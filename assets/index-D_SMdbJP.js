(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var jsxRuntime={exports:{}},reactJsxRuntime_production={};var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:r,type:n,key:o,ref:i!==void 0?i:null,props:s}}return reactJsxRuntime_production.Fragment=e,reactJsxRuntime_production.jsx=t,reactJsxRuntime_production.jsxs=t,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),x=Symbol.iterator;function y(B){return B===null||typeof B!="object"?null:(B=x&&B[x]||B["@@iterator"],typeof B=="function"?B:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,h={};function f(B,V,Y){this.props=B,this.context=V,this.refs=h,this.updater=Y||b}f.prototype.isReactComponent={},f.prototype.setState=function(B,V){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,V,"setState")},f.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function E(){}E.prototype=f.prototype;function m(B,V,Y){this.props=B,this.context=V,this.refs=h,this.updater=Y||b}var S=m.prototype=new E;S.constructor=m,_(S,f.prototype),S.isPureReactComponent=!0;var w=Array.isArray;function v(){}var A={H:null,A:null,T:null,S:null},M=Object.prototype.hasOwnProperty;function T(B,V,Y){var K=Y.ref;return{$$typeof:r,type:B,key:V,ref:K!==void 0?K:null,props:Y}}function R(B,V){return T(B.type,V,B.props)}function O(B){return typeof B=="object"&&B!==null&&B.$$typeof===r}function L(B){var V={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(Y){return V[Y]})}var P=/\/+/g;function I(B,V){return typeof B=="object"&&B!==null&&B.key!=null?L(""+B.key):V.toString(36)}function N(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(v,v):(B.status="pending",B.then(function(V){B.status==="pending"&&(B.status="fulfilled",B.value=V)},function(V){B.status==="pending"&&(B.status="rejected",B.reason=V)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function U(B,V,Y,K,J){var Te=typeof B;(Te==="undefined"||Te==="boolean")&&(B=null);var He=!1;if(B===null)He=!0;else switch(Te){case"bigint":case"string":case"number":He=!0;break;case"object":switch(B.$$typeof){case r:case e:He=!0;break;case u:return He=B._init,U(He(B._payload),V,Y,K,J)}}if(He)return J=J(B),He=K===""?"."+I(B,0):K,w(J)?(Y="",He!=null&&(Y=He.replace(P,"$&/")+"/"),U(J,V,Y,"",function(ut){return ut})):J!=null&&(O(J)&&(J=R(J,Y+(J.key==null||B&&B.key===J.key?"":(""+J.key).replace(P,"$&/")+"/")+He)),V.push(J)),1;He=0;var Q=K===""?".":K+":";if(w(B))for(var Xe=0;Xe<B.length;Xe++)K=B[Xe],Te=Q+I(K,Xe),He+=U(K,V,Y,Te,J);else if(Xe=y(B),typeof Xe=="function")for(B=Xe.call(B),Xe=0;!(K=B.next()).done;)K=K.value,Te=Q+I(K,Xe++),He+=U(K,V,Y,Te,J);else if(Te==="object"){if(typeof B.then=="function")return U(N(B),V,Y,K,J);throw V=String(B),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return He}function F(B,V,Y){if(B==null)return B;var K=[],J=0;return U(B,K,"","",function(Te){return V.call(Y,Te,J++)}),K}function k(B){if(B._status===-1){var V=B._result;V=V(),V.then(function(Y){(B._status===0||B._status===-1)&&(B._status=1,B._result=Y)},function(Y){(B._status===0||B._status===-1)&&(B._status=2,B._result=Y)}),B._status===-1&&(B._status=0,B._result=V)}if(B._status===1)return B._result.default;throw B._result}var j=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},H={map:F,forEach:function(B,V,Y){F(B,function(){V.apply(this,arguments)},Y)},count:function(B){var V=0;return F(B,function(){V++}),V},toArray:function(B){return F(B,function(V){return V})||[]},only:function(B){if(!O(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return react_production.Activity=g,react_production.Children=H,react_production.Component=f,react_production.Fragment=t,react_production.Profiler=i,react_production.PureComponent=m,react_production.StrictMode=n,react_production.Suspense=l,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(B){return A.H.useMemoCache(B)}},react_production.cache=function(B){return function(){return B.apply(null,arguments)}},react_production.cacheSignal=function(){return null},react_production.cloneElement=function(B,V,Y){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var K=_({},B.props),J=B.key;if(V!=null)for(Te in V.key!==void 0&&(J=""+V.key),V)!M.call(V,Te)||Te==="key"||Te==="__self"||Te==="__source"||Te==="ref"&&V.ref===void 0||(K[Te]=V[Te]);var Te=arguments.length-2;if(Te===1)K.children=Y;else if(1<Te){for(var He=Array(Te),Q=0;Q<Te;Q++)He[Q]=arguments[Q+2];K.children=He}return T(B.type,J,K)},react_production.createContext=function(B){return B={$$typeof:o,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:s,_context:B},B},react_production.createElement=function(B,V,Y){var K,J={},Te=null;if(V!=null)for(K in V.key!==void 0&&(Te=""+V.key),V)M.call(V,K)&&K!=="key"&&K!=="__self"&&K!=="__source"&&(J[K]=V[K]);var He=arguments.length-2;if(He===1)J.children=Y;else if(1<He){for(var Q=Array(He),Xe=0;Xe<He;Xe++)Q[Xe]=arguments[Xe+2];J.children=Q}if(B&&B.defaultProps)for(K in He=B.defaultProps,He)J[K]===void 0&&(J[K]=He[K]);return T(B,Te,J)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(B){return{$$typeof:a,render:B}},react_production.isValidElement=O,react_production.lazy=function(B){return{$$typeof:u,_payload:{_status:-1,_result:B},_init:k}},react_production.memo=function(B,V){return{$$typeof:d,type:B,compare:V===void 0?null:V}},react_production.startTransition=function(B){var V=A.T,Y={};A.T=Y;try{var K=B(),J=A.S;J!==null&&J(Y,K),typeof K=="object"&&K!==null&&typeof K.then=="function"&&K.then(v,j)}catch(Te){j(Te)}finally{V!==null&&Y.types!==null&&(V.types=Y.types),A.T=V}},react_production.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},react_production.use=function(B){return A.H.use(B)},react_production.useActionState=function(B,V,Y){return A.H.useActionState(B,V,Y)},react_production.useCallback=function(B,V){return A.H.useCallback(B,V)},react_production.useContext=function(B){return A.H.useContext(B)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(B,V){return A.H.useDeferredValue(B,V)},react_production.useEffect=function(B,V){return A.H.useEffect(B,V)},react_production.useEffectEvent=function(B){return A.H.useEffectEvent(B)},react_production.useId=function(){return A.H.useId()},react_production.useImperativeHandle=function(B,V,Y){return A.H.useImperativeHandle(B,V,Y)},react_production.useInsertionEffect=function(B,V){return A.H.useInsertionEffect(B,V)},react_production.useLayoutEffect=function(B,V){return A.H.useLayoutEffect(B,V)},react_production.useMemo=function(B,V){return A.H.useMemo(B,V)},react_production.useOptimistic=function(B,V){return A.H.useOptimistic(B,V)},react_production.useReducer=function(B,V,Y){return A.H.useReducer(B,V,Y)},react_production.useRef=function(B){return A.H.useRef(B)},react_production.useState=function(B){return A.H.useState(B)},react_production.useSyncExternalStore=function(B,V,Y){return A.H.useSyncExternalStore(B,V,Y)},react_production.useTransition=function(){return A.H.useTransition()},react_production.version="19.2.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact(),client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(r){function e(U,F){var k=U.length;U.push(F);e:for(;0<k;){var j=k-1>>>1,H=U[j];if(0<i(H,F))U[j]=F,U[k]=H,k=j;else break e}}function t(U){return U.length===0?null:U[0]}function n(U){if(U.length===0)return null;var F=U[0],k=U.pop();if(k!==F){U[0]=k;e:for(var j=0,H=U.length,B=H>>>1;j<B;){var V=2*(j+1)-1,Y=U[V],K=V+1,J=U[K];if(0>i(Y,k))K<H&&0>i(J,Y)?(U[j]=J,U[K]=k,j=K):(U[j]=Y,U[V]=k,j=V);else if(K<H&&0>i(J,k))U[j]=J,U[K]=k,j=K;else break e}}return F}function i(U,F){var k=U.sortIndex-F.sortIndex;return k!==0?k:U.id-F.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var l=[],d=[],u=1,g=null,x=3,y=!1,b=!1,_=!1,h=!1,f=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;function S(U){for(var F=t(d);F!==null;){if(F.callback===null)n(d);else if(F.startTime<=U)n(d),F.sortIndex=F.expirationTime,e(l,F);else break;F=t(d)}}function w(U){if(_=!1,S(U),!b)if(t(l)!==null)b=!0,v||(v=!0,L());else{var F=t(d);F!==null&&N(w,F.startTime-U)}}var v=!1,A=-1,M=5,T=-1;function R(){return h?!0:!(r.unstable_now()-T<M)}function O(){if(h=!1,v){var U=r.unstable_now();T=U;var F=!0;try{e:{b=!1,_&&(_=!1,E(A),A=-1),y=!0;var k=x;try{t:{for(S(U),g=t(l);g!==null&&!(g.expirationTime>U&&R());){var j=g.callback;if(typeof j=="function"){g.callback=null,x=g.priorityLevel;var H=j(g.expirationTime<=U);if(U=r.unstable_now(),typeof H=="function"){g.callback=H,S(U),F=!0;break t}g===t(l)&&n(l),S(U)}else n(l);g=t(l)}if(g!==null)F=!0;else{var B=t(d);B!==null&&N(w,B.startTime-U),F=!1}}break e}finally{g=null,x=k,y=!1}F=void 0}}finally{F?L():v=!1}}}var L;if(typeof m=="function")L=function(){m(O)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,I=P.port2;P.port1.onmessage=O,L=function(){I.postMessage(null)}}else L=function(){f(O,0)};function N(U,F){A=f(function(){U(r.unstable_now())},F)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(U){U.callback=null},r.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<U?Math.floor(1e3/U):5},r.unstable_getCurrentPriorityLevel=function(){return x},r.unstable_next=function(U){switch(x){case 1:case 2:case 3:var F=3;break;default:F=x}var k=x;x=F;try{return U()}finally{x=k}},r.unstable_requestPaint=function(){h=!0},r.unstable_runWithPriority=function(U,F){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var k=x;x=U;try{return F()}finally{x=k}},r.unstable_scheduleCallback=function(U,F,k){var j=r.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?j+k:j):k=j,U){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=k+H,U={id:u++,callback:F,priorityLevel:U,startTime:k,expirationTime:H,sortIndex:-1},k>j?(U.sortIndex=k,e(d,U),t(l)===null&&U===t(d)&&(_?(E(A),A=-1):_=!0,N(w,k-j))):(U.sortIndex=H,e(l,U),b||y||(b=!0,v||(v=!0,L()))),U},r.unstable_shouldYield=R,r.unstable_wrapCallback=function(U){var F=x;return function(){var k=x;x=F;try{return U.apply(this,arguments)}finally{x=k}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var r=requireReact();function e(l){var d="https://react.dev/errors/"+l;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)d+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+l+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(l,d,u){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:l,containerInfo:d,implementation:u}}var o=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(l,d){if(l==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,reactDom_production.createPortal=function(l,d){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(l,d,null,u)},reactDom_production.flushSync=function(l){var d=o.T,u=n.p;try{if(o.T=null,n.p=2,l)return l()}finally{o.T=d,n.p=u,n.d.f()}},reactDom_production.preconnect=function(l,d){typeof l=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,n.d.C(l,d))},reactDom_production.prefetchDNS=function(l){typeof l=="string"&&n.d.D(l)},reactDom_production.preinit=function(l,d){if(typeof l=="string"&&d&&typeof d.as=="string"){var u=d.as,g=a(u,d.crossOrigin),x=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;u==="style"?n.d.S(l,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:x,fetchPriority:y}):u==="script"&&n.d.X(l,{crossOrigin:g,integrity:x,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},reactDom_production.preinitModule=function(l,d){if(typeof l=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var u=a(d.as,d.crossOrigin);n.d.M(l,{crossOrigin:u,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&n.d.M(l)},reactDom_production.preload=function(l,d){if(typeof l=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var u=d.as,g=a(u,d.crossOrigin);n.d.L(l,u,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},reactDom_production.preloadModule=function(l,d){if(typeof l=="string")if(d){var u=a(d.as,d.crossOrigin);n.d.m(l,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:u,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else n.d.m(l)},reactDom_production.requestFormReset=function(l){n.d.r(l)},reactDom_production.unstable_batchedUpdates=function(l,d){return l(d)},reactDom_production.useFormState=function(l,d,u){return o.H.useFormState(l,d,u)},reactDom_production.useFormStatus=function(){return o.H.useHostTransitionStatus()},reactDom_production.version="19.2.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),reactDom.exports=requireReactDom_production(),reactDom.exports}var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var r=requireScheduler(),e=requireReact(),t=requireReactDom();function n(c){var p="https://react.dev/errors/"+c;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)p+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+c+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function s(c){var p=c,C=c;if(c.alternate)for(;p.return;)p=p.return;else{c=p;do p=c,(p.flags&4098)!==0&&(C=p.return),c=p.return;while(c)}return p.tag===3?C:null}function o(c){if(c.tag===13){var p=c.memoizedState;if(p===null&&(c=c.alternate,c!==null&&(p=c.memoizedState)),p!==null)return p.dehydrated}return null}function a(c){if(c.tag===31){var p=c.memoizedState;if(p===null&&(c=c.alternate,c!==null&&(p=c.memoizedState)),p!==null)return p.dehydrated}return null}function l(c){if(s(c)!==c)throw Error(n(188))}function d(c){var p=c.alternate;if(!p){if(p=s(c),p===null)throw Error(n(188));return p!==c?null:c}for(var C=c,D=p;;){var G=C.return;if(G===null)break;var $=G.alternate;if($===null){if(D=G.return,D!==null){C=D;continue}break}if(G.child===$.child){for($=G.child;$;){if($===C)return l(G),c;if($===D)return l(G),p;$=$.sibling}throw Error(n(188))}if(C.return!==D.return)C=G,D=$;else{for(var et=!1,n0=G.child;n0;){if(n0===C){et=!0,C=G,D=$;break}if(n0===D){et=!0,D=G,C=$;break}n0=n0.sibling}if(!et){for(n0=$.child;n0;){if(n0===C){et=!0,C=$,D=G;break}if(n0===D){et=!0,D=$,C=G;break}n0=n0.sibling}if(!et)throw Error(n(189))}}if(C.alternate!==D)throw Error(n(190))}if(C.tag!==3)throw Error(n(188));return C.stateNode.current===C?c:p}function u(c){var p=c.tag;if(p===5||p===26||p===27||p===6)return c;for(c=c.child;c!==null;){if(p=u(c),p!==null)return p;c=c.sibling}return null}var g=Object.assign,x=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),m=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),T=Symbol.for("react.activity"),R=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function L(c){return c===null||typeof c!="object"?null:(c=O&&c[O]||c["@@iterator"],typeof c=="function"?c:null)}var P=Symbol.for("react.client.reference");function I(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===P?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case _:return"Fragment";case f:return"Profiler";case h:return"StrictMode";case w:return"Suspense";case v:return"SuspenseList";case T:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case b:return"Portal";case m:return c.displayName||"Context";case E:return(c._context.displayName||"Context")+".Consumer";case S:var p=c.render;return c=c.displayName,c||(c=p.displayName||p.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case A:return p=c.displayName||null,p!==null?p:I(c.type)||"Memo";case M:p=c._payload,c=c._init;try{return I(c(p))}catch{}}return null}var N=Array.isArray,U=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,k={pending:!1,data:null,method:null,action:null},j=[],H=-1;function B(c){return{current:c}}function V(c){0>H||(c.current=j[H],j[H]=null,H--)}function Y(c,p){H++,j[H]=c.current,c.current=p}var K=B(null),J=B(null),Te=B(null),He=B(null);function Q(c,p){switch(Y(Te,p),Y(J,c),Y(K,null),p.nodeType){case 9:case 11:c=(c=p.documentElement)&&(c=c.namespaceURI)?zT(c):0;break;default:if(c=p.tagName,p=p.namespaceURI)p=zT(p),c=FT(p,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}V(K),Y(K,c)}function Xe(){V(K),V(J),V(Te)}function ut(c){c.memoizedState!==null&&Y(He,c);var p=K.current,C=FT(p,c.type);p!==C&&(Y(J,c),Y(K,C))}function Ji(c){J.current===c&&(V(K),V(J)),He.current===c&&(V(He),xA._currentValue=k)}var er,ec;function ai(c){if(er===void 0)try{throw Error()}catch(C){var p=C.stack.trim().match(/\n( *(at )?)/);er=p&&p[1]||"",ec=-1<C.stack.indexOf(`
    at`)?" (<anonymous>)":-1<C.stack.indexOf("@")?"@unknown:0:0":""}return`
`+er+c+ec}var u0=!1;function o0(c,p){if(!c||u0)return"";u0=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var D={DetermineComponentFrameRoot:function(){try{if(p){var t1=function(){throw Error()};if(Object.defineProperty(t1.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t1,[])}catch(q0){var Y0=q0}Reflect.construct(c,[],t1)}else{try{t1.call()}catch(q0){Y0=q0}c.call(t1.prototype)}}else{try{throw Error()}catch(q0){Y0=q0}(t1=c())&&typeof t1.catch=="function"&&t1.catch(function(){})}}catch(q0){if(q0&&Y0&&typeof q0.stack=="string")return[q0.stack,Y0.stack]}return[null,null]}};D.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var G=Object.getOwnPropertyDescriptor(D.DetermineComponentFrameRoot,"name");G&&G.configurable&&Object.defineProperty(D.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var $=D.DetermineComponentFrameRoot(),et=$[0],n0=$[1];if(et&&n0){var R0=et.split(`
`),W0=n0.split(`
`);for(G=D=0;D<R0.length&&!R0[D].includes("DetermineComponentFrameRoot");)D++;for(;G<W0.length&&!W0[G].includes("DetermineComponentFrameRoot");)G++;if(D===R0.length||G===W0.length)for(D=R0.length-1,G=W0.length-1;1<=D&&0<=G&&R0[D]!==W0[G];)G--;for(;1<=D&&0<=G;D--,G--)if(R0[D]!==W0[G]){if(D!==1||G!==1)do if(D--,G--,0>G||R0[D]!==W0[G]){var Q0=`
`+R0[D].replace(" at new "," at ");return c.displayName&&Q0.includes("<anonymous>")&&(Q0=Q0.replace("<anonymous>",c.displayName)),Q0}while(1<=D&&0<=G);break}}}finally{u0=!1,Error.prepareStackTrace=C}return(C=c?c.displayName||c.name:"")?ai(C):""}function E0(c,p){switch(c.tag){case 26:case 27:case 5:return ai(c.type);case 16:return ai("Lazy");case 13:return c.child!==p&&p!==null?ai("Suspense Fallback"):ai("Suspense");case 19:return ai("SuspenseList");case 0:case 15:return o0(c.type,!1);case 11:return o0(c.type.render,!1);case 1:return o0(c.type,!0);case 31:return ai("Activity");default:return""}}function F0(c){try{var p="",C=null;do p+=E0(c,C),C=c,c=c.return;while(c);return p}catch(D){return`
Error generating stack: `+D.message+`
`+D.stack}}var g0=Object.prototype.hasOwnProperty,w0=r.unstable_scheduleCallback,L0=r.unstable_cancelCallback,T0=r.unstable_shouldYield,ht=r.unstable_requestPaint,We=r.unstable_now,h0=r.unstable_getCurrentPriorityLevel,M0=r.unstable_ImmediatePriority,Z=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,tr=r.unstable_LowPriority,s0=r.unstable_IdlePriority,c0=r.log,A0=r.unstable_setDisableYieldValue,P0=null,Fe=null;function f0(c){if(typeof c0=="function"&&A0(c),Fe&&typeof Fe.setStrictMode=="function")try{Fe.setStrictMode(P0,c)}catch{}}var v0=Math.clz32?Math.clz32:y0,D0=Math.log,l0=Math.LN2;function y0(c){return c>>>=0,c===0?32:31-(D0(c)/l0|0)|0}var lt=256,oi=262144,b0=4194304;function W(c){var p=c&42;if(p!==0)return p;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function e0(c,p,C){var D=c.pendingLanes;if(D===0)return 0;var G=0,$=c.suspendedLanes,et=c.pingedLanes;c=c.warmLanes;var n0=D&134217727;return n0!==0?(D=n0&~$,D!==0?G=W(D):(et&=n0,et!==0?G=W(et):C||(C=n0&~c,C!==0&&(G=W(C))))):(n0=D&~$,n0!==0?G=W(n0):et!==0?G=W(et):C||(C=D&~c,C!==0&&(G=W(C)))),G===0?0:p!==0&&p!==G&&(p&$)===0&&($=G&-G,C=p&-p,$>=C||$===32&&(C&4194048)!==0)?p:G}function a0(c,p){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&p)===0}function hi(c,p){switch(c){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function p0(){var c=b0;return b0<<=1,(b0&62914560)===0&&(b0=4194304),c}function O0(c){for(var p=[],C=0;31>C;C++)p.push(c);return p}function q(c,p){c.pendingLanes|=p,p!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function it(c,p,C,D,G,$){var et=c.pendingLanes;c.pendingLanes=C,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=C,c.entangledLanes&=C,c.errorRecoveryDisabledLanes&=C,c.shellSuspendCounter=0;var n0=c.entanglements,R0=c.expirationTimes,W0=c.hiddenUpdates;for(C=et&~C;0<C;){var Q0=31-v0(C),t1=1<<Q0;n0[Q0]=0,R0[Q0]=-1;var Y0=W0[Q0];if(Y0!==null)for(W0[Q0]=null,Q0=0;Q0<Y0.length;Q0++){var q0=Y0[Q0];q0!==null&&(q0.lane&=-536870913)}C&=~t1}D!==0&&at(c,D,0),$!==0&&G===0&&c.tag!==0&&(c.suspendedLanes|=$&~(et&~p))}function at(c,p,C){c.pendingLanes|=p,c.suspendedLanes&=~p;var D=31-v0(p);c.entangledLanes|=p,c.entanglements[D]=c.entanglements[D]|1073741824|C&261930}function t0(c,p){var C=c.entangledLanes|=p;for(c=c.entanglements;C;){var D=31-v0(C),G=1<<D;G&p|c[D]&p&&(c[D]|=p),C&=~G}}function i0(c,p){var C=p&-p;return C=(C&42)!==0?1:d0(C),(C&(c.suspendedLanes|p))!==0?0:C}function d0(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function _0(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function S0(){var c=F.p;return c!==0?c:(c=window.event,c===void 0?32:o3(c.type))}function $0(c,p){var C=F.p;try{return F.p=c,p()}finally{F.p=C}}var K0=Math.random().toString(36).slice(2),n1="__reactFiber$"+K0,c1="__reactProps$"+K0,J0="__reactContainer$"+K0,Z0="__reactEvents$"+K0,Hm="__reactListeners$"+K0,C0="__reactHandles$"+K0,z0="__reactResources$"+K0,B0="__reactMarker$"+K0;function V0(c){delete c[n1],delete c[c1],delete c[Z0],delete c[Hm],delete c[C0]}function i1(c){var p=c[n1];if(p)return p;for(var C=c.parentNode;C;){if(p=C[J0]||C[n1]){if(C=p.alternate,p.child!==null||C!==null&&C.child!==null)for(c=WT(c);c!==null;){if(C=c[n1])return C;c=WT(c)}return p}c=C,C=c.parentNode}return null}function u1(c){if(c=c[n1]||c[J0]){var p=c.tag;if(p===5||p===6||p===13||p===31||p===26||p===27||p===3)return c}return null}function f1(c){var p=c.tag;if(p===5||p===26||p===27||p===6)return c.stateNode;throw Error(n(33))}function a1(c){var p=c[z0];return p||(p=c[z0]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function k0(c){c[B0]=!0}var r1=new Set,l1={};function v1(c,p){p1(c,p),p1(c+"Capture",p)}function p1(c,p){for(l1[c]=p,c=0;c<p.length;c++)r1.add(p[c])}var b1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),M1={},o1={};function g1(c){return g0.call(o1,c)?!0:g0.call(M1,c)?!1:b1.test(c)?o1[c]=!0:(M1[c]=!0,!1)}function y1(c,p,C){if(g1(p))if(C===null)c.removeAttribute(p);else{switch(typeof C){case"undefined":case"function":case"symbol":c.removeAttribute(p);return;case"boolean":var D=p.toLowerCase().slice(0,5);if(D!=="data-"&&D!=="aria-"){c.removeAttribute(p);return}}c.setAttribute(p,""+C)}}function C1(c,p,C){if(C===null)c.removeAttribute(p);else{switch(typeof C){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(p);return}c.setAttribute(p,""+C)}}function q1(c,p,C,D){if(D===null)c.removeAttribute(C);else{switch(typeof D){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(C);return}c.setAttributeNS(p,C,""+D)}}function P_(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function ov(c){var p=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function fv(c,p,C){var D=Object.getOwnPropertyDescriptor(c.constructor.prototype,p);if(!c.hasOwnProperty(p)&&typeof D<"u"&&typeof D.get=="function"&&typeof D.set=="function"){var G=D.get,$=D.set;return Object.defineProperty(c,p,{configurable:!0,get:function(){return G.call(this)},set:function(et){C=""+et,$.call(this,et)}}),Object.defineProperty(c,p,{enumerable:D.enumerable}),{getValue:function(){return C},setValue:function(et){C=""+et},stopTracking:function(){c._valueTracker=null,delete c[p]}}}}function Z1(c){if(!c._valueTracker){var p=ov(c)?"checked":"value";c._valueTracker=fv(c,p,""+c[p])}}function $_(c){if(!c)return!1;var p=c._valueTracker;if(!p)return!0;var C=p.getValue(),D="";return c&&(D=ov(c)?c.checked?"true":"false":c.value),c=D,c!==C?(p.setValue(c),!0):!1}function z_(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var R_=/[\n"\\]/g;function z1(c){return c.replace(R_,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function pv(c,p,C,D,G,$,et,n0){c.name="",et!=null&&typeof et!="function"&&typeof et!="symbol"&&typeof et!="boolean"?c.type=et:c.removeAttribute("type"),p!=null?et==="number"?(p===0&&c.value===""||c.value!=p)&&(c.value=""+P_(p)):c.value!==""+P_(p)&&(c.value=""+P_(p)):et!=="submit"&&et!=="reset"||c.removeAttribute("value"),p!=null?lv(c,et,P_(p)):C!=null?lv(c,et,P_(C)):D!=null&&c.removeAttribute("value"),G==null&&$!=null&&(c.defaultChecked=!!$),G!=null&&(c.checked=G&&typeof G!="function"&&typeof G!="symbol"),n0!=null&&typeof n0!="function"&&typeof n0!="symbol"&&typeof n0!="boolean"?c.name=""+P_(n0):c.removeAttribute("name")}function Z_(c,p,C,D,G,$,et,n0){if($!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(c.type=$),p!=null||C!=null){if(!($!=="submit"&&$!=="reset"||p!=null)){Z1(c);return}C=C!=null?""+P_(C):"",p=p!=null?""+P_(p):C,n0||p===c.value||(c.value=p),c.defaultValue=p}D=D??G,D=typeof D!="function"&&typeof D!="symbol"&&!!D,c.checked=n0?c.checked:!!D,c.defaultChecked=!!D,et!=null&&typeof et!="function"&&typeof et!="symbol"&&typeof et!="boolean"&&(c.name=et),Z1(c)}function lv(c,p,C){p==="number"&&z_(c.ownerDocument)===c||c.defaultValue===""+C||(c.defaultValue=""+C)}function yv(c,p,C,D){if(c=c.options,p){p={};for(var G=0;G<C.length;G++)p["$"+C[G]]=!0;for(C=0;C<c.length;C++)G=p.hasOwnProperty("$"+c[C].value),c[C].selected!==G&&(c[C].selected=G),G&&D&&(c[C].defaultSelected=!0)}else{for(C=""+P_(C),p=null,G=0;G<c.length;G++){if(c[G].value===C){c[G].selected=!0,D&&(c[G].defaultSelected=!0);return}p!==null||c[G].disabled||(p=c[G])}p!==null&&(p.selected=!0)}}function cv(c,p,C){if(p!=null&&(p=""+P_(p),p!==c.value&&(c.value=p),C==null)){c.defaultValue!==p&&(c.defaultValue=p);return}c.defaultValue=C!=null?""+P_(C):""}function Wv(c,p,C,D){if(p==null){if(D!=null){if(C!=null)throw Error(n(92));if(N(D)){if(1<D.length)throw Error(n(93));D=D[0]}C=D}C==null&&(C=""),p=C}C=P_(p),c.defaultValue=C,D=c.textContent,D===C&&D!==""&&D!==null&&(c.value=D),Z1(c)}function V_(c,p){if(p){var C=c.firstChild;if(C&&C===c.lastChild&&C.nodeType===3){C.nodeValue=p;return}}c.textContent=p}var dx=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function fx(c,p,C){var D=p.indexOf("--")===0;C==null||typeof C=="boolean"||C===""?D?c.setProperty(p,""):p==="float"?c.cssFloat="":c[p]="":D?c.setProperty(p,C):typeof C!="number"||C===0||dx.has(p)?p==="float"?c.cssFloat=C:c[p]=(""+C).trim():c[p]=C+"px"}function rv(c,p,C){if(p!=null&&typeof p!="object")throw Error(n(62));if(c=c.style,C!=null){for(var D in C)!C.hasOwnProperty(D)||p!=null&&p.hasOwnProperty(D)||(D.indexOf("--")===0?c.setProperty(D,""):D==="float"?c.cssFloat="":c[D]="");for(var G in p)D=p[G],p.hasOwnProperty(G)&&C[G]!==D&&fx(c,G,D)}else for(var $ in p)p.hasOwnProperty($)&&fx(c,$,p[$])}function O_(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var X_=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),G1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function H_(c){return G1.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function Q_(){}var tx=null;function bv(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var px=null,nx=null;function mx(c){var p=u1(c);if(p&&(c=p.stateNode)){var C=c[c1]||null;e:switch(c=p.stateNode,p.type){case"input":if(pv(c,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name),p=C.name,C.type==="radio"&&p!=null){for(C=c;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll('input[name="'+z1(""+p)+'"][type="radio"]'),p=0;p<C.length;p++){var D=C[p];if(D!==c&&D.form===c.form){var G=D[c1]||null;if(!G)throw Error(n(90));pv(D,G.value,G.defaultValue,G.defaultValue,G.checked,G.defaultChecked,G.type,G.name)}}for(p=0;p<C.length;p++)D=C[p],D.form===c.form&&$_(D)}break e;case"textarea":cv(c,C.value,C.defaultValue);break e;case"select":p=C.value,p!=null&&yv(c,!!C.multiple,p,!1)}}}var MS=!1;function AA(c,p,C){if(MS)return c(p,C);MS=!0;try{var D=c(p);return D}finally{if(MS=!1,(px!==null||nx!==null)&&(_E(),px&&(p=px,c=nx,nx=px=null,mx(p),c)))for(p=0;p<c.length;p++)mx(c[p])}}function uv(c,p){var C=c.stateNode;if(C===null)return null;var D=C[c1]||null;if(D===null)return null;C=D[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(c=c.type,D=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!D;break e;default:c=!1}if(c)return null;if(C&&typeof C!="function")throw Error(n(231,p,typeof C));return C}var mv=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),wS=!1;if(mv)try{var d2={};Object.defineProperty(d2,"passive",{get:function(){wS=!0}}),window.addEventListener("test",d2,d2),window.removeEventListener("test",d2,d2)}catch{wS=!1}var Sv=null,G2=null,f2=null;function EA(){if(f2)return f2;var c,p=G2,C=p.length,D,G="value"in Sv?Sv.value:Sv.textContent,$=G.length;for(c=0;c<C&&p[c]===G[c];c++);var et=C-c;for(D=1;D<=et&&p[C-D]===G[$-D];D++);return f2=G.slice(c,1<D?1-D:void 0)}function p2(c){var p=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&p===13&&(c=13)):c=p,c===10&&(c=13),32<=c||c===13?c:0}function V2(){return!0}function MA(){return!1}function hv(c){function p(C,D,G,$,et){this._reactName=C,this._targetInst=G,this.type=D,this.nativeEvent=$,this.target=et,this.currentTarget=null;for(var n0 in c)c.hasOwnProperty(n0)&&(C=c[n0],this[n0]=C?C($):$[n0]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?V2:MA,this.isPropagationStopped=MA,this}return g(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=V2)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=V2)},persist:function(){},isPersistent:V2}),p}var gx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},H2=hv(gx),m2=g({},gx,{view:0,detail:0}),UE=hv(m2),CS,TS,g2,j2=g({},m2,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:$2,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==g2&&(g2&&c.type==="mousemove"?(CS=c.screenX-g2.screenX,TS=c.screenY-g2.screenY):TS=CS=0,g2=c),CS)},movementY:function(c){return"movementY"in c?c.movementY:TS}}),wA=hv(j2),kE=g({},j2,{dataTransfer:0}),_2=hv(kE),GE=g({},m2,{relatedTarget:0}),RS=hv(GE),VE=g({},gx,{animationName:0,elapsedTime:0,pseudoElement:0}),W2=hv(VE),CA=g({},gx,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),v2=hv(CA),HE=g({},gx,{data:0}),TA=hv(HE),jE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},WE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},x2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $E(c){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(c):(c=x2[c])?!!p[c]:!1}function $2(){return $E}var RA=g({},m2,{key:function(c){if(c.key){var p=jE[c.key]||c.key;if(p!=="Unidentified")return p}return c.type==="keypress"?(c=p2(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?WE[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:$2,charCode:function(c){return c.type==="keypress"?p2(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?p2(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),XE=hv(RA),YE=g({},j2,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),DA=hv(YE),KE=g({},m2,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:$2}),X2=hv(KE),qE=g({},gx,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZE=hv(qE),QE=g({},j2,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),JE=hv(QE),y2=g({},gx,{newState:0,oldState:0}),DS=hv(y2),eM=[9,13,27,32],LS=mv&&"CompositionEvent"in window,b2=null;mv&&"documentMode"in document&&(b2=document.documentMode);var tM=mv&&"TextEvent"in window&&!b2,LA=mv&&(!LS||b2&&8<b2&&11>=b2),PA=" ",OA=!1;function S2(c,p){switch(c){case"keyup":return eM.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function IA(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Ux=!1;function kx(c,p){switch(c){case"compositionend":return IA(p);case"keypress":return p.which!==32?null:(OA=!0,PA);case"textInput":return c=p.data,c===PA&&OA?null:c;default:return null}}function BA(c,p){if(Ux)return c==="compositionend"||!LS&&S2(c,p)?(c=EA(),f2=G2=Sv=null,Ux=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return LA&&p.locale!=="ko"?null:p.data;default:return null}}var NA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function PS(c){var p=c&&c.nodeName&&c.nodeName.toLowerCase();return p==="input"?!!NA[c.type]:p==="textarea"}function Y2(c,p,C,D){px?nx?nx.push(D):nx=[D]:px=D,p=EE(p,"onChange"),0<p.length&&(C=new H2("onChange","change",null,C,D),c.push({event:C,listeners:p}))}var Gx=null,A2=null;function nM(c){LT(c,0)}function K2(c){var p=f1(c);if($_(p))return c}function zA(c,p){if(c==="change")return p}var iM=!1;if(mv){var vx;if(mv){var OS="oninput"in document;if(!OS){var IS=document.createElement("div");IS.setAttribute("oninput","return;"),OS=typeof IS.oninput=="function"}vx=OS}else vx=!1;iM=vx&&(!document.documentMode||9<document.documentMode)}function BS(){Gx&&(Gx.detachEvent("onpropertychange",NS),A2=Gx=null)}function NS(c){if(c.propertyName==="value"&&K2(A2)){var p=[];Y2(p,A2,c,bv(c)),AA(nM,p)}}function rM(c,p,C){c==="focusin"?(BS(),Gx=p,A2=C,Gx.attachEvent("onpropertychange",NS)):c==="focusout"&&BS()}function q2(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return K2(A2)}function xx(c,p){if(c==="click")return K2(p)}function sM(c,p){if(c==="input"||c==="change")return K2(p)}function aM(c,p){return c===p&&(c!==0||1/c===1/p)||c!==c&&p!==p}var I_=typeof Object.is=="function"?Object.is:aM;function Vx(c,p){if(I_(c,p))return!0;if(typeof c!="object"||c===null||typeof p!="object"||p===null)return!1;var C=Object.keys(c),D=Object.keys(p);if(C.length!==D.length)return!1;for(D=0;D<C.length;D++){var G=C[D];if(!g0.call(p,G)||!I_(c[G],p[G]))return!1}return!0}function zS(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function FA(c,p){var C=zS(c);c=0;for(var D;C;){if(C.nodeType===3){if(D=c+C.textContent.length,c<=p&&D>=p)return{node:C,offset:p-c};c=D}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=zS(C)}}function FS(c,p){return c&&p?c===p?!0:c&&c.nodeType===3?!1:p&&p.nodeType===3?FS(c,p.parentNode):"contains"in c?c.contains(p):c.compareDocumentPosition?!!(c.compareDocumentPosition(p)&16):!1:!1}function E2(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var p=z_(c.document);p instanceof c.HTMLIFrameElement;){try{var C=typeof p.contentWindow.location.href=="string"}catch{C=!1}if(C)c=p.contentWindow;else break;p=z_(c.document)}return p}function Z2(c){var p=c&&c.nodeName&&c.nodeName.toLowerCase();return p&&(p==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||p==="textarea"||c.contentEditable==="true")}var UA=mv&&"documentMode"in document&&11>=document.documentMode,yx=null,Q2=null,Hx=null,J2=!1;function US(c,p,C){var D=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;J2||yx==null||yx!==z_(D)||(D=yx,"selectionStart"in D&&Z2(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),Hx&&Vx(Hx,D)||(Hx=D,D=EE(Q2,"onSelect"),0<D.length&&(p=new H2("onSelect","select",null,p,C),c.push({event:p,listeners:D}),p.target=yx)))}function ix(c,p){var C={};return C[c.toLowerCase()]=p.toLowerCase(),C["Webkit"+c]="webkit"+p,C["Moz"+c]="moz"+p,C}var bx={animationend:ix("Animation","AnimationEnd"),animationiteration:ix("Animation","AnimationIteration"),animationstart:ix("Animation","AnimationStart"),transitionrun:ix("Transition","TransitionRun"),transitionstart:ix("Transition","TransitionStart"),transitioncancel:ix("Transition","TransitionCancel"),transitionend:ix("Transition","TransitionEnd")},jx={},zv={};mv&&(zv=document.createElement("div").style,"AnimationEvent"in window||(delete bx.animationend.animation,delete bx.animationiteration.animation,delete bx.animationstart.animation),"TransitionEvent"in window||delete bx.transitionend.transition);function $v(c){if(jx[c])return jx[c];if(!bx[c])return c;var p=bx[c],C;for(C in p)if(p.hasOwnProperty(C)&&C in zv)return jx[c]=p[C];return c}var kS=$v("animationend"),eS=$v("animationiteration"),GS=$v("animationstart"),kA=$v("transitionrun"),GA=$v("transitionstart"),VA=$v("transitioncancel"),M2=$v("transitionend"),w2=new Map,tS="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");tS.push("scrollEnd");function Av(c,p){w2.set(c,p),v1(p,[c])}var C2=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},gv=[],Sx=0,T2=0;function R2(){for(var c=Sx,p=T2=Sx=0;p<c;){var C=gv[p];gv[p++]=null;var D=gv[p];gv[p++]=null;var G=gv[p];gv[p++]=null;var $=gv[p];if(gv[p++]=null,D!==null&&G!==null){var et=D.pending;et===null?G.next=G:(G.next=et.next,et.next=G),D.pending=G}$!==0&&VS(C,G,$)}}function D2(c,p,C,D){gv[Sx++]=c,gv[Sx++]=p,gv[Sx++]=C,gv[Sx++]=D,T2|=D,c.lanes|=D,c=c.alternate,c!==null&&(c.lanes|=D)}function S_(c,p,C,D){return D2(c,p,C,D),nS(c)}function rx(c,p){return D2(c,null,null,p),nS(c)}function VS(c,p,C){c.lanes|=C;var D=c.alternate;D!==null&&(D.lanes|=C);for(var G=!1,$=c.return;$!==null;)$.childLanes|=C,D=$.alternate,D!==null&&(D.childLanes|=C),$.tag===22&&(c=$.stateNode,c===null||c._visibility&1||(G=!0)),c=$,$=$.return;return c.tag===3?($=c.stateNode,G&&p!==null&&(G=31-v0(C),c=$.hiddenUpdates,D=c[G],D===null?c[G]=[p]:D.push(p),p.lane=C|536870912),$):null}function nS(c){if(50<dA)throw dA=0,ew=null,Error(n(185));for(var p=c.return;p!==null;)c=p,p=c.return;return c.tag===3?c.stateNode:null}var Wx={};function Dw(c,p,C,D){this.tag=c,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _v(c,p,C,D){return new Dw(c,p,C,D)}function iS(c){return c=c.prototype,!(!c||!c.isReactComponent)}function Xv(c,p){var C=c.alternate;return C===null?(C=_v(c.tag,p,c.key,c.mode),C.elementType=c.elementType,C.type=c.type,C.stateNode=c.stateNode,C.alternate=c,c.alternate=C):(C.pendingProps=p,C.type=c.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=c.flags&65011712,C.childLanes=c.childLanes,C.lanes=c.lanes,C.child=c.child,C.memoizedProps=c.memoizedProps,C.memoizedState=c.memoizedState,C.updateQueue=c.updateQueue,p=c.dependencies,C.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},C.sibling=c.sibling,C.index=c.index,C.ref=c.ref,C.refCleanup=c.refCleanup,C}function sx(c,p){c.flags&=65011714;var C=c.alternate;return C===null?(c.childLanes=0,c.lanes=p,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=C.childLanes,c.lanes=C.lanes,c.child=C.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=C.memoizedProps,c.memoizedState=C.memoizedState,c.updateQueue=C.updateQueue,c.type=C.type,p=C.dependencies,c.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),c}function L2(c,p,C,D,G,$){var et=0;if(D=c,typeof c=="function")iS(c)&&(et=1);else if(typeof c=="string")et=fR(c,C,K.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case T:return c=_v(31,C,p,G),c.elementType=T,c.lanes=$,c;case _:return ax(C.children,G,$,p);case h:et=8,G|=24;break;case f:return c=_v(12,C,p,G|2),c.elementType=f,c.lanes=$,c;case w:return c=_v(13,C,p,G),c.elementType=w,c.lanes=$,c;case v:return c=_v(19,C,p,G),c.elementType=v,c.lanes=$,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case m:et=10;break e;case E:et=9;break e;case S:et=11;break e;case A:et=14;break e;case M:et=16,D=null;break e}et=29,C=Error(n(130,c===null?"null":typeof c,"")),D=null}return p=_v(et,C,p,G),p.elementType=c,p.type=D,p.lanes=$,p}function ax(c,p,C,D){return c=_v(7,c,D,p),c.lanes=C,c}function rS(c,p,C){return c=_v(6,c,null,p),c.lanes=C,c}function HS(c){var p=_v(18,null,null,0);return p.stateNode=c,p}function jS(c,p,C){return p=_v(4,c.children!==null?c.children:[],c.key,p),p.lanes=C,p.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},p}var WS=new WeakMap;function dv(c,p){if(typeof c=="object"&&c!==null){var C=WS.get(c);return C!==void 0?C:(p={value:c,source:p,stack:F0(p)},WS.set(c,p),p)}return{value:c,source:p,stack:F0(p)}}var ox=[],$x=0,P2=null,O2=0,Ev=[],Mv=0,lx=null,Fv=1,Uv="";function Yv(c,p){ox[$x++]=O2,ox[$x++]=P2,P2=c,O2=p}function HA(c,p,C){Ev[Mv++]=Fv,Ev[Mv++]=Uv,Ev[Mv++]=lx,lx=c;var D=Fv;c=Uv;var G=32-v0(D)-1;D&=~(1<<G),C+=1;var $=32-v0(p)+G;if(30<$){var et=G-G%5;$=(D&(1<<et)-1).toString(32),D>>=et,G-=et,Fv=1<<32-v0(p)+G|C<<G|D,Uv=$+c}else Fv=1<<$|C<<G|D,Uv=c}function $S(c){c.return!==null&&(Yv(c,1),HA(c,1,0))}function XS(c){for(;c===P2;)P2=ox[--$x],ox[$x]=null,O2=ox[--$x],ox[$x]=null;for(;c===lx;)lx=Ev[--Mv],Ev[Mv]=null,Uv=Ev[--Mv],Ev[Mv]=null,Fv=Ev[--Mv],Ev[Mv]=null}function jA(c,p){Ev[Mv++]=Fv,Ev[Mv++]=Uv,Ev[Mv++]=lx,Fv=p.id,Uv=p.overflow,lx=c}var J_=null,D_=null,F1=!1,nv=null,wv=!1,YS=Error(n(519));function Kv(c){var p=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw B2(dv(p,c)),YS}function WA(c){var p=c.stateNode,C=c.type,D=c.memoizedProps;switch(p[n1]=c,p[c1]=D,C){case"dialog":k1("cancel",p),k1("close",p);break;case"iframe":case"object":case"embed":k1("load",p);break;case"video":case"audio":for(C=0;C<pA.length;C++)k1(pA[C],p);break;case"source":k1("error",p);break;case"img":case"image":case"link":k1("error",p),k1("load",p);break;case"details":k1("toggle",p);break;case"input":k1("invalid",p),Z_(p,D.value,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name,!0);break;case"select":k1("invalid",p);break;case"textarea":k1("invalid",p),Wv(p,D.value,D.defaultValue,D.children)}C=D.children,typeof C!="string"&&typeof C!="number"&&typeof C!="bigint"||p.textContent===""+C||D.suppressHydrationWarning===!0||BT(p.textContent,C)?(D.popover!=null&&(k1("beforetoggle",p),k1("toggle",p)),D.onScroll!=null&&k1("scroll",p),D.onScrollEnd!=null&&k1("scrollend",p),D.onClick!=null&&(p.onclick=Q_),p=!0):p=!1,p||Kv(c,!0)}function $A(c){for(J_=c.return;J_;)switch(J_.tag){case 5:case 31:case 13:wv=!1;return;case 27:case 3:wv=!0;return;default:J_=J_.return}}function kv(c){if(c!==J_)return!1;if(!F1)return $A(c),F1=!0,!1;var p=c.tag,C;if((C=p!==3&&p!==27)&&((C=p===5)&&(C=c.type,C=!(C!=="form"&&C!=="button")||mw(c.type,c.memoizedProps)),C=!C),C&&D_&&Kv(c),$A(c),p===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(317));D_=jT(c)}else if(p===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(317));D_=jT(c)}else p===27?(p=D_,a2(c.type)?(c=yw,yw=null,D_=c):D_=p):D_=J_?Hv(c.stateNode.nextSibling):null;return!0}function qv(){D_=J_=null,F1=!1}function I2(){var c=nv;return c!==null&&(Dv===null?Dv=c:Dv.push.apply(Dv,c),nv=null),c}function B2(c){nv===null?nv=[c]:nv.push(c)}var sS=B(null),Ax=null,vv=null;function Gv(c,p,C){Y(sS,p._currentValue),p._currentValue=C}function Zv(c){c._currentValue=sS.current,V(sS)}function KS(c,p,C){for(;c!==null;){var D=c.alternate;if((c.childLanes&p)!==p?(c.childLanes|=p,D!==null&&(D.childLanes|=p)):D!==null&&(D.childLanes&p)!==p&&(D.childLanes|=p),c===C)break;c=c.return}}function qS(c,p,C,D){var G=c.child;for(G!==null&&(G.return=c);G!==null;){var $=G.dependencies;if($!==null){var et=G.child;$=$.firstContext;e:for(;$!==null;){var n0=$;$=G;for(var R0=0;R0<p.length;R0++)if(n0.context===p[R0]){$.lanes|=C,n0=$.alternate,n0!==null&&(n0.lanes|=C),KS($.return,C,c),D||(et=null);break e}$=n0.next}}else if(G.tag===18){if(et=G.return,et===null)throw Error(n(341));et.lanes|=C,$=et.alternate,$!==null&&($.lanes|=C),KS(et,C,c),et=null}else et=G.child;if(et!==null)et.return=G;else for(et=G;et!==null;){if(et===c){et=null;break}if(G=et.sibling,G!==null){G.return=et.return,et=G;break}et=et.return}G=et}}function Xx(c,p,C,D){c=null;for(var G=p,$=!1;G!==null;){if(!$){if((G.flags&524288)!==0)$=!0;else if((G.flags&262144)!==0)break}if(G.tag===10){var et=G.alternate;if(et===null)throw Error(n(387));if(et=et.memoizedProps,et!==null){var n0=G.type;I_(G.pendingProps.value,et.value)||(c!==null?c.push(n0):c=[n0])}}else if(G===He.current){if(et=G.alternate,et===null)throw Error(n(387));et.memoizedState.memoizedState!==G.memoizedState.memoizedState&&(c!==null?c.push(xA):c=[xA])}G=G.return}c!==null&&qS(p,c,C,D),p.flags|=262144}function aS(c){for(c=c.firstContext;c!==null;){if(!I_(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function Ex(c){Ax=c,vv=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function ev(c){return XA(Ax,c)}function oS(c,p){return Ax===null&&Ex(c),XA(c,p)}function XA(c,p){var C=p._currentValue;if(p={context:p,memoizedValue:C,next:null},vv===null){if(c===null)throw Error(n(308));vv=p,c.dependencies={lanes:0,firstContext:p},c.flags|=524288}else vv=vv.next=p;return C}var oM=typeof AbortController<"u"?AbortController:function(){var c=[],p=this.signal={aborted:!1,addEventListener:function(C,D){c.push(D)}};this.abort=function(){p.aborted=!0,c.forEach(function(C){return C()})}},lM=r.unstable_scheduleCallback,cM=r.unstable_NormalPriority,F_={$$typeof:m,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ZS(){return{controller:new oM,data:new Map,refCount:0}}function Yx(c){c.refCount--,c.refCount===0&&lM(cM,function(){c.controller.abort()})}var Kx=null,lS=0,Mx=0,wx=null;function YA(c,p){if(Kx===null){var C=Kx=[];lS=0,Mx=aw(),wx={status:"pending",value:void 0,then:function(D){C.push(D)}}}return lS++,p.then(QS,QS),p}function QS(){if(--lS===0&&Kx!==null){wx!==null&&(wx.status="fulfilled");var c=Kx;Kx=null,Mx=0,wx=null;for(var p=0;p<c.length;p++)(0,c[p])()}}function KA(c,p){var C=[],D={status:"pending",value:null,reason:null,then:function(G){C.push(G)}};return c.then(function(){D.status="fulfilled",D.value=p;for(var G=0;G<C.length;G++)(0,C[G])(p)},function(G){for(D.status="rejected",D.reason=G,G=0;G<C.length;G++)(0,C[G])(void 0)}),D}var JS=U.S;U.S=function(c,p){sT=We(),typeof p=="object"&&p!==null&&typeof p.then=="function"&&YA(c,p),JS!==null&&JS(c,p)};var Cx=B(null);function z(){var c=Cx.current;return c!==null?c:L_.pooledCache}function si(c,p){p===null?Y(Cx,Cx.current):Y(Cx,p.pool)}function X(){var c=z();return c===null?null:{parent:F_._currentValue,pool:c}}var r0=Error(n(460)),x0=Error(n(474)),m0=Error(n(542)),X0={then:function(){}};function U0(c){return c=c.status,c==="fulfilled"||c==="rejected"}function m1(c,p,C){switch(C=c[C],C===void 0?c.push(p):C!==p&&(p.then(Q_,Q_),p=C),p.status){case"fulfilled":return p.value;case"rejected":throw c=p.reason,d1(c),c;default:if(typeof p.status=="string")p.then(Q_,Q_);else{if(c=L_,c!==null&&100<c.shellSuspendCounter)throw Error(n(482));c=p,c.status="pending",c.then(function(D){if(p.status==="pending"){var G=p;G.status="fulfilled",G.value=D}},function(D){if(p.status==="pending"){var G=p;G.status="rejected",G.reason=D}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw c=p.reason,d1(c),c}throw j0=p,r0}}function I0(c){try{var p=c._init;return p(c._payload)}catch(C){throw C!==null&&typeof C=="object"&&typeof C.then=="function"?(j0=C,r0):C}}var j0=null;function W1(){if(j0===null)throw Error(n(459));var c=j0;return j0=null,c}function d1(c){if(c===r0||c===m0)throw Error(n(483))}var s1=null,S1=0;function A_(c){var p=S1;return S1+=1,s1===null&&(s1=[]),m1(s1,c,p)}function I1(c,p){p=p.props.ref,c.ref=p!==void 0?p:null}function R1(c,p){throw p.$$typeof===x?Error(n(525)):(c=Object.prototype.toString.call(p),Error(n(31,c==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":c)))}function $1(c){function p(G0,N0){if(c){var H0=G0.deletions;H0===null?(G0.deletions=[N0],G0.flags|=16):H0.push(N0)}}function C(G0,N0){if(!c)return null;for(;N0!==null;)p(G0,N0),N0=N0.sibling;return null}function D(G0){for(var N0=new Map;G0!==null;)G0.key!==null?N0.set(G0.key,G0):N0.set(G0.index,G0),G0=G0.sibling;return N0}function G(G0,N0){return G0=Xv(G0,N0),G0.index=0,G0.sibling=null,G0}function $(G0,N0,H0){return G0.index=H0,c?(H0=G0.alternate,H0!==null?(H0=H0.index,H0<N0?(G0.flags|=67108866,N0):H0):(G0.flags|=67108866,N0)):(G0.flags|=1048576,N0)}function et(G0){return c&&G0.alternate===null&&(G0.flags|=67108866),G0}function n0(G0,N0,H0,e1){return N0===null||N0.tag!==6?(N0=rS(H0,G0.mode,e1),N0.return=G0,N0):(N0=G(N0,H0),N0.return=G0,N0)}function R0(G0,N0,H0,e1){var A1=H0.type;return A1===_?Q0(G0,N0,H0.props.children,e1,H0.key):N0!==null&&(N0.elementType===A1||typeof A1=="object"&&A1!==null&&A1.$$typeof===M&&I0(A1)===N0.type)?(N0=G(N0,H0.props),I1(N0,H0),N0.return=G0,N0):(N0=L2(H0.type,H0.key,H0.props,null,G0.mode,e1),I1(N0,H0),N0.return=G0,N0)}function W0(G0,N0,H0,e1){return N0===null||N0.tag!==4||N0.stateNode.containerInfo!==H0.containerInfo||N0.stateNode.implementation!==H0.implementation?(N0=jS(H0,G0.mode,e1),N0.return=G0,N0):(N0=G(N0,H0.children||[]),N0.return=G0,N0)}function Q0(G0,N0,H0,e1,A1){return N0===null||N0.tag!==7?(N0=ax(H0,G0.mode,e1,A1),N0.return=G0,N0):(N0=G(N0,H0),N0.return=G0,N0)}function t1(G0,N0,H0){if(typeof N0=="string"&&N0!==""||typeof N0=="number"||typeof N0=="bigint")return N0=rS(""+N0,G0.mode,H0),N0.return=G0,N0;if(typeof N0=="object"&&N0!==null){switch(N0.$$typeof){case y:return H0=L2(N0.type,N0.key,N0.props,null,G0.mode,H0),I1(H0,N0),H0.return=G0,H0;case b:return N0=jS(N0,G0.mode,H0),N0.return=G0,N0;case M:return N0=I0(N0),t1(G0,N0,H0)}if(N(N0)||L(N0))return N0=ax(N0,G0.mode,H0,null),N0.return=G0,N0;if(typeof N0.then=="function")return t1(G0,A_(N0),H0);if(N0.$$typeof===m)return t1(G0,oS(G0,N0),H0);R1(G0,N0)}return null}function Y0(G0,N0,H0,e1){var A1=N0!==null?N0.key:null;if(typeof H0=="string"&&H0!==""||typeof H0=="number"||typeof H0=="bigint")return A1!==null?null:n0(G0,N0,""+H0,e1);if(typeof H0=="object"&&H0!==null){switch(H0.$$typeof){case y:return H0.key===A1?R0(G0,N0,H0,e1):null;case b:return H0.key===A1?W0(G0,N0,H0,e1):null;case M:return H0=I0(H0),Y0(G0,N0,H0,e1)}if(N(H0)||L(H0))return A1!==null?null:Q0(G0,N0,H0,e1,null);if(typeof H0.then=="function")return Y0(G0,N0,A_(H0),e1);if(H0.$$typeof===m)return Y0(G0,N0,oS(G0,H0),e1);R1(G0,H0)}return null}function q0(G0,N0,H0,e1,A1){if(typeof e1=="string"&&e1!==""||typeof e1=="number"||typeof e1=="bigint")return G0=G0.get(H0)||null,n0(N0,G0,""+e1,A1);if(typeof e1=="object"&&e1!==null){switch(e1.$$typeof){case y:return G0=G0.get(e1.key===null?H0:e1.key)||null,R0(N0,G0,e1,A1);case b:return G0=G0.get(e1.key===null?H0:e1.key)||null,W0(N0,G0,e1,A1);case M:return e1=I0(e1),q0(G0,N0,H0,e1,A1)}if(N(e1)||L(e1))return G0=G0.get(H0)||null,Q0(N0,G0,e1,A1,null);if(typeof e1.then=="function")return q0(G0,N0,H0,A_(e1),A1);if(e1.$$typeof===m)return q0(G0,N0,H0,oS(N0,e1),A1);R1(N0,e1)}return null}function _1(G0,N0,H0,e1){for(var A1=null,X1=null,x1=N0,O1=N0=0,j1=null;x1!==null&&O1<H0.length;O1++){x1.index>O1?(j1=x1,x1=null):j1=x1.sibling;var Y1=Y0(G0,x1,H0[O1],e1);if(Y1===null){x1===null&&(x1=j1);break}c&&x1&&Y1.alternate===null&&p(G0,x1),N0=$(Y1,N0,O1),X1===null?A1=Y1:X1.sibling=Y1,X1=Y1,x1=j1}if(O1===H0.length)return C(G0,x1),F1&&Yv(G0,O1),A1;if(x1===null){for(;O1<H0.length;O1++)x1=t1(G0,H0[O1],e1),x1!==null&&(N0=$(x1,N0,O1),X1===null?A1=x1:X1.sibling=x1,X1=x1);return F1&&Yv(G0,O1),A1}for(x1=D(x1);O1<H0.length;O1++)j1=q0(x1,G0,O1,H0[O1],e1),j1!==null&&(c&&j1.alternate!==null&&x1.delete(j1.key===null?O1:j1.key),N0=$(j1,N0,O1),X1===null?A1=j1:X1.sibling=j1,X1=j1);return c&&x1.forEach(function(h2){return p(G0,h2)}),F1&&Yv(G0,O1),A1}function w1(G0,N0,H0,e1){if(H0==null)throw Error(n(151));for(var A1=null,X1=null,x1=N0,O1=N0=0,j1=null,Y1=H0.next();x1!==null&&!Y1.done;O1++,Y1=H0.next()){x1.index>O1?(j1=x1,x1=null):j1=x1.sibling;var h2=Y0(G0,x1,Y1.value,e1);if(h2===null){x1===null&&(x1=j1);break}c&&x1&&h2.alternate===null&&p(G0,x1),N0=$(h2,N0,O1),X1===null?A1=h2:X1.sibling=h2,X1=h2,x1=j1}if(Y1.done)return C(G0,x1),F1&&Yv(G0,O1),A1;if(x1===null){for(;!Y1.done;O1++,Y1=H0.next())Y1=t1(G0,Y1.value,e1),Y1!==null&&(N0=$(Y1,N0,O1),X1===null?A1=Y1:X1.sibling=Y1,X1=Y1);return F1&&Yv(G0,O1),A1}for(x1=D(x1);!Y1.done;O1++,Y1=H0.next())Y1=q0(x1,G0,O1,Y1.value,e1),Y1!==null&&(c&&Y1.alternate!==null&&x1.delete(Y1.key===null?O1:Y1.key),N0=$(Y1,N0,O1),X1===null?A1=Y1:X1.sibling=Y1,X1=Y1);return c&&x1.forEach(function(ER){return p(G0,ER)}),F1&&Yv(G0,O1),A1}function T_(G0,N0,H0,e1){if(typeof H0=="object"&&H0!==null&&H0.type===_&&H0.key===null&&(H0=H0.props.children),typeof H0=="object"&&H0!==null){switch(H0.$$typeof){case y:e:{for(var A1=H0.key;N0!==null;){if(N0.key===A1){if(A1=H0.type,A1===_){if(N0.tag===7){C(G0,N0.sibling),e1=G(N0,H0.props.children),e1.return=G0,G0=e1;break e}}else if(N0.elementType===A1||typeof A1=="object"&&A1!==null&&A1.$$typeof===M&&I0(A1)===N0.type){C(G0,N0.sibling),e1=G(N0,H0.props),I1(e1,H0),e1.return=G0,G0=e1;break e}C(G0,N0);break}else p(G0,N0);N0=N0.sibling}H0.type===_?(e1=ax(H0.props.children,G0.mode,e1,H0.key),e1.return=G0,G0=e1):(e1=L2(H0.type,H0.key,H0.props,null,G0.mode,e1),I1(e1,H0),e1.return=G0,G0=e1)}return et(G0);case b:e:{for(A1=H0.key;N0!==null;){if(N0.key===A1)if(N0.tag===4&&N0.stateNode.containerInfo===H0.containerInfo&&N0.stateNode.implementation===H0.implementation){C(G0,N0.sibling),e1=G(N0,H0.children||[]),e1.return=G0,G0=e1;break e}else{C(G0,N0);break}else p(G0,N0);N0=N0.sibling}e1=jS(H0,G0.mode,e1),e1.return=G0,G0=e1}return et(G0);case M:return H0=I0(H0),T_(G0,N0,H0,e1)}if(N(H0))return _1(G0,N0,H0,e1);if(L(H0)){if(A1=L(H0),typeof A1!="function")throw Error(n(150));return H0=A1.call(H0),w1(G0,N0,H0,e1)}if(typeof H0.then=="function")return T_(G0,N0,A_(H0),e1);if(H0.$$typeof===m)return T_(G0,N0,oS(G0,H0),e1);R1(G0,H0)}return typeof H0=="string"&&H0!==""||typeof H0=="number"||typeof H0=="bigint"?(H0=""+H0,N0!==null&&N0.tag===6?(C(G0,N0.sibling),e1=G(N0,H0),e1.return=G0,G0=e1):(C(G0,N0),e1=rS(H0,G0.mode,e1),e1.return=G0,G0=e1),et(G0)):C(G0,N0)}return function(G0,N0,H0,e1){try{S1=0;var A1=T_(G0,N0,H0,e1);return s1=null,A1}catch(x1){if(x1===r0||x1===m0)throw x1;var X1=_v(29,x1,null,G0.mode);return X1.lanes=e1,X1.return=G0,X1}finally{}}}var D1=$1(!0),h1=$1(!1),B1=!1;function U_(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function E1(c,p){c=c.updateQueue,p.updateQueue===c&&(p.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function V1(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function L1(c,p,C){var D=c.updateQueue;if(D===null)return null;if(D=D.shared,(K1&2)!==0){var G=D.pending;return G===null?p.next=p:(p.next=G.next,G.next=p),D.pending=p,p=nS(c),VS(c,null,C),p}return D2(c,D,p,C),nS(c)}function T1(c,p,C){if(p=p.updateQueue,p!==null&&(p=p.shared,(C&4194048)!==0)){var D=p.lanes;D&=c.pendingLanes,C|=D,p.lanes=C,t0(c,C)}}function N1(c,p){var C=c.updateQueue,D=c.alternate;if(D!==null&&(D=D.updateQueue,C===D)){var G=null,$=null;if(C=C.firstBaseUpdate,C!==null){do{var et={lane:C.lane,tag:C.tag,payload:C.payload,callback:null,next:null};$===null?G=$=et:$=$.next=et,C=C.next}while(C!==null);$===null?G=$=p:$=$.next=p}else G=$=p;C={baseState:D.baseState,firstBaseUpdate:G,lastBaseUpdate:$,shared:D.shared,callbacks:D.callbacks},c.updateQueue=C;return}c=C.lastBaseUpdate,c===null?C.firstBaseUpdate=p:c.next=p,C.lastBaseUpdate=p}var Qv=!1;function qx(){if(Qv){var c=wx;if(c!==null)throw c}}function cx(c,p,C,D){Qv=!1;var G=c.updateQueue;B1=!1;var $=G.firstBaseUpdate,et=G.lastBaseUpdate,n0=G.shared.pending;if(n0!==null){G.shared.pending=null;var R0=n0,W0=R0.next;R0.next=null,et===null?$=W0:et.next=W0,et=R0;var Q0=c.alternate;Q0!==null&&(Q0=Q0.updateQueue,n0=Q0.lastBaseUpdate,n0!==et&&(n0===null?Q0.firstBaseUpdate=W0:n0.next=W0,Q0.lastBaseUpdate=R0))}if($!==null){var t1=G.baseState;et=0,Q0=W0=R0=null,n0=$;do{var Y0=n0.lane&-536870913,q0=Y0!==n0.lane;if(q0?(H1&Y0)===Y0:(D&Y0)===Y0){Y0!==0&&Y0===Mx&&(Qv=!0),Q0!==null&&(Q0=Q0.next={lane:0,tag:n0.tag,payload:n0.payload,callback:null,next:null});e:{var _1=c,w1=n0;Y0=p;var T_=C;switch(w1.tag){case 1:if(_1=w1.payload,typeof _1=="function"){t1=_1.call(T_,t1,Y0);break e}t1=_1;break e;case 3:_1.flags=_1.flags&-65537|128;case 0:if(_1=w1.payload,Y0=typeof _1=="function"?_1.call(T_,t1,Y0):_1,Y0==null)break e;t1=g({},t1,Y0);break e;case 2:B1=!0}}Y0=n0.callback,Y0!==null&&(c.flags|=64,q0&&(c.flags|=8192),q0=G.callbacks,q0===null?G.callbacks=[Y0]:q0.push(Y0))}else q0={lane:Y0,tag:n0.tag,payload:n0.payload,callback:n0.callback,next:null},Q0===null?(W0=Q0=q0,R0=t1):Q0=Q0.next=q0,et|=Y0;if(n0=n0.next,n0===null){if(n0=G.shared.pending,n0===null)break;q0=n0,n0=q0.next,q0.next=null,G.lastBaseUpdate=q0,G.shared.pending=null}}while(!0);Q0===null&&(R0=t1),G.baseState=R0,G.firstBaseUpdate=W0,G.lastBaseUpdate=Q0,$===null&&(G.shared.lanes=0),t2|=et,c.lanes=et,c.memoizedState=t1}}function N2(c,p){if(typeof c!="function")throw Error(n(191,c));c.call(p)}function Lw(c,p){var C=c.callbacks;if(C!==null)for(c.callbacks=null,c=0;c<C.length;c++)N2(C[c],p)}var cS=B(null),qA=B(0);function Pw(c,p){c=Nx,Y(qA,c),Y(cS,p),Nx=c|p.baseLanes}function uM(){Y(qA,Nx),Y(cS,cS.current)}function hM(){Nx=qA.current,V(cS),V(qA)}var Pv=B(null),Vv=null;function Zx(c){var p=c.alternate;Y(j_,j_.current&1),Y(Pv,c),Vv===null&&(p===null||cS.current!==null||p.memoizedState!==null)&&(Vv=c)}function dM(c){Y(j_,j_.current),Y(Pv,c),Vv===null&&(Vv=c)}function Ow(c){c.tag===22?(Y(j_,j_.current),Y(Pv,c),Vv===null&&(Vv=c)):Qx()}function Qx(){Y(j_,j_.current),Y(Pv,Pv.current)}function Ov(c){V(Pv),Vv===c&&(Vv=null),V(j_)}var j_=B(0);function ZA(c){for(var p=c;p!==null;){if(p.tag===13){var C=p.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||vw(C)||xw(C)))return p}else if(p.tag===19&&(p.memoizedProps.revealOrder==="forwards"||p.memoizedProps.revealOrder==="backwards"||p.memoizedProps.revealOrder==="unstable_legacy-backwards"||p.memoizedProps.revealOrder==="together")){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var Tx=0,P1=null,E_=null,Y_=null,QA=!1,uS=!1,z2=!1,JA=0,eA=0,hS=null,p3=0;function k_(){throw Error(n(321))}function fM(c,p){if(p===null)return!1;for(var C=0;C<p.length&&C<c.length;C++)if(!I_(c[C],p[C]))return!1;return!0}function pM(c,p,C,D,G,$){return Tx=$,P1=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,U.H=c===null||c.memoizedState===null?gC:RM,z2=!1,$=C(D,G),z2=!1,uS&&($=Bw(p,C,D,G)),Iw(c),$}function Iw(c){U.H=iA;var p=E_!==null&&E_.next!==null;if(Tx=0,Y_=E_=P1=null,QA=!1,eA=0,hS=null,p)throw Error(n(300));c===null||K_||(c=c.dependencies,c!==null&&aS(c)&&(K_=!0))}function Bw(c,p,C,D){P1=c;var G=0;do{if(uS&&(hS=null),eA=0,uS=!1,25<=G)throw Error(n(301));if(G+=1,Y_=E_=null,c.updateQueue!=null){var $=c.updateQueue;$.lastEffect=null,$.events=null,$.stores=null,$.memoCache!=null&&($.memoCache.index=0)}U.H=_C,$=p(C,D)}while(uS);return $}function m3(){var c=U.H,p=c.useState()[0];return p=typeof p.then=="function"?tA(p):p,c=c.useState()[0],(E_!==null?E_.memoizedState:null)!==c&&(P1.flags|=1024),p}function mM(){var c=JA!==0;return JA=0,c}function gM(c,p,C){p.updateQueue=c.updateQueue,p.flags&=-2053,c.lanes&=~C}function _M(c){if(QA){for(c=c.memoizedState;c!==null;){var p=c.queue;p!==null&&(p.pending=null),c=c.next}QA=!1}Tx=0,Y_=E_=P1=null,uS=!1,eA=JA=0,hS=null}function xv(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Y_===null?P1.memoizedState=Y_=c:Y_=Y_.next=c,Y_}function W_(){if(E_===null){var c=P1.alternate;c=c!==null?c.memoizedState:null}else c=E_.next;var p=Y_===null?P1.memoizedState:Y_.next;if(p!==null)Y_=p,E_=c;else{if(c===null)throw P1.alternate===null?Error(n(467)):Error(n(310));E_=c,c={memoizedState:E_.memoizedState,baseState:E_.baseState,baseQueue:E_.baseQueue,queue:E_.queue,next:null},Y_===null?P1.memoizedState=Y_=c:Y_=Y_.next=c}return Y_}function eE(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function tA(c){var p=eA;return eA+=1,hS===null&&(hS=[]),c=m1(hS,c,p),p=P1,(Y_===null?p.memoizedState:Y_.next)===null&&(p=p.alternate,U.H=p===null||p.memoizedState===null?gC:RM),c}function tE(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return tA(c);if(c.$$typeof===m)return ev(c)}throw Error(n(438,String(c)))}function vM(c){var p=null,C=P1.updateQueue;if(C!==null&&(p=C.memoCache),p==null){var D=P1.alternate;D!==null&&(D=D.updateQueue,D!==null&&(D=D.memoCache,D!=null&&(p={data:D.data.map(function(G){return G.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),C===null&&(C=eE(),P1.updateQueue=C),C.memoCache=p,C=p.data[p.index],C===void 0)for(C=p.data[p.index]=Array(c),D=0;D<c;D++)C[D]=R;return p.index++,C}function Rx(c,p){return typeof p=="function"?p(c):p}function nE(c){var p=W_();return xM(p,E_,c)}function xM(c,p,C){var D=c.queue;if(D===null)throw Error(n(311));D.lastRenderedReducer=C;var G=c.baseQueue,$=D.pending;if($!==null){if(G!==null){var et=G.next;G.next=$.next,$.next=et}p.baseQueue=G=$,D.pending=null}if($=c.baseState,G===null)c.memoizedState=$;else{p=G.next;var n0=et=null,R0=null,W0=p,Q0=!1;do{var t1=W0.lane&-536870913;if(t1!==W0.lane?(H1&t1)===t1:(Tx&t1)===t1){var Y0=W0.revertLane;if(Y0===0)R0!==null&&(R0=R0.next={lane:0,revertLane:0,gesture:null,action:W0.action,hasEagerState:W0.hasEagerState,eagerState:W0.eagerState,next:null}),t1===Mx&&(Q0=!0);else if((Tx&Y0)===Y0){W0=W0.next,Y0===Mx&&(Q0=!0);continue}else t1={lane:0,revertLane:W0.revertLane,gesture:null,action:W0.action,hasEagerState:W0.hasEagerState,eagerState:W0.eagerState,next:null},R0===null?(n0=R0=t1,et=$):R0=R0.next=t1,P1.lanes|=Y0,t2|=Y0;t1=W0.action,z2&&C($,t1),$=W0.hasEagerState?W0.eagerState:C($,t1)}else Y0={lane:t1,revertLane:W0.revertLane,gesture:W0.gesture,action:W0.action,hasEagerState:W0.hasEagerState,eagerState:W0.eagerState,next:null},R0===null?(n0=R0=Y0,et=$):R0=R0.next=Y0,P1.lanes|=t1,t2|=t1;W0=W0.next}while(W0!==null&&W0!==p);if(R0===null?et=$:R0.next=n0,!I_($,c.memoizedState)&&(K_=!0,Q0&&(C=wx,C!==null)))throw C;c.memoizedState=$,c.baseState=et,c.baseQueue=R0,D.lastRenderedState=$}return G===null&&(D.lanes=0),[c.memoizedState,D.dispatch]}function yM(c){var p=W_(),C=p.queue;if(C===null)throw Error(n(311));C.lastRenderedReducer=c;var D=C.dispatch,G=C.pending,$=p.memoizedState;if(G!==null){C.pending=null;var et=G=G.next;do $=c($,et.action),et=et.next;while(et!==G);I_($,p.memoizedState)||(K_=!0),p.memoizedState=$,p.baseQueue===null&&(p.baseState=$),C.lastRenderedState=$}return[$,D]}function Nw(c,p,C){var D=P1,G=W_(),$=F1;if($){if(C===void 0)throw Error(n(407));C=C()}else C=p();var et=!I_((E_||G).memoizedState,C);if(et&&(G.memoizedState=C,K_=!0),G=G.queue,AM(Uw.bind(null,D,G,c),[c]),G.getSnapshot!==p||et||Y_!==null&&Y_.memoizedState.tag&1){if(D.flags|=2048,dS(9,{destroy:void 0},Fw.bind(null,D,G,C,p),null),L_===null)throw Error(n(349));$||(Tx&127)!==0||zw(D,p,C)}return C}function zw(c,p,C){c.flags|=16384,c={getSnapshot:p,value:C},p=P1.updateQueue,p===null?(p=eE(),P1.updateQueue=p,p.stores=[c]):(C=p.stores,C===null?p.stores=[c]:C.push(c))}function Fw(c,p,C,D){p.value=C,p.getSnapshot=D,kw(p)&&Gw(c)}function Uw(c,p,C){return C(function(){kw(p)&&Gw(c)})}function kw(c){var p=c.getSnapshot;c=c.value;try{var C=p();return!I_(c,C)}catch{return!0}}function Gw(c){var p=rx(c,2);p!==null&&Lv(p,c,2)}function bM(c){var p=xv();if(typeof c=="function"){var C=c;if(c=C(),z2){f0(!0);try{C()}finally{f0(!1)}}}return p.memoizedState=p.baseState=c,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rx,lastRenderedState:c},p}function Vw(c,p,C,D){return c.baseState=C,xM(c,E_,typeof D=="function"?D:Rx)}function g3(c,p,C,D,G){if(sE(c))throw Error(n(485));if(c=p.action,c!==null){var $={payload:G,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(et){$.listeners.push(et)}};U.T!==null?C(!0):$.isTransition=!1,D($),C=p.pending,C===null?($.next=p.pending=$,Hw(p,$)):($.next=C.next,p.pending=C.next=$)}}function Hw(c,p){var C=p.action,D=p.payload,G=c.state;if(p.isTransition){var $=U.T,et={};U.T=et;try{var n0=C(G,D),R0=U.S;R0!==null&&R0(et,n0),jw(c,p,n0)}catch(W0){SM(c,p,W0)}finally{$!==null&&et.types!==null&&($.types=et.types),U.T=$}}else try{$=C(G,D),jw(c,p,$)}catch(W0){SM(c,p,W0)}}function jw(c,p,C){C!==null&&typeof C=="object"&&typeof C.then=="function"?C.then(function(D){Ww(c,p,D)},function(D){return SM(c,p,D)}):Ww(c,p,C)}function Ww(c,p,C){p.status="fulfilled",p.value=C,$w(p),c.state=C,p=c.pending,p!==null&&(C=p.next,C===p?c.pending=null:(C=C.next,p.next=C,Hw(c,C)))}function SM(c,p,C){var D=c.pending;if(c.pending=null,D!==null){D=D.next;do p.status="rejected",p.reason=C,$w(p),p=p.next;while(p!==D)}c.action=null}function $w(c){c=c.listeners;for(var p=0;p<c.length;p++)(0,c[p])()}function Xw(c,p){return p}function Yw(c,p){if(F1){var C=L_.formState;if(C!==null){e:{var D=P1;if(F1){if(D_){t:{for(var G=D_,$=wv;G.nodeType!==8;){if(!$){G=null;break t}if(G=Hv(G.nextSibling),G===null){G=null;break t}}$=G.data,G=$==="F!"||$==="F"?G:null}if(G){D_=Hv(G.nextSibling),D=G.data==="F!";break e}}Kv(D)}D=!1}D&&(p=C[0])}}return C=xv(),C.memoizedState=C.baseState=p,D={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Xw,lastRenderedState:p},C.queue=D,C=fC.bind(null,P1,D),D.dispatch=C,D=bM(!1),$=TM.bind(null,P1,!1,D.queue),D=xv(),G={state:p,dispatch:null,action:c,pending:null},D.queue=G,C=g3.bind(null,P1,G,$,C),G.dispatch=C,D.memoizedState=c,[p,C,!1]}function Kw(c){var p=W_();return qw(p,E_,c)}function qw(c,p,C){if(p=xM(c,p,Xw)[0],c=nE(Rx)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var D=tA(p)}catch(et){throw et===r0?m0:et}else D=p;p=W_();var G=p.queue,$=G.dispatch;return C!==p.memoizedState&&(P1.flags|=2048,dS(9,{destroy:void 0},_3.bind(null,G,C),null)),[D,$,c]}function _3(c,p){c.action=p}function Zw(c){var p=W_(),C=E_;if(C!==null)return qw(p,C,c);W_(),p=p.memoizedState,C=W_();var D=C.queue.dispatch;return C.memoizedState=c,[p,D,!1]}function dS(c,p,C,D){return c={tag:c,create:C,deps:D,inst:p,next:null},p=P1.updateQueue,p===null&&(p=eE(),P1.updateQueue=p),C=p.lastEffect,C===null?p.lastEffect=c.next=c:(D=C.next,C.next=c,c.next=D,p.lastEffect=c),c}function Qw(){return W_().memoizedState}function iE(c,p,C,D){var G=xv();P1.flags|=c,G.memoizedState=dS(1|p,{destroy:void 0},C,D===void 0?null:D)}function rE(c,p,C,D){var G=W_();D=D===void 0?null:D;var $=G.memoizedState.inst;E_!==null&&D!==null&&fM(D,E_.memoizedState.deps)?G.memoizedState=dS(p,$,C,D):(P1.flags|=c,G.memoizedState=dS(1|p,$,C,D))}function Jw(c,p){iE(8390656,8,c,p)}function AM(c,p){rE(2048,8,c,p)}function v3(c){P1.flags|=4;var p=P1.updateQueue;if(p===null)p=eE(),P1.updateQueue=p,p.events=[c];else{var C=p.events;C===null?p.events=[c]:C.push(c)}}function eC(c){var p=W_().memoizedState;return v3({ref:p,nextImpl:c}),function(){if((K1&2)!==0)throw Error(n(440));return p.impl.apply(void 0,arguments)}}function tC(c,p){return rE(4,2,c,p)}function nC(c,p){return rE(4,4,c,p)}function iC(c,p){if(typeof p=="function"){c=c();var C=p(c);return function(){typeof C=="function"?C():p(null)}}if(p!=null)return c=c(),p.current=c,function(){p.current=null}}function rC(c,p,C){C=C!=null?C.concat([c]):null,rE(4,4,iC.bind(null,p,c),C)}function EM(){}function sC(c,p){var C=W_();p=p===void 0?null:p;var D=C.memoizedState;return p!==null&&fM(p,D[1])?D[0]:(C.memoizedState=[c,p],c)}function aC(c,p){var C=W_();p=p===void 0?null:p;var D=C.memoizedState;if(p!==null&&fM(p,D[1]))return D[0];if(D=c(),z2){f0(!0);try{c()}finally{f0(!1)}}return C.memoizedState=[D,p],D}function MM(c,p,C){return C===void 0||(Tx&1073741824)!==0&&(H1&261930)===0?c.memoizedState=p:(c.memoizedState=C,c=oT(),P1.lanes|=c,t2|=c,C)}function oC(c,p,C,D){return I_(C,p)?C:cS.current!==null?(c=MM(c,C,D),I_(c,p)||(K_=!0),c):(Tx&42)===0||(Tx&1073741824)!==0&&(H1&261930)===0?(K_=!0,c.memoizedState=C):(c=oT(),P1.lanes|=c,t2|=c,p)}function lC(c,p,C,D,G){var $=F.p;F.p=$!==0&&8>$?$:8;var et=U.T,n0={};U.T=n0,TM(c,!1,p,C);try{var R0=G(),W0=U.S;if(W0!==null&&W0(n0,R0),R0!==null&&typeof R0=="object"&&typeof R0.then=="function"){var Q0=KA(R0,D);nA(c,p,Q0,Nv(c))}else nA(c,p,D,Nv(c))}catch(t1){nA(c,p,{then:function(){},status:"rejected",reason:t1},Nv())}finally{F.p=$,et!==null&&n0.types!==null&&(et.types=n0.types),U.T=et}}function x3(){}function wM(c,p,C,D){if(c.tag!==5)throw Error(n(476));var G=cC(c).queue;lC(c,G,p,k,C===null?x3:function(){return uC(c),C(D)})}function cC(c){var p=c.memoizedState;if(p!==null)return p;p={memoizedState:k,baseState:k,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rx,lastRenderedState:k},next:null};var C={};return p.next={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Rx,lastRenderedState:C},next:null},c.memoizedState=p,c=c.alternate,c!==null&&(c.memoizedState=p),p}function uC(c){var p=cC(c);p.next===null&&(p=c.alternate.memoizedState),nA(c,p.next.queue,{},Nv())}function CM(){return ev(xA)}function hC(){return W_().memoizedState}function dC(){return W_().memoizedState}function y3(c){for(var p=c.return;p!==null;){switch(p.tag){case 24:case 3:var C=Nv();c=V1(C);var D=L1(p,c,C);D!==null&&(Lv(D,p,C),T1(D,p,C)),p={cache:ZS()},c.payload=p;return}p=p.return}}function b3(c,p,C){var D=Nv();C={lane:D,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null},sE(c)?pC(p,C):(C=S_(c,p,C,D),C!==null&&(Lv(C,c,D),mC(C,p,D)))}function fC(c,p,C){var D=Nv();nA(c,p,C,D)}function nA(c,p,C,D){var G={lane:D,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null};if(sE(c))pC(p,G);else{var $=c.alternate;if(c.lanes===0&&($===null||$.lanes===0)&&($=p.lastRenderedReducer,$!==null))try{var et=p.lastRenderedState,n0=$(et,C);if(G.hasEagerState=!0,G.eagerState=n0,I_(n0,et))return D2(c,p,G,0),L_===null&&R2(),!1}catch{}finally{}if(C=S_(c,p,G,D),C!==null)return Lv(C,c,D),mC(C,p,D),!0}return!1}function TM(c,p,C,D){if(D={lane:2,revertLane:aw(),gesture:null,action:D,hasEagerState:!1,eagerState:null,next:null},sE(c)){if(p)throw Error(n(479))}else p=S_(c,C,D,2),p!==null&&Lv(p,c,2)}function sE(c){var p=c.alternate;return c===P1||p!==null&&p===P1}function pC(c,p){uS=QA=!0;var C=c.pending;C===null?p.next=p:(p.next=C.next,C.next=p),c.pending=p}function mC(c,p,C){if((C&4194048)!==0){var D=p.lanes;D&=c.pendingLanes,C|=D,p.lanes=C,t0(c,C)}}var iA={readContext:ev,use:tE,useCallback:k_,useContext:k_,useEffect:k_,useImperativeHandle:k_,useLayoutEffect:k_,useInsertionEffect:k_,useMemo:k_,useReducer:k_,useRef:k_,useState:k_,useDebugValue:k_,useDeferredValue:k_,useTransition:k_,useSyncExternalStore:k_,useId:k_,useHostTransitionStatus:k_,useFormState:k_,useActionState:k_,useOptimistic:k_,useMemoCache:k_,useCacheRefresh:k_};iA.useEffectEvent=k_;var gC={readContext:ev,use:tE,useCallback:function(c,p){return xv().memoizedState=[c,p===void 0?null:p],c},useContext:ev,useEffect:Jw,useImperativeHandle:function(c,p,C){C=C!=null?C.concat([c]):null,iE(4194308,4,iC.bind(null,p,c),C)},useLayoutEffect:function(c,p){return iE(4194308,4,c,p)},useInsertionEffect:function(c,p){iE(4,2,c,p)},useMemo:function(c,p){var C=xv();p=p===void 0?null:p;var D=c();if(z2){f0(!0);try{c()}finally{f0(!1)}}return C.memoizedState=[D,p],D},useReducer:function(c,p,C){var D=xv();if(C!==void 0){var G=C(p);if(z2){f0(!0);try{C(p)}finally{f0(!1)}}}else G=p;return D.memoizedState=D.baseState=G,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:G},D.queue=c,c=c.dispatch=b3.bind(null,P1,c),[D.memoizedState,c]},useRef:function(c){var p=xv();return c={current:c},p.memoizedState=c},useState:function(c){c=bM(c);var p=c.queue,C=fC.bind(null,P1,p);return p.dispatch=C,[c.memoizedState,C]},useDebugValue:EM,useDeferredValue:function(c,p){var C=xv();return MM(C,c,p)},useTransition:function(){var c=bM(!1);return c=lC.bind(null,P1,c.queue,!0,!1),xv().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,p,C){var D=P1,G=xv();if(F1){if(C===void 0)throw Error(n(407));C=C()}else{if(C=p(),L_===null)throw Error(n(349));(H1&127)!==0||zw(D,p,C)}G.memoizedState=C;var $={value:C,getSnapshot:p};return G.queue=$,Jw(Uw.bind(null,D,$,c),[c]),D.flags|=2048,dS(9,{destroy:void 0},Fw.bind(null,D,$,C,p),null),C},useId:function(){var c=xv(),p=L_.identifierPrefix;if(F1){var C=Uv,D=Fv;C=(D&~(1<<32-v0(D)-1)).toString(32)+C,p="_"+p+"R_"+C,C=JA++,0<C&&(p+="H"+C.toString(32)),p+="_"}else C=p3++,p="_"+p+"r_"+C.toString(32)+"_";return c.memoizedState=p},useHostTransitionStatus:CM,useFormState:Yw,useActionState:Yw,useOptimistic:function(c){var p=xv();p.memoizedState=p.baseState=c;var C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=C,p=TM.bind(null,P1,!0,C),C.dispatch=p,[c,p]},useMemoCache:vM,useCacheRefresh:function(){return xv().memoizedState=y3.bind(null,P1)},useEffectEvent:function(c){var p=xv(),C={impl:c};return p.memoizedState=C,function(){if((K1&2)!==0)throw Error(n(440));return C.impl.apply(void 0,arguments)}}},RM={readContext:ev,use:tE,useCallback:sC,useContext:ev,useEffect:AM,useImperativeHandle:rC,useInsertionEffect:tC,useLayoutEffect:nC,useMemo:aC,useReducer:nE,useRef:Qw,useState:function(){return nE(Rx)},useDebugValue:EM,useDeferredValue:function(c,p){var C=W_();return oC(C,E_.memoizedState,c,p)},useTransition:function(){var c=nE(Rx)[0],p=W_().memoizedState;return[typeof c=="boolean"?c:tA(c),p]},useSyncExternalStore:Nw,useId:hC,useHostTransitionStatus:CM,useFormState:Kw,useActionState:Kw,useOptimistic:function(c,p){var C=W_();return Vw(C,E_,c,p)},useMemoCache:vM,useCacheRefresh:dC};RM.useEffectEvent=eC;var _C={readContext:ev,use:tE,useCallback:sC,useContext:ev,useEffect:AM,useImperativeHandle:rC,useInsertionEffect:tC,useLayoutEffect:nC,useMemo:aC,useReducer:yM,useRef:Qw,useState:function(){return yM(Rx)},useDebugValue:EM,useDeferredValue:function(c,p){var C=W_();return E_===null?MM(C,c,p):oC(C,E_.memoizedState,c,p)},useTransition:function(){var c=yM(Rx)[0],p=W_().memoizedState;return[typeof c=="boolean"?c:tA(c),p]},useSyncExternalStore:Nw,useId:hC,useHostTransitionStatus:CM,useFormState:Zw,useActionState:Zw,useOptimistic:function(c,p){var C=W_();return E_!==null?Vw(C,E_,c,p):(C.baseState=c,[c,C.queue.dispatch])},useMemoCache:vM,useCacheRefresh:dC};_C.useEffectEvent=eC;function DM(c,p,C,D){p=c.memoizedState,C=C(D,p),C=C==null?p:g({},p,C),c.memoizedState=C,c.lanes===0&&(c.updateQueue.baseState=C)}var LM={enqueueSetState:function(c,p,C){c=c._reactInternals;var D=Nv(),G=V1(D);G.payload=p,C!=null&&(G.callback=C),p=L1(c,G,D),p!==null&&(Lv(p,c,D),T1(p,c,D))},enqueueReplaceState:function(c,p,C){c=c._reactInternals;var D=Nv(),G=V1(D);G.tag=1,G.payload=p,C!=null&&(G.callback=C),p=L1(c,G,D),p!==null&&(Lv(p,c,D),T1(p,c,D))},enqueueForceUpdate:function(c,p){c=c._reactInternals;var C=Nv(),D=V1(C);D.tag=2,p!=null&&(D.callback=p),p=L1(c,D,C),p!==null&&(Lv(p,c,C),T1(p,c,C))}};function vC(c,p,C,D,G,$,et){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(D,$,et):p.prototype&&p.prototype.isPureReactComponent?!Vx(C,D)||!Vx(G,$):!0}function xC(c,p,C,D){c=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(C,D),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(C,D),p.state!==c&&LM.enqueueReplaceState(p,p.state,null)}function F2(c,p){var C=p;if("ref"in p){C={};for(var D in p)D!=="ref"&&(C[D]=p[D])}if(c=c.defaultProps){C===p&&(C=g({},C));for(var G in c)C[G]===void 0&&(C[G]=c[G])}return C}function yC(c){C2(c)}function bC(c){console.error(c)}function SC(c){C2(c)}function aE(c,p){try{var C=c.onUncaughtError;C(p.value,{componentStack:p.stack})}catch(D){setTimeout(function(){throw D})}}function AC(c,p,C){try{var D=c.onCaughtError;D(C.value,{componentStack:C.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(G){setTimeout(function(){throw G})}}function PM(c,p,C){return C=V1(C),C.tag=3,C.payload={element:null},C.callback=function(){aE(c,p)},C}function EC(c){return c=V1(c),c.tag=3,c}function MC(c,p,C,D){var G=C.type.getDerivedStateFromError;if(typeof G=="function"){var $=D.value;c.payload=function(){return G($)},c.callback=function(){AC(p,C,D)}}var et=C.stateNode;et!==null&&typeof et.componentDidCatch=="function"&&(c.callback=function(){AC(p,C,D),typeof G!="function"&&(n2===null?n2=new Set([this]):n2.add(this));var n0=D.stack;this.componentDidCatch(D.value,{componentStack:n0!==null?n0:""})})}function S3(c,p,C,D,G){if(C.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){if(p=C.alternate,p!==null&&Xx(p,C,G,!0),C=Pv.current,C!==null){switch(C.tag){case 31:case 13:return Vv===null?vE():C.alternate===null&&G_===0&&(G_=3),C.flags&=-257,C.flags|=65536,C.lanes=G,D===X0?C.flags|=16384:(p=C.updateQueue,p===null?C.updateQueue=new Set([D]):p.add(D),iw(c,D,G)),!1;case 22:return C.flags|=65536,D===X0?C.flags|=16384:(p=C.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([D])},C.updateQueue=p):(C=p.retryQueue,C===null?p.retryQueue=new Set([D]):C.add(D)),iw(c,D,G)),!1}throw Error(n(435,C.tag))}return iw(c,D,G),vE(),!1}if(F1)return p=Pv.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=G,D!==YS&&(c=Error(n(422),{cause:D}),B2(dv(c,C)))):(D!==YS&&(p=Error(n(423),{cause:D}),B2(dv(p,C))),c=c.current.alternate,c.flags|=65536,G&=-G,c.lanes|=G,D=dv(D,C),G=PM(c.stateNode,D,G),N1(c,G),G_!==4&&(G_=2)),!1;var $=Error(n(520),{cause:D});if($=dv($,C),hA===null?hA=[$]:hA.push($),G_!==4&&(G_=2),p===null)return!0;D=dv(D,C),C=p;do{switch(C.tag){case 3:return C.flags|=65536,c=G&-G,C.lanes|=c,c=PM(C.stateNode,D,c),N1(C,c),!1;case 1:if(p=C.type,$=C.stateNode,(C.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(n2===null||!n2.has($))))return C.flags|=65536,G&=-G,C.lanes|=G,G=EC(G),MC(G,c,C,D),N1(C,G),!1}C=C.return}while(C!==null);return!1}var OM=Error(n(461)),K_=!1;function sv(c,p,C,D){p.child=c===null?h1(p,null,C,D):D1(p,c.child,C,D)}function wC(c,p,C,D,G){C=C.render;var $=p.ref;if("ref"in D){var et={};for(var n0 in D)n0!=="ref"&&(et[n0]=D[n0])}else et=D;return Ex(p),D=pM(c,p,C,et,$,G),n0=mM(),c!==null&&!K_?(gM(c,p,G),Dx(c,p,G)):(F1&&n0&&$S(p),p.flags|=1,sv(c,p,D,G),p.child)}function CC(c,p,C,D,G){if(c===null){var $=C.type;return typeof $=="function"&&!iS($)&&$.defaultProps===void 0&&C.compare===null?(p.tag=15,p.type=$,TC(c,p,$,D,G)):(c=L2(C.type,null,D,p,p.mode,G),c.ref=p.ref,c.return=p,p.child=c)}if($=c.child,!GM(c,G)){var et=$.memoizedProps;if(C=C.compare,C=C!==null?C:Vx,C(et,D)&&c.ref===p.ref)return Dx(c,p,G)}return p.flags|=1,c=Xv($,D),c.ref=p.ref,c.return=p,p.child=c}function TC(c,p,C,D,G){if(c!==null){var $=c.memoizedProps;if(Vx($,D)&&c.ref===p.ref)if(K_=!1,p.pendingProps=D=$,GM(c,G))(c.flags&131072)!==0&&(K_=!0);else return p.lanes=c.lanes,Dx(c,p,G)}return IM(c,p,C,D,G)}function RC(c,p,C,D){var G=D.children,$=c!==null?c.memoizedState:null;if(c===null&&p.stateNode===null&&(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),D.mode==="hidden"){if((p.flags&128)!==0){if($=$!==null?$.baseLanes|C:C,c!==null){for(D=p.child=c.child,G=0;D!==null;)G=G|D.lanes|D.childLanes,D=D.sibling;D=G&~$}else D=0,p.child=null;return DC(c,p,$,C,D)}if((C&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},c!==null&&si(p,$!==null?$.cachePool:null),$!==null?Pw(p,$):uM(),Ow(p);else return D=p.lanes=536870912,DC(c,p,$!==null?$.baseLanes|C:C,C,D)}else $!==null?(si(p,$.cachePool),Pw(p,$),Qx(),p.memoizedState=null):(c!==null&&si(p,null),uM(),Qx());return sv(c,p,G,C),p.child}function rA(c,p){return c!==null&&c.tag===22||p.stateNode!==null||(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.sibling}function DC(c,p,C,D,G){var $=z();return $=$===null?null:{parent:F_._currentValue,pool:$},p.memoizedState={baseLanes:C,cachePool:$},c!==null&&si(p,null),uM(),Ow(p),c!==null&&Xx(c,p,D,!0),p.childLanes=G,null}function oE(c,p){return p=cE({mode:p.mode,children:p.children},c.mode),p.ref=c.ref,c.child=p,p.return=c,p}function LC(c,p,C){return D1(p,c.child,null,C),c=oE(p,p.pendingProps),c.flags|=2,Ov(p),p.memoizedState=null,c}function A3(c,p,C){var D=p.pendingProps,G=(p.flags&128)!==0;if(p.flags&=-129,c===null){if(F1){if(D.mode==="hidden")return c=oE(p,D),p.lanes=536870912,rA(null,c);if(dM(p),(c=D_)?(c=HT(c,wv),c=c!==null&&c.data==="&"?c:null,c!==null&&(p.memoizedState={dehydrated:c,treeContext:lx!==null?{id:Fv,overflow:Uv}:null,retryLane:536870912,hydrationErrors:null},C=HS(c),C.return=p,p.child=C,J_=p,D_=null)):c=null,c===null)throw Kv(p);return p.lanes=536870912,null}return oE(p,D)}var $=c.memoizedState;if($!==null){var et=$.dehydrated;if(dM(p),G)if(p.flags&256)p.flags&=-257,p=LC(c,p,C);else if(p.memoizedState!==null)p.child=c.child,p.flags|=128,p=null;else throw Error(n(558));else if(K_||Xx(c,p,C,!1),G=(C&c.childLanes)!==0,K_||G){if(D=L_,D!==null&&(et=i0(D,C),et!==0&&et!==$.retryLane))throw $.retryLane=et,rx(c,et),Lv(D,c,et),OM;vE(),p=LC(c,p,C)}else c=$.treeContext,D_=Hv(et.nextSibling),J_=p,F1=!0,nv=null,wv=!1,c!==null&&jA(p,c),p=oE(p,D),p.flags|=4096;return p}return c=Xv(c.child,{mode:D.mode,children:D.children}),c.ref=p.ref,p.child=c,c.return=p,c}function lE(c,p){var C=p.ref;if(C===null)c!==null&&c.ref!==null&&(p.flags|=4194816);else{if(typeof C!="function"&&typeof C!="object")throw Error(n(284));(c===null||c.ref!==C)&&(p.flags|=4194816)}}function IM(c,p,C,D,G){return Ex(p),C=pM(c,p,C,D,void 0,G),D=mM(),c!==null&&!K_?(gM(c,p,G),Dx(c,p,G)):(F1&&D&&$S(p),p.flags|=1,sv(c,p,C,G),p.child)}function PC(c,p,C,D,G,$){return Ex(p),p.updateQueue=null,C=Bw(p,D,C,G),Iw(c),D=mM(),c!==null&&!K_?(gM(c,p,$),Dx(c,p,$)):(F1&&D&&$S(p),p.flags|=1,sv(c,p,C,$),p.child)}function OC(c,p,C,D,G){if(Ex(p),p.stateNode===null){var $=Wx,et=C.contextType;typeof et=="object"&&et!==null&&($=ev(et)),$=new C(D,$),p.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,$.updater=LM,p.stateNode=$,$._reactInternals=p,$=p.stateNode,$.props=D,$.state=p.memoizedState,$.refs={},U_(p),et=C.contextType,$.context=typeof et=="object"&&et!==null?ev(et):Wx,$.state=p.memoizedState,et=C.getDerivedStateFromProps,typeof et=="function"&&(DM(p,C,et,D),$.state=p.memoizedState),typeof C.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(et=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),et!==$.state&&LM.enqueueReplaceState($,$.state,null),cx(p,D,$,G),qx(),$.state=p.memoizedState),typeof $.componentDidMount=="function"&&(p.flags|=4194308),D=!0}else if(c===null){$=p.stateNode;var n0=p.memoizedProps,R0=F2(C,n0);$.props=R0;var W0=$.context,Q0=C.contextType;et=Wx,typeof Q0=="object"&&Q0!==null&&(et=ev(Q0));var t1=C.getDerivedStateFromProps;Q0=typeof t1=="function"||typeof $.getSnapshotBeforeUpdate=="function",n0=p.pendingProps!==n0,Q0||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(n0||W0!==et)&&xC(p,$,D,et),B1=!1;var Y0=p.memoizedState;$.state=Y0,cx(p,D,$,G),qx(),W0=p.memoizedState,n0||Y0!==W0||B1?(typeof t1=="function"&&(DM(p,C,t1,D),W0=p.memoizedState),(R0=B1||vC(p,C,R0,D,Y0,W0,et))?(Q0||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount()),typeof $.componentDidMount=="function"&&(p.flags|=4194308)):(typeof $.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=D,p.memoizedState=W0),$.props=D,$.state=W0,$.context=et,D=R0):(typeof $.componentDidMount=="function"&&(p.flags|=4194308),D=!1)}else{$=p.stateNode,E1(c,p),et=p.memoizedProps,Q0=F2(C,et),$.props=Q0,t1=p.pendingProps,Y0=$.context,W0=C.contextType,R0=Wx,typeof W0=="object"&&W0!==null&&(R0=ev(W0)),n0=C.getDerivedStateFromProps,(W0=typeof n0=="function"||typeof $.getSnapshotBeforeUpdate=="function")||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(et!==t1||Y0!==R0)&&xC(p,$,D,R0),B1=!1,Y0=p.memoizedState,$.state=Y0,cx(p,D,$,G),qx();var q0=p.memoizedState;et!==t1||Y0!==q0||B1||c!==null&&c.dependencies!==null&&aS(c.dependencies)?(typeof n0=="function"&&(DM(p,C,n0,D),q0=p.memoizedState),(Q0=B1||vC(p,C,Q0,D,Y0,q0,R0)||c!==null&&c.dependencies!==null&&aS(c.dependencies))?(W0||typeof $.UNSAFE_componentWillUpdate!="function"&&typeof $.componentWillUpdate!="function"||(typeof $.componentWillUpdate=="function"&&$.componentWillUpdate(D,q0,R0),typeof $.UNSAFE_componentWillUpdate=="function"&&$.UNSAFE_componentWillUpdate(D,q0,R0)),typeof $.componentDidUpdate=="function"&&(p.flags|=4),typeof $.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof $.componentDidUpdate!="function"||et===c.memoizedProps&&Y0===c.memoizedState||(p.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||et===c.memoizedProps&&Y0===c.memoizedState||(p.flags|=1024),p.memoizedProps=D,p.memoizedState=q0),$.props=D,$.state=q0,$.context=R0,D=Q0):(typeof $.componentDidUpdate!="function"||et===c.memoizedProps&&Y0===c.memoizedState||(p.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||et===c.memoizedProps&&Y0===c.memoizedState||(p.flags|=1024),D=!1)}return $=D,lE(c,p),D=(p.flags&128)!==0,$||D?($=p.stateNode,C=D&&typeof C.getDerivedStateFromError!="function"?null:$.render(),p.flags|=1,c!==null&&D?(p.child=D1(p,c.child,null,G),p.child=D1(p,null,C,G)):sv(c,p,C,G),p.memoizedState=$.state,c=p.child):c=Dx(c,p,G),c}function IC(c,p,C,D){return qv(),p.flags|=256,sv(c,p,C,D),p.child}var BM={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function NM(c){return{baseLanes:c,cachePool:X()}}function zM(c,p,C){return c=c!==null?c.childLanes&~C:0,p&&(c|=Bv),c}function BC(c,p,C){var D=p.pendingProps,G=!1,$=(p.flags&128)!==0,et;if((et=$)||(et=c!==null&&c.memoizedState===null?!1:(j_.current&2)!==0),et&&(G=!0,p.flags&=-129),et=(p.flags&32)!==0,p.flags&=-33,c===null){if(F1){if(G?Zx(p):Qx(),(c=D_)?(c=HT(c,wv),c=c!==null&&c.data!=="&"?c:null,c!==null&&(p.memoizedState={dehydrated:c,treeContext:lx!==null?{id:Fv,overflow:Uv}:null,retryLane:536870912,hydrationErrors:null},C=HS(c),C.return=p,p.child=C,J_=p,D_=null)):c=null,c===null)throw Kv(p);return xw(c)?p.lanes=32:p.lanes=536870912,null}var n0=D.children;return D=D.fallback,G?(Qx(),G=p.mode,n0=cE({mode:"hidden",children:n0},G),D=ax(D,G,C,null),n0.return=p,D.return=p,n0.sibling=D,p.child=n0,D=p.child,D.memoizedState=NM(C),D.childLanes=zM(c,et,C),p.memoizedState=BM,rA(null,D)):(Zx(p),FM(p,n0))}var R0=c.memoizedState;if(R0!==null&&(n0=R0.dehydrated,n0!==null)){if($)p.flags&256?(Zx(p),p.flags&=-257,p=UM(c,p,C)):p.memoizedState!==null?(Qx(),p.child=c.child,p.flags|=128,p=null):(Qx(),n0=D.fallback,G=p.mode,D=cE({mode:"visible",children:D.children},G),n0=ax(n0,G,C,null),n0.flags|=2,D.return=p,n0.return=p,D.sibling=n0,p.child=D,D1(p,c.child,null,C),D=p.child,D.memoizedState=NM(C),D.childLanes=zM(c,et,C),p.memoizedState=BM,p=rA(null,D));else if(Zx(p),xw(n0)){if(et=n0.nextSibling&&n0.nextSibling.dataset,et)var W0=et.dgst;et=W0,D=Error(n(419)),D.stack="",D.digest=et,B2({value:D,source:null,stack:null}),p=UM(c,p,C)}else if(K_||Xx(c,p,C,!1),et=(C&c.childLanes)!==0,K_||et){if(et=L_,et!==null&&(D=i0(et,C),D!==0&&D!==R0.retryLane))throw R0.retryLane=D,rx(c,D),Lv(et,c,D),OM;vw(n0)||vE(),p=UM(c,p,C)}else vw(n0)?(p.flags|=192,p.child=c.child,p=null):(c=R0.treeContext,D_=Hv(n0.nextSibling),J_=p,F1=!0,nv=null,wv=!1,c!==null&&jA(p,c),p=FM(p,D.children),p.flags|=4096);return p}return G?(Qx(),n0=D.fallback,G=p.mode,R0=c.child,W0=R0.sibling,D=Xv(R0,{mode:"hidden",children:D.children}),D.subtreeFlags=R0.subtreeFlags&65011712,W0!==null?n0=Xv(W0,n0):(n0=ax(n0,G,C,null),n0.flags|=2),n0.return=p,D.return=p,D.sibling=n0,p.child=D,rA(null,D),D=p.child,n0=c.child.memoizedState,n0===null?n0=NM(C):(G=n0.cachePool,G!==null?(R0=F_._currentValue,G=G.parent!==R0?{parent:R0,pool:R0}:G):G=X(),n0={baseLanes:n0.baseLanes|C,cachePool:G}),D.memoizedState=n0,D.childLanes=zM(c,et,C),p.memoizedState=BM,rA(c.child,D)):(Zx(p),C=c.child,c=C.sibling,C=Xv(C,{mode:"visible",children:D.children}),C.return=p,C.sibling=null,c!==null&&(et=p.deletions,et===null?(p.deletions=[c],p.flags|=16):et.push(c)),p.child=C,p.memoizedState=null,C)}function FM(c,p){return p=cE({mode:"visible",children:p},c.mode),p.return=c,c.child=p}function cE(c,p){return c=_v(22,c,null,p),c.lanes=0,c}function UM(c,p,C){return D1(p,c.child,null,C),c=FM(p,p.pendingProps.children),c.flags|=2,p.memoizedState=null,c}function NC(c,p,C){c.lanes|=p;var D=c.alternate;D!==null&&(D.lanes|=p),KS(c.return,p,C)}function kM(c,p,C,D,G,$){var et=c.memoizedState;et===null?c.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:D,tail:C,tailMode:G,treeForkCount:$}:(et.isBackwards=p,et.rendering=null,et.renderingStartTime=0,et.last=D,et.tail=C,et.tailMode=G,et.treeForkCount=$)}function zC(c,p,C){var D=p.pendingProps,G=D.revealOrder,$=D.tail;D=D.children;var et=j_.current,n0=(et&2)!==0;if(n0?(et=et&1|2,p.flags|=128):et&=1,Y(j_,et),sv(c,p,D,C),D=F1?O2:0,!n0&&c!==null&&(c.flags&128)!==0)e:for(c=p.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&NC(c,C,p);else if(c.tag===19)NC(c,C,p);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===p)break e;for(;c.sibling===null;){if(c.return===null||c.return===p)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(G){case"forwards":for(C=p.child,G=null;C!==null;)c=C.alternate,c!==null&&ZA(c)===null&&(G=C),C=C.sibling;C=G,C===null?(G=p.child,p.child=null):(G=C.sibling,C.sibling=null),kM(p,!1,G,C,$,D);break;case"backwards":case"unstable_legacy-backwards":for(C=null,G=p.child,p.child=null;G!==null;){if(c=G.alternate,c!==null&&ZA(c)===null){p.child=G;break}c=G.sibling,G.sibling=C,C=G,G=c}kM(p,!0,C,null,$,D);break;case"together":kM(p,!1,null,null,void 0,D);break;default:p.memoizedState=null}return p.child}function Dx(c,p,C){if(c!==null&&(p.dependencies=c.dependencies),t2|=p.lanes,(C&p.childLanes)===0)if(c!==null){if(Xx(c,p,C,!1),(C&p.childLanes)===0)return null}else return null;if(c!==null&&p.child!==c.child)throw Error(n(153));if(p.child!==null){for(c=p.child,C=Xv(c,c.pendingProps),p.child=C,C.return=p;c.sibling!==null;)c=c.sibling,C=C.sibling=Xv(c,c.pendingProps),C.return=p;C.sibling=null}return p.child}function GM(c,p){return(c.lanes&p)!==0?!0:(c=c.dependencies,!!(c!==null&&aS(c)))}function E3(c,p,C){switch(p.tag){case 3:Q(p,p.stateNode.containerInfo),Gv(p,F_,c.memoizedState.cache),qv();break;case 27:case 5:ut(p);break;case 4:Q(p,p.stateNode.containerInfo);break;case 10:Gv(p,p.type,p.memoizedProps.value);break;case 31:if(p.memoizedState!==null)return p.flags|=128,dM(p),null;break;case 13:var D=p.memoizedState;if(D!==null)return D.dehydrated!==null?(Zx(p),p.flags|=128,null):(C&p.child.childLanes)!==0?BC(c,p,C):(Zx(p),c=Dx(c,p,C),c!==null?c.sibling:null);Zx(p);break;case 19:var G=(c.flags&128)!==0;if(D=(C&p.childLanes)!==0,D||(Xx(c,p,C,!1),D=(C&p.childLanes)!==0),G){if(D)return zC(c,p,C);p.flags|=128}if(G=p.memoizedState,G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),Y(j_,j_.current),D)break;return null;case 22:return p.lanes=0,RC(c,p,C,p.pendingProps);case 24:Gv(p,F_,c.memoizedState.cache)}return Dx(c,p,C)}function FC(c,p,C){if(c!==null)if(c.memoizedProps!==p.pendingProps)K_=!0;else{if(!GM(c,C)&&(p.flags&128)===0)return K_=!1,E3(c,p,C);K_=(c.flags&131072)!==0}else K_=!1,F1&&(p.flags&1048576)!==0&&HA(p,O2,p.index);switch(p.lanes=0,p.tag){case 16:e:{var D=p.pendingProps;if(c=I0(p.elementType),p.type=c,typeof c=="function")iS(c)?(D=F2(c,D),p.tag=1,p=OC(null,p,c,D,C)):(p.tag=0,p=IM(null,p,c,D,C));else{if(c!=null){var G=c.$$typeof;if(G===S){p.tag=11,p=wC(null,p,c,D,C);break e}else if(G===A){p.tag=14,p=CC(null,p,c,D,C);break e}}throw p=I(c)||c,Error(n(306,p,""))}}return p;case 0:return IM(c,p,p.type,p.pendingProps,C);case 1:return D=p.type,G=F2(D,p.pendingProps),OC(c,p,D,G,C);case 3:e:{if(Q(p,p.stateNode.containerInfo),c===null)throw Error(n(387));D=p.pendingProps;var $=p.memoizedState;G=$.element,E1(c,p),cx(p,D,null,C);var et=p.memoizedState;if(D=et.cache,Gv(p,F_,D),D!==$.cache&&qS(p,[F_],C,!0),qx(),D=et.element,$.isDehydrated)if($={element:D,isDehydrated:!1,cache:et.cache},p.updateQueue.baseState=$,p.memoizedState=$,p.flags&256){p=IC(c,p,D,C);break e}else if(D!==G){G=dv(Error(n(424)),p),B2(G),p=IC(c,p,D,C);break e}else{switch(c=p.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(D_=Hv(c.firstChild),J_=p,F1=!0,nv=null,wv=!0,C=h1(p,null,D,C),p.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling}else{if(qv(),D===G){p=Dx(c,p,C);break e}sv(c,p,D,C)}p=p.child}return p;case 26:return lE(c,p),c===null?(C=KT(p.type,null,p.pendingProps,null))?p.memoizedState=C:F1||(C=p.type,c=p.pendingProps,D=ME(Te.current).createElement(C),D[n1]=p,D[c1]=c,av(D,C,c),k0(D),p.stateNode=D):p.memoizedState=KT(p.type,c.memoizedProps,p.pendingProps,c.memoizedState),null;case 27:return ut(p),c===null&&F1&&(D=p.stateNode=$T(p.type,p.pendingProps,Te.current),J_=p,wv=!0,G=D_,a2(p.type)?(yw=G,D_=Hv(D.firstChild)):D_=G),sv(c,p,p.pendingProps.children,C),lE(c,p),c===null&&(p.flags|=4194304),p.child;case 5:return c===null&&F1&&((G=D=D_)&&(D=eR(D,p.type,p.pendingProps,wv),D!==null?(p.stateNode=D,J_=p,D_=Hv(D.firstChild),wv=!1,G=!0):G=!1),G||Kv(p)),ut(p),G=p.type,$=p.pendingProps,et=c!==null?c.memoizedProps:null,D=$.children,mw(G,$)?D=null:et!==null&&mw(G,et)&&(p.flags|=32),p.memoizedState!==null&&(G=pM(c,p,m3,null,null,C),xA._currentValue=G),lE(c,p),sv(c,p,D,C),p.child;case 6:return c===null&&F1&&((c=C=D_)&&(C=tR(C,p.pendingProps,wv),C!==null?(p.stateNode=C,J_=p,D_=null,c=!0):c=!1),c||Kv(p)),null;case 13:return BC(c,p,C);case 4:return Q(p,p.stateNode.containerInfo),D=p.pendingProps,c===null?p.child=D1(p,null,D,C):sv(c,p,D,C),p.child;case 11:return wC(c,p,p.type,p.pendingProps,C);case 7:return sv(c,p,p.pendingProps,C),p.child;case 8:return sv(c,p,p.pendingProps.children,C),p.child;case 12:return sv(c,p,p.pendingProps.children,C),p.child;case 10:return D=p.pendingProps,Gv(p,p.type,D.value),sv(c,p,D.children,C),p.child;case 9:return G=p.type._context,D=p.pendingProps.children,Ex(p),G=ev(G),D=D(G),p.flags|=1,sv(c,p,D,C),p.child;case 14:return CC(c,p,p.type,p.pendingProps,C);case 15:return TC(c,p,p.type,p.pendingProps,C);case 19:return zC(c,p,C);case 31:return A3(c,p,C);case 22:return RC(c,p,C,p.pendingProps);case 24:return Ex(p),D=ev(F_),c===null?(G=z(),G===null&&(G=L_,$=ZS(),G.pooledCache=$,$.refCount++,$!==null&&(G.pooledCacheLanes|=C),G=$),p.memoizedState={parent:D,cache:G},U_(p),Gv(p,F_,G)):((c.lanes&C)!==0&&(E1(c,p),cx(p,null,null,C),qx()),G=c.memoizedState,$=p.memoizedState,G.parent!==D?(G={parent:D,cache:D},p.memoizedState=G,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=G),Gv(p,F_,D)):(D=$.cache,Gv(p,F_,D),D!==G.cache&&qS(p,[F_],C,!0))),sv(c,p,p.pendingProps.children,C),p.child;case 29:throw p.pendingProps}throw Error(n(156,p.tag))}function Lx(c){c.flags|=4}function VM(c,p,C,D,G){if((p=(c.mode&32)!==0)&&(p=!1),p){if(c.flags|=16777216,(G&335544128)===G)if(c.stateNode.complete)c.flags|=8192;else if(hT())c.flags|=8192;else throw j0=X0,x0}else c.flags&=-16777217}function UC(c,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!e3(p))if(hT())c.flags|=8192;else throw j0=X0,x0}function uE(c,p){p!==null&&(c.flags|=4),c.flags&16384&&(p=c.tag!==22?p0():536870912,c.lanes|=p,gS|=p)}function sA(c,p){if(!F1)switch(c.tailMode){case"hidden":p=c.tail;for(var C=null;p!==null;)p.alternate!==null&&(C=p),p=p.sibling;C===null?c.tail=null:C.sibling=null;break;case"collapsed":C=c.tail;for(var D=null;C!==null;)C.alternate!==null&&(D=C),C=C.sibling;D===null?p||c.tail===null?c.tail=null:c.tail.sibling=null:D.sibling=null}}function B_(c){var p=c.alternate!==null&&c.alternate.child===c.child,C=0,D=0;if(p)for(var G=c.child;G!==null;)C|=G.lanes|G.childLanes,D|=G.subtreeFlags&65011712,D|=G.flags&65011712,G.return=c,G=G.sibling;else for(G=c.child;G!==null;)C|=G.lanes|G.childLanes,D|=G.subtreeFlags,D|=G.flags,G.return=c,G=G.sibling;return c.subtreeFlags|=D,c.childLanes=C,p}function M3(c,p,C){var D=p.pendingProps;switch(XS(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return B_(p),null;case 1:return B_(p),null;case 3:return C=p.stateNode,D=null,c!==null&&(D=c.memoizedState.cache),p.memoizedState.cache!==D&&(p.flags|=2048),Zv(F_),Xe(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(c===null||c.child===null)&&(kv(p)?Lx(p):c===null||c.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,I2())),B_(p),null;case 26:var G=p.type,$=p.memoizedState;return c===null?(Lx(p),$!==null?(B_(p),UC(p,$)):(B_(p),VM(p,G,null,D,C))):$?$!==c.memoizedState?(Lx(p),B_(p),UC(p,$)):(B_(p),p.flags&=-16777217):(c=c.memoizedProps,c!==D&&Lx(p),B_(p),VM(p,G,c,D,C)),null;case 27:if(Ji(p),C=Te.current,G=p.type,c!==null&&p.stateNode!=null)c.memoizedProps!==D&&Lx(p);else{if(!D){if(p.stateNode===null)throw Error(n(166));return B_(p),null}c=K.current,kv(p)?WA(p):(c=$T(G,D,C),p.stateNode=c,Lx(p))}return B_(p),null;case 5:if(Ji(p),G=p.type,c!==null&&p.stateNode!=null)c.memoizedProps!==D&&Lx(p);else{if(!D){if(p.stateNode===null)throw Error(n(166));return B_(p),null}if($=K.current,kv(p))WA(p);else{var et=ME(Te.current);switch($){case 1:$=et.createElementNS("http://www.w3.org/2000/svg",G);break;case 2:$=et.createElementNS("http://www.w3.org/1998/Math/MathML",G);break;default:switch(G){case"svg":$=et.createElementNS("http://www.w3.org/2000/svg",G);break;case"math":$=et.createElementNS("http://www.w3.org/1998/Math/MathML",G);break;case"script":$=et.createElement("div"),$.innerHTML="<script><\/script>",$=$.removeChild($.firstChild);break;case"select":$=typeof D.is=="string"?et.createElement("select",{is:D.is}):et.createElement("select"),D.multiple?$.multiple=!0:D.size&&($.size=D.size);break;default:$=typeof D.is=="string"?et.createElement(G,{is:D.is}):et.createElement(G)}}$[n1]=p,$[c1]=D;e:for(et=p.child;et!==null;){if(et.tag===5||et.tag===6)$.appendChild(et.stateNode);else if(et.tag!==4&&et.tag!==27&&et.child!==null){et.child.return=et,et=et.child;continue}if(et===p)break e;for(;et.sibling===null;){if(et.return===null||et.return===p)break e;et=et.return}et.sibling.return=et.return,et=et.sibling}p.stateNode=$;e:switch(av($,G,D),G){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}D&&Lx(p)}}return B_(p),VM(p,p.type,c===null?null:c.memoizedProps,p.pendingProps,C),null;case 6:if(c&&p.stateNode!=null)c.memoizedProps!==D&&Lx(p);else{if(typeof D!="string"&&p.stateNode===null)throw Error(n(166));if(c=Te.current,kv(p)){if(c=p.stateNode,C=p.memoizedProps,D=null,G=J_,G!==null)switch(G.tag){case 27:case 5:D=G.memoizedProps}c[n1]=p,c=!!(c.nodeValue===C||D!==null&&D.suppressHydrationWarning===!0||BT(c.nodeValue,C)),c||Kv(p,!0)}else c=ME(c).createTextNode(D),c[n1]=p,p.stateNode=c}return B_(p),null;case 31:if(C=p.memoizedState,c===null||c.memoizedState!==null){if(D=kv(p),C!==null){if(c===null){if(!D)throw Error(n(318));if(c=p.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(557));c[n1]=p}else qv(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;B_(p),c=!1}else C=I2(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=C),c=!0;if(!c)return p.flags&256?(Ov(p),p):(Ov(p),null);if((p.flags&128)!==0)throw Error(n(558))}return B_(p),null;case 13:if(D=p.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(G=kv(p),D!==null&&D.dehydrated!==null){if(c===null){if(!G)throw Error(n(318));if(G=p.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(n(317));G[n1]=p}else qv(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;B_(p),G=!1}else G=I2(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=G),G=!0;if(!G)return p.flags&256?(Ov(p),p):(Ov(p),null)}return Ov(p),(p.flags&128)!==0?(p.lanes=C,p):(C=D!==null,c=c!==null&&c.memoizedState!==null,C&&(D=p.child,G=null,D.alternate!==null&&D.alternate.memoizedState!==null&&D.alternate.memoizedState.cachePool!==null&&(G=D.alternate.memoizedState.cachePool.pool),$=null,D.memoizedState!==null&&D.memoizedState.cachePool!==null&&($=D.memoizedState.cachePool.pool),$!==G&&(D.flags|=2048)),C!==c&&C&&(p.child.flags|=8192),uE(p,p.updateQueue),B_(p),null);case 4:return Xe(),c===null&&uw(p.stateNode.containerInfo),B_(p),null;case 10:return Zv(p.type),B_(p),null;case 19:if(V(j_),D=p.memoizedState,D===null)return B_(p),null;if(G=(p.flags&128)!==0,$=D.rendering,$===null)if(G)sA(D,!1);else{if(G_!==0||c!==null&&(c.flags&128)!==0)for(c=p.child;c!==null;){if($=ZA(c),$!==null){for(p.flags|=128,sA(D,!1),c=$.updateQueue,p.updateQueue=c,uE(p,c),p.subtreeFlags=0,c=C,C=p.child;C!==null;)sx(C,c),C=C.sibling;return Y(j_,j_.current&1|2),F1&&Yv(p,D.treeForkCount),p.child}c=c.sibling}D.tail!==null&&We()>mE&&(p.flags|=128,G=!0,sA(D,!1),p.lanes=4194304)}else{if(!G)if(c=ZA($),c!==null){if(p.flags|=128,G=!0,c=c.updateQueue,p.updateQueue=c,uE(p,c),sA(D,!0),D.tail===null&&D.tailMode==="hidden"&&!$.alternate&&!F1)return B_(p),null}else 2*We()-D.renderingStartTime>mE&&C!==536870912&&(p.flags|=128,G=!0,sA(D,!1),p.lanes=4194304);D.isBackwards?($.sibling=p.child,p.child=$):(c=D.last,c!==null?c.sibling=$:p.child=$,D.last=$)}return D.tail!==null?(c=D.tail,D.rendering=c,D.tail=c.sibling,D.renderingStartTime=We(),c.sibling=null,C=j_.current,Y(j_,G?C&1|2:C&1),F1&&Yv(p,D.treeForkCount),c):(B_(p),null);case 22:case 23:return Ov(p),hM(),D=p.memoizedState!==null,c!==null?c.memoizedState!==null!==D&&(p.flags|=8192):D&&(p.flags|=8192),D?(C&536870912)!==0&&(p.flags&128)===0&&(B_(p),p.subtreeFlags&6&&(p.flags|=8192)):B_(p),C=p.updateQueue,C!==null&&uE(p,C.retryQueue),C=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(C=c.memoizedState.cachePool.pool),D=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(D=p.memoizedState.cachePool.pool),D!==C&&(p.flags|=2048),c!==null&&V(Cx),null;case 24:return C=null,c!==null&&(C=c.memoizedState.cache),p.memoizedState.cache!==C&&(p.flags|=2048),Zv(F_),B_(p),null;case 25:return null;case 30:return null}throw Error(n(156,p.tag))}function w3(c,p){switch(XS(p),p.tag){case 1:return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 3:return Zv(F_),Xe(),c=p.flags,(c&65536)!==0&&(c&128)===0?(p.flags=c&-65537|128,p):null;case 26:case 27:case 5:return Ji(p),null;case 31:if(p.memoizedState!==null){if(Ov(p),p.alternate===null)throw Error(n(340));qv()}return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 13:if(Ov(p),c=p.memoizedState,c!==null&&c.dehydrated!==null){if(p.alternate===null)throw Error(n(340));qv()}return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 19:return V(j_),null;case 4:return Xe(),null;case 10:return Zv(p.type),null;case 22:case 23:return Ov(p),hM(),c!==null&&V(Cx),c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 24:return Zv(F_),null;case 25:return null;default:return null}}function kC(c,p){switch(XS(p),p.tag){case 3:Zv(F_),Xe();break;case 26:case 27:case 5:Ji(p);break;case 4:Xe();break;case 31:p.memoizedState!==null&&Ov(p);break;case 13:Ov(p);break;case 19:V(j_);break;case 10:Zv(p.type);break;case 22:case 23:Ov(p),hM(),c!==null&&V(Cx);break;case 24:Zv(F_)}}function aA(c,p){try{var C=p.updateQueue,D=C!==null?C.lastEffect:null;if(D!==null){var G=D.next;C=G;do{if((C.tag&c)===c){D=void 0;var $=C.create,et=C.inst;D=$(),et.destroy=D}C=C.next}while(C!==G)}}catch(n0){J1(p,p.return,n0)}}function Jx(c,p,C){try{var D=p.updateQueue,G=D!==null?D.lastEffect:null;if(G!==null){var $=G.next;D=$;do{if((D.tag&c)===c){var et=D.inst,n0=et.destroy;if(n0!==void 0){et.destroy=void 0,G=p;var R0=C,W0=n0;try{W0()}catch(Q0){J1(G,R0,Q0)}}}D=D.next}while(D!==$)}}catch(Q0){J1(p,p.return,Q0)}}function GC(c){var p=c.updateQueue;if(p!==null){var C=c.stateNode;try{Lw(p,C)}catch(D){J1(c,c.return,D)}}}function VC(c,p,C){C.props=F2(c.type,c.memoizedProps),C.state=c.memoizedState;try{C.componentWillUnmount()}catch(D){J1(c,p,D)}}function oA(c,p){try{var C=c.ref;if(C!==null){switch(c.tag){case 26:case 27:case 5:var D=c.stateNode;break;case 30:D=c.stateNode;break;default:D=c.stateNode}typeof C=="function"?c.refCleanup=C(D):C.current=D}}catch(G){J1(c,p,G)}}function ux(c,p){var C=c.ref,D=c.refCleanup;if(C!==null)if(typeof D=="function")try{D()}catch(G){J1(c,p,G)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof C=="function")try{C(null)}catch(G){J1(c,p,G)}else C.current=null}function HC(c){var p=c.type,C=c.memoizedProps,D=c.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":C.autoFocus&&D.focus();break e;case"img":C.src?D.src=C.src:C.srcSet&&(D.srcset=C.srcSet)}}catch(G){J1(c,c.return,G)}}function HM(c,p,C){try{var D=c.stateNode;Y3(D,c.type,C,p),D[c1]=p}catch(G){J1(c,c.return,G)}}function jC(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&a2(c.type)||c.tag===4}function jM(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||jC(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&a2(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function WM(c,p,C){var D=c.tag;if(D===5||D===6)c=c.stateNode,p?(C.nodeType===9?C.body:C.nodeName==="HTML"?C.ownerDocument.body:C).insertBefore(c,p):(p=C.nodeType===9?C.body:C.nodeName==="HTML"?C.ownerDocument.body:C,p.appendChild(c),C=C._reactRootContainer,C!=null||p.onclick!==null||(p.onclick=Q_));else if(D!==4&&(D===27&&a2(c.type)&&(C=c.stateNode,p=null),c=c.child,c!==null))for(WM(c,p,C),c=c.sibling;c!==null;)WM(c,p,C),c=c.sibling}function hE(c,p,C){var D=c.tag;if(D===5||D===6)c=c.stateNode,p?C.insertBefore(c,p):C.appendChild(c);else if(D!==4&&(D===27&&a2(c.type)&&(C=c.stateNode),c=c.child,c!==null))for(hE(c,p,C),c=c.sibling;c!==null;)hE(c,p,C),c=c.sibling}function WC(c){var p=c.stateNode,C=c.memoizedProps;try{for(var D=c.type,G=p.attributes;G.length;)p.removeAttributeNode(G[0]);av(p,D,C),p[n1]=c,p[c1]=C}catch($){J1(c,c.return,$)}}var Px=!1,q_=!1,$M=!1,$C=typeof WeakSet=="function"?WeakSet:Set,iv=null;function C3(c,p){if(c=c.containerInfo,fw=PE,c=E2(c),Z2(c)){if("selectionStart"in c)var C={start:c.selectionStart,end:c.selectionEnd};else e:{C=(C=c.ownerDocument)&&C.defaultView||window;var D=C.getSelection&&C.getSelection();if(D&&D.rangeCount!==0){C=D.anchorNode;var G=D.anchorOffset,$=D.focusNode;D=D.focusOffset;try{C.nodeType,$.nodeType}catch{C=null;break e}var et=0,n0=-1,R0=-1,W0=0,Q0=0,t1=c,Y0=null;t:for(;;){for(var q0;t1!==C||G!==0&&t1.nodeType!==3||(n0=et+G),t1!==$||D!==0&&t1.nodeType!==3||(R0=et+D),t1.nodeType===3&&(et+=t1.nodeValue.length),(q0=t1.firstChild)!==null;)Y0=t1,t1=q0;for(;;){if(t1===c)break t;if(Y0===C&&++W0===G&&(n0=et),Y0===$&&++Q0===D&&(R0=et),(q0=t1.nextSibling)!==null)break;t1=Y0,Y0=t1.parentNode}t1=q0}C=n0===-1||R0===-1?null:{start:n0,end:R0}}else C=null}C=C||{start:0,end:0}}else C=null;for(pw={focusedElem:c,selectionRange:C},PE=!1,iv=p;iv!==null;)if(p=iv,c=p.child,(p.subtreeFlags&1028)!==0&&c!==null)c.return=p,iv=c;else for(;iv!==null;){switch(p=iv,$=p.alternate,c=p.flags,p.tag){case 0:if((c&4)!==0&&(c=p.updateQueue,c=c!==null?c.events:null,c!==null))for(C=0;C<c.length;C++)G=c[C],G.ref.impl=G.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&$!==null){c=void 0,C=p,G=$.memoizedProps,$=$.memoizedState,D=C.stateNode;try{var _1=F2(C.type,G);c=D.getSnapshotBeforeUpdate(_1,$),D.__reactInternalSnapshotBeforeUpdate=c}catch(w1){J1(C,C.return,w1)}}break;case 3:if((c&1024)!==0){if(c=p.stateNode.containerInfo,C=c.nodeType,C===9)_w(c);else if(C===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":_w(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(n(163))}if(c=p.sibling,c!==null){c.return=p.return,iv=c;break}iv=p.return}}function XC(c,p,C){var D=C.flags;switch(C.tag){case 0:case 11:case 15:Ix(c,C),D&4&&aA(5,C);break;case 1:if(Ix(c,C),D&4)if(c=C.stateNode,p===null)try{c.componentDidMount()}catch(et){J1(C,C.return,et)}else{var G=F2(C.type,p.memoizedProps);p=p.memoizedState;try{c.componentDidUpdate(G,p,c.__reactInternalSnapshotBeforeUpdate)}catch(et){J1(C,C.return,et)}}D&64&&GC(C),D&512&&oA(C,C.return);break;case 3:if(Ix(c,C),D&64&&(c=C.updateQueue,c!==null)){if(p=null,C.child!==null)switch(C.child.tag){case 27:case 5:p=C.child.stateNode;break;case 1:p=C.child.stateNode}try{Lw(c,p)}catch(et){J1(C,C.return,et)}}break;case 27:p===null&&D&4&&WC(C);case 26:case 5:Ix(c,C),p===null&&D&4&&HC(C),D&512&&oA(C,C.return);break;case 12:Ix(c,C);break;case 31:Ix(c,C),D&4&&qC(c,C);break;case 13:Ix(c,C),D&4&&ZC(c,C),D&64&&(c=C.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(C=N3.bind(null,C),nR(c,C))));break;case 22:if(D=C.memoizedState!==null||Px,!D){p=p!==null&&p.memoizedState!==null||q_,G=Px;var $=q_;Px=D,(q_=p)&&!$?Bx(c,C,(C.subtreeFlags&8772)!==0):Ix(c,C),Px=G,q_=$}break;case 30:break;default:Ix(c,C)}}function YC(c){var p=c.alternate;p!==null&&(c.alternate=null,YC(p)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(p=c.stateNode,p!==null&&V0(p)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var N_=null,Cv=!1;function Ox(c,p,C){for(C=C.child;C!==null;)KC(c,p,C),C=C.sibling}function KC(c,p,C){if(Fe&&typeof Fe.onCommitFiberUnmount=="function")try{Fe.onCommitFiberUnmount(P0,C)}catch{}switch(C.tag){case 26:q_||ux(C,p),Ox(c,p,C),C.memoizedState?C.memoizedState.count--:C.stateNode&&(C=C.stateNode,C.parentNode.removeChild(C));break;case 27:q_||ux(C,p);var D=N_,G=Cv;a2(C.type)&&(N_=C.stateNode,Cv=!1),Ox(c,p,C),gA(C.stateNode),N_=D,Cv=G;break;case 5:q_||ux(C,p);case 6:if(D=N_,G=Cv,N_=null,Ox(c,p,C),N_=D,Cv=G,N_!==null)if(Cv)try{(N_.nodeType===9?N_.body:N_.nodeName==="HTML"?N_.ownerDocument.body:N_).removeChild(C.stateNode)}catch($){J1(C,p,$)}else try{N_.removeChild(C.stateNode)}catch($){J1(C,p,$)}break;case 18:N_!==null&&(Cv?(c=N_,GT(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,C.stateNode),ES(c)):GT(N_,C.stateNode));break;case 4:D=N_,G=Cv,N_=C.stateNode.containerInfo,Cv=!0,Ox(c,p,C),N_=D,Cv=G;break;case 0:case 11:case 14:case 15:Jx(2,C,p),q_||Jx(4,C,p),Ox(c,p,C);break;case 1:q_||(ux(C,p),D=C.stateNode,typeof D.componentWillUnmount=="function"&&VC(C,p,D)),Ox(c,p,C);break;case 21:Ox(c,p,C);break;case 22:q_=(D=q_)||C.memoizedState!==null,Ox(c,p,C),q_=D;break;default:Ox(c,p,C)}}function qC(c,p){if(p.memoizedState===null&&(c=p.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{ES(c)}catch(C){J1(p,p.return,C)}}}function ZC(c,p){if(p.memoizedState===null&&(c=p.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{ES(c)}catch(C){J1(p,p.return,C)}}function T3(c){switch(c.tag){case 31:case 13:case 19:var p=c.stateNode;return p===null&&(p=c.stateNode=new $C),p;case 22:return c=c.stateNode,p=c._retryCache,p===null&&(p=c._retryCache=new $C),p;default:throw Error(n(435,c.tag))}}function dE(c,p){var C=T3(c);p.forEach(function(D){if(!C.has(D)){C.add(D);var G=z3.bind(null,c,D);D.then(G,G)}})}function Tv(c,p){var C=p.deletions;if(C!==null)for(var D=0;D<C.length;D++){var G=C[D],$=c,et=p,n0=et;e:for(;n0!==null;){switch(n0.tag){case 27:if(a2(n0.type)){N_=n0.stateNode,Cv=!1;break e}break;case 5:N_=n0.stateNode,Cv=!1;break e;case 3:case 4:N_=n0.stateNode.containerInfo,Cv=!0;break e}n0=n0.return}if(N_===null)throw Error(n(160));KC($,et,G),N_=null,Cv=!1,$=G.alternate,$!==null&&($.return=null),G.return=null}if(p.subtreeFlags&13886)for(p=p.child;p!==null;)QC(p,c),p=p.sibling}var Jv=null;function QC(c,p){var C=c.alternate,D=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:Tv(p,c),Rv(c),D&4&&(Jx(3,c,c.return),aA(3,c),Jx(5,c,c.return));break;case 1:Tv(p,c),Rv(c),D&512&&(q_||C===null||ux(C,C.return)),D&64&&Px&&(c=c.updateQueue,c!==null&&(D=c.callbacks,D!==null&&(C=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=C===null?D:C.concat(D))));break;case 26:var G=Jv;if(Tv(p,c),Rv(c),D&512&&(q_||C===null||ux(C,C.return)),D&4){var $=C!==null?C.memoizedState:null;if(D=c.memoizedState,C===null)if(D===null)if(c.stateNode===null){e:{D=c.type,C=c.memoizedProps,G=G.ownerDocument||G;t:switch(D){case"title":$=G.getElementsByTagName("title")[0],(!$||$[B0]||$[n1]||$.namespaceURI==="http://www.w3.org/2000/svg"||$.hasAttribute("itemprop"))&&($=G.createElement(D),G.head.insertBefore($,G.querySelector("head > title"))),av($,D,C),$[n1]=c,k0($),D=$;break e;case"link":var et=QT("link","href",G).get(D+(C.href||""));if(et){for(var n0=0;n0<et.length;n0++)if($=et[n0],$.getAttribute("href")===(C.href==null||C.href===""?null:C.href)&&$.getAttribute("rel")===(C.rel==null?null:C.rel)&&$.getAttribute("title")===(C.title==null?null:C.title)&&$.getAttribute("crossorigin")===(C.crossOrigin==null?null:C.crossOrigin)){et.splice(n0,1);break t}}$=G.createElement(D),av($,D,C),G.head.appendChild($);break;case"meta":if(et=QT("meta","content",G).get(D+(C.content||""))){for(n0=0;n0<et.length;n0++)if($=et[n0],$.getAttribute("content")===(C.content==null?null:""+C.content)&&$.getAttribute("name")===(C.name==null?null:C.name)&&$.getAttribute("property")===(C.property==null?null:C.property)&&$.getAttribute("http-equiv")===(C.httpEquiv==null?null:C.httpEquiv)&&$.getAttribute("charset")===(C.charSet==null?null:C.charSet)){et.splice(n0,1);break t}}$=G.createElement(D),av($,D,C),G.head.appendChild($);break;default:throw Error(n(468,D))}$[n1]=c,k0($),D=$}c.stateNode=D}else JT(G,c.type,c.stateNode);else c.stateNode=ZT(G,D,c.memoizedProps);else $!==D?($===null?C.stateNode!==null&&(C=C.stateNode,C.parentNode.removeChild(C)):$.count--,D===null?JT(G,c.type,c.stateNode):ZT(G,D,c.memoizedProps)):D===null&&c.stateNode!==null&&HM(c,c.memoizedProps,C.memoizedProps)}break;case 27:Tv(p,c),Rv(c),D&512&&(q_||C===null||ux(C,C.return)),C!==null&&D&4&&HM(c,c.memoizedProps,C.memoizedProps);break;case 5:if(Tv(p,c),Rv(c),D&512&&(q_||C===null||ux(C,C.return)),c.flags&32){G=c.stateNode;try{V_(G,"")}catch(_1){J1(c,c.return,_1)}}D&4&&c.stateNode!=null&&(G=c.memoizedProps,HM(c,G,C!==null?C.memoizedProps:G)),D&1024&&($M=!0);break;case 6:if(Tv(p,c),Rv(c),D&4){if(c.stateNode===null)throw Error(n(162));D=c.memoizedProps,C=c.stateNode;try{C.nodeValue=D}catch(_1){J1(c,c.return,_1)}}break;case 3:if(TE=null,G=Jv,Jv=wE(p.containerInfo),Tv(p,c),Jv=G,Rv(c),D&4&&C!==null&&C.memoizedState.isDehydrated)try{ES(p.containerInfo)}catch(_1){J1(c,c.return,_1)}$M&&($M=!1,JC(c));break;case 4:D=Jv,Jv=wE(c.stateNode.containerInfo),Tv(p,c),Rv(c),Jv=D;break;case 12:Tv(p,c),Rv(c);break;case 31:Tv(p,c),Rv(c),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,dE(c,D)));break;case 13:Tv(p,c),Rv(c),c.child.flags&8192&&c.memoizedState!==null!=(C!==null&&C.memoizedState!==null)&&(pE=We()),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,dE(c,D)));break;case 22:G=c.memoizedState!==null;var R0=C!==null&&C.memoizedState!==null,W0=Px,Q0=q_;if(Px=W0||G,q_=Q0||R0,Tv(p,c),q_=Q0,Px=W0,Rv(c),D&8192)e:for(p=c.stateNode,p._visibility=G?p._visibility&-2:p._visibility|1,G&&(C===null||R0||Px||q_||U2(c)),C=null,p=c;;){if(p.tag===5||p.tag===26){if(C===null){R0=C=p;try{if($=R0.stateNode,G)et=$.style,typeof et.setProperty=="function"?et.setProperty("display","none","important"):et.display="none";else{n0=R0.stateNode;var t1=R0.memoizedProps.style,Y0=t1!=null&&t1.hasOwnProperty("display")?t1.display:null;n0.style.display=Y0==null||typeof Y0=="boolean"?"":(""+Y0).trim()}}catch(_1){J1(R0,R0.return,_1)}}}else if(p.tag===6){if(C===null){R0=p;try{R0.stateNode.nodeValue=G?"":R0.memoizedProps}catch(_1){J1(R0,R0.return,_1)}}}else if(p.tag===18){if(C===null){R0=p;try{var q0=R0.stateNode;G?VT(q0,!0):VT(R0.stateNode,!1)}catch(_1){J1(R0,R0.return,_1)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===c)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break e;for(;p.sibling===null;){if(p.return===null||p.return===c)break e;C===p&&(C=null),p=p.return}C===p&&(C=null),p.sibling.return=p.return,p=p.sibling}D&4&&(D=c.updateQueue,D!==null&&(C=D.retryQueue,C!==null&&(D.retryQueue=null,dE(c,C))));break;case 19:Tv(p,c),Rv(c),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,dE(c,D)));break;case 30:break;case 21:break;default:Tv(p,c),Rv(c)}}function Rv(c){var p=c.flags;if(p&2){try{for(var C,D=c.return;D!==null;){if(jC(D)){C=D;break}D=D.return}if(C==null)throw Error(n(160));switch(C.tag){case 27:var G=C.stateNode,$=jM(c);hE(c,$,G);break;case 5:var et=C.stateNode;C.flags&32&&(V_(et,""),C.flags&=-33);var n0=jM(c);hE(c,n0,et);break;case 3:case 4:var R0=C.stateNode.containerInfo,W0=jM(c);WM(c,W0,R0);break;default:throw Error(n(161))}}catch(Q0){J1(c,c.return,Q0)}c.flags&=-3}p&4096&&(c.flags&=-4097)}function JC(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var p=c;JC(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),c=c.sibling}}function Ix(c,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)XC(c,p.alternate,p),p=p.sibling}function U2(c){for(c=c.child;c!==null;){var p=c;switch(p.tag){case 0:case 11:case 14:case 15:Jx(4,p,p.return),U2(p);break;case 1:ux(p,p.return);var C=p.stateNode;typeof C.componentWillUnmount=="function"&&VC(p,p.return,C),U2(p);break;case 27:gA(p.stateNode);case 26:case 5:ux(p,p.return),U2(p);break;case 22:p.memoizedState===null&&U2(p);break;case 30:U2(p);break;default:U2(p)}c=c.sibling}}function Bx(c,p,C){for(C=C&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var D=p.alternate,G=c,$=p,et=$.flags;switch($.tag){case 0:case 11:case 15:Bx(G,$,C),aA(4,$);break;case 1:if(Bx(G,$,C),D=$,G=D.stateNode,typeof G.componentDidMount=="function")try{G.componentDidMount()}catch(W0){J1(D,D.return,W0)}if(D=$,G=D.updateQueue,G!==null){var n0=D.stateNode;try{var R0=G.shared.hiddenCallbacks;if(R0!==null)for(G.shared.hiddenCallbacks=null,G=0;G<R0.length;G++)N2(R0[G],n0)}catch(W0){J1(D,D.return,W0)}}C&&et&64&&GC($),oA($,$.return);break;case 27:WC($);case 26:case 5:Bx(G,$,C),C&&D===null&&et&4&&HC($),oA($,$.return);break;case 12:Bx(G,$,C);break;case 31:Bx(G,$,C),C&&et&4&&qC(G,$);break;case 13:Bx(G,$,C),C&&et&4&&ZC(G,$);break;case 22:$.memoizedState===null&&Bx(G,$,C),oA($,$.return);break;case 30:break;default:Bx(G,$,C)}p=p.sibling}}function XM(c,p){var C=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(C=c.memoizedState.cachePool.pool),c=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(c=p.memoizedState.cachePool.pool),c!==C&&(c!=null&&c.refCount++,C!=null&&Yx(C))}function YM(c,p){c=null,p.alternate!==null&&(c=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==c&&(p.refCount++,c!=null&&Yx(c))}function ex(c,p,C,D){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)eT(c,p,C,D),p=p.sibling}function eT(c,p,C,D){var G=p.flags;switch(p.tag){case 0:case 11:case 15:ex(c,p,C,D),G&2048&&aA(9,p);break;case 1:ex(c,p,C,D);break;case 3:ex(c,p,C,D),G&2048&&(c=null,p.alternate!==null&&(c=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==c&&(p.refCount++,c!=null&&Yx(c)));break;case 12:if(G&2048){ex(c,p,C,D),c=p.stateNode;try{var $=p.memoizedProps,et=$.id,n0=$.onPostCommit;typeof n0=="function"&&n0(et,p.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(R0){J1(p,p.return,R0)}}else ex(c,p,C,D);break;case 31:ex(c,p,C,D);break;case 13:ex(c,p,C,D);break;case 23:break;case 22:$=p.stateNode,et=p.alternate,p.memoizedState!==null?$._visibility&2?ex(c,p,C,D):lA(c,p):$._visibility&2?ex(c,p,C,D):($._visibility|=2,fS(c,p,C,D,(p.subtreeFlags&10256)!==0||!1)),G&2048&&XM(et,p);break;case 24:ex(c,p,C,D),G&2048&&YM(p.alternate,p);break;default:ex(c,p,C,D)}}function fS(c,p,C,D,G){for(G=G&&((p.subtreeFlags&10256)!==0||!1),p=p.child;p!==null;){var $=c,et=p,n0=C,R0=D,W0=et.flags;switch(et.tag){case 0:case 11:case 15:fS($,et,n0,R0,G),aA(8,et);break;case 23:break;case 22:var Q0=et.stateNode;et.memoizedState!==null?Q0._visibility&2?fS($,et,n0,R0,G):lA($,et):(Q0._visibility|=2,fS($,et,n0,R0,G)),G&&W0&2048&&XM(et.alternate,et);break;case 24:fS($,et,n0,R0,G),G&&W0&2048&&YM(et.alternate,et);break;default:fS($,et,n0,R0,G)}p=p.sibling}}function lA(c,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var C=c,D=p,G=D.flags;switch(D.tag){case 22:lA(C,D),G&2048&&XM(D.alternate,D);break;case 24:lA(C,D),G&2048&&YM(D.alternate,D);break;default:lA(C,D)}p=p.sibling}}var cA=8192;function pS(c,p,C){if(c.subtreeFlags&cA)for(c=c.child;c!==null;)tT(c,p,C),c=c.sibling}function tT(c,p,C){switch(c.tag){case 26:pS(c,p,C),c.flags&cA&&c.memoizedState!==null&&pR(C,Jv,c.memoizedState,c.memoizedProps);break;case 5:pS(c,p,C);break;case 3:case 4:var D=Jv;Jv=wE(c.stateNode.containerInfo),pS(c,p,C),Jv=D;break;case 22:c.memoizedState===null&&(D=c.alternate,D!==null&&D.memoizedState!==null?(D=cA,cA=16777216,pS(c,p,C),cA=D):pS(c,p,C));break;default:pS(c,p,C)}}function nT(c){var p=c.alternate;if(p!==null&&(c=p.child,c!==null)){p.child=null;do p=c.sibling,c.sibling=null,c=p;while(c!==null)}}function uA(c){var p=c.deletions;if((c.flags&16)!==0){if(p!==null)for(var C=0;C<p.length;C++){var D=p[C];iv=D,rT(D,c)}nT(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)iT(c),c=c.sibling}function iT(c){switch(c.tag){case 0:case 11:case 15:uA(c),c.flags&2048&&Jx(9,c,c.return);break;case 3:uA(c);break;case 12:uA(c);break;case 22:var p=c.stateNode;c.memoizedState!==null&&p._visibility&2&&(c.return===null||c.return.tag!==13)?(p._visibility&=-3,fE(c)):uA(c);break;default:uA(c)}}function fE(c){var p=c.deletions;if((c.flags&16)!==0){if(p!==null)for(var C=0;C<p.length;C++){var D=p[C];iv=D,rT(D,c)}nT(c)}for(c=c.child;c!==null;){switch(p=c,p.tag){case 0:case 11:case 15:Jx(8,p,p.return),fE(p);break;case 22:C=p.stateNode,C._visibility&2&&(C._visibility&=-3,fE(p));break;default:fE(p)}c=c.sibling}}function rT(c,p){for(;iv!==null;){var C=iv;switch(C.tag){case 0:case 11:case 15:Jx(8,C,p);break;case 23:case 22:if(C.memoizedState!==null&&C.memoizedState.cachePool!==null){var D=C.memoizedState.cachePool.pool;D!=null&&D.refCount++}break;case 24:Yx(C.memoizedState.cache)}if(D=C.child,D!==null)D.return=C,iv=D;else e:for(C=c;iv!==null;){D=iv;var G=D.sibling,$=D.return;if(YC(D),D===C){iv=null;break e}if(G!==null){G.return=$,iv=G;break e}iv=$}}}var R3={getCacheForType:function(c){var p=ev(F_),C=p.data.get(c);return C===void 0&&(C=c(),p.data.set(c,C)),C},cacheSignal:function(){return ev(F_).controller.signal}},D3=typeof WeakMap=="function"?WeakMap:Map,K1=0,L_=null,U1=null,H1=0,Q1=0,Iv=null,e2=!1,mS=!1,KM=!1,Nx=0,G_=0,t2=0,k2=0,qM=0,Bv=0,gS=0,hA=null,Dv=null,ZM=!1,pE=0,sT=0,mE=1/0,gE=null,n2=null,tv=0,i2=null,_S=null,zx=0,QM=0,JM=null,aT=null,dA=0,ew=null;function Nv(){return(K1&2)!==0&&H1!==0?H1&-H1:U.T!==null?aw():S0()}function oT(){if(Bv===0)if((H1&536870912)===0||F1){var c=oi;oi<<=1,(oi&3932160)===0&&(oi=262144),Bv=c}else Bv=536870912;return c=Pv.current,c!==null&&(c.flags|=32),Bv}function Lv(c,p,C){(c===L_&&(Q1===2||Q1===9)||c.cancelPendingCommit!==null)&&(vS(c,0),r2(c,H1,Bv,!1)),q(c,C),((K1&2)===0||c!==L_)&&(c===L_&&((K1&2)===0&&(k2|=C),G_===4&&r2(c,H1,Bv,!1)),hx(c))}function lT(c,p,C){if((K1&6)!==0)throw Error(n(327));var D=!C&&(p&127)===0&&(p&c.expiredLanes)===0||a0(c,p),G=D?O3(c,p):nw(c,p,!0),$=D;do{if(G===0){mS&&!D&&r2(c,p,0,!1);break}else{if(C=c.current.alternate,$&&!L3(C)){G=nw(c,p,!1),$=!1;continue}if(G===2){if($=p,c.errorRecoveryDisabledLanes&$)var et=0;else et=c.pendingLanes&-536870913,et=et!==0?et:et&536870912?536870912:0;if(et!==0){p=et;e:{var n0=c;G=hA;var R0=n0.current.memoizedState.isDehydrated;if(R0&&(vS(n0,et).flags|=256),et=nw(n0,et,!1),et!==2){if(KM&&!R0){n0.errorRecoveryDisabledLanes|=$,k2|=$,G=4;break e}$=Dv,Dv=G,$!==null&&(Dv===null?Dv=$:Dv.push.apply(Dv,$))}G=et}if($=!1,G!==2)continue}}if(G===1){vS(c,0),r2(c,p,0,!0);break}e:{switch(D=c,$=G,$){case 0:case 1:throw Error(n(345));case 4:if((p&4194048)!==p)break;case 6:r2(D,p,Bv,!e2);break e;case 2:Dv=null;break;case 3:case 5:break;default:throw Error(n(329))}if((p&62914560)===p&&(G=pE+300-We(),10<G)){if(r2(D,p,Bv,!e2),e0(D,0,!0)!==0)break e;zx=p,D.timeoutHandle=UT(cT.bind(null,D,C,Dv,gE,ZM,p,Bv,k2,gS,e2,$,"Throttled",-0,0),G);break e}cT(D,C,Dv,gE,ZM,p,Bv,k2,gS,e2,$,null,-0,0)}}break}while(!0);hx(c)}function cT(c,p,C,D,G,$,et,n0,R0,W0,Q0,t1,Y0,q0){if(c.timeoutHandle=-1,t1=p.subtreeFlags,t1&8192||(t1&16785408)===16785408){t1={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Q_},tT(p,$,t1);var _1=($&62914560)===$?pE-We():($&4194048)===$?sT-We():0;if(_1=mR(t1,_1),_1!==null){zx=$,c.cancelPendingCommit=_1(_T.bind(null,c,p,$,C,D,G,et,n0,R0,Q0,t1,null,Y0,q0)),r2(c,$,et,!W0);return}}_T(c,p,$,C,D,G,et,n0,R0)}function L3(c){for(var p=c;;){var C=p.tag;if((C===0||C===11||C===15)&&p.flags&16384&&(C=p.updateQueue,C!==null&&(C=C.stores,C!==null)))for(var D=0;D<C.length;D++){var G=C[D],$=G.getSnapshot;G=G.value;try{if(!I_($(),G))return!1}catch{return!1}}if(C=p.child,p.subtreeFlags&16384&&C!==null)C.return=p,p=C;else{if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function r2(c,p,C,D){p&=~qM,p&=~k2,c.suspendedLanes|=p,c.pingedLanes&=~p,D&&(c.warmLanes|=p),D=c.expirationTimes;for(var G=p;0<G;){var $=31-v0(G),et=1<<$;D[$]=-1,G&=~et}C!==0&&at(c,C,p)}function _E(){return(K1&6)===0?(fA(0),!1):!0}function tw(){if(U1!==null){if(Q1===0)var c=U1.return;else c=U1,vv=Ax=null,_M(c),s1=null,S1=0,c=U1;for(;c!==null;)kC(c.alternate,c),c=c.return;U1=null}}function vS(c,p){var C=c.timeoutHandle;C!==-1&&(c.timeoutHandle=-1,Z3(C)),C=c.cancelPendingCommit,C!==null&&(c.cancelPendingCommit=null,C()),zx=0,tw(),L_=c,U1=C=Xv(c.current,null),H1=p,Q1=0,Iv=null,e2=!1,mS=a0(c,p),KM=!1,gS=Bv=qM=k2=t2=G_=0,Dv=hA=null,ZM=!1,(p&8)!==0&&(p|=p&32);var D=c.entangledLanes;if(D!==0)for(c=c.entanglements,D&=p;0<D;){var G=31-v0(D),$=1<<G;p|=c[G],D&=~$}return Nx=p,R2(),C}function uT(c,p){P1=null,U.H=iA,p===r0||p===m0?(p=W1(),Q1=3):p===x0?(p=W1(),Q1=4):Q1=p===OM?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,Iv=p,U1===null&&(G_=1,aE(c,dv(p,c.current)))}function hT(){var c=Pv.current;return c===null?!0:(H1&4194048)===H1?Vv===null:(H1&62914560)===H1||(H1&536870912)!==0?c===Vv:!1}function dT(){var c=U.H;return U.H=iA,c===null?iA:c}function fT(){var c=U.A;return U.A=R3,c}function vE(){G_=4,e2||(H1&4194048)!==H1&&Pv.current!==null||(mS=!0),(t2&134217727)===0&&(k2&134217727)===0||L_===null||r2(L_,H1,Bv,!1)}function nw(c,p,C){var D=K1;K1|=2;var G=dT(),$=fT();(L_!==c||H1!==p)&&(gE=null,vS(c,p)),p=!1;var et=G_;e:do try{if(Q1!==0&&U1!==null){var n0=U1,R0=Iv;switch(Q1){case 8:tw(),et=6;break e;case 3:case 2:case 9:case 6:Pv.current===null&&(p=!0);var W0=Q1;if(Q1=0,Iv=null,xS(c,n0,R0,W0),C&&mS){et=0;break e}break;default:W0=Q1,Q1=0,Iv=null,xS(c,n0,R0,W0)}}P3(),et=G_;break}catch(Q0){uT(c,Q0)}while(!0);return p&&c.shellSuspendCounter++,vv=Ax=null,K1=D,U.H=G,U.A=$,U1===null&&(L_=null,H1=0,R2()),et}function P3(){for(;U1!==null;)pT(U1)}function O3(c,p){var C=K1;K1|=2;var D=dT(),G=fT();L_!==c||H1!==p?(gE=null,mE=We()+500,vS(c,p)):mS=a0(c,p);e:do try{if(Q1!==0&&U1!==null){p=U1;var $=Iv;t:switch(Q1){case 1:Q1=0,Iv=null,xS(c,p,$,1);break;case 2:case 9:if(U0($)){Q1=0,Iv=null,mT(p);break}p=function(){Q1!==2&&Q1!==9||L_!==c||(Q1=7),hx(c)},$.then(p,p);break e;case 3:Q1=7;break e;case 4:Q1=5;break e;case 7:U0($)?(Q1=0,Iv=null,mT(p)):(Q1=0,Iv=null,xS(c,p,$,7));break;case 5:var et=null;switch(U1.tag){case 26:et=U1.memoizedState;case 5:case 27:var n0=U1;if(et?e3(et):n0.stateNode.complete){Q1=0,Iv=null;var R0=n0.sibling;if(R0!==null)U1=R0;else{var W0=n0.return;W0!==null?(U1=W0,xE(W0)):U1=null}break t}}Q1=0,Iv=null,xS(c,p,$,5);break;case 6:Q1=0,Iv=null,xS(c,p,$,6);break;case 8:tw(),G_=6;break e;default:throw Error(n(462))}}I3();break}catch(Q0){uT(c,Q0)}while(!0);return vv=Ax=null,U.H=D,U.A=G,K1=C,U1!==null?0:(L_=null,H1=0,R2(),G_)}function I3(){for(;U1!==null&&!T0();)pT(U1)}function pT(c){var p=FC(c.alternate,c,Nx);c.memoizedProps=c.pendingProps,p===null?xE(c):U1=p}function mT(c){var p=c,C=p.alternate;switch(p.tag){case 15:case 0:p=PC(C,p,p.pendingProps,p.type,void 0,H1);break;case 11:p=PC(C,p,p.pendingProps,p.type.render,p.ref,H1);break;case 5:_M(p);default:kC(C,p),p=U1=sx(p,Nx),p=FC(C,p,Nx)}c.memoizedProps=c.pendingProps,p===null?xE(c):U1=p}function xS(c,p,C,D){vv=Ax=null,_M(p),s1=null,S1=0;var G=p.return;try{if(S3(c,G,p,C,H1)){G_=1,aE(c,dv(C,c.current)),U1=null;return}}catch($){if(G!==null)throw U1=G,$;G_=1,aE(c,dv(C,c.current)),U1=null;return}p.flags&32768?(F1||D===1?c=!0:mS||(H1&536870912)!==0?c=!1:(e2=c=!0,(D===2||D===9||D===3||D===6)&&(D=Pv.current,D!==null&&D.tag===13&&(D.flags|=16384))),gT(p,c)):xE(p)}function xE(c){var p=c;do{if((p.flags&32768)!==0){gT(p,e2);return}c=p.return;var C=M3(p.alternate,p,Nx);if(C!==null){U1=C;return}if(p=p.sibling,p!==null){U1=p;return}U1=p=c}while(p!==null);G_===0&&(G_=5)}function gT(c,p){do{var C=w3(c.alternate,c);if(C!==null){C.flags&=32767,U1=C;return}if(C=c.return,C!==null&&(C.flags|=32768,C.subtreeFlags=0,C.deletions=null),!p&&(c=c.sibling,c!==null)){U1=c;return}U1=c=C}while(c!==null);G_=6,U1=null}function _T(c,p,C,D,G,$,et,n0,R0){c.cancelPendingCommit=null;do yE();while(tv!==0);if((K1&6)!==0)throw Error(n(327));if(p!==null){if(p===c.current)throw Error(n(177));if($=p.lanes|p.childLanes,$|=T2,it(c,C,$,et,n0,R0),c===L_&&(U1=L_=null,H1=0),_S=p,i2=c,zx=C,QM=$,JM=G,aT=D,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,F3(tt,function(){return ST(),null})):(c.callbackNode=null,c.callbackPriority=0),D=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||D){D=U.T,U.T=null,G=F.p,F.p=2,et=K1,K1|=4;try{C3(c,p,C)}finally{K1=et,F.p=G,U.T=D}}tv=1,vT(),xT(),yT()}}function vT(){if(tv===1){tv=0;var c=i2,p=_S,C=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||C){C=U.T,U.T=null;var D=F.p;F.p=2;var G=K1;K1|=4;try{QC(p,c);var $=pw,et=E2(c.containerInfo),n0=$.focusedElem,R0=$.selectionRange;if(et!==n0&&n0&&n0.ownerDocument&&FS(n0.ownerDocument.documentElement,n0)){if(R0!==null&&Z2(n0)){var W0=R0.start,Q0=R0.end;if(Q0===void 0&&(Q0=W0),"selectionStart"in n0)n0.selectionStart=W0,n0.selectionEnd=Math.min(Q0,n0.value.length);else{var t1=n0.ownerDocument||document,Y0=t1&&t1.defaultView||window;if(Y0.getSelection){var q0=Y0.getSelection(),_1=n0.textContent.length,w1=Math.min(R0.start,_1),T_=R0.end===void 0?w1:Math.min(R0.end,_1);!q0.extend&&w1>T_&&(et=T_,T_=w1,w1=et);var G0=FA(n0,w1),N0=FA(n0,T_);if(G0&&N0&&(q0.rangeCount!==1||q0.anchorNode!==G0.node||q0.anchorOffset!==G0.offset||q0.focusNode!==N0.node||q0.focusOffset!==N0.offset)){var H0=t1.createRange();H0.setStart(G0.node,G0.offset),q0.removeAllRanges(),w1>T_?(q0.addRange(H0),q0.extend(N0.node,N0.offset)):(H0.setEnd(N0.node,N0.offset),q0.addRange(H0))}}}}for(t1=[],q0=n0;q0=q0.parentNode;)q0.nodeType===1&&t1.push({element:q0,left:q0.scrollLeft,top:q0.scrollTop});for(typeof n0.focus=="function"&&n0.focus(),n0=0;n0<t1.length;n0++){var e1=t1[n0];e1.element.scrollLeft=e1.left,e1.element.scrollTop=e1.top}}PE=!!fw,pw=fw=null}finally{K1=G,F.p=D,U.T=C}}c.current=p,tv=2}}function xT(){if(tv===2){tv=0;var c=i2,p=_S,C=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||C){C=U.T,U.T=null;var D=F.p;F.p=2;var G=K1;K1|=4;try{XC(c,p.alternate,p)}finally{K1=G,F.p=D,U.T=C}}tv=3}}function yT(){if(tv===4||tv===3){tv=0,ht();var c=i2,p=_S,C=zx,D=aT;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?tv=5:(tv=0,_S=i2=null,bT(c,c.pendingLanes));var G=c.pendingLanes;if(G===0&&(n2=null),_0(C),p=p.stateNode,Fe&&typeof Fe.onCommitFiberRoot=="function")try{Fe.onCommitFiberRoot(P0,p,void 0,(p.current.flags&128)===128)}catch{}if(D!==null){p=U.T,G=F.p,F.p=2,U.T=null;try{for(var $=c.onRecoverableError,et=0;et<D.length;et++){var n0=D[et];$(n0.value,{componentStack:n0.stack})}}finally{U.T=p,F.p=G}}(zx&3)!==0&&yE(),hx(c),G=c.pendingLanes,(C&261930)!==0&&(G&42)!==0?c===ew?dA++:(dA=0,ew=c):dA=0,fA(0)}}function bT(c,p){(c.pooledCacheLanes&=p)===0&&(p=c.pooledCache,p!=null&&(c.pooledCache=null,Yx(p)))}function yE(){return vT(),xT(),yT(),ST()}function ST(){if(tv!==5)return!1;var c=i2,p=QM;QM=0;var C=_0(zx),D=U.T,G=F.p;try{F.p=32>C?32:C,U.T=null,C=JM,JM=null;var $=i2,et=zx;if(tv=0,_S=i2=null,zx=0,(K1&6)!==0)throw Error(n(331));var n0=K1;if(K1|=4,iT($.current),eT($,$.current,et,C),K1=n0,fA(0,!1),Fe&&typeof Fe.onPostCommitFiberRoot=="function")try{Fe.onPostCommitFiberRoot(P0,$)}catch{}return!0}finally{F.p=G,U.T=D,bT(c,p)}}function AT(c,p,C){p=dv(C,p),p=PM(c.stateNode,p,2),c=L1(c,p,2),c!==null&&(q(c,2),hx(c))}function J1(c,p,C){if(c.tag===3)AT(c,c,C);else for(;p!==null;){if(p.tag===3){AT(p,c,C);break}else if(p.tag===1){var D=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(n2===null||!n2.has(D))){c=dv(C,c),C=EC(2),D=L1(p,C,2),D!==null&&(MC(C,D,p,c),q(D,2),hx(D));break}}p=p.return}}function iw(c,p,C){var D=c.pingCache;if(D===null){D=c.pingCache=new D3;var G=new Set;D.set(p,G)}else G=D.get(p),G===void 0&&(G=new Set,D.set(p,G));G.has(C)||(KM=!0,G.add(C),c=B3.bind(null,c,p,C),p.then(c,c))}function B3(c,p,C){var D=c.pingCache;D!==null&&D.delete(p),c.pingedLanes|=c.suspendedLanes&C,c.warmLanes&=~C,L_===c&&(H1&C)===C&&(G_===4||G_===3&&(H1&62914560)===H1&&300>We()-pE?(K1&2)===0&&vS(c,0):qM|=C,gS===H1&&(gS=0)),hx(c)}function ET(c,p){p===0&&(p=p0()),c=rx(c,p),c!==null&&(q(c,p),hx(c))}function N3(c){var p=c.memoizedState,C=0;p!==null&&(C=p.retryLane),ET(c,C)}function z3(c,p){var C=0;switch(c.tag){case 31:case 13:var D=c.stateNode,G=c.memoizedState;G!==null&&(C=G.retryLane);break;case 19:D=c.stateNode;break;case 22:D=c.stateNode._retryCache;break;default:throw Error(n(314))}D!==null&&D.delete(p),ET(c,C)}function F3(c,p){return w0(c,p)}var bE=null,yS=null,rw=!1,SE=!1,sw=!1,s2=0;function hx(c){c!==yS&&c.next===null&&(yS===null?bE=yS=c:yS=yS.next=c),SE=!0,rw||(rw=!0,k3())}function fA(c,p){if(!sw&&SE){sw=!0;do for(var C=!1,D=bE;D!==null;){if(c!==0){var G=D.pendingLanes;if(G===0)var $=0;else{var et=D.suspendedLanes,n0=D.pingedLanes;$=(1<<31-v0(42|c)+1)-1,$&=G&~(et&~n0),$=$&201326741?$&201326741|1:$?$|2:0}$!==0&&(C=!0,TT(D,$))}else $=H1,$=e0(D,D===L_?$:0,D.cancelPendingCommit!==null||D.timeoutHandle!==-1),($&3)===0||a0(D,$)||(C=!0,TT(D,$));D=D.next}while(C);sw=!1}}function U3(){MT()}function MT(){SE=rw=!1;var c=0;s2!==0&&q3()&&(c=s2);for(var p=We(),C=null,D=bE;D!==null;){var G=D.next,$=wT(D,p);$===0?(D.next=null,C===null?bE=G:C.next=G,G===null&&(yS=C)):(C=D,(c!==0||($&3)!==0)&&(SE=!0)),D=G}tv!==0&&tv!==5||fA(c),s2!==0&&(s2=0)}function wT(c,p){for(var C=c.suspendedLanes,D=c.pingedLanes,G=c.expirationTimes,$=c.pendingLanes&-62914561;0<$;){var et=31-v0($),n0=1<<et,R0=G[et];R0===-1?((n0&C)===0||(n0&D)!==0)&&(G[et]=hi(n0,p)):R0<=p&&(c.expiredLanes|=n0),$&=~n0}if(p=L_,C=H1,C=e0(c,c===p?C:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),D=c.callbackNode,C===0||c===p&&(Q1===2||Q1===9)||c.cancelPendingCommit!==null)return D!==null&&D!==null&&L0(D),c.callbackNode=null,c.callbackPriority=0;if((C&3)===0||a0(c,C)){if(p=C&-C,p===c.callbackPriority)return p;switch(D!==null&&L0(D),_0(C)){case 2:case 8:C=Z;break;case 32:C=tt;break;case 268435456:C=s0;break;default:C=tt}return D=CT.bind(null,c),C=w0(C,D),c.callbackPriority=p,c.callbackNode=C,p}return D!==null&&D!==null&&L0(D),c.callbackPriority=2,c.callbackNode=null,2}function CT(c,p){if(tv!==0&&tv!==5)return c.callbackNode=null,c.callbackPriority=0,null;var C=c.callbackNode;if(yE()&&c.callbackNode!==C)return null;var D=H1;return D=e0(c,c===L_?D:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),D===0?null:(lT(c,D,p),wT(c,We()),c.callbackNode!=null&&c.callbackNode===C?CT.bind(null,c):null)}function TT(c,p){if(yE())return null;lT(c,p,!0)}function k3(){Q3(function(){(K1&6)!==0?w0(M0,U3):MT()})}function aw(){if(s2===0){var c=Mx;c===0&&(c=lt,lt<<=1,(lt&261888)===0&&(lt=256)),s2=c}return s2}function RT(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:H_(""+c)}function DT(c,p){var C=p.ownerDocument.createElement("input");return C.name=p.name,C.value=p.value,c.id&&C.setAttribute("form",c.id),p.parentNode.insertBefore(C,p),c=new FormData(c),C.parentNode.removeChild(C),c}function G3(c,p,C,D,G){if(p==="submit"&&C&&C.stateNode===G){var $=RT((G[c1]||null).action),et=D.submitter;et&&(p=(p=et[c1]||null)?RT(p.formAction):et.getAttribute("formAction"),p!==null&&($=p,et=null));var n0=new H2("action","action",null,D,G);c.push({event:n0,listeners:[{instance:null,listener:function(){if(D.defaultPrevented){if(s2!==0){var R0=et?DT(G,et):new FormData(G);wM(C,{pending:!0,data:R0,method:G.method,action:$},null,R0)}}else typeof $=="function"&&(n0.preventDefault(),R0=et?DT(G,et):new FormData(G),wM(C,{pending:!0,data:R0,method:G.method,action:$},$,R0))},currentTarget:G}]})}}for(var ow=0;ow<tS.length;ow++){var lw=tS[ow],V3=lw.toLowerCase(),H3=lw[0].toUpperCase()+lw.slice(1);Av(V3,"on"+H3)}Av(kS,"onAnimationEnd"),Av(eS,"onAnimationIteration"),Av(GS,"onAnimationStart"),Av("dblclick","onDoubleClick"),Av("focusin","onFocus"),Av("focusout","onBlur"),Av(kA,"onTransitionRun"),Av(GA,"onTransitionStart"),Av(VA,"onTransitionCancel"),Av(M2,"onTransitionEnd"),p1("onMouseEnter",["mouseout","mouseover"]),p1("onMouseLeave",["mouseout","mouseover"]),p1("onPointerEnter",["pointerout","pointerover"]),p1("onPointerLeave",["pointerout","pointerover"]),v1("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),v1("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),v1("onBeforeInput",["compositionend","keypress","textInput","paste"]),v1("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),v1("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),v1("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pA="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),j3=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(pA));function LT(c,p){p=(p&4)!==0;for(var C=0;C<c.length;C++){var D=c[C],G=D.event;D=D.listeners;e:{var $=void 0;if(p)for(var et=D.length-1;0<=et;et--){var n0=D[et],R0=n0.instance,W0=n0.currentTarget;if(n0=n0.listener,R0!==$&&G.isPropagationStopped())break e;$=n0,G.currentTarget=W0;try{$(G)}catch(Q0){C2(Q0)}G.currentTarget=null,$=R0}else for(et=0;et<D.length;et++){if(n0=D[et],R0=n0.instance,W0=n0.currentTarget,n0=n0.listener,R0!==$&&G.isPropagationStopped())break e;$=n0,G.currentTarget=W0;try{$(G)}catch(Q0){C2(Q0)}G.currentTarget=null,$=R0}}}}function k1(c,p){var C=p[Z0];C===void 0&&(C=p[Z0]=new Set);var D=c+"__bubble";C.has(D)||(PT(p,c,2,!1),C.add(D))}function cw(c,p,C){var D=0;p&&(D|=4),PT(C,c,D,p)}var AE="_reactListening"+Math.random().toString(36).slice(2);function uw(c){if(!c[AE]){c[AE]=!0,r1.forEach(function(C){C!=="selectionchange"&&(j3.has(C)||cw(C,!1,c),cw(C,!0,c))});var p=c.nodeType===9?c:c.ownerDocument;p===null||p[AE]||(p[AE]=!0,cw("selectionchange",!1,p))}}function PT(c,p,C,D){switch(o3(p)){case 2:var G=vR;break;case 8:G=xR;break;default:G=Mw}C=G.bind(null,p,C,c),G=void 0,!wS||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(G=!0),D?G!==void 0?c.addEventListener(p,C,{capture:!0,passive:G}):c.addEventListener(p,C,!0):G!==void 0?c.addEventListener(p,C,{passive:G}):c.addEventListener(p,C,!1)}function hw(c,p,C,D,G){var $=D;if((p&1)===0&&(p&2)===0&&D!==null)e:for(;;){if(D===null)return;var et=D.tag;if(et===3||et===4){var n0=D.stateNode.containerInfo;if(n0===G)break;if(et===4)for(et=D.return;et!==null;){var R0=et.tag;if((R0===3||R0===4)&&et.stateNode.containerInfo===G)return;et=et.return}for(;n0!==null;){if(et=i1(n0),et===null)return;if(R0=et.tag,R0===5||R0===6||R0===26||R0===27){D=$=et;continue e}n0=n0.parentNode}}D=D.return}AA(function(){var W0=$,Q0=bv(C),t1=[];e:{var Y0=w2.get(c);if(Y0!==void 0){var q0=H2,_1=c;switch(c){case"keypress":if(p2(C)===0)break e;case"keydown":case"keyup":q0=XE;break;case"focusin":_1="focus",q0=RS;break;case"focusout":_1="blur",q0=RS;break;case"beforeblur":case"afterblur":q0=RS;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":q0=wA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":q0=_2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":q0=X2;break;case kS:case eS:case GS:q0=W2;break;case M2:q0=ZE;break;case"scroll":case"scrollend":q0=UE;break;case"wheel":q0=JE;break;case"copy":case"cut":case"paste":q0=v2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":q0=DA;break;case"toggle":case"beforetoggle":q0=DS}var w1=(p&4)!==0,T_=!w1&&(c==="scroll"||c==="scrollend"),G0=w1?Y0!==null?Y0+"Capture":null:Y0;w1=[];for(var N0=W0,H0;N0!==null;){var e1=N0;if(H0=e1.stateNode,e1=e1.tag,e1!==5&&e1!==26&&e1!==27||H0===null||G0===null||(e1=uv(N0,G0),e1!=null&&w1.push(mA(N0,e1,H0))),T_)break;N0=N0.return}0<w1.length&&(Y0=new q0(Y0,_1,null,C,Q0),t1.push({event:Y0,listeners:w1}))}}if((p&7)===0){e:{if(Y0=c==="mouseover"||c==="pointerover",q0=c==="mouseout"||c==="pointerout",Y0&&C!==tx&&(_1=C.relatedTarget||C.fromElement)&&(i1(_1)||_1[J0]))break e;if((q0||Y0)&&(Y0=Q0.window===Q0?Q0:(Y0=Q0.ownerDocument)?Y0.defaultView||Y0.parentWindow:window,q0?(_1=C.relatedTarget||C.toElement,q0=W0,_1=_1?i1(_1):null,_1!==null&&(T_=s(_1),w1=_1.tag,_1!==T_||w1!==5&&w1!==27&&w1!==6)&&(_1=null)):(q0=null,_1=W0),q0!==_1)){if(w1=wA,e1="onMouseLeave",G0="onMouseEnter",N0="mouse",(c==="pointerout"||c==="pointerover")&&(w1=DA,e1="onPointerLeave",G0="onPointerEnter",N0="pointer"),T_=q0==null?Y0:f1(q0),H0=_1==null?Y0:f1(_1),Y0=new w1(e1,N0+"leave",q0,C,Q0),Y0.target=T_,Y0.relatedTarget=H0,e1=null,i1(Q0)===W0&&(w1=new w1(G0,N0+"enter",_1,C,Q0),w1.target=H0,w1.relatedTarget=T_,e1=w1),T_=e1,q0&&_1)t:{for(w1=W3,G0=q0,N0=_1,H0=0,e1=G0;e1;e1=w1(e1))H0++;e1=0;for(var A1=N0;A1;A1=w1(A1))e1++;for(;0<H0-e1;)G0=w1(G0),H0--;for(;0<e1-H0;)N0=w1(N0),e1--;for(;H0--;){if(G0===N0||N0!==null&&G0===N0.alternate){w1=G0;break t}G0=w1(G0),N0=w1(N0)}w1=null}else w1=null;q0!==null&&OT(t1,Y0,q0,w1,!1),_1!==null&&T_!==null&&OT(t1,T_,_1,w1,!0)}}e:{if(Y0=W0?f1(W0):window,q0=Y0.nodeName&&Y0.nodeName.toLowerCase(),q0==="select"||q0==="input"&&Y0.type==="file")var X1=zA;else if(PS(Y0))if(iM)X1=sM;else{X1=q2;var x1=rM}else q0=Y0.nodeName,!q0||q0.toLowerCase()!=="input"||Y0.type!=="checkbox"&&Y0.type!=="radio"?W0&&O_(W0.elementType)&&(X1=zA):X1=xx;if(X1&&(X1=X1(c,W0))){Y2(t1,X1,C,Q0);break e}x1&&x1(c,Y0,W0),c==="focusout"&&W0&&Y0.type==="number"&&W0.memoizedProps.value!=null&&lv(Y0,"number",Y0.value)}switch(x1=W0?f1(W0):window,c){case"focusin":(PS(x1)||x1.contentEditable==="true")&&(yx=x1,Q2=W0,Hx=null);break;case"focusout":Hx=Q2=yx=null;break;case"mousedown":J2=!0;break;case"contextmenu":case"mouseup":case"dragend":J2=!1,US(t1,C,Q0);break;case"selectionchange":if(UA)break;case"keydown":case"keyup":US(t1,C,Q0)}var O1;if(LS)e:{switch(c){case"compositionstart":var j1="onCompositionStart";break e;case"compositionend":j1="onCompositionEnd";break e;case"compositionupdate":j1="onCompositionUpdate";break e}j1=void 0}else Ux?S2(c,C)&&(j1="onCompositionEnd"):c==="keydown"&&C.keyCode===229&&(j1="onCompositionStart");j1&&(LA&&C.locale!=="ko"&&(Ux||j1!=="onCompositionStart"?j1==="onCompositionEnd"&&Ux&&(O1=EA()):(Sv=Q0,G2="value"in Sv?Sv.value:Sv.textContent,Ux=!0)),x1=EE(W0,j1),0<x1.length&&(j1=new TA(j1,c,null,C,Q0),t1.push({event:j1,listeners:x1}),O1?j1.data=O1:(O1=IA(C),O1!==null&&(j1.data=O1)))),(O1=tM?kx(c,C):BA(c,C))&&(j1=EE(W0,"onBeforeInput"),0<j1.length&&(x1=new TA("onBeforeInput","beforeinput",null,C,Q0),t1.push({event:x1,listeners:j1}),x1.data=O1)),G3(t1,c,W0,C,Q0)}LT(t1,p)})}function mA(c,p,C){return{instance:c,listener:p,currentTarget:C}}function EE(c,p){for(var C=p+"Capture",D=[];c!==null;){var G=c,$=G.stateNode;if(G=G.tag,G!==5&&G!==26&&G!==27||$===null||(G=uv(c,C),G!=null&&D.unshift(mA(c,G,$)),G=uv(c,p),G!=null&&D.push(mA(c,G,$))),c.tag===3)return D;c=c.return}return[]}function W3(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function OT(c,p,C,D,G){for(var $=p._reactName,et=[];C!==null&&C!==D;){var n0=C,R0=n0.alternate,W0=n0.stateNode;if(n0=n0.tag,R0!==null&&R0===D)break;n0!==5&&n0!==26&&n0!==27||W0===null||(R0=W0,G?(W0=uv(C,$),W0!=null&&et.unshift(mA(C,W0,R0))):G||(W0=uv(C,$),W0!=null&&et.push(mA(C,W0,R0)))),C=C.return}et.length!==0&&c.push({event:p,listeners:et})}var $3=/\r\n?/g,X3=/\u0000|\uFFFD/g;function IT(c){return(typeof c=="string"?c:""+c).replace($3,`
`).replace(X3,"")}function BT(c,p){return p=IT(p),IT(c)===p}function C_(c,p,C,D,G,$){switch(C){case"children":typeof D=="string"?p==="body"||p==="textarea"&&D===""||V_(c,D):(typeof D=="number"||typeof D=="bigint")&&p!=="body"&&V_(c,""+D);break;case"className":C1(c,"class",D);break;case"tabIndex":C1(c,"tabindex",D);break;case"dir":case"role":case"viewBox":case"width":case"height":C1(c,C,D);break;case"style":rv(c,D,$);break;case"data":if(p!=="object"){C1(c,"data",D);break}case"src":case"href":if(D===""&&(p!=="a"||C!=="href")){c.removeAttribute(C);break}if(D==null||typeof D=="function"||typeof D=="symbol"||typeof D=="boolean"){c.removeAttribute(C);break}D=H_(""+D),c.setAttribute(C,D);break;case"action":case"formAction":if(typeof D=="function"){c.setAttribute(C,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof $=="function"&&(C==="formAction"?(p!=="input"&&C_(c,p,"name",G.name,G,null),C_(c,p,"formEncType",G.formEncType,G,null),C_(c,p,"formMethod",G.formMethod,G,null),C_(c,p,"formTarget",G.formTarget,G,null)):(C_(c,p,"encType",G.encType,G,null),C_(c,p,"method",G.method,G,null),C_(c,p,"target",G.target,G,null)));if(D==null||typeof D=="symbol"||typeof D=="boolean"){c.removeAttribute(C);break}D=H_(""+D),c.setAttribute(C,D);break;case"onClick":D!=null&&(c.onclick=Q_);break;case"onScroll":D!=null&&k1("scroll",c);break;case"onScrollEnd":D!=null&&k1("scrollend",c);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(n(61));if(C=D.__html,C!=null){if(G.children!=null)throw Error(n(60));c.innerHTML=C}}break;case"multiple":c.multiple=D&&typeof D!="function"&&typeof D!="symbol";break;case"muted":c.muted=D&&typeof D!="function"&&typeof D!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(D==null||typeof D=="function"||typeof D=="boolean"||typeof D=="symbol"){c.removeAttribute("xlink:href");break}C=H_(""+D),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",C);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":D!=null&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(C,""+D):c.removeAttribute(C);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":D&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(C,""):c.removeAttribute(C);break;case"capture":case"download":D===!0?c.setAttribute(C,""):D!==!1&&D!=null&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(C,D):c.removeAttribute(C);break;case"cols":case"rows":case"size":case"span":D!=null&&typeof D!="function"&&typeof D!="symbol"&&!isNaN(D)&&1<=D?c.setAttribute(C,D):c.removeAttribute(C);break;case"rowSpan":case"start":D==null||typeof D=="function"||typeof D=="symbol"||isNaN(D)?c.removeAttribute(C):c.setAttribute(C,D);break;case"popover":k1("beforetoggle",c),k1("toggle",c),y1(c,"popover",D);break;case"xlinkActuate":q1(c,"http://www.w3.org/1999/xlink","xlink:actuate",D);break;case"xlinkArcrole":q1(c,"http://www.w3.org/1999/xlink","xlink:arcrole",D);break;case"xlinkRole":q1(c,"http://www.w3.org/1999/xlink","xlink:role",D);break;case"xlinkShow":q1(c,"http://www.w3.org/1999/xlink","xlink:show",D);break;case"xlinkTitle":q1(c,"http://www.w3.org/1999/xlink","xlink:title",D);break;case"xlinkType":q1(c,"http://www.w3.org/1999/xlink","xlink:type",D);break;case"xmlBase":q1(c,"http://www.w3.org/XML/1998/namespace","xml:base",D);break;case"xmlLang":q1(c,"http://www.w3.org/XML/1998/namespace","xml:lang",D);break;case"xmlSpace":q1(c,"http://www.w3.org/XML/1998/namespace","xml:space",D);break;case"is":y1(c,"is",D);break;case"innerText":case"textContent":break;default:(!(2<C.length)||C[0]!=="o"&&C[0]!=="O"||C[1]!=="n"&&C[1]!=="N")&&(C=X_.get(C)||C,y1(c,C,D))}}function dw(c,p,C,D,G,$){switch(C){case"style":rv(c,D,$);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(n(61));if(C=D.__html,C!=null){if(G.children!=null)throw Error(n(60));c.innerHTML=C}}break;case"children":typeof D=="string"?V_(c,D):(typeof D=="number"||typeof D=="bigint")&&V_(c,""+D);break;case"onScroll":D!=null&&k1("scroll",c);break;case"onScrollEnd":D!=null&&k1("scrollend",c);break;case"onClick":D!=null&&(c.onclick=Q_);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!l1.hasOwnProperty(C))e:{if(C[0]==="o"&&C[1]==="n"&&(G=C.endsWith("Capture"),p=C.slice(2,G?C.length-7:void 0),$=c[c1]||null,$=$!=null?$[C]:null,typeof $=="function"&&c.removeEventListener(p,$,G),typeof D=="function")){typeof $!="function"&&$!==null&&(C in c?c[C]=null:c.hasAttribute(C)&&c.removeAttribute(C)),c.addEventListener(p,D,G);break e}C in c?c[C]=D:D===!0?c.setAttribute(C,""):y1(c,C,D)}}}function av(c,p,C){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":k1("error",c),k1("load",c);var D=!1,G=!1,$;for($ in C)if(C.hasOwnProperty($)){var et=C[$];if(et!=null)switch($){case"src":D=!0;break;case"srcSet":G=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:C_(c,p,$,et,C,null)}}G&&C_(c,p,"srcSet",C.srcSet,C,null),D&&C_(c,p,"src",C.src,C,null);return;case"input":k1("invalid",c);var n0=$=et=G=null,R0=null,W0=null;for(D in C)if(C.hasOwnProperty(D)){var Q0=C[D];if(Q0!=null)switch(D){case"name":G=Q0;break;case"type":et=Q0;break;case"checked":R0=Q0;break;case"defaultChecked":W0=Q0;break;case"value":$=Q0;break;case"defaultValue":n0=Q0;break;case"children":case"dangerouslySetInnerHTML":if(Q0!=null)throw Error(n(137,p));break;default:C_(c,p,D,Q0,C,null)}}Z_(c,$,n0,R0,W0,et,G,!1);return;case"select":k1("invalid",c),D=et=$=null;for(G in C)if(C.hasOwnProperty(G)&&(n0=C[G],n0!=null))switch(G){case"value":$=n0;break;case"defaultValue":et=n0;break;case"multiple":D=n0;default:C_(c,p,G,n0,C,null)}p=$,C=et,c.multiple=!!D,p!=null?yv(c,!!D,p,!1):C!=null&&yv(c,!!D,C,!0);return;case"textarea":k1("invalid",c),$=G=D=null;for(et in C)if(C.hasOwnProperty(et)&&(n0=C[et],n0!=null))switch(et){case"value":D=n0;break;case"defaultValue":G=n0;break;case"children":$=n0;break;case"dangerouslySetInnerHTML":if(n0!=null)throw Error(n(91));break;default:C_(c,p,et,n0,C,null)}Wv(c,D,G,$);return;case"option":for(R0 in C)if(C.hasOwnProperty(R0)&&(D=C[R0],D!=null))switch(R0){case"selected":c.selected=D&&typeof D!="function"&&typeof D!="symbol";break;default:C_(c,p,R0,D,C,null)}return;case"dialog":k1("beforetoggle",c),k1("toggle",c),k1("cancel",c),k1("close",c);break;case"iframe":case"object":k1("load",c);break;case"video":case"audio":for(D=0;D<pA.length;D++)k1(pA[D],c);break;case"image":k1("error",c),k1("load",c);break;case"details":k1("toggle",c);break;case"embed":case"source":case"link":k1("error",c),k1("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(W0 in C)if(C.hasOwnProperty(W0)&&(D=C[W0],D!=null))switch(W0){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:C_(c,p,W0,D,C,null)}return;default:if(O_(p)){for(Q0 in C)C.hasOwnProperty(Q0)&&(D=C[Q0],D!==void 0&&dw(c,p,Q0,D,C,void 0));return}}for(n0 in C)C.hasOwnProperty(n0)&&(D=C[n0],D!=null&&C_(c,p,n0,D,C,null))}function Y3(c,p,C,D){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var G=null,$=null,et=null,n0=null,R0=null,W0=null,Q0=null;for(q0 in C){var t1=C[q0];if(C.hasOwnProperty(q0)&&t1!=null)switch(q0){case"checked":break;case"value":break;case"defaultValue":R0=t1;default:D.hasOwnProperty(q0)||C_(c,p,q0,null,D,t1)}}for(var Y0 in D){var q0=D[Y0];if(t1=C[Y0],D.hasOwnProperty(Y0)&&(q0!=null||t1!=null))switch(Y0){case"type":$=q0;break;case"name":G=q0;break;case"checked":W0=q0;break;case"defaultChecked":Q0=q0;break;case"value":et=q0;break;case"defaultValue":n0=q0;break;case"children":case"dangerouslySetInnerHTML":if(q0!=null)throw Error(n(137,p));break;default:q0!==t1&&C_(c,p,Y0,q0,D,t1)}}pv(c,et,n0,R0,W0,Q0,$,G);return;case"select":q0=et=n0=Y0=null;for($ in C)if(R0=C[$],C.hasOwnProperty($)&&R0!=null)switch($){case"value":break;case"multiple":q0=R0;default:D.hasOwnProperty($)||C_(c,p,$,null,D,R0)}for(G in D)if($=D[G],R0=C[G],D.hasOwnProperty(G)&&($!=null||R0!=null))switch(G){case"value":Y0=$;break;case"defaultValue":n0=$;break;case"multiple":et=$;default:$!==R0&&C_(c,p,G,$,D,R0)}p=n0,C=et,D=q0,Y0!=null?yv(c,!!C,Y0,!1):!!D!=!!C&&(p!=null?yv(c,!!C,p,!0):yv(c,!!C,C?[]:"",!1));return;case"textarea":q0=Y0=null;for(n0 in C)if(G=C[n0],C.hasOwnProperty(n0)&&G!=null&&!D.hasOwnProperty(n0))switch(n0){case"value":break;case"children":break;default:C_(c,p,n0,null,D,G)}for(et in D)if(G=D[et],$=C[et],D.hasOwnProperty(et)&&(G!=null||$!=null))switch(et){case"value":Y0=G;break;case"defaultValue":q0=G;break;case"children":break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(n(91));break;default:G!==$&&C_(c,p,et,G,D,$)}cv(c,Y0,q0);return;case"option":for(var _1 in C)if(Y0=C[_1],C.hasOwnProperty(_1)&&Y0!=null&&!D.hasOwnProperty(_1))switch(_1){case"selected":c.selected=!1;break;default:C_(c,p,_1,null,D,Y0)}for(R0 in D)if(Y0=D[R0],q0=C[R0],D.hasOwnProperty(R0)&&Y0!==q0&&(Y0!=null||q0!=null))switch(R0){case"selected":c.selected=Y0&&typeof Y0!="function"&&typeof Y0!="symbol";break;default:C_(c,p,R0,Y0,D,q0)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var w1 in C)Y0=C[w1],C.hasOwnProperty(w1)&&Y0!=null&&!D.hasOwnProperty(w1)&&C_(c,p,w1,null,D,Y0);for(W0 in D)if(Y0=D[W0],q0=C[W0],D.hasOwnProperty(W0)&&Y0!==q0&&(Y0!=null||q0!=null))switch(W0){case"children":case"dangerouslySetInnerHTML":if(Y0!=null)throw Error(n(137,p));break;default:C_(c,p,W0,Y0,D,q0)}return;default:if(O_(p)){for(var T_ in C)Y0=C[T_],C.hasOwnProperty(T_)&&Y0!==void 0&&!D.hasOwnProperty(T_)&&dw(c,p,T_,void 0,D,Y0);for(Q0 in D)Y0=D[Q0],q0=C[Q0],!D.hasOwnProperty(Q0)||Y0===q0||Y0===void 0&&q0===void 0||dw(c,p,Q0,Y0,D,q0);return}}for(var G0 in C)Y0=C[G0],C.hasOwnProperty(G0)&&Y0!=null&&!D.hasOwnProperty(G0)&&C_(c,p,G0,null,D,Y0);for(t1 in D)Y0=D[t1],q0=C[t1],!D.hasOwnProperty(t1)||Y0===q0||Y0==null&&q0==null||C_(c,p,t1,Y0,D,q0)}function NT(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function K3(){if(typeof performance.getEntriesByType=="function"){for(var c=0,p=0,C=performance.getEntriesByType("resource"),D=0;D<C.length;D++){var G=C[D],$=G.transferSize,et=G.initiatorType,n0=G.duration;if($&&n0&&NT(et)){for(et=0,n0=G.responseEnd,D+=1;D<C.length;D++){var R0=C[D],W0=R0.startTime;if(W0>n0)break;var Q0=R0.transferSize,t1=R0.initiatorType;Q0&&NT(t1)&&(R0=R0.responseEnd,et+=Q0*(R0<n0?1:(n0-W0)/(R0-W0)))}if(--D,p+=8*($+et)/(G.duration/1e3),c++,10<c)break}}if(0<c)return p/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var fw=null,pw=null;function ME(c){return c.nodeType===9?c:c.ownerDocument}function zT(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function FT(c,p){if(c===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&p==="foreignObject"?0:c}function mw(c,p){return c==="textarea"||c==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var gw=null;function q3(){var c=window.event;return c&&c.type==="popstate"?c===gw?!1:(gw=c,!0):(gw=null,!1)}var UT=typeof setTimeout=="function"?setTimeout:void 0,Z3=typeof clearTimeout=="function"?clearTimeout:void 0,kT=typeof Promise=="function"?Promise:void 0,Q3=typeof queueMicrotask=="function"?queueMicrotask:typeof kT<"u"?function(c){return kT.resolve(null).then(c).catch(J3)}:UT;function J3(c){setTimeout(function(){throw c})}function a2(c){return c==="head"}function GT(c,p){var C=p,D=0;do{var G=C.nextSibling;if(c.removeChild(C),G&&G.nodeType===8)if(C=G.data,C==="/$"||C==="/&"){if(D===0){c.removeChild(G),ES(p);return}D--}else if(C==="$"||C==="$?"||C==="$~"||C==="$!"||C==="&")D++;else if(C==="html")gA(c.ownerDocument.documentElement);else if(C==="head"){C=c.ownerDocument.head,gA(C);for(var $=C.firstChild;$;){var et=$.nextSibling,n0=$.nodeName;$[B0]||n0==="SCRIPT"||n0==="STYLE"||n0==="LINK"&&$.rel.toLowerCase()==="stylesheet"||C.removeChild($),$=et}}else C==="body"&&gA(c.ownerDocument.body);C=G}while(C);ES(p)}function VT(c,p){var C=c;c=0;do{var D=C.nextSibling;if(C.nodeType===1?p?(C._stashedDisplay=C.style.display,C.style.display="none"):(C.style.display=C._stashedDisplay||"",C.getAttribute("style")===""&&C.removeAttribute("style")):C.nodeType===3&&(p?(C._stashedText=C.nodeValue,C.nodeValue=""):C.nodeValue=C._stashedText||""),D&&D.nodeType===8)if(C=D.data,C==="/$"){if(c===0)break;c--}else C!=="$"&&C!=="$?"&&C!=="$~"&&C!=="$!"||c++;C=D}while(C)}function _w(c){var p=c.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var C=p;switch(p=p.nextSibling,C.nodeName){case"HTML":case"HEAD":case"BODY":_w(C),V0(C);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(C.rel.toLowerCase()==="stylesheet")continue}c.removeChild(C)}}function eR(c,p,C,D){for(;c.nodeType===1;){var G=C;if(c.nodeName.toLowerCase()!==p.toLowerCase()){if(!D&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(D){if(!c[B0])switch(p){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if($=c.getAttribute("rel"),$==="stylesheet"&&c.hasAttribute("data-precedence"))break;if($!==G.rel||c.getAttribute("href")!==(G.href==null||G.href===""?null:G.href)||c.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin)||c.getAttribute("title")!==(G.title==null?null:G.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if($=c.getAttribute("src"),($!==(G.src==null?null:G.src)||c.getAttribute("type")!==(G.type==null?null:G.type)||c.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin))&&$&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(p==="input"&&c.type==="hidden"){var $=G.name==null?null:""+G.name;if(G.type==="hidden"&&c.getAttribute("name")===$)return c}else return c;if(c=Hv(c.nextSibling),c===null)break}return null}function tR(c,p,C){if(p==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!C||(c=Hv(c.nextSibling),c===null))return null;return c}function HT(c,p){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!p||(c=Hv(c.nextSibling),c===null))return null;return c}function vw(c){return c.data==="$?"||c.data==="$~"}function xw(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function nR(c,p){var C=c.ownerDocument;if(c.data==="$~")c._reactRetry=p;else if(c.data!=="$?"||C.readyState!=="loading")p();else{var D=function(){p(),C.removeEventListener("DOMContentLoaded",D)};C.addEventListener("DOMContentLoaded",D),c._reactRetry=D}}function Hv(c){for(;c!=null;c=c.nextSibling){var p=c.nodeType;if(p===1||p===3)break;if(p===8){if(p=c.data,p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"||p==="F!"||p==="F")break;if(p==="/$"||p==="/&")return null}}return c}var yw=null;function jT(c){c=c.nextSibling;for(var p=0;c;){if(c.nodeType===8){var C=c.data;if(C==="/$"||C==="/&"){if(p===0)return Hv(c.nextSibling);p--}else C!=="$"&&C!=="$!"&&C!=="$?"&&C!=="$~"&&C!=="&"||p++}c=c.nextSibling}return null}function WT(c){c=c.previousSibling;for(var p=0;c;){if(c.nodeType===8){var C=c.data;if(C==="$"||C==="$!"||C==="$?"||C==="$~"||C==="&"){if(p===0)return c;p--}else C!=="/$"&&C!=="/&"||p++}c=c.previousSibling}return null}function $T(c,p,C){switch(p=ME(C),c){case"html":if(c=p.documentElement,!c)throw Error(n(452));return c;case"head":if(c=p.head,!c)throw Error(n(453));return c;case"body":if(c=p.body,!c)throw Error(n(454));return c;default:throw Error(n(451))}}function gA(c){for(var p=c.attributes;p.length;)c.removeAttributeNode(p[0]);V0(c)}var jv=new Map,XT=new Set;function wE(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var Fx=F.d;F.d={f:iR,r:rR,D:sR,C:aR,L:oR,m:lR,X:uR,S:cR,M:hR};function iR(){var c=Fx.f(),p=_E();return c||p}function rR(c){var p=u1(c);p!==null&&p.tag===5&&p.type==="form"?uC(p):Fx.r(c)}var bS=typeof document>"u"?null:document;function YT(c,p,C){var D=bS;if(D&&typeof p=="string"&&p){var G=z1(p);G='link[rel="'+c+'"][href="'+G+'"]',typeof C=="string"&&(G+='[crossorigin="'+C+'"]'),XT.has(G)||(XT.add(G),c={rel:c,crossOrigin:C,href:p},D.querySelector(G)===null&&(p=D.createElement("link"),av(p,"link",c),k0(p),D.head.appendChild(p)))}}function sR(c){Fx.D(c),YT("dns-prefetch",c,null)}function aR(c,p){Fx.C(c,p),YT("preconnect",c,p)}function oR(c,p,C){Fx.L(c,p,C);var D=bS;if(D&&c&&p){var G='link[rel="preload"][as="'+z1(p)+'"]';p==="image"&&C&&C.imageSrcSet?(G+='[imagesrcset="'+z1(C.imageSrcSet)+'"]',typeof C.imageSizes=="string"&&(G+='[imagesizes="'+z1(C.imageSizes)+'"]')):G+='[href="'+z1(c)+'"]';var $=G;switch(p){case"style":$=SS(c);break;case"script":$=AS(c)}jv.has($)||(c=g({rel:"preload",href:p==="image"&&C&&C.imageSrcSet?void 0:c,as:p},C),jv.set($,c),D.querySelector(G)!==null||p==="style"&&D.querySelector(_A($))||p==="script"&&D.querySelector(vA($))||(p=D.createElement("link"),av(p,"link",c),k0(p),D.head.appendChild(p)))}}function lR(c,p){Fx.m(c,p);var C=bS;if(C&&c){var D=p&&typeof p.as=="string"?p.as:"script",G='link[rel="modulepreload"][as="'+z1(D)+'"][href="'+z1(c)+'"]',$=G;switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":$=AS(c)}if(!jv.has($)&&(c=g({rel:"modulepreload",href:c},p),jv.set($,c),C.querySelector(G)===null)){switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(C.querySelector(vA($)))return}D=C.createElement("link"),av(D,"link",c),k0(D),C.head.appendChild(D)}}}function cR(c,p,C){Fx.S(c,p,C);var D=bS;if(D&&c){var G=a1(D).hoistableStyles,$=SS(c);p=p||"default";var et=G.get($);if(!et){var n0={loading:0,preload:null};if(et=D.querySelector(_A($)))n0.loading=5;else{c=g({rel:"stylesheet",href:c,"data-precedence":p},C),(C=jv.get($))&&bw(c,C);var R0=et=D.createElement("link");k0(R0),av(R0,"link",c),R0._p=new Promise(function(W0,Q0){R0.onload=W0,R0.onerror=Q0}),R0.addEventListener("load",function(){n0.loading|=1}),R0.addEventListener("error",function(){n0.loading|=2}),n0.loading|=4,CE(et,p,D)}et={type:"stylesheet",instance:et,count:1,state:n0},G.set($,et)}}}function uR(c,p){Fx.X(c,p);var C=bS;if(C&&c){var D=a1(C).hoistableScripts,G=AS(c),$=D.get(G);$||($=C.querySelector(vA(G)),$||(c=g({src:c,async:!0},p),(p=jv.get(G))&&Sw(c,p),$=C.createElement("script"),k0($),av($,"link",c),C.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},D.set(G,$))}}function hR(c,p){Fx.M(c,p);var C=bS;if(C&&c){var D=a1(C).hoistableScripts,G=AS(c),$=D.get(G);$||($=C.querySelector(vA(G)),$||(c=g({src:c,async:!0,type:"module"},p),(p=jv.get(G))&&Sw(c,p),$=C.createElement("script"),k0($),av($,"link",c),C.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},D.set(G,$))}}function KT(c,p,C,D){var G=(G=Te.current)?wE(G):null;if(!G)throw Error(n(446));switch(c){case"meta":case"title":return null;case"style":return typeof C.precedence=="string"&&typeof C.href=="string"?(p=SS(C.href),C=a1(G).hoistableStyles,D=C.get(p),D||(D={type:"style",instance:null,count:0,state:null},C.set(p,D)),D):{type:"void",instance:null,count:0,state:null};case"link":if(C.rel==="stylesheet"&&typeof C.href=="string"&&typeof C.precedence=="string"){c=SS(C.href);var $=a1(G).hoistableStyles,et=$.get(c);if(et||(G=G.ownerDocument||G,et={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},$.set(c,et),($=G.querySelector(_A(c)))&&!$._p&&(et.instance=$,et.state.loading=5),jv.has(c)||(C={rel:"preload",as:"style",href:C.href,crossOrigin:C.crossOrigin,integrity:C.integrity,media:C.media,hrefLang:C.hrefLang,referrerPolicy:C.referrerPolicy},jv.set(c,C),$||dR(G,c,C,et.state))),p&&D===null)throw Error(n(528,""));return et}if(p&&D!==null)throw Error(n(529,""));return null;case"script":return p=C.async,C=C.src,typeof C=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=AS(C),C=a1(G).hoistableScripts,D=C.get(p),D||(D={type:"script",instance:null,count:0,state:null},C.set(p,D)),D):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,c))}}function SS(c){return'href="'+z1(c)+'"'}function _A(c){return'link[rel="stylesheet"]['+c+"]"}function qT(c){return g({},c,{"data-precedence":c.precedence,precedence:null})}function dR(c,p,C,D){c.querySelector('link[rel="preload"][as="style"]['+p+"]")?D.loading=1:(p=c.createElement("link"),D.preload=p,p.addEventListener("load",function(){return D.loading|=1}),p.addEventListener("error",function(){return D.loading|=2}),av(p,"link",C),k0(p),c.head.appendChild(p))}function AS(c){return'[src="'+z1(c)+'"]'}function vA(c){return"script[async]"+c}function ZT(c,p,C){if(p.count++,p.instance===null)switch(p.type){case"style":var D=c.querySelector('style[data-href~="'+z1(C.href)+'"]');if(D)return p.instance=D,k0(D),D;var G=g({},C,{"data-href":C.href,"data-precedence":C.precedence,href:null,precedence:null});return D=(c.ownerDocument||c).createElement("style"),k0(D),av(D,"style",G),CE(D,C.precedence,c),p.instance=D;case"stylesheet":G=SS(C.href);var $=c.querySelector(_A(G));if($)return p.state.loading|=4,p.instance=$,k0($),$;D=qT(C),(G=jv.get(G))&&bw(D,G),$=(c.ownerDocument||c).createElement("link"),k0($);var et=$;return et._p=new Promise(function(n0,R0){et.onload=n0,et.onerror=R0}),av($,"link",D),p.state.loading|=4,CE($,C.precedence,c),p.instance=$;case"script":return $=AS(C.src),(G=c.querySelector(vA($)))?(p.instance=G,k0(G),G):(D=C,(G=jv.get($))&&(D=g({},C),Sw(D,G)),c=c.ownerDocument||c,G=c.createElement("script"),k0(G),av(G,"link",D),c.head.appendChild(G),p.instance=G);case"void":return null;default:throw Error(n(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(D=p.instance,p.state.loading|=4,CE(D,C.precedence,c));return p.instance}function CE(c,p,C){for(var D=C.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),G=D.length?D[D.length-1]:null,$=G,et=0;et<D.length;et++){var n0=D[et];if(n0.dataset.precedence===p)$=n0;else if($!==G)break}$?$.parentNode.insertBefore(c,$.nextSibling):(p=C.nodeType===9?C.head:C,p.insertBefore(c,p.firstChild))}function bw(c,p){c.crossOrigin==null&&(c.crossOrigin=p.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=p.referrerPolicy),c.title==null&&(c.title=p.title)}function Sw(c,p){c.crossOrigin==null&&(c.crossOrigin=p.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=p.referrerPolicy),c.integrity==null&&(c.integrity=p.integrity)}var TE=null;function QT(c,p,C){if(TE===null){var D=new Map,G=TE=new Map;G.set(C,D)}else G=TE,D=G.get(C),D||(D=new Map,G.set(C,D));if(D.has(c))return D;for(D.set(c,null),C=C.getElementsByTagName(c),G=0;G<C.length;G++){var $=C[G];if(!($[B0]||$[n1]||c==="link"&&$.getAttribute("rel")==="stylesheet")&&$.namespaceURI!=="http://www.w3.org/2000/svg"){var et=$.getAttribute(p)||"";et=c+et;var n0=D.get(et);n0?n0.push($):D.set(et,[$])}}return D}function JT(c,p,C){c=c.ownerDocument||c,c.head.insertBefore(C,p==="title"?c.querySelector("head > title"):null)}function fR(c,p,C){if(C===1||p.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return c=p.disabled,typeof p.precedence=="string"&&c==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function e3(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function pR(c,p,C,D){if(C.type==="stylesheet"&&(typeof D.media!="string"||matchMedia(D.media).matches!==!1)&&(C.state.loading&4)===0){if(C.instance===null){var G=SS(D.href),$=p.querySelector(_A(G));if($){p=$._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(c.count++,c=RE.bind(c),p.then(c,c)),C.state.loading|=4,C.instance=$,k0($);return}$=p.ownerDocument||p,D=qT(D),(G=jv.get(G))&&bw(D,G),$=$.createElement("link"),k0($);var et=$;et._p=new Promise(function(n0,R0){et.onload=n0,et.onerror=R0}),av($,"link",D),C.instance=$}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(C,p),(p=C.state.preload)&&(C.state.loading&3)===0&&(c.count++,C=RE.bind(c),p.addEventListener("load",C),p.addEventListener("error",C))}}var Aw=0;function mR(c,p){return c.stylesheets&&c.count===0&&LE(c,c.stylesheets),0<c.count||0<c.imgCount?function(C){var D=setTimeout(function(){if(c.stylesheets&&LE(c,c.stylesheets),c.unsuspend){var $=c.unsuspend;c.unsuspend=null,$()}},6e4+p);0<c.imgBytes&&Aw===0&&(Aw=62500*K3());var G=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&LE(c,c.stylesheets),c.unsuspend)){var $=c.unsuspend;c.unsuspend=null,$()}},(c.imgBytes>Aw?50:800)+p);return c.unsuspend=C,function(){c.unsuspend=null,clearTimeout(D),clearTimeout(G)}}:null}function RE(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)LE(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var DE=null;function LE(c,p){c.stylesheets=null,c.unsuspend!==null&&(c.count++,DE=new Map,p.forEach(gR,c),DE=null,RE.call(c))}function gR(c,p){if(!(p.state.loading&4)){var C=DE.get(c);if(C)var D=C.get(null);else{C=new Map,DE.set(c,C);for(var G=c.querySelectorAll("link[data-precedence],style[data-precedence]"),$=0;$<G.length;$++){var et=G[$];(et.nodeName==="LINK"||et.getAttribute("media")!=="not all")&&(C.set(et.dataset.precedence,et),D=et)}D&&C.set(null,D)}G=p.instance,et=G.getAttribute("data-precedence"),$=C.get(et)||D,$===D&&C.set(null,G),C.set(et,G),this.count++,D=RE.bind(this),G.addEventListener("load",D),G.addEventListener("error",D),$?$.parentNode.insertBefore(G,$.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(G,c.firstChild)),p.state.loading|=4}}var xA={$$typeof:m,Provider:null,Consumer:null,_currentValue:k,_currentValue2:k,_threadCount:0};function _R(c,p,C,D,G,$,et,n0,R0){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=O0(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=O0(0),this.hiddenUpdates=O0(null),this.identifierPrefix=D,this.onUncaughtError=G,this.onCaughtError=$,this.onRecoverableError=et,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=R0,this.incompleteTransitions=new Map}function t3(c,p,C,D,G,$,et,n0,R0,W0,Q0,t1){return c=new _R(c,p,C,et,R0,W0,Q0,t1,n0),p=1,$===!0&&(p|=24),$=_v(3,null,null,p),c.current=$,$.stateNode=c,p=ZS(),p.refCount++,c.pooledCache=p,p.refCount++,$.memoizedState={element:D,isDehydrated:C,cache:p},U_($),c}function n3(c){return c?(c=Wx,c):Wx}function i3(c,p,C,D,G,$){G=n3(G),D.context===null?D.context=G:D.pendingContext=G,D=V1(p),D.payload={element:C},$=$===void 0?null:$,$!==null&&(D.callback=$),C=L1(c,D,p),C!==null&&(Lv(C,c,p),T1(C,c,p))}function r3(c,p){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var C=c.retryLane;c.retryLane=C!==0&&C<p?C:p}}function Ew(c,p){r3(c,p),(c=c.alternate)&&r3(c,p)}function s3(c){if(c.tag===13||c.tag===31){var p=rx(c,67108864);p!==null&&Lv(p,c,67108864),Ew(c,67108864)}}function a3(c){if(c.tag===13||c.tag===31){var p=Nv();p=d0(p);var C=rx(c,p);C!==null&&Lv(C,c,p),Ew(c,p)}}var PE=!0;function vR(c,p,C,D){var G=U.T;U.T=null;var $=F.p;try{F.p=2,Mw(c,p,C,D)}finally{F.p=$,U.T=G}}function xR(c,p,C,D){var G=U.T;U.T=null;var $=F.p;try{F.p=8,Mw(c,p,C,D)}finally{F.p=$,U.T=G}}function Mw(c,p,C,D){if(PE){var G=ww(D);if(G===null)hw(c,p,D,OE,C),l3(c,D);else if(bR(G,c,p,C,D))D.stopPropagation();else if(l3(c,D),p&4&&-1<yR.indexOf(c)){for(;G!==null;){var $=u1(G);if($!==null)switch($.tag){case 3:if($=$.stateNode,$.current.memoizedState.isDehydrated){var et=W($.pendingLanes);if(et!==0){var n0=$;for(n0.pendingLanes|=2,n0.entangledLanes|=2;et;){var R0=1<<31-v0(et);n0.entanglements[1]|=R0,et&=~R0}hx($),(K1&6)===0&&(mE=We()+500,fA(0))}}break;case 31:case 13:n0=rx($,2),n0!==null&&Lv(n0,$,2),_E(),Ew($,2)}if($=ww(D),$===null&&hw(c,p,D,OE,C),$===G)break;G=$}G!==null&&D.stopPropagation()}else hw(c,p,D,null,C)}}function ww(c){return c=bv(c),Cw(c)}var OE=null;function Cw(c){if(OE=null,c=i1(c),c!==null){var p=s(c);if(p===null)c=null;else{var C=p.tag;if(C===13){if(c=o(p),c!==null)return c;c=null}else if(C===31){if(c=a(p),c!==null)return c;c=null}else if(C===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;c=null}else p!==c&&(c=null)}}return OE=c,null}function o3(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(h0()){case M0:return 2;case Z:return 8;case tt:case tr:return 32;case s0:return 268435456;default:return 32}default:return 32}}var Tw=!1,o2=null,l2=null,c2=null,yA=new Map,bA=new Map,u2=[],yR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function l3(c,p){switch(c){case"focusin":case"focusout":o2=null;break;case"dragenter":case"dragleave":l2=null;break;case"mouseover":case"mouseout":c2=null;break;case"pointerover":case"pointerout":yA.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":bA.delete(p.pointerId)}}function SA(c,p,C,D,G,$){return c===null||c.nativeEvent!==$?(c={blockedOn:p,domEventName:C,eventSystemFlags:D,nativeEvent:$,targetContainers:[G]},p!==null&&(p=u1(p),p!==null&&s3(p)),c):(c.eventSystemFlags|=D,p=c.targetContainers,G!==null&&p.indexOf(G)===-1&&p.push(G),c)}function bR(c,p,C,D,G){switch(p){case"focusin":return o2=SA(o2,c,p,C,D,G),!0;case"dragenter":return l2=SA(l2,c,p,C,D,G),!0;case"mouseover":return c2=SA(c2,c,p,C,D,G),!0;case"pointerover":var $=G.pointerId;return yA.set($,SA(yA.get($)||null,c,p,C,D,G)),!0;case"gotpointercapture":return $=G.pointerId,bA.set($,SA(bA.get($)||null,c,p,C,D,G)),!0}return!1}function c3(c){var p=i1(c.target);if(p!==null){var C=s(p);if(C!==null){if(p=C.tag,p===13){if(p=o(C),p!==null){c.blockedOn=p,$0(c.priority,function(){a3(C)});return}}else if(p===31){if(p=a(C),p!==null){c.blockedOn=p,$0(c.priority,function(){a3(C)});return}}else if(p===3&&C.stateNode.current.memoizedState.isDehydrated){c.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}c.blockedOn=null}function IE(c){if(c.blockedOn!==null)return!1;for(var p=c.targetContainers;0<p.length;){var C=ww(c.nativeEvent);if(C===null){C=c.nativeEvent;var D=new C.constructor(C.type,C);tx=D,C.target.dispatchEvent(D),tx=null}else return p=u1(C),p!==null&&s3(p),c.blockedOn=C,!1;p.shift()}return!0}function u3(c,p,C){IE(c)&&C.delete(p)}function SR(){Tw=!1,o2!==null&&IE(o2)&&(o2=null),l2!==null&&IE(l2)&&(l2=null),c2!==null&&IE(c2)&&(c2=null),yA.forEach(u3),bA.forEach(u3)}function BE(c,p){c.blockedOn===p&&(c.blockedOn=null,Tw||(Tw=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,SR)))}var NE=null;function h3(c){NE!==c&&(NE=c,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){NE===c&&(NE=null);for(var p=0;p<c.length;p+=3){var C=c[p],D=c[p+1],G=c[p+2];if(typeof D!="function"){if(Cw(D||C)===null)continue;break}var $=u1(C);$!==null&&(c.splice(p,3),p-=3,wM($,{pending:!0,data:G,method:C.method,action:D},D,G))}}))}function ES(c){function p(R0){return BE(R0,c)}o2!==null&&BE(o2,c),l2!==null&&BE(l2,c),c2!==null&&BE(c2,c),yA.forEach(p),bA.forEach(p);for(var C=0;C<u2.length;C++){var D=u2[C];D.blockedOn===c&&(D.blockedOn=null)}for(;0<u2.length&&(C=u2[0],C.blockedOn===null);)c3(C),C.blockedOn===null&&u2.shift();if(C=(c.ownerDocument||c).$$reactFormReplay,C!=null)for(D=0;D<C.length;D+=3){var G=C[D],$=C[D+1],et=G[c1]||null;if(typeof $=="function")et||h3(C);else if(et){var n0=null;if($&&$.hasAttribute("formAction")){if(G=$,et=$[c1]||null)n0=et.formAction;else if(Cw(G)!==null)continue}else n0=et.action;typeof n0=="function"?C[D+1]=n0:(C.splice(D,3),D-=3),h3(C)}}}function d3(){function c($){$.canIntercept&&$.info==="react-transition"&&$.intercept({handler:function(){return new Promise(function(et){return G=et})},focusReset:"manual",scroll:"manual"})}function p(){G!==null&&(G(),G=null),D||setTimeout(C,20)}function C(){if(!D&&!navigation.transition){var $=navigation.currentEntry;$&&$.url!=null&&navigation.navigate($.url,{state:$.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var D=!1,G=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",p),navigation.addEventListener("navigateerror",p),setTimeout(C,100),function(){D=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",p),navigation.removeEventListener("navigateerror",p),G!==null&&(G(),G=null)}}}function Rw(c){this._internalRoot=c}zE.prototype.render=Rw.prototype.render=function(c){var p=this._internalRoot;if(p===null)throw Error(n(409));var C=p.current,D=Nv();i3(C,D,c,p,null,null)},zE.prototype.unmount=Rw.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var p=c.containerInfo;i3(c.current,2,null,c,null,null),_E(),p[J0]=null}};function zE(c){this._internalRoot=c}zE.prototype.unstable_scheduleHydration=function(c){if(c){var p=S0();c={blockedOn:null,target:c,priority:p};for(var C=0;C<u2.length&&p!==0&&p<u2[C].priority;C++);u2.splice(C,0,c),C===0&&c3(c)}};var f3=e.version;if(f3!=="19.2.0")throw Error(n(527,f3,"19.2.0"));F.findDOMNode=function(c){var p=c._reactInternals;if(p===void 0)throw typeof c.render=="function"?Error(n(188)):(c=Object.keys(c).join(","),Error(n(268,c)));return c=d(p),c=c!==null?u(c):null,c=c===null?null:c.stateNode,c};var AR={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var FE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!FE.isDisabled&&FE.supportsFiber)try{P0=FE.inject(AR),Fe=FE}catch{}}return reactDomClient_production.createRoot=function(c,p){if(!i(c))throw Error(n(299));var C=!1,D="",G=yC,$=bC,et=SC;return p!=null&&(p.unstable_strictMode===!0&&(C=!0),p.identifierPrefix!==void 0&&(D=p.identifierPrefix),p.onUncaughtError!==void 0&&(G=p.onUncaughtError),p.onCaughtError!==void 0&&($=p.onCaughtError),p.onRecoverableError!==void 0&&(et=p.onRecoverableError)),p=t3(c,1,!1,null,null,C,D,null,G,$,et,d3),c[J0]=p.current,uw(c),new Rw(p)},reactDomClient_production.hydrateRoot=function(c,p,C){if(!i(c))throw Error(n(299));var D=!1,G="",$=yC,et=bC,n0=SC,R0=null;return C!=null&&(C.unstable_strictMode===!0&&(D=!0),C.identifierPrefix!==void 0&&(G=C.identifierPrefix),C.onUncaughtError!==void 0&&($=C.onUncaughtError),C.onCaughtError!==void 0&&(et=C.onCaughtError),C.onRecoverableError!==void 0&&(n0=C.onRecoverableError),C.formState!==void 0&&(R0=C.formState)),p=t3(c,1,!0,p,C??null,D,G,R0,$,et,n0,d3),p.context=n3(null),C=p.current,D=Nv(),D=d0(D),G=V1(D),G.callback=null,L1(C,G,D),C=D,p.current.lanes=C,q(p,C),hx(p),c[J0]=p.current,uw(c),new zE(p)},reactDomClient_production.version="19.2.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const REVISION="158",CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LinearEncoding=3e3,sRGBEncoding=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",DisplayP3ColorSpace="display-p3",LinearDisplayP3ColorSpace="display-p3-linear",LinearTransfer="linear",SRGBTransfer="srgb",Rec709Primaries="rec709",P3Primaries="p3",KeepStencilOp=7680,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(_lut[r&255]+_lut[r>>8&255]+_lut[r>>16&255]+_lut[r>>24&255]+"-"+_lut[e&255]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[t&63|128]+_lut[t>>8&255]+"-"+_lut[t>>16&255]+_lut[t>>24&255]+_lut[n&255]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]).toLowerCase()}function clamp(r,e,t){return Math.max(e,Math.min(t,r))}function euclideanModulo(r,e){return(r%e+e)%e}function lerp(r,e,t){return(1-t)*r+t*e}function isPowerOfTwo(r){return(r&r-1)===0&&r!==0}function floorPowerOfTwo(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function denormalize(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function normalize$1(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}class Vector2{constructor(e=0,t=0){Vector2.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*i+e.x,this.y=s*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(e,t,n,i,s,o,a,l,d){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,o,a,l,d)}set(e,t,n,i,s,o,a,l,d){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=n,u[7]=o,u[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],d=n[1],u=n[4],g=n[7],x=n[2],y=n[5],b=n[8],_=i[0],h=i[3],f=i[6],E=i[1],m=i[4],S=i[7],w=i[2],v=i[5],A=i[8];return s[0]=o*_+a*E+l*w,s[3]=o*h+a*m+l*v,s[6]=o*f+a*S+l*A,s[1]=d*_+u*E+g*w,s[4]=d*h+u*m+g*v,s[7]=d*f+u*S+g*A,s[2]=x*_+y*E+b*w,s[5]=x*h+y*m+b*v,s[8]=x*f+y*S+b*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],d=e[7],u=e[8];return t*o*u-t*a*d-n*s*u+n*a*l+i*s*d-i*o*l}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],d=e[7],u=e[8],g=u*o-a*d,x=a*l-u*s,y=d*s-o*l,b=t*g+n*x+i*y;if(b===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/b;return e[0]=g*_,e[1]=(i*d-u*n)*_,e[2]=(a*n-i*o)*_,e[3]=x*_,e[4]=(u*t-i*l)*_,e[5]=(i*s-a*t)*_,e[6]=y*_,e[7]=(n*l-d*t)*_,e[8]=(o*t-n*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,o,a){const l=Math.cos(s),d=Math.sin(s);return this.set(n*l,n*d,-n*(l*o+d*a)+o+e,-i*d,i*l,-i*(-d*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(_m3.makeScale(e,t)),this}rotate(e){return this.premultiply(_m3.makeRotation(-e)),this}translate(e,t){return this.premultiply(_m3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function createElementNS(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function createCanvasElement(){const r=createElementNS("canvas");return r.style.display="block",r}const _cache={};function warnOnce(r){r in _cache||(_cache[r]=!0,console.warn(r))}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=new Matrix3().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=new Matrix3().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),COLOR_SPACES={[LinearSRGBColorSpace]:{transfer:LinearTransfer,primaries:Rec709Primaries,toReference:r=>r,fromReference:r=>r},[SRGBColorSpace]:{transfer:SRGBTransfer,primaries:Rec709Primaries,toReference:r=>r.convertSRGBToLinear(),fromReference:r=>r.convertLinearToSRGB()},[LinearDisplayP3ColorSpace]:{transfer:LinearTransfer,primaries:P3Primaries,toReference:r=>r.applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:r=>r.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3)},[DisplayP3ColorSpace]:{transfer:SRGBTransfer,primaries:P3Primaries,toReference:r=>r.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:r=>r.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}},SUPPORTED_WORKING_COLOR_SPACES=new Set([LinearSRGBColorSpace,LinearDisplayP3ColorSpace]),ColorManagement={enabled:!0,_workingColorSpace:LinearSRGBColorSpace,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(r){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!r},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(r){if(!SUPPORTED_WORKING_COLOR_SPACES.has(r))throw new Error(`Unsupported working color space, "${r}".`);this._workingColorSpace=r},convert:function(r,e,t){if(this.enabled===!1||e===t||!e||!t)return r;const n=COLOR_SPACES[e].toReference,i=COLOR_SPACES[t].fromReference;return i(n(r))},fromWorkingColorSpace:function(r,e){return this.convert(r,this._workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this._workingColorSpace)},getPrimaries:function(r){return COLOR_SPACES[r].primaries},getTransfer:function(r){return r===NoColorSpace?LinearTransfer:COLOR_SPACES[r].transfer}};function SRGBToLinear(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function LinearToSRGB(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=e.width,_canvas.height=e.height;const n=_canvas.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=_canvas}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=createElementNS("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=SRGBToLinear(s[o]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(SRGBToLinear(t[n]/255)*255):t[n]=SRGBToLinear(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let _sourceId=0;class Source{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(serializeImage(i[o].image)):s.push(serializeImage(i[o]))}else s=serializeImage(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function serializeImage(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?ImageUtils.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,n=ClampToEdgeWrapping,i=ClampToEdgeWrapping,s=LinearFilter,o=LinearMipmapLinearFilter,a=RGBAFormat,l=UnsignedByteType,d=Texture.DEFAULT_ANISOTROPY,u=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=d,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set encoding(e){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===sRGBEncoding?SRGBColorSpace:NoColorSpace}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(e=0,t=0,n=0,i=1){Vector4.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const l=e.elements,d=l[0],u=l[4],g=l[8],x=l[1],y=l[5],b=l[9],_=l[2],h=l[6],f=l[10];if(Math.abs(u-x)<.01&&Math.abs(g-_)<.01&&Math.abs(b-h)<.01){if(Math.abs(u+x)<.1&&Math.abs(g+_)<.1&&Math.abs(b+h)<.1&&Math.abs(d+y+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const m=(d+1)/2,S=(y+1)/2,w=(f+1)/2,v=(u+x)/4,A=(g+_)/4,M=(b+h)/4;return m>S&&m>w?m<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(m),i=v/n,s=A/n):S>w?S<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(S),n=v/i,s=M/i):w<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(w),n=A/s,i=M/s),this.set(n,i,s,t),this}let E=Math.sqrt((h-b)*(h-b)+(g-_)*(g-_)+(x-u)*(x-u));return Math.abs(E)<.001&&(E=1),this.x=(h-b)/E,this.y=(g-_)/E,this.z=(x-u)/E,this.w=Math.acos((d+y+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t);const i={width:e,height:t,depth:1};n.encoding!==void 0&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Texture(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Source(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Data3DTexture extends Texture{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Quaternion{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,o,a){let l=n[i+0],d=n[i+1],u=n[i+2],g=n[i+3];const x=s[o+0],y=s[o+1],b=s[o+2],_=s[o+3];if(a===0){e[t+0]=l,e[t+1]=d,e[t+2]=u,e[t+3]=g;return}if(a===1){e[t+0]=x,e[t+1]=y,e[t+2]=b,e[t+3]=_;return}if(g!==_||l!==x||d!==y||u!==b){let h=1-a;const f=l*x+d*y+u*b+g*_,E=f>=0?1:-1,m=1-f*f;if(m>Number.EPSILON){const w=Math.sqrt(m),v=Math.atan2(w,f*E);h=Math.sin(h*v)/w,a=Math.sin(a*v)/w}const S=a*E;if(l=l*h+x*S,d=d*h+y*S,u=u*h+b*S,g=g*h+_*S,h===1-a){const w=1/Math.sqrt(l*l+d*d+u*u+g*g);l*=w,d*=w,u*=w,g*=w}}e[t]=l,e[t+1]=d,e[t+2]=u,e[t+3]=g}static multiplyQuaternionsFlat(e,t,n,i,s,o){const a=n[i],l=n[i+1],d=n[i+2],u=n[i+3],g=s[o],x=s[o+1],y=s[o+2],b=s[o+3];return e[t]=a*b+u*g+l*y-d*x,e[t+1]=l*b+u*x+d*g-a*y,e[t+2]=d*b+u*y+a*x-l*g,e[t+3]=u*b-a*g-l*x-d*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,d=a(n/2),u=a(i/2),g=a(s/2),x=l(n/2),y=l(i/2),b=l(s/2);switch(o){case"XYZ":this._x=x*u*g+d*y*b,this._y=d*y*g-x*u*b,this._z=d*u*b+x*y*g,this._w=d*u*g-x*y*b;break;case"YXZ":this._x=x*u*g+d*y*b,this._y=d*y*g-x*u*b,this._z=d*u*b-x*y*g,this._w=d*u*g+x*y*b;break;case"ZXY":this._x=x*u*g-d*y*b,this._y=d*y*g+x*u*b,this._z=d*u*b+x*y*g,this._w=d*u*g-x*y*b;break;case"ZYX":this._x=x*u*g-d*y*b,this._y=d*y*g+x*u*b,this._z=d*u*b-x*y*g,this._w=d*u*g+x*y*b;break;case"YZX":this._x=x*u*g+d*y*b,this._y=d*y*g+x*u*b,this._z=d*u*b-x*y*g,this._w=d*u*g-x*y*b;break;case"XZY":this._x=x*u*g-d*y*b,this._y=d*y*g-x*u*b,this._z=d*u*b+x*y*g,this._w=d*u*g+x*y*b;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],o=t[1],a=t[5],l=t[9],d=t[2],u=t[6],g=t[10],x=n+a+g;if(x>0){const y=.5/Math.sqrt(x+1);this._w=.25/y,this._x=(u-l)*y,this._y=(s-d)*y,this._z=(o-i)*y}else if(n>a&&n>g){const y=2*Math.sqrt(1+n-a-g);this._w=(u-l)/y,this._x=.25*y,this._y=(i+o)/y,this._z=(s+d)/y}else if(a>g){const y=2*Math.sqrt(1+a-n-g);this._w=(s-d)/y,this._x=(i+o)/y,this._y=.25*y,this._z=(l+u)/y}else{const y=2*Math.sqrt(1+g-n-a);this._w=(o-i)/y,this._x=(s+d)/y,this._y=(l+u)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,o=e._w,a=t._x,l=t._y,d=t._z,u=t._w;return this._x=n*u+o*a+i*d-s*l,this._y=i*u+o*l+s*a-n*d,this._z=s*u+o*d+n*l-i*a,this._w=o*u-n*a-i*l-s*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const y=1-t;return this._w=y*o+t*this._w,this._x=y*n+t*this._x,this._y=y*i+t*this._y,this._z=y*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const d=Math.sqrt(l),u=Math.atan2(d,a),g=Math.sin((1-t)*u)/d,x=Math.sin(t*u)/d;return this._w=o*g+this._w*x,this._x=n*g+this._x*x,this._y=i*g+this._y*x,this._z=s*g+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(s),n*Math.cos(s),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(e=0,t=0,n=0){Vector3.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_quaternion$4.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,a=e.z,l=e.w,d=2*(o*i-a*n),u=2*(a*t-s*i),g=2*(s*n-o*t);return this.x=t+l*d+o*g-a*u,this.y=n+l*u+a*d-s*g,this.z=i+l*g+s*u-o*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=i*l-s*a,this.y=s*o-n*l,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return _vector$b.copy(this).projectOnVector(e),this.sub(_vector$b)}reflect(e){return this.sub(_vector$b.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$b=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(_vector$a.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(_vector$a.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=_vector$a.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,_vector$a):_vector$a.fromBufferAttribute(s,o),_vector$a.applyMatrix4(e.matrixWorld),this.expandByPoint(_vector$a);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),_box$3.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),_box$3.copy(n.boundingBox)),_box$3.applyMatrix4(e.matrixWorld),this.union(_box$3)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,_vector$a),_vector$a.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(e.a,_center),_v1$7.subVectors(e.b,_center),_v2$4.subVectors(e.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(t,_v0$2,_v1$7,_v2$4,_extents)||(t=[1,0,0,0,1,0,0,0,1],!satForAxes(t,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(t,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_vector$a).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_vector$a).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$a=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(r,e,t,n,i){for(let s=0,o=r.length-3;s<=o;s+=3){_testAxis.fromArray(r,s);const a=i.x*Math.abs(_testAxis.x)+i.y*Math.abs(_testAxis.y)+i.z*Math.abs(_testAxis.z),l=e.dot(_testAxis),d=t.dot(_testAxis),u=n.dot(_testAxis);if(Math.max(-Math.max(l,d,u),Math.min(l,d,u))>a)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(e=new Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):_box$2.setFromPoints(e).getCenter(n);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_v1$6.subVectors(e,this.center);const t=_v1$6.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(_v1$6,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(_v2$3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_v1$6.copy(e.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(e.center).sub(_v2$3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$9=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(e=new Vector3,t=new Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_vector$9)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=_vector$9.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$9.copy(this.origin).addScaledVector(this.direction,t),_vector$9.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);const s=e.distanceTo(t)*.5,o=-this.direction.dot(_segDir),a=_diff.dot(this.direction),l=-_diff.dot(_segDir),d=_diff.lengthSq(),u=Math.abs(1-o*o);let g,x,y,b;if(u>0)if(g=o*l-a,x=o*a-l,b=s*u,g>=0)if(x>=-b)if(x<=b){const _=1/u;g*=_,x*=_,y=g*(g+o*x+2*a)+x*(o*g+x+2*l)+d}else x=s,g=Math.max(0,-(o*x+a)),y=-g*g+x*(x+2*l)+d;else x=-s,g=Math.max(0,-(o*x+a)),y=-g*g+x*(x+2*l)+d;else x<=-b?(g=Math.max(0,-(-o*s+a)),x=g>0?-s:Math.min(Math.max(-s,-l),s),y=-g*g+x*(x+2*l)+d):x<=b?(g=0,x=Math.min(Math.max(-s,-l),s),y=x*(x+2*l)+d):(g=Math.max(0,-(o*s+a)),x=g>0?s:Math.min(Math.max(-s,-l),s),y=-g*g+x*(x+2*l)+d);else x=o>0?-s:s,g=Math.max(0,-(o*x+a)),y=-g*g+x*(x+2*l)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,g),i&&i.copy(_segCenter).addScaledVector(_segDir,x),y}intersectSphere(e,t){_vector$9.subVectors(e.center,this.origin);const n=_vector$9.dot(this.direction),i=_vector$9.dot(_vector$9)-n*n,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,o,a,l;const d=1/this.direction.x,u=1/this.direction.y,g=1/this.direction.z,x=this.origin;return d>=0?(n=(e.min.x-x.x)*d,i=(e.max.x-x.x)*d):(n=(e.max.x-x.x)*d,i=(e.min.x-x.x)*d),u>=0?(s=(e.min.y-x.y)*u,o=(e.max.y-x.y)*u):(s=(e.max.y-x.y)*u,o=(e.min.y-x.y)*u),n>o||s>i||((s>n||isNaN(n))&&(n=s),(o<i||isNaN(i))&&(i=o),g>=0?(a=(e.min.z-x.z)*g,l=(e.max.z-x.z)*g):(a=(e.max.z-x.z)*g,l=(e.min.z-x.z)*g),n>l||a>i)||((a>n||n!==n)&&(n=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,_vector$9)!==null}intersectTriangle(e,t,n,i,s){_edge1.subVectors(t,e),_edge2.subVectors(n,e),_normal$1.crossVectors(_edge1,_edge2);let o=this.direction.dot(_normal$1),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;_diff.subVectors(this.origin,e);const l=a*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(l<0)return null;const d=a*this.direction.dot(_edge1.cross(_diff));if(d<0||l+d>o)return null;const u=-a*_diff.dot(_normal$1);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Matrix4{constructor(e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h)}set(e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h){const f=this.elements;return f[0]=e,f[4]=t,f[8]=n,f[12]=i,f[1]=s,f[5]=o,f[9]=a,f[13]=l,f[2]=d,f[6]=u,f[10]=g,f[14]=x,f[3]=y,f[7]=b,f[11]=_,f[15]=h,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/_v1$5.setFromMatrixColumn(e,0).length(),s=1/_v1$5.setFromMatrixColumn(e,1).length(),o=1/_v1$5.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(i),d=Math.sin(i),u=Math.cos(s),g=Math.sin(s);if(e.order==="XYZ"){const x=o*u,y=o*g,b=a*u,_=a*g;t[0]=l*u,t[4]=-l*g,t[8]=d,t[1]=y+b*d,t[5]=x-_*d,t[9]=-a*l,t[2]=_-x*d,t[6]=b+y*d,t[10]=o*l}else if(e.order==="YXZ"){const x=l*u,y=l*g,b=d*u,_=d*g;t[0]=x+_*a,t[4]=b*a-y,t[8]=o*d,t[1]=o*g,t[5]=o*u,t[9]=-a,t[2]=y*a-b,t[6]=_+x*a,t[10]=o*l}else if(e.order==="ZXY"){const x=l*u,y=l*g,b=d*u,_=d*g;t[0]=x-_*a,t[4]=-o*g,t[8]=b+y*a,t[1]=y+b*a,t[5]=o*u,t[9]=_-x*a,t[2]=-o*d,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const x=o*u,y=o*g,b=a*u,_=a*g;t[0]=l*u,t[4]=b*d-y,t[8]=x*d+_,t[1]=l*g,t[5]=_*d+x,t[9]=y*d-b,t[2]=-d,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const x=o*l,y=o*d,b=a*l,_=a*d;t[0]=l*u,t[4]=_-x*g,t[8]=b*g+y,t[1]=g,t[5]=o*u,t[9]=-a*u,t[2]=-d*u,t[6]=y*g+b,t[10]=x-_*g}else if(e.order==="XZY"){const x=o*l,y=o*d,b=a*l,_=a*d;t[0]=l*u,t[4]=-g,t[8]=d*u,t[1]=x*g+_,t[5]=o*u,t[9]=y*g-b,t[2]=b*g-y,t[6]=a*u,t[10]=_*g+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,t,n){const i=this.elements;return _z.subVectors(e,t),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(n,_z),_x.lengthSq()===0&&(Math.abs(n.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(n,_z)),_x.normalize(),_y$1.crossVectors(_z,_x),i[0]=_x.x,i[4]=_y$1.x,i[8]=_z.x,i[1]=_x.y,i[5]=_y$1.y,i[9]=_z.y,i[2]=_x.z,i[6]=_y$1.z,i[10]=_z.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],d=n[12],u=n[1],g=n[5],x=n[9],y=n[13],b=n[2],_=n[6],h=n[10],f=n[14],E=n[3],m=n[7],S=n[11],w=n[15],v=i[0],A=i[4],M=i[8],T=i[12],R=i[1],O=i[5],L=i[9],P=i[13],I=i[2],N=i[6],U=i[10],F=i[14],k=i[3],j=i[7],H=i[11],B=i[15];return s[0]=o*v+a*R+l*I+d*k,s[4]=o*A+a*O+l*N+d*j,s[8]=o*M+a*L+l*U+d*H,s[12]=o*T+a*P+l*F+d*B,s[1]=u*v+g*R+x*I+y*k,s[5]=u*A+g*O+x*N+y*j,s[9]=u*M+g*L+x*U+y*H,s[13]=u*T+g*P+x*F+y*B,s[2]=b*v+_*R+h*I+f*k,s[6]=b*A+_*O+h*N+f*j,s[10]=b*M+_*L+h*U+f*H,s[14]=b*T+_*P+h*F+f*B,s[3]=E*v+m*R+S*I+w*k,s[7]=E*A+m*O+S*N+w*j,s[11]=E*M+m*L+S*U+w*H,s[15]=E*T+m*P+S*F+w*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],o=e[1],a=e[5],l=e[9],d=e[13],u=e[2],g=e[6],x=e[10],y=e[14],b=e[3],_=e[7],h=e[11],f=e[15];return b*(+s*l*g-i*d*g-s*a*x+n*d*x+i*a*y-n*l*y)+_*(+t*l*y-t*d*x+s*o*x-i*o*y+i*d*u-s*l*u)+h*(+t*d*g-t*a*y-s*o*g+n*o*y+s*a*u-n*d*u)+f*(-i*a*u-t*l*g+t*a*x+i*o*g-n*o*x+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],d=e[7],u=e[8],g=e[9],x=e[10],y=e[11],b=e[12],_=e[13],h=e[14],f=e[15],E=g*h*d-_*x*d+_*l*y-a*h*y-g*l*f+a*x*f,m=b*x*d-u*h*d-b*l*y+o*h*y+u*l*f-o*x*f,S=u*_*d-b*g*d+b*a*y-o*_*y-u*a*f+o*g*f,w=b*g*l-u*_*l-b*a*x+o*_*x+u*a*h-o*g*h,v=t*E+n*m+i*S+s*w;if(v===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/v;return e[0]=E*A,e[1]=(_*x*s-g*h*s-_*i*y+n*h*y+g*i*f-n*x*f)*A,e[2]=(a*h*s-_*l*s+_*i*d-n*h*d-a*i*f+n*l*f)*A,e[3]=(g*l*s-a*x*s-g*i*d+n*x*d+a*i*y-n*l*y)*A,e[4]=m*A,e[5]=(u*h*s-b*x*s+b*i*y-t*h*y-u*i*f+t*x*f)*A,e[6]=(b*l*s-o*h*s-b*i*d+t*h*d+o*i*f-t*l*f)*A,e[7]=(o*x*s-u*l*s+u*i*d-t*x*d-o*i*y+t*l*y)*A,e[8]=S*A,e[9]=(b*g*s-u*_*s-b*n*y+t*_*y+u*n*f-t*g*f)*A,e[10]=(o*_*s-b*a*s+b*n*d-t*_*d-o*n*f+t*a*f)*A,e[11]=(u*a*s-o*g*s-u*n*d+t*g*d+o*n*y-t*a*y)*A,e[12]=w*A,e[13]=(u*_*i-b*g*i+b*n*x-t*_*x-u*n*h+t*g*h)*A,e[14]=(b*a*i-o*_*i-b*n*l+t*_*l+o*n*h-t*a*h)*A,e[15]=(o*g*i-u*a*i+u*n*l-t*g*l-o*n*x+t*a*x)*A,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,d=s*o,u=s*a;return this.set(d*o+n,d*a-i*l,d*l+i*a,0,d*a+i*l,u*a+n,u*l-i*o,0,d*l-i*a,u*l+i*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,o){return this.set(1,n,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,d=s+s,u=o+o,g=a+a,x=s*d,y=s*u,b=s*g,_=o*u,h=o*g,f=a*g,E=l*d,m=l*u,S=l*g,w=n.x,v=n.y,A=n.z;return i[0]=(1-(_+f))*w,i[1]=(y+S)*w,i[2]=(b-m)*w,i[3]=0,i[4]=(y-S)*v,i[5]=(1-(x+f))*v,i[6]=(h+E)*v,i[7]=0,i[8]=(b+m)*A,i[9]=(h-E)*A,i[10]=(1-(x+_))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=_v1$5.set(i[0],i[1],i[2]).length();const o=_v1$5.set(i[4],i[5],i[6]).length(),a=_v1$5.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],_m1$2.copy(this);const d=1/s,u=1/o,g=1/a;return _m1$2.elements[0]*=d,_m1$2.elements[1]*=d,_m1$2.elements[2]*=d,_m1$2.elements[4]*=u,_m1$2.elements[5]*=u,_m1$2.elements[6]*=u,_m1$2.elements[8]*=g,_m1$2.elements[9]*=g,_m1$2.elements[10]*=g,t.setFromRotationMatrix(_m1$2),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,i,s,o,a=WebGLCoordinateSystem){const l=this.elements,d=2*s/(t-e),u=2*s/(n-i),g=(t+e)/(t-e),x=(n+i)/(n-i);let y,b;if(a===WebGLCoordinateSystem)y=-(o+s)/(o-s),b=-2*o*s/(o-s);else if(a===WebGPUCoordinateSystem)y=-o/(o-s),b=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=d,l[4]=0,l[8]=g,l[12]=0,l[1]=0,l[5]=u,l[9]=x,l[13]=0,l[2]=0,l[6]=0,l[10]=y,l[14]=b,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,s,o,a=WebGLCoordinateSystem){const l=this.elements,d=1/(t-e),u=1/(n-i),g=1/(o-s),x=(t+e)*d,y=(n+i)*u;let b,_;if(a===WebGLCoordinateSystem)b=(o+s)*g,_=-2*g;else if(a===WebGPUCoordinateSystem)b=s*g,_=-1*g;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*d,l[4]=0,l[8]=0,l[12]=-x,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-y,l[2]=0,l[6]=0,l[10]=_,l[14]=-b,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y$1=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(e=0,t=0,n=0,i=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],l=i[1],d=i[5],u=i[9],g=i[2],x=i[6],y=i[10];switch(t){case"XYZ":this._y=Math.asin(clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,y),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(x,d),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,y),this._z=Math.atan2(l,d)):(this._y=Math.atan2(-g,s),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-g,y),this._z=Math.atan2(-o,d)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-clamp(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(x,y),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,d));break;case"YZX":this._z=Math.asin(clamp(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,d),this._y=Math.atan2(-g,s)):(this._x=0,this._y=Math.atan2(a,y));break;case"XZY":this._z=Math.asin(-clamp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(x,d),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return _matrix.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const e=new Vector3,t=new Euler,n=new Quaternion,i=new Vector3(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this}rotateX(e){return this.rotateOnAxis(_xAxis,e)}rotateY(e){return this.rotateOnAxis(_yAxis,e)}rotateZ(e){return this.rotateOnAxis(_zAxis,e)}translateOnAxis(e,t){return _v1$4.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_xAxis,e)}translateY(e){return this.translateOnAxis(_yAxis,e)}translateZ(e){return this.translateOnAxis(_zAxis,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?_target.copy(e):_target.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),i&&(_m1$1.extractRotation(i.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_removedEvent)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectsByProperty(e,t);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,e,_scale$2),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++){const a=i[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let d=0,u=l.length;d<u;d++){const g=l[d];s(e.shapes,g)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,d=this.material.length;l<d;l++)a.push(s(e.materials,this.material[l]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),d=o(e.textures),u=o(e.images),g=o(e.shapes),x=o(e.skeletons),y=o(e.animations),b=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),d.length>0&&(n.textures=d),u.length>0&&(n.images=u),g.length>0&&(n.shapes=g),x.length>0&&(n.skeletons=x),y.length>0&&(n.animations=y),b.length>0&&(n.nodes=b)}return n.object=i,n;function o(a){const l=[];for(const d in a){const u=a[d];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(e=new Vector3,t=new Vector3,n=new Vector3){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),_v0$1.subVectors(e,t),i.cross(_v0$1);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){_v0$1.subVectors(i,t),_v1$3.subVectors(n,t),_v2$2.subVectors(e,t);const o=_v0$1.dot(_v0$1),a=_v0$1.dot(_v1$3),l=_v0$1.dot(_v2$2),d=_v1$3.dot(_v1$3),u=_v1$3.dot(_v2$2),g=o*d-a*a;if(g===0)return s.set(-2,-1,-1);const x=1/g,y=(d*l-a*u)*x,b=(o*u-a*l)*x;return s.set(1-y-b,b,y)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(e,t,n,i,s,o,a,l){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(e,t,n,i,s,o,a,l)}static getInterpolation(e,t,n,i,s,o,a,l){return this.getBarycoord(e,t,n,i,_v3$1),l.setScalar(0),l.addScaledVector(s,_v3$1.x),l.addScaledVector(o,_v3$1.y),l.addScaledVector(a,_v3$1.z),l}static isFrontFacing(e,t,n,i){return _v0$1.subVectors(n,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,s){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}getInterpolation(e,t,n,i,s){return Triangle.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let o,a;_vab.subVectors(i,n),_vac.subVectors(s,n),_vap.subVectors(e,n);const l=_vab.dot(_vap),d=_vac.dot(_vap);if(l<=0&&d<=0)return t.copy(n);_vbp.subVectors(e,i);const u=_vab.dot(_vbp),g=_vac.dot(_vbp);if(u>=0&&g<=u)return t.copy(i);const x=l*g-u*d;if(x<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(_vab,o);_vcp.subVectors(e,s);const y=_vab.dot(_vcp),b=_vac.dot(_vcp);if(b>=0&&y<=b)return t.copy(s);const _=y*d-l*b;if(_<=0&&d>=0&&b<=0)return a=d/(d-b),t.copy(n).addScaledVector(_vac,a);const h=u*b-y*g;if(h<=0&&g-u>=0&&y-b>=0)return _vbc.subVectors(s,i),a=(g-u)/(g-u+(y-b)),t.copy(i).addScaledVector(_vbc,a);const f=1/(h+_+x);return o=_*f,a=x*f,t.copy(n).addScaledVector(_vab,o).addScaledVector(_vac,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class Color{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=SRGBColorSpace){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ColorManagement.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=ColorManagement.workingColorSpace){return this.r=e,this.g=t,this.b=n,ColorManagement.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=ColorManagement.workingColorSpace){if(e=euclideanModulo(e,1),t=clamp(t,0,1),n=clamp(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=hue2rgb(o,s,e+1/3),this.g=hue2rgb(o,s,e),this.b=hue2rgb(o,s,e-1/3)}return ColorManagement.toWorkingColorSpace(this,i),this}setStyle(e,t=SRGBColorSpace){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=SRGBColorSpace){const n=_colorKeywords[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),e),Math.round(clamp(_color.r*255,0,255))*65536+Math.round(clamp(_color.g*255,0,255))*256+Math.round(clamp(_color.b*255,0,255))}getHexString(e=SRGBColorSpace){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),t);const n=_color.r,i=_color.g,s=_color.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let l,d;const u=(a+o)/2;if(a===o)l=0,d=0;else{const g=o-a;switch(d=u<=.5?g/(o+a):g/(2-o-a),o){case n:l=(i-s)/g+(i<s?6:0);break;case i:l=(s-n)/g+2;break;case s:l=(n-i)/g+4;break}l/=6}return e.h=l,e.s=d,e.l=u,e}getRGB(e,t=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),t),e.r=_color.r,e.g=_color.g,e.b=_color.b,e}getStyle(e=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),e);const t=_color.r,n=_color.g,i=_color.b;return e!==SRGBColorSpace?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(_hslA),this.setHSL(_hslA.h+e,_hslA.s+t,_hslA.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(_hslA),e.getHSL(_hslB);const n=lerp(_hslA.h,_hslB.h,t),i=lerp(_hslA.s,_hslB.s,t),s=lerp(_hslA.l,_hslB.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(n.blending=this.blending),this.side!==FrontSide&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(n.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(n.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(n.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=i(e.textures),o=i(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class MeshBasicMaterial extends Material{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const _vector$8=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)_vector2$1.fromBufferAttribute(this,t),_vector2$1.applyMatrix3(e),this.setXY(t,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)_vector$8.fromBufferAttribute(this,t),_vector$8.applyMatrix3(e),this.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)_vector$8.fromBufferAttribute(this,t),_vector$8.applyMatrix4(e),this.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)_vector$8.fromBufferAttribute(this,t),_vector$8.applyNormalMatrix(e),this.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)_vector$8.fromBufferAttribute(this,t),_vector$8.transformDirection(e),this.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=denormalize(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=normalize$1(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=denormalize(t,this.array)),t}setX(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=denormalize(t,this.array)),t}setY(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=denormalize(t,this.array)),t}setZ(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=denormalize(t,this.array)),t}setW(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),n=normalize$1(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),n=normalize$1(n,this.array),i=normalize$1(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),n=normalize$1(n,this.array),i=normalize$1(i,this.array),s=normalize$1(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==StaticDrawUsage&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class Uint16BufferAttribute extends BufferAttribute{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Uint32BufferAttribute extends BufferAttribute{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Float32BufferAttribute extends BufferAttribute{constructor(e,t,n){super(new Float32Array(e),t,n)}}let _id$2=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$7=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(arrayNeedsUint32(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Matrix3().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return _m1.makeRotationFromQuaternion(e),this.applyMatrix4(_m1),this}rotateX(e){return _m1.makeRotationX(e),this.applyMatrix4(_m1),this}rotateY(e){return _m1.makeRotationY(e),this.applyMatrix4(_m1),this}rotateZ(e){return _m1.makeRotationZ(e),this.applyMatrix4(_m1),this}translate(e,t,n){return _m1.makeTranslation(e,t,n),this.applyMatrix4(_m1),this}scale(e,t,n){return _m1.makeScale(e,t,n),this.applyMatrix4(_m1),this}lookAt(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const s=t[n];_box$1.setFromBufferAttribute(s),this.morphTargetsRelative?(_vector$7.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$7),_vector$7.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$7)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(e){const n=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];_boxMorphTargets.setFromBufferAttribute(a),this.morphTargetsRelative?(_vector$7.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$7),_vector$7.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$7)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(n);let i=0;for(let s=0,o=e.count;s<o;s++)_vector$7.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(_vector$7));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let d=0,u=a.count;d<u;d++)_vector$7.fromBufferAttribute(a,d),l&&(_offset.fromBufferAttribute(e,d),_vector$7.add(_offset)),i=Math.max(i,n.distanceToSquared(_vector$7))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,i=t.position.array,s=t.normal.array,o=t.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,d=[],u=[];for(let R=0;R<a;R++)d[R]=new Vector3,u[R]=new Vector3;const g=new Vector3,x=new Vector3,y=new Vector3,b=new Vector2,_=new Vector2,h=new Vector2,f=new Vector3,E=new Vector3;function m(R,O,L){g.fromArray(i,R*3),x.fromArray(i,O*3),y.fromArray(i,L*3),b.fromArray(o,R*2),_.fromArray(o,O*2),h.fromArray(o,L*2),x.sub(g),y.sub(g),_.sub(b),h.sub(b);const P=1/(_.x*h.y-h.x*_.y);isFinite(P)&&(f.copy(x).multiplyScalar(h.y).addScaledVector(y,-_.y).multiplyScalar(P),E.copy(y).multiplyScalar(_.x).addScaledVector(x,-h.x).multiplyScalar(P),d[R].add(f),d[O].add(f),d[L].add(f),u[R].add(E),u[O].add(E),u[L].add(E))}let S=this.groups;S.length===0&&(S=[{start:0,count:n.length}]);for(let R=0,O=S.length;R<O;++R){const L=S[R],P=L.start,I=L.count;for(let N=P,U=P+I;N<U;N+=3)m(n[N+0],n[N+1],n[N+2])}const w=new Vector3,v=new Vector3,A=new Vector3,M=new Vector3;function T(R){A.fromArray(s,R*3),M.copy(A);const O=d[R];w.copy(O),w.sub(A.multiplyScalar(A.dot(O))).normalize(),v.crossVectors(M,O);const P=v.dot(u[R])<0?-1:1;l[R*4]=w.x,l[R*4+1]=w.y,l[R*4+2]=w.z,l[R*4+3]=P}for(let R=0,O=S.length;R<O;++R){const L=S[R],P=L.start,I=L.count;for(let N=P,U=P+I;N<U;N+=3)T(n[N+0]),T(n[N+1]),T(n[N+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new BufferAttribute(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let x=0,y=n.count;x<y;x++)n.setXYZ(x,0,0,0);const i=new Vector3,s=new Vector3,o=new Vector3,a=new Vector3,l=new Vector3,d=new Vector3,u=new Vector3,g=new Vector3;if(e)for(let x=0,y=e.count;x<y;x+=3){const b=e.getX(x+0),_=e.getX(x+1),h=e.getX(x+2);i.fromBufferAttribute(t,b),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,h),u.subVectors(o,s),g.subVectors(i,s),u.cross(g),a.fromBufferAttribute(n,b),l.fromBufferAttribute(n,_),d.fromBufferAttribute(n,h),a.add(u),l.add(u),d.add(u),n.setXYZ(b,a.x,a.y,a.z),n.setXYZ(_,l.x,l.y,l.z),n.setXYZ(h,d.x,d.y,d.z)}else for(let x=0,y=t.count;x<y;x+=3)i.fromBufferAttribute(t,x+0),s.fromBufferAttribute(t,x+1),o.fromBufferAttribute(t,x+2),u.subVectors(o,s),g.subVectors(i,s),u.cross(g),n.setXYZ(x+0,u.x,u.y,u.z),n.setXYZ(x+1,u.x,u.y,u.z),n.setXYZ(x+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)_vector$7.fromBufferAttribute(e,t),_vector$7.normalize(),e.setXYZ(t,_vector$7.x,_vector$7.y,_vector$7.z)}toNonIndexed(){function e(a,l){const d=a.array,u=a.itemSize,g=a.normalized,x=new d.constructor(l.length*u);let y=0,b=0;for(let _=0,h=l.length;_<h;_++){a.isInterleavedBufferAttribute?y=l[_]*a.data.stride+a.offset:y=l[_]*u;for(let f=0;f<u;f++)x[b++]=d[y++]}return new BufferAttribute(x,u,g)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new BufferGeometry,n=this.index.array,i=this.attributes;for(const a in i){const l=i[a],d=e(l,n);t.setAttribute(a,d)}const s=this.morphAttributes;for(const a in s){const l=[],d=s[a];for(let u=0,g=d.length;u<g;u++){const x=d[u],y=e(x,n);l.push(y)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const d=o[a];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const d in l)l[d]!==void 0&&(e[d]=l[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const d=n[l];e.data.attributes[l]=d.toJSON(e.data)}const i={};let s=!1;for(const l in this.morphAttributes){const d=this.morphAttributes[l],u=[];for(let g=0,x=d.length;g<x;g++){const y=d[g];u.push(y.toJSON(e.data))}u.length>0&&(i[l]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const i=e.attributes;for(const d in i){const u=i[d];this.setAttribute(d,u.clone(t))}const s=e.morphAttributes;for(const d in s){const u=[],g=s[d];for(let x=0,y=g.length;x<y;x++)u.push(g[x].clone(t));this.morphAttributes[d]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let d=0,u=o.length;d<u;d++){const g=o[d];this.addGroup(g.start,g.count,g.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$5=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(e=new BufferGeometry,t=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){_morphA.set(0,0,0);for(let l=0,d=s.length;l<d;l++){const u=a[l],g=s[l];u!==0&&(_tempA.fromBufferAttribute(g,e),o?_morphA.addScaledVector(_tempA,u):_morphA.addScaledVector(_tempA.sub(t),u))}t.add(_morphA)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere$5.copy(n.boundingSphere),_sphere$5.applyMatrix4(s),_ray$3.copy(e.ray).recast(e.near),!(_sphere$5.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$5,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(e.far-e.near)**2))&&(_inverseMatrix$3.copy(s).invert(),_ray$3.copy(e.ray).applyMatrix4(_inverseMatrix$3),!(n.boundingBox!==null&&_ray$3.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,_ray$3)))}_computeIntersections(e,t,n){let i;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,d=s.attributes.uv,u=s.attributes.uv1,g=s.attributes.normal,x=s.groups,y=s.drawRange;if(a!==null)if(Array.isArray(o))for(let b=0,_=x.length;b<_;b++){const h=x[b],f=o[h.materialIndex],E=Math.max(h.start,y.start),m=Math.min(a.count,Math.min(h.start+h.count,y.start+y.count));for(let S=E,w=m;S<w;S+=3){const v=a.getX(S),A=a.getX(S+1),M=a.getX(S+2);i=checkGeometryIntersection(this,f,e,n,d,u,g,v,A,M),i&&(i.faceIndex=Math.floor(S/3),i.face.materialIndex=h.materialIndex,t.push(i))}}else{const b=Math.max(0,y.start),_=Math.min(a.count,y.start+y.count);for(let h=b,f=_;h<f;h+=3){const E=a.getX(h),m=a.getX(h+1),S=a.getX(h+2);i=checkGeometryIntersection(this,o,e,n,d,u,g,E,m,S),i&&(i.faceIndex=Math.floor(h/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(o))for(let b=0,_=x.length;b<_;b++){const h=x[b],f=o[h.materialIndex],E=Math.max(h.start,y.start),m=Math.min(l.count,Math.min(h.start+h.count,y.start+y.count));for(let S=E,w=m;S<w;S+=3){const v=S,A=S+1,M=S+2;i=checkGeometryIntersection(this,f,e,n,d,u,g,v,A,M),i&&(i.faceIndex=Math.floor(S/3),i.face.materialIndex=h.materialIndex,t.push(i))}}else{const b=Math.max(0,y.start),_=Math.min(l.count,y.start+y.count);for(let h=b,f=_;h<f;h+=3){const E=h,m=h+1,S=h+2;i=checkGeometryIntersection(this,o,e,n,d,u,g,E,m,S),i&&(i.faceIndex=Math.floor(h/3),t.push(i))}}}}function checkIntersection(r,e,t,n,i,s,o,a){let l;if(e.side===BackSide?l=n.intersectTriangle(o,s,i,!0,a):l=n.intersectTriangle(i,s,o,e.side===FrontSide,a),l===null)return null;_intersectionPointWorld.copy(a),_intersectionPointWorld.applyMatrix4(r.matrixWorld);const d=t.ray.origin.distanceTo(_intersectionPointWorld);return d<t.near||d>t.far?null:{distance:d,point:_intersectionPointWorld.clone(),object:r}}function checkGeometryIntersection(r,e,t,n,i,s,o,a,l,d){r.getVertexPosition(a,_vA$1),r.getVertexPosition(l,_vB$1),r.getVertexPosition(d,_vC$1);const u=checkIntersection(r,e,t,n,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(u){i&&(_uvA$1.fromBufferAttribute(i,a),_uvB$1.fromBufferAttribute(i,l),_uvC$1.fromBufferAttribute(i,d),u.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),s&&(_uvA$1.fromBufferAttribute(s,a),_uvB$1.fromBufferAttribute(s,l),_uvC$1.fromBufferAttribute(s,d),u.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),u.uv2=u.uv1),o&&(_normalA.fromBufferAttribute(o,a),_normalB.fromBufferAttribute(o,l),_normalC.fromBufferAttribute(o,d),u.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const g={a,b:l,c:d,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,g.normal),u.face=g}return u}class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,n=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const l=[],d=[],u=[],g=[];let x=0,y=0;b("z","y","x",-1,-1,n,t,e,o,s,0),b("z","y","x",1,-1,n,t,-e,o,s,1),b("x","z","y",1,1,e,n,t,i,o,2),b("x","z","y",1,-1,e,n,-t,i,o,3),b("x","y","z",1,-1,e,t,n,i,s,4),b("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2));function b(_,h,f,E,m,S,w,v,A,M,T){const R=S/A,O=w/M,L=S/2,P=w/2,I=v/2,N=A+1,U=M+1;let F=0,k=0;const j=new Vector3;for(let H=0;H<U;H++){const B=H*O-P;for(let V=0;V<N;V++){const Y=V*R-L;j[_]=Y*E,j[h]=B*m,j[f]=I,d.push(j.x,j.y,j.z),j[_]=0,j[h]=0,j[f]=v>0?1:-1,u.push(j.x,j.y,j.z),g.push(V/A),g.push(1-H/M),F+=1}}for(let H=0;H<M;H++)for(let B=0;B<A;B++){const V=x+B+N*H,Y=x+B+N*(H+1),K=x+(B+1)+N*(H+1),J=x+(B+1)+N*H;l.push(V,Y,J),l.push(Y,K,J),k+=6}a.addGroup(y,k,T),y+=k,x+=F}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cloneUniforms(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const i=r[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function mergeUniforms(r){const e={};for(let t=0;t<r.length;t++){const n=cloneUniforms(r[t]);for(const i in n)e[i]=n[i]}return e}function cloneUniformsGroups(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function getUnlitUniformColorSpace(r){return r.getRenderTarget()===null?r.outputColorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.uniformsGroups=cloneUniformsGroups(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}let Camera$1=class extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};class PerspectiveCamera extends Camera$1{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,d=o.fullHeight;s+=o.offsetX*i/l,t-=o.offsetY*n/d,i*=o.width/l,n*=o.height/d}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new PerspectiveCamera(fov,aspect,e,t);i.layers=this.layers,this.add(i);const s=new PerspectiveCamera(fov,aspect,e,t);s.layers=this.layers,this.add(s);const o=new PerspectiveCamera(fov,aspect,e,t);o.layers=this.layers,this.add(o);const a=new PerspectiveCamera(fov,aspect,e,t);a.layers=this.layers,this.add(a);const l=new PerspectiveCamera(fov,aspect,e,t);l.layers=this.layers,this.add(l);const d=new PerspectiveCamera(fov,aspect,e,t);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,o,a,l]=t;for(const d of t)this.remove(d);if(e===WebGLCoordinateSystem)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===WebGPUCoordinateSystem)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of t)this.add(d),d.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,d,u]=this.children,g=e.getRenderTarget(),x=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),b=e.xr.enabled;e.xr.enabled=!1;const _=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,s),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,a),e.setRenderTarget(n,3,i),e.render(t,l),e.setRenderTarget(n,4,i),e.render(t,d),n.texture.generateMipmaps=_,e.setRenderTarget(n,5,i),e.render(t,u),e.setRenderTarget(g,x,y),e.xr.enabled=b,n.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(e,t,n,i,s,o,a,l,d,u){e=e!==void 0?e:[],t=t!==void 0?t:CubeReflectionMapping,super(e,t,n,i,s,o,a,l,d,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];t.encoding!==void 0&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new CubeTexture(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:LinearFilter}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new BoxGeometry(5,5,5),s=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:BackSide,blending:NoBlending});s.uniforms.tEquirect.value=t;const o=new Mesh(i,s),a=t.minFilter;return t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter),new CubeCamera(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(s)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=_vector1.subVectors(n,t).cross(_vector2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(_vector1),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||_normalMatrix.getNormalMatrix(e),i=this.coplanarPoint(_vector1).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$4=new Sphere,_vector$6=new Vector3;class Frustum{constructor(e=new Plane,t=new Plane,n=new Plane,i=new Plane,s=new Plane,o=new Plane){this.planes=[e,t,n,i,s,o]}set(e,t,n,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=WebGLCoordinateSystem){const n=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],l=i[3],d=i[4],u=i[5],g=i[6],x=i[7],y=i[8],b=i[9],_=i[10],h=i[11],f=i[12],E=i[13],m=i[14],S=i[15];if(n[0].setComponents(l-s,x-d,h-y,S-f).normalize(),n[1].setComponents(l+s,x+d,h+y,S+f).normalize(),n[2].setComponents(l+o,x+u,h+b,S+E).normalize(),n[3].setComponents(l-o,x-u,h-b,S-E).normalize(),n[4].setComponents(l-a,x-g,h-_,S-m).normalize(),t===WebGLCoordinateSystem)n[5].setComponents(l+a,x+g,h+_,S+m).normalize();else if(t===WebGPUCoordinateSystem)n[5].setComponents(a,g,_,m).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),_sphere$4.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),_sphere$4.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(_sphere$4)}intersectsSprite(e){return _sphere$4.center.set(0,0,0),_sphere$4.radius=.7071067811865476,_sphere$4.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(_vector$6.x=i.normal.x>0?e.max.x:e.min.x,_vector$6.y=i.normal.y>0?e.max.y:e.min.y,_vector$6.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let r=null,e=!1,t=null,n=null;function i(s,o){t(s,o),n=r.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(i),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){r=s}}}function WebGLAttributes(r,e){const t=e.isWebGL2,n=new WeakMap;function i(d,u){const g=d.array,x=d.usage,y=r.createBuffer();r.bindBuffer(u,y),r.bufferData(u,g,x),d.onUploadCallback();let b;if(g instanceof Float32Array)b=r.FLOAT;else if(g instanceof Uint16Array)if(d.isFloat16BufferAttribute)if(t)b=r.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else b=r.UNSIGNED_SHORT;else if(g instanceof Int16Array)b=r.SHORT;else if(g instanceof Uint32Array)b=r.UNSIGNED_INT;else if(g instanceof Int32Array)b=r.INT;else if(g instanceof Int8Array)b=r.BYTE;else if(g instanceof Uint8Array)b=r.UNSIGNED_BYTE;else if(g instanceof Uint8ClampedArray)b=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+g);return{buffer:y,type:b,bytesPerElement:g.BYTES_PER_ELEMENT,version:d.version}}function s(d,u,g){const x=u.array,y=u.updateRange;r.bindBuffer(g,d),y.count===-1?r.bufferSubData(g,0,x):(t?r.bufferSubData(g,y.offset*x.BYTES_PER_ELEMENT,x,y.offset,y.count):r.bufferSubData(g,y.offset*x.BYTES_PER_ELEMENT,x.subarray(y.offset,y.offset+y.count)),y.count=-1),u.onUploadCallback()}function o(d){return d.isInterleavedBufferAttribute&&(d=d.data),n.get(d)}function a(d){d.isInterleavedBufferAttribute&&(d=d.data);const u=n.get(d);u&&(r.deleteBuffer(u.buffer),n.delete(d))}function l(d,u){if(d.isGLBufferAttribute){const x=n.get(d);(!x||x.version<d.version)&&n.set(d,{buffer:d.buffer,type:d.type,bytesPerElement:d.elementSize,version:d.version});return}d.isInterleavedBufferAttribute&&(d=d.data);const g=n.get(d);g===void 0?n.set(d,i(d,u)):g.version<d.version&&(s(g.buffer,d,u),g.version=d.version)}return{get:o,remove:a,update:l}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(i),d=a+1,u=l+1,g=e/a,x=t/l,y=[],b=[],_=[],h=[];for(let f=0;f<u;f++){const E=f*x-o;for(let m=0;m<d;m++){const S=m*g-s;b.push(S,-E,0),_.push(0,0,1),h.push(m/a),h.push(1-f/l)}}for(let f=0;f<l;f++)for(let E=0;E<a;E++){const m=E+d*f,S=E+d*(f+1),w=E+1+d*(f+1),v=E+1+d*f;y.push(m,S,v),y.push(S,w,v)}this.setIndex(y),this.setAttribute("position",new Float32BufferAttribute(b,3)),this.setAttribute("normal",new Float32BufferAttribute(_,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0};function WebGLBackground(r,e,t,n,i,s,o){const a=new Color(0);let l=s===!0?0:1,d,u,g=null,x=0,y=null;function b(h,f){let E=!1,m=f.isScene===!0?f.background:null;m&&m.isTexture&&(m=(f.backgroundBlurriness>0?t:e).get(m)),m===null?_(a,l):m&&m.isColor&&(_(m,1),E=!0);const S=r.xr.getEnvironmentBlendMode();S==="additive"?n.buffers.color.setClear(0,0,0,1,o):S==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(r.autoClear||E)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),m&&(m.isCubeTexture||m.mapping===CubeUVReflectionMapping)?(u===void 0&&(u=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(w,v,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),u.material.uniforms.envMap.value=m,u.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,u.material.toneMapped=ColorManagement.getTransfer(m.colorSpace)!==SRGBTransfer,(g!==m||x!==m.version||y!==r.toneMapping)&&(u.material.needsUpdate=!0,g=m,x=m.version,y=r.toneMapping),u.layers.enableAll(),h.unshift(u,u.geometry,u.material,0,0,null)):m&&m.isTexture&&(d===void 0&&(d=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(d)),d.material.uniforms.t2D.value=m,d.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,d.material.toneMapped=ColorManagement.getTransfer(m.colorSpace)!==SRGBTransfer,m.matrixAutoUpdate===!0&&m.updateMatrix(),d.material.uniforms.uvTransform.value.copy(m.matrix),(g!==m||x!==m.version||y!==r.toneMapping)&&(d.material.needsUpdate=!0,g=m,x=m.version,y=r.toneMapping),d.layers.enableAll(),h.unshift(d,d.geometry,d.material,0,0,null))}function _(h,f){h.getRGB(_rgb,getUnlitUniformColorSpace(r)),n.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,f,o)}return{getClearColor:function(){return a},setClearColor:function(h,f=1){a.set(h),l=f,_(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(h){l=h,_(a,l)},render:b}}function WebGLBindingStates(r,e,t,n){const i=r.getParameter(r.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=h(null);let d=l,u=!1;function g(I,N,U,F,k){let j=!1;if(o){const H=_(F,U,N);d!==H&&(d=H,y(d.object)),j=f(I,F,U,k),j&&E(I,F,U,k)}else{const H=N.wireframe===!0;(d.geometry!==F.id||d.program!==U.id||d.wireframe!==H)&&(d.geometry=F.id,d.program=U.id,d.wireframe=H,j=!0)}k!==null&&t.update(k,r.ELEMENT_ARRAY_BUFFER),(j||u)&&(u=!1,M(I,N,U,F),k!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.get(k).buffer))}function x(){return n.isWebGL2?r.createVertexArray():s.createVertexArrayOES()}function y(I){return n.isWebGL2?r.bindVertexArray(I):s.bindVertexArrayOES(I)}function b(I){return n.isWebGL2?r.deleteVertexArray(I):s.deleteVertexArrayOES(I)}function _(I,N,U){const F=U.wireframe===!0;let k=a[I.id];k===void 0&&(k={},a[I.id]=k);let j=k[N.id];j===void 0&&(j={},k[N.id]=j);let H=j[F];return H===void 0&&(H=h(x()),j[F]=H),H}function h(I){const N=[],U=[],F=[];for(let k=0;k<i;k++)N[k]=0,U[k]=0,F[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:N,enabledAttributes:U,attributeDivisors:F,object:I,attributes:{},index:null}}function f(I,N,U,F){const k=d.attributes,j=N.attributes;let H=0;const B=U.getAttributes();for(const V in B)if(B[V].location>=0){const K=k[V];let J=j[V];if(J===void 0&&(V==="instanceMatrix"&&I.instanceMatrix&&(J=I.instanceMatrix),V==="instanceColor"&&I.instanceColor&&(J=I.instanceColor)),K===void 0||K.attribute!==J||J&&K.data!==J.data)return!0;H++}return d.attributesNum!==H||d.index!==F}function E(I,N,U,F){const k={},j=N.attributes;let H=0;const B=U.getAttributes();for(const V in B)if(B[V].location>=0){let K=j[V];K===void 0&&(V==="instanceMatrix"&&I.instanceMatrix&&(K=I.instanceMatrix),V==="instanceColor"&&I.instanceColor&&(K=I.instanceColor));const J={};J.attribute=K,K&&K.data&&(J.data=K.data),k[V]=J,H++}d.attributes=k,d.attributesNum=H,d.index=F}function m(){const I=d.newAttributes;for(let N=0,U=I.length;N<U;N++)I[N]=0}function S(I){w(I,0)}function w(I,N){const U=d.newAttributes,F=d.enabledAttributes,k=d.attributeDivisors;U[I]=1,F[I]===0&&(r.enableVertexAttribArray(I),F[I]=1),k[I]!==N&&((n.isWebGL2?r:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](I,N),k[I]=N)}function v(){const I=d.newAttributes,N=d.enabledAttributes;for(let U=0,F=N.length;U<F;U++)N[U]!==I[U]&&(r.disableVertexAttribArray(U),N[U]=0)}function A(I,N,U,F,k,j,H){H===!0?r.vertexAttribIPointer(I,N,U,k,j):r.vertexAttribPointer(I,N,U,F,k,j)}function M(I,N,U,F){if(n.isWebGL2===!1&&(I.isInstancedMesh||F.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();const k=F.attributes,j=U.getAttributes(),H=N.defaultAttributeValues;for(const B in j){const V=j[B];if(V.location>=0){let Y=k[B];if(Y===void 0&&(B==="instanceMatrix"&&I.instanceMatrix&&(Y=I.instanceMatrix),B==="instanceColor"&&I.instanceColor&&(Y=I.instanceColor)),Y!==void 0){const K=Y.normalized,J=Y.itemSize,Te=t.get(Y);if(Te===void 0)continue;const He=Te.buffer,Q=Te.type,Xe=Te.bytesPerElement,ut=n.isWebGL2===!0&&(Q===r.INT||Q===r.UNSIGNED_INT||Y.gpuType===IntType);if(Y.isInterleavedBufferAttribute){const Ji=Y.data,er=Ji.stride,ec=Y.offset;if(Ji.isInstancedInterleavedBuffer){for(let ai=0;ai<V.locationSize;ai++)w(V.location+ai,Ji.meshPerAttribute);I.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Ji.meshPerAttribute*Ji.count)}else for(let ai=0;ai<V.locationSize;ai++)S(V.location+ai);r.bindBuffer(r.ARRAY_BUFFER,He);for(let ai=0;ai<V.locationSize;ai++)A(V.location+ai,J/V.locationSize,Q,K,er*Xe,(ec+J/V.locationSize*ai)*Xe,ut)}else{if(Y.isInstancedBufferAttribute){for(let Ji=0;Ji<V.locationSize;Ji++)w(V.location+Ji,Y.meshPerAttribute);I.isInstancedMesh!==!0&&F._maxInstanceCount===void 0&&(F._maxInstanceCount=Y.meshPerAttribute*Y.count)}else for(let Ji=0;Ji<V.locationSize;Ji++)S(V.location+Ji);r.bindBuffer(r.ARRAY_BUFFER,He);for(let Ji=0;Ji<V.locationSize;Ji++)A(V.location+Ji,J/V.locationSize,Q,K,J*Xe,J/V.locationSize*Ji*Xe,ut)}}else if(H!==void 0){const K=H[B];if(K!==void 0)switch(K.length){case 2:r.vertexAttrib2fv(V.location,K);break;case 3:r.vertexAttrib3fv(V.location,K);break;case 4:r.vertexAttrib4fv(V.location,K);break;default:r.vertexAttrib1fv(V.location,K)}}}}v()}function T(){L();for(const I in a){const N=a[I];for(const U in N){const F=N[U];for(const k in F)b(F[k].object),delete F[k];delete N[U]}delete a[I]}}function R(I){if(a[I.id]===void 0)return;const N=a[I.id];for(const U in N){const F=N[U];for(const k in F)b(F[k].object),delete F[k];delete N[U]}delete a[I.id]}function O(I){for(const N in a){const U=a[N];if(U[I.id]===void 0)continue;const F=U[I.id];for(const k in F)b(F[k].object),delete F[k];delete U[I.id]}}function L(){P(),u=!0,d!==l&&(d=l,y(d.object))}function P(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:g,reset:L,resetDefaultState:P,dispose:T,releaseStatesOfGeometry:R,releaseStatesOfProgram:O,initAttributes:m,enableAttribute:S,disableUnusedAttributes:v}}function WebGLBufferRenderer(r,e,t,n){const i=n.isWebGL2;let s;function o(d){s=d}function a(d,u){r.drawArrays(s,d,u),t.update(u,s,1)}function l(d,u,g){if(g===0)return;let x,y;if(i)x=r,y="drawArraysInstanced";else if(x=e.get("ANGLE_instanced_arrays"),y="drawArraysInstancedANGLE",x===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}x[y](s,d,u,g),t.update(u,s,g)}this.setMode=o,this.render=a,this.renderInstances=l}function WebGLCapabilities(r,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const A=e.get("EXT_texture_filter_anisotropic");n=r.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(A){if(A==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";A="mediump"}return A==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&r.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const d=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,g=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),x=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),y=r.getParameter(r.MAX_TEXTURE_SIZE),b=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),_=r.getParameter(r.MAX_VERTEX_ATTRIBS),h=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),f=r.getParameter(r.MAX_VARYING_VECTORS),E=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),m=x>0,S=o||e.has("OES_texture_float"),w=m&&S,v=o?r.getParameter(r.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:d,getMaxAnisotropy:i,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:g,maxVertexTextures:x,maxTextureSize:y,maxCubemapSize:b,maxAttributes:_,maxVertexUniforms:h,maxVaryings:f,maxFragmentUniforms:E,vertexTextures:m,floatFragmentTextures:S,floatVertexTextures:w,maxSamples:v}}function WebGLClipping(r){const e=this;let t=null,n=0,i=!1,s=!1;const o=new Plane,a=new Matrix3,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(g,x){const y=g.length!==0||x||n!==0||i;return i=x,n=g.length,y},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(g,x){t=u(g,x,0)},this.setState=function(g,x,y){const b=g.clippingPlanes,_=g.clipIntersection,h=g.clipShadows,f=r.get(g);if(!i||b===null||b.length===0||s&&!h)s?u(null):d();else{const E=s?0:n,m=E*4;let S=f.clippingState||null;l.value=S,S=u(b,x,m,y);for(let w=0;w!==m;++w)S[w]=t[w];f.clippingState=S,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=E}};function d(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(g,x,y,b){const _=g!==null?g.length:0;let h=null;if(_!==0){if(h=l.value,b!==!0||h===null){const f=y+_*4,E=x.matrixWorldInverse;a.getNormalMatrix(E),(h===null||h.length<f)&&(h=new Float32Array(f));for(let m=0,S=y;m!==_;++m,S+=4)o.copy(g[m]).applyMatrix4(E,a),o.normal.toArray(h,S),h[S+3]=o.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,h}}function WebGLCubeMaps(r){let e=new WeakMap;function t(o,a){return a===EquirectangularReflectionMapping?o.mapping=CubeReflectionMapping:a===EquirectangularRefractionMapping&&(o.mapping=CubeRefractionMapping),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===EquirectangularReflectionMapping||a===EquirectangularRefractionMapping)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const d=new WebGLCubeRenderTarget(l.height/2);return d.fromEquirectangularTexture(r,o),e.set(o,d),o.addEventListener("dispose",i),t(d.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}class OrthographicCamera extends Camera$1{constructor(e=-1,t=1,n=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=d*this.view.offsetX,o=s+d*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),e.scissorTest=!1,_setViewport(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},i=_createRenderTarget(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(s)),this._blurMaterial=_getBlurShader(s,e,t)}return i}_compileMaterial(e){const t=new Mesh(this._lodPlanes[0],e);this._renderer.compile(t,_flatCamera)}_sceneToCubeUV(e,t,n,i){const a=new PerspectiveCamera(90,1,t,n),l=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],u=this._renderer,g=u.autoClear,x=u.toneMapping;u.getClearColor(_clearColor),u.toneMapping=NoToneMapping,u.autoClear=!1;const y=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),b=new Mesh(new BoxGeometry,y);let _=!1;const h=e.background;h?h.isColor&&(y.color.copy(h),e.background=null,_=!0):(y.color.copy(_clearColor),_=!0);for(let f=0;f<6;f++){const E=f%3;E===0?(a.up.set(0,l[f],0),a.lookAt(d[f],0,0)):E===1?(a.up.set(0,0,l[f]),a.lookAt(0,d[f],0)):(a.up.set(0,l[f],0),a.lookAt(0,0,d[f]));const m=this._cubeSize;_setViewport(i,E*m,f>2?m:0,m,m),u.setRenderTarget(i),_&&u.render(b,a),u.render(e,a)}b.geometry.dispose(),b.material.dispose(),u.toneMapping=x,u.autoClear=g,e.background=h}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new Mesh(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;_setViewport(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,_flatCamera)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const s=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),o=_axisDirections[(i-1)%_axisDirections.length];this._blur(e,i-1,i,s,o)}t.autoClear=n}_blur(e,t,n,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",s),this._halfBlur(o,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,o,a){const l=this._renderer,d=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,g=new Mesh(this._lodPlanes[i],d),x=d.uniforms,y=this._sizeLods[n]-1,b=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*MAX_SAMPLES-1),_=s/b,h=isFinite(s)?1+Math.floor(u*_):MAX_SAMPLES;h>MAX_SAMPLES&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${h} samples when the maximum is set to ${MAX_SAMPLES}`);const f=[];let E=0;for(let A=0;A<MAX_SAMPLES;++A){const M=A/_,T=Math.exp(-M*M/2);f.push(T),A===0?E+=T:A<h&&(E+=2*T)}for(let A=0;A<f.length;A++)f[A]=f[A]/E;x.envMap.value=e.texture,x.samples.value=h,x.weights.value=f,x.latitudinal.value=o==="latitudinal",a&&(x.poleAxis.value=a);const{_lodMax:m}=this;x.dTheta.value=b,x.mipInt.value=m-n;const S=this._sizeLods[i],w=3*S*(i>m-LOD_MIN?i-m+LOD_MIN:0),v=4*(this._cubeSize-S);_setViewport(t,w,v,3*S,2*S),l.setRenderTarget(t),l.render(g,_flatCamera)}}function _createPlanes(r){const e=[],t=[],n=[];let i=r;const s=r-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let l=1/a;o>r-LOD_MIN?l=EXTRA_LOD_SIGMA[o-r+LOD_MIN-1]:o===0&&(l=0),n.push(l);const d=1/(a-2),u=-d,g=1+d,x=[u,u,g,u,g,g,u,u,g,g,u,g],y=6,b=6,_=3,h=2,f=1,E=new Float32Array(_*b*y),m=new Float32Array(h*b*y),S=new Float32Array(f*b*y);for(let v=0;v<y;v++){const A=v%3*2/3-1,M=v>2?0:-1,T=[A,M,0,A+2/3,M,0,A+2/3,M+1,0,A,M,0,A+2/3,M+1,0,A,M+1,0];E.set(T,_*b*v),m.set(x,h*b*v);const R=[v,v,v,v,v,v];S.set(R,f*b*v)}const w=new BufferGeometry;w.setAttribute("position",new BufferAttribute(E,_)),w.setAttribute("uv",new BufferAttribute(m,h)),w.setAttribute("faceIndex",new BufferAttribute(S,f)),e.push(w),i>LOD_MIN&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function _createRenderTarget(r,e,t){const n=new WebGLRenderTarget(r,e,t);return n.texture.mapping=CubeUVReflectionMapping,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function _setViewport(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function _getBlurShader(r,e,t){const n=new Float32Array(MAX_SAMPLES),i=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(r){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,d=l===EquirectangularReflectionMapping||l===EquirectangularRefractionMapping,u=l===CubeReflectionMapping||l===CubeRefractionMapping;if(d||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let g=e.get(a);return t===null&&(t=new PMREMGenerator(r)),g=d?t.fromEquirectangular(a,g):t.fromCubemap(a,g),e.set(a,g),g.texture}else{if(e.has(a))return e.get(a).texture;{const g=a.image;if(d&&g&&g.height>0||u&&g&&i(g)){t===null&&(t=new PMREMGenerator(r));const x=d?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,x),a.addEventListener("dispose",s),x.texture}else return null}}}return a}function i(a){let l=0;const d=6;for(let u=0;u<d;u++)a[u]!==void 0&&l++;return l===d}function s(a){const l=a.target;l.removeEventListener("dispose",s);const d=e.get(l);d!==void 0&&(e.delete(l),d.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function WebGLExtensions(r){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=r.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function WebGLGeometries(r,e,t,n){const i={},s=new WeakMap;function o(g){const x=g.target;x.index!==null&&e.remove(x.index);for(const b in x.attributes)e.remove(x.attributes[b]);for(const b in x.morphAttributes){const _=x.morphAttributes[b];for(let h=0,f=_.length;h<f;h++)e.remove(_[h])}x.removeEventListener("dispose",o),delete i[x.id];const y=s.get(x);y&&(e.remove(y),s.delete(x)),n.releaseStatesOfGeometry(x),x.isInstancedBufferGeometry===!0&&delete x._maxInstanceCount,t.memory.geometries--}function a(g,x){return i[x.id]===!0||(x.addEventListener("dispose",o),i[x.id]=!0,t.memory.geometries++),x}function l(g){const x=g.attributes;for(const b in x)e.update(x[b],r.ARRAY_BUFFER);const y=g.morphAttributes;for(const b in y){const _=y[b];for(let h=0,f=_.length;h<f;h++)e.update(_[h],r.ARRAY_BUFFER)}}function d(g){const x=[],y=g.index,b=g.attributes.position;let _=0;if(y!==null){const E=y.array;_=y.version;for(let m=0,S=E.length;m<S;m+=3){const w=E[m+0],v=E[m+1],A=E[m+2];x.push(w,v,v,A,A,w)}}else if(b!==void 0){const E=b.array;_=b.version;for(let m=0,S=E.length/3-1;m<S;m+=3){const w=m+0,v=m+1,A=m+2;x.push(w,v,v,A,A,w)}}else return;const h=new(arrayNeedsUint32(x)?Uint32BufferAttribute:Uint16BufferAttribute)(x,1);h.version=_;const f=s.get(g);f&&e.remove(f),s.set(g,h)}function u(g){const x=s.get(g);if(x){const y=g.index;y!==null&&x.version<y.version&&d(g)}else d(g);return s.get(g)}return{get:a,update:l,getWireframeAttribute:u}}function WebGLIndexedBufferRenderer(r,e,t,n){const i=n.isWebGL2;let s;function o(x){s=x}let a,l;function d(x){a=x.type,l=x.bytesPerElement}function u(x,y){r.drawElements(s,y,a,x*l),t.update(y,s,1)}function g(x,y,b){if(b===0)return;let _,h;if(i)_=r,h="drawElementsInstanced";else if(_=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",_===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}_[h](s,y,a,x*l,b),t.update(y,s,b)}this.setMode=o,this.setIndex=d,this.render=u,this.renderInstances=g}function WebGLInfo(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case r.TRIANGLES:t.triangles+=a*(s/3);break;case r.LINES:t.lines+=a*(s/2);break;case r.LINE_STRIP:t.lines+=a*(s-1);break;case r.LINE_LOOP:t.lines+=a*s;break;case r.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function numericalSort(r,e){return r[0]-e[0]}function absNumericalSort(r,e){return Math.abs(e[1])-Math.abs(r[1])}function WebGLMorphtargets(r,e,t){const n={},i=new Float32Array(8),s=new WeakMap,o=new Vector4,a=[];for(let d=0;d<8;d++)a[d]=[d,0];function l(d,u,g){const x=d.morphTargetInfluences;if(e.isWebGL2===!0){const b=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,_=b!==void 0?b.length:0;let h=s.get(u);if(h===void 0||h.count!==_){let N=function(){P.dispose(),s.delete(u),u.removeEventListener("dispose",N)};var y=N;h!==void 0&&h.texture.dispose();const m=u.morphAttributes.position!==void 0,S=u.morphAttributes.normal!==void 0,w=u.morphAttributes.color!==void 0,v=u.morphAttributes.position||[],A=u.morphAttributes.normal||[],M=u.morphAttributes.color||[];let T=0;m===!0&&(T=1),S===!0&&(T=2),w===!0&&(T=3);let R=u.attributes.position.count*T,O=1;R>e.maxTextureSize&&(O=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const L=new Float32Array(R*O*4*_),P=new DataArrayTexture(L,R,O,_);P.type=FloatType,P.needsUpdate=!0;const I=T*4;for(let U=0;U<_;U++){const F=v[U],k=A[U],j=M[U],H=R*O*4*U;for(let B=0;B<F.count;B++){const V=B*I;m===!0&&(o.fromBufferAttribute(F,B),L[H+V+0]=o.x,L[H+V+1]=o.y,L[H+V+2]=o.z,L[H+V+3]=0),S===!0&&(o.fromBufferAttribute(k,B),L[H+V+4]=o.x,L[H+V+5]=o.y,L[H+V+6]=o.z,L[H+V+7]=0),w===!0&&(o.fromBufferAttribute(j,B),L[H+V+8]=o.x,L[H+V+9]=o.y,L[H+V+10]=o.z,L[H+V+11]=j.itemSize===4?o.w:1)}}h={count:_,texture:P,size:new Vector2(R,O)},s.set(u,h),u.addEventListener("dispose",N)}let f=0;for(let m=0;m<x.length;m++)f+=x[m];const E=u.morphTargetsRelative?1:1-f;g.getUniforms().setValue(r,"morphTargetBaseInfluence",E),g.getUniforms().setValue(r,"morphTargetInfluences",x),g.getUniforms().setValue(r,"morphTargetsTexture",h.texture,t),g.getUniforms().setValue(r,"morphTargetsTextureSize",h.size)}else{const b=x===void 0?0:x.length;let _=n[u.id];if(_===void 0||_.length!==b){_=[];for(let S=0;S<b;S++)_[S]=[S,0];n[u.id]=_}for(let S=0;S<b;S++){const w=_[S];w[0]=S,w[1]=x[S]}_.sort(absNumericalSort);for(let S=0;S<8;S++)S<b&&_[S][1]?(a[S][0]=_[S][0],a[S][1]=_[S][1]):(a[S][0]=Number.MAX_SAFE_INTEGER,a[S][1]=0);a.sort(numericalSort);const h=u.morphAttributes.position,f=u.morphAttributes.normal;let E=0;for(let S=0;S<8;S++){const w=a[S],v=w[0],A=w[1];v!==Number.MAX_SAFE_INTEGER&&A?(h&&u.getAttribute("morphTarget"+S)!==h[v]&&u.setAttribute("morphTarget"+S,h[v]),f&&u.getAttribute("morphNormal"+S)!==f[v]&&u.setAttribute("morphNormal"+S,f[v]),i[S]=A,E+=A):(h&&u.hasAttribute("morphTarget"+S)===!0&&u.deleteAttribute("morphTarget"+S),f&&u.hasAttribute("morphNormal"+S)===!0&&u.deleteAttribute("morphNormal"+S),i[S]=0)}const m=u.morphTargetsRelative?1:1-E;g.getUniforms().setValue(r,"morphTargetBaseInfluence",m),g.getUniforms().setValue(r,"morphTargetInfluences",i)}}return{update:l}}function WebGLObjects(r,e,t,n){let i=new WeakMap;function s(l){const d=n.render.frame,u=l.geometry,g=e.get(l,u);if(i.get(g)!==d&&(e.update(g),i.set(g,d)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),i.get(l)!==d&&(t.update(l.instanceMatrix,r.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,r.ARRAY_BUFFER),i.set(l,d))),l.isSkinnedMesh){const x=l.skeleton;i.get(x)!==d&&(x.update(),i.set(x,d))}return g}function o(){i=new WeakMap}function a(l){const d=l.target;d.removeEventListener("dispose",a),t.remove(d.instanceMatrix),d.instanceColor!==null&&t.remove(d.instanceColor)}return{update:s,dispose:o}}const emptyTexture=new Texture,emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(r,e,t){const n=r[0];if(n<=0||n>0)return r;const i=e*t;let s=arrayCacheF32[i];if(s===void 0&&(s=new Float32Array(i),arrayCacheF32[i]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,r[o].toArray(s,a)}return s}function arraysEqual(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function copyArray(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function allocTexUnits(r,e){let t=arrayCacheI32[e];t===void 0&&(t=new Int32Array(e),arrayCacheI32[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function setValueV1f(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function setValueV2f(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(arraysEqual(t,e))return;r.uniform2fv(this.addr,e),copyArray(t,e)}}function setValueV3f(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(arraysEqual(t,e))return;r.uniform3fv(this.addr,e),copyArray(t,e)}}function setValueV4f(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(arraysEqual(t,e))return;r.uniform4fv(this.addr,e),copyArray(t,e)}}function setValueM2(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(arraysEqual(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),copyArray(t,e)}else{if(arraysEqual(t,n))return;mat2array.set(n),r.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(t,n)}}function setValueM3(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(arraysEqual(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),copyArray(t,e)}else{if(arraysEqual(t,n))return;mat3array.set(n),r.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(t,n)}}function setValueM4(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(arraysEqual(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),copyArray(t,e)}else{if(arraysEqual(t,n))return;mat4array.set(n),r.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(t,n)}}function setValueV1i(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function setValueV2i(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(arraysEqual(t,e))return;r.uniform2iv(this.addr,e),copyArray(t,e)}}function setValueV3i(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(arraysEqual(t,e))return;r.uniform3iv(this.addr,e),copyArray(t,e)}}function setValueV4i(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(arraysEqual(t,e))return;r.uniform4iv(this.addr,e),copyArray(t,e)}}function setValueV1ui(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function setValueV2ui(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(arraysEqual(t,e))return;r.uniform2uiv(this.addr,e),copyArray(t,e)}}function setValueV3ui(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(arraysEqual(t,e))return;r.uniform3uiv(this.addr,e),copyArray(t,e)}}function setValueV4ui(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(arraysEqual(t,e))return;r.uniform4uiv(this.addr,e),copyArray(t,e)}}function setValueT1(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2D(e||emptyTexture,i)}function setValueT3D1(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||empty3dTexture,i)}function setValueT6(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||emptyCubeTexture,i)}function setValueT2DArray1(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||emptyArrayTexture,i)}function getSingularSetter(r){switch(r){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(r,e){r.uniform1fv(this.addr,e)}function setValueV2fArray(r,e){const t=flatten(e,this.size,2);r.uniform2fv(this.addr,t)}function setValueV3fArray(r,e){const t=flatten(e,this.size,3);r.uniform3fv(this.addr,t)}function setValueV4fArray(r,e){const t=flatten(e,this.size,4);r.uniform4fv(this.addr,t)}function setValueM2Array(r,e){const t=flatten(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function setValueM3Array(r,e){const t=flatten(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function setValueM4Array(r,e){const t=flatten(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function setValueV1iArray(r,e){r.uniform1iv(this.addr,e)}function setValueV2iArray(r,e){r.uniform2iv(this.addr,e)}function setValueV3iArray(r,e){r.uniform3iv(this.addr,e)}function setValueV4iArray(r,e){r.uniform4iv(this.addr,e)}function setValueV1uiArray(r,e){r.uniform1uiv(this.addr,e)}function setValueV2uiArray(r,e){r.uniform2uiv(this.addr,e)}function setValueV3uiArray(r,e){r.uniform3uiv(this.addr,e)}function setValueV4uiArray(r,e){r.uniform4uiv(this.addr,e)}function setValueT1Array(r,e,t){const n=this.cache,i=e.length,s=allocTexUnits(t,i);arraysEqual(n,s)||(r.uniform1iv(this.addr,s),copyArray(n,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||emptyTexture,s[o])}function setValueT3DArray(r,e,t){const n=this.cache,i=e.length,s=allocTexUnits(t,i);arraysEqual(n,s)||(r.uniform1iv(this.addr,s),copyArray(n,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||empty3dTexture,s[o])}function setValueT6Array(r,e,t){const n=this.cache,i=e.length,s=allocTexUnits(t,i);arraysEqual(n,s)||(r.uniform1iv(this.addr,s),copyArray(n,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||emptyCubeTexture,s[o])}function setValueT2DArrayArray(r,e,t){const n=this.cache,i=e.length,s=allocTexUnits(t,i);arraysEqual(n,s)||(r.uniform1iv(this.addr,s),copyArray(n,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||emptyArrayTexture,s[o])}function getPureArraySetter(r){switch(r){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=getSingularSetter(t.type)}}class PureArrayUniform{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}}class StructuredUniform{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,t[a.id],n)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(r,e){r.seq.push(e),r.map[e.id]=e}function parseUniform(r,e,t){const n=r.name,i=n.length;for(RePathPart.lastIndex=0;;){const s=RePathPart.exec(n),o=RePathPart.lastIndex;let a=s[1];const l=s[2]==="]",d=s[3];if(l&&(a=a|0),d===void 0||d==="["&&o+2===i){addUniform(t,d===void 0?new SingleUniform(a,r,e):new PureArrayUniform(a,r,e));break}else{let g=t.map[a];g===void 0&&(g=new StructuredUniform(a),addUniform(t,g)),t=g}}}class WebGLUniforms{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const s=e.getActiveUniform(t,i),o=e.getUniformLocation(t,s.name);parseUniform(s,o,this)}}setValue(e,t,n,i){const s=this.map[t];s!==void 0&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&n.push(o)}return n}}function WebGLShader(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(r,e){const t=r.split(`
`),n=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function getEncodingComponents(r){const e=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),t=ColorManagement.getPrimaries(r);let n;switch(e===t?n="":e===P3Primaries&&t===Rec709Primaries?n="LinearDisplayP3ToLinearSRGB":e===Rec709Primaries&&t===P3Primaries&&(n="LinearSRGBToLinearDisplayP3"),r){case LinearSRGBColorSpace:case LinearDisplayP3ColorSpace:return[n,"LinearTransferOETF"];case SRGBColorSpace:case DisplayP3ColorSpace:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",r),[n,"LinearTransferOETF"]}}function getShaderErrors(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),i=r.getShaderInfoLog(e).trim();if(n&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+handleSource(r.getShaderSource(e),o)}else return i}function getTexelEncodingFunction(r,e){const t=getEncodingComponents(e);return`vec4 ${r}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function getToneMappingFunction(r,e){let t;switch(e){case LinearToneMapping:t="Linear";break;case ReinhardToneMapping:t="Reinhard";break;case CineonToneMapping:t="OptimizedCineon";break;case ACESFilmicToneMapping:t="ACESFilmic";break;case CustomToneMapping:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function generateExtensions(r){return[r.extensionDerivatives||r.envMapCubeUVHeight||r.bumpMap||r.normalMapTangentSpace||r.clearcoatNormalMap||r.flatShading||r.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(r){const e=[];for(const t in r){const n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function fetchAttributeLocations(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=r.getActiveAttrib(e,i),o=s.name;let a=1;s.type===r.FLOAT_MAT2&&(a=2),s.type===r.FLOAT_MAT3&&(a=3),s.type===r.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:r.getAttribLocation(e,o),locationSize:a}}return t}function filterEmptyLine(r){return r!==""}function replaceLightNums(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function replaceClippingPlaneNums(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(r){return r.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function includeReplacer(r,e){let t=ShaderChunk[e];if(t===void 0){const n=shaderChunkMap.get(e);if(n!==void 0)t=ShaderChunk[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return resolveIncludes(t)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(r){return r.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(r,e,t,n){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function generatePrecision(r){let e="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function generateShadowMapTypeDefine(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===PCFShadowMap?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===PCFSoftShadowMap?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===VSMShadowMap&&(e="SHADOWMAP_TYPE_VSM"),e}function generateEnvMapTypeDefine(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:e="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:e="ENVMAP_TYPE_CUBE_UV";break}return e}function generateEnvMapModeDefine(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case CubeRefractionMapping:e="ENVMAP_MODE_REFRACTION";break}return e}function generateEnvMapBlendingDefine(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case MultiplyOperation:e="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:e="ENVMAP_BLENDING_MIX";break;case AddOperation:e="ENVMAP_BLENDING_ADD";break}return e}function generateCubeUVSize(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function WebGLProgram(r,e,t,n){const i=r.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=generateShadowMapTypeDefine(t),d=generateEnvMapTypeDefine(t),u=generateEnvMapModeDefine(t),g=generateEnvMapBlendingDefine(t),x=generateCubeUVSize(t),y=t.isWebGL2?"":generateExtensions(t),b=generateDefines(s),_=i.createProgram();let h,f,E=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(h=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b].filter(filterEmptyLine).join(`
`),h.length>0&&(h+=`
`),f=[y,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b].filter(filterEmptyLine).join(`
`),f.length>0&&(f+=`
`)):(h=[generatePrecision(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),f=[y,generatePrecision(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.envMap?"#define "+u:"",t.envMap?"#define "+g:"",x?"#define CUBEUV_TEXEL_WIDTH "+x.texelWidth:"",x?"#define CUBEUV_TEXEL_HEIGHT "+x.texelHeight:"",x?"#define CUBEUV_MAX_MIP "+x.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",t.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",t.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),o=resolveIncludes(o),o=replaceLightNums(o,t),o=replaceClippingPlaneNums(o,t),a=resolveIncludes(a),a=replaceLightNums(a,t),a=replaceClippingPlaneNums(a,t),o=unrollLoops(o),a=unrollLoops(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(E=`#version 300 es
`,h=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+h,f=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+f);const m=E+h+o,S=E+f+a,w=WebGLShader(i,i.VERTEX_SHADER,m),v=WebGLShader(i,i.FRAGMENT_SHADER,S);i.attachShader(_,w),i.attachShader(_,v),t.index0AttributeName!==void 0?i.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(_,0,"position"),i.linkProgram(_);function A(O){if(r.debug.checkShaderErrors){const L=i.getProgramInfoLog(_).trim(),P=i.getShaderInfoLog(w).trim(),I=i.getShaderInfoLog(v).trim();let N=!0,U=!0;if(i.getProgramParameter(_,i.LINK_STATUS)===!1)if(N=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,_,w,v);else{const F=getShaderErrors(i,w,"vertex"),k=getShaderErrors(i,v,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(_,i.VALIDATE_STATUS)+`

Program Info Log: `+L+`
`+F+`
`+k)}else L!==""?console.warn("THREE.WebGLProgram: Program Info Log:",L):(P===""||I==="")&&(U=!1);U&&(O.diagnostics={runnable:N,programLog:L,vertexShader:{log:P,prefix:h},fragmentShader:{log:I,prefix:f}})}i.deleteShader(w),i.deleteShader(v),M=new WebGLUniforms(i,_),T=fetchAttributeLocations(i,_)}let M;this.getUniforms=function(){return M===void 0&&A(this),M};let T;this.getAttributes=function(){return T===void 0&&A(this),T};let R=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return R===!1&&(R=i.getProgramParameter(_,COMPLETION_STATUS_KHR)),R},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=programIdCount++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=w,this.fragmentShader=v,this}let _id$1=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new WebGLShaderStage(e),t.set(e,n)),n}}class WebGLShaderStage{constructor(e){this.id=_id$1++,this.code=e,this.usedTimes=0}}function WebGLPrograms(r,e,t,n,i,s,o){const a=new Layers,l=new WebGLShaderCache,d=[],u=i.isWebGL2,g=i.logarithmicDepthBuffer,x=i.vertexTextures;let y=i.precision;const b={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(T){return T===0?"uv":`uv${T}`}function h(T,R,O,L,P){const I=L.fog,N=P.geometry,U=T.isMeshStandardMaterial?L.environment:null,F=(T.isMeshStandardMaterial?t:e).get(T.envMap||U),k=F&&F.mapping===CubeUVReflectionMapping?F.image.height:null,j=b[T.type];T.precision!==null&&(y=i.getMaxPrecision(T.precision),y!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",y,"instead."));const H=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,B=H!==void 0?H.length:0;let V=0;N.morphAttributes.position!==void 0&&(V=1),N.morphAttributes.normal!==void 0&&(V=2),N.morphAttributes.color!==void 0&&(V=3);let Y,K,J,Te;if(j){const O0=ShaderLib[j];Y=O0.vertexShader,K=O0.fragmentShader}else Y=T.vertexShader,K=T.fragmentShader,l.update(T),J=l.getVertexShaderID(T),Te=l.getFragmentShaderID(T);const He=r.getRenderTarget(),Q=P.isInstancedMesh===!0,Xe=!!T.map,ut=!!T.matcap,Ji=!!F,er=!!T.aoMap,ec=!!T.lightMap,ai=!!T.bumpMap,u0=!!T.normalMap,o0=!!T.displacementMap,E0=!!T.emissiveMap,F0=!!T.metalnessMap,g0=!!T.roughnessMap,w0=T.anisotropy>0,L0=T.clearcoat>0,T0=T.iridescence>0,ht=T.sheen>0,We=T.transmission>0,h0=w0&&!!T.anisotropyMap,M0=L0&&!!T.clearcoatMap,Z=L0&&!!T.clearcoatNormalMap,tt=L0&&!!T.clearcoatRoughnessMap,tr=T0&&!!T.iridescenceMap,s0=T0&&!!T.iridescenceThicknessMap,c0=ht&&!!T.sheenColorMap,A0=ht&&!!T.sheenRoughnessMap,P0=!!T.specularMap,Fe=!!T.specularColorMap,f0=!!T.specularIntensityMap,v0=We&&!!T.transmissionMap,D0=We&&!!T.thicknessMap,l0=!!T.gradientMap,y0=!!T.alphaMap,lt=T.alphaTest>0,oi=!!T.alphaHash,b0=!!T.extensions,W=!!N.attributes.uv1,e0=!!N.attributes.uv2,a0=!!N.attributes.uv3;let hi=NoToneMapping;return T.toneMapped&&(He===null||He.isXRRenderTarget===!0)&&(hi=r.toneMapping),{isWebGL2:u,shaderID:j,shaderType:T.type,shaderName:T.name,vertexShader:Y,fragmentShader:K,defines:T.defines,customVertexShaderID:J,customFragmentShaderID:Te,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:y,instancing:Q,instancingColor:Q&&P.instanceColor!==null,supportsVertexTextures:x,outputColorSpace:He===null?r.outputColorSpace:He.isXRRenderTarget===!0?He.texture.colorSpace:LinearSRGBColorSpace,map:Xe,matcap:ut,envMap:Ji,envMapMode:Ji&&F.mapping,envMapCubeUVHeight:k,aoMap:er,lightMap:ec,bumpMap:ai,normalMap:u0,displacementMap:x&&o0,emissiveMap:E0,normalMapObjectSpace:u0&&T.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:u0&&T.normalMapType===TangentSpaceNormalMap,metalnessMap:F0,roughnessMap:g0,anisotropy:w0,anisotropyMap:h0,clearcoat:L0,clearcoatMap:M0,clearcoatNormalMap:Z,clearcoatRoughnessMap:tt,iridescence:T0,iridescenceMap:tr,iridescenceThicknessMap:s0,sheen:ht,sheenColorMap:c0,sheenRoughnessMap:A0,specularMap:P0,specularColorMap:Fe,specularIntensityMap:f0,transmission:We,transmissionMap:v0,thicknessMap:D0,gradientMap:l0,opaque:T.transparent===!1&&T.blending===NormalBlending,alphaMap:y0,alphaTest:lt,alphaHash:oi,combine:T.combine,mapUv:Xe&&_(T.map.channel),aoMapUv:er&&_(T.aoMap.channel),lightMapUv:ec&&_(T.lightMap.channel),bumpMapUv:ai&&_(T.bumpMap.channel),normalMapUv:u0&&_(T.normalMap.channel),displacementMapUv:o0&&_(T.displacementMap.channel),emissiveMapUv:E0&&_(T.emissiveMap.channel),metalnessMapUv:F0&&_(T.metalnessMap.channel),roughnessMapUv:g0&&_(T.roughnessMap.channel),anisotropyMapUv:h0&&_(T.anisotropyMap.channel),clearcoatMapUv:M0&&_(T.clearcoatMap.channel),clearcoatNormalMapUv:Z&&_(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:tt&&_(T.clearcoatRoughnessMap.channel),iridescenceMapUv:tr&&_(T.iridescenceMap.channel),iridescenceThicknessMapUv:s0&&_(T.iridescenceThicknessMap.channel),sheenColorMapUv:c0&&_(T.sheenColorMap.channel),sheenRoughnessMapUv:A0&&_(T.sheenRoughnessMap.channel),specularMapUv:P0&&_(T.specularMap.channel),specularColorMapUv:Fe&&_(T.specularColorMap.channel),specularIntensityMapUv:f0&&_(T.specularIntensityMap.channel),transmissionMapUv:v0&&_(T.transmissionMap.channel),thicknessMapUv:D0&&_(T.thicknessMap.channel),alphaMapUv:y0&&_(T.alphaMap.channel),vertexTangents:!!N.attributes.tangent&&(u0||w0),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!N.attributes.color&&N.attributes.color.itemSize===4,vertexUv1s:W,vertexUv2s:e0,vertexUv3s:a0,pointsUvs:P.isPoints===!0&&!!N.attributes.uv&&(Xe||y0),fog:!!I,useFog:T.fog===!0,fogExp2:I&&I.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:g,skinning:P.isSkinnedMesh===!0,morphTargets:N.morphAttributes.position!==void 0,morphNormals:N.morphAttributes.normal!==void 0,morphColors:N.morphAttributes.color!==void 0,morphTargetsCount:B,morphTextureStride:V,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:T.dithering,shadowMapEnabled:r.shadowMap.enabled&&O.length>0,shadowMapType:r.shadowMap.type,toneMapping:hi,useLegacyLights:r._useLegacyLights,decodeVideoTexture:Xe&&T.map.isVideoTexture===!0&&ColorManagement.getTransfer(T.map.colorSpace)===SRGBTransfer,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===DoubleSide,flipSided:T.side===BackSide,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:b0&&T.extensions.derivatives===!0,extensionFragDepth:b0&&T.extensions.fragDepth===!0,extensionDrawBuffers:b0&&T.extensions.drawBuffers===!0,extensionShaderTextureLOD:b0&&T.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()}}function f(T){const R=[];if(T.shaderID?R.push(T.shaderID):(R.push(T.customVertexShaderID),R.push(T.customFragmentShaderID)),T.defines!==void 0)for(const O in T.defines)R.push(O),R.push(T.defines[O]);return T.isRawShaderMaterial===!1&&(E(R,T),m(R,T),R.push(r.outputColorSpace)),R.push(T.customProgramCacheKey),R.join()}function E(T,R){T.push(R.precision),T.push(R.outputColorSpace),T.push(R.envMapMode),T.push(R.envMapCubeUVHeight),T.push(R.mapUv),T.push(R.alphaMapUv),T.push(R.lightMapUv),T.push(R.aoMapUv),T.push(R.bumpMapUv),T.push(R.normalMapUv),T.push(R.displacementMapUv),T.push(R.emissiveMapUv),T.push(R.metalnessMapUv),T.push(R.roughnessMapUv),T.push(R.anisotropyMapUv),T.push(R.clearcoatMapUv),T.push(R.clearcoatNormalMapUv),T.push(R.clearcoatRoughnessMapUv),T.push(R.iridescenceMapUv),T.push(R.iridescenceThicknessMapUv),T.push(R.sheenColorMapUv),T.push(R.sheenRoughnessMapUv),T.push(R.specularMapUv),T.push(R.specularColorMapUv),T.push(R.specularIntensityMapUv),T.push(R.transmissionMapUv),T.push(R.thicknessMapUv),T.push(R.combine),T.push(R.fogExp2),T.push(R.sizeAttenuation),T.push(R.morphTargetsCount),T.push(R.morphAttributeCount),T.push(R.numDirLights),T.push(R.numPointLights),T.push(R.numSpotLights),T.push(R.numSpotLightMaps),T.push(R.numHemiLights),T.push(R.numRectAreaLights),T.push(R.numDirLightShadows),T.push(R.numPointLightShadows),T.push(R.numSpotLightShadows),T.push(R.numSpotLightShadowsWithMaps),T.push(R.numLightProbes),T.push(R.shadowMapType),T.push(R.toneMapping),T.push(R.numClippingPlanes),T.push(R.numClipIntersection),T.push(R.depthPacking)}function m(T,R){a.disableAll(),R.isWebGL2&&a.enable(0),R.supportsVertexTextures&&a.enable(1),R.instancing&&a.enable(2),R.instancingColor&&a.enable(3),R.matcap&&a.enable(4),R.envMap&&a.enable(5),R.normalMapObjectSpace&&a.enable(6),R.normalMapTangentSpace&&a.enable(7),R.clearcoat&&a.enable(8),R.iridescence&&a.enable(9),R.alphaTest&&a.enable(10),R.vertexColors&&a.enable(11),R.vertexAlphas&&a.enable(12),R.vertexUv1s&&a.enable(13),R.vertexUv2s&&a.enable(14),R.vertexUv3s&&a.enable(15),R.vertexTangents&&a.enable(16),R.anisotropy&&a.enable(17),R.alphaHash&&a.enable(18),T.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.skinning&&a.enable(4),R.morphTargets&&a.enable(5),R.morphNormals&&a.enable(6),R.morphColors&&a.enable(7),R.premultipliedAlpha&&a.enable(8),R.shadowMapEnabled&&a.enable(9),R.useLegacyLights&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.transmission&&a.enable(15),R.sheen&&a.enable(16),R.opaque&&a.enable(17),R.pointsUvs&&a.enable(18),R.decodeVideoTexture&&a.enable(19),T.push(a.mask)}function S(T){const R=b[T.type];let O;if(R){const L=ShaderLib[R];O=UniformsUtils.clone(L.uniforms)}else O=T.uniforms;return O}function w(T,R){let O;for(let L=0,P=d.length;L<P;L++){const I=d[L];if(I.cacheKey===R){O=I,++O.usedTimes;break}}return O===void 0&&(O=new WebGLProgram(r,R,T,s),d.push(O)),O}function v(T){if(--T.usedTimes===0){const R=d.indexOf(T);d[R]=d[d.length-1],d.pop(),T.destroy()}}function A(T){l.remove(T)}function M(){l.dispose()}return{getParameters:h,getProgramCacheKey:f,getUniforms:S,acquireProgram:w,releaseProgram:v,releaseShaderCache:A,programs:d,dispose:M}}function WebGLProperties(){let r=new WeakMap;function e(s){let o=r.get(s);return o===void 0&&(o={},r.set(s,o)),o}function t(s){r.delete(s)}function n(s,o,a){r.get(s)[o]=a}function i(){r=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function painterSortStable(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function reversePainterSortStable(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function WebGLRenderList(){const r=[];let e=0;const t=[],n=[],i=[];function s(){e=0,t.length=0,n.length=0,i.length=0}function o(g,x,y,b,_,h){let f=r[e];return f===void 0?(f={id:g.id,object:g,geometry:x,material:y,groupOrder:b,renderOrder:g.renderOrder,z:_,group:h},r[e]=f):(f.id=g.id,f.object=g,f.geometry=x,f.material=y,f.groupOrder=b,f.renderOrder=g.renderOrder,f.z=_,f.group=h),e++,f}function a(g,x,y,b,_,h){const f=o(g,x,y,b,_,h);y.transmission>0?n.push(f):y.transparent===!0?i.push(f):t.push(f)}function l(g,x,y,b,_,h){const f=o(g,x,y,b,_,h);y.transmission>0?n.unshift(f):y.transparent===!0?i.unshift(f):t.unshift(f)}function d(g,x){t.length>1&&t.sort(g||painterSortStable),n.length>1&&n.sort(x||reversePainterSortStable),i.length>1&&i.sort(x||reversePainterSortStable)}function u(){for(let g=e,x=r.length;g<x;g++){const y=r[g];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:i,init:s,push:a,unshift:l,finish:u,sort:d}}function WebGLRenderLists(){let r=new WeakMap;function e(n,i){const s=r.get(n);let o;return s===void 0?(o=new WebGLRenderList,r.set(n,[o])):i>=s.length?(o=new WebGLRenderList,s.push(o)):o=s[i],o}function t(){r=new WeakMap}return{get:e,dispose:t}}function UniformsCache(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Vector3,color:new Color};break;case"SpotLight":t={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":t={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return r[e.id]=t,t}}}function ShadowUniformsCache(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function WebGLLights(r,e){const t=new UniformsCache,n=ShadowUniformsCache(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new Vector3);const s=new Vector3,o=new Matrix4,a=new Matrix4;function l(u,g){let x=0,y=0,b=0;for(let L=0;L<9;L++)i.probe[L].set(0,0,0);let _=0,h=0,f=0,E=0,m=0,S=0,w=0,v=0,A=0,M=0,T=0;u.sort(shadowCastingAndTexturingLightsFirst);const R=g===!0?Math.PI:1;for(let L=0,P=u.length;L<P;L++){const I=u[L],N=I.color,U=I.intensity,F=I.distance,k=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)x+=N.r*U*R,y+=N.g*U*R,b+=N.b*U*R;else if(I.isLightProbe){for(let j=0;j<9;j++)i.probe[j].addScaledVector(I.sh.coefficients[j],U);T++}else if(I.isDirectionalLight){const j=t.get(I);if(j.color.copy(I.color).multiplyScalar(I.intensity*R),I.castShadow){const H=I.shadow,B=n.get(I);B.shadowBias=H.bias,B.shadowNormalBias=H.normalBias,B.shadowRadius=H.radius,B.shadowMapSize=H.mapSize,i.directionalShadow[_]=B,i.directionalShadowMap[_]=k,i.directionalShadowMatrix[_]=I.shadow.matrix,S++}i.directional[_]=j,_++}else if(I.isSpotLight){const j=t.get(I);j.position.setFromMatrixPosition(I.matrixWorld),j.color.copy(N).multiplyScalar(U*R),j.distance=F,j.coneCos=Math.cos(I.angle),j.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),j.decay=I.decay,i.spot[f]=j;const H=I.shadow;if(I.map&&(i.spotLightMap[A]=I.map,A++,H.updateMatrices(I),I.castShadow&&M++),i.spotLightMatrix[f]=H.matrix,I.castShadow){const B=n.get(I);B.shadowBias=H.bias,B.shadowNormalBias=H.normalBias,B.shadowRadius=H.radius,B.shadowMapSize=H.mapSize,i.spotShadow[f]=B,i.spotShadowMap[f]=k,v++}f++}else if(I.isRectAreaLight){const j=t.get(I);j.color.copy(N).multiplyScalar(U),j.halfWidth.set(I.width*.5,0,0),j.halfHeight.set(0,I.height*.5,0),i.rectArea[E]=j,E++}else if(I.isPointLight){const j=t.get(I);if(j.color.copy(I.color).multiplyScalar(I.intensity*R),j.distance=I.distance,j.decay=I.decay,I.castShadow){const H=I.shadow,B=n.get(I);B.shadowBias=H.bias,B.shadowNormalBias=H.normalBias,B.shadowRadius=H.radius,B.shadowMapSize=H.mapSize,B.shadowCameraNear=H.camera.near,B.shadowCameraFar=H.camera.far,i.pointShadow[h]=B,i.pointShadowMap[h]=k,i.pointShadowMatrix[h]=I.shadow.matrix,w++}i.point[h]=j,h++}else if(I.isHemisphereLight){const j=t.get(I);j.skyColor.copy(I.color).multiplyScalar(U*R),j.groundColor.copy(I.groundColor).multiplyScalar(U*R),i.hemi[m]=j,m++}}E>0&&(e.isWebGL2||r.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,i.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):r.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=UniformsLib.LTC_HALF_1,i.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=x,i.ambient[1]=y,i.ambient[2]=b;const O=i.hash;(O.directionalLength!==_||O.pointLength!==h||O.spotLength!==f||O.rectAreaLength!==E||O.hemiLength!==m||O.numDirectionalShadows!==S||O.numPointShadows!==w||O.numSpotShadows!==v||O.numSpotMaps!==A||O.numLightProbes!==T)&&(i.directional.length=_,i.spot.length=f,i.rectArea.length=E,i.point.length=h,i.hemi.length=m,i.directionalShadow.length=S,i.directionalShadowMap.length=S,i.pointShadow.length=w,i.pointShadowMap.length=w,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=S,i.pointShadowMatrix.length=w,i.spotLightMatrix.length=v+A-M,i.spotLightMap.length=A,i.numSpotLightShadowsWithMaps=M,i.numLightProbes=T,O.directionalLength=_,O.pointLength=h,O.spotLength=f,O.rectAreaLength=E,O.hemiLength=m,O.numDirectionalShadows=S,O.numPointShadows=w,O.numSpotShadows=v,O.numSpotMaps=A,O.numLightProbes=T,i.version=nextVersion++)}function d(u,g){let x=0,y=0,b=0,_=0,h=0;const f=g.matrixWorldInverse;for(let E=0,m=u.length;E<m;E++){const S=u[E];if(S.isDirectionalLight){const w=i.directional[x];w.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(f),x++}else if(S.isSpotLight){const w=i.spot[b];w.position.setFromMatrixPosition(S.matrixWorld),w.position.applyMatrix4(f),w.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(f),b++}else if(S.isRectAreaLight){const w=i.rectArea[_];w.position.setFromMatrixPosition(S.matrixWorld),w.position.applyMatrix4(f),a.identity(),o.copy(S.matrixWorld),o.premultiply(f),a.extractRotation(o),w.halfWidth.set(S.width*.5,0,0),w.halfHeight.set(0,S.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),_++}else if(S.isPointLight){const w=i.point[y];w.position.setFromMatrixPosition(S.matrixWorld),w.position.applyMatrix4(f),y++}else if(S.isHemisphereLight){const w=i.hemi[h];w.direction.setFromMatrixPosition(S.matrixWorld),w.direction.transformDirection(f),h++}}}return{setup:l,setupView:d,state:i}}function WebGLRenderState(r,e){const t=new WebGLLights(r,e),n=[],i=[];function s(){n.length=0,i.length=0}function o(g){n.push(g)}function a(g){i.push(g)}function l(g){t.setup(n,g)}function d(g){t.setupView(n,g)}return{init:s,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:l,setupLightsView:d,pushLight:o,pushShadow:a}}function WebGLRenderStates(r,e){let t=new WeakMap;function n(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new WebGLRenderState(r,e),t.set(s,[l])):o>=a.length?(l=new WebGLRenderState(r,e),a.push(l)):l=a[o],l}function i(){t=new WeakMap}return{get:n,dispose:i}}class MeshDepthMaterial extends Material{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(r,e,t){let n=new Frustum;const i=new Vector2,s=new Vector2,o=new Vector4,a=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),l=new MeshDistanceMaterial,d={},u=t.maxTextureSize,g={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},x=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),y=x.clone();y.defines.HORIZONTAL_PASS=1;const b=new BufferGeometry;b.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new Mesh(b,x),h=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let f=this.type;this.render=function(w,v,A){if(h.enabled===!1||h.autoUpdate===!1&&h.needsUpdate===!1||w.length===0)return;const M=r.getRenderTarget(),T=r.getActiveCubeFace(),R=r.getActiveMipmapLevel(),O=r.state;O.setBlending(NoBlending),O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const L=f!==VSMShadowMap&&this.type===VSMShadowMap,P=f===VSMShadowMap&&this.type!==VSMShadowMap;for(let I=0,N=w.length;I<N;I++){const U=w[I],F=U.shadow;if(F===void 0){console.warn("THREE.WebGLShadowMap:",U,"has no shadow.");continue}if(F.autoUpdate===!1&&F.needsUpdate===!1)continue;i.copy(F.mapSize);const k=F.getFrameExtents();if(i.multiply(k),s.copy(F.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/k.x),i.x=s.x*k.x,F.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/k.y),i.y=s.y*k.y,F.mapSize.y=s.y)),F.map===null||L===!0||P===!0){const H=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};F.map!==null&&F.map.dispose(),F.map=new WebGLRenderTarget(i.x,i.y,H),F.map.texture.name=U.name+".shadowMap",F.camera.updateProjectionMatrix()}r.setRenderTarget(F.map),r.clear();const j=F.getViewportCount();for(let H=0;H<j;H++){const B=F.getViewport(H);o.set(s.x*B.x,s.y*B.y,s.x*B.z,s.y*B.w),O.viewport(o),F.updateMatrices(U,H),n=F.getFrustum(),S(v,A,F.camera,U,this.type)}F.isPointLightShadow!==!0&&this.type===VSMShadowMap&&E(F,A),F.needsUpdate=!1}f=this.type,h.needsUpdate=!1,r.setRenderTarget(M,T,R)};function E(w,v){const A=e.update(_);x.defines.VSM_SAMPLES!==w.blurSamples&&(x.defines.VSM_SAMPLES=w.blurSamples,y.defines.VSM_SAMPLES=w.blurSamples,x.needsUpdate=!0,y.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new WebGLRenderTarget(i.x,i.y)),x.uniforms.shadow_pass.value=w.map.texture,x.uniforms.resolution.value=w.mapSize,x.uniforms.radius.value=w.radius,r.setRenderTarget(w.mapPass),r.clear(),r.renderBufferDirect(v,null,A,x,_,null),y.uniforms.shadow_pass.value=w.mapPass.texture,y.uniforms.resolution.value=w.mapSize,y.uniforms.radius.value=w.radius,r.setRenderTarget(w.map),r.clear(),r.renderBufferDirect(v,null,A,y,_,null)}function m(w,v,A,M){let T=null;const R=A.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(R!==void 0)T=R;else if(T=A.isPointLight===!0?l:a,r.localClippingEnabled&&v.clipShadows===!0&&Array.isArray(v.clippingPlanes)&&v.clippingPlanes.length!==0||v.displacementMap&&v.displacementScale!==0||v.alphaMap&&v.alphaTest>0||v.map&&v.alphaTest>0){const O=T.uuid,L=v.uuid;let P=d[O];P===void 0&&(P={},d[O]=P);let I=P[L];I===void 0&&(I=T.clone(),P[L]=I),T=I}if(T.visible=v.visible,T.wireframe=v.wireframe,M===VSMShadowMap?T.side=v.shadowSide!==null?v.shadowSide:v.side:T.side=v.shadowSide!==null?v.shadowSide:g[v.side],T.alphaMap=v.alphaMap,T.alphaTest=v.alphaTest,T.map=v.map,T.clipShadows=v.clipShadows,T.clippingPlanes=v.clippingPlanes,T.clipIntersection=v.clipIntersection,T.displacementMap=v.displacementMap,T.displacementScale=v.displacementScale,T.displacementBias=v.displacementBias,T.wireframeLinewidth=v.wireframeLinewidth,T.linewidth=v.linewidth,A.isPointLight===!0&&T.isMeshDistanceMaterial===!0){const O=r.properties.get(T);O.light=A}return T}function S(w,v,A,M,T){if(w.visible===!1)return;if(w.layers.test(v.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&T===VSMShadowMap)&&(!w.frustumCulled||n.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,w.matrixWorld);const L=e.update(w),P=w.material;if(Array.isArray(P)){const I=L.groups;for(let N=0,U=I.length;N<U;N++){const F=I[N],k=P[F.materialIndex];if(k&&k.visible){const j=m(w,k,M,T);r.renderBufferDirect(A,null,L,j,w,F)}}}else if(P.visible){const I=m(w,P,M,T);r.renderBufferDirect(A,null,L,I,w,null)}}const O=w.children;for(let L=0,P=O.length;L<P;L++)S(O[L],v,A,M,T)}}function WebGLState(r,e,t){const n=t.isWebGL2;function i(){let oi=!1;const b0=new Vector4;let W=null;const e0=new Vector4(0,0,0,0);return{setMask:function(a0){W!==a0&&!oi&&(r.colorMask(a0,a0,a0,a0),W=a0)},setLocked:function(a0){oi=a0},setClear:function(a0,hi,p0,O0,q){q===!0&&(a0*=O0,hi*=O0,p0*=O0),b0.set(a0,hi,p0,O0),e0.equals(b0)===!1&&(r.clearColor(a0,hi,p0,O0),e0.copy(b0))},reset:function(){oi=!1,W=null,e0.set(-1,0,0,0)}}}function s(){let oi=!1,b0=null,W=null,e0=null;return{setTest:function(a0){a0?Xe(r.DEPTH_TEST):ut(r.DEPTH_TEST)},setMask:function(a0){b0!==a0&&!oi&&(r.depthMask(a0),b0=a0)},setFunc:function(a0){if(W!==a0){switch(a0){case NeverDepth:r.depthFunc(r.NEVER);break;case AlwaysDepth:r.depthFunc(r.ALWAYS);break;case LessDepth:r.depthFunc(r.LESS);break;case LessEqualDepth:r.depthFunc(r.LEQUAL);break;case EqualDepth:r.depthFunc(r.EQUAL);break;case GreaterEqualDepth:r.depthFunc(r.GEQUAL);break;case GreaterDepth:r.depthFunc(r.GREATER);break;case NotEqualDepth:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}W=a0}},setLocked:function(a0){oi=a0},setClear:function(a0){e0!==a0&&(r.clearDepth(a0),e0=a0)},reset:function(){oi=!1,b0=null,W=null,e0=null}}}function o(){let oi=!1,b0=null,W=null,e0=null,a0=null,hi=null,p0=null,O0=null,q=null;return{setTest:function(it){oi||(it?Xe(r.STENCIL_TEST):ut(r.STENCIL_TEST))},setMask:function(it){b0!==it&&!oi&&(r.stencilMask(it),b0=it)},setFunc:function(it,at,t0){(W!==it||e0!==at||a0!==t0)&&(r.stencilFunc(it,at,t0),W=it,e0=at,a0=t0)},setOp:function(it,at,t0){(hi!==it||p0!==at||O0!==t0)&&(r.stencilOp(it,at,t0),hi=it,p0=at,O0=t0)},setLocked:function(it){oi=it},setClear:function(it){q!==it&&(r.clearStencil(it),q=it)},reset:function(){oi=!1,b0=null,W=null,e0=null,a0=null,hi=null,p0=null,O0=null,q=null}}}const a=new i,l=new s,d=new o,u=new WeakMap,g=new WeakMap;let x={},y={},b=new WeakMap,_=[],h=null,f=!1,E=null,m=null,S=null,w=null,v=null,A=null,M=null,T=new Color(0,0,0),R=0,O=!1,L=null,P=null,I=null,N=null,U=null;const F=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let k=!1,j=0;const H=r.getParameter(r.VERSION);H.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(H)[1]),k=j>=1):H.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),k=j>=2);let B=null,V={};const Y=r.getParameter(r.SCISSOR_BOX),K=r.getParameter(r.VIEWPORT),J=new Vector4().fromArray(Y),Te=new Vector4().fromArray(K);function He(oi,b0,W,e0){const a0=new Uint8Array(4),hi=r.createTexture();r.bindTexture(oi,hi),r.texParameteri(oi,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(oi,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let p0=0;p0<W;p0++)n&&(oi===r.TEXTURE_3D||oi===r.TEXTURE_2D_ARRAY)?r.texImage3D(b0,0,r.RGBA,1,1,e0,0,r.RGBA,r.UNSIGNED_BYTE,a0):r.texImage2D(b0+p0,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,a0);return hi}const Q={};Q[r.TEXTURE_2D]=He(r.TEXTURE_2D,r.TEXTURE_2D,1),Q[r.TEXTURE_CUBE_MAP]=He(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Q[r.TEXTURE_2D_ARRAY]=He(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),Q[r.TEXTURE_3D]=He(r.TEXTURE_3D,r.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),d.setClear(0),Xe(r.DEPTH_TEST),l.setFunc(LessEqualDepth),F0(!1),g0(CullFaceBack),Xe(r.CULL_FACE),o0(NoBlending);function Xe(oi){x[oi]!==!0&&(r.enable(oi),x[oi]=!0)}function ut(oi){x[oi]!==!1&&(r.disable(oi),x[oi]=!1)}function Ji(oi,b0){return y[oi]!==b0?(r.bindFramebuffer(oi,b0),y[oi]=b0,n&&(oi===r.DRAW_FRAMEBUFFER&&(y[r.FRAMEBUFFER]=b0),oi===r.FRAMEBUFFER&&(y[r.DRAW_FRAMEBUFFER]=b0)),!0):!1}function er(oi,b0){let W=_,e0=!1;if(oi)if(W=b.get(b0),W===void 0&&(W=[],b.set(b0,W)),oi.isWebGLMultipleRenderTargets){const a0=oi.texture;if(W.length!==a0.length||W[0]!==r.COLOR_ATTACHMENT0){for(let hi=0,p0=a0.length;hi<p0;hi++)W[hi]=r.COLOR_ATTACHMENT0+hi;W.length=a0.length,e0=!0}}else W[0]!==r.COLOR_ATTACHMENT0&&(W[0]=r.COLOR_ATTACHMENT0,e0=!0);else W[0]!==r.BACK&&(W[0]=r.BACK,e0=!0);e0&&(t.isWebGL2?r.drawBuffers(W):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(W))}function ec(oi){return h!==oi?(r.useProgram(oi),h=oi,!0):!1}const ai={[AddEquation]:r.FUNC_ADD,[SubtractEquation]:r.FUNC_SUBTRACT,[ReverseSubtractEquation]:r.FUNC_REVERSE_SUBTRACT};if(n)ai[MinEquation]=r.MIN,ai[MaxEquation]=r.MAX;else{const oi=e.get("EXT_blend_minmax");oi!==null&&(ai[MinEquation]=oi.MIN_EXT,ai[MaxEquation]=oi.MAX_EXT)}const u0={[ZeroFactor]:r.ZERO,[OneFactor]:r.ONE,[SrcColorFactor]:r.SRC_COLOR,[SrcAlphaFactor]:r.SRC_ALPHA,[SrcAlphaSaturateFactor]:r.SRC_ALPHA_SATURATE,[DstColorFactor]:r.DST_COLOR,[DstAlphaFactor]:r.DST_ALPHA,[OneMinusSrcColorFactor]:r.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:r.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:r.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:r.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:r.CONSTANT_COLOR,[OneMinusConstantColorFactor]:r.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:r.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:r.ONE_MINUS_CONSTANT_ALPHA};function o0(oi,b0,W,e0,a0,hi,p0,O0,q,it){if(oi===NoBlending){f===!0&&(ut(r.BLEND),f=!1);return}if(f===!1&&(Xe(r.BLEND),f=!0),oi!==CustomBlending){if(oi!==E||it!==O){if((m!==AddEquation||v!==AddEquation)&&(r.blendEquation(r.FUNC_ADD),m=AddEquation,v=AddEquation),it)switch(oi){case NormalBlending:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:r.blendFunc(r.ONE,r.ONE);break;case SubtractiveBlending:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case MultiplyBlending:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",oi);break}else switch(oi){case NormalBlending:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case SubtractiveBlending:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case MultiplyBlending:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",oi);break}S=null,w=null,A=null,M=null,T.set(0,0,0),R=0,E=oi,O=it}return}a0=a0||b0,hi=hi||W,p0=p0||e0,(b0!==m||a0!==v)&&(r.blendEquationSeparate(ai[b0],ai[a0]),m=b0,v=a0),(W!==S||e0!==w||hi!==A||p0!==M)&&(r.blendFuncSeparate(u0[W],u0[e0],u0[hi],u0[p0]),S=W,w=e0,A=hi,M=p0),(O0.equals(T)===!1||q!==R)&&(r.blendColor(O0.r,O0.g,O0.b,q),T.copy(O0),R=q),E=oi,O=!1}function E0(oi,b0){oi.side===DoubleSide?ut(r.CULL_FACE):Xe(r.CULL_FACE);let W=oi.side===BackSide;b0&&(W=!W),F0(W),oi.blending===NormalBlending&&oi.transparent===!1?o0(NoBlending):o0(oi.blending,oi.blendEquation,oi.blendSrc,oi.blendDst,oi.blendEquationAlpha,oi.blendSrcAlpha,oi.blendDstAlpha,oi.blendColor,oi.blendAlpha,oi.premultipliedAlpha),l.setFunc(oi.depthFunc),l.setTest(oi.depthTest),l.setMask(oi.depthWrite),a.setMask(oi.colorWrite);const e0=oi.stencilWrite;d.setTest(e0),e0&&(d.setMask(oi.stencilWriteMask),d.setFunc(oi.stencilFunc,oi.stencilRef,oi.stencilFuncMask),d.setOp(oi.stencilFail,oi.stencilZFail,oi.stencilZPass)),L0(oi.polygonOffset,oi.polygonOffsetFactor,oi.polygonOffsetUnits),oi.alphaToCoverage===!0?Xe(r.SAMPLE_ALPHA_TO_COVERAGE):ut(r.SAMPLE_ALPHA_TO_COVERAGE)}function F0(oi){L!==oi&&(oi?r.frontFace(r.CW):r.frontFace(r.CCW),L=oi)}function g0(oi){oi!==CullFaceNone?(Xe(r.CULL_FACE),oi!==P&&(oi===CullFaceBack?r.cullFace(r.BACK):oi===CullFaceFront?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):ut(r.CULL_FACE),P=oi}function w0(oi){oi!==I&&(k&&r.lineWidth(oi),I=oi)}function L0(oi,b0,W){oi?(Xe(r.POLYGON_OFFSET_FILL),(N!==b0||U!==W)&&(r.polygonOffset(b0,W),N=b0,U=W)):ut(r.POLYGON_OFFSET_FILL)}function T0(oi){oi?Xe(r.SCISSOR_TEST):ut(r.SCISSOR_TEST)}function ht(oi){oi===void 0&&(oi=r.TEXTURE0+F-1),B!==oi&&(r.activeTexture(oi),B=oi)}function We(oi,b0,W){W===void 0&&(B===null?W=r.TEXTURE0+F-1:W=B);let e0=V[W];e0===void 0&&(e0={type:void 0,texture:void 0},V[W]=e0),(e0.type!==oi||e0.texture!==b0)&&(B!==W&&(r.activeTexture(W),B=W),r.bindTexture(oi,b0||Q[oi]),e0.type=oi,e0.texture=b0)}function h0(){const oi=V[B];oi!==void 0&&oi.type!==void 0&&(r.bindTexture(oi.type,null),oi.type=void 0,oi.texture=void 0)}function M0(){try{r.compressedTexImage2D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function Z(){try{r.compressedTexImage3D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function tt(){try{r.texSubImage2D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function tr(){try{r.texSubImage3D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function s0(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function c0(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function A0(){try{r.texStorage2D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function P0(){try{r.texStorage3D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function Fe(){try{r.texImage2D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function f0(){try{r.texImage3D.apply(r,arguments)}catch(oi){console.error("THREE.WebGLState:",oi)}}function v0(oi){J.equals(oi)===!1&&(r.scissor(oi.x,oi.y,oi.z,oi.w),J.copy(oi))}function D0(oi){Te.equals(oi)===!1&&(r.viewport(oi.x,oi.y,oi.z,oi.w),Te.copy(oi))}function l0(oi,b0){let W=g.get(b0);W===void 0&&(W=new WeakMap,g.set(b0,W));let e0=W.get(oi);e0===void 0&&(e0=r.getUniformBlockIndex(b0,oi.name),W.set(oi,e0))}function y0(oi,b0){const e0=g.get(b0).get(oi);u.get(b0)!==e0&&(r.uniformBlockBinding(b0,e0,oi.__bindingPointIndex),u.set(b0,e0))}function lt(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),n===!0&&(r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),x={},B=null,V={},y={},b=new WeakMap,_=[],h=null,f=!1,E=null,m=null,S=null,w=null,v=null,A=null,M=null,T=new Color(0,0,0),R=0,O=!1,L=null,P=null,I=null,N=null,U=null,J.set(0,0,r.canvas.width,r.canvas.height),Te.set(0,0,r.canvas.width,r.canvas.height),a.reset(),l.reset(),d.reset()}return{buffers:{color:a,depth:l,stencil:d},enable:Xe,disable:ut,bindFramebuffer:Ji,drawBuffers:er,useProgram:ec,setBlending:o0,setMaterial:E0,setFlipSided:F0,setCullFace:g0,setLineWidth:w0,setPolygonOffset:L0,setScissorTest:T0,activeTexture:ht,bindTexture:We,unbindTexture:h0,compressedTexImage2D:M0,compressedTexImage3D:Z,texImage2D:Fe,texImage3D:f0,updateUBOMapping:l0,uniformBlockBinding:y0,texStorage2D:A0,texStorage3D:P0,texSubImage2D:tt,texSubImage3D:tr,compressedTexSubImage2D:s0,compressedTexSubImage3D:c0,scissor:v0,viewport:D0,reset:lt}}function WebGLTextures(r,e,t,n,i,s,o){const a=i.isWebGL2,l=i.maxTextures,d=i.maxCubemapSize,u=i.maxTextureSize,g=i.maxSamples,x=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,y=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),b=new WeakMap;let _;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function E(ht,We){return f?new OffscreenCanvas(ht,We):createElementNS("canvas")}function m(ht,We,h0,M0){let Z=1;if((ht.width>M0||ht.height>M0)&&(Z=M0/Math.max(ht.width,ht.height)),Z<1||We===!0)if(typeof HTMLImageElement<"u"&&ht instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ht instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ht instanceof ImageBitmap){const tt=We?floorPowerOfTwo:Math.floor,tr=tt(Z*ht.width),s0=tt(Z*ht.height);_===void 0&&(_=E(tr,s0));const c0=h0?E(tr,s0):_;return c0.width=tr,c0.height=s0,c0.getContext("2d").drawImage(ht,0,0,tr,s0),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ht.width+"x"+ht.height+") to ("+tr+"x"+s0+")."),c0}else return"data"in ht&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ht.width+"x"+ht.height+")."),ht;return ht}function S(ht){return isPowerOfTwo(ht.width)&&isPowerOfTwo(ht.height)}function w(ht){return a?!1:ht.wrapS!==ClampToEdgeWrapping||ht.wrapT!==ClampToEdgeWrapping||ht.minFilter!==NearestFilter&&ht.minFilter!==LinearFilter}function v(ht,We){return ht.generateMipmaps&&We&&ht.minFilter!==NearestFilter&&ht.minFilter!==LinearFilter}function A(ht){r.generateMipmap(ht)}function M(ht,We,h0,M0,Z=!1){if(a===!1)return We;if(ht!==null){if(r[ht]!==void 0)return r[ht];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ht+"'")}let tt=We;if(We===r.RED&&(h0===r.FLOAT&&(tt=r.R32F),h0===r.HALF_FLOAT&&(tt=r.R16F),h0===r.UNSIGNED_BYTE&&(tt=r.R8)),We===r.RED_INTEGER&&(h0===r.UNSIGNED_BYTE&&(tt=r.R8UI),h0===r.UNSIGNED_SHORT&&(tt=r.R16UI),h0===r.UNSIGNED_INT&&(tt=r.R32UI),h0===r.BYTE&&(tt=r.R8I),h0===r.SHORT&&(tt=r.R16I),h0===r.INT&&(tt=r.R32I)),We===r.RG&&(h0===r.FLOAT&&(tt=r.RG32F),h0===r.HALF_FLOAT&&(tt=r.RG16F),h0===r.UNSIGNED_BYTE&&(tt=r.RG8)),We===r.RGBA){const tr=Z?LinearTransfer:ColorManagement.getTransfer(M0);h0===r.FLOAT&&(tt=r.RGBA32F),h0===r.HALF_FLOAT&&(tt=r.RGBA16F),h0===r.UNSIGNED_BYTE&&(tt=tr===SRGBTransfer?r.SRGB8_ALPHA8:r.RGBA8),h0===r.UNSIGNED_SHORT_4_4_4_4&&(tt=r.RGBA4),h0===r.UNSIGNED_SHORT_5_5_5_1&&(tt=r.RGB5_A1)}return(tt===r.R16F||tt===r.R32F||tt===r.RG16F||tt===r.RG32F||tt===r.RGBA16F||tt===r.RGBA32F)&&e.get("EXT_color_buffer_float"),tt}function T(ht,We,h0){return v(ht,h0)===!0||ht.isFramebufferTexture&&ht.minFilter!==NearestFilter&&ht.minFilter!==LinearFilter?Math.log2(Math.max(We.width,We.height))+1:ht.mipmaps!==void 0&&ht.mipmaps.length>0?ht.mipmaps.length:ht.isCompressedTexture&&Array.isArray(ht.image)?We.mipmaps.length:1}function R(ht){return ht===NearestFilter||ht===NearestMipmapNearestFilter||ht===NearestMipmapLinearFilter?r.NEAREST:r.LINEAR}function O(ht){const We=ht.target;We.removeEventListener("dispose",O),P(We),We.isVideoTexture&&b.delete(We)}function L(ht){const We=ht.target;We.removeEventListener("dispose",L),N(We)}function P(ht){const We=n.get(ht);if(We.__webglInit===void 0)return;const h0=ht.source,M0=h.get(h0);if(M0){const Z=M0[We.__cacheKey];Z.usedTimes--,Z.usedTimes===0&&I(ht),Object.keys(M0).length===0&&h.delete(h0)}n.remove(ht)}function I(ht){const We=n.get(ht);r.deleteTexture(We.__webglTexture);const h0=ht.source,M0=h.get(h0);delete M0[We.__cacheKey],o.memory.textures--}function N(ht){const We=ht.texture,h0=n.get(ht),M0=n.get(We);if(M0.__webglTexture!==void 0&&(r.deleteTexture(M0.__webglTexture),o.memory.textures--),ht.depthTexture&&ht.depthTexture.dispose(),ht.isWebGLCubeRenderTarget)for(let Z=0;Z<6;Z++){if(Array.isArray(h0.__webglFramebuffer[Z]))for(let tt=0;tt<h0.__webglFramebuffer[Z].length;tt++)r.deleteFramebuffer(h0.__webglFramebuffer[Z][tt]);else r.deleteFramebuffer(h0.__webglFramebuffer[Z]);h0.__webglDepthbuffer&&r.deleteRenderbuffer(h0.__webglDepthbuffer[Z])}else{if(Array.isArray(h0.__webglFramebuffer))for(let Z=0;Z<h0.__webglFramebuffer.length;Z++)r.deleteFramebuffer(h0.__webglFramebuffer[Z]);else r.deleteFramebuffer(h0.__webglFramebuffer);if(h0.__webglDepthbuffer&&r.deleteRenderbuffer(h0.__webglDepthbuffer),h0.__webglMultisampledFramebuffer&&r.deleteFramebuffer(h0.__webglMultisampledFramebuffer),h0.__webglColorRenderbuffer)for(let Z=0;Z<h0.__webglColorRenderbuffer.length;Z++)h0.__webglColorRenderbuffer[Z]&&r.deleteRenderbuffer(h0.__webglColorRenderbuffer[Z]);h0.__webglDepthRenderbuffer&&r.deleteRenderbuffer(h0.__webglDepthRenderbuffer)}if(ht.isWebGLMultipleRenderTargets)for(let Z=0,tt=We.length;Z<tt;Z++){const tr=n.get(We[Z]);tr.__webglTexture&&(r.deleteTexture(tr.__webglTexture),o.memory.textures--),n.remove(We[Z])}n.remove(We),n.remove(ht)}let U=0;function F(){U=0}function k(){const ht=U;return ht>=l&&console.warn("THREE.WebGLTextures: Trying to use "+ht+" texture units while this GPU supports only "+l),U+=1,ht}function j(ht){const We=[];return We.push(ht.wrapS),We.push(ht.wrapT),We.push(ht.wrapR||0),We.push(ht.magFilter),We.push(ht.minFilter),We.push(ht.anisotropy),We.push(ht.internalFormat),We.push(ht.format),We.push(ht.type),We.push(ht.generateMipmaps),We.push(ht.premultiplyAlpha),We.push(ht.flipY),We.push(ht.unpackAlignment),We.push(ht.colorSpace),We.join()}function H(ht,We){const h0=n.get(ht);if(ht.isVideoTexture&&L0(ht),ht.isRenderTargetTexture===!1&&ht.version>0&&h0.__version!==ht.version){const M0=ht.image;if(M0===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(M0.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Xe(h0,ht,We);return}}t.bindTexture(r.TEXTURE_2D,h0.__webglTexture,r.TEXTURE0+We)}function B(ht,We){const h0=n.get(ht);if(ht.version>0&&h0.__version!==ht.version){Xe(h0,ht,We);return}t.bindTexture(r.TEXTURE_2D_ARRAY,h0.__webglTexture,r.TEXTURE0+We)}function V(ht,We){const h0=n.get(ht);if(ht.version>0&&h0.__version!==ht.version){Xe(h0,ht,We);return}t.bindTexture(r.TEXTURE_3D,h0.__webglTexture,r.TEXTURE0+We)}function Y(ht,We){const h0=n.get(ht);if(ht.version>0&&h0.__version!==ht.version){ut(h0,ht,We);return}t.bindTexture(r.TEXTURE_CUBE_MAP,h0.__webglTexture,r.TEXTURE0+We)}const K={[RepeatWrapping]:r.REPEAT,[ClampToEdgeWrapping]:r.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:r.MIRRORED_REPEAT},J={[NearestFilter]:r.NEAREST,[NearestMipmapNearestFilter]:r.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:r.NEAREST_MIPMAP_LINEAR,[LinearFilter]:r.LINEAR,[LinearMipmapNearestFilter]:r.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:r.LINEAR_MIPMAP_LINEAR},Te={[NeverCompare]:r.NEVER,[AlwaysCompare]:r.ALWAYS,[LessCompare]:r.LESS,[LessEqualCompare]:r.LEQUAL,[EqualCompare]:r.EQUAL,[GreaterEqualCompare]:r.GEQUAL,[GreaterCompare]:r.GREATER,[NotEqualCompare]:r.NOTEQUAL};function He(ht,We,h0){if(h0?(r.texParameteri(ht,r.TEXTURE_WRAP_S,K[We.wrapS]),r.texParameteri(ht,r.TEXTURE_WRAP_T,K[We.wrapT]),(ht===r.TEXTURE_3D||ht===r.TEXTURE_2D_ARRAY)&&r.texParameteri(ht,r.TEXTURE_WRAP_R,K[We.wrapR]),r.texParameteri(ht,r.TEXTURE_MAG_FILTER,J[We.magFilter]),r.texParameteri(ht,r.TEXTURE_MIN_FILTER,J[We.minFilter])):(r.texParameteri(ht,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(ht,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(ht===r.TEXTURE_3D||ht===r.TEXTURE_2D_ARRAY)&&r.texParameteri(ht,r.TEXTURE_WRAP_R,r.CLAMP_TO_EDGE),(We.wrapS!==ClampToEdgeWrapping||We.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(ht,r.TEXTURE_MAG_FILTER,R(We.magFilter)),r.texParameteri(ht,r.TEXTURE_MIN_FILTER,R(We.minFilter)),We.minFilter!==NearestFilter&&We.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),We.compareFunction&&(r.texParameteri(ht,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(ht,r.TEXTURE_COMPARE_FUNC,Te[We.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const M0=e.get("EXT_texture_filter_anisotropic");if(We.magFilter===NearestFilter||We.minFilter!==NearestMipmapLinearFilter&&We.minFilter!==LinearMipmapLinearFilter||We.type===FloatType&&e.has("OES_texture_float_linear")===!1||a===!1&&We.type===HalfFloatType&&e.has("OES_texture_half_float_linear")===!1)return;(We.anisotropy>1||n.get(We).__currentAnisotropy)&&(r.texParameterf(ht,M0.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(We.anisotropy,i.getMaxAnisotropy())),n.get(We).__currentAnisotropy=We.anisotropy)}}function Q(ht,We){let h0=!1;ht.__webglInit===void 0&&(ht.__webglInit=!0,We.addEventListener("dispose",O));const M0=We.source;let Z=h.get(M0);Z===void 0&&(Z={},h.set(M0,Z));const tt=j(We);if(tt!==ht.__cacheKey){Z[tt]===void 0&&(Z[tt]={texture:r.createTexture(),usedTimes:0},o.memory.textures++,h0=!0),Z[tt].usedTimes++;const tr=Z[ht.__cacheKey];tr!==void 0&&(Z[ht.__cacheKey].usedTimes--,tr.usedTimes===0&&I(We)),ht.__cacheKey=tt,ht.__webglTexture=Z[tt].texture}return h0}function Xe(ht,We,h0){let M0=r.TEXTURE_2D;(We.isDataArrayTexture||We.isCompressedArrayTexture)&&(M0=r.TEXTURE_2D_ARRAY),We.isData3DTexture&&(M0=r.TEXTURE_3D);const Z=Q(ht,We),tt=We.source;t.bindTexture(M0,ht.__webglTexture,r.TEXTURE0+h0);const tr=n.get(tt);if(tt.version!==tr.__version||Z===!0){t.activeTexture(r.TEXTURE0+h0);const s0=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),c0=We.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(We.colorSpace),A0=We.colorSpace===NoColorSpace||s0===c0?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,We.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,We.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,We.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,A0);const P0=w(We)&&S(We.image)===!1;let Fe=m(We.image,P0,!1,u);Fe=T0(We,Fe);const f0=S(Fe)||a,v0=s.convert(We.format,We.colorSpace);let D0=s.convert(We.type),l0=M(We.internalFormat,v0,D0,We.colorSpace,We.isVideoTexture);He(M0,We,f0);let y0;const lt=We.mipmaps,oi=a&&We.isVideoTexture!==!0,b0=tr.__version===void 0||Z===!0,W=T(We,Fe,f0);if(We.isDepthTexture)l0=r.DEPTH_COMPONENT,a?We.type===FloatType?l0=r.DEPTH_COMPONENT32F:We.type===UnsignedIntType?l0=r.DEPTH_COMPONENT24:We.type===UnsignedInt248Type?l0=r.DEPTH24_STENCIL8:l0=r.DEPTH_COMPONENT16:We.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),We.format===DepthFormat&&l0===r.DEPTH_COMPONENT&&We.type!==UnsignedShortType&&We.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),We.type=UnsignedIntType,D0=s.convert(We.type)),We.format===DepthStencilFormat&&l0===r.DEPTH_COMPONENT&&(l0=r.DEPTH_STENCIL,We.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),We.type=UnsignedInt248Type,D0=s.convert(We.type))),b0&&(oi?t.texStorage2D(r.TEXTURE_2D,1,l0,Fe.width,Fe.height):t.texImage2D(r.TEXTURE_2D,0,l0,Fe.width,Fe.height,0,v0,D0,null));else if(We.isDataTexture)if(lt.length>0&&f0){oi&&b0&&t.texStorage2D(r.TEXTURE_2D,W,l0,lt[0].width,lt[0].height);for(let e0=0,a0=lt.length;e0<a0;e0++)y0=lt[e0],oi?t.texSubImage2D(r.TEXTURE_2D,e0,0,0,y0.width,y0.height,v0,D0,y0.data):t.texImage2D(r.TEXTURE_2D,e0,l0,y0.width,y0.height,0,v0,D0,y0.data);We.generateMipmaps=!1}else oi?(b0&&t.texStorage2D(r.TEXTURE_2D,W,l0,Fe.width,Fe.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,Fe.width,Fe.height,v0,D0,Fe.data)):t.texImage2D(r.TEXTURE_2D,0,l0,Fe.width,Fe.height,0,v0,D0,Fe.data);else if(We.isCompressedTexture)if(We.isCompressedArrayTexture){oi&&b0&&t.texStorage3D(r.TEXTURE_2D_ARRAY,W,l0,lt[0].width,lt[0].height,Fe.depth);for(let e0=0,a0=lt.length;e0<a0;e0++)y0=lt[e0],We.format!==RGBAFormat?v0!==null?oi?t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,e0,0,0,0,y0.width,y0.height,Fe.depth,v0,y0.data,0,0):t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,e0,l0,y0.width,y0.height,Fe.depth,0,y0.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):oi?t.texSubImage3D(r.TEXTURE_2D_ARRAY,e0,0,0,0,y0.width,y0.height,Fe.depth,v0,D0,y0.data):t.texImage3D(r.TEXTURE_2D_ARRAY,e0,l0,y0.width,y0.height,Fe.depth,0,v0,D0,y0.data)}else{oi&&b0&&t.texStorage2D(r.TEXTURE_2D,W,l0,lt[0].width,lt[0].height);for(let e0=0,a0=lt.length;e0<a0;e0++)y0=lt[e0],We.format!==RGBAFormat?v0!==null?oi?t.compressedTexSubImage2D(r.TEXTURE_2D,e0,0,0,y0.width,y0.height,v0,y0.data):t.compressedTexImage2D(r.TEXTURE_2D,e0,l0,y0.width,y0.height,0,y0.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):oi?t.texSubImage2D(r.TEXTURE_2D,e0,0,0,y0.width,y0.height,v0,D0,y0.data):t.texImage2D(r.TEXTURE_2D,e0,l0,y0.width,y0.height,0,v0,D0,y0.data)}else if(We.isDataArrayTexture)oi?(b0&&t.texStorage3D(r.TEXTURE_2D_ARRAY,W,l0,Fe.width,Fe.height,Fe.depth),t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Fe.width,Fe.height,Fe.depth,v0,D0,Fe.data)):t.texImage3D(r.TEXTURE_2D_ARRAY,0,l0,Fe.width,Fe.height,Fe.depth,0,v0,D0,Fe.data);else if(We.isData3DTexture)oi?(b0&&t.texStorage3D(r.TEXTURE_3D,W,l0,Fe.width,Fe.height,Fe.depth),t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Fe.width,Fe.height,Fe.depth,v0,D0,Fe.data)):t.texImage3D(r.TEXTURE_3D,0,l0,Fe.width,Fe.height,Fe.depth,0,v0,D0,Fe.data);else if(We.isFramebufferTexture){if(b0)if(oi)t.texStorage2D(r.TEXTURE_2D,W,l0,Fe.width,Fe.height);else{let e0=Fe.width,a0=Fe.height;for(let hi=0;hi<W;hi++)t.texImage2D(r.TEXTURE_2D,hi,l0,e0,a0,0,v0,D0,null),e0>>=1,a0>>=1}}else if(lt.length>0&&f0){oi&&b0&&t.texStorage2D(r.TEXTURE_2D,W,l0,lt[0].width,lt[0].height);for(let e0=0,a0=lt.length;e0<a0;e0++)y0=lt[e0],oi?t.texSubImage2D(r.TEXTURE_2D,e0,0,0,v0,D0,y0):t.texImage2D(r.TEXTURE_2D,e0,l0,v0,D0,y0);We.generateMipmaps=!1}else oi?(b0&&t.texStorage2D(r.TEXTURE_2D,W,l0,Fe.width,Fe.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,v0,D0,Fe)):t.texImage2D(r.TEXTURE_2D,0,l0,v0,D0,Fe);v(We,f0)&&A(M0),tr.__version=tt.version,We.onUpdate&&We.onUpdate(We)}ht.__version=We.version}function ut(ht,We,h0){if(We.image.length!==6)return;const M0=Q(ht,We),Z=We.source;t.bindTexture(r.TEXTURE_CUBE_MAP,ht.__webglTexture,r.TEXTURE0+h0);const tt=n.get(Z);if(Z.version!==tt.__version||M0===!0){t.activeTexture(r.TEXTURE0+h0);const tr=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),s0=We.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(We.colorSpace),c0=We.colorSpace===NoColorSpace||tr===s0?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,We.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,We.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,We.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,c0);const A0=We.isCompressedTexture||We.image[0].isCompressedTexture,P0=We.image[0]&&We.image[0].isDataTexture,Fe=[];for(let e0=0;e0<6;e0++)!A0&&!P0?Fe[e0]=m(We.image[e0],!1,!0,d):Fe[e0]=P0?We.image[e0].image:We.image[e0],Fe[e0]=T0(We,Fe[e0]);const f0=Fe[0],v0=S(f0)||a,D0=s.convert(We.format,We.colorSpace),l0=s.convert(We.type),y0=M(We.internalFormat,D0,l0,We.colorSpace),lt=a&&We.isVideoTexture!==!0,oi=tt.__version===void 0||M0===!0;let b0=T(We,f0,v0);He(r.TEXTURE_CUBE_MAP,We,v0);let W;if(A0){lt&&oi&&t.texStorage2D(r.TEXTURE_CUBE_MAP,b0,y0,f0.width,f0.height);for(let e0=0;e0<6;e0++){W=Fe[e0].mipmaps;for(let a0=0;a0<W.length;a0++){const hi=W[a0];We.format!==RGBAFormat?D0!==null?lt?t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,a0,0,0,hi.width,hi.height,D0,hi.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,a0,y0,hi.width,hi.height,0,hi.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,a0,0,0,hi.width,hi.height,D0,l0,hi.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,a0,y0,hi.width,hi.height,0,D0,l0,hi.data)}}}else{W=We.mipmaps,lt&&oi&&(W.length>0&&b0++,t.texStorage2D(r.TEXTURE_CUBE_MAP,b0,y0,Fe[0].width,Fe[0].height));for(let e0=0;e0<6;e0++)if(P0){lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,0,0,0,Fe[e0].width,Fe[e0].height,D0,l0,Fe[e0].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,0,y0,Fe[e0].width,Fe[e0].height,0,D0,l0,Fe[e0].data);for(let a0=0;a0<W.length;a0++){const p0=W[a0].image[e0].image;lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,a0+1,0,0,p0.width,p0.height,D0,l0,p0.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,a0+1,y0,p0.width,p0.height,0,D0,l0,p0.data)}}else{lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,0,0,0,D0,l0,Fe[e0]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,0,y0,D0,l0,Fe[e0]);for(let a0=0;a0<W.length;a0++){const hi=W[a0];lt?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,a0+1,0,0,D0,l0,hi.image[e0]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+e0,a0+1,y0,D0,l0,hi.image[e0])}}}v(We,v0)&&A(r.TEXTURE_CUBE_MAP),tt.__version=Z.version,We.onUpdate&&We.onUpdate(We)}ht.__version=We.version}function Ji(ht,We,h0,M0,Z,tt){const tr=s.convert(h0.format,h0.colorSpace),s0=s.convert(h0.type),c0=M(h0.internalFormat,tr,s0,h0.colorSpace);if(!n.get(We).__hasExternalTextures){const P0=Math.max(1,We.width>>tt),Fe=Math.max(1,We.height>>tt);Z===r.TEXTURE_3D||Z===r.TEXTURE_2D_ARRAY?t.texImage3D(Z,tt,c0,P0,Fe,We.depth,0,tr,s0,null):t.texImage2D(Z,tt,c0,P0,Fe,0,tr,s0,null)}t.bindFramebuffer(r.FRAMEBUFFER,ht),w0(We)?x.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,M0,Z,n.get(h0).__webglTexture,0,g0(We)):(Z===r.TEXTURE_2D||Z>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&Z<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,M0,Z,n.get(h0).__webglTexture,tt),t.bindFramebuffer(r.FRAMEBUFFER,null)}function er(ht,We,h0){if(r.bindRenderbuffer(r.RENDERBUFFER,ht),We.depthBuffer&&!We.stencilBuffer){let M0=a===!0?r.DEPTH_COMPONENT24:r.DEPTH_COMPONENT16;if(h0||w0(We)){const Z=We.depthTexture;Z&&Z.isDepthTexture&&(Z.type===FloatType?M0=r.DEPTH_COMPONENT32F:Z.type===UnsignedIntType&&(M0=r.DEPTH_COMPONENT24));const tt=g0(We);w0(We)?x.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,tt,M0,We.width,We.height):r.renderbufferStorageMultisample(r.RENDERBUFFER,tt,M0,We.width,We.height)}else r.renderbufferStorage(r.RENDERBUFFER,M0,We.width,We.height);r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,ht)}else if(We.depthBuffer&&We.stencilBuffer){const M0=g0(We);h0&&w0(We)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,M0,r.DEPTH24_STENCIL8,We.width,We.height):w0(We)?x.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,M0,r.DEPTH24_STENCIL8,We.width,We.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,We.width,We.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,ht)}else{const M0=We.isWebGLMultipleRenderTargets===!0?We.texture:[We.texture];for(let Z=0;Z<M0.length;Z++){const tt=M0[Z],tr=s.convert(tt.format,tt.colorSpace),s0=s.convert(tt.type),c0=M(tt.internalFormat,tr,s0,tt.colorSpace),A0=g0(We);h0&&w0(We)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,A0,c0,We.width,We.height):w0(We)?x.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,A0,c0,We.width,We.height):r.renderbufferStorage(r.RENDERBUFFER,c0,We.width,We.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function ec(ht,We){if(We&&We.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,ht),!(We.depthTexture&&We.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(We.depthTexture).__webglTexture||We.depthTexture.image.width!==We.width||We.depthTexture.image.height!==We.height)&&(We.depthTexture.image.width=We.width,We.depthTexture.image.height=We.height,We.depthTexture.needsUpdate=!0),H(We.depthTexture,0);const M0=n.get(We.depthTexture).__webglTexture,Z=g0(We);if(We.depthTexture.format===DepthFormat)w0(We)?x.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,M0,0,Z):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,M0,0);else if(We.depthTexture.format===DepthStencilFormat)w0(We)?x.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,M0,0,Z):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,M0,0);else throw new Error("Unknown depthTexture format")}function ai(ht){const We=n.get(ht),h0=ht.isWebGLCubeRenderTarget===!0;if(ht.depthTexture&&!We.__autoAllocateDepthBuffer){if(h0)throw new Error("target.depthTexture not supported in Cube render targets");ec(We.__webglFramebuffer,ht)}else if(h0){We.__webglDepthbuffer=[];for(let M0=0;M0<6;M0++)t.bindFramebuffer(r.FRAMEBUFFER,We.__webglFramebuffer[M0]),We.__webglDepthbuffer[M0]=r.createRenderbuffer(),er(We.__webglDepthbuffer[M0],ht,!1)}else t.bindFramebuffer(r.FRAMEBUFFER,We.__webglFramebuffer),We.__webglDepthbuffer=r.createRenderbuffer(),er(We.__webglDepthbuffer,ht,!1);t.bindFramebuffer(r.FRAMEBUFFER,null)}function u0(ht,We,h0){const M0=n.get(ht);We!==void 0&&Ji(M0.__webglFramebuffer,ht,ht.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),h0!==void 0&&ai(ht)}function o0(ht){const We=ht.texture,h0=n.get(ht),M0=n.get(We);ht.addEventListener("dispose",L),ht.isWebGLMultipleRenderTargets!==!0&&(M0.__webglTexture===void 0&&(M0.__webglTexture=r.createTexture()),M0.__version=We.version,o.memory.textures++);const Z=ht.isWebGLCubeRenderTarget===!0,tt=ht.isWebGLMultipleRenderTargets===!0,tr=S(ht)||a;if(Z){h0.__webglFramebuffer=[];for(let s0=0;s0<6;s0++)if(a&&We.mipmaps&&We.mipmaps.length>0){h0.__webglFramebuffer[s0]=[];for(let c0=0;c0<We.mipmaps.length;c0++)h0.__webglFramebuffer[s0][c0]=r.createFramebuffer()}else h0.__webglFramebuffer[s0]=r.createFramebuffer()}else{if(a&&We.mipmaps&&We.mipmaps.length>0){h0.__webglFramebuffer=[];for(let s0=0;s0<We.mipmaps.length;s0++)h0.__webglFramebuffer[s0]=r.createFramebuffer()}else h0.__webglFramebuffer=r.createFramebuffer();if(tt)if(i.drawBuffers){const s0=ht.texture;for(let c0=0,A0=s0.length;c0<A0;c0++){const P0=n.get(s0[c0]);P0.__webglTexture===void 0&&(P0.__webglTexture=r.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&ht.samples>0&&w0(ht)===!1){const s0=tt?We:[We];h0.__webglMultisampledFramebuffer=r.createFramebuffer(),h0.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,h0.__webglMultisampledFramebuffer);for(let c0=0;c0<s0.length;c0++){const A0=s0[c0];h0.__webglColorRenderbuffer[c0]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,h0.__webglColorRenderbuffer[c0]);const P0=s.convert(A0.format,A0.colorSpace),Fe=s.convert(A0.type),f0=M(A0.internalFormat,P0,Fe,A0.colorSpace,ht.isXRRenderTarget===!0),v0=g0(ht);r.renderbufferStorageMultisample(r.RENDERBUFFER,v0,f0,ht.width,ht.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+c0,r.RENDERBUFFER,h0.__webglColorRenderbuffer[c0])}r.bindRenderbuffer(r.RENDERBUFFER,null),ht.depthBuffer&&(h0.__webglDepthRenderbuffer=r.createRenderbuffer(),er(h0.__webglDepthRenderbuffer,ht,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(Z){t.bindTexture(r.TEXTURE_CUBE_MAP,M0.__webglTexture),He(r.TEXTURE_CUBE_MAP,We,tr);for(let s0=0;s0<6;s0++)if(a&&We.mipmaps&&We.mipmaps.length>0)for(let c0=0;c0<We.mipmaps.length;c0++)Ji(h0.__webglFramebuffer[s0][c0],ht,We,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+s0,c0);else Ji(h0.__webglFramebuffer[s0],ht,We,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+s0,0);v(We,tr)&&A(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(tt){const s0=ht.texture;for(let c0=0,A0=s0.length;c0<A0;c0++){const P0=s0[c0],Fe=n.get(P0);t.bindTexture(r.TEXTURE_2D,Fe.__webglTexture),He(r.TEXTURE_2D,P0,tr),Ji(h0.__webglFramebuffer,ht,P0,r.COLOR_ATTACHMENT0+c0,r.TEXTURE_2D,0),v(P0,tr)&&A(r.TEXTURE_2D)}t.unbindTexture()}else{let s0=r.TEXTURE_2D;if((ht.isWebGL3DRenderTarget||ht.isWebGLArrayRenderTarget)&&(a?s0=ht.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(s0,M0.__webglTexture),He(s0,We,tr),a&&We.mipmaps&&We.mipmaps.length>0)for(let c0=0;c0<We.mipmaps.length;c0++)Ji(h0.__webglFramebuffer[c0],ht,We,r.COLOR_ATTACHMENT0,s0,c0);else Ji(h0.__webglFramebuffer,ht,We,r.COLOR_ATTACHMENT0,s0,0);v(We,tr)&&A(s0),t.unbindTexture()}ht.depthBuffer&&ai(ht)}function E0(ht){const We=S(ht)||a,h0=ht.isWebGLMultipleRenderTargets===!0?ht.texture:[ht.texture];for(let M0=0,Z=h0.length;M0<Z;M0++){const tt=h0[M0];if(v(tt,We)){const tr=ht.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D,s0=n.get(tt).__webglTexture;t.bindTexture(tr,s0),A(tr),t.unbindTexture()}}}function F0(ht){if(a&&ht.samples>0&&w0(ht)===!1){const We=ht.isWebGLMultipleRenderTargets?ht.texture:[ht.texture],h0=ht.width,M0=ht.height;let Z=r.COLOR_BUFFER_BIT;const tt=[],tr=ht.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,s0=n.get(ht),c0=ht.isWebGLMultipleRenderTargets===!0;if(c0)for(let A0=0;A0<We.length;A0++)t.bindFramebuffer(r.FRAMEBUFFER,s0.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+A0,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,s0.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+A0,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,s0.__webglMultisampledFramebuffer),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,s0.__webglFramebuffer);for(let A0=0;A0<We.length;A0++){tt.push(r.COLOR_ATTACHMENT0+A0),ht.depthBuffer&&tt.push(tr);const P0=s0.__ignoreDepthValues!==void 0?s0.__ignoreDepthValues:!1;if(P0===!1&&(ht.depthBuffer&&(Z|=r.DEPTH_BUFFER_BIT),ht.stencilBuffer&&(Z|=r.STENCIL_BUFFER_BIT)),c0&&r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,s0.__webglColorRenderbuffer[A0]),P0===!0&&(r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[tr]),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[tr])),c0){const Fe=n.get(We[A0]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,Fe,0)}r.blitFramebuffer(0,0,h0,M0,0,0,h0,M0,Z,r.NEAREST),y&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,tt)}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),c0)for(let A0=0;A0<We.length;A0++){t.bindFramebuffer(r.FRAMEBUFFER,s0.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+A0,r.RENDERBUFFER,s0.__webglColorRenderbuffer[A0]);const P0=n.get(We[A0]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,s0.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+A0,r.TEXTURE_2D,P0,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,s0.__webglMultisampledFramebuffer)}}function g0(ht){return Math.min(g,ht.samples)}function w0(ht){const We=n.get(ht);return a&&ht.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&We.__useRenderToTexture!==!1}function L0(ht){const We=o.render.frame;b.get(ht)!==We&&(b.set(ht,We),ht.update())}function T0(ht,We){const h0=ht.colorSpace,M0=ht.format,Z=ht.type;return ht.isCompressedTexture===!0||ht.isVideoTexture===!0||ht.format===_SRGBAFormat||h0!==LinearSRGBColorSpace&&h0!==NoColorSpace&&(ColorManagement.getTransfer(h0)===SRGBTransfer?a===!1?e.has("EXT_sRGB")===!0&&M0===RGBAFormat?(ht.format=_SRGBAFormat,ht.minFilter=LinearFilter,ht.generateMipmaps=!1):We=ImageUtils.sRGBToLinear(We):(M0!==RGBAFormat||Z!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",h0)),We}this.allocateTextureUnit=k,this.resetTextureUnits=F,this.setTexture2D=H,this.setTexture2DArray=B,this.setTexture3D=V,this.setTextureCube=Y,this.rebindTextures=u0,this.setupRenderTarget=o0,this.updateRenderTargetMipmap=E0,this.updateMultisampleRenderTarget=F0,this.setupDepthRenderbuffer=ai,this.setupFrameBufferTexture=Ji,this.useMultisampledRTT=w0}function WebGLUtils(r,e,t){const n=t.isWebGL2;function i(s,o=NoColorSpace){let a;const l=ColorManagement.getTransfer(o);if(s===UnsignedByteType)return r.UNSIGNED_BYTE;if(s===UnsignedShort4444Type)return r.UNSIGNED_SHORT_4_4_4_4;if(s===UnsignedShort5551Type)return r.UNSIGNED_SHORT_5_5_5_1;if(s===ByteType)return r.BYTE;if(s===ShortType)return r.SHORT;if(s===UnsignedShortType)return r.UNSIGNED_SHORT;if(s===IntType)return r.INT;if(s===UnsignedIntType)return r.UNSIGNED_INT;if(s===FloatType)return r.FLOAT;if(s===HalfFloatType)return n?r.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===AlphaFormat)return r.ALPHA;if(s===RGBAFormat)return r.RGBA;if(s===LuminanceFormat)return r.LUMINANCE;if(s===LuminanceAlphaFormat)return r.LUMINANCE_ALPHA;if(s===DepthFormat)return r.DEPTH_COMPONENT;if(s===DepthStencilFormat)return r.DEPTH_STENCIL;if(s===_SRGBAFormat)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===RedFormat)return r.RED;if(s===RedIntegerFormat)return r.RED_INTEGER;if(s===RGFormat)return r.RG;if(s===RGIntegerFormat)return r.RG_INTEGER;if(s===RGBAIntegerFormat)return r.RGBA_INTEGER;if(s===RGB_S3TC_DXT1_Format||s===RGBA_S3TC_DXT1_Format||s===RGBA_S3TC_DXT3_Format||s===RGBA_S3TC_DXT5_Format)if(l===SRGBTransfer)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===RGB_S3TC_DXT1_Format)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT1_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT3_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===RGBA_S3TC_DXT5_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===RGB_S3TC_DXT1_Format)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT1_Format)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT3_Format)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===RGBA_S3TC_DXT5_Format)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===RGB_PVRTC_4BPPV1_Format||s===RGB_PVRTC_2BPPV1_Format||s===RGBA_PVRTC_4BPPV1_Format||s===RGBA_PVRTC_2BPPV1_Format)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===RGB_PVRTC_4BPPV1_Format)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===RGB_PVRTC_2BPPV1_Format)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===RGBA_PVRTC_4BPPV1_Format)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===RGBA_PVRTC_2BPPV1_Format)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===RGB_ETC1_Format)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===RGB_ETC2_Format||s===RGBA_ETC2_EAC_Format)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===RGB_ETC2_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===RGBA_ETC2_EAC_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===RGBA_ASTC_4x4_Format||s===RGBA_ASTC_5x4_Format||s===RGBA_ASTC_5x5_Format||s===RGBA_ASTC_6x5_Format||s===RGBA_ASTC_6x6_Format||s===RGBA_ASTC_8x5_Format||s===RGBA_ASTC_8x6_Format||s===RGBA_ASTC_8x8_Format||s===RGBA_ASTC_10x5_Format||s===RGBA_ASTC_10x6_Format||s===RGBA_ASTC_10x8_Format||s===RGBA_ASTC_10x10_Format||s===RGBA_ASTC_12x10_Format||s===RGBA_ASTC_12x12_Format)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===RGBA_ASTC_4x4_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===RGBA_ASTC_5x4_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===RGBA_ASTC_5x5_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===RGBA_ASTC_6x5_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===RGBA_ASTC_6x6_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===RGBA_ASTC_8x5_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===RGBA_ASTC_8x6_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===RGBA_ASTC_8x8_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===RGBA_ASTC_10x5_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===RGBA_ASTC_10x6_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===RGBA_ASTC_10x8_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===RGBA_ASTC_10x10_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===RGBA_ASTC_12x10_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===RGBA_ASTC_12x12_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===RGBA_BPTC_Format||s===RGB_BPTC_SIGNED_Format||s===RGB_BPTC_UNSIGNED_Format)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===RGBA_BPTC_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===RGB_BPTC_SIGNED_Format)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===RGB_BPTC_UNSIGNED_Format)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===RED_RGTC1_Format||s===SIGNED_RED_RGTC1_Format||s===RED_GREEN_RGTC2_Format||s===SIGNED_RED_GREEN_RGTC2_Format)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===RGBA_BPTC_Format)return a.COMPRESSED_RED_RGTC1_EXT;if(s===SIGNED_RED_RGTC1_Format)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===RED_GREEN_RGTC2_Format)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===SIGNED_RED_GREEN_RGTC2_Format)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===UnsignedInt248Type?n?r.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):r[s]!==void 0?r[s]:null}return{convert:i}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,o=null;const a=this._targetRay,l=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){o=!0;for(const _ of e.hand.values()){const h=t.getJointPose(_,n),f=this._getHandJoint(d,_);h!==null&&(f.matrix.fromArray(h.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,f.jointRadius=h.radius),f.visible=h!==null}const u=d.joints["index-finger-tip"],g=d.joints["thumb-tip"],x=u.position.distanceTo(g.position),y=.02,b=.005;d.inputState.pinching&&x>y+b?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&x<=y-b&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=s!==null),d!==null&&(d.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Group;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class DepthTexture extends Texture{constructor(e,t,n,i,s,o,a,l,d,u){if(u=u!==void 0?u:DepthFormat,u!==DepthFormat&&u!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===DepthFormat&&(n=UnsignedIntType),n===void 0&&u===DepthStencilFormat&&(n=UnsignedInt248Type),super(null,i,s,o,a,l,u,n,d),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:NearestFilter,this.minFilter=l!==void 0?l:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class WebXRManager extends EventDispatcher{constructor(e,t){super();const n=this;let i=null,s=1,o=null,a="local-floor",l=1,d=null,u=null,g=null,x=null,y=null,b=null;const _=t.getContextAttributes();let h=null,f=null;const E=[],m=[],S=new PerspectiveCamera;S.layers.enable(1),S.viewport=new Vector4;const w=new PerspectiveCamera;w.layers.enable(2),w.viewport=new Vector4;const v=[S,w],A=new ArrayCamera;A.layers.enable(1),A.layers.enable(2);let M=null,T=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(B){let V=E[B];return V===void 0&&(V=new WebXRController,E[B]=V),V.getTargetRaySpace()},this.getControllerGrip=function(B){let V=E[B];return V===void 0&&(V=new WebXRController,E[B]=V),V.getGripSpace()},this.getHand=function(B){let V=E[B];return V===void 0&&(V=new WebXRController,E[B]=V),V.getHandSpace()};function R(B){const V=m.indexOf(B.inputSource);if(V===-1)return;const Y=E[V];Y!==void 0&&(Y.update(B.inputSource,B.frame,d||o),Y.dispatchEvent({type:B.type,data:B.inputSource}))}function O(){i.removeEventListener("select",R),i.removeEventListener("selectstart",R),i.removeEventListener("selectend",R),i.removeEventListener("squeeze",R),i.removeEventListener("squeezestart",R),i.removeEventListener("squeezeend",R),i.removeEventListener("end",O),i.removeEventListener("inputsourceschange",L);for(let B=0;B<E.length;B++){const V=m[B];V!==null&&(m[B]=null,E[B].disconnect(V))}M=null,T=null,e.setRenderTarget(h),y=null,x=null,g=null,i=null,f=null,H.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(B){s=B,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(B){a=B,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||o},this.setReferenceSpace=function(B){d=B},this.getBaseLayer=function(){return x!==null?x:y},this.getBinding=function(){return g},this.getFrame=function(){return b},this.getSession=function(){return i},this.setSession=async function(B){if(i=B,i!==null){if(h=e.getRenderTarget(),i.addEventListener("select",R),i.addEventListener("selectstart",R),i.addEventListener("selectend",R),i.addEventListener("squeeze",R),i.addEventListener("squeezestart",R),i.addEventListener("squeezeend",R),i.addEventListener("end",O),i.addEventListener("inputsourceschange",L),_.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const V={antialias:i.renderState.layers===void 0?_.antialias:!0,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(i,t,V),i.updateRenderState({baseLayer:y}),f=new WebGLRenderTarget(y.framebufferWidth,y.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})}else{let V=null,Y=null,K=null;_.depth&&(K=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,V=_.stencil?DepthStencilFormat:DepthFormat,Y=_.stencil?UnsignedInt248Type:UnsignedIntType);const J={colorFormat:t.RGBA8,depthFormat:K,scaleFactor:s};g=new XRWebGLBinding(i,t),x=g.createProjectionLayer(J),i.updateRenderState({layers:[x]}),f=new WebGLRenderTarget(x.textureWidth,x.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(x.textureWidth,x.textureHeight,Y,void 0,void 0,void 0,void 0,void 0,void 0,V),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0});const Te=e.properties.get(f);Te.__ignoreDepthValues=x.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(l),d=null,o=await i.requestReferenceSpace(a),H.setContext(i),H.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function L(B){for(let V=0;V<B.removed.length;V++){const Y=B.removed[V],K=m.indexOf(Y);K>=0&&(m[K]=null,E[K].disconnect(Y))}for(let V=0;V<B.added.length;V++){const Y=B.added[V];let K=m.indexOf(Y);if(K===-1){for(let Te=0;Te<E.length;Te++)if(Te>=m.length){m.push(Y),K=Te;break}else if(m[Te]===null){m[Te]=Y,K=Te;break}if(K===-1)break}const J=E[K];J&&J.connect(Y)}}const P=new Vector3,I=new Vector3;function N(B,V,Y){P.setFromMatrixPosition(V.matrixWorld),I.setFromMatrixPosition(Y.matrixWorld);const K=P.distanceTo(I),J=V.projectionMatrix.elements,Te=Y.projectionMatrix.elements,He=J[14]/(J[10]-1),Q=J[14]/(J[10]+1),Xe=(J[9]+1)/J[5],ut=(J[9]-1)/J[5],Ji=(J[8]-1)/J[0],er=(Te[8]+1)/Te[0],ec=He*Ji,ai=He*er,u0=K/(-Ji+er),o0=u0*-Ji;V.matrixWorld.decompose(B.position,B.quaternion,B.scale),B.translateX(o0),B.translateZ(u0),B.matrixWorld.compose(B.position,B.quaternion,B.scale),B.matrixWorldInverse.copy(B.matrixWorld).invert();const E0=He+u0,F0=Q+u0,g0=ec-o0,w0=ai+(K-o0),L0=Xe*Q/F0*E0,T0=ut*Q/F0*E0;B.projectionMatrix.makePerspective(g0,w0,L0,T0,E0,F0),B.projectionMatrixInverse.copy(B.projectionMatrix).invert()}function U(B,V){V===null?B.matrixWorld.copy(B.matrix):B.matrixWorld.multiplyMatrices(V.matrixWorld,B.matrix),B.matrixWorldInverse.copy(B.matrixWorld).invert()}this.updateCamera=function(B){if(i===null)return;A.near=w.near=S.near=B.near,A.far=w.far=S.far=B.far,(M!==A.near||T!==A.far)&&(i.updateRenderState({depthNear:A.near,depthFar:A.far}),M=A.near,T=A.far);const V=B.parent,Y=A.cameras;U(A,V);for(let K=0;K<Y.length;K++)U(Y[K],V);Y.length===2?N(A,S,w):A.projectionMatrix.copy(S.projectionMatrix),F(B,A,V)};function F(B,V,Y){Y===null?B.matrix.copy(V.matrixWorld):(B.matrix.copy(Y.matrixWorld),B.matrix.invert(),B.matrix.multiply(V.matrixWorld)),B.matrix.decompose(B.position,B.quaternion,B.scale),B.updateMatrixWorld(!0),B.projectionMatrix.copy(V.projectionMatrix),B.projectionMatrixInverse.copy(V.projectionMatrixInverse),B.isPerspectiveCamera&&(B.fov=RAD2DEG*2*Math.atan(1/B.projectionMatrix.elements[5]),B.zoom=1)}this.getCamera=function(){return A},this.getFoveation=function(){if(!(x===null&&y===null))return l},this.setFoveation=function(B){l=B,x!==null&&(x.fixedFoveation=B),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=B)};let k=null;function j(B,V){if(u=V.getViewerPose(d||o),b=V,u!==null){const Y=u.views;y!==null&&(e.setRenderTargetFramebuffer(f,y.framebuffer),e.setRenderTarget(f));let K=!1;Y.length!==A.cameras.length&&(A.cameras.length=0,K=!0);for(let J=0;J<Y.length;J++){const Te=Y[J];let He=null;if(y!==null)He=y.getViewport(Te);else{const Xe=g.getViewSubImage(x,Te);He=Xe.viewport,J===0&&(e.setRenderTargetTextures(f,Xe.colorTexture,x.ignoreDepthValues?void 0:Xe.depthStencilTexture),e.setRenderTarget(f))}let Q=v[J];Q===void 0&&(Q=new PerspectiveCamera,Q.layers.enable(J),Q.viewport=new Vector4,v[J]=Q),Q.matrix.fromArray(Te.transform.matrix),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale),Q.projectionMatrix.fromArray(Te.projectionMatrix),Q.projectionMatrixInverse.copy(Q.projectionMatrix).invert(),Q.viewport.set(He.x,He.y,He.width,He.height),J===0&&(A.matrix.copy(Q.matrix),A.matrix.decompose(A.position,A.quaternion,A.scale)),K===!0&&A.cameras.push(Q)}}for(let Y=0;Y<E.length;Y++){const K=m[Y],J=E[Y];K!==null&&J!==void 0&&J.update(K,V,d||o)}k&&k(B,V),V.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:V}),b=null}const H=new WebGLAnimation;H.setAnimationLoop(j),this.setAnimationLoop=function(B){k=B},this.dispose=function(){}}}function WebGLMaterials(r,e){function t(h,f){h.matrixAutoUpdate===!0&&h.updateMatrix(),f.value.copy(h.matrix)}function n(h,f){f.color.getRGB(h.fogColor.value,getUnlitUniformColorSpace(r)),f.isFog?(h.fogNear.value=f.near,h.fogFar.value=f.far):f.isFogExp2&&(h.fogDensity.value=f.density)}function i(h,f,E,m,S){f.isMeshBasicMaterial||f.isMeshLambertMaterial?s(h,f):f.isMeshToonMaterial?(s(h,f),g(h,f)):f.isMeshPhongMaterial?(s(h,f),u(h,f)):f.isMeshStandardMaterial?(s(h,f),x(h,f),f.isMeshPhysicalMaterial&&y(h,f,S)):f.isMeshMatcapMaterial?(s(h,f),b(h,f)):f.isMeshDepthMaterial?s(h,f):f.isMeshDistanceMaterial?(s(h,f),_(h,f)):f.isMeshNormalMaterial?s(h,f):f.isLineBasicMaterial?(o(h,f),f.isLineDashedMaterial&&a(h,f)):f.isPointsMaterial?l(h,f,E,m):f.isSpriteMaterial?d(h,f):f.isShadowMaterial?(h.color.value.copy(f.color),h.opacity.value=f.opacity):f.isShaderMaterial&&(f.uniformsNeedUpdate=!1)}function s(h,f){h.opacity.value=f.opacity,f.color&&h.diffuse.value.copy(f.color),f.emissive&&h.emissive.value.copy(f.emissive).multiplyScalar(f.emissiveIntensity),f.map&&(h.map.value=f.map,t(f.map,h.mapTransform)),f.alphaMap&&(h.alphaMap.value=f.alphaMap,t(f.alphaMap,h.alphaMapTransform)),f.bumpMap&&(h.bumpMap.value=f.bumpMap,t(f.bumpMap,h.bumpMapTransform),h.bumpScale.value=f.bumpScale,f.side===BackSide&&(h.bumpScale.value*=-1)),f.normalMap&&(h.normalMap.value=f.normalMap,t(f.normalMap,h.normalMapTransform),h.normalScale.value.copy(f.normalScale),f.side===BackSide&&h.normalScale.value.negate()),f.displacementMap&&(h.displacementMap.value=f.displacementMap,t(f.displacementMap,h.displacementMapTransform),h.displacementScale.value=f.displacementScale,h.displacementBias.value=f.displacementBias),f.emissiveMap&&(h.emissiveMap.value=f.emissiveMap,t(f.emissiveMap,h.emissiveMapTransform)),f.specularMap&&(h.specularMap.value=f.specularMap,t(f.specularMap,h.specularMapTransform)),f.alphaTest>0&&(h.alphaTest.value=f.alphaTest);const E=e.get(f).envMap;if(E&&(h.envMap.value=E,h.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,h.reflectivity.value=f.reflectivity,h.ior.value=f.ior,h.refractionRatio.value=f.refractionRatio),f.lightMap){h.lightMap.value=f.lightMap;const m=r._useLegacyLights===!0?Math.PI:1;h.lightMapIntensity.value=f.lightMapIntensity*m,t(f.lightMap,h.lightMapTransform)}f.aoMap&&(h.aoMap.value=f.aoMap,h.aoMapIntensity.value=f.aoMapIntensity,t(f.aoMap,h.aoMapTransform))}function o(h,f){h.diffuse.value.copy(f.color),h.opacity.value=f.opacity,f.map&&(h.map.value=f.map,t(f.map,h.mapTransform))}function a(h,f){h.dashSize.value=f.dashSize,h.totalSize.value=f.dashSize+f.gapSize,h.scale.value=f.scale}function l(h,f,E,m){h.diffuse.value.copy(f.color),h.opacity.value=f.opacity,h.size.value=f.size*E,h.scale.value=m*.5,f.map&&(h.map.value=f.map,t(f.map,h.uvTransform)),f.alphaMap&&(h.alphaMap.value=f.alphaMap,t(f.alphaMap,h.alphaMapTransform)),f.alphaTest>0&&(h.alphaTest.value=f.alphaTest)}function d(h,f){h.diffuse.value.copy(f.color),h.opacity.value=f.opacity,h.rotation.value=f.rotation,f.map&&(h.map.value=f.map,t(f.map,h.mapTransform)),f.alphaMap&&(h.alphaMap.value=f.alphaMap,t(f.alphaMap,h.alphaMapTransform)),f.alphaTest>0&&(h.alphaTest.value=f.alphaTest)}function u(h,f){h.specular.value.copy(f.specular),h.shininess.value=Math.max(f.shininess,1e-4)}function g(h,f){f.gradientMap&&(h.gradientMap.value=f.gradientMap)}function x(h,f){h.metalness.value=f.metalness,f.metalnessMap&&(h.metalnessMap.value=f.metalnessMap,t(f.metalnessMap,h.metalnessMapTransform)),h.roughness.value=f.roughness,f.roughnessMap&&(h.roughnessMap.value=f.roughnessMap,t(f.roughnessMap,h.roughnessMapTransform)),e.get(f).envMap&&(h.envMapIntensity.value=f.envMapIntensity)}function y(h,f,E){h.ior.value=f.ior,f.sheen>0&&(h.sheenColor.value.copy(f.sheenColor).multiplyScalar(f.sheen),h.sheenRoughness.value=f.sheenRoughness,f.sheenColorMap&&(h.sheenColorMap.value=f.sheenColorMap,t(f.sheenColorMap,h.sheenColorMapTransform)),f.sheenRoughnessMap&&(h.sheenRoughnessMap.value=f.sheenRoughnessMap,t(f.sheenRoughnessMap,h.sheenRoughnessMapTransform))),f.clearcoat>0&&(h.clearcoat.value=f.clearcoat,h.clearcoatRoughness.value=f.clearcoatRoughness,f.clearcoatMap&&(h.clearcoatMap.value=f.clearcoatMap,t(f.clearcoatMap,h.clearcoatMapTransform)),f.clearcoatRoughnessMap&&(h.clearcoatRoughnessMap.value=f.clearcoatRoughnessMap,t(f.clearcoatRoughnessMap,h.clearcoatRoughnessMapTransform)),f.clearcoatNormalMap&&(h.clearcoatNormalMap.value=f.clearcoatNormalMap,t(f.clearcoatNormalMap,h.clearcoatNormalMapTransform),h.clearcoatNormalScale.value.copy(f.clearcoatNormalScale),f.side===BackSide&&h.clearcoatNormalScale.value.negate())),f.iridescence>0&&(h.iridescence.value=f.iridescence,h.iridescenceIOR.value=f.iridescenceIOR,h.iridescenceThicknessMinimum.value=f.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum.value=f.iridescenceThicknessRange[1],f.iridescenceMap&&(h.iridescenceMap.value=f.iridescenceMap,t(f.iridescenceMap,h.iridescenceMapTransform)),f.iridescenceThicknessMap&&(h.iridescenceThicknessMap.value=f.iridescenceThicknessMap,t(f.iridescenceThicknessMap,h.iridescenceThicknessMapTransform))),f.transmission>0&&(h.transmission.value=f.transmission,h.transmissionSamplerMap.value=E.texture,h.transmissionSamplerSize.value.set(E.width,E.height),f.transmissionMap&&(h.transmissionMap.value=f.transmissionMap,t(f.transmissionMap,h.transmissionMapTransform)),h.thickness.value=f.thickness,f.thicknessMap&&(h.thicknessMap.value=f.thicknessMap,t(f.thicknessMap,h.thicknessMapTransform)),h.attenuationDistance.value=f.attenuationDistance,h.attenuationColor.value.copy(f.attenuationColor)),f.anisotropy>0&&(h.anisotropyVector.value.set(f.anisotropy*Math.cos(f.anisotropyRotation),f.anisotropy*Math.sin(f.anisotropyRotation)),f.anisotropyMap&&(h.anisotropyMap.value=f.anisotropyMap,t(f.anisotropyMap,h.anisotropyMapTransform))),h.specularIntensity.value=f.specularIntensity,h.specularColor.value.copy(f.specularColor),f.specularColorMap&&(h.specularColorMap.value=f.specularColorMap,t(f.specularColorMap,h.specularColorMapTransform)),f.specularIntensityMap&&(h.specularIntensityMap.value=f.specularIntensityMap,t(f.specularIntensityMap,h.specularIntensityMapTransform))}function b(h,f){f.matcap&&(h.matcap.value=f.matcap)}function _(h,f){const E=e.get(f).light;h.referencePosition.value.setFromMatrixPosition(E.matrixWorld),h.nearDistance.value=E.shadow.camera.near,h.farDistance.value=E.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function WebGLUniformsGroups(r,e,t,n){let i={},s={},o=[];const a=t.isWebGL2?r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(E,m){const S=m.program;n.uniformBlockBinding(E,S)}function d(E,m){let S=i[E.id];S===void 0&&(b(E),S=u(E),i[E.id]=S,E.addEventListener("dispose",h));const w=m.program;n.updateUBOMapping(E,w);const v=e.render.frame;s[E.id]!==v&&(x(E),s[E.id]=v)}function u(E){const m=g();E.__bindingPointIndex=m;const S=r.createBuffer(),w=E.__size,v=E.usage;return r.bindBuffer(r.UNIFORM_BUFFER,S),r.bufferData(r.UNIFORM_BUFFER,w,v),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,m,S),S}function g(){for(let E=0;E<a;E++)if(o.indexOf(E)===-1)return o.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function x(E){const m=i[E.id],S=E.uniforms,w=E.__cache;r.bindBuffer(r.UNIFORM_BUFFER,m);for(let v=0,A=S.length;v<A;v++){const M=S[v];if(y(M,v,w)===!0){const T=M.__offset,R=Array.isArray(M.value)?M.value:[M.value];let O=0;for(let L=0;L<R.length;L++){const P=R[L],I=_(P);typeof P=="number"?(M.__data[0]=P,r.bufferSubData(r.UNIFORM_BUFFER,T+O,M.__data)):P.isMatrix3?(M.__data[0]=P.elements[0],M.__data[1]=P.elements[1],M.__data[2]=P.elements[2],M.__data[3]=P.elements[0],M.__data[4]=P.elements[3],M.__data[5]=P.elements[4],M.__data[6]=P.elements[5],M.__data[7]=P.elements[0],M.__data[8]=P.elements[6],M.__data[9]=P.elements[7],M.__data[10]=P.elements[8],M.__data[11]=P.elements[0]):(P.toArray(M.__data,O),O+=I.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,T,M.__data)}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function y(E,m,S){const w=E.value;if(S[m]===void 0){if(typeof w=="number")S[m]=w;else{const v=Array.isArray(w)?w:[w],A=[];for(let M=0;M<v.length;M++)A.push(v[M].clone());S[m]=A}return!0}else if(typeof w=="number"){if(S[m]!==w)return S[m]=w,!0}else{const v=Array.isArray(S[m])?S[m]:[S[m]],A=Array.isArray(w)?w:[w];for(let M=0;M<v.length;M++){const T=v[M];if(T.equals(A[M])===!1)return T.copy(A[M]),!0}}return!1}function b(E){const m=E.uniforms;let S=0;const w=16;let v=0;for(let A=0,M=m.length;A<M;A++){const T=m[A],R={boundary:0,storage:0},O=Array.isArray(T.value)?T.value:[T.value];for(let L=0,P=O.length;L<P;L++){const I=O[L],N=_(I);R.boundary+=N.boundary,R.storage+=N.storage}if(T.__data=new Float32Array(R.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=S,A>0){v=S%w;const L=w-v;v!==0&&L-R.boundary<0&&(S+=w-v,T.__offset=S)}S+=R.storage}return v=S%w,v>0&&(S+=w-v),E.__size=S,E.__cache={},this}function _(E){const m={boundary:0,storage:0};return typeof E=="number"?(m.boundary=4,m.storage=4):E.isVector2?(m.boundary=8,m.storage=8):E.isVector3||E.isColor?(m.boundary=16,m.storage=12):E.isVector4?(m.boundary=16,m.storage=16):E.isMatrix3?(m.boundary=48,m.storage=48):E.isMatrix4?(m.boundary=64,m.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),m}function h(E){const m=E.target;m.removeEventListener("dispose",h);const S=o.indexOf(m.__bindingPointIndex);o.splice(S,1),r.deleteBuffer(i[m.id]),delete i[m.id],delete s[m.id]}function f(){for(const E in i)r.deleteBuffer(i[E]);o=[],i={},s={}}return{bind:l,update:d,dispose:f}}class WebGLRenderer{constructor(e={}){const{canvas:t=createCanvasElement(),context:n=null,depth:i=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:d=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:g=!1}=e;this.isWebGLRenderer=!0;let x;n!==null?x=n.getContextAttributes().alpha:x=o;const y=new Uint32Array(4),b=new Int32Array(4);let _=null,h=null;const f=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this._useLegacyLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const m=this;let S=!1,w=0,v=0,A=null,M=-1,T=null;const R=new Vector4,O=new Vector4;let L=null;const P=new Color(0);let I=0,N=t.width,U=t.height,F=1,k=null,j=null;const H=new Vector4(0,0,N,U),B=new Vector4(0,0,N,U);let V=!1;const Y=new Frustum;let K=!1,J=!1,Te=null;const He=new Matrix4,Q=new Vector2,Xe=new Vector3,ut={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ji(){return A===null?F:1}let er=n;function ec(Hm,C0){for(let z0=0;z0<Hm.length;z0++){const B0=Hm[z0],V0=t.getContext(B0,C0);if(V0!==null)return V0}return null}try{const Hm={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:d,powerPreference:u,failIfMajorPerformanceCaveat:g};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${REVISION}`),t.addEventListener("webglcontextlost",lt,!1),t.addEventListener("webglcontextrestored",oi,!1),t.addEventListener("webglcontextcreationerror",b0,!1),er===null){const C0=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&C0.shift(),er=ec(C0,Hm),er===null)throw ec(C0)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&er instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),er.getShaderPrecisionFormat===void 0&&(er.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Hm){throw console.error("THREE.WebGLRenderer: "+Hm.message),Hm}let ai,u0,o0,E0,F0,g0,w0,L0,T0,ht,We,h0,M0,Z,tt,tr,s0,c0,A0,P0,Fe,f0,v0,D0;function l0(){ai=new WebGLExtensions(er),u0=new WebGLCapabilities(er,ai,e),ai.init(u0),f0=new WebGLUtils(er,ai,u0),o0=new WebGLState(er,ai,u0),E0=new WebGLInfo(er),F0=new WebGLProperties,g0=new WebGLTextures(er,ai,o0,F0,u0,f0,E0),w0=new WebGLCubeMaps(m),L0=new WebGLCubeUVMaps(m),T0=new WebGLAttributes(er,u0),v0=new WebGLBindingStates(er,ai,T0,u0),ht=new WebGLGeometries(er,T0,E0,v0),We=new WebGLObjects(er,ht,T0,E0),A0=new WebGLMorphtargets(er,u0,g0),tr=new WebGLClipping(F0),h0=new WebGLPrograms(m,w0,L0,ai,u0,v0,tr),M0=new WebGLMaterials(m,F0),Z=new WebGLRenderLists,tt=new WebGLRenderStates(ai,u0),c0=new WebGLBackground(m,w0,L0,o0,We,x,l),s0=new WebGLShadowMap(m,We,u0),D0=new WebGLUniformsGroups(er,E0,u0,o0),P0=new WebGLBufferRenderer(er,ai,E0,u0),Fe=new WebGLIndexedBufferRenderer(er,ai,E0,u0),E0.programs=h0.programs,m.capabilities=u0,m.extensions=ai,m.properties=F0,m.renderLists=Z,m.shadowMap=s0,m.state=o0,m.info=E0}l0();const y0=new WebXRManager(m,er);this.xr=y0,this.getContext=function(){return er},this.getContextAttributes=function(){return er.getContextAttributes()},this.forceContextLoss=function(){const Hm=ai.get("WEBGL_lose_context");Hm&&Hm.loseContext()},this.forceContextRestore=function(){const Hm=ai.get("WEBGL_lose_context");Hm&&Hm.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(Hm){Hm!==void 0&&(F=Hm,this.setSize(N,U,!1))},this.getSize=function(Hm){return Hm.set(N,U)},this.setSize=function(Hm,C0,z0=!0){if(y0.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}N=Hm,U=C0,t.width=Math.floor(Hm*F),t.height=Math.floor(C0*F),z0===!0&&(t.style.width=Hm+"px",t.style.height=C0+"px"),this.setViewport(0,0,Hm,C0)},this.getDrawingBufferSize=function(Hm){return Hm.set(N*F,U*F).floor()},this.setDrawingBufferSize=function(Hm,C0,z0){N=Hm,U=C0,F=z0,t.width=Math.floor(Hm*z0),t.height=Math.floor(C0*z0),this.setViewport(0,0,Hm,C0)},this.getCurrentViewport=function(Hm){return Hm.copy(R)},this.getViewport=function(Hm){return Hm.copy(H)},this.setViewport=function(Hm,C0,z0,B0){Hm.isVector4?H.set(Hm.x,Hm.y,Hm.z,Hm.w):H.set(Hm,C0,z0,B0),o0.viewport(R.copy(H).multiplyScalar(F).floor())},this.getScissor=function(Hm){return Hm.copy(B)},this.setScissor=function(Hm,C0,z0,B0){Hm.isVector4?B.set(Hm.x,Hm.y,Hm.z,Hm.w):B.set(Hm,C0,z0,B0),o0.scissor(O.copy(B).multiplyScalar(F).floor())},this.getScissorTest=function(){return V},this.setScissorTest=function(Hm){o0.setScissorTest(V=Hm)},this.setOpaqueSort=function(Hm){k=Hm},this.setTransparentSort=function(Hm){j=Hm},this.getClearColor=function(Hm){return Hm.copy(c0.getClearColor())},this.setClearColor=function(){c0.setClearColor.apply(c0,arguments)},this.getClearAlpha=function(){return c0.getClearAlpha()},this.setClearAlpha=function(){c0.setClearAlpha.apply(c0,arguments)},this.clear=function(Hm=!0,C0=!0,z0=!0){let B0=0;if(Hm){let V0=!1;if(A!==null){const i1=A.texture.format;V0=i1===RGBAIntegerFormat||i1===RGIntegerFormat||i1===RedIntegerFormat}if(V0){const i1=A.texture.type,u1=i1===UnsignedByteType||i1===UnsignedIntType||i1===UnsignedShortType||i1===UnsignedInt248Type||i1===UnsignedShort4444Type||i1===UnsignedShort5551Type,f1=c0.getClearColor(),a1=c0.getClearAlpha(),k0=f1.r,r1=f1.g,l1=f1.b;u1?(y[0]=k0,y[1]=r1,y[2]=l1,y[3]=a1,er.clearBufferuiv(er.COLOR,0,y)):(b[0]=k0,b[1]=r1,b[2]=l1,b[3]=a1,er.clearBufferiv(er.COLOR,0,b))}else B0|=er.COLOR_BUFFER_BIT}C0&&(B0|=er.DEPTH_BUFFER_BIT),z0&&(B0|=er.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),er.clear(B0)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",lt,!1),t.removeEventListener("webglcontextrestored",oi,!1),t.removeEventListener("webglcontextcreationerror",b0,!1),Z.dispose(),tt.dispose(),F0.dispose(),w0.dispose(),L0.dispose(),We.dispose(),v0.dispose(),D0.dispose(),h0.dispose(),y0.dispose(),y0.removeEventListener("sessionstart",q),y0.removeEventListener("sessionend",it),Te&&(Te.dispose(),Te=null),at.stop()};function lt(Hm){Hm.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),S=!0}function oi(){console.log("THREE.WebGLRenderer: Context Restored."),S=!1;const Hm=E0.autoReset,C0=s0.enabled,z0=s0.autoUpdate,B0=s0.needsUpdate,V0=s0.type;l0(),E0.autoReset=Hm,s0.enabled=C0,s0.autoUpdate=z0,s0.needsUpdate=B0,s0.type=V0}function b0(Hm){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Hm.statusMessage)}function W(Hm){const C0=Hm.target;C0.removeEventListener("dispose",W),e0(C0)}function e0(Hm){a0(Hm),F0.remove(Hm)}function a0(Hm){const C0=F0.get(Hm).programs;C0!==void 0&&(C0.forEach(function(z0){h0.releaseProgram(z0)}),Hm.isShaderMaterial&&h0.releaseShaderCache(Hm))}this.renderBufferDirect=function(Hm,C0,z0,B0,V0,i1){C0===null&&(C0=ut);const u1=V0.isMesh&&V0.matrixWorld.determinant()<0,f1=c1(Hm,C0,z0,B0,V0);o0.setMaterial(B0,u1);let a1=z0.index,k0=1;if(B0.wireframe===!0){if(a1=ht.getWireframeAttribute(z0),a1===void 0)return;k0=2}const r1=z0.drawRange,l1=z0.attributes.position;let v1=r1.start*k0,p1=(r1.start+r1.count)*k0;i1!==null&&(v1=Math.max(v1,i1.start*k0),p1=Math.min(p1,(i1.start+i1.count)*k0)),a1!==null?(v1=Math.max(v1,0),p1=Math.min(p1,a1.count)):l1!=null&&(v1=Math.max(v1,0),p1=Math.min(p1,l1.count));const b1=p1-v1;if(b1<0||b1===1/0)return;v0.setup(V0,B0,f1,z0,a1);let M1,o1=P0;if(a1!==null&&(M1=T0.get(a1),o1=Fe,o1.setIndex(M1)),V0.isMesh)B0.wireframe===!0?(o0.setLineWidth(B0.wireframeLinewidth*Ji()),o1.setMode(er.LINES)):o1.setMode(er.TRIANGLES);else if(V0.isLine){let g1=B0.linewidth;g1===void 0&&(g1=1),o0.setLineWidth(g1*Ji()),V0.isLineSegments?o1.setMode(er.LINES):V0.isLineLoop?o1.setMode(er.LINE_LOOP):o1.setMode(er.LINE_STRIP)}else V0.isPoints?o1.setMode(er.POINTS):V0.isSprite&&o1.setMode(er.TRIANGLES);if(V0.isInstancedMesh)o1.renderInstances(v1,b1,V0.count);else if(z0.isInstancedBufferGeometry){const g1=z0._maxInstanceCount!==void 0?z0._maxInstanceCount:1/0,y1=Math.min(z0.instanceCount,g1);o1.renderInstances(v1,b1,y1)}else o1.render(v1,b1)};function hi(Hm,C0,z0){Hm.transparent===!0&&Hm.side===DoubleSide&&Hm.forceSinglePass===!1?(Hm.side=BackSide,Hm.needsUpdate=!0,$0(Hm,C0,z0),Hm.side=FrontSide,Hm.needsUpdate=!0,$0(Hm,C0,z0),Hm.side=DoubleSide):$0(Hm,C0,z0)}this.compile=function(Hm,C0,z0=null){z0===null&&(z0=Hm),h=tt.get(z0),h.init(),E.push(h),z0.traverseVisible(function(V0){V0.isLight&&V0.layers.test(C0.layers)&&(h.pushLight(V0),V0.castShadow&&h.pushShadow(V0))}),Hm!==z0&&Hm.traverseVisible(function(V0){V0.isLight&&V0.layers.test(C0.layers)&&(h.pushLight(V0),V0.castShadow&&h.pushShadow(V0))}),h.setupLights(m._useLegacyLights);const B0=new Set;return Hm.traverse(function(V0){const i1=V0.material;if(i1)if(Array.isArray(i1))for(let u1=0;u1<i1.length;u1++){const f1=i1[u1];hi(f1,z0,V0),B0.add(f1)}else hi(i1,z0,V0),B0.add(i1)}),E.pop(),h=null,B0},this.compileAsync=function(Hm,C0,z0=null){const B0=this.compile(Hm,C0,z0);return new Promise(V0=>{function i1(){if(B0.forEach(function(u1){F0.get(u1).currentProgram.isReady()&&B0.delete(u1)}),B0.size===0){V0(Hm);return}setTimeout(i1,10)}ai.get("KHR_parallel_shader_compile")!==null?i1():setTimeout(i1,10)})};let p0=null;function O0(Hm){p0&&p0(Hm)}function q(){at.stop()}function it(){at.start()}const at=new WebGLAnimation;at.setAnimationLoop(O0),typeof self<"u"&&at.setContext(self),this.setAnimationLoop=function(Hm){p0=Hm,y0.setAnimationLoop(Hm),Hm===null?at.stop():at.start()},y0.addEventListener("sessionstart",q),y0.addEventListener("sessionend",it),this.render=function(Hm,C0){if(C0!==void 0&&C0.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(S===!0)return;Hm.matrixWorldAutoUpdate===!0&&Hm.updateMatrixWorld(),C0.parent===null&&C0.matrixWorldAutoUpdate===!0&&C0.updateMatrixWorld(),y0.enabled===!0&&y0.isPresenting===!0&&(y0.cameraAutoUpdate===!0&&y0.updateCamera(C0),C0=y0.getCamera()),Hm.isScene===!0&&Hm.onBeforeRender(m,Hm,C0,A),h=tt.get(Hm,E.length),h.init(),E.push(h),He.multiplyMatrices(C0.projectionMatrix,C0.matrixWorldInverse),Y.setFromProjectionMatrix(He),J=this.localClippingEnabled,K=tr.init(this.clippingPlanes,J),_=Z.get(Hm,f.length),_.init(),f.push(_),t0(Hm,C0,0,m.sortObjects),_.finish(),m.sortObjects===!0&&_.sort(k,j),this.info.render.frame++,K===!0&&tr.beginShadows();const z0=h.state.shadowsArray;if(s0.render(z0,Hm,C0),K===!0&&tr.endShadows(),this.info.autoReset===!0&&this.info.reset(),c0.render(_,Hm),h.setupLights(m._useLegacyLights),C0.isArrayCamera){const B0=C0.cameras;for(let V0=0,i1=B0.length;V0<i1;V0++){const u1=B0[V0];i0(_,Hm,u1,u1.viewport)}}else i0(_,Hm,C0);A!==null&&(g0.updateMultisampleRenderTarget(A),g0.updateRenderTargetMipmap(A)),Hm.isScene===!0&&Hm.onAfterRender(m,Hm,C0),v0.resetDefaultState(),M=-1,T=null,E.pop(),E.length>0?h=E[E.length-1]:h=null,f.pop(),f.length>0?_=f[f.length-1]:_=null};function t0(Hm,C0,z0,B0){if(Hm.visible===!1)return;if(Hm.layers.test(C0.layers)){if(Hm.isGroup)z0=Hm.renderOrder;else if(Hm.isLOD)Hm.autoUpdate===!0&&Hm.update(C0);else if(Hm.isLight)h.pushLight(Hm),Hm.castShadow&&h.pushShadow(Hm);else if(Hm.isSprite){if(!Hm.frustumCulled||Y.intersectsSprite(Hm)){B0&&Xe.setFromMatrixPosition(Hm.matrixWorld).applyMatrix4(He);const u1=We.update(Hm),f1=Hm.material;f1.visible&&_.push(Hm,u1,f1,z0,Xe.z,null)}}else if((Hm.isMesh||Hm.isLine||Hm.isPoints)&&(!Hm.frustumCulled||Y.intersectsObject(Hm))){const u1=We.update(Hm),f1=Hm.material;if(B0&&(Hm.boundingSphere!==void 0?(Hm.boundingSphere===null&&Hm.computeBoundingSphere(),Xe.copy(Hm.boundingSphere.center)):(u1.boundingSphere===null&&u1.computeBoundingSphere(),Xe.copy(u1.boundingSphere.center)),Xe.applyMatrix4(Hm.matrixWorld).applyMatrix4(He)),Array.isArray(f1)){const a1=u1.groups;for(let k0=0,r1=a1.length;k0<r1;k0++){const l1=a1[k0],v1=f1[l1.materialIndex];v1&&v1.visible&&_.push(Hm,u1,v1,z0,Xe.z,l1)}}else f1.visible&&_.push(Hm,u1,f1,z0,Xe.z,null)}}const i1=Hm.children;for(let u1=0,f1=i1.length;u1<f1;u1++)t0(i1[u1],C0,z0,B0)}function i0(Hm,C0,z0,B0){const V0=Hm.opaque,i1=Hm.transmissive,u1=Hm.transparent;h.setupLightsView(z0),K===!0&&tr.setGlobalState(m.clippingPlanes,z0),i1.length>0&&d0(V0,i1,C0,z0),B0&&o0.viewport(R.copy(B0)),V0.length>0&&_0(V0,C0,z0),i1.length>0&&_0(i1,C0,z0),u1.length>0&&_0(u1,C0,z0),o0.buffers.depth.setTest(!0),o0.buffers.depth.setMask(!0),o0.buffers.color.setMask(!0),o0.setPolygonOffset(!1)}function d0(Hm,C0,z0,B0){if((z0.isScene===!0?z0.overrideMaterial:null)!==null)return;const i1=u0.isWebGL2;Te===null&&(Te=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:ai.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:i1?4:0})),m.getDrawingBufferSize(Q),i1?Te.setSize(Q.x,Q.y):Te.setSize(floorPowerOfTwo(Q.x),floorPowerOfTwo(Q.y));const u1=m.getRenderTarget();m.setRenderTarget(Te),m.getClearColor(P),I=m.getClearAlpha(),I<1&&m.setClearColor(16777215,.5),m.clear();const f1=m.toneMapping;m.toneMapping=NoToneMapping,_0(Hm,z0,B0),g0.updateMultisampleRenderTarget(Te),g0.updateRenderTargetMipmap(Te);let a1=!1;for(let k0=0,r1=C0.length;k0<r1;k0++){const l1=C0[k0],v1=l1.object,p1=l1.geometry,b1=l1.material,M1=l1.group;if(b1.side===DoubleSide&&v1.layers.test(B0.layers)){const o1=b1.side;b1.side=BackSide,b1.needsUpdate=!0,S0(v1,z0,B0,p1,b1,M1),b1.side=o1,b1.needsUpdate=!0,a1=!0}}a1===!0&&(g0.updateMultisampleRenderTarget(Te),g0.updateRenderTargetMipmap(Te)),m.setRenderTarget(u1),m.setClearColor(P,I),m.toneMapping=f1}function _0(Hm,C0,z0){const B0=C0.isScene===!0?C0.overrideMaterial:null;for(let V0=0,i1=Hm.length;V0<i1;V0++){const u1=Hm[V0],f1=u1.object,a1=u1.geometry,k0=B0===null?u1.material:B0,r1=u1.group;f1.layers.test(z0.layers)&&S0(f1,C0,z0,a1,k0,r1)}}function S0(Hm,C0,z0,B0,V0,i1){Hm.onBeforeRender(m,C0,z0,B0,V0,i1),Hm.modelViewMatrix.multiplyMatrices(z0.matrixWorldInverse,Hm.matrixWorld),Hm.normalMatrix.getNormalMatrix(Hm.modelViewMatrix),V0.onBeforeRender(m,C0,z0,B0,Hm,i1),V0.transparent===!0&&V0.side===DoubleSide&&V0.forceSinglePass===!1?(V0.side=BackSide,V0.needsUpdate=!0,m.renderBufferDirect(z0,C0,B0,V0,Hm,i1),V0.side=FrontSide,V0.needsUpdate=!0,m.renderBufferDirect(z0,C0,B0,V0,Hm,i1),V0.side=DoubleSide):m.renderBufferDirect(z0,C0,B0,V0,Hm,i1),Hm.onAfterRender(m,C0,z0,B0,V0,i1)}function $0(Hm,C0,z0){C0.isScene!==!0&&(C0=ut);const B0=F0.get(Hm),V0=h.state.lights,i1=h.state.shadowsArray,u1=V0.state.version,f1=h0.getParameters(Hm,V0.state,i1,C0,z0),a1=h0.getProgramCacheKey(f1);let k0=B0.programs;B0.environment=Hm.isMeshStandardMaterial?C0.environment:null,B0.fog=C0.fog,B0.envMap=(Hm.isMeshStandardMaterial?L0:w0).get(Hm.envMap||B0.environment),k0===void 0&&(Hm.addEventListener("dispose",W),k0=new Map,B0.programs=k0);let r1=k0.get(a1);if(r1!==void 0){if(B0.currentProgram===r1&&B0.lightsStateVersion===u1)return n1(Hm,f1),r1}else f1.uniforms=h0.getUniforms(Hm),Hm.onBuild(z0,f1,m),Hm.onBeforeCompile(f1,m),r1=h0.acquireProgram(f1,a1),k0.set(a1,r1),B0.uniforms=f1.uniforms;const l1=B0.uniforms;return(!Hm.isShaderMaterial&&!Hm.isRawShaderMaterial||Hm.clipping===!0)&&(l1.clippingPlanes=tr.uniform),n1(Hm,f1),B0.needsLights=Z0(Hm),B0.lightsStateVersion=u1,B0.needsLights&&(l1.ambientLightColor.value=V0.state.ambient,l1.lightProbe.value=V0.state.probe,l1.directionalLights.value=V0.state.directional,l1.directionalLightShadows.value=V0.state.directionalShadow,l1.spotLights.value=V0.state.spot,l1.spotLightShadows.value=V0.state.spotShadow,l1.rectAreaLights.value=V0.state.rectArea,l1.ltc_1.value=V0.state.rectAreaLTC1,l1.ltc_2.value=V0.state.rectAreaLTC2,l1.pointLights.value=V0.state.point,l1.pointLightShadows.value=V0.state.pointShadow,l1.hemisphereLights.value=V0.state.hemi,l1.directionalShadowMap.value=V0.state.directionalShadowMap,l1.directionalShadowMatrix.value=V0.state.directionalShadowMatrix,l1.spotShadowMap.value=V0.state.spotShadowMap,l1.spotLightMatrix.value=V0.state.spotLightMatrix,l1.spotLightMap.value=V0.state.spotLightMap,l1.pointShadowMap.value=V0.state.pointShadowMap,l1.pointShadowMatrix.value=V0.state.pointShadowMatrix),B0.currentProgram=r1,B0.uniformsList=null,r1}function K0(Hm){if(Hm.uniformsList===null){const C0=Hm.currentProgram.getUniforms();Hm.uniformsList=WebGLUniforms.seqWithValue(C0.seq,Hm.uniforms)}return Hm.uniformsList}function n1(Hm,C0){const z0=F0.get(Hm);z0.outputColorSpace=C0.outputColorSpace,z0.instancing=C0.instancing,z0.instancingColor=C0.instancingColor,z0.skinning=C0.skinning,z0.morphTargets=C0.morphTargets,z0.morphNormals=C0.morphNormals,z0.morphColors=C0.morphColors,z0.morphTargetsCount=C0.morphTargetsCount,z0.numClippingPlanes=C0.numClippingPlanes,z0.numIntersection=C0.numClipIntersection,z0.vertexAlphas=C0.vertexAlphas,z0.vertexTangents=C0.vertexTangents,z0.toneMapping=C0.toneMapping}function c1(Hm,C0,z0,B0,V0){C0.isScene!==!0&&(C0=ut),g0.resetTextureUnits();const i1=C0.fog,u1=B0.isMeshStandardMaterial?C0.environment:null,f1=A===null?m.outputColorSpace:A.isXRRenderTarget===!0?A.texture.colorSpace:LinearSRGBColorSpace,a1=(B0.isMeshStandardMaterial?L0:w0).get(B0.envMap||u1),k0=B0.vertexColors===!0&&!!z0.attributes.color&&z0.attributes.color.itemSize===4,r1=!!z0.attributes.tangent&&(!!B0.normalMap||B0.anisotropy>0),l1=!!z0.morphAttributes.position,v1=!!z0.morphAttributes.normal,p1=!!z0.morphAttributes.color;let b1=NoToneMapping;B0.toneMapped&&(A===null||A.isXRRenderTarget===!0)&&(b1=m.toneMapping);const M1=z0.morphAttributes.position||z0.morphAttributes.normal||z0.morphAttributes.color,o1=M1!==void 0?M1.length:0,g1=F0.get(B0),y1=h.state.lights;if(K===!0&&(J===!0||Hm!==T)){const R_=Hm===T&&B0.id===M;tr.setState(B0,Hm,R_)}let C1=!1;B0.version===g1.__version?(g1.needsLights&&g1.lightsStateVersion!==y1.state.version||g1.outputColorSpace!==f1||V0.isInstancedMesh&&g1.instancing===!1||!V0.isInstancedMesh&&g1.instancing===!0||V0.isSkinnedMesh&&g1.skinning===!1||!V0.isSkinnedMesh&&g1.skinning===!0||V0.isInstancedMesh&&g1.instancingColor===!0&&V0.instanceColor===null||V0.isInstancedMesh&&g1.instancingColor===!1&&V0.instanceColor!==null||g1.envMap!==a1||B0.fog===!0&&g1.fog!==i1||g1.numClippingPlanes!==void 0&&(g1.numClippingPlanes!==tr.numPlanes||g1.numIntersection!==tr.numIntersection)||g1.vertexAlphas!==k0||g1.vertexTangents!==r1||g1.morphTargets!==l1||g1.morphNormals!==v1||g1.morphColors!==p1||g1.toneMapping!==b1||u0.isWebGL2===!0&&g1.morphTargetsCount!==o1)&&(C1=!0):(C1=!0,g1.__version=B0.version);let q1=g1.currentProgram;C1===!0&&(q1=$0(B0,C0,V0));let P_=!1,ov=!1,fv=!1;const Z1=q1.getUniforms(),$_=g1.uniforms;if(o0.useProgram(q1.program)&&(P_=!0,ov=!0,fv=!0),B0.id!==M&&(M=B0.id,ov=!0),P_||T!==Hm){Z1.setValue(er,"projectionMatrix",Hm.projectionMatrix),Z1.setValue(er,"viewMatrix",Hm.matrixWorldInverse);const R_=Z1.map.cameraPosition;R_!==void 0&&R_.setValue(er,Xe.setFromMatrixPosition(Hm.matrixWorld)),u0.logarithmicDepthBuffer&&Z1.setValue(er,"logDepthBufFC",2/(Math.log(Hm.far+1)/Math.LN2)),(B0.isMeshPhongMaterial||B0.isMeshToonMaterial||B0.isMeshLambertMaterial||B0.isMeshBasicMaterial||B0.isMeshStandardMaterial||B0.isShaderMaterial)&&Z1.setValue(er,"isOrthographic",Hm.isOrthographicCamera===!0),T!==Hm&&(T=Hm,ov=!0,fv=!0)}if(V0.isSkinnedMesh){Z1.setOptional(er,V0,"bindMatrix"),Z1.setOptional(er,V0,"bindMatrixInverse");const R_=V0.skeleton;R_&&(u0.floatVertexTextures?(R_.boneTexture===null&&R_.computeBoneTexture(),Z1.setValue(er,"boneTexture",R_.boneTexture,g0),Z1.setValue(er,"boneTextureSize",R_.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const z_=z0.morphAttributes;if((z_.position!==void 0||z_.normal!==void 0||z_.color!==void 0&&u0.isWebGL2===!0)&&A0.update(V0,z0,q1),(ov||g1.receiveShadow!==V0.receiveShadow)&&(g1.receiveShadow=V0.receiveShadow,Z1.setValue(er,"receiveShadow",V0.receiveShadow)),B0.isMeshGouraudMaterial&&B0.envMap!==null&&($_.envMap.value=a1,$_.flipEnvMap.value=a1.isCubeTexture&&a1.isRenderTargetTexture===!1?-1:1),ov&&(Z1.setValue(er,"toneMappingExposure",m.toneMappingExposure),g1.needsLights&&J0($_,fv),i1&&B0.fog===!0&&M0.refreshFogUniforms($_,i1),M0.refreshMaterialUniforms($_,B0,F,U,Te),WebGLUniforms.upload(er,K0(g1),$_,g0)),B0.isShaderMaterial&&B0.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(er,K0(g1),$_,g0),B0.uniformsNeedUpdate=!1),B0.isSpriteMaterial&&Z1.setValue(er,"center",V0.center),Z1.setValue(er,"modelViewMatrix",V0.modelViewMatrix),Z1.setValue(er,"normalMatrix",V0.normalMatrix),Z1.setValue(er,"modelMatrix",V0.matrixWorld),B0.isShaderMaterial||B0.isRawShaderMaterial){const R_=B0.uniformsGroups;for(let z1=0,pv=R_.length;z1<pv;z1++)if(u0.isWebGL2){const Z_=R_[z1];D0.update(Z_,q1),D0.bind(Z_,q1)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return q1}function J0(Hm,C0){Hm.ambientLightColor.needsUpdate=C0,Hm.lightProbe.needsUpdate=C0,Hm.directionalLights.needsUpdate=C0,Hm.directionalLightShadows.needsUpdate=C0,Hm.pointLights.needsUpdate=C0,Hm.pointLightShadows.needsUpdate=C0,Hm.spotLights.needsUpdate=C0,Hm.spotLightShadows.needsUpdate=C0,Hm.rectAreaLights.needsUpdate=C0,Hm.hemisphereLights.needsUpdate=C0}function Z0(Hm){return Hm.isMeshLambertMaterial||Hm.isMeshToonMaterial||Hm.isMeshPhongMaterial||Hm.isMeshStandardMaterial||Hm.isShadowMaterial||Hm.isShaderMaterial&&Hm.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return A},this.setRenderTargetTextures=function(Hm,C0,z0){F0.get(Hm.texture).__webglTexture=C0,F0.get(Hm.depthTexture).__webglTexture=z0;const B0=F0.get(Hm);B0.__hasExternalTextures=!0,B0.__hasExternalTextures&&(B0.__autoAllocateDepthBuffer=z0===void 0,B0.__autoAllocateDepthBuffer||ai.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),B0.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Hm,C0){const z0=F0.get(Hm);z0.__webglFramebuffer=C0,z0.__useDefaultFramebuffer=C0===void 0},this.setRenderTarget=function(Hm,C0=0,z0=0){A=Hm,w=C0,v=z0;let B0=!0,V0=null,i1=!1,u1=!1;if(Hm){const a1=F0.get(Hm);a1.__useDefaultFramebuffer!==void 0?(o0.bindFramebuffer(er.FRAMEBUFFER,null),B0=!1):a1.__webglFramebuffer===void 0?g0.setupRenderTarget(Hm):a1.__hasExternalTextures&&g0.rebindTextures(Hm,F0.get(Hm.texture).__webglTexture,F0.get(Hm.depthTexture).__webglTexture);const k0=Hm.texture;(k0.isData3DTexture||k0.isDataArrayTexture||k0.isCompressedArrayTexture)&&(u1=!0);const r1=F0.get(Hm).__webglFramebuffer;Hm.isWebGLCubeRenderTarget?(Array.isArray(r1[C0])?V0=r1[C0][z0]:V0=r1[C0],i1=!0):u0.isWebGL2&&Hm.samples>0&&g0.useMultisampledRTT(Hm)===!1?V0=F0.get(Hm).__webglMultisampledFramebuffer:Array.isArray(r1)?V0=r1[z0]:V0=r1,R.copy(Hm.viewport),O.copy(Hm.scissor),L=Hm.scissorTest}else R.copy(H).multiplyScalar(F).floor(),O.copy(B).multiplyScalar(F).floor(),L=V;if(o0.bindFramebuffer(er.FRAMEBUFFER,V0)&&u0.drawBuffers&&B0&&o0.drawBuffers(Hm,V0),o0.viewport(R),o0.scissor(O),o0.setScissorTest(L),i1){const a1=F0.get(Hm.texture);er.framebufferTexture2D(er.FRAMEBUFFER,er.COLOR_ATTACHMENT0,er.TEXTURE_CUBE_MAP_POSITIVE_X+C0,a1.__webglTexture,z0)}else if(u1){const a1=F0.get(Hm.texture),k0=C0||0;er.framebufferTextureLayer(er.FRAMEBUFFER,er.COLOR_ATTACHMENT0,a1.__webglTexture,z0||0,k0)}M=-1},this.readRenderTargetPixels=function(Hm,C0,z0,B0,V0,i1,u1){if(!(Hm&&Hm.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let f1=F0.get(Hm).__webglFramebuffer;if(Hm.isWebGLCubeRenderTarget&&u1!==void 0&&(f1=f1[u1]),f1){o0.bindFramebuffer(er.FRAMEBUFFER,f1);try{const a1=Hm.texture,k0=a1.format,r1=a1.type;if(k0!==RGBAFormat&&f0.convert(k0)!==er.getParameter(er.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const l1=r1===HalfFloatType&&(ai.has("EXT_color_buffer_half_float")||u0.isWebGL2&&ai.has("EXT_color_buffer_float"));if(r1!==UnsignedByteType&&f0.convert(r1)!==er.getParameter(er.IMPLEMENTATION_COLOR_READ_TYPE)&&!(r1===FloatType&&(u0.isWebGL2||ai.has("OES_texture_float")||ai.has("WEBGL_color_buffer_float")))&&!l1){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}C0>=0&&C0<=Hm.width-B0&&z0>=0&&z0<=Hm.height-V0&&er.readPixels(C0,z0,B0,V0,f0.convert(k0),f0.convert(r1),i1)}finally{const a1=A!==null?F0.get(A).__webglFramebuffer:null;o0.bindFramebuffer(er.FRAMEBUFFER,a1)}}},this.copyFramebufferToTexture=function(Hm,C0,z0=0){const B0=Math.pow(2,-z0),V0=Math.floor(C0.image.width*B0),i1=Math.floor(C0.image.height*B0);g0.setTexture2D(C0,0),er.copyTexSubImage2D(er.TEXTURE_2D,z0,0,0,Hm.x,Hm.y,V0,i1),o0.unbindTexture()},this.copyTextureToTexture=function(Hm,C0,z0,B0=0){const V0=C0.image.width,i1=C0.image.height,u1=f0.convert(z0.format),f1=f0.convert(z0.type);g0.setTexture2D(z0,0),er.pixelStorei(er.UNPACK_FLIP_Y_WEBGL,z0.flipY),er.pixelStorei(er.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z0.premultiplyAlpha),er.pixelStorei(er.UNPACK_ALIGNMENT,z0.unpackAlignment),C0.isDataTexture?er.texSubImage2D(er.TEXTURE_2D,B0,Hm.x,Hm.y,V0,i1,u1,f1,C0.image.data):C0.isCompressedTexture?er.compressedTexSubImage2D(er.TEXTURE_2D,B0,Hm.x,Hm.y,C0.mipmaps[0].width,C0.mipmaps[0].height,u1,C0.mipmaps[0].data):er.texSubImage2D(er.TEXTURE_2D,B0,Hm.x,Hm.y,u1,f1,C0.image),B0===0&&z0.generateMipmaps&&er.generateMipmap(er.TEXTURE_2D),o0.unbindTexture()},this.copyTextureToTexture3D=function(Hm,C0,z0,B0,V0=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const i1=Hm.max.x-Hm.min.x+1,u1=Hm.max.y-Hm.min.y+1,f1=Hm.max.z-Hm.min.z+1,a1=f0.convert(B0.format),k0=f0.convert(B0.type);let r1;if(B0.isData3DTexture)g0.setTexture3D(B0,0),r1=er.TEXTURE_3D;else if(B0.isDataArrayTexture)g0.setTexture2DArray(B0,0),r1=er.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}er.pixelStorei(er.UNPACK_FLIP_Y_WEBGL,B0.flipY),er.pixelStorei(er.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B0.premultiplyAlpha),er.pixelStorei(er.UNPACK_ALIGNMENT,B0.unpackAlignment);const l1=er.getParameter(er.UNPACK_ROW_LENGTH),v1=er.getParameter(er.UNPACK_IMAGE_HEIGHT),p1=er.getParameter(er.UNPACK_SKIP_PIXELS),b1=er.getParameter(er.UNPACK_SKIP_ROWS),M1=er.getParameter(er.UNPACK_SKIP_IMAGES),o1=z0.isCompressedTexture?z0.mipmaps[0]:z0.image;er.pixelStorei(er.UNPACK_ROW_LENGTH,o1.width),er.pixelStorei(er.UNPACK_IMAGE_HEIGHT,o1.height),er.pixelStorei(er.UNPACK_SKIP_PIXELS,Hm.min.x),er.pixelStorei(er.UNPACK_SKIP_ROWS,Hm.min.y),er.pixelStorei(er.UNPACK_SKIP_IMAGES,Hm.min.z),z0.isDataTexture||z0.isData3DTexture?er.texSubImage3D(r1,V0,C0.x,C0.y,C0.z,i1,u1,f1,a1,k0,o1.data):z0.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),er.compressedTexSubImage3D(r1,V0,C0.x,C0.y,C0.z,i1,u1,f1,a1,o1.data)):er.texSubImage3D(r1,V0,C0.x,C0.y,C0.z,i1,u1,f1,a1,k0,o1),er.pixelStorei(er.UNPACK_ROW_LENGTH,l1),er.pixelStorei(er.UNPACK_IMAGE_HEIGHT,v1),er.pixelStorei(er.UNPACK_SKIP_PIXELS,p1),er.pixelStorei(er.UNPACK_SKIP_ROWS,b1),er.pixelStorei(er.UNPACK_SKIP_IMAGES,M1),V0===0&&B0.generateMipmaps&&er.generateMipmap(r1),o0.unbindTexture()},this.initTexture=function(Hm){Hm.isCubeTexture?g0.setTextureCube(Hm,0):Hm.isData3DTexture?g0.setTexture3D(Hm,0):Hm.isDataArrayTexture||Hm.isCompressedArrayTexture?g0.setTexture2DArray(Hm,0):g0.setTexture2D(Hm,0),o0.unbindTexture()},this.resetState=function(){w=0,v=0,A=null,o0.reset(),v0.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===DisplayP3ColorSpace?"display-p3":"srgb",t.unpackColorSpace=ColorManagement.workingColorSpace===LinearDisplayP3ColorSpace?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class Fog{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Color(e),this.near=t,this.far=n}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class DataTexture extends Texture{constructor(e=null,t=1,n=1,i,s,o,a,l,d=NearestFilter,u=NearestFilter,g,x){super(null,o,a,l,d,u,i,s,g,x),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class LineBasicMaterial extends Material{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(e=new BufferGeometry,t=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,s=t.count;i<s;i++)_start$1.fromBufferAttribute(t,i-1),_end$1.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere$1.copy(n.boundingSphere),_sphere$1.applyMatrix4(i),_sphere$1.radius+=s,e.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(i).invert(),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,d=new Vector3,u=new Vector3,g=new Vector3,x=new Vector3,y=this.isLineSegments?2:1,b=n.index,h=n.attributes.position;if(b!==null){const f=Math.max(0,o.start),E=Math.min(b.count,o.start+o.count);for(let m=f,S=E-1;m<S;m+=y){const w=b.getX(m),v=b.getX(m+1);if(d.fromBufferAttribute(h,w),u.fromBufferAttribute(h,v),_ray$1.distanceSqToSegment(d,u,x,g)>l)continue;x.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(x);M<e.near||M>e.far||t.push({distance:M,point:g.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else{const f=Math.max(0,o.start),E=Math.min(h.count,o.start+o.count);for(let m=f,S=E-1;m<S;m+=y){if(d.fromBufferAttribute(h,m),u.fromBufferAttribute(h,m+1),_ray$1.distanceSqToSegment(d,u,x,g)>l)continue;x.applyMatrix4(this.matrixWorld);const v=e.ray.origin.distanceTo(x);v<e.near||v>e.far||t.push({distance:v,point:g.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,s=t.count;i<s;i+=2)_start.fromBufferAttribute(t,i),_end.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class PointsMaterial extends Material{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(e=new BufferGeometry,t=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere.copy(n.boundingSphere),_sphere.applyMatrix4(i),_sphere.radius+=s,e.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(i).invert(),_ray.copy(e.ray).applyMatrix4(_inverseMatrix);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,d=n.index,g=n.attributes.position;if(d!==null){const x=Math.max(0,o.start),y=Math.min(d.count,o.start+o.count);for(let b=x,_=y;b<_;b++){const h=d.getX(b);_position$2.fromBufferAttribute(g,h),testPoint(_position$2,h,l,i,e,t,this)}}else{const x=Math.max(0,o.start),y=Math.min(g.count,o.start+o.count);for(let b=x,_=y;b<_;b++)_position$2.fromBufferAttribute(g,b),testPoint(_position$2,b,l,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function testPoint(r,e,t,n,i,s,o){const a=_ray.distanceSqToPoint(r);if(a<t){const l=new Vector3;_ray.closestPointToPoint(r,l),l.applyMatrix4(n);const d=i.ray.origin.distanceTo(l);if(d<i.near||d>i.far)return;s.push({distance:d,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class CanvasTexture extends Texture{constructor(e,t,n,i,s,o,a,l,d){super(e,t,n,i,s,o,a,l,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class CylinderGeometry extends BufferGeometry{constructor(e=1,t=1,n=1,i=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const d=this;i=Math.floor(i),s=Math.floor(s);const u=[],g=[],x=[],y=[];let b=0;const _=[],h=n/2;let f=0;E(),o===!1&&(e>0&&m(!0),t>0&&m(!1)),this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(g,3)),this.setAttribute("normal",new Float32BufferAttribute(x,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2));function E(){const S=new Vector3,w=new Vector3;let v=0;const A=(t-e)/n;for(let M=0;M<=s;M++){const T=[],R=M/s,O=R*(t-e)+e;for(let L=0;L<=i;L++){const P=L/i,I=P*l+a,N=Math.sin(I),U=Math.cos(I);w.x=O*N,w.y=-R*n+h,w.z=O*U,g.push(w.x,w.y,w.z),S.set(N,A,U).normalize(),x.push(S.x,S.y,S.z),y.push(P,1-R),T.push(b++)}_.push(T)}for(let M=0;M<i;M++)for(let T=0;T<s;T++){const R=_[T][M],O=_[T+1][M],L=_[T+1][M+1],P=_[T][M+1];u.push(R,O,P),u.push(O,L,P),v+=6}d.addGroup(f,v,0),f+=v}function m(S){const w=b,v=new Vector2,A=new Vector3;let M=0;const T=S===!0?e:t,R=S===!0?1:-1;for(let L=1;L<=i;L++)g.push(0,h*R,0),x.push(0,R,0),y.push(.5,.5),b++;const O=b;for(let L=0;L<=i;L++){const I=L/i*l+a,N=Math.cos(I),U=Math.sin(I);A.x=T*U,A.y=h*R,A.z=T*N,g.push(A.x,A.y,A.z),x.push(0,R,0),v.x=N*.5+.5,v.y=U*.5*R+.5,y.push(v.x,v.y),b++}for(let L=0;L<i;L++){const P=w+L,I=O+L;S===!0?u.push(I,I+1,P):u.push(I+1,I,P),M+=3}d.addGroup(f,M,S===!0?1:2),f+=M}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(e=1,t=1,n=32,i=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,i,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],o=[];a(i),d(n),u(),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(s.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(E){const m=new Vector3,S=new Vector3,w=new Vector3;for(let v=0;v<t.length;v+=3)y(t[v+0],m),y(t[v+1],S),y(t[v+2],w),l(m,S,w,E)}function l(E,m,S,w){const v=w+1,A=[];for(let M=0;M<=v;M++){A[M]=[];const T=E.clone().lerp(S,M/v),R=m.clone().lerp(S,M/v),O=v-M;for(let L=0;L<=O;L++)L===0&&M===v?A[M][L]=T:A[M][L]=T.clone().lerp(R,L/O)}for(let M=0;M<v;M++)for(let T=0;T<2*(v-M)-1;T++){const R=Math.floor(T/2);T%2===0?(x(A[M][R+1]),x(A[M+1][R]),x(A[M][R])):(x(A[M][R+1]),x(A[M+1][R+1]),x(A[M+1][R]))}}function d(E){const m=new Vector3;for(let S=0;S<s.length;S+=3)m.x=s[S+0],m.y=s[S+1],m.z=s[S+2],m.normalize().multiplyScalar(E),s[S+0]=m.x,s[S+1]=m.y,s[S+2]=m.z}function u(){const E=new Vector3;for(let m=0;m<s.length;m+=3){E.x=s[m+0],E.y=s[m+1],E.z=s[m+2];const S=h(E)/2/Math.PI+.5,w=f(E)/Math.PI+.5;o.push(S,1-w)}b(),g()}function g(){for(let E=0;E<o.length;E+=6){const m=o[E+0],S=o[E+2],w=o[E+4],v=Math.max(m,S,w),A=Math.min(m,S,w);v>.9&&A<.1&&(m<.2&&(o[E+0]+=1),S<.2&&(o[E+2]+=1),w<.2&&(o[E+4]+=1))}}function x(E){s.push(E.x,E.y,E.z)}function y(E,m){const S=E*3;m.x=e[S+0],m.y=e[S+1],m.z=e[S+2]}function b(){const E=new Vector3,m=new Vector3,S=new Vector3,w=new Vector3,v=new Vector2,A=new Vector2,M=new Vector2;for(let T=0,R=0;T<s.length;T+=9,R+=6){E.set(s[T+0],s[T+1],s[T+2]),m.set(s[T+3],s[T+4],s[T+5]),S.set(s[T+6],s[T+7],s[T+8]),v.set(o[R+0],o[R+1]),A.set(o[R+2],o[R+3]),M.set(o[R+4],o[R+5]),w.copy(E).add(m).add(S).divideScalar(3);const O=h(w);_(v,R+0,E,O),_(A,R+2,m,O),_(M,R+4,S,O)}}function _(E,m,S,w){w<0&&E.x===1&&(o[m]=E.x-1),S.x===0&&S.z===0&&(o[m]=w/2/Math.PI+.5)}function h(E){return Math.atan2(E.z,-E.x)}function f(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PolyhedronGeometry(e.vertices,e.indices,e.radius,e.details)}}class IcosahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new IcosahedronGeometry(e.radius,e.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new OctahedronGeometry(e.radius,e.detail)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new TetrahedronGeometry(e.radius,e.detail)}}class TorusGeometry extends BufferGeometry{constructor(e=1,t=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],l=[],d=[],u=new Vector3,g=new Vector3,x=new Vector3;for(let y=0;y<=n;y++)for(let b=0;b<=i;b++){const _=b/i*s,h=y/n*Math.PI*2;g.x=(e+t*Math.cos(h))*Math.cos(_),g.y=(e+t*Math.cos(h))*Math.sin(_),g.z=t*Math.sin(h),a.push(g.x,g.y,g.z),u.x=e*Math.cos(_),u.y=e*Math.sin(_),x.subVectors(g,u).normalize(),l.push(x.x,x.y,x.z),d.push(b/i),d.push(y/n)}for(let y=1;y<=n;y++)for(let b=1;b<=i;b++){const _=(i+1)*y+b-1,h=(i+1)*(y-1)+b-1,f=(i+1)*(y-1)+b,E=(i+1)*y+b;o.push(_,h,E),o.push(h,f,E)}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Light extends Object3D{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(e.matrixWorld),t.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(_lookTarget$1),t.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(_projScreenMatrix$1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class AmbientLight extends Light{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,_projectionMatrix.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,o=t.near*Math.tan(DEG2RAD*t.fov*.5)/t.zoom;let a,l;_eyeLeft.elements[12]=-i,_eyeRight.elements[12]=i,a=-o*t.aspect+s,l=o*t.aspect+s,_projectionMatrix.elements[0]=2*t.near/(l-a),_projectionMatrix.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(_projectionMatrix),a=-o*t.aspect-s,l=o*t.aspect-s,_projectionMatrix.elements[0]=2*t.near/(l-a),_projectionMatrix.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}}class Uniform{constructor(e){this.value=e}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);var chroma$1={exports:{}},chroma=chroma$1.exports,hasRequiredChroma;function requireChroma(){return hasRequiredChroma||(hasRequiredChroma=1,(function(r,e){(function(){var t,n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R,O,L,P,I,N,U,F,k,j,H,B,V,Y,K,J,Te,He,Q,Xe,ut,Ji,er,ec,ai,u0,o0,E0,F0,g0,w0,L0,T0,ht,We,h0,M0,Z,tt,tr,s0,c0,A0,P0,Fe,f0,v0,D0,l0,y0,lt,oi,b0,W,e0,a0,hi,p0,O0=[].slice;W=(function(){var q,it,at,t0,i0;for(q={},i0="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),t0=0,it=i0.length;t0<it;t0++)at=i0[t0],q["[object "+at+"]"]=at.toLowerCase();return function(d0){var _0;return _0=Object.prototype.toString.call(d0),q[_0]||"object"}})(),er=function(q,it,at){return it==null&&(it=0),at==null&&(at=1),q<it&&(q=it),q>at&&(q=at),q},e0=function(q){return q.length>=3?Array.prototype.slice.call(q):q[0]},v=function(q){var it,at;for(q._clipped=!1,q._unclipped=q.slice(0),it=at=0;at<3;it=++at)it<3?((q[it]<0||q[it]>255)&&(q._clipped=!0),q[it]<0&&(q[it]=0),q[it]>255&&(q[it]=255)):it===3&&(q[it]<0&&(q[it]=0),q[it]>1&&(q[it]=1));return q._clipped||delete q._unclipped,q},s=Math.PI,l0=Math.round,M=Math.cos,P=Math.floor,L0=Math.pow,ec=Math.log,lt=Math.sin,oi=Math.sqrt,_=Math.atan2,o0=Math.max,b=Math.abs,l=s*2,o=s/3,n=s/180,a=180/s,w=function(){return arguments[0]instanceof t?arguments[0]:(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,arguments,function(){})},w.default=w,y=[],r!==null&&r.exports!=null&&(r.exports=w),D0=e!==null?e:this,D0.chroma=w,w.version="1.4.1",x={},u=[],g=!1,t=(function(){function q(){var it,at,t0,i0,d0,_0,S0,$0,K0;for(_0=this,at=[],$0=0,i0=arguments.length;$0<i0;$0++)it=arguments[$0],it!=null&&at.push(it);if(at.length>1&&(S0=at[at.length-1]),x[S0]!=null)_0._rgb=v(x[S0](e0(at.slice(0,-1))));else{for(g||(u=u.sort(function(n1,c1){return c1.p-n1.p}),g=!0),K0=0,d0=u.length;K0<d0&&(t0=u[K0],S0=t0.test.apply(t0,at),!S0);K0++);S0&&(_0._rgb=v(x[S0].apply(x,at)))}_0._rgb==null&&console.warn("unknown format: "+at),_0._rgb==null&&(_0._rgb=[0,0,0]),_0._rgb.length===3&&_0._rgb.push(1)}return q.prototype.toString=function(){return this.hex()},q})(),w._input=x;w.brewer=m={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},(function(){var q,it;it=[];for(q in m)it.push(m[q.toLowerCase()]=m[q]);return it})(),a0={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},w.colors=a0,He=function(){var q,it,at,t0,i0,d0,_0,S0,$0;return it=e0(arguments),i0=it[0],q=it[1],at=it[2],S0=(i0+16)/116,_0=isNaN(q)?S0:S0+q/500,$0=isNaN(at)?S0:S0-at/200,S0=i.Yn*Q(S0),_0=i.Xn*Q(_0),$0=i.Zn*Q($0),d0=p0(3.2404542*_0-1.5371385*S0-.4985314*$0),t0=p0(-.969266*_0+1.8760108*S0+.041556*$0),at=p0(.0556434*_0-.2040259*S0+1.0572252*$0),[d0,t0,at,it.length>3?it[3]:1]},p0=function(q){return 255*(q<=.00304?12.92*q:1.055*L0(q,1/2.4)-.055)},Q=function(q){return q>i.t1?q*q*q:i.t2*(q-i.t0)},i={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},tr=function(){var q,it,at,t0,i0,d0,_0,S0;return t0=e0(arguments),at=t0[0],it=t0[1],q=t0[2],i0=Fe(at,it,q),d0=i0[0],_0=i0[1],S0=i0[2],[116*_0-16,500*(d0-_0),200*(_0-S0)]},f0=function(q){return(q/=255)<=.04045?q/12.92:L0((q+.055)/1.055,2.4)},hi=function(q){return q>i.t3?L0(q,1/3):q/i.t2+i.t0},Fe=function(){var q,it,at,t0,i0,d0,_0;return t0=e0(arguments),at=t0[0],it=t0[1],q=t0[2],at=f0(at),it=f0(it),q=f0(q),i0=hi((.4124564*at+.3575761*it+.1804375*q)/i.Xn),d0=hi((.2126729*at+.7151522*it+.072175*q)/i.Yn),_0=hi((.0193339*at+.119192*it+.9503041*q)/i.Zn),[i0,d0,_0]},w.lab=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["lab"]),function(){})},x.lab=He,t.prototype.lab=function(){return tr(this._rgb)},h=function(q){var it,at,t0,i0,d0,_0,S0,$0,K0,n1,c1;return q=(function(){var J0,Z0,Hm;for(Hm=[],Z0=0,J0=q.length;Z0<J0;Z0++)i0=q[Z0],Hm.push(w(i0));return Hm})(),q.length===2?(K0=(function(){var J0,Z0,Hm;for(Hm=[],Z0=0,J0=q.length;Z0<J0;Z0++)i0=q[Z0],Hm.push(i0.lab());return Hm})(),d0=K0[0],_0=K0[1],it=function(J0){var Z0,Hm;return Hm=(function(){var C0,z0;for(z0=[],Z0=C0=0;C0<=2;Z0=++C0)z0.push(d0[Z0]+J0*(_0[Z0]-d0[Z0]));return z0})(),w.lab.apply(w,Hm)}):q.length===3?(n1=(function(){var J0,Z0,Hm;for(Hm=[],Z0=0,J0=q.length;Z0<J0;Z0++)i0=q[Z0],Hm.push(i0.lab());return Hm})(),d0=n1[0],_0=n1[1],S0=n1[2],it=function(J0){var Z0,Hm;return Hm=(function(){var C0,z0;for(z0=[],Z0=C0=0;C0<=2;Z0=++C0)z0.push((1-J0)*(1-J0)*d0[Z0]+2*(1-J0)*J0*_0[Z0]+J0*J0*S0[Z0]);return z0})(),w.lab.apply(w,Hm)}):q.length===4?(c1=(function(){var J0,Z0,Hm;for(Hm=[],Z0=0,J0=q.length;Z0<J0;Z0++)i0=q[Z0],Hm.push(i0.lab());return Hm})(),d0=c1[0],_0=c1[1],S0=c1[2],$0=c1[3],it=function(J0){var Z0,Hm;return Hm=(function(){var C0,z0;for(z0=[],Z0=C0=0;C0<=2;Z0=++C0)z0.push((1-J0)*(1-J0)*(1-J0)*d0[Z0]+3*(1-J0)*(1-J0)*J0*_0[Z0]+3*(1-J0)*J0*J0*S0[Z0]+J0*J0*J0*$0[Z0]);return z0})(),w.lab.apply(w,Hm)}):q.length===5&&(at=h(q.slice(0,3)),t0=h(q.slice(2,5)),it=function(J0){return J0<.5?at(J0*2):t0((J0-.5)*2)}),it},w.bezier=function(q){var it;return it=h(q),it.scale=function(){return w.scale(it)},it},w.cubehelix=function(q,it,at,t0,i0){var d0,_0,S0;return q==null&&(q=300),it==null&&(it=-1.5),at==null&&(at=1),t0==null&&(t0=1),i0==null&&(i0=[0,1]),d0=0,W(i0)==="array"?_0=i0[1]-i0[0]:(_0=0,i0=[i0,i0]),S0=function($0){var K0,n1,c1,J0,Z0,Hm,C0,z0,B0;return K0=l*((q+120)/360+it*$0),C0=L0(i0[0]+_0*$0,t0),Hm=d0!==0?at[0]+$0*d0:at,n1=Hm*C0*(1-C0)/2,J0=M(K0),B0=lt(K0),z0=C0+n1*(-.14861*J0+1.78277*B0),Z0=C0+n1*(-.29227*J0-.90649*B0),c1=C0+n1*(1.97294*J0),w(v([z0*255,Z0*255,c1*255,1]))},S0.start=function($0){return $0==null?q:(q=$0,S0)},S0.rotations=function($0){return $0==null?it:(it=$0,S0)},S0.gamma=function($0){return $0==null?t0:(t0=$0,S0)},S0.hue=function($0){return $0==null?at:(at=$0,W(at)==="array"?(d0=at[1]-at[0],d0===0&&(at=at[1])):d0=0,S0)},S0.lightness=function($0){return $0==null?i0:(W($0)==="array"?(i0=$0,_0=$0[1]-$0[0]):(i0=[$0,$0],_0=0),S0)},S0.scale=function(){return w.scale(S0)},S0.hue(at),S0},w.random=function(){var q,it,at;for(it="0123456789abcdef",q="#",at=0;at<6;++at)q+=it.charAt(P(Math.random()*16));return new t(q)},y=[],H=function(q,it,at,t0){var i0,d0,_0,S0;for(at==null&&(at=.5),t0==null&&(t0="rgb"),W(q)!=="object"&&(q=w(q)),W(it)!=="object"&&(it=w(it)),_0=0,d0=y.length;_0<d0;_0++)if(i0=y[_0],t0===i0[0]){S0=i0[1](q,it,at,t0);break}if(S0==null)throw"color mode "+t0+" is not supported";return S0.alpha(q.alpha()+at*(it.alpha()-q.alpha()))},w.interpolate=H,t.prototype.interpolate=function(q,it,at){return H(this,q,it,at)},w.mix=H,t.prototype.mix=t.prototype.interpolate,x.rgb=function(){var q,it,at,t0;it=e0(arguments),at=[];for(q in it)t0=it[q],at.push(t0);return at},w.rgb=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(q){return q==null&&(q=!0),q?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(q){return q==null&&(q=!0),q?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(q){var it;if(it=e0(arguments),W(it)==="array"&&it.length===3||it.length===4&&W(it[3])==="number"&&it[3]>=0&&it[3]<=1)return"rgb"}}),x.lrgb=x.rgb,Y=function(q,it,at,t0){var i0,d0;return i0=q._rgb,d0=it._rgb,new t(oi(L0(i0[0],2)*(1-at)+L0(d0[0],2)*at),oi(L0(i0[1],2)*(1-at)+L0(d0[1],2)*at),oi(L0(i0[2],2)*(1-at)+L0(d0[2],2)*at),t0)},d=function(q){var it,at,t0,i0,d0,_0;for(at=1/q.length,_0=[0,0,0,0],i0=0,t0=q.length;i0<t0;i0++)it=q[i0],d0=it._rgb,_0[0]+=L0(d0[0],2)*at,_0[1]+=L0(d0[1],2)*at,_0[2]+=L0(d0[2],2)*at,_0[3]+=d0[3]*at;return _0[0]=oi(_0[0]),_0[1]=oi(_0[1]),_0[2]=oi(_0[2]),_0[3]>1&&(_0[3]=1),new t(v(_0))},y.push(["lrgb",Y]),w.average=function(q,it){var at,t0,i0,d0,_0,S0,$0,K0,n1,c1,J0,Z0,Hm;if(it==null&&(it="rgb"),n1=q.length,q=q.map(function(C0){return w(C0)}),$0=q.splice(0,1)[0],it==="lrgb")return d(q);Z0=$0.get(it),d0=[],_0=0,S0=0;for(K0 in Z0)Z0[K0]=Z0[K0]||0,d0.push(isNaN(Z0[K0])?0:1),it.charAt(K0)==="h"&&!isNaN(Z0[K0])&&(at=Z0[K0]/180*s,_0+=M(at),S0+=lt(at));for(t0=$0.alpha(),J0=0,c1=q.length;J0<c1;J0++){i0=q[J0],Hm=i0.get(it),t0+=i0.alpha();for(K0 in Z0)isNaN(Hm[K0])||(d0[K0]+=1,it.charAt(K0)==="h"?(at=Hm[K0]/180*s,_0+=M(at),S0+=lt(at)):Z0[K0]+=Hm[K0])}for(K0 in Z0)if(it.charAt(K0)==="h"){for(at=_(S0/d0[K0],_0/d0[K0])/s*180;at<0;)at+=360;for(;at>=360;)at-=360;Z0[K0]=at}else Z0[K0]=Z0[K0]/d0[K0];return w(Z0,it).alpha(t0/n1)},N=function(q){var it,at,t0,i0,d0,_0;if(q.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(q.length===4||q.length===7)&&(q=q.substr(1)),q.length===3&&(q=q.split(""),q=q[0]+q[0]+q[1]+q[1]+q[2]+q[2]),_0=parseInt(q,16),i0=_0>>16,t0=_0>>8&255,at=_0&255,[i0,t0,at,1];if(q.match(/^#?([A-Fa-f0-9]{8})$/))return q.length===9&&(q=q.substr(1)),_0=parseInt(q,16),i0=_0>>24&255,t0=_0>>16&255,at=_0>>8&255,it=l0((_0&255)/255*100)/100,[i0,t0,at,it];if(x.css!=null&&(d0=x.css(q)))return d0;throw"unknown color: "+q},h0=function(q,it){var at,t0,i0,d0,_0,S0,$0;return it==null&&(it="auto"),_0=q[0],i0=q[1],t0=q[2],at=q[3],it==="auto"&&(it=at<1?"rgba":"rgb"),_0=Math.round(_0),i0=Math.round(i0),t0=Math.round(t0),$0=_0<<16|i0<<8|t0,S0="000000"+$0.toString(16),S0=S0.substr(S0.length-6),d0="0"+l0(at*255).toString(16),d0=d0.substr(d0.length-2),"#"+(function(){switch(it.toLowerCase()){case"rgba":return S0+d0;case"argb":return d0+S0;default:return S0}})()},x.hex=function(q){return N(q)},w.hex=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(q){return q==null&&(q="auto"),h0(this._rgb,q)},u.push({p:4,test:function(q){if(arguments.length===1&&W(q)==="string")return"hex"}}),k=function(){var q,it,at,t0,i0,d0,_0,S0,$0,K0,n1,c1,J0,Z0;if(q=e0(arguments),i0=q[0],n1=q[1],_0=q[2],n1===0)$0=t0=it=_0*255;else{for(Z0=[0,0,0],at=[0,0,0],J0=_0<.5?_0*(1+n1):_0+n1-_0*n1,c1=2*_0-J0,i0/=360,Z0[0]=i0+1/3,Z0[1]=i0,Z0[2]=i0-1/3,d0=S0=0;S0<=2;d0=++S0)Z0[d0]<0&&(Z0[d0]+=1),Z0[d0]>1&&(Z0[d0]-=1),6*Z0[d0]<1?at[d0]=c1+(J0-c1)*6*Z0[d0]:2*Z0[d0]<1?at[d0]=J0:3*Z0[d0]<2?at[d0]=c1+(J0-c1)*(2/3-Z0[d0])*6:at[d0]=c1;K0=[l0(at[0]*255),l0(at[1]*255),l0(at[2]*255)],$0=K0[0],t0=K0[1],it=K0[2]}return q.length>3?[$0,t0,it,q[3]]:[$0,t0,it]},Z=function(q,it,at){var t0,i0,d0,_0,S0;return q!==void 0&&q.length>=3&&(_0=q,q=_0[0],it=_0[1],at=_0[2]),q/=255,it/=255,at/=255,d0=Math.min(q,it,at),o0=Math.max(q,it,at),i0=(o0+d0)/2,o0===d0?(S0=0,t0=Number.NaN):S0=i0<.5?(o0-d0)/(o0+d0):(o0-d0)/(2-o0-d0),q===o0?t0=(it-at)/(o0-d0):it===o0?t0=2+(at-q)/(o0-d0):at===o0&&(t0=4+(q-it)/(o0-d0)),t0*=60,t0<0&&(t0+=360),[t0,S0,i0]},w.hsl=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["hsl"]),function(){})},x.hsl=k,t.prototype.hsl=function(){return Z(this._rgb)},j=function(){var q,it,at,t0,i0,d0,_0,S0,$0,K0,n1,c1,J0,Z0,Hm,C0,z0,B0;if(q=e0(arguments),i0=q[0],C0=q[1],B0=q[2],B0*=255,C0===0)$0=t0=it=B0;else switch(i0===360&&(i0=0),i0>360&&(i0-=360),i0<0&&(i0+=360),i0/=60,d0=P(i0),at=i0-d0,_0=B0*(1-C0),S0=B0*(1-C0*at),z0=B0*(1-C0*(1-at)),d0){case 0:K0=[B0,z0,_0],$0=K0[0],t0=K0[1],it=K0[2];break;case 1:n1=[S0,B0,_0],$0=n1[0],t0=n1[1],it=n1[2];break;case 2:c1=[_0,B0,z0],$0=c1[0],t0=c1[1],it=c1[2];break;case 3:J0=[_0,S0,B0],$0=J0[0],t0=J0[1],it=J0[2];break;case 4:Z0=[z0,_0,B0],$0=Z0[0],t0=Z0[1],it=Z0[2];break;case 5:Hm=[B0,_0,S0],$0=Hm[0],t0=Hm[1],it=Hm[2]}return[$0,t0,it,q.length>3?q[3]:1]},tt=function(){var q,it,at,t0,i0,d0,_0,S0,$0;return _0=e0(arguments),d0=_0[0],at=_0[1],q=_0[2],i0=Math.min(d0,at,q),o0=Math.max(d0,at,q),it=o0-i0,$0=o0/255,o0===0?(t0=Number.NaN,S0=0):(S0=it/o0,d0===o0&&(t0=(at-q)/it),at===o0&&(t0=2+(q-d0)/it),q===o0&&(t0=4+(d0-at)/it),t0*=60,t0<0&&(t0+=360)),[t0,S0,$0]},w.hsv=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["hsv"]),function(){})},x.hsv=j,t.prototype.hsv=function(){return tt(this._rgb)},g0=function(q){var it,at,t0;return W(q)==="number"&&q>=0&&q<=16777215?(t0=q>>16,at=q>>8&255,it=q&255,[t0,at,it,1]):(console.warn("unknown num color: "+q),[0,0,0,1])},A0=function(){var q,it,at,t0;return t0=e0(arguments),at=t0[0],it=t0[1],q=t0[2],(at<<16)+(it<<8)+q},w.num=function(q){return new t(q,"num")},t.prototype.num=function(q){return q==null&&(q="rgb"),A0(this._rgb,q)},x.num=g0,u.push({p:1,test:function(q){if(arguments.length===1&&W(q)==="number"&&q>=0&&q<=16777215)return"num"}}),I=function(){var q,it,at,t0,i0,d0,_0,S0,$0,K0,n1,c1,J0,Z0,Hm,C0,z0,B0,V0,i1;if(at=e0(arguments),S0=at[0],i0=at[1],it=at[2],i0=i0/100,_0=_0/100*255,q=i0*255,i0===0)c1=_0=t0=it;else switch(S0===360&&(S0=0),S0>360&&(S0-=360),S0<0&&(S0+=360),S0/=60,$0=P(S0),d0=S0-$0,K0=it*(1-i0),n1=K0+q*(1-d0),V0=K0+q*d0,i1=K0+q,$0){case 0:J0=[i1,V0,K0],c1=J0[0],_0=J0[1],t0=J0[2];break;case 1:Z0=[n1,i1,K0],c1=Z0[0],_0=Z0[1],t0=Z0[2];break;case 2:Hm=[K0,i1,V0],c1=Hm[0],_0=Hm[1],t0=Hm[2];break;case 3:C0=[K0,n1,i1],c1=C0[0],_0=C0[1],t0=C0[2];break;case 4:z0=[V0,K0,i1],c1=z0[0],_0=z0[1],t0=z0[2];break;case 5:B0=[i1,K0,n1],c1=B0[0],_0=B0[1],t0=B0[2]}return[c1,_0,t0,at.length>3?at[3]:1]},We=function(){var q,it,at,t0,i0,d0,_0,S0,$0;return $0=e0(arguments),S0=$0[0],i0=$0[1],it=$0[2],_0=Math.min(S0,i0,it),o0=Math.max(S0,i0,it),t0=o0-_0,at=t0*100/255,q=_0/(255-t0)*100,t0===0?d0=Number.NaN:(S0===o0&&(d0=(i0-it)/t0),i0===o0&&(d0=2+(it-S0)/t0),it===o0&&(d0=4+(S0-i0)/t0),d0*=60,d0<0&&(d0+=360)),[d0,at,q]},w.hcg=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["hcg"]),function(){})},x.hcg=I,t.prototype.hcg=function(){return We(this._rgb)},T=function(q){var it,at,t0,i0,d0,_0,S0,$0;if(q=q.toLowerCase(),w.colors!=null&&w.colors[q])return N(w.colors[q]);if(d0=q.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(S0=d0.slice(1,4),i0=_0=0;_0<=2;i0=++_0)S0[i0]=+S0[i0];S0[3]=1}else if(d0=q.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(S0=d0.slice(1,5),i0=$0=0;$0<=3;i0=++$0)S0[i0]=+S0[i0];else if(d0=q.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(S0=d0.slice(1,4),i0=it=0;it<=2;i0=++it)S0[i0]=l0(S0[i0]*2.55);S0[3]=1}else if(d0=q.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(S0=d0.slice(1,5),i0=at=0;at<=2;i0=++at)S0[i0]=l0(S0[i0]*2.55);S0[3]=+S0[3]}else(d0=q.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(t0=d0.slice(1,4),t0[1]*=.01,t0[2]*=.01,S0=k(t0),S0[3]=1):(d0=q.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(t0=d0.slice(1,4),t0[1]*=.01,t0[2]*=.01,S0=k(t0),S0[3]=+d0[4]);return S0},ht=function(q){var it;if(it=q[3]<1?"rgba":"rgb",it==="rgb")return it+"("+q.slice(0,3).map(l0).join(",")+")";if(it==="rgba")return it+"("+q.slice(0,3).map(l0).join(",")+","+q[3]+")"},v0=function(q){return l0(q*100)/100},F=function(q,it){var at;return at=it<1?"hsla":"hsl",q[0]=v0(q[0]||0),q[1]=v0(q[1]*100)+"%",q[2]=v0(q[2]*100)+"%",at==="hsla"&&(q[3]=it),at+"("+q.join(",")+")"},x.css=function(q){return T(q)},w.css=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(q){if(q==null&&(q="rgb"),q.slice(0,3)==="rgb")return ht(this._rgb);if(q.slice(0,3)==="hsl")return F(this.hsl(),this.alpha())},x.named=function(q){return N(a0[q])},u.push({p:5,test:function(q){if(arguments.length===1&&a0[q]!=null)return"named"}}),t.prototype.name=function(q){var it,at;arguments.length&&(a0[q]&&(this._rgb=N(a0[q])),this._rgb[3]=1),it=this.hex("rgb");for(at in a0)if(it===a0[at])return at;return it},Xe=function(){var q,it,at,t0;return t0=e0(arguments),at=t0[0],q=t0[1],it=t0[2],it=it*n,[at,M(it)*q,lt(it)*q]},ut=function(){var q,it,at,t0,i0,d0,_0,S0,$0,K0,n1;return at=e0(arguments),S0=at[0],i0=at[1],_0=at[2],K0=Xe(S0,i0,_0),q=K0[0],it=K0[1],t0=K0[2],n1=He(q,it,t0),$0=n1[0],d0=n1[1],t0=n1[2],[$0,d0,t0,at.length>3?at[3]:1]},Te=function(){var q,it,at,t0,i0,d0;return d0=e0(arguments),i0=d0[0],q=d0[1],it=d0[2],at=oi(q*q+it*it),t0=(_(it,q)*a+360)%360,l0(at*1e4)===0&&(t0=Number.NaN),[i0,at,t0]},s0=function(){var q,it,at,t0,i0,d0,_0;return d0=e0(arguments),i0=d0[0],at=d0[1],it=d0[2],_0=tr(i0,at,it),t0=_0[0],q=_0[1],it=_0[2],Te(t0,q,it)},w.lch=function(){var q;return q=e0(arguments),new t(q,"lch")},w.hcl=function(){var q;return q=e0(arguments),new t(q,"hcl")},x.lch=ut,x.hcl=function(){var q,it,at,t0;return t0=e0(arguments),it=t0[0],q=t0[1],at=t0[2],ut([at,q,it])},t.prototype.lch=function(){return s0(this._rgb)},t.prototype.hcl=function(){return s0(this._rgb).reverse()},T0=function(q){var it,at,t0,i0,d0,_0,S0,$0,K0;return q==null&&(q="rgb"),$0=e0(arguments),S0=$0[0],i0=$0[1],it=$0[2],S0=S0/255,i0=i0/255,it=it/255,d0=1-Math.max(S0,Math.max(i0,it)),t0=d0<1?1/(1-d0):0,at=(1-S0-d0)*t0,_0=(1-i0-d0)*t0,K0=(1-it-d0)*t0,[at,_0,K0,d0]},A=function(){var q,it,at,t0,i0,d0,_0,S0,$0;return it=e0(arguments),t0=it[0],_0=it[1],$0=it[2],d0=it[3],q=it.length>4?it[4]:1,d0===1?[0,0,0,q]:(S0=t0>=1?0:255*(1-t0)*(1-d0),i0=_0>=1?0:255*(1-_0)*(1-d0),at=$0>=1?0:255*(1-$0)*(1-d0),[S0,i0,at,q])},x.cmyk=function(){return A(e0(arguments))},w.cmyk=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return T0(this._rgb)},x.gl=function(){var q,it,at,t0,i0;for(t0=(function(){var d0,_0;d0=e0(arguments),_0=[];for(it in d0)i0=d0[it],_0.push(i0);return _0}).apply(this,arguments),q=at=0;at<=2;q=++at)t0[q]*=255;return t0},w.gl=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var q;return q=this._rgb,[q[0]/255,q[1]/255,q[2]/255,q[3]]},c0=function(q,it,at){var t0;return t0=e0(arguments),q=t0[0],it=t0[1],at=t0[2],q=ai(q),it=ai(it),at=ai(at),.2126*q+.7152*it+.0722*at},ai=function(q){return q/=255,q<=.03928?q/12.92:L0((q+.055)/1.055,2.4)},J=function(q,it,at,t0){var i0,d0;return i0=q._rgb,d0=it._rgb,new t(i0[0]+at*(d0[0]-i0[0]),i0[1]+at*(d0[1]-i0[1]),i0[2]+at*(d0[2]-i0[2]),t0)},y.push(["rgb",J]),t.prototype.luminance=function(q,it){var at,t0,i0,d0,_0;return it==null&&(it="rgb"),arguments.length?(d0=this._rgb,q===0?d0=[0,0,0,this._rgb[3]]:q===1?d0=[255,255,255,this[3]]:(at=c0(this._rgb),t0=1e-7,i0=20,_0=function(S0,$0){var K0,n1;return n1=S0.interpolate($0,.5,it),K0=n1.luminance(),Math.abs(q-K0)<t0||!i0--?n1:K0>q?_0(S0,n1):_0(n1,$0)},at>q?d0=_0(w("black"),this).rgba():d0=_0(this,w("white")).rgba()),w(d0).alpha(this.alpha())):c0(this._rgb)},b0=function(q){var it,at,t0,i0;return i0=q/100,i0<66?(t0=255,at=-155.25485562709179-.44596950469579133*(at=i0-2)+104.49216199393888*ec(at),it=i0<20?0:-254.76935184120902+.8274096064007395*(it=i0-10)+115.67994401066147*ec(it)):(t0=351.97690566805693+.114206453784165*(t0=i0-55)-40.25366309332127*ec(t0),at=325.4494125711974+.07943456536662342*(at=i0-50)-28.0852963507957*ec(at),it=255),[t0,at,it]},P0=function(){var q,it,at,t0,i0,d0,_0,S0;for(d0=e0(arguments),i0=d0[0],d0[1],q=d0[2],t0=1e3,at=4e4,it=.4;at-t0>it;)S0=(at+t0)*.5,_0=b0(S0),_0[2]/_0[0]>=q/i0?at=S0:t0=S0;return l0(S0)},w.temperature=w.kelvin=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["temperature"]),function(){})},x.temperature=x.kelvin=x.K=b0,t.prototype.temperature=function(){return P0(this._rgb)},t.prototype.kelvin=t.prototype.temperature,w.contrast=function(q,it){var at,t0,i0,d0;return((i0=W(q))==="string"||i0==="number")&&(q=new t(q)),((d0=W(it))==="string"||d0==="number")&&(it=new t(it)),at=q.luminance(),t0=it.luminance(),at>t0?(at+.05)/(t0+.05):(t0+.05)/(at+.05)},w.distance=function(q,it,at){var t0,i0,d0,_0,S0,$0,K0;at==null&&(at="lab"),((S0=W(q))==="string"||S0==="number")&&(q=new t(q)),(($0=W(it))==="string"||$0==="number")&&(it=new t(it)),d0=q.get(at),_0=it.get(at),K0=0;for(i0 in d0)t0=(d0[i0]||0)-(_0[i0]||0),K0+=t0*t0;return Math.sqrt(K0)},w.deltaE=function(q,it,at,t0){var i0,d0,_0,S0,$0,K0,n1,c1,J0,Z0,Hm,C0,z0,B0,V0,i1,u1,f1,a1,k0,r1,l1,v1,p1,b1,M1,o1;for(at==null&&(at=1),t0==null&&(t0=1),((u1=W(q))==="string"||u1==="number")&&(q=new t(q)),((f1=W(it))==="string"||f1==="number")&&(it=new t(it)),a1=q.lab(),i0=a1[0],_0=a1[1],$0=a1[2],k0=it.lab(),d0=k0[0],S0=k0[1],K0=k0[2],n1=oi(_0*_0+$0*$0),c1=oi(S0*S0+K0*K0),v1=i0<16?.511:.040975*i0/(1+.01765*i0),r1=.0638*n1/(1+.0131*n1)+.638,i1=n1<1e-6?0:_($0,_0)*180/s;i1<0;)i1+=360;for(;i1>=360;)i1-=360;return p1=i1>=164&&i1<=345?.56+b(.2*M(s*(i1+168)/180)):.36+b(.4*M(s*(i1+35)/180)),J0=n1*n1*n1*n1,V0=oi(J0/(J0+1900)),l1=r1*(V0*p1+1-V0),B0=i0-d0,z0=n1-c1,Hm=_0-S0,C0=$0-K0,Z0=Hm*Hm+C0*C0-z0*z0,b1=B0/(at*v1),M1=z0/(t0*r1),o1=l1,oi(b1*b1+M1*M1+Z0/(o1*o1))},t.prototype.get=function(q){var it,at,t0,i0,d0,_0;return t0=this,d0=q.split("."),i0=d0[0],it=d0[1],_0=t0[i0](),it?(at=i0.indexOf(it),at>-1?_0[at]:console.warn("unknown channel "+it+" in mode "+i0)):_0},t.prototype.set=function(q,it){var at,t0,i0,d0,_0,S0;if(i0=this,_0=q.split("."),d0=_0[0],at=_0[1],at)if(S0=i0[d0](),t0=d0.indexOf(at),t0>-1)if(W(it)==="string")switch(it.charAt(0)){case"+":S0[t0]+=+it;break;case"-":S0[t0]+=+it;break;case"*":S0[t0]*=+it.substr(1);break;case"/":S0[t0]/=+it.substr(1);break;default:S0[t0]=+it}else S0[t0]=it;else console.warn("unknown channel "+at+" in mode "+d0);else S0=it;return w(S0,d0).alpha(i0.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(q){return arguments.length?w.rgb([this._rgb[0],this._rgb[1],this._rgb[2],q]):this._rgb[3]},t.prototype.darken=function(q){var it,at;return q==null&&(q=1),at=this,it=at.lab(),it[0]-=i.Kn*q,w.lab(it).alpha(at.alpha())},t.prototype.brighten=function(q){return q==null&&(q=1),this.darken(-q)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(q){var it,at;return q==null&&(q=1),at=this,it=at.lch(),it[1]+=q*i.Kn,it[1]<0&&(it[1]=0),w.lch(it).alpha(at.alpha())},t.prototype.desaturate=function(q){return q==null&&(q=1),this.saturate(-q)},t.prototype.premultiply=function(){var q,it;return it=this.rgb(),q=this.alpha(),w(it[0]*q,it[1]*q,it[2]*q,q)},f=function(q,it,at){if(!f[at])throw"unknown blend mode "+at;return f[at](q,it)},E=function(q){return function(it,at){var t0,i0;return t0=w(at).rgb(),i0=w(it).rgb(),w(q(t0,i0),"rgb")}},L=function(q){return function(it,at){var t0,i0,d0;for(d0=[],t0=i0=0;i0<=3;t0=++i0)d0[t0]=q(it[t0],at[t0]);return d0}},F0=function(q,it){return q},E0=function(q,it){return q*it/255},R=function(q,it){return q>it?it:q},Ji=function(q,it){return q>it?q:it},y0=function(q,it){return 255*(1-(1-q/255)*(1-it/255))},w0=function(q,it){return it<128?2*q*it/255:255*(1-2*(1-q/255)*(1-it/255))},S=function(q,it){return 255*(1-(1-it/255)/(q/255))},O=function(q,it){return q===255||(q=255*(it/255)/(1-q/255),q>255)?255:q},f.normal=E(L(F0)),f.multiply=E(L(E0)),f.screen=E(L(y0)),f.overlay=E(L(w0)),f.darken=E(L(R)),f.lighten=E(L(Ji)),f.dodge=E(L(O)),f.burn=E(L(S)),w.blend=f,w.analyze=function(q){var it,at,t0,i0;for(t0={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},at=0,it=q.length;at<it;at++)i0=q[at],i0!=null&&!isNaN(i0)&&(t0.values.push(i0),t0.sum+=i0,i0<t0.min&&(t0.min=i0),i0>t0.max&&(t0.max=i0),t0.count+=1);return t0.domain=[t0.min,t0.max],t0.limits=function(d0,_0){return w.limits(t0,d0,_0)},t0},w.scale=function(q,it){var at,t0,i0,d0,_0,S0,$0,K0,n1,c1,J0,Z0,Hm,C0,z0,B0,V0,i1,u1,f1,a1;return n1="rgb",c1=w("#ccc"),C0=0,_0=[0,1],Hm=[],Z0=[0,0],at=!1,i0=[],J0=!1,K0=0,$0=1,d0=!1,t0={},z0=!0,S0=1,f1=function(k0){var r1,l1,v1,p1,b1,M1;if(k0==null&&(k0=["#fff","#000"]),k0!=null&&W(k0)==="string"&&w.brewer!=null&&(k0=w.brewer[k0]||w.brewer[k0.toLowerCase()]||k0),W(k0)==="array"){for(k0.length===1&&(k0=[k0[0],k0[0]]),k0=k0.slice(0),r1=v1=0,p1=k0.length-1;0<=p1?v1<=p1:v1>=p1;r1=0<=p1?++v1:--v1)l1=k0[r1],W(l1)==="string"&&(k0[r1]=w(l1));for(Hm.length=0,r1=M1=0,b1=k0.length-1;0<=b1?M1<=b1:M1>=b1;r1=0<=b1?++M1:--M1)Hm.push(r1/(k0.length-1))}return u1(),i0=k0},V0=function(k0){var r1,l1;if(at!=null){for(l1=at.length-1,r1=0;r1<l1&&k0>=at[r1];)r1++;return r1-1}return 0},a1=function(k0){return k0},i1=function(k0,r1){var l1,v1,p1,b1,M1,o1,g1,y1;if(r1==null&&(r1=!1),isNaN(k0)||k0===null)return c1;if(r1?y1=k0:at&&at.length>2?(l1=V0(k0),y1=l1/(at.length-2)):$0!==K0?y1=(k0-K0)/($0-K0):y1=1,r1||(y1=a1(y1)),S0!==1&&(y1=L0(y1,S0)),y1=Z0[0]+y1*(1-Z0[0]-Z0[1]),y1=Math.min(1,Math.max(0,y1)),b1=Math.floor(y1*1e4),z0&&t0[b1])v1=t0[b1];else{if(W(i0)==="array")for(p1=M1=0,g1=Hm.length-1;0<=g1?M1<=g1:M1>=g1;p1=0<=g1?++M1:--M1){if(o1=Hm[p1],y1<=o1){v1=i0[p1];break}if(y1>=o1&&p1===Hm.length-1){v1=i0[p1];break}if(y1>o1&&y1<Hm[p1+1]){y1=(y1-o1)/(Hm[p1+1]-o1),v1=w.interpolate(i0[p1],i0[p1+1],y1,n1);break}}else W(i0)==="function"&&(v1=i0(y1));z0&&(t0[b1]=v1)}return v1},u1=function(){return t0={}},f1(q),B0=function(k0){var r1;return r1=w(i1(k0)),J0&&r1[J0]?r1[J0]():r1},B0.classes=function(k0){var r1;return k0!=null?(W(k0)==="array"?(at=k0,_0=[k0[0],k0[k0.length-1]]):(r1=w.analyze(_0),k0===0?at=[r1.min,r1.max]:at=w.limits(r1,"e",k0)),B0):at},B0.domain=function(k0){var r1,l1,v1,p1,b1,M1,o1;if(!arguments.length)return _0;if(K0=k0[0],$0=k0[k0.length-1],Hm=[],v1=i0.length,k0.length===v1&&K0!==$0)for(b1=0,p1=k0.length;b1<p1;b1++)l1=k0[b1],Hm.push((l1-K0)/($0-K0));else for(r1=o1=0,M1=v1-1;0<=M1?o1<=M1:o1>=M1;r1=0<=M1?++o1:--o1)Hm.push(r1/(v1-1));return _0=[K0,$0],B0},B0.mode=function(k0){return arguments.length?(n1=k0,u1(),B0):n1},B0.range=function(k0,r1){return f1(k0,r1),B0},B0.out=function(k0){return J0=k0,B0},B0.spread=function(k0){return arguments.length?(C0=k0,B0):C0},B0.correctLightness=function(k0){return k0==null&&(k0=!0),d0=k0,u1(),d0?a1=function(r1){var l1,v1,p1,b1,M1,o1,g1,y1,C1;for(l1=i1(0,!0).lab()[0],v1=i1(1,!0).lab()[0],g1=l1>v1,p1=i1(r1,!0).lab()[0],M1=l1+(v1-l1)*r1,b1=p1-M1,y1=0,C1=1,o1=20;Math.abs(b1)>.01&&o1-- >0;)(function(){return g1&&(b1*=-1),b1<0?(y1=r1,r1+=(C1-r1)*.5):(C1=r1,r1+=(y1-r1)*.5),p1=i1(r1,!0).lab()[0],b1=p1-M1})();return r1}:a1=function(r1){return r1},B0},B0.padding=function(k0){return k0!=null?(W(k0)==="number"&&(k0=[k0,k0]),Z0=k0,B0):Z0},B0.colors=function(k0,r1){var l1,v1,p1,b1,M1,o1,g1,y1;if(arguments.length<2&&(r1="hex"),M1=[],arguments.length===0)M1=i0.slice(0);else if(k0===1)M1=[B0(.5)];else if(k0>1)v1=_0[0],l1=_0[1]-v1,M1=(function(){o1=[];for(var C1=0;0<=k0?C1<k0:C1>k0;0<=k0?C1++:C1--)o1.push(C1);return o1}).apply(this).map(function(C1){return B0(v1+C1/(k0-1)*l1)});else{if(q=[],g1=[],at&&at.length>2)for(p1=y1=1,b1=at.length;1<=b1?y1<b1:y1>b1;p1=1<=b1?++y1:--y1)g1.push((at[p1-1]+at[p1])*.5);else g1=_0;M1=g1.map(function(C1){return B0(C1)})}return w[r1]&&(M1=M1.map(function(C1){return C1[r1]()})),M1},B0.cache=function(k0){return k0!=null?(z0=k0,B0):z0},B0.gamma=function(k0){return k0!=null?(S0=k0,B0):S0},B0.nodata=function(k0){return k0!=null?(c1=w(k0),B0):c1},B0},w.scales==null&&(w.scales={}),w.scales.cool=function(){return w.scale([w.hsl(180,1,.9),w.hsl(250,.7,.4)])},w.scales.hot=function(){return w.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},w.analyze=function(q,it,at){var t0,i0,d0,_0,S0,$0,K0;if(S0={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},at==null&&(at=function(){return!0}),t0=function(n1){n1!=null&&!isNaN(n1)&&(S0.values.push(n1),S0.sum+=n1,n1<S0.min&&(S0.min=n1),n1>S0.max&&(S0.max=n1),S0.count+=1)},K0=function(n1,c1){if(at(n1,c1))return it!=null&&W(it)==="function"?t0(it(n1)):it!=null&&W(it)==="string"||W(it)==="number"?t0(n1[it]):t0(n1)},W(q)==="array")for(_0=0,d0=q.length;_0<d0;_0++)$0=q[_0],K0($0);else for(i0 in q)$0=q[i0],K0($0,i0);return S0.domain=[S0.min,S0.max],S0.limits=function(n1,c1){return w.limits(S0,n1,c1)},S0},w.limits=function(q,it,at){var t0,i0,d0,_0,S0,$0,K0,n1,c1,J0,Z0,Hm,C0,z0,B0,V0,i1,u1,f1,a1,k0,r1,l1,v1,p1,b1,M1,o1,g1,y1,C1,q1,P_,ov,fv,Z1,$_,z_,R_,z1,pv,Z_,lv,yv,cv,Wv,V_,dx,fx,rv,O_,X_,G1,H_,Q_;if(it==null&&(it="equal"),at==null&&(at=7),W(q)==="array"&&(q=w.analyze(q)),p1=q.min,o0=q.max,q.sum,H_=q.values.sort(function(tx,bv){return tx-bv}),at===1)return[p1,o0];if(l1=[],it.substr(0,1)==="c"&&(l1.push(p1),l1.push(o0)),it.substr(0,1)==="e"){for(l1.push(p1),a1=C1=1,fv=at-1;1<=fv?C1<=fv:C1>=fv;a1=1<=fv?++C1:--C1)l1.push(p1+a1/at*(o0-p1));l1.push(o0)}else if(it.substr(0,1)==="l"){if(p1<=0)throw"Logarithmic scales are only possible for values > 0";for(b1=Math.LOG10E*ec(p1),v1=Math.LOG10E*ec(o0),l1.push(p1),a1=Q_=1,Z1=at-1;1<=Z1?Q_<=Z1:Q_>=Z1;a1=1<=Z1?++Q_:--Q_)l1.push(L0(10,b1+a1/at*(v1-b1)));l1.push(o0)}else if(it.substr(0,1)==="q"){for(l1.push(p1),a1=t0=1,Z_=at-1;1<=Z_?t0<=Z_:t0>=Z_;a1=1<=Z_?++t0:--t0)q1=(H_.length-1)*a1/at,P_=P(q1),P_===q1?l1.push(H_[P_]):(ov=q1-P_,l1.push(H_[P_]*(1-ov)+H_[P_+1]*ov));l1.push(o0)}else if(it.substr(0,1)==="k"){for(o1=H_.length,z0=new Array(o1),u1=new Array(at),rv=!0,g1=0,V0=null,V0=[],V0.push(p1),a1=i0=1,lv=at-1;1<=lv?i0<=lv:i0>=lv;a1=1<=lv?++i0:--i0)V0.push(p1+a1/at*(o0-p1));for(V0.push(o0);rv;){for(k0=d0=0,yv=at-1;0<=yv?d0<=yv:d0>=yv;k0=0<=yv?++d0:--d0)u1[k0]=0;for(a1=_0=0,cv=o1-1;0<=cv?_0<=cv:_0>=cv;a1=0<=cv?++_0:--_0){for(G1=H_[a1],M1=Number.MAX_VALUE,k0=S0=0,Wv=at-1;0<=Wv?S0<=Wv:S0>=Wv;k0=0<=Wv?++S0:--S0)f1=b(V0[k0]-G1),f1<M1&&(M1=f1,B0=k0);u1[B0]++,z0[a1]=B0}for(y1=new Array(at),k0=$0=0,V_=at-1;0<=V_?$0<=V_:$0>=V_;k0=0<=V_?++$0:--$0)y1[k0]=null;for(a1=K0=0,dx=o1-1;0<=dx?K0<=dx:K0>=dx;a1=0<=dx?++K0:--K0)i1=z0[a1],y1[i1]===null?y1[i1]=H_[a1]:y1[i1]+=H_[a1];for(k0=n1=0,fx=at-1;0<=fx?n1<=fx:n1>=fx;k0=0<=fx?++n1:--n1)y1[k0]*=1/u1[k0];for(rv=!1,k0=c1=0,$_=at-1;0<=$_?c1<=$_:c1>=$_;k0=0<=$_?++c1:--c1)if(y1[k0]!==V0[a1]){rv=!0;break}V0=y1,g1++,g1>200&&(rv=!1)}for(r1={},k0=J0=0,z_=at-1;0<=z_?J0<=z_:J0>=z_;k0=0<=z_?++J0:--J0)r1[k0]=[];for(a1=Z0=0,R_=o1-1;0<=R_?Z0<=R_:Z0>=R_;a1=0<=R_?++Z0:--Z0)i1=z0[a1],r1[i1].push(H_[a1]);for(O_=[],k0=Hm=0,z1=at-1;0<=z1?Hm<=z1:Hm>=z1;k0=0<=z1?++Hm:--Hm)O_.push(r1[k0][0]),O_.push(r1[k0][r1[k0].length-1]);for(O_=O_.sort(function(tx,bv){return tx-bv}),l1.push(O_[0]),a1=C0=1,pv=O_.length-1;C0<=pv;a1=C0+=2)X_=O_[a1],!isNaN(X_)&&l1.indexOf(X_)===-1&&l1.push(X_)}return l1},U=function(q,it,at){var t0,i0,d0,_0;return t0=e0(arguments),q=t0[0],it=t0[1],at=t0[2],isNaN(q)&&(q=0),q/=360,q<1/3?(i0=(1-it)/3,_0=(1+it*M(l*q)/M(o-l*q))/3,d0=1-(i0+_0)):q<2/3?(q-=1/3,_0=(1-it)/3,d0=(1+it*M(l*q)/M(o-l*q))/3,i0=1-(_0+d0)):(q-=2/3,d0=(1-it)/3,i0=(1+it*M(l*q)/M(o-l*q))/3,_0=1-(d0+i0)),_0=er(at*_0*3),d0=er(at*d0*3),i0=er(at*i0*3),[_0*255,d0*255,i0*255,t0.length>3?t0[3]:1]},M0=function(){var q,it,at,t0,i0,d0,_0,S0;return _0=e0(arguments),d0=_0[0],it=_0[1],q=_0[2],l=Math.PI*2,d0/=255,it/=255,q/=255,i0=Math.min(d0,it,q),t0=(d0+it+q)/3,S0=1-i0/t0,S0===0?at=0:(at=(d0-it+(d0-q))/2,at/=Math.sqrt((d0-it)*(d0-it)+(d0-q)*(it-q)),at=Math.acos(at),q>it&&(at=l-at),at/=l),[at*360,S0,t0]},w.hsi=function(){return(function(q,it,at){at.prototype=q.prototype;var t0=new at,i0=q.apply(t0,it);return Object(i0)===i0?i0:t0})(t,O0.call(arguments).concat(["hsi"]),function(){})},x.hsi=U,t.prototype.hsi=function(){return M0(this._rgb)},B=function(q,it,at,t0){var i0,d0,_0,S0,$0,K0,n1,c1,J0,Z0,Hm,C0;return t0==="hsl"?(Hm=q.hsl(),C0=it.hsl()):t0==="hsv"?(Hm=q.hsv(),C0=it.hsv()):t0==="hcg"?(Hm=q.hcg(),C0=it.hcg()):t0==="hsi"?(Hm=q.hsi(),C0=it.hsi()):(t0==="lch"||t0==="hcl")&&(t0="hcl",Hm=q.hcl(),C0=it.hcl()),t0.substr(0,1)==="h"&&(_0=Hm[0],J0=Hm[1],K0=Hm[2],S0=C0[0],Z0=C0[1],n1=C0[2]),!isNaN(_0)&&!isNaN(S0)?(S0>_0&&S0-_0>180?i0=S0-(_0+360):S0<_0&&_0-S0>180?i0=S0+360-_0:i0=S0-_0,d0=_0+at*i0):isNaN(_0)?isNaN(S0)?d0=Number.NaN:(d0=S0,(K0===1||K0===0)&&t0!=="hsv"&&(c1=Z0)):(d0=_0,(n1===1||n1===0)&&t0!=="hsv"&&(c1=J0)),c1==null&&(c1=J0+at*(Z0-J0)),$0=K0+at*(n1-K0),w[t0](d0,c1,$0)},y=y.concat((function(){var q,it,at,t0;for(at=["hsv","hsl","hsi","hcl","lch","hcg"],t0=[],it=0,q=at.length;it<q;it++)u0=at[it],t0.push([u0,B]);return t0})()),K=function(q,it,at,t0){var i0,d0;return i0=q.num(),d0=it.num(),w.num(i0+(d0-i0)*at,"num")},y.push(["num",K]),V=function(q,it,at,t0){var i0,d0;return i0=q.lab(),d0=it.lab(),new t(i0[0]+at*(d0[0]-i0[0]),i0[1]+at*(d0[1]-i0[1]),i0[2]+at*(d0[2]-i0[2]),t0)},y.push(["lab",V])}).call(chroma)})(chroma$1,chroma$1.exports)),chroma$1.exports}var chromaExports=requireChroma(),signals$1={exports:{}},signals=signals$1.exports,hasRequiredSignals;function requireSignals(){return hasRequiredSignals||(hasRequiredSignals=1,(function(r){(function(e){function t(o,a,l,d,u){this._listener=a,this._isOnce=l,this.context=d,this._signal=o,this._priority=u||0}t.prototype={active:!0,params:null,execute:function(o){var a,l;return this.active&&this._listener&&(l=this.params?this.params.concat(o):o,a=this._listener.apply(this.context,l),this._isOnce&&this.detach()),a},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function n(o,a){if(typeof o!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",a))}function i(){this._bindings=[],this._prevParams=null;var o=this;this.dispatch=function(){i.prototype.dispatch.apply(o,arguments)}}i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(o,a,l,d){var u=this._indexOfListener(o,l),g;if(u!==-1){if(g=this._bindings[u],g.isOnce()!==a)throw new Error("You cannot add"+(a?"":"Once")+"() then add"+(a?"Once":"")+"() the same listener without removing the relationship first.")}else g=new t(this,o,a,l,d),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(o){var a=this._bindings.length;do--a;while(this._bindings[a]&&o._priority<=this._bindings[a]._priority);this._bindings.splice(a+1,0,o)},_indexOfListener:function(o,a){for(var l=this._bindings.length,d;l--;)if(d=this._bindings[l],d._listener===o&&d.context===a)return l;return-1},has:function(o,a){return this._indexOfListener(o,a)!==-1},add:function(o,a,l){return n(o,"add"),this._registerListener(o,!1,a,l)},addOnce:function(o,a,l){return n(o,"addOnce"),this._registerListener(o,!0,a,l)},remove:function(o,a){n(o,"remove");var l=this._indexOfListener(o,a);return l!==-1&&(this._bindings[l]._destroy(),this._bindings.splice(l,1)),o},removeAll:function(){for(var o=this._bindings.length;o--;)this._bindings[o]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(o){if(this.active){var a=Array.prototype.slice.call(arguments),l=this._bindings.length,d;if(this.memorize&&(this._prevParams=a),!!l){d=this._bindings.slice(),this._shouldPropagate=!0;do l--;while(d[l]&&this._shouldPropagate&&d[l].execute(a)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var s=i;s.Signal=i,r.exports?r.exports=s:e.signals=s})(signals)})(signals$1)),signals$1.exports}var signalsExports=requireSignals(),sprintf={},hasRequiredSprintf;function requireSprintf(){return hasRequiredSprintf||(hasRequiredSprintf=1,(function(r){(function(){var e={not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function t(a){return i(o(a),arguments)}function n(a,l){return t.apply(null,[a].concat(l||[]))}function i(a,l){var d=1,u=a.length,g,x="",y,b,_,h,f,E,m,S;for(y=0;y<u;y++)if(typeof a[y]=="string")x+=a[y];else if(typeof a[y]=="object"){if(_=a[y],_.keys)for(g=l[d],b=0;b<_.keys.length;b++){if(g==null)throw new Error(t('[sprintf] Cannot access property "%s" of undefined value "%s"',_.keys[b],_.keys[b-1]));g=g[_.keys[b]]}else _.param_no?g=l[_.param_no]:g=l[d++];if(e.not_type.test(_.type)&&e.not_primitive.test(_.type)&&g instanceof Function&&(g=g()),e.numeric_arg.test(_.type)&&typeof g!="number"&&isNaN(g))throw new TypeError(t("[sprintf] expecting number but found %T",g));switch(e.number.test(_.type)&&(m=g>=0),_.type){case"b":g=parseInt(g,10).toString(2);break;case"c":g=String.fromCharCode(parseInt(g,10));break;case"d":case"i":g=parseInt(g,10);break;case"j":g=JSON.stringify(g,null,_.width?parseInt(_.width):0);break;case"e":g=_.precision?parseFloat(g).toExponential(_.precision):parseFloat(g).toExponential();break;case"f":g=_.precision?parseFloat(g).toFixed(_.precision):parseFloat(g);break;case"g":g=_.precision?String(Number(g.toPrecision(_.precision))):parseFloat(g);break;case"o":g=(parseInt(g,10)>>>0).toString(8);break;case"s":g=String(g),g=_.precision?g.substring(0,_.precision):g;break;case"t":g=String(!!g),g=_.precision?g.substring(0,_.precision):g;break;case"T":g=Object.prototype.toString.call(g).slice(8,-1).toLowerCase(),g=_.precision?g.substring(0,_.precision):g;break;case"u":g=parseInt(g,10)>>>0;break;case"v":g=g.valueOf(),g=_.precision?g.substring(0,_.precision):g;break;case"x":g=(parseInt(g,10)>>>0).toString(16);break;case"X":g=(parseInt(g,10)>>>0).toString(16).toUpperCase();break}e.json.test(_.type)?x+=g:(e.number.test(_.type)&&(!m||_.sign)?(S=m?"+":"-",g=g.toString().replace(e.sign,"")):S="",f=_.pad_char?_.pad_char==="0"?"0":_.pad_char.charAt(1):" ",E=_.width-(S+g).length,h=_.width&&E>0?f.repeat(E):"",x+=_.align?S+g+h:f==="0"?S+h+g:h+S+g)}return x}var s=Object.create(null);function o(a){if(s[a])return s[a];for(var l=a,d,u=[],g=0;l;){if((d=e.text.exec(l))!==null)u.push(d[0]);else if((d=e.modulo.exec(l))!==null)u.push("%");else if((d=e.placeholder.exec(l))!==null){if(d[2]){g|=1;var x=[],y=d[2],b=[];if((b=e.key.exec(y))!==null)for(x.push(b[1]);(y=y.substring(b[0].length))!=="";)if((b=e.key_access.exec(y))!==null)x.push(b[1]);else if((b=e.index_access.exec(y))!==null)x.push(b[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");d[2]=x}else g|=2;if(g===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:d[0],param_no:d[1],keys:d[2],sign:d[3],pad_char:d[4],align:d[5],width:d[6],precision:d[7],type:d[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");l=l.substring(d[0].length)}return s[a]=u}r.sprintf=t,r.vsprintf=n,typeof window<"u"&&(window.sprintf=t,window.vsprintf=n)})()})(sprintf)),sprintf}var sprintfExports=requireSprintf(),define_process_env_default={};function rt(r){if(typeof window>"u")return;const e=new RegExp(`${r}=([^&#=]*)`).exec(window.location.search);return e?decodeURIComponent(e[1]):void 0}function nt(r,e){return r!==void 0?r:e}function st(r,e){const t=Object.assign({},r);for(const n in e)r[n]===void 0&&(t[n]=e[n]);return t}function ot(r,e){for(const t in e){const n=e[t];n!==void 0&&(r[t]=n)}return r}function ct(){if(typeof window>"u")return!1;const r=window.navigator.userAgent;return/Opera|OPR/.test(r)?"Opera":/Chrome/i.test(r)?"Chrome":/Firefox/i.test(r)?"Firefox":/Mobile(\/.*)? Safari/i.test(r)?"Mobile Safari":/MSIE/i.test(r)?"Internet Explorer":!!/Safari/i.test(r)&&"Safari"}function dt(r,e){return r<e?-1:r>e?1:0}function mt(r,e,t=dt){let n=0,i=r.length-1;for(;n<=i;){const s=n+i>>1,o=t(e,r[s]);if(o>0)n=s+1;else{if(!(o<0))return s;i=s-1}}return-n-1}function ft(r,e,t){const n=(function(s,o){let a=s.length-1;if(s[a]<o)return-1;let l=0;for(;l<=a;){const d=l+a>>1;s[d]>=o?a=d-1:l=d+1}return a+1})(r,e),i=(function(s,o){if(s[0]>o)return-1;let a=0,l=s.length-1;for(;a<=l;){const d=a+l>>1;s[d]>o?l=d-1:a=d+1}return a-1})(r,t);return n===-1||i===-1||n>i?0:i-n+1}function pt(r){return r.sort().filter((function(e,t,n){return t===0||e!==n[t-1]}))}function gt(r){if(r.length>28672){const t=[];for(let n=0;n<r.length;n+=28672)t.push(String.fromCharCode.apply(null,r.subarray(n,n+28672)));return t.join("")}return String.fromCharCode.apply(null,r)}function yt(r,e){switch(r){case"int8":return new Int8Array(e);case"int16":return new Int16Array(e);case"int32":return new Int32Array(e);case"uint8":return new Uint8Array(e);case"uint16":return new Uint16Array(e);case"uint32":return new Uint32Array(e);case"float32":return new Float32Array(e);default:throw new Error("arrayType unknown: "+r)}}function bt(r,e){return new(e>65535?Uint32Array:Uint16Array)(r)}function _t(r){return r.buffer&&r.buffer instanceof ArrayBuffer?r.buffer:r}function xt(r,e){return r===void 0?r=new e:Array.isArray(r)&&(r=new e().fromArray(r)),r}function vt(r){return xt(r,Vector3)}function wt(r){return xt(r,Matrix4)}function At(r){return xt(r,Quaternion)}function St(r){return e=r,t=Float32Array,e instanceof t?e:new t(e);var e,t}function Ct(r){return nt(r,"").toString().toLowerCase()}class Pt{constructor(e){this.name=e,this._dict={}}add(e,t){this._dict[Ct(e)]=t}get(e){return this._dict[Ct(e)]}get names(){return Object.keys(this._dict)}}function It(r){return .01745*r}const kt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Mt=new Array(36);function Tt(){let r,e=0;for(let t=0;t<36;t++)t===8||t===13||t===18||t===23?Mt[t]="-":t===14?Mt[t]="4":(e<=2&&(e=33554432+16777216*Math.random()|0),r=15&e,e>>=4,Mt[t]=kt[t===19?3&r|8:r]);return Mt.join("")}function Dt(r,e,t){return Math.max(e,Math.min(t,r))}function Bt(r,e,t){return r+(e-r)*t}function Ft(r,e,t,n,i,s){const o=(t-r)*s,a=(n-e)*s,l=i*i;return(2*e-2*t+o+a)*(i*l)+(-3*e+3*t-2*o-a)*l+o*i+e}function Et(r,e,t){var n;return n=(function(i,s,o){return(i-s)/(o-s)})(t,r,e),(t=Dt(n,0,1))*t*(3-2*t)}var $t="sRGB";const Ot={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},Rt=new Color;function Lt(r,e,t){const n=t.value;return t.value=function(i,s){let o=n.bind(this,i,s)();return $t=="linear"?(Rt.set(o),Rt.convertSRGBToLinear(),Rt.getHex()):o},t}class Nt{constructor(e={}){this.parameters=st(e,Ot),typeof this.parameters.value=="string"&&(this.parameters.value=Rt.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(e={}){const t=st(e,this.parameters);return t.scale==="rainbow"?t.scale=["red","orange","yellow","green","blue"]:t.scale==="rwb"&&(t.scale=["red","white","blue"]),t.reverse&&(t.domain=t.domain.slice().reverse()),chromaExports.scale(t.scale).mode(t.mode).domain(t.domain).out("num")}colorToArray(e,t=[],n=0){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t}atomColorToArray(e,t,n){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,n)}bondColor(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(e,t,n,i){return this.colorToArray(this.bondColor(e,t),n,i)}volumeColorToArray(e,t,n){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,n)}positionColorToArray(e,t,n){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,n)}}var zt;(function(r){r[r.PROTEIN=1]="PROTEIN",r[r.NUCLEIC=2]="NUCLEIC",r[r.RNA=3]="RNA",r[r.DNA=4]="DNA",r[r.POLYMER=5]="POLYMER",r[r.WATER=6]="WATER",r[r.HELIX=7]="HELIX",r[r.SHEET=8]="SHEET",r[r.TURN=9]="TURN",r[r.BACKBONE=10]="BACKBONE",r[r.SIDECHAIN=11]="SIDECHAIN",r[r.ALL=12]="ALL",r[r.HETERO=13]="HETERO",r[r.ION=14]="ION",r[r.SACCHARIDE=15]="SACCHARIDE",r[r.SUGAR=15]="SUGAR",r[r.BONDED=16]="BONDED",r[r.RING=17]="RING",r[r.AROMATICRING=18]="AROMATICRING",r[r.METAL=19]="METAL",r[r.POLARH=20]="POLARH",r[r.NONE=21]="NONE"})(zt||(zt={}));const Ut=["*","","ALL"],Vt=["NONE"],jt=[zt.BACKBONE,zt.SIDECHAIN,zt.BONDED,zt.RING,zt.AROMATICRING,zt.METAL,zt.POLARH],Gt=[zt.POLYMER,zt.WATER],Ht=["ALA","GLY","SER"],qt=["CYS","SER","THR"],Wt=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],Xt=["PHE","TRP","TYR","HIS"],Yt=["ASN","GLN"],Kt=["ASP","GLU"],Zt=["ARG","HIS","LYS"],Qt=["ARG","ASP","GLU","HIS","LYS"],Jt=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],te=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],ee=["HIS","PHE","PRO","TRP","TYR"],ie=["ALA","GLY","ILE","LEU","VAL"];function re(r,e){if(e.atomname===void 0&&e.element===void 0&&e.altloc===void 0&&e.atomindex===void 0&&e.keyword===void 0&&e.inscode===void 0&&e.resname===void 0&&e.sstruc===void 0&&e.resno===void 0&&e.chainname===void 0&&e.model===void 0)return-1;if(e.keyword!==void 0&&(e.keyword===zt.BACKBONE&&!r.isBackbone()||e.keyword===zt.SIDECHAIN&&!r.isSidechain()||e.keyword===zt.BONDED&&!r.isBonded()||e.keyword===zt.RING&&!r.isRing()||e.keyword===zt.AROMATICRING&&!r.isAromatic()||e.keyword===zt.HETERO&&!r.isHetero()||e.keyword===zt.PROTEIN&&!r.isProtein()||e.keyword===zt.NUCLEIC&&!r.isNucleic()||e.keyword===zt.RNA&&!r.isRna()||e.keyword===zt.DNA&&!r.isDna()||e.keyword===zt.POLYMER&&!r.isPolymer()||e.keyword===zt.WATER&&!r.isWater()||e.keyword===zt.HELIX&&!r.isHelix()||e.keyword===zt.SHEET&&!r.isSheet()||e.keyword===zt.TURN&&!r.isTurn()||e.keyword===zt.ION&&!r.isIon()||e.keyword===zt.SACCHARIDE&&!r.isSaccharide()||e.keyword===zt.METAL&&!r.isMetal()||e.keyword===zt.POLARH&&!r.isPolarHydrogen())||e.atomname!==void 0&&e.atomname!==r.atomname||e.element!==void 0&&e.element!==r.element||e.altloc!==void 0&&e.altloc!==r.altloc||e.atomindex!==void 0&&mt(e.atomindex,r.index)<0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(r.resname))return!1}else if(e.resname!==r.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==r.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>r.resno||e.resno[1]<r.resno)return!1}else if(e.resno!==r.resno)return!1}return(e.inscode===void 0||e.inscode===r.inscode)&&(e.chainname===void 0||e.chainname===r.chainname)&&(e.model===void 0||e.model===r.modelIndex)}function ne(r,e){if(e.resname===void 0&&e.resno===void 0&&e.inscode===void 0&&e.sstruc===void 0&&e.model===void 0&&e.chainname===void 0&&e.atomindex===void 0&&(e.keyword===void 0||jt.includes(e.keyword)))return-1;if(e.keyword!==void 0&&(e.keyword===zt.HETERO&&!r.isHetero()||e.keyword===zt.PROTEIN&&!r.isProtein()||e.keyword===zt.NUCLEIC&&!r.isNucleic()||e.keyword===zt.RNA&&!r.isRna()||e.keyword===zt.DNA&&!r.isDna()||e.keyword===zt.POLYMER&&!r.isPolymer()||e.keyword===zt.WATER&&!r.isWater()||e.keyword===zt.HELIX&&!r.isHelix()||e.keyword===zt.SHEET&&!r.isSheet()||e.keyword===zt.TURN&&!r.isTurn()||e.keyword===zt.ION&&!r.isIon()||e.keyword===zt.SACCHARIDE&&!r.isSaccharide())||e.atomindex!==void 0&&ft(e.atomindex,r.atomOffset,r.atomEnd)===0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(r.resname))return!1}else if(e.resname!==r.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==r.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>r.resno||e.resno[1]<r.resno)return!1}else if(e.resno!==r.resno)return!1}return(e.inscode===void 0||e.inscode===r.inscode)&&(e.chainname===void 0||e.chainname===r.chainname)&&(e.model===void 0||e.model===r.modelIndex)}function se(r,e){return e.chainname!==void 0||e.model!==void 0||e.atomindex!==void 0||e.keyword!==void 0&&Gt.includes(e.keyword)&&r.entity?e.keyword!==void 0&&(e.keyword===zt.POLYMER&&!r.entity.isPolymer()||e.keyword===zt.WATER&&!r.entity.isWater())?!1:(e.atomindex===void 0||ft(e.atomindex,r.atomOffset,r.atomEnd)!==0)&&(e.chainname===void 0||e.chainname===r.chainname)&&(e.model===void 0||e.model===r.modelIndex):-1}function oe(r,e){return e.model===void 0&&e.atomindex===void 0?-1:(e.atomindex===void 0||ft(e.atomindex,r.atomOffset,r.atomEnd)!==0)&&(e.model===void 0||e.model===r.index)}function ae(r,e){if(r===null||r.error||!r.rules||r.rules.length===0)return!1;const t=r.rules.length,n=!r.negate,i=!!r.negate,s=[];for(let o=0;o<t;++o){const a=r.rules[o];a.hasOwnProperty("operator")&&(s[o]=ae(a,e))}return function(o){const a=r.operator==="AND";let l=!1;for(let d=0;d<t;++d){const u=r.rules[d];let g;if(u.hasOwnProperty("operator")){const x=s[d];if(g=x!==!1?x(o):-1,g===-1){l=!0;continue}if(g===!0){if(a)continue;return n}if(a)return i}else{if(u.keyword===zt.ALL){if(a)continue;return n}if(u.keyword===zt.NONE){if(a)continue;return i}if(g=e(o,u),g!==-1){if(g===!0){if(a)continue;return n}if(a)return i}else l=!0}}return l?-1:a?n:i}}function ce(r,e){if(r.error||!r.rules||r.rules.length===0)return r;const t=r.rules.length,n={operator:r.operator,rules:[]};r.hasOwnProperty("negate")&&(n.negate=r.negate);for(let i=0;i<t;++i){const s=r.rules[i];if(s.hasOwnProperty("operator")){const o=ce(s,e);o!==null&&n.rules.push(o)}else e(s)||n.rules.push(s)}return n.rules.length>0?r:null}function le(r,e=!1){let t=r;return e&&(t=ce(r,(function(n){return n.keyword!==void 0&&!jt.includes(n.keyword)||n.model!==void 0||n.chainname!==void 0||n.resname!==void 0||n.resno!==void 0||n.sstruc!==void 0}))),ae(t,re)}function he(r,e=!1){let t=r;return e&&(t=ce(r,(function(n){return!(n.keyword===void 0||!jt.includes(n.keyword))||n.model!==void 0||n.chainname!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0}))),ae(t,ne)}function ue(r,e=!1){let t=r;return e&&(t=ce(r,(function(n){return n.keyword!==void 0&&!Gt.includes(n.keyword)||n.resname!==void 0||n.resno!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0||n.sstruc!==void 0||n.inscode!==void 0}))),ae(t,se)}function de(r,e=!1){let t=r;return e&&(t=ce(r,(function(n){return n.keyword!==void 0||n.chainname!==void 0||n.resname!==void 0||n.resno!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0||n.sstruc!==void 0||n.inscode!==void 0}))),ae(t,oe)}class me{constructor(e){this.signals={stringChanged:new signalsExports.Signal},this.setString(e)}get type(){return"selection"}setString(e,t){if(e===void 0&&(e=this.string||""),e===this.string)return;try{this.selection=(function(i){let s={operator:void 0,rules:[]};if(!i)return s;let o,a,l=s;const d=[];(i=i.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)==="("&&i.substr(-1)===")"&&(i=i.slice(1,-1).trim());const u=i.split(/\s+/),g=_=>{o={operator:_,rules:[]},l===void 0?(l=o,s=o):(l.rules.push(o),d.push(l),l=o)},x=function(_){a=l,l=d.pop(),l===void 0&&(g(_),y(a))},y=function(_){l.rules.push(_)};let b=!1;for(let _=0;_<u.length;++_){const h=u[_],f=h.toUpperCase();if(h==="("){b=!1,g();continue}if(h===")"){x(),l.negate&&x();continue}if(b>0)if(f==="NOT")b=1;else if(b===1)b=2;else{if(b!==2)throw new Error("something went wrong with 'not'");b=!1,x()}if(f==="AND"){if(l.operator==="OR"){const M=l.rules.pop();g("AND"),y(M)}else l.operator="AND";continue}if(f==="OR"){l.operator==="AND"?x("OR"):l.operator="OR";continue}if(h.toUpperCase()==="NOT"){b=1,g(),l.negate=!0;continue}if(+f!=+f){const M=zt[f];if(M!==void 0){y({keyword:M});continue}}if(f==="HYDROGEN"){y({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if(f==="SMALL"){y({resname:Ht});continue}if(f==="NUCLEOPHILIC"){y({resname:qt});continue}if(f==="HYDROPHOBIC"){y({resname:Wt});continue}if(f==="AROMATIC"){y({resname:Xt});continue}if(f==="AMIDE"){y({resname:Yt});continue}if(f==="ACIDIC"){y({resname:Kt});continue}if(f==="BASIC"){y({resname:Zt});continue}if(f==="CHARGED"){y({resname:Qt});continue}if(f==="POLAR"){y({resname:Jt});continue}if(f==="NONPOLAR"){y({resname:te});continue}if(f==="CYCLIC"){y({resname:ee});continue}if(f==="ALIPHATIC"){y({resname:ie});continue}if(f==="SIDECHAINATTACHED"){y({operator:"OR",rules:[{keyword:zt.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:zt.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:zt.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if(f==="APOLARH"){y({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:zt.POLARH}]}]});continue}if(f==="LIGAND"){y({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:zt.HETERO},{negate:!0,operator:void 0,rules:[{keyword:zt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:zt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:zt.WATER},{keyword:zt.ION}]}]}]});continue}if(Ut.indexOf(f)!==-1){y({keyword:zt.ALL});continue}if(h.charAt(0)==="@"){const M=h.substr(1).split(",").map((T=>parseInt(T)));M.sort((function(T,R){return T-R})),y({atomindex:M});continue}if(h.charAt(0)==="#"){console.error("# for element selection deprecated, use _"),y({element:f.substr(1)});continue}if(h.charAt(0)==="_"){y({element:f.substr(1)});continue}if(h[0]==="["&&h[h.length-1]==="]"){const M=f.substr(1,h.length-2).split(","),T=M.length>1?M:M[0];y({resname:T});continue}if(h.length>=1&&h.length<=4&&h[0]!=="^"&&h[0]!==":"&&h[0]!=="."&&h[0]!=="%"&&h[0]!=="/"&&isNaN(parseInt(h))){y({resname:f});continue}const E={operator:"AND",rules:[]},m=h.split("/");if(m.length>1&&m[1]){if(isNaN(parseInt(m[1])))throw new Error("model must be an integer");E.rules.push({model:parseInt(m[1])})}const S=m[0].split("%");S.length>1&&E.rules.push({altloc:S[1]});const w=S[0].split(".");if(w.length>1&&w[1]){if(w[1].length>4)throw new Error("atomname must be one to four characters");E.rules.push({atomname:w[1].substring(0,4).toUpperCase()})}const v=w[0].split(":");v.length>1&&v[1]&&E.rules.push({chainname:v[1]});const A=v[0].split("^");if(A.length>1&&E.rules.push({inscode:A[1]}),A[0]){let M,T;A[0][0]==="-"&&(A[0]=A[0].substr(1),M=!0),A[0].includes("--")&&(A[0]=A[0].replace("--","-"),T=!0);let R=A[0].split("-");if(R.length===1){let O=parseInt(R[0]);if(isNaN(O))throw new Error("resi must be an integer");M&&(O*=-1),E.rules.push({resno:O})}else{if(R.length!==2)throw new Error("resi range must contain one '-'");{const O=R.map((L=>parseInt(L)));M&&(O[0]*=-1),T&&(O[1]*=-1),E.rules.push({resno:[O[0],O[1]]})}}}if(E.rules.length===1)y(E.rules[0]);else{if(!(E.rules.length>1))throw new Error("empty selection chunk");y(E)}}return s.operator===void 0&&s.rules.length===1&&s.rules[0].hasOwnProperty("operator")&&(s=s.rules[0]),s})(e)}catch(i){this.selection={error:i.message}}const n=this.selection;this.string=e,this.test=le(n),this.residueTest=he(n),this.chainTest=ue(n),this.modelTest=de(n),this.atomOnlyTest=le(n,!0),this.residueOnlyTest=he(n,!0),this.chainOnlyTest=ue(n,!0),this.modelOnlyTest=de(n,!0),t||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return Ut.includes(this.string.toUpperCase())}isNoneSelection(){return Vt.includes(this.string.toUpperCase())}}class fe extends Nt{constructor(e){super(e),this.colormakerList=[],this.selectionList=[],(e.dataList||[]).forEach((t=>{const[n,i,s={}]=t;Oe.hasScheme(n)?Object.assign(s,{scheme:n,structure:this.parameters.structure}):Object.assign(s,{scheme:"uniform",value:new Color(n).getHex()}),this.colormakerList.push(Oe.getScheme(s)),this.selectionList.push(new me(i))}))}atomColor(e){for(let t=0,n=this.selectionList.length;t<n;++t){const i=this.selectionList[t].test;if(i&&i(e))return this.colormakerList[t].atomColor(e)}return 16777215}}const pe={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},ge={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};function ye(r){const e=r;return r.forEach((function(t){t.__deps&&Array.prototype.push.apply(e,ye(t.__deps))})),e}function be(r){return pt(ye(r)).map((function(e){return e.toString()})).join(`


`)}function _e(r){const e=r.data.__name,t=r.data.__postId;if(e===void 0)console.error("message __name undefined");else if(self.func===void 0)console.error("worker func undefined",e);else{const n=function(i,s){i=i||{},t!==void 0&&(i.__postId=t);try{self.postMessage(i,s)}catch(o){console.error("self.postMessage:",o),self.postMessage(i)}};self.func(r,n)}}function xe(r,e){let t=`'use strict';

`+be(e);return t+=`


self.func = `+r.toString()+";",t+=`


self.onmessage = `+_e.toString()+";",new Blob([t],{type:"application/javascript"})}const ve=ct();let we=!1;try{const r=Object.defineProperty({},"passive",{get:function(){we=!0}});window.addEventListener("test",(e=>{}),r)}catch{}const Ae=typeof window<"u"&&window.orientation!==void 0;let Se=!1;function Ce(r){Se=r}let Pe=!1;function Ie(r){Pe=r}const ke={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let Me={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1},De=!!(Be=rt("debug"))&&(typeof Be!="string"||/^1|true|t|yes|y$/i.test(Be));var Be;const Ee=["ngl","js"],$e=new class{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(r,e,t){this._funcDict[r]=e,this._depsDict[r]=t}get(r){return this._blobDict[r]||(this._blobDict[r]=xe(this._funcDict[r],this._depsDict[r])),this._blobDict[r]}},Oe=new class{constructor(){this.schemes={},this.userSchemes={}}getScheme(r){const e=((r||{}).scheme||"").toLowerCase();let t;return t=e in this.schemes?this.schemes[e]:e in this.userSchemes?this.userSchemes[e]:Nt,new t(r)}getSchemes(){const r={};return Object.keys(this.schemes).forEach((function(e){r[e]=e})),Object.keys(this.userSchemes).forEach((function(e){r[e]=e.split("|")[1]})),r}getScales(){return pe}getModes(){return ge}add(r,e){r=r.toLowerCase(),this.schemes[r]=e}addScheme(r,e){return(function(t){return t instanceof Nt})(r)||(r=this._createScheme(r)),this._addUserScheme(r,e)}_addUserScheme(r,e){e=e||"";const t=`${Tt()}|${e}`.toLowerCase();return this.userSchemes[t]=r,t}removeScheme(r){r=r.toLowerCase(),delete this.userSchemes[r]}_createScheme(r){return class extends Nt{constructor(e){super(e),r.call(this,e)}}}addSelectionScheme(r,e){return this._addUserScheme(class extends fe{constructor(t){super(Object.assign({dataList:r},t))}},e)}hasScheme(r){return(r=r.toLowerCase())in this.schemes||r in this.userSchemes}},Re=new Pt("datasource"),Le=new Pt("representatation"),Ne=new class extends Pt{constructor(){super("parser")}__hasObjName(r,e){const t=this.get(r);return t&&t.prototype.__objName===e}isTrajectory(r){return this.__hasObjName(r,"frames")}isStructure(r){return this.__hasObjName(r,"structure")}isVolume(r){return this.__hasObjName(r,"volume")}isSurface(r){return this.__hasObjName(r,"surface")}isBinary(r){const e=this.get(r);return e&&e.prototype.isBinary}isXml(r){const e=this.get(r);return e&&e.prototype.isXml}isJson(r){const e=this.get(r);return e&&e.prototype.isJson}getTrajectoryExtensions(){return this.names.filter((r=>this.isTrajectory(r)))}getStructureExtensions(){return this.names.filter((r=>this.isStructure(r)))}getVolumeExtensions(){return this.names.filter((r=>this.isVolume(r)))}getSurfaceExtensions(){return this.names.filter((r=>this.isSurface(r)))}},ze=new Pt("shader"),Ue=new Pt("decompressor"),Ve=new Pt("component"),je=new Pt("buffer"),Ge=new Pt("picker");let qe;class Ye{constructor(e,t={}){this.chunkSize=10485760,this.newline=`
`,this.__pointer=0,this.__partialLine="",this.compressed=nt(t.compressed,!1),this.binary=nt(t.binary,!1),this.json=nt(t.json,!1),this.xml=nt(t.xml,!1),this.src=e}isBinary(){return this.binary||this.compressed}read(){return this._read().then((e=>{const t=this.compressed?Ue.get(this.compressed):void 0;return this.compressed&&t?this.data=t(e):((this.binary||this.compressed)&&e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.data=e),this.data}))}_chunk(e,t){return t=Math.min(this.data.length,t),e===0&&this.data.length===t?this.data:this.isBinary()?this.data.subarray(e,t):this.data.substring(e,t)}chunk(e){const t=e+this.chunkSize;return this._chunk(e,t)}peekLines(e){const t=this.data,n=t.length,i=this.isBinary()?this.newline.charCodeAt(0):this.newline;let s,o=0;for(s=0;s<n&&(t[s]===i&&++o,o!==e);++s);const a=this._chunk(0,s+1);return this.chunkToLines(a,"",s>n).lines}chunkCount(){return Math.floor(this.data.length/this.chunkSize)+1}asText(){return this.isBinary()?gt(this.data):this.data}chunkToLines(e,t,n){const i=this.newline;if(!this.isBinary()&&e.length===this.data.length)return{lines:e.split(i),partialLine:""};let s=[];const o=this.isBinary()?gt(e):e,a=o.lastIndexOf(i);if(a===-1)t+=o;else{const l=t+o.substr(0,a);s=s.concat(l.split(i)),t=a===o.length-i.length?"":o.substr(a+i.length)}return n&&t!==""&&s.push(t),{lines:s,partialLine:t}}nextChunk(){const e=this.__pointer;if(!(e>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(e)}nextChunkOfLines(){const e=this.nextChunk();if(e===void 0)return;const t=this.__pointer>this.data.length,n=this.chunkToLines(e,this.__partialLine,t);return this.__partialLine=n.partialLine,n.lines}eachChunk(e){const t=this.chunkSize,n=this.data.length,i=this.chunkCount();for(let s=0;s<n;s+=t)e(this.chunk(s),Math.round(s/t),i)}eachChunkOfLines(e){this.eachChunk(((t,n,i)=>{const s=n===i+1,o=this.chunkToLines(t,this.__partialLine,s);this.__partialLine=o.partialLine,e(o.lines,n,i)}))}dispose(){delete this.src}}class Ke extends Ye{_read(){return new Promise(((e,t)=>{const n=this.src,i=new FileReader;i.onload=s=>{s.target&&e(s.target.result)},i.onerror=s=>t(s),this.binary||this.compressed?i.readAsArrayBuffer(n):i.readAsText(n)}))}}class Ze extends Ye{_read(){return new Promise(((e,t)=>{const n=this.src,i=new XMLHttpRequest;i.open("GET",n,!0),i.addEventListener("load",(()=>{if(i.status===200||i.status===304||i.status===0)try{e(i.response)}catch(s){t(s)}else t(i.statusText)}),!1),i.addEventListener("error",(s=>t("network error")),!1),this.isBinary()?i.responseType="arraybuffer":this.json?i.responseType="json":this.xml?i.responseType="document":i.responseType="text",i.send()}))}}class Qe{constructor(e,t={}){this.parameters=st(t,{ext:"",compressed:!1,binary:Ne.isBinary(t.ext||""),name:"",dir:"",path:"",protocol:""});const n={compressed:this.parameters.compressed,binary:this.parameters.binary,json:Ne.isJson(this.parameters.ext),xml:Ne.isXml(this.parameters.ext)};typeof File<"u"&&e instanceof File||typeof Blob<"u"&&e instanceof Blob?this.streamer=new Ke(e,n):this.streamer=new Ze(e,n)}}class Je extends Qe{constructor(e,t={}){super(e,t),this.parserParams={voxelSize:t.voxelSize,firstModelOnly:t.firstModelOnly,asTrajectory:t.asTrajectory,cAlphaOnly:t.cAlphaOnly,delimiter:t.delimiter,comment:t.comment,columnNames:t.columnNames,inferBonds:t.inferBonds,name:this.parameters.name,path:this.parameters.path}}load(){return new(Ne.get(this.parameters.ext))(this.streamer,this.parserParams).parse()}}class ti{constructor(e,t,n){this.name=t,this.path=n,this.signals={elementAdded:new signalsExports.Signal,elementRemoved:new signalsExports.Signal,nameChanged:new signalsExports.Signal},this.type="Script",this.dir=n.substring(0,n.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",e)}catch(i){ke.error("Script compilation failed",i),this.fn=function(){}}}run(e){return new Promise(((t,n)=>{try{this.fn.apply(null,[e,this.name,this.path,this.dir]),t()}catch(i){ke.error("Script.fn",i),n(i)}}))}}class ei extends Qe{load(){return this.streamer.read().then((()=>new ti(this.streamer.asText(),this.parameters.name,this.parameters.path)))}}function ii(r){const e=Ue.names;let t,n,i="";t=r instanceof File?r.name:r instanceof Blob?"":r;const s=t.lastIndexOf("?"),o=s!==-1?t.substring(s):"";t=t.substring(0,s===-1?t.length:s);const a=t.replace(/^.*[\\/]/,"");let l=a.substring(0,a.lastIndexOf("."));const d=a.split(".");let u=d.length>1?(d.pop()||"").toLowerCase():"";const g=t.match(/^(.+):\/\/(.+)$/);g&&(i=g[1].toLowerCase(),t=g[2]||"");const x=t.substring(0,t.lastIndexOf("/")+1);if(e.includes(u)){n=u;const y=t.length-u.length-1;u=(t.substr(0,y).split(".").pop()||"").toLowerCase();const b=l.length-u.length-1;l=l.substr(0,b)}else n=!1;return{path:t,name:a,ext:u,base:l,dir:x,compressed:n,protocol:i,query:o,src:r}}function ri(r){let e=ii(r);const t=Re.get(e.protocol);return t&&(e=ii(t.getUrl(e.src)),!e.ext&&t.getExt&&(e.ext=t.getExt(r))),e}function ni(r,e={}){const t=Object.assign(ri(r),e);let n;return Ne.names.includes(t.ext)?n=new Je(t.src,t):Ee.includes(t.ext)&&(n=new ei(t.src,t)),n?n.load():Promise.reject(new Error(`autoLoad: ext '${t.ext}' unknown`))}const ci=[];class li{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;e===void 0&&(e=8192),typeof e=="number"?e=new ArrayBuffer(e):n=!0;const i=t.offset?t.offset>>>0:0;let s=e.byteLength-i,o=i;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+i),e=e.buffer),this._lastWrittenByte=n?s:0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=o,this._data=new DataView(this.buffer,o,s)}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return e===void 0&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){ci.length=e;for(var t=0;t<e;t++)ci[t]=this.readChar();return ci.join("")}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class ui{constructor(){this.count=0,this.signals={countChanged:new signalsExports.Signal}}clear(){this.change(-this.count)}change(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&ke.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(e){this.change(e.count),e.signals.countChanged.add(this.change,this)}unlisten(e){const t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)}onZeroOnce(e,t){if(this.count===0)e.call(t);else{const n=()=>{this.count===0&&(this.signals.countChanged.remove(n,this),e.call(t))};this.signals.countChanged.add(n,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}ze.add("shader/BasicLine.vert",`void main(){
#include begin_vertex
#include project_vertex
}`),ze.add("shader/BasicLine.frag",`uniform vec3 uColor;
#include common
#include fog_pars_fragment
void main(){
gl_FragColor = vec4( uColor, 1.0 );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`),ze.add("shader/Quad.vert",`varying vec2 vUv;
void main() {
vUv = uv;
gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`),ze.add("shader/Quad.frag",`varying vec2 vUv;
uniform sampler2D tForeground;
uniform float scale;
void main() {
vec4 foreground = texture2D( tForeground, vUv );
gl_FragColor = foreground * scale;
}`);class di{constructor(){this.signals={updated:new signalsExports.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()}update(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()}begin(){this.startTime=window.performance.now(),this.lastFrames=this.frames}end(){const e=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=e-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,e>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=e,this.frames=0),e}}ze.add("shader/chunk/fog_fragment.glsl",`#ifdef USE_FOG
float depth = length( vViewPosition );
#ifdef FOG_EXP2
float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
#else
float fogFactor = smoothstep( fogNear, fogFar, depth );
#endif
gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`),ze.add("shader/chunk/interior_fragment.glsl",`if( gl_FrontFacing == false ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}`),ze.add("shader/chunk/matrix_scale.glsl",`float matrixScale( in mat4 m ){
vec4 r = m[ 0 ];
return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );
}`),ze.add("shader/chunk/nearclip_vertex.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear - 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),ze.add("shader/chunk/nearclip_fragment.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear )
discard;
#endif`),ze.add("shader/chunk/opaque_back_fragment.glsl",`#ifdef OPAQUE_BACK
#ifdef FLIP_SIDED
if( gl_FrontFacing == true ){
gl_FragColor.a = 1.0;
}
#else
if( gl_FrontFacing == false ){
gl_FragColor.a = 1.0;
}
#endif
#endif`),ze.add("shader/chunk/radiusclip_vertex.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),ze.add("shader/chunk/radiusclip_fragment.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius )
discard;
#endif`),ze.add("shader/chunk/unpack_color.glsl",`vec3 unpackColor(float f) {
vec3 color;
color.r = floor(f / 256.0 / 256.0);
color.g = floor((f - color.r * 256.0 * 256.0) / 256.0);
color.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);
return color / 255.0;
}`);const mi=/^(?!\/\/)\s*#include\s+(\S+)/gim,fi={};function pi(r,e={}){let t=r+"|";for(const n in e)t+=n+":"+e[n];if(!fi[t]){const n=(function(s){if(s===void 0)return"";const o=[];for(const a in s){const l=s[a];l&&o.push(`#define ${a} ${l}`)}return o.join(`
`)+`
`})(e);let i=ze.get(`shader/${r}`);if(!i)throw new Error(`empty shader, '${r}'`);i=i.replace(mi,(function(s,o){const a=`shader/chunk/${o}.glsl`,l=ze.get(a)||ShaderChunk[o];if(!l)throw new Error(`empty chunk, '${o}'`);return l})),fi[t]=n+i}return fi[t]}if(typeof WebGLRenderingContext<"u"){const r=WebGLRenderingContext.prototype,e=r.getShaderParameter;r.getShaderParameter=function(){return!De||e.apply(this,arguments)};const t=r.getShaderInfoLog;r.getShaderInfoLog=function(){return De?t.apply(this,arguments):""};const n=r.getProgramParameter;r.getProgramParameter=function(s,o){return!De&&o===r.LINK_STATUS||n.apply(this,arguments)};const i=r.getProgramInfoLog;r.getProgramInfoLog=function(){return De?i.apply(this,arguments):""}}const gi=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];gi.forEach((r=>{r.forEach((e=>{e[0]*=.0625,e[1]*=.0625}))}));class yi{constructor(e,t,n,i){this.canvas=document.createElement("canvas"),this._viewer=n,this._factor=nt(i.factor,2),this._antialias=nt(i.antialias,!1),this._onProgress=i.onProgress,this._onFinish=i.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=n.sampleLevel,this._viewer.setSampling(-1)}_renderTile(e){const t=this._viewer,n=this._width,i=this._height,s=this._factor,o=e%s*n,a=Math.floor(e/s)*i;if(t.camera.setViewOffset(n*s,i*s,o,a,n,i),t.render(),this._antialias){const l=Math.round((o+n)/2)-Math.round(o/2),d=Math.round((a+i)/2)-Math.round(a/2);this._ctx.drawImage(t.renderer.domElement,Math.round(o/2),Math.round(a/2),l,d)}else this._ctx.drawImage(t.renderer.domElement,Math.floor(o),Math.floor(a),Math.ceil(n),Math.ceil(i));typeof this._onProgress=="function"&&this._onProgress(e+1,this._n,!1)}_finalize(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,typeof this._onFinish=="function"&&this._onFinish(this._n+1,this._n,!1)}render(){for(let e=0;e<=this._n;++e)e===this._n?this._finalize():this._renderTile(e)}renderAsync(){let e=0;const t=this._n,n=()=>{e===t?this._finalize():this._renderTile(e),e+=1};for(let i=0;i<=t;++i)setTimeout(n,0)}}const bi=2*Math.PI,_i=180/Math.PI;function xi(r,e,t=1,n=0,i){const s=i?i.length:r.length/t;let o=0,a=0;if(i)for(let l=0;l<s;++l){const d=(r[i[l]*t+n]+e)%e/e*bi-Math.PI;o+=Math.cos(d),a+=Math.sin(d)}else for(let l=n;l<s;l+=t){const d=(r[l]+e)%e/e*bi-Math.PI;o+=Math.cos(d),a+=Math.sin(d)}return o/=s,a/=s,(Math.atan2(a,o)+Math.PI)/bi*e}function vi(r,e,t,n=0){const i=r.length,s=t||new Float32Array(i);for(let o=0;o<i;o+=3)s[n+o+0]=(r[o+0]+e[o+0])/2,s[n+o+1]=(r[o+1]+e[o+1])/2,s[n+o+2]=(r[o+2]+e[o+2])/2;return s}function wi(r,e){const t=r.length,n=new Float32Array(t);for(let i=0;i<t;i+=3)n[i+0]=e[i+0]-r[i+0],n[i+1]=e[i+1]-r[i+1],n[i+2]=e[i+2]-r[i+2];return n}function Ai(r,e,t){const n=t||new Float32Array(r);for(let i=0;i<r;++i)n[i]=e;return n}function Si(r,e,t,n,i){const s=i||new Float32Array(3*r);for(let o=0;o<r;++o){const a=3*o;s[a+0]=e,s[a+1]=t,s[a+2]=n}return s}function Ci(r){const e=new Float32Array(r);for(let t=0;t<r;++t)e[t]=t;return e}function Pi(r,e,t=0,n){const i=n||new Float32Array(r*e);for(let s=0;s<r;++s){const o=t+s*e;for(let a=0;a<e;++a)i[o+a]=s}return i}function Ii(r,e){const t=r.length,n=new Float32Array(t*e);for(let i=0;i<t;++i){const s=i*e,o=r[i];for(let a=0;a<e;++a)n[s+a]=o}return n}function ki(r,e,t,n,i){for(let s=0;s<i;++s)e[n+s]=r[t+s]}function Mi(r,e,t,n){ki(r,r,e,t,n)}function Ti(r){let e=-1/0;for(let t=0,n=r.length;t<n;++t)r[t]>e&&(e=r[t]);return e}function Di(r){let e=1/0;for(let t=0,n=r.length;t<n;++t)r[t]<e&&(e=r[t]);return e}function Bi(r,e=1,t=0){const n=r.length;let i=0;for(let s=t;s<n;s+=e)i+=r[s];return i}function Fi(r,e=1,t=0){return Bi(r,e,t)/(r.length/e)}const Ei={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0};function $i(r,e={}){const{trim:t,factor:n,antialias:i,transparent:s}=st(e,Ei),o=r.renderer,a=r.camera,l=o.getClearAlpha(),d=o.getClearColor(new Color);function u(y=!1){let b=n;i&&(b*=2),y&&(b=1/b),r.scene.traverse((function(_){const h=_.material;h&&h.linewidth&&(h.linewidth*=b),h&&h.uniforms&&h.uniforms.size&&h.uniforms.size.__seen===void 0&&(h.uniforms.size.value*=b,h.uniforms.size.__seen=!0),h&&h.uniforms&&h.uniforms.linewidth&&h.uniforms.linewidth.__seen===void 0&&(h.uniforms.linewidth.value*=b,h.uniforms.linewidth.__seen=!0)})),r.scene.traverse((function(_){const h=_.material;h&&h.uniforms&&h.uniforms.size&&delete h.uniforms.size.__seen,h&&h.uniforms&&h.uniforms.linewidth&&delete h.uniforms.linewidth.__seen}))}function g(y){if(t){const b=d;return(function(_,h,f,E,m){const S=_.height,w=_.width,v=_.getContext("2d").getImageData(0,0,w,S).data;let A,M,T,R;for(T=!1,M=0;M<S;M++){for(A=0;A<w;A++)if(R=4*(M*w+A),v[R]!==h||v[R+1]!==f||v[R+2]!==E||v[R+3]!==m){T=!0;break}if(T)break}const O=M;for(T=!1,A=0;A<w;A++){for(M=0;M<S;M++)if(R=4*(M*w+A),v[R]!==h||v[R+1]!==f||v[R+2]!==E||v[R+3]!==m){T=!0;break}if(T)break}const L=A;for(T=!1,M=S-1;M>=0;M--){for(A=w-1;A>=0;A--)if(R=4*(M*w+A),v[R]!==h||v[R+1]!==f||v[R+2]!==E||v[R+3]!==m){T=!0;break}if(T)break}const P=M;for(T=!1,A=w-1;A>=0;A--){for(M=S-1;M>=0;M--)if(R=4*(M*w+A),v[R]!==h||v[R+1]!==f||v[R+2]!==E||v[R+3]!==m){T=!0;break}if(T)break}const I=A,N=document.createElement("canvas");return N.width=I-L,N.height=P-O,N.getContext("2d").drawImage(_,L,O,N.width,N.height,0,0,N.width,N.height),N})(y,s?0:255*b.r,s?0:255*b.g,s?0:255*b.b,s?0:255)}return y}function x(y,b,_){typeof e.onProgress=="function"&&e.onProgress(y,b,_)}return new Promise((function(y,b){const _=new yi(o,a,r,{factor:n,antialias:i,onProgress:x,onFinish:function(h,f){g(_.canvas).toBlob((function(E){o.setClearAlpha(l),u(!0),r.requestRender(),x(f,f,!0),E?y(E):b("error creating image")}),"image/png")}});o.setClearAlpha(s?0:1),u(),_.renderAsync()}))}const Oi=new Vector3,Ri=new Matrix4,Li=new Matrix4,Ni=new Vector2,zi=new Matrix4,Ui=new Matrix4;function Vi(r,e){zi.copy(e.projectionMatrix).invert(),Ui.copy(e.projectionMatrix).transpose(),r.traverse((function(t){const n=t.material;if(!n)return;const i=n.uniforms;i&&(i.projectionMatrixInverse&&i.projectionMatrixInverse.value.copy(zi),i.projectionMatrixTranspose&&i.projectionMatrixTranspose.value.copy(Ui))}))}function ji(r,e,t){const n=r.createShader(t);return n?(r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(console.log(`error compiling shader ${n}: ${r.getShaderInfoLog(n)}`),r.deleteShader(n),null)):void console.log(`error creating WebGL shader ${t}`)}function Gi(r,e){const t=r.getExtension(e);return t||console.log(`extension '${e}' not available`),t}const Hi=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function qi(r){const e=document.createElement("canvas");e.width=16,e.height=16,e.style.width="16px",e.style.height="16px";const t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return console.log(`error creating webgl context for ${r}`),!1;if(!(t instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;Gi(t,"OES_texture_float"),Gi(t,"OES_texture_half_float"),Gi(t,"WEBGL_color_buffer_float");const n=ji(t,`
attribute vec4 a_position;

void main() {
  gl_Position = a_position;
}`,t.VERTEX_SHADER),i=ji(t,`
precision mediump float;
uniform vec4 u_color;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;
}`,t.FRAGMENT_SHADER);if(!n||!i)return!1;const s=(function(b,_,h,f){const E=b.createProgram();return E?(_.forEach((m=>b.attachShader(E,m))),b.linkProgram(E),b.getProgramParameter(E,b.LINK_STATUS)?E:(console.log(`error linking program: ${b.getProgramInfoLog(E)}`),b.deleteProgram(E),null)):void console.log("error creating WebGL program")})(t,[n,i]);if(!s)return console.log("error creating WebGL program"),!1;t.useProgram(s);const o=t.getAttribLocation(s,"a_position"),a=t.getUniformLocation(s,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;const l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,Hi,t.STATIC_DRAW),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0);const d=t.createTexture(),u=new Uint8Array([255,255,255,255]);t.bindTexture(t.TEXTURE_2D,d),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,u);const g=t.createTexture();t.bindTexture(t.TEXTURE_2D,g),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,r,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const x=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,x),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,g,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)return console.log(`error creating framebuffer for ${r}`),!1;t.bindTexture(t.TEXTURE_2D,d),t.uniform4fv(a,[0,10,20,1]),t.drawArrays(t.TRIANGLES,0,6),t.bindTexture(t.TEXTURE_2D,g),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(1,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.uniform4fv(a,[0,.1,.05,1]),t.drawArrays(t.TRIANGLES,0,6);const y=new Uint8Array(4);if(t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,y),y[0]!==0||y[1]<248||y[2]<248||y[3]<254)return console.log(`not able to actually render to ${r} texture`),!1;if(r===t.FLOAT){t.bindFramebuffer(t.FRAMEBUFFER,x);const b=new Float32Array(4);t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,b);const _=t.getError();if(_)return console.log(`error reading pixels as float: '${(function(h,f){switch(f){case h.NO_ERROR:return"no error";case h.INVALID_ENUM:return"invalid enum";case h.INVALID_VALUE:return"invalid value";case h.INVALID_OPERATION:return"invalid operation";case h.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case h.OUT_OF_MEMORY:return"out of memory";case h.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"})(t,_)}'`),!1}return!0}const Wi=new Float32Array(100),Xi=new Uint8Array(100),Yi=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],Ki=new Matrix4;function Zi(r,e,t,n,i){const s=i.uniforms,o=[];if(s&&(s.objectId&&(s.objectId.value=Se?this.id:this.id/255,o.push("objectId")),(s.modelViewMatrixInverse||s.modelViewMatrixInverseTranspose||s.modelViewProjectionMatrix||s.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,this.matrixWorld),s.modelViewMatrixInverse&&(s.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert(),o.push("modelViewMatrixInverse")),s.modelViewMatrixInverseTranspose&&(s.modelViewMatrixInverse?s.modelViewMatrixInverseTranspose.value.copy(s.modelViewMatrixInverse.value).transpose():s.modelViewMatrixInverseTranspose.value.copy(this.modelViewMatrix).invert().transpose(),o.push("modelViewMatrixInverseTranspose")),s.modelViewProjectionMatrix&&(s.modelViewProjectionMatrix.value.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),o.push("modelViewProjectionMatrix")),s.modelViewProjectionMatrixInverse&&(s.modelViewProjectionMatrix?(Ki.copy(s.modelViewProjectionMatrix.value),s.modelViewProjectionMatrixInverse.value.copy(Ki.invert())):(Ki.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),s.modelViewProjectionMatrixInverse.value.copy(Ki.invert())),o.push("modelViewProjectionMatrixInverse")),o.length)){const a=r.properties.get(i);if(a.program){const l=r.getContext(),d=a.program;l.useProgram(d.program);const u=d.getUniforms();o.forEach((function(g){u.setValue(l,g,s[g].value)}))}}}class Qi{constructor(e){if(this.boundingBox=new Box3,this.boundingBoxSize=new Vector3,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new Vector3,this.signals={ticked:new signalsExports.Signal,rendered:new signalsExports.Signal},typeof e=="string"){const t=document.getElementById(e);this.container=t===null?document.createElement("div"):t}else e instanceof HTMLElement?this.container=e:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{const t=this.container.getBoundingClientRect();this.width=t.width||1,this.height=t.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),this._initRenderer()!==!1?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):ke.error("Viewer: could not initialize renderer")}_initParams(){this.parameters={fogColor:new Color(0),fogNear:50,fogFar:100,backgroundColor:new Color(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new Color(14540253),lightIntensity:1.2,ambientColor:new Color(14540253),ambientIntensity:.3,sampleLevel:0,outputColorSpace:"srgb-linear"}}_initCamera(){const e=new Vector3(0,0,0),{width:t,height:n}=this;this.perspectiveCamera=new PerspectiveCamera(this.parameters.cameraFov,t/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(e),this.orthographicCamera=new OrthographicCamera(t/-2,t/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(e),this.stereoCamera=new StereoCamera,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;const i=this.parameters.cameraType;if(i==="orthographic")this.camera=this.orthographicCamera;else{if(i!=="perspective"&&i!=="stereo")throw new Error(`Unknown cameraType '${i}'`);this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()}_initStats(){this.stats=new di}_initScene(){this.scene||(this.scene=new Scene,this.scene.name="scene"),this.rotationGroup=new Group,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new Group,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new Group,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new Group,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new Group,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new Group,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new Fog(this.parameters.fogColor.getHex()),this.directionalLight=new DirectionalLight(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.directionalLight),this.ambientLight=new AmbientLight(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)}_initRenderer(){const e=window.devicePixelRatio,{width:t,height:n}=this;try{this.renderer=new WebGLRenderer({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch{return this.wrapper.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',!1}this.renderer.setPixelRatio(e),this.renderer.setSize(t,n),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputColorSpace=this.parameters.outputColorSpace,this.renderer.useLegacyLights=!0;const i=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(Ie(!0),Ce(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(Ie(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),Ce(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&qi(i.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&qi(36193)),this.wrapper.appendChild(this.renderer.domElement);const s=t*e,o=n*e;De&&console.log(JSON.stringify({Browser:ve,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":qi(i.FLOAT),"testTextureSupport HalfFloat":qi(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:Se},null,2)),this.pickingTarget=new WebGLRenderTarget(s,o,{minFilter:NearestFilter,magFilter:NearestFilter,stencilBuffer:!1,format:RGBAFormat,type:Se?FloatType:UnsignedByteType}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.colorSpace=this.parameters.outputColorSpace,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new WebGLRenderTarget(s,o,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,type:this.supportsHalfFloat?HalfFloatType:Se?FloatType:UnsignedByteType}),this.sampleTarget.texture.colorSpace=this.parameters.outputColorSpace,this.holdTarget=new WebGLRenderTarget(s,o,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:this.supportsHalfFloat?HalfFloatType:Se?FloatType:UnsignedByteType}),this.holdTarget.texture.colorSpace=this.parameters.outputColorSpace,this.compositeUniforms={tForeground:new Uniform(this.sampleTarget.texture),scale:new Uniform(1)},this.compositeMaterial=new ShaderMaterial({uniforms:this.compositeUniforms,vertexShader:pi("Quad.vert"),fragmentShader:pi("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:AdditiveBlending,depthTest:!1,depthWrite:!1}),this.compositeCamera=new OrthographicCamera(-1,1,1,-1,0,1),this.compositeScene=new Scene,this.compositeScene.name="compositeScene",this.compositeScene.add(new Mesh(new PlaneGeometry(2,2),this.compositeMaterial))}_initHelper(){const e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(24),n=new BufferGeometry;n.setIndex(new BufferAttribute(e,1)),n.setAttribute("position",new BufferAttribute(t,3));const i=new ShaderMaterial({uniforms:{uColor:{value:new Color("skyblue")}},vertexShader:pi("BasicLine.vert"),fragmentShader:pi("BasicLine.frag")});this.boundingBoxMesh=new LineSegments(n,i),this.helperGroup.add(this.boundingBoxMesh)}updateHelper(){const e=this.boundingBoxMesh.geometry.attributes.position,t=e.array,{min:n,max:i}=this.boundingBox;t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=n.x,t[4]=i.y,t[5]=i.z,t[6]=n.x,t[7]=n.y,t[8]=i.z,t[9]=i.x,t[10]=n.y,t[11]=i.z,t[12]=i.x,t[13]=i.y,t[14]=n.z,t[15]=n.x,t[16]=i.y,t[17]=n.z,t[18]=n.x,t[19]=n.y,t[20]=n.z,t[21]=i.x,t[22]=n.y,t[23]=n.z,e.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()}get cameraDistance(){return Math.abs(this.camera.position.z)}set cameraDistance(e){this.camera.position.z=-e}add(e,t){t?t.forEach((n=>this.addBuffer(e,n))):this.addBuffer(e),e.group.name="meshGroup",e.wireframeGroup.name="wireframeGroup",e.parameters.background?(this.backgroundGroup.add(e.group),this.backgroundGroup.add(e.wireframeGroup)):(this.modelGroup.add(e.group),this.modelGroup.add(e.wireframeGroup)),e.pickable&&this.pickingGroup.add(e.pickingGroup),De&&this.updateHelper()}addBuffer(e,t){function n(o){o instanceof Group?o.children.forEach(n):(o.userData.buffer=e,o.userData.instance=t,o.onBeforeRender=Zi)}const i=e.getMesh();t&&i.applyMatrix4(t.matrix),n(i),e.group.add(i);const s=e.getWireframeMesh();if(t&&(s.matrix.copy(i.matrix),s.position.copy(i.position),s.quaternion.copy(i.quaternion),s.scale.copy(i.scale)),n(s),e.wireframeGroup.add(s),e.pickable){const o=e.getPickingMesh();t&&(o.matrix.copy(i.matrix),o.position.copy(i.position),o.quaternion.copy(i.quaternion),o.scale.copy(i.scale)),n(o),e.pickingGroup.add(o)}t?this._updateBoundingBox(e.geometry,e.matrix,t.matrix):this._updateBoundingBox(e.geometry,e.matrix)}remove(e){this.translationGroup.children.forEach((function(t){t.remove(e.group),t.remove(e.wireframeGroup)})),e.pickable&&this.pickingGroup.remove(e.pickingGroup),this.updateBoundingBox(),De&&this.updateHelper()}_updateBoundingBox(e,t,n){const i=this.boundingBox;function s(a,l,d){a.boundingBox==null&&a.computeBoundingBox();const u=a.boundingBox.clone();l&&u.applyMatrix4(l),d&&u.applyMatrix4(d),u.min.equals(u.max)&&u.expandByScalar(5),i.union(u)}function o(a){if(a.geometry!==void 0){let l,d;a.userData.buffer&&(l=a.userData.buffer.matrix),a.userData.instance&&(d=a.userData.instance.matrix),s(a.geometry,l,d)}}e?s(e,t,n):(i.makeEmpty(),this.modelGroup.traverse(o),this.backgroundGroup.traverse(o)),i.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()}updateBoundingBox(){this._updateBoundingBox(),De&&this.updateHelper()}getPickingPixels(){const{width:e,height:t}=this,n=e*t*4,i=Se?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,e,t,i),i}getImage(e){return new Promise((t=>{if(e){const{width:n,height:i}=this,s=n*i*4;let o=this.getPickingPixels();if(Se){const u=new Uint8Array(s);for(let g=0;g<s;++g)u[g]=Math.round(255*o[g]);o=u}const a=document.createElement("canvas");a.width=n,a.height=i;const l=a.getContext("2d"),d=l.getImageData(0,0,n,i);d.data.set(o),l.putImageData(d,0,0),a.toBlob(t,"image/png")}else this.renderer.domElement.toBlob(t,"image/png")}))}makeImage(e={}){return $i(this,e)}setLight(e,t,n,i){const s=this.parameters;e!==void 0&&s.lightColor.set(e),t!==void 0&&(s.lightIntensity=t),n!==void 0&&s.ambientColor.set(n),i!==void 0&&(s.ambientIntensity=i),this.requestRender()}setFog(e,t,n){const i=this.parameters;e!==void 0&&i.fogColor.set(e),t!==void 0&&(i.fogNear=t),n!==void 0&&(i.fogFar=n),this.requestRender()}setBackground(e){const t=this.parameters;e&&t.backgroundColor.set(e),this.setFog(t.backgroundColor),this.renderer.setClearColor(t.backgroundColor,0),this.renderer.domElement.style.backgroundColor=t.backgroundColor.getStyle(),this.requestRender()}setSampling(e){e!==void 0&&(this.parameters.sampleLevel=e,this.sampleLevel=e),this.requestRender()}setOutputEncoding(e){this.parameters.outputColorSpace=e,this.renderer.outputColorSpace=e,this.pickingTarget.texture.colorSpace=e,this.sampleTarget.texture.colorSpace=e,this.holdTarget.texture.colorSpace=e}setColorWorkflow(e){if(e!="srgb-linear"&&e!="srgb")throw new Error(`setColorWorkflow: invalid color workflow ${e}`);$t=e=="srgb-linear"?"linear":"sRGB",this.setOutputEncoding(e=="srgb-linear"?"srgb":"srgb-linear"),this.requestRender()}setCamera(e,t,n){const i=this.parameters;if(e&&(i.cameraType=e),t&&(i.cameraFov=t),n&&(i.cameraEyeSep=n),i.cameraType==="orthographic")this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if(i.cameraType!=="perspective"&&i.cameraType!=="stereo")throw new Error(`Unknown cameraType '${i.cameraType}'`);this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=i.cameraFov,this.stereoCamera.eyeSep=i.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()}setClip(e,t,n,i,s){const o=this.parameters;e!==void 0&&(o.clipNear=e),t!==void 0&&(o.clipFar=t),n!==void 0&&(o.clipDist=n),i!==void 0&&(o.clipMode=i),s!==void 0&&(o.clipScale=s),this.requestRender()}setSize(e,t){this.width=e||1,this.height=t||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();const n=window.devicePixelRatio;this.renderer.setPixelRatio(n),this.renderer.setSize(e,t);const i=this.width*n,s=this.height*n;this.pickingTarget.setSize(i,s),this.sampleTarget.setSize(i,s),this.holdTarget.setSize(i,s),this.requestRender()}handleResize(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{const e=this.container.getBoundingClientRect();this.setSize(e.width,e.height)}}updateInfo(e){const{memory:t,render:n}=this.info;if(e)t.programs=0,t.geometries=0,t.textures=0,n.calls=0,n.vertices=0,n.points=0;else{const i=this.renderer.info,s=i.memory,o=i.render;t.geometries=s.geometries,t.textures=s.textures,n.calls+=o.calls,n.faces+=o.triangles,n.points+=o.points}}animate(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&this.sampleLevel!==-1){const e=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=e,De&&ke.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)}pick(e,t){if(this.parameters.cameraType==="stereo")return{pid:0,instance:void 0,picker:void 0};e*=window.devicePixelRatio,t*=window.devicePixelRatio,e=Math.max(e-2,0),t=Math.max(t-2,0);let n,i,s=0;const o=Se?Wi:Xi;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,e,t,5,5,o);for(let a=0;a<Yi.length;a++){const l=4*Yi[a],d=Math.round(o[l+3]),u=this.pickingGroup.getObjectById(d);u&&(n=u.userData.instance,i=u.userData.buffer.picking,s=Se?Math.round(255*o[l])<<16&16711680|Math.round(255*o[l+1])<<8&65280|255&Math.round(255*o[l+2]):o[l]<<16|o[l+1]<<8|o[l+2])}return{pid:s,instance:n,picker:i}}requestRender(){this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame((()=>{this.render(),this.stats.update()})))}updateZoom(){const e=It(this.perspectiveCamera.fov),t=2*Math.tan(e/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/t}absoluteToRelative(e){return 50*(1-e/this.bRadius)}relativeToAbsolute(e){return this.bRadius*(1-e/50)}__updateClipping(){const e=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(e.cameraZ),this.cDist=Math.abs(e.cameraZ));const t=this.scene.fog;if(t.color.set(e.fogColor),e.clipMode==="camera")this.camera.near=e.clipNear,this.camera.far=e.clipFar,t.near=e.fogNear,t.far=e.fogFar;else if(e.clipScale==="absolute")this.camera.near=this.cDist-e.clipNear,this.camera.far=this.cDist+e.clipFar,t.near=this.cDist-e.fogNear,t.far=this.cDist+e.fogFar;else{const n=(50-e.clipNear)/50,i=-(50-e.clipFar)/50;this.camera.near=this.cDist-this.bRadius*n,this.camera.far=this.cDist+this.bRadius*i;const s=(50-e.fogNear)/50,o=-(50-e.fogFar)/50;t.near=this.cDist-this.bRadius*s,t.far=this.cDist+this.bRadius*o}e.clipMode!=="camera"&&(this.camera.type==="PerspectiveCamera"?(this.camera.near=Math.max(.1,e.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),t.near=Math.max(.1,t.near),t.far=Math.max(1,t.far)):this.camera.type==="OrthographicCamera"&&e.clipDist>0&&(this.camera.near=Math.max(e.clipDist,this.camera.near)))}__updateCamera(){const e=this.camera;e.updateMatrix(),e.updateMatrixWorld(!0),e.updateProjectionMatrix(),(function(t,n,i,s,o){let a=new Vector2;i.getSize(a);const l=a.height,d=i.getPixelRatio(),u=n.type==="OrthographicCamera";Ni.set(a.width,a.height),zi.copy(n.projectionMatrix).invert(),Ui.copy(n.projectionMatrix).transpose(),t.traverse((function(g){const x=g.material;if(!x)return;const y=x.uniforms;if(y){if(x.clipNear){const b=(50-x.clipNear)/50,_=s-o*b;y.clipNear.value=_}y.canvasHeight&&(y.canvasHeight.value=l),y.resolution&&y.resolution.value.copy(Ni),y.pixelRatio&&(y.pixelRatio.value=d),y.projectionMatrixInverse&&y.projectionMatrixInverse.value.copy(zi),y.projectionMatrixTranspose&&y.projectionMatrixTranspose.value.copy(Ui),y.ortho&&(y.ortho.value=u)}}))})(this.scene,e,this.renderer,this.cDist,this.bRadius),(function(t,n){t.traverseVisible((function(i){if(!(i instanceof Points&&i.userData.buffer.parameters.sortParticles))return;const s=i.geometry.attributes,o=s.position.count;if(o===0)return;let a,l,d,u,g,x,y,b;Ri.multiplyMatrices(n.matrixWorldInverse,i.matrixWorld),Li.multiplyMatrices(n.projectionMatrix,Ri),i.userData.sortData?(a=i.userData.sortData,d=a.__zArray,l=a.__sortArray,u=a.__cmpFn):(d=new Float32Array(o),l=new Uint32Array(o),u=function(_,h){const f=d[_],E=d[h];return f>E?1:f<E?-1:0},a={__zArray:d,__sortArray:l,__cmpFn:u},i.userData.sortData=a);for(let _=0;_<o;++_)Oi.fromArray(s.position.array,3*_),Oi.applyMatrix4(Li),d[_]=-Oi.z,l[_]=_;(function(_,h,f=0,E){h=h||function(O,L){return O>L?1:O<L?-1:0};const m=[];let S,w,v,A=-1,M=f,T=E=(E||_.length)-1;function R(O,L){const P=_[O];_[O]=_[L],_[L]=P}for(;;)if(T-M<=25){for(let O=M+1;O<=T;++O){for(S=_[O],w=O-1;w>=M&&h(_[w],S)>0;)_[w+1]=_[w],--w;_[w+1]=S}if(A===-1)break;T=m[A--],M=m[A--]}else{for(w=M+1,v=T,R(M+T>>1,w),h(_[M],_[T])>0&&R(M,T),h(_[w],_[T])>0&&R(w,T),h(_[M],_[w])>0&&R(M,w),S=_[w];;){do w++;while(h(_[w],S)<0);do v--;while(h(_[v],S)>0);if(v<w)break;R(w,v)}_[M+1]=_[v],_[v]=S,T-w+1>=v-M?(m[++A]=w,m[++A]=T,T=v-1):(m[++A]=M,m[++A]=v-1,M=w)}})(l,u);for(let _ in s){const h=s[_],f=h.array,E=h.itemSize;a[_]||(a[_]=new Float32Array(E*o)),b=a[_],a[_]=f;for(let m=0;m<o;++m){g=l[m];for(let S=0;S<E;++S)x=g*E+S,y=m*E+S,b[y]=f[x]}s[_].array=b,s[_].needsUpdate=!0}}))})(this.scene,e)}__setVisibility(e,t,n,i){this.modelGroup.visible=e,this.pickingGroup.visible=t,this.backgroundGroup.visible=n,this.helperGroup.visible=i}__updateLights(){this.directionalLight.color.set(this.parameters.lightColor),this.directionalLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.directionalLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity}__renderPickingGroup(e){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderModelGroup(e,t){this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,e),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,De),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderSuperSample(e,t){const n=gi[Math.max(0,Math.min(this.sampleLevel,5))],i=1/n.length;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;let s=this.sampleTarget.width;const o=this.sampleTarget.height;this.parameters.cameraType==="stereo"&&(s/=2);for(let a=0;a<n.length;++a){const l=n[a];e.setViewOffset(s,o,l[0],l[1],s,o),e.updateProjectionMatrix(),Vi(this.scene,e);let d=i;d+=.03125*((a+.5)/n.length-.5),this.compositeUniforms.scale.value=d,this.__renderModelGroup(e,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),a===0&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,e.clearViewOffset(),this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}__renderStereo(e=!1,t){const n=this.stereoCamera;n.update(this.perspectiveCamera);const i=this.renderer;let s=new Vector2;i.getSize(s),i.setScissorTest(!0),i.setScissor(0,0,s.width/2,s.height),i.setViewport(0,0,s.width/2,s.height),Vi(this.scene,n.cameraL),this.__render(e,n.cameraL),i.setScissor(s.width/2,0,s.width/2,s.height),i.setViewport(s.width/2,0,s.width/2,s.height),Vi(this.scene,n.cameraR),this.__render(e,n.cameraR),i.setScissorTest(!1),i.setViewport(0,0,s.width,s.height)}__render(e=!1,t,n){e?this.lastRenderedPicking||this.__renderPickingGroup(t):this.sampleLevel>0&&this.parameters.cameraType!=="stereo"?this.__renderSuperSample(t,n):this.__renderModelGroup(t,n)}render(e=!1,t){if(this.rendering)ke.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),this.parameters.cameraType==="stereo"?this.__renderStereo(e,t):this.__render(e,this.camera,t),this.lastRenderedPicking=e}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}}clear(){ke.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()}dispose(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)}}function ir(r){const e=r.touches[0].pageX-r.touches[1].pageX,t=r.touches[0].pageY-r.touches[1].pageY;return Math.sqrt(e*e+t*t)}class rr{constructor(e,t={}){this.domElement=e,this.signals={moved:new signalsExports.Signal,scrolled:new signalsExports.Signal,dragged:new signalsExports.Signal,dropped:new signalsExports.Signal,clicked:new signalsExports.Signal,hovered:new signalsExports.Signal,doubleClicked:new signalsExports.Signal},this.position=new Vector2,this.prevPosition=new Vector2,this.down=new Vector2,this.canvasPosition=new Vector2,this.prevClickCP=new Vector2,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=nt(t.hoverTimeout,50),this.handleScroll=nt(t.handleScroll,!0),this.doubleClickSpeed=nt(t.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();const n={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,n),document.addEventListener("wheel",this._onMousewheel,n),document.addEventListener("MozMousePixelScroll",this._onMousewheel,n),document.addEventListener("mousemove",this._onMousemove,n),document.addEventListener("mousedown",this._onMousedown,n),document.addEventListener("mouseup",this._onMouseup,n),document.addEventListener("contextmenu",this._onContextmenu,n),document.addEventListener("touchstart",this._onTouchstart,n),document.addEventListener("touchend",this._onTouchend,n),document.addEventListener("touchmove",this._onTouchmove,n)}get key(){let e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e}setParameters(e={}){this.hoverTimeout=nt(e.hoverTimeout,this.hoverTimeout)}_listen(){const e=window.performance.now(),t=this.canvasPosition;this.doubleClickPending&&e-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),e-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,this.hoverTimeout!==-1&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(t.x,t.y))),this.frameRequest=window.requestAnimationFrame(this._listen)}_onMousewheel(e){if(e.target!==this.domElement||!this.handleScroll)return;e.preventDefault(),this._setKeys(e);let t=0;"deltaY"in e&&"deltaMode"in e&&e.deltaY!==void 0&&e.deltaMode!==void 0?t=e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-e.deltaY:e.deltaMode===WheelEvent.DOM_DELTA_LINE?-e.deltaY*(2.5/3):2.5*-e.deltaY:"deltaY"in e&&!("detail"in e)?t=.025*-e.deltaY:e.wheelDelta!==void 0?t=.025*-e.wheelDelta:e.wheelDeltaY!==void 0?t=.025*-e.wheelDeltaY:e.detail!==void 0&&(t=-e.detail/3),this.signals.scrolled.dispatch(t),setTimeout((()=>{this.scrolled=!0}),this.hoverTimeout)}_onMousemove(e){e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(e),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.clientX,e.clientY),this._setCanvasPosition(e);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n)}_onMousedown(e){e.target===this.domElement&&(e.preventDefault(),this._setKeys(e),this.moving=!1,this.hovering=!1,this.down.set(e.clientX,e.clientY),this.position.set(e.clientX,e.clientY),this.which=e.which,this.buttons=(function(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){const n=t.which;if(n===2)return 4;if(n===3)return 2;if(n>0)return 1<<n-1}else if("button"in t){const n=t.button;if(n===1)return 4;if(n===2)return 2;if(n>=0)return 1<<n}}return 0})(e),this.pressed=!0,this._setCanvasPosition(e))}_onMouseup(e){e.target===this.domElement&&e.preventDefault(),this._setKeys(e);const t=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(t)<4&&(this.signals.doubleClicked.dispatch(t.x,t.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(t.x,t.y),this.doubleClickPending=!0,this.prevClickCP.copy(t)),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onContextmenu(e){e.target===this.domElement&&e.preventDefault()}_onTouchstart(e){if(e.target===this.domElement)switch(e.preventDefault(),this.pressed=!0,e.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(e.touches[0].pageX,e.touches[0].pageY),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);break;case 2:this.down.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.lastTouchDistance=ir(e)}}_onTouchend(e){e.target===this.domElement&&e.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onTouchmove(e){switch(e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,e.touches.length){case 1:{this._setKeys(e),this.which=1,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n);break}case 2:{const t=ir(e),n=t-this.lastTouchDistance;if(this.lastTouchDistance=t,this.prevPosition.copy(this.position),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),Math.abs(n)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(n/2);else{this.which=3,this.buttons=2;const i=this.prevPosition.x-this.position.x,s=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(i,s),this.pressed&&this.signals.dragged.dispatch(i,s)}}}}_distance(){return this.position.distanceTo(this.down)}_setCanvasPosition(e){const t=this.domElement.getBoundingClientRect();let n,i;"clientX"in e&&"clientY"in e?(n=e.clientX-t.left,i=e.clientY-t.top):(n=e.offsetX,i=e.offsetY),this.canvasPosition.set(n,t.height-i)}_setKeys(e){this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey,this.shiftKey=e.shiftKey}dispose(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)}}const nr=new Matrix4,sr=new Matrix4,or=new Matrix4,ar=new Matrix4,cr=new Matrix4,lr=new Vector3,hr=new Quaternion,ur=new Quaternion,dr=new Matrix4,mr=new Vector3,fr=new Vector3;class pr{constructor(e,t={}){this.stage=e,this.rotateSpeed=nt(t.rotateSpeed,2),this.zoomSpeed=nt(t.zoomSpeed,1.2),this.panSpeed=nt(t.panSpeed,1),this.viewer=e.viewer,this.mouse=e.mouseObserver,this.controls=e.viewerControls}get component(){return this.stage.transformComponent}get atom(){return this.stage.transformAtom}_setPanVector(e,t,n=0){const i=this.controls.getCanvasScaleFactor(n);mr.set(e,t,0),mr.multiplyScalar(this.panSpeed*i)}_getRotateXY(e,t){return[this.rotateSpeed*-e*.01,this.rotateSpeed*t*.01]}_getCameraRotation(e){return e.extractRotation(this.viewer.camera.matrixWorld),e.multiply(sr.makeRotationY(Math.PI)),e}_transformPanVector(){this.component&&(dr.extractRotation(this.component.transform),dr.premultiply(this.viewer.rotationGroup.matrix),dr.invert(),dr.multiply(this._getCameraRotation(ar)),mr.applyMatrix4(dr))}zoom(e){this.controls.zoom(this.zoomSpeed*e*.02)}pan(e,t){this._setPanVector(e,t),dr.copy(this.viewer.rotationGroup.matrix).invert(),dr.multiply(this._getCameraRotation(ar)),mr.applyMatrix4(dr),this.controls.translate(mr)}panComponent(e,t){this.component&&(this._setPanVector(e,t),this._transformPanVector(),this.component.position.add(mr),this.component.updateMatrix())}panAtom(e,t){this.atom&&this.component&&(this.atom.positionToVector3(fr),fr.add(this.viewer.translationGroup.position),fr.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(e,t,fr.z),this._transformPanVector(),this.atom.positionAdd(mr),this.component.updateRepresentations({position:!0}))}rotate(e,t){const[n,i]=this._getRotateXY(e,t);this._getCameraRotation(ar),lr.set(1,0,0),lr.applyMatrix4(ar),hr.setFromAxisAngle(lr,i),lr.set(0,1,0),lr.applyMatrix4(ar),ur.setFromAxisAngle(lr,n),hr.multiply(ur),ar.makeRotationFromQuaternion(hr),this.controls.applyMatrix(ar)}zRotate(e,t){const n=this.rotateSpeed*((-e+t)/-2)*.01;or.makeRotationZ(n),this.controls.applyMatrix(or)}rotateComponent(e,t){if(!this.component)return;const[n,i]=this._getRotateXY(e,t);this._getCameraRotation(cr),ar.extractRotation(this.component.transform),ar.premultiply(this.viewer.rotationGroup.matrix),ar.invert(),ar.premultiply(cr),lr.set(1,0,0),lr.applyMatrix4(ar),nr.makeRotationAxis(lr,i),lr.set(0,1,0),lr.applyMatrix4(ar),sr.makeRotationAxis(lr,n),nr.multiply(sr),hr.setFromRotationMatrix(nr),this.component.quaternion.premultiply(hr),this.component.quaternion.normalize(),this.component.updateMatrix()}}const gr=new Vector3;class yr{constructor(e,t){this.stage=t,this.pid=e.pid,this.picker=e.picker,this.instance=e.instance,this.stage=t,this.controls=t.viewerControls,this.mouse=t.mouseObserver}get type(){return this.picker.type}get altKey(){return this.mouse.altKey}get ctrlKey(){return this.mouse.ctrlKey}get metaKey(){return this.mouse.metaKey}get shiftKey(){return this.mouse.shiftKey}get canvasPosition(){return this.mouse.canvasPosition}get component(){return this.stage.getComponentsByObject(this.picker.data).list[0]}get object(){return this.picker.getObject(this.pid)}get position(){return this.picker.getPosition(this.pid,this.instance,this.component)}get closestBondAtom(){if(this.type!=="bond"||!this.bond)return;const e=this.bond,t=this.controls,n=this.canvasPosition,i=e.atom1.positionToVector3(),s=e.atom2.positionToVector3();i.applyMatrix4(this.component.matrix),s.applyMatrix4(this.component.matrix);const o=t.getPositionOnCanvas(i),a=t.getPositionOnCanvas(s);return d=o,u=a,(l=n).distanceTo(d)<l.distanceTo(u)?e.atom1:e.atom2;var l,d,u}get closeAtom(){const e=this.canvasPosition,t=this.closestBondAtom;if(!t)return;const n=t.positionToVector3().applyMatrix4(this.component.matrix),i=this.controls.getPositionOnCanvas(n);t.positionToVector3(gr),this.instance&&gr.applyMatrix4(this.instance.matrix),gr.applyMatrix4(this.component.matrix);const s=this.controls.viewer;gr.add(s.translationGroup.position),gr.applyMatrix4(s.rotationGroup.matrix);const o=this.controls.getCanvasScaleFactor(gr.z),a=this.component.getMaxRepresentationRadius(t.index);return e.distanceTo(i)<=a/o?t:void 0}get arrow(){return this._objectIfType("arrow")}get atom(){return this._objectIfType("atom")}get axes(){return this._objectIfType("axes")}get bond(){return this._objectIfType("bond")}get box(){return this._objectIfType("box")}get cone(){return this._objectIfType("cone")}get clash(){return this._objectIfType("clash")}get contact(){return this._objectIfType("contact")}get cylinder(){return this._objectIfType("cylinder")}get distance(){return this._objectIfType("distance")}get ellipsoid(){return this._objectIfType("ellipsoid")}get octahedron(){return this._objectIfType("octahedron")}get point(){return this._objectIfType("point")}get mesh(){return this._objectIfType("mesh")}get slice(){return this._objectIfType("slice")}get sphere(){return this._objectIfType("sphere")}get tetrahedron(){return this._objectIfType("tetrahedron")}get torus(){return this._objectIfType("torus")}get surface(){return this._objectIfType("surface")}get unitcell(){return this._objectIfType("unitcell")}get unknown(){return this._objectIfType("unknown")}get volume(){return this._objectIfType("volume")}get wideline(){return this._objectIfType("wideline")}_objectIfType(e){return this.type===e?this.object:void 0}getLabel(){const e=this.atom||this.closeAtom;let t="nothing";return this.arrow?t=this.arrow.name:e?t=`atom: ${e.qualifiedName()} (${e.structure.name})`:this.axes?t="axes":this.bond?t=`bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`:this.box?t=this.box.name:this.cone?t=this.cone.name:this.clash?t=`clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`:this.contact?t=`${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`:this.cylinder?t=this.cylinder.name:this.distance?t=`distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`:this.ellipsoid?t=this.ellipsoid.name:this.octahedron?t=this.octahedron.name:this.point?t=this.point.name:this.mesh?t=`mesh: ${this.mesh.name||this.mesh.serial} (${this.mesh.shape.name})`:this.slice?t=`slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`:this.sphere?t=this.sphere.name:this.surface?t=`surface: ${this.surface.surface.name}`:this.tetrahedron?t=this.tetrahedron.name:this.torus?t=this.torus.name:this.unitcell?t=`unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`:this.unknown?t="unknown":this.volume?t=`volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`:this.wideline&&(t=this.wideline.name),t}}class br{constructor(e){this.stage=e,this.viewer=e.viewer}pick(e,t){const n=this.viewer.pick(e,t);if(n.picker&&n.picker.type!=="ignore"&&n.pid!==void 0){const i=n.picker.array;if(!(i&&n.pid>=i.length))return new yr(n,this.stage);console.error("pid >= picker.array.length")}}}const _r=new Quaternion,xr=new Vector3,vr=new Vector3,wr=new Vector3,Ar=new Vector3,Sr=new Matrix4,Cr=new Vector3,Pr=new Matrix4;class Ir{constructor(e){this.stage=e,this.signals={changed:new signalsExports.Signal},this.viewer=e.viewer}get position(){return this.viewer.translationGroup.position}get rotation(){return this.viewer.rotationGroup.quaternion}changed(){this.viewer.requestRender(),this.signals.changed.dispatch()}getPositionOnCanvas(e,t){const n=xt(t,Vector2),i=this.viewer;return wr.copy(e).add(i.translationGroup.position).applyMatrix4(i.rotationGroup.matrix).project(i.camera),n.set((wr.x+1)*i.width/2,(wr.y+1)*i.height/2)}getCanvasScaleFactor(e=0){const t=this.viewer.camera;if(t instanceof OrthographicCamera)return 1/t.zoom;{e=Math.abs(e),e+=this.getCameraDistance();const n=It(t.fov);return 2*e*Math.tan(n/2)/this.viewer.height}}getOrientation(e){const t=wt(e);t.copy(this.viewer.rotationGroup.matrix);const n=this.getCameraDistance();return t.scale(Ar.set(n,n,n)),t.setPosition(this.viewer.translationGroup.position),t}orient(e){wt(e).decompose(xr,_r,vr);const t=this.viewer;t.rotationGroup.setRotationFromQuaternion(_r),t.translationGroup.position.copy(xr),t.cameraDistance=vr.z,t.updateZoom(),this.changed()}translate(e){this.viewer.translationGroup.position.add(vt(e)),this.changed()}center(e){this.viewer.translationGroup.position.copy(vt(e)).negate(),this.changed()}zoom(e){this.distance(this.getCameraDistance()*(1-e))}getCameraDistance(){return this.viewer.cameraDistance}distance(e){this.viewer.cameraDistance=Math.max(Math.abs(e),.2),this.viewer.updateZoom(),this.changed()}spin(e,t){Sr.copy(this.viewer.rotationGroup.matrix).invert(),Cr.copy(vt(e)).applyMatrix4(Sr),this.viewer.rotationGroup.rotateOnAxis(Cr,t),this.changed()}rotate(e){this.viewer.rotationGroup.setRotationFromQuaternion(At(e)),this.changed()}align(e){Pr.copy(wt(e)).invert(),this.viewer.rotationGroup.setRotationFromMatrix(Pr),this.changed()}applyMatrix(e){this.viewer.rotationGroup.applyMatrix4(wt(e)),this.changed()}}class kr{constructor(e,t,...n){this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=nt(e,1e3),this.controls=t,this.startTime=window.performance.now(),this._init(...n)}get done(){return this.alpha===1}get paused(){return this._paused}tick(e){if(!this._paused)return this.elapsedDuration=e.currentTime-this.startTime-this.pausedDuration,this.duration===0?this.alpha=1:this.alpha=Et(0,1,this.elapsedDuration/this.duration),this._tick(e),this.done&&this._resolveList.forEach((t=>t())),this.done}pause(e){e&&(this._hold=!0),this.pausedTime===-1&&(this.pausedTime=window.performance.now()),this._paused=!0}resume(e){!e&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)}toggle(){this._paused?this.resume():this.pause()}then(e){let t;return t=this.done?Promise.resolve():new Promise((n=>this._resolveList.push(n))),t.then(e)}}class Mr extends kr{constructor(e,t,...n){super(nt(e,1/0),t,...n)}_init(e,t){Array.isArray(e)?this.axis=new Vector3().fromArray(e):this.axis=nt(e,new Vector3(0,1,0)),this.angle=nt(t,.01)}_tick(e){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*e.lastDuration/16)}}class Tr extends kr{constructor(e,t,...n){super(nt(e,1/0),t,...n),this.angleSum=0,this.direction=1}_init(e,t,n){Array.isArray(e)?this.axis=new Vector3().fromArray(e):this.axis=nt(e,new Vector3(0,1,0)),this.angleStep=nt(t,.01),this.angleEnd=nt(n,.2)}_tick(e){if(!this.axis||!this.angleStep||!this.angleEnd)return;const t=Et(0,1,Math.abs(this.angleSum)/this.angleEnd),n=this.angleStep*this.direction*(1.1-t);this.controls.spin(this.axis,n*e.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}}class Dr extends kr{_init(e,t){this.moveFrom=vt(nt(e,new Vector3)),this.moveTo=vt(nt(t,new Vector3))}_tick(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()}}class Br extends kr{_init(e,t){this.zoomFrom=e,this.zoomTo=t}_tick(){this.controls.distance(Bt(this.zoomFrom,this.zoomTo,this.alpha))}}class Fr extends kr{constructor(){super(...arguments),this._currentRotation=new Quaternion}_init(e,t){this.rotateFrom=At(e),this.rotateTo=At(t),this._currentRotation=new Quaternion}_tick(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)}}class Er extends kr{_init(e,t,n){this.valueFrom=e,this.valueTo=t,this.callback=n}_tick(){this.callback(Bt(this.valueFrom,this.valueTo,this.alpha))}}class $r extends kr{_init(e){this.callback=e}_tick(){this.alpha===1&&this.callback()}}class Or{constructor(e=[]){this._resolveList=[],this._list=e}get done(){return this._list.every((e=>e.done))}then(e){let t;return t=this.done?Promise.resolve():new Promise((n=>{this._resolveList.push(n),this._list.forEach((i=>{i.then((()=>{this._resolveList.forEach((s=>{s()})),this._resolveList.length=0}))}))})),t.then(e)}}class Rr{constructor(e){this.stage=e,this.animationList=[],this.finishedList=[],this.viewer=e.viewer,this.controls=e.viewerControls}get paused(){return this.animationList.every((e=>e.paused))}add(e){return e.duration===0?e.tick(this.viewer.stats):this.animationList.push(e),e}remove(e){const t=this.animationList,n=t.indexOf(e);n>-1&&t.splice(n,1)}run(e){const t=this.finishedList,n=this.animationList,i=n.length;for(let o=0;o<i;++o){const a=n[o];a.tick(e)&&t.push(a)}const s=t.length;if(s){for(let o=0;o<s;++o)this.remove(t[o]);t.length=0}}spin(e,t,n){return this.add(new Mr(n,this.controls,e,t))}rock(e,t,n,i){return this.add(new Tr(i,this.controls,e,t,n))}rotate(e,t){const n=this.viewer.rotationGroup.quaternion.clone();return this.add(new Fr(t,this.controls,n,e))}move(e,t){const n=this.controls.position.clone().negate();return this.add(new Dr(t,this.controls,n,e))}zoom(e,t){const n=this.viewer.camera.position.z;return this.add(new Br(t,this.controls,n,e))}zoomMove(e,t,n){return new Or([this.move(e,n),this.zoom(t,n)])}orient(e,t){const n=new Vector3,i=new Quaternion,s=new Vector3;return wt(e).decompose(n,i,s),new Or([this.move(n.negate(),t),this.rotate(i,t),this.zoom(-s.x,t)])}value(e,t,n,i){return this.add(new Er(i,this.controls,e,t,n))}timeout(e,t){return this.add(new $r(t,this.controls,e))}spinComponent(e,t,n,i){return this.add(new Mr(i,e.controls,t,n))}rockComponent(e,t,n,i,s){return this.add(new Tr(s,e.controls,t,n,i))}moveComponent(e,t,n){const i=e.controls.position.clone().negate();return this.add(new Dr(n,e.controls,i,t))}pause(){this.animationList.forEach((e=>e.pause()))}resume(){this.animationList.forEach((e=>e.resume()))}toggle(){this.paused?this.resume():this.pause()}clear(){this.animationList.length=0}dispose(){this.clear()}}class Lr{constructor(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(let n=0,i=t.length;n<i;++n)this.queue.push(t[n]);this.next()}}run(e){this.fn(e,this.next)}next(){const e=this.queue.shift();e!==void 0?(this.pending=!0,setTimeout((()=>this.run(e)))):this.pending=!1}push(e){this.queue.push(e),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class Nr{constructor(e,t,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:Oe.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:Oe.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new ui,this.queue=new Lr(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=Oe.getSchemes()),this.toBePrepared=!1}init(e){const t=e||{};this.clipNear=nt(t.clipNear,0),this.clipRadius=nt(t.clipRadius,0),this.clipCenter=nt(t.clipCenter,new Vector3),this.flatShaded=nt(t.flatShaded,!1),this.side=nt(t.side,"double"),this.opacity=nt(t.opacity,1),this.depthWrite=nt(t.depthWrite,!0),this.wireframe=nt(t.wireframe,!1),this.setColor(t.color,t),this.colorData=nt(t.colorData,void 0),this.colorScheme=nt(t.colorScheme,"uniform"),this.colorScale=nt(t.colorScale,""),this.colorReverse=nt(t.colorReverse,!1),this.colorValue=nt(t.colorValue,9474192),this.colorDomain=nt(t.colorDomain,void 0),this.colorMode=nt(t.colorMode,"hcl"),this.visible=nt(t.visible,!0),this.quality=nt(t.quality,void 0),this.roughness=nt(t.roughness,.4),this.metalness=nt(t.metalness,0),this.diffuse=nt(t.diffuse,16777215),this.diffuseInterior=nt(t.diffuseInterior,!1),this.useInteriorColor=nt(t.useInteriorColor,!1),this.interiorColor=nt(t.interiorColor,2236962),this.interiorDarkening=nt(t.interiorDarkening,0),this.lazy=nt(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=nt(t.matrix,new Matrix4),this.disablePicking=nt(t.disablePicking,!1);const n=this.parameters;n.sphereDetail===!0&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),n.radialSegments===!0&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),n.openEnded===!0&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),n.disableImpostor===!0&&(n.disableImpostor={type:"boolean",rebuild:!0}),t.quality==="low"?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):t.quality==="medium"?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):t.quality==="high"?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=nt(t.sphereDetail,1)),n.radialSegments&&(this.radialSegments=nt(t.radialSegments,10))),n.openEnded&&(this.openEnded=nt(t.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=nt(t.disableImpostor,!1))}getColorParams(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)}getBufferParams(e={}){return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)}setColor(e,t){const n=Object.keys(Oe.getSchemes());if(typeof e=="string"&&n.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(e!==void 0){let i=new Color(e).getHex();t?(t.colorScheme="uniform",t.colorValue=i):this.setParameters({colorScheme:"uniform",colorValue:i})}return this}prepare(e){}create(){}update(e){this.build()}build(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0}make(e,t){De&&ke.time("Representation.make "+this.type);const n=()=>{e?(this.update(e),this.viewer.requestRender(),this.tasks.decrement(),t&&t()):(this.clear(),this.create(),this.manualAttach||this.disposed||(De&&ke.time("Representation.attach "+this.type),this.attach((()=>{De&&ke.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),t&&t()})))),De&&ke.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(n):n()}attach(e){this.setVisibility(this.visible),e()}setVisibility(e,t){if(this.visible=e,this.visible&&this.opacity){const n=this.lazyProps,i=n.bufferParams,s=n.what;if(n.build)return n.build=!1,this.build(),this;(Object.keys(i).length||Object.keys(s).length)&&(n.bufferParams={},n.what={},this.updateParameters(i,s))}return this.bufferList.forEach((function(n){n.setVisibility(e)})),t||this.viewer.requestRender(),this}setParameters(e,t={},n=!1){const i=e||{},s=this.parameters,o={};this.opacity||i.opacity===void 0||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(o,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(i.color,i);for(let a in i)i[a]!==void 0&&s[a]!=null&&(s[a].int&&(i[a]=parseInt(i[a])),s[a].float&&(i[a]=parseFloat(i[a])),i[a]!==this[a]||i[a].equals&&!i[a].equals(this[a]))&&(this[a]&&this[a].copy&&i[a].copy?this[a].copy(i[a]):this[a]&&this[a].set?this[a].set(i[a]):this[a]=i[a],s[a].buffer&&(s[a].buffer===!0?o[a]=i[a]:o[s[a].buffer]=i[a]),s[a].update&&(t[s[a].update]=!0),!s[a].rebuild||s[a].rebuild==="impostor"&&Pe&&!this.disableImpostor||(n=!0));return n?this.build():this.updateParameters(o,t),this}updateParameters(e={},t){if(this.lazy&&(!this.visible||!this.opacity)&&e.hasOwnProperty("opacity")===!1)return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach((function(n){n.setParameters(e)})),Object.keys(t).length&&this.update(t),this.viewer.requestRender()}getParameters(){const e={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach((t=>{this.parameters[t]!==null&&(e[t]=this[t])})),e}clear(){this.bufferList.forEach((e=>{this.viewer.remove(e),e.dispose()})),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class zr{constructor(e){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=e,this.blobUrl=window.URL.createObjectURL($e.get(e)),this.worker=new Worker(this.blobUrl),$e.activeWorkerCount+=1,this.worker.onmessage=t=>{this.pending-=1;const n=t.data.__postId;De&&ke.timeEnd("Worker.postMessage "+e+" #"+n);const i=this.onmessageDict[n];i&&i.call(this.worker,t),delete this.onmessageDict[n],delete this.onerrorDict[n]},this.worker.onerror=t=>{if(this.pending-=1,t.data){const n=t.data.__postId,i=this.onerrorDict[n];i?i.call(this.worker,t):ke.error("Worker.onerror",n,e,t),delete this.onmessageDict[n],delete this.onerrorDict[n]}else ke.error("Worker.onerror",e,t)}}post(e={},t,n,i){this.onmessageDict[this.postCount]=n,this.onerrorDict[this.postCount]=i,e.__name=this.name,e.__postId=this.postCount,e.__debug=De,De&&ke.time(`Worker.postMessage ${this.name} #${this.postCount}`);try{this.worker.postMessage(e,t)}catch(s){ke.error("worker.post:",s),this.worker.postMessage(e)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),$e.activeWorkerCount-=1):ke.log("no worker to terminate")}}class Ur{constructor(e,t=2){this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e}post(e={},t,n,i){const s=this.getNextWorker();return s?s.post(e,t,n,i):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach((function(e){e.terminate()}))}getNextWorker(){let e,t=1/0;for(let n=0;n<this.maxCount;++n){if(n>=this.count){e=new zr(this.name),this.pool.push(e),this.count+=1;break}const i=this.pool[n];if(i.pending===0){e=i;break}i.pending<t&&(t=i.pending,e=i)}return e}}function Vr(r){const e=r.length,t=e/3;let n=0,i=0,s=0;for(let o=0;o<e;o+=3)n+=r[o+0],i+=r[o+1],s+=r[o+2];return new Vector3(n/t,i/t,s/t)}function jr(r,e,t){return t?r.sub(t).projectOnVector(e).add(t):r.projectOnVector(e),r}function Gr(r){let e=1/0,t=1/0,n=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=r.length;a<l;a+=3){const d=r[a],u=r[a+1],g=r[a+2];d<e&&(e=d),u<t&&(t=u),g<n&&(n=g),d>i&&(i=d),u>s&&(s=u),g>o&&(o=g)}return[Xr([e,t,n]),Xr([i,s,o])]}function Hr(r,e){for(let t=0,n=e.length;t<n;t+=3){const i=e[t],s=e[t+1],o=e[t+2];e[t]=r[0]*i+r[4]*s+r[8]*o+r[12],e[t+1]=r[1]*i+r[5]*s+r[9]*o+r[13],e[t+2]=r[2]*i+r[6]*s+r[10]*o+r[14]}}function qr(r,e){for(let t=0,n=e.length;t<n;t+=3){const i=e[t],s=e[t+1],o=e[t+2];e[t]=r[0]*i+r[3]*s+r[6]*o,e[t+1]=r[1]*i+r[4]*s+r[7]*o,e[t+2]=r[2]*i+r[5]*s+r[8]*o}}function Wr(r){for(let e=0,t=r.length;e<t;e+=3){const n=r[e],i=r[e+1],s=r[e+2],o=n*n+i*i+s*s;if(o>0){const a=1/Math.sqrt(o);r[e]=n*a,r[e+1]=i*a,r[e+2]=s*a}}}function Xr(r){return new Float32Array(r||3)}function Yr(r,e,t){const n=e[0],i=e[1],s=e[2],o=t[0],a=t[1],l=t[2];r[0]=i*l-s*a,r[1]=s*o-n*l,r[2]=n*a-i*o}function Kr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Zr(r,e,t){r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2]}function Qr(r,e,t){r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2]}function Jr(r,e,t=0){r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2]}function tn(r,e,t=0){e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2]}function en(r){return r[0]*r[0]+r[1]*r[1]+r[2]*r[2]}function rn(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])}function nn(r,e,t){sn(r,e,1/t)}function sn(r,e,t){r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t}function on(r,e){const t=en(e);t==0?(r[0]=e[0],r[1]=e[1],r[2]=e[2]):sn(r,e,1/Math.sqrt(t))}function an(r,e,t){r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t}function cn(r,e,t){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function ln(r,e){r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2])}function hn(r,e){r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2])}function un(r,e){r[0]=-e[0],r[1]=-e[1],r[2]=-e[2]}function dn(r,e){const t=r[0],n=r[1],i=r[2],s=e[0],o=e[1],a=e[2],l=n*a-i*o,d=i*s-t*a,u=t*o-n*s,g=Math.sqrt(l*l+d*d+u*u),x=t*s+n*o+i*a;return Math.atan2(g,x)}function mn(r,e=9){const t=Math.floor(e/2),n=r.position1.length/3,i=3*(t*n),s=1/e,o=wi(r.position1,r.position2),a=new Float32Array(i),l=new Float32Array(i),d=new Vector3;for(let y=0;y<n;++y){const b=3*y;d.set(o[b],o[b+1],o[b+2]);const _=r.position1[b],h=r.position1[b+1],f=r.position1[b+2];for(let E=0;E<t;++E){const m=t*b+3*E,S=s*(2*E+1),w=s*(2*E+2);a[m]=_+d.x*S,a[m+1]=h+d.y*S,a[m+2]=f+d.z*S,l[m]=_+d.x*w,l[m+1]=h+d.y*w,l[m+2]=f+d.z*w}}const u=vi(a,l),g=(function(y,b){const _=y.length/3,h=new Float32Array(_*b*3);for(let f=0;f<_;++f){const E=3*f,m=f*b*3,S=y[E+0],w=y[E+1],v=y[E+2];for(let A=0;A<b;++A){const M=m+3*A;h[M+0]=S,h[M+1]=w,h[M+2]=v}}return h})(r.color,t),x={position:u,position1:a,position2:l,color:g,color2:g};return r.radius&&(x.radius=Ii(r.radius,t)),r.picking&&r.picking.array&&(r.picking.array=Ii(r.picking.array,t),x.picking=r.picking),r.primitiveId&&(x.primitiveId=Ii(r.primitiveId,t)),x}function fn(r,e=.1){const t=wi(r.position1,r.position2),n=[],i=[],s=[],o=r.radius?[]:void 0,a=r.picking?[]:void 0,l=r.primitiveId?[]:void 0,d=new Vector3,u=r.position1.length/3;let g=0;for(let f=0;f<u;++f){const E=3*f;d.set(t[E],t[E+1],t[E+2]);const m=d.length()/e,S=Math.floor(m/2),w=1/m,v=r.position1[E],A=r.position1[E+1],M=r.position1[E+2];for(let T=0;T<S;++T){const R=3*g+3*T,O=w*(2*T+1),L=w*(2*T+2);n[R]=v+d.x*O,n[R+1]=A+d.y*O,n[R+2]=M+d.z*O,i[R]=v+d.x*L,i[R+1]=A+d.y*L,i[R+2]=M+d.z*L,r.color&&(s[R]=r.color[E],s[R+1]=r.color[E+1],s[R+2]=r.color[E+2]),o&&(o[g+T]=r.radius[f]),a&&(r.picking.array?a[g+T]=r.picking.array[f]:a[g+T]=f),l&&(l[g+T]=r.primitiveId[f])}g+=S}const x=new Float32Array(n),y=new Float32Array(i),b=vi(x,y),_=new Float32Array(s),h={position:b,position1:x,position2:y,color:_,color2:_};return o&&(h.radius=new Float32Array(o)),a&&r.picking&&(r.picking.array=new Float32Array(a),h.picking=r.picking),l&&(h.primitiveId=new Float32Array(l)),h}function pn(r,e=.1){const t=wi(r.position1,r.position2),n=[],i=[],s=[],o=r.radius?[]:void 0,a=r.picking?[]:void 0,l=r.primitiveId?[]:void 0,d=new Vector3,u=r.position1.length/3;let g=e,x=!0,y=0,b=0,_=0;for(let w=0;w<u;++w){const v=3*w,A=r.position1[v],M=r.position1[v+1],T=r.position1[v+2];d.set(t[v],t[v+1],t[v+2]);const R=d.length();x&&(n[b]=A,n[b+1]=M,n[b+2]=T);let O=g;const L=1/R;for(;O<R;){const P=x?i:n;P[b]=A+d.x*O*L,P[b+1]=M+d.y*O*L,P[b+2]=T+d.z*O*L,x&&(y++,b=3*y),x=!x,g=e,O+=e}x&&(i[b]=r.position2[v],i[b+1]=r.position2[v+1],i[b+2]=r.position2[v+2],y++,b=3*y),g=O-R;for(let P=_;P<y;P++){if(r.color){const I=3*P;s[I]=r.color[v],s[I+1]=r.color[v+1],s[I+2]=r.color[v+2]}o&&(o[P]=r.radius[w]),a&&(r.picking.array?a[P]=r.picking.array[w]:a[P]=w),l&&(l[P]=r.primitiveId[w])}_=y}if(!x&&u>0){const w=3*y;i[w]=r.position2[3*u-3],i[w+1]=r.position2[3*u-2],i[w+1]=r.position2[3*u-1]}const h=new Float32Array(n),f=new Float32Array(i),E=vi(h,f),m=new Float32Array(s),S={position:E,position1:h,position2:f,color:m,color2:m};return o&&(S.radius=new Float32Array(o)),a&&r.picking&&(r.picking.array=new Float32Array(a),S.picking=r.picking),l&&(S.primitiveId=new Float32Array(l)),S}Ur.prototype.constructor=Ur,Gr.__deps=[Xr],nn.__deps=[sn],on.__deps=[sn,en];const gn=new Vector3;class yn{static get Picker(){return Ge.get(this.type)}static get Buffer(){return je.get(this.type)}static getShapeKey(e){return this.type+e[0].toUpperCase()+e.substr(1)}static expandBoundingBox(e,t){}static valueToShape(e,t,n){const i=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":(function(s,o){s.toArray!==void 0?s=s.toArray():s.x!==void 0?s=[s.x,s.y,s.z]:s.r!==void 0&&(s=[s.r,s.g,s.b]),o.push.apply(o,s)})(n,i);break;default:i.push(n)}}static objectToShape(e,t){Object.keys(this.fields).forEach((n=>{this.valueToShape(e,n,t[n])})),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)}static valueFromShape(e,t,n){const i=e._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return new Vector3().fromArray(i,3*t);case"c":return new Color().fromArray(i,3*t);default:return i[t]}}static objectFromShape(e,t){let n=this.valueFromShape(e,t,"name");n===void 0&&(n=`${this.type}: ${t} (${e.name})`);const i={shape:e,name:n};return Object.keys(this.fields).forEach((s=>{i[s]=this.valueFromShape(e,t,s)})),i}static arrayFromShape(e,t){const n=e._primitiveData[this.getShapeKey(t)];return this.fields[t]==="s"?n:new Float32Array(n)}static dataFromShape(e){const t={};return this.Picker&&(t.picking=new this.Picker(e)),Object.keys(this.fields).forEach((n=>{t[n]=this.arrayFromShape(e,n)})),t}static bufferFromShape(e,t){return new this.Buffer(this.dataFromShape(e),t)}}yn.type="",yn.fields={};class bn extends yn{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position))}}bn.type="sphere",bn.fields={position:"v3",color:"c",radius:"f"};class _n extends yn{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position))}}_n.type="box",_n.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class xn extends _n{}xn.type="octahedron";class vn extends _n{}vn.type="tetrahedron";class wn extends yn{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position1)),e.expandByPoint(gn.fromArray(t.position2))}static bufferFromShape(e,t={}){let n=this.dataFromShape(e);return this.type==="cylinder"&&t.dashedCylinder&&(n=fn(n)),new this.Buffer(n,t)}}wn.type="cylinder",wn.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class An extends wn{}An.type="arrow";class Sn extends wn{}Sn.type="cone";class Cn extends bn{}Cn.type="ellipsoid",Cn.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class Pn extends Cn{}Pn.type="torus";class In extends yn{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position))}}In.type="text",In.fields={position:"v3",color:"c",size:"f",text:"s"};class kn extends yn{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position))}}kn.type="point",kn.fields={position:"v3",color:"c"};class Mn extends yn{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position1)),e.expandByPoint(gn.fromArray(t.position2))}}Mn.type="wideline",Mn.fields={position1:"v3",position2:"v3",color:"c"};class Tn{constructor(e,t){this.exp=3;const n=t||(function(h){const{x:f,y:E,z:m}=h,S=new Box3,w=f.length,{min:v,max:A}=S;for(let M=0;M<w;M++)v.x=Math.min(f[M],v.x),v.y=Math.min(E[M],v.y),v.z=Math.min(m[M],v.z),A.x=Math.max(f[M],A.x),A.y=Math.max(E[M],A.y),A.z=Math.max(m[M],A.z);return S})(e);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);const i=this.boundX*this.boundY*this.boundZ,s=e.count!==void 0?e.count:e.x.length,o=e.x,a=e.y,l=e.z;let d=0;const u=new Uint32Array(i),g=new Int32Array(s);for(let h=0;h<s;++h){const f=o[h]-this.minX>>this.exp,E=a[h]-this.minY>>this.exp,m=l[h]-this.minZ>>this.exp,S=(f*this.boundY+E)*this.boundZ+m;(u[S]+=1)===1&&(d+=1),g[h]=S}const x=new Uint16Array(d);for(let h=0,f=0;h<i;++h){const E=u[h];E>0&&(u[h]=f+1,x[f]=E,f+=1)}const y=new Uint32Array(d);for(let h=1;h<d;++h)y[h]+=y[h-1]+x[h-1];const b=new Uint16Array(d),_=new Int32Array(s);for(let h=0;h<s;++h){const f=u[g[h]];if(f>0){const E=f-1;_[y[E]+b[E]]=h,b[E]+=1}}this.grid=u,this.bucketCount=x,this.bucketOffset=y,this.bucketArray=_,this.xArray=o,this.yArray=a,this.zArray=l}within(e,t,n,i){const s=[];return this.eachWithin(e,t,n,i,(o=>s.push(o))),s}eachWithin(e,t,n,i,s){const o=i*i,a=Math.max(0,e-i-this.minX>>this.exp),l=Math.max(0,t-i-this.minY>>this.exp),d=Math.max(0,n-i-this.minZ>>this.exp),u=Math.min(this.boundX,1+(e+i-this.minX>>this.exp)),g=Math.min(this.boundY,1+(t+i-this.minY>>this.exp)),x=Math.min(this.boundZ,1+(n+i-this.minZ>>this.exp));for(let y=a;y<u;++y)for(let b=l;b<g;++b)for(let _=d;_<x;++_){const h=(y*this.boundY+b)*this.boundZ+_,f=this.grid[h];if(f>0){const E=f-1,m=this.bucketOffset[E],S=m+this.bucketCount[E];for(let w=m;w<S;++w){const v=this.bucketArray[w],A=this.xArray[v]-e,M=this.yArray[v]-t,T=this.zArray[v]-n,R=A*A+M*M+T*T;R<=o&&s(v,R)}}}}}class Dn{constructor(e=0){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(e){this.length=e,this.count=0;for(let t=0,n=this._fields.length;t<n;++t){const[i,s,o]=this._fields[t];this._initField(i,s,o)}}_initField(e,t,n){this[e]=yt(n,this.length*t)}addField(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let t=0,n=this._fields.length;t<n;++t){const i=this._fields[t][0],s=this._fields[t][1],o=this.length*s,a=new this[i].constructor(o);this[i].length>o?a.set(this[i].subarray(0,o)):a.set(this[i]),this[i]=a}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}copyFrom(e,t,n,i){for(let s=0,o=this._fields.length;s<o;++s){const a=this._fields[s][0],l=this._fields[s][1],d=this[a],u=e[a];for(let g=0;g<i;++g){const x=l*(t+g),y=l*(n+g);for(let b=0;b<l;++b)d[x+b]=u[y+b]}}}copyWithin(e,t,n){for(let i=0,s=this._fields.length;i<s;++i){const o=this._fields[i][0],a=this._fields[i][1],l=this[o];for(let d=0;d<n;++d){const u=a*(e+d),g=a*(t+d);for(let x=0;x<a;++x)l[u+x]=l[g+x]}}}sort(e){ke.time("Store.sort");const t=this,n=new this.constructor(1);(function i(s,o){if(s<o){let d=Math.floor((s+o)/2),u=s,g=o;do{for(;e(u,d)<0;)u+=1;for(;e(g,d)>0;)g-=1;u<=g&&(u===d?d=g:g===d&&(d=u),(a=u)!==(l=g)&&(n.copyFrom(t,0,a,1),t.copyWithin(a,l,1),t.copyFrom(n,l,0,1)),u+=1,g-=1)}while(u<=g);i(s,g),i(u,o)}var a,l})(0,this.count-1),ke.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]}}class Bn extends Dn{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(e,t,n){this.growIfFull();const i=this.count;e<t?(this.index1[i]=e,this.index2[i]=t):(this.index2[i]=e,this.index1[i]=t),n&&(this.type[i]=n),this.count+=1}}function Fn(r){return 16843009*((r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)>>>24}class En{constructor(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),t===!0&&this.setAll()}get(e){return!!(this._words[e>>>5]&1<<e)}set(e){this._words[e>>>5]|=1<<e}clear(e){this._words[e>>>5]&=~(1<<e)}flip(e){this._words[e>>>5]^=1<<e}_assignRange(e,t,n){if(t<e)return;const i=this._words,s=n===!0?4294967295:0,o=e>>>5,a=t>>>5;for(let u=o+1;u<a;++u)i[u]=s;const l=o<<5,d=a<<5;if(n===!0)if(t-e<32)for(let u=e,g=t+1;u<g;++u)i[u>>>5]|=1<<u;else{for(let u=e,g=l+32;u<g;++u)i[u>>>5]|=1<<u;for(let u=d,g=t+1;u<g;++u)i[u>>>5]|=1<<u}else if(t-e<32)for(let u=e,g=t+1;u<g;++u)i[u>>>5]&=~(1<<u);else{for(let u=e,g=l+32;u<g;++u)i[u>>>5]&=~(1<<u);for(let u=d,g=t+1;u<g;++u)i[u>>>5]&=~(1<<u)}return this}setRange(e,t){return this._assignRange(e,t,!0)}clearRange(e,t){return this._assignRange(e,t,!1)}setBits(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const s=e[i];t[s>>>5]|=1<<s}return this}clearBits(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const s=e[i];t[s>>>5]&=~(1<<s)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const e=this._words.length,t=this._words,n=32-this.length%32;for(let i=0;i<e-1;++i)t[i]=~t[i];return t[e-1]=~(t[e-1]<<n)>>>n,this}_isRangeValue(e,t,n){if(t<e)return;const i=this._words,s=n===!0?4294967295:0,o=e>>>5,a=t>>>5;for(let l=o+1;l<a;++l)if(i[l]!==s)return!1;if(t-e<32){for(let l=e,d=t+1;l<d;++l)if(!!(i[l>>>5]&1<<l)!==n)return!1}else{const l=a<<5;for(let d=e,u=(o<<5)+32;d<u;++d)if(!!(i[d>>>5]&1<<d)!==n)return!1;for(let d=l,u=t+1;d<u;++d)if(!!(i[d>>>5]&1<<d)!==n)return!1}return!0}isRangeSet(e,t){return this._isRangeValue(e,t,!0)}isRangeClear(e,t){return this._isRangeValue(e,t,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const s=e[i];if(!(t[s>>>5]&1<<s))return!1}return!0}isClear(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const s=e[i];if(t[s>>>5]&1<<s)return!1}return!0}isEqualTo(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)if(t[s]!==n[s])return!1;return!0}getSize(){const e=this._words.length,t=this._words;let n=0;for(let i=0;i<e;++i)n+=Fn(t[i]);return n}difference(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)t[s]=t[s]&~n[s];for(let s=t.length;s<i;++s)t[s]=0;return this}union(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)t[s]|=n[s];for(let s=t.length;s<i;++s)t[s]=0;return this}intersection(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)t[s]&=n[s];for(let s=t.length;s<i;++s)t[s]=0;return this}intersects(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)if(t[s]&n[s])return!0;return!1}getIntersectionSize(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);let s=0;for(let o=0;o<i;++o)s+=Fn(t[o]&n[o]);return s}makeIntersection(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length),s=new Uint32Array(i),o=Object.create(En.prototype);o._words=s,o.length=Math.min(this.length,e.length);for(let a=0;a<i;++a)s[a]=t[a]&n[a];return o}forEach(e){const t=this._words.length,n=this._words;let i=0;for(let s=0;s<t;++s){let o=n[s];for(;o!==0;){const a=o&-o;e((s<<5)+Fn(a-1),i),o^=a,++i}}}toArray(){const e=this._words,t=new Array(this.getSize()),n=this._words.length;let i=0;for(let s=0;s<n;++s){let o=e[s];for(;o!==0;){const a=o&-o;t[i++]=(s<<5)+Fn(a-1),o^=a}}return t}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(En.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e}}function $n(r){const{edgeCount:e,nodeCount:t,nodeArray1:n,nodeArray2:i}=r,s=new Uint8Array(t),o=new Int32Array(t);for(let d=0;d<e;++d)s[n[d]]+=1,s[i[d]]+=1;for(let d=1;d<t;++d)o[d]+=o[d-1]+s[d-1];const a=2*e,l=new Int32Array(a);for(let d=0;d<a;++d)l[d]=-1;for(let d=0;d<e;++d){const u=n[d],g=i[d];let x=o[u];for(;l[x]!==-1&&x<a;)x+=1;l[x]=d;let y=o[g];for(;l[y]!==-1&&y<a;)y+=1;l[y]=d}return{countArray:s,offsetArray:o,indexArray:l}}function On(r=0,e=0){return{type:r,group:e,x:0,y:0,z:0,atomSet:[]}}function Rn(r,e){r.x+=e.x,r.y+=e.y,r.z+=e.z,r.atomSet.push(e.index)}function Ln(r,e){const t=e.atomSet.length;if(t>0){const{types:n,groups:i,centers:s,atomSets:o}=r;n.push(e.type),i.push(e.group),s.x.push(e.x/t),s.y.push(e.y/t),s.z.push(e.z/t),o.push(e.atomSet)}}const Nn=0,zn=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],Un=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],Vn=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],jn=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],Gn=["NON-POLYMER"].concat(["OTHER"],jn),Hn=["h","g","i"],qn=["e","b"],Wn=["s","t","l",""],Xn={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},Yn={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},Kn={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},Zn={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},Qn={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},Jn={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},ts=[0,0,0],es={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},is=Object.keys(es),rs=["A","C","T","G","U","I"],ns=["DA","DC","DT","DG","DU","DI"],ss=["A","G","I","DA","DG","DI"],os=rs.concat(ns),as=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],cs=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],ls=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],hs=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],us=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],ds={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]}};ds[Nn]={};const ms={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function fs(r){switch(r){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const ps=new Map([[2,It(180)],[3,It(120)],[4,It(109.4721)],[6,It(90)]]);function gs(r,e){let t=[];const n=new Vector3,i=new Vector3;return n.subVectors(e,r),r.eachBondedAtom((s=>{s.number!==1&&(i.subVectors(s,r),t.push(n.angleTo(i)))})),t}function ys(r,e){const t=r.clone(),n=new Vector3;n.subVectors(e,r);const i=[new Vector3,new Vector3];let s=0;if(r.eachBondedAtom((a=>{s>1||a.number!==1&&(t.index=a.index,i[s++].subVectors(a,r))})),s===1&&t.eachBondedAtom((a=>{s>1||a.number!==1&&a.index!==r.index&&i[s++].subVectors(a,r)})),s!==2)return;const o=i[0].cross(i[1]);return Math.abs(Math.PI/2-o.angleTo(n))}function bs(r,e){const t=r.structure,n=t.atomCount,i=new Int8Array(n),s=new Int8Array(n),o=new Int8Array(n),a=new Int8Array(n);return t.eachAtom((l=>{const d=l.index,[u,g,x,y]=(function(b,_){const h=b.bondToElementCount(1);let f=b.formalCharge||0;const E=f===0,m=h===0,S=b.bondCount,w=(function(R){let O=0;return R.eachBond((L=>O+=L.bondOrder)),O})(b),v=(function(R){const O=R.structure.getBondProxy(),L=R.number,P=L===8||L===7;if(P&&R.bondCount===4)return!1;let I=!1;return R.eachBond((N=>{if(N.bondOrder>1)I=!0;else if(P){const U=N.getOtherAtom(R);U.eachBond((F=>{if(F.bondOrder>1){const k=U.number;if((k===15||k===16)&&F.getOtherAtom(U).number===8)return;I=!0}}),O)}})),I})(b),A=w-S>0;let M=0,T=8;switch(b.number){case 1:E&&(S===0?(f=1,T=0):S===1&&(f=0,T=1));break;case 6:E&&(f=0),m&&(M=Math.max(0,4-w-Math.abs(f))),T=fs(S+M+Math.max(0,-f));break;case 7:if(E)if(m)if(v&&w<4)f=S-h==1&&w-h==2?1:0;else{let R=!1;b.eachBondedAtom((O=>{(O.number===16||O.isMetal())&&(R=!0)})),f=R?0:1}else f=w-3;m&&(M=Math.max(0,3-w+f)),T=fs(v&&!A?S+M-f:S+M+1-f);break;case 8:E&&(m||(f=w-2),w===1&&b.eachBondedAtom((R=>{R.eachBond((O=>{const L=O.getOtherAtom(R);L.index!==b.index&&L.number===8&&O.bondOrder===2&&(f=-1)}))}))),m&&(M=Math.max(0,2-w+f)),T=fs(v&&!A?S+M-f+1:S+M-f+2);break;case 16:E&&(m||(f=w<=3&&!b.bondToElementCount(8)?w-2:0)),m&&w<2&&(M=Math.max(0,2-w+f)),w<=3&&(T=fs(S+M-f+2));break;case 9:case 17:case 35:case 53:case 85:E&&(f=w-1);break;case 3:case 11:case 19:case 37:case 55:case 87:E&&(f=1-w);break;case 4:case 12:case 20:case 38:case 56:case 88:E&&(f=2-w);break;default:console.warn("Requested charge, protonation for an unhandled element",b.element)}return[f,M,M+h,T]})(l);i[d]=u,s[d]=g,o[d]=x,a[d]=y})),{charge:i,implicitH:s,totalH:o,idealGeometry:a}}function _s(r){if(r["@valenceModel"])return r["@valenceModel"];const e=bs(r);return r["@valenceModel"]=e,e}function xs(r){return r.number===15&&r.bondToElementCount(8)===r.bondCount}const vs=["ARG","HIS","LYS"],ws=["GLU","ASP"];function As(r,e){return r===2&&e===1||r===1&&e===2}function Ss(r,e){return r===3&&e===3}function Cs(r,e){return r===3&&e===1||r===1&&e===3}function Ps(r){return r.resname==="HIS"&&r.number==7&&r.isRing()}function Is(r,e){return r===5&&e===4||r===4&&e===5}function ks(r,e){return r===9&&e===5||r===5&&e===9}const Ms=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function Ts(r,e){return r===12?e===11||e===12:r===13?e===10:void 0}const Ds=[17,35,53,85],Bs=[7,8,16],Fs=[6,7,15,16],Es=It(180),$s=It(120);function Os(r,e,t){return!Ls(r,e,t)&&(r.modelIndex!==e.modelIndex||r.altloc&&e.altloc&&r.altloc!==e.altloc)}const Rs={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function Ls(r,e,t){return r.modelIndex===t&&e.modelIndex!==t||e.modelIndex===t&&r.modelIndex!==t}function Ns(r,e,t){return!Ls(r,e,t)&&(r.modelIndex!==e.modelIndex||r.residueIndex===e.residueIndex||r.altloc&&e.altloc&&r.altloc!==e.altloc)}function zs(r){const e={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return De&&ke.time("calculateFeatures"),(function(t,n){const{charge:i}=_s(t.data),s={};t.eachResidue((o=>{if(vs.includes(o.resname)){const a=On(1);o.eachAtom((l=>{l.number===7&&l.isSidechain()&&Rn(a,l)})),Ln(n,a)}else is.includes(o.resname)||o.isNucleic()||(o.eachAtom((a=>{let l=!1;const d=On(1);(function(u){let g=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===3&&u.eachBondedAtom((x=>{x.bondCount-x.bondToElementCount(1)==1&&++g})),g===2})(a)?(d.group=8,l=!0):(function(u){let g=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom((x=>{x.bondCount-x.bondToElementCount(1)==1&&++g})),g===2})(a)&&(d.group=9,l=!0),l&&(a.eachBondedAtom((u=>{u.number===7&&(s[u.index]=!0,Rn(d,u))})),Ln(n,d))})),o.eachAtom((a=>{const l=On(1);i[a.index]>0&&(s[a.index]||(Rn(l,a),Ln(n,l)))})))}))})(r,e),(function(t,n){const{charge:i}=_s(t.data),s={};t.eachResidue((o=>{if(ws.includes(o.resname)){const a=On(2);o.eachAtom((l=>{l.number===8&&l.isSidechain()&&Rn(a,l)})),Ln(n,a)}else if(os.includes(o.resname)){const a=On(2);o.eachAtom((l=>{xs(l)&&(a.group=6,l.eachBondedAtom((d=>{d.number===8&&Rn(a,d)})),Ln(n,a))}))}else is.includes(o.resname)||os.includes(o.resname)||(o.eachAtom((a=>{let l=!1;const d=On(2);(function(u){return u.number===16&&u.bondToElementCount(8)===3})(a)?(d.group=4,l=!0):xs(a)?(d.group=6,l=!0):(function(u){return u.number===16&&u.bondToElementCount(8)===4})(a)?(d.group=5,l=!0):(function(u){let g=0;return u.number===6&&u.bondToElementCount(8)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom((x=>{x.number===8&&x.bondCount-x.bondToElementCount(1)==1&&++g})),g===2})(a)&&(d.group=10,l=!0),l&&(a.eachBondedAtom((u=>{u.number===8&&(s[u.index]=!0,Rn(d,u))})),Ln(n,d))})),o.eachAtom((a=>{const l=On(2);i[a.index]<0&&(s[a.index]||(Rn(l,a),Ln(n,l)))})))}))})(r,e),(function(t,n){const i=t.getAtomProxy();t.eachResidue((s=>{const o=s.getAromaticRings();if(o){const a=s.atomOffset;o.forEach((l=>{const d=On(3);l.forEach((u=>{i.index=u+a,Rn(d,i)})),Ln(n,d)}))}}))})(r,e),(function(t,n){const{charge:i,implicitH:s,idealGeometry:o}=_s(t.data);t.eachAtom((a=>{const l=On(5),d=a.number;if(d===8)Rn(l,a),Ln(n,l);else if(d===7){if(Ps(a))Rn(l,a),Ln(n,l);else if(i[a.index]<1){const u=a.bondCount+s[a.index],g=o[a.index];(g===4&&u<4||g===3&&u<3||g===2&&u<2)&&(Rn(l,a),Ln(n,l))}}else d===16&&(a.resname!=="CYS"&&a.resname!=="MET"&&a.formalCharge!==-1||(Rn(l,a),Ln(n,l)))}))})(r,e),(function(t,n){const{totalH:i}=_s(t.data);t.eachAtom((s=>{const o=On(4),a=s.number;(Ps(s)||i[s.index]>0&&(a===7||a===8||a===16))&&(Rn(o,s),Ln(n,o))}))})(r,e),(function(t,n){const{totalH:i}=_s(t.data);t.eachAtom((s=>{if(s.number===6&&i[s.index]>0&&(s.bondToElementCount(7)>0||s.bondToElementCount(8)>0||(function(o){if(!o.isAromatic())return!1;const a=o.residueType.getRings();if(!a)return!1;let l=!1;return a.rings.forEach((d=>{l||d.some((u=>o.index-o.residueAtomOffset===u))&&(l=d.some((u=>{const g=o.residueType.atomTypeIdList[u],x=o.atomMap.get(g).number;return x===7||x===8})))})),l})(s))){const o=On(9);Rn(o,s),Ln(n,o)}}))})(r,e),(function(t,n){t.eachAtom((i=>{let s=!1,o=!1;const a=is.includes(i.resname),l=os.includes(i.resname);if(a||l?a?i.number===8?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(i.resname)&&i.isSidechain()||i.isBackbone())&&(s=!0,o=!0):i.number===16&&i.resname==="CYS"?(s=!0,o=!0):i.number===7&&i.resname==="HIS"&&i.isSidechain()&&(s=!0):l&&(i.number===8&&i.isBackbone()?(s=!0,o=!0):["N3","N4","N7"].includes(i.atomname)?s=!0:["O2","O4","O6"].includes(i.atomname)&&(s=!0,o=!0)):i.isHalogen()||i.number===8||i.number===16?(s=!0,o=!0):i.number===7&&(s=!0),s){const d=On(11);Rn(d,i),Ln(n,d)}if(o){const d=On(10);Rn(d,i),Ln(n,d)}}))})(r,e),(function(t,n){t.eachAtom((i=>{if(i.isTransitionMetal()||i.number===30||i.number===48){const s=On(12);Rn(s,i),Ln(n,s)}else if(Ms.includes(i.number)){const s=On(13);Rn(s,i),Ln(n,s)}}))})(r,e),(function(t,n){t.eachAtom((i=>{const s=On(8);let o=!1;i.number===6?(o=!0,i.eachBondedAtom((a=>{const l=a.number;l!==6&&l!==1&&(o=!1)}))):i.number===9&&(o=!0),o&&(Rn(s,i),Ln(n,s))}))})(r,e),(function(t,n){t.eachAtom((i=>{if(Bs.includes(i.number)){let s=!1;if(i.eachBondedAtom((o=>{Fs.includes(o.number)&&(s=!0)})),s){const o=On(7);Rn(o,i),Ln(n,o)}}}))})(r,e),(function(t,n){t.eachAtom((i=>{if(Ds.includes(i.number)&&i.bondToElementCount(6)===1){const s=On(6);Rn(s,i),Ln(n,s)}}))})(r,e),De&&ke.timeEnd("calculateFeatures"),e}function Us(r,e=Rs){const t=(function(i){const{types:s,centers:o}=i;return{features:i,spatialHash:new Tn(o),contactStore:new Bn,featureSet:new En(s.length,!1)}})(zs(r));De&&ke.time("calculateContacts"),(function(i,s,o={}){const a=nt(o.maxIonicDist,Rs.maxIonicDist),l=nt(o.maxPiStackingDist,Rs.maxPiStackingDist),d=nt(o.maxPiStackingOffset,Rs.maxPiStackingOffset),u=nt(o.maxPiStackingAngle,Rs.maxPiStackingAngle),g=nt(o.maxCationPiDist,Rs.maxCationPiDist),x=nt(o.maxCationPiOffset,Rs.maxCationPiOffset),y=nt(o.masterModelIndex,Rs.masterModelIndex),b=Math.max(a+2,l,g),_=l*l,h=g*g,{features:f,spatialHash:E,contactStore:m,featureSet:S}=s,{types:w,centers:v,atomSets:A}=f,{x:M,y:T,z:R}=v,O=w.length,L=i.atomStore.x,P=i.atomStore.y,I=i.atomStore.z,N=i.getAtomProxy(),U=i.getAtomProxy(),F=function(Q,Xe,ut){const Ji=Q.length,er=Xe.length;for(let ec=0;ec<Ji;++ec){N.index=Q[ec];for(let ai=0;ai<er;++ai)if(U.index=Xe[ai],N.distanceTo(U)<=ut)return!0}return!1},k=new Vector3,j=new Vector3,H=new Vector3,B=new Vector3,V=new Vector3,Y=new Vector3,K=new Vector3,J=function(Q,Xe){k.set(L[Q[0]],P[Q[0]],I[Q[0]]),j.set(L[Q[1]],P[Q[1]],I[Q[1]]),H.set(L[Q[2]],P[Q[2]],I[Q[2]]),B.subVectors(k,j),V.subVectors(k,H),Xe.crossVectors(B,V)},Te=function(Q,Xe,ut){return k.set(M[Q],T[Q],R[Q]),j.set(M[Xe],T[Xe],R[Xe]),k.sub(j).projectOnPlane(ut).add(j).distanceTo(j)},He=function(Q,Xe,ut){S.setBits(Q,Xe),m.addContact(Q,Xe,ut)};for(let Q=0;Q<O;++Q)E.eachWithin(M[Q],T[Q],R[Q],b,((Xe,ut)=>{if(Xe<=Q||(N.index=A[Q][0],U.index=A[Xe][0],Ns(N,U,y)))return;const Ji=w[Q],er=w[Xe];if(As(Ji,er))F(A[Q],A[Xe],a)&&He(Q,Xe,1);else if(Ss(Ji,er)){if(ut<=_){J(A[Q],Y),J(A[Xe],K);const ec=57.29578*Y.angleTo(K);Math.min(Te(Q,Xe,K),Te(Xe,Q,Y))<=d&&(ec<=u||ec>=180-u||ec<=u+90&&ec>=90-u)&&He(Q,Xe,3)}}else if(Cs(Ji,er)&&ut<=h){const[ec,ai]=Ji===3?[Q,Xe]:[Xe,Q];J(A[ec],Y),Te(ai,ec,Y)<=x&&He(ec,ai,2)}}))})(r,t,e),(function(i,s,o={}){const a=nt(o.maxHbondDist,Rs.maxHbondDist),l=nt(o.maxHbondSulfurDist,Rs.maxHbondSulfurDist),d=It(nt(o.maxHbondAccAngle,Rs.maxHbondAccAngle)),u=It(nt(o.maxHbondDonAngle,Rs.maxHbondDonAngle)),g=It(nt(o.maxHbondAccPlaneAngle,Rs.maxHbondAccPlaneAngle)),x=It(nt(o.maxHbondDonPlaneAngle,Rs.maxHbondDonPlaneAngle)),y=nt(o.masterModelIndex,Rs.masterModelIndex),b=Math.max(a,l),_=a*a,{features:h,spatialHash:f,contactStore:E,featureSet:m}=s,{types:S,centers:w,atomSets:v}=h,{x:A,y:M,z:T}=w,R=S.length,{idealGeometry:O}=_s(i.data),L=i.getAtomProxy(),P=i.getAtomProxy();for(let I=0;I<R;++I)f.eachWithin(A[I],M[I],T[I],b,((N,U)=>{if(N<=I)return;const F=S[I],k=S[N],j=ks(F,k);if(!j&&!Is(F,k))return;const[H,B]=k===5?[I,N]:[N,I];if(L.index=v[H][0],P.index=v[B][0],P.index===L.index||Ns(L,P,y)||L.number!==16&&P.number!==16&&U>_||L.connectedTo(P))return;const V=gs(L,P),Y=ps.get(O[L.index])||It(120);if(V.some((Xe=>Math.abs(Y-Xe)>u)))return;if(O[L.index]===3){const Xe=ys(L,P);if(Xe!==void 0&&Xe>x)return}const K=gs(P,L),J=ps.get(O[P.index])||It(120);if(K.some((Xe=>J-Xe>d)))return;if(O[P.index]===3){const Xe=ys(P,L);if(Xe!==void 0&&Xe>g)return}m.setBits(H,B);const Te=j?8:(function(Xe,ut){return Xe.isWater()&&ut.isWater()})(He=L,Q=P)?9:(function(Xe,ut){return Xe.isBackbone()&&ut.isBackbone()})(He,Q)?10:4;var He,Q;E.addContact(H,B,Te)}))})(r,t,e),(function(i,s,o={}){const a=nt(o.maxMetalDist,Rs.maxMetalDist),l=nt(o.masterModelIndex,Rs.masterModelIndex),{features:d,spatialHash:u,contactStore:g,featureSet:x}=s,{types:y,centers:b,atomSets:_}=d,{x:h,y:f,z:E}=b,m=y.length,S=i.getAtomProxy(),w=i.getAtomProxy();for(let v=0;v<m;++v)u.eachWithin(h[v],f[v],E[v],a,((A,M)=>{if(A<=v||(S.index=_[v][0],w.index=_[A][0],Ns(S,w,l)))return;const T=S.isMetal(),R=w.isMetal();if(!T&&!R)return;const[O,L]=T?[y[v],y[A]]:[y[A],y[v]];Ts(O,L)&&(x.setBits(v,A),g.addContact(v,A,7))}))})(r,t,e),(function(i,s,o={}){const a=nt(o.maxHydrophobicDist,Rs.maxHydrophobicDist),l=nt(o.masterModelIndex,Rs.masterModelIndex),{features:d,spatialHash:u,contactStore:g,featureSet:x}=s,{types:y,centers:b,atomSets:_}=d,{x:h,y:f,z:E}=b,m=y.length,S=i.getAtomProxy(),w=i.getAtomProxy();for(let v=0;v<m;++v)u.eachWithin(h[v],f[v],E[v],a,((A,M)=>{var T,R;A<=v||(S.index=_[v][0],w.index=_[A][0],Ns(S,w,l)||S.number===9&&w.number===9||S.connectedTo(w)||(T=y[v],R=y[A],T===8&&R===8&&(x.setBits(v,A),g.addContact(v,A,6))))}))})(r,t,e),(function(i,s,o={}){const a=nt(o.maxHalogenBondDist,Rs.maxHalogenBondDist),l=It(nt(o.maxHalogenBondAngle,Rs.maxHalogenBondAngle)),d=nt(o.masterModelIndex,Rs.masterModelIndex),{features:u,spatialHash:g,contactStore:x,featureSet:y}=s,{types:b,centers:_,atomSets:h}=u,{x:f,y:E,z:m}=_,S=b.length,w=i.getAtomProxy(),v=i.getAtomProxy();for(let A=0;A<S;++A)g.eachWithin(f[A],E[A],m[A],a,((M,T)=>{if(M<=A||(w.index=h[A][0],v.index=h[M][0],Ns(w,v,d))||(R=b[A],O=b[M],!(R===7&&O===6||R===6&&O===7)))return;var R,O;const[L,P]=b[A]===6?[w,v]:[v,w],I=gs(L,P);if(I.length!==1||Es-I[0]>l)return;const N=gs(P,L);N.length!==0&&(N.some((U=>$s-U>l))||(y.setBits(A,M),x.addContact(A,M,5)))}))})(r,t,e);const n=(function(i){const{index1:s,index2:o,count:a}=i.contactStore,l=$n({nodeArray1:s,nodeArray2:o,edgeCount:a,nodeCount:i.featureSet.length}),d=new En(i.contactStore.count,!0);return Object.assign({adjacencyList:l,contactSet:d},i)})(t);return(function(i,s,o={}){De&&ke.time("refineLineOfSight");const a=nt(o.lineOfSightDistFactor,Rs.lineOfSightDistFactor),l=nt(o.masterModelIndex,Rs.masterModelIndex),d=i.spatialHash,{contactSet:u,contactStore:g,features:x}=s,{index1:y,index2:b}=g,{centers:_,atomSets:h}=x,{x:f,y:E,z:m}=_,S=i.getAtomProxy(),w=i.getAtomProxy(),v=i.getAtomProxy(),A=new Vector3,M=new Vector3,T=3*a,R=a*a;u.forEach((O=>{A.set(f[y[O]],E[y[O]],m[y[O]]),M.set(f[b[O]],E[b[O]],m[b[O]]);const L=(A.x+M.x)/2,P=(A.y+M.y)/2,I=(A.z+M.z)/2,N=h[y[O]],U=h[b[O]];S.index=N[0],w.index=U[0],d.eachWithin(L,P,I,T,((F,k)=>{v.index=F,v.number!==1&&v.vdw*v.vdw*R>k&&!Os(S,v,l)&&!Os(w,v,l)&&!N.includes(F)&&!U.includes(F)&&A.distanceToSquared(v)>1&&M.distanceToSquared(v)>1&&(u.clear(O),De&&ke.log("removing",S.qualifiedName(),w.qualifiedName(),"because",v.qualifiedName()))}))})),De&&ke.timeEnd("refineLineOfSight")})(r,n,e),(function(i,s){const{contactSet:o,contactStore:a,features:l}=s,{type:d,index1:u,index2:g}=a,{atomSets:x}=l,y=i.getAtomProxy(),b=i.getAtomProxy(),_={},h=function(f,E,m){const[S,w]=_[m]||[1/0,-1];f<S?(w!==-1&&o.clear(w),_[m]=[f,E]):o.clear(E)};o.forEach((f=>{if(d[f]!==6)return;y.index=x[u[f]][0],b.index=x[g[f]][0];const E=y.distanceTo(b);h(E,f,`${y.index}|${b.residueIndex}`),h(E,f,`${b.index}|${y.residueIndex}`)}))})(r,n),e.refineSaltBridges&&(function(i,s){const{contactSet:o,contactStore:a,features:l}=s,{type:d,index1:u,index2:g}=a,{atomSets:x}=l,y={},b=function(_,h){y[_]||(y[_]=[]),y[_].push(h)};o.forEach((_=>{d[_]===1&&(x[u[_]].forEach((h=>b(h,_))),x[g[_]].forEach((h=>b(h,_))))})),o.forEach((_=>{if(!(function(m){return m===4||m===9||m===10})(d[_]))return;const h=y[x[u[_]][0]],f=y[x[g[_]][0]];if(!h||!f)return;const E=h.length;for(let m=0;m<E;++m)if(f.includes(h[m]))return void o.clear(_)}))})(0,n),(function(i,s){const{contactSet:o,contactStore:a,features:l}=s,{type:d,index1:u,index2:g}=a,{atomSets:x}=l,y={},b=function(_,h){y[_]||(y[_]=[]),y[_].push(h)};o.forEach((_=>{d[_]===3&&(x[u[_]].forEach((h=>b(h,_))),x[g[_]].forEach((h=>b(h,_))))})),o.forEach((_=>{if(d[_]!==6&&d[_]!==2)return;const h=y[x[u[_]][0]],f=y[x[g[_]][0]];if(!h||!f)return;const E=h.length;for(let m=0;m<E;++m)if(f.includes(h[m]))return void o.clear(_)}))})(0,n),(function(i,s){const{contactSet:o,contactStore:a,features:l}=s,{type:d,index1:u,index2:g}=a,{atomSets:x}=l,y={},b=function(_,h){y[_]||(y[_]=[]),y[_].push(h)};o.forEach((_=>{d[_]===1&&(x[u[_]].forEach((h=>b(h,_))),x[g[_]].forEach((h=>b(h,_))))})),o.forEach((_=>{if(d[_]!==7)return;const h=y[x[u[_]][0]],f=y[x[g[_]][0]];if(!h||!f)return;const E=h.length;for(let m=0;m<E;++m)if(f.includes(h[m]))return void o.clear(h[m])}))})(0,n),De&&ke.timeEnd("calculateContacts"),n}function Vs(r){switch(r){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const js={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},Gs=new Color;function Hs(r,e,t){const n=st(t,js),i=[];n.hydrogenBond&&i.push(4),n.hydrophobic&&i.push(6),n.halogenBond&&i.push(5),n.ionicInteraction&&i.push(1),n.metalCoordination&&i.push(7),n.cationPi&&i.push(2),n.piStacking&&i.push(3),n.weakHydrogenBond&&i.push(8),n.waterHydrogenBond&&i.push(9),n.backboneHydrogenBond&&i.push(10);const{features:s,contactSet:o,contactStore:a}=r,{centers:l,atomSets:d}=s,{x:u,y:g,z:x}=l,{index1:y,index2:b,type:_}=a,h=[],f=[],E=[],m=[],S=[];let w;return n.filterSele&&(w=Array.isArray(n.filterSele)?n.filterSele.map((v=>e.getAtomSet(new me(v)))):e.getAtomSet(new me(n.filterSele))),o.forEach((v=>{const A=_[v];if(!i.includes(A))return;if(w){const R=d[y[v]][0],O=d[b[v]][0];if(Array.isArray(w)){if(!(w[0].isSet(R)&&w[1].isSet(O)||w[1].isSet(R)&&w[0].isSet(O)))return}else if(!w.isSet(R)&&!w.isSet(O))return}const M=y[v],T=b[v];h.push(u[M],g[M],x[M]),f.push(u[T],g[T],x[T]),E.push(...(function(R){switch(R){case 4:case 9:case 10:return Gs.setHex(2851770).toArray();case 6:return Gs.setHex(8421504).toArray();case 5:return Gs.setHex(4259775).toArray();case 1:return Gs.setHex(15779860).toArray();case 7:return Gs.setHex(9191577).toArray();case 2:return Gs.setHex(16744448).toArray();case 3:return Gs.setHex(9220966).toArray();case 8:return Gs.setHex(12967404).toArray();default:return Gs.setHex(13421772).toArray()}})(A)),m.push(n.radius),S.push(v)})),{position1:new Float32Array(h),position2:new Float32Array(f),color:new Float32Array(E),color2:new Float32Array(E),radius:new Float32Array(m),picking:new Zs(S,r,e)}}class qs{constructor(e){this.array=e}get type(){return""}get data(){return{}}getIndex(e){return this.array?this.array[e]:e}getObject(e){return{}}_applyTransformations(e,t,n){return t&&e.applyMatrix4(t.matrix),n&&e.applyMatrix4(n.matrix),e}_getPosition(e){return new Vector3}getPosition(e,t,n){return this._applyTransformations(this._getPosition(e),t,n)}}class Ws extends qs{constructor(e){super(),this.shape=e}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(e){return this.primitive.objectFromShape(this.shape,this.getIndex(e))}_getPosition(e){return this.primitive.positionFromShape(this.shape,this.getIndex(e))}}class Xs extends qs{constructor(e,t){super(e),this.structure=t}get type(){return"atom"}get data(){return this.structure}getObject(e){return this.structure.getAtomProxy(this.getIndex(e))}_getPosition(e){return new Vector3().copy(this.getObject(e))}}class Ys extends qs{constructor(e){super(),this.axes=e}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class Ks extends qs{constructor(e,t,n){super(e),this.structure=t,this.bondStore=n||t.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(e){const t=this.structure.getBondProxy(this.getIndex(e));return t.bondStore=this.bondStore,t}_getPosition(e){const t=this.getObject(e);return new Vector3().copy(t.atom1).add(t.atom2).multiplyScalar(.5)}}class Zs extends qs{constructor(e,t,n){super(e),this.contacts=t,this.structure=n}get type(){return"contact"}get data(){return this.contacts}getObject(e){const t=this.getIndex(e),{features:n,contactStore:i}=this.contacts,{centers:s,atomSets:o}=n,{x:a,y:l,z:d}=s,{index1:u,index2:g,type:x}=i,y=u[t],b=g[t];return{center1:new Vector3(a[y],l[y],d[y]),center2:new Vector3(a[b],l[b],d[b]),atom1:this.structure.getAtomProxy(o[y][0]),atom2:this.structure.getAtomProxy(o[b][0]),type:Vs(x[t])}}_getPosition(e){const{center1:t,center2:n}=this.getObject(e);return new Vector3().addVectors(t,n).multiplyScalar(.5)}}class Qs extends qs{constructor(e,t,n){super(e),this.validation=t,this.structure=n}get type(){return"clash"}get data(){return this.validation}getObject(e){const t=this.validation,n=this.getIndex(e);return{validation:t,index:n,clash:t.clashArray[n]}}_getAtomProxyFromSele(e){const t=new me(e),n=this.structure.getAtomIndices(t)[0];return this.structure.getAtomProxy(n)}_getPosition(e){const t=this.getObject(e).clash,n=this._getAtomProxyFromSele(t.sele1),i=this._getAtomProxyFromSele(t.sele2);return new Vector3().copy(n).add(i).multiplyScalar(.5)}}class Js extends Ks{get type(){return"distance"}}class to extends qs{get type(){return"ignore"}}class eo extends Ws{constructor(e,t){super(e),this.mesh=t}get type(){return"mesh"}getObject(){const e=this.mesh;return{shape:this.shape,name:e.name,serial:e.serial}}_getPosition(){return this.__position||(this.__position=Vr(this.mesh.position)),this.__position}}class io extends qs{constructor(e,t){super(e),this.surface=t}get type(){return"surface"}get data(){return this.surface}getObject(e){return{surface:this.surface,index:this.getIndex(e)}}_getPosition(){return this.surface.center.clone()}}class ro extends qs{constructor(e,t){super(),this.unitcell=e,this.structure=t}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class no extends qs{constructor(e,t){super(e),this.volume=t}get type(){return"volume"}get data(){return this.volume}getObject(e){const t=this.volume,n=this.getIndex(e);return{volume:t,index:n,value:t.data[n]}}_getPosition(e){const t=this.volume.position,n=this.getIndex(e);return new Vector3(t[3*n],t[3*n+1],t[3*n+2])}}class so extends no{get type(){return"slice"}}function oo(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function ao(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function co(r,e,t,n,i){var s,o,a,l,d,u,g,x=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],y=0,b=!1,_=!1,h=!1,f=!1,E=-1,m=e*t*n,S=e,w=e*t,v=new Int32Array(12),A=[],M=[],T=[],R=[],O=oo(),L=ao();function P(B,V,Y){return B+(V-B)*Y}function I(B,V,Y){return w*(Y=(Y+g)%n)+S*(V=(V+u)%t)+(B=(B+d)%e)}function N(B,V,Y,K,J,Te,He){var Q=3*B;if(o[Q]<0){var Xe=(y-Te)/(He-Te),ut=s,Ji=3*a;if(A[Ji]=Y+Xe,A[Ji+1]=K,A[Ji+2]=J,!b){var er=3*B;M[Ji]=E*P(ut[er],ut[er+3],Xe),M[Ji+1]=E*P(ut[er+1],ut[er+4],Xe),M[Ji+2]=E*P(ut[er+2],ut[er+5],Xe)}i&&(R[a]=i[B+Math.round(Xe)]),o[Q]=a,v[V]=a,a+=1}else v[V]=o[Q]}function U(B,V,Y,K,J,Te,He){var Q=3*B+1;if(o[Q]<0){var Xe=(y-Te)/(He-Te),ut=s,Ji=3*a;if(A[Ji]=Y,A[Ji+1]=K+Xe,A[Ji+2]=J,!b){var er=3*B,ec=er+3*S;M[Ji]=E*P(ut[er],ut[ec],Xe),M[Ji+1]=E*P(ut[er+1],ut[ec+1],Xe),M[Ji+2]=E*P(ut[er+2],ut[ec+2],Xe)}i&&(R[a]=i[B+Math.round(Xe)*S]),o[Q]=a,v[V]=a,a+=1}else v[V]=o[Q]}function F(B,V,Y,K,J,Te,He){var Q=3*B+2;if(o[Q]<0){var Xe=(y-Te)/(He-Te),ut=s,Ji=3*a;if(A[Ji]=Y,A[Ji+1]=K,A[Ji+2]=J+Xe,!b){var er=3*B,ec=er+3*w;M[Ji]=E*P(ut[er],ut[ec],Xe),M[Ji+1]=E*P(ut[er+1],ut[ec+1],Xe),M[Ji+2]=E*P(ut[er+2],ut[ec+2],Xe)}i&&(R[a]=i[B+Math.round(Xe)*w]),o[Q]=a,v[V]=a,a+=1}else v[V]=o[Q]}function k(B){var V=3*B;s[V]===0&&(s[V]=r[(B-1+m)%m]-r[(B+1)%m],s[V+1]=r[(B-S+m)%m]-r[(B+S)%m],s[V+2]=r[(B-w+m)%m]-r[(B+w)%m])}function j(B,V,Y,K,J){var Te,He,Q,Xe,ut,Ji,er;h?(K=I(B,V,Y),Te=I(B+1,V,Y),He=I(B,V+1,Y),Q=I(B,V,Y+1),Xe=I(B+1,V+1,Y),ut=I(B+1,V,Y+1),Ji=I(B,V+1,Y+1),er=I(B+1,V+1,Y+1)):(Te=K+1,Xe=(He=K+S)+1,ut=(Q=K+w)+1,er=(Ji=He+w)+1);var ec=0,ai=r[K],u0=r[Te],o0=r[He],E0=r[Xe],F0=r[Q],g0=r[ut],w0=r[Ji],L0=r[er];ai<y&&(ec|=1),u0<y&&(ec|=2),o0<y&&(ec|=8),E0<y&&(ec|=4),F0<y&&(ec|=16),g0<y&&(ec|=32),w0<y&&(ec|=128),L0<y&&(ec|=64);var T0=O[ec];if(T0===0)return 0;var ht=B+1,We=V+1,h0=Y+1;1&T0&&(b||(k(K),k(Te)),N(K,0,B,V,Y,ai,u0)),2&T0&&(b||(k(Te),k(Xe)),U(Te,1,ht,V,Y,u0,E0)),4&T0&&(b||(k(He),k(Xe)),N(He,2,B,We,Y,o0,E0)),8&T0&&(b||(k(K),k(He)),U(K,3,B,V,Y,ai,o0)),16&T0&&(b||(k(Q),k(ut)),N(Q,4,B,V,h0,F0,g0)),32&T0&&(b||(k(ut),k(er)),U(ut,5,ht,V,h0,g0,L0)),64&T0&&(b||(k(Ji),k(er)),N(Ji,6,B,We,h0,w0,L0)),128&T0&&(b||(k(Q),k(Ji)),U(Q,7,B,V,h0,F0,w0)),256&T0&&(b||(k(K),k(Q)),F(K,8,B,V,Y,ai,F0)),512&T0&&(b||(k(Te),k(ut)),F(Te,9,ht,V,Y,u0,g0)),1024&T0&&(b||(k(Xe),k(er)),F(Xe,10,ht,We,Y,E0,L0)),2048&T0&&(b||(k(He),k(Ji)),F(He,11,B,We,Y,o0,w0));for(var M0,Z,tt,tr=ec<<4,s0=0;L[tr+s0]!==-1;)M0=L[tr+s0],Z=L[tr+s0+1],tt=L[tr+s0+2],_?(x[M0][Z]&J&&(T[l++]=v[M0],T[l++]=v[Z]),x[Z][tt]&J&&(T[l++]=v[Z],T[l++]=v[tt]),x[M0][tt]&J&&(T[l++]=v[M0],T[l++]=v[tt])):(T[l++]=v[f?M0:Z],T[l++]=v[f?Z:M0],T[l++]=v[tt]),s0+=3}function H(B,V,Y,K,J,Te){let He,Q,Xe,ut,Ji,er,ec,ai,u0,o0,E0,F0,g0;if(B=B!==void 0?B:0,V=V!==void 0?V:0,Y=Y!==void 0?Y:0,K=K!==void 0?K:e-1,J=J!==void 0?J:t-1,Te=Te!==void 0?Te:n-1,h||(b?(B=Math.max(0,B),V=Math.max(0,V),Y=Math.max(0,Y),K=Math.min(e-1,K),J=Math.min(t-1,J),Te=Math.min(n-1,Te)):(B=Math.max(1,B),V=Math.max(1,V),Y=Math.max(1,Y),K=Math.min(e-2,K),J=Math.min(t-2,J),Te=Math.min(n-2,Te))),h)for(ai=B-2,u0=V-2,o0=Y-2,E0=K+2,F0=J+2,g0=Te+2,Ji=o0;Ji<g0;++Ji)for(ut=u0;ut<F0;++ut)for(Xe=ai;Xe<E0;++Xe)Q=3*I(Xe,ut,Ji),o[Q]=-1,o[Q+1]=-1,o[Q+2]=-1;else for(ai=Math.max(0,B-2),u0=Math.max(0,V-2),o0=Math.max(0,Y-2),E0=Math.min(e,K+2),F0=Math.min(t,J+2),g0=Math.min(n,Te+2),Ji=o0;Ji<g0;++Ji)for(ec=w*Ji,ut=u0;ut<F0;++ut)for(er=ec+S*ut,Xe=ai;Xe<E0;++Xe)He=3*(er+Xe),o[He]=-1,o[He+1]=-1,o[He+2]=-1;if(!h){var w0,L0=B,T0=V,ht=Y,We=K,h0=J,M0=Te;for(w0=!1,Ji=Y;Ji<Te;++Ji){for(ut=V;ut<J;++ut){for(Xe=B;Xe<K;++Xe)if(He=e*t*Ji+e*ut+Xe,r[He]>=y){ht=Ji,w0=!0;break}if(w0)break}if(w0)break}for(w0=!1,ut=V;ut<J;++ut){for(Ji=ht;Ji<Te;++Ji){for(Xe=B;Xe<K;++Xe)if(He=e*t*Ji+e*ut+Xe,r[He]>=y){T0=ut,w0=!0;break}if(w0)break}if(w0)break}for(w0=!1,Xe=B;Xe<K;++Xe){for(ut=T0;ut<J;++ut){for(Ji=ht;Ji<Te;++Ji)if(He=e*t*Ji+e*ut+Xe,r[He]>=y){L0=Xe,w0=!0;break}if(w0)break}if(w0)break}for(w0=!1,Ji=Te;Ji>=Y;--Ji){for(ut=J;ut>=V;--ut){for(Xe=K;Xe>=B;--Xe)if(He=e*t*Ji+e*ut+Xe,r[He]>=y){M0=Ji,w0=!0;break}if(w0)break}if(w0)break}for(w0=!1,ut=J;ut>=V;--ut){for(Ji=M0;Ji>=Y;--Ji){for(Xe=K;Xe>=B;--Xe)if(He=e*t*Ji+e*ut+Xe,r[He]>=y){h0=ut,w0=!0;break}if(w0)break}if(w0)break}for(w0=!1,Xe=K;Xe>=B;--Xe){for(ut=h0;ut>=V;--ut){for(Ji=M0;Ji>=Y;--Ji)if(He=e*t*Ji+e*ut+Xe,r[He]>=y){We=Xe,w0=!0;break}if(w0)break}if(w0)break}b?(B=Math.max(0,L0-1),V=Math.max(0,T0-1),Y=Math.max(0,ht-1),K=Math.min(e-1,We+1),J=Math.min(t-1,h0+1),Te=Math.min(n-1,M0+1)):(B=Math.max(1,L0-1),V=Math.max(1,T0-1),Y=Math.max(1,ht-1),K=Math.min(e-2,We+1),J=Math.min(t-2,h0+1),Te=Math.min(n-2,M0+1))}var Z=15;for(Ji=Y;Ji<Te;++Ji,Z&=-5)for(ec=w*Ji,Z|=2,ut=V;ut<J;++ut,Z&=-3)for(er=ec+S*ut,Z|=1,Xe=B;Xe<K;++Xe,Z&=-2)He=er+Xe,j(Xe,ut,Ji,He,Z)}this.triangulate=function(B,V,Y,K,J){f=(y=B)<0,_=K,h=J,(b=V||_)||(E=y>0?-1:1,s||(s=new Float32Array(3*m)));var Te=3*m;if(o&&o.length===Te||(o=new Int32Array(Te)),a=0,l=0,Y!==void 0){var He=Y[0].map(Math.round),Q=Y[1].map(Math.round);d=e*Math.ceil(Math.abs(He[0])/e),u=t*Math.ceil(Math.abs(He[1])/t),g=n*Math.ceil(Math.abs(He[2])/n),H(He[0],He[1],He[2],Q[0],Q[1],Q[2])}else d=u=g=0,H();return A.length=3*a,b||(M.length=3*a),T.length=l,i&&(R.length=a),{position:new Float32Array(A),normal:b?void 0:new Float32Array(M),index:bt(T,A.length/3),atomindex:i?new Int32Array(R):void 0,contour:_}}}Ge.add("arrow",class extends Ws{get primitive(){return An}}),Ge.add("box",class extends Ws{get primitive(){return _n}}),Ge.add("cone",class extends Ws{get primitive(){return Sn}}),Ge.add("cylinder",class extends Ws{get primitive(){return wn}}),Ge.add("ellipsoid",class extends Ws{get primitive(){return Cn}}),Ge.add("octahedron",class extends Ws{get primitive(){return xn}}),Ge.add("sphere",class extends Ws{get primitive(){return bn}}),Ge.add("tetrahedron",class extends Ws{get primitive(){return vn}}),Ge.add("torus",class extends Ws{get primitive(){return Pn}}),Ge.add("point",class extends Ws{get primitive(){return kn}}),Ge.add("wideline",class extends Ws{get primitive(){return Mn}}),Object.assign(co,{__deps:[oo,ao,bt]});class lo{constructor(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(e){e.data.set(this.data)}}function ho(r,e){let t=0,n=0;const i=e.rows,s=e.cols;let o=0,a=0,l=0;const d=e.data,u=r.data;for(;t<i;a+=1,o+=s,t++)for(l=a,n=0;n<s;l+=i,n++)u[l]=d[o+n]}function uo(r,e,t){let n=0,i=0,s=0,o=0,a=0,l=0,d=0;const u=e.cols,g=e.rows,x=t.rows,y=e.data,b=t.data,_=r.data;let h=0;for(;n<g;o+=u,n++)for(l=0,i=0;i<x;d++,i++){for(a=o,h=0,s=0;s<u;a++,l++,s++)h+=y[a]*b[l];_[d]=h}}function mo(r,e,t){const n=r.data,i=e.data,s=t.data,o=i[0],a=i[1],l=i[2],d=i[3],u=i[4],g=i[5],x=i[6],y=i[7],b=i[8],_=s[0],h=s[1],f=s[2],E=s[3],m=s[4],S=s[5],w=s[6],v=s[7],A=s[8];n[0]=o*_+a*E+l*w,n[1]=o*h+a*m+l*v,n[2]=o*f+a*S+l*A,n[3]=d*_+u*E+g*w,n[4]=d*h+u*m+g*v,n[5]=d*f+u*S+g*A,n[6]=x*_+y*E+b*w,n[7]=x*h+y*m+b*v,n[8]=x*f+y*S+b*A}function fo(r){const e=r.rows,t=r.cols,n=r.data,i=new Array(t);for(let s=0;s<t;++s)i[s]=0;for(let s=0,o=0;s<e;++s)for(let a=0;a<t;++a,++o)i[a]+=n[o];for(let s=0;s<t;++s)i[s]/=e;return i}function po(r,e){const t=r.rows,n=r.cols,i=r.data;for(let s=0,o=0;s<t;++s)for(let a=0;a<n;++a,++o)i[o]-=e[a]}function go(r,e,t,n){n=r[e],r[e]=r[t],r[t]=n}function yo(r,e){return(r=Math.abs(r))>(e=Math.abs(e))?(e/=r,r*Math.sqrt(1+e*e)):e>0?(r/=e,e*Math.sqrt(1+r*r)):0}const bo=1192092896e-16,_o=1e-37;function xo(r,e,t,n){let i=0,s=0;const o=r.rows,a=r.cols;let l=o,d=a;l<d&&(i=1,s=l,l=d,d=s);const u=new lo(l,l),g=new lo(1,d),x=new lo(d,d);if(i===0)ho(u,r);else{for(s=0;s<a*o;s++)u.data[s]=r.data[s];for(;s<d*l;s++)u.data[s]=0}if((function(y,b,_,h,f,E,m,S){const w=2*bo,v=_o;let A=0,M=0,T=0,R=0;const O=Math.max(E,30);let L=0,P=0,I=0,N=0,U=0,F=0,k=0,j=0,H=0,B=0,V=0,Y=0,K=0,J=0,Te=0,He=0,Q=0,Xe=4660,ut=0,Ji=0,er=0;const ec=new Float64Array(m<<3);for(;A<m;A++){for(T=0,V=0;T<E;T++)j=y[A*b+T],V+=j*j;if(ec[A]=V,h){for(T=0;T<m;T++)h[A*f+T]=0;h[A*f+A]=1}}for(;R<O;R++){for(U=0,A=0;A<m-1;A++)for(M=A+1;M<m;M++){for(L=A*b|0,P=M*b|0,Te=ec[A],He=0,Q=ec[M],T=2,He+=y[L]*y[P],He+=y[L+1]*y[P+1];T<E;T++)He+=y[L+T]*y[P+T];if(!(Math.abs(He)<=w*Math.sqrt(Te*Q))){for(He*=2,Y=Te-Q,K=yo(He,Y),Y<0?(J=.5*(K-Y),k=Math.sqrt(J/K),F=He/(K*k*2)):(F=Math.sqrt((K+Y)/(2*K)),k=He/(K*F*2)),Te=0,Q=0,T=2,H=F*y[L]+k*y[P],B=-k*y[L]+F*y[P],y[L]=H,y[P]=B,Te+=H*H,Q+=B*B,H=F*y[L+1]+k*y[P+1],B=-k*y[L+1]+F*y[P+1],y[L+1]=H,y[P+1]=B,Te+=H*H,Q+=B*B;T<E;T++)H=F*y[L+T]+k*y[P+T],B=-k*y[L+T]+F*y[P+T],y[L+T]=H,y[P+T]=B,Te+=H*H,Q+=B*B;if(ec[A]=Te,ec[M]=Q,U=1,h)for(I=A*f|0,N=M*f|0,T=2,H=F*h[I]+k*h[N],B=-k*h[I]+F*h[N],h[I]=H,h[N]=B,H=F*h[I+1]+k*h[N+1],B=-k*h[I+1]+F*h[N+1],h[I+1]=H,h[N+1]=B;T<m;T++)H=F*h[I+T]+k*h[N+T],B=-k*h[I+T]+F*h[N+T],h[I+T]=H,h[N+T]=B}}if(U===0)break}for(A=0;A<m;A++){for(T=0,V=0;T<E;T++)j=y[A*b+T],V+=j*j;ec[A]=Math.sqrt(V)}for(A=0;A<m-1;A++){for(M=A,T=A+1;T<m;T++)ec[M]<ec[T]&&(M=T);if(A!==M&&(go(ec,A,M,V),h)){for(T=0;T<E;T++)go(y,A*b+T,M*b+T,j);for(T=0;T<m;T++)go(h,A*f+T,M*f+T,j)}}for(A=0;A<m;A++)_[A]=ec[A];if(h)for(A=0;A<S;A++){for(V=A<m?ec[A]:0;V<=v;){for(Ji=1/E,T=0;T<E;T++)Xe=214013*Xe+2531011,ut=256&Xe>>16?Ji:-Ji,y[A*b+T]=ut;for(R=0;R<2;R++)for(M=0;M<A;M++){for(V=0,T=0;T<E;T++)V+=y[A*b+T]*y[M*b+T];for(er=0,T=0;T<E;T++)j=y[A*b+T]-V*y[M*b+T],y[A*b+T]=j,er+=Math.abs(j);for(er=er?1/er:0,T=0;T<E;T++)y[A*b+T]*=er}for(V=0,T=0;T<E;T++)j=y[A*b+T],V+=j*j;V=Math.sqrt(V)}for(k=1/V,T=0;T<E;T++)y[A*b+T]*=k}})(u.data,l,g.data,x.data,d,l,d,l),e){for(s=0;s<d;s++)e.data[s]=g.data[s];for(;s<a;s++)e.data[s]=0}i===0?(t&&ho(t,u),n&&ho(n,x)):(t&&ho(t,x),n&&ho(n,u))}function vo(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function wo(r,e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h){r[0]=e,r[4]=t,r[8]=n,r[12]=i,r[1]=s,r[5]=o,r[9]=a,r[13]=l,r[2]=d,r[6]=u,r[10]=g,r[14]=x,r[3]=y,r[7]=b,r[11]=_,r[15]=h}function Ao(r,e,t){const n=e[0],i=e[4],s=e[8],o=e[12],a=e[1],l=e[5],d=e[9],u=e[13],g=e[2],x=e[6],y=e[10],b=e[14],_=e[3],h=e[7],f=e[11],E=e[15],m=t[0],S=t[4],w=t[8],v=t[12],A=t[1],M=t[5],T=t[9],R=t[13],O=t[2],L=t[6],P=t[10],I=t[14],N=t[3],U=t[7],F=t[11],k=t[15];r[0]=n*m+i*A+s*O+o*N,r[4]=n*S+i*M+s*L+o*U,r[8]=n*w+i*T+s*P+o*F,r[12]=n*v+i*R+s*I+o*k,r[1]=a*m+l*A+d*O+u*N,r[5]=a*S+l*M+d*L+u*U,r[9]=a*w+l*T+d*P+u*F,r[13]=a*v+l*R+d*I+u*k,r[2]=g*m+x*A+y*O+b*N,r[6]=g*S+x*M+y*L+b*U,r[10]=g*w+x*T+y*P+b*F,r[14]=g*v+x*R+y*I+b*k,r[3]=_*m+h*A+f*O+E*N,r[7]=_*S+h*M+f*L+E*U,r[11]=_*w+h*T+f*P+E*F,r[15]=_*v+h*R+f*I+E*k}function So(r,e,t,n){wo(r,e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1)}function Co(r,e,t,n){wo(r,1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1)}function Po(r,e){const t=Math.cos(e),n=Math.sin(e);wo(r,t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1)}function Io(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function ko(r,e){const t=Xr([e[0],e[1],e[2]]),n=Xr([e[4],e[5],e[6]]),i=Xr([e[8],e[9],e[10]]),s=Xr();Yr(s,n,i),r[0]=s[0],r[1]=s[1],r[2]=s[2],Yr(s,i,t),r[3]=s[0],r[4]=s[1],r[5]=s[2],Yr(s,t,n),r[6]=s[0],r[7]=s[1],r[8]=s[2]}function Mo(r,e,t,n){t=t||1,n=n||!0;const i=r.length/3,s=e.length/3;let o;n&&(o=new Float32Array(3*i));const a=new Float32Array(3*i);let l;const d=new Array(20);for(l=0;l<20;++l)d[l]=new Uint32Array(i);for(l=0;l<i;++l)d[0][l]=0;let u,g,x;for(l=0;l<s;++l){var y=3*l,b=3*l+1,_=3*l+2;for(x=!0,u=0,g=d[0][e[y]];u<g;++u)if(e[b]===d[u+1][e[y]]){x=!1;break}for(x&&(d[0][e[y]]++,d[d[0][e[y]]][e[y]]=e[b]),x=!0,u=0,g=d[0][e[y]];u<g;++u)if(e[_]===d[u+1][e[y]]){x=!1;break}for(x&&(d[0][e[y]]++,d[d[0][e[y]]][e[y]]=e[_]),x=!0,u=0,g=d[0][e[b]];u<g;++u)if(e[y]===d[u+1][e[b]]){x=!1;break}for(x&&(d[0][e[b]]++,d[d[0][e[b]]][e[b]]=e[y]),x=!0,u=0,g=d[0][e[b]];u<g;++u)if(e[_]===d[u+1][e[b]]){x=!1;break}for(x&&(d[0][e[b]]++,d[d[0][e[b]]][e[b]]=e[_]),x=!0,u=0;u<d[0][e[_]];++u)if(e[y]===d[u+1][e[_]]){x=!1;break}for(x&&(d[0][e[_]]++,d[d[0][e[_]]][e[_]]=e[y]),x=!0,u=0,g=d[0][e[_]];u<g;++u)if(e[b]===d[u+1][e[_]]){x=!1;break}x&&(d[0][e[_]]++,d[d[0][e[_]]][e[_]]=e[b])}for(var h,f,E,m,S,w=.5,v=.75/4.5,A=0;A<t;++A){for(l=0;l<i;++l)if(h=3*l,(E=d[0][l])<3)a[h]=r[h],a[h+1]=r[h+1],a[h+2]=r[h+2];else if(E===3||E===4){for(a[h]=0,a[h+1]=0,a[h+2]=0,u=0;u<E;++u)f=3*d[u+1][l],a[h]+=r[f],a[h+1]+=r[f+1],a[h+2]+=r[f+2];a[h]+=w*r[h],a[h+1]+=w*r[h+1],a[h+2]+=w*r[h+2],S=w+E,a[h]/=S,a[h+1]/=S,a[h+2]/=S}else{for(a[h]=0,a[h+1]=0,a[h+2]=0,u=0;u<E;++u)f=3*d[u+1][l],a[h]+=r[f],a[h+1]+=r[f+1],a[h+2]+=r[f+2];a[h]+=1*r[h],a[h+1]+=1*r[h+1],a[h+2]+=1*r[h+2],m=1+E,a[h]/=m,a[h+1]/=m,a[h+2]/=m}if(r.set(a),n){To(r,e,o);var M=3*i;for(h=0;h<M;h+=3)r[h]+=-1*v*o[h],r[h+1]+=-1*v*o[h+1],r[h+2]+=-1*v*o[h+2]}}}function To(r,e,t){var n,i;if(t===void 0)t=new Float32Array(r.length);else for(n=0,i=t.length;n<i;n++)t[n]=0;var s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3),d=new Float32Array(3);if(e)for(n=0,i=e.length;n<i;n+=3){var u=3*e[n],g=3*e[n+1],x=3*e[n+2];Jr(s,r,u),Jr(o,r,g),Jr(a,r,x),Zr(l,a,o),Zr(d,s,o),Yr(l,l,d),t[u]+=l[0],t[u+1]+=l[1],t[u+2]+=l[2],t[g]+=l[0],t[g+1]+=l[1],t[g+2]+=l[2],t[x]+=l[0],t[x+1]+=l[1],t[x+2]+=l[2]}else for(n=0,i=r.length;n<i;n+=9)Jr(s,r,n),Jr(o,r,n+3),Jr(a,r,n+6),Zr(l,a,o),Zr(d,s,o),Yr(l,l,d),t[n]=l[0],t[n+1]=l[1],t[n+2]=l[2],t[n+3]=l[0],t[n+4]=l[1],t[n+5]=l[2],t[n+6]=l[0],t[n+7]=l[1],t[n+8]=l[2];return Wr(t),t}function Do(r){for(var e={},t=0,n=r.length;t<n;++t)e[r[t]]=!0;return e}function Bo(r,e,t,n,i){var s=1/n*3;an(r,r,i+(s+=t)),cn(e,e,i+s),sn(r,r,n),ln(r,r),nn(r,r,n),sn(e,e,n),hn(e,e),nn(e,e,n);var o=new Float32Array(3);Zr(o,e,r),sn(o,o,n),hn(o,o),cn(o,o,1);var a=256*Math.pow(10,6),l=o[0]*o[1]*o[2]*3;a<=l&&(sn(r,r,n*=Math.pow(a/l,1/3)),ln(r,r),nn(r,r,n),sn(e,e,n),hn(e,e),nn(e,e,n),Zr(o,e,r),sn(o,o,n),hn(o,o),cn(o,o,1));var d=new Float32Array(r);un(d,d);var u=vo(),g=vo();Po(g,It(90)),Ao(u,u,g);var x=vo();So(x,-1/n,1/n,1/n),Ao(u,u,x);var y=vo();return Co(y,-n*d[2],-n*d[1],-n*d[0]),Ao(u,u,y),{dim:o,tran:d,matrix:u,scaleFactor:n}}So.__deps=[wo],Co.__deps=[wo],Po.__deps=[wo],ko.__deps=[Xr,Yr],Object.assign(Mo,{__deps:[To]}),Object.assign(To,{__deps:[Zr,Yr,Jr,Wr]}),Object.assign(Bo,{__deps:[It,an,cn,nn,sn,ln,hn,Zr,un,vo,Ao,Co,So,Po]});class Fo{constructor(e,t,n){this.name=e||"",this.path=t||"",this.info={},this.center=new Vector3,this.boundingBox=new Box3,n instanceof BufferGeometry||n instanceof Group?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(e,t,n,i,s,o=!1){this.position=e,this.index=t,this.normal=n,this.color=i,this.atomindex=s,this.size=e.length/3,this.contour=o}fromGeometry(e){let t,n,i,s;if(De&&ke.time("GeometrySurface.fromGeometry"),t=e instanceof BufferGeometry?e:e[0],t.boundingBox||t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox),this.boundingBox.getCenter(this.center),t instanceof BufferGeometry){const o=t.attributes,a=!!o.normal&&o.normal.array;(!a||a[0]===0&&a[1]===0&&a[2]===0)&&t.computeVertexNormals(),n=o.position.array,i=o.index?o.index.array:null,s=o.normal.array}this.set(n,i,s,void 0,void 0),De&&ke.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(e){const t=e||{};t.surface=this;const n=this.size,i=new Float32Array(3*n),s=Oe.getScheme(t);if(s.volumeColor||t.scheme==="random")for(let a=0;a<n;++a)s.volumeColorToArray(a,i,3*a);else if(s.positionColor){const a=new Vector3,l=this.position;for(let d=0;d<n;++d){var o=3*d;a.set(l[o],l[o+1],l[o+2]),s.positionColorToArray(a,i,o)}}else if(s.atomColor&&this.atomindex){const a=t.structure.getAtomProxy(),l=this.atomindex;for(let d=0;d<n;++d)a.index=l[d],s.atomColorToArray(a,i,3*d)}else{const a=new Color(t.value);Si(n,a.r,a.g,a.b,i)}return i}getPicking(e){return this.atomindex&&e?new Xs(this.atomindex,e):new io(Ci(this.size),this)}getNormal(){return this.normal}getSize(e,t){return Ai(this.size,e*t)}getIndex(){return this.index}getFilteredIndex(e,t){if(e&&this.atomindex){const n=new me(e),i=t.getAtomSet(n),s=[],o=this.atomindex,a=this.index,l=a.length,d=this.contour?2:3;let u=0;for(let g=0;g<l;g+=d){let x=!0;for(let y=0;y<d;y++){const b=o[a[g+y]];if(!i.get(b)){x=!1;break}}if(x)for(let y=0;y<d;y++,u++)s[u]=a[g+y]}return bt(s,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function Eo(r,e,t,n,i){var s=new co(r,e,t,n,i);this.getSurface=function(o,a,l,d,u,g=!1){const x=s.triangulate(o,a,l,u,g);if(a&&!u&&(Mo(x.position,x.index,a,!0),x.normal=To(x.position,x.index)),d&&(Hr(d,x.position),x.normal)){const y=Io();ko(y,d),qr(y,x.normal)}return x}}Object.assign(Eo,{__deps:[Mo,To,co,Hr,qr,Io,ko]}),$e.add("surf",(function(r,e){const t=r.data.args,n=r.data.params;if(t&&(self.volsurf=new Eo(t[0],t[1],t[2],t[3],t[4])),n){const i=self.volsurf.getSurface(n.isolevel,n.smooth,n.box,n.matrix,n.contour,n.wrap),s=[i.position.buffer,i.index.buffer];i.normal&&s.push(i.normal.buffer),i.atomindex&&s.push(i.atomindex.buffer),e({sd:i,p:n},s)}}),[Eo]);class $o{constructor(e,t,n,i,s,o,a){this.name=e,this.path=t,this.matrix=new Matrix4,this.normalMatrix=new Matrix3,this.inverseMatrix=new Matrix4,this.center=new Vector3,this.boundingBox=new Box3,this.setData(n,i,s,o,a)}get type(){return"Volume"}setData(e,t,n,i,s){this.nx=t||1,this.ny=n||1,this.nz=i||1,this.data=e||new Float32Array(1),this.setAtomindex(s),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(e,t,n,i){this._min=e,this._max=t,this._mean=n,this._rms=i}setMatrix(e){this.matrix.copy(e);const t=this.boundingBox,n=this.center,i=this.nx-1,s=this.ny-1,o=this.nz-1;t.makeEmpty(),t.expandByPoint(n.set(i,s,o)),t.expandByPoint(n.set(i,s,0)),t.expandByPoint(n.set(i,0,o)),t.expandByPoint(n.set(i,0,0)),t.expandByPoint(n.set(0,s,o)),t.expandByPoint(n.set(0,0,o)),t.expandByPoint(n.set(0,s,0)),t.expandByPoint(n.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);const a=this.matrix.elements,l=new Vector3(a[0],a[1],a[2]),d=new Vector3(a[4],a[5],a[6]),u=new Vector3(a[8],a[9],a[10]),g=new Vector3,x=this.normalMatrix.elements;g.crossVectors(d,u),x[0]=g.x,x[1]=g.y,x[2]=g.z,g.crossVectors(u,l),x[3]=g.x,x[4]=g.y,x[5]=g.z,g.crossVectors(l,d),x[6]=g.x,x[7]=g.y,x[8]=g.z,this.inverseMatrix.copy(this.matrix).invert()}setAtomindex(e){this.atomindex=e}getBox(e,t,n){return n||(n=new Box3),n.set(e,e),n.expandByScalar(t),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n}_getBox(e,t){if(!e||!t)return;this.__box||(this.__box=new Box3);const n=this.getBox(e,t,this.__box);return[n.min.toArray(),n.max.toArray()]}_makeSurface(e,t,n){const i=this.name+"@"+t.toPrecision(2),s=new Fo(i,"",e);return s.info.isolevel=t,s.info.smooth=n,s.info.volume=this,s}getSurface(e,t,n,i,s,o=!1){e=isNaN(e)?this.getValueForSigma(2):e,t=nt(t,0),this.volsurf===void 0&&(this.volsurf=new Eo(this.data,this.nx,this.ny,this.nz,this.atomindex));const a=this._getBox(n,i),l=this.volsurf.getSurface(e,t,a,this.matrix.elements,s,o);return this._makeSurface(l,e,t)}getSurfaceWorker(e,t,n,i,s,o,a){if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){this.workerPool===void 0&&(this.workerPool=new Ur("surf",2));const l={},d=this.workerPool.getNextWorker();d.postCount===0&&Object.assign(l,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(l,{params:{isolevel:e,smooth:t,box:this._getBox(n,i),matrix:this.matrix.elements,contour:s,wrap:o}}),d.post(l,void 0,(u=>{const g=u.data.sd,x=u.data.p;a(this._makeSurface(g,x.isolevel,x.smooth))}),(u=>{console.warn("Volume.getSurfaceWorker error - trying without worker",u);const g=this.getSurface(e,t,n,i,s,o);a(g)}))}else{const l=this.getSurface(e,t,n,i,s,o);a(l)}}getValueForSigma(e){return this.mean+nt(e,2)*this.rms}getSigmaForValue(e){return(nt(e,0)-this.mean)/this.rms}get position(){if(!this._position){const e=this.nz,t=this.ny,n=this.nx,i=new Float32Array(n*t*e*3);let s=0;for(let o=0;o<e;++o)for(let a=0;a<t;++a)for(let l=0;l<n;++l)i[s+0]=l,i[s+1]=a,i[s+2]=o,s+=3;Hr(this.matrix.elements,i),this._position=i}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(e){const t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];const n=Oe.getScheme(t),i=this.position.length/3,s=new Float32Array(3*i);for(let o=0;o<i;++o)n.volumeColorToArray(o,s,3*o);return s}getDataPicking(){const e=Ci(this.position.length/3);return new no(e,this)}getDataSize(e,t){const n=this.data,i=this.position.length/3;let s;switch(e){case"value":case"deviation":s=new Float32Array(n);break;case"abs-value":s=new Float32Array(n);for(let o=0;o<i;++o)s[o]=Math.abs(s[o]);break;case"value-min":{s=new Float32Array(n);const o=this.min;for(let a=0;a<i;++a)s[a]-=o;break}default:s=Ai(i,e)}if(t!==1)for(let o=0;o<i;++o)s[o]*=t;return s}get min(){return this._min===void 0&&(this._min=Di(this.data)),this._min}get max(){return this._max===void 0&&(this._max=Ti(this.data)),this._max}get sum(){return this._sum===void 0&&(this._sum=Bi(this.data)),this._sum}get mean(){return this._mean===void 0&&(this._mean=Fi(this.data)),this._mean}get rms(){return this._rms===void 0&&(this._rms=(function(e){const t=e.length;let n=0;for(let i=0;i<t;++i){const s=e[i];n+=s*s}return Math.sqrt(n/t)})(this.data)),this._rms}clone(){const e=new $o(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e}dispose(){this.workerPool&&this.workerPool.terminate()}}function Oo(r){return r==="front"?FrontSide:r==="back"?BackSide:DoubleSide}ze.add("shader/Mesh.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#elif defined( NOLIGHT )
vColor = color;
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),ze.add("shader/Mesh.frag",`#define STANDARD
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#elif defined( NOLIGHT )
gl_FragColor = vec4( vColor, opacity );
#else
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
#include interior_fragment
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#include opaque_back_fragment
#endif
}`);const Ro={f:1,v2:2,v3:3,c:3};function Lo(r,e){r.matrix.copy(e),r.matrix.decompose(r.position,r.quaternion,r.scale),r.matrixWorldNeedsUpdate=!0}const No={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new Vector3,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new Matrix4,disablePicking:!1,sortParticles:!1,background:!1},zo={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class Uo{constructor(e,t={}){this.parameterTypes=zo,this.geometry=new BufferGeometry,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new Group,this.wireframeGroup=new Group,this.pickingGroup=new Group,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=st(t,this.defaultParameters),this.uniforms=UniformsUtils.merge([UniformsLib.common,{fogColor:{value:new Color(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new Color(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new Color(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},UniformsLib.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const n=e.position||e.position1;this._positionDataSize=n?n.length/3:0,e.primitiveId||(e.primitiveId=Ci(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()}get defaultParameters(){return No}set matrix(e){this.setMatrix(e)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(e){Lo(this.group,e),Lo(this.wireframeGroup,e),Lo(this.pickingGroup,e)}initIndex(e){this.geometry.setIndex(new BufferAttribute(e,1));const t=this.geometry.getIndex();t?t.setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage):ke.error("Index is null")}makeMaterial(){const e=Oo(this.parameters.side),t=new ShaderMaterial({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;const n=new ShaderMaterial({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});n.vertexColors=!0;const i=new ShaderMaterial({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:NoBlending});i.vertexColors=!0,i.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,i.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=n,this.pickingMaterial=i,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const e=this.geometry,t=this.wireframeIndex,n=new BufferGeometry;n.attributes=e.attributes,t&&(n.setIndex(new BufferAttribute(t,1).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n}makeWireframeIndex(){const e=[];function t(s,o){if(s>o){const l=s;s=o,o=l}const a=e[s];return a===void 0?(e[s]=[o],!0):!a.includes(o)&&(a.push(o),!0)}const n=this.geometry,i=n.index;if(this.parameters.wireframe)if(i){const s=i.array;let o,a=s.length;n.drawRange.count!==1/0&&(a=n.drawRange.count),this.wireframeIndex&&this.wireframeIndex.length>2*a?o=this.wireframeIndex:o=bt(2*a,n.attributes.position.count);let l=0;e.length=0;for(let d=0;d<a;d+=3){const u=s[d+0],g=s[d+1],x=s[d+2];t(u,g)&&(o[l+0]=u,o[l+1]=g,l+=2),t(g,x)&&(o[l+0]=g,o[l+1]=x,l+=2),t(x,u)&&(o[l+0]=x,o[l+1]=u,l+=2)}this.wireframeIndex=o,this.wireframeIndexCount=l,this.wireframeIndexVersion=this.indexVersion}else{const s=n.attributes.position.count;let o;o=this.wireframeIndex&&this.wireframeIndex.length>2*s?this.wireframeIndex:bt(2*s,s);for(let a=0,l=0;a<s;a+=3)o[l+0]=a,o[l+1]=a+1,o[l+2]=a+1,o[l+3]=a+2,o[l+4]=a+2,o[l+5]=a,l+=6;this.wireframeIndex=o,this.wireframeIndexCount=2*s,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new BufferAttribute(this.wireframeIndex,1).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage));else{const e=this.wireframeGeometry.getIndex();if(!e)return void ke.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e}_getMesh(e){this.material||this.makeMaterial();const t=this.geometry,n=this[e];let i;return i=this.isLine?new LineSegments(t,n):this.isPoint?new Points(t,n):new Mesh(t,n),i.frustumCulled=!1,i.renderOrder=this.getRenderOrder(),i}getMesh(){return this._getMesh("material")}getWireframeMesh(){let e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),e=new LineSegments(this.wireframeGeometry,this.wireframeMaterial),e.frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(e,t){return pi(e,this.getDefines(t))}getVertexShader(e){return this.getShader(this.vertexShader,e)}getFragmentShader(e){return this.getShader(this.fragmentShader,e)}getDefines(e){const t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),e==="picking"?t.PICKING=1:((e==="background"||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t}getParameters(){return this.parameters}addUniforms(e){this.uniforms=UniformsUtils.merge([this.uniforms,e]),this.pickingUniforms=UniformsUtils.merge([this.pickingUniforms,e])}addAttributes(e){for(let t in e){let n;const i=e[t],s=this.attributeSize*Ro[i.type];i.value?(s!==i.value.length&&ke.error("attribute value has wrong length",t),n=i.value):n=yt("float32",s),this.geometry.setAttribute(t,new BufferAttribute(n,Ro[i.type]).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage))}}updateRenderOrder(){const e=this.getRenderOrder();function t(n){n.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)}updateShader(){const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0}setParameters(e){const t=e,n=this.parameterTypes,i=this.parameters,s={},o={};let a=!1,l=!1;for(const d in t){const u=t[d];u!==void 0&&(i[d]=u,n[d]!==void 0&&(n[d].property&&(n[d].property!==!0?s[n[d].property]=u:s[d]=u),n[d].uniform&&(n[d].uniform!==!0?o[n[d].uniform]=u:o[d]=u),n[d].updateShader&&(a=!0),n[d].updateVisibility&&(l=!0),this.dynamic&&d==="wireframe"&&u===!0&&this.updateWireframeIndex(),d==="forceTransparent"&&(s.transparent=this.transparent),d==="matrix"&&(this.matrix=u)))}this.setProperties(s),this.setUniforms(o),a&&this.updateShader(),l&&this.setVisibility(this.visible)}setAttributes(e){const t=this.geometry,n=t.attributes;for(const i in e){if(i==="picking")continue;const s=e[i],o=s.length;if(i==="index"){const a=t.getIndex();if(!a){ke.error("Index is null");continue}t.setDrawRange(0,1/0),o>a.array.length?t.setIndex(new BufferAttribute(s,1).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage)):(a.set(s),a.needsUpdate=o>0,a.updateRange.count=o,t.setDrawRange(0,o)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const a=n[i];o>a.array.length?t.setAttribute(i,new BufferAttribute(s,a.itemSize).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage)):(n[i].set(s),n[i].needsUpdate=o>0,n[i].updateRange.count=o)}}}setUniforms(e){if(!e)return;const t=this.material.uniforms,n=this.wireframeMaterial.uniforms,i=this.pickingMaterial.uniforms;for(let s in e)s==="opacity"&&this.setProperties({transparent:this.transparent}),t[s]!==void 0&&(t[s].value.isVector3?t[s].value.copy(e[s]):t[s].value.set?t[s].value.set(e[s]):t[s].value=e[s]),n[s]!==void 0&&(n[s].value.isVector3?n[s].value.copy(e[s]):n[s].value.set?n[s].value.set(e[s]):n[s].value=e[s]),i[s]!==void 0&&(i[s].value.isVector3?i[s].value.copy(e[s]):i[s].value.set?i[s].value.set(e[s]):i[s].value=e[s])}setProperties(e){if(!e)return;const t=this.material,n=this.wireframeMaterial,i=this.pickingMaterial;for(const s in e){const o=s;let a=e[o];o==="transparent"?this.updateRenderOrder():o==="side"&&(a=Oo(a)),t[o]=a,n[o]=a,i[o]=a}t.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var e={};for(var t in this)t!=="group"&&t!=="wireframeGroup"&&t!="pickingGroup"&&t!=="picking"&&(e[t]=this[t]);return e}}class Vo extends Uo{constructor(e,t={}){super(e,t),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:e.normal}}),e.normal===void 0&&this.geometry.computeVertexNormals()}}class jo extends Vo{constructor(){super(...arguments),this.isSurface=!0}}function Go(r){r.visible=!0}function Ho(r){r.visible=!1}class qo{constructor(e){this.group=new Group,this.wireframeGroup=new Group,this.pickingGroup=new Group,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new Group,this.wireframeGroup=new Group,this.pickingGroup=new Group,this.matrix=e.matrix;const t=e,n=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),n.makeMaterial(),n.picking=e.picking,n.geometry=e.geometry,n.wireframeGeometry=e.wireframeGeometry,n.setParameters(e.getParameters()),n.updateShader(),t.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=n}set matrix(e){Uo.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const e=Object.assign({},this.buffer.parameters);return e.side=this.side,e}getMesh(e){let t,n;return e?(n=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(n),this.setParameters({side:this.side}),new Group().add(n,t)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(e){this.buffer.setAttributes(e)}setParameters(e){(e=Object.assign({},e)).side==="front"?(this.frontMeshes.forEach(Go),this.backMeshes.forEach(Ho)):e.side==="back"?(this.frontMeshes.forEach(Ho),this.backMeshes.forEach(Go)):e.side==="double"&&(this.frontMeshes.forEach(Go),this.backMeshes.forEach(Go)),e.side!==void 0&&(this.side=e.side),delete e.side,e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),e.wireframe!==void 0&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e}}ze.add("shader/Line.vert",`uniform float clipNear;
uniform vec3 clipCenter;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include color_pars_vertex
void main(){
#include color_vertex
#include begin_vertex
#include project_vertex
vViewPosition = -mvPosition.xyz;
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),ze.add("shader/Line.frag",`uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
void main(){
#include nearclip_fragment
#include radiusclip_fragment
gl_FragColor = vec4( vColor, opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`);class Wo extends Uo{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class Xo extends Nr{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),e instanceof $o?(this.surface=void 0,this.volume=e):(this.surface=e,this.volume=void 0),this.boxCenter=new Vector3,this.__boxCenter=new Vector3,this.box=new Box3,this.__box=new Box3,this._position=new Vector3,this.inverseMatrix=new Matrix4,this.setBox=function(){this._position.copy(t.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}init(e){const t=e||{};t.colorScheme=nt(t.colorScheme,"uniform"),t.colorValue=nt(t.colorValue,14540253),this.isolevelType=nt(t.isolevelType,"sigma"),this.isolevel=nt(t.isolevel,2),this.negateIsolevel=nt(t.negateIsolevel,!1),this.isolevelScroll=nt(t.isolevelScroll,!1),this.smooth=nt(t.smooth,0),this.background=nt(t.background,!1),this.opaqueBack=nt(t.opaqueBack,!0),this.boxSize=nt(t.boxSize,0),this.colorVolume=nt(t.colorVolume,void 0),this.contour=nt(t.contour,!1),this.useWorker=nt(t.useWorker,!0),this.wrap=nt(t.wrap,!1),super.init(t),this.inverseMatrix.copy(this.matrix).invert(),this.build()}attach(e){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),e()}prepare(e){if(this.volume){let t;if(t=this.isolevelType==="sigma"?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(t*=-1),!this.surface||this.__isolevel!==t||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=t,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const n=i=>{this.surface=i,e()};this.useWorker?this.volume.getSurfaceWorker(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,n):n(this.volume.getSurface(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else e()}else e()}create(){const e={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let t;if(this.contour)t=new Wo(e,this.getBufferParams({wireframe:!1}));else{Object.assign(e,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const n=new jo(e,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));t=new qo(n)}this.bufferList.push(t)}update(e){if(this.bufferList.length===0)return;const t={};(e=e||{}).position&&(t.position=this.surface.getPosition()),e.color&&(t.color=this.surface.getColor(this.getColorParams())),e.index&&(t.index=this.surface.getIndex()),e.normal&&(t.normal=this.surface.getNormal()),this.bufferList.forEach((function(n){n.setAttributes(t)}))}setParameters(e,t,n){return e&&e.isolevelType!==void 0&&this.volume&&(this.isolevelType==="value"&&e.isolevelType==="sigma"?this.isolevel=this.volume.getSigmaForValue(this.isolevel):this.isolevelType==="sigma"&&e.isolevelType==="value"&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=e.isolevelType),e&&e.boxCenter&&(this.boxCenter.copy(e.boxCenter),delete e.boxCenter),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),e.matrix&&this.inverseMatrix.copy(e.matrix).invert(),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),e&&e.colorVolume!==void 0&&t&&(t.color=!0),this.surface&&(e.isolevel!==void 0||e.negateIsolevel!==void 0||e.smooth!==void 0||e.wrap!==void 0||e.boxSize!==void 0||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class Yo{static zoomScroll(e,t){e.trackballControls.zoom(t)}static clipNearScroll(e,t){const n=e.getParameters();e.setParameters({clipNear:n.clipNear+t/10})}static focusScroll(e,t){const n=e.getFocus(),i=Math.sign(t)*(function(s,o,a){if(s>o)return s;const l=s/o;return((2*a-o)*l+(2*o-3*a))*l*l+a})((100-n)/10,5,.2);e.setFocus(n+i)}static zoomFocusScroll(e,t){e.trackballControls.zoom(t);const n=e.viewer.camera.position.z;e.setFocus(100-Math.abs(n/8))}static isolevelScroll(e,t){const n=Math.sign(t)/10;e.eachRepresentation(((i,s)=>{if(i.repr instanceof Xo){const o=i.getParameters();o.isolevelScroll&&i.setParameters({isolevel:o.isolevel+n})}}))}static panDrag(e,t,n){e.trackballControls.pan(t,n)}static rotateDrag(e,t,n){e.trackballControls.rotate(t,n)}static zRotateDrag(e,t,n){e.trackballControls.zRotate(t,n)}static zoomDrag(e,t,n){e.trackballControls.zoom((t+n)/-2)}static zoomFocusDrag(e,t,n){e.trackballControls.zoom((t+n)/-2);const i=e.viewer.camera.position.z;e.setFocus(100-Math.abs(i/8))}static panComponentDrag(e,t,n){e.trackballControls.panComponent(t,n)}static panAtomDrag(e,t,n){e.trackballControls.panAtom(t,n)}static rotateComponentDrag(e,t,n){e.trackballControls.rotateComponent(t,n)}static movePick(e,t){t&&e.animationControls.move(t.position.clone())}static tooltipPick(e,t){const n=e.tooltip;if(e.getParameters().tooltip&&t){const i=t.mouse.position;n.innerText=t.getLabel(),n.style.bottom=window.innerHeight-i.y+3+"px",n.style.left=i.x+3+"px",n.style.display="block"}else n.style.display="none"}static measurePick(e,t){if(t&&(t.atom||t.bond)){const n=t.atom||t.closestBondAtom;t.component.measurePick(n)}else e.measureClear()}}const Ko={default:[["scroll",Yo.zoomScroll],["scroll-shift",Yo.focusScroll],["scroll-ctrl",Yo.isolevelScroll],["scroll-shift-ctrl",Yo.zoomFocusScroll],["drag-left",Yo.rotateDrag],["drag-right",Yo.panDrag],["drag-ctrl-left",Yo.panDrag],["drag-ctrl-right",Yo.zRotateDrag],["drag-shift-left",Yo.zoomDrag],["drag-middle",Yo.zoomFocusDrag],["drag-ctrl-shift-right",Yo.panComponentDrag],["drag-ctrl-shift-left",Yo.rotateComponentDrag],["clickPick-right",Yo.measurePick],["clickPick-ctrl-left",Yo.measurePick],["clickPick-middle",Yo.movePick],["clickPick-left",Yo.movePick],["hoverPick",Yo.tooltipPick]],pymol:[["drag-left",Yo.rotateDrag],["drag-middle",Yo.panDrag],["drag-right",Yo.zoomDrag],["scroll",Yo.focusScroll],["drag-shift-right",Yo.focusScroll],["clickPick-ctrl+shift-middle",Yo.movePick],["hoverPick",Yo.tooltipPick]],coot:[["scroll",Yo.isolevelScroll],["drag-left",Yo.rotateDrag],["drag-middle",Yo.panDrag],["drag-ctrl-left",Yo.panDrag],["drag-right",Yo.zoomFocusDrag],["drag-ctrl-right",Yo.focusScroll],["clickPick-middle",Yo.movePick],["hoverPick",Yo.tooltipPick]],astexviewer:[["drag-left",Yo.rotateDrag],["drag-ctrl-left",Yo.panDrag],["drag-shift-left",Yo.zoomDrag],["scroll",Yo.focusScroll],["clickPick-middle",Yo.movePick],["hoverPick",Yo.tooltipPick]]};function Zo(r){const e=r.split(/[-+]/);let t="";e.includes("scroll")&&(t="scroll"),e.includes("drag")&&(t="drag"),e.includes("click")&&(t="click"),e.includes("doubleClick")&&(t="doubleClick"),e.includes("hover")&&(t="hover"),e.includes("clickPick")&&(t="clickPick"),e.includes("hoverPick")&&(t="hoverPick");let n=0;e.includes("alt")&&(n+=1),e.includes("ctrl")&&(n+=2),e.includes("meta")&&(n+=4),e.includes("shift")&&(n+=8);let i=0;return e.includes("left")&&(i+=1),e.includes("right")&&(i+=2),e.includes("middle")&&(i+=4),[t,n,i]}class Qo{constructor(e,t={}){this.stage=e,this.actionList=[],this.mouse=e.mouseObserver,this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e,...t){if(this.disabled)return;const n=this.mouse.key||0,i=this.mouse.buttons||0;this.actionList.forEach((s=>{s.type===e&&s.key===n&&s.button===i&&s.callback(this.stage,...t)}))}add(e,t){const[n,i,s]=Zo(e);this.actionList.push({type:n,key:i,button:s,callback:t})}remove(e,t){const n=e.includes("*"),[i,s,o]=Zo(e),a=this.actionList.filter((function(l){return!((l.type===i||n&&i==="")&&(l.key===s||n&&s===0)&&(l.button===o||n&&o===0)&&(l.callback===t||t===void 0))}));this.actionList=a}preset(e){this.clear(),(Ko[e]||[]).forEach((t=>this.add(t[0],t[1])))}clear(){this.actionList.length=0}}class Jo{static autoView(e){e.autoView(1e3)}static toggleAnimations(e){e.animationControls.toggle()}static toggleRock(e){e.toggleRock()}static toggleSpin(e){e.toggleSpin()}static toggleAntialiasing(e){const t=e.getParameters();e.setParameters({sampleLevel:t.sampleLevel===-1?0:-1})}}const ta={default:[["i",Jo.toggleSpin],["k",Jo.toggleRock],["p",Jo.toggleAnimations],["a",Jo.toggleAntialiasing],["r",Jo.autoView]]};class ea{constructor(e,t={}){this.stage=e,this.actionList=[],this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e){this.disabled||this.actionList.forEach((t=>{t.key===e&&t.callback(this.stage)}))}add(e,t){this.actionList.push({key:e,callback:t})}remove(e,t){const n=this.actionList.filter((function(i){return!(i.key===e&&(i.callback===t||t===void 0))}));this.actionList=n}preset(e){this.clear(),(ta[e]||[]).forEach((t=>this.add(t[0],t[1])))}clear(){this.actionList.length=0}}class ia{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)}_onClick(e,t){const n=this.stage.pickingControls.pick(e,t);this.stage.signals.clicked.dispatch(n),this.controls.run("clickPick",n)}_onHover(e,t){const n=this.stage.pickingControls.pick(e,t);n&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=n.component,this.stage.transformAtom=n.atom),this.stage.signals.hovered.dispatch(n),this.controls.run("hoverPick",n)}dispose(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class ra{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)}_onMove(){this.stage.tooltip.style.display="none"}_onScroll(e){this.controls.run("scroll",e)}_onDrag(e,t){this.controls.run("drag",e,t)}_onClick(e,t){this.controls.run("click",e,t)}_onDblclick(e,t){this.controls.run("doubleClick",e,t)}_onHover(e,t){this.controls.run("hover",e,t)}dispose(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class na{constructor(e){this.stage=e,this.viewer=e.viewer,this.animationControls=e.animationControls,this.viewer.signals.ticked.add(this._onTick,this)}_onTick(e){this.animationControls.run(e)}dispose(){this.viewer.signals.ticked.remove(this._onTick,this)}}const sa=!!we&&{passive:!0};class oa{constructor(e){this.stage=e,this.stage=e,this.controls=e.keyControls,this.domElement=e.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,sa),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)}_onKeydown(){}_onKeyup(){}_onKeypress(e){let t;t="key"in KeyboardEvent.prototype?e.key:String.fromCharCode(e.which||e.keyCode),this.controls.run(t)}_focusDomElement(){this.domElement.focus()}dispose(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,sa),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)}}class aa{constructor(e,t,n,i={}){this.component=e,this.position=t,this.offsetX=nt(i.offsetX,0),this.offsetY=nt(i.offsetY,0),this.visible=nt(i.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new Vector3,this._updateViewerPosition(),this._canvasPosition=new Vector2,this._cameraPosition=new Vector3,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(e){const t=this.element.style.display;if(t==="none"&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{const n=document.createElement("div");n.innerText=e,Object.assign(n.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(n)}this._clientRect=this.element.getBoundingClientRect(),t==="none"&&(this.element.style.display=t)}setVisibility(e){this.visible=e,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const e=this.element.style,t=this._canvasPosition,n=this._viewerPosition,i=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(e.display="none");e.display="block";const s=this._cameraPosition.length(),o=this.viewer.scene.fog;e.opacity=(1-Et(o.near,o.far,s)).toString(),e.zIndex=Math.round(100*(o.far-s)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,t),e.bottom=this.offsetX+t.y+i.height/2+"px",e.left=this.offsetY+t.x-i.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const ca=new Matrix4,la=new Vector3,ha=new Quaternion;class ua{constructor(e){this.component=e,this.signals={changed:new signalsExports.Signal},this.stage=e.stage,this.viewer=e.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(e,t){ca.copy(this.viewer.rotationGroup.matrix).invert(),la.copy(vt(e)).applyMatrix4(ca),ca.extractRotation(this.component.transform),ca.premultiply(this.viewer.rotationGroup.matrix),ca.invert(),la.copy(vt(e)),la.applyMatrix4(ca),ca.makeRotationAxis(la,t),ha.setFromRotationMatrix(ca),this.component.quaternion.premultiply(ha),this.changed()}}const da={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class ma{constructor(e={}){this.max=10,this.type=nt(e.type,"size"),this.scale=nt(e.scale,1),this.size=nt(e.size,1),this.data=nt(e.data,{})}atomRadius(e){let t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":const n=e.sstruc;t=n==="h"||n==="g"||n==="i"||n==="e"||n==="b"?.25:us.includes(e.atomname)?.4:.1;break;case"data":t=nt(this.data[e.index],1);break;case"explicit":t=e.radius,t===null&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)}}ma.types=da;const fa=new Vector3(-1,-1,-1),pa=new Matrix4;class ga{constructor(e){const t=e.rows,n=t/3,i=new lo(t,3),s=new lo(3,3),o=new lo(1,3),a=new lo(3,3),l=new lo(3,3),d=fo(e);po(e,d),ho(i,e),uo(s,i,i),xo(s,o,a,l);const u=new Vector3(d[0],d[1],d[2]),g=new Vector3(a.data[0],a.data[3],a.data[6]),x=new Vector3(a.data[1],a.data[4],a.data[7]),y=new Vector3(a.data[2],a.data[5],a.data[8]),b=g.clone().multiplyScalar(Math.sqrt(o.data[0]/n)),_=x.clone().multiplyScalar(Math.sqrt(o.data[1]/n)),h=y.clone().multiplyScalar(Math.sqrt(o.data[2]/n));this.begA=u.clone().sub(b),this.endA=u.clone().add(b),this.begB=u.clone().sub(_),this.endB=u.clone().add(_),this.begC=u.clone().sub(h),this.endC=u.clone().add(h),this.center=u,this.vecA=b,this.vecB=_,this.vecC=h,this.normVecA=g,this.normVecB=x,this.normVecC=y}getBasisMatrix(e=new Matrix4){const t=e;return t.makeBasis(this.normVecB,this.normVecA,this.normVecC),t.determinant()<0&&t.scale(fa),t}getRotationQuaternion(e=new Quaternion){const t=e;return t.setFromRotationMatrix(this.getBasisMatrix(pa)),t.invert()}getProjectedScaleForAtoms(e){let t=-1/0,n=-1/0,i=-1/0,s=-1/0,o=-1/0,a=-1/0;const l=new Vector3,d=new Vector3,u=this.center,g=this.normVecA,x=this.normVecB,y=this.normVecC;return e.eachAtom((function(b){jr(l.copy(b),g,u);const _=d.subVectors(l,u).normalize().dot(g),h=l.distanceTo(u);_>0?h>t&&(t=h):h>n&&(n=h),jr(l.copy(b),x,u);const f=d.subVectors(l,u).normalize().dot(x),E=l.distanceTo(u);f>0?E>i&&(i=E):E>s&&(s=E),jr(l.copy(b),y,u);const m=d.subVectors(l,u).normalize().dot(y),S=l.distanceTo(u);m>0?S>o&&(o=S):S>a&&(a=S)})),{d1a:t,d2a:i,d3a:o,d1b:-n,d2b:-s,d3b:-a}}}class ya{constructor(e,t,n,i){this.volume=e,this.setFilter(t,n,i)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(e,t,n){return JSON.stringify([e,t,n])}setFilter(e,t,n){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=e===void 0||isNaN(e)?-1/0:e,t=nt(t,1/0),n=nt(n,!1);const i=this.volume.data,s=this.volume.position,o=this.volume.atomindex,a=this._getFilterHash(e,t,n);if(a!==this._filterHash){if(e===-1/0&&t===1/0)this.data=i,this.position=s,this.atomindex=o;else{const l=i.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*l),this._positionBuffer=new ArrayBuffer(3*l*4),o&&(this._atomindexBuffer=new ArrayBuffer(4*l)));const d=new Float32Array(this._dataBuffer),u=new Float32Array(this._positionBuffer);let g;o&&(g=new Uint32Array(this._atomindexBuffer));let x=0;for(let y=0;y<l;++y){const b=3*y,_=i[y];if(!n&&_>=e&&_<=t||n&&(_<e||_>t)){const h=3*x;d[x]=_,u[h+0]=s[b+0],u[h+1]=s[b+1],u[h+2]=s[b+2],o&&g&&(g[x]=o[y]),x+=1}}this.data=new Float32Array(this._dataBuffer,0,x),this.position=new Float32Array(this._positionBuffer,0,3*x),o&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,x))}this._filterHash=a}}}ya.prototype.getValueForSigma=$o.prototype.getValueForSigma,ya.prototype.getSigmaForValue=$o.prototype.getSigmaForValue,ya.prototype.getDataAtomindex=$o.prototype.getDataAtomindex,ya.prototype.getDataPosition=$o.prototype.getDataPosition,ya.prototype.getDataColor=$o.prototype.getDataColor,ya.prototype.getDataPicking=$o.prototype.getDataPicking,ya.prototype.getDataSize=$o.prototype.getDataSize;class ba{constructor(e,t){const n=$n({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray}}class _a extends Dn{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(e,t,n){this.growIfFull();const i=this.count,s=e.index,o=t.index;s<o?(this.atomIndex1[i]=s,this.atomIndex2[i]=o):(this.atomIndex2[i]=s,this.atomIndex1[i]=o),n&&(this.bondOrder[i]=n),this.count+=1}addBondIfConnected(e,t,n){return!!e.connectedTo(t)&&(this.addBond(e,t,n),!0)}}class xa extends Dn{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(e,t){this.altloc[e]=t.charCodeAt(0)}getAltloc(e){const t=this.altloc[e];return t?String.fromCharCode(t):""}}class va extends Dn{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(e,t){this.sstruc[e]=t.charCodeAt(0)}getSstruc(e){const t=this.sstruc[e];return t?String.fromCharCode(t):""}setInscode(e,t){this.inscode[e]=t.charCodeAt(0)}getInscode(e){const t=this.inscode[e];return t?String.fromCharCode(t):""}}class wa extends Dn{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(e,t){const n=4*e;this.chainname[n]=t.charCodeAt(0),this.chainname[n+1]=t.charCodeAt(1),this.chainname[n+2]=t.charCodeAt(2),this.chainname[n+3]=t.charCodeAt(3)}getChainname(e){let t="";for(let n=0;n<4;++n){const i=this.chainname[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t}setChainid(e,t){const n=4*e;this.chainid[n]=t.charCodeAt(0),this.chainid[n+1]=t.charCodeAt(1),this.chainid[n+2]=t.charCodeAt(2),this.chainid[n+3]=t.charCodeAt(3)}getChainid(e){let t="";for(let n=0;n<4;++n){const i=this.chainid[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t}}class Aa extends Dn{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class Sa{constructor(e){this.polymer=e,this.size=e.residueCount}getCenterIterator(e=0){const t=this.getPosition().center,n=t.length/3;let i=0,s=-1;const o=[new Vector3,new Vector3,new Vector3,new Vector3];return{size:n,next:function(){const a=this.get(s);return s+=1,a},get:function(a){a=Math.min(n-1,Math.max(0,a));const l=o[i%4],d=3*a;if(l.fromArray(t,d),e){const u=Math.min(e,a,n-a-1);for(let g=1;g<=u;++g){const x=3*g,y=(u+1-g)/(u+1);l.x+=y*t[d-x+0]+y*t[d+x+0],l.y+=y*t[d-x+1]+y*t[d+x+1],l.z+=y*t[d-x+2]+y*t[d+x+2]}l.x/=u+1,l.y/=u+1,l.z/=u+1}return i+=1,l},reset:function(){i=0,s=-1}}}getColor(e){const t=this.polymer,n=t.structure,i=t.residueCount,s=t.residueIndexStart,o=new Float32Array(3*i),a=e||{};a.structure=n;const l=Oe.getScheme(a),d=n.getResidueProxy(),u=n.getAtomProxy();for(let g=0;g<i;++g)d.index=s+g,u.index=d.traceAtomIndex,l.atomColorToArray(u,o,3*g);return{color:o}}getPicking(){const e=this.polymer,t=e.structure,n=e.residueCount,i=e.residueIndexStart,s=new Float32Array(n),o=t.getResidueProxy();for(let a=0;a<n;++a)o.index=i+a,s[a]=o.traceAtomIndex;return{picking:new Xs(s,t)}}getSize(e){const t=this.polymer,n=t.structure,i=t.residueCount,s=t.residueIndexStart,o=new Float32Array(i),a=new ma(e),l=n.getResidueProxy(),d=n.getAtomProxy();for(let u=0;u<i;++u)l.index=s+u,d.index=l.traceAtomIndex,o[u]=a.atomRadius(d);return{size:o}}getPosition(){const e=this.polymer,t=e.structure,n=e.residueCount,i=n-3,s=new Float32Array(3*n),o=new Float32Array(3*n),a=new Float32Array(n),l=new Float32Array(n),d=new Float32Array(n),u=new Float32Array(n),g=new Float32Array(3*n),x=new Vector3,y=new Vector3,b=new Vector3,_=new Vector3,h=new Vector3,f=new Vector3,E=new Vector3,m=new Vector3,S=new Vector3,w=new Vector3,v=new Vector3,A=new Vector3(0,0,0),M="trace",T=t.getAtomProxy(),R=t.getAtomProxy(e.getAtomIndexByType(0,M)),O=t.getAtomProxy(e.getAtomIndexByType(1,M)),L=t.getAtomProxy(e.getAtomIndexByType(2,M));for(let k=0;k<i;++k){T.index=R.index,R.index=O.index,O.index=L.index,L.index=e.getAtomIndexByType(k+3,M);const j=3*k;x.subVectors(R,T),y.subVectors(O,R),b.subVectors(L,O),_.subVectors(x,y),h.subVectors(y,b),S.crossVectors(_,h).normalize(),S.toArray(o,j),k>0&&(a[k]=S.angleTo(w));const H=Math.cos(_.angleTo(h));u[k]=180/Math.PI*Math.acos(H);const B=_.length(),V=h.length();l[k]=Math.sqrt(V*B)/Math.max(2,2*(1-H)),d[k]=Math.abs(y.dot(S)),f.copy(_).multiplyScalar(l[k]/B),E.copy(h).multiplyScalar(l[k]/V),f.subVectors(R,f),E.subVectors(O,E),f.toArray(s,j+3),E.toArray(s,j+6),v.subVectors(T,A),v.toArray(g,j),w.copy(S),A.copy(f)}f.fromArray(s,3),E.fromArray(s,6),S.subVectors(f,E).normalize(),T.index=e.getAtomIndexByType(0,M),A.copy(T),m.copy(T),jr(m,S,f),m.toArray(s,0),v.subVectors(A,f),v.toArray(g,0),f.fromArray(s,3*n-6),E.fromArray(s,3*n-9),S.subVectors(f,E).normalize(),T.index=e.getAtomIndexByType(n-1,M),A.copy(T),m.copy(T),jr(m,S,f),m.toArray(s,3*n-3);for(let k=n-3;k<n;++k)f.fromArray(s,3*k),T.index=e.getAtomIndexByType(k,M),A.copy(T),v.subVectors(A,f),v.toArray(g,3*k);const P=new Float32Array(n),I=new Float32Array(n),N=new Float32Array(n),U=new Float32Array(n);P[1]=l[0],I[1]=u[0],N[1]=l[0];for(let k=2;k<n-2;++k)P[k]=.5*(l[k-2]+l[k-1]),I[k]=.5*(u[k-2]+u[k-1]),N[k]=.5*(d[k-2]+d[k-1]),f.fromArray(o,3*(k-2)),E.fromArray(o,3*(k-1)),U[k]=180/Math.PI*Math.acos(Math.cos(f.angleTo(E)));P[n-2]=l[n-4],I[n-2]=u[n-4],N[n-2]=d[n-4];const F=new Float32Array(3*n);ki(o,F,0,0,3),ki(o,F,0,3,3);for(let k=2;k<n-2;++k)f.fromArray(o,3*(k-2)),E.fromArray(o,3*(k-1)),S.addVectors(E,f).multiplyScalar(.5).normalize(),S.toArray(F,3*k);return ki(o,F,3*n-12,3*n-6,3),ki(o,F,3*n-12,3*n-3,3),{center:s,axis:F,bending:U,radius:P,rise:N,twist:I,resdir:g}}}class Ca{constructor(e){this.polymer=e,this.helixorient=new Sa(e),this.position=this.helixorient.getPosition()}getAxis(e,t,n,i,s){e=e||30,t=t||2.5,n=n!==void 0&&n;const o=this.polymer,a=o.structure,l=o.residueCount,d=o.residueIndexStart,u=this.position,g=i||{};g.structure=a;const x=Oe.getScheme(g),y=new ma(s);let b=0,_=0;const h=[],f=[],E=[],m=[],S=[],w=[],v=[],A=[],M=[];let T,R,O=new Float32Array(3*l),L=new Float32Array(3*l);const P=new Vector3,I=new Vector3,N=a.getResidueProxy(),U=a.getResidueProxy(),F=a.getAtomProxy(),k=new Vector3,j=new Vector3;let H=!1;for(let V=0;V<l;++V)if(N.index=d+V,k.fromArray(u.center,3*V),V===l-1?H=!0:(U.index=d+V+1,j.fromArray(u.center,3*V+3),(n&&N.sstruc!==U.sstruc||k.distanceTo(j)>t||u.bending[V]>e)&&(H=!0)),H){if(V-b<4){b=V,H=!1;continue}F.index=N.traceAtomIndex,O=u.axis.subarray(3*b+3,3*V),L=u.center.subarray(3*b,3*V+3),T=Vr(O).normalize(),R=Vr(L),P.fromArray(L),jr(P,T,R),I.fromArray(L,L.length-3),jr(I,T,R),T.subVectors(I,P),T.toArray(h,_),R.toArray(f,_),P.toArray(E,_),I.toArray(m,_),x.atomColorToArray(F,S,_),w.push(F.index),v.push(y.atomRadius(F)),A.push(d+b),M.push(d+V+1-b),_+=3,b=V,H=!1}const B=new Float32Array(w);return{axis:new Float32Array(h),center:new Float32Array(f),begin:new Float32Array(E),end:new Float32Array(m),color:new Float32Array(S),picking:new Xs(B,a),size:new Float32Array(v),residueOffset:A,residueCount:M}}}class Pa{constructor(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.bubbleUp(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}peek(){return this.content[0]}remove(e){const t=this.content.length;for(let n=0;n<t;n++)if(this.content[n]===e){const i=this.content.pop();return void(i&&n!==t-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(e){const t=this.content[e];for(;e>0;){const n=Math.floor((e+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[n]=t,this.content[e]=i,e=n}}sinkDown(e){const t=this.content.length,n=this.content[e],i=this.scoreFunction(n);let s=0,o=0;for(;;){const a=2*(e+1),l=a-1;let d=null;if(l<t){const u=this.content[l];s=this.scoreFunction(u),s<i&&(d=l)}if(a<t){const u=this.content[a];o=this.scoreFunction(u),o<(d===null?i:s)&&(d=a)}if(d===null)break;this.content[e]=this.content[d],this.content[d]=n,e=d}}}class Ia{constructor(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;const n=e.length/3,i=new Uint32Array(n);for(let s=0;s<n;++s)i[s]=s;this.indices=i,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)}buildTree(e,t,n,i){e>this.maxDepth&&(this.maxDepth=e);const s=i-n;if(s===0)return-1;const o=4*this.currentNode,a=this.nodes;if(this.currentNode+=1,s===1)return a[o]=n,a[o+1]=-1,a[o+2]=-1,a[o+3]=t,o;const l=this.indices,d=this.points,u=n+Math.floor(s/2),g=e%3;let x,y,b,_,h,f=n,E=i-1;for(;E>f;){for(b=f+E>>1,_=d[3*l[b]+g],y=l[b],l[b]=l[E],l[E]=y,h=f,x=f;x<E;++x)d[3*l[x]+g]<_&&(y=l[h],l[h]=l[x],l[x]=y,++h);if(y=l[E],l[E]=l[h],l[h]=y,b=h,u===b)break;u<b?E=b-1:f=b+1}return a[o]=u,a[o+1]=this.buildTree(e+1,o,n,u),a[o+2]=this.buildTree(e+1,o,u+1,i),a[o+3]=t,o}getNodeDepth(e){const t=this.nodes[e+3];return t===-1?0:this.getNodeDepth(t)+1}nearest(e,t,n){const i=new Pa((u=>-u[1])),s=this.nodes,o=this.points,a=this.indices,l=u=>{let g,x;const y=this.getNodeDepth(u)%3,b=3*a[s[u]],_=[o[b+0],o[b+1],o[b+2]],h=this.metric(e,_);function f(v,A){i.push([v,A]),i.size()>t&&i.pop()}const E=s[u+1],m=s[u+2];if(m===-1&&E===-1)return void((i.size()<t||h<i.peek()[1])&&h<=n&&f(u,h));g=m===-1?E:E===-1?m:e[y]<=o[b+y]?E:m,l(g),(i.size()<t||h<i.peek()[1])&&h<=n&&f(u,h);const S=[];for(let v=0;v<3;v+=1)S[v]=v===y?e[v]:o[b+v];const w=this.metric(S,_);(i.size()<t||Math.abs(w)<i.peek()[1])&&Math.abs(w)<=n&&(x=g===E?m:E,x!==-1&&l(x))};l(this.rootIndex);const d=[];for(let u=0,g=Math.min(i.size(),t);u<g;u+=1)d.push(i.content[u]);return d}verify(e,t=0){let n=1;if(e===void 0&&(e=this.rootIndex),e===-1)throw new Error("node is null");const i=t%3,s=this.nodes,o=this.points,a=this.indices,l=s[e+1],d=s[e+2];if(l!==-1){if(o[3*a[s[l]]+i]>o[3*a[s[e]]+i])throw new Error("left child is > parent!");n+=this.verify(l,t+1)}if(d!==-1){if(o[3*a[s[d]]+i]<o[3*a[s[e]]+i])throw new Error("right child is < parent!");n+=this.verify(d,t+1)}return n}}class ka{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(e){this.atomStore.residueIndex[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(e){this.atomStore.x[this.index]=e}get y(){return this.atomStore.y[this.index]}set y(e){this.atomStore.y[this.index]=e}get z(){return this.atomStore.z[this.index]}set z(e){this.atomStore.z[this.index]=e}get serial(){return this.atomStore.serial[this.index]}set serial(e){this.atomStore.serial[this.index]=e}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(e){this.atomStore.bfactor[this.index]=e}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(e){this.atomStore.occupancy[this.index]=e}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(e){this.atomStore.setAltloc(this.index,e)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(e,t){t=t||this.structure._bp;const n=this.index,i=this.bondHash,s=i.indexArray,o=i.countArray[n],a=i.offsetArray[n];for(let l=0;l<o;++l)t.index=s[a+l],e(t)}eachBondedAtom(e,t){const n=t||this.structure._ap,i=this.index;this.eachBond((function(s){n.index=i!==s.atomIndex1?s.atomIndex1:s.atomIndex2,e(n)})),this.index=i}hasBondTo(e){let t=!1;return this.eachBondedAtom((function(n){e.index===n.index&&(t=!0)})),t}bondToElementCount(e){let t=0;const n=this.index;return this.eachBondedAtom((function(i){i.number===e&&(t+=1)})),this.index=n,t}hasBondToElement(e){return this.bondToElementCount(e)>0}isBackbone(){const e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return this.residueType.hetero===1}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isHelix(){return Hn.includes(this.sstruc)}isSheet(){return qn.includes(this.sstruc)}isTurn(){return Wn.includes(this.sstruc)&&this.isProtein()}isBonded(){return this.bondHash.countArray[this.index]!==0}isRing(){return this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]!==void 0}isAromatic(){return this.aromatic===1}isPolarHydrogen(){let e=!1;return this.number!==1||(e=!this.hasBondToElement(6)),e}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(e){const t=this.atomStore,n=e.atomStore,i=this.index,s=e.index,o=t.x[i]-n.x[s],a=t.y[i]-n.y[s],l=t.z[i]-n.z[s],d=o*o+a*a+l*l;return Math.sqrt(d)}connectedTo(e){const t=this.atomStore,n=e.atomStore,i=this.index,s=e.index;if(t.altloc&&n.altloc){const y=t.altloc[i],b=n.altloc[s];if(y!==0&&b!==0&&y!==32&&b!==32&&y!==b)return!1}const o=t.x[i]-n.x[s],a=t.y[i]-n.y[s],l=t.z[i]-n.z[s],d=o*o+a*a+l*l;if(d<48&&this.isCg())return!0;if(isNaN(d))return!1;const u=this.covalent+e.covalent,g=u+.3,x=u-.5;return d<g*g&&d>x*x}positionFromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}positionToArray(e=[],t=0){const n=this.index,i=this.atomStore;return e[t+0]=i.x[n],e[t+1]=i.y[n],e[t+2]=i.z[n],e}positionToVector3(e){return e===void 0&&(e=new Vector3),e.x=this.x,e.y=this.y,e.z=this.z,e}positionFromVector3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}positionAdd(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}positionSub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}getResidueBonds(e=!1){const t=this.residueAtomOffset,n=this.index-this.residueAtomOffset,i=this.residueType.getBonds(),s=i.atomIndices1,o=i.atomIndices2;let a,l,d,u;for(e||(u=[]),a=s.indexOf(n);a!==-1;){if(d=o[a]+t,!u)return d;u.push(d),a=s.indexOf(n,a+1)}for(l=o.indexOf(n);l!==-1;){if(d=s[l]+t,!u)return d;u.push(d),l=o.indexOf(n,l+1)}return u}qualifiedName(e=!1){var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t}clone(){return new ka(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function Ma(r,e){const t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function Ta(r,e){return Math.sqrt(Ma(r,e))}const Da=new Float32Array(3);class Ba{constructor(e,t=!1){De&&ke.time("Kdtree build");const n=t?Ma:Ta,i=new Float32Array(3*e.atomCount),s=new Uint32Array(e.atomCount);let o=0;e.eachAtom((function(a){i[o+0]=a.x,i[o+1]=a.y,i[o+2]=a.z,s[o/3]=a.index,o+=3})),this.atomIndices=s,this.points=i,this.kdtree=new Ia(i,n),De&&ke.timeEnd("Kdtree build")}nearest(e,t,n){e instanceof Vector3?e.toArray(Da):e instanceof ka&&e.positionToArray(Da);const i=this.kdtree.nearest(Da,t,n),s=this.kdtree.indices,o=this.kdtree.nodes,a=this.atomIndices,l=[];for(let d=0,u=i.length;d<u;++d){const g=i[d],x=g[0],y=g[1];l.push({index:a[s[o[x]]],distance:y})}return l}}const Fa={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},Ea={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},$a=/^[1-9]$/;function Oa(r){let e="";return r.length>0&&(e=":"+pt(r).join(" OR :")),new me(e)}class Ra{constructor(e=""){this.name=e,this.partList=[]}get type(){return"Assembly"}addPart(e,t){const n=new La(e,t);return this.partList.push(n),n}getAtomCount(e){return this.partList.reduce(((t,n)=>t+n.getAtomCount(e)),0)}getResidueCount(e){return this.partList.reduce(((t,n)=>t+n.getResidueCount(e)),0)}getInstanceCount(){let e=0;return this.partList.forEach((function(t){e+=t.matrixList.length})),e}isIdentity(e){if(this.partList.length!==1)return!1;const t=this.partList[0];if(t.matrixList.length!==1||!new Matrix4().equals(t.matrixList[0]))return!1;let n=[];return e.eachChain((function(i){n.push(i.chainname)})),n=pt(n),t.chainList.length===n.length}getBoundingBox(e){const t=new Box3;return this.partList.forEach((function(n){const i=n.getBoundingBox(e);t.expandByPoint(i.min),t.expandByPoint(i.max)})),t}getCenter(e){return this.getBoundingBox(e).getCenter(new Vector3)}getSelection(){let e=[];return this.partList.forEach((function(t){e=e.concat(t.chainList)})),Oa(e)}}class La{constructor(e=[],t=[]){this.matrixList=e,this.chainList=t}get type(){return"AssemblyPart"}_getCount(e,t){let n=0;return e.eachChain((i=>{(this.chainList.length===0||this.chainList.includes(i.chainname))&&(n+=i[t])})),this.matrixList.length*n}getAtomCount(e){return this._getCount(e,"atomCount")}getResidueCount(e){return this._getCount(e,"residueCount")}getBoundingBox(e){const t=new Box3,n=new Box3,i=this.getSelection(),s=e.getBoundingBox(i);return this.matrixList.forEach((function(o){n.copy(s).applyMatrix4(o),t.expandByPoint(n.min),t.expandByPoint(n.max)})),t}getSelection(){return Oa(this.chainList)}getView(e){const t=this.getSelection();return t?e.getView(t):e}getInstanceList(){const e=[];for(let t=0,n=this.matrixList.length;t<n;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e}}class Na{constructor(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(e){var t,n;const i=this.structure.atomStore,s=this.structure.residueStore,o=this.structure.residueMap,a=(t=this.structure.chemCompMap)===null||t===void 0?void 0:t.dict[this.previousResname],l=s.atomCount[e],d=s.atomOffset[e],u=new Array(l);for(let y=0;y<l;++y)u[y]=i.atomTypeId[d+y];const g=a?.chemCompType,x=a?(n=this.structure.chemCompMap)===null||n===void 0?void 0:n.getBonds(this.previousResname,u):void 0;s.residueTypeId[e]=o.add(this.previousResname,u,this.previousHetero,g,x)}addAtom(e,t,n,i,s,o,a,l){const d=this.structure.atomStore,u=this.structure.residueStore,g=this.structure.chainStore,x=this.structure.modelStore;let y=!1,b=!1,_=!1;this.currentModelindex!==e?(y=!0,b=!0,_=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(b=!0,_=!0,this.ci+=1,this.ri+=1):this.currentResno===s&&this.currentResname===i&&this.currentInscode===l||(_=!0,this.ri+=1),this.ai+=1,y&&(x.growIfFull(),x.chainOffset[this.mi]=this.ci,x.chainCount[this.mi]=0,x.count+=1,g.modelIndex[this.ci]=this.mi),b&&(g.growIfFull(),g.setChainname(this.ci,t),g.setChainid(this.ci,n),g.residueOffset[this.ci]=this.ri,g.residueCount[this.ci]=0,g.count+=1,g.modelIndex[this.ci]=this.mi,x.chainCount[this.mi]+=1,u.chainIndex[this.ri]=this.ci),_&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),u.growIfFull(),u.resno[this.ri]=s,a!==void 0&&(u.sstruc[this.ri]=a.charCodeAt(0)),l!==void 0&&(u.inscode[this.ri]=l.charCodeAt(0)),u.atomOffset[this.ri]=this.ai,u.atomCount[this.ri]=0,u.count+=1,u.chainIndex[this.ri]=this.ci,g.residueCount[this.ci]+=1),d.count+=1,d.residueIndex[this.ai]=this.ri,u.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=n,this.currentResname=i,this.currentResno=s,this.currentInscode=l,this.currentHetero=o}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function za(r,e){if(!e)return;De&&ke.time("assignSecondaryStructure");const t=[];r.eachModel((function(d){d.eachChain((function(u){t.push(u.chainname)}))}));const n=t.slice().sort(),i=[];n.forEach((function(d){i.push(t.indexOf(d))}));const s=e.helices.filter((function(d){return mt(n,d[0])>=0}));s.sort((function(d,u){const g=d[0],x=u[0],y=d[1],b=u[1];if(g===x)return y===b?0:y<b?-1:1;{const _=mt(n,g),h=mt(n,x);return i[_]<i[h]?-1:1}}));const o=r.residueStore;r.eachModel((function(d){let u=0;const g=s.length;if(g===0)return;let x=s[u],y=!1,b=!1;d.eachChain((function(_){let h=!1;if(_.chainname===x[0]){const f=_.residueCount,E=_.residueOffset,m=E+f;for(let S=E;S<m;++S)if(o.resno[S]===x[1]&&o.getInscode(S)===x[2]&&(y=!0),y&&(o.sstruc[S]=x[6],o.resno[S]===x[4]&&o.getInscode(S)===x[5]&&(y=!1,u+=1,u<g?(S=E-1,x=s[u],h=_.chainname!==x[0]):b=!0)),h||b)return}}))}));const a=e.sheets.filter((function(d){return mt(n,d[0])>=0}));a.sort((function(d,u){const g=d[0],x=u[0];if(g===x)return 0;const y=mt(n,g),b=mt(n,x);return i[y]<i[b]?-1:1}));const l=101;r.eachModel((function(d){let u=0;const g=a.length;if(g===0)return;let x=a[u],y=!1,b=!1;d.eachChain((function(_){let h=!1;if(_.chainname===x[0]){const f=_.residueCount,E=_.residueOffset,m=E+f;for(let S=E;S<m;++S)if(o.resno[S]===x[1]&&o.getInscode(S)===x[2]&&(y=!0),y&&(o.sstruc[S]=l,o.resno[S]===x[4]&&o.getInscode(S)===x[5]&&(y=!1,u+=1,u<g?(S=E-1,x=a[u],h=_.chainname!==x[0]):b=!0)),h||b)return}}))})),De&&ke.timeEnd("assignSecondaryStructure")}const Ua=(function(){const r=function(n,i,s,o){const a=n.structure,l=n.residueIndexStart,d=a.getResidueProxy(),u=a.getResidueProxy(),g=a.getAtomProxy(),x=a.getAtomProxy();for(let y=Math.max(0,i-2);y<=i;++y)for(let b=2;b<5;++b){if(y+b>=n.residueCount)continue;d.index=l+y,u.index=l+y+b,g.index=d.traceAtomIndex,x.index=u.traceAtomIndex;const _=g.distanceTo(x);if(Math.abs(_-s[b-2])>o)return!1}return!0},e=function(n,i){return r(n,i,[5.45,5.18,6.37],2.1)},t=function(n,i){return r(n,i,[6.1,10.4,13],1.42)};return function(n){De&&ke.time("calculateSecondaryStructure"),n.eachPolymer((function(i){if(i.residueCount<4)return;if(i.isCg())(function(a){const l=a.residueStore,d=a.residueIndexStart,u=new Ca(a).position,g=new Vector3,x=new Vector3;for(let y=0,b=a.residueCount;y<b;++y){g.fromArray(u.center,3*y),x.fromArray(u.center,3*y+3);const _=g.distanceTo(x);_<2&&_>1&&u.bending[y]<20&&(l.sstruc[d+y]=104,l.sstruc[d+y+1]=104)}})(i);else{if(!i.isProtein())return;(function(a){const l=a.residueStore,d=a.residueIndexStart;for(let u=0,g=a.residueCount;u<g;++u){let x="c";e(a,u)?x="h":t(a,u)&&(x="e"),l.sstruc[d+u]=x.charCodeAt(0)}})(i)}let s,o=0;i.eachResidue((function(a){a.sstruc===s?o+=1:(o===1&&(a.index-=1,a.sstruc="c"),o=1,s=a.sstruc)}))})),De&&ke.timeEnd("calculateSecondaryStructure")}})(),Va="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function ja(r){const e=Va.length;let t=r,n=0,i=Va[t%e];for(;t>=e;)t=Math.floor(t/e),i+=Va[t%e],n+=1;return n>=5&&ke.warn("chainname overflow"),i}function Ga(r,e=!1){De&&ke.time("calculateChainnames");let t=!0;if(r.eachChain((function(n){n.chainname&&(t=!1)})),t){const n=r.modelStore,i=r.chainStore,s=r.residueStore,o=function(_,h,f,E){const m=i.count;for(let S=0;S<E;++S)s.chainIndex[f+S]=m;i.growIfFull(),i.modelIndex[m]=_,i.setChainname(m,h),i.setChainid(m,h),i.residueOffset[m]=f,i.residueCount[m]=E,i.count+=1,n.chainCount[_]+=1},a=r.getAtomProxy(),l=r.getAtomProxy();let d=0,u=0,g=0,x=0;const y=[];s.count===1?y.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):r.eachResidueN(2,(function(_,h){let f=!1;const E=_.backboneType,m=h.backboneType,S=Nn;x=_.index,_.modelIndex!==h.modelIndex||_.moleculeType!==h.moleculeType?f=!0:E!==S&&E===m&&(a.index=_.backboneEndAtomIndex,l.index=h.backboneStartAtomIndex,f=e?!a.hasBondTo(l):!a.connectedTo(l)),f||h.index!==s.count-1||(f=!0,x=h.index),f&&(y.push({mIndex:u,chainname:ja(d),rStart:g,rCount:x-g+1}),d+=1,_.modelIndex!==h.modelIndex&&(d=0,u+=1),h.index===s.count-1&&x!==h.index&&y.push({mIndex:u,chainname:ja(d),rStart:s.count-1,rCount:1}),g=h.index,x=h.index)})),i.count=0,n.chainCount.fill(0,0,n.count),n.chainOffset.fill(0,0,n.count),y.forEach((function(_){o(_.mIndex,_.chainname,_.rStart,_.rCount)}));let b=0;r.eachModel((function(_){n.chainOffset[_.index]=b,b+=n.chainCount[_.index]}))}De&&ke.timeEnd("calculateChainnames")}function Ha(r,e="all"){e!=="none"&&(De&&ke.time("calculateBonds"),Xa(r,!1,e),Ya(r),De&&ke.timeEnd("calculateBonds"))}const qa={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function Wa(r,e,t){return[e,t]=e<t?[e,t]:[t,e],is.includes(r)&&e==="C"&&t==="O"||os.includes(r)&&e==="OP1"&&t==="P"?2:qa[`${r}|${e}|${t}`]||1}function Xa(r,e=!1,t="all"){De&&ke.time("calculateBondsWithin");const n=r.bondStore,i=r.rungBondStore,s=r.getAtomSet(!1),o=r.getAtomProxy(),a=r.getAtomProxy(),l=r.getBondProxy(),d=e?null:(function(g){De&&ke.time("calculateAtomBondMap");var x=[];return g.eachBond((function(y){var b=y.atomIndex1,_=y.atomIndex2;x[b]===void 0&&(x[b]=[]),x[b][_]=y.index})),De&&ke.timeEnd("calculateAtomBondMap"),x})(r);let u;e||t!=="auto"||(u=new Set,d.forEach(((g,x)=>{u.add(x),g.forEach((y=>{u.add(y)}))}))),r.eachResidue((function(g){if(!e&&d){const b=g.atomCount,_=g.atomOffset;if(b>500)return void ke.warn("more than 500 atoms, skip residue for auto-bonding",g.qualifiedName());if(t==="auto"&&g.hetero){for(let w=g.atomOffset;w<g.atomEnd;w++)if(u.has(w))return}const h=g.getBonds(),f=h.atomIndices1,E=h.atomIndices2,m=h.bondOrders,S=f.length;for(let w=0;w<S;++w){const v=f[w],A=E[w],M=v+_,T=A+_,R=d[M];R!==void 0&&R[T]!==void 0?(l.index=R[T],m[g.residueType.getBondIndex(v,A)]=l.bondOrder):(o.index=M,a.index=T,n.addBond(o,a,m[w]))}}const x=g.residueType.traceAtomIndex,y=g.residueType.rungEndAtomIndex;x!==-1&&y!==-1&&(o.index=g.traceAtomIndex,a.index=g.rungEndAtomIndex,i.addBond(o,a),s.set(o.index),s.set(a.index))})),r.atomSetDict.rung=s,De&&ke.timeEnd("calculateBondsWithin")}function Ya(r,e=!1,t=!1){De&&ke.time("calculateBondsBetween");const n=r.bondStore,i=r.backboneBondStore,s=r.getAtomSet(!1),o=r.getAtomProxy(),a=r.getAtomProxy();function l(g,x){const y=g.backboneType,b=x.backboneType;if(y!==Nn&&y===b){o.index=g.backboneEndAtomIndex,a.index=x.backboneStartAtomIndex;let _=!1,h=!1;t&&o.hasBondTo(a)?(_=!1,h=!0):o.connectedTo(a)&&(_=!e,h=!0),_&&n.addBond(o,a,1),h&&(o.index=g.traceAtomIndex,a.index=x.traceAtomIndex,i.addBond(o,a),s.set(o.index),s.set(a.index))}}i.count===0&&i.resize(r.residueStore.count),r.eachResidueN(2,l);const d=r.getResidueProxy(),u=r.getResidueProxy();if(r.eachChain((function(g){g.residueCount!==0&&(d.index=g.residueOffset,u.index=g.residueOffset+g.residueCount-1,l(u,d))})),r.atomSetDict.backbone=s,!e){De&&ke.time("calculateBondsBetween inter");const g=r.spatialHash;r.eachResidue((function(x){x.backboneType!==Nn||x.isWater()||x.eachAtom((function(y){y.isMetal()||g.eachWithin(y.x,y.y,y.z,4,(function(b){a.index=b,y.modelIndex!==a.modelIndex||y.residueIndex===a.residueIndex||a.isMetal()||n.addBondIfConnected(y,a,1)}))}))})),De&&ke.timeEnd("calculateBondsBetween inter")}De&&ke.timeEnd("calculateBondsBetween")}function Ka(r){if(!r.unitcell)return;De&&ke.time("buildUnitcellAssembly");const e=r.unitcell,t=r.center.clone().applyMatrix4(e.cartToFrac),n=t.clone().floor(),i=(function(b){const _=Ea[b],h={};if(_===void 0)return console.warn(`spacegroup '${b}' not found in symop library`),h;const f=[];for(let E=0,m=_.length;E<m;E+=3){const S=[];for(let w=0;w<3;++w)S.push(Fa[_[E+w]]);f.push(S)}return f.forEach((function(E){let m=0;const S=new Matrix4().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),w=S.elements;h[E.toString()]=S,E.forEach((function(v){let A=!1,M=!1;for(let T=0,R=v.length;T<R;++T){const O=v[T];if(O==="-")A=!0;else if(O==="+")A=!1;else if(O==="/")M=!0;else if(O==="X")w[0+m]=A?-1:1;else if(O==="Y")w[4+m]=A?-1:1;else if(O==="Z")w[8+m]=A?-1:1;else if($a.test(O)){const L=parseInt(O);M?w[12+m]/=L:w[12+m]=L}else ke.warn(`getSymmetryOperations: unknown token '${O}'`)}m+=1}))})),h})(e.spacegroup),s=new Vector3,o=new Vector3;function a(b){const _=[];return Object.keys(i).forEach((function(h){const f=i[h].clone();s.copy(t).applyMatrix4(f).floor(),o.setFromMatrixPosition(f),o.sub(s),o.add(n),b&&o.add(b),f.setPosition(o),f.multiplyMatrices(e.fracToCart,f),f.multiply(e.cartToFrac),_.push(f)})),_}const l=new Ra("UNITCELL"),d=a(),u=[];if(r.biomolDict.NCS){u.push(new Matrix4,...r.biomolDict.NCS.partList[0].matrixList);const b=[];d.forEach((_=>{u.forEach((h=>{b.push(_.clone().multiply(h))}))})),l.addPart(b)}else l.addPart(d);const g=new Vector3,x=new Ra("SUPERCELL"),y=Array.prototype.concat.call(a(g.set(1,0,0)),a(g.set(0,1,0)),a(g.set(0,0,1)),a(g.set(-1,0,0)),a(g.set(0,-1,0)),a(g.set(0,0,-1)),a(g.set(1,1,0)),a(g.set(1,0,1)),a(g.set(0,1,1)),a(g.set(-1,-1,0)),a(g.set(-1,0,-1)),a(g.set(0,-1,-1)),a(g.set(1,-1,-1)),a(g.set(1,1,-1)),a(g.set(1,-1,1)),a(g.set(-1,1,1)),a(g.set(-1,-1,1)),a(g.set(-1,1,-1)),a(g.set(0,1,-1)),a(g.set(0,-1,1)),a(g.set(1,0,-1)),a(g.set(-1,0,1)),a(g.set(1,-1,0)),a(g.set(-1,1,0)),a(),a(g.set(1,1,1)),a(g.set(-1,-1,-1)));if(r.biomolDict.NCS){const b=[];y.forEach((function(_){u.forEach((function(h){b.push(_.clone().multiply(h))}))})),x.addPart(b)}else x.addPart(y);r.biomolDict.UNITCELL=l,r.biomolDict.SUPERCELL=x,De&&ke.timeEnd("buildUnitcellAssembly")}const Za=["H","C","O","N","S","P"],Qa=["NA","CL","FE"];function Ja(r){let e=r.toUpperCase(),t=0,n=0;for(let s=0;s<e.length;s++)if(e.charCodeAt(s)<65){if(n>0)break;++t}else n=s+1;(t>0||n<e.length)&&(e=e.substring(t,n));const i=e.length;if(i===0)return"";if(i===1)return e;if(i===2){if(Qa.indexOf(e)!==-1)return e;if(Za.indexOf(e[0])!==-1)return e[0];if(e in Xn)return e}return i>=3&&Za.indexOf(e[0])!==-1?e[0]:""}function tc(r){const e=r.bondHash,t=e.countArray,n=e.offsetArray,i=e.indexArray,s=r.getBondProxy();r.eachResidue((function(o){const a=o.residueType;if(a.bonds!==void 0)return;var l=o.atomOffset,d=[],u=[],g=[],x={};const y=l+o.atomCount;o.eachAtom((function(b){const _=b.index,h=n[_];for(let f=0,E=t[_];f<E;++f){s.index=i[h+f];let m=s.atomIndex1;if(m<l||m>=y)continue;let S=s.atomIndex2;if(S<l||S>=y)continue;if(m>S){const v=S;S=m,m=v}const w=m+"|"+S;x[w]===void 0&&(x[w]=!0,d.push(m-l),u.push(S-l),g.push(s.bondOrder))}})),a.bonds={atomIndices1:d,atomIndices2:u,bondOrders:g}}))}const ic=[3,11,19,37,55,87],rc=[4,12,20,38,56,88],nc=[6,15,16,34],sc=[1,7,8,9,17,35,53],oc=[2,10,18,36,54,86],ac=[13,30,31,48,49,50,80,81,82,83,84,85,112],cc=[5,14,32,33,51,52,85],lc=[9,17,35,53,85];class hc{constructor(e,t,n){this.structure=e,this.atomname=t,n=n||Ja(t),this.element=n,this.number=Xn[n]||0,this.vdw=Yn[this.number]||2,this.covalent=Kn[this.number]||1.6}getDefaultValence(){const e=Zn[this.number];return e?e[0]:-1}getValenceList(){return Zn[this.number]||[]}getOuterShellElectronCount(){return Qn[this.number]||2}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return cc.includes(this.number)}isHalogen(){return lc.includes(this.number)}isDiatomicNonmetal(){return sc.includes(this.number)}isPolyatomicNonmetal(){return nc.includes(this.number)}isAlkaliMetal(){return ic.includes(this.number)}isAlkalineEarthMetal(){return rc.includes(this.number)}isNobleGas(){return oc.includes(this.number)}isTransitionMetal(){const e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108}isPostTransitionMetal(){return ac.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}class uc{constructor(e){this.structure=e,this.dict={},this.list=[],this.structure=e}add(e,t){const n=(function(s,o){return s+"|"+o})(e=e.toUpperCase(),t=t?t.toUpperCase():Ja(e));let i=this.dict[n];if(i===void 0){const s=new hc(this.structure,e,t);i=this.list.length,this.dict[n]=i,this.list.push(s)}return i}get(e){return this.list[e]}}class dc{constructor(e,t,n,i,s,o){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=n,this.hetero=i?1:0,this.chemCompType=s,this.bonds=o,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const a=ds[this.backboneType],l=ds[this.backboneStartType],d=ds[this.backboneEndType],u=this.getAtomIndexByName(a.trace);this.traceAtomIndex=nt(u,-1);const g=this.getAtomIndexByName(a.direction1);this.direction1AtomIndex=nt(g,-1);const x=this.getAtomIndexByName(a.direction2);this.direction2AtomIndex=nt(x,-1);const y=this.getAtomIndexByName(l.backboneStart);this.backboneStartAtomIndex=nt(y,-1);const b=this.getAtomIndexByName(d.backboneEnd);let _;this.backboneEndAtomIndex=nt(b,-1),_=ss.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=nt(_,-1)}getBackboneIndexList(){const e=[];let t;switch(this.moleculeType){case 3:t=hs;break;case 4:case 5:t=us;break;default:return e}const n=this.structure.atomMap,i=this.atomTypeIdList;for(let s=0,o=this.atomCount;s<o;++s){const a=n.get(i[s]);t.includes(a.atomname)&&e.push(s)}return e}getMoleculeType(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0}getBackboneType(e){return this.hasProteinBackbone(e)?1:this.hasRnaBackbone(e)?2:this.hasDnaBackbone(e)?3:this.hasCgProteinBackbone(e)?4:this.hasCgRnaBackbone(e)?5:this.hasCgDnaBackbone(e)?6:Nn}isProtein(){return this.chemCompType?zn.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||is.includes(this.resname)}isCg(){const e=this.backboneType;return e===4||e===5||e===6}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?Un.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||rs.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?Vn.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||ns.includes(this.resname))}isHetero(){return this.hetero===1}isIon(){return cs.includes(this.resname)}isWater(){return as.includes(this.resname)}isSaccharide(){return this.chemCompType?jn.includes(this.chemCompType):ls.includes(this.resname)}isStandardAminoacid(){return is.includes(this.resname)}isStandardBase(){return os.includes(this.resname)}hasBackboneAtoms(e,t){const n=ds[t];return e===-1?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):e===0?this.hasAtomWithName(n.trace,n.direction1,n.direction2):e===1?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)}hasProteinBackbone(e){return this.isProtein()&&this.hasBackboneAtoms(e,1)}hasRnaBackbone(e){return this.isRna()&&this.hasBackboneAtoms(e,2)}hasDnaBackbone(e){return this.isDna()&&this.hasBackboneAtoms(e,3)}hasCgProteinBackbone(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,4)}hasCgRnaBackbone(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,5)}hasCgDnaBackbone(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,6)}hasBackbone(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)}getAtomIndexByName(e){const t=this.atomCount,n=this.structure.atomMap,i=this.atomTypeIdList;if(Array.isArray(e))for(let s=0;s<t;++s){const o=i[s];if(e.includes(n.get(o).atomname))return s}else for(let s=0;s<t;++s){const o=i[s];if(e===n.get(o).atomname)return s}}hasAtomWithName(...e){const t=e.length;for(let n=0;n<t;++n)if(e[n]!==void 0&&this.getAtomIndexByName(e[n])===void 0)return!1;return!0}getBonds(e){return this.bonds===void 0&&(this.bonds=(function(t){const n=t.structure,i=n.getAtomProxy(),s=n.getAtomProxy(),o=t.atomCount,a=t.atomOffset,l=a+o-1,d=[],u=[],g=[];if(o>500)De&&ke.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());else if(o>50){const x=new Ba(t,!0),y=t.isCg()?1.2:2.3;for(let b=a;b<l;++b){i.index=b;const _=i.covalent+y+.3,h=x.nearest(i,1/0,_*_),f=h.length;for(let E=0;E<f;++E)s.index=h[E].index,i.index<s.index&&i.connectedTo(s)&&(d.push(i.index-a),u.push(s.index-a),g.push(Wa(i.resname,i.atomname,s.atomname)))}}else for(let x=a;x<l;++x){i.index=x;for(let y=x+1;y<=l;++y)s.index=y,i.connectedTo(s)&&(d.push(x-a),u.push(y-a),g.push(Wa(i.resname,i.atomname,s.atomname)))}return{atomIndices1:d,atomIndices2:u,bondOrders:g}})(e)),this.bonds}getRings(){return this.rings===void 0&&this.calculateRings(),this.rings}getBondGraph(){return this.bondGraph===void 0&&this.calculateBondGraph(),this.bondGraph}getAromatic(e){return this.aromaticAtoms===void 0&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms}getAromaticRings(e){return this.aromaticRings===void 0&&this.calculateAromatic(e),this.aromaticRings}calculateBondGraph(){const e=this.bondGraph={},t=this.getBonds(),n=t.atomIndices1.length,i=t.atomIndices1,s=t.atomIndices2;for(let o=0;o<n;++o){const a=i[o],l=s[o];(e[a]=e[a]||[]).push(l),(e[l]=e[l]||[]).push(a)}}calculateRings(){const e=(function(t,n){const i={count:n,visited:new Int32Array(n),queue:new Int32Array(n),pred:new Int32Array(n),left:new Int32Array(yc),right:new Int32Array(yc),color:new Int32Array(n),currentColor:0,rings:[],atomRings:[],bonds:t};for(let s=0;s<n;s++)i.visited[s]=-1,i.pred[s]=-1;return i})(this.getBondGraph(),this.atomCount);for(let t=0;t<e.count;t++)e.visited[t]>=0||gc(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}}isAromatic(e){return this.aromaticAtoms=this.getAromatic(e),this.aromaticAtoms[e.index-e.residueAtomOffset]===1}calculateAromatic(e){const t=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,i=n.map((o=>(function(a){if(a.some((g=>!mc.includes(g.number))))return!1;let l=0;const d=new lo(3,a.length),u=d.data;return a.forEach((g=>{u[l+0]=g.x,u[l+1]=g.y,u[l+2]=g.z,l+=3})),new ga(d).vecC.length()<fc})(o.map((a=>this.structure.getAtomProxy(a+e.atomOffset)))))),s=this.aromaticRings=[];n.forEach(((o,a)=>{i[a]&&(s.push(o),o.forEach((l=>t[l]=1)))}))}assignBondReferenceAtomIndices(){const e=this.getBondGraph(),t=this.getRings(),n=t.atomRings,i=t.rings,s=this.bonds,o=s.atomIndices1,a=s.atomIndices2,l=s.bondOrders,d=this.bondReferenceAtomIndices,u=s.atomIndices1.length;d.length=0;for(let g=0;g<u;++g){if(l[g]<=1)continue;let x;const y=o[g],b=a[g],_=n[y],h=n[b];if(_&&h){for(let f=0;f<_.length;f++)if(h.indexOf(_[f])!==-1){x=i[_[f]];break}}if(e[y].length>1)for(let f=0;f<e[y].length;++f){const E=e[y][f];if(E!==b&&(x===void 0||x.indexOf(E)!==-1)){d[g]=E;break}}else if(e[b].length>1)for(let f=0;f<e[b].length;++f){const E=e[b][f];if(E!==y&&(x===void 0||x.indexOf(E)!==-1)){d[g]=E;break}}}}getBondIndex(e,t){const n=this.bonds,i=n.atomIndices1,s=n.atomIndices2;let o=i.indexOf(e),a=s.indexOf(t);const l=a;for(;o!==-1;){for(;a!==-1;){if(o===a)return o;a=s.indexOf(t,a+1)}o=i.indexOf(e,o+1),a=l}}getBondReferenceAtomIndex(e,t){const n=this.getBondIndex(e,t);if(n!==void 0)return this.bondReferenceAtomIndices.length===0&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]}}const mc=[5,6,7,8,14,15,16,32,33,50,51,83],fc=.05;function pc(r,e,t){if(t<e)return;const{pred:n,color:i,left:s,right:o}=r,a=++r.currentColor;let l=e;for(let f=0;f<yc&&(i[l]=a,l=n[l],!(l<0));f++);let d=0,u=0,g=!1,x=0;l=t;for(let f=0;f<yc;f++){if(i[l]===a){x=l,g=!0;break}if(o[u++]=l,l=n[l],l<0)break}if(!g)return;l=e;for(let f=0;f<yc&&(s[d++]=l,x!==l)&&(l=n[l],!(l<0));f++);const y=d+u,b=new Array(y);let _=0;for(let f=0;f<d;f++)b[_++]=s[f];for(let f=u-1;f>=0;f--)b[_++]=o[f];const h=r.rings.length;for(let f=0;f<y;++f){const E=b[f];r.atomRings[E]?r.atomRings[E].push(h):r.atomRings[E]=[h]}r.rings.push(b)}function gc(r,e){const{bonds:t,visited:n,queue:i,pred:s}=r;n[e]=1,i[0]=e;let o=0,a=1;for(;o<a;){const l=i[o++],d=0;if(t[l]===void 0)continue;const u=t[l].length;for(let g=d;g<u;g++){const x=t[l][g];n[x]>0?s[x]!==l&&s[l]!==x&&pc(r,l,x):(n[x]=1,i[a++]=x,s[x]=l)}}}const yc=4;class bc{constructor(e){this.structure=e,this.dict={},this.list=[]}add(e,t,n,i="",s){const o=(function(l,d,u,g=""){return l+"|"+d.join(",")+"|"+(u?1:0)+"|"+g})(e=e.toUpperCase(),t,n,i);let a=this.dict[o];if(a===void 0){const l=new dc(this.structure,e,t,n,i,s);a=this.list.length,this.dict[o]=a,this.list.push(l)}return a}get(e){return this.list[e]}}class _c{constructor(e,t=0){this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new Vector3,this._v13=new Vector3,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(e){this.bondStore.atomIndex1[this.index]=e}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(e){this.bondStore.atomIndex2[this.index]=e}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(e){this.bondStore.bondOrder[this.index]=e}getOtherAtomIndex(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))}getReferenceAtomIndex(){const e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex!==t.residueIndex)return;const n=e.index-e.residueAtomOffset,i=t.index-t.residueAtomOffset,s=e.residueType.getBondReferenceAtomIndex(n,i);if(s!==void 0)return s+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}calculateShiftDir(e=new Vector3){const t=this._ap1,n=this._ap2,i=this._ap3,s=this._v12,o=this._v13;t.index=this.atomIndex1,n.index=this.atomIndex2;const a=this.getReferenceAtomIndex();s.subVectors(t,n).normalize(),a!==void 0?(i.index=a,o.subVectors(t,i)):o.copy(t),o.normalize();let l=s.dot(o);return 1-Math.abs(l)<1e-5&&(o.set(1,0,0),l=s.dot(o),1-Math.abs(l)<1e-5&&(o.set(0,1,0),l=s.dot(o))),e.copy(o.sub(s.multiplyScalar(l))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new _c(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class xc{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(e){this.residueStore.chainIndex[this.index]=e}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(e){this.residueStore.atomOffset[this.index]=e}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(e){this.residueStore.atomCount[this.index]=e}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(e){this.residueStore.resno[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(e){this.residueStore.setSstruc(this.index,e)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(e){this.residueStore.setInscode(this.index,e)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount}get y(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount}get z(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount}eachAtom(e,t){const n=this.atomCount,i=this.atomOffset,s=this.structure._ap,o=i+n;if(t&&t.atomOnlyTest){const a=t.atomOnlyTest;for(let l=i;l<o;++l)s.index=l,a(s)&&e(s)}else for(let a=i;a<o;++a)s.index=a,e(s)}positionToArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isHetero(){return this.residueType.hetero===1}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return Hn.includes(this.sstruc)}isSheet(){return qn.includes(this.sstruc)}isTurn(){return Wn.includes(this.sstruc)&&this.isProtein()}getAtomType(e){return this.atomMap.get(this.atomStore.atomTypeId[e])}getResname1(){return es[this.resname.toUpperCase()]||"X"}getBackboneType(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(e){let t=this.residueType.getAtomIndexByName(e);return t!==void 0&&(t+=this.atomOffset),t}hasAtomWithName(e){return this.residueType.hasAtomWithName(e)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const e=this.atomCount,t=this.atomOffset,n=new Array(e);for(let i=0;i<e;++i)n[i]=this.getAtomType(t+i).atomname;return n}connectedTo(e){const t=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!n)&&t.connectedTo(n)}getNextConnectedResidue(){const e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<e+t){const i=this.structure.getResidueProxy(n);if(this.connectedTo(i))return i}else if(n===e+t){const i=this.structure.getResidueProxy(e);if(this.connectedTo(i))return i}}getPreviousConnectedResidue(e){const t=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=t){const i=nt(e,this.structure.getResidueProxy());if(i.index=n,i.connectedTo(this))return i}else if(n===t-1){const i=this.chainStore.residueCount[this.chainIndex],s=nt(e,this.structure.getResidueProxy());if(s.index=t+i-1,s.connectedTo(this))return s}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(e=!1){let t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex,t}clone(){return new xc(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class vc{constructor(e,t,n){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=n,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=n-t+1;const i=this.structure.getResidueProxy(this.residueIndexStart),s=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=i.getPreviousConnectedResidue()!==void 0;const o=s.getNextConnectedResidue();this.isNextConnected=o!==void 0,this.isNextNextConnected=o!==void 0&&o.getNextConnectedResidue()!==void 0,this.isCyclic=s.connectedTo(i),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)}getAtomIndexByType(e,t){this.isCyclic?e===-1?e=this.residueCount-1:e===this.residueCount&&(e=0):(e!==-1||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));const n=this.__residueProxy;let i;switch(n.index=this.residueIndexStart+e,t){case"trace":i=n.traceAtomIndex;break;case"direction1":i=n.direction1AtomIndex;break;case"direction2":i=n.direction2AtomIndex;break;default:i=n.getAtomIndexByName(t)}return i}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}))}eachAtomN(e,t,n){const i=this.residueCount,s=new Array(e);for(let a=0;a<e;++a)s[a]=this.structure.getAtomProxy(this.getAtomIndexByType(a,n));t.apply(this,s);for(var o=e;o<i;++o){for(let a=1;a<e;++a)s[a-1].index=s[a].index;s[e-1].index=this.getAtomIndexByType(o,n),t.apply(this,s)}}eachResidue(e){const t=this.structure.getResidueProxy(),n=this.residueCount,i=this.residueIndexStart;for(let s=0;s<n;++s)t.index=i+s,e(t)}qualifiedName(){const e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()}}class wc{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(e){this.chainStore.entityIndex[this.index]=e}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(e){this.chainStore.modelIndex[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(e){this.chainStore.residueOffset[this.index]=e}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(e){this.chainStore.residueCount[this.index]=e}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(e){this.chainStore.setChainname(this.index,e)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(e){this.chainStore.setChainid(this.index,e)}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){const n=this.residueCount,i=this.residueOffset,s=this.structure._rp,o=i+n;if(t&&t.test){const a=t.residueOnlyTest;if(a)for(let l=i;l<o;++l)s.index=l,a(s)&&e(s);else for(let l=i;l<o;++l)s.index=l,e(s)}else for(let a=i;a<o;++a)s.index=a,e(s)}eachResidueN(e,t){const n=this.residueCount,i=this.residueOffset,s=i+n;if(n<e)return;const o=new Array(e);for(let a=0;a<e;++a)o[a]=this.structure.getResidueProxy(i+a);t.apply(this,o);for(let a=i+e;a<s;++a){for(let l=0;l<e;++l)o[l].index+=1;t.apply(this,o)}}eachPolymer(e,t){let n=0,i=0;const s=t?t.residueOnlyTest:void 0,o=this.model.structure,a=this.residueCount,l=this.residueOffset,d=l+a,u=this.structure.getResidueProxy(),g=this.structure.getResidueProxy(l),x=this.structure.getAtomProxy(),y=this.structure.getAtomProxy();let b=!0;for(let _=l+1;_<d;++_){u.index=g.index,g.index=_;const h=b?u.backboneEndType:u.backboneType,f=g.backboneType;b&&(n=u.index,b=!1),i=g.index,h!==Nn&&h===f?(x.index=u.backboneEndAtomIndex,y.index=g.backboneStartAtomIndex,x&&y&&x.connectedTo(y)&&(!s||s(u)&&s(g))||(u.index-n>1&&e(new vc(o,n,u.index)),n=i)):(h!==Nn&&u.index-n>1&&e(new vc(o,n,u.index)),n=i)}i-n>1&&this.structure.getResidueProxy(n).backboneEndType&&e(new vc(o,n,i))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new wc(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class Ac{constructor(e,t=0){this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(e){this.modelStore.chainOffset[this.index]=e}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(e){this.modelStore.chainCount[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return this.chainCount===0?0:this.residueEnd-this.residueOffset+1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}eachAtom(e,t){this.eachChain((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){this.eachChain((function(n){n.eachResidue(e,t)}),t)}eachPolymer(e,t){if(t&&t.chainOnlyTest){const n=t.chainOnlyTest;this.eachChain((function(i){n(i)&&i.eachPolymer(e,t)}))}else this.eachChain((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){const n=this.chainCount,i=this.chainOffset,s=this.structure._cp,o=i+n;if(t&&t.test){const a=t.chainOnlyTest;if(a)for(let l=i;l<o;++l)s.index=l,a(s)&&e(s);else for(let l=i;l<o;++l)s.index=l,e(s)}else for(let a=i;a<o;++a)s.index=a,e(s)}qualifiedName(){return"/"+this.index}clone(){return new Ac(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class Sc{constructor(e="",t=""){this.signals={refreshed:new signalsExports.Signal},this.init(e,t)}init(e,t){this.name=e,this.path=t,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new _a(0),this.backboneBondStore=new _a(0),this.rungBondStore=new _a(0),this.atomStore=new xa(0),this.residueStore=new va(0),this.chainStore=new wa(0),this.modelStore=new Aa(0),this.atomMap=new uc(this),this.residueMap=new bc(this),this.chemCompMap=void 0,this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new Vector3,this.boundingBox=new Box3,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new Vector3),this.spatialHash=new Tn(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new ba(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let e in this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()}getBondProxy(e){return new _c(this,e)}getAtomProxy(e){return new ka(this,e)}getResidueProxy(e){return new xc(this,e)}getChainProxy(e){return new wc(this,e)}getModelProxy(e){return new Ac(this,e)}getBondSet(){const e=this.bondStore.count,t=new En(e),n=this.atomSet;if(n)if(n.isAllSet())t.setAll();else if(n.isAllClear())t.clearAll();else{const i=this.getBondProxy();for(let s=0;s<e;++s)i.index=s,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getBackboneBondSet(){const e=this.backboneBondStore.count,t=new En(e),n=this.atomSetCache.__backbone;if(n){const i=this.getBondProxy();i.bondStore=this.backboneBondStore;for(let s=0;s<e;++s)i.index=s,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getRungBondSet(){const e=this.rungBondStore.count,t=new En(e),n=this.atomSetCache.__rung;if(n){const i=this.getBondProxy();i.bondStore=this.rungBondStore;for(let s=0;s<e;++s)i.index=s,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getAtomSet(e){const t=this.atomStore.count;if(e===void 0)return new En(t,!0);if(e instanceof En)return e;if(e===!0)return new En(t,!0);if(e&&e.test){const n=e.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(n==="")return new En(t,!0);{const i=new En(t);return this.eachAtom((function(s){i.set(s.index)}),e),this.atomSetCache[n]=i,i}}return e===!1?new En(t):new En(t,!0)}getAtomSetWithinSelection(e,t){const n=this.spatialHash,i=this.getAtomSet(!1),s=this.getAtomProxy();return n&&this.getAtomSet(e).forEach((function(o){s.index=o,n.within(s.x,s.y,s.z,t).forEach((function(a){i.set(a)}))})),i}getAtomSetWithinPoint(e,t){const n=e,i=this.getAtomSet(!1);return this.spatialHash&&this.spatialHash.within(n.x,n.y,n.z,t).forEach((function(s){i.set(s)})),i}getAtomSetWithinVolume(e,t,n,i,s){const o=new ya(e,n,i,s),a=o.getDataPosition(),l=a.length,d=o.matrix.getMaxScaleOnAxis(),u=this.getAtomSet(!1);if(!this.spatialHash)return u;for(let g=0;g<l;g+=3)this.spatialHash.within(a[g],a[g+1],a[g+2],d).forEach((function(x){u.set(x)}));return u}getAtomSetWithinGroup(e){const t=this.atomStore.residueIndex,n=this.getAtomSet(!1),i=this.getResidueProxy();return this.getAtomSet(e).forEach((function(s){i.index=t[s];for(let o=i.atomOffset;o<=i.atomEnd;++o)n.set(o)})),n}getSelection(){}getStructure(){return this}eachEntity(e,t){this.entityList.forEach((function(n){t!==void 0&&n.getEntityType()!==t||e(n)}))}eachBond(e,t){const n=this.getBondProxy();let i;if(t&&t.test&&(i=this.getBondSet(),this.bondSet&&i.intersection(this.bondSet)),i)i.forEach((function(s){n.index=s,e(n)}));else{const s=this.bondStore.count;for(let o=0;o<s;++o)n.index=o,e(n)}}eachAtom(e,t){if(t&&t.test)this.eachModel((function(n){n.eachAtom(e,t)}),t);else{const n=this.atomStore.count,i=this.getAtomProxy();for(let s=0;s<n;++s)i.index=s,e(i)}}eachResidue(e,t){if(t&&t.test){const n=this.modelStore.count,i=this.getModelProxy(),s=t.modelOnlyTest;if(s)for(let o=0;o<n;++o)i.index=o,s(i)&&i.eachResidue(e,t);else for(let o=0;o<n;++o)i.index=o,i.eachResidue(e,t)}else{const n=this.residueStore.count,i=this.getResidueProxy();for(let s=0;s<n;++s)i.index=s,e(i)}}eachResidueN(e,t){const n=this.residueStore.count;if(n<e)return;const i=new Array(e);for(let s=0;s<e;++s)i[s]=this.getResidueProxy(s);t.apply(this,i);for(let s=e;s<n;++s){for(let o=0;o<e;++o)i[o].index+=1;t.apply(this,i)}}eachPolymer(e,t){if(t&&t.modelOnlyTest){const n=t.modelOnlyTest;this.eachModel((function(i){n(i)&&i.eachPolymer(e,t)}))}else this.eachModel((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){if(t&&t.test)this.eachModel((function(n){n.eachChain(e,t)}));else{const n=this.chainStore.count,i=this.getChainProxy();for(let s=0;s<n;++s)i.index=s,e(i)}}eachModel(e,t){const n=this.modelStore.count,i=this.getModelProxy();if(t&&t.test){const s=t.modelOnlyTest;if(s)for(let o=0;o<n;++o)i.index=o,s(i)&&e(i);else for(let o=0;o<n;++o)i.index=o,e(i)}else for(let s=0;s<n;++s)i.index=s,e(i)}getAtomData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,i=nt(t.atomSet,this.atomSet);let s,o;const a={},l=this.getAtomProxy(),d=i.getSize();n&&!n.position||(a.position=new Float32Array(3*d)),n&&!n.color||!t.colorParams||(a.color=new Float32Array(3*d),o=Oe.getScheme(t.colorParams)),n&&!n.picking||(a.picking=new Xs(new Float32Array(d),this.getStructure())),n&&!n.radius||(a.radius=new Float32Array(d),s=new ma(t.radiusParams)),n&&!n.index||(a.index=new Uint32Array(d));const{position:u,color:g,picking:x,radius:y,index:b}=a;return i.forEach(((_,h)=>{const f=3*h;l.index=_,u&&l.positionToArray(u,f),g&&o.atomColorToArray(l,g,f),x&&(x.array[h]=_),y&&(y[h]=s.atomRadius(l)),b&&(b[h]=_)})),a}getBondData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,i=nt(t.bondSet,this.bondSet),s=nt(t.multipleBond,"off"),o=s!=="off",a=s==="offset",l=nt(t.bondScale,.4),d=nt(t.bondSpacing,1);let u,g;const x={},y=this.getBondProxy();t.bondStore&&(y.bondStore=t.bondStore);const b=this.getAtomProxy(),_=this.getAtomProxy();let h;if(o){const k=y.bondStore.bondOrder;h=0,i.forEach((function(j){h+=k[j]}))}else h=i.getSize();n&&!n.position||(x.position1=new Float32Array(3*h),x.position2=new Float32Array(3*h)),n&&!n.color||!t.colorParams||(x.color=new Float32Array(3*h),x.color2=new Float32Array(3*h),g=Oe.getScheme(t.colorParams)),n&&!n.picking||(x.picking=new Ks(new Float32Array(h),this.getStructure(),t.bondStore)),(!n||n.radius||o&&n.position)&&(u=new ma(t.radiusParams)),n&&!n.radius||(x.radius=new Float32Array(h),t.radius2&&(x.radius2=new Float32Array(h)));const{position1:f,position2:E,color:m,color2:S,picking:w,radius:v,radius2:A}=x;let M,T,R,O,L,P,I=0;const N=new Vector3,U=new Vector3,F=new Vector3;return i.forEach((k=>{if(T=3*I,y.index=k,b.index=y.atomIndex1,_.index=y.atomIndex2,O=y.bondOrder,f)if(o&&O>1){const j=u.atomRadius(b);P=j*l/(.5*O),y.calculateShiftDir(F),a?(L=2*d*j,F.multiplyScalar(L),F.negate(),U.subVectors(_,b).multiplyScalar(Math.max(.1,L/1.88)),b.positionToArray(f,T),_.positionToArray(E,T),O>=2&&(N.addVectors(b,F).add(U).toArray(f,T+3),N.addVectors(_,F).sub(U).toArray(E,T+3),O>=3&&(N.subVectors(b,F).add(U).toArray(f,T+6),N.subVectors(_,F).sub(U).toArray(E,T+6)))):(L=(d-l)*j,F.multiplyScalar(L),O===2?(N.addVectors(b,F).toArray(f,T),N.subVectors(b,F).toArray(f,T+3),N.addVectors(_,F).toArray(E,T),N.subVectors(_,F).toArray(E,T+3)):O===3?(b.positionToArray(f,T),N.addVectors(b,F).toArray(f,T+3),N.subVectors(b,F).toArray(f,T+6),_.positionToArray(E,T),N.addVectors(_,F).toArray(E,T+3),N.subVectors(_,F).toArray(E,T+6)):(b.positionToArray(f,T),_.positionToArray(E,T)))}else b.positionToArray(f,T),_.positionToArray(E,T);if(m&&S&&(g.bondColorToArray(y,1,m,T),g.bondColorToArray(y,0,S,T),o&&O>1))for(M=1;M<O;++M)R=3*M+T,Mi(m,T,R,3),Mi(S,T,R,3);if(w&&w.array&&(w.array[I]=k,o&&O>1))for(M=1;M<O;++M)w.array[I+M]=k;if(v&&(v[I]=u.atomRadius(b),o&&O>1))for(P=v[I]*l/(a?1:.5*O),M=a?1:0;M<O;++M)v[I+M]=P;if(A&&(A[I]=u.atomRadius(_),o&&O>1))for(P=A[I]*l/(a?1:.5*O),M=a?1:0;M<O;++M)A[I+M]=P;I+=o?O:1})),x}getBackboneAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)}getBackboneBondData(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)}getRungAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)}getRungBondData(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)}getBoundingBox(e,t){De&&ke.time("getBoundingBox"),t=t||new Box3;let n=1/0,i=1/0,s=1/0,o=-1/0,a=-1/0,l=-1/0;return this.eachAtom((d=>{const u=d.x,g=d.y,x=d.z;u<n&&(n=u),g<i&&(i=g),x<s&&(s=x),u>o&&(o=u),g>a&&(a=g),x>l&&(l=x)}),e),t.min.set(n,i,s),t.max.set(o,a,l),De&&ke.timeEnd("getBoundingBox"),t}getPrincipalAxes(e){De&&ke.time("getPrincipalAxes");let t=0;const n=new lo(3,this.atomCount),i=n.data;return this.eachAtom((s=>{i[t+0]=s.x,i[t+1]=s.y,i[t+2]=s.z,t+=3}),e),De&&ke.timeEnd("getPrincipalAxes"),new ga(n)}atomCenter(e){return e?this.getBoundingBox(e).getCenter(new Vector3):this.center.clone()}hasCoords(){if(this._hasCoords===void 0){const e=this.atomStore;this._hasCoords=Di(e.x)!==0||Ti(e.x)!==0||Di(e.y)!==0||Ti(e.y)!==0||Di(e.z)!==0||Ti(e.z)!==0||e.count/this.modelStore.count==1}return this._hasCoords}getSequence(e){const t=[],n=this.getResidueProxy();return this.eachAtom((function(i){n.index=i.residueIndex,i.index===n.traceAtomIndex&&t.push(n.getResname1())}),e),t}getAtomIndices(e){if(e&&e.string){const t=[];return this.eachAtom((function(n){t.push(n.index)}),e),new Uint32Array(t)}{const t={what:{index:!0}};return this.getAtomData(t).index}}getChainnameCount(e){const t=new Set;return this.eachChain((function(n){n.residueCount&&t.add(n.chainname)}),e),t.size}updatePosition(e,t=!0){let n=0;this.eachAtom((function(i){i.positionFromArray(e,n),n+=3}),void 0),this._hasCoords=void 0,t&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new Tn(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const Cc=new Box3,Pc=[An,_n,Sn,wn,Cn,xn,bn,vn,In,Pn,kn,Mn],Ic={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class kc{constructor(e="shape",t={}){this.boundingBox=new Box3,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=st(t,Ic),Pc.forEach((n=>{Object.keys(n.fields).forEach((i=>{this._primitiveData[n.getShapeKey(i)]=[]})),this._primitiveData[n.getShapeKey("name")]=[]}))}addBuffer(e){this.bufferList.push(e);const t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this}addMesh(e,t,n,i,s){let o;e=St(e),t=St(t),Array.isArray(n)&&(n=bt(n,e.length)),i&&(i=St(i)),o=i===void 0||i.length==0?{position:e,color:t,index:n}:{position:e,color:t,index:n,normal:i};const a=new eo(this,Object.assign({serial:this.meshCount,name:s},o)),l=new Vo(Object.assign({picking:a},o));return this.bufferList.push(l),Cc.setFromArray(e),this.boundingBox.union(Cc),this.meshCount+=1,this}addSphere(e,t,n,i){return bn.objectToShape(this,{position:e,color:t,radius:n,name:i}),this}addEllipsoid(e,t,n,i,s,o){return Cn.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:s,name:o}),this}addTorus(e,t,n,i,s,o){return Pn.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:s,name:o}),this}addCylinder(e,t,n,i,s){return wn.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:s}),this}addCone(e,t,n,i,s){return Sn.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:s}),this}addArrow(e,t,n,i,s){return An.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:s}),this}addBox(e,t,n,i,s,o){return _n.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:s,name:o}),this}addOctahedron(e,t,n,i,s,o){return xn.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:s,name:o}),this}addTetrahedron(e,t,n,i,s,o){return vn.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:s,name:o}),this}addText(e,t,n,i){return In.objectToShape(this,{position:e,color:t,size:n,text:i}),this}addPoint(e,t,n){return kn.objectToShape(this,{position:e,color:t,name:n}),this}addWideline(e,t,n,i,s){return this.parameters.linewidth=i,Mn.objectToShape(this,{position1:e,position2:t,color:n,name:s}),this}addLabel(e,t,n,i){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,n,i)}getBufferList(){const e=[];return Pc.forEach((t=>{this._primitiveData[t.getShapeKey("color")].length&&e.push(t.bufferFromShape(this,this.parameters))})),this.bufferList.concat(e)}dispose(){this.bufferList.forEach((function(e){e.dispose()})),this.bufferList.length=0,Pc.forEach((e=>{Object.keys(e.fields).forEach((t=>{this._primitiveData[e.getShapeKey(t)].length=0})),this._primitiveData[e.getShapeKey("name")].length=0}))}get center(){return this._center||(this._center=this.boundingBox.getCenter(new Vector3)),this._center}get type(){return"Shape"}}class Mc extends Nr{constructor(e,t,n){Array.isArray(e)||(e=[e]),super(e,t,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=e,this.init(n)}init(e){super.init(e),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(e){this.bufferList.forEach((t=>{this.viewer.add(t),t.setParameters(this.getBufferParams())})),this.setVisibility(this.visible),e()}}const Tc=new Matrix4,Dc=new Matrix3;class Bc extends Vo{constructor(e,t={},n){super((function(l,d){const u=d.attributes.position.array,g=d.index?d.index.array:void 0,x=l.position.length/3,y=u.length/3,b=x*y,_=new Float32Array(3*b),h=new Float32Array(3*b),f=new Float32Array(3*b);let E;return g&&(E=bt(x*g.length,b)),{position:_,color:f,index:E,normal:h,primitiveId:l.primitiveId||Pi(x,y),picking:l.picking}})(e,n),t),this.updateNormals=!1;const i=n.attributes.position.array,s=n.attributes.normal.array,o=n.index?n.index.array:void 0;this.geoPosition=i,this.geoNormal=s,this.geoIndex=o,this.positionCount=e.position.length/3,this.geoPositionCount=i.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const a=this.geometry.attributes;if(this.meshPosition=a.position.array,this.meshColor=a.color.array,this.meshNormal=a.normal.array,this.setAttributes(e),o){const l=this.geometry.getIndex();if(!l)return void ke.error("Index is null");this.meshIndex=l.array,this.makeIndex()}}setAttributes(e={},t=!1){const n=this.geometry.attributes;let i,s,o,a,l,d,u,g,x;const y=this.updateNormals;e.position&&(i=e.position,o=this.geoPosition,u=this.meshPosition,l=this.transformedGeoPosition,n.position.needsUpdate=!0,(y||t)&&(a=this.geoNormal,x=this.meshNormal,d=this.transformedGeoNormal,n.normal.needsUpdate=!0)),e.color&&(s=e.color,g=this.meshColor,n.color.needsUpdate=!0);const b=this.positionCount,_=this.geoPositionCount;for(let h=0;h<b;++h){let f,E;const m=h*_*3,S=3*h;if(i&&l&&u&&x&&o&&a&&(l.set(o),Tc.makeTranslation(i[S],i[S+1],i[S+2]),this.applyPositionTransform(Tc,h,S),Hr(Tc.elements,l),u.set(l,m),y&&d?(d.set(a),Dc.getNormalMatrix(Tc),qr(Dc.elements,d),x.set(d,m)):t&&x.set(a,m)),s&&g)for(f=0;f<_;++f)E=m+3*f,g[E]=s[S],g[E+1]=s[S+1],g[E+2]=s[S+2]}}makeIndex(){const e=this.geoIndex,t=this.meshIndex;if(!e)return;const n=this.positionCount,i=this.geoPositionCount,s=3*(e.length/3);for(let o=0;o<n;++o){const a=o*s,l=a+s;t.set(e,a);for(let d=a;d<l;++d)t[d]+=o*i}}}const Fc=new Vector3,Ec=Object.assign({sphereDetail:1},No);class $c extends Bc{constructor(e,t={}){super(e,t,new IcosahedronGeometry(1,nt(t.sphereDetail,1))),this.setAttributes(e,!0)}get defaultParameters(){return Ec}applyPositionTransform(e,t){const n=this._radius[t];Fc.set(n,n,n),e.scale(Fc)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}ze.add("shader/SphereImpostor.vert",`uniform mat4 projectionMatrixInverse;
uniform float clipNear;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
attribute vec2 mapping;
attribute float radius;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
#include matrix_scale
const mat4 D = mat4(
1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, -1.0
);
mat4 transposeM( in mat4 inMatrix ) {
vec4 i0 = inMatrix[0];
vec4 i1 = inMatrix[1];
vec4 i2 = inMatrix[2];
vec4 i3 = inMatrix[3];
mat4 outMatrix = mat4(
vec4(i0.x, i1.x, i2.x, i3.x),
vec4(i0.y, i1.y, i2.y, i3.y),
vec4(i0.z, i1.z, i2.z, i3.z),
vec4(i0.w, i1.w, i2.w, i3.w)
);
return outMatrix;
}
void ComputePointSizeAndPositionInClipCoordSphere(){
vec2 xbc;
vec2 ybc;
mat4 T = mat4(
radius, 0.0, 0.0, 0.0,
0.0, radius, 0.0, 0.0,
0.0, 0.0, radius, 0.0,
position.x, position.y, position.z, 1.0
);
mat4 R = transposeM( projectionMatrix * modelViewMatrix * T );
float A = dot( R[ 3 ], D * R[ 3 ] );
float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );
float C = dot( R[ 0 ], D * R[ 0 ] );
xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;
A = dot( R[ 3 ], D * R[ 3 ] );
B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );
C = dot( R[ 1 ], D * R[ 1 ] );
ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;
gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );
gl_Position.xy -= mapping * vec2( sx, sy );
gl_Position.xy *= gl_Position.w;
}
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
vRadius = radius * matrixScale( modelViewMatrix );
vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
mvPosition.z -= vRadius;
gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );
ComputePointSizeAndPositionInClipCoordSphere();
vRadiusSq = vRadius * vRadius;
vec4 vPoint4 = projectionMatrixInverse * gl_Position;
vPoint = vPoint4.xyz / vPoint4.w;
vPointViewPosition = -mvPosition.xyz / mvPosition.w;
}`),ze.add("shader/SphereImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool flag2 = false;
bool interior = false;
vec3 cameraPos;
vec3 cameraNormal;
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){
vec3 cameraSpherePos = -vPointViewPosition;
cameraSpherePos.z += vRadius;
vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );
vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );
vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );
float B = dot( rayDirection, cameraSphereDir );
float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );
if( det < 0.0 ){
discard;
return false;
}
float sqrtDet = sqrt( det );
float posT = mix( B + sqrtDet, B + sqrtDet, ortho );
float negT = mix( B - sqrtDet, sqrtDet - B, ortho );
cameraPos = rayDirection * negT + rayOrigin;
#ifdef NEAR_CLIP
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}else if( calcClip( cameraPos ) > 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
flag2 = true;
}
#else
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}
#endif
cameraNormal = normalize( cameraPos - cameraSpherePos );
cameraNormal *= float(!interior) * 2.0 - 1.0;
return !interior;
}
void main(void){
bool flag = Impostor( cameraPos, cameraNormal );
#ifdef NEAR_CLIP
if( calcClip( cameraPos ) > 0.0 )
discard;
#endif
gl_FragDepthEXT = calcDepth( cameraPos );
if( !flag ){
#ifdef NEAR_CLIP
if( flag2 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}else if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#else
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#endif
}
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vNormal = cameraNormal;
vec3 vViewPosition = -cameraPos;
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);class Oc extends Uo{constructor(e,t,n={}){super(t,n),this.index=bt(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:e,value:null}}),this.setAttributes({primitiveId:Ci(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(e){const t={};for(const n in e){const i=e[n];t[n]={type:i.type,value:null}}super.addAttributes(t)}getAttributeIndex(e){return 3*e*this.mappingSize}setAttributes(e){e&&!e.position&&e.position1&&e.position2&&(e.position=vi(e.position1,e.position2));const t=this.size,n=this.mappingSize,i=this.geometry.attributes;let s,o,a,l,d,u,g;for(const x in e)if(x!=="index"&&x!=="picking"){o=e[x],s=i[x],a=s.itemSize,l=s.array;for(let y=0;y<t;++y){d=y*a,u=d*n;for(let b=0;b<n;++b){g=u+a*b;for(let _=0;_<a;++_)l[g+_]=o[d+_]}}s.needsUpdate=!0}}makeMapping(){const e=this.size,t=this.mapping,n=this.mappingSize,i=this.mappingItemSize,s=this.geometry.attributes.mapping.array;for(let o=0;o<e;o++)s.set(t,o*i*n)}makeIndex(){const e=this.size,t=this.mappingSize,n=this.mappingIndices,i=this.mappingIndicesSize,s=this.index;for(let o=0;o<e;o++){const a=o*i,l=o*t;s.set(n,a);for(let d=0;d<i;++d)s[a+d]+=l}}}const Rc=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Lc=new Uint16Array([0,1,2,1,3,2]);class Nc extends Oc{constructor(e,t={}){super("v2",e,t)}get mapping(){return Rc}get mappingIndices(){return Lc}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}class zc extends Nc{constructor(e,t={}){super(e,t),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new Matrix4},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}}Object.assign({disableImpostor:!1},Ec);const Uc=class{constructor(r,e){return!Pe||e&&e.disableImpostor?new $c(r,e):new zc(r,e)}};function Vc(r,e,t,n){const i=t-r,s=n-e;return Math.sqrt(i*i+s*s)}je.add("sphere",Uc),ze.add("shader/Point.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float size;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
varying vec3 vViewPosition;
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
#include begin_vertex
#include project_vertex
#ifdef USE_SIZEATTENUATION
gl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );
#else
gl_PointSize = size * pixelRatio;
#endif
#ifndef PICKING
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),ze.add("shader/Point.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include alphatest_pars_fragment
varying vec3 vViewPosition;
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
#ifdef USE_MAP
if( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )
discard;
#endif
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
#ifdef USE_MAP
diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );
#endif
#include color_fragment
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const jc=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},No),Gc=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{uniform:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},zo);class Hc extends Uo{constructor(e,t={}){super(e,t),this.parameterTypes=Gc,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null},alphaTest:{value:this.parameters.alphaTest}})}get defaultParameters(){return jc}makeMaterial(){super.makeMaterial(),this.makeTexture();const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.uniforms.map.value=this.tex,e.needsUpdate=!0,t.uniforms.map.value=this.tex,t.needsUpdate=!0,n.uniforms.map.value=this.tex,n.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=(function(e){const t=e||{},n=nt(t.width,256),i=nt(t.height,256),s=[n/2,i/2],o=Math.min(n/2,i/2),a=nt(t.delta,1/(o+1))*o;let l=0,d=0;const u=new Uint8Array(n*i*4);for(let x=0,y=u.length;x<y;x+=4){const b=1-Et(o-a,o,Vc(l,d,s[0],s[1]));u[x]=255*b,u[x+1]=255*b,u[x+2]=255*b,u[x+3]=255*b,++l===n&&(l=0,d++)}const g=new DataTexture(u,n,i);return g.needsUpdate=!0,g})({delta:this.parameters.edgeBleach})}getDefines(e){const t=super.getDefines(e);return this.parameters.sizeAttenuation&&(t.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(t.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(t.USE_ALPHATEST=1),t}setUniforms(e){e&&e.edgeBleach!==void 0&&(this.makeTexture(),e.map=this.tex),super.setUniforms(e)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}je.add("point",Hc);class qc extends Nr{constructor(e,t,n){super(e,t,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),e instanceof $o?(this.surface=void 0,this.volume=new ya(e)):(this.surface=e,this.volume=void 0),this.init(n)}init(e){var t=e||{};t.colorScheme=nt(t.colorScheme,"uniform"),t.colorValue=nt(t.colorValue,14540253),this.thresholdType=nt(t.thresholdType,"sigma"),this.thresholdMin=nt(t.thresholdMin,2),this.thresholdMax=nt(t.thresholdMax,1/0),this.thresholdOut=nt(t.thresholdOut,!1),this.dotType=nt(t.dotType,"point"),this.radius=nt(t.radius,.1),this.scale=nt(t.scale,1),this.pointSize=nt(t.pointSize,1),this.sizeAttenuation=nt(t.sizeAttenuation,!0),this.sortParticles=nt(t.sortParticles,!1),this.useTexture=nt(t.useTexture,!1),this.alphaTest=nt(t.alphaTest,.5),this.forceTransparent=nt(t.forceTransparent,!1),this.edgeBleach=nt(t.edgeBleach,0),super.init(t),this.build()}attach(e){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),e()}create(){var e={};if(this.volume){var t,n,i=this.volume;this.thresholdType==="sigma"?(t=i.getValueForSigma(this.thresholdMin),n=i.getValueForSigma(this.thresholdMax)):(t=this.thresholdMin,n=this.thresholdMax),i.setFilter(t,n,this.thresholdOut),Object.assign(e,{position:i.getDataPosition(),color:i.getDataColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:i.getDataSize(this.radius,this.scale),picking:i.getDataPicking()})}else{var s=this.surface;Object.assign(e,{position:s.getPosition(),color:s.getColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:s.getSize(this.radius,this.scale),picking:s.getPicking()})}this.dotType==="sphere"?this.dotBuffer=new Uc(e,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new Hc(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(e={}){if(this.bufferList.length===0)return;const t={};e.color&&(this.volume?Object.assign(t,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(t,{color:this.surface.getColor(this.getColorParams())})),this.dotType==="sphere"&&(e.radius||e.scale)&&(this.volume?Object.assign(t,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(t,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(t)}setParameters(e,t={},n){return e&&e.thresholdType!==void 0&&this.volume instanceof $o&&(this.thresholdType==="value"&&e.thresholdType==="sigma"?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):this.thresholdType==="sigma"&&e.thresholdType==="value"&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=e.thresholdType),e&&e.radiusType!==void 0&&(e.radiusType==="radius"?this.radius=.1:this.radius=parseFloat(e.radiusType),t.radius=!0,this.dotType!=="sphere"||Pe&&!this.disableImpostor||(n=!0)),e&&e.radius!==void 0&&(t.radius=!0,this.dotType!=="sphere"||Pe&&!this.disableImpostor||(n=!0)),e&&e.scale!==void 0&&(t.scale=!0,this.dotType!=="sphere"||Pe&&!this.disableImpostor||(n=!0)),super.setParameters(e,t,n),this}}ze.add("shader/Image.vert",`uniform float clipRadius;
uniform vec3 clipCenter;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void main() {
#include begin_vertex
#include project_vertex
vUv = uv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
}`),ze.add("shader/Image.frag",`uniform sampler2D map;
uniform float opacity;
uniform vec2 mapSize;
uniform float clipNear;
uniform float clipRadius;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform sampler2D pickingMap;
uniform float objectId;
#else
#include fog_pars_fragment
#endif
#if defined( CUBIC_INTERPOLATION )
#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )
#if defined( CATMULROM_FILTER )
const float B = 0.0;
const float C = 0.5;
#elif defined( MITCHELL_FILTER )
const float B = 0.333;
const float C = 0.333;
#endif
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f < 1.0 ){
return ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +
( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +
( 6.0 - 2.0 * B ) ) / 6.0;
}else if( f >= 1.0 && f < 2.0 ){
return ( ( -B - 6.0 * C ) * ( f * f * f )
+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +
( - ( 12.0 * B ) - 48.0 * C ) * f +
8.0 * B + 24.0 * C ) / 6.0;
}else{
return 0.0;
}
}
#elif defined( BSPLINE_FILTER )
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f >= 0.0 && f <= 1.0 ){
return ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );
}else if( f > 1.0 && f <= 2.0 ){
return 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );
}
return 1.0;
}
#else
float applyFilter( float x ){
return 1.0;
}
#endif
vec4 biCubic( sampler2D tex, vec2 texCoord ){
vec2 texelSize = 1.0 / mapSize;
texCoord -= texelSize / 2.0;
vec4 nSum = vec4( 0.0 );
float nDenom = 0.0;
vec2 cell = fract( texCoord * mapSize );
for( float m = -1.0; m <= 2.0; ++m ){
for( float n = -1.0; n <= 2.0; ++n ){
vec4 vecData = texture2D(
tex, texCoord + texelSize * vec2( m, n )
);
float c = applyFilter( m - cell.x ) * applyFilter( -n + cell.y );
nSum += vecData * c;
nDenom += c;
}
}
return nSum / nDenom;
}
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( CUBIC_INTERPOLATION )
gl_FragColor = biCubic( map, vUv );
#else
gl_FragColor = texture2D( map, vUv );
#endif
#if defined( PICKING )
if( gl_FragColor.a < 0.3 )
discard;
gl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );
#else
if( gl_FragColor.a < 0.01 )
discard;
gl_FragColor.a *= opacity;
#include fog_fragment
#endif
}`);const Wc=new Uint16Array([0,1,2,1,3,2]),Xc=new Float32Array([0,1,0,0,1,1,1,0]),Yc=Object.assign({filter:"nearest",forceTransparent:!0},No),Kc=Object.assign({filter:{updateShader:!0,uniform:!0}},zo);class Zc extends Uo{constructor(e,t){super({position:e.position,index:Wc,picking:e.picking},t),this.parameterTypes=Kc,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:n,width:i,height:s}=e,o=new DataTexture(n,i,s);o.flipY=!0,this.tex=o;const a=n.length,l=new Uint8Array(a);for(let u=0;u<a;u+=4){const g=u/4;l[u]=g>>16&255,l[u+1]=g>>8&255,l[u+2]=255&g}const d=new DataTexture(l,i,s);d.flipY=!0,d.minFilter=NearestFilter,d.magFilter=NearestFilter,this.pickingTex=d,this.addUniforms({map:{value:o},pickingMap:{value:d},mapSize:{value:new Vector2(i,s)}}),this.geometry.setAttribute("uv",new BufferAttribute(Xc,2))}get defaultParameters(){return Yc}getDefines(e){const t=super.getDefines(e),n=this.parameters.filter;return n.startsWith("cubic")&&(t.CUBIC_INTERPOLATION=1,n.endsWith("bspline")?t.BSPLINE_FILTER=1:n.endsWith("catmulrom")?t.CATMULROM_FILTER=1:n.endsWith("mitchell")&&(t.MITCHELL_FILTER=1)),t}updateTexture(){const e=this.tex,t=this.parameters.filter;t.startsWith("cubic")?(e.minFilter=NearestFilter,e.magFilter=NearestFilter):t==="linear"?(e.minFilter=LinearFilter,e.magFilter=LinearFilter):(e.minFilter=NearestFilter,e.magFilter=NearestFilter),e.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const e=this.material;e.uniforms.map.value=this.tex,e.blending=NormalBlending,e.needsUpdate=!0;const t=this.wireframeMaterial;t.uniforms.map.value=this.tex,t.blending=NormalBlending,t.needsUpdate=!0;const n=this.pickingMaterial;n.uniforms.map.value=this.tex,n.uniforms.pickingMap.value=this.pickingTex,n.blending=NormalBlending,n.needsUpdate=!0}setUniforms(e){e&&e.filter!==void 0&&(this.updateTexture(),e.map=this.tex),super.setUniforms(e)}}class Qc{constructor(e,t){const n=t||{};this.dimension=nt(n.dimension,"x"),this.positionType=nt(n.positionType,"percent"),this.position=nt(n.position,30),this.thresholdType=nt(n.thresholdType,"sigma"),this.thresholdMin=nt(n.thresholdMin,-1/0),this.thresholdMax=nt(n.thresholdMax,1/0),this.normalize=nt(n.normalize,!1),this.volume=e}getPositionFromCoordinate(e){const t=this.dimension,n=this.volume,i=n.matrix,s=new Vector3().setFromMatrixPosition(i)[t],o=new Vector3().setFromMatrixScale(i)[t];let a;return a=t==="x"?n.nx:t==="y"?n.ny:n.nz,Math.round(((e-s)/(a/100)+1)/o)}getData(e){e=e||{};const t=this.volume,n=t.data,i=t.matrix;let s;function o(H){return Math.round(H/100*(s-1))}function a(H,B,V,Y){return 3*(V*t.ny*t.nx+B*t.nx+H)+Y}s=this.positionType==="coordinate"?this.getPositionFromCoordinate(this.position):this.position;const l=new Float32Array(12),d=new Vector3;let u,g,x,y,b,_=0,h=0,f=0,E=t.nx,m=t.ny,S=t.nz;function w(H,B,V,Y){d.set(H,B,V).applyMatrix4(i).toArray(l,Y)}this.dimension==="x"?(x=o(t.nx),y=t.ny-1,b=t.nz-1,u=t.nz,g=t.ny,_=x,E=_+1,w(x,0,0,0),w(x,y,0,3),w(x,0,b,6),w(x,y,b,9)):this.dimension==="y"?(x=t.nx-1,y=o(t.ny),b=t.nz-1,u=t.nz,g=t.nx,h=y,m=h+1,w(0,y,0,0),w(x,y,0,3),w(0,y,b,6),w(x,y,b,9)):this.dimension==="z"&&(x=t.nx-1,y=t.ny-1,b=o(t.nz),u=t.nx,g=t.ny,f=b,S=f+1,w(0,0,b,0),w(0,y,b,3),w(x,0,b,6),w(x,y,b,9));let v=0,A=0;const M=new Uint8Array(u*g*4),T=new Float32Array(u*g);let R,O;this.thresholdType==="sigma"?(R=t.getValueForSigma(this.thresholdMin),O=t.getValueForSigma(this.thresholdMax)):(R=this.thresholdMin,O=this.thresholdMax);const L=Object.assign({},e.colorParams,{volume:t});this.normalize&&(L.domain=[0,1]);const P=Oe.getScheme(L),I=new Float32Array(3),N=P.getScale();let U,F=0,k=0;if(this.normalize){F=1/0,U=-1/0;for(let H=h;H<m;++H)for(let B=_;B<E;++B)for(let V=f;V<S;++V){const Y=n[a(B,H,V,0)/3];Y<F&&(F=Y),Y>U&&(U=Y)}k=U-F}for(let H=h;H<m;++H)for(let B=_;B<E;++B)for(let V=f;V<S;++V){const Y=a(B,H,V,0)/3;let K=n[Y];this.normalize&&(K=(K-F)/k),P.colorToArray(N(K),I),M[v]=Math.round(255*I[0]),M[v+1]=Math.round(255*I[1]),M[v+2]=Math.round(255*I[2]),M[v+3]=K>R&&K<O?255:0,T[A]=Y,++A,v+=4}const j=new so(T,t);return{position:l,imageData:M,width:u,height:g,picking:j}}}class Jc extends Nr{constructor(e,t,n){super(e,t,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=e,this.init(n)}init(e){const t=this.volume,n=e||{};n.colorDomain=nt(n.colorDomain,[t.min,t.max]),n.colorScheme=nt(n.colorScheme,"value"),n.colorScale=nt(n.colorScale,"Spectral"),this.colorScheme="value",this.dimension=nt(n.dimension,"x"),this.filter=nt(n.filter,"cubic-bspline"),this.positionType=nt(n.positionType,"percent"),this.position=nt(n.position,30),this.thresholdType=nt(n.thresholdType,"sigma"),this.thresholdMin=nt(n.thresholdMin,-1/0),this.thresholdMax=nt(n.thresholdMax,1/0),this.normalize=nt(n.normalize,!1),super.init(n),this.build()}attach(e){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),e()}create(){const e=new Qc(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),t=new Zc(e.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(t)}}function tl(r){ke.error(`makeRepresentation: representation type ${r} unknown`)}const el={name:"some element",status:""};class il{constructor(e,t={}){this.stage=e,this.signals={statusChanged:new signalsExports.Signal,nameChanged:new signalsExports.Signal,disposed:new signalsExports.Signal},this.parameters=st(t,this.defaultParameters),this.uuid=Tt()}get defaultParameters(){return el}get name(){return this.parameters.name}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}dispose(){this.signals.disposed.dispatch()}}const rl=Object.assign({visible:!0},el);class nl extends il{constructor(e,t,n={},i){super(e,Object.assign({name:t.type},n)),this.parent=i,this.signals=Object.assign({visibilityChanged:new signalsExports.Signal,parametersChanged:new signalsExports.Signal},this.signals),this.setRepresentation(t)}get defaultParameters(){return rl}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(e){this._disposeRepresentation(),this.repr=e,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(e){return this.parameters.visible=e,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(e){return this.repr.update(e),this}build(e){return this.repr.build(e),this}setSelection(e){const t=this.repr;return t.setSelection&&t.setSelection(e),this}setParameters(e){return this.repr.setParameters(e),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(e){return this.repr.setColor(e),this}}const sl=new Matrix4,ol=new Vector3,al={name:"",status:"",visible:!0};class cl{constructor(e,t,n={}){this.stage=e,this.object=t,this.signals={representationAdded:new signalsExports.Signal,representationRemoved:new signalsExports.Signal,visibilityChanged:new signalsExports.Signal,matrixChanged:new signalsExports.Signal,statusChanged:new signalsExports.Signal,nameChanged:new signalsExports.Signal,disposed:new signalsExports.Signal},this.reprList=[],this.annotationList=[],this.matrix=new Matrix4,this.position=new Vector3,this.quaternion=new Quaternion,this.scale=new Vector3(1,1,1),this.transform=new Matrix4,this.parameters=st(n,this.defaultParameters),this.uuid=Tt(),this.viewer=e.viewer,this.controls=new ua(this)}get defaultParameters(){return al}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this}setRotation(e){if(Array.isArray(e))if(e.length===3){const t=new Euler().fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof Euler?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this}setScale(e){return this.scale.set(e,e,e),this.updateMatrix(),this}setTransform(e){return this.transform.copy(e),this.updateMatrix(),this}updateMatrix(){const e=this.getCenterUntransformed(ol);this.matrix.makeTranslation(-e.x,-e.y,-e.z),sl.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(sl),sl.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(sl);const t=this.position;sl.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(sl),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach((e=>{e.setParameters({matrix:this.matrix})}))}addAnnotation(e,t,n){const i=new aa(this,e,t,n);return this.annotationList.push(i),i}eachAnnotation(e){this.annotationList.slice().forEach(e)}removeAnnotation(e){const t=this.annotationList.indexOf(e);t!==-1&&(this.annotationList.splice(t,1),e.dispose())}removeAllAnnotations(){this.eachAnnotation((e=>e.dispose())),this.annotationList.length=0}_addRepresentation(e,t,n,i=!1){const s=n||{},o=this.stage.getParameters();s.matrix=this.matrix.clone(),s.quality=s.quality||o.quality,s.disableImpostor=nt(s.disableImpostor,!o.impostor),s.useWorker=nt(s.useWorker,o.workerDefault),s.visible=nt(s.visible,!0);const a=Object.assign({},s,{visible:this.parameters.visible&&s.visible}),l=(function(u,g,x,y){var b;if(De&&ke.time("makeRepresentation "+u),g instanceof Sc){if(!(b=Le.get(u)))return void tl(u)}else if(g instanceof Fo)if(u==="surface")b=Xo;else{if(u!=="dot")return void tl(u);b=qc}else if(g instanceof $o)if(u==="surface")b=Xo;else if(u==="dot")b=qc;else{if(u!=="slice")return void tl(u);b=Jc}else if(g instanceof kc)b=Mc,g=g.getBufferList();else{if(u!=="buffer")return void ke.error("makeRepresentation: object "+g+" unknown");b=Mc}const _=new b(g,x,y);return De&&ke.timeEnd("makeRepresentation "+u),_})(e,t,this.viewer,a),d=new nl(this.stage,l,s,this);return i||(this.reprList.push(d),this.signals.representationAdded.dispatch(d)),d}addBufferRepresentation(e,t){return this._addRepresentation.call(this,"buffer",e,t)}hasRepresentation(e){return this.reprList.indexOf(e)!==-1}eachRepresentation(e){this.reprList.slice().forEach(e)}removeRepresentation(e){const t=this.reprList.indexOf(e);t!==-1&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))}updateRepresentations(e){this.reprList.forEach((t=>t.update(e))),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation((e=>e.dispose()))}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(e){return this.parameters.visible=e,this.eachRepresentation((t=>t.updateVisibility())),this.eachAnnotation((t=>t.updateVisibility())),this.signals.visibilityChanged.dispatch(e),this}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}getBox(...e){return this.getBoxUntransformed(...e).clone().applyMatrix4(this.matrix)}getCenter(...e){return this.getCenterUntransformed(...e).clone().applyMatrix4(this.matrix)}getZoom(...e){return this.stage.getZoomForBox(this.getBox(...e))}getBoxUntransformed(...e){return new Box3}getCenterUntransformed(...e){return this.getBoxUntransformed().getCenter(new Vector3)}autoView(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),nt(e,0))}}class ll{constructor(e=[]){this.list=e;const t=e.length;for(let n=0;n<t;++n)e[n].signals.disposed.add(this._remove,this)}_remove(e){const t=this.list.indexOf(e);t!==-1&&this.list.splice(t,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(e){return this.list.forEach(e),this}dispose(){return this.forEach((e=>e.dispose()))}}class hl extends ll{setParameters(e){return this.forEach((t=>t.setParameters(e)))}setVisibility(e){return this.forEach((t=>t.setVisibility(e)))}setSelection(e){return this.forEach((t=>t.setSelection(e)))}setColor(e){return this.forEach((t=>t.setColor(e)))}update(e){return this.forEach((t=>t.update(e)))}build(e){return this.forEach((t=>t.build(e)))}dispose(e){return this.forEach((t=>t.dispose()))}}const ul=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},el);class dl extends il{constructor(e,t,n={}){super(e,Object.assign({name:t.name},n)),this.trajectory=t,this.signals=Object.assign(this.signals,{frameChanged:new signalsExports.Signal,playerChanged:new signalsExports.Signal,countChanged:new signalsExports.Signal,parametersChanged:new signalsExports.Signal}),t.signals.frameChanged.add((i=>{this.signals.frameChanged.dispatch(i)})),t.signals.playerChanged.add((i=>{this.signals.playerChanged.dispatch(i)})),t.signals.countChanged.add((i=>{this.signals.countChanged.dispatch(i)})),n.initialFrame!==void 0&&this.setFrame(n.initialFrame)}get defaultParameters(){return ul}get type(){return"trajectory"}setFrame(e){this.trajectory.setFrame(e)}setParameters(e={}){this.trajectory.setParameters(e),this.signals.parametersChanged.dispatch(e)}dispose(){this.trajectory.dispose(),super.dispose()}}class ml{constructor(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class fl{constructor(e,t){let n,i;if(this.A=new lo(3,3),this.W=new lo(1,3),this.U=new lo(3,3),this.V=new lo(3,3),this.VH=new lo(3,3),this.R=new lo(3,3),this.tmp=new lo(3,3),this.c=new lo(3,3),e instanceof Sc)n=e.atomCount;else{if(!(e instanceof Float32Array))return;n=e.length/3}if(t instanceof Sc)i=t.atomCount;else{if(!(t instanceof Float32Array))return;i=t.length/3}const s=Math.min(n,i),o=new lo(3,s),a=new lo(3,s);this.coords1t=new lo(s,3),this.coords2t=new lo(s,3),this.transformationMatrix=new Matrix4,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,o,s,!1),this.prepCoords(t,a,s,!1),this._superpose(o,a)}_superpose(e,t){this.mean1=fo(e),this.mean2=fo(t),po(e,this.mean1),po(t,this.mean2),ho(this.coords1t,e),ho(this.coords2t,t),uo(this.A,this.coords2t,this.coords1t),xo(this.A,this.W,this.U,this.V),(function(x,y){const b=x.data,_=y.data,h=b[4],f=b[8],E=b[5],m=b[7],S=b[0],w=S*h,v=S*E,A=b[3],M=b[1],T=A*M,R=b[2],O=A*R,L=b[6],P=L*M,I=L*R,N=1/(w*f-v*m-T*f+O*m+P*E-I*h);_[0]=(h*f-E*m)*N,_[1]=-(M*f-R*m)*N,_[2]=-(-M*E+R*h)*N,_[3]=-(A*f-E*L)*N,_[4]=(S*f-I)*N,_[5]=-(v-O)*N,_[6]=-(-A*m+h*L)*N,_[7]=-(S*m-P)*N,_[8]=(w-T)*N})(this.V,this.VH),mo(this.R,this.U,this.VH),(function(x){const y=x.data;return y[0]*y[4]*y[8]-y[0]*y[5]*y[7]-y[3]*y[1]*y[8]+y[3]*y[2]*y[7]+y[6]*y[1]*y[5]-y[6]*y[2]*y[4]})(this.R)<0&&(De&&ke.log("R not a right handed system"),mo(this.tmp,this.c,this.VH),mo(this.R,this.U,this.tmp));const n=new lo(4,4),i=new lo(4,4),s=new lo(4,4),o=new lo(4,4),a=new lo(4,4),l=new lo(4,4),d=this.R.data,u=this.mean1,g=this.mean2;o.data.set([1,0,0,-u[0],0,1,0,-u[1],0,0,1,-u[2],0,0,0,1]),a.data.set([d[0],d[1],d[2],0,d[3],d[4],d[5],0,d[6],d[7],d[8],0,0,0,0,1]),l.data.set([1,0,0,g[0],0,1,0,g[1],0,0,1,g[2],0,0,0,1]),ho(i,o),uo(n,a,i),ho(s,n),uo(i,l,s),ho(n,i),this.transformationMatrix.elements=n.data}prepCoords(e,t,n,i){let s=0;const o=t.data;let a=3,l=3*n;if(i&&(l=4*n,a=4),e instanceof Sc)e.eachAtom((function(d){s<l&&(o[s+0]=d.x,o[s+1]=d.y,o[s+2]=d.z,i&&(o[s+3]=1),s+=a)}));else if(e instanceof Float32Array)for(;s<l;s+=a)s<l&&(o[s]=e[s],o[s+1]=e[s+1],o[s+2]=e[s+2],i&&(o[s+3]=1));else ke.warn("prepCoords: input type unknown")}transform(e){let t;if(e instanceof Sc)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}const n=new lo(4,t),i=new lo(t,4);this.prepCoords(e,n,t,!0);const s=this.transformationMatrix,o=s.determinant();if(!o)return o;const a=new lo(4,4);a.data=s.elements,(function(u,g,x){let y=0,b=0,_=0,h=0,f=0,E=0,m=0,S=0;const w=g.cols,v=g.rows,A=x.cols,M=g.data,T=x.data,R=u.data;let O=0;for(;y<v;h+=w,y++)for(m=0,b=0;b<A;S++,m++,b++){for(E=m,f=h,O=0,_=0;_<w;f++,E+=A,_++)O+=M[f]*T[E];R[S]=O}})(i,n,a);let l=0;const d=i.data;if(e instanceof Sc){e.eachAtom((function(x){x.x=d[l],x.y=d[l+1],x.z=d[l+2],l+=4}));const u=new Matrix4;u.copy(s).invert();const g=e.biomolDict;for(let x in g)g.hasOwnProperty(x)&&g[x].partList.forEach((function(y){y.matrixList.forEach((function(b){b.premultiply(s),b.multiply(u)}))}))}else if(e instanceof Float32Array){const u=4*t;for(;l<u;l+=4)e[l]=d[l],e[l+1]=d[l+1],e[l+2]=d[l+2]}else ke.warn("transform: input type unknown");return this.transformationMatrix}}const pl={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class gl{constructor(e,t={}){this.signals={startedRunning:new signalsExports.Signal,haltedRunning:new signalsExports.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add((i=>{i!==this&&this.pause()}),this);const n=nt(e.frameCount,1);this.traj=e,this.parameters=st(t,pl),this.parameters.end=Math.min(nt(t.end,n-1),n-1),this.parameters.step=nt(t.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction=this.parameters.direction==="bounce"?"forward":this.parameters.direction,e.signals.countChanged.add((i=>{this.parameters.end=Math.min(nt(this.parameters.end,i-1),i-1)}),this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(e={}){ot(this.parameters,e),e.direction!==void 0&&this.parameters.direction!=="bounce"&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/t,i=this.traj;if(i&&i.frameCount&&!i.inProgress&&e>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),this._currentStep===1&&(this._currentFrame=this._nextInterpolated()),i.hasFrame(this._currentFrame)){this._currentStep+=1;const s=this._currentStep/(this.parameters.interpolateStep+1),[o,a,l,d]=this._currentFrame;i.setFrameInterpolated(o,a,l,d,s,this.parameters.interpolateType),this._previousTime=this._currentTime}else i.loadFrame(this._currentFrame);else{const s=this._next();i.hasFrame(s)?(i.setFrame(s),this._previousTime=this._currentTime):i.loadFrame(s)}window.requestAnimationFrame(this._animate)}_next(){const e=this.parameters;let t;return t=this._direction==="forward"?this.traj.currentFrame+e.step:this.traj.currentFrame-e.step,(t>e.end||t<e.start)&&(e.direction==="bounce"&&(this._direction==="forward"?this._direction="backward":this._direction="forward"),e.mode==="once"?(this.pause(),t=e.direction==="forward"?e.end:e.direction==="backward"||this._direction==="forward"?e.start:e.end):this._direction==="forward"?(t=e.start,e.interpolateType&&(t=Math.min(e.end,t+e.step))):(t=e.end,e.interpolateType&&(t=Math.max(e.start,t-e.step)))),t}_nextInterpolated(){const e=this.parameters,t=this._next();let n,i,s;return this._direction==="forward"?(n=Math.max(e.start,t-e.step),i=Math.max(e.start,t-2*e.step),s=Math.max(e.start,t-3*e.step)):(n=Math.min(e.end,t+e.step),i=Math.min(e.end,t+2*e.step),s=Math.min(e.end,t+3*e.step)),[t,n,i,s]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const e=this.parameters,t=this.traj.currentFrame;let n=Math.ceil(t/e.step)*e.step;e.direction==="forward"&&t>=e.end?n=e.start:e.direction==="backward"&&t<=e.start&&(n=e.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}class yl{constructor(e,t,n={}){this.signals={countChanged:new signalsExports.Signal,frameChanged:new signalsExports.Signal,playerChanged:new signalsExports.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=nt(n.deltaTime,0),this.timeOffset=nt(n.timeOffset,0),this.centerPbc=nt(n.centerPbc,!1),this.removePbc=nt(n.removePbc,!1),this.removePeriodicity=nt(n.removePeriodicity,!1),this.superpose=nt(n.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new me(nt(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add((()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}))}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new gl(this))}_loadFrameCount(){}setStructure(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new me("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,(()=>this._saveInitialCoords()))}_saveStructureCoords(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position}setSelection(e){return this.selection.setString(e),this}_getIndices(e){let t=0;const n=e.test,i=[];return n&&this.structure.eachAtom((s=>{n(s)&&i.push(t),t+=1})),i}_makeSuperposeCoords(){const e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);const t=this.initialCoords,n=this.coords2;for(let i=0;i<e;i+=3){const s=3*this.selectionIndices[i/3];n[i+0]=t[s+0],n[i+1]=t[s+1],n[i+2]=t[s+2]}}_makeAtomIndices(){ke.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(e={}){let t=!1;e.centerPbc!==void 0&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),e.removePeriodicity!==void 0&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),e.removePbc!==void 0&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),e.superpose!==void 0&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=nt(e.deltaTime,this.deltaTime),this.timeOffset=nt(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(e){return Array.isArray(e)?e.every((t=>!!this.frameCache[t])):!!this.frameCache[e]}setFrame(e,t){return e===void 0||(this.inProgress=!0,e===-1||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,(()=>{this._updateStructure(e),t&&t()}))),this}_interpolate(e,t,n,i,s,o){const a=this.frameCache;let l;l=o==="spline"?(function(d,u,g,x,y){const b=d.length,_=new Float32Array(b);for(let h=0;h<b;h+=3){const f=h+1,E=h+2;_[h]=Ft(x[h],g[h],u[h],d[h],y,1),_[f]=Ft(x[f],g[f],u[f],d[f],y,1),_[E]=Ft(x[E],g[E],u[E],d[E],y,1)}return _})(a[e],a[t],a[n],a[i],s):(function(d,u,g){const x=d.length,y=new Float32Array(x);for(let b=0;b<x;b+=3){const _=b+1,h=b+2;y[b]=Bt(u[b],d[b],g),y[_]=Bt(u[_],d[_],g),y[h]=Bt(u[h],d[h],g)}return y})(a[e],a[t],s),this.structure.updatePosition(l),this._currentFrame=e,this.signals.frameChanged.dispatch(e)}setFrameInterpolated(e,t,n,i,s,o,a){if(e===void 0)return this;const l=this.frameCache,d=[];return l[i]||d.push(i),l[n]||d.push(n),l[t]||d.push(t),l[e]||d.push(e),d.length?this.loadFrame(d,(()=>{this._interpolate(e,t,n,i,s,o),a&&a()})):(this._interpolate(e,t,n,i,s,o),a&&a()),this}loadFrame(e,t){Array.isArray(e)?e.forEach((n=>{this.loadQueue[n]||this.frameCache[n]||(this.loadQueue[n]=!0,this._loadFrame(n,(()=>{delete this.loadQueue[n]})))})):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,(()=>{delete this.loadQueue[e],t&&t()})))}_loadFrame(e,t){ke.error("Trajectory._loadFrame not implemented",e,t)}_updateStructure(e){this._disposed?console.error("updateStructure: traj disposed"):(e===-1?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))}_doSuperpose(e){const t=3*this.selectionIndices.length,n=this.coords1,i=this.coords2;for(let s=0;s<t;s+=3){const o=3*this.selectionIndices[s/3];n[s+0]=e[o+0],n[s+1]=e[o+1],n[s+2]=e[o+2]}new fl(n,i).transform(e)}_process(e,t,n,i){if(this._setFrameCount(i),t){if(this.backboneIndices.length>0&&this.centerPbc){const s=[t[0],t[4],t[8]],o=(function(a,l,d){return[xi(l,d[0],3,0,a),xi(l,d[1],3,1,a),xi(l,d[2],3,2,a)]})(this.backboneIndices,n,s);(function(a,l,d){if(d[0]===0||d[8]===0||d[4]===0)return;const u=a.length,g=d[0],x=d[1],y=d[2],b=-l[0]+g+g/2,_=-l[1]+x+x/2,h=-l[2]+y+y/2;for(let f=0;f<u;f+=3)a[f+0]=(a[f+0]+b)%g,a[f+1]=(a[f+1]+_)%x,a[f+2]=(a[f+2]+h)%y})(n,o,s)}if(this.removePeriodicity){const s=(function(o){return[Fi(o,3,0),Fi(o,3,1),Fi(o,3,2)]})(n);(function(o,a,l){if(a[0]===0||a[8]===0||a[4]===0)return;const d=o.length;for(let u=3;u<d;u+=3)for(let g=0;g<3;++g){const x=(o[u+g]-l[g])/a[3*g+g];Math.abs(x)>.5&&(o[u+g]-=a[3*g+g]*Math.round(x))}})(n,t,s)}this.removePbc&&(function(s,o){if(o[0]===0||o[8]===0||o[4]===0)return;const a=s.length;for(let l=3;l<a;l+=3)for(let d=0;d<3;++d){const u=s[l+d]-s[l-3+d];if(Math.abs(u)>.9*o[3*d+d])if(u>0)for(let g=0;g<3;++g)s[l+g]-=o[3*d+g];else for(let g=0;g<3;++g)s[l+g]+=o[3*d+g]}})(n,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[e]=n,this.boxCache[e]=t,this.frameCacheSize+=1}_setFrameCount(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(e){this.player=e,this.signals.playerChanged.dispatch(e)}getFrameTime(e){return this.timeOffset+e*this.deltaTime}}class bl extends yl{constructor(e,t,n){const i=n||{};i.timeOffset=nt(i.timeOffset,e.timeOffset),i.deltaTime=nt(i.deltaTime,e.deltaTime),super("",t,i),this.name=e.name,this.path=e.path,this.frames=e.coordinates,this.boxes=e.boxes,this._init(t)}get type(){return"frames"}_makeAtomIndices(){this.structure.type==="StructureView"?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const i=this.frames[e];if(this.atomIndices){const a=this.atomIndices,l=a.length;n=new Float32Array(3*l);for(let d=0;d<l;++d){const u=3*d,g=3*a[d];n[u+0]=i[g+0],n[u+1]=i[g+1],n[u+2]=i[g+2]}}else n=new Float32Array(i);const s=this.boxes[e],o=this.frames.length;this._process(e,s,n,o),typeof t=="function"&&t()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class _l extends yl{constructor(e,t,n){super("",t,n),this._init(t)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const i=this.structure,s=i.frames[e];if(this.atomIndices){const l=this.atomIndices,d=l.length;n=new Float32Array(3*d);for(let u=0;u<d;++u){const g=3*u,x=3*l[u];n[g+0]=s[x+0],n[g+1]=s[x+1],n[g+2]=s[x+2]}}else n=new Float32Array(s);const o=i.boxes[e],a=i.frames.length;this._process(e,o,n,a),typeof t=="function"&&t()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class xl extends yl{constructor(e,t,n){super(e,t,n),this._init(t)}get type(){return"remote"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),n=t.length;let i=t[0],s=t[0];for(let o=1;o<n;++o){const a=t[o];s+1<a&&(e.push([i,s+1]),i=a),s=a}e.push([i,s+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){const n=new XMLHttpRequest,i=qe.getFrameUrl(this.trajPath,e),s=qe.getFrameParams(this.trajPath,this.atomIndices);n.open("POST",i,!0),n.responseType="arraybuffer",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.addEventListener("load",(()=>{const o=n.response;if(!o)return void ke.error(`empty arrayBuffer for '${i}'`);const a=new Int32Array(o,0,1)[0],l=new Float32Array(o,8,9),d=new Float32Array(o,44);this._process(e,l,d,a),typeof t=="function"&&t()}),!1),n.send(s)}_loadFrameCount(){const e=new XMLHttpRequest,t=qe.getCountUrl(this.trajPath);e.open("GET",t,!0),e.addEventListener("load",(()=>{this._setFrameCount(parseInt(e.response))}),!1),e.send()}}class vl extends yl{constructor(e,t,n){super("",t,n),this.requestCallback=e,this._init(t)}get type(){return"callback"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),n=t.length;let i=t[0],s=t[0];for(let o=1;o<n;++o){const a=t[o];s+1<a&&(e.push([i,s+1]),i=a),s=a}e.push([i,s+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){this.requestCallback(((n,i,s,o)=>{this._process(n,i,s,o),typeof t=="function"&&t()}),e,this.atomIndices)}_loadFrameCount(){this.requestCallback((e=>this._setFrameCount(e)))}}Sc.prototype.getView=function(r){return new wl(this,r)};class wl extends Sc{constructor(e,t){super(),this.structure=e,this.selection=t,this.center=new Vector3,this.boundingBox=new Box3,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(e){this.structure._hasCoords=e}refresh(){De&&ke.time("StructureView.refresh"),this.atomSetCache={};const e=this.structure;if(this.selection.isAllSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=e.atomSet.clone(),this.bondSet=e.bondSet.clone();for(let t in this.atomSetDict){const n=this.atomSetDict[t];this.atomSetCache["__"+t]=n.clone()}this.atomCount=e.atomCount,this.bondCount=e.bondCount,this.boundingBox.copy(e.boundingBox),this.center.copy(e.center)}else if(this.selection.isNoneSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=new En(e.atomCount),this.bondSet=new En(e.bondCount);for(let t in this.atomSetDict)this.atomSetCache["__"+t]=new En(e.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),e.atomSet&&(this.atomSet=this.atomSet.intersection(e.atomSet)),this.bondSet=this.getBondSet();for(let t in this.atomSetDict){const n=this.atomSetDict[t];this.atomSetCache["__"+t]=n.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new Vector3)}De&&ke.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(e){this.selection=e,this.refresh()}getSelection(e){const t=[];e&&e.string&&t.push(e.string);const n=this.structure.getSelection();n&&n.string&&t.push(n.string),this.selection&&this.selection.string&&t.push(this.selection.string);let i="";return t.length>0&&(i=`( ${t.join(" ) AND ( ")} )`),new me(i)}getStructure(){return this.structure.getStructure()}eachBond(e,t){this.structure.eachBond(e,this.getSelection(t))}eachAtom(e,t){const n=this.getAtomProxy(),i=this.getAtomSet(t),s=this.atomStore.count;if(i.getSize()<s)i.forEach((function(o){n.index=o,e(n)}));else for(let o=0;o<s;++o)n.index=o,e(n)}eachResidue(e,t){this.structure.eachResidue(e,this.getSelection(t))}eachResidueN(e,t){console.error("StructureView.eachResidueN() not implemented")}eachChain(e,t){this.structure.eachChain(e,this.getSelection(t))}eachModel(e,t){this.structure.eachModel(e,this.getSelection(t))}getAtomSet(e,t=!1){let n=this.structure.getAtomSet(e);return!t&&this.atomSet&&(n=n.makeIntersection(this.atomSet)),n}getAtomIndices(e){return this.structure.getAtomIndices(this.getSelection(e))}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new Sc,delete this.atomSet,delete this.bondSet}}const Al=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]];function Sl(r,e){let t,n=0;const i={};return e.forEach((function(s){t=0;const o={};s.forEach((function(a){o[r[t++]]=a})),i[r[n++]]=o})),i}const Cl={blosum62:Sl("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:Sl("ACDEFGHIKLMNPQRSTVWY",Al)};class Pl{constructor(e,t,n=-10,i=-1,s="blosum62"){this.seq1=e,this.seq2=t,this.gapPenalty=n,this.gapExtensionPenalty=i,s&&(this.substMatrix=Cl[s])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(let t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(let e=0;e<=this.n;++e)this.S[e][0]=this.gap(0),this.H[e][0]=-1/0;for(let e=0;e<=this.m;++e)this.S[0][e]=this.gap(0),this.V[0][e]=-1/0;this.S[0][0]=0}gap(e){return this.gapPenalty+e*this.gapExtensionPenalty}makeScoreFn(){const e=this.seq1,t=this.seq2,n=this.substMatrix;return n?function(i,s){const o=e[i],a=t[s];try{return n[o][a]}catch{return-4}}:(ke.warn("Alignment: no subst matrix"),function(i,s){return e[i]===t[s]?5:-3})}calc(){De&&ke.time("Alignment.calc"),this.initMatrices();const e=this.gap(0),t=this.makeScoreFn(),n=this.gapExtensionPenalty,i=this.V,s=this.H,o=this.S,a=this.n,l=this.m;let d,u,g,x,y;for(let b=1;b<=a;++b){u=o[b-1],d=i[b-1],g=i[b],x=s[b],y=o[b];for(let _=1;_<=l;++_)g[_]=Math.max(u[_]+e,d[_]+n),x[_]=Math.max(y[_-1]+e,x[_-1]+n),y[_]=Math.max(u[_-1]+t(b-1,_-1),g[_],x[_])}De&&ke.timeEnd("Alignment.calc"),De&&ke.log(this.S,this.V,this.H)}trace(){De&&ke.time("Alignment.trace"),this.ali1="",this.ali2="";const e=this.makeScoreFn();let t,n=this.n,i=this.m;for(this.S[n][i]>=this.V[n][i]?(t="S",this.score=this.S[n][i]):this.V[n][i]>=this.H[n][i]?(t="V",this.score=this.V[n][i]):(t="H",this.score=this.H[n][i]),De&&ke.log("Alignment: SCORE",this.score),De&&ke.log("Alignment: S, V, H",this.S[n][i],this.V[n][i],this.H[n][i]);n>0&&i>0;)t==="S"?this.S[n][i]===this.S[n-1][i-1]+e(n-1,i-1)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--n,--i,t="S"):this.S[n][i]===this.V[n][i]?t="V":this.S[n][i]===this.H[n][i]?t="H":(--n,--i):t==="V"?this.V[n][i]===this.V[n-1][i]+this.gapExtensionPenalty?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="V"):this.V[n][i]===this.S[n-1][i]+this.gap(0)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="S"):--n:t==="H"?this.H[n][i]===this.H[n][i-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,t="H"):this.H[n][i]===this.S[n][i-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,t="S"):--i:ke.error("Alignment: no matrix");for(;n>0;)this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n;for(;i>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i;De&&ke.timeEnd("Alignment.trace"),De&&ke.log([this.ali1,this.ali2])}}function Il(r,e,t=!1,n="",i=""){let s,o,a,l,d;if(t){let g=r,x=e;n&&i&&(g=r.getView(new me(n)),x=e.getView(new me(i)));const y=g.getSequence(),b=x.getSequence(),_=new Pl(y.join(""),b.join(""));let h,f;_.calc(),_.trace(),s=0,o=0,a=_.ali1.length;const E=[],m=[];for(let M=0;M<a;++M){const T=_.ali1[M],R=_.ali2[M];h=0,f=0,T==="-"?m[o]=!1:(m[o]=!0,h=1),R==="-"?E[s]=!1:(E[s]=!0,f=1),s+=h,o+=f}const S=[],w=[],v=g.getAtomProxy(),A=x.getAtomProxy();s=0,g.eachResidue((function(M){M.traceAtomIndex!==void 0&&M.traceAtomIndex===M.getAtomIndexByName("CA")&&(E[s]&&(v.index=M.getAtomIndexByName("CA"),S.push(v.x,v.y,v.z)),s+=1)})),s=0,x.eachResidue((function(M){M.traceAtomIndex!==void 0&&M.traceAtomIndex===M.getAtomIndexByName("CA")&&(m[s]&&(A.index=M.getAtomIndexByName("CA"),w.push(A.x,A.y,A.z)),s+=1)})),l=new Float32Array(S),d=new Float32Array(w)}else l=r.getView(new me(`${n} and .CA`)),d=e.getView(new me(`${i} and .CA`));const u=new fl(l,d).transform(r);return r.refreshPosition(),u}const kl=Object.assign({sele:"",defaultAssembly:""},al);class Ml extends cl{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.structure=t,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new signalsExports.Signal,trajectoryRemoved:new signalsExports.Signal,defaultAssemblyChanged:new signalsExports.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=(function(i){let s=0,o=0;const a=[];return{has:function(l){return a.indexOf(l)!==-1},get:function(l){return a[l]},push:function(l){a[s]=l,s=(i+s+1)%i,++o},get count(){return o},get data(){return a.slice(0,Math.min(o,i))},clear:function(){o=0,s=0,a.length=0}}})(4),this.pickDict=(function(){const i={};return{has:function(s){return i[JSON.stringify(s)]!==void 0},add:function(s,o){i[JSON.stringify(s)]=o},del:function(s){delete i[JSON.stringify(s)]},get values(){return Object.keys(i).map((s=>i[s]))}}})(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:Me.opacity,color:Me.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",Me,!0),this.angleRepresentation=this.addRepresentation("angle",Me,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",Me,!0),this.measureRepresentations=new hl([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add((()=>{this.updateRepresentations({position:!0})}))}get defaultParameters(){return kl}get type(){return"structure"}initSelection(e){this.selection=new me(e),this.structureView=new wl(this.structure,this.selection),this.selection.signals.stringChanged.add((()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()}))}setSelection(e){return this.parameters.sele=e,this.selection.setString(e),this}setDefaultAssembly(e){if(this.structure.biomolDict[e]===void 0&&(e=""),this.parameters.defaultAssembly!==e){const t={defaultAssembly:e};this.reprList.forEach((n=>n.setParameters(t))),this.measureRepresentations.setParameters(t),this.parameters.defaultAssembly=e,this.signals.defaultAssemblyChanged.dispatch(e)}return this}rebuildRepresentations(){this.reprList.forEach((e=>{e.build()})),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach((e=>{e.trajectory.setStructure(this.structureView)}))}updateRepresentations(e){super.updateRepresentations(e),this.measureRepresentations.update(e)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(e,t={},n=!1){t.defaultAssembly=this.parameters.defaultAssembly;const i=this._addRepresentation(e,this.structureView,t,n);return n||i.signals.parametersChanged.add((()=>this.measureUpdate())),i}addTrajectory(e="",t={}){const n=(function(s,o,a){let l;return l=s&&s instanceof ml?new bl(s,o,a):!s&&o.frames?new _l(s,o,a):s&&typeof s=="function"?new vl(s,o,a):new xl(s,o,a),l})(e,this.structureView,t),i=new dl(this.stage,n,t);return this.trajList.push(i),this.signals.trajectoryAdded.dispatch(i),i}removeTrajectory(e){const t=this.trajList.indexOf(e);t!==-1&&this.trajList.splice(t,1),e.dispose(),this.signals.trajectoryRemoved.dispatch(e)}dispose(){this.trajList.slice().forEach((e=>e.dispose())),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(e,t){typeof e=="number"&&(t=e,e=""),this.stage.animationControls.zoomMove(this.getCenter(e),this.getZoom(e),nt(t,0))}getBoxUntransformed(e){let t;return t=e?this.structureView.getBoundingBox(new me(e)):this.structureView.boundingBox,t}getCenterUntransformed(e){return e&&typeof e=="string"?this.structure.atomCenter(new me(e)):this.structure.center}superpose(e,t,n,i){return Il(this.structureView,e.structureView,t,n,i),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(e){let t=0;const n=this.structure.getAtomProxy(e);return this.eachRepresentation((i=>{if(i.getVisibility()){const s=i.repr;t=Math.max(s.getAtomRadius(n),t)}})),t}measurePick(e){const t=this.pickBuffer.count;if(this.lastPick===e.index&&t>=1){if(t>1){const n=this.pickBuffer.data,i=this.pickBuffer.data.sort();this.pickDict.has(i)?this.pickDict.del(i):this.pickDict.add(i,n),t===2?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter((s=>s.length===2))}):t===3?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter((s=>s.length===3))}):t===4&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter((s=>s.length===4))})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(e.index)||this.pickBuffer.push(e.index),this.lastPick=e.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const e=this.measureData();this.distanceRepresentation.setParameters({atomPair:e.distance}),this.angleRepresentation.setParameters({atomTriple:e.angle}),this.dihedralRepresentation.setParameters({atomQuad:e.dihedral})}measureUpdate(){const e=this.pickBuffer.data,t={};e.forEach((n=>{const i=Math.max(.1,this.getMaxRepresentationRadius(n));t[n]=i*(2.3-Et(.1,2,i))})),this.spacefillRepresentation.setSelection(e.length?"@"+e.join(","):"none"),e.length&&this.spacefillRepresentation.setParameters({radiusData:t})}measureData(){const e=this.pickDict.values;return{distance:e.filter((t=>t.length===2)),angle:e.filter((t=>t.length===3)),dihedral:e.filter((t=>t.length===4))}}removeAllMeasurements(e){const t=this.pickDict,n=t.values,i=function(s){n.filter((o=>o.length===s)).forEach((o=>t.del(o.slice().sort())))};(!e||1&e)&&i(2),(!e||2&e)&&i(3),(!e||4&e)&&i(4),this.measureBuild()}removeMeasurement(e){this.pickDict.del(e.slice().sort()),this.measureBuild()}addMeasurement(e){if(e.length<2||e.length>4)return;const t=e.slice().sort();this.pickDict.has(t)||this.pickDict.add(t,e),this.measureBuild()}}Ve.add("structure",Ml),Ve.add("structureview",Ml);class Tl extends cl{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.surface=t}get type(){return"surface"}addRepresentation(e,t={}){return this._addRepresentation(e,this.surface,t)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}}Ve.add("surface",Tl);class Dl extends cl{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.volume=t}get type(){return"volume"}addRepresentation(e,t={}){return this._addRepresentation(e,this.volume,t)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}Ve.add("volume",Dl);class Bl extends ll{addRepresentation(e,t){return this.forEach((n=>n.addRepresentation(e,t)))}autoView(e){return this.forEach((t=>t.autoView(e)))}}function Fl(r,e){return r instanceof RegExp?e.name.match(r)!==null:e.name===r}const El=new Vector3,$l={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1.2,ambientColor:14540253,ambientIntensity:.3,hoverTimeout:0,tooltip:!0,mousePreset:"default"};class Ol{constructor(e,t={}){this.signals={parametersChanged:new signalsExports.Signal,fullscreenChanged:new signalsExports.Signal,componentAdded:new signalsExports.Signal,componentRemoved:new signalsExports.Signal,clicked:new signalsExports.Signal,hovered:new signalsExports.Signal},this.tasks=new ui,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new Qi(e),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new rr(this.viewer.renderer.domElement),this.viewerControls=new Ir(this),this.trackballControls=new pr(this),this.pickingControls=new br(this),this.animationControls=new Rr(this),this.mouseControls=new Qo(this),this.keyControls=new ea(this),this.pickingBehavior=new ia(this),this.mouseBehavior=new ra(this),this.animationBehavior=new na(this),this.keyBehavior=new oa(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=st(t,$l),this.setParameters(this.parameters),this.viewer.animate())}setParameters(e={}){ot(this.parameters,e);const t=e,n=this.parameters,i=this.viewer,s=this.trackballControls;return t.quality!==void 0&&this.setQuality(n.quality),t.impostor!==void 0&&this.setImpostor(n.impostor),t.rotateSpeed!==void 0&&(s.rotateSpeed=n.rotateSpeed),t.zoomSpeed!==void 0&&(s.zoomSpeed=n.zoomSpeed),t.panSpeed!==void 0&&(s.panSpeed=n.panSpeed),t.mousePreset!==void 0&&this.mouseControls.preset(n.mousePreset),this.mouseObserver.setParameters({hoverTimeout:n.hoverTimeout}),i.setClip(n.clipNear,n.clipFar,n.clipDist,n.clipMode,n.clipScale),i.setFog(void 0,n.fogNear,n.fogFar),i.setCamera(n.cameraType,n.cameraFov,n.cameraEyeSep),i.setSampling(n.sampleLevel),i.setBackground(n.backgroundColor),i.setLight(n.lightColor,n.lightIntensity,n.ambientColor,n.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this}log(e){console.log("STAGE LOG",e),this.logList.push(e)}getParameters(){return Object.assign({},this.parameters)}defaultFileRepresentation(e){if(e instanceof Ml){let t,n,i;e.setSelection("/0");const s=e.structure;if(s.biomolDict.BU1){const g=s.biomolDict.BU1;t=g.getAtomCount(s),n=g.getResidueCount(s),i=g.getInstanceCount(),e.setDefaultAssembly("BU1")}else t=s.getModelProxy(0).atomCount,n=s.getModelProxy(0).residueCount,i=1;let o=t;Ae&&(o*=4);const a=s.atomStore.count/s.residueStore.count<2;a&&(o*=10);let l="chainname",d="RdYlBu",u=!1;if(s.getChainnameCount(new me("polymer and /0"))===1&&(l="residueindex",d="Spectral",u=!0),De&&console.log(o,t,i,a),n/i<4)e.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(i>5&&o>15e3||o>7e5){let g=Math.min(2,Math.max(.1,6e3/(o/i)));a&&(g=Math.min(g,.5)),e.addRepresentation("surface",{colorScheme:l,colorScale:d,colorReverse:u,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:g,useWorker:!1})}else o>25e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:d,colorReverse:u,lineOnly:!0}):o>1e5?e.addRepresentation("backbone",{colorScheme:l,colorScale:d,colorReverse:u,quality:"low",disableImpostor:!0,radiusScale:2}):o>8e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:d,colorReverse:u,radiusScale:2}):(e.addRepresentation("cartoon",{colorScheme:l,colorScale:d,colorReverse:u,radiusScale:.7,aspectRatio:5,quality:"auto"}),o<5e4&&e.addRepresentation("base",{colorScheme:l,colorScale:d,colorReverse:u,quality:"auto"}),e.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));e.structure.frames.length&&e.addTrajectory()}else(e instanceof Tl||e instanceof Dl)&&e.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)}loadFile(e,t={}){const n=Object.assign({},this.defaultFileParams,t),i=ii(e).name;this.tasks.increment(),this.log(`loading file '${i}'`);const s=nt(n.ext,ii(e).ext);let o;return o=Ne.isTrajectory(s)?Promise.reject(new Error(`loadFile: ext '${s}' is a trajectory and must be loaded into a structure component`)):ni(e,n),o.then((a=>{this.log(`loaded '${i}'`);const l=this.addComponentFromObject(a,n);return n.defaultRepresentation&&this.defaultFileRepresentation(l),this.tasks.decrement(),l}),(a=>{this.tasks.decrement();const l=`error loading file: '${a}'`;throw this.log(l),l}))}loadScript(e){const t=ii(e).name;return this.log(`loading script '${t}'`),ni(e).then((n=>{this.tasks.increment(),this.log(`running script '${t}'`),n.run(this).then((()=>{this.tasks.decrement(),this.log(`finished script '${t}'`)})),this.log(`called script '${t}'`)}),(n=>{this.tasks.decrement();const i=`errored script '${t}' "${n}"`;throw this.log(i),i}))}addComponent(e){e?(this.compList.push(e),this.signals.componentAdded.dispatch(e)):ke.warn("Stage.addComponent: no component given")}addComponentFromObject(e,t={}){const n=Ve.get(e.type);if(n){const i=new n(this,e,t);return this.addComponent(i),i}ke.warn("no component for object type",e.type)}removeComponent(e){const t=this.compList.indexOf(e);t!==-1&&(this.compList.splice(t,1),e.dispose(),this.signals.componentRemoved.dispatch(e))}removeAllComponents(){this.compList.slice().forEach((e=>this.removeComponent(e)))}handleResize(){this.viewer.handleResize()}setSize(e,t){const n=this.viewer.container;n!==document.body&&(e!==void 0&&(n.style.width=e),t!==void 0&&(n.style.height=t),this.handleResize())}toggleFullscreen(e){if(!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))return void ke.log("fullscreen mode (currently) not possible");const t=this;function n(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function i(){if(!n()&&t.lastFullscreenElement){const s=t.lastFullscreenElement;s.style.width=s.dataset.normalWidth||"",s.style.height=s.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),t.handleResize(),t.signals.fullscreenChanged.dispatch(!1)}}e=e||this.viewer.container,this.lastFullscreenElement=e,n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.dataset.normalWidth=e.style.width||"",e.dataset.normalHeight=e.style.height||"",e.style.width=window.screen.width+"px",e.style.height=window.screen.height+"px",e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("MSFullscreenChange",i),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout((function(){t.handleResize()}),100))}setSpin(e){e?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)}setRock(e){e?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)}toggleSpin(){this.setSpin(this.spinAnimation.paused)}toggleRock(){this.setRock(this.rockAnimation.paused)}getFocus(){const e=this.parameters;if(e.clipMode!=="scene")return 0;let t=e.clipNear;return e.clipScale==="absolute"&&(t=this.viewer.absoluteToRelative(t)),2*t}setFocus(e){if(this.parameters.clipMode!=="scene")return;let t,n,i,s;this.parameters.clipScale==="relative"?(t=Dt(e/2,0,49.9),n=100-t,i=50,s=(function(o){return Dt(o,0,100)})(2*n-50)):(t=this.viewer.relativeToAbsolute(e/2),n=t,i=0,s=2*n),this.setParameters({clipNear:t,clipFar:n,fogNear:i,fogFar:s})}getZoomForBox(e){const t=e.getSize(El),n=Math.max(t.x,t.y,t.z),i=Math.min(t.x,t.y,t.z);let s=n+Math.sqrt(i);const o=It(this.viewer.perspectiveCamera.fov),a=this.viewer.width,l=this.viewer.height,d=l<a?1:a/l;return s=Math.abs(.5*s/d/Math.sin(o/2)),s+=this.parameters.clipDist,-s}getBox(){return this.viewer.boundingBox}getZoom(){return this.getZoomForBox(this.getBox())}getCenter(e){return this.getBox().getCenter(e||new Vector3)}autoView(e){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),nt(e,0))}makeImage(e={}){return new Promise(((t,n)=>{this.tasks.onZeroOnce((()=>{this.tasks.increment(),this.viewer.makeImage(e).then((i=>{this.tasks.decrement(),t(i)})).catch((i=>{this.tasks.decrement(),n(i)}))}))}))}setImpostor(e){this.parameters.impostor=e;const t=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(n){if(!t.includes(n.getType()))return;const i=n.getParameters();i.disableImpostor=!e,n.build(i)}))}setQuality(e){this.parameters.quality=e;const t=["tube","cartoon","ribbon","trace","rope"],n=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(i){const s=i.getParameters();if(!t.includes(i.getType())){if(!n.includes(i.getType()))return;if(!s.disableImpostor)return void(i.repr.quality=e)}s.quality=e,i.build(s)}))}eachComponent(e,t){this.compList.slice().forEach((n=>{t!==void 0&&t!==n.type||e(n)}))}eachRepresentation(e,t){this.eachComponent((n=>{n.reprList.slice().forEach((i=>{t!==void 0&&t!==i.getType()||e(i,n)}))}))}getComponentsByName(e){const t=[];return this.eachComponent((n=>{(e===void 0||Fl(e,n))&&t.push(n)})),new Bl(t)}getComponentsByObject(e){const t=[];return this.eachComponent((n=>{n.object===e&&t.push(n)})),new Bl(t)}getRepresentationsByName(e){const t=[];return this.eachRepresentation(((n,i)=>{(e===void 0||Fl(e,n))&&t.push(n)})),new hl(t)}measureClear(){this.eachComponent((e=>e.measureClear()),"structure")}measureUpdate(){this.eachComponent((e=>e.measureUpdate()),"structure")}dispose(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()}}class Rl extends cl{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.shape=t}get type(){return"shape"}addRepresentation(e,t={}){return this._addRepresentation(e,this.shape,t)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}function Ll(r,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(i=r[a])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}function Nl(r,e,t,n){return new(t||(t=Promise))((function(i,s){function o(d){try{l(n.next(d))}catch(u){s(u)}}function a(d){try{l(n.throw(d))}catch(u){s(u)}}function l(d){d.done?i(d.value):(function(u){return u instanceof t?u:new t((function(g){g(u)}))})(d.value).then(o,a)}l((n=n.apply(r,[])).next())}))}Ve.add("shape",Rl),typeof SuppressedError=="function"&&SuppressedError;class zl extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=nt(e.reverse,!0)),this.scalePerModel={},e.structure.eachModel((t=>{this.parameters.domain=[t.atomOffset,t.atomEnd],this.scalePerModel[t.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.index)}}Ll([Lt],zl.prototype,"atomColor",null),Oe.add("atomindex",zl);class Ul extends Nt{constructor(e){if(super(e),e.scale||(this.parameters.scale="OrRd"),!e.domain){let t,n=1/0,i=-1/0;e.sele&&(t=new me(e.sele)),e.structure.eachAtom((function(s){const o=s.bfactor;n=Math.min(n,o),i=Math.max(i,o)}),t),this.parameters.domain=[n,i]}this.bfactorScale=this.getScale()}atomColor(e){return this.bfactorScale(e.bfactor)}}Ll([Lt],Ul.prototype,"atomColor",null),Oe.add("bfactor",Ul);class Vl extends Nt{constructor(e){super(e),this.chainidDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((t=>{let n=0;const i={};t.eachChain((function(s){i[s.chainid]===void 0&&(i[s.chainid]=n,n+=1)})),this.parameters.domain=[0,n-1],this.chainidDictPerModel[t.index]=i,this.scalePerModel[t.index]=this.getScale()}))}atomColor(e){const t=this.chainidDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainid])}}Ll([Lt],Vl.prototype,"atomColor",null),Oe.add("chainid",Vl);class jl extends Nt{constructor(e){super(e),this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((t=>{this.parameters.domain=[t.chainOffset,t.chainEnd],this.scalePerModel[t.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.chainIndex)}}Ll([Lt],jl.prototype,"atomColor",null),Oe.add("chainindex",jl);class Gl extends Nt{constructor(e){super(e),this.chainnameDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((t=>{let n=0;const i={};t.eachChain((function(s){i[s.chainname]===void 0&&(i[s.chainname]=n,n+=1)})),this.parameters.domain=[0,n-1],this.chainnameDictPerModel[t.index]=i,this.scalePerModel[t.index]=this.getScale()}))}atomColor(e){const t=this.chainnameDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainname])}}Ll([Lt],Gl.prototype,"atomColor",null),Oe.add("chainname",Gl);class Hl extends Nt{constructor(e){super(e),this.rsrzDict={},this.rsccDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const t=e.structure.validation;t&&(this.rsrzDict=t.rsrzDict,this.rsccDict=t.rsccDict)}atomColor(e){let t=e.resno+"";e.inscode&&(t+="^"+e.inscode),e.chainname&&(t+=":"+e.chainname),t+="/"+e.modelIndex;const n=this.rsrzDict[t];if(n!==void 0)return this.rsrzScale(n);const i=this.rsccDict[t];return i!==void 0?this.rsccScale(i):9474192}}Ll([Lt],Hl.prototype,"atomColor",null),Oe.add("densityfit",Hl);const ql={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}};class Wl extends Nt{constructor(e){super(e),this.delta=new Vector3,this.hCharges=[],e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(e.structure.atomCount);const t=[];e.structure.eachAtom((i=>{var s;if(this.charges[i.index]=((s=i).partialCharge!==null?s.partialCharge:s.isProtein()&&(ql[s.resname]&&ql[s.resname][s.atomname]||ql.backbone[s.atomname])||0)*i.occupancy,i.atomname==="N"){if(i.bondCount>=3||i.bondToElementCount(1))return;const o=(function(a,l=new Vector3){let d=!1,u=!1,g=!1;return l.set(2*a.x,2*a.y,2*a.z),a.eachBondedAtom((function(x){if(!d)return x.atomname==="H"?(l.set(x.x,x.y,x.z),void(d=!0)):void(u||x.atomname!=="CA"?g||x.atomname!=="C"||(g=!0,l.sub(x)):(l.sub(x),u=!0))})),d?l:u&&g?(l.normalize(),l.multiplyScalar(1.04),l.add(a),l):void 0})(i);o!==void 0&&(t.push(o),this.hCharges.push(.25*i.occupancy))}}));const n=e.structure.getBoundingBox();n.expandByScalar(1.04),this.hStore=(function(i){const s=i.length,o=new Float32Array(s),a=new Float32Array(s),l=new Float32Array(s);for(let d=0;d<i.length;d++){const u=i[d];o[d]=u.x,a[d]=u.y,l[d]=u.z}return{x:o,y:a,z:l,count:s}})(t),this.hHash=new Tn(this.hStore,n),this.hash=new Tn(e.structure.atomStore,n)}positionColor(e){const t=this.charges,n=this.hCharges;let i=0;return this.hash.eachWithin(e.x,e.y,e.z,12,((s,o)=>{const a=t[s];a!==0&&(i+=a/o)})),this.hHash.eachWithin(e.x,e.y,e.z,12,((s,o)=>{const a=n[s];a!==0&&(i+=a/o)})),this.scale(332*i)}}Ll([Lt],Wl.prototype,"positionColor",null),Oe.add("electrostatic",Wl);const Xl={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120};class Yl extends Nt{constructor(e){e.value=nt(e.value,Xl.C),super(e)}atomColor(e){const t=e.element;return t==="C"?this.parameters.value:Xl[t]||16777215}}Ll([Lt],Yl.prototype,"atomColor",null),Oe.add("element",Yl);class Kl extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="Spectral"),e.domain||(this.parameters.domain=[0,e.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(e){return this.entityindexScale(e.entityIndex)}}Ll([Lt],Kl.prototype,"atomColor",null),Oe.add("entityindex",Kl);class Zl extends Nt{atomColor(e){const t=e.entity;switch(t?t.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}}}Ll([Lt],Zl.prototype,"atomColor",null),Oe.add("entitytype",Zl);class Ql extends Nt{constructor(e){super(e),this.geoAtomDict={},this.geoDict={};const t=e.structure.validation;t&&(this.geoAtomDict=t.geoAtomDict,this.geoDict=t.geoDict)}atomColor(e){let t,n=e.resno+"";e.inscode&&(n+="^"+e.inscode),e.chainname&&(n+=":"+e.chainname),n+="/"+e.modelIndex;const i=this.geoAtomDict[n];i!==void 0?(s=i[e.atomname]||0,t=16843009*((s=(858993459&(s-=s>>1&1431655765))+(s>>2&858993459))+(s>>4)&252645135)>>24):t=this.geoDict[n]||0;var s;return t===0?2188972:t===1?16703627:t===2?16018755:t>=3?10813478:9474192}}Ll([Lt],Ql.prototype,"atomColor",null),Oe.add("geoquality",Ql);class Jl extends Nt{constructor(e){super(e),this.resHF={},e.scale||(this.parameters.scale="RdYlGn");for(const t in Jn)this.resHF[t]=Jn[t][0];if(this.defaultResidueHydrophobicity=ts[0],!e.domain){let t=1/0,n=-1/0;for(const i in this.resHF){const s=this.resHF[i];t=Math.min(t,s),n=Math.max(n,s)}this.parameters.domain=[t,0,n]}this.hfScale=this.getScale()}atomColor(e){return this.hfScale(this.resHF[e.resname]||this.defaultResidueHydrophobicity)}}Ll([Lt],Jl.prototype,"atomColor",null),Oe.add("hydrophobicity",Jl);class th extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow"),e.domain||(this.parameters.domain=[0,e.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(e){return this.modelindexScale(e.modelIndex)}}Ll([Lt],th.prototype,"atomColor",null),Oe.add("modelindex",th);class eh extends Nt{atomColor(e){switch(e.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}}}Ll([Lt],eh.prototype,"atomColor",null),Oe.add("moleculetype",eh);class ih extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="PuBu"),e.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(e){return this.occupancyScale(e.occupancy)}}Ll([Lt],ih.prototype,"atomColor",null),Oe.add("occupancy",ih);class rh extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(e){return this.partialchargeScale(e.partialCharge||0)}}function nh(){return 16777215*Math.random()}Ll([Lt],rh.prototype,"atomColor",null),Oe.add("partialcharge",rh);class sh extends Nt{atomColor(){return nh()}volumeColor(){return nh()}positionColor(){return nh()}}Ll([Lt],sh.prototype,"atomColor",null),Ll([Lt],sh.prototype,"volumeColor",null),Ll([Lt],sh.prototype,"positionColor",null),Oe.add("random",sh);class oh extends Nt{constructor(e){super(e),this.rciDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const t=e.structure.validation;t&&(this.rciDict=t.rciDict)}atomColor(e){let t=`[${e.resname}]${e.resno}`;e.chainname&&(t+=":"+e.chainname);const n=this.rciDict[t];return n!==void 0?this.rciScale(n):9474192}}Ll([Lt],oh.prototype,"atomColor",null),Oe.add("randomcoilindex",oh);class ah extends Nt{constructor(e){super(e),this.scalePerChain={},e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=nt(e.reverse,!0)),e.structure.eachChain((t=>{this.parameters.domain=[t.residueOffset,t.residueEnd],this.scalePerChain[t.index]=this.getScale()}))}atomColor(e){return this.scalePerChain[e.chainIndex](e.residueIndex)}}Ll([Lt],ah.prototype,"atomColor",null),Oe.add("residueindex",ah);const ch={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723};class lh extends Nt{atomColor(e){return ch[e.resname]||16711935}}Ll([Lt],lh.prototype,"atomColor",null),Oe.add("resname",lh);const hh=16711808,uh=10485888,dh=6291584,mh=16762880,fh=6324479,ph=16777215,gh=11403518,yh=16580962,bh=10921722;class _h extends Nt{constructor(e){super(e),this.residueProxy=e.structure.getResidueProxy()}atomColor(e){const t=e.sstruc,n=this.residueProxy;return t==="h"?hh:t==="g"?uh:t==="i"?dh:t==="e"||t==="b"?mh:t==="t"?fh:(n.index=e.residueIndex,n.isDna()?gh:n.isRna()?yh:n.isSaccharide()?bh:n.isProtein()||t==="s"||t==="l"?ph:8421504)}}Ll([Lt],_h.prototype,"atomColor",null),Oe.add("sstruc",_h);class xh extends Nt{constructor(e){var t,n;super(e),e.scale||(this.parameters.scale="rwb"),this.atomData=(t=this.parameters.data)===null||t===void 0?void 0:t.atomData,this.bondData=(n=this.parameters.data)===null||n===void 0?void 0:n.bondData,this.scale=this.getScale(this.parameters)}atomColor(e){var t;const n=(t=this.atomData)===null||t===void 0?void 0:t[e.index];return n!==void 0?this.scale(n):this.parameters.value}bondColor(e,t){var n;const i=(n=this.bondData)===null||n===void 0?void 0:n[e.index];return i!==void 0?this.scale(i):this.atomProxy?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}Ll([Lt],xh.prototype,"atomColor",null),Ll([Lt],xh.prototype,"bondColor",null),Oe.add("structuredata",xh);class vh extends Nt{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}Ll([Lt],vh.prototype,"atomColor",null),Ll([Lt],vh.prototype,"bondColor",null),Ll([Lt],vh.prototype,"valueColor",null),Ll([Lt],vh.prototype,"volumeColor",null),Oe.add("uniform",vh);class wh extends Nt{constructor(e){super(e),this.valueScale=this.getScale()}volumeColor(e){return this.valueScale(this.parameters.volume.data[e])}}Ll([Lt],wh.prototype,"volumeColor",null),Oe.add("value",wh);class Ah extends Nt{constructor(e){super(e),this.vec=new Vector3,this.valueScale=this.getScale()}positionColor(e){const t=this.parameters.volume;if(!t||!t.inverseMatrix)return this.parameters.value;const n=this.vec,i=t.data,s=t.nx,o=t.ny,a=s*o;n.copy(e),n.applyMatrix4(t.inverseMatrix);const l=Math.floor(n.x),d=Math.floor(n.y),u=Math.floor(n.z),g=(u*o+d)*s+l,x=g+1,y=g+s,b=g+a,_=y+1,h=b+1,f=y+a,E=f+1,m=i[g],S=i[x],w=i[y],v=i[b],A=i[_],M=i[h],T=i[f],R=i[E],O=n.x-l,L=n.y-d,P=n.z-u,I=Bt(m,S,O),N=Bt(v,M,O),U=Bt(w,A,O),F=Bt(T,R,O),k=Bt(I,U,L),j=Bt(N,F,L),H=Bt(k,j,P);return this.valueScale(H)}}Ll([Lt],Ah.prototype,"positionColor",null),Oe.add("volume",Ah);class Sh extends Nr{constructor(e,t,n){const i=n||{};if(super(e,t,i),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:ma.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new me(i.sele),this.dataList=[],this.structure=e,this.structureView=this.structure.getView(this.selection),e.biomolDict){const s={default:"default","":e.unitcell?"AU":"FULL"};Object.keys(e.biomolDict).forEach((function(o){s[o]=o})),this.parameters.assembly={type:"select",options:s,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(e){const t=e||{};t.colorScheme=nt(t.colorScheme,"element"),this.setRadius(t.radius,t),this.radiusType=nt(t.radiusType,"vdw"),this.radiusData=nt(t.radiusData,{}),this.radiusSize=nt(t.radiusSize,1),this.radiusScale=nt(t.radiusScale,1),this.assembly=nt(t.assembly,"default"),this.defaultAssembly=nt(t.defaultAssembly,""),t.quality==="auto"&&(t.quality=this.getQuality()),super.init(t),this.selection.signals.stringChanged.add((()=>{this.build()})),this.build()}setRadius(e,t){const n=Object.keys(da);return typeof e=="string"&&n.includes(e.toLowerCase())?t.radiusType=e:e!==void 0&&(t.radiusType="size",t.radiusSize=e),this}getAssembly(){const e=this.assembly==="default"?this.defaultAssembly:this.assembly;return this.structure.biomolDict[e]}getQuality(){let e;const t=this.structureView,n=this.getAssembly();return e=n?n.getAtomCount(t):t.atomCount,Ae&&(e*=4),t.atomStore.count/t.residueStore.count<2&&(e*=10),e<15e3?"high":e<8e4?"medium":"low"}create(){if(this.structureView.atomCount===0)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const e=this.getAssembly();if(e)e.partList.forEach(((t,n)=>{const i=t.getView(this.structureView);if(i.atomCount===0)return;const s=this.createData(i,n);s&&(s.sview=i,s.instanceList=t.getInstanceList(),this.dataList.push(s))}));else{const t=this.createData(this.structureView,0);t&&(t.sview=this.structureView,this.dataList.push(t))}}update(e){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach((t=>{t.bufferList.length>0&&this.updateData(e,t)}),this):Object.assign(this.lazyProps.what,e)}updateData(e,t){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(e){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getBondParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getAtomRadius(e){return this.structureView.atomSet.isSet(e.index)?new ma(this.getRadiusParams()).atomRadius(e):0}setSelection(e,t){return this.selection.setString(e,t),this}setParameters(e,t={},n=!1){const i=e||{};return this.setRadius(i.radius,i),i.radiusType===void 0&&i.radiusData===void 0&&i.radiusSize===void 0&&i.radiusScale===void 0||(t.radius=!0,Pe&&!this.disableImpostor||(n=!0)),i.defaultAssembly!==void 0&&i.defaultAssembly!==this.defaultAssembly&&(this.assembly==="default"&&i.assembly===void 0||i.assembly==="default")&&(n=!0),super.setParameters(i,t,n),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(e){const t=this.viewer,n=this.bufferList;this.dataList.forEach((function(i){i.bufferList.forEach((function(s){n.push(s),t.add(s,i.instanceList)}))})),this.setVisibility(this.visible),e()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class Ch extends Sh{constructor(e,t,n){super(e,t,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(e){const t=e||{};this.labelVisible=nt(t.labelVisible,!0),this.labelSize=nt(t.labelSize,2),this.labelColor=nt(t.labelColor,16777215),this.labelFontFamily=nt(t.labelFontFamily,"sans-serif"),this.labelFontStyle=nt(t.labelFontstyle,"normal"),this.labelFontWeight=nt(t.labelFontWeight,"bold"),this.labelsdf=nt(t.labelsdf,ve==="Chrome"),this.labelXOffset=nt(t.labelXOffset,0),this.labelYOffset=nt(t.labelYOffset,0),this.labelZOffset=nt(t.labelZOffset,.5),this.labelAttachment=nt(t.labelAttachment,"bottom-left"),this.labelBorder=nt(t.labelBorder,!1),this.labelBorderColor=nt(t.labelBorderColor,"lightgrey"),this.labelBorderWidth=nt(t.labelBorderWidth,.15),this.labelBackground=nt(t.labelBackground,!1),this.labelBackgroundColor=nt(t.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=nt(t.labelBackgroundMargin,.5),this.labelBackgroundOpacity=nt(t.labelBackgroundOpacity,1),this.labelFixedSize=nt(t.labelFixedSize,!1),this.lineOpacity=nt(t.lineOpacity,1),this.linewidth=nt(t.linewidth,2),super.init(t)}update(e){e.position?this.build():super.update(e)}updateData(e,t){const n={};if(e&&!e.labelSize||Object.assign(n,{size:Ai(this.n,this.labelSize)}),!e||e.labelColor){const i=new Color(this.labelColor);Object.assign(n,{color:Si(this.n,i.r,i.g,i.b)})}this.textBuffer.setAttributes(n)}setParameters(e,t={},n=!1){return e&&e.labelSize&&(t.labelSize=!0),e&&(e.labelColor||e.labelColor===0)&&(t.labelColor=!0,n=!0),super.setParameters(e,t,n),e&&e.opacity!==void 0&&this.textBuffer.setParameters({opacity:1}),e&&e.labelVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),t||this.viewer.requestRender(),this}getLabelBufferParams(e={}){return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},e,{opacity:1}))}getAtomRadius(){return 0}}function Ph(r,e){const t=r.getAtomProxy(),n=new me,i=e.length;if(i===0)return new Float32Array(0);const s=e[0].length,o=r.getAtomSet(),a=new Float32Array(i*s*3);let l=0;return e.forEach((function(d){let u=!1;for(let g=0;g<s;g++){const x=d[g];if(typeof x=="number"&&Number.isInteger(x)){if(!o.get(x)){u=!0;break}t.index=x}else{n.setString(x);const b=r.getAtomIndices(n);if(!b.length){u=!0;break}t.index=b[0]}let y=l+3*g;a[y++]=t.x,a[y++]=t.y,a[y++]=t.z}u||(l+=3*s)})),a.subarray(0,l)}function Ih(r,e,t,n,i){const s=Math.cos(i),o=Math.sin(i);r[0]=e[0]+t[0]*s+n[0]*o,r[1]=e[1]+t[1]*s+n[1]*o,r[2]=e[2]+t[2]*s+n[2]*o}function kh(r,e,t,n,i,s,o){for(let a=0;a<e;a++){for(let l=0;l<t;l++)n[l]=r[l*e+a];Mh(n,i,s,o,t);for(let l=0;l<t;l++)r[l*e+a]=i[l]}for(let a=0;a<t;a++){for(let l=0;l<e;l++)n[l]=r[a*e+l];Mh(n,i,s,o,e);for(let l=0;l<e;l++)r[a*e+l]=Math.sqrt(i[l])}}function Mh(r,e,t,n,i){t[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(let s=1,o=0;s<i;s++){let a=(r[s]+s*s-(r[t[o]]+t[o]*t[o]))/(2*s-2*t[o]);for(;a<=n[o];)o--,a=(r[s]+s*s-(r[t[o]]+t[o]*t[o]))/(2*s-2*t[o]);o++,t[o]=s,n[o]=a,n[o+1]=Number.MAX_SAFE_INTEGER}for(let s=0,o=0;s<i;s++){for(;n[o+1]<s;)o++;e[s]=(s-t[o])*(s-t[o])+r[t[o]]}}ze.add("shader/SDFFont.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float xOffset;
uniform float yOffset;
uniform float zOffset;
uniform bool ortho;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
attribute vec2 mapping;
attribute vec2 inputTexCoord;
attribute float inputSize;
#include matrix_scale
#include common
void main(void){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
texCoord = inputTexCoord;
float scale = matrixScale( modelViewMatrix );
float _xOffset = xOffset * scale;
float _yOffset = yOffset * scale;
float _zOffset = zOffset * scale;
if( texCoord.x == 10.0 ){
_zOffset -= 0.001;
}
vec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );
#ifdef FIXED_SIZE
if ( ortho ) {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;
} else {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;
}
#endif
vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );
cameraCornerPos.xy += mapping * inputSize * 0.01 * scale;
cameraCornerPos.x += _xOffset;
cameraCornerPos.y += _yOffset;
if( ortho ){
cameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;
} else {
cameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;
}
gl_Position = projectionMatrix * cameraCornerPos;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -cameraCornerPos.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),ze.add("shader/SDFFont.frag",`uniform sampler2D fontTexture;
uniform float opacity;
uniform bool showBorder;
uniform vec3 borderColor;
uniform float borderWidth;
uniform vec3 backgroundColor;
uniform float backgroundOpacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
const vec3 vColor = vec3( 0.0 );
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#endif
const float gamma = 2.2 * 1.4142 / 128.0;
const float padding = 0.75;
void main(){
#include nearclip_fragment
#include radiusclip_fragment
if( texCoord.x > 1.0 ){
gl_FragColor = vec4( backgroundColor, backgroundOpacity );
}else{
float sdf = texture2D( fontTexture, texCoord ).a;
if( showBorder ) sdf += borderWidth;
float a = smoothstep(padding - gamma, padding + gamma, sdf);
if( a < 0.2 ) discard;
a *= opacity;
vec3 outgoingLight = vColor;
if( showBorder && sdf < ( padding + borderWidth ) ){
outgoingLight = borderColor;
}
gl_FragColor = vec4( outgoingLight, a );
}
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Th={},Dh={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class Bh{constructor(e={}){this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=st(e,Dh);const t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;const n=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),i=this.maxWidth=t.width/4,s=this.canvas=document.createElement("canvas");s.width=i,s.height=n;const o=this.context=this.canvas.getContext("2d",{willReadFrequently:!0});o.font=`${t.style} ${t.variant} ${t.weight} ${t.size}px ${t.font}`,o.fillStyle="black",o.textAlign="left",o.textBaseline="bottom",o.lineJoin="round",this.gridOuter=new Float64Array(n*i),this.gridInner=new Float64Array(n*i),this.f=new Float64Array(Math.max(n,i)),this.d=new Float64Array(Math.max(n,i)),this.z=new Float64Array(Math.max(n,i)+1),this.v=new Int16Array(Math.max(n,i)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map("");for(let a=32;a<=126;++a)this.map(String.fromCharCode(a));this.map(""),this.map(""),this.texture=new CanvasTexture(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(e){const t=this.parameters;return this.mapped[e]===void 0&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]}get(e){return this.mapped[e]||this.placeholder}draw(e){const t=this.parameters,n=this.lineHeight,i=t.outline,s=this.context,o=this.maxWidth,a=i,l=n-t.outline,d=s.measureText(e),u=Math.min(o,Math.ceil(d.width+2*a+1)),g=u*n;s.clearRect(0,0,u,n),s.fillText(e,a,l);const x=s.getImageData(0,0,u,n),y=x.data;for(let b=0;b<g;b++){const _=x.data[4*b+3]/255;this.gridOuter[b]=_===1?0:_===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-_),2),this.gridInner[b]=_===1?Number.MAX_SAFE_INTEGER:_===0?0:Math.pow(Math.max(0,_-.5),2)}kh(this.gridOuter,u,n,this.f,this.d,this.v,this.z),kh(this.gridInner,u,n,this.f,this.d,this.v,this.z);for(let b=0;b<g;b++){const _=this.gridOuter[b]-this.gridInner[b];y[4*b+3]=Math.max(0,Math.min(255,Math.round(255-255*(_/this.radius+this.cutoff))))}s.putImageData(x,0,0),this.scratchW=u,this.scratchH=n}}const Fh=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},No),Eh=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},zo);function $h(r,e){const t=r.position.length/3;let n=0;for(let i=0;i<t;++i)n+=r.text[i].length;return e.showBackground&&(n+=t),n}class Oh extends Nc{constructor(e,t={}){super({position:new Float32Array(3*$h(e,t)),color:new Float32Array(3*$h(e,t)),picking:new to},t),this.parameterTypes=Eh,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=e.text,this.positionCount=e.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new Color(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new Color(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(e),this.makeTexture(),this.makeMapping()}get defaultParameters(){return Fh}makeMaterial(){super.makeMaterial();const e=this.texture,t=this.material;t.transparent=!0,t.extensions.derivatives=!0,t.lights=!1,t.uniforms.fontTexture.value=e,t.needsUpdate=!0;const n=this.wireframeMaterial;n.transparent=!0,n.extensions.derivatives=!0,n.lights=!1,n.uniforms.fontTexture.value=e,n.needsUpdate=!0;const i=this.pickingMaterial;i.extensions.derivatives=!0,i.lights=!1,i.uniforms.fontTexture.value=e,i.needsUpdate=!0}setAttributes(e={}){let t,n,i,s,o,a;const l=this.text,d=this.geometry.attributes;e.position&&(t=e.position,s=d.position.array,d.position.needsUpdate=!0),e.size&&(n=e.size,o=d.inputSize.array,d.inputSize.needsUpdate=!0),e.color&&(i=e.color,a=d.color.array,d.color.needsUpdate=!0);const u=this.positionCount;let g,x,y,b,_,h=0;for(let f=0;f<u;++f)for(x=3*f,y=l[f],_=y.length,this.parameters.showBackground&&(_+=1),b=0;b<_;++b,++h)for(let E=0;E<4;E++)g=4*h*3+3*E,t&&(s[g]=t[x],s[g+1]=t[x+1],s[g+2]=t[x+2]),n&&(o[4*h+E]=n[f]),i&&(a[g]=i[x],a[g+1]=i[x+1],a[g+2]=i[x+2])}makeTexture(){this.textAtlas=(function(e){const t=JSON.stringify(e);return Th[t]===void 0&&(Th[t]=new Bh(e)),Th[t]})({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const e=this.textAtlas,t=this.text,n=this.parameters.attachment,i=e.lineHeight*this.parameters.backgroundMargin*.1-10,s=this.geometry.attributes,o=s.inputTexCoord.array,a=s.mapping.array,l=this.positionCount;let d,u,g,x,y,b,_,h,f=0;for(let E=0;E<l;++E){for(g=t[E],x=0,b=g.length,y=0;y<b;++y)d=e.get(g[y]),x+=d.w-2*e.parameters.outline;for(h=n.startsWith("top")?e.lineHeight/1.25:n.startsWith("middle")?e.lineHeight/2.5:0,_=n.endsWith("right")?x:n.endsWith("center")?x/2:0,_+=e.parameters.outline,h+=e.parameters.outline,this.parameters.showBackground&&(u=2*f*4,a[u+0]=-e.lineHeight/6-_-i,a[u+1]=e.lineHeight-h+i,a[u+2]=-e.lineHeight/6-_-i,a[u+3]=0-h-i,a[u+4]=x+e.lineHeight/6-_+2*e.parameters.outline+i,a[u+5]=e.lineHeight-h+i,a[u+6]=x+e.lineHeight/6-_+2*e.parameters.outline+i,a[u+7]=0-h-i,o[u+0]=10,o[u+2]=10,o[u+4]=10,o[u+6]=10,f+=1),x=0,y=0;y<b;++y,++f){d=e.get(g[y]),u=2*f*4,a[u+0]=x-_,a[u+1]=d.h-h,a[u+2]=x-_,a[u+3]=0-h,a[u+4]=x+d.w-_,a[u+5]=d.h-h,a[u+6]=x+d.w-_,a[u+7]=0-h;const m=e.parameters.width,S=e.parameters.height,w=[d.x/m,d.y/S,d.x/m,(d.y+d.h)/S,(d.x+d.w)/m,d.y/S,(d.x+d.w)/m,(d.y+d.h)/S];o.set(w,u),x+=d.w-2*e.parameters.outline}}s.inputTexCoord.needsUpdate=!0,s.mapping.needsUpdate=!0}getDefines(e){const t=super.getDefines(e);return this.parameters.fixedSize&&(t.FIXED_SIZE=1),t}setUniforms(e){!e||e.fontFamily===void 0&&e.fontStyle===void 0&&e.fontWeight===void 0&&e.fontSize===void 0||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,e.fontTexture=this.texture),super.setUniforms(e)}}je.add("text",Oh),ze.add("shader/WideLine.vert",`
uniform float clipNear;
uniform vec3 clipCenter;
uniform float linewidth;
uniform vec2 resolution;
uniform mat4 projectionMatrixInverse;
attribute vec2 mapping;
attribute vec3 position1;
attribute vec3 position2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void trimSegment( const in vec4 start, inout vec4 end ) {
float a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;
float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
end.xyz = mix( start.xyz, end.xyz, alpha );
}
void main() {
float aspect = resolution.x / resolution.y;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
flag = mapping.y;
vColor = color;
vColor2 = color2;
#endif
vec4 start = modelViewMatrix * vec4( position1, 1.0 );
vec4 end = modelViewMatrix * vec4( position2, 1.0 );
bool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {
if ( start.z < 0.0 && end.z >= 0.0 ) {
trimSegment( start, end );
} else if ( end.z < 0.0 && start.z >= 0.0 ) {
trimSegment( end, start );
}
}
vec4 clipStart = projectionMatrix * start;
vec4 clipEnd = projectionMatrix * end;
vec2 ndcStart = clipStart.xy / clipStart.w;
vec2 ndcEnd = clipEnd.xy / clipEnd.w;
vec2 dir = ndcEnd - ndcStart;
dir.x *= aspect;
dir = normalize( dir );
vec2 offset = vec2( dir.y, - dir.x );
dir.x /= aspect;
offset.x /= aspect;
if ( mapping.x < 0.0 ) offset *= - 1.0;
offset *= linewidth;
offset /= resolution.y;
vec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;
offset *= clip.w;
clip.xy += offset;
gl_Position = clip;
#ifndef PICKING
vViewPosition = ( projectionMatrixInverse * clip ).xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),ze.add("shader/WideLine.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include fog_pars_fragment
varying vec3 vViewPosition;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
#endif
void main() {
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
if ( flag < 0.0 ) {
diffuseColor.rgb *= vColor;
} else {
diffuseColor.rgb *= vColor2;
}
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Rh=Object.assign({linewidth:2},No),Lh=Object.assign({linewidth:{uniform:!0}},zo);class Nh extends Nc{constructor(e,t={}){super(e,t),this.parameterTypes=Lh,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!e.color2&&e.color&&(e.color2=e.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new Vector2},projectionMatrixInverse:{value:new Matrix4}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Rh}setParameters(e){super.setParameters(e)}}je.add("wideline",Nh);class zh extends Ch{constructor(e,t,n){super(e,t,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=nt(t.side,"double"),t.opacity=nt(t.opacity,.5),this.atomTriple=nt(t.atomTriple,[]),this.arcVisible=nt(t.arcVisible,!0),this.sectorVisible=nt(t.sectorVisible,!0),this.vectorVisible=nt(t.vectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomTriple.length)return;const t=(function(a,l){return(function(d){const u=[],g=d.length/9;for(let b=0;b<g;b++){let _=!0;for(let h=b;h<b+3;h+=3)d[h]===d[h+3]&&d[h+1]===d[h+4]&&d[h+2]===d[h+5]&&(_=!1);_&&u.push(b)}const x=new Float32Array(9*u.length);let y=0;return u.forEach((function(b){ki(d,x,9*b,9*y,9),y++})),x})(Ph(a,l))})(e,this.atomTriple),n=(function(a,l={}){const d=nt(l.angleStep,Math.PI/90),u=a.length/9,g=new Float32Array(u),x=new Float32Array(3*u),y=new Array(u),b=new Float32Array(6*u),_=new Float32Array(6*u),h=new Array(u),f=new Array(u),E=new Array(u);let m=0;const S=Xr(),w=Xr(),v=Xr(),A=Xr(),M=Xr(),T=Xr(),R=Xr(),O=Xr(),L=Xr();for(var P=0;P<u;P++){let B=9*P;Jr(S,a,B),Jr(w,a,B+3),Jr(v,a,B+6);let V=6*P;tn(S,b,V),tn(w,_,V),tn(w,b,V+3),tn(v,_,V+3),Zr(A,S,w),Zr(M,v,w),on(A,A),on(M,M),Yr(T,A,M);const Y=rn(T),K=Kr(A,M),J=g[P]=Math.atan2(Y,K);y[P]=(_i*J).toFixed(1)+"",rn(T)===0&&(T[0]=1,T[1]=0,T[2]=0),Yr(R,T,A),on(R,R),Ih(O,w,A,R,J/2),tn(O,x,3*P);const Te=Math.ceil(J/d),He=new Float32Array(9*Te);E[P]=He;const Q=new Float32Array(3*Te),Xe=new Float32Array(3*Te);h[P]=Q,f[P]=Xe,Qr(L,w,A);const ut=function(er,ec){const ai=9*ec,u0=3*ec;tn(w,He,ai),tn(L,He,ai+3),tn(L,Q,u0),Ih(L,w,A,R,er),tn(L,He,ai+6),tn(L,Xe,u0)};let Ji=0;for(let er=d;er<J;er+=d)ut(er,Ji),Ji++;ut(J,Ji),m+=Te}const I=3*m,N=9*m,U=new Float32Array(I),F=new Float32Array(I),k=new Float32Array(N);let j=0,H=0;for(let B=0;B<u;B++){const V=h[B],Y=f[B];ki(V,U,0,H,V.length),ki(Y,F,0,H,Y.length),H+=V.length;const K=E[B];ki(K,k,0,j,K.length),j+=K.length}return{labelPosition:x,labelText:y,vectorPosition1:b,vectorPosition2:_,arcPosition1:U,arcPosition2:F,sectorPosition:k}})(t),i=this.n=n.labelPosition.length/3,s=new Color(this.labelColor);this.textBuffer=new Oh({position:n.labelPosition,size:Ai(i,this.labelSize),color:Si(i,s.r,s.g,s.b),text:n.labelText},this.getLabelBufferParams());const o=new Color(this.colorValue);return this.vectorBuffer=new Nh(pn({position1:n.vectorPosition1,position2:n.vectorPosition2,color:Si(2*i,o.r,o.g,o.b),color2:Si(2*i,o.r,o.g,o.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=n.arcPosition1.length/3,this.arcBuffer=new Nh(pn({position1:n.arcPosition1,position2:n.arcPosition2,color:Si(this.arcLength,o.r,o.g,o.b),color2:Si(this.arcLength,o.r,o.g,o.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=n.sectorPosition.length/3,this.sectorBuffer=new Vo({position:n.sectorPosition,color:Si(this.sectorLength,o.r,o.g,o.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},i={},s={};if(e.color){const o=new Color(this.colorValue);Object.assign(n,{color:Si(2*this.n,o.r,o.g,o.b),color2:Si(2*this.n,o.r,o.g,o.b)}),Object.assign(i,{color:Si(this.arcLength,o.r,o.g,o.b),color2:Si(this.arcLength,o.r,o.g,o.b)}),Object.assign(s,{color:Si(this.sectorLength,o.r,o.g,o.b)})}this.vectorBuffer.setAttributes(n),this.arcBuffer.setAttributes(i),this.sectorBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),!e||e.vectorVisible===void 0&&e.arcVisible===void 0&&e.sectorVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&(this.vectorBuffer.setParameters({opacity:e.lineOpacity}),this.arcBuffer.setParameters({opacity:e.lineOpacity})),e&&e.opacity!==void 0&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),e&&e.linewidth&&(this.vectorBuffer.setParameters({linewidth:e.linewidth}),this.arcBuffer.setParameters({linewidth:e.linewidth})),this}setVisibility(e,t){return super.setVisibility(e,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}Le.add("angle",zh);const Uh=new Vector3,Vh=new Vector3,jh=new Vector3,Gh=new Vector3(0,1,0),Hh=Object.assign({radialSegments:1,openEnded:!0},No);function qh(r={}){const e=nt(r.radialSegments,10),t=nt(r.openEnded,!0),n=new Matrix4().makeRotationX(Math.PI/2),i=new CylinderGeometry(1,1,1,e,1,t);return i.applyMatrix4(n),i}class Wh extends Bc{constructor(e,t={}){super((function(s,o={}){const a=qh(o),l=s.position1.length,d=a.attributes.position.array.length/3,u=l/3,g=new Float32Array(2*u*d);return Pi(u,d,0,g),Pi(u,d,u*d,g),{position:new Float32Array(2*l),color:new Float32Array(2*l),primitiveId:g,picking:s.picking}})(e,t),t,qh(t)),this.updateNormals=!0;const n=e.position1.length,i=e.radius.length;this.__center=new Float32Array(n),this._position=new Float32Array(2*n),this._color=new Float32Array(2*n),this._from=new Float32Array(2*n),this._to=new Float32Array(2*n),this._radius=new Float32Array(2*i),this.setAttributes(e,!0)}get defaultParameters(){return Hh}applyPositionTransform(e,t,n){Vh.fromArray(this._from,n),jh.fromArray(this._to,n),e.lookAt(Vh,jh,Gh);const i=this._radius[t];Uh.set(i,i,Vh.distanceTo(jh)),e.scale(Uh)}setAttributes(e={},t){const n={};e.position1&&e.position2&&(vi(e.position1,e.position2,this.__center),vi(e.position1,this.__center,this._position),vi(this.__center,e.position2,this._position,e.position1.length),this._from.set(e.position1),this._from.set(this.__center,e.position1.length),this._to.set(this.__center),this._to.set(e.position2,this.__center.length),n.position=this._position),e.color&&e.color2&&(this._color.set(e.color),this._color.set(e.color2,e.color.length),n.color=this._color),e.radius&&(this._radius.set(e.radius),this._radius.set(e.radius,e.radius.length),n.radius=this._radius),super.setAttributes(n,t)}}ze.add("shader/CylinderImpostor.vert",`
attribute vec3 mapping;
attribute vec3 position1;
attribute vec3 position2;
attribute float radius;
varying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;
varying vec4 w;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform mat4 modelViewMatrixInverse;
uniform float ortho;
#include matrix_scale
void main(){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
base_radius.w = radius * matrixScale( modelViewMatrix );
vec3 center = position;
vec3 dir = normalize( position2 - position1 );
float ext = length( position2 - position1 ) / 2.0;
vec3 cam_dir;
if( ortho == 0.0 ){
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;
}else{
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;
}
cam_dir = normalize( cam_dir );
vec3 ldir;
float b = dot( cam_dir, dir );
end_b.w = b;
if( b < 0.0 )
ldir = -ext * dir;
else
ldir = ext * dir;
vec3 left = radius * normalize( cross( cam_dir, ldir ) );
vec3 up = radius * normalize( cross( left, ldir ) );
axis = normalize( normalMatrix * ldir );
U = normalize( normalMatrix * up );
V = normalize( normalMatrix * left );
vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );
base_radius.xyz = base4.xyz / base4.w;
vec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );
end_b.xyz = end4.xyz / end4.w;
w = modelViewMatrix * vec4(
center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0
);
gl_Position = projectionMatrix * w;
gl_Position.z = 0.99;
}`),ze.add("shader/CylinderImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying vec3 axis;
varying vec4 base_radius;
varying vec4 end_b;
varying vec3 U;
varying vec3 V;
varying vec4 w;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float distSq3( vec3 v3a, vec3 v3b ){
return (
( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +
( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +
( v3a.z - v3b.z ) * ( v3a.z - v3b.z )
);
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
void main(){
vec3 ray_target = w.xyz / w.w;
vec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;
vec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);
vec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);
mat3 basis = mat3( U, V, axis );
vec3 diff = ray_target - 0.5 * (base + end);
vec3 P = diff * basis;
float dz = dot( axis, ray_direction );
float radius2 = vRadius*vRadius;
vec3 D = vec3(dot(U, ray_direction),
dot(V, ray_direction),
dz);
float a0 = P.x*P.x + P.y*P.y - radius2;
float a1 = P.x*D.x + P.y*D.y;
float a2 = D.x*D.x + D.y*D.y;
float d = a1*a1 - a0*a2;
if (d < 0.0) {
discard;
}
float dist = (-a1 + sqrt(d)) / a2;
vec3 surface_point = ray_target + dist * ray_direction;
vec3 base_to_surface = surface_point - base;
vec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );
float base_cap_test = dot( base_to_surface, axis );
float end_cap_test = dot((surface_point - end), axis);
#ifndef CAP
vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
vec3 tmp_point2 = new_point2 - base;
#endif
if (base_cap_test < 0.0) {
float dNV;
float near;
vec3 front_point;
if ( ortho == 1.0 ) {
front_point = ray_target;
} else {
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
front_point = ray_direction * near + ray_origin;
}
if (dot(front_point - base, front_point-base) > radius2) {
discard;
}
#ifdef CAP
surface_point = front_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(axis, end) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - end, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
if( end_cap_test > 0.0 )
{
float dNV;
float near;
vec3 end_point;
if ( ortho == 1.0 ) {
end_point = ray_target;
} else {
dNV = dot(axis, ray_direction);
if (dNV < 0.0) {
discard;
}
near = dot(axis, end) / dNV;
end_point = ray_direction * near + ray_origin;
}
if( dot(end_point - end, end_point-base) > radius2 ) {
discard;
}
#ifdef CAP
surface_point = end_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - base, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
gl_FragDepthEXT = calcDepth( surface_point );
#ifdef NEAR_CLIP
if( calcClip( surface_point ) > 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
if( calcClip( surface_point ) > 0.0 ) {
discard;
}
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#endif
if (gl_FragDepthEXT < 0.0) {
discard;
}
if (gl_FragDepthEXT > 1.0) {
discard;
}
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -surface_point;
vec3 vNormal = _normal;
vec3 vColor;
if( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){
if( b < 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}else{
if( b > 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Xh=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),Yh=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);class Kh extends Oc{constructor(e,t={}){super("v3",e,t)}get mapping(){return Xh}get mappingIndices(){return Yh}get mappingIndicesSize(){return 12}get mappingSize(){return 6}get mappingItemSize(){return 3}}const Zh=Object.assign({openEnded:!1},No),Qh=Object.assign({openEnded:{updateShader:!0}},zo);class Jh extends Kh{constructor(e,t={}){super(e,t),this.parameterTypes=Qh,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new Matrix4},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Zh}getDefines(e){const t=Kh.prototype.getDefines.call(this,e);return this.parameters.openEnded||(t.CAP=1),t}}Object.assign({disableImpostor:!1},Hh,Zh);const tu=class{constructor(r,e={}){return!r.color2&&r.color&&(r.color2=r.color),!Pe||e&&e.disableImpostor?new Wh(r,e):new Jh(r,e)}};je.add("cylinder",tu);class eu extends Sh{constructor(e,t,n){super(e,t,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};t.radiusSize=nt(t.radiusSize,.5),t.colorValue=nt(t.colorValue,"lightgreen"),t.useInteriorColor=nt(t.useInteriorColor,!0),this.showAxes=nt(t.showAxes,!0),this.showBox=nt(t.showBox,!1),super.init(t)}getPrincipalAxes(){let e;const t=this.getAssembly();return t&&(e=t.partList[0].getSelection()),this.structureView.getPrincipalAxes(e)}getAxesData(e){const t=this.getPrincipalAxes(),n=new Color(this.colorValue);let i=0,s=0;this.showAxes&&(i+=6,s+=3),this.showBox&&(i+=8,s+=12);const o=new Float32Array(3*i),a=Si(i,n.r,n.g,n.b),l=Ai(i,this.radiusSize),d=new Float32Array(3*s),u=new Float32Array(3*s),g=Si(s,n.r,n.g,n.b),x=Ai(s,this.radiusSize);let y=0;if(this.showAxes){const _=function(h,f){h.toArray(o,2*y),f.toArray(o,2*y+3),h.toArray(d,y),f.toArray(u,y),y+=3};_(t.begA,t.endA),_(t.begB,t.endB),_(t.begC,t.endC)}if(this.showBox){const _=new Vector3,{d1a:h,d2a:f,d3a:E,d1b:m,d2b:S,d3b:w}=t.getProjectedScaleForAtoms(e);let v=2*y;const A=function(R,O,L){_.copy(t.center).addScaledVector(t.normVecA,R).addScaledVector(t.normVecB,O).addScaledVector(t.normVecC,L),_.toArray(o,v),v+=3};A(h,f,E),A(h,f,w),A(h,S,w),A(h,S,E),A(m,S,w),A(m,S,E),A(m,f,E),A(m,f,w);let M=y;const T=function(R,O){_.fromArray(o,2*y+3*R).toArray(d,M),_.fromArray(o,2*y+3*O).toArray(u,M),M+=3};T(0,1),T(0,3),T(0,6),T(1,2),T(1,7),T(2,3),T(2,4),T(3,5),T(4,5),T(4,7),T(5,6),T(6,7)}const b=new Ys(t);return{vertex:{position:o,color:a,radius:l,picking:b},edge:{position1:d,position2:u,color:g,color2:g,radius:x,picking:b}}}create(){const e=this.getAxesData(this.structureView);this.sphereBuffer=new Uc(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new tu(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=this.getAxesData(t.sview),i={},s={};e&&!e.position||(Object.assign(i,{position:n.vertex.position}),Object.assign(s,{position1:n.edge.position1,position2:n.edge.position2})),e&&!e.color||(Object.assign(i,{color:n.vertex.color}),Object.assign(s,{color:n.edge.color,color2:n.edge.color})),e&&!e.radius||(Object.assign(i,{radius:n.vertex.radius}),Object.assign(s,{radius:n.edge.radius})),this.sphereBuffer.setAttributes(i),this.cylinderBuffer.setAttributes(s)}}Le.add("axes",eu);class iu extends Sh{constructor(e,t,n){super(e,t,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusType=nt(t.radiusType,"size"),t.radiusSize=nt(t.radiusSize,.15),t.useInteriorColor=nt(t.useInteriorColor,!0),this.aspectRatio=nt(t.aspectRatio,2),this.lineOnly=nt(t.lineOnly,!1),this.cylinderOnly=nt(t.cylinderOnly,!1),this.multipleBond=nt(t.multipleBond,"off"),this.bondSpacing=nt(t.bondSpacing,1),this.bondScale=nt(t.bondScale,.4),this.linewidth=nt(t.linewidth,2),super.init(t)}getAtomRadius(e){return this.aspectRatio*super.getAtomRadius(e)}getAtomParams(e,t){var n=super.getAtomParams(e,t);return n.radiusParams.scale*=this.aspectRatio,n}getAtomData(e,t,n){return e.getAtomData(this.getAtomParams(t,n))}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},t),super.getBondParams(e,t)}getBondData(e,t,n){return e.getBondData(this.getBondParams(t,n))}createData(e){const t=[];if(this.lineOnly)this.lineBuffer=new Nh(this.getBondData(e,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),t.push(this.lineBuffer);else{const n=new tu(this.getBondData(e),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(t.push(n),!this.cylinderOnly){const i=new Uc(this.getAtomData(e),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));t.push(i)}}return{bufferList:t}}updateData(e,t){this.multipleBond!=="off"&&e&&e.radius&&(e.position=!0);const n=this.getBondData(t.sview,e);if(this.lineOnly){const a={};e&&!e.position||Object.assign(a,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(a,{color:n.color,color2:n.color2}),t.bufferList[0].setAttributes(a)}else{var i={};if(e&&!e.position||Object.assign(i,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(i,{color:n.color,color2:n.color2}),e&&!e.radius||Object.assign(i,{radius:n.radius}),t.bufferList[0].setAttributes(i),!this.cylinderOnly){var s=this.getAtomData(t.sview,e),o={};e&&!e.position||Object.assign(o,{position:s.position}),e&&!e.color||Object.assign(o,{color:s.color}),e&&!e.radius||Object.assign(o,{radius:s.radius}),t.bufferList[1].setAttributes(o)}}}setParameters(e={}){let t=!1;const n={};return(e.aspectRatio||e.bondSpacing||e.bondScale)&&(Object.assign(n,{radius:!0}),Pe&&!this.disableImpostor||(t=!0)),super.setParameters(e,n,t),this}}Le.add("ball+stick",iu);class ru extends iu{constructor(e,t,n){super(e,t,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}init(e){var t=e||{};t.aspectRatio=nt(t.aspectRatio,1),t.radiusSize=nt(t.radiusSize,.25),super.init(t)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}getAtomData(e,t,n){return e.getBackboneAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){return e.getBackboneBondData(this.getBondParams(t,n))}}Le.add("backbone",ru);class nu extends iu{constructor(e,t,n){super(e,t,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){let t=e||{};t.aspectRatio=nt(t.aspectRatio,1),t.radiusSize=nt(t.radiusSize,.3),super.init(t)}getAtomData(e,t,n){return e.getRungAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){let i=this.getBondParams(t,n);return Object.assign(i.colorParams,{rung:!0}),e.getRungBondData(i)}}Le.add("base",nu);class su{constructor(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new Vector3,this.vec2=new Vector3,this.vDir=new Vector3,this.vTan=new Vector3,this.vNorm=new Vector3,this.vBin=new Vector3,this.m2=Math.ceil(this.m/2)}interpolateToArr(e,t,n,i,s,o,a){o[a+0]=Ft(e.x,t.x,n.x,i.x,s,this.tension),o[a+1]=Ft(e.y,t.y,n.y,i.y,s,this.tension),o[a+2]=Ft(e.z,t.z,n.z,i.z,s,this.tension)}interpolateToVec(e,t,n,i,s,o){o.x=Ft(e.x,t.x,n.x,i.x,s,this.tension),o.y=Ft(e.y,t.y,n.y,i.y,s,this.tension),o.z=Ft(e.z,t.z,n.z,i.z,s,this.tension)}interpolatePosition(e,t,n,i,s,o){for(var a=0;a<this.m;++a){var l=o+3*a,d=this.dt*a;this.interpolateToArr(e,t,n,i,d,s,l)}}interpolateTangent(e,t,n,i,s,o){for(var a=0;a<this.m;++a){var l=this.dt*a,d=l-this.delta,u=l+this.delta,g=o+3*a;d<0&&(d=0),u>1&&(u=1),this.interpolateToVec(e,t,n,i,d,this.vec1),this.interpolateToVec(e,t,n,i,u,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(s,g)}}vectorSubdivide(e,t,n,i,s){let o,a=t.next(),l=t.next(),d=t.next();const u=t.size,g=u-1;let x=i||0;for(let y=0;y<g;++y)o=a,a=l,l=d,d=t.next(),e.apply(this,[o,a,l,d,n,x]),x+=3*this.m;s&&(o=t.get(u-2),a=t.get(u-1),l=t.get(0),d=t.get(1),e.apply(this,[o,a,l,d,n,x]),x+=3*this.m)}getPosition(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,n,i);var s=e.size-1,o=s*this.m*3;i&&(o+=3*this.m);var a=e.get(i?0:s);t[o]=a.x,t[o+1]=a.y,t[o+2]=a.z}getTangent(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,n,i);let s=(e.size-1)*this.m*3;i&&(s+=3*this.m),ki(t,t,s-3,s,3)}interpolateNormalDir(e,t,n,i,s,o,a,l,d,u,g,x,y){for(let b=0;b<this.m;++b){let _=x+3*b;y&&(_+=3*this.m2);const h=this.dt*b;this.interpolateToVec(e,t,n,i,h,this.vec1),this.interpolateToVec(s,o,a,l,h,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(d,_),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(g,_),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(u,_)}}interpolateNormal(e,t,n,i,s){for(var o=0;o<this.m;++o){var a=s+3*o;e.copy(this.vNorm),this.vTan.fromArray(t,a),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(i,a),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,a)}}getNormal(e,t,n,i,s,o){this.vNorm.set(0,0,1);const a=e-1;let l=s||0;for(var d=0;d<a;++d)this.interpolateNormal(this.vDir,t,n,i,l),l+=3*this.m;o&&(this.interpolateNormal(this.vDir,t,n,i,l),l+=3*this.m),this.vBin.toArray(i,l),this.vNorm.toArray(n,l)}getNormalDir(e,t,n,i,s,o,a,l){e.reset(),t.reset();const d=new Vector3,u=new Vector3,g=new Vector3,x=new Vector3,y=new Vector3,b=new Vector3().copy(e.next()),_=new Vector3().copy(e.next()),h=new Vector3().copy(e.next()),f=new Vector3,E=new Vector3().copy(t.next()),m=new Vector3().copy(t.next()),S=new Vector3().copy(t.next());this.vNorm.set(0,0,1);let w=e.size,v=w-1,A=o||0;for(var M=0;M<v;++M)y.copy(b),b.copy(_),_.copy(h),h.copy(e.next()),f.copy(E),E.copy(m),m.copy(S),S.copy(t.next()),M===0?(d.subVectors(f,y),u.subVectors(E,b),d.dot(u)<0&&(u.multiplyScalar(-1),E.addVectors(b,u)),g.subVectors(m,_),u.dot(g)<0&&(g.multiplyScalar(-1),m.addVectors(_,g))):g.copy(x),x.subVectors(S,h),g.dot(x)<0&&(x.multiplyScalar(-1),S.addVectors(h,x)),this.interpolateNormalDir(y,b,_,h,f,E,m,S,n,i,s,A,l),A+=3*this.m;if(a&&(y.copy(e.get(w-2)),b.copy(e.get(w-1)),_.copy(e.get(0)),h.copy(e.get(1)),f.copy(t.get(w-2)),E.copy(t.get(w-1)),m.copy(t.get(0)),S.copy(t.get(1)),g.copy(x),x.subVectors(S,h),g.dot(x)<0&&(x.multiplyScalar(-1),S.addVectors(h,x)),this.interpolateNormalDir(y,b,_,h,f,E,m,S,n,i,s,A,l),A+=3*this.m),l){this.vBin.fromArray(s,3*this.m2),this.vNorm.fromArray(i,3*this.m2);for(var T=0;T<this.m2;++T)this.vBin.toArray(s,3*T),this.vNorm.toArray(i,3*T)}else this.vBin.toArray(s,A),this.vNorm.toArray(i,A)}interpolateColor(e,t,n,i,s){var o,a;for(o=0;o<this.m2;++o)a=s+3*o,n.apply(this,[e,i,a]);for(o=this.m2;o<this.m;++o)a=s+3*o,n.apply(this,[t,i,a])}getColor(e,t,n,i,s){let o;e.reset(),e.next();let a=e.next();for(var l=e.size,d=l-1,u=i||0,g=0;g<d;++g)o=a,a=e.next(),this.interpolateColor(o,a,t,n,u),u+=3*this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolateColor(o,a,t,n,u),u+=3*this.m),n[u]=n[u-3],n[u+1]=n[u-2],n[u+2]=n[u-1]}interpolatePicking(e,t,n,i,s){var o;for(o=0;o<this.m2;++o)i[s+o]=n.apply(this,[e]);for(o=this.m2;o<this.m;++o)i[s+o]=n.apply(this,[t])}getPicking(e,t,n,i,s){let o;e.reset(),e.next();let a=e.next();const l=e.size,d=l-1;let u=i||0;for(var g=0;g<d;++g)o=a,a=e.next(),this.interpolatePicking(o,a,t,n,u),u+=this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolatePicking(o,a,t,n,u),u+=this.m),n[u]=n[u-1]}interpolateSize(e,t,n,i,s){const o=n.apply(this,[e]),a=n.apply(this,[t]);for(let l=0;l<this.m;++l){let d=l/this.m;i[s+l]=(1-d)*o+d*a}}getSize(e,t,n,i,s){let o;e.reset(),e.next();let a=e.next();const l=e.size,d=l-1;let u=i||0;for(var g=0;g<d;++g)o=a,a=e.next(),this.interpolateSize(o,a,t,n,u),u+=this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolateSize(o,a,t,n,u),u+=this.m),n[u]=n[u-1]}}class ou{constructor(e,t){this.polymer=e,this.size=e.residueCount;var n=t||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new su(this.subdiv,this.tension)}getAtomIterator(e,t){const n=this.polymer,i=n.structure,s=n.residueCount;let o=0,a=-1;const l=[i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy()],d=[new Vector3,new Vector3,new Vector3,new Vector3];var u=i.getAtomProxy(),g=i.getAtomProxy();function x(y){var b=l[o%4];if(b.index=n.getAtomIndexByType(y,e),t&&y>0&&y<s&&b.sstruc==="e"){var _=d[o%4];return u.index=n.getAtomIndexByType(y+1,e),g.index=n.getAtomIndexByType(y-1,e),_.addVectors(u,g).add(b).add(b).multiplyScalar(.25),o+=1,_}return o+=1,b}return{size:s,next:function(){var y=x(a);return a+=1,y},get:x,reset:function(){o=0,a=-1}}}getSubdividedColor(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t*3+3;n.isCyclic&&(i+=3*t);var s=new Float32Array(i),o=this.getAtomIterator("trace"),a=e||{};a.structure=n.structure;var l=Oe.getScheme(a);return this.interpolator.getColor(o,(function(d,u,g){l.atomColorToArray(d,u,g)}),s,0,n.isCyclic),{color:s}}getSubdividedPicking(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e+1;t.isCyclic&&(n+=e);var i=t.structure,s=this.getAtomIterator("trace"),o=new Float32Array(n);return this.interpolator.getPicking(s,(function(a){return a.index}),o,0,t.isCyclic),{picking:new Xs(o,i)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}}getSubdividedSize(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t+1;n.isCyclic&&(i+=t);var s=new Float32Array(i),o=this.getAtomIterator("trace"),a=new ma(e);return this.interpolator.getSize(o,(function(l){return a.atomRadius(l)}),s,0,n.isCyclic),{size:s}}getPosition(){const e=this.subdiv,t=this.polymer;let n=(t.residueCount-1)*e*3+3;t.isCyclic&&(n+=3*e);const i=new Float32Array(n),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(s,i,0,t.isCyclic),i}getTangent(){const e=this.subdiv,t=this.polymer;let n=(this.size-1)*e*3+3;t.isCyclic&&(n+=3*e);const i=new Float32Array(n),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(s,i,0,t.isCyclic),i}getNormals(e){const t=this.subdiv,n=this.polymer,i=n.isProtein(),s=this.size;let o=(s-1)*t*3+3;n.isCyclic&&(o+=3*t);const a=new Float32Array(o),l=new Float32Array(o);if(this.directional&&!this.polymer.isCg()){const d=this.getAtomIterator("direction1"),u=this.getAtomIterator("direction2");this.interpolator.getNormalDir(d,u,e,a,l,0,n.isCyclic,i)}else this.interpolator.getNormal(s,e,a,l,0,n.isCyclic);return{normal:a,binormal:l}}}const au=new Vector3,cu=new Vector3,lu=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},No);class hu extends Vo{constructor(e,t={}){super((function(n,i={}){const s=nt(i.radialSegments,4),o=nt(i.capped,!1),a=o?s:0,l=o?s-2:0,d=n.position.length/3,u=d*s*3+2*a*3,g=2*(d-1)*s*3+2*l*3;return{position:new Float32Array(u),color:new Float32Array(u),index:bt(g,u/3),normal:new Float32Array(u),picking:n.picking}})(e,t),t),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=e.position.length/3,e.primitiveId=Ci(this.size2),this.setAttributes(e),this.makeIndex()}get defaultParameters(){return lu}setAttributes(e={}){const t=this.parameters.aspectRatio,n=this.size2,i=n-1,s=this.parameters.radialSegments,o=this.geometry.attributes;let a,l,d,u,g,x,y,b,_,h,f,E,m;e.position&&(a=e.position,l=e.normal,d=e.binormal,u=e.tangent,x=e.size,b=o.position.array,h=o.normal.array,o.position.needsUpdate=!0,o.normal.needsUpdate=!0),e.color&&(g=e.color,_=o.color.array,o.color.needsUpdate=!0),e.primitiveId&&(y=e.primitiveId,f=o.primitiveId.array,o.primitiveId.needsUpdate=!0);let S=0,w=0,v=0,A=0,M=0,T=0,R=0,O=0,L=0,P=0;const I=[],N=[],U=[],F=[],k=[],j=[];if(a)for(let H=0;H<s;++H){const B=H/s*2*Math.PI;I[H]=t*Math.cos(B),N[H]=Math.sin(B),U[H]=t*Math.cos(B-.01),F[H]=Math.sin(B-.01),k[H]=t*Math.cos(B+.01),j[H]=Math.sin(B+.01)}for(let H=0;H<n;++H){E=3*H,m=E*s,a&&u&&l&&d&&x&&(au.set(u[E],u[E+1],u[E+2]),w=l[E],v=l[E+1],A=l[E+2],M=d[E],T=d[E+1],R=d[E+2],O=a[E],L=a[E+1],P=a[E+2],S=x[H]);for(let B=0;B<s;++B){const V=m+3*B;if(a){const Y=-S*I[B],K=S*N[B],J=-S*U[B],Te=S*F[B],He=-S*k[B],Q=S*j[B];b[V]=O+Y*w+K*M,b[V+1]=L+Y*v+K*T,b[V+2]=P+Y*A+K*R,cu.set(He*w+Q*M-(J*w+Te*M),He*v+Q*T-(J*v+Te*T),He*A+Q*R-(J*A+Te*R)).cross(au),h[V]=cu.x,h[V+1]=cu.y,h[V+2]=cu.z}g&&(_[V]=g[E],_[V+1]=g[E+1],_[V+2]=g[E+2]),y&&(f[H*s+B]=y[H])}}E=0,m=3*n*s;for(let H=0;H<s;++H){const B=E+3*H,V=m+3*H;a&&u&&(b[V]=b[B],b[V+1]=b[B+1],b[V+2]=b[B+2],h[V]=u[E],h[V+1]=u[E+1],h[V+2]=u[E+2]),g&&(_[V]=_[B],_[V+1]=_[B+1],_[V+2]=_[B+2]),y&&(f[n*s+H]=f[0+H])}E=3*(n-1)*s,m=3*(n+1)*s;for(let H=0;H<s;++H){const B=E+3*H,V=m+3*H;a&&u&&(b[V]=b[B],b[V+1]=b[B+1],b[V+2]=b[B+2],h[V]=u[3*i],h[V+1]=u[3*i+1],h[V+2]=u[3*i+2]),g&&(_[V]=_[B],_[V+1]=_[B+1],_[V+2]=_[B+2]),y&&(f[(n+1)*s+H]=f[(n-1)*s+H])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void ke.error("Index is null");const t=e.array,n=this.size2,i=n-1,s=this.capTriangles,o=this.parameters.radialSegments,a=this.parameters.radialSegments+1;let l,d;for(let g=0;g<i;++g){const x=g*o*3*2,y=g*o,b=(g+1)*o;for(let _=0;_<o;++_)d=x+3*_*2,t[d]=y+_,t[d+1]=y+(_+1)%o,t[d+2]=b+_,t[d+3]=b+_,t[d+4]=y+(_+1)%o,t[d+5]=b+(_+1)%o}const u=[0];for(let g=1;g<a/2;++g)u.push(g),o-g!==g&&u.push(o-g);d=i*o*3*2,l=n*o;for(let g=0;g<u.length-2;++g)g%2==0?(t[d+3*g+0]=l+u[g+0],t[d+3*g+1]=l+u[g+1],t[d+3*g+2]=l+u[g+2]):(t[d+3*g+0]=l+u[g+2],t[d+3*g+1]=l+u[g+1],t[d+3*g+2]=l+u[g+0]);d=i*o*3*2+3*s,l=n*o+o;for(let g=0;g<u.length-2;++g)g%2==0?(t[d+3*g+0]=l+u[g+0],t[d+3*g+1]=l+u[g+1],t[d+3*g+2]=l+u[g+2]):(t[d+3*g+0]=l+u[g+2],t[d+3*g+1]=l+u[g+1],t[d+3*g+2]=l+u[g+0])}}class uu extends Sh{constructor(e,t,n){super(e,t,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.colorScheme=nt(t.colorScheme,"chainname"),t.colorScale=nt(t.colorScale,"RdYlBu"),t.radiusType=nt(t.radiusType,"sstruc"),t.radiusScale=nt(t.radiusScale,.7),t.useInteriorColor=nt(t.useInteriorColor,!0),this.aspectRatio=nt(t.aspectRatio,5),this.tension=nt(t.tension,NaN),this.capped=nt(t.capped,!0),this.smoothSheet=nt(t.smoothSheet,!1),t.quality==="low"?(this.subdiv=3,this.radialSegments=6):t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=nt(t.subdiv,6),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:this.aspectRatio!==1,smoothSheet:this.smoothSheet},e)}getSpline(e){return new ou(e,this.getSplineParams())}getAspectRatio(e){return e.isCg()?1:this.aspectRatio}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){let t=[],n=[];return this.structure.eachPolymer((i=>{if(i.residueCount<4)return;n.push(i);const s=this.getSpline(i),o=this.getAspectRatio(i),a=s.getSubdividedPosition(),l=s.getSubdividedOrientation(),d=s.getSubdividedColor(this.getColorParams()),u=s.getSubdividedPicking(),g=s.getSubdividedSize(this.getRadiusParams());t.push(new hu(Object.assign({},a,l,d,u,g),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:o,capped:this.capped})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){De&&ke.time(this.type+" repr update"),e=e||{};for(var n=0,i=t.polymerList.length;n<i;++n){var s={},o=t.polymerList[n],a=this.getSpline(o),l=this.getAspectRatio(o);if(Object.assign(t.bufferList[n],{aspectRatio:l}),e.position||e.radius){var d=a.getSubdividedPosition(),u=a.getSubdividedOrientation(),g=a.getSubdividedSize(this.getRadiusParams(l));s.position=d.position,s.normal=u.normal,s.binormal=u.binormal,s.tangent=u.tangent,s.size=g.size}if(e.color){var x=a.getSubdividedColor(this.getColorParams());s.color=x.color}if(e.picking){var y=a.getSubdividedPicking();s.picking=y.picking}t.bufferList[n].setAttributes(s)}De&&ke.timeEnd(this.type+" repr update")}setParameters(e){var t={};return e&&e.aspectRatio&&(t.radius=!0),e&&e.tension&&(t.position=!0),super.setParameters(e,t,!1),this}}Le.add("cartoon",uu);class du extends Sh{constructor(e,t,n){super(e,t,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusSize=nt(t.radiusSize,.05),t.useInteriorColor=nt(t.useInteriorColor,!0),this.hydrogenBond=nt(t.hydrogenBond,!0),this.weakHydrogenBond=nt(t.weakHydrogenBond,!1),this.waterHydrogenBond=nt(t.waterHydrogenBond,!1),this.backboneHydrogenBond=nt(t.backboneHydrogenBond,!1),this.hydrophobic=nt(t.hydrophobic,!1),this.halogenBond=nt(t.halogenBond,!0),this.ionicInteraction=nt(t.ionicInteraction,!0),this.metalCoordination=nt(t.metalCoordination,!0),this.cationPi=nt(t.cationPi,!0),this.piStacking=nt(t.piStacking,!0),this.filterSele=nt(t.filterSele,""),this.labelVisible=nt(t.labelVisible,!1),this.labelFixedSize=nt(t.labelFixedSize,!1),this.labelSize=nt(t.labelSize,2),this.labelUnit=nt(t.labelUnit,""),this.maxHydrophobicDist=nt(t.maxHydrophobicDist,4),this.maxHbondDist=nt(t.maxHbondDist,3.5),this.maxHbondSulfurDist=nt(t.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=nt(t.maxHbondAccAngle,45),this.maxHbondDonAngle=nt(t.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=nt(t.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=nt(t.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=nt(t.maxPiStackingDist,5.5),this.maxPiStackingOffset=nt(t.maxPiStackingOffset,2),this.maxPiStackingAngle=nt(t.maxPiStackingAngle,30),this.maxCationPiDist=nt(t.maxCationPiDist,6),this.maxCationPiOffset=nt(t.maxCationPiOffset,2),this.maxIonicDist=nt(t.maxIonicDist,5),this.maxHalogenBondDist=nt(t.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=nt(t.maxHalogenBondAngle,30),this.maxMetalDist=nt(t.maxMetalDist,3),this.refineSaltBridges=nt(t.refineSaltBridges,!0),this.masterModelIndex=nt(t.masterModelIndex,-1),this.lineOfSightDistFactor=nt(t.lineOfSightDistFactor,1),super.init(t)}getAtomRadius(){return 0}getContactData(e){const t={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},n={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return Hs(Us(e,t),e,n)}createData(e){const t=this.getContactData(e),n=[new tu(mn(t),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const i={size:this.labelSize,unit:this.labelUnit};n.push(new Oh((function(s,o){const a=vi(s.position1,s.position2),l=[],d=wi(s.position1,s.position2),u=d.length/3;for(let g=0;g<u;g++){const x=3*g,y=Math.sqrt(Math.pow(d[x],2)+Math.pow(d[x+1],2)+Math.pow(d[x+2],2));switch(o.unit){case"angstrom":l[g]=y.toFixed(2)+" ";break;case"nm":l[g]=(y/10).toFixed(2)+" nm";break;default:l[g]=y.toFixed(2)}}return{position:a,size:Ai(a.length/3,o.size),color:s.color,text:l}})(t,i),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:n}}}Le.add("contact",du);class mu extends Ch{constructor(e,t,n){super(e,t,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=nt(t.side,"double"),t.opacity=nt(t.opacity,.5),this.atomQuad=nt(t.atomQuad,[]),this.extendLine=nt(t.extendLine,!0),this.lineVisible=nt(t.lineVisible,!0),this.planeVisible=nt(t.planeVisible,!0),this.sectorVisible=nt(t.sectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomQuad.length)return;const t=(function(a,l={}){const d=nt(l.angleStep,Math.PI/90),u=a.length,g=a.length/12,x=new Float32Array(g),y=new Float32Array(3*g),b=new Array(g),_=new Array(g),h=new Array(g),f=new Array(g),E=new Array(g);let m=0,S=0,w=0;const v=Xr(),A=Xr(),M=Xr(),T=Xr(),R=Xr(),O=Xr(),L=Xr(),P=Xr(),I=Xr(),N=Xr(),U=Xr(),F=Xr(),k=Xr(),j=Xr(),H=Xr();let B=0;for(var V=0;V<u;V+=12){if(Jr(v,a,V),Jr(A,a,V+3),Jr(M,a,V+6),Jr(T,a,V+9),Zr(R,v,A),Zr(O,M,A),rn(O)===0)continue;Zr(L,T,M),sn(P,O,.5),Qr(I,A,P),on(R,R),on(O,O),on(L,L),Zr(P,v,I);const Ji=Kr(P,O)>0;Zr(P,T,I);const er=Kr(P,O)<0;if(sn(P,O,Kr(O,R)),Zr(N,R,P),sn(P,O,Kr(O,L)),Zr(U,L,P),rn(N)===0||rn(U)===0)continue;on(N,N),on(U,U);const ec=x[B]=dn(N,U);b[B]=(_i*ec).toFixed(1)+"",Yr(j,N,O),on(j,j),Kr(j,U)<0&&un(j,j),Ih(P,I,N,j,ec/2),tn(P,y,3*B);const ai=Math.ceil(ec/d),u0=ai+(l.extendLine?4:2),o0=l.extendLine?36:0,E0=new Float32Array(3*u0),F0=new Float32Array(3*u0),g0=new Float32Array(9*ai),w0=new Float32Array(o0);_[B]=E0,h[B]=F0,f[B]=g0,E[B]=w0,l.extendLine&&(Ji?(Zr(P,v,M),on(P,P),sn(F,P,1/Kr(N,P)),Qr(F,F,M)):(sn(F,R,1/Kr(N,R)),Qr(F,F,A)),er?(Zr(P,T,A),on(P,P),sn(k,P,1/Kr(U,P)),Qr(k,k,A)):(sn(k,L,1/Kr(U,L)),Qr(k,k,M))),Qr(H,I,N);let L0=0;l.extendLine?(tn(v,E0,L0),tn(F,F0,L0),L0+=3,tn(F,E0,L0),tn(H,F0,L0),L0+=3,tn(F,w0,0),tn(H,w0,3),tn(Ji?M:A,w0,6),tn(Ji?M:A,w0,9),tn(H,w0,12),tn(I,w0,15)):(tn(I,E0,L0),tn(H,F0,L0),L0+=3);const T0=function(We,h0){const M0=9*h0;tn(I,g0,M0),tn(H,g0,M0+3),tn(H,E0,L0),Ih(H,I,N,j,We),tn(H,g0,M0+6),tn(H,F0,L0),L0+=3};let ht=0;for(let We=d;We<ec;We+=d)T0(We,ht++);T0(ec,ht++),l.extendLine?(tn(H,E0,3*(u0-2)),tn(k,F0,3*(u0-2)),tn(k,E0,3*(u0-1)),tn(T,F0,3*(u0-1)),tn(k,w0,18),tn(H,w0,21),tn(er?A:M,w0,24),tn(er?A:M,w0,27),tn(H,w0,30),tn(I,w0,33)):(tn(H,E0,L0),tn(I,F0,L0),L0+=3),m+=3*u0,S+=9*ai,w+=o0,B+=1}const Y=B,K=new Float32Array(m),J=new Float32Array(m),Te=new Float32Array(S),He=new Float32Array(w);let Q=0,Xe=0,ut=0;for(let Ji=0;Ji<Y;Ji++){const er=_[Ji],ec=h[Ji],ai=f[Ji],u0=E[Ji];ki(er,K,0,Q,er.length),ki(ec,J,0,Q,ec.length),ki(ai,Te,0,Xe,ai.length),ki(u0,He,0,ut,u0.length),Q+=er.length,Xe+=ai.length,ut+=u0.length}return{labelPosition:y.subarray(0,3*Y),labelText:b.slice(0,Y),linePosition1:K,linePosition2:J,planePosition:He,sectorPosition:Te}})(Ph(e,this.atomQuad),{extendLine:this.extendLine}),n=this.n=t.labelText.length,i=new Color(this.labelColor);this.textBuffer=new Oh({position:t.labelPosition,size:Ai(n,this.labelSize),color:Si(n,i.r,i.g,i.b),text:t.labelText},this.getLabelBufferParams());const s=new Color(this.colorValue);this.lineLength=t.linePosition1.length/3;const o=Si(this.lineLength,s.r,s.g,s.b);return this.lineBuffer=new Nh(pn({position1:t.linePosition1,position2:t.linePosition2,color:o}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=t.planePosition.length/3,this.planeBuffer=new Vo({position:t.planePosition,color:Si(this.planeLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new Vo({position:t.sectorPosition,color:Si(this.sectorLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},i={},s={};if(e.color){const o=new Color(this.colorValue);Object.assign(n,{color:Si(this.lineLength,o.r,o.g,o.b),color2:Si(this.lineLength,o.r,o.g,o.b)}),Object.assign(i,{color:Si(this.planeLength,o.r,o.g,o.b)}),Object.assign(s,{color:Si(this.sectorLength,o.r,o.g,o.b)})}this.lineBuffer.setAttributes(n),this.planeBuffer.setAttributes(i),this.sectorBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),!e||e.lineVisible===void 0&&e.sectorVisible===void 0&&e.planeVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&this.lineBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.lineBuffer.setParameters({linewidth:e.linewidth}),this}setVisibility(e,t){return super.setVisibility(e,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}Le.add("dihedral",mu);function fu(r,e){function t(i,s){return s in i}const n=Object.assign({},r);for(const i in n)t(n,i)&&t(e,i)&&(n[i]=nt(e[i],n[i]));return n}function pu(r,e){const t=new Color(r),n=new Float32Array(3*e);return Si(e,t.r,t.g,t.b,n),n}class gu extends Sh{constructor(e,t,n){super(e,t,n),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(n)}init(e){const t=e||{},n=fu({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},t);Object.assign(this,n);const i=fu({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},t);Object.assign(this,i),this.histogramsData.forEach((s=>{const o=fu(n,s);Object.assign(s,o)})),t.side=nt(t.side,"double"),t.opacity=nt(t.opacity,.5),t.radiusType=nt(t.radiusType,"size"),t.radiusSize=nt(t.radiusSize,.15),super.init(t)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(e){if(!e.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach((a=>a.atomPositions=Ph(e,[a.atomQuad])));const t=this.scaleBinToSectorArea?function(a){return Math.sqrt(a)}:function(a){return a};function n(a){const l=a.map((g=>g.length)),d=new Float32Array(Bi(l));let u=0;for(let g=0;g<a.length;g++)d.set(a[g],u),u+=a[g].length;return d}function i(a,l){return new Nh({position1:n(a.map((d=>d.startPoints))),position2:n(a.map((d=>d.endPoints))),color:n(a.map((d=>d.startColors))),color2:n(a.map((d=>d.endColors)))},l)}function s(a,l){return new Vo({position:n(a.map((d=>d.triangles))),color:n(a.map((d=>d.triangleColors)))},l)}this.histogramsData.forEach((a=>a.histogram360Scaled=a.histogram360.map(t)));const o=[];for(let a=0;a<this.histogramsData.length;a++){let l,d=this.histogramsData[a];d.histogram360.length>=3&&(l=yu(d)),l!==void 0&&o.push(l)}return this.frontHistogramBinBordersBuffer=i(o.map((a=>a.frontHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=i(o.map((a=>a.backHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=i(o.map((a=>a.adjacentBondArrows)),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=i(o.map((a=>a.distantBondArrows)),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=s(o.map((a=>a.opaqueMiddleDisc)),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=s(o.map((a=>a.frontHistogram)),this.getHistogramBufferParameters()),this.backHistogramBuffer=s(o.map((a=>a.backHistogram)),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(e){return super.setParameters(e,{},!1),e&&e.histogramBinBorderVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),t||this.viewer.requestRender(),this}}function yu(r){const e=r.atomPositions,t=r.histogram360Scaled,n=t.length<=180?360:2*t.length,i={triangles:new Float32Array(3*n*3),triangleColors:pu(r.opaqueMiddleDiscColor,3*n)},s={triangles:new Float32Array(3*t.length*3),triangleColors:pu(r.frontHistogramColor,3*t.length)},o={triangles:new Float32Array(3*t.length*3),triangleColors:pu(r.backHistogramColor,3*t.length)},a={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:pu(r.histogramBinBorderColor,t.length),endColors:pu(r.histogramBinBorderColor,t.length)},l={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:pu(r.histogramBinBorderColor,t.length),endColors:pu(r.histogramBinBorderColor,t.length)},d={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:pu(r.adjacentBondArrowColor,t.length),endColors:pu(r.adjacentBondArrowColor,t.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:pu(r.distantBondArrowColor,t.length),endColors:pu(r.distantBondArrowColor,t.length)},g=Xr(),x=Xr(),y=Xr(),b=Xr(),_=Xr(),h=Xr(),f=Xr(),E=Xr(),m=Xr(),S=Xr(),w=Xr(),v=Xr(),A=Xr(),M=Xr(),T=Xr(),R=Xr(),O=[g,x,y,b];for(let j=0;j<O.length;j++)Jr(O[j],e,3*j);if(Zr(_,g,x),Zr(h,y,x),Zr(E,b,y),rn(h)===0||(sn(T,h,.5),Qr(m,x,T),on(_,_),on(h,h),on(E,E),un(f,h),sn(T,f,Kr(f,_)),Zr(S,_,T),sn(T,h,Kr(h,E)),Zr(w,E,T),rn(S)===0||rn(w)===0))return;on(S,S),on(w,w);const L=Math.acos(Kr(S,w));Yr(v,f,S),Yr(A,h,w),on(v,v),on(A,A);let P=L;Kr(v,w)<0&&(P=-L),Qr(M,m,S);const I=Math.max.apply(null,t),N=2*Math.PI/t.length;function U(j,H,B,V,Y){const K=3*H*3;tn(m,j,K);const J=Number(t[H])/I;sn(T,B,J),sn(R,V,J),Ih(M,m,T,R,H*Y),tn(M,j,K+3),Ih(M,m,T,R,(H+1)*Y),tn(M,j,K+6)}function F(j,H,B,V,Y){ki(m,d.startPoints,0,3*B,m.length),Ih(T,m,V,Y,0+0*N),ki(T,d.endPoints,0,3*B,m.length),ki(m,u.startPoints,0,3*B,m.length),Ih(T,m,V,Y,P),ki(T,u.endPoints,0,3*B,m.length);for(let K=0;K<t.length;K++)ki(m,H.startPoints,0,3*K,m.length),Ih(T,m,V,Y,0+N*K),ki(T,H.endPoints,0,3*K,T.length);for(let K=0;K<t.length;K++)U(j.triangles,K,V,Y,N)}const k=2*Math.PI/n;for(let j=0;j<n;j++){const H=3*j*3;tn(m,i.triangles,H),Ih(M,m,S,v,j*k),tn(M,i.triangles,H+3),Ih(M,m,S,v,(j+1)*k),tn(M,i.triangles,H+6)}return sn(T,h,-.01),Qr(m,m,T),F(s,a,0,S,v),sn(T,h,.02),Qr(m,m,T),F(o,l,1,w,A),{opaqueMiddleDisc:i,frontHistogram:s,backHistogram:o,frontHistogramBinBorders:a,backHistogramBinBorders:l,adjacentBondArrows:d,distantBondArrows:u}}Le.add("dihedral-histogram",gu);class bu extends Ch{constructor(e,t,n){super(e,t,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.linewidth=nt(t.linewidth,5),t.radiusType=nt(t.radiusType,"size"),t.radiusSize=nt(t.radiusSize,.2),this.labelUnit=nt(t.labelUnit,""),this.useCylinder=nt(t.useCylinder,!1),this.atomPair=nt(t.atomPair,[]),super.init(t)}getDistanceData(e,t){let n=t.length;const i=new Array(n);let s=new Float32Array(3*n);const o=new me,a=new me,l=new _a,d=e.getAtomProxy(),u=e.getAtomProxy();let g=0;const x=e.getAtomSet();t.forEach(((b,_)=>{let h=b[0],f=b[1];if(typeof h=="number"&&Number.isInteger(h)&&typeof f=="number"&&Number.isInteger(f)){if(!x.get(h)||!x.get(f))return void(g+=1);d.index=h,u.index=f}else{o.setString(h),a.setString(f);var E=e.getAtomIndices(o),m=e.getAtomIndices(a);if(!E.length||!m.length)return void(g+=1);d.index=E[0],u.index=m[0]}l.addBond(d,u,1),_-=g;var S=d.distanceTo(u);switch(this.labelUnit){case"angstrom":i[_]=S.toFixed(2)+" ";break;case"nm":i[_]=(S/10).toFixed(2)+" nm";break;default:i[_]=S.toFixed(2)}var w=3*_;s[w+0]=(d.x+u.x)/2,s[w+1]=(d.y+u.y)/2,s[w+2]=(d.z+u.z)/2})),g>0&&(n-=g,s=s.subarray(0,3*n));var y=new En(l.count,!0);return{text:i,position:s,bondSet:y,bondStore:l}}getBondData(e,t,n){const i=e.getBondData(this.getBondParams(t,n));return i.picking&&(i.picking=new Js(i.picking.array,i.picking.structure,n.bondStore)),i}createData(e){if(!e.atomCount||!this.atomPair.length)return;const t=this.atomPair.length,n=new Color(this.labelColor),i=this.getDistanceData(e,this.atomPair);this.textBuffer=new Oh({position:i.position,size:Ai(t,this.labelSize),color:Si(t,n.r,n.g,n.b),text:i.text},this.getLabelBufferParams());const s={bondSet:i.bondSet,bondStore:i.bondStore},o=this.getBondData(e,{position:!0,color:!0,picking:!0,radius:this.useCylinder},s);return this.useCylinder?this.distanceBuffer=new tu(o,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new Nh(fn(o),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:i.bondSet,bondStore:i.bondStore,position:i.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(e,t){super.updateData(e,t);const n={bondSet:t.bondSet,bondStore:t.bondStore},i=this.getBondData(t.sview,e,n),s={};e&&!e.color||Object.assign(s,{color:i.color,color2:i.color2}),e&&!e.radius||Object.assign(s,{radius:i.radius}),this.distanceBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),this.useCylinder||(e&&e.lineOpacity&&this.distanceBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.distanceBuffer.setParameters({linewidth:e.linewidth})),this}}function _u(r){return 2*(r.position.length/3)*3}Le.add("distance",bu);const xu=Object.assign({scale:1,color:"grey"},No);class vu extends Uo{constructor(e,t={}){super({position:new Float32Array(_u(e)),color:new Float32Array(_u(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const n=new Color(this.parameters.color),i=this.geometry.attributes;Si(_u(e)/3,n.r,n.g,n.b,i.color.array),this.setAttributes(e)}get defaultParameters(){return xu}setAttributes(e={}){const t=this.geometry.attributes;let n,i,s;e.position&&e.vector&&(n=e.position,i=e.vector,s=t.position.array,t.position.needsUpdate=!0);const o=this.size/2,a=this.parameters.scale;if(n&&i)for(let l=0;l<o;l++){const d=2*l*3,u=3*l;s[d+0]=n[u+0],s[d+1]=n[u+1],s[d+2]=n[u+2],s[d+3]=n[u+0]+i[u+0]*a,s[d+4]=n[u+1]+i[u+1]*a,s[d+5]=n[u+2]+i[u+2]*a}}}class wu extends Sh{constructor(e,t,n){super(e,t,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){const t=e||{};t.colorScheme=nt(t.colorScheme,"sstruc"),t.radiusType=nt(t.radiusType,"size"),t.radiusSize=nt(t.radiusSize,.15),t.radiusScale=nt(t.radiusScale,1),t.useInteriorColor=nt(t.useInteriorColor,!0),super.init(t)}createData(e){const t=[],n=[];return this.structure.eachPolymer((i=>{if(i.residueCount<4)return;n.push(i);const s=new Sa(i),o=s.getPosition(),a=s.getColor(this.getColorParams()),l=s.getSize(this.getRadiusParams()),d=s.getPicking();t.push(new Uc({position:o.center,color:a.color,radius:l.size,picking:d.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new vu({position:o.center,vector:o.axis},this.getBufferParams({color:"skyblue",scale:1})),new vu({position:o.center,vector:o.resdir},this.getBufferParams({color:"lightgreen",scale:1})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){De&&ke.time(this.type+" repr update"),e=e||{};for(let n=0,i=t.polymerList.length;n<i;++n){const s=3*n,o={},a=t.polymerList[n],l=new Sa(a);if(e.position){const d=l.getPosition();Object.assign(o,{position:d.center}),t.bufferList[s+1].setAttributes({position:d.center,vector:d.axis}),t.bufferList[s+2].setAttributes({position:d.center,vector:d.resdir})}t.bufferList[s].setAttributes(o)}De&&ke.timeEnd(this.type+" repr update")}}Le.add("helixorient",wu);class Au extends iu{constructor(e,t,n){super(e,t,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,super.init(t)}}Le.add("licorice",Au),ze.add("shader/HyperballStickImpostor.vert",`
attribute vec3 mapping;
attribute float radius;
attribute float radius2;
attribute vec3 position1;
attribute vec3 position2;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform float shrink;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewProjectionMatrixInverse;
void main(){
vRadius = radius;
vRadius2 = radius2;
vec4 spaceposition;
vec3 position_atom1;
vec3 position_atom2;
vec4 vertex_position;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
float radius1 = radius;
position_atom1 = position1;
position_atom2 = position2;
float distance = distance( position_atom1, position_atom2 );
spaceposition.z = mapping.z * distance;
if (radius1 > radius2) {
spaceposition.y = mapping.y * 1.5 * radius1;
spaceposition.x = mapping.x * 1.5 * radius1;
} else {
spaceposition.y = mapping.y * 1.5 * radius2;
spaceposition.x = mapping.x * 1.5 * radius2;
}
spaceposition.w = 1.0;
vec4 e3 = vec4( 1.0 );
vec3 e1, e1_temp, e2, e2_temp;
e3.xyz = normalize(position_atom1-position_atom2);
if (e3.z == 0.0) { e3.z = 0.0000000000001;}
if ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}
if ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}
if ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}
vec4 focus = vec4( 1.0 );
focus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +
( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));
focus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +
( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));
focus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +
( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;
e2 = normalize(e2_temp);
mat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );
vertex_position.xyz = R * spaceposition.xyz;
vertex_position.w = 1.0;
vertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;
vertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;
vertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;
gl_Position = modelViewProjectionMatrix * vertex_position;
vec4 i_near, i_far;
vec4 near = gl_Position;
near.z = 0.0 ;
near = modelViewProjectionMatrixInverse * near;
i_near = near;
vec4 far = gl_Position;
far.z = far.w ;
i_far = modelViewProjectionMatrixInverse * far;
prime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );
prime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );
float Rsquare = (radius1*radius1/shrink) - (
(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +
(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +
(position_atom1.z - focus.z)*(position_atom1.z - focus.z)
);
focus.w = Rsquare;
matrix_near = mat4( i_near, i_far, focus, e3 );
gl_Position.z = 1.0;
}`),ze.add("shader/HyperballStickImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float shrink;
uniform mat4 modelViewMatrix;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewMatrixInverseTranspose;
uniform mat4 projectionMatrix;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float calcClip( vec4 cameraPos ){
return dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
float calcClip( vec3 cameraPos ){
return calcClip( vec4( cameraPos, 1.0 ) );
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
struct Ray {
vec3 origin ;
vec3 direction ;
};
bool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){
float a = x3.x;
float b = x3.y;
float c = x3.z;
float d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;
float l = a*M.x+b*M.y+c*M.z+d;
if (l<0.0) {return true;}
else{return false;}
}
vec3 isect_surf(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t1 =(-b-sqrt(delta))/a;
return r.origin+t1*r.direction;
}
vec3 isect_surf2(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t2 =(-b+sqrt(delta))/a;
return r.origin+t2*r.direction;
}
Ray primary_ray(vec4 near1, vec4 far1){
vec3 near=near1.xyz/near1.w;
vec3 far=far1.xyz/far1.w;
return Ray(near,far-near);
}
float update_z_buffer(vec3 M, mat4 ModelViewP){
float depth1;
vec4 Ms=(ModelViewP*vec4(M,1.0));
return depth1=(1.0+Ms.z/Ms.w)/2.0;
}
void main(){
float radius = max( vRadius, vRadius2 );
vec4 i_near, i_far, focus;
vec3 e3, e1, e1_temp, e2;
i_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);
i_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);
focus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);
e3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2 = normalize(cross(e1,e3));
vec4 equation = focus;
float shrinkfactor = shrink;
float t1 = -1.0/(1.0-shrinkfactor);
float t2 = 1.0/(shrinkfactor);
vec4 colonne1, colonne2, colonne3, colonne4;
mat4 mat;
vec3 equation1 = vec3(t2,t2,t1);
float A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;
float A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;
float A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;
float A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;
float A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;
float A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;
float A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;
float A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;
float A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;
float A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;
float A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;
float A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;
float A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;
colonne1 = vec4(A11,A21,A31,A41);
colonne2 = vec4(A21,A22,A32,A42);
colonne3 = vec4(A31,A32,A33,A43);
colonne4 = vec4(A41,A42,A43,A44);
mat = mat4(colonne1,colonne2,colonne3,colonne4);
Ray ray = primary_ray(i_near,i_far) ;
vec3 M;
M = isect_surf(ray, mat);
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
vec4 M1 = vec4(M,1.0);
vec4 M2 = mat*M1;
vec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
#ifdef NEAR_CLIP
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){
M = isect_surf2(ray, mat);
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )
discard;
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#endif
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
float distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /
distance(prime2.xyz,prime1.xyz);
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;
vec3 vNormal = _normal;
vec3 vColor;
if( distance_ratio>0.5 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Su=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),Cu=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);class Pu extends Oc{constructor(e,t={}){super("v3",e,t)}get mapping(){return Su}get mappingIndices(){return Cu}get mappingIndicesSize(){return 36}get mappingSize(){return 8}get mappingItemSize(){return 3}}const Iu=Object.assign({shrink:.14},No),ku=Object.assign({shrink:{uniform:!0}},zo);class Mu extends Pu{constructor(e,t={}){super(e,t),this.parameterTypes=ku,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new Matrix4},modelViewProjectionMatrixInverse:{value:new Matrix4},modelViewMatrixInverseTranspose:{value:new Matrix4},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Iu}}Object.assign({disableImpostor:!1},Hh,Iu);const Tu=class{constructor(r,e={}){return!Pe||e&&e.disableImpostor?(r.radius=(function(t,n){const i=t.length,s=new Float32Array(i);for(let o=0;o<i;o++)s[o]=Math.min(t[o],n[o]);return s})(r.radius,r.radius2),new Wh(r,e)):new Mu(r,e)}};class Du extends Au{constructor(e,t,n){super(e,t,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){var t=e||{};t.radiusScale=nt(t.radiusScale,.2),t.radiusType=nt(t.radiusType,"vdw"),t.useInteriorColor=nt(t.useInteriorColor,!0),this.shrink=nt(t.shrink,.12),super.init(t)}getBondParams(e,t){return e&&!e.radius||(t=Object.assign({radius2:!0},t)),super.getBondParams(e,t)}createData(e){var t=new Uc(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*e.bondCount),{bufferList:[t,new Tu(e.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams()),i=t.sview.getBondData(this.getBondParams()),s={},o={};if(!e||e.position){Object.assign(s,{position:n.position});var a=i.position1,l=i.position2;Object.assign(o,{position:vi(a,l,this.__center),position1:a,position2:l})}e&&!e.color||(Object.assign(s,{color:n.color}),Object.assign(o,{color:i.color,color2:i.color2})),e&&!e.radius||(Object.assign(s,{radius:n.radius}),Object.assign(o,{radius:i.radius,radius2:i.radius2})),t.bufferList[0].setAttributes(s),t.bufferList[1].setAttributes(o)}}Le.add("hyperball",Du);class Bu{constructor(e,t={},n=""){this.type=e,this.text=t,this.format=n,this.errorLogged=!1}atomLabel(e){let t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t=`${e.index}`;break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t=`${e.serial}`;break;case"element":t=e.element;break;case"atom":t=`${e.atomname}|${e.index}`;break;case"resname":t=e.resname;break;case"resno":t=`${e.resno}`;break;case"res":t=`${es[e.resname.toUpperCase()]||e.resname}${e.resno}`;break;case"residue":const n=es[e.resname.toUpperCase()];t=n&&!e.inscode?`${n}${e.resno}`:`[${e.resname}]${e.resno}${e.inscode}`;break;case"text":t=this.text[e.index];break;case"format":try{t=sprintfExports.sprintf(this.format,e)}catch(i){this.errorLogged||(this.errorLogged=!0,console.log(i.message))}break;default:t=e.qualifiedName()}return t===void 0?"":t}}Bu.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};class Fu extends Sh{constructor(e,t,n){super(e,t,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:Bu.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}init(e){const t=e||{};this.labelType=nt(t.labelType,"res"),this.labelText=nt(t.labelText,{}),this.labelFormat=nt(t.labelFormat,""),this.labelGrouping=nt(t.labelGrouping,"atom"),this.fontFamily=nt(t.fontFamily,"sans-serif"),this.fontStyle=nt(t.fontStyle,"normal"),this.fontWeight=nt(t.fontWeight,"bold"),this.xOffset=nt(t.xOffset,0),this.yOffset=nt(t.yOffset,0),this.zOffset=nt(t.zOffset,.5),this.attachment=nt(t.attachment,"bottom-left"),this.showBorder=nt(t.showBorder,!1),this.borderColor=nt(t.borderColor,"lightgrey"),this.borderWidth=nt(t.borderWidth,.15),this.showBackground=nt(t.showBackground,!1),this.backgroundColor=nt(t.backgroundColor,"lightgrey"),this.backgroundMargin=nt(t.backgroundMargin,.5),this.backgroundOpacity=nt(t.backgroundOpacity,1),this.fixedSize=nt(t.fixedSize,!1),super.init(t)}getTextData(e,t){const n=this.getAtomParams(t),i=new Bu(this.labelType,this.labelText,this.labelFormat);let s,o,a,l,d,u,g;if(this.labelGrouping==="atom"){const x=e.getAtomData(n);s=x.position,o=x.radius,a=x.color,t&&!t.text||(l=[],e.eachAtom((y=>l.push(i.atomLabel(y)))))}else if(this.labelGrouping==="residue"){t&&!t.position||(d=[]),t&&!t.color||(g=[]),t&&!t.radius||(u=[]),t&&!t.text||(l=[]),n.colorParams&&(n.colorParams.structure=e.getStructure());const x=Oe.getScheme(n.colorParams),y=new ma(n.radiusParams),b=e.getAtomProxy();let _=0;e.eachResidue((h=>{const f=3*_;h.isProtein()||h.isNucleic()?(b.index=h.traceAtomIndex,t&&!t.position||b.positionToArray(d,f)):(b.index=h.atomOffset,t&&!t.position||h.positionToArray(d,f)),t&&!t.color||x.atomColorToArray(b,g,f),t&&!t.radius||(u[_]=y.atomRadius(b)),t&&!t.text||l.push(i.atomLabel(b)),++_})),t&&!t.position||(s=new Float32Array(d)),t&&!t.color||(a=new Float32Array(g)),t&&!t.radius||(o=new Float32Array(u))}return{position:s,size:o,color:a,text:l}}createData(e){return{bufferList:[new Oh(this.getTextData(e,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(e,t){t.bufferList[0].setAttributes(this.getTextData(t.sview,e))}getAtomRadius(){return 0}}function Eu(r){const e=r.getAtomSet(),t=r.getBondSet(),n=r.getBondProxy();return t.forEach((function(i){n.index=i,e.clear(n.atomIndex1),e.clear(n.atomIndex2)})),e}Le.add("label",Fu);class $u extends Sh{constructor(e,t,n){super(e,t,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.multipleBond=nt(t.multipleBond,"off"),this.bondSpacing=nt(t.bondSpacing,1),this.linewidth=nt(t.linewidth,2),this.lines=nt(t.lines,!0),this.crosses=nt(t.crosses,"lone"),this.crossSize=nt(t.crossSize,.4),super.init(t)}getAtomRadius(e){return .1}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},t),super.getBondParams(e,t)}_crossData(e,t){if(e&&!e.position&&!e.color)return;const n={};this.crosses==="lone"&&Object.assign(n,{atomSet:Eu(t)});const i=t.getAtomData(this.getAtomParams(e,n)),s={},o=i.position,a=i.color,l=i.picking,d=(o||a).length,u=3*d;let g=new Float32Array(0),x=new Float32Array(0),y=new Float32Array(0),b=new Float32Array(0),_=0,h=new Float32Array(0);e&&!e.position||(g=s.position1=new Float32Array(u),x=s.position2=new Float32Array(u),_=this.crossSize/2),e&&!e.color||(y=s.color=new Float32Array(u),b=s.color2=new Float32Array(u)),e&&!e.picking||(h=new Float32Array(3*i.picking.array.length));for(let f=0;f<d;f++){const E=3*f,m=3*E;if(!e||e.position){const S=o[E],w=o[E+1],v=o[E+2];g[m]=S-_,g[m+1]=w,g[m+2]=v,x[m]=S+_,x[m+1]=w,x[m+2]=v,g[m+3]=S,g[m+4]=w-_,g[m+5]=v,x[m+3]=S,x[m+4]=w+_,x[m+5]=v,g[m+6]=S,g[m+7]=w,g[m+8]=v-_,x[m+6]=S,x[m+7]=w,x[m+8]=v+_}if(!e||e.color){const S=m+9;for(let w=m;w<S;w+=3)y[w]=b[w]=a[E],y[w+1]=b[w+1]=a[E+1],y[w+2]=b[w+2]=a[E+2]}e&&!e.picking||(h[E]=h[E+1]=h[E+2]=l.array[f])}return e&&!e.picking||(s.picking=new Xs(h,l.structure)),s}createData(e){const t={position:!0,color:!0,picking:!0},n=[];if(this.lines){const i=e.getBondData(this.getBondParams(t)),s=new Nh(i,this.getBufferParams({linewidth:this.linewidth}));n.push(s)}if(this.crosses!=="off"){const i=new Nh(this._crossData(t,e),this.getBufferParams({linewidth:this.linewidth}));n.push(i)}return{bufferList:n}}updateData(e,t){let n=0;if(this.lines){const i=t.sview.getBondData(this.getBondParams(e)),s={};e&&!e.position||Object.assign(s,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(s,{color:i.color,color2:i.color2}),t.bufferList[n++].setAttributes(s)}if(this.crosses!=="off"){const i=this._crossData(e,t.sview),s={};e&&!e.position||Object.assign(s,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(s,{color:i.color,color2:i.color2}),t.bufferList[n++].setAttributes(s)}}setParameters(e){var t={};return e&&(e.bondSpacing||e.crossSize)&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}function Ou(r,e,t,n,i){const s=new(n=n||Int32Array)(r*e*t*(i=i||1));function o(a,l,d){return((a*e+l)*t+d)*i}return{data:s,index:o,set:function(a,l,d,...u){const g=o(a,l,d);for(let x=0;x<i;++x)s[g+x]=u[x]},toArray:function(a,l,d,u=[],g=0){const x=o(a,l,d);for(let y=0;y<i;++y)u[g+y]=s[x+y]},fromArray:function(a,l,d,u,g=0){const x=o(a,l,d);for(let y=0;y<i;++y)s[x+y]=u[g+y]},copy:function(a){s.set(a.data)}}}function Ru(r,e,t){var n=Do(e),i=Gr(r);r.length===0&&(i[0].set([0,0,0]),i[1].set([0,0,0]));var s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S=i[0],w=i[1];function v(F,k,j,H,B){s=k||1.4,o=j||2,h=B||!0;var V=0;for(var Y in n)V=Math.max(V,Y);var K=Bo(S,w,V,o,F?s:0);l=K.dim[0],d=K.dim[1],u=K.dim[2],g=K.matrix,x=K.tran,o=K.scaleFactor,y={},b={},O(F),_=s*o,a=H||s/o,f=new Uint8Array(l*d*u),F&&(E=new Float64Array(l*d*u)),h&&(m=new Int32Array(l*d*u))}var A=1,M=2,T=4,R=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function O(F){var k,j,H,B,V,Y,K,J,Te,He;for(var Q in n)if(k=parseFloat(Q),!y[Q]){for(Y=(K=F?(k+s)*o+.5:k*o+.5)*K,J=Math.floor(K)+1,Te=new Int32Array(J*J),He=0,j=0;j<J;++j)for(H=0;H<J;++H)(B=j*j+H*H)>Y?Te[He]=-1:(V=Math.sqrt(Y-B),Te[He]=Math.floor(V)),++He;b[Q]=J,y[Q]=Te}}function L(F){var k,j,H,B,V,Y,K,J,Te,He,Q,Xe,ut,Ji,er,ec,ai,u0,o0=3*F,E0=F;k=Math.floor(.5+o*(r[o0]+x[0])),j=Math.floor(.5+o*(r[o0+1]+x[1])),H=Math.floor(.5+o*(r[o0+2]+x[2]));var F0,g0=e[E0],w0=y[g0],L0=0,T0=d*u,ht=b[g0];for(He=0;He<ht;++He)for(Q=0;Q<ht;++Q){if((F0=w0[L0])!==-1){for(ec=-1;ec<2;++ec)for(ai=-1;ai<2;++ai)for(u0=-1;u0<2;++u0)if(ec!==0&&ai!==0&&u0!==0){for(K=ec*He,Te=u0*Q,Xe=0;Xe<=F0;++Xe)if(Ji=j+(J=Xe*ai),er=H+Te,!((ut=k+K)<0||Ji<0||er<0||ut>=l||Ji>=d||er>=u)){var We=ut*T0+Ji*u+er;if(h)if(f[We]&A){if(f[We]&A){var h0=m[We];h0!==o0&&K*K+J*J+Te*Te<(B=k+K-Math.floor(.5+o*(r[h0]+x[0])))*B+(V=j+J-Math.floor(.5+o*(r[h0+1]+x[1])))*V+(Y=H+Te-Math.floor(.5+o*(r[h0+2]+x[2])))*Y&&(m[We]=F)}}else f[We]|=A,m[We]=F;else f[We]|=A}}}L0++}}function P(F){var k,j;for(console.time("EDTSurface fillvoxels"),k=0,j=f.length;k<j;++k)f[k]=0,F&&(E[k]=-1),h&&(m[k]=-1);for(k=0,j=r.length/3;k<j;++k)L(k);for(k=0,j=f.length;k<j;++k)f[k]&A&&(f[k]|=M);console.timeEnd("EDTSurface fillvoxels")}function I(F){var k,j,H,B,V,Y,K,J,Te,He,Q,Xe,ut,Ji,er,ec,ai,u0,o0,E0=3*F,F0=F,g0=0;k=Math.floor(.5+o*(r[E0]+x[0])),j=Math.floor(.5+o*(r[E0+1]+x[1])),H=Math.floor(.5+o*(r[E0+2]+x[2]));var w0=e[F0],L0=d*u;for(ut=0,o0=b[w0];ut<o0;++ut)for(Ji=0;Ji<o0;++Ji){if(y[w0][g0]!==-1){for(ec=-1;ec<2;++ec)for(ai=-1;ai<2;++ai)for(u0=-1;u0<2;++u0)if(ec!==0&&ai!==0&&u0!==0){for(K=ec*ut,Te=u0*Ji,er=0;er<=y[w0][g0];++er)if(Q=j+(J=er*ai),Xe=H+Te,!((He=k+K)<0||Q<0||Xe<0||He>=l||Q>=d||Xe>=u)){var T0=He*L0+Q*u+Xe;if(f[T0]&M){if(h){var ht=m[T0];K*K+J*J+Te*Te<(B=Math.floor(.5+o*(r[ht]+x[0])))*B+(V=Math.floor(.5+o*(r[ht+1]+x[1])))*V+(Y=Math.floor(.5+o*(r[ht+2]+x[2])))*Y&&(m[T0]=F)}}else f[T0]|=M,h&&(m[T0]=F)}}}g0++}}function N(){var F,k,j,H;console.time("EDTSurface fastdistancemap");var B,V=Ou(l,d,u,Uint16Array,3),Y=d*u,K=_*_,J=0;for(F=0;F<l;++F)for(k=0;k<d;++k)for(j=0;j<u;++j)f[B=F*Y+k*u+j]&=~M,f[B]&A&&f[B]&T&&(V.set(F,k,j,F,k,j),E[B]=0,f[B]|=M,J+=1);var Te=new Int32Array(3*J),He=0,Q=new Int32Array(3*J),Xe=0;for(F=0;F<l;++F)for(k=0;k<d;++k)for(j=0;j<u;++j)f[B=F*Y+k*u+j]&T&&(Te[He]=F,Te[He+1]=k,Te[He+2]=j,He+=3,f[B]&=~T);do for(Xe=U(Te,V,He,Q),He=0,F=0,H=Xe;F<H;F+=3)B=Y*Q[F]+u*Q[F+1]+Q[F+2],f[B]&=~T,E[B]<=1.0404*K&&(Te[He]=Q[F],Te[He+1]=Q[F+1],Te[He+2]=Q[F+2],He+=3);while(He>0);var ut,Ji=a*a,er=new Uint16Array(3);for(F=0;F<l;++F)for(k=0;k<d;++k)for(j=0;j<u;++j)f[B=F*Y+k*u+j]&=~T,f[B]&A&&(f[B]&M&&!(f[B]&M&&E[B]>=Ji)||(f[B]|=T,h&&f[B]&M&&(V.toArray(F,k,j,er),ut=er[0]*Y+er[1]*u+er[2],m[B]=m[ut])));console.timeEnd("EDTSurface fastdistancemap")}function U(F,k,j,H){var B,V,Y,K,J,Te,He,Q,Xe,ut,Ji,er,ec=new Uint16Array(3),ai=0;if(j===0)return ai;var u0=-1,o0=-1,E0=-1,F0=d*u;for(He=0,Xe=j;He<Xe;He+=3)for(B=F[He],V=F[He+1],Y=F[He+2],k.toArray(B,V,Y,ec),Q=0;Q<6;++Q)u0=B+(er=R[Q])[0],o0=V+er[1],E0=Y+er[2],u0<l&&u0>-1&&o0<d&&o0>-1&&E0<u&&E0>-1&&(f[Ji=u0*F0+u*o0+E0]&A&&!(f[Ji]&M)?(k.fromArray(u0,o0,E0,ec),ut=(K=u0-ec[0])*K+(J=o0-ec[1])*J+(Te=E0-ec[2])*Te,E[Ji]=ut,f[Ji]|=M,f[Ji]|=T,H[ai]=u0,H[ai+1]=o0,H[ai+2]=E0,ai+=3):f[Ji]&A&&f[Ji]&M&&(ut=(K=u0-ec[0])*K+(J=o0-ec[1])*J+(Te=E0-ec[2])*Te)<E[Ji]&&(k.fromArray(u0,o0,E0,ec),E[Ji]=ut,f[Ji]&T||(f[Ji]|=T,H[ai]=u0,H[ai+1]=o0,H[ai+2]=E0,ai+=3)));for(He=0,Xe=j;He<Xe;He+=3)for(B=F[He],V=F[He+1],Y=F[He+2],k.toArray(B,V,Y,ec),Q=6;Q<18;Q++)u0=B+(er=R[Q])[0],o0=V+er[1],E0=Y+er[2],u0<l&&u0>-1&&o0<d&&o0>-1&&E0<u&&E0>-1&&(f[Ji=u0*F0+u*o0+E0]&A&&!(f[Ji]&M)?(k.fromArray(u0,o0,E0,ec),ut=(K=u0-ec[0])*K+(J=o0-ec[1])*J+(Te=E0-ec[2])*Te,E[Ji]=ut,f[Ji]|=M,f[Ji]|=T,H[ai]=u0,H[ai+1]=o0,H[ai+2]=E0,ai+=3):f[Ji]&A&&f[Ji]&M&&(ut=(K=u0-ec[0])*K+(J=o0-ec[1])*J+(Te=E0-ec[2])*Te)<E[Ji]&&(k.fromArray(u0,o0,E0,ec),E[Ji]=ut,f[Ji]&T||(f[Ji]|=T,H[ai]=u0,H[ai+1]=o0,H[ai+2]=E0,ai+=3)));for(He=0,Xe=j;He<Xe;He+=3)for(B=F[He],V=F[He+1],Y=F[He+2],k.toArray(B,V,Y,ec),Q=18;Q<26;Q++)u0=B+(er=R[Q])[0],o0=V+er[1],E0=Y+er[2],u0<l&&u0>-1&&o0<d&&o0>-1&&E0<u&&E0>-1&&(f[Ji=u0*F0+u*o0+E0]&A&&!(f[Ji]&M)?(k.fromArray(u0,o0,E0,ec),ut=(K=u0-ec[0])*K+(J=o0-ec[1])*J+(Te=E0-ec[2])*Te,E[Ji]=ut,f[Ji]|=M,f[Ji]|=T,H[ai]=u0,H[ai+1]=o0,H[ai+2]=E0,ai+=3):f[Ji]&A&&f[Ji]&M&&(ut=(K=u0-ec[0])*K+(J=o0-ec[1])*J+(Te=E0-ec[2])*Te)<E[Ji]&&(k.fromArray(u0,o0,E0,ec),E[Ji]=ut,f[Ji]&T||(f[Ji]|=T,H[ai]=u0,H[ai+1]=o0,H[ai+2]=E0,ai+=3)));return ai}this.getVolume=function(F,k,j,H,B){console.time("EDTSurface.getVolume");var V=F!=="vws";v(V,k,j,H,B),P(V),(function(){var J,Te,He,Q=d*u;for(J=0;J<l;++J)for(Te=0;Te<u;++Te)for(He=0;He<d;++He){var Xe=J*Q+He*u+Te;if(f[Xe]&A)for(var ut=0;ut<26;){var Ji=J+R[ut][0],er=Te+R[ut][2],ec=He+R[ut][1];if(Ji>-1&&Ji<l&&ec>-1&&ec<d&&er>-1&&er<u&&!(f[Ji*Q+ec*u+er]&A)){f[Xe]|=T;break}ut++}}})(),F!=="ms"&&F!=="ses"||N(),F==="ses"&&(O(!1),(function(){var J,Te;for(J=0,Te=f.length;J<Te;++J)f[J]&=~M;for(J=0,Te=r.length/3;J<Te;++J)I(J)})()),(function(J){var Te,He=f.length;if(J==="vws")for(Te=0;Te<He;++Te)f[Te]&=~T,f[Te]=f[Te]&M?1:0;else if(J==="ms")for(Te=0;Te<He;++Te)f[Te]&=~M,f[Te]&T&&(f[Te]|=M),f[Te]&=~T,f[Te]=f[Te]&M?1:0;else if(J==="ses")for(Te=0;Te<He;++Te)f[Te]&T&&f[Te]&M?f[Te]&=~T:f[Te]&T&&!(f[Te]&M)&&(f[Te]|=M),f[Te]=f[Te]&M?1:0;else if(J==="sas")for(Te=0;Te<He;++Te)f[Te]&=~T,f[Te]=f[Te]&M?1:0})(F);for(var Y=0,K=m.length;Y<K;++Y)m[Y]=t[m[Y]];return console.timeEnd("EDTSurface.getVolume"),{data:f,nx:u,ny:d,nz:l,atomindex:m}},this.getSurface=function(F,k,j,H,B,V,Y){var K=this.getVolume(F,k,j,H,B);return new Eo(K.data,K.nx,K.ny,K.nz,K.atomindex).getSurface(1,V,void 0,g,Y)}}function Lu(r,e,t,n,i,s,o){o=Math.max(.1,o);var a=r.length,l=i[0],d=i[1],u=i[2],g=s[0],x=s[1],y=s[2];function b(j,H){return Math.floor((j-H)/o)}for(var _,h,f,E=b(g,l)+1,m=b(x,d)+1,S=b(y,u)+1,w=E*m*S,v=m*S,A=[],M=0;M<a;M++){var T=(_=r[M],h=e[M],f=t[M],(b(_,l)*m+b(h,d))*S+b(f,u));A[T]===void 0?A[T]=[M]:A[T].push(M)}var R=new Uint32Array(w),O=new Uint16Array(w),L=new Uint32Array(a),P=0,I=0;for(M=0;M<w;M++){var N=R[M]=P,U=A[M];if(U!==void 0)for(var F=0;F<U.length;F++)L[P]=U[F],P++;var k=P-N;O[M]=k,k>I&&(I=k)}return{neighbourListLength:27*I+1,withinRadii:function(j,H,B,V,Y){for(var K=0,J=b(j,l),Te=b(H,d),He=b(B,u),Q=Math.max(0,J-1),Xe=Math.max(0,Te-1),ut=Math.max(0,He-1),Ji=Math.min(E,J+2),er=Math.min(m,Te+2),ec=Math.min(S,He+2),ai=Q;ai<Ji;++ai)for(var u0=ai*v,o0=Xe;o0<er;++o0)for(var E0=o0*S,F0=ut;F0<ec;++F0)for(var g0=u0+E0+F0,w0=R[g0],L0=w0+O[g0],T0=w0;T0<L0;T0++){var ht=L[T0],We=r[ht]-j,h0=e[ht]-H,M0=t[ht]-B,Z=n[ht]+V;We*We+h0*h0+M0*M0<=Z*Z&&(Y[K++]=L[T0])}Y[K]=-1}}}function Nu(r,e,t){const n=e.length,i=new Float32Array(n),s=new Float32Array(n),o=new Float32Array(n);for(let J=0;J<n;J++){const Te=3*J;i[J]=r[Te],s[J]=r[Te+1],o[J]=r[Te+2]}let a=Gr(r);r.length===0&&(a[0].set([0,0,0]),a[1].set([0,0,0]));const l=a[0],d=a[1];let u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R,O,L=-1;const P=new Float32Array([0,0,0]),I=new Float32Array([0,0,0]),N=new Float32Array([0,0,0]),U=new Float32Array([0,0,0]);let F;function k(J,Te,He,Q){y=nt(J,1.4),b=nt(Te,2),_=nt(He,!0),h=nt(Q,30),u=new Float32Array(n),g=new Float32Array(n);for(let ut=0;ut<u.length;++ut){var Xe=e[ut]+y;u[ut]=Xe,g[ut]=Xe*Xe}x=0;for(let ut=0;ut<u.length;++ut)u[ut]>x&&(x=u[ut]);(function(){const ut=Bo(l,d,x,b,0);b=ut.scaleFactor,f=ut.dim,E=ut.matrix,F=Math.max(5,2+Math.floor(y*b)),m=Ai(f[0]*f[1]*f[2],-1001),S=new Int32Array(m.length),w=new Float32Array(f[0]),v=new Float32Array(f[1]),A=new Float32Array(f[2]),j(w,l[0],1/b),j(v,l[1],1/b),j(A,l[2],1/b)})(),(function(){var ut=0,Ji=2*Math.PI/h;T=new Float32Array(h),M=new Float32Array(h);for(var er=0;er<h;er++)T[er]=Math.cos(ut),M[er]=Math.sin(ut),ut+=Ji})(),R=Lu(i,s,o,u,l,d,2.01*x),O=new Int32Array(R.neighbourListLength),L=-1}function j(J,Te,He){for(let Q=0;Q<J.length;Q++)J[Q]=Te+He*Q}function H(J,Te,He,Q,Xe){let ut;if(L!==-1){if(ut=L,ut!==Q&&ut!==Xe&&B(ut,J,Te,He))return ut;L=-1}var Ji=0;for(ut=O[Ji];ut>=0;){if(ut!==Q&&ut!==Xe&&B(ut,J,Te,He))return L=ut,ut;ut=O[++Ji]}return L=-1,-1}function B(J,Te,He,Q){var Xe=3*J,ut=g[J],Ji=r[Xe]-Te,er=r[Xe+1]-He,ec=r[Xe+2]-Q;return Ji*Ji+er*er+ec*ec<ut}function V(){for(var J=0;J<n;J++){var Te=i[J],He=s[J],Q=o[J],Xe=u[J],ut=g[J];R.withinRadii(Te,He,Q,Xe,O);for(var Ji=Math.ceil(Xe*b),er=Math.floor(b*(Te-l[0])),ec=Math.floor(b*(He-l[1])),ai=Math.floor(b*(Q-l[2])),u0=Math.max(0,er-Ji),o0=Math.max(0,ec-Ji),E0=Math.max(0,ai-Ji),F0=Math.min(f[0],er+Ji+2),g0=Math.min(f[1],ec+Ji+2),w0=Math.min(f[2],ai+Ji+2),L0=u0;L0<F0;L0++)for(var T0=w[L0]-Te,ht=f[1]*f[2]*L0,We=o0;We<g0;We++)for(var h0=v[We]-He,M0=T0*T0+h0*h0,Z=ht+f[2]*We,tt=E0;tt<w0;tt++){var tr=A[tt]-Q,s0=M0+tr*tr;if(s0<ut){var c0=tt+Z;m[c0]<0&&(m[c0]=-m[c0]);var A0=Math.sqrt(s0),P0=Xe/A0,Fe=T0*P0,f0=h0*P0,v0=tr*P0;if(H(Fe+=Te,f0+=He,v0+=Q,J,-1)===-1){var D0=Xe-A0;D0<m[c0]&&(m[c0]=D0,_&&(S[c0]=J))}}}}}function Y(J,Te){var He=u[J],Q=u[Te],Xe=P[0]=i[Te]-i[J],ut=P[1]=s[Te]-s[J],Ji=P[2]=o[Te]-o[J],er=Xe*Xe+ut*ut+Ji*Ji,ec=Math.sqrt(er),ai=He*((He*He+ec*ec-Q*Q)/(2*He*ec));on(P,P),(function(lt,oi){lt[0]=lt[1]=lt[2]=1,oi[0]!==0?lt[0]=(oi[1]+oi[2])/-oi[0]:oi[1]!==0?lt[1]=(oi[0]+oi[2])/-oi[1]:oi[2]!==0&&(lt[2]=(oi[0]+oi[1])/-oi[2])})(N,P),on(N,N),Yr(U,P,N),on(U,U);var u0=Math.sqrt(He*He-ai*ai);sn(N,N,u0),sn(U,U,u0),sn(P,P,ai),I[0]=P[0]+i[J],I[1]=P[1]+s[J],I[2]=P[2]+o[J],L=-1;for(var o0=F,E0=0;E0<h;E0++){var F0=T[E0],g0=M[E0],w0=I[0]+F0*N[0]+g0*U[0],L0=I[1]+F0*N[1]+g0*U[1],T0=I[2]+F0*N[2]+g0*U[2];if(H(w0,L0,T0,J,Te)===-1)for(var ht=Math.floor(b*(w0-l[0])),We=Math.floor(b*(L0-l[1])),h0=Math.floor(b*(T0-l[2])),M0=Math.max(0,ht-o0),Z=Math.max(0,We-o0),tt=Math.max(0,h0-o0),tr=Math.min(f[0],ht+o0+2),s0=Math.min(f[1],We+o0+2),c0=Math.min(f[2],h0+o0+2),A0=M0;A0<tr;A0++){Xe=w0-w[A0];for(var P0=f[1]*f[2]*A0,Fe=Z;Fe<s0;Fe++)for(var f0=Xe*Xe+(ut=L0-v[Fe])*ut,v0=P0+f[2]*Fe,D0=tt;D0<c0;D0++){er=f0+(Ji=T0-A[D0])*Ji;var l0=D0+v0,y0=m[l0];if(y0>0&&er<y0*y0&&(m[l0]=Math.sqrt(er),_)){const lt=Xe*P[0]+ut*P[1]+Ji*P[2];S[l0]=lt<0?Te:J}}}}}function K(J,Te,He){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),k(J,Te,He),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),V(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),(function(){for(var Q=0;Q<n;Q++){R.withinRadii(i[Q],s[Q],o[Q],u[Q],O);for(var Xe=0,ut=O[Xe];ut>=0;)Q<ut&&Y(Q,ut),ut=O[++Xe]}})(),console.timeEnd("AVSurface.projectTorii"),(function(){for(var Q=0;Q<m.length;Q++)m[Q]<0&&(m[Q]=0)})(),(function(){for(var Q=0;Q<S.length;Q++)S[Q]=t[S[Q]]})(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(J,Te,He,Q,Xe,ut,Ji){return K(Te,He,Xe),new Eo(m,f[2],f[1],f[0],S).getSurface(Te,!1,void 0,E,Ji)}}Le.add("line",$u),Object.assign(Ru,{__deps:[Bo,Do,Eo,Gr,Ou]}),Object.assign(Nu,{__deps:[Bo,Eo,Ai,Gr,sn,Yr,on,Lu,nt]}),$e.add("molsurf",(function(r,e){const t=r.data.args,n=r.data.params;if(t&&n){const i=new(n.type==="av"?Nu:Ru)(t.coordList,t.radiusList,t.indexList).getSurface(n.type,n.probeRadius,n.scaleFactor,n.cutoff,!0,n.smooth,n.contour),s=[i.position.buffer,i.index.buffer];i.normal&&s.push(i.normal.buffer),i.atomindex&&s.push(i.atomindex.buffer),e({sd:i,p:n},s)}}),[Ru,Nu]);class zu{constructor(e){this.structure=e}_getAtomData(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:nt(e.radiusParams,{type:"vdw",scale:1})})}_makeSurface(e,t){var n=new Fo(t.name,"",e);return n.info.type=t.type,n.info.probeRadius=t.probeRadius,n.info.scaleFactor=t.scaleFactor,n.info.smooth=t.smooth,n.info.cutoff=t.cutoff,n}getSurface(e){const t=e||{},n=this._getAtomData(e),i=n.position,s=n.radius,o=n.index,a=new(t.type==="av"?Nu:Ru)(i,s,o).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(a,t)}getSurfaceWorker(e,t){const n=Object.assign({},e);if(window.hasOwnProperty("Worker")){this.worker===void 0&&(this.worker=new zr("molsurf"));const i=this._getAtomData(e),s=i.position,o=i.radius,a=i.index,l={args:{coordList:s,radiusList:o,indexList:a},params:n},d=[s.buffer,o.buffer,a.buffer];this.worker.post(l,d,(u=>{t(this._makeSurface(u.data.sd,n))}),(u=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",u),this.worker.terminate(),this.worker=void 0;const g=this.getSurface(n);t(g)}))}else{const i=this.getSurface(n);t(i)}}dispose(){this.worker&&this.worker.terminate()}}class Uu extends Sh{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add((()=>{this.__forceNewMolsurf=!0})),this.toBePrepared=!0,this.init(n)}init(e){const t=e||{};t.colorScheme=nt(t.colorScheme,"uniform"),t.colorValue=nt(t.colorValue,14540253),t.disablePicking=nt(t.disablePicking,!0),this.surfaceType=nt(t.surfaceType,"ms"),this.probeRadius=nt(t.probeRadius,1.4),this.smooth=nt(t.smooth,2),this.scaleFactor=nt(t.scaleFactor,2),this.cutoff=nt(t.cutoff,0),this.contour=nt(t.contour,!1),this.background=nt(t.background,!1),this.opaqueBack=nt(t.opaqueBack,!0),this.filterSele=nt(t.filterSele,""),this.colorVolume=nt(t.colorVolume,void 0),this.useWorker=nt(t.useWorker,!0),super.init(e)}prepareData(e,t,n){let i=this.__infoList[t];if(i||(i={},this.__infoList[t]=i),i.molsurf&&i.sele===e.selection.string)n(t);else{if(this.filterSele){const a=e.structure.getView(new me(this.filterSele)),l=a.boundingBox.getSize(new Vector3),d=Math.max(l.x,l.y,l.z),u=e.getAtomSetWithinPoint(a.center,d/2+6);if((e=e.getView(new me(e.getAtomSetWithinSelection(u,3).toSeleString()))).atomCount===0)return void n(t)}i.sele=e.selection.string,i.molsurf=new zu(e);const s=this.getSurfaceParams(),o=a=>{i.surface=a,n(t)};this.useWorker?i.molsurf.getSurfaceWorker(s,o):o(i.molsurf.getSurface(s))}}prepare(e){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach((s=>{s&&s.molsurf&&s.molsurf.dispose()})),this.__infoList.length=0),this.structureView.atomCount===0)return void e();const t=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,e()},n=this.assembly==="default"?this.defaultAssembly:this.assembly,i=this.structure.biomolDict[n];i?i.partList.forEach(((s,o)=>{const a=s.getView(this.structureView);this.prepareData(a,o,(l=>{l===i.partList.length-1&&t()}))})):this.prepareData(this.structureView,0,t)}createData(e,t){const n=this.__infoList[t],i=n.surface;if(!i)return;const s={position:i.getPosition(),color:i.getColor(this.getColorParams()),index:i.getFilteredIndex(this.filterSele,e)},o=[];if(i.contour){const a=new Wo(s,this.getBufferParams({wireframe:!1}));o.push(a)}else{Object.assign(s,{normal:i.getNormal(),picking:i.getPicking(e.getStructure())});const a=new jo(s,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if(this.getBufferParams().side=="double"){const l=new qo(a);o.push(l)}else o.push(a)}return{bufferList:o,info:n}}updateData(e,t){const n={};if(e.position||e.radius)return this.__forceNewMolsurf=!0,void this.build();e.color&&(n.color=t.info.surface.getColor(this.getColorParams())),e.index&&(n.index=t.info.surface.getFilteredIndex(this.filterSele,t.sview)),t.bufferList[0].setAttributes(n)}setParameters(e,t={},n){return e&&e.filterSele&&(t.index=!0),e&&e.colorVolume!==void 0&&(t.color=!0),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),this}getSurfaceParams(e={}){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},e)}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach((e=>{e&&e.molsurf&&e.molsurf.dispose()})),this.__infoList.length=0,super.dispose()}}Le.add("surface",Uu);class Vu extends Sh{constructor(e,t,n){super(e,t,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.pointSize=nt(t.pointSize,1),this.sizeAttenuation=nt(t.sizeAttenuation,!0),this.sortParticles=nt(t.sortParticles,!1),this.useTexture=nt(t.useTexture,!1),this.alphaTest=nt(t.alphaTest,.5),this.forceTransparent=nt(t.forceTransparent,!1),this.edgeBleach=nt(t.edgeBleach,0),super.init(t)}createData(e){var t=e.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new Hc(t,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:n.position}),e&&!e.color||Object.assign(i,{color:n.color}),t.bufferList[0].setAttributes(i)}getAtomRadius(){return .1}}Le.add("point",Vu),ze.add("shader/Ribbon.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
attribute vec3 dir;
attribute float size;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
transformed += normalize( dir ) * size;
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);const ju=new Uint16Array([0,1,2,1,3,2]);function Gu(r){return 3*(4*(r.position.length/3-1))}class Hu extends Vo{constructor(e,t={}){super({position:new Float32Array(Gu(e)),color:new Float32Array(Gu(e)),index:bt(Gu(e),Gu(e)/3),normal:new Float32Array(Gu(e)),picking:e.picking},t),this.vertexShader="Ribbon.vert";const n=e.position.length/3-1,i=4*n,s=3*i;this.addAttributes({dir:{type:"v3",value:new Float32Array(s)}}),this.addAttributes({size:{type:"f",value:new Float32Array(i)}}),e.primitiveId=Ci(n),this.setAttributes(e),this.makeIndex()}setAttributes(e={}){const t=this.size/4,n=this.geometry.attributes;let i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v;e.position&&(i=e.position,u=n.position.array,n.position.needsUpdate=!0),e.normal&&(s=e.normal,g=n.normal.array,n.normal.needsUpdate=!0),e.size&&(o=e.size,x=n.size.array,n.size.needsUpdate=!0),e.dir&&(a=e.dir,y=n.dir.array,n.dir.needsUpdate=!0),e.color&&(l=e.color,b=n.color.array,n.color.needsUpdate=!0),e.primitiveId&&(d=e.primitiveId,_=n.primitiveId.array,n.primitiveId.needsUpdate=!0);let A=o?o[0]:null;for(h=0;h<t;++h){for(w=3*h,E=3*h*4,S=4*h,i&&(u[E]=u[E+3]=i[w],u[E+1]=u[E+4]=i[w+1],u[E+2]=u[E+5]=i[w+2],u[E+6]=u[E+9]=i[w+3],u[E+7]=u[E+10]=i[w+4],u[E+8]=u[E+11]=i[w+5]),s&&(g[E]=g[E+3]=-s[w],g[E+1]=g[E+4]=-s[w+1],g[E+2]=g[E+5]=-s[w+2],g[E+6]=g[E+9]=-s[w+3],g[E+7]=g[E+10]=-s[w+4],g[E+8]=g[E+11]=-s[w+5]),f=0;f<4;++f)m=E+3*f,l&&(b[m]=l[w],b[m+1]=l[w+1],b[m+2]=l[w+2]),d&&(_[S+f]=d[h]);o&&(v=o[h],A!==o[h]?(x[S]=A,x[S+1]=A,x[S+2]=v,x[S+3]=v):(x[S]=v,x[S+1]=v,x[S+2]=v,x[S+3]=v),A=v),a&&(y[E]=a[w],y[E+1]=a[w+1],y[E+2]=a[w+2],y[E+3]=-a[w],y[E+4]=-a[w+1],y[E+5]=-a[w+2],y[E+6]=a[w+3],y[E+7]=a[w+4],y[E+8]=a[w+5],y[E+9]=-a[w+3],y[E+10]=-a[w+4],y[E+11]=-a[w+5])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void ke.error("Index is null");const t=e.array,n=t.length/4/3;for(let i=0;i<n;++i){const s=6*i,o=4*i;t.set(ju,s);for(let a=0;a<6;++a)t[s+a]+=o}}}class qu extends Sh{constructor(e,t,n){super(e,t,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=nt(t.colorScheme,"chainname"),t.colorScale=nt(t.colorScale,"RdYlBu"),t.radiusType=nt(t.radiusType,"sstruc"),t.radiusScale=nt(t.radiusScale,4),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=nt(t.subdiv,6),this.tension=nt(t.tension,NaN),this.smoothSheet=nt(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){var t=[],n=[];return this.structure.eachPolymer((i=>{if(!(i.residueCount<4)){n.push(i);var s=new ou(i,this.getSplineParams()),o=s.getSubdividedPosition(),a=s.getSubdividedOrientation(),l=s.getSubdividedColor(this.getColorParams()),d=s.getSubdividedPicking(),u=s.getSubdividedSize(this.getRadiusParams());t.push(new Hu({position:o.position,normal:a.binormal,dir:a.normal,color:l.color,size:u.size,picking:d.picking},this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,i=t.polymerList.length;for(n=0;n<i;++n){var s={},o=new ou(t.polymerList[n],this.getSplineParams());if(e.position){var a=o.getSubdividedPosition(),l=o.getSubdividedOrientation();Object.assign(s,{position:a.position,normal:l.binormal,dir:l.normal})}if(e.radius||e.scale){var d=o.getSubdividedSize(this.getRadiusParams());Object.assign(s,{size:d.size})}if(e.color){var u=o.getSubdividedColor(this.getColorParams());Object.assign(s,{color:u.color})}t.bufferList[n].setAttributes(s)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}Le.add("ribbon",qu);class Wu extends Sh{constructor(e,t,n){super(e,t,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){let t=e||{};t.colorScheme=nt(t.colorScheme,"sstruc"),t.radiusSize=nt(t.radiusSize,1.5),t.radiusScale=nt(t.radiusScale,1),t.openEnded=nt(t.openEnded,!1),t.useInteriorColor=nt(t.useInteriorColor,!0),this.localAngle=nt(t.localAngle,30),this.centerDist=nt(t.centerDist,2.5),this.ssBorder=nt(t.ssBorder,!1),super.init(t)}createData(e){let t=0;const n=[],i=[];this.structure.eachPolymer((l=>{if(l.residueCount<4||l.isNucleic())return;const d=new Ca(l),u=d.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t+=u.size.length,n.push(u),i.push(d)}),e.getSelection());const s={begin:new Float32Array(3*t),end:new Float32Array(3*t),size:new Float32Array(t),color:new Float32Array(3*t),picking:{}};let o=new Float32Array(t),a=0;return n.forEach((function(l){s.begin.set(l.begin,3*a),s.end.set(l.end,3*a),s.size.set(l.size,a),s.color.set(l.color,3*a),o.set(l.picking.array,a),a+=l.size.length})),t&&(s.picking=new Xs(o,e.getStructure())),{bufferList:[new tu({position1:s.begin,position2:s.end,color:s.color,color2:s.color,radius:s.size,picking:s.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:n,helixbundleList:i,axisData:s}}updateData(e,t){if((e=e||{}).position)this.build();else{var n={};if(e.color||e.radius){var i=0;t.helixbundleList.forEach((s=>{var o=s.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e.color&&t.axisData.color.set(o.color,3*i),(e.radius||e.scale)&&t.axisData.size.set(o.size,i),i+=o.size.length})),e.color&&Object.assign(n,{color:t.axisData.color,color2:t.axisData.color}),(e.radius||e.scale)&&Object.assign(n,{radius:t.axisData.size})}t.bufferList[0].setAttributes(n)}}}Le.add("rocket",Wu);class Xu extends uu{constructor(e,t,n){super(e,t,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(e){var t=e||{};t.aspectRatio=1,t.tension=nt(t.tension,.5),t.radiusScale=nt(t.radiusScale,5),t.smoothSheet=!1,this.smooth=nt(t.smooth,2),super.init(t)}getSpline(e){var t=new Sa(e);return new ou(e,this.getSplineParams({directional:!1,positionIterator:t.getCenterIterator(this.smooth)}))}}Le.add("rope",Xu);class Yu extends Sh{constructor(e,t,n){super(e,t,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.useInteriorColor=nt(t.useInteriorColor,!0),super.init(t)}createData(e){return{bufferList:[new Uc(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:n.position}),e&&!e.color||Object.assign(i,{color:n.color}),e&&!e.radius||Object.assign(i,{radius:n.radius}),t.bufferList[0].setAttributes(i)}}function Ku(r){return 3*(r.position.length/3-1)*2}Le.add("spacefill",Yu);class Zu extends Uo{constructor(e,t={}){super({position:new Float32Array(Ku(e)),color:new Float32Array(Ku(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(e)}setAttributes(e){let t,n,i,s;const o=this.geometry.attributes;if(e.position&&(t=e.position,i=o.position.array,o.position.needsUpdate=!0),e.color&&(n=e.color,s=o.color.array,o.color.needsUpdate=!0),!t&&!n)return void ke.warn("TraceBuffer.prototype.setAttributes no data");let a,l;const d=this.size-1;for(let u=0;u<d;++u)a=3*u,l=3*u*2,t&&(i[l]=t[a],i[l+1]=t[a+1],i[l+2]=t[a+2],i[l+3]=t[a+3],i[l+4]=t[a+4],i[l+5]=t[a+5]),n&&(s[l]=n[a],s[l+1]=n[a+1],s[l+2]=n[a+2],s[l+3]=n[a+3],s[l+4]=n[a+4],s[l+5]=n[a+5])}}class Qu extends Sh{constructor(e,t,n){super(e,t,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=nt(t.colorScheme,"chainname"),t.colorScale=nt(t.colorScale,"RdYlBu"),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=nt(t.subdiv,6),this.tension=nt(t.tension,NaN),this.smoothSheet=nt(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?.1:0}createData(e){var t=[],n=[];return this.structure.eachPolymer((i=>{if(!(i.residueCount<4)){n.push(i);var s=new ou(i,this.getSplineParams()),o=s.getSubdividedPosition(),a=s.getSubdividedColor(this.getColorParams());t.push(new Zu(Object.assign({},o,a),this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,i=t.polymerList.length;for(n=0;n<i;++n){var s={},o=new ou(t.polymerList[n],this.getSplineParams());if(e.position){var a=o.getSubdividedPosition();Object.assign(s,{position:a.position})}if(e.color){var l=o.getSubdividedColor(this.getColorParams());Object.assign(s,{color:l.color})}t.bufferList[n].setAttributes(s)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}Le.add("trace",Qu);class Ju extends uu{constructor(e,t,n){super(e,t,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,t.radiusScale=nt(t.radiusScale,2),t.quality==="low"&&(this.radialSegments=5),super.init(t)}getSplineParams(){return super.getSplineParams({directional:!1})}}Le.add("tube",Ju);class td extends Sh{constructor(e,t,n){super(e,t,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};let n=.5;this.structure.unitcell&&(n=Math.cbrt(this.structure.unitcell.volume)/200),t.radiusSize=nt(t.radiusSize,n),t.colorValue=nt(t.colorValue,"orange"),t.useInteriorColor=nt(t.useInteriorColor,!0),super.init(t)}getUnitcellData(e){return e.unitcell.getData(e)}create(){const e=this.structureView.getStructure();if(!e.unitcell)return;const t=this.getUnitcellData(e);this.sphereBuffer=new Uc(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new tu(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=t.sview.getStructure();if(!n.unitcell)return;const i=this.getUnitcellData(n),s={},o={};e&&!e.position||(Object.assign(s,{position:i.vertex.position}),Object.assign(o,{position1:i.edge.position1,position2:i.edge.position2})),e&&!e.color||(Object.assign(s,{color:i.vertex.color}),Object.assign(o,{color:i.edge.color,color2:i.edge.color2})),e&&!e.radius||(Object.assign(s,{radius:i.vertex.radius}),Object.assign(o,{radius:i.edge.radius})),this.sphereBuffer.setAttributes(s),this.cylinderBuffer.setAttributes(o)}}Le.add("unitcell",td);class ed extends Sh{constructor(e,t,n){super(e,t,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}init(e){const t=e||{};t.colorValue=nt(t.colorValue,"#f0027f"),t.useInteriorColor=nt(t.useInteriorColor,!0),super.init(t)}createData(e){if(!e.validation)return;const t=e.validation.getClashData({structure:e,color:this.colorValue});return{bufferList:[new tu(t,this.getBufferParams({openEnded:!1}))]}}}Le.add("validation",ed);const id=new Vector3,rd=new Vector3,nd=new Vector3,sd=new Vector3(0,1,0),od=Object.assign({radialSegments:60,openEnded:!1},No);class ad extends Bc{constructor(e,t={}){super({position:new Float32Array(e.position1.length),color:e.color,picking:e.picking},t,(function(n={}){const i=new ConeGeometry(1,1,nt(n.radialSegments,60),1,nt(n.openEnded,!1));return i.applyMatrix4(new Matrix4().makeRotationX(-Math.PI/2)),i})(t)),this.updateNormals=!0,this._position=new Float32Array(e.position1.length),this.setAttributes(e,!0)}get defaultParameters(){return od}applyPositionTransform(e,t,n){rd.fromArray(this._position1,n),nd.fromArray(this._position2,n),e.lookAt(rd,nd,sd);const i=this._radius[t];id.set(i,i,rd.distanceTo(nd)),e.scale(id)}setAttributes(e={},t){e.position1&&e.position2&&(vi(e.position1,e.position2,this._position),this._position1=e.position1,this._position2=e.position2,e.position=this._position),e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}je.add("cone",ad);class cd{constructor(e=[]){this.geometryList=e}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new Box3,this.geometryList.forEach((e=>{e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox)}))}}const ld=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},No);class hd{constructor(e,t={}){this.group=new Group,this.wireframeGroup=new Group,this.pickingGroup=new Group,this.visible=!0,this.parameters=st(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);const n=this.makeAttributes(e),i={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new tu(n.cylinder,i),this.coneBuffer=new ad(n.cone,i),this.geometry=new cd([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=nt(t.matrix,new Matrix4),this.picking=e.picking}get defaultParameters(){return ld}set matrix(e){Uo.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(e={}){const t=this.splitPosition,n=this.cylinderRadius,i=this.parameters.aspectRatio;let s,o;const a={},l={};if(e.radius){for(s=0,o=n.length;s<o;++s)n[s]=e.radius[s]/i;a.radius=n,l.radius=e.radius}if(e.position1&&e.position2){const d=new Vector3,u=new Vector3,g=new Vector3,x=new Vector3;for(s=0,o=t.length;s<o;s+=3){d.fromArray(e.position1,s),u.fromArray(e.position2,s),g.subVectors(d,u);const y=g.length(),b=n[s/3]*i*2,_=Math.min(y,b);g.setLength(_),x.copy(u).add(g),x.toArray(t,s)}a.position1=e.position1,a.position2=t,l.position1=t,l.position2=e.position2}return e.color&&(a.color=e.color,a.color2=e.color,l.color=e.color),{cylinder:a,cone:l}}getMesh(){return new Group().add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return new Group().add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return new Group().add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(e={}){const t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)}setParameters(e={}){(e=Object.assign({},e))&&e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,e&&e.wireframe!==void 0&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)}setVisibility(e){Uo.prototype.setVisibility.call(this,e)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}}je.add("arrow",hd);const ud=new Vector3,dd=new Vector3,md=new Vector3,fd=new Vector3(0,0,0);class pd extends Bc{constructor(e,t={}){super(e,t,new BoxGeometry(1,1,1)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){dd.fromArray(this._heightAxis,n),md.fromArray(this._depthAxis,n),e.lookAt(fd,dd,md),ud.set(this._size[t],md.length(),dd.length()),e.scale(ud)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}je.add("box",pd);const gd=new Vector3,yd=new Vector3,bd=new Vector3,_d=new Vector3(0,0,0),xd=Object.assign({sphereDetail:2},No);class vd extends Bc{constructor(e,t={}){super(e,t,new IcosahedronGeometry(1,nt(t.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return xd}applyPositionTransform(e,t,n){yd.fromArray(this._majorAxis,n),bd.fromArray(this._minorAxis,n),e.lookAt(_d,yd,bd),gd.set(this._radius[t],bd.length(),yd.length()),e.scale(gd)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}je.add("ellipsoid",vd);const wd=new Vector3,Ad=new Vector3,Sd=new Vector3,Cd=new Vector3(0,0,0);class Pd extends Bc{constructor(e,t={}){super(e,t,new OctahedronGeometry(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){Ad.fromArray(this._heightAxis,n),Sd.fromArray(this._depthAxis,n),e.lookAt(Cd,Ad,Sd),wd.set(this._size[t],Sd.length(),Ad.length()),e.scale(wd)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}je.add("octahedron",Pd);const Id=new Vector3,kd=new Vector3,Md=new Vector3,Td=new Vector3(0,0,0);class Dd extends Bc{constructor(e,t={}){super(e,t,new TetrahedronGeometry(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){kd.fromArray(this._heightAxis,n),Md.fromArray(this._depthAxis,n),e.lookAt(Td,kd,Md),Id.set(this._size[t],Md.length(),kd.length()),e.scale(Id)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}je.add("tetrahedron",Dd);const Bd=new Vector3,Fd=new Vector3,Ed=new Vector3,$d=new Vector3(0,0,0),Od=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},No);class Rd extends Bc{constructor(e,t={}){super(e,t,new TorusGeometry(1,nt(t.radiusRatio,.2),nt(t.radialSegments,16),nt(t.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return Od}applyPositionTransform(e,t,n){Fd.fromArray(this._majorAxis,n),Ed.fromArray(this._minorAxis,n),e.lookAt($d,Fd,Ed);const i=this._radius[t];Bd.set(i,i,i),e.scale(Bd)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}function Ld(r,e){return{start:e&&e.start!==void 0?Math.max(Math.min(e.start,r-1),0):0,end:e&&e.end!==void 0?Math.min(e.end,r):r}}function Nd(r,e){const t=e&&e.array!==void 0?e.array:Array,{start:n,end:i}=Ld(r,e);return{array:new t(i-n),start:n,end:i}}function zd(r,e,t){const{array:n,start:i}=Nd(r,t);return(function(s,o,a){for(let l=0,d=o.length;l<d;l++)o[l]=s(a+l);return o})(e,n,i)}function Ud(r){return!!r.buffer&&typeof r.byteLength=="number"&&typeof r.BYTES_PER_ELEMENT=="number"}function Vd(r,e){const{constructor:t,buffer:n,length:i,byteOffset:s,BYTES_PER_ELEMENT:o}=r,{start:a,end:l}=Ld(i,e);return a===0&&l===i?r:new t(n,s+o*a,Math.min(i,l-a))}je.add("torus",Rd);const jd=1e-6;function Gd(r,e,t){return Math.abs(r-e)<=t}function Hd(r,e,t){return Math.max(e,Math.min(t,r))}function qd(r,e,t,n,i,s){const o=(t-r)*s,a=(n-e)*s,l=i*i;return(2*e-2*t+o+a)*(i*l)+(-3*e+3*t-2*o-a)*l+o*i+e}function Wd(r,e,t,n){const i=1-n;return i*i*r+2*i*n*e+n*n*t}const Xd=isFinite;function Yd(){return Yd.zero()}(function(r){function e(){const L=[.1,0,0];return L[0]=0,L}function t(L,P,I){const N=e();return N[0]=L,N[1]=P,N[2]=I,N}function n(L,P){return L[0]=P[0],L[1]=P[1],L[2]=P[2],L}function i(L,P,I){return L[0]=P[0]+I[0],L[1]=P[1]+I[1],L[2]=P[2]+I[2],L}function s(L,P,I){return L[0]=P[0]-I[0],L[1]=P[1]-I[1],L[2]=P[2]-I[2],L}function o(L,P,I){return L[0]=P[0]*I,L[1]=P[1]*I,L[2]=P[2]*I,L}function a(L,P,I,N){return L[0]=P[0]+I[0]*N,L[1]=P[1]+I[1]*N,L[2]=P[2]+I[2]*N,L}function l(L){const P=L[0],I=L[1],N=L[2];return P*P+I*I+N*N}function d(L,P){return L[0]=-P[0],L[1]=-P[1],L[2]=-P[2],L}function u(L,P){const I=P[0],N=P[1],U=P[2];let F=I*I+N*N+U*U;return F>0&&(F=1/Math.sqrt(F),L[0]=P[0]*F,L[1]=P[1]*F,L[2]=P[2]*F),L}function g(L,P){return L[0]*P[0]+L[1]*P[1]+L[2]*P[2]}function x(L,P,I){const N=P[0],U=P[1],F=P[2],k=I[0],j=I[1],H=I[2];return L[0]=U*H-F*j,L[1]=F*k-N*H,L[2]=N*j-U*k,L}r.zero=e,r.clone=function(L){const P=e();return P[0]=L[0],P[1]=L[1],P[2]=L[2],P},r.isFinite=function(L){return Xd(L[0])&&Xd(L[1])&&Xd(L[2])},r.hasNaN=function(L){return isNaN(L[0])||isNaN(L[1])||isNaN(L[2])},r.setNaN=function(L){return L[0]=NaN,L[1]=NaN,L[2]=NaN,L},r.fromObj=function(L){return t(L.x,L.y,L.z)},r.toObj=function(L){return{x:L[0],y:L[1],z:L[2]}},r.fromArray=function(L,P,I){return L[0]=P[I+0],L[1]=P[I+1],L[2]=P[I+2],L},r.toArray=function(L,P,I){return P[I+0]=L[0],P[I+1]=L[1],P[I+2]=L[2],P},r.create=t,r.ofArray=function(L){const P=e();return P[0]=L[0],P[1]=L[1],P[2]=L[2],P},r.set=function(L,P,I,N){return L[0]=P,L[1]=I,L[2]=N,L},r.copy=n,r.add=i,r.sub=s,r.mul=function(L,P,I){return L[0]=P[0]*I[0],L[1]=P[1]*I[1],L[2]=P[2]*I[2],L},r.div=function(L,P,I){return L[0]=P[0]/I[0],L[1]=P[1]/I[1],L[2]=P[2]/I[2],L},r.scale=o,r.scaleAndAdd=a,r.scaleAndSub=function(L,P,I,N){return L[0]=P[0]-I[0]*N,L[1]=P[1]-I[1]*N,L[2]=P[2]-I[2]*N,L},r.addScalar=function(L,P,I){return L[0]=P[0]+I,L[1]=P[1]+I,L[2]=P[2]+I,L},r.subScalar=function(L,P,I){return L[0]=P[0]-I,L[1]=P[1]-I,L[2]=P[2]-I,L},r.round=function(L,P){return L[0]=Math.round(P[0]),L[1]=Math.round(P[1]),L[2]=Math.round(P[2]),L},r.ceil=function(L,P){return L[0]=Math.ceil(P[0]),L[1]=Math.ceil(P[1]),L[2]=Math.ceil(P[2]),L},r.floor=function(L,P){return L[0]=Math.floor(P[0]),L[1]=Math.floor(P[1]),L[2]=Math.floor(P[2]),L},r.trunc=function(L,P){return L[0]=Math.trunc(P[0]),L[1]=Math.trunc(P[1]),L[2]=Math.trunc(P[2]),L},r.abs=function(L,P){return L[0]=Math.abs(P[0]),L[1]=Math.abs(P[1]),L[2]=Math.abs(P[2]),L},r.min=function(L,P,I){return L[0]=Math.min(P[0],I[0]),L[1]=Math.min(P[1],I[1]),L[2]=Math.min(P[2],I[2]),L},r.max=function(L,P,I){return L[0]=Math.max(P[0],I[0]),L[1]=Math.max(P[1],I[1]),L[2]=Math.max(P[2],I[2]),L},r.clamp=function(L,P,I,N){return L[0]=Math.max(I[0],Math.min(N[0],P[0])),L[1]=Math.max(I[1],Math.min(N[1],P[1])),L[2]=Math.max(I[2],Math.min(N[2],P[2])),L},r.distance=function(L,P){const I=P[0]-L[0],N=P[1]-L[1],U=P[2]-L[2];return Math.sqrt(I*I+N*N+U*U)},r.squaredDistance=function(L,P){const I=P[0]-L[0],N=P[1]-L[1],U=P[2]-L[2];return I*I+N*N+U*U},r.magnitude=function(L){const P=L[0],I=L[1],N=L[2];return Math.sqrt(P*P+I*I+N*N)},r.squaredMagnitude=l,r.setMagnitude=function(L,P,I){return o(L,u(L,P),I)},r.negate=d,r.inverse=function(L,P){return L[0]=1/P[0],L[1]=1/P[1],L[2]=1/P[2],L},r.normalize=u,r.dot=g,r.cross=x,r.lerp=function(L,P,I,N){const U=P[0],F=P[1],k=P[2];return L[0]=U+N*(I[0]-U),L[1]=F+N*(I[1]-F),L[2]=k+N*(I[2]-k),L};const y=e();function b(L,P){const I=Math.sqrt(l(L)*l(P));if(I===0)return Math.PI/2;const N=g(L,P)/I;return Math.acos(Hd(N,-1,1))}r.slerp=function(L,P,I,N){const U=Hd(g(P,I),-1,1),F=Math.acos(U)*N;return a(y,I,P,-U),u(y,y),i(L,o(L,P,Math.cos(F)),o(y,y,Math.sin(F)))},r.hermite=function(L,P,I,N,U,F){const k=F*F,j=k*(2*F-3)+1,H=k*(F-2)+F,B=k*(F-1),V=k*(3-2*F);return L[0]=P[0]*j+I[0]*H+N[0]*B+U[0]*V,L[1]=P[1]*j+I[1]*H+N[1]*B+U[1]*V,L[2]=P[2]*j+I[2]*H+N[2]*B+U[2]*V,L},r.bezier=function(L,P,I,N,U,F){const k=1-F,j=k*k,H=F*F,B=j*k,V=3*F*j,Y=3*H*k,K=H*F;return L[0]=P[0]*B+I[0]*V+N[0]*Y+U[0]*K,L[1]=P[1]*B+I[1]*V+N[1]*Y+U[1]*K,L[2]=P[2]*B+I[2]*V+N[2]*Y+U[2]*K,L},r.quadraticBezier=function(L,P,I,N,U){return L[0]=Wd(P[0],I[0],N[0],U),L[1]=Wd(P[1],I[1],N[1],U),L[2]=Wd(P[2],I[2],N[2],U),L},r.spline=function(L,P,I,N,U,F,k){return L[0]=qd(P[0],I[0],N[0],U[0],F,k),L[1]=qd(P[1],I[1],N[1],U[1],F,k),L[2]=qd(P[2],I[2],N[2],U[2],F,k),L},r.random=function(L,P){const I=2*Math.random()*Math.PI,N=2*Math.random()-1,U=Math.sqrt(1-N*N)*P;return L[0]=Math.cos(I)*U,L[1]=Math.sin(I)*U,L[2]=N*P,L},r.transformMat4=function(L,P,I){const N=P[0],U=P[1],F=P[2],k=1/(I[3]*N+I[7]*U+I[11]*F+I[15]||1);return L[0]=(I[0]*N+I[4]*U+I[8]*F+I[12])*k,L[1]=(I[1]*N+I[5]*U+I[9]*F+I[13])*k,L[2]=(I[2]*N+I[6]*U+I[10]*F+I[14])*k,L},r.transformDirection=function(L,P,I){const N=P[0],U=P[1],F=P[2];return L[0]=I[0]*N+I[4]*U+I[8]*F,L[1]=I[1]*N+I[5]*U+I[9]*F,L[2]=I[2]*N+I[6]*U+I[10]*F,u(L,L)},r.transformMat4Offset=function(L,P,I,N,U,F){const k=P[0+U],j=P[1+U],H=P[2+U],B=1/(I[3+F]*k+I[7+F]*j+I[11+F]*H+I[15+F]||1);return L[0+N]=(I[0+F]*k+I[4+F]*j+I[8+F]*H+I[12+F])*B,L[1+N]=(I[1+F]*k+I[5+F]*j+I[9+F]*H+I[13+F])*B,L[2+N]=(I[2+F]*k+I[6+F]*j+I[10+F]*H+I[14+F])*B,L},r.transformDirectionOffset=function(L,P,I,N,U,F){const k=P[0+U],j=P[1+U],H=P[2+U];L[0+N]=I[0+F]*k+I[4+F]*j+I[8+F]*H,L[1+N]=I[1+F]*k+I[5+F]*j+I[9+F]*H,L[2+N]=I[2+F]*k+I[6+F]*j+I[10+F]*H;const B=Math.hypot(L[0+N],L[1+N],L[2+N]);return B>0&&(L[0+N]/=B,L[1+N]/=B,L[2+N]/=B),L},r.transformMat3=function(L,P,I){const N=P[0],U=P[1],F=P[2];return L[0]=N*I[0]+U*I[3]+F*I[6],L[1]=N*I[1]+U*I[4]+F*I[7],L[2]=N*I[2]+U*I[5]+F*I[8],L},r.transformQuat=function(L,P,I){const N=P[0],U=P[1],F=P[2],k=I[0],j=I[1],H=I[2],B=I[3],V=B*N+j*F-H*U,Y=B*U+H*N-k*F,K=B*F+k*U-j*N,J=-k*N-j*U-H*F;return L[0]=V*B+J*-k+Y*-H-K*-j,L[1]=Y*B+J*-j+K*-k-V*-H,L[2]=K*B+J*-H+V*-j-Y*-k,L},r.angle=b;const _=e(),h=e(),f=e(),E=e(),m=e(),S=e(),w=e();r.dihedralAngle=function(L,P,I,N){s(_,L,P),s(h,I,P),s(f,P,I),s(E,N,I),x(m,_,h),x(S,f,E);const U=b(m,S);return x(w,m,S),g(h,w)>0?U:-U},r.directionFromSpherical=function(L,P,I,N){return r.set(L,N*Math.cos(I)*Math.sin(P),N*Math.sin(I)*Math.sin(P),N*Math.cos(P))},r.exactEquals=function(L,P){return L[0]===P[0]&&L[1]===P[1]&&L[2]===P[2]},r.equals=function(L,P){const I=L[0],N=L[1],U=L[2],F=P[0],k=P[1],j=P[2];return Math.abs(I-F)<=jd*Math.max(1,Math.abs(I),Math.abs(F))&&Math.abs(N-k)<=jd*Math.max(1,Math.abs(N),Math.abs(k))&&Math.abs(U-j)<=jd*Math.max(1,Math.abs(U),Math.abs(j))};const v=e();r.makeRotation=function(L,P,I){const N=b(P,I);if(Math.abs(N)<1e-4)return Qd.setIdentity(L);if(Math.abs(N-Math.PI)<jd)return Qd.fromScaling(L,r.negUnit);const U=x(v,P,I);return Qd.fromRotation(L,N,U)},r.isZero=function(L){return L[0]===0&&L[1]===0&&L[2]===0},r.projectPointOnVector=function(L,P,I,N){return s(L,P,N),i(L,o(L,I,g(I,L)/l(I)),N)};const A=e();function M(L,P,I){return o(L,I,g(I,P)/l(I))}r.projectPointOnPlane=function(L,P,I,N){return u(A,I),s(L,P,N),s(L,P,o(A,A,g(L,A)))},r.projectOnVector=M;const T=e();r.projectOnPlane=function(L,P,I){return M(T,P,I),s(L,P,T)},r.orthogonalize=function(L,P,I){return u(L,x(L,x(L,P,I),P))},r.matchDirection=function(L,P,I){return g(P,I)>0?n(L,P):d(L,n(L,P)),L};const R=e(),O=e();r.triangleNormal=function(L,P,I,N){return s(R,I,P),s(O,N,P),u(L,x(L,R,O))},r.toString=function(L,P){return`[${L[0].toPrecision(P)} ${L[1].toPrecision(P)} ${L[2].toPrecision(P)}]`},r.origin=t(0,0,0),r.unit=t(1,1,1),r.negUnit=t(-1,-1,-1),r.unitX=t(1,0,0),r.unitY=t(0,1,0),r.unitZ=t(0,0,1),r.negUnitX=t(-1,0,0),r.negUnitY=t(0,-1,0),r.negUnitZ=t(0,0,-1)})(Yd||(Yd={}));const Kd=Math.PI/180;function Zd(r){return r*Kd}function Qd(){return Qd.zero()}function Jd(){return Jd.zero()}function tm(){return tm.zero()}function em(){return em.zero()}function im(r){throw new Error("unreachable")}function rm(){return rm.zero()}var nm,sm,om,am;function cm(r,e,t){let n=e,i=0,s=1;for(r.charCodeAt(n)===45?(s=-1,++n):r.charCodeAt(n)===43&&++n;n<t;n++){const o=r.charCodeAt(n)-48;if(o>9||o<0)return s*i|0;i=10*i+o|0}return s*i}function lm(r,e,t,n){return e.charCodeAt(t)===43&&t++,r*Math.pow(10,cm(e,t,n))}function hm(r,e,t){let n=e,i=1,s=0,o=0,a=1;for(r.charCodeAt(n)===45?(i=-1,++n):r.charCodeAt(n)===43&&++n;n<t;){let l=r.charCodeAt(n)-48;if(!(l>=0&&l<10)){if(l===-2){for(++n;n<t;){if(l=r.charCodeAt(n)-48,!(l>=0&&l<10))return l===53||l===21?lm(i*(s+o/a),r,n+1,t):i*(s+o/a);o=10*o+l,a*=10,++n}return i*(s+o/a)}if(l===53||l===21)return lm(i*s,r,n+1,t);break}s=10*s+l,++n}return i*s}function um(r,e,t,n){return{schema:t,__array:void 0,isDefined:n===0,rowCount:e,value:i=>r,valueKind:i=>n,toArray:i=>{const{array:s}=Nd(e,i);for(let o=0,a=s.length;o<a;o++)s[o]=r;return s},areValuesEqual:(i,s)=>!0}}function dm({value:r,valueKind:e,areValuesEqual:t,rowCount:n,schema:i}){return{schema:i,__array:void 0,isDefined:!0,rowCount:n,value:r,valueKind:e||(s=>0),toArray:s=>{const{array:o,start:a}=Nd(n,s);for(let l=0,d=o.length;l<d;l++)o[l]=r(l+a);return o},areValuesEqual:t||((s,o)=>r(s)===r(o))}}function mm({array:r,schema:e,valueKind:t}){const n=r.length,i=e.T,s=e.valueType==="str"?e.transform==="lowercase"?a=>{const l=r[a];return typeof l=="string"?l.toLowerCase():`${l??i}`.toLowerCase()}:e.transform==="uppercase"?a=>{const l=r[a];return typeof l=="string"?l.toUpperCase():`${l??i}`.toUpperCase()}:a=>{const l=r[a];return typeof l=="string"?l:`${l??i}`}:a=>r[a],o=Ud(r);return{schema:e,__array:r,isDefined:!0,rowCount:n,value:s,valueKind:t||(a=>0),toArray:e.valueType==="str"?e.transform==="lowercase"?a=>{const{start:l,end:d}=Ld(n,a),u=new(a&&a.array!==void 0?a.array:r.constructor)(d-l);for(let g=0,x=d-l;g<x;g++){const y=r[l+g];u[g]=typeof y=="string"?y.toLowerCase():`${y??i}`.toLowerCase()}return u}:e.transform==="uppercase"?a=>{const{start:l,end:d}=Ld(n,a),u=new(a&&a.array!==void 0?a.array:r.constructor)(d-l);for(let g=0,x=d-l;g<x;g++){const y=r[l+g];u[g]=typeof y=="string"?y.toUpperCase():`${y??i}`.toUpperCase()}return u}:a=>{const{start:l,end:d}=Ld(n,a),u=new(a&&a.array!==void 0?a.array:r.constructor)(d-l);for(let g=0,x=d-l;g<x;g++){const y=r[l+g];u[g]=typeof y=="string"?y:`${y??i}`}return u}:o?a=>Vd(r,a):a=>{const{start:l,end:d}=Ld(n,a);if(l===0&&d===r.length)return r;const u=new(a&&a.array!==void 0?a.array:r.constructor)(d-l);for(let g=0,x=d-l;g<x;g++)u[g]=r[l+g];return u},areValuesEqual:(a,l)=>r[a]===r[l]}}function fm(r,e,t){return r.isDefined?e===0&&t===r.rowCount?r:r.__array&&Ud(r.__array)?(function(n,i,s){const o=Vd(n.__array,{start:i,end:s}),a=n.valueKind;return mm({array:o,schema:n.schema,valueKind:l=>a(i+l)})})(r,e,t):(function(n,i,s){const o=n.value,a=n.valueKind,l=n.areValuesEqual,d=i===0?o:g=>o(g+i),u=s-i;return{schema:n.schema,__array:void 0,isDefined:n.isDefined,rowCount:u,value:d,valueKind:i===0?a:g=>a(g+i),toArray:g=>{const{array:x}=Nd(u,g);for(let y=0,b=x.length;y<b;y++)x[y]=o(y+i);return x},areValuesEqual:i===0?l:(g,x)=>l(g+i,x+i)}})(r,e,t):sm.Undefined(t-e,r.schema)}function pm(r,e,t){return r.rowCount===0||t&&(function(n,i){if(n.length!==i)return!1;for(let s=0,o=n.length;s<o;s++)if(n[s]!==s)return!1;return!0})(e,r.rowCount)?r:r.__array&&typeof r.value(0)==typeof r.__array[0]?(function(n,i){const s=n.__array,o=new s.constructor(i.length);for(let l=0,d=i.length;l<d;l++)o[l]=s[i[l]];const a=n.valueKind;return mm({array:o,schema:n.schema,valueKind:l=>a(i[l])})})(r,e):(function(n,i){const s=n.value,o=n.valueKind,a=n.areValuesEqual,l=u=>s(i[u]),d=i.length;return{schema:n.schema,__array:void 0,isDefined:n.isDefined,rowCount:d,value:l,valueKind:u=>o(i[u]),toArray:u=>{const{array:g}=Nd(d,u);for(let x=0,y=g.length;x<y;x++)g[x]=s(i[x]);return g},areValuesEqual:(u,g)=>a(i[u],i[g])}})(r,e)}function gm(r,e,t){return r[e]-r[t]}function ym(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}function bm(r,e,t,n){const i=t+n>>1;return e(r,t,n)>0?e(r,t,i)>0?e(r,i,n)>0?i:n:t:e(r,n,i)>0?e(r,i,t)>0?i:t:n}function _m(r,e,t){const{cmp:n,swap:i,data:s,parts:o}=r;let a=e+1,l=t;for(i(s,e,bm(s,n,e,t));n(s,l,e)>0;)--l;for(let d=e+1;d<=l;d++){const u=n(s,d,e);if(u>0){for(i(s,d,l),--l;n(s,l,e)>0;)--l;d--}else u===0&&(i(s,d,a),a++)}for(let d=e;d<a;d++)i(s,d,e+l-d);o[0]=l-a+e+1,o[1]=l}function xm({data:r,cmp:e,swap:t},n,i){for(let s=n+1;s<=i;s++){let o=s-1;for(;o>=n&&e(r,o,o+1)>0;)t(r,o,o+1),o-=1}}function vm(r,e,t){const{parts:n}=r;for(;e<t;){if(t-e<16)return void xm(r,e,t);_m(r,e,t);const i=n[0],s=n[1];i-e<t-s?(vm(r,e,i-1),e=s+1):(vm(r,s+1,t),t=i-1)}}function wm(r,e,t,n){let i=t+1,s=n;ym(r,t,bm(r,gm,t,n));const o=r[t];for(;r[s]>o;)--s;for(let a=t+1;a<=s;a++){const l=r[a];if(l>o){for(ym(r,a,s),--s;r[s]>o;)--s;a--}else l===o&&(ym(r,a,i),++i)}for(let a=t;a<i;a++)ym(r,a,t+s-a);e[0]=s-i+t+1,e[1]=s}function Am(r,e,t){for(let n=e+1;n<=t;n++){const i=r[n];let s=n-1;for(;s>=e&&r[s]>i;)r[s+1]=r[s],s-=1;r[s+1]=i}}function Sm(r,e,t,n){for(;t<n;){if(n-t<16)return void Am(r,t,n);wm(r,e,t,n);const i=e[0],s=e[1];i-t<n-s?(Sm(r,e,t,i-1),t=s+1):(Sm(r,e,s+1,n),n=i-1)}}function Cm(r,e=gm){return(function(t,n,i,s=gm){return s===gm?Sm(t,[0,0],n,i-1):vm({data:t,cmp:s,swap:ym,parts:[0,0]},n,i-1),t})(r,0,r.length,e)}(function(r){function e(){const m=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return m[0]=0,m}function t(){const m=e();return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function n(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function i(m){for(let S=0;S<16;S++)m[S]=0;return m}r.zero=e,r.identity=t,r.setIdentity=n,r.setZero=i,r.ofRows=function(m){const S=e();for(let w=0;w<4;w++){const v=m[w];for(let A=0;A<4;A++)S[4*A+w]=v[A]}return S};const s=t();function o(m,S,w){for(let v=0;v<16;v++)if(Math.abs(m[v]-S[v])>w)return!1;return!0}function a(m,S,w,v){m[4*w+S]=v}function l(m,S){return m[0]=S[0],m[1]=S[1],m[2]=S[2],m[3]=S[3],m[4]=S[4],m[5]=S[5],m[6]=S[6],m[7]=S[7],m[8]=S[8],m[9]=S[9],m[10]=S[10],m[11]=S[11],m[12]=S[12],m[13]=S[13],m[14]=S[14],m[15]=S[15],m}function d(m,S){const w=S[0]+S[5]+S[10];let v=0;return w>0?(v=2*Math.sqrt(w+1),m[3]=.25*v,m[0]=(S[6]-S[9])/v,m[1]=(S[8]-S[2])/v,m[2]=(S[1]-S[4])/v):S[0]>S[5]&&S[0]>S[10]?(v=2*Math.sqrt(1+S[0]-S[5]-S[10]),m[3]=(S[6]-S[9])/v,m[0]=.25*v,m[1]=(S[1]+S[4])/v,m[2]=(S[8]+S[2])/v):S[5]>S[10]?(v=2*Math.sqrt(1+S[5]-S[0]-S[10]),m[3]=(S[8]-S[2])/v,m[0]=(S[1]+S[4])/v,m[1]=.25*v,m[2]=(S[6]+S[9])/v):(v=2*Math.sqrt(1+S[10]-S[0]-S[5]),m[3]=(S[1]-S[4])/v,m[0]=(S[8]+S[2])/v,m[1]=(S[6]+S[9])/v,m[2]=.25*v),m}function u(m,S){const w=S[0],v=S[1],A=S[2],M=S[3],T=S[4],R=S[5],O=S[6],L=S[7],P=S[8],I=S[9],N=S[10],U=S[11],F=S[12],k=S[13],j=S[14],H=S[15],B=w*R-v*T,V=w*O-A*T,Y=w*L-M*T,K=v*O-A*R,J=v*L-M*R,Te=A*L-M*O,He=P*k-I*F,Q=P*j-N*F,Xe=P*H-U*F,ut=I*j-N*k,Ji=I*H-U*k,er=N*H-U*j;let ec=B*er-V*Ji+Y*ut+K*Xe-J*Q+Te*He;return!!ec&&(ec=1/ec,m[0]=(R*er-O*Ji+L*ut)*ec,m[1]=(A*Ji-v*er-M*ut)*ec,m[2]=(k*Te-j*J+H*K)*ec,m[3]=(N*J-I*Te-U*K)*ec,m[4]=(O*Xe-T*er-L*Q)*ec,m[5]=(w*er-A*Xe+M*Q)*ec,m[6]=(j*Y-F*Te-H*V)*ec,m[7]=(P*Te-N*Y+U*V)*ec,m[8]=(T*Ji-R*Xe+L*He)*ec,m[9]=(v*Xe-w*Ji-M*He)*ec,m[10]=(F*J-k*Y+H*B)*ec,m[11]=(I*Y-P*J-U*B)*ec,m[12]=(R*Q-T*ut-O*He)*ec,m[13]=(w*ut-v*Q+A*He)*ec,m[14]=(k*V-F*K-j*B)*ec,m[15]=(P*K-I*V+N*B)*ec,!0)}function g(m,S,w){const v=S[0],A=S[1],M=S[2],T=S[3],R=S[4],O=S[5],L=S[6],P=S[7],I=S[8],N=S[9],U=S[10],F=S[11],k=S[12],j=S[13],H=S[14],B=S[15];let V=w[0],Y=w[1],K=w[2],J=w[3];return m[0]=V*v+Y*R+K*I+J*k,m[1]=V*A+Y*O+K*N+J*j,m[2]=V*M+Y*L+K*U+J*H,m[3]=V*T+Y*P+K*F+J*B,V=w[4],Y=w[5],K=w[6],J=w[7],m[4]=V*v+Y*R+K*I+J*k,m[5]=V*A+Y*O+K*N+J*j,m[6]=V*M+Y*L+K*U+J*H,m[7]=V*T+Y*P+K*F+J*B,V=w[8],Y=w[9],K=w[10],J=w[11],m[8]=V*v+Y*R+K*I+J*k,m[9]=V*A+Y*O+K*N+J*j,m[10]=V*M+Y*L+K*U+J*H,m[11]=V*T+Y*P+K*F+J*B,V=w[12],Y=w[13],K=w[14],J=w[15],m[12]=V*v+Y*R+K*I+J*k,m[13]=V*A+Y*O+K*N+J*j,m[14]=V*M+Y*L+K*U+J*H,m[15]=V*T+Y*P+K*F+J*B,m}function x(m,S,w){let v=w[0],A=w[1],M=w[2],T=Math.sqrt(v*v+A*A+M*M);if(Math.abs(T)<jd)return n(m);T=1/T,v*=T,A*=T,M*=T;const R=Math.sin(S),O=Math.cos(S),L=1-O;return m[0]=v*v*L+O,m[1]=A*v*L+M*R,m[2]=M*v*L-A*R,m[3]=0,m[4]=v*A*L-M*R,m[5]=A*A*L+O,m[6]=M*A*L+v*R,m[7]=0,m[8]=v*M*L+A*R,m[9]=A*M*L-v*R,m[10]=M*M*L+O,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}r.isIdentity=function(m,S){return o(m,s,S===void 0?jd:S)},r.hasNaN=function(m){for(let S=0;S<16;S++)if(isNaN(m[S]))return!0;return!1},r.areEqual=o,r.setValue=a,r.getValue=function(m,S,w){return m[4*w+S]},r.toArray=function(m,S,w){return S[w+0]=m[0],S[w+1]=m[1],S[w+2]=m[2],S[w+3]=m[3],S[w+4]=m[4],S[w+5]=m[5],S[w+6]=m[6],S[w+7]=m[7],S[w+8]=m[8],S[w+9]=m[9],S[w+10]=m[10],S[w+11]=m[11],S[w+12]=m[12],S[w+13]=m[13],S[w+14]=m[14],S[w+15]=m[15],S},r.fromArray=function(m,S,w){return m[0]=S[w+0],m[1]=S[w+1],m[2]=S[w+2],m[3]=S[w+3],m[4]=S[w+4],m[5]=S[w+5],m[6]=S[w+6],m[7]=S[w+7],m[8]=S[w+8],m[9]=S[w+9],m[10]=S[w+10],m[11]=S[w+11],m[12]=S[w+12],m[13]=S[w+13],m[14]=S[w+14],m[15]=S[w+15],m},r.fromBasis=function(m,S,w,v){return i(m),a(m,0,0,S[0]),a(m,1,0,S[1]),a(m,2,0,S[2]),a(m,0,1,w[0]),a(m,1,1,w[1]),a(m,2,1,w[2]),a(m,0,2,v[0]),a(m,1,2,v[1]),a(m,2,2,v[2]),a(m,3,3,1),m},r.copy=l,r.clone=function(m){return l(e(),m)},r.getTranslation=function(m,S){return m[0]=S[12],m[1]=S[13],m[2]=S[14],m},r.getScaling=function(m,S){const w=S[0],v=S[1],A=S[2],M=S[4],T=S[5],R=S[6],O=S[8],L=S[9],P=S[10];return m[0]=Math.sqrt(w*w+v*v+A*A),m[1]=Math.sqrt(M*M+T*T+R*R),m[2]=Math.sqrt(O*O+L*L+P*P),m},r.getRotation=d,r.extractRotation=function(m,S){const w=1/Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]),v=1/Math.sqrt(S[4]*S[4]+S[5]*S[5]+S[6]*S[6]),A=1/Math.sqrt(S[8]*S[8]+S[9]*S[9]+S[10]*S[10]);return m[0]=S[0]*w,m[1]=S[1]*w,m[2]=S[2]*w,m[3]=0,m[4]=S[4]*v,m[5]=S[5]*v,m[6]=S[6]*v,m[7]=0,m[8]=S[8]*A,m[9]=S[9]*A,m[10]=S[10]*A,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.transpose=function(m,S){if(m===S){const w=S[1],v=S[2],A=S[3],M=S[6],T=S[7],R=S[11];m[1]=S[4],m[2]=S[8],m[3]=S[12],m[4]=w,m[6]=S[9],m[7]=S[13],m[8]=v,m[9]=M,m[11]=S[14],m[12]=A,m[13]=T,m[14]=R}else m[0]=S[0],m[1]=S[4],m[2]=S[8],m[3]=S[12],m[4]=S[1],m[5]=S[5],m[6]=S[9],m[7]=S[13],m[8]=S[2],m[9]=S[6],m[10]=S[10],m[11]=S[14],m[12]=S[3],m[13]=S[7],m[14]=S[11],m[15]=S[15];return m},r.tryInvert=u,r.invert=function(m,S){return u(m,S)||console.warn("non-invertible matrix.",S),m},r.mul=g,r.mulOffset=function(m,S,w,v,A,M){const T=S[0+A],R=S[1+A],O=S[2+A],L=S[3+A],P=S[4+A],I=S[5+A],N=S[6+A],U=S[7+A],F=S[8+A],k=S[9+A],j=S[10+A],H=S[11+A],B=S[12+A],V=S[13+A],Y=S[14+A],K=S[15+A];let J=w[0+M],Te=w[1+M],He=w[2+M],Q=w[3+M];return m[0+v]=J*T+Te*P+He*F+Q*B,m[1+v]=J*R+Te*I+He*k+Q*V,m[2+v]=J*O+Te*N+He*j+Q*Y,m[3+v]=J*L+Te*U+He*H+Q*K,J=w[4+M],Te=w[5+M],He=w[6+M],Q=w[7+M],m[4+v]=J*T+Te*P+He*F+Q*B,m[5+v]=J*R+Te*I+He*k+Q*V,m[6+v]=J*O+Te*N+He*j+Q*Y,m[7+v]=J*L+Te*U+He*H+Q*K,J=w[8+M],Te=w[9+M],He=w[10+M],Q=w[11+M],m[8+v]=J*T+Te*P+He*F+Q*B,m[9+v]=J*R+Te*I+He*k+Q*V,m[10+v]=J*O+Te*N+He*j+Q*Y,m[11+v]=J*L+Te*U+He*H+Q*K,J=w[12+M],Te=w[13+M],He=w[14+M],Q=w[15+M],m[12+v]=J*T+Te*P+He*F+Q*B,m[13+v]=J*R+Te*I+He*k+Q*V,m[14+v]=J*O+Te*N+He*j+Q*Y,m[15+v]=J*L+Te*U+He*H+Q*K,m},r.mul3=function(m,S,w,v){return g(m,g(m,S,w),v)},r.translate=function(m,S,w){const v=w[0],A=w[1],M=w[2];let T,R,O,L,P,I,N,U,F,k,j,H;return S===m?(m[12]=S[0]*v+S[4]*A+S[8]*M+S[12],m[13]=S[1]*v+S[5]*A+S[9]*M+S[13],m[14]=S[2]*v+S[6]*A+S[10]*M+S[14],m[15]=S[3]*v+S[7]*A+S[11]*M+S[15]):(T=S[0],R=S[1],O=S[2],L=S[3],P=S[4],I=S[5],N=S[6],U=S[7],F=S[8],k=S[9],j=S[10],H=S[11],m[0]=T,m[1]=R,m[2]=O,m[3]=L,m[4]=P,m[5]=I,m[6]=N,m[7]=U,m[8]=F,m[9]=k,m[10]=j,m[11]=H,m[12]=T*v+P*A+F*M+S[12],m[13]=R*v+I*A+k*M+S[13],m[14]=O*v+N*A+j*M+S[14],m[15]=L*v+U*A+H*M+S[15]),m},r.fromTranslation=function(m,S){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=S[0],m[13]=S[1],m[14]=S[2],m[15]=1,m},r.setTranslation=function(m,S){return m[12]=S[0],m[13]=S[1],m[14]=S[2],m},r.setAxes=function(m,S,w,v){return m[0]=w[0],m[4]=w[1],m[8]=w[2],m[1]=v[0],m[5]=v[1],m[9]=v[2],m[2]=S[0],m[6]=S[1],m[10]=S[2],m},r.rotate=function(m,S,w,v){let A=v[0],M=v[1],T=v[2],R=Math.sqrt(A*A+M*M+T*T);if(Math.abs(R)<jd)return t();R=1/R,A*=R,M*=R,T*=R;const O=Math.sin(w),L=Math.cos(w),P=1-L,I=S[0],N=S[1],U=S[2],F=S[3],k=S[4],j=S[5],H=S[6],B=S[7],V=S[8],Y=S[9],K=S[10],J=S[11],Te=A*A*P+L,He=M*A*P+T*O,Q=T*A*P-M*O,Xe=A*M*P-T*O,ut=M*M*P+L,Ji=T*M*P+A*O,er=A*T*P+M*O,ec=M*T*P-A*O,ai=T*T*P+L;return m[0]=I*Te+k*He+V*Q,m[1]=N*Te+j*He+Y*Q,m[2]=U*Te+H*He+K*Q,m[3]=F*Te+B*He+J*Q,m[4]=I*Xe+k*ut+V*Ji,m[5]=N*Xe+j*ut+Y*Ji,m[6]=U*Xe+H*ut+K*Ji,m[7]=F*Xe+B*ut+J*Ji,m[8]=I*er+k*ec+V*ai,m[9]=N*er+j*ec+Y*ai,m[10]=U*er+H*ec+K*ai,m[11]=F*er+B*ec+J*ai,S!==m&&(m[12]=S[12],m[13]=S[13],m[14]=S[14],m[15]=S[15]),m},r.fromRotation=x,r.scale=function(m,S,w){const v=w[0],A=w[1],M=w[2];return m[0]=S[0]*v,m[1]=S[1]*v,m[2]=S[2]*v,m[3]=S[3]*v,m[4]=S[4]*A,m[5]=S[5]*A,m[6]=S[6]*A,m[7]=S[7]*A,m[8]=S[8]*M,m[9]=S[9]*M,m[10]=S[10]*M,m[11]=S[11]*M,m[12]=S[12],m[13]=S[13],m[14]=S[14],m[15]=S[15],m},r.scaleUniformly=function(m,S,w){return m[0]=S[0]*w,m[1]=S[1]*w,m[2]=S[2]*w,m[3]=S[3]*w,m[4]=S[4]*w,m[5]=S[5]*w,m[6]=S[6]*w,m[7]=S[7]*w,m[8]=S[8]*w,m[9]=S[9]*w,m[10]=S[10]*w,m[11]=S[11]*w,m[12]=S[12],m[13]=S[13],m[14]=S[14],m[15]=S[15],m},r.fromScaling=function(m,S){return m[0]=S[0],m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=S[1],m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=S[2],m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.fromUniformScaling=function(m,S){return m[0]=S,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=S,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=S,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.fromMat3=function(m,S){return m[0]=S[0],m[1]=S[1],m[2]=S[2],m[4]=S[3],m[5]=S[4],m[6]=S[5],m[8]=S[6],m[9]=S[7],m[10]=S[8],m},r.compose=function(m,S,w,v){const[A,M,T,R]=w,O=A+A,L=M+M,P=T+T,I=A*O,N=A*L,U=A*P,F=M*L,k=M*P,j=T*P,H=R*O,B=R*L,V=R*P,[Y,K,J]=v;return m[0]=(1-(F+j))*Y,m[1]=(N+V)*Y,m[2]=(U-B)*Y,m[3]=0,m[4]=(N-V)*K,m[5]=(1-(I+j))*K,m[6]=(k+H)*K,m[7]=0,m[8]=(U+B)*J,m[9]=(k-H)*J,m[10]=(1-(I+F))*J,m[11]=0,m[12]=S[0],m[13]=S[1],m[14]=S[2],m[15]=1,m};const y=[0,0,0],b=e();function _(m){const S=m[0],w=m[1],v=m[2],A=m[3],M=m[4],T=m[5],R=m[6],O=m[7],L=m[8],P=m[9],I=m[10],N=m[11],U=m[12],F=m[13],k=m[14],j=m[15];return(S*T-w*M)*(I*j-N*k)-(S*R-v*M)*(P*j-N*F)+(S*O-A*M)*(P*k-I*F)+(w*R-v*T)*(L*j-N*U)-(w*O-A*T)*(L*k-I*U)+(v*O-A*R)*(L*F-P*U)}r.decompose=function(m,S,w,v){let A=Yd.magnitude(Yd.set(y,m[0],m[1],m[2]));const M=Yd.magnitude(Yd.set(y,m[4],m[5],m[6])),T=Yd.magnitude(Yd.set(y,m[8],m[9],m[10]));_(m)<0&&(A=-A),S[0]=m[12],S[1]=m[13],S[2]=m[14],l(b,m);const R=1/A,O=1/M,L=1/T;return b[0]*=R,b[1]*=R,b[2]*=R,b[4]*=O,b[5]*=O,b[6]*=O,b[8]*=L,b[9]*=L,b[10]*=L,d(w,b),v[0]=A,v[1]=M,v[2]=T,m},r.makeTable=function(m){let S="";for(let w=0;w<4;w++){for(let v=0;v<4;v++)S+=m[4*v+w].toString(),v<3&&(S+=" ");w<3&&(S+=`
`)}return S},r.determinant=_,r.isRotationAndTranslation=function(m,S){return(function(w,v){const A=w[0],M=w[1],T=w[2],R=w[3],O=w[4],L=w[5],P=w[6],I=w[7],N=w[8],U=w[9],F=w[10],k=w[11],j=w[15];return!(!(Gd(j,1,v)&&Gd(R,0,v)&&Gd(I,0,v)&&Gd(k,0,v))||!Gd(Math.abs(A*(L*F-P*U)-M*(O*F-P*N)+T*(O*U-L*N)),1,v))})(m,S!==void 0?S:jd)},r.isTranslationAndUniformScaling=function(m,S){return(function(w,v){const A=w[0];return Gd(w[1],0,v)&&Gd(w[2],0,v)&&Gd(w[3],0,v)&&Gd(w[4],0,v)&&Gd(w[5],A,v)&&Gd(w[6],0,v)&&Gd(w[7],0,v)&&Gd(w[8],0,v)&&Gd(w[9],0,v)&&Gd(w[10],A,v)&&Gd(w[11],0,v)&&Gd(w[15],1,v)})(m,S!==void 0?S:jd)},r.fromQuat=function(m,S){const w=S[0],v=S[1],A=S[2],M=S[3],T=w+w,R=v+v,O=A+A,L=w*T,P=v*T,I=v*R,N=A*T,U=A*R,F=A*O,k=M*T,j=M*R,H=M*O;return m[0]=1-I-F,m[1]=P+H,m[2]=N-j,m[3]=0,m[4]=P-H,m[5]=1-L-F,m[6]=U+k,m[7]=0,m[8]=N+j,m[9]=U-k,m[10]=1-L-I,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.fromEuler=function(m,S,w){const v=S[0],A=S[1],M=S[2],T=Math.cos(v),R=Math.sin(v),O=Math.cos(A),L=Math.sin(A),P=Math.cos(M),I=Math.sin(M);if(w==="XYZ"){const N=T*P,U=T*I,F=R*P,k=R*I;m[0]=O*P,m[4]=-O*I,m[8]=L,m[1]=U+F*L,m[5]=N-k*L,m[9]=-R*O,m[2]=k-N*L,m[6]=F+U*L,m[10]=T*O}else if(w==="YXZ"){const N=O*P,U=O*I,F=L*P,k=L*I;m[0]=N+k*R,m[4]=F*R-U,m[8]=T*L,m[1]=T*I,m[5]=T*P,m[9]=-R,m[2]=U*R-F,m[6]=k+N*R,m[10]=T*O}else if(w==="ZXY"){const N=O*P,U=O*I,F=L*P,k=L*I;m[0]=N-k*R,m[4]=-T*I,m[8]=F+U*R,m[1]=U+F*R,m[5]=T*P,m[9]=k-N*R,m[2]=-T*L,m[6]=R,m[10]=T*O}else if(w==="ZYX"){const N=T*P,U=T*I,F=R*P,k=R*I;m[0]=O*P,m[4]=F*L-U,m[8]=N*L+k,m[1]=O*I,m[5]=k*L+N,m[9]=U*L-F,m[2]=-L,m[6]=R*O,m[10]=T*O}else if(w==="YZX"){const N=T*O,U=T*L,F=R*O,k=R*L;m[0]=O*P,m[4]=k-N*I,m[8]=F*I+U,m[1]=I,m[5]=T*P,m[9]=-R*P,m[2]=-L*P,m[6]=U*I+F,m[10]=N-k*I}else if(w==="XZY"){const N=T*O,U=T*L,F=R*O,k=R*L;m[0]=O*P,m[4]=-I,m[8]=L*P,m[1]=N*I+k,m[5]=T*P,m[9]=U*I-F,m[2]=F*I-U,m[6]=R*P,m[10]=k*I+N}return m[3]=0,m[7]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.perspective=function(m,S,w,v,A,M,T){const R=2*M/(w-S),O=2*M/(v-A),L=(w+S)/(w-S),P=(v+A)/(v-A),I=-(T+M)/(T-M),N=-2*T*M/(T-M);return m[0]=R,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=O,m[6]=0,m[7]=0,m[8]=L,m[9]=P,m[10]=I,m[11]=-1,m[12]=0,m[13]=0,m[14]=N,m[15]=0,m},r.ortho=function(m,S,w,v,A,M,T){const R=1/(w-S),O=1/(v-A),L=1/(T-M),P=(w+S)*R,I=(v+A)*O,N=(T+M)*L;return m[0]=2*R,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=2*O,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=-2*L,m[11]=0,m[12]=-P,m[13]=-I,m[14]=-N,m[15]=1,m},r.lookAt=function(m,S,w,v){let A,M,T,R,O,L,P,I,N,U;const F=S[0],k=S[1],j=S[2],H=v[0],B=v[1],V=v[2],Y=w[0],K=w[1],J=w[2];return Math.abs(F-Y)<jd&&Math.abs(k-K)<jd&&Math.abs(j-J)<jd?n(m):(P=F-Y,I=k-K,N=j-J,U=1/Math.sqrt(P*P+I*I+N*N),P*=U,I*=U,N*=U,A=B*N-V*I,M=V*P-H*N,T=H*I-B*P,U=Math.sqrt(A*A+M*M+T*T),U?(U=1/U,A*=U,M*=U,T*=U):(A=0,M=0,T=0),R=I*T-N*M,O=N*A-P*T,L=P*M-I*A,U=Math.sqrt(R*R+O*O+L*L),U?(U=1/U,R*=U,O*=U,L*=U):(R=0,O=0,L=0),m[0]=A,m[1]=R,m[2]=P,m[3]=0,m[4]=M,m[5]=O,m[6]=I,m[7]=0,m[8]=T,m[9]=L,m[10]=N,m[11]=0,m[12]=-(A*F+M*k+T*j),m[13]=-(R*F+O*k+L*j),m[14]=-(P*F+I*k+N*j),m[15]=1,m)},r.targetTo=function(m,S,w,v){const A=S[0],M=S[1],T=S[2],R=v[0],O=v[1],L=v[2];let P=A-w[0],I=M-w[1],N=T-w[2],U=P*P+I*I+N*N;U>0&&(U=1/Math.sqrt(U),P*=U,I*=U,N*=U);let F=O*N-L*I,k=L*P-R*N,j=R*I-O*P;return U=F*F+k*k+j*j,U>0&&(U=1/Math.sqrt(U),F*=U,k*=U,j*=U),m[0]=F,m[1]=k,m[2]=j,m[3]=0,m[4]=I*j-N*k,m[5]=N*F-P*j,m[6]=P*k-I*F,m[7]=0,m[8]=P,m[9]=I,m[10]=N,m[11]=0,m[12]=A,m[13]=M,m[14]=T,m[15]=1,m},r.fromPermutation=function(m,S){i(m);for(let w=0;w<4;w++)a(m,w,S[w],1);return m},r.getMaxScaleOnAxis=function(m){const S=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],w=m[4]*m[4]+m[5]*m[5]+m[6]*m[6],v=m[8]*m[8]+m[9]*m[9]+m[10]*m[10];return Math.sqrt(Math.max(S,w,v))};const h=[1,0,0],f=[0,1,0],E=[0,0,1];r.rotX90=x(e(),Zd(90),h),r.rotX180=x(e(),Zd(180),h),r.rotY90=x(e(),Zd(90),f),r.rotY180=x(e(),Zd(180),f),r.rotY270=x(e(),Zd(270),f),r.rotZ90=x(e(),Zd(90),E),r.rotZ180=x(e(),Zd(180),E),r.rotXY90=g(e(),r.rotX90,r.rotY90),r.rotZY90=g(e(),r.rotZ90,r.rotY90),r.rotZYZ90=g(e(),r.rotZY90,r.rotZ90),r.rotZ90X180=g(e(),r.rotZ90,r.rotX180),r.rotY90Z180=g(e(),r.rotY90,r.rotZ180),r.id=t()})(Qd||(Qd={})),(function(r){function e(){const v=[.1,0,0,0,0,0,0,0,0];return v[0]=0,v}function t(){const v=e();return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=1,v[5]=0,v[6]=0,v[7]=0,v[8]=1,v}function n(v,A){return v[0]=A[0],v[1]=A[1],v[2]=A[2],v[3]=A[4],v[4]=A[5],v[5]=A[6],v[6]=A[8],v[7]=A[9],v[8]=A[10],v}r.zero=e,r.identity=t,r.setIdentity=function(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=1,v[5]=0,v[6]=0,v[7]=0,v[8]=1,v},r.toArray=function(v,A,M){return A[M+0]=v[0],A[M+1]=v[1],A[M+2]=v[2],A[M+3]=v[3],A[M+4]=v[4],A[M+5]=v[5],A[M+6]=v[6],A[M+7]=v[7],A[M+8]=v[8],A},r.fromArray=function(v,A,M){return v[0]=A[M+0],v[1]=A[M+1],v[2]=A[M+2],v[3]=A[M+3],v[4]=A[M+4],v[5]=A[M+5],v[6]=A[M+6],v[7]=A[M+7],v[8]=A[M+8],v},r.fromColumns=function(v,A,M,T){return v[0]=A[0],v[1]=A[1],v[2]=A[2],v[3]=M[0],v[4]=M[1],v[5]=M[2],v[6]=T[0],v[7]=T[1],v[8]=T[2],v},r.fromMat4=n;const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];r.fromEuler=function(v,A,M){return Qd.fromEuler(i,A,M),n(v,i)},r.create=function(v,A,M,T,R,O,L,P,I){const N=e();return N[0]=v,N[1]=A,N[2]=M,N[3]=T,N[4]=R,N[5]=O,N[6]=L,N[7]=P,N[8]=I,N};const s=t();function o(v,A,M){for(let T=0;T<9;T++)if(Math.abs(v[T]-A[T])>M)return!1;return!0}function a(v,A){return v[0]=A[0],v[1]=A[1],v[2]=A[2],v[3]=A[3],v[4]=A[4],v[5]=A[5],v[6]=A[6],v[7]=A[7],v[8]=A[8],v}function l(v,A){if(v===A){const M=A[1],T=A[2],R=A[5];v[1]=A[3],v[2]=A[6],v[3]=M,v[5]=A[7],v[6]=T,v[7]=R}else v[0]=A[0],v[1]=A[3],v[2]=A[6],v[3]=A[1],v[4]=A[4],v[5]=A[7],v[6]=A[2],v[7]=A[5],v[8]=A[8];return v}function d(v,A){const M=A[0],T=A[1],R=A[2],O=A[3],L=A[4],P=A[5],I=A[6],N=A[7],U=A[8],F=U*L-P*N,k=-U*O+P*I,j=N*O-L*I;let H=M*F+T*k+R*j;return H?(H=1/H,v[0]=F*H,v[1]=(-U*T+R*N)*H,v[2]=(P*T-R*L)*H,v[3]=k*H,v[4]=(U*M-R*I)*H,v[5]=(-P*M+R*O)*H,v[6]=j*H,v[7]=(-N*M+T*I)*H,v[8]=(L*M-T*O)*H,v):(console.warn("non-invertible matrix.",A),v)}function u(v){const A=v[0],M=v[1],T=v[2],R=v[3],O=v[4],L=v[5],P=v[6],I=v[7],N=v[8];return A*(N*O-L*I)+M*(-N*R+L*P)+T*(I*R-O*P)}function g(v){return v[0]+v[4]+v[8]}function x(v,A,M){return v[0]=A[0]-M[0],v[1]=A[1]-M[1],v[2]=A[2]-M[2],v[3]=A[3]-M[3],v[4]=A[4]-M[4],v[5]=A[5]-M[5],v[6]=A[6]-M[6],v[7]=A[7]-M[7],v[8]=A[8]-M[8],v}function y(v,A,M){return v[0]=A[0]*M,v[1]=A[1]*M,v[2]=A[2]*M,v[3]=A[3]*M,v[4]=A[4]*M,v[5]=A[5]*M,v[6]=A[6]*M,v[7]=A[7]*M,v[8]=A[8]*M,v}r.isIdentity=function(v,A){return o(v,s,A===void 0?jd:A)},r.hasNaN=function(v){for(let A=0;A<9;A++)if(isNaN(v[A]))return!0;return!1},r.clone=function(v){return a(e(),v)},r.areEqual=o,r.setValue=function(v,A,M,T){v[3*M+A]=T},r.getValue=function(v,A,M){return v[3*M+A]},r.copy=a,r.transpose=l,r.invert=d,r.symmtricFromUpper=function(v,A){return v===A?(v[3]=A[1],v[6]=A[2],v[7]=A[5]):(v[0]=A[0],v[1]=A[1],v[2]=A[2],v[3]=A[1],v[4]=A[4],v[5]=A[5],v[6]=A[2],v[7]=A[5],v[8]=A[8]),v},r.symmtricFromLower=function(v,A){return v===A?(v[1]=A[3],v[2]=A[6],v[5]=A[7]):(v[0]=A[0],v[1]=A[3],v[2]=A[6],v[3]=A[3],v[4]=A[4],v[5]=A[7],v[6]=A[6],v[7]=A[7],v[8]=A[8]),v},r.determinant=u,r.trace=g,r.sub=x,r.add=function(v,A,M){return v[0]=A[0]+M[0],v[1]=A[1]+M[1],v[2]=A[2]+M[2],v[3]=A[3]+M[3],v[4]=A[4]+M[4],v[5]=A[5]+M[5],v[6]=A[6]+M[6],v[7]=A[7]+M[7],v[8]=A[8]+M[8],v},r.mul=function(v,A,M){const T=A[0],R=A[1],O=A[2],L=A[3],P=A[4],I=A[5],N=A[6],U=A[7],F=A[8],k=M[0],j=M[1],H=M[2],B=M[3],V=M[4],Y=M[5],K=M[6],J=M[7],Te=M[8];return v[0]=k*T+j*L+H*N,v[1]=k*R+j*P+H*U,v[2]=k*O+j*I+H*F,v[3]=B*T+V*L+Y*N,v[4]=B*R+V*P+Y*U,v[5]=B*O+V*I+Y*F,v[6]=K*T+J*L+Te*N,v[7]=K*R+J*P+Te*U,v[8]=K*O+J*I+Te*F,v},r.subScalar=function(v,A,M){return v[0]=A[0]-M,v[1]=A[1]-M,v[2]=A[2]-M,v[3]=A[3]-M,v[4]=A[4]-M,v[5]=A[5]-M,v[6]=A[6]-M,v[7]=A[7]-M,v[8]=A[8]-M,v},r.addScalar=function(v,A,M){return v[0]=A[0]+M,v[1]=A[1]+M,v[2]=A[2]+M,v[3]=A[3]+M,v[4]=A[4]+M,v[5]=A[5]+M,v[6]=A[6]+M,v[7]=A[7]+M,v[8]=A[8]+M,v},r.mulScalar=y;const b=Math.PI/3,_=e();r.symmetricEigenvalues=function(v,A){const M=A[1]*A[1]+A[2]*A[2]+A[5]*A[5];if(M===0)v[0]=A[0],v[1]=A[4],v[2]=A[8];else{const T=g(A)/3,R=A[0]-T,O=A[4]-T,L=A[8]-T,P=R*R+O*O+L*L+2*M,I=Math.sqrt(P/6);y(_,r.Identity,T),x(_,A,_),y(_,_,1/I);const N=u(_)/2,U=N<=-1?b:N>=1?0:Math.acos(N)/3;v[0]=T+2*I*Math.cos(U),v[2]=T+2*I*Math.cos(U+2*b),v[1]=3*T-v[0]-v[2]}return v};const h=[.1,0,0],f=[.1,0,0],E=[.1,0,0],m=[.1,0,0],S=[.1,0,0],w=[.1,0,0];r.eigenvector=function(v,A,M){Yd.set(h,A[0]-M,A[1],A[2]),Yd.set(f,A[1],A[4]-M,A[5]),Yd.set(E,A[2],A[5],A[8]-M),Yd.cross(m,h,f),Yd.cross(S,h,E),Yd.cross(w,f,E);const T=Yd.dot(m,m),R=Yd.dot(S,S),O=Yd.dot(w,w);let L=T,P=0;return R>L&&(L=R,P=1),O>L&&(P=2),P===0?Yd.scale(v,m,1/Math.sqrt(T)):P===1?Yd.scale(v,S,1/Math.sqrt(R)):Yd.scale(v,w,1/Math.sqrt(O)),v},r.directionTransform=function(v,A){return n(v,A),d(v,v),l(v,v),v},r.Identity=t(),r.innerProduct=function(v,A){return v[0]*A[0]+v[1]*A[1]+v[2]*A[2]+v[3]*A[3]+v[4]*A[4]+v[5]*A[5]+v[6]*A[6]+v[7]*A[7]+v[8]*A[8]}})(Jd||(Jd={})),(function(r){function e(){const t=[.1,0];return t[0]=0,t}r.zero=e,r.clone=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n},r.create=function(t,n){const i=e();return i[0]=t,i[1]=n,i},r.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])},r.toArray=function(t,n,i){return n[i+0]=t[0],n[i+1]=t[1],n},r.fromArray=function(t,n,i){return t[0]=n[i+0],t[1]=n[i+1],t},r.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t},r.set=function(t,n,i){return t[0]=n,t[1]=i,t},r.add=function(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t},r.sub=function(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t},r.mul=function(t,n,i){return t[0]=n[0]*i[0],t[1]=n[1]*i[1],t},r.div=function(t,n,i){return t[0]=n[0]/i[0],t[1]=n[1]/i[1],t},r.scale=function(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t},r.round=function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t},r.ceil=function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t},r.floor=function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t},r.distance=function(t,n){const i=n[0]-t[0],s=n[1]-t[1];return Math.sqrt(i*i+s*s)},r.squaredDistance=function(t,n){const i=n[0]-t[0],s=n[1]-t[1];return i*i+s*s},r.magnitude=function(t){const n=t[0],i=t[1];return Math.sqrt(n*n+i*i)},r.squaredMagnitude=function(t){const n=t[0],i=t[1];return n*n+i*i},r.inverse=function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t},r.areEqual=function(t,n){return t[0]===n[0]&&t[1]===n[1]},r.toString=function(t,n){return`[${t[0].toPrecision(n)} ${t[1].toPrecision(n)}}]`}})(tm||(tm={})),(function(r){function e(){const n=[.1,0,0,0];return n[0]=0,n}function t(n,i){return n[0]=i.center[0],n[1]=i.center[1],n[2]=i.center[2],n[3]=i.radius,n}r.zero=e,r.clone=function(n){const i=e();return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},r.create=function(n,i,s,o){const a=e();return a[0]=n,a[1]=i,a[2]=s,a[3]=o,a},r.fromSphere=t,r.ofSphere=function(n){return t(e(),n)},r.hasNaN=function(n){return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])},r.toArray=function(n,i,s){return i[s+0]=n[0],i[s+1]=n[1],i[s+2]=n[2],i[s+3]=n[3],i},r.fromArray=function(n,i,s){return n[0]=i[s+0],n[1]=i[s+1],n[2]=i[s+2],n[3]=i[s+3],n},r.toVec3Array=function(n,i,s){i[s+0]=n[0],i[s+1]=n[1],i[s+2]=n[2]},r.fromVec3Array=function(n,i,s){return n[0]=i[s+0],n[1]=i[s+1],n[2]=i[s+2],n[3]=0,n},r.copy=function(n,i){return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},r.set=function(n,i,s,o,a){return n[0]=i,n[1]=s,n[2]=o,n[3]=a,n},r.add=function(n,i,s){return n[0]=i[0]+s[0],n[1]=i[1]+s[1],n[2]=i[2]+s[2],n[3]=i[3]+s[3],n},r.distance=function(n,i){const s=i[0]-n[0],o=i[1]-n[1],a=i[2]-n[2],l=i[3]-n[3];return Math.sqrt(s*s+o*o+a*a+l*l)},r.scale=function(n,i,s){return n[0]=i[0]*s,n[1]=i[1]*s,n[2]=i[2]*s,n[4]=i[4]*s,n},r.round=function(n,i){return n[0]=Math.round(i[0]),n[1]=Math.round(i[1]),n[2]=Math.round(i[2]),n[3]=Math.round(i[3]),n},r.ceil=function(n,i){return n[0]=Math.ceil(i[0]),n[1]=Math.ceil(i[1]),n[2]=Math.ceil(i[2]),n[3]=Math.ceil(i[3]),n},r.floor=function(n,i){return n[0]=Math.floor(i[0]),n[1]=Math.floor(i[1]),n[2]=Math.floor(i[2]),n[3]=Math.floor(i[3]),n},r.squaredDistance=function(n,i){const s=i[0]-n[0],o=i[1]-n[1],a=i[2]-n[2],l=i[3]-n[3];return s*s+o*o+a*a+l*l},r.norm=function(n){const i=n[0],s=n[1],o=n[2],a=n[3];return Math.sqrt(i*i+s*s+o*o+a*a)},r.squaredNorm=function(n){const i=n[0],s=n[1],o=n[2],a=n[3];return i*i+s*s+o*o+a*a},r.transformMat4=function(n,i,s){const o=i[0],a=i[1],l=i[2],d=i[3];return n[0]=s[0]*o+s[4]*a+s[8]*l+s[12]*d,n[1]=s[1]*o+s[5]*a+s[9]*l+s[13]*d,n[2]=s[2]*o+s[6]*a+s[10]*l+s[14]*d,n[3]=s[3]*o+s[7]*a+s[11]*l+s[15]*d,n},r.dot=function(n,i){return n[0]*i[0]+n[1]*i[1]+n[2]*i[2]+n[3]*i[3]},r.inverse=function(n,i){return n[0]=1/i[0],n[1]=1/i[1],n[2]=1/i[2],n[3]=1/i[3],n},r.exactEquals=function(n,i){return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]&&n[3]===i[3]},r.equals=function(n,i){const s=n[0],o=n[1],a=n[2],l=n[3],d=i[0],u=i[1],g=i[2],x=i[3];return Math.abs(s-d)<=jd*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-u)<=jd*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(a-g)<=jd*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-x)<=jd*Math.max(1,Math.abs(l),Math.abs(x))},r.toString=function(n,i){return`[${n[0].toPrecision(i)} ${n[1].toPrecision(i)} ${n[2].toPrecision(i)}  ${n[3].toPrecision(i)}]`}})(em||(em={})),(function(r){function e(){const b=[.1,0,0,0];return b[0]=0,b}function t(){const b=e();return b[3]=1,b}function n(b,_,h){h*=.5;const f=Math.sin(h);return b[0]=f*_[0],b[1]=f*_[1],b[2]=f*_[2],b[3]=Math.cos(h),b}function i(b,_,h,f){const E=_[0],m=_[1],S=_[2],w=_[3];let v,A,M,T,R,O=h[0],L=h[1],P=h[2],I=h[3];return A=E*O+m*L+S*P+w*I,A<0&&(A=-A,O=-O,L=-L,P=-P,I=-I),1-A>1e-6?(v=Math.acos(A),M=Math.sin(v),T=Math.sin((1-f)*v)/M,R=Math.sin(f*v)/M):(T=1-f,R=f),b[0]=T*E+R*O,b[1]=T*m+R*L,b[2]=T*S+R*P,b[3]=T*w+R*I,b}function s(b,_){const h=_[0]+_[4]+_[8];let f;if(h>0)f=Math.sqrt(h+1),b[3]=.5*f,f=.5/f,b[0]=(_[5]-_[7])*f,b[1]=(_[6]-_[2])*f,b[2]=(_[1]-_[3])*f;else{let E=0;_[4]>_[0]&&(E=1),_[8]>_[3*E+E]&&(E=2);const m=(E+1)%3,S=(E+2)%3;f=Math.sqrt(_[3*E+E]-_[3*m+m]-_[3*S+S]+1),b[E]=.5*f,f=.5/f,b[3]=(_[3*m+S]-_[3*S+m])*f,b[m]=(_[3*m+E]+_[3*E+m])*f,b[S]=(_[3*S+E]+_[3*E+S])*f}return b}r.zero=e,r.identity=t,r.setIdentity=function(b){b[0]=0,b[1]=0,b[2]=0,b[3]=1},r.hasNaN=function(b){return isNaN(b[0])||isNaN(b[1])||isNaN(b[2])||isNaN(b[3])},r.create=function(b,_,h,f){const E=t();return E[0]=b,E[1]=_,E[2]=h,E[3]=f,E},r.setAxisAngle=n,r.getAxisAngle=function(b,_){const h=2*Math.acos(_[3]),f=Math.sin(h/2);return f!==0?(b[0]=_[0]/f,b[1]=_[1]/f,b[2]=_[2]/f):(b[0]=1,b[1]=0,b[2]=0),h},r.multiply=function(b,_,h){const f=_[0],E=_[1],m=_[2],S=_[3],w=h[0],v=h[1],A=h[2],M=h[3];return b[0]=f*M+S*w+E*A-m*v,b[1]=E*M+S*v+m*w-f*A,b[2]=m*M+S*A+f*v-E*w,b[3]=S*M-f*w-E*v-m*A,b},r.rotateX=function(b,_,h){h*=.5;const f=_[0],E=_[1],m=_[2],S=_[3],w=Math.sin(h),v=Math.cos(h);return b[0]=f*v+S*w,b[1]=E*v+m*w,b[2]=m*v-E*w,b[3]=S*v-f*w,b},r.rotateY=function(b,_,h){h*=.5;const f=_[0],E=_[1],m=_[2],S=_[3],w=Math.sin(h),v=Math.cos(h);return b[0]=f*v-m*w,b[1]=E*v+S*w,b[2]=m*v+f*w,b[3]=S*v-E*w,b},r.rotateZ=function(b,_,h){h*=.5;const f=_[0],E=_[1],m=_[2],S=_[3],w=Math.sin(h),v=Math.cos(h);return b[0]=f*v+E*w,b[1]=E*v-f*w,b[2]=m*v+S*w,b[3]=S*v-m*w,b},r.calculateW=function(b,_){const h=_[0],f=_[1],E=_[2];return b[0]=h,b[1]=f,b[2]=E,b[3]=Math.sqrt(Math.abs(1-h*h-f*f-E*E)),b},r.slerp=i,r.invert=function(b,_){const h=_[0],f=_[1],E=_[2],m=_[3],S=h*h+f*f+E*E+m*m,w=S?1/S:0;return b[0]=-h*w,b[1]=-f*w,b[2]=-E*w,b[3]=m*w,b},r.conjugate=function(b,_){return b[0]=-_[0],b[1]=-_[1],b[2]=-_[2],b[3]=_[3],b},r.dot=function(b,_){return b[0]*_[0]+b[1]*_[1]+b[2]*_[2]+b[3]*_[3]},r.fromMat3=s,r.fromEuler=function(b,_,h){const[f,E,m]=_,S=Math.cos(f/2),w=Math.cos(E/2),v=Math.cos(m/2),A=Math.sin(f/2),M=Math.sin(E/2),T=Math.sin(m/2);switch(h){case"XYZ":b[0]=A*w*v+S*M*T,b[1]=S*M*v-A*w*T,b[2]=S*w*T+A*M*v,b[3]=S*w*v-A*M*T;break;case"YXZ":b[0]=A*w*v+S*M*T,b[1]=S*M*v-A*w*T,b[2]=S*w*T-A*M*v,b[3]=S*w*v+A*M*T;break;case"ZXY":b[0]=A*w*v-S*M*T,b[1]=S*M*v+A*w*T,b[2]=S*w*T+A*M*v,b[3]=S*w*v-A*M*T;break;case"ZYX":b[0]=A*w*v-S*M*T,b[1]=S*M*v+A*w*T,b[2]=S*w*T-A*M*v,b[3]=S*w*v+A*M*T;break;case"YZX":b[0]=A*w*v+S*M*T,b[1]=S*M*v+A*w*T,b[2]=S*w*T-A*M*v,b[3]=S*w*v-A*M*T;break;case"XZY":b[0]=A*w*v-S*M*T,b[1]=S*M*v-A*w*T,b[2]=S*w*T+A*M*v,b[3]=S*w*v+A*M*T;break;default:im()}return b};const o=[0,0,0];function a(b,_){const h=_[0],f=_[1],E=_[2],m=_[3];let S=h*h+f*f+E*E+m*m;return S>0&&(S=1/Math.sqrt(S),b[0]=h*S,b[1]=f*S,b[2]=E*S,b[3]=m*S),b}r.fromUnitVec3=function(b,_,h){let f=Yd.dot(_,h)+1;return f<jd?(f=0,Math.abs(_[0])>Math.abs(_[2])?Yd.set(o,-_[1],_[0],0):Yd.set(o,0,-_[2],_[1])):Yd.cross(o,_,h),b[0]=o[0],b[1]=o[1],b[2]=o[2],b[3]=f,a(b,b),b},r.clone=function(b){const _=e();return _[0]=b[0],_[1]=b[1],_[2]=b[2],_[3]=b[3],_},r.toArray=function(b,_,h){return _[h+0]=b[0],_[h+1]=b[1],_[h+2]=b[2],_[h+3]=b[3],_},r.fromArray=function(b,_,h){return b[0]=_[h+0],b[1]=_[h+1],b[2]=_[h+2],b[3]=_[h+3],b},r.copy=function(b,_){return b[0]=_[0],b[1]=_[1],b[2]=_[2],b[3]=_[3],b},r.set=function(b,_,h,f,E){return b[0]=_,b[1]=h,b[2]=f,b[3]=E,b},r.exactEquals=function(b,_){return b[0]===_[0]&&b[1]===_[1]&&b[2]===_[2]&&b[3]===_[3]},r.equals=function(b,_){const h=b[0],f=b[1],E=b[2],m=b[3],S=_[0],w=_[1],v=_[2],A=_[3];return Math.abs(h-S)<=jd*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(f-w)<=jd*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(E-v)<=jd*Math.max(1,Math.abs(E),Math.abs(v))&&Math.abs(m-A)<=jd*Math.max(1,Math.abs(m),Math.abs(A))},r.add=function(b,_,h){return b[0]=_[0]+h[0],b[1]=_[1]+h[1],b[2]=_[2]+h[2],b[3]=_[3]+h[3],b},r.normalize=a;const l=[0,0,0],d=[1,0,0],u=[0,1,0];r.rotationTo=function(b,_,h){const f=Yd.dot(_,h);return f<-.999999?(Yd.cross(l,d,_),Yd.magnitude(l)<1e-6&&Yd.cross(l,u,_),Yd.normalize(l,l),n(b,l,Math.PI),b):f>.999999?(b[0]=0,b[1]=0,b[2]=0,b[3]=1,b):(Yd.cross(l,_,h),b[0]=l[0],b[1]=l[1],b[2]=l[2],b[3]=1+f,a(b,b))};const g=e(),x=e();r.sqlerp=function(b,_,h,f,E,m){return i(g,_,E,m),i(x,h,f,m),i(b,g,x,2*m*(1-m)),b};const y=[0,0,0,0,0,0,0,0,0];r.setAxes=function(b,_,h,f){return y[0]=h[0],y[3]=h[1],y[6]=h[2],y[1]=f[0],y[4]=f[1],y[7]=f[2],y[2]=-_[0],y[5]=-_[1],y[8]=-_[2],a(b,s(b,y))},r.toString=function(b,_){return`[${b[0].toPrecision(_)} ${b[1].toPrecision(_)} ${b[2].toPrecision(_)}  ${b[3].toPrecision(_)}]`},r.Identity=t()})(rm||(rm={})),(function(r){function e(o,a,l){const d=(function(_,h,f){const E=[];for(let S=0;S<h.length;S++)E[S]=h[h.length-S-1];const m=[1];for(let S=1;S<_.length;S++)m[S]=_[E[S-1]];return{dimensions:_,axisOrderFastToSlow:E,axisOrderSlowToFast:h,accessDimensions:m,defaultCtor:f||Float64Array}})(o,a,l),{get:u,set:g,add:x,dataOffset:y,getCoords:b}=t(d);return{rank:o.length,dimensions:o,axisOrderSlowToFast:a,create:n(d),get:u,set:g,add:x,dataOffset:y,getCoords:b}}function t(o){const{dimensions:a,axisOrderFastToSlow:l}=o;switch(a.length){case 1:return{get:(d,u)=>d[u],set:(d,u,g)=>d[u]=g,add:(d,u,g)=>d[u]+=g,dataOffset:d=>d,getCoords:(d,u)=>(u[0]=d,u)};case 2:if(l[0]===0&&l[1]===1){const d=a[0];return{get:(u,g,x)=>u[x*d+g],set:(u,g,x,y)=>u[x*d+g]=y,add:(u,g,x,y)=>u[x*d+g]+=y,dataOffset:(u,g)=>g*d+u,getCoords:(u,g)=>(g[0]=u%d,g[1]=Math.floor(u/d),g)}}if(l[0]===1&&l[1]===0){const d=a[1];return{get:(u,g,x)=>u[g*d+x],set:(u,g,x,y)=>u[g*d+x]=y,add:(u,g,x,y)=>u[g*d+x]+=y,dataOffset:(u,g)=>u*d+g,getCoords:(u,g)=>(g[0]=Math.floor(u/d),g[1]=u%d,g)}}throw new Error("bad axis order");case 3:if(l[0]===0&&l[1]===1&&l[2]===2){const d=a[0],u=a[1],g=d*u;return{get:(x,y,b,_)=>x[y+b*d+_*g],set:(x,y,b,_,h)=>x[y+b*d+_*g]=h,add:(x,y,b,_,h)=>x[y+b*d+_*g]+=h,dataOffset:(x,y,b)=>x+y*d+b*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=x%d,y[1]=b%u,y[2]=Math.floor(b/u),y}}}if(l[0]===0&&l[1]===2&&l[2]===1){const d=a[0],u=a[2],g=d*u;return{get:(x,y,b,_)=>x[y+_*d+b*g],set:(x,y,b,_,h)=>x[y+_*d+b*g]=h,add:(x,y,b,_,h)=>x[y+_*d+b*g]+=h,dataOffset:(x,y,b)=>x+b*d+y*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=x%d,y[1]=Math.floor(b/u),y[2]=b%u,y}}}if(l[0]===1&&l[1]===0&&l[2]===2){const d=a[1],u=a[0],g=d*u;return{get:(x,y,b,_)=>x[b+y*d+_*g],set:(x,y,b,_,h)=>x[b+y*d+_*g]=h,add:(x,y,b,_,h)=>x[b+y*d+_*g]+=h,dataOffset:(x,y,b)=>y+x*d+b*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=b%u,y[1]=x%d,y[2]=Math.floor(b/u),y}}}if(l[0]===1&&l[1]===2&&l[2]===0){const d=a[1],u=a[2],g=d*u;return{get:(x,y,b,_)=>x[b+_*d+y*g],set:(x,y,b,_,h)=>x[b+_*d+y*g]=h,add:(x,y,b,_,h)=>x[b+_*d+y*g]+=h,dataOffset:(x,y,b)=>y+b*d+x*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=Math.floor(b/u),y[1]=x%d,y[2]=b%u,y}}}if(l[0]===2&&l[1]===0&&l[2]===1){const d=a[2],u=a[0],g=d*u;return{get:(x,y,b,_)=>x[_+y*d+b*g],set:(x,y,b,_,h)=>x[_+y*d+b*g]=h,add:(x,y,b,_,h)=>x[_+y*d+b*g]+=h,dataOffset:(x,y,b)=>b+x*d+y*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=b%u,y[1]=Math.floor(b/u),y[2]=x%d,y}}}if(l[0]===2&&l[1]===1&&l[2]===0){const d=a[2],u=a[1],g=d*u;return{get:(x,y,b,_)=>x[_+b*d+y*g],set:(x,y,b,_,h)=>x[_+b*d+y*g]=h,add:(x,y,b,_,h)=>x[_+b*d+y*g]+=h,dataOffset:(x,y,b)=>b+y*d+x*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=Math.floor(b/u),y[1]=b%u,y[2]=x%d,y}}}throw new Error("bad axis order");default:return{get:(d,...u)=>d[i(o,u)],set:(d,...u)=>d[i(o,u)]=u[u.length-1],add:(d,...u)=>d[i(o,u)]+=u[u.length-1],dataOffset:(...d)=>i(o,d),getCoords:(d,u)=>(function(g,x,y){const{dimensions:b,axisOrderFastToSlow:_}=g,h=b.length;let f=x;for(let E=0;E<h;E++){const m=b[_[E]];y[_[E]]=f%m,f=Math.floor(f/m)}return y[_[h+1]]=f,y})(o,d,u)}}}function n(o){const{dimensions:a}=o;let l=1;for(let d=0,u=a.length;d<u;d++)l*=a[d];return d=>new(d||o.defaultCtor)(l)}function i(o,a){const{accessDimensions:l,axisOrderFastToSlow:d}=o,u=l.length-1;let g=l[u]*a[d[u]];for(let x=u-1;x>=0;x--)g=(g+a[d[x]])*l[x];return g}function s(o,a){const l=[];for(let d=0;d<o.length;d++)l[d]=o[a[d]];return l}r.create=function(o,a){return{space:o,data:a}},r.Space=e,r.Data1=function(o){return o},r.Vector=function(o,a){return e([o],[0],a)},r.ColumnMajorMatrix=function(o,a,l){return e([o,a],[1,0],l)},r.RowMajorMatrix=function(o,a,l){return e([o,a],[0,1],l)},r.toMat4=function(o,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const d=Math.min(4,a.dimensions[0]),u=Math.min(4,a.dimensions[1]);for(let g=0;g<d;g++)for(let x=0;x<u;x++)Qd.setValue(o,g,x,a.get(l,g,x));return o},r.toMat3=function(o,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const d=Math.min(3,a.dimensions[0]),u=Math.min(3,a.dimensions[1]);for(let g=0;g<d;g++)for(let x=0;x<u;x++)Jd.setValue(o,g,x,a.get(l,g,x));return o},r.toVec3=function(o,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const d=Math.min(3,a.dimensions[0]);for(let u=0;u<d;u++)o[u]=l[u];return o},r.toVec4=function(o,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const d=Math.min(4,a.dimensions[0]);for(let u=0;u<d;u++)o[u]=l[u];return o},r.areEqualExact=function(o,a){const l=o.length;if(l!==a.length)return!1;for(let d=0;d<l;d++)if(o[d]!==a[d])return!1;return!0},r.invertAxisOrder=function(o){const a=[];for(let l=0;l<o.length;l++)a[l]=o[o.length-l-1];return a},r.convertToCanonicalAxisIndicesFastToSlow=function(o){const a=new Int32Array(o.length);for(let l=0;l<o.length;l++)a[o[l]]=l;return l=>s(l,a)},r.convertToCanonicalAxisIndicesSlowToFast=function(o){const a=new Int32Array(o.length);for(let l=0;l<o.length;l++)a[o[o.length-l-1]]=l;return l=>s(l,a)}})(nm||(nm={})),(function(r){let e;function t(i,s){return um(s.T,i,s,1)}function n(i){return dm(i)}(function(i){function s(o,a=i.float){return{"@type":"tensor",T:o.create(),space:o,valueType:"tensor",baseType:a}}i.str={"@type":"str",T:"",valueType:"str"},i.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},i.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},i.int={"@type":"int",T:0,valueType:"int"},i.coord={"@type":"coord",T:0,valueType:"float"},i.float={"@type":"float",T:0,valueType:"float"},i.Str=function(o){var a;return{"@type":"str",T:(a=o?.defaultValue)!==null&&a!==void 0?a:"",transform:o?.transform,valueType:"str"}},i.Int=function(o=0){return{"@type":"int",T:o,valueType:"int"}},i.Float=function(o=0){return{"@type":"float",T:o,valueType:"float"}},i.Tensor=s,i.Vector=function(o,a=i.float){return s(nm.Vector(o,a["@type"]==="int"?Int32Array:Float64Array),a)},i.Matrix=function(o,a,l=i.float){return s(nm.ColumnMajorMatrix(o,a,l["@type"]==="int"?Int32Array:Float64Array),l)},i.Aliased=function(o){return o},i.List=function(o,a,l=[]){return{"@type":"list",T:l,separator:o,itemParse:a,valueType:"list"}}})(e=r.Schema||(r.Schema={})),r.is=function(i){return!!i&&!!i.schema&&!!i.value},r.ValueKind={Present:0,NotPresent:1,Unknown:2},r.Undefined=t,r.ofConst=function(i,s,o){return um(i,s,o,0)},r.ofLambda=n,r.range=function(i,s){return n({value:o=>o+i,rowCount:Math.max(s-i+1,0),schema:e.int})},r.ofArray=function(i){return mm(i)},r.ofIntArray=function(i){return mm({array:i,schema:e.int})},r.ofFloatArray=function(i){return mm({array:i,schema:e.float})},r.ofStringArray=function(i){return mm({array:i,schema:e.str})},r.ofStringAliasArray=function(i){return mm({array:i,schema:e.Aliased(e.str)})},r.ofStringListArray=function(i,s=","){return mm({array:i,schema:e.List(s,(o=>o))})},r.ofIntTokens=function(i){const{count:s,data:o,indices:a}=i;return dm({value:l=>cm(o,a[2*l],a[2*l+1])||0,rowCount:s,schema:e.int})},r.ofFloatTokens=function(i){const{count:s,data:o,indices:a}=i;return dm({value:l=>hm(o,a[2*l],a[2*l+1])||0,rowCount:s,schema:e.float})},r.ofStringTokens=function(i){const{count:s,data:o,indices:a}=i;return dm({value:l=>{const d=o.substring(a[2*l],a[2*l+1]);return d==="."||d==="?"?"":d},rowCount:s,schema:e.str})},r.window=function(i,s,o){return fm(i,s,o)},r.view=function(i,s,o=!0){return pm(i,s,o)},r.createFirstIndexMap=function(i){return(function(s){const o=new Map;for(let a=0,l=s.rowCount;a<l;a++){const d=s.value(a);o.has(d)||o.set(s.value(a),a)}return o})(i)},r.createIndexer=function(i){return(function(s){const o=new Map;for(let a=0,l=s.rowCount;a<l;a++){const d=s.value(a);o.has(d)||o.set(s.value(a),a)}return a=>o.has(a)?o.get(a):-1})(i)},r.mapToArray=function(i,s,o){return(function(a,l,d){const u=new d(a.rowCount);for(let g=0,x=a.rowCount;g<x;g++)u[g]=l(a.value(g));return u})(i,s,o||Array)},r.areEqual=function(i,s){return(function(o,a){return o===a||o.rowCount===a.rowCount&&o.isDefined===a.isDefined&&o.schema.valueType===a.schema.valueType&&(o.__array&&a.__array?(function(l,d){const u=l.__array,g=d.__array;for(let x=0,y=l.rowCount;x<y;x++)if(u[x]!==g[x])return!1;return!0})(o,a):(function(l,d){const u=l.value,g=d.value;for(let x=0,y=l.rowCount;x<y;x++)if(u(x)!==g(x))return!1;return!0})(o,a))})(i,s)},r.indicesOf=function(i,s){return(function(o,a){const l=[],d=o.value;for(let u=0,g=o.rowCount;u<g;u++)a(d(u))&&(l[l.length]=u);return l})(i,s)},r.asArrayColumn=function(i,s){return i.__array?i:i.isDefined?mm({array:i.toArray({array:s}),schema:i.schema,valueKind:i.valueKind}):t(i.rowCount,i.schema)},r.copyToArray=function(i,s,o=0){if(!i.isDefined)return;const a=i.__array;if(a)for(let l=0,d=a.length;l<d;l++)s[o+l]=a[l];else for(let l=0,d=i.rowCount;l<d;l++)s[o+l]=i.value(l)},r.isIdentity=function(i){for(let s=0,o=i.rowCount;s<o;s++)if(s!==i.value(s))return!1;return!0}})(sm||(sm={})),(function(r){r.create=function(e){return e},r.has=function(e,t){return!!(e&t)},r.hasAll=function(e,t){return!!t&&(e&t)===t}})(om||(om={})),(function(r){r.create=function(i=512){return{current:[],offset:0,capacity:i,chunks:[]}},r.getString=function(i){return i.chunks.length?(i.offset>0&&(i.chunks[i.chunks.length]=i.current.length===i.offset?i.current.join(""):i.current.slice(0,i.offset).join("")),i.chunks.join("")):i.current.length===i.offset?i.current.join(""):i.current.splice(0,i.offset).join("")},r.getSize=function(i){let s=0;for(const o of i.chunks)s+=o.length;for(let o=0;o<i.offset;o++)s+=i.current[o].length;return s},r.getChunks=function(i){return i.offset>0&&(i.current.length===i.offset?i.chunks[i.chunks.length]=i.current.join(""):i.chunks[i.chunks.length]=i.current.slice(0,i.offset).join(""),i.offset=0),i.chunks};const e=[];function t(i,s){s>0&&n(i,e[s])}function n(i,s){i.offset===i.capacity&&(i.chunks[i.chunks.length]=i.current.join(""),i.offset=0),i.current[i.offset++]=s}(function(){let i="";for(let s=0;s<512;s++)e[s]=i,i+=" "})(),r.newline=function(i){n(i,`
`)},r.whitespace=t,r.whitespace1=function(i){n(i," ")},r.write=function(i,s){s&&(i.offset===i.capacity&&(i.chunks[i.chunks.length]=i.current.join(""),i.offset=0),i.current[i.offset++]=s)},r.writeSafe=n,r.writePadLeft=function(i,s,o){if(!s)return void t(i,o);t(i,o-s.length),n(i,s)},r.writePadRight=function(i,s,o){if(!s)return void t(i,o);const a=o-s.length;n(i,s),t(i,a)},r.writeInteger=function(i,s){n(i,""+s)},r.writeIntegerAndSpace=function(i,s){n(i,s+" ")},r.writeIntegerPadLeft=function(i,s,o){const a=""+s;t(i,o-a.length),n(i,a)},r.writeIntegerPadRight=function(i,s,o){const a=""+s,l=o-a.length;n(i,a),t(i,l)},r.writeFloat=function(i,s,o){n(i,""+Math.round(o*s)/o)},r.writeFloatPadLeft=function(i,s,o,a){const l=""+Math.round(o*s)/o;t(i,a-l.length),n(i,l)},r.writeFloatPadRight=function(i,s,o,a){const l=""+Math.round(o*s)/o,d=a-l.length;n(i,l),t(i,d)}})(am||(am={}));const Pm=(function(){if(typeof window<"u"&&window.performance){const r=window.performance;return()=>r.now()}return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?()=>{const r=process.hrtime();return 1e3*r[0]+r[1]/1e6}:Date.now?()=>Date.now():()=>+new Date})();var Im,km,Mm;function Tm(r,e){return r-e}function Dm(r=0,e=Number.MAX_SAFE_INTEGER){let t=r;return()=>{const n=t;return t=(t+1)%e,n}}(function(r){const e=typeof btoa<"u"?btoa:n=>Buffer.from(n).toString("base64"),t=[];r.create22=function(){let n=+new Date+Pm();for(let i=0;i<16;i++)t[i]=String.fromCharCode((n+255*Math.random())%255|0),n=Math.floor(n/255);return e(t.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},r.createv4=function(){let n=+new Date+Pm();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){const s=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(i==="x"?s:3&s|8).toString(16)}))},r.is=function(n){return typeof n=="string"}})(Im||(Im={})),(function(r){class e{has(d){return!1}forEach(d,u){return u}constructor(){this.size=0}}class t{has(d){return d===this.idx}forEach(d,u){return d(this.idx,u),u}constructor(d){this.idx=d,this.size=1}}class n{has(d){return d<this.length&&!!this.mask[d]}_forEach(d,u){for(let g=0;g<this.length;g++)this.mask[g]&&d(g,u)}forEach(d,u){return this._forEach(d,u),u}constructor(d,u){this.mask=d,this.size=u,this.length=d.length}}class i{has(d){return!0}_forEach(d,u){for(let g=0;g<this.size;g++)d(g,u)}forEach(d,u){return this._forEach(d,u),u}constructor(d){this.size=d}}class s{has(d){return this.set.has(d)}_forEach(d,u){for(const g of this.flatten())d(g,u)}flatten(){if(this._flat)return this._flat;const d=new Int32Array(this.size);let u=0;return this.set.forEach((g=>d[u++]=g)),(function(g){Array.prototype.sort.call(g,Tm)})(d),this._flat=d,this._flat}forEach(d,u){return this._forEach(d,u),u}constructor(d){this.set=d,this._flat=void 0,this.size=d.size}}function o(l){return new s(l)}function a(l,d){return new n(l,d)}r.always=function(l){return new i(l)},r.never=new e,r.ofSet=o,r.singleton=function(l){return new t(l)},r.ofUniqueIndices=function(l){const d=l.length;if(d===0)return new e;if(d===1)return new t(l[0]);let u=0;for(const x of l)x>u&&(u=x);if(d===u)return new i(d);if(d/u<1/12){const x=new Set;for(const y of l)x.add(y);return new s(x)}const g=new Int8Array(u+1);for(const x of l)g[x]=1;return new n(g,l.length)},r.ofMask=a,r.hasAny=function(l,d){for(const u of d)if(l.has(u))return!0;return!1},r.complement=function(l,d){let u=0,g=0;if(d.forEach((x=>{l.has(x)||(u++,x>g&&(g=x))})),u/g<1/12){const x=new Set;return d.forEach((y=>{l.has(y)||x.add(y)})),o(x)}{const x=new Uint8Array(g+1);return d.forEach((y=>{l.has(y)||(x[y]=1)})),a(x,u)}}})(km||(km={})),(function(r){r.create=function(e){return{ref:e}},r.set=function(e,t){return e.ref=t,e}})(Mm||(Mm={}));const Bm=Dm(0,2147483647);var Fm,Em,$m,Om,Rm;function Lm(r){const{data:e,indices:t}=r;return function(n,i){const s=t[2*n],o=t[2*i],a=t[2*n+1]-s;if(a!==t[2*i+1]-o)return!1;for(let l=0;l<a;l++)if(e.charCodeAt(l+s)!==e.charCodeAt(l+o))return!1;return!0}}function Nm(r,e){return{name:e,blocks:r}}function zm(r,e,t,n=[]){return{categoryNames:r,header:t,categories:e,saveFrames:n,getField(i){const[s,o]=i.split(".");return e[s].getField(o||"")}}}function Um(r,e,t,n){return{rowCount:e,name:r,fieldNames:[...t],getField:i=>n[i]}}(function(r){r.create=function(e,t){return{id:Bm(),version:0,value:e,metadata:t}},r.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}})(Fm||(Fm={})),(function(r){function e(t,n){return Mm.set(t,Fm.withValue(t.ref,n))}r.create=function(t,n){return Mm.create(Fm.create(t,n))},r.update=e,r.set=function(t,n){return Mm.set(t,n)},r.updateIfChanged=function(t,n){return t.ref.value!==n?e(t,n):t}})(Em||(Em={})),(function(r){function e(n,i,s){const o=Object.create(null),a=Object.keys(i);o._rowCount=s.length,o._columns=a,o._schema=i;for(const l of a)o[l]=sm.view(n[l],s);return o}function t(n,i){const s=Object.create(null),{_columns:o}=n;for(let a=0;a<o.length;a++){const l=o[a];s[l]=n[l].value(i)}return s}r.is=function(n){return n&&typeof n._rowCount=="number"&&!!n._columns&&!!n._schema},r.pickColumns=function(n,i,s={}){const o=Object.create(null),a=Object.keys(n);o._rowCount=i._rowCount,o._columns=a,o._schema=n;for(const l of a)if(i[l])o[l]=i[l];else{if(!s[l])throw Error(`Cannot find column '${l}'.`);o[l]=s[l]}return o},r.ofColumns=function(n,i){const s=Object.keys(i);return{_rowCount:i[s[0]].rowCount,_columns:s,_schema:n,...i}},r.ofPartialColumns=function(n,i,s){const o=Object.create(null),a=Object.keys(n);o._rowCount=s,o._columns=a,o._schema=n;for(const l of a)o[l]=l in i?i[l]:sm.Undefined(s,n[l]);return o},r.ofUndefinedColumns=function(n,i){const s=Object.create(null),o=Object.keys(n);s._rowCount=i,s._columns=o,s._schema=n;for(const a of o)s[a]=sm.Undefined(i,n[a]);return s},r.ofRows=function(n,i){const s=Object.create(null),o=i.length,a=Object.keys(n);s._rowCount=o,s._columns=a,s._schema=n;for(const l of a)s[l]=sm.ofLambda({rowCount:o,schema:n[l],value:d=>i[d][l],valueKind:d=>i[d][l]===void 0?1:0});return s},r.ofArrays=function(n,i){var s;const o=Object.create(null),a=Object.keys(n);o._rowCount=0,o._columns=a,o._schema=n;for(const l of a)i[l]!==void 0?(o[l]=sm.ofArray({array:i[l],schema:n[l]}),o._rowCount=(s=i[l])===null||s===void 0?void 0:s.length):o[l]=sm.Undefined(o._rowCount,n[l]);return o},r.view=e,r.pick=function(n,i,s){const o=[];for(let a=0,l=n._rowCount;a<l;++a)s(a)&&o.push(a);return e(n,i,o)},r.window=function(n,i,s,o){if(s===0&&o===n._rowCount)return n;const a=Object.create(null),l=Object.keys(i);a._rowCount=o-s,a._columns=l,a._schema=i;for(const d of l)a[d]=sm.window(n[d],s,o);return a},r.concat=function(n,i){const s=Object.create(null),o=Object.keys(i);s._rowCount=0;for(const d of n)s._rowCount+=d._rowCount;const a={};for(const d of o)a[d]=new Array(s._rowCount);s._columns=o,s._schema=i;let l=0;for(const d of n){for(const u of o)sm.copyToArray(d[u],a[u],l);l+=d._rowCount}for(const d of o)s[d]=sm.ofArray({array:a[d],schema:i[d]});return s},r.columnToArray=function(n,i,s){n[i]=sm.asArrayColumn(n[i],s)},r.sort=function(n,i){const s=new Int32Array(n._rowCount);for(let l=0,d=s.length;l<d;l++)s[l]=l;Cm(s,((l,d,u)=>i(d,u)));let o=!0;for(let l=0,d=s.length;l<d;l++)if(s[l]!==l){o=!1;break}if(o)return n;const a=Object.create(null);a._rowCount=n._rowCount,a._columns=n._columns,a._schema=n._schema;for(const l of n._columns)a[l]=sm.view(n[l],s,!1);return a},r.areEqual=function(n,i){if(n._rowCount!==i._rowCount||n._columns.length!==i._columns.length)return!1;for(const s of n._columns)if(!i[s])return!1;for(const s of n._columns)if(!sm.areEqual(n[s],i[s]))return!1;return!0},r.getRow=t,r.pickRow=function(n,i){for(let s=0,o=n._rowCount;s<o;++s)if(i(s))return t(n,s)},r.getRows=function(n){const i=[],{_rowCount:s}=n;for(let o=0;o<s;o++)i[o]=t(n,o);return i},r.toArrays=function(n){const i={},{_columns:s}=n;for(let o=0;o<s.length;o++){const a=s[o];i[a]=n[a].toArray()}return i},r.formatToString=function(n){const i=am.create(),{_columns:s,_rowCount:o}=n;let a=1;am.write(i,"|");for(let l=0;l<s.length;l++)am.write(i,s[l]),am.write(i,"|"),a+=s[l].length+1;am.newline(i),am.write(i,new Array(a+1).join("-")),am.newline(i);for(let l=0;l<o;l++){am.write(i,"|");for(let d=0;d<s.length;d++){const u=n[s[d]];u.valueKind(l)===0?(am.write(i,u.value(l)),am.write(i,"|")):am.write(i,".|")}am.newline(i)}return am.getString(i)}})($m||($m={})),(function(r){r.ofTables=function(e,t,n){const i=Object.keys(n),s=Object.create(null),o=[];s._name=e,s._tableNames=o,s._schema=t;for(const a of i)$m.is(n[a])&&(s[a]=n[a],o[o.length]=a);return s},r.getTablesAsRows=function(e){const t={};for(const n of e._tableNames)t[n]=$m.getRows(e[n]);return t}})(Om||(Om={})),(function(r){function e(t,n){const i=Object.keys(n);return{rowCount:i.length>0?n[i[0]].rowCount:0,name:t,fieldNames:i,getField:s=>n[s]}}r.empty=function(t){return{rowCount:0,name:t,fieldNames:[],getField(n){}}},r.ofFields=e,r.ofTable=function(t,n){const i={};for(const s of n._columns)i[s]=Rm.ofColumn(n[s]);return e(t,i)}})(Um||(Um={})),(function(r){function e(n){const i=n.length,s=l=>{const d=n[l];return d&&d!=="."&&d!=="?"?d:""},o=l=>{const d=n[l];return cm(d,0,d.length)||0},a=l=>{const d=n[l];return hm(d,0,d.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:i,str:s,int:o,float:a,valueKind:l=>{const d=n[l],u=d.length;if(u>1)return 0;if(u===0)return 1;const g=d.charCodeAt(0);return g===46?1:g===63?2:0},areValuesEqual:(l,d)=>n[l]===n[d],toStringArray:l=>l?zd(i,s,l):n,toIntArray:l=>zd(i,o,l),toFloatArray:l=>zd(i,a,l)}}function t(n){const{rowCount:i,valueKind:s,areValuesEqual:o,isDefined:a}=n;let l,d,u;switch(n.schema.valueType){case"float":case"int":l=x=>""+n.value(x),d=n.value,u=n.value;break;case"str":l=n.value,d=x=>{const y=n.value(x);return cm(y,0,y.length)||0},u=x=>{const y=n.value(x);return hm(y,0,y.length)||0};break;case"list":const{separator:g}=n.schema;l=x=>n.value(x).join(g),d=x=>NaN,u=x=>NaN;break;default:throw new Error(`unsupported valueType '${n.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:a,rowCount:i,str:l,int:d,float:u,valueKind:s,areValuesEqual:o,toStringArray:g=>zd(i,l,g),toIntArray:g=>zd(i,d,g),toFloatArray:g=>zd(i,u,g)}}r.ofString=function(n){return e([n])},r.ofStrings=e,r.ofNumbers=function(n){const i=n.length,s=l=>""+n[l],o=l=>n[l],a=l=>!l||l.array&&n instanceof l.array?n:zd(i,o,l);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:i,str:s,int:o,float:o,valueKind:l=>0,areValuesEqual:(l,d)=>n[l]===n[d],toStringArray:l=>zd(i,s,l),toIntArray:a,toFloatArray:a}},r.ofTokens=function(n){const{data:i,indices:s,count:o}=n,a=u=>{const g=i.substring(s[2*u],s[2*u+1]);return g==="."||g==="?"?"":g},l=u=>cm(i,s[2*u],s[2*u+1])||0,d=u=>hm(i,s[2*u],s[2*u+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:o,str:a,int:l,float:d,valueKind:u=>{const g=s[2*u],x=s[2*u+1]-g;if(x>1)return 0;if(x===0)return 1;const y=i.charCodeAt(g);return y===46?1:y===63?2:0},areValuesEqual:Lm(n),toStringArray:u=>zd(o,a,u),toIntArray:u=>zd(o,l,u),toFloatArray:u=>zd(o,d,u)}},r.ofColumn=t,r.ofUndefined=function(n,i){return t(sm.Undefined(n,i))}})(Rm||(Rm={}));const Vm=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(r,...e)=>window.setImmediate(r,...e),clearImmediate:r=>window.clearImmediate(r)}:{setImmediate,clearImmediate}:(function(){const r=(function(){const a=typeof window<"u"&&window,l=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return a||typeof global<"u"&&global||l})(),e={},t=typeof document<"u"?document:void 0;let n,i=1;function s(a){delete e[a]}function o(a){const l=e[a];s(a),(function(d){const u=d.callback,g=d.args;switch(g.length){case 0:u();break;case 1:u(g[0]);break;case 2:u(g[0],g[1]);break;case 3:u(g[0],g[1],g[2]);break;default:u.apply(void 0,g)}})(l)}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?n=function(a){process.nextTick((function(){o(a)}))}:(function(){if(r&&r.postMessage&&!r.importScripts){let a=!0;const l=r.onmessage;return r.onmessage=function(){a=!1},r.postMessage("","*"),r.onmessage=l,a}})()?(function(){const a="setImmediate$"+Math.random()+"$",l=function(d){d.source===r&&typeof d.data=="string"&&d.data.indexOf(a)===0&&o(+d.data.slice(a.length))};window.addEventListener?window.addEventListener("message",l,!1):window.attachEvent("onmessage",l),n=function(d){window.postMessage(a+d,"*")}})():typeof MessageChannel<"u"?(function(){const a=new MessageChannel;a.port1.onmessage=function(l){o(l.data)},n=function(l){a.port2.postMessage(l)}})():t&&"onreadystatechange"in t.createElement("script")?(function(){const a=t.documentElement;n=function(l){let d=t.createElement("script");d.onreadystatechange=function(){o(l),d.onreadystatechange=null,a.removeChild(d),d=null},a.appendChild(d)}})():n=function(a){setTimeout(o,0,a)},{setImmediate:function(a,...l){typeof a!="function"&&(a=new Function(""+a));const d={callback:a,args:l};return e[i]=d,n(i),i++},clearImmediate:s}})();function jm(r){Vm.setImmediate(r)}const Gm={setImmediate:Vm.setImmediate,clearImmediate:Vm.clearImmediate,immediatePromise:()=>new Promise(jm),delay:(r,e=void 0)=>new Promise((t=>setTimeout(t,r,e)))};(function(){try{return!0}catch{return!1}})(),(function(){try{const r=define_process_env_default.DEBUG;return r==="*"||r==="molstar"}catch{return!1}})();var qm;function Wm(r,e,t=250){const n=(function(i,s,o){const a={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:o,lastNotified:Pm(),observer:s,abortToken:a,taskId:i.id,root:{progress:Xm(i),children:[]},tryAbort:Ym(a)}})(r,e,t);return Qm(r,new rf(n,n.root))}function Xm(r){return{taskId:r.id,taskName:r.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function Ym(r){return e=>{r.abortRequested=!0,r.reason=e||r.reason}}function Km(r){return{progress:{...r.progress},children:r.children.map(Km)}}function Zm(r){return r.progress.canAbort&&r.children.every(Zm)}async function Qm(r,e){qm.markStart(r),e.node.progress.startedTime=Pm();try{const t=await r.f(e);return qm.markEnd(r),qm.measure(r),e.info.abortToken.abortRequested&&Jm(e.info),t}catch(t){throw sf.isAbort(t)&&(e.isAborted=!0,e.node.children.length>0&&await new Promise((n=>{e.onChildrenFinished=n})),r.onAbort&&r.onAbort()),t}}function Jm(r){throw r.abortToken.treeAborted||(r.abortToken.treeAborted=!0,tf(r.root),ef(r,Pm())),sf.Aborted(r.abortToken.reason)}function tf(r){const e=r.progress;e.isIndeterminate=!0,e.canAbort=!1,e.message="Aborting...";for(const t of r.children)tf(t)}function ef(r,e){r.lastNotified=e;const t=(function(n){return{root:Km(n.root),canAbort:Zm(n.root),requestAbort:n.tryAbort}})(r);r.observer(t)}(function(r){r.markStart=function(e){},r.markEnd=function(e){},r.measure=function(e){}})(qm||(qm={}));class rf{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,Jm(this.info))}get shouldUpdate(){return this.checkAborted(),Pm()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;const t=this.node.progress;typeof e=="string"?(t.message=e,t.isIndeterminate=!0):(e.canAbort!==void 0&&(t.canAbort=e.canAbort),e.message!==void 0&&(t.message=e.message),e.current!==void 0&&(t.current=e.current),e.max!==void 0&&(t.max=e.max),t.isIndeterminate=t.current===void 0||t.max===void 0,e.isIndeterminate!==void 0&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=Pm(),this.updateProgress(e),!t)return ef(this.info,this.lastUpdatedTime),this.checkAborted(),Gm.immediatePromise()}async runChild(e,t){this.updateProgress(t);const n={progress:Xm(e),children:[]},i=this.node.children;i.push(n);const s=new rf(this.info,n);try{return await Qm(e,s)}catch(o){if(sf.isAbort(o)&&this.isAborted)return;throw o}finally{const o=i.indexOf(n);if(o>=0){for(let a=o,l=i.length-1;a<l;a++)i[a]=i[a+1];i.pop()}i.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}}const nf=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(r,e){}};var sf,of,af,cf,lf,hf;async function uf(r,e,t,n,i){let s=Math.max(e,0),o=0,a=0;if(r.isSynchronous)return n(Number.MAX_SAFE_INTEGER,t),t;let l=Pm(),d=0,u=0;for(;(d=n(s,t))>0;){o+=d;const g=Pm()-l;u+=g,a+=g,r.shouldUpdate&&(await i(r,t,o),s=Math.round(u*o/a)+1,l=Pm(),u=0)}return r.shouldUpdate&&await i(r,t,o),t}function df(r){return{data:r,position:0,length:r.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function mf(r){for(;r.position<r.length;)switch(r.data.charCodeAt(r.position)){case 9:case 10:case 13:case 32:return void(r.tokenEnd=r.position);default:++r.position}r.tokenEnd=r.position}function ff(r){return!(r.length-r.position<2)&&r.data.charCodeAt(r.position+1)===39&&r.data.charCodeAt(r.position+2)===39}function pf(r,e,t){let n;const i=t-e,s=r.tokenStart-e,o=r.tokenEnd-r.tokenStart;if(o<i)return!1;for(n=e;n<t;++n)if(r.data.charCodeAt(n)!==r.data.charCodeAt(n+s))return!1;return i===o||r.data.charCodeAt(n+s)===46}function gf(r){let e;for(e=r.tokenStart;e<r.tokenEnd;++e)if(r.data.charCodeAt(e)===46)return e;return e}function yf(r,e){return r.data.substring(r.tokenStart,e)}function bf(r){return r.data.substring(r.tokenStart,r.tokenEnd)}function _f(r){const e=(function(n){let i=10;for(;n.position<n.length;){const s=n.data.charCodeAt(n.position);switch(s){case 9:case 32:i=s,++n.position;break;case 10:i!==13&&++n.lineNumber,i=s,++n.position;break;case 13:i=s,++n.position,++n.lineNumber;break;default:return i}}return i})(r);if(r.position>=r.length)return void(r.tokenType=6);r.tokenStart=r.position,r.tokenEnd=r.position,r.isEscaped=!1;const t=r.data.charCodeAt(r.position);switch(t){case 35:(function(n){for(;n.position<n.length;){const i=n.data.charCodeAt(n.position);if(i===10||i===13)return;++n.position}})(r),r.tokenType=5;break;case 39:if(ff(r)){(function(n){for(n.position+=3;n.position<n.length;){if(n.data.charCodeAt(n.position)===39&&ff(n))return n.tokenStart+=3,n.tokenEnd=n.position,n.isEscaped=!0,void(n.position+=3);++n.position}n.tokenEnd=n.position})(r),r.tokenType=3;break}case 34:(function(n,i){let s,o;for(++n.position;n.position<n.length;)if(o=n.data.charCodeAt(n.position),o===i)switch(s=n.data.charCodeAt(n.position+1),s){case 9:case 10:case 13:case 32:return n.tokenStart++,n.tokenEnd=n.position,n.isEscaped=!0,void++n.position;default:if(s===void 0)return n.tokenStart++,n.tokenEnd=n.position,n.isEscaped=!0,void++n.position;++n.position}else{if(o===10||o===13)return void(n.tokenEnd=n.position);++n.position}n.tokenEnd=n.position})(r,t),r.tokenType=3;break;case 59:e===10||e===13?(function(n){let i,s=59,o=n.position+1;for(;o<n.length;){if(i=n.data.charCodeAt(o),i===59&&(s===10||s===13)){for(n.position=o+1,n.tokenStart++,o--,i=n.data.charCodeAt(o);i===10||i===13;)o--,i=n.data.charCodeAt(o);return n.tokenEnd=o+1,void(n.isEscaped=!0)}(i===13||i===10&&s!==13)&&n.lineNumber++,s=i,++o}n.position=o})(r):mf(r),r.tokenType=3;break;default:r.isImportGet?(function(n){for(;n.position<n.length;){if(n.data.charCodeAt(n.position)===93)return++n.position,n.tokenEnd=n.position,void(n.isImportGet=!1);++n.position}})(r):mf(r),r.isEscaped?r.tokenType=3:r.data.charCodeAt(r.tokenStart)===95?(r.inSaveFrame&&(function(n){return n.tokenEnd-n.tokenStart==11&&n.data.charCodeAt(n.tokenStart+1)===105&&n.data.charCodeAt(n.tokenStart+2)===109&&n.data.charCodeAt(n.tokenStart+3)===112&&n.data.charCodeAt(n.tokenStart+4)===111&&n.data.charCodeAt(n.tokenStart+5)===114&&n.data.charCodeAt(n.tokenStart+6)===116&&n.data.charCodeAt(n.tokenStart+7)===46&&n.data.charCodeAt(n.tokenStart+8)===103&&n.data.charCodeAt(n.tokenStart+9)===101&&n.data.charCodeAt(n.tokenStart+10)===116})(r)&&(r.isImportGet=!0),r.tokenType=4):r.tokenEnd-r.tokenStart>=5&&r.data.charCodeAt(r.tokenStart+4)===95?(function(n){let i=n.data.charCodeAt(n.tokenStart);return!(i!==68&&i!==100||(i=n.data.charCodeAt(n.tokenStart+1),i!==65&&i!==97||(i=n.data.charCodeAt(n.tokenStart+2),i!==84&&i!==116||(i=n.data.charCodeAt(n.tokenStart+3),i!==65&&i!==97))))})(r)?r.tokenType=0:(function(n){let i=n.data.charCodeAt(n.tokenStart);return!(i!==83&&i!==115||(i=n.data.charCodeAt(n.tokenStart+1),i!==65&&i!==97||(i=n.data.charCodeAt(n.tokenStart+2),i!==86&&i!==118||(i=n.data.charCodeAt(n.tokenStart+3),i!==69&&i!==101))))})(r)?r.tokenType=1:(function(n){if(n.tokenEnd-n.tokenStart!=5)return!1;let i=n.data.charCodeAt(n.tokenStart);return!(i!==76&&i!==108||(i=n.data.charCodeAt(n.tokenStart+1),i!==79&&i!==111||(i=n.data.charCodeAt(n.tokenStart+2),i!==79&&i!==111||(i=n.data.charCodeAt(n.tokenStart+3),i!==80&&i!==112))))})(r)?r.tokenType=2:r.tokenType=3:r.tokenType=3}}function xf(r){for(_f(r);r.tokenType===5;)_f(r)}function vf(){return{categoryNames:[],categoryData:Object.create(null)}}function wf(r,e){const t=Object.create(null);for(const n of r){const i=e[n];t[n]=Um(i.name,i.rowCount,i.fieldNames,i.fields)}return t}function Af(r,e,t){return zm(r.categoryNames,wf(r.categoryNames,r.categoryData),e,t)}function Sf(r,e){return zm(r.categoryNames,wf(r.categoryNames,r.categoryData),e)}function Cf(r,e,t,n,i){if(e in r.categoryData){const s=r.categoryData[e];s.fieldNames.push(...n),Object.assign(s.fields,i)}else r.categoryData[e]={name:e,rowCount:t,fieldNames:n,fields:i},r.categoryNames.push(e)}function Pf(r,e){const t=r.tokenStart,n=gf(r),i=yf(r,n),s=Object.create(null),o=[];let a=!0;for(;a;){if(r.tokenType!==4||!pf(r,t,n)){a=!1;break}const l=bf(r).substring(i.length+1);if(xf(r),r.tokenType!==3)return{hasError:!0,errorLine:r.lineNumber,errorMessage:"Expected value."};s[l]=Rm.ofTokens({data:r.data,indices:[r.tokenStart,r.tokenEnd],count:1}),o[o.length]=l,xf(r)}return Cf(e,i.substr(1),1,o,s),{hasError:!1,errorLine:0,errorMessage:""}}function If(r,e){const{tokenizer:t,tokens:n,fieldCount:i}=e;let s=e.tokenCount,o=0;for(;t.tokenType===3&&o<r;)cf.add(n[s++%i],t.tokenStart,t.tokenEnd),xf(t),o++;return e.tokenCount=s,o}function kf(r,e){return r.update({message:"Parsing...",current:e.tokenizer.position,max:e.tokenizer.data.length})}async function Mf(r,e){const t=r.lineNumber;xf(r);const n=yf(r,gf(r)),i=(function(g){let x;for(x=g.tokenStart;x<g.tokenEnd;++x)if(g.data.charCodeAt(x)===46)return!1;return!0})(r),s=[];for(;r.tokenType===4;)s[s.length]=i?bf(r):bf(r).substring(n.length+1),xf(r);const o=n==="_atom_site"?r.data.length/100|0:32,a=[],l=s.length;for(let g=0;g<l;g++)a[g]=cf.create(r.data,o);const d={fieldCount:l,tokenCount:0,tokenizer:r,tokens:a};if(await uf(r.runtimeCtx,1e6,d,If,kf),d.tokenCount%l!=0)return{hasError:!0,errorLine:r.lineNumber,errorMessage:`The number of values for loop starting at line ${t} is not a multiple of the number of columns.`};const u=d.tokenCount/l|0;if(i)for(let g=0;g<l;g++){const x={"":Rm.ofTokens(a[g])};Cf(e,s[g].substr(1),u,[""],x)}else{const g=Object.create(null);for(let x=0;x<l;x++)g[s[x]]=Rm.ofTokens(a[x]);Cf(e,n.substr(1),u,s,g)}return{hasError:!1,errorLine:0,errorMessage:""}}function Tf(r,e){return lf.error(e,r)}async function Df(r,e){const t=[],n=(function(u,g){return{data:u,length:u.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:g}})(r,e);let i="",s=vf(),o=[],a=vf();const l=(function(u,g,x){return{categoryNames:u,header:x,categories:g}})(a.categoryNames,wf(a.categoryNames,a.categoryData),"");let d="";for(e.update({message:"Parsing...",current:0,max:r.length}),xf(n);n.tokenType!==6;){const u=n.tokenType;if(u===0){if(n.inSaveFrame)return Tf(n.lineNumber,"Unexpected data block inside a save frame.");s.categoryNames.length>0&&t.push(Af(s,i,o)),i=r.substring(n.tokenStart+5,n.tokenEnd),s=vf(),o=[],xf(n)}else if(u===1){if(n.tokenEnd-n.tokenStart==5)a.categoryNames.length>0&&(o[o.length]=Sf(a,d)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return Tf(n.lineNumber,"Save frames cannot be nested.");n.inSaveFrame=!0,d=r.substring(n.tokenStart+5,n.tokenEnd),a=vf()}xf(n)}else if(u===2){const g=await Mf(n,n.inSaveFrame?a:s);if(g.hasError)return Tf(g.errorLine,g.errorMessage)}else{if(u!==4)return console.log(n.tokenType,df.getTokenString(n)),Tf(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const g=Pf(n,n.inSaveFrame?a:s);if(g.hasError)return Tf(g.errorLine,g.errorMessage)}}}return n.inSaveFrame?Tf(n.lineNumber,`Unfinished save frame (${l.header}).`):((s.categoryNames.length>0||o.length>0)&&t.push(Af(s,i,o)),(function(u){return lf.success(u)})(Nm(t)))}function Bf(r){return sf.create("Parse CIF",(async e=>await Df(r,e)))}(function(r){class e{run(o,a=250){return o?Wm(this,o,a):this.f(nf)}runAsChild(o,a){return o.isSynchronous?this.f(nf):(function(l,d,u){return l.runChild(d,u)})(o,this,a)}runInContext(o){return o.isSynchronous?this.f(nf):(function(a,l){return Qm(l,a)})(o,this)}constructor(o,a,l){this.name=o,this.f=a,this.onAbort=l,this.id=i()}}function t(s){const o=s;return!!s&&typeof o.id=="number"&&typeof o.name=="string"&&!!o.run}function n(s,o,a){return new e(s,o,a)}r.is=t,r.isAbort=function(s){return!!s&&!!s.isAborted},r.Aborted=function(s){return{isAborted:!0,reason:s,toString:()=>"Aborted"+(s?": "+s:"")}},r.create=n,r.constant=function(s,o){return n(s,(async a=>o))},r.empty=function(){return n("",(async s=>{}))},r.fail=function(s,o){return n(s,(async a=>{throw new Error(o)}))},r.resolveInContext=function(s,o){return t(s)?o?s.runInContext(o):s.run():s};const i=Dm(0,1073741823)})(sf||(sf={})),(function(r){r.Synchronous=nf})(of||(of={})),(function(r){function e(t,n=""){const i=t.progress;if(!t.children.length)return i.isIndeterminate?`${n}${i.taskName}: ${i.message}`:`${n}${i.taskName}: [${i.current}/${i.max}] ${i.message}`;const s=n+"  |_ ",o=t.children.map((a=>e(a,s)));return i.isIndeterminate?`${n}${i.taskName}: ${i.message}
${o.join(`
`)}`:`${n}${i.taskName}: [${i.current}/${i.max}] ${i.message}
${o.join(`
`)}`}r.format=function(t){return e(t.root)}})(af||(af={})),(function(r){function e(o){return o.data.substring(o.tokenStart,o.tokenEnd)}function t(o){const{data:a}=o;for(;o.position<o.length;)switch(a.charCodeAt(o.position)){case 10:return o.tokenEnd=o.position,++o.position,++o.lineNumber,!0;case 13:return o.tokenEnd=o.position,++o.position,++o.lineNumber,a.charCodeAt(o.position)===10&&++o.position,!0;default:++o.position}return o.tokenEnd=o.position,o.tokenStart!==o.tokenEnd}function n(o){return o.tokenStart=o.position,t(o)}function i(o,a,l){let d=0;for(let u=0;u<a;u++){if(!n(o))return d;cf.addUnchecked(l,o.tokenStart,o.tokenEnd),d++}return d}function s(o,a,l){const{data:d}=o;let u=a,g=l-1,x=d.charCodeAt(u);for(;(x===9||x===32)&&u<=g;)x=d.charCodeAt(++u);for(x=d.charCodeAt(g);(x===9||x===32)&&g>=u;)x=d.charCodeAt(--g);return o.tokenStart=u,o.tokenEnd=g+1,o.position=l,o}r.getTokenString=e,r.reset=function(o){o.position=0,o.lineNumber=1,o.tokenStart=0,o.tokenEnd=0},r.eatLine=t,r.markStart=function(o){o.tokenStart=o.position},r.markLine=n,r.readLine=function(o){return n(o),e(o)},r.readLineTrim=function(o){n(o);const a=o.position;return s(o,o.tokenStart,o.tokenEnd),o.position=a,e(o)},r.markLines=function(o,a){const l=cf.create(o.data,2*a);return i(o,a,l),l},r.readLines=function(o,a){const l=[];for(let d=0;d<a;d++)l.push(r.readLine(o));return l},r.readLinesAsync=async function(o,a,l,d=1e5){const u=cf.create(o.data,2*a);let g=0;return await uf(l,d,o,((x,y)=>{const b=Math.min(a-g,x);return i(y,b,u),g+=b,b}),((x,y)=>x.update({message:"Parsing...",current:y.position,max:y.length}))),u},r.readAllLines=function(o){const a=r(o),l=cf.create(a.data,Math.max(o.length/80,2));for(;n(a);)cf.add(l,a.tokenStart,a.tokenEnd);return l},r.readAllLinesAsync=async function(o,a,l=1e5){const d=r(o),u=cf.create(d.data,Math.max(o.length/80,2));return await uf(a,l,d,((g,x)=>((function(y,b,_){let h=0;for(let f=0;f<b;f++){if(!n(y))return h;cf.add(_,y.tokenStart,y.tokenEnd),h++}})(x,g,u),x.position<x.length?g:0)),((g,x)=>g.update({message:"Parsing...",current:x.position,max:x.length}))),u},r.eatValue=function(o){for(;o.position<o.length;)switch(o.data.charCodeAt(o.position)){case 9:case 10:case 13:case 32:return void(o.tokenEnd=o.position);default:++o.position}o.tokenEnd=o.position},r.skipWhitespace=function(o){let a=-1;for(;o.position<o.length;){const l=o.data.charCodeAt(o.position);switch(l){case 9:case 32:a=l,++o.position;break;case 10:a!==13&&++o.lineNumber,a=l,++o.position;break;case 13:a=l,++o.position,++o.lineNumber;break;default:return a}}return a},r.trim=s})(df||(df={})),(function(r){function e(t,n,i){const s=t;s.offset>s.indicesLenMinus2&&(function(o){const a=new Uint32Array(1.61*o.indices.length|0);a.set(o.indices),o.indices=a,o.indicesLenMinus2=a.length-2|0})(s),s.indices[s.offset++]=n,s.indices[s.offset++]=i,t.count++}r.add=e,r.addToken=function(t,n){e(t,n.tokenStart,n.tokenEnd)},r.addUnchecked=function(t,n,i){t.indices[t.offset++]=n,t.indices[t.offset++]=i,t.count++},r.create=function(t,n){return{data:t,indicesLenMinus2:(n=Math.max(10,n))-2|0,count:0,offset:0,indices:new Uint32Array(n)}}})(cf||(cf={})),(function(r){r.error=function(n,i=-1){return new e(n,i)},r.success=function(n,i=[]){return new t(n,i)};class e{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(i,s){this.message=i,this.line=s,this.isError=!0}}r.Error=e;class t{constructor(i,s){this.result=i,this.warnings=s,this.isError=!1}}r.Success=t})(lf||(lf={})),(function(r){var e,t;(e=r.IntDataType||(r.IntDataType={}))[e.Int8=1]="Int8",e[e.Int16=2]="Int16",e[e.Int32=3]="Int32",e[e.Uint8=4]="Uint8",e[e.Uint16=5]="Uint16",e[e.Uint32=6]="Uint32",(t=r.FloatDataType||(r.FloatDataType={}))[t.Float32=32]="Float32",t[t.Float64=33]="Float64",r.getDataType=function(n){let i;return i=n instanceof Int8Array?r.IntDataType.Int8:n instanceof Int16Array?r.IntDataType.Int16:n instanceof Int32Array?r.IntDataType.Int32:n instanceof Uint8Array?r.IntDataType.Uint8:n instanceof Uint16Array?r.IntDataType.Uint16:n instanceof Uint32Array?r.IntDataType.Uint32:n instanceof Float32Array?r.FloatDataType.Float32:n instanceof Float64Array?r.FloatDataType.Float64:r.IntDataType.Int32,i},r.isSignedIntegerDataType=function(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(let i=0,s=n.length;i<s;i++)if(i<0)return!1;return!0}})(hf||(hf={}));const Ff=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function Ef(r){let e=r.data;for(let t=r.encoding.length-1;t>=0;t--)e=$f(e,r.encoding[t]);return e}function $f(r,e){switch(e.kind){case"ByteArray":switch(e.type){case hf.IntDataType.Uint8:return r;case hf.IntDataType.Int8:return(function(t){return new Int8Array(t.buffer,t.byteOffset)})(r);case hf.IntDataType.Int16:return(function(t){return Lf(t,2,Int16Array)})(r);case hf.IntDataType.Uint16:return(function(t){return Lf(t,2,Uint16Array)})(r);case hf.IntDataType.Int32:return(function(t){return Lf(t,4,Int32Array)})(r);case hf.IntDataType.Uint32:return(function(t){return Lf(t,4,Uint32Array)})(r);case hf.FloatDataType.Float32:return(function(t){return Lf(t,4,Float32Array)})(r);case hf.FloatDataType.Float64:return(function(t){return Lf(t,8,Float64Array)})(r);default:im(e.type)}case"FixedPoint":return(function(t,n){const i=t.length,s=Rf(n.srcType,i),o=1/n.factor;for(let a=0;a<i;a++)s[a]=o*t[a];return s})(r,e);case"IntervalQuantization":return(function(t,n){const i=t.length,s=Rf(n.srcType,i),o=(n.max-n.min)/(n.numSteps-1),a=n.min;for(let l=0;l<i;l++)s[l]=a+o*t[l];return s})(r,e);case"RunLength":return(function(t,n){const i=Of(n.srcType,n.srcSize);let s=0;for(let o=0,a=t.length;o<a;o+=2){const l=t[o],d=t[o+1];for(let u=0;u<d;++u)i[s++]=l}return i})(r,e);case"Delta":return(function(t,n){const i=t.length,s=Of(n.srcType,i);if(!i)return t;s[0]=t[0]+(0|n.origin);for(let o=1;o<i;++o)s[o]=t[o]+s[o-1];return s})(r,e);case"IntegerPacking":return(function(t,n){return t.length===n.srcSize?t:n.isUnsigned?(function(i,s){const o=s.byteCount===1?255:65535,a=i.length,l=new Int32Array(s.srcSize);let d=0,u=0;for(;d<a;){let g=0,x=i[d];for(;x===o;)g+=x,d++,x=i[d];g+=x,l[u]=g,d++,u++}return l})(t,n):(function(i,s){const o=s.byteCount===1?127:32767,a=-o-1,l=i.length,d=new Int32Array(s.srcSize);let u=0,g=0;for(;u<l;){let x=0,y=i[u];for(;y===o||y===a;)x+=y,u++,y=i[u];x+=y,d[g]=x,u++,g++}return d})(t,n)})(r,e);case"StringArray":return(function(t,n){const i=Ef({encoding:n.offsetEncoding,data:n.offsets}),s=Ef({encoding:n.dataEncoding,data:t}),o=n.stringData,a=new Array(i.length);a[0]="";for(let u=1,g=i.length;u<g;u++)a[u]=o.substring(i[u-1],i[u]);let l=0;const d=new Array(s.length);for(let u=0,g=s.length;u<g;u++)d[l++]=a[s[u]+1];return d})(r,e)}}function Of(r,e){switch(r){case hf.IntDataType.Int8:return new Int8Array(e);case hf.IntDataType.Int16:return new Int16Array(e);case hf.IntDataType.Int32:return new Int32Array(e);case hf.IntDataType.Uint8:return new Uint8Array(e);case hf.IntDataType.Uint16:return new Uint16Array(e);case hf.IntDataType.Uint32:return new Uint32Array(e);default:return new Int32Array(e)}}function Rf(r,e){switch(r){case hf.FloatDataType.Float32:return new Float32Array(e);case hf.FloatDataType.Float64:default:return new Float64Array(e)}}function Lf(r,e,t){return new t(Ff?r.buffer:(function(n,i){const s=new ArrayBuffer(n.length),o=new Uint8Array(s);for(let a=0,l=n.length;a<l;a+=i)for(let d=0;d<i;d++)o[a+i-d-1]=n[a+d];return s})(r,e))}var Nf,zf,Uf,Vf,jf;function Gf(r,e,t){let n,i=1;for(n=0;n<e;n++){const s=i*r;if(Math.abs(Math.round(s)-s)<=t)return n;i*=10}return-1}function Hf(r){return zf.classify(r)}(function(r){function e(n){const i=n.growBy*n.elementSize;n.currentSize=i,n.currentIndex=0,n.currentChunk=new n.ctor(i),n.allocatedSize+=i,n.chunks[n.chunks.length]=n.currentChunk}function t(n,i){const{ctor:s,chunks:o,currentIndex:a}=n;if(!o.length)return new s(0);if(o.length===1&&(i||a===n.allocatedSize))return o[0];let l=0;for(let x=0,y=o.length-1;x<y;x++)l+=o[x].length;l+=n.currentIndex;const d=new s(l);let u=0;if(d.buffer)for(let x=0,y=o.length-1;x<y;x++)d.set(o[x],u),u+=o[x].length;else for(let x=0,y=o.length-1;x<y;x++){const b=o[x];for(let _=0,h=b.length;_<h;_++)d[u+_]=b[_];u+=b.length}const g=o[o.length-1];if(d.buffer&&a>=n.currentSize)d.set(g,u);else for(let x=0,y=g.length;x<y;x++)d[u+x]=g[x];return d}r.is=function(n){return n.creator&&n.chunkSize},r.add4=function(n,i,s,o,a){n.currentIndex>=n.currentSize&&e(n);const l=n.currentChunk,d=n.currentIndex;return l[d]=i,l[d+1]=s,l[d+2]=o,l[d+3]=a,n.currentIndex+=4,n.elementCount++},r.add3=function(n,i,s,o){n.currentIndex>=n.currentSize&&e(n);const a=n.currentChunk,l=n.currentIndex;return a[l]=i,a[l+1]=s,a[l+2]=o,n.currentIndex+=3,n.elementCount++},r.add2=function(n,i,s){n.currentIndex>=n.currentSize&&e(n);const o=n.currentChunk,a=n.currentIndex;return o[a]=i,o[a+1]=s,n.currentIndex+=2,n.elementCount++},r.add=function(n,i){return n.currentIndex>=n.currentSize&&e(n),n.currentChunk[n.currentIndex]=i,n.currentIndex+=1,n.elementCount++},r.addRepeat=function(n,i,s){for(let o=0;o<i;o++)n.currentIndex>=n.currentSize&&e(n),n.currentChunk[n.currentIndex++]=s,n.elementCount++;return n.elementCount},r.addMany=function(n,i){const{elementSize:s}=n;for(let o=0,a=i.length;o<a;o+=s){n.currentIndex>=n.currentSize&&e(n);const{currentChunk:l}=n;for(let d=0;d<s;d++)l[n.currentIndex++]=i[o+d];n.elementCount++}return n.elementCount},r.compact=function(n,i=!1){return t(n,i)},r._compact=t,r.create=function(n,i,s,o){const a={ctor:n,elementSize:i,growBy:Math.max(1,Math.ceil(s)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(o===void 0)return a;if(typeof o=="number")return a.currentChunk=new n(o*i),a.allocatedSize=o*i,a.currentSize=a.currentChunk.length,a.chunks[0]=a.currentChunk,a;const l=o;if(l.length%i!=0)throw new Error("initialChunk length must be a multiple of the element size.");return a.currentChunk=l,a.allocatedSize=l.length,a.currentSize=l.length,a.chunks[0]=l,a}})(Nf||(Nf={})),(function(r){function e(u,g){return u>=0?Math.ceil((u+1)/g):Math.ceil((u+1)/(-g-1))}function t({limit8:u,limit16:g},x,y){x.pack8+=e(y,u),x.pack16+=e(y,g),x.count+=1}function n(u,g){u.pack8+=e(g,127),u.pack16+=e(g,32767),u.count+=1}function i(u){return 4*u.count<2*u.pack16?{length:4*u.count,elem:4}:2*u.pack16<u.pack8?{length:2*u.pack16,elem:2}:{length:u.pack8,elem:1}}function s(u,g){const x={pack8:0,pack16:0,count:0};for(let y=0,b=u.length;y<b;y++)t(g,x,u[y]);return{...i(x),kind:"pack"}}function o(u,g){const x={pack8:0,pack16:0,count:0};let y=u[0];for(let b=1,_=u.length;b<_;b++)n(x,u[b]-y),y=u[b];return{...i(x),kind:"delta"}}function a(u,g){const x={pack8:0,pack16:0,count:0};let y=1;for(let b=1,_=u.length;b<_;b++)u[b-1]!==u[b]?(t(g,x,u[b-1]),t(g,x,y),y=1):y++;return t(g,x,u[u.length-1]),t(g,x,y),{...i(x),kind:"rle"}}function l(u,g){const x={pack8:0,pack16:0,count:0};let y=1,b=0,_=0;for(let h=1,f=u.length;h<f;h++){const E=u[h]-b;_!==E?(n(x,_),n(x,y),y=1):y++,_=E,b=u[h]}return n(x,_),n(x,y),{...i(x),kind:"delta-rle"}}function d(u){const g=(function(y){let b=!1;for(let _=0,h=y.length;_<h;_++)if(y[_]<0){b=!0;break}return b?{signed:b,limit8:127,limit16:32767}:{signed:b,limit8:255,limit16:65535}})(u),x=[s(u,g),a(u,g),o(u),l(u)];return x.sort(((y,b)=>y.length-b.length)),x}r.getSize=d,r.classify=function(u){if(u.length<2)return jf.by(jf.byteArray);switch(d(u)[0].kind){case"pack":return jf.by(jf.integerPacking);case"rle":return jf.by(jf.runLength).and(jf.integerPacking);case"delta":return jf.by(jf.delta).and(jf.integerPacking);case"delta-rle":return jf.by(jf.delta).and(jf.runLength).and(jf.integerPacking);default:im()}}})(zf||(zf={})),(function(r){r.classify=function(e){const{mantissaDigits:t,integerDigits:n}=(function(l,d,u){let g=1,x=0;for(let y=0,b=l.length;y<b;y++){if(g>=0){const h=Gf(l[y],d,u);h<0?g=-1:h>g&&(g=h)}const _=Math.abs(l[y]);if(_>u){const h=Math.floor(Math.log10(Math.abs(_)))+1;h>x&&(x=h)}}return{mantissaDigits:g,integerDigits:x}})(e,4,1e-6);if(t<0||t+n>10)return jf.by(jf.byteArray);if(t===0)return zf.classify(e);const i=(function(l){let d=1;for(let u=0;u<l;u++)d*=10;return d})(t),s=new Int32Array(e.length);for(let l=0,d=e.length;l<d;l++)s[l]=Math.round(i*e[l]);const o=zf.getSize(s)[0],a=jf.by(jf.fixedPoint(i));switch(o.kind){case"pack":return a.and(jf.integerPacking);case"rle":return a.and(jf.runLength).and(jf.integerPacking);case"delta":return a.and(jf.delta).and(jf.integerPacking);case"delta-rle":return a.and(jf.delta).and(jf.runLength).and(jf.integerPacking);default:im()}}})(Uf||(Uf={}));class qf{and(e){return new qf(this.providers.concat([e]))}encode(e){const t=[];for(const n of this.providers){const i=n(e);if(!i.encodings.length)throw new Error("Encodings must be non-empty.");e=i.data;for(const s of i.encodings)t.push(s)}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:t,data:e}}constructor(e){this.providers=e}}(function(r){function e(n){return new qf([n])}function t(n){switch(n.kind){case"ByteArray":return jf.byteArray;case"FixedPoint":return jf.fixedPoint(n.factor);case"IntervalQuantization":return jf.intervalQuantizaiton(n.min,n.max,n.numSteps);case"RunLength":return jf.runLength;case"Delta":return jf.delta;case"IntegerPacking":return jf.integerPacking;case"StringArray":return jf.stringArray}}r.by=e,r.fromEncoding=function(n){let i=e(t(n[0]));for(let s=1;s<n.length&&n[s-1].kind!=="IntegerPacking";s++)i=i.and(t(n[s]));return i}})(Vf||(Vf={})),(function(r){r.by=function(o){return new qf([o])};const e={[hf.IntDataType.Int16]:function(o,a,l){o.setInt16(2*a,l,!0)},[hf.IntDataType.Uint16]:function(o,a,l){o.setUint16(2*a,l,!0)},[hf.IntDataType.Int32]:function(o,a,l){o.setInt32(4*a,l,!0)},[hf.IntDataType.Uint32]:function(o,a,l){o.setUint32(4*a,l,!0)},[hf.FloatDataType.Float32]:function(o,a,l){o.setFloat32(4*a,l,!0)},[hf.FloatDataType.Float64]:function(o,a,l){o.setFloat64(8*a,l,!0)}},t={[hf.IntDataType.Int16]:2,[hf.IntDataType.Uint16]:2,[hf.IntDataType.Int32]:4,[hf.IntDataType.Uint32]:4,[hf.FloatDataType.Float32]:4,[hf.FloatDataType.Float64]:8};function n(o){const a=hf.getDataType(o);if(a===hf.IntDataType.Int8)return(function(g){return{encodings:[{kind:"ByteArray",type:hf.IntDataType.Int8}],data:new Uint8Array(g.buffer,g.byteOffset)}})(o);if(a===hf.IntDataType.Uint8)return(function(g){return{encodings:[{kind:"ByteArray",type:hf.IntDataType.Uint8}],data:g}})(o);const l=new Uint8Array(o.length*t[a]),d=e[a],u=new DataView(l.buffer);for(let g=0,x=o.length;g<x;g++)d(u,g,o[g]);return{encodings:[{kind:"ByteArray",type:a}],data:l}}function i(o,a){let l=0;for(let d=0,u=o.length;d<u;d++)l+=o[d]/a|0;return l+=o.length,l}function s(o,a){const l=-a-1;let d=0;for(let u=0,g=o.length;u<g;u++){const x=o[u];d+=x>=0?x/a|0:x/l|0}return d+=o.length,d}r.byteArray=n,r.fixedPoint=function(o){return a=>(function(l,d){const u=hf.getDataType(l),g=new Int32Array(l.length);for(let x=0,y=l.length;x<y;x++)g[x]=Math.round(l[x]*d);return{encodings:[{kind:"FixedPoint",factor:d,srcType:u}],data:g}})(a,o)},r.intervalQuantizaiton=function(o,a,l,d=Int32Array){return u=>(function(g,x,y,b,_){const h=hf.getDataType(g);if(!g.length)return{encodings:[{kind:"IntervalQuantization",min:x,max:y,numSteps:b,srcType:h}],data:new Int32Array(0)};if(y<x){const m=x;x=y,y=m}const f=(y-x)/(b-1),E=new _(g.length);for(let m=0,S=g.length;m<S;m++){const w=g[m];E[m]=w<=x?0:w>=y?b-1:0|Math.round((w-x)/f)}return{encodings:[{kind:"IntervalQuantization",min:x,max:y,numSteps:b,srcType:h}],data:E}})(u,o,a,l,d)},r.runLength=function(o){let a=hf.getDataType(o);if(a===void 0&&(o=new Int32Array(o),a=hf.IntDataType.Int32),!o.length)return{encodings:[{kind:"RunLength",srcType:a,srcSize:0}],data:new Int32Array(0)};let l=2;for(let x=1,y=o.length;x<y;x++)o[x-1]!==o[x]&&(l+=2);const d=new Int32Array(l);let u=0,g=1;for(let x=1,y=o.length;x<y;x++)o[x-1]!==o[x]?(d[u]=o[x-1],d[u+1]=g,g=1,u+=2):++g;return d[u]=o[o.length-1],d[u+1]=g,{encodings:[{kind:"RunLength",srcType:a,srcSize:o.length}],data:d}},r.delta=function(o){if(!hf.isSignedIntegerDataType(o))throw new Error("Only signed integer types can be encoded using delta encoding.");let a=hf.getDataType(o);if(a===void 0&&(o=new Int32Array(o),a=hf.IntDataType.Int32),!o.length)return{encodings:[{kind:"Delta",origin:0,srcType:a}],data:new o.constructor(0)};const l=new o.constructor(o.length),d=o[0];l[0]=o[0];for(let u=1,g=o.length;u<g;u++)l[u]=o[u]-o[u-1];return l[0]=0,{encodings:[{kind:"Delta",origin:d,srcType:a}],data:l}},r.integerPacking=function(o){const a=(function(l){const d=(function(x){for(let y=0,b=x.length;y<b;y++)if(x[y]<0)return!0;return!1})(l),u=d?s(l,127):i(l,255),g=d?s(l,32767):i(l,65535);return 4*l.length<2*g?{isSigned:d,size:l.length,bytesPerElement:4}:2*g<u?{isSigned:d,size:g,bytesPerElement:2}:{isSigned:d,size:u,bytesPerElement:1}})(o);return a.bytesPerElement===4?n(o):(function(l,d){const u=d.isSigned?d.bytesPerElement===1?127:32767:d.bytesPerElement===1?255:65535,g=-u-1,x=l.length,y=d.isSigned?d.bytesPerElement===1?new Int8Array(d.size):new Int16Array(d.size):d.bytesPerElement===1?new Uint8Array(d.size):new Uint16Array(d.size);let b=0;for(let h=0;h<x;h++){let f=l[h];if(f>=0)for(;f>=u;)y[b]=u,++b,f-=u;else for(;f<=g;)y[b]=g,++b,f-=g;y[b]=f,++b}const _=n(y);return{encodings:[{kind:"IntegerPacking",byteCount:d.bytesPerElement,isUnsigned:!d.isSigned,srcSize:x},_.encodings[0]],data:_.data}})(o,a)},r.stringArray=function(o){const a=Object.create(null),l=[],d=new Int32Array(o.length),u=Nf.create(Int32Array,1,Math.min(1024,o.length<32?o.length+1:Math.round(o.length/8)+1));Nf.add(u,0);let g=0,x=0;for(const h of o){if(h==null){d[x++]=-1;continue}let f=a[h];f===void 0&&(g+=h.length,f=l.length,l[f]=h,a[h]=f,Nf.add(u,g)),d[x++]=f}const y=Nf.compact(u),b=Hf(y).encode(y),_=Hf(d).encode(d);return{encodings:[{kind:"StringArray",dataEncoding:_.encoding,stringData:l.join(""),offsetEncoding:b.encoding,offsets:b.data}],data:_.data}}})(jf||(jf={}));const Wf=(function(){const r=[];for(let e=0;e<1024;e++)r[e]=String.fromCharCode(e);return r})();function Xf(r){throw new Error(r)}const Yf=typeof TextDecoder<"u"?new TextDecoder:void 0;function Kf(r,e,t){if(Yf){const n=e||t!==r.length?r.subarray(e,e+t):r;return Yf.decode(n)}return(function(n,i,s){const o=Wf;let a,l=0;const d=[];for(let u=i,g=i+s;u<g;u++){const x=n[u];128&x?(224&x)==192?d[l++]=o[(15&x)<<6|63&n[++u]]:(240&x)==224?d[l++]=String.fromCharCode((15&x)<<12|(63&n[++u])<<6|63&n[++u]):(248&x)==240?d[l++]=String.fromCharCode((7&x)<<18|(63&n[++u])<<12|(63&n[++u])<<6|63&n[++u]):Xf("Invalid byte "+x.toString(16)):d[l++]=o[x],l===512&&(a=a||[],a[a.length]=d.join(""),l=0)}return a?(l>0&&(a[a.length]=d.slice(0,l).join("")),a.join("")):d.slice(0,l).join("")})(r,e,t)}function Zf(r,e){const t={};for(let n=0;n<e;n++)t[ep(r)]=ep(r);return t}function Qf(r,e){const t=new Uint8Array(e),n=r.offset;for(let i=0;i<e;i++)t[i]=r.buffer[i+n];return r.offset+=e,t}function Jf(r,e){const t=Kf(r.buffer,r.offset,e);return r.offset+=e,t}function tp(r,e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=ep(r);return t}function ep(r){const e=r.buffer[r.offset];let t,n;if(!(128&e))return r.offset++,e;if((240&e)==128)return n=15&e,r.offset++,Zf(r,n);if((240&e)==144)return n=15&e,r.offset++,tp(r,n);if((224&e)==160)return n=31&e,r.offset++,Jf(r,n);if(!(224&~e))return t=r.dataView.getInt8(r.offset),r.offset++,t;switch(e){case 192:return r.offset++,null;case 194:return r.offset++,!1;case 195:return r.offset++,!0;case 196:return n=r.dataView.getUint8(r.offset+1),r.offset+=2,Qf(r,n);case 197:return n=r.dataView.getUint16(r.offset+1),r.offset+=3,Qf(r,n);case 198:return n=r.dataView.getUint32(r.offset+1),r.offset+=5,Qf(r,n);case 202:return t=r.dataView.getFloat32(r.offset+1),r.offset+=5,t;case 203:return t=r.dataView.getFloat64(r.offset+1),r.offset+=9,t;case 204:return t=r.buffer[r.offset+1],r.offset+=2,t;case 205:return t=r.dataView.getUint16(r.offset+1),r.offset+=3,t;case 206:return t=r.dataView.getUint32(r.offset+1),r.offset+=5,t;case 208:return t=r.dataView.getInt8(r.offset+1),r.offset+=2,t;case 209:return t=r.dataView.getInt16(r.offset+1),r.offset+=3,t;case 210:return t=r.dataView.getInt32(r.offset+1),r.offset+=5,t;case 217:return n=r.dataView.getUint8(r.offset+1),r.offset+=2,Jf(r,n);case 218:return n=r.dataView.getUint16(r.offset+1),r.offset+=3,Jf(r,n);case 219:return n=r.dataView.getUint32(r.offset+1),r.offset+=5,Jf(r,n);case 220:return n=r.dataView.getUint16(r.offset+1),r.offset+=3,tp(r,n);case 221:return n=r.dataView.getUint32(r.offset+1),r.offset+=5,tp(r,n);case 222:return n=r.dataView.getUint16(r.offset+1),r.offset+=3,Zf(r,n);case 223:return n=r.dataView.getUint32(r.offset+1),r.offset+=5,Zf(r,n)}throw new Error("Unknown type 0x"+e.toString(16))}function ip(r){const e=Object.create(null),t=Object.create(null);for(const n of r.columns)e[n.name]=n;return{rowCount:r.rowCount,name:r.name.substr(1),fieldNames:r.columns.map((n=>n.name)),getField(n){const i=e[n];if(i)return t[n]||(t[n]=(function(s){const o=s.mask?Ef(s.mask):void 0,a=Ef(s.data),l=Ud(a),d=l?o?b=>o[b]===0?""+a[b]:"":b=>""+a[b]:o?b=>o[b]===0?a[b]:"":b=>a[b],u=l?b=>a[b]:b=>{const _=a[b];return cm(_,0,_.length)},g=l?b=>a[b]:b=>{const _=a[b];return hm(_,0,_.length)},x=o?b=>o[b]:b=>0,y=a.length;return{__array:a,binaryEncoding:s.data.encoding,isDefined:!0,rowCount:y,str:d,int:u,float:g,valueKind:x,areValuesEqual:(b,_)=>a[b]===a[_],toStringArray:b=>zd(y,d,b),toIntArray:l?b=>Vd(a,b):b=>zd(y,u,b),toFloatArray:l?b=>Vd(a,b):b=>zd(y,g,b)}})(i)),t[n]}}}function rp(r){return sf.create("Parse BinaryCIF",(async e=>{const t=[0,3];try{const i=ep({buffer:n=r,offset:0,dataView:new DataView(n.buffer)});if(!(function(o,a){for(let l=0;l<2;l++)if(o[l]>a[l])return!1;return!0})(t,i.version.match(/(\d)\.(\d)\.\d/).slice(1).map((o=>+o))))return lf.error(`Unsupported format version. Current ${i.version}, required ${t.join(".")}.`);const s=Nm(i.dataBlocks.map((o=>{const a=Object.create(null);for(const l of o.categories)a[l.name.substr(1)]=ip(l);return zm(o.categories.map((l=>l.name.substr(1))),a,o.header)})));return lf.success(s)}catch(i){return lf.error(""+i)}var n}))}var np;function sp(r,e,t){return(function(n,i,s){const o=Object.create(null);for(const a of Object.keys(n))o[a]=dp(a,n[a],i,s);return Om.ofTables(i.header,n,o)})(r,e,t)}function op(r){switch(r.valueType){case"str":return(e,t,n)=>(function(i,s,o,a){return{schema:i,__array:s.__array,isDefined:s.isDefined,rowCount:s.rowCount,value:i.transform==="lowercase"?l=>o(l).toLowerCase():i.transform==="uppercase"?l=>o(l).toUpperCase():o,valueKind:s.valueKind,areValuesEqual:s.areValuesEqual,toArray:i.transform==="lowercase"?l=>Array.from(a(l)).map((d=>d.toLowerCase())):i.transform==="uppercase"?l=>Array.from(a(l)).map((d=>d.toUpperCase())):a}})(r,e,e.str,e.toStringArray);case"int":return(e,t,n)=>ap(r,e,e.int,e.toIntArray);case"float":return(e,t,n)=>ap(r,e,e.float,e.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function ap(r,e,t,n){return{schema:r,__array:e.__array,isDefined:e.isDefined,rowCount:e.rowCount,value:t,valueKind:e.valueKind,areValuesEqual:e.areValuesEqual,toArray:n}}function cp(r,e,t){const n=r.separator,i=r.itemParse,s=e.getField(t),o=s?a=>s.str(a).split(n).map((l=>i(l.trim()))).filter((l=>!!l)):a=>[];return{schema:r,__array:void 0,isDefined:!!s,rowCount:e.rowCount,value:o,valueKind:s?s.valueKind:()=>1,areValuesEqual:(a,l)=>(function(d,u){const g=d.length;if(g!==u.length)return!1;for(let x=0;x<g;x++)if(d[x]!==u[x])return!1;return!0})(o(a),o(l)),toArray:a=>zd(e.rowCount,o,a)}}function lp(r,e,t){const n=r.space,i=e.fieldNames.includes(`${t}[0]`)||e.fieldNames.includes(`${t}[0][0]`)||e.fieldNames.includes(`${t}[0][0][0]`),s=i?0:1,o=e.fieldNames.includes(`${t}_1`)||e.fieldNames.includes(`${t}_11`)||e.fieldNames.includes(`${t}_111`)?"underscore":"brackets",a=(function(u,g,x,y){const b=x?0:1;switch(g){case 1:return y==="brackets"?_=>`${u}[${_+b}]`:_=>`${u}_${_+b}`;case 2:return y==="brackets"?(_,h)=>`${u}[${_+b}][${h+b}]`:(_,h)=>`${u}_${_+b}${h+b}`;case 3:return y==="brackets"?(_,h,f)=>`${u}[${_+b}][${h+b}][${f+b}]`:(_,h,f)=>`${u}_${_+b}${h+b}${f+b}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}})(t,n.rank,i,o),l=e.getField(a(s,s,s))||sm.Undefined(e.rowCount,r),d=u=>(function(g,x,y,b){const _=x.create();if(x.rank===1){const h=x.dimensions[0];for(let f=0;f<h;f++){const E=g.getField(b(f));x.set(_,f,E?E.float(y):0)}}else if(x.rank===2){const h=x.dimensions[0],f=x.dimensions[1];for(let E=0;E<h;E++)for(let m=0;m<f;m++){const S=g.getField(b(E,m));x.set(_,E,m,S?S.float(y):0)}}else{if(x.rank!==3)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const h=x.dimensions[0],f=x.dimensions[1],E=x.dimensions[2];for(let m=0;m<h;m++)for(let S=0;S<f;S++)for(let w=0;w<E;w++){const v=g.getField(b(m,S,w));x.set(_,m,S,w,v?v.float(y):0)}}}return _})(e,n,u,a);return{schema:r,__array:void 0,isDefined:l.isDefined,rowCount:e.rowCount,value:d,valueKind:l.valueKind,areValuesEqual:(u,g)=>nm.areEqualExact(d(u),d(g)),toArray:u=>zd(e.rowCount,d,u)}}(function(r){function e(t){return t.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}r.canonical=e,r.equal=function(t,n){return e(t)===e(n)},r.create=function(t,n,i=!1){const s=`${t}${n?`.${n}`:""}`;return i?e(s):s}})(np||(np={}));class hp{constructor(e,t,n){this._isDefined=n;const i=Object.keys(t);this._rowCount=e.rowCount,this._columns=i,this._schema=t;const s=Object.create(null);for(const o of i)Object.defineProperty(this,o,{get:function(){if(s[o])return s[o];const a=t[o];if(a.valueType==="list")s[o]=cp(a,e,o);else if(a.valueType==="tensor")s[o]=lp(a,e,o);else{const l=op(a),d=e.getField(o);s[o]=d?l(d,e,o):sm.Undefined(e.rowCount,a)}return s[o]},enumerable:!0,configurable:!1})}}function up(r,e,t,n){const i=np.create(e,r),s=np.canonical(i);if(s in t)return t[s];if(n&&i in n)for(const o of n[i]){const a=np.canonical(o);if(a in t)return t[a]}}function dp(r,e,t,n){let i=t.categories[r];if(n){const s=(function(d){const u=Object.create(null);for(const g of Object.keys(d.categories))for(const x of d.categories[g].fieldNames)u[np.create(g,x,!0)]=d.categories[g].getField(x);return u})(t),o=Object.create(null),a=[];let l=0;for(const d of Object.keys(e)){const u=up(d,r,s,n);u&&(o[d]=u,a.push(d),l=u.rowCount)}i={rowCount:l,name:r,fieldNames:[...a],getField:d=>o[d]}}return new hp(i||Um.empty(r),e,!!i)}var mp=sm.Schema;const fp=mp.str,pp=mp.int,gp=mp.float,yp=mp.coord,bp=mp.Aliased,_p=mp.Matrix,xp=mp.Vector,vp=mp.lstr,wp=mp.List,Ap={atom_site:{auth_asym_id:fp,auth_atom_id:fp,auth_comp_id:fp,auth_seq_id:pp,B_iso_or_equiv:gp,Cartn_x:yp,Cartn_y:yp,Cartn_z:yp,group_PDB:bp(fp),id:pp,label_alt_id:fp,label_asym_id:fp,label_atom_id:fp,label_comp_id:fp,label_entity_id:fp,label_seq_id:pp,occupancy:gp,type_symbol:fp,pdbx_PDB_ins_code:fp,pdbx_PDB_model_num:pp,pdbx_formal_charge:pp,pdbx_label_index:pp,pdbx_sifts_xref_db_name:fp,pdbx_sifts_xref_db_acc:fp,pdbx_sifts_xref_db_num:fp,pdbx_sifts_xref_db_res:fp,ihm_model_id:pp},atom_site_anisotrop:{id:pp,type_symbol:fp,U:_p(3,3),U_esd:_p(3,3),pdbx_auth_seq_id:fp,pdbx_auth_asym_id:fp,pdbx_auth_atom_id:fp,pdbx_auth_comp_id:fp,pdbx_label_seq_id:pp,pdbx_label_alt_id:fp,pdbx_label_asym_id:fp,pdbx_label_atom_id:fp,pdbx_label_comp_id:fp,pdbx_PDB_ins_code:fp},atom_sites:{entry_id:fp,fract_transf_matrix:_p(3,3),fract_transf_vector:xp(3)},audit_author:{name:fp,pdbx_ordinal:pp,identifier_ORCID:fp},audit_conform:{dict_location:fp,dict_name:fp,dict_version:fp},cell:{angle_alpha:gp,angle_beta:gp,angle_gamma:gp,entry_id:fp,length_a:gp,length_b:gp,length_c:gp,Z_PDB:pp,pdbx_unique_axis:fp},chem_comp:{formula:fp,formula_weight:gp,id:fp,mon_nstd_flag:bp(vp),name:fp,type:bp(vp),pdbx_synonyms:wp(";",(r=>r))},chem_comp_bond:{atom_id_1:fp,atom_id_2:fp,comp_id:fp,value_order:bp(vp),pdbx_ordinal:pp,pdbx_stereo_config:bp(vp),pdbx_aromatic_flag:bp(vp)},citation:{book_publisher:fp,country:fp,id:fp,journal_abbrev:fp,journal_id_ASTM:fp,journal_id_CSD:fp,journal_id_ISSN:fp,journal_volume:fp,page_first:fp,page_last:fp,title:fp,year:pp,pdbx_database_id_DOI:fp,pdbx_database_id_PubMed:pp},citation_author:{citation_id:fp,name:fp,ordinal:pp},database_2:{database_id:bp(vp),database_code:fp},entity:{details:fp,formula_weight:gp,id:fp,src_method:bp(vp),type:bp(vp),pdbx_description:wp(",",(r=>r)),pdbx_number_of_molecules:pp,pdbx_mutation:fp,pdbx_fragment:fp,pdbx_ec:wp(",",(r=>r))},entity_poly:{entity_id:fp,nstd_linkage:bp(vp),nstd_monomer:bp(vp),type:bp(fp),pdbx_strand_id:wp(",",(r=>r)),pdbx_seq_one_letter_code:fp,pdbx_seq_one_letter_code_can:fp,pdbx_target_identifier:fp},entity_poly_seq:{entity_id:fp,hetero:bp(vp),mon_id:fp,num:pp},entry:{id:fp},exptl:{entry_id:fp,method:bp(fp)},software:{classification:fp,date:fp,description:fp,name:fp,type:bp(vp),version:fp,pdbx_ordinal:pp},struct:{entry_id:fp,title:fp,pdbx_descriptor:fp},struct_asym:{details:fp,entity_id:fp,id:fp,pdbx_modified:fp,pdbx_blank_PDB_chainid_flag:bp(fp)},struct_conf:{beg_label_asym_id:fp,beg_label_comp_id:fp,beg_label_seq_id:pp,beg_auth_asym_id:fp,beg_auth_comp_id:fp,beg_auth_seq_id:pp,conf_type_id:bp(vp),details:fp,end_label_asym_id:fp,end_label_comp_id:fp,end_label_seq_id:pp,end_auth_asym_id:fp,end_auth_comp_id:fp,end_auth_seq_id:pp,id:fp,pdbx_beg_PDB_ins_code:fp,pdbx_end_PDB_ins_code:fp,pdbx_PDB_helix_class:fp,pdbx_PDB_helix_length:pp,pdbx_PDB_helix_id:fp},struct_conn:{conn_type_id:bp(vp),details:fp,id:fp,ptnr1_label_asym_id:fp,ptnr1_label_atom_id:fp,ptnr1_label_comp_id:fp,ptnr1_label_seq_id:pp,ptnr1_auth_asym_id:fp,ptnr1_auth_comp_id:fp,ptnr1_auth_seq_id:pp,ptnr1_symmetry:fp,ptnr2_label_asym_id:fp,ptnr2_label_atom_id:fp,ptnr2_label_comp_id:fp,ptnr2_label_seq_id:pp,ptnr2_auth_asym_id:fp,ptnr2_auth_comp_id:fp,ptnr2_auth_seq_id:pp,ptnr2_symmetry:fp,pdbx_ptnr1_PDB_ins_code:fp,pdbx_ptnr1_label_alt_id:fp,pdbx_ptnr1_standard_comp_id:fp,pdbx_ptnr2_PDB_ins_code:fp,pdbx_ptnr2_label_alt_id:fp,pdbx_ptnr3_PDB_ins_code:fp,pdbx_ptnr3_label_alt_id:fp,pdbx_ptnr3_label_asym_id:fp,pdbx_ptnr3_label_atom_id:fp,pdbx_ptnr3_label_comp_id:fp,pdbx_ptnr3_label_seq_id:pp,pdbx_PDB_id:fp,pdbx_dist_value:gp,pdbx_value_order:bp(vp)},struct_conn_type:{criteria:fp,id:bp(vp),reference:fp},struct_keywords:{entry_id:fp,text:wp(",",(r=>r)),pdbx_keywords:fp},struct_ncs_oper:{code:bp(fp),details:fp,id:pp,matrix:_p(3,3),vector:xp(3)},struct_sheet_range:{beg_label_asym_id:fp,beg_label_comp_id:fp,beg_label_seq_id:pp,end_label_asym_id:fp,end_label_comp_id:fp,end_label_seq_id:pp,beg_auth_asym_id:fp,beg_auth_comp_id:fp,beg_auth_seq_id:pp,end_auth_asym_id:fp,end_auth_comp_id:fp,end_auth_seq_id:pp,id:fp,sheet_id:fp,pdbx_beg_PDB_ins_code:fp,pdbx_end_PDB_ins_code:fp},struct_site:{details:fp,id:fp,pdbx_num_residues:pp,pdbx_evidence_code:fp,pdbx_auth_asym_id:fp,pdbx_auth_comp_id:fp,pdbx_auth_seq_id:fp,pdbx_auth_ins_code:fp},struct_site_gen:{details:fp,id:fp,label_alt_id:fp,label_asym_id:fp,label_atom_id:fp,label_comp_id:fp,label_seq_id:pp,auth_asym_id:fp,auth_comp_id:fp,auth_seq_id:fp,site_id:fp,symmetry:fp,pdbx_auth_ins_code:fp,pdbx_num_res:pp},symmetry:{entry_id:fp,cell_setting:bp(vp),Int_Tables_number:pp,space_group_name_Hall:fp,"space_group_name_H-M":fp},pdbx_database_status:{status_code:bp(fp),status_code_sf:bp(fp),status_code_mr:bp(fp),entry_id:fp,recvd_initial_deposition_date:fp,SG_entry:bp(vp),deposit_site:bp(fp),process_site:bp(fp),status_code_cs:bp(fp),methods_development_category:bp(fp),pdb_format_compatible:bp(vp)},pdbx_nonpoly_scheme:{asym_id:fp,entity_id:fp,mon_id:fp,pdb_strand_id:fp,ndb_seq_num:fp,pdb_seq_num:fp,auth_seq_num:fp,pdb_mon_id:fp,auth_mon_id:fp,pdb_ins_code:fp},pdbx_database_related:{db_name:fp,details:fp,db_id:fp,content_type:bp(fp)},pdbx_entity_nonpoly:{entity_id:fp,comp_id:fp,name:fp},pdbx_chem_comp_synonyms:{name:fp,comp_id:fp,provenance:bp(fp)},pdbx_chem_comp_identifier:{comp_id:fp,identifier:fp,type:bp(fp),program:fp,program_version:fp},pdbx_unobs_or_zero_occ_residues:{id:pp,polymer_flag:bp(vp),occupancy_flag:bp(pp),PDB_model_num:pp,auth_asym_id:fp,auth_comp_id:fp,auth_seq_id:fp,PDB_ins_code:fp,label_asym_id:fp,label_comp_id:fp,label_seq_id:pp},pdbx_struct_mod_residue:{id:pp,auth_asym_id:fp,auth_comp_id:fp,auth_seq_id:pp,PDB_ins_code:fp,label_asym_id:fp,label_comp_id:fp,label_seq_id:pp,parent_comp_id:fp,details:fp},pdbx_struct_oper_list:{id:fp,type:bp(fp),name:fp,symmetry_operation:fp,matrix:_p(3,3),vector:xp(3)},pdbx_struct_assembly:{method_details:fp,oligomeric_details:fp,oligomeric_count:pp,details:fp,id:fp},pdbx_struct_assembly_gen:{asym_id_list:wp(",",(r=>r)),assembly_id:fp,oper_expression:fp},pdbx_reference_entity_list:{prd_id:fp,ref_entity_id:fp,type:bp(vp),details:fp,component_id:pp},pdbx_reference_entity_link:{link_id:pp,prd_id:fp,details:fp,ref_entity_id_1:fp,ref_entity_id_2:fp,entity_seq_num_1:pp,entity_seq_num_2:pp,comp_id_1:fp,comp_id_2:fp,atom_id_1:fp,atom_id_2:fp,value_order:bp(vp),component_1:pp,component_2:pp,link_class:bp(fp)},pdbx_reference_entity_poly_link:{link_id:pp,prd_id:fp,ref_entity_id:fp,component_id:pp,entity_seq_num_1:pp,entity_seq_num_2:pp,comp_id_1:fp,comp_id_2:fp,atom_id_1:fp,atom_id_2:fp,value_order:bp(vp)},pdbx_molecule:{prd_id:fp,instance_id:pp,asym_id:fp},pdbx_molecule_features:{prd_id:fp,class:bp(vp),type:bp(vp),name:fp,details:fp},entity_src_nat:{entity_id:fp,pdbx_organism_scientific:fp,pdbx_plasmid_name:fp,pdbx_src_id:pp,pdbx_beg_seq_num:pp,pdbx_end_seq_num:pp},entity_src_gen:{entity_id:fp,pdbx_gene_src_gene:wp(",",(r=>r)),pdbx_gene_src_scientific_name:fp,plasmid_name:fp,pdbx_src_id:pp,pdbx_beg_seq_num:pp,pdbx_end_seq_num:pp},pdbx_entity_src_syn:{organism_scientific:fp,entity_id:fp,pdbx_src_id:pp,pdbx_beg_seq_num:pp,pdbx_end_seq_num:pp},pdbx_entity_branch_descriptor:{entity_id:fp,descriptor:fp,type:bp(vp),program:fp,program_version:fp,ordinal:pp},pdbx_entity_instance_feature:{details:fp,feature_type:bp(fp),auth_asym_id:fp,asym_id:fp,auth_seq_num:fp,seq_num:pp,comp_id:fp,auth_comp_id:fp,ordinal:pp},pdbx_entity_branch_list:{entity_id:fp,hetero:bp(vp),comp_id:fp,num:pp},pdbx_entity_branch_link:{link_id:pp,details:fp,entity_id:fp,entity_branch_list_num_1:pp,entity_branch_list_num_2:pp,comp_id_1:fp,comp_id_2:fp,atom_id_1:fp,leaving_atom_id_1:fp,atom_stereo_config_1:bp(vp),atom_id_2:fp,leaving_atom_id_2:fp,atom_stereo_config_2:bp(vp),value_order:bp(vp)},pdbx_entity_branch:{entity_id:fp,type:bp(fp)},pdbx_branch_scheme:{entity_id:fp,hetero:bp(vp),asym_id:fp,mon_id:fp,num:pp,pdb_asym_id:fp,pdb_seq_num:fp,pdb_mon_id:fp,auth_asym_id:fp,auth_seq_num:fp,auth_mon_id:fp},pdbx_chem_comp_related:{comp_id:fp,related_comp_id:fp,relationship_type:bp(fp),details:fp},ihm_starting_model_details:{starting_model_id:fp,entity_id:fp,entity_description:fp,asym_id:fp,entity_poly_segment_id:pp,starting_model_source:bp(fp),starting_model_auth_asym_id:fp,starting_model_sequence_offset:pp,dataset_list_id:pp},ihm_starting_comparative_models:{id:pp,starting_model_id:fp,starting_model_auth_asym_id:fp,starting_model_seq_id_begin:pp,starting_model_seq_id_end:pp,template_auth_asym_id:fp,template_seq_id_begin:pp,template_seq_id_end:pp,template_sequence_identity:gp,template_sequence_identity_denominator:bp(pp),template_dataset_list_id:pp,alignment_file_id:pp},ihm_starting_model_seq_dif:{id:pp,entity_id:fp,asym_id:fp,seq_id:pp,comp_id:fp,starting_model_id:fp,db_asym_id:fp,db_seq_id:pp,db_comp_id:fp,details:fp},ihm_model_representation:{id:pp,name:fp,details:fp},ihm_model_representation_details:{id:pp,representation_id:pp,entity_poly_segment_id:pp,entity_id:fp,entity_description:fp,entity_asym_id:fp,model_object_primitive:bp(fp),starting_model_id:fp,model_mode:bp(fp),model_granularity:bp(fp),model_object_count:pp},ihm_struct_assembly_details:{id:pp,assembly_id:pp,parent_assembly_id:pp,entity_description:fp,entity_id:fp,asym_id:fp,entity_poly_segment_id:pp},ihm_struct_assembly:{id:pp,name:fp,description:fp},ihm_modeling_protocol:{id:pp,num_steps:pp,protocol_name:fp},ihm_modeling_protocol_details:{id:pp,protocol_id:pp,step_id:pp,struct_assembly_id:pp,dataset_group_id:pp,struct_assembly_description:fp,step_name:fp,step_method:fp,num_models_begin:pp,num_models_end:pp,multi_scale_flag:bp(vp),multi_state_flag:bp(vp),ordered_flag:bp(vp),script_file_id:pp,software_id:pp},ihm_multi_state_modeling:{state_id:pp,state_group_id:pp,population_fraction:gp,population_fraction_sd:gp,state_type:fp,state_name:fp,experiment_type:bp(fp),details:fp},ihm_modeling_post_process:{id:pp,protocol_id:pp,analysis_id:pp,step_id:pp,type:bp(fp),feature:bp(fp),num_models_begin:pp,num_models_end:pp},ihm_ensemble_info:{ensemble_id:pp,ensemble_name:fp,post_process_id:pp,model_group_id:pp,ensemble_clustering_method:bp(fp),ensemble_clustering_feature:bp(fp),num_ensemble_models:pp,num_ensemble_models_deposited:pp,ensemble_precision_value:gp,ensemble_file_id:pp},ihm_model_list:{model_id:pp,model_name:fp,assembly_id:pp,protocol_id:pp,representation_id:pp},ihm_model_group:{id:pp,name:fp,details:fp},ihm_model_group_link:{model_id:pp,group_id:pp},ihm_model_representative:{id:pp,model_group_id:pp,model_id:pp,selection_criteria:bp(fp)},ihm_dataset_list:{id:pp,data_type:bp(fp),database_hosted:bp(vp)},ihm_dataset_group:{id:pp,name:fp,application:bp(fp),details:fp},ihm_dataset_group_link:{dataset_list_id:pp,group_id:pp},ihm_related_datasets:{dataset_list_id_derived:pp,dataset_list_id_primary:pp},ihm_dataset_related_db_reference:{id:pp,dataset_list_id:pp,db_name:bp(fp),accession_code:fp,version:fp,details:fp},ihm_external_reference_info:{reference_id:pp,reference_provider:fp,reference_type:bp(fp),reference:fp,refers_to:bp(fp),associated_url:fp},ihm_external_files:{id:pp,reference_id:pp,file_path:fp,content_type:bp(fp),file_size_bytes:gp,details:fp},ihm_dataset_external_reference:{id:pp,dataset_list_id:pp,file_id:pp},ihm_localization_density_files:{id:pp,file_id:pp,ensemble_id:pp,entity_id:fp,entity_poly_segment_id:pp,asym_id:fp},ihm_predicted_contact_restraint:{id:pp,group_id:pp,entity_id_1:fp,entity_id_2:fp,asym_id_1:fp,asym_id_2:fp,comp_id_1:fp,comp_id_2:fp,seq_id_1:pp,seq_id_2:pp,rep_atom_1:bp(fp),rep_atom_2:bp(fp),distance_lower_limit:gp,distance_upper_limit:gp,probability:gp,restraint_type:bp(fp),model_granularity:bp(fp),dataset_list_id:pp,software_id:pp},ihm_cross_link_list:{id:pp,group_id:pp,entity_description_1:fp,entity_description_2:fp,entity_id_1:fp,entity_id_2:fp,comp_id_1:fp,comp_id_2:fp,seq_id_1:pp,seq_id_2:pp,linker_type:bp(fp),dataset_list_id:pp},ihm_cross_link_restraint:{id:pp,group_id:pp,entity_id_1:fp,entity_id_2:fp,asym_id_1:fp,asym_id_2:fp,comp_id_1:fp,comp_id_2:fp,seq_id_1:pp,seq_id_2:pp,atom_id_1:fp,atom_id_2:fp,restraint_type:bp(fp),conditional_crosslink_flag:bp(fp),model_granularity:bp(fp),distance_threshold:gp,psi:gp,sigma_1:gp,sigma_2:gp},ihm_cross_link_result_parameters:{id:pp,restraint_id:pp,model_id:pp,psi:gp,sigma_1:gp,sigma_2:gp},ihm_2dem_class_average_restraint:{id:pp,dataset_list_id:pp,number_raw_micrographs:pp,pixel_size_width:gp,pixel_size_height:gp,image_resolution:gp,image_segment_flag:bp(vp),number_of_projections:pp,struct_assembly_id:pp,details:fp},ihm_2dem_class_average_fitting:{id:pp,restraint_id:pp,model_id:pp,cross_correlation_coefficient:gp,rot_matrix:_p(3,3),tr_vector:xp(3)},ihm_3dem_restraint:{id:pp,dataset_list_id:pp,model_id:pp,struct_assembly_id:pp,fitting_method:fp,number_of_gaussians:pp,cross_correlation_coefficient:gp},ihm_sas_restraint:{id:pp,dataset_list_id:pp,model_id:pp,struct_assembly_id:pp,profile_segment_flag:bp(vp),fitting_atom_type:fp,fitting_method:fp,fitting_state:bp(fp),radius_of_gyration:gp,chi_value:gp,details:fp},ihm_starting_model_coord:{ordinal_id:pp,starting_model_id:fp,group_PDB:bp(fp),id:pp,type_symbol:fp,entity_id:fp,atom_id:fp,comp_id:fp,seq_id:pp,asym_id:fp,Cartn_x:gp,Cartn_y:gp,Cartn_z:gp,B_iso_or_equiv:gp},ihm_sphere_obj_site:{id:pp,entity_id:fp,seq_id_begin:pp,seq_id_end:pp,asym_id:fp,Cartn_x:gp,Cartn_y:gp,Cartn_z:gp,object_radius:gp,rmsf:gp,model_id:pp},ihm_gaussian_obj_site:{id:pp,entity_id:fp,seq_id_begin:pp,seq_id_end:pp,asym_id:fp,mean_Cartn_x:gp,mean_Cartn_y:gp,mean_Cartn_z:gp,weight:gp,covariance_matrix:_p(3,3),model_id:pp},ihm_gaussian_obj_ensemble:{id:pp,entity_id:fp,seq_id_begin:pp,seq_id_end:pp,asym_id:fp,mean_Cartn_x:gp,mean_Cartn_y:gp,mean_Cartn_z:gp,weight:gp,covariance_matrix:_p(3,3),ensemble_id:pp},ihm_feature_list:{feature_id:pp,feature_type:bp(fp),entity_type:bp(fp)},ihm_poly_residue_feature:{ordinal_id:pp,feature_id:pp,entity_id:fp,asym_id:fp,comp_id_begin:fp,comp_id_end:fp,seq_id_begin:pp,seq_id_end:pp},ihm_derived_distance_restraint:{id:pp,group_id:pp,feature_id_1:pp,feature_id_2:pp,group_conditionality:bp(fp),random_exclusion_fraction:gp,distance_upper_limit:gp,restraint_type:bp(fp),dataset_list_id:pp},ma_model_list:{ordinal_id:pp,model_id:pp,model_group_id:pp,model_name:fp,model_group_name:fp,model_type:bp(fp),data_id:pp},ma_target_entity:{entity_id:fp,data_id:pp,origin:bp(fp)},ma_target_entity_instance:{asym_id:fp,entity_id:fp,details:fp},ma_target_ref_db_details:{target_entity_id:fp,db_name:bp(fp),db_code:fp,db_accession:fp,seq_db_isoform:fp,seq_db_align_begin:fp,seq_db_align_end:fp,ncbi_taxonomy_id:fp,organism_scientific:fp},ma_data:{id:pp,content_type:bp(fp),content_type_other_details:fp,name:fp},ma_software_group:{ordinal_id:pp,group_id:pp,software_id:pp},ma_qa_metric:{id:pp,name:fp,type:bp(fp),mode:bp(fp),software_group_id:pp},ma_qa_metric_global:{ordinal_id:pp,model_id:pp,metric_id:pp,metric_value:gp},ma_qa_metric_local:{ordinal_id:pp,model_id:pp,label_asym_id:fp,label_seq_id:pp,label_comp_id:fp,metric_id:pp,metric_value:gp}};var Sp=sm.Schema;const Cp=Sp.str,Pp=Sp.float,Ip=Sp.List,kp=Sp.lstr,Mp=Sp.Aliased,Tp=Sp.int,Dp=Sp.coord,Bp={chem_comp:{formula:Cp,formula_weight:Pp,id:Cp,mon_nstd_parent_comp_id:Ip(",",(r=>r)),name:Cp,one_letter_code:Cp,three_letter_code:Cp,type:Mp(kp),pdbx_synonyms:Ip(";",(r=>r)),pdbx_type:Cp,pdbx_ambiguous_flag:Cp,pdbx_replaced_by:Cp,pdbx_replaces:Cp,pdbx_formal_charge:Tp,pdbx_model_coordinates_details:Cp,pdbx_model_coordinates_db_code:Cp,pdbx_ideal_coordinates_details:Cp,pdbx_ideal_coordinates_missing_flag:Mp(kp),pdbx_model_coordinates_missing_flag:Mp(kp),pdbx_initial_date:Cp,pdbx_modified_date:Cp,pdbx_release_status:Mp(Cp),pdbx_processing_site:Mp(Cp)},chem_comp_atom:{alt_atom_id:Cp,atom_id:Cp,charge:Tp,model_Cartn_x:Dp,model_Cartn_y:Dp,model_Cartn_z:Dp,comp_id:Cp,type_symbol:Cp,pdbx_align:Tp,pdbx_ordinal:Tp,pdbx_model_Cartn_x_ideal:Dp,pdbx_model_Cartn_y_ideal:Dp,pdbx_model_Cartn_z_ideal:Dp,pdbx_stereo_config:Mp(kp),pdbx_aromatic_flag:Mp(kp),pdbx_leaving_atom_flag:Mp(kp)},chem_comp_bond:{atom_id_1:Cp,atom_id_2:Cp,comp_id:Cp,value_order:Mp(kp),pdbx_ordinal:Tp,pdbx_stereo_config:Mp(kp),pdbx_aromatic_flag:Mp(kp)},pdbx_chem_comp_descriptor:{comp_id:Cp,descriptor:Cp,type:Mp(kp),program:Cp,program_version:Cp},pdbx_chem_comp_identifier:{comp_id:Cp,identifier:Cp,type:Mp(Cp),program:Cp,program_version:Cp}};var Fp=sm.Schema;const Ep=Fp.str,$p=Fp.float,Op=Fp.lstr,Rp=Fp.Aliased,Lp=Fp.int,Np={pdbx_reference_molecule:{prd_id:Ep,formula_weight:$p,formula:Ep,type:Rp(Op),type_evidence_code:Ep,class:Rp(Op),class_evidence_code:Ep,name:Ep,represent_as:Rp(Op),chem_comp_id:Ep,compound_details:Ep,description:Ep,representative_PDB_id_code:Ep,release_status:Rp(Op),replaces:Ep,replaced_by:Ep},pdbx_reference_entity_list:{prd_id:Ep,ref_entity_id:Ep,type:Rp(Op),details:Ep,component_id:Lp},pdbx_reference_entity_nonpoly:{prd_id:Ep,ref_entity_id:Ep,name:Ep,chem_comp_id:Ep},pdbx_reference_entity_link:{link_id:Lp,prd_id:Ep,details:Ep,ref_entity_id_1:Ep,ref_entity_id_2:Ep,entity_seq_num_1:Lp,entity_seq_num_2:Lp,comp_id_1:Ep,comp_id_2:Ep,atom_id_1:Ep,atom_id_2:Ep,value_order:Rp(Op),component_1:Lp,component_2:Lp,link_class:Rp(Ep)},pdbx_reference_entity_poly_link:{link_id:Lp,prd_id:Ep,ref_entity_id:Ep,component_id:Lp,entity_seq_num_1:Lp,entity_seq_num_2:Lp,comp_id_1:Ep,comp_id_2:Ep,atom_id_1:Ep,atom_id_2:Ep,value_order:Rp(Op)},pdbx_reference_entity_poly:{prd_id:Ep,ref_entity_id:Ep,type:Rp(Ep),db_code:Ep,db_name:Ep},pdbx_reference_entity_poly_seq:{prd_id:Ep,ref_entity_id:Ep,mon_id:Ep,parent_mon_id:Ep,num:Lp,observed:Rp(Op),hetero:Rp(Op)},pdbx_reference_entity_sequence:{prd_id:Ep,ref_entity_id:Ep,type:Rp(Ep),NRP_flag:Rp(Ep),one_letter_codes:Ep},pdbx_reference_entity_src_nat:{prd_id:Ep,ref_entity_id:Ep,ordinal:Lp,organism_scientific:Ep,taxid:Ep,db_code:Ep,db_name:Ep},pdbx_prd_audit:{prd_id:Ep,date:Ep,processing_site:Rp(Ep),action_type:Rp(Ep)}};var zp=sm.Schema;const Up=zp.str,Vp={datablock:{id:Up,description:Up},dictionary:{title:Up,datablock_id:Up,version:Up},dictionary_history:{version:Up,update:Up,revision:Up},sub_category:{id:Up,description:Up},category_group_list:{id:Up,parent_id:Up,description:Up},item_type_list:{code:Up,primitive_code:Up,construct:Up,detail:Up},item_units_list:{code:Up,detail:Up},item_units_conversion:{from_code:Up,to_code:Up,operator:Up,factor:zp.float}};var jp=sm.Schema;const Gp=jp.str,Hp=jp.int,qp=jp.float,Wp=jp.Aliased,Xp=jp.Vector;Wp(Gp),Wp(Gp),Wp(Gp),Wp(Gp),Xp(3),Xp(3);const Yp={volume_data_3d_info:{name:Gp,axis_order:Xp(3,Hp),origin:Xp(3),dimensions:Xp(3),sample_rate:Hp,sample_count:Xp(3,Hp),spacegroup_number:Hp,spacegroup_cell_size:Xp(3),spacegroup_cell_angles:Xp(3),mean_source:qp,mean_sampled:qp,sigma_source:qp,sigma_sampled:qp,min_source:qp,min_sampled:qp,max_source:qp,max_sampled:qp},volume_data_3d:{values:qp}};var Kp=sm.Schema;const Zp=Kp.float,Qp=Kp.int,Jp=Kp.str,tg={cell:{angle_alpha:Zp,angle_beta:Zp,angle_gamma:Zp,formula_units_z:Qp,length_a:Zp,length_b:Zp,length_c:Zp,volume:Zp},chemical:{melting_point:Zp,name_common:Jp,name_systematic:Jp},chemical_formula:{moiety:Jp,sum:Jp,weight:Zp},space_group:{crystal_system:Jp,it_number:Qp,"name_h-m_full":Jp},space_group_symop:{operation_xyz:Jp},geom_bond:{atom_site_label_1:Jp,atom_site_label_2:Jp,distance:Zp,publ_flag:Jp,site_symmetry_1:Jp,site_symmetry_2:Jp,valence:Zp},audit:{block_doi:Jp},database_code:{cod:Jp,csd:Jp,depnum_ccdc_archive:Jp,depnum_ccdc_fiz:Jp,icsd:Jp,mdf:Jp,nbs:Jp},atom_site:{adp_type:Jp,calc_flag:Jp,disorder_assembly:Jp,disorder_group:Jp,fract_x:Zp,fract_y:Zp,fract_z:Zp,label:Jp,occupancy:Zp,refinement_flags:Jp,site_symmetry_multiplicity:Qp,type_symbol:Jp,u_iso_or_equiv:Zp},atom_site_aniso:{label:Jp,u_11:Zp,u:(0,Kp.Matrix)(3,3),u_12:Zp,u_13:Zp,u_22:Zp,u_23:Zp,u_33:Zp},atom_type:{description:Jp,symbol:Jp},atom_type_scat:{dispersion_imag:Zp,dispersion_real:Zp,source:Jp}},eg={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},ig=sm.Schema.int,rg={volume_data_3d_info:Yp.volume_data_3d_info,segmentation_data_table:{set_id:ig,segment_id:ig},segmentation_data_3d:{values:ig}},ng={parse:r=>typeof r=="string"?Bf(r):rp(r),parseText:Bf,parseBinary:rp,toDatabaseCollection:function(r,e,t){const n={};for(const i of e.blocks)n[i.header]=sp(r,i,t);return n},toDatabase:sp,schema:{mmCIF:r=>sp(Ap,r),CCD:r=>sp(Bp,r),BIRD:r=>sp(Np,r),dic:r=>sp(Vp,r),cifCore:r=>sp(tg,r,eg),densityServer:r=>sp(Yp,r),segmentation:r=>sp(rg,r)}};class sg{constructor(e,t){var n=t||{};this.streamer=e,this.name=nt(n.name,""),this.path=nt(n.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then((()=>Nl(this,void 0,void 0,(function*(){return yield this._beforeParse(),yield this._parse(),yield this._afterParse(),this[this.__objName]}))))}_parse(){}_beforeParse(){}_afterParse(){De&&ke.log(this[this.__objName])}}class og extends sg{constructor(e,t){var n=t||{};super(e,n),this.firstModelOnly=nt(n.firstModelOnly,!1),this.asTrajectory=nt(n.asTrajectory,!1),this.cAlphaOnly=nt(n.cAlphaOnly,!1),this.structure=new Sc(this.name,this.path),this.structureBuilder=new Na(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}class ag{constructor(e,t,n="",i,s=[]){this.structure=e,this.index=t,this.description=n,this.entityType=(function(o){switch(o=o.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}})(i||""),this.chainIndexList=s,s.forEach((function(o){e.chainStore.entityIndex[o]=t}))}get type(){return(function(e){switch(e){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}})(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return this.entityType===1}isNonPolymer(){return this.entityType===2}isMacrolide(){return this.entityType===3}isWater(){return this.entityType===4}eachChain(e){const t=this.structure.getChainProxy();this.chainIndexList.forEach((function(n){t.index=n,e(t)}))}}const cg={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class lg{constructor(e=cg){this.cartToFrac=new Matrix4,this.fracToCart=new Matrix4,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;const t=It(this.alpha),n=It(this.beta),i=It(this.gamma),s=Math.cos(t),o=Math.cos(n),a=Math.cos(i),l=Math.sin(n),d=Math.sin(i);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-s*s-o*o-a*a+2*s*o*a),e.cartToFrac===void 0){const u=this.a*this.b*d/this.volume,g=(o*a-s)/(l*d);this.fracToCart.set(this.a,0,0,0,this.b*a,this.b*d,0,0,this.c*o,-this.c*l*g,1/u,0,0,0,0,1).transpose(),this.cartToFrac.copy(this.fracToCart).invert()}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.copy(this.cartToFrac).invert()}getPosition(e){const t=new Float32Array(24);if(e.unitcell){const n=e.unitcell,i=e.center.clone().applyMatrix4(n.cartToFrac).floor(),s=new Vector3;let o=0;const a=function(l,d,u){s.set(l,d,u).add(i).applyMatrix4(n.fracToCart).toArray(t,o),o+=3};a(0,0,0),a(1,0,0),a(0,1,0),a(0,0,1),a(1,1,0),a(1,0,1),a(0,1,1),a(1,1,1)}return t}getCenter(e){return(function(t,n=new Vector3){const i=t.length;for(let s=0;s<i;s+=3)n.x+=t[s],n.y+=t[s+1],n.z+=t[s+2];return n.divideScalar(i/3),n})(this.getPosition(e))}getData(e,t={}){const n=nt(t.colorValue,"orange"),i=nt(t.radius,Math.cbrt(this.volume)/200),s=new Color(n),o=new Vector3,a=this.getPosition(e),l=Si(8,s.r,s.g,s.b),d=Ai(8,i),u=new Float32Array(36),g=new Float32Array(36),x=Si(12,s.r,s.g,s.b),y=Ai(12,i);let b=0;function _(f,E){o.fromArray(a,3*f).toArray(u,b),o.fromArray(a,3*E).toArray(g,b),b+=3}_(0,1),_(0,2),_(0,3),_(1,4),_(1,5),_(2,6),_(3,5),_(4,7),_(5,7),_(2,4),_(7,6),_(3,6);const h=new ro(this,e);return{vertex:{position:a,color:l,radius:d,picking:h},edge:{position1:u,position2:g,color:x,color2:x,radius:y,picking:h}}}}const hg={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},ug=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],dg=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],mg=/\s+/;function fg(r,e,t){let n=`${r}`;return e&&(n+=`:${e}`),t&&(n+=`^${t}`),n}class pg extends og{constructor(e,t){const n=t||{};super(e,n),this.hex=nt(n.hex,!1),this.inferBonds=nt(n.inferBonds,"all")}get type(){return"pdb"}_parse(){De&&ke.time("PdbParser._parse "+this.name);let e=!1;const t=this.streamer.peekLines(1)[0],n=t.substr(62,4),i=t.substr(72,4);n===i&&i.trim()&&(e=!0);const s=this.type==="pqr",o=this.type==="pdbqt",a=this.structure,l=this.structureBuilder,d=this.hex;let u=10,g=10;const x=this.firstModelOnly,y=this.asTrajectory,b=this.cAlphaOnly,_=a.frames,h=a.boxes;let f,E,m=!1;const S=a.biomolDict;let w,v,A,M,T,R,O,L,P,I,N,U,F,k,j,H,B,V,Y,K,J,Te,He={};const Q={},Xe={},ut=[];let Ji,er;const ec={},ai={},u0={};let o0,E0,F0,g0,w0,L0,T0;const ht={};let We;const h0={helices:[],sheets:[]},M0=h0.helices,Z=h0.sheets,tt=a.atomMap,tr=a.atomStore;tr.resize(Math.round(this.streamer.data.length/80)),(s||o)&&tr.addField("partialCharge",1,"float32"),s&&tr.addField("radius",1,"float32");const s0=a.getAtomProxy(),c0=a.getAtomProxy();let A0=0,P0=0,Fe=!0;this.streamer.eachChunkOfLines((function(v0){(function(D0,l0,y0){for(let lt=D0;lt<l0;++lt)if(M=y0[lt],T=M.substr(0,6),T==="ATOM  "||T==="HETATM"){if(Fe&&(y?(m?(f=new Float32Array(3*tr.count),_.push(f)):f=[],E=0):x||(He={}),o0=1,E0=o0.toString(),F0=!0,Fe=!1),x&&P0>0)continue;let oi,b0,W,e0,a0,hi=0;if(s){if(e0=M.split(mg),hi=e0.length===10?1:0,U=e0[2],b&&U!=="CA")continue;oi=parseFloat(e0[6-hi]),b0=parseFloat(e0[7-hi]),W=parseFloat(e0[8-hi])}else{if(U=M.substr(12,4).trim(),b&&U!=="CA")continue;oi=parseFloat(M.substr(30,8)),b0=parseFloat(M.substr(38,8)),W=parseFloat(M.substr(46,8))}if(y){const O0=3*E;if(f[O0+0]=oi,f[O0+1]=b0,f[O0+2]=W,E+=1,m)continue}s?(R=parseInt(e0[1]),a0="",F=M[0]==="H",O=hi?"":e0[4],L=parseInt(e0[5-hi]),N="",P=e0[3],j="",I=1):(R=parseInt(M.substr(6,5),u),d&&R===99999&&(u=16),F=M[0]==="H",O=M[21].trim(),L=parseInt(M.substr(22,4),g),d&&L===9999&&(g=16),N=M[26].trim(),P=M.substr(17,4).trim()||"MOL",k=parseFloat(M.substr(60,6)),j=M[16].trim(),I=parseFloat(M.substr(54,6)),e||(o?(a0=M.substr(76,3).trim(),a0 in ms&&(a0=ms[a0])):(a0=M.substr(76,2).trim(),O||(O=M.substr(72,4).trim())),H=parseInt((M.substr(79,1)+M.substr(78,1)).trim()))),tr.growIfFull(),tr.atomTypeId[A0]=tt.add(U,a0),tr.x[A0]=oi,tr.y[A0]=b0,tr.z[A0]=W,tr.serial[A0]=R,tr.altloc[A0]=j.charCodeAt(0),tr.occupancy[A0]=isNaN(I)?0:I,s?(tr.partialCharge[A0]=parseFloat(e0[9-hi]),tr.radius[A0]=parseFloat(e0[10-hi])):(tr.bfactor[A0]=isNaN(k)?0:k,o&&(tr.partialCharge[A0]=parseFloat(M.substr(70,6))),isFinite(H)&&(tr.formalCharge||tr.addField("formalCharge",1,"int8"),tr.formalCharge[A0]=H));const p0=fg(L,O,N);!F||ai[p0]||ug.includes(P)?F0||g0===O||(o0+=1,E0=o0.toString()):g0===O&&L0===P&&(as.includes(P)||w0===L&&T0===N)||(o0+=1,E0=o0.toString(),w0=L,L0=P,T0=N),l.addAtom(P0,O,E0,P,L,F,void 0,N),He[R]=A0,A0+=1,F0=!1,g0=O}else if(T==="CONECT"){const oi=He[parseInt(M.substr(6,5))],b0=[11,16,21,26],W={};if(oi===void 0)continue;for(let e0=0;e0<4;++e0){let a0=parseInt(M.substr(b0[e0],5));if(!Number.isNaN(a0)&&(a0=He[a0],a0!==void 0))if(oi<a0?(s0.index=oi,c0.index=a0):(s0.index=a0,c0.index=oi),W[a0]!==void 0)a.bondStore.bondOrder[W[a0]]+=1;else{const hi=s0.index+"|"+c0.index;Xe[hi]===void 0&&(Xe[hi]=!0,W[a0]=a.bondStore.count,a.bondStore.addBond(s0,c0,1))}}}else if(T==="HELIX "){B=M[19].trim(),V=parseInt(M.substr(21,4)),Y=M[25].trim(),K=M[31].trim(),J=parseInt(M.substr(33,4)),Te=M[37].trim();let oi=parseInt(M.substr(39,1));oi=(hg[oi]||hg[0]).charCodeAt(0),M0.push([B,V,Y,K,J,Te,oi])}else if(T==="SHEET ")B=M[21].trim(),V=parseInt(M.substr(22,4)),Y=M[26].trim(),K=M[32].trim(),J=parseInt(M.substr(33,4)),Te=M[37].trim(),Z.push([B,V,Y,K,J,Te]);else if(T==="HETNAM")ec[M.substr(11,3)]=M.substr(15).trim();else if(T==="SEQRES"){const oi=M[11].trim();oi!==We&&(ht[oi]=[],We=oi),ht[oi].push(...M.substr(19).trim().split(mg))}else if(T==="MODRES"){const oi=M.substr(12,3).trim(),b0=M[16].trim(),W=M[22].trim(),e0=parseInt(M.substr(18,4).trim()),a0=fg(e0,b0,W);ai[a0]={resname:oi,chainname:b0,inscode:W,resno:e0}}else if(T==="COMPND"){const oi=M.substr(10,70).trim(),b0=oi.indexOf(":"),W=oi.substring(0,b0);let e0;dg.includes(W)?(er=W,e0=oi.substring(b0+2)):e0=oi,e0=e0.replace(/;$/,""),er==="MOL_ID"?(Ji={chainList:[],name:""},ut.push(Ji)):er==="MOLECULE"?(Ji.name&&(Ji.name+=" "),Ji.name+=e0):er==="CHAIN"&&Array.prototype.push.apply(Ji.chainList,e0.split(/\s*,\s*/))}else if(M.startsWith("TER")){const oi=a.getChainProxy(a.chainStore.count-1);u0[oi.chainname]=oi.index,o0+=1,E0=o0.toString(),F0=!0}else if(T==="REMARK"&&M.substr(7,3)==="350"){if(M.substr(11,12)==="BIOMOLECULE:"){let oi=M.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(oi)&&(oi="BU"+oi),w=new Ra(oi),S[oi]=w}else if(M.substr(13,5)==="BIOMT"){const oi=M.split(/\s+/),b0=parseInt(M[18])-1;b0===0&&(A=new Matrix4,v.matrixList.push(A));const W=A.elements;W[0+b0]=parseFloat(oi[4]),W[4+b0]=parseFloat(oi[5]),W[8+b0]=parseFloat(oi[6]),W[12+b0]=parseFloat(oi[7])}else if(M.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||M.substr(11,30)==="                   AND CHAINS:"){M.substr(11,5)==="APPLY"&&(v=w.addPart());const oi=M.substr(41,30).split(",");for(let b0=0,W=oi.length;b0<W;++b0){const e0=oi[b0].trim();e0&&v.chainList.push(e0)}}}else if(T==="HEADER")a.id=M.substr(62,4);else if(T==="TITLE ")a.title+=(a.title?" ":"")+M.substr(10,70).trim();else if(T==="MODEL ")Fe=!0;else if(T==="ENDMDL"||M.trim()==="END"){if(Fe)continue;y&&!m&&(_.push(new Float32Array(f)),m=!0),P0+=1,Fe=!0}else if(M.substr(0,5)==="MTRIX"){if(M[59]==="1")continue;(!w||w.name!=="NCS")&&(w=new Ra("NCS"),S.NCS=w,v=w.addPart());const oi=M.split(/\s+/),b0=parseInt(M[5])-1;b0===0&&(A=new Matrix4,v.matrixList.push(A));const W=A.elements;W[0+b0]=parseFloat(oi[2]),W[4+b0]=parseFloat(oi[3]),W[8+b0]=parseFloat(oi[4]),W[12+b0]=parseFloat(oi[5])}else if(M.substr(0,5)==="ORIGX"){Q.origx||(Q.origx=new Matrix4);const oi=M.split(/\s+/),b0=parseInt(M[5])-1,W=Q.origx.elements;W[0+b0]=parseFloat(oi[1]),W[4+b0]=parseFloat(oi[2]),W[8+b0]=parseFloat(oi[3]),W[12+b0]=parseFloat(oi[4])}else if(M.substr(0,5)==="SCALE"){Q.scale||(Q.scale=new Matrix4);const oi=M.split(/\s+/),b0=parseInt(M[5])-1,W=Q.scale.elements;W[0+b0]=parseFloat(oi[1]),W[4+b0]=parseFloat(oi[2]),W[8+b0]=parseFloat(oi[3]),W[12+b0]=parseFloat(oi[4])}else if(T==="CRYST1"){const oi=parseFloat(M.substr(6,9)),b0=parseFloat(M.substr(15,9)),W=parseFloat(M.substr(24,9)),e0=parseFloat(M.substr(33,7)),a0=parseFloat(M.substr(40,7)),hi=parseFloat(M.substr(47,7)),p0=M.substr(55,11).trim(),O0=new Float32Array(9);O0[0]=oi,O0[4]=b0,O0[8]=W,h.push(O0),P0===0&&(Q.a=oi,Q.b=b0,Q.c=W,Q.alpha=e0,Q.beta=a0,Q.gamma=hi,Q.spacegroup=p0)}})(0,v0.length,v0)})),l.finalize();const f0=ut.length;if(f0){a.eachChain((function(y0){y0.entityIndex=f0})),ut.forEach((function(y0,lt){const oi=y0.chainList.map((function(b0){return u0[b0]}));a.entityList.push(new ag(a,lt,y0.name,"polymer",oi))}));let v0=ut.length;const D0=a.getResidueProxy(),l0={};a.eachChain((function(y0){y0.entityIndex===f0&&(D0.index=y0.residueOffset,l0[D0.resname]||(l0[D0.resname]=[]),l0[D0.resname].push(y0.index))})),Object.keys(l0).forEach((function(y0){const lt=l0[y0];let oi="non-polymer",b0=ec[y0]||y0;as.includes(y0)&&(b0="water",oi="water"),a.entityList.push(new ag(a,v0,b0,oi,lt)),v0+=1}))}Q.a!==void 0?a.unitcell=new lg(Q):a.unitcell=void 0,(M0.length||Z.length)&&za(a,h0),a.finalizeAtoms(),e||Ga(a),Ha(a,this.inferBonds),a.finalizeBonds(),M0.length||Z.length||Ua(a),Ka(a),De&&ke.timeEnd("PdbParser._parse "+this.name)}}Ne.add("pdb",pg),Ne.add("pdb1",pg),Ne.add("ent",pg);class gg{constructor(e){this.structure=e,this.dict={},this.structure=e}add(e,t,n){this.dict[e]={chemCompType:t},n&&(this.dict[e].bonds=n)}addBond(e,t,n,i){const s=this.dict[e];if(!s)return;s.bonds||(s.bonds={atom1:[],atom2:[],bondOrders:[]});const o=s.bonds;o.atom1.push(t),o.atom2.push(n),o.bondOrders.push(i)}getBonds(e,t){var n;const i=(n=this.dict[e])===null||n===void 0?void 0:n.bonds;if(!i)return;const s=this.structure.atomMap,o=new Map(t.map(((x,y)=>{var b;return[(b=s.get(x))===null||b===void 0?void 0:b.atomname,y]}))),a=[],l=[],d=[];let u,g;for(let x=0;x<i.atom1.length;x++)(u=o.get(i.atom1[x]))!==void 0&&(g=o.get(i.atom2[x]))!==void 0&&(a.push(u),l.push(g),d.push(i.bondOrders[x]));return{atomIndices1:a,atomIndices2:l,bondOrders:d}}}const yg=/^\D{1,2}/,bg={HELX_RH_AL_P:"h",STRN:"e",HELX_RH_3T_P:"g",HELX_RH_PI_P:"i",HELX_LH_PP_P:"e",TURN_TY1_P:"t",BEND:"s",OTHER:" "},_g={AROM:1,DELO:2,DIRECTED:0,DOUB:2,PI:0,POLY:0,QUAD:4,SING:1,TRIP:3};function xg(r){switch(r.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}class vg extends og{get type(){return"cif"}get isBinary(){return!1}_parse(){var e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w;return Nl(this,void 0,void 0,(function*(){ke.time("CifParser._parse "+this.name);const v=this.structure,A=this.structureBuilder,M=this.firstModelOnly,T=this.asTrajectory,R=v.frames;let O,L;const P=this.isBinary?ng.parseBinary(this.streamer.data):ng.parseText(this.streamer.compressed?gt(this.streamer.data):this.streamer.data),I=yield P.run();if(I.isError)throw I;const N=I.result.blocks[0];if("chem_comp"in N.categories&&"chem_comp_atom"in N.categories&&!("struct"in N.categories))(function(U,F,k){const j=F.atomStore,H=F.atomMap;let B,V;const Y=U.chem_comp,K=U.chem_comp_atom,J=U.chem_comp_bond;let Te;Y&&((Te=Y.getField("name"))&&(F.title=Te.str(0)),(Te=Y.getField("id"))&&(F.id=Te.str(0)));const He={};if(K){let Q,Xe,ut,Ji;V=K.rowCount,j.resize(2*V);const er=K.getField("atom_id"),ec=K.getField("type_symbol"),ai=K.getField("pdbx_component_comp_id"),u0=K.getField("pdbx_residue_numbering");[["model_Cartn_x","model_Cartn_y","model_Cartn_z"],["pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal"]].forEach((([o0,E0,F0],g0)=>{var w0;const L0=K.getField(o0),T0=K.getField(E0),ht=K.getField(F0),We=g0*V;for(let h0=0;h0<V;++h0){const M0=h0+We;j.growIfFull(),Q=er?.str(h0),Xe=ec?.str(h0),He[Q]=h0,j.atomTypeId[M0]=H.add(Q,Xe),j.x[M0]=L0.float(h0),j.y[M0]=T0.float(h0),j.z[M0]=ht.float(h0),j.serial[M0]=h0,ut=ai.str(h0),Ji=(w0=u0?.int(h0))!==null&&w0!==void 0?w0:1,k.addAtom(g0,"","",ut,Ji,!0)}}))}if(K&&J){let Q,Xe,ut;V=J.rowCount;const Ji=K.rowCount,er=F.getAtomProxy(),ec=F.getAtomProxy(),ai=J.getField("atom_id_1"),u0=J.getField("atom_id_2"),o0=J.getField("value_order");for(B=0;B<V;++B)Q=ai.str(B),Xe=u0.str(B),ut=xg(o0.str(B)),er.index=He[Q],ec.index=He[Xe],F.bondStore.growIfFull(),F.bondStore.addBond(er,ec,ut),er.index+=Ji,ec.index+=Ji,F.bondStore.growIfFull(),F.bondStore.addBond(er,ec,ut)}})(N.categories,v,A),A.finalize(),v.finalizeAtoms(),v.finalizeBonds(),tc(v);else if("atom_site_type_symbol"in N.categories&&"atom_site_label"in N.categories&&"atom_site_fract_x"in N.categories)(function(U,F,k){var j,H,B=F.atomStore,V=F.atomMap;U.header&&(F.id=U.header,F.name=U.header),F.unitcell=new lg({a:U.getField("cell_length_a").float(0),b:U.getField("cell_length_b").float(0),c:U.getField("cell_length_c").float(0),alpha:U.getField("cell_angle_alpha").float(0),beta:U.getField("cell_angle_beta").float(0),gamma:U.getField("cell_angle_gamma").float(0),spacegroup:U.getField("symmetry_space_group_name_H-M").str(0)});const Y=new Vector3,K=new Vector3,J=U.getField("atom_site_type_symbol");if(!J)return;const Te=(j=J.rowCount)!==null&&j!==void 0?j:0,He=U.getField("atom_site_type_symbol"),Q=U.getField("atom_site_fract_x"),Xe=U.getField("atom_site_fract_y"),ut=U.getField("atom_site_fract_z"),Ji=U.getField("atom_site_occupancy"),er={};for(let g0=0;g0<Te;++g0){B.growIfFull();const w0=He.str(g0),L0=J.str(g0);let T0=er[L0];if(!T0){const ht=L0.match(yg);er[L0]=T0=(H=ht?.[0])!==null&&H!==void 0?H:L0}B.atomTypeId[g0]=V.add(w0,T0),Y.set(Q.float(g0),Xe.float(g0),ut.float(g0)),Y.applyMatrix4(F.unitcell.fracToCart),K.add(Y),B.x[g0]=Y.x,B.y[g0]=Y.y,B.z[g0]=Y.z,Ji&&(B.occupancy[g0]=Ji.float(g0)),B.serial[g0]=g0,k.addAtom(0,"","","HET",1,!0)}K.divideScalar(Te),F.center=K,Ka(F);const ec=new Vector3,ai=new Vector3,u0=F.biomolDict.SUPERCELL.partList[0].matrixList;let o0=Te;function E0(g0){return V.get(B.atomTypeId[g0]).covalent}const F0=new Matrix4;for(let g0=0;g0<Te;++g0){const w0=E0(g0);Y.set(B.x[g0],B.y[g0],B.z[g0]),u0.forEach((function(L0){if(!F0.equals(L0)){ec.copy(Y),ec.applyMatrix4(L0);for(let T0=0;T0<Te;++T0){ai.set(B.x[T0],B.y[T0],B.z[T0]);const ht=ec.distanceToSquared(ai),We=E0(T0)+w0,h0=We+.3,M0=We-.5;if(ht<h0*h0&&ht>M0*M0)return B.growIfFull(),B.atomTypeId[o0]=B.atomTypeId[g0],B.x[o0]=ec.x,B.y[o0]=ec.y,B.z[o0]=ec.z,B.occupancy[o0]=B.occupancy[g0],B.serial[o0]=o0,B.altloc[o0]=65,k.addAtom(0,"","","HET",1,!0),void(o0+=1)}}}))}})(N,v,A),A.finalize(),v.finalizeAtoms(),Ha(v),v.finalizeBonds();else{const U={},F={},k=v.atomMap,j=v.atomStore,H=N.categories.atom_site;let B=H.rowCount;const V=H.getField("pdbx_PDB_model_num");if(!((e=V?.areValuesEqual(0,B-1))===null||e===void 0||e)&&(T||M)){const g0=V.int(0);for(let w0=0;w0<B;w0++)if(V.int(w0)>g0){B=w0;break}}v.chemCompMap=new gg(v);const Y=N.categories.chem_comp;let K=Y.getField("id");const J=Y.getField("type");for(let g0=0;g0<Y.rowCount;g0++)v.chemCompMap.add(K.str(g0),J.str(g0).toUpperCase());if(N.categoryNames.includes("chem_comp_bond")){const g0=N.categories.chem_comp_bond;K=g0.getField("comp_id");const w0=g0.getField("atom_id_1"),L0=g0.getField("atom_id_2"),T0=g0.getField("value_order");for(let ht=0;ht<g0.rowCount;ht++){const We=_g[T0.str(ht)];We&&v.chemCompMap.addBond(K.str(ht),w0.str(ht),L0.str(ht),We)}}const Te=(g0,w0,L0)=>{const T0=g0.getField(w0);return T0?T0.toFloatArray({array:Float32Array,start:0,end:L0}):new Float32Array(L0)};j.resize(B),j.x=Te(H,"Cartn_x",B),j.y=Te(H,"Cartn_y",B),j.z=Te(H,"Cartn_z",B),j.serial=H.getField("id").toIntArray({start:0,end:B}),j.bfactor=Te(H,"B_iso_or_equiv",B),j.occupancy=Te(H,"occupancy",B);const He=H.getField("label_alt_id");He?.isDefined&&(j.altloc=Uint8Array.from(He.toStringArray(),(g0=>g0.charCodeAt(0))));const Q=H.getField("label_atom_id"),Xe=H.getField("type_symbol");K=H.getField("label_comp_id");const ut=(t=H.getField("auth_seq_id"))!==null&&t!==void 0?t:H.getField("label_seq_id"),Ji=H.getField("pdbx_PDB_ins_code"),er=H.getField("auth_asym_id"),ec=H.getField("label_asym_id"),ai=H.getField("group_PDB"),u0=H.getField("label_entity_id");for(let g0=0;g0<B;g0++){const w0=(n=V?.int(g0))!==null&&n!==void 0?n:1,L0=(i=er?.str(g0))!==null&&i!==void 0?i:"",T0=(s=ec?.str(g0))!==null&&s!==void 0?s:"",ht=(o=K?.str(g0))!==null&&o!==void 0?o:"",We=(a=ut?.int(g0))!==null&&a!==void 0?a:0,h0=ai?.str(g0)[0]==="H",M0=(l=Ji?.str(g0))!==null&&l!==void 0?l:"",Z=(d=u0?.int(g0))!==null&&d!==void 0?d:1;j.atomTypeId[g0]=k.add(Q?.str(g0)||"",Xe?.str(g0)),A.addAtom(w0-1,L0,T0,ht,We,h0,void 0,M0),U[T0]=L0,F[Z]||(F[Z]=new Set),F[Z].add(v.chainStore.count-1)}if(T){const g0=H.rowCount/B|0,w0=H.getField("Cartn_x"),L0=H.getField("Cartn_y"),T0=H.getField("Cartn_z");for(let ht=0;ht<g0;ht++){O=new Float32Array(3*B);const We=ht*B,h0=We+B;L=0;for(let M0=We;M0<h0;M0++)O[L+0]=w0.float(M0),O[L+1]=L0.float(M0),O[L+2]=T0.float(M0),L+=3;R.push(O)}}const o0=(function(g0,w0,L0){var T0,ht,We,h0,M0,Z;const tt=[],tr=[];let s0,c0,A0,P0;const Fe=g0.struct_conf;if(Fe?.fieldNames.includes("pdbx_PDB_helix_class")){const v0=Fe.getField("pdbx_beg_PDB_ins_code"),D0=Fe.getField("pdbx_end_PDB_ins_code"),l0=Fe.getField("pdbx_PDB_helix_class"),y0=Fe.getField("beg_label_asym_id"),lt=Fe.getField("end_label_asym_id"),oi=Fe.getField("beg_auth_seq_id"),b0=Fe.getField("end_auth_seq_id");for(s0=0,c0=Fe.rowCount;s0<c0;++s0){const W=l0?.int(s0);Number.isFinite(W)&&(A0=(T0=v0?.str(s0))!==null&&T0!==void 0?T0:"",P0=(ht=D0?.str(s0))!==null&&ht!==void 0?ht:"",tt.push([L0[y0.str(s0)],oi.int(s0),A0,L0[lt.str(s0)],b0.int(s0),P0,(hg[W]||hg[0]).charCodeAt(0)]))}}else if(Fe?.fieldNames.includes("conf_type_id")){const v0=Fe.getField("conf_type_id"),D0=Fe.getField("pdbx_beg_PDB_ins_code"),l0=Fe.getField("pdbx_end_PDB_ins_code"),y0=Fe.getField("beg_label_asym_id"),lt=Fe.getField("end_label_asym_id"),oi=Fe.getField("beg_auth_seq_id"),b0=Fe.getField("end_auth_seq_id");let W;for(s0=0,c0=Fe.rowCount;s0<c0;++s0){const e0=v0.str(s0);(W=bg[e0])&&(A0=(We=D0?.str(s0))!==null&&We!==void 0?We:"",P0=(h0=l0?.str(s0))!==null&&h0!==void 0?h0:"",W==="h"||W==="g"||W==="i"?tt.push([L0[y0.str(s0)],oi.int(s0),A0,L0[lt.str(s0)],b0.int(s0),P0,W.charCodeAt(0)]):W==="e"&&tr.push([L0[y0.str(s0)],oi.int(s0),A0,L0[lt.str(s0)],b0.int(s0),P0]))}}const f0=g0.struct_sheet_range;if(f0&&tr.length===0){const v0=f0.getField("pdbx_beg_PDB_ins_code"),D0=f0.getField("pdbx_end_PDB_ins_code"),l0=f0.getField("beg_label_asym_id"),y0=f0.getField("end_label_asym_id"),lt=f0.getField("beg_auth_seq_id"),oi=f0.getField("end_auth_seq_id");for(s0=0,c0=f0.rowCount;s0<c0;++s0)A0=(M0=v0?.str(s0))!==null&&M0!==void 0?M0:"",P0=(Z=D0?.str(s0))!==null&&Z!==void 0?Z:"",tr.push([L0[l0.str(s0)],lt.int(s0),A0,L0[y0.str(s0)],oi.int(s0),P0])}return!(!Fe&&!f0)&&{helices:tt,sheets:tr}})(N.categories,0,U);let E0,F0;if((function(g0,w0,L0){const T0={},ht=w0.biomolDict;if(g0.pdbx_struct_oper_list){const Z=g0.pdbx_struct_oper_list,tt=Z.getField("id"),tr=Z.getField("matrix[1][1]"),s0=Z.getField("matrix[1][2]"),c0=Z.getField("matrix[1][3]"),A0=Z.getField("matrix[2][1]"),P0=Z.getField("matrix[2][2]"),Fe=Z.getField("matrix[2][3]"),f0=Z.getField("matrix[3][1]"),v0=Z.getField("matrix[3][2]"),D0=Z.getField("matrix[3][3]"),l0=Z.getField("vector[1]"),y0=Z.getField("vector[2]"),lt=Z.getField("vector[3]");for(let oi=0;oi<Z.rowCount;oi++){const b0=new Matrix4,W=b0.elements;W[0]=tr.float(oi),W[1]=s0.float(oi),W[2]=c0.float(oi),W[4]=A0.float(oi),W[5]=P0.float(oi),W[6]=Fe.float(oi),W[8]=f0.float(oi),W[9]=v0.float(oi),W[10]=D0.float(oi),W[3]=l0.float(oi),W[7]=y0.float(oi),W[11]=lt.float(oi),b0.transpose(),T0[tt.str(oi)]=b0}}if(g0.pdbx_struct_assembly_gen){const Z=g0.pdbx_struct_assembly_gen,tt=function(A0){const P0={};return A0.replace(/[()']/g,"").split(",").forEach((function(Fe){if(Fe.includes("-"))for(var f0=Fe.split("-"),v0=parseInt(f0[0]),D0=parseInt(f0[1]);v0<=D0;++v0)P0[v0]=T0[v0];else P0[Fe]=T0[Fe]})),P0},tr=Z.getField("assembly_id"),s0=Z.getField("oper_expression"),c0=Z.getField("asym_id_list");for(let A0=0;A0<Z.rowCount;A0++){const P0=tr.int(A0);let Fe={},f0=s0.str(A0).replace(/['"]\(|['"]/g,"");if(f0.includes(")(")||f0.indexOf("(")>0){const[y0,lt]=f0.split("(").filter((W=>!!W)),oi=tt(y0),b0=tt(lt);Object.keys(oi).forEach((function(W){Object.keys(b0).forEach((function(e0){const a0=new Matrix4;a0.multiplyMatrices(oi[W],b0[e0]),Fe[W+"x"+e0]=a0}))}))}else Fe=tt(f0);const v0=[];for(let y0 in Fe)v0.push(Fe[y0]);let D0=""+P0;/^(0|[1-9][0-9]*)$/.test(D0)&&(D0="BU"+D0);const l0=c0.str(A0).split(",").map((y0=>L0[y0]));ht[D0]===void 0&&(ht[D0]=new Ra(D0)),ht[D0].addPart(v0,l0)}}if(g0.struct_ncs_oper){const Z=g0.struct_ncs_oper,tt="NCS";ht[tt]=new Ra(tt);const tr=ht[tt].addPart(),s0=Z.getField("code"),c0=Z.getField("matrix[1][1]"),A0=Z.getField("matrix[1][2]"),P0=Z.getField("matrix[1][3]"),Fe=Z.getField("matrix[2][1]"),f0=Z.getField("matrix[2][2]"),v0=Z.getField("matrix[2][3]"),D0=Z.getField("matrix[3][1]"),l0=Z.getField("matrix[3][2]"),y0=Z.getField("matrix[3][3]"),lt=Z.getField("vector[1]"),oi=Z.getField("vector[2]"),b0=Z.getField("vector[3]");for(let W=0;W<Z.rowCount;W++){if(s0.str(W)==="given")return;const e0=new Matrix4,a0=e0.elements;a0[0]=c0.float(W),a0[1]=A0.float(W),a0[2]=P0.float(W),a0[4]=Fe.float(W),a0[5]=f0.float(W),a0[6]=v0.float(W),a0[8]=D0.float(W),a0[9]=l0.float(W),a0[10]=y0.float(W),a0[3]=lt.float(W),a0[7]=oi.float(W),a0[11]=b0.float(W),e0.transpose(),tr.matrixList.push(e0)}tr.matrixList.length===0&&delete ht[tt]}const We={};if(g0.cell){const Z=g0.cell,tt=Z.getField("length_a").float(0),tr=Z.getField("length_b").float(0),s0=Z.getField("length_c").float(0),c0=new Float32Array(9);c0[0]=tt,c0[4]=tr,c0[8]=s0,w0.boxes.push(c0),We.a=tt,We.b=tr,We.c=s0,We.alpha=Z.getField("angle_alpha").float(0),We.beta=Z.getField("angle_beta").float(0),We.gamma=Z.getField("angle_gamma").float(0)}g0.symmetry&&(We.spacegroup=g0.symmetry.getField("space_group_name_H-M").str(0));const h0=new Matrix4;if(g0.database_PDB_matrix){const Z=g0.database_PDB_matrix,tt=h0.elements,tr=Z.getField("origx[1][1]"),s0=Z.getField("origx[1][2]"),c0=Z.getField("origx[1][3]"),A0=Z.getField("origx[2][1]"),P0=Z.getField("origx[2][2]"),Fe=Z.getField("origx[2][3]"),f0=Z.getField("origx[3][1]"),v0=Z.getField("origx[3][2]"),D0=Z.getField("origx[3][3]"),l0=Z.getField("origx_vector[1]"),y0=Z.getField("origx_vector[2]"),lt=Z.getField("origx_vector[3]");tt[0]=tr.float(0),tt[1]=s0.float(0),tt[2]=c0.float(0),tt[4]=A0.float(0),tt[5]=P0.float(0),tt[6]=Fe.float(0),tt[8]=f0.float(0),tt[9]=v0.float(0),tt[10]=D0.float(0),tt[3]=l0.float(0),tt[7]=y0.float(0),tt[11]=lt.float(0),h0.transpose(),We.origx=h0}const M0=new Matrix4;if(g0.atom_sites){const Z=g0.atom_sites,tt=M0.elements,tr=Z.getField("fract_transf_matrix[1][1]"),s0=Z.getField("fract_transf_matrix[1][2]"),c0=Z.getField("fract_transf_matrix[1][3]"),A0=Z.getField("fract_transf_matrix[2][1]"),P0=Z.getField("fract_transf_matrix[2][2]"),Fe=Z.getField("fract_transf_matrix[2][3]"),f0=Z.getField("fract_transf_matrix[3][1]"),v0=Z.getField("fract_transf_matrix[3][2]"),D0=Z.getField("fract_transf_matrix[3][3]"),l0=Z.getField("fract_transf_vector[1]"),y0=Z.getField("fract_transf_vector[2]"),lt=Z.getField("fract_transf_vector[3]");tt[0]=tr.float(0),tt[1]=s0.float(0),tt[2]=c0.float(0),tt[4]=A0.float(0),tt[5]=P0.float(0),tt[6]=Fe.float(0),tt[8]=f0.float(0),tt[9]=v0.float(0),tt[10]=D0.float(0),tt[3]=l0.float(0),tt[7]=y0.float(0),tt[11]=lt.float(0),M0.transpose(),We.scale=M0}We.a!==void 0?w0.unitcell=new lg(We):w0.unitcell=void 0})(N.categories,v,U),(function(g0,w0,L0){const T0=g0.struct_conn;if(T0){const h0=w0.getAtomProxy(),M0=w0.getAtomProxy(),Z={},tt=T0.getField("conn_type_id"),tr=T0.getField("ptnr1_symmetry"),s0=T0.getField("pdbx_ptnr1_PDB_ins_code"),c0=T0.getField("pdbx_ptnr1_label_alt_id"),A0=T0.getField("ptnr1_auth_seq_id"),P0=T0.getField("ptnr1_label_asym_id"),Fe=T0.getField("ptnr1_label_atom_id"),f0=T0.getField("ptnr2_symmetry"),v0=T0.getField("pdbx_ptnr2_PDB_ins_code"),D0=T0.getField("pdbx_ptnr2_label_alt_id"),l0=T0.getField("ptnr2_auth_seq_id"),y0=T0.getField("ptnr2_label_asym_id"),lt=T0.getField("ptnr2_label_atom_id"),oi=T0.getField("pdbx_value_order");for(let b0=0,W=T0.rowCount;b0<W;++b0){const e0=tt.str(b0);if(e0==="hydrog"||e0==="mismat"||e0==="saltbr"||tr.str(b0)!=="1_555"||f0.str(b0)!=="1_555")continue;const a0=s0.str(b0),hi=c0.str(b0),p0=A0.str(b0)+(a0?"^"+a0:"")+":"+L0[P0.str(b0)]+"."+Fe.str(b0)+(hi?"%"+hi:"");let O0=Z[p0];if(!O0){const i0=new me(p0);if(i0.selection.error){De&&ke.warn("invalid selection for connection",p0);continue}O0=w0.getAtomIndices(i0),Z[p0]=O0}const q=v0.str(b0),it=D0.str(b0),at=l0.str(b0)+(q?"^"+q:"")+":"+L0[y0.str(b0)]+"."+lt.str(b0)+(it?"%"+it:"");let t0=Z[at];if(!t0){const i0=new me(at);if(i0.selection.error){De&&ke.warn("invalid selection for connection",at);continue}t0=w0.getAtomIndices(i0),Z[at]=t0}var ht=O0.length,We=t0.length;if(ht>We&&([ht,We]=[We,ht],[O0,t0]=[t0,O0]),ht!==0&&We!==0)for(let i0=0;i0<We;++i0)h0.index=O0[i0%ht],M0.index=t0[i0],h0&&M0?w0.bondStore.addBond(h0,M0,xg(oi.str(b0))):ke.log("atoms for connection not found");else De&&ke.warn("no atoms found for",p0,at)}}})(N.categories,v,U),(function(g0,w0,L0){var T0;if(g0.entity){const ht=g0.entity,We=ht.getField("id"),h0=ht.getField("pdbx_description"),M0=ht.getField("type"),Z=ht.rowCount;for(let tt=0;tt<Z;++tt){const tr=Array.from((T0=L0[We.int(tt)])!==null&&T0!==void 0?T0:[]);w0.entityList[tt]=new ag(w0,tt,h0?.str(tt),M0.str(tt),tr)}}})(N.categories,v,F),(E0=(u=N.categories.struct)===null||u===void 0?void 0:u.getField("title"))&&(F0=E0.str(0))&&(v.title=F0),(E0=(g=N.categories.entry)===null||g===void 0?void 0:g.getField("id"))&&(F0=E0.str(0))&&(v.id=F0),N.categories.pdbx_audit_revision_history){if(E0=(x=N.categories.pdbx_audit_revision_history)===null||x===void 0?void 0:x.getField("revision_date")){for(let g0=0;g0<E0.rowCount;g0++)if(F0=E0.str(g0)){v.header.releaseDate=F0;break}}if(E0=(y=N.categories.pdbx_database_status)===null||y===void 0?void 0:y.getField("recvd_initial_deposition_date")){for(let g0=0;g0<E0.rowCount;g0++)if(F0=E0.str(g0)){v.header.depositionDate=F0;break}}}else if(N.categories.database_PDB_rev){if(E0=(b=N.categories.database_PDB_rev)===null||b===void 0?void 0:b.getField("date")){for(let g0=0;g0<E0.rowCount;g0++)if(F0=E0.str(g0)){v.header.releaseDate=F0;break}}if(E0=(_=N.categories.database_PDB_rev)===null||_===void 0?void 0:_.getField("date_original")){for(let g0=0;g0<E0.rowCount;g0++)if(F0=E0.str(g0)){v.header.depositionDate=F0;break}}}(E0=(f=(h=N.categories.reflns)===null||h===void 0?void 0:h.getField("d_resolution_high"))!==null&&f!==void 0?f:(E=N.categories.refine)===null||E===void 0?void 0:E.getField("ls_d_res_high"))&&E0.valueKind(0)===0&&(v.header.resolution=E0.float(0)),(E0=(m=N.categories.refine)===null||m===void 0?void 0:m.getField("ls_R_factor_R_free"))&&E0.valueKind(0)===0&&(v.header.rFree=E0.float(0)),(E0=(S=N.categories.refine)===null||S===void 0?void 0:S.getField("ls_R_factor_R_work"))&&E0.valueKind(0)===0&&(v.header.rFree=E0.float(0)),(E0=(w=N.categories.exptl)===null||w===void 0?void 0:w.getField("method"))&&(v.header.experimentalMethods=E0.toStringArray().slice()),A.finalize(),v.finalizeAtoms(),Ha(v),v.finalizeBonds(),o0?za(v,o0):Ua(v),Ka(v),v.extraData.cif=N}De&&ke.timeEnd("CifParser._parse "+this.name)}))}}Ne.add("bcif",class extends vg{get type(){return"bcif"}get isBinary(){return!0}}),Ne.add("cif",vg),Ne.add("mcif",vg),Ne.add("mmcif",vg);Ne.add("gro",class extends og{get type(){return"gro"}_parse(){De&&ke.time("GroParser._parse "+this.name);var r,e,t=this.structure,n=this.structureBuilder,i=this.firstModelOnly,s=this.asTrajectory,o=this.cAlphaOnly,a=t.frames,l=t.boxes,d=this.streamer.peekLines(3);t.title=d[0].trim();var u,g,x,y,b=5+(d[2].length-d[2].lastIndexOf(".")-1),_=20+b,h=20+2*b,f=parseInt(d[1]),E=f+3,m=t.atomMap,S=t.atomStore;S.resize(f);var w=0,v=0,A=0;this.streamer.eachChunkOfLines((function(M){(function(T,R,O){for(var L=T;L<R;++L){var P=++A-1,I=O[L];if(I){if(P%E==0)s&&(r=new Float32Array(3*f),a.push(r),e=0);else if(P%E!=1)if(P%E==E-1){var N=I.trim().split(/\s+/),U=new Float32Array(9);if(U[0]=10*parseFloat(N[0]),U[4]=10*parseFloat(N[1]),U[8]=10*parseFloat(N[2]),l.push(U),i)return!0;v+=1}else{if(u=I.substr(10,5).trim(),o&&u!=="CA")continue;var F=10*parseFloat(I.substr(20,b)),k=10*parseFloat(I.substr(_,b)),j=10*parseFloat(I.substr(h,b));if(s){var H=3*e;if(r[H+0]=F,r[H+1]=k,r[H+2]=j,e+=1,P>E)continue}g=I.substr(5,5).trim(),x=parseInt(I.substr(0,5)),y=parseInt(I.substr(15,5)),S.growIfFull(),S.atomTypeId[w]=m.add(u),S.x[w]=F,S.y[w]=k,S.z[w]=j,S.serial[w]=y,n.addAtom(v,"","",g,x,!1,"l"),w+=1}}}})(0,M.length,M)})),n.finalize(),t.finalizeAtoms(),Ga(t),Ha(t),t.finalizeBonds(),Ua(t),De&&ke.timeEnd("GroParser._parse "+this.name)}});var wg=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function Ag(r,e,t){return e?new r(e.buffer,e.byteOffset,e.byteLength/(t||1)):void 0}function Sg(r){return Ag(DataView,r)}function Cg(r){return Ag(Int8Array,r)}function Pg(r){return Ag(Int32Array,r,4)}function Ig(r,e){var t=r.length/2;e||(e=new Int16Array(t));for(var n=0,i=0;n<t;++n,i+=2)e[n]=r[i]<<8^r[i+1];return e}function kg(r,e){var t=r.length/4;e||(e=new Int32Array(t));for(var n=0,i=0;n<t;++n,i+=4)e[n]=r[i]<<24^r[i+1]<<16^r[i+2]<<8^r[i+3];return e}function Mg(r,e,t){var n=r.length,i=1/e;t||(t=new Float32Array(n));for(var s=0;s<n;++s)t[s]=r[s]*i;return t}function Tg(r,e){var t,n;if(!e){var i=0;for(t=0,n=r.length;t<n;t+=2)i+=r[t+1];e=new r.constructor(i)}var s=0;for(t=0,n=r.length;t<n;t+=2)for(var o=r[t],a=r[t+1],l=0;l<a;++l)e[s]=o,++s;return e}function Dg(r,e){var t=r.length;e||(e=new r.constructor(t)),t&&(e[0]=r[0]);for(var n=1;n<t;++n)e[n]=r[n]+e[n-1];return e}function Bg(r,e){var t,n,i=r instanceof Int8Array?127:32767,s=-i-1,o=r.length;if(!e){var a=0;for(t=0;t<o;++t)r[t]<i&&r[t]>s&&++a;e=new Int32Array(a)}for(t=0,n=0;t<o;){for(var l=0;r[t]===i||r[t]===s;)l+=r[t],++t;l+=r[t],++t,e[n]=l,++n}return e}function Fg(r,e,t){return Mg(Bg(r,Pg(t)),e,t)}function Eg(r,e,t){var n=Bg(r,Pg(t));return(function(i,s,o){return Mg(Dg(i,Pg(o)),s,o)})(n,e,Ag(Float32Array,n,4))}function $g(r){var e=0,t=new DataView(r.buffer);function n(l){for(var d={},u=0;u<l;u++)d[a()]=a();return d}function i(l){var d=r.subarray(e,e+l);return e+=l,d}function s(l){var d=r.subarray(e,e+l);e+=l;var u=65535;if(l>u){for(var g=[],x=0;x<d.length;x+=u)g.push(String.fromCharCode.apply(null,d.subarray(x,x+u)));return g.join("")}return String.fromCharCode.apply(null,d)}function o(l){for(var d=new Array(l),u=0;u<l;u++)d[u]=a();return d}function a(){var l,d,u=r[e];if(!(128&u))return e++,u;if((240&u)==128)return e++,n(d=15&u);if((240&u)==144)return e++,o(d=15&u);if((224&u)==160)return e++,s(d=31&u);if(!(224&~u))return l=t.getInt8(e),e++,l;switch(u){case 192:return e++,null;case 194:return e++,!1;case 195:return e++,!0;case 196:return d=t.getUint8(e+1),e+=2,i(d);case 197:return d=t.getUint16(e+1),e+=3,i(d);case 198:return d=t.getUint32(e+1),e+=5,i(d);case 202:return l=t.getFloat32(e+1),e+=5,l;case 203:return l=t.getFloat64(e+1),e+=9,l;case 204:return l=r[e+1],e+=2,l;case 205:return l=t.getUint16(e+1),e+=3,l;case 206:return l=t.getUint32(e+1),e+=5,l;case 208:return l=t.getInt8(e+1),e+=2,l;case 209:return l=t.getInt16(e+1),e+=3,l;case 210:return l=t.getInt32(e+1),e+=5,l;case 217:return d=t.getUint8(e+1),e+=2,s(d);case 218:return d=t.getUint16(e+1),e+=3,s(d);case 219:return d=t.getUint32(e+1),e+=5,s(d);case 220:return d=t.getUint16(e+1),e+=3,o(d);case 221:return d=t.getUint32(e+1),e+=5,o(d);case 222:return d=t.getUint16(e+1),e+=3,n(d);case 223:return d=t.getUint32(e+1),e+=5,n(d)}throw new Error("Unknown type 0x"+u.toString(16))}return a()}function Og(r,e,t,n){switch(r){case 1:return(function(a,l){var d=a.length;l||(l=new Float32Array(d/4));for(var u=Sg(l),g=Sg(a),x=0,y=0,b=d/4;x<b;++x,y+=4)u.setFloat32(y,g.getFloat32(y),!0);return l})(e);case 2:return Cg(e);case 3:return Ig(e);case 4:return kg(e);case 5:return Ag(Uint8Array,e);case 6:return Tg(kg(e),new Uint8Array(t));case 7:return Tg(kg(e));case 8:return(function(a,l){return Dg(Tg(a),l)})(kg(e));case 9:return i=kg(e),s=kg(n)[0],Mg(Tg(i,Pg(o)),s,o);case 10:return Eg(Ig(e),kg(n)[0]);case 11:return Mg(Ig(e),kg(n)[0]);case 12:return Fg(Ig(e),kg(n)[0]);case 13:return Fg(Cg(e),kg(n)[0]);case 14:return Bg(Ig(e));case 15:return Bg(Cg(e))}var i,s,o}function Rg(r,e){var t=(e=e||{}).ignoreFields,n={};return wg.forEach((function(i){var s,o,a,l,d,u=!!t&&t.indexOf(i)!==-1,g=r[i];u||g===void 0||(g instanceof Uint8Array?n[i]=Og.apply(null,(o=Sg(s=g),a=o.getInt32(0),l=o.getInt32(4),d=s.subarray(8,12),[a,s=s.subarray(12),l,d])):n[i]=g)})),n}const Lg={0:105,1:115,2:104,3:101,4:103,5:98,6:116,7:108,"-1":NaN};Ne.add("mmtf",class extends og{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let r,e,t,n,i;De&&ke.time("MmtfParser._parse "+this.name);const s=this.structure,o=Rg($g(this.streamer.data));let a,l,d,u,g,x;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach((function(k){o[k]!==void 0&&(s.header[k]=o[k])})),s.id=o.structureId,s.title=o.title,s.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(g=1,u=o.chainsPerModel[0],d=0,r=0,e=u;r<e;++r)d+=o.groupsPerChain[r];for(l=0,r=0,e=d;r<e;++r)i=o.groupList[o.groupTypeList[r]],l+=i.atomNameList.length;a=o.numBonds,x=[u]}else a=o.numBonds,l=o.numAtoms,d=o.numGroups,u=o.numChains,g=o.numModels,x=o.chainsPerModel;if(a+=d,this.asTrajectory)for(r=0,e=o.numModels;r<e;++r){const k=new Float32Array(3*l),j=l*r;for(t=0;t<l;++t){const H=3*t,B=t+j;k[H]=o.xCoordList[B],k[H+1]=o.yCoordList[B],k[H+2]=o.zCoordList[B]}s.frames.push(k)}const y=new Uint32Array(a),b=new Uint32Array(a),_=new Uint8Array(a),h=new Uint32Array(l),f=new Int8Array(l),E=new Uint32Array(d),m=new Uint32Array(d),S=new Uint32Array(d),w=new Uint16Array(u),v=new Uint32Array(u),A=new Uint32Array(u),M=new Uint32Array(g),T=new Uint32Array(g);let R=0;for(r=0,e=g;r<e;++r){const k=x[r];for(M[r]=R,T[r]=k,t=0;t<k;++t)w[t+R]=r;R+=k}const O=o.groupsPerChain;let L=0;for(r=0,e=u;r<e;++r){const k=O[r];for(v[r]=L,A[r]=k,t=0;t<k;++t)E[t+L]=r;L+=k}let P=0,I=0;for(r=0,e=d;r<e;++r){i=o.groupList[o.groupTypeList[r]];const k=i.atomNameList.length,j=i.formalChargeList,H=i.bondAtomList,B=i.bondOrderList;for(t=0,n=B.length;t<n;++t)y[I]=P+H[2*t],b[I]=P+H[2*t+1],_[I]=B[t],I+=1;for(m[r]=P,S[r]=k,t=0;t<k;++t)h[P]=r,f[P]=j[t],P+=1}const N=o.bondAtomList;if(N)for(o.bondOrderList&&_.set(o.bondOrderList,I),r=0,e=N.length;r<e;r+=2){const k=N[r],j=N[r+1];k<l&&j<l&&(y[I]=k,b[I]=j,I+=1)}s.bondStore.length=_.length,s.bondStore.count=I,s.bondStore.atomIndex1=y,s.bondStore.atomIndex2=b,s.bondStore.bondOrder=_,s.atomStore.length=l,s.atomStore.count=l,s.atomStore.residueIndex=h,s.atomStore.atomTypeId=new Uint16Array(l),s.atomStore.x=o.xCoordList.subarray(0,l),s.atomStore.y=o.yCoordList.subarray(0,l),s.atomStore.z=o.zCoordList.subarray(0,l),s.atomStore.serial=o.atomIdList.subarray(0,l),s.atomStore.bfactor=o.bFactorList.subarray(0,l),s.atomStore.altloc=o.altLocList.subarray(0,l),s.atomStore.occupancy=o.occupancyList.subarray(0,l),s.atomStore.formalCharge=f,s.residueStore.length=d,s.residueStore.count=d,s.residueStore.chainIndex=E,s.residueStore.residueTypeId=o.groupTypeList,s.residueStore.atomOffset=m,s.residueStore.atomCount=S,s.residueStore.resno=o.groupIdList.subarray(0,d),s.residueStore.sstruc=o.secStructList.subarray(0,d),s.residueStore.inscode=o.insCodeList.subarray(0,d),s.chainStore.length=u,s.chainStore.count=u,s.chainStore.entityIndex=new Uint16Array(u),s.chainStore.modelIndex=w,s.chainStore.residueOffset=v,s.chainStore.residueCount=A,s.chainStore.chainname=o.chainNameList.subarray(0,4*u),s.chainStore.chainid=o.chainIdList.subarray(0,4*u),s.modelStore.length=g,s.modelStore.count=g,s.modelStore.chainOffset=M,s.modelStore.chainCount=T;let U={};for(r=0,e=o.groupList.length;r<e;++r){const k=o.groupList[r],j=[];for(t=0,n=k.atomNameList.length;t<n;++t){const Te=k.elementList[t].toUpperCase(),He=k.atomNameList[t];j.push(s.atomMap.add(He,Te))}const H=k.chemCompType.toUpperCase(),B=Gn.includes(H),V=k.bondOrderList.length,Y=new Array(V),K=new Array(V);for(t=0;t<V;++t)Y[t]=k.bondAtomList[2*t],K[t]=k.bondAtomList[2*t+1];const J={atomIndices1:Y,atomIndices2:K,bondOrders:k.bondOrderList};U[r]=s.residueMap.add(k.groupName,j,B,H,J)}for(r=0,e=d;r<e;++r)s.residueStore.residueTypeId[r]=U[s.residueStore.residueTypeId[r]];for(r=0,e=s.atomStore.count;r<e;++r){const k=s.atomStore.residueIndex[r],j=s.residueMap.list[s.residueStore.residueTypeId[k]],H=s.residueStore.atomOffset[k];s.atomStore.atomTypeId[r]=j.atomTypeIdList[r-H]}if(o.secStructList){const k=o.secStructList.length;for(r=0,e=s.residueStore.count;r<e;++r){const j=Lg[s.residueStore.sstruc[r%k]];j!==void 0&&(s.residueStore.sstruc[r]=j)}}if(o.entityList&&o.entityList.forEach((function(k,j){s.entityList[j]=new ag(s,j,k.description,k.type,k.chainIndexList)})),o.bioAssemblyList&&o.bioAssemblyList.forEach((function(k,j){const H=j+1,B=new Ra(""+H);s.biomolDict["BU"+H]=B;let V={};k.transformList.forEach((function(Y){const K=new Matrix4().fromArray(Y.matrix).transpose(),J=Y.chainIndexList.map((function(He){let Q="";for(let Xe=0;Xe<4;++Xe){const ut=o.chainNameList[4*He+Xe];if(!ut)break;Q+=String.fromCharCode(ut)}return Q})),Te=V[J.toString()];Te?Te.matrixList.push(K):V[J.toString()]=B.addPart([K],J)}))})),o.ncsOperatorList){const j=new Ra("NCS"),H=j.addPart();o.ncsOperatorList.forEach((function(B){const V=new Matrix4().fromArray(B).transpose();H.matrixList.push(V)})),H.matrixList.length>0&&(s.biomolDict.NCS=j)}const F=o.unitCell;F&&Array.isArray(F)&&F[0]?s.unitcell=new lg({a:F[0],b:F[1],c:F[2],alpha:F[3],beta:F[4],gamma:F[5],spacegroup:o.spaceGroup}):s.unitcell=void 0,Ya(s,!0),Xa(s,!0),s.finalizeAtoms(),s.finalizeBonds(),Ka(s),De&&ke.timeEnd("MmtfParser._parse "+this.name)}});const Ng=/\s+/,zg={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};Ne.add("mol2",class extends og{get type(){return"mol2"}_parse(){De&&ke.time("Mol2Parser._parse "+this.name);const r=this.structure,e=this.structureBuilder,t=this.firstModelOnly,n=this.asTrajectory,i=r.frames;let s,o,a=!1;const l=r.atomMap,d=r.atomStore;d.resize(Math.round(this.streamer.data.length/60)),d.addField("partialCharge",1,"float32");let u=0,g=0,x=0,y=-1,b=0,_=0;const h=r.getAtomProxy(),f=r.getAtomProxy();this.streamer.eachChunkOfLines((function(E){(function(m,S,w){for(let v=m;v<S;++v){const A=w[v].trim();if(A!==""&&A[0]!=="#"){if(A[0]==="@")A==="@<TRIPOS>MOLECULE"?(_=1,g=0,++y):A==="@<TRIPOS>ATOM"?(_=2,x=d.count,n&&(o=0,s=new Float32Array(3*b),i.push(s),y>0&&(a=!0))):_=A==="@<TRIPOS>BOND"?3:0;else if(_===1){if(g===0)r.title=A,r.id=A;else if(g===1){const M=A.split(Ng);b=parseInt(M[0])}++g}else if(_===2){const M=A.split(Ng);if(t&&y>0)continue;const T=parseFloat(M[2]),R=parseFloat(M[3]),O=parseFloat(M[4]);if(n){const k=3*o;if(s[k+0]=T,s[k+1]=R,s[k+2]=O,o+=1,a)continue}const L=M[0],P=M[1],I=M[5].split(".")[0],N=M[6]?parseInt(M[6]):1,U=M[7]?M[7]:"",F=M[8]?parseFloat(M[8]):0;d.growIfFull(),d.atomTypeId[u]=l.add(P,I),d.x[u]=T,d.y[u]=R,d.z[u]=O,d.serial[u]=+L,d.partialCharge[u]=F,e.addAtom(y,"","",U,N,!0),u+=1}else if(_===3){if(t&&y>0||n&&y>0)continue;const M=A.split(Ng);h.index=parseInt(M[1])-1+x,f.index=parseInt(M[2])-1+x;const T=zg[M[3]];r.bondStore.addBond(h,f,T)}}}})(0,E.length,E)})),e.finalize(),r.finalizeAtoms(),Ga(r),Xa(r,!0),Ya(r,!0),r.finalizeBonds(),tc(r),Ua(r),De&&ke.timeEnd("Mol2Parser._parse "+this.name)}});Ne.add("pdbqt",class extends pg{get type(){return"pdbqt"}});Ne.add("pqr",class extends pg{get type(){return"pqr"}});const Ug=/> +<(.+)>/;class Vg extends og{get type(){return"sdf"}_parse(){De&&ke.time("SdfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=this.firstModelOnly,i=this.asTrajectory,s=this.streamer.peekLines(2);e.id=s[0].trim(),e.title=s[1].trim();const o=e.frames;let a,l,d=!1;const u=e.atomMap,g=e.atomStore;g.resize(Math.round(this.streamer.data.length/50)),g.addField("formalCharge",1,"int8");const x=e.getAtomProxy(),y=e.getAtomProxy();let b=0,_=0,h=0,f=0;const E=[];let m,S,w,v,A,M,T,R,O,L,P,I,N,U,F=!1,k={};e.extraData.sdf=E;let j=!1,H=!1,B=!1,V=[],Y=[];const K=new Map;this.streamer.eachChunkOfLines((function(J){(function(Te,He,Q){for(let Xe=Te;Xe<He;++Xe){const ut=Q[Xe];if(j&&ut&&(V=ut.substring(7).split(" "),Y.length&&(V=[...Y,...V],Y=[]),V[V.length-1]==="-"))V.pop(),Y=V;else{if(ut.substr(0,4)==="$$$$")_=-1,++h,f=g.count,E.push(k),k={},F=!1,j=!1;else if(_===3)j=ut.indexOf(" V3000")>-1,j?K.clear():(S=parseInt(ut.substr(0,3)),w=parseInt(ut.substr(3,3)),v=4,A=v+S,M=A,T=M+w,i&&(l=0,a=new Float32Array(3*S),o.push(a),h>0&&(d=!0)));else if(j&&V[0]==="COUNTS")S=parseInt(V[1]),i&&(l=0,a=new Float32Array(3*S),o.push(a),h>0&&(d=!0));else if(j&&V.length==2)V[1]==="ATOM"?V[0]==="BEGIN"?H=!0:V[0]==="END"&&(H=!1):V[1]==="BOND"&&(V[0]==="BEGIN"?B=!0:V[0]==="END"&&(B=!1));else if(H||!j&&_>=v&&_<A){if(n&&h>0)continue;let Ji=0;if(j){if(R=parseFloat(V[2]),O=parseFloat(V[3]),L=parseFloat(V[4]),I=V[1],N=parseInt(V[0]),K.set(N,b),P=I+N,V.length>6){let er=V.slice(6).find((ec=>ec.indexOf("CHG=")===0));er&&(Ji=parseInt(er.substring(4)))}}else R=parseFloat(ut.substr(0,10)),O=parseFloat(ut.substr(10,10)),L=parseFloat(ut.substr(20,10)),I=ut.substr(31,3).trim(),P=I+(b-f+1);if(i){const er=3*l;if(a[er+0]=R,a[er+1]=O,a[er+2]=L,l+=1,d)continue}g.growIfFull(),g.atomTypeId[b]=u.add(P,I),g.x[b]=R,g.y[b]=O,g.z[b]=L,g.serial[b]=j?N:b,g.formalCharge[b]=Ji,t.addAtom(h,"","","HET",1,!0),b+=1}else if(B||!j&&_>=M&&_<T){if(n&&h>0||i&&h>0)continue;j?(x.index=K.get(parseInt(V[2])),y.index=K.get(parseInt(V[3])),U=parseInt(V[1])):(x.index=parseInt(ut.substr(0,3))-1+f,y.index=parseInt(ut.substr(3,3))-1+f,U=parseInt(ut.substr(6,3))),e.bondStore.addBond(x,y,U)}else if(ut.substr(0,6)==="M  CHG"){const Ji=parseInt(ut.substr(6,3));for(let er=0,ec=10;er<Ji;++er,ec+=8){const ai=parseInt(ut.substr(ec,3))-1+f,u0=parseInt(ut.substr(ec+4,3));g.formalCharge[ai]=u0}}else ut.charAt(0)===">"&&(m=ut.match(Ug))?(F=m[1],k[F]=[]):F!==!1&&ut&&k[F].push(ut);++_}}})(0,J.length,J)})),t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),tc(e),De&&ke.timeEnd("SdfParser._parse "+this.name)}_postProcess(){tc(this.structure)}}Ne.add("sdf",Vg),Ne.add("sd",Vg),Ne.add("mol",Vg);function jg(r,e,t){return parseInt(r.substr(e,t).trim())}class Gg extends og{get type(){return"prmtop"}_parse(){De&&ke.time("PrmtopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,i=e.atomStore;i.addField("partialCharge",1,"float32"),i.addField("radius",1,"float32");const s=[],o={},a=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let l,d,u,g,x;a.forEach((A=>{o[A]=0}));let y,b,_,h,f,E=new Uint8Array(0);this.streamer.eachChunkOfLines((function(A){(function(M,T,R){for(let O=M;O<T;++O){const L=R[O],P=L.trim();if(P&&!L.startsWith("%FORMAT")){if(L.startsWith("%FLAG")){const I=L.substr(5).trim();h=0,I==="TITLE"?_=0:I==="POINTERS"?_=1:I==="ATOM_NAME"?_=2:I==="CHARGE"?_=3:I==="MASS"?_=4:I==="RESIDUE_LABEL"?_=5:I==="RESIDUE_POINTER"?_=6:I==="BONDS_INC_HYDROGEN"?(f=0,_=7):I==="BONDS_WITHOUT_HYDROGEN"?(f=o.NBONH,_=8):_=I==="RADII"?9:void 0}else if(_===0)s.push(P);else if(_===1){const I=Math.min(h+10,32);for(let U=0;h<I;++U,++h)o[a[h]]=parseInt(L.substr(8*U,8).trim());l=new Array(o.NATOM),d=new Float32Array(o.NATOM),u=new Float32Array(o.NATOM),i.resize(o.NATOM);const N=o.NBONH+o.MBONA;g=new Uint32Array(N),x=new Uint32Array(N),E=new Uint8Array(N),y=new Array(o.NRES),b=new Uint32Array(o.NRES)}else if(_===2){const I=Math.min(h+20,o.NATOM);for(let N=0;h<I;++N,++h)l[h]=L.substr(4*N,4).trim()}else if(_===3){const I=Math.min(h+5,o.NATOM);for(let N=0;h<I;++N,++h)d[h]=parseFloat(L.substr(16*N,16))/18.2223}else if(_!==4){if(_===5){const I=Math.min(h+20,o.NRES);for(let N=0;h<I;++N,++h)y[h]=L.substr(4*N,4).trim()}else if(_===6){const I=Math.min(h+10,o.NRES);for(let N=0;h<I;++N,++h)b[h]=jg(L,8*N,8)}else if(_===7){const I=Math.min(h+10,3*o.NBONH);for(let N=0;h<I;++N,++h){const U=h%3;U===0&&(g[f]=jg(L,8*N,8)/3),U===1&&(x[f]=jg(L,8*N,8)/3,E[f]=1,++f)}}else if(_===8){const I=Math.min(h+10,3*o.MBONA);for(let N=0;h<I;++N,++h){const U=h%3;U===0&&(g[f]=jg(L,8*N,8)/3),U===1&&(x[f]=jg(L,8*N,8)/3,E[f]=1,++f)}}else if(_===9){const I=Math.min(h+5,o.NATOM);for(let N=0;h<I;++N,++h)u[h]=parseFloat(L.substr(16*N,16))}}}}})(0,A.length,A)})),e.title=s.join(" ");const m=o.NATOM;let S=0,w=y[0],v=1;for(let A=0;A<m;++A)A+1===b[S+1]&&(++S,w=y[S],v=S+1),i.atomTypeId[A]=n.add(l[A]),i.serial[A]=A+1,t.addAtom(0,"","",w,v,!1);i.partialCharge.set(d),i.radius.set(u),e.bondStore.length=E.length,e.bondStore.count=E.length,e.bondStore.atomIndex1=g,e.bondStore.atomIndex2=x,e.bondStore.bondOrder=E,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),Xa(e,!0),Ya(e,!0,!0),Ga(e,!0),tc(e),De&&ke.timeEnd("PrmtopParser._parse "+this.name)}}Ne.add("prmtop",Gg),Ne.add("parm7",Gg);const Hg=/\s+/,qg=/(^\*|REMARK)*/;Ne.add("psf",class extends og{get type(){return"psf"}_parse(){De&&ke.time("PsfParser._parse "+this.name);const r=this.structure,e=this.structureBuilder,t=r.atomMap,n=r.atomStore;n.addField("partialCharge",1,"float32");const i=[];let s,o,a,l,d,u,g=0,x=0,y=0;this.streamer.eachChunkOfLines((function(b){(function(_,h,f){for(let E=_;E<h;++E){const m=f[E].trim();if(m){if(s===2){const S=m.split(Hg),w=parseInt(S[0]),v=S[1],A=parseInt(S[2]),M=S[3],T=S[4],R=parseFloat(S[6]);v!==a&&(o=ja(x),++x),n.growIfFull(),n.atomTypeId[g]=t.add(T),n.serial[g]=w,n.partialCharge[g]=R,e.addAtom(0,o,o,M,A,!1),g+=1,a=v}else if(s===3){const S=m.split(Hg);for(let w=0,v=S.length;w<v;w+=2)l[y]=parseInt(S[w])-1,d[y]=parseInt(S[w+1])-1,u[y]=1,y+=1}else if(s===1)i.push(m.replace(qg,"").trim());else if(s!==4){if(s!==5){if(s!==6)if(m.includes("!NATOM")){s=2;const S=parseInt(m.split(Hg)[0]);n.resize(S)}else if(m.includes("!NBOND")){s=3;const S=parseInt(m.split(Hg)[0]);l=new Uint32Array(S),d=new Uint32Array(S),u=new Uint8Array(S)}else m.includes("!NTITLE")?s=1:m.includes("!NTHETA")?s=4:m.includes("!NPHI")?s=5:m.includes("!NIMPHI")&&(s=6)}}}else s=void 0}})(0,b.length,b)})),r.title=i.join(" "),r.bondStore.length=u.length,r.bondStore.count=y,r.bondStore.atomIndex1=l,r.bondStore.atomIndex2=d,r.bondStore.bondOrder=u,e.finalize(),r.finalizeAtoms(),r.finalizeBonds(),Xa(r,!0),Ya(r,!0,!0),tc(r),De&&ke.timeEnd("PsfParser._parse "+this.name)}});const Wg=/\[ (.+) \]/,Xg=/\s+/;Ne.add("top",class extends og{get type(){return"top"}_parse(){De&&ke.time("TopParser._parse "+this.name);const r=this.structure,e=this.structureBuilder,t=r.atomMap,n=r.bondStore,i=r.atomStore;i.addField("partialCharge",1,"float32");const s=[],o={};let a,l;this.streamer.eachChunkOfLines((function(E){(function(m,S,w){for(let v=m;v<S;++v){const A=w[v];let M=A.trim();if(!M||M[0]==="*"||M[0]===";")continue;if(M.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const T=A.match(Wg);if(T!==null){const O=T[1];O==="moleculetype"?(l=2,a={atoms:[],bonds:[]}):l=O==="atoms"?3:O==="bonds"?4:O==="system"?0:O==="molecules"?1:void 0;continue}const R=M.indexOf(";");if(R!==-1&&(M=M.substring(0,R).trim()),l===2){const O=M.split(Xg)[0];o[O]=a}else if(l===3){const O=M.split(Xg);a.atoms.push([parseInt(O[2]),O[3],O[4],parseFloat(O[6])])}else if(l===4){const O=M.split(Xg);a.bonds.push([parseInt(O[0]),parseInt(O[1])])}else if(l===0)r.title=M;else if(l===1){const O=M.split(Xg);s.push([O[0],parseInt(O[1])])}}})(0,E.length,E)}));let d=0,u=0;s.forEach((function(E){const[m,S]=E,w=o[m];d+=S*w.atoms.length,u+=S*w.bonds.length})),i.resize(d),n.resize(u);let g,x=0,y=0,b=0,_=0,h=0,f=0;s.forEach((function(E){const[m,S]=E,w=o[m],v=ja(_);for(let A=0;A<S;++A){g=-1;const M=as.includes(m)?v:ja(b);w.atoms.forEach((function(T){const[R,O,L,P]=T;R!==g&&++y,i.atomTypeId[x]=t.add(L),i.serial[x]=x+1,i.partialCharge[x]=P,e.addAtom(0,v,M,O,y+1,!1),++x,g=R})),w.bonds.forEach((function(T){n.atomIndex1[h]=f+T[0]-1,n.atomIndex2[h]=f+T[1]-1,++h})),++b,f+=w.atoms.length}++_})),n.count=u,e.finalize(),r.finalizeAtoms(),r.finalizeBonds(),Xa(r,!0),Ya(r,!0,!0),tc(r),De&&ke.timeEnd("TopParser._parse "+this.name)}});class Yg extends sg{constructor(e,t){super(e,t),this.frames=new ml(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}function Kg(r,e){if(r)throw new TypeError("Not a valid NetCDF v3.x file: "+e)}function Zg(r){r.offset%4!=0&&r.skip(4-r.offset%4)}function Qg(r){const e=r.readUint32(),t=r.readChars(e);return Zg(r),t}Ne.add("dcd",class extends Yg{get type(){return"dcd"}get isBinary(){return!0}_parse(){De&&ke.time("DcdParser._parse "+this.name);const r=_t(this.streamer.data),e=new DataView(r),t=this.frames,n=t.coordinates,i=t.boxes,s={};let o=0;const a=new Int32Array(r,0,23),l=a[0]!==e.getInt32(0);if(a[0]!==84){const h=r.byteLength;for(let f=0;f<h;f+=4)e.setFloat32(f,e.getFloat32(f),!0)}a[0]!==84&&ke.error("dcd bad format, header block start"),String.fromCharCode(e.getUint8(4),e.getUint8(5),e.getUint8(6),e.getUint8(7))!=="CORD"&&ke.error("dcd bad format, format string");let d=!1,u=!1,g=!1;a[22]!==0&&(d=!0,a[12]!==0&&(u=!0),a[13]===1&&(g=!0)),s.NSET=a[2],s.ISTART=a[3],s.NSAVC=a[4],s.NAMNF=a[10],s.DELTA=d?e.getFloat32(44,l):e.getFloat64(44,l),a[22]!==84&&ke.error("dcd bad format, header block end"),o=o+84+8;const x=e.getInt32(o,l),y=o+1;if((x-4)%80!=0&&ke.error("dcd bad format, title block start"),s.TITLE=gt(new Uint8Array(r,y,x)),e.getInt32(y+x+4-1,l)!==x&&ke.error("dcd bad format, title block end"),o=o+x+8,e.getInt32(o,l)!==4&&ke.error("dcd bad format, natom block start"),s.NATOM=e.getInt32(o+4,l),e.getInt32(o+8,l)!==4&&ke.error("dcd bad format, natom block end"),o=o+4+8,s.NAMNF>0)return void ke.error("dcd format with fixed atoms unsupported, aborting");const b=s.NATOM,_=4*b;for(let h=0,f=s.NSET;h<f;++h){if(u){o+=4;const m=new Float32Array(9);m[0]=e.getFloat64(o,l),m[4]=e.getFloat64(o+16,l),m[8]=e.getFloat64(o+40,l),i.push(m),o+=48,o+=4}const E=new Float32Array(3*b);for(let m=0;m<3;++m){e.getInt32(o,l)!==_&&ke.error("dcd bad format, coord block start",h,m),o+=4;const S=new Float32Array(r,o,b);for(let w=0;w<b;++w)E[3*w+m]=S[w];o+=_,e.getInt32(o,l)!==_&&ke.error("dcd bad format, coord block end",h,m),o+=4}n.push(E),g&&(o+=4+e.getInt32(o,l)+4)}s.DELTA&&(t.deltaTime=20.45482949774598*s.DELTA),s.ISTART>=1&&(t.timeOffset=(s.ISTART-1)*t.deltaTime),De&&ke.timeEnd("DcdParser._parse "+this.name)}});const Jg={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function ty(r){switch(Number(r)){case Jg.BYTE:return"byte";case Jg.CHAR:return"char";case Jg.SHORT:return"short";case Jg.INT:return"int";case Jg.FLOAT:return"float";case Jg.DOUBLE:return"double";default:return"undefined"}}function ey(r){switch(Number(r)){case Jg.BYTE:case Jg.CHAR:return 1;case Jg.SHORT:return 2;case Jg.INT:case Jg.FLOAT:return 4;case Jg.DOUBLE:return 8;default:return-1}}function iy(r){switch(String(r)){case"byte":return Jg.BYTE;case"char":return Jg.CHAR;case"short":return Jg.SHORT;case"int":return Jg.INT;case"float":return Jg.FLOAT;case"double":return Jg.DOUBLE;default:return-1}}function ry(r,e){if(r!==1){const t=new Array(r);for(let n=0;n<r;n++)t[n]=e();return t}return e()}function ny(r,e,t){switch(e){case Jg.BYTE:return r.readBytes(t);case Jg.CHAR:return(function(n){return n.charCodeAt(n.length-1)===0?n.substring(0,n.length-1):n})(r.readChars(t));case Jg.SHORT:return ry(t,r.readInt16.bind(r));case Jg.INT:return ry(t,r.readInt32.bind(r));case Jg.FLOAT:return ry(t,r.readFloat32.bind(r));case Jg.DOUBLE:return ry(t,r.readFloat64.bind(r));default:return void Kg(!0,"non valid type "+e)}}const sy=0,oy=10,ay=11,cy=12;function ly(r,e){const t={recordDimension:{length:r.readUint32()}};t.version=e;const n=(function(s){let o,a,l;const d=s.readUint32();if(d===sy)return Kg(s.readUint32()!==sy,"wrong empty tag for list of dimensions"),[];{Kg(d!==oy,"wrong tag for list of dimensions");const u=s.readUint32();o=new Array(u);for(let g=0;g<u;g++){const x=Qg(s),y=s.readUint32();y===0&&(a=g,l=x),o[g]={name:x,size:y}}return{dimensions:o,recordId:a,recordName:l}}})(r);t.recordDimension.id=n.recordId,t.recordDimension.name=n.recordName,t.dimensions=n.dimensions,t.globalAttributes=hy(r);const i=(function(s,o,a){const l=s.readUint32();let d,u=0;if(l===sy)return Kg(s.readUint32()!==sy,"wrong empty tag for list of variables"),[];{Kg(l!==ay,"wrong tag for list of variables");const g=s.readUint32();d=new Array(g);for(let x=0;x<g;x++){const y=Qg(s),b=s.readUint32(),_=new Array(b);for(let S=0;S<b;S++)_[S]=s.readUint32();const h=hy(s),f=s.readUint32();Kg(f<1&&f>6,"non valid type "+f);const E=s.readUint32();let m=s.readUint32();a===2&&(Kg(m>0,"offsets larger than 4GB not supported"),m=s.readUint32()),_[0]===o&&(u+=E),d[x]={name:y,dimensions:_,attributes:h,type:ty(f),size:E,offset:m,record:_[0]===o}}}return{variables:d,recordStep:u}})(r,n.recordId,e);return t.variables=i.variables,t.recordDimension.recordStep=i.recordStep,t}function hy(r){let e;const t=r.readUint32();if(t===sy)return Kg(r.readUint32()!==sy,"wrong empty tag for list of attributes"),[];{Kg(t!==cy,"wrong tag for list of attributes");const n=r.readUint32();e=new Array(n);for(let i=0;i<n;i++){const s=Qg(r),o=r.readUint32();Kg(o<1||o>6,"non valid type "+o);const a=r.readUint32(),l=ny(r,o,a);Zg(r),e[i]={name:s,type:ty(o),value:l}}}return e}class uy{constructor(e){const t=new li(e);t.setBigEndian(),Kg(t.readChars(3)!=="CDF","should start with CDF");const n=t.readByte();Kg(n>2,"unknown version"),this.header=ly(t,n),this.buffer=t}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return this.header.variables.findIndex((function(t){return t.name===e}))!==-1}getDataVariable(e){let t;return t=typeof e=="string"?this.header.variables.find((function(n){return n.name===e})):e,Kg(t===void 0,"variable not found"),this.buffer.seek(t.offset),t.record?(function(n,i,s){const o=iy(i.type),a=i.size?i.size/ey(o):1,l=s.length,d=new Array(l),u=s.recordStep;for(let g=0;g<l;g++){const x=n.offset;d[g]=ny(n,o,a),n.seek(x+u)}return d})(this.buffer,t,this.header.recordDimension):(function(n,i){const s=iy(i.type),o=i.size/ey(s),a=new Array(o);for(let l=0;l<o;l++)a[l]=ny(n,s,1);return a})(this.buffer,t)}}class dy extends Yg{get type(){return"nctraj"}get isBinary(){return!0}_parse(){De&&ke.time("NctrajParser._parse "+this.name);const e=new uy(this.streamer.data),t=this.frames,n=t.coordinates,i=t.boxes,s=t.times;e.getDataVariable("coordinates").forEach((function(o){n.push(new Float32Array(o))})),e.hasDataVariable("cell_lengths")&&e.getDataVariable("cell_lengths").forEach((function(o){i.push(new Float32Array(o))})),e.hasDataVariable("time")&&e.getDataVariable("time").forEach((function(o){s.push(o)})),s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),De&&ke.timeEnd("NctrajParser._parse "+this.name)}}Ne.add("nctraj",dy),Ne.add("ncdf",dy),Ne.add("nc",dy);Ne.add("trr",class extends Yg{get type(){return"trr"}get isBinary(){return!0}_parse(){De&&ke.time("TrrParser._parse "+this.name);const r=_t(this.streamer.data),e=new DataView(r),t=this.frames,n=t.coordinates,i=t.boxes,s=t.times;let o=0;for(;;){o+=8;const a=e.getInt32(o);o+=4,o+=a;const l=e.getInt32(o+8),d=e.getInt32(o+12),u=e.getInt32(o+16),g=e.getInt32(o+28),x=e.getInt32(o+32),y=e.getInt32(o+36),b=e.getInt32(o+40);o+=52;const _=l/9,h=3*b;if(_===8?s.push(e.getFloat64(o)):s.push(e.getFloat32(o)),o+=2*_,l){const f=new Float32Array(9);if(_===8)for(let E=0;E<9;++E)f[E]=10*e.getFloat64(o),o+=8;else for(let E=0;E<9;++E)f[E]=10*e.getFloat32(o),o+=4;i.push(f)}if(o+=d,o+=u,g){let f;if(_===8){f=new Float32Array(h);for(let E=0;E<h;++E)f[E]=10*e.getFloat64(o),o+=8}else{const E=new Uint32Array(r,o,h);for(let m=0;m<h;++m){const S=E[m];E[m]=(255&S)<<24|(65280&S)<<8|S>>8&65280|S>>24&255}f=new Float32Array(r,o,h);for(let m=0;m<h;++m)f[m]*=10,o+=4}n.push(f)}if(o+=x,o+=y,o>=r.byteLength)break}s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),De&&ke.timeEnd("TrrParser._parse "+this.name)}});const my=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function fy(r){let e=1,t=0;for(;r>=e&&t<32;)t++,e<<=1;return t}const py=new Uint8Array(32);function gy(r,e){let t=1,n=0;py[0]=1;for(let s=0;s<r;s++){let o,a=0;for(o=0;o<t;o++)a+=py[o]*e[s],py[o]=255&a,a>>=8;for(;a!==0;)py[o++]=255&a,a>>=8;t=o}let i=1;for(t--;py[t]>=i;)n++,i*=2;return n+8*t}function yy(r,e,t,n){const i=(1<<t)-1;let s=n[1],o=n[2],a=r[0],l=0;for(;t>=8;)o=o<<8|e[a++],l|=o>>s<<t-8,t-=8;return t>0&&(s<t&&(s+=8,o=o<<8|e[a++]),s-=t,l|=o>>s&(1<<t)-1),l&=i,r[0]=a,r[1]=s,r[2]=o,l}const by=new Int32Array(32);function _y(r,e,t,n,i,s,o){let a=0;for(by[1]=0,by[2]=0,by[3]=0;n>8;)by[a++]=yy(r,e,8,o),n-=8;n>0&&(by[a++]=yy(r,e,n,o));for(let l=t-1;l>0;l--){let d=0;for(let u=a-1;u>=0;u--){d=d<<8|by[u];const g=d/i[l]|0;by[u]=g,d-=g*i[l]}s[l]=d}s[0]=by[0]|by[1]<<8|by[2]<<16|by[3]<<24}Ne.add("xtc",class extends Yg{get type(){return"xtc"}get isBinary(){return!0}_parse(){De&&ke.time("XtcParser._parse "+this.name);const r=_t(this.streamer.data),e=new DataView(r),t=this.frames,n=t.coordinates,i=t.boxes,s=t.times,o=new Int32Array(6),a=new Int32Array(3),l=new Int32Array(3),d=new Uint32Array(3),u=new Float32Array(3),g=new Float32Array(3);let x=0;const y=new Int32Array(3),b=new Uint32Array(y.buffer);for(;;){let _;const h=e.getInt32(x+4);x+=12;const f=3*h;s.push(e.getFloat32(x)),x+=4;const E=new Float32Array(9);for(let m=0;m<9;++m)E[m]=10*e.getFloat32(x),x+=4;if(i.push(E),h<=9){_=new Float32Array(h);for(let m=0;m<h;++m)_[m]=e.getFloat32(x),x+=4}else{y[0]=y[1]=y[2]=0,a[0]=a[1]=a[2]=0,d[0]=d[1]=d[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,g[0]=g[1]=g[2]=0,_=new Float32Array(f);let m=0;const S=e.getInt32(x);x+=4;const w=e.getFloat32(x);let v;x+=4,o[0]=e.getInt32(x),o[1]=e.getInt32(x+4),o[2]=e.getInt32(x+8),o[3]=e.getInt32(x+12),o[4]=e.getInt32(x+16),o[5]=e.getInt32(x+20),a[0]=o[3]-o[0]+1,a[1]=o[4]-o[1]+1,a[2]=o[5]-o[2]+1,x+=24,(a[0]|a[1]|a[2])>16777215?(l[0]=fy(a[0]),l[1]=fy(a[1]),l[2]=fy(a[2]),v=0):v=gy(3,a);let A=e.getInt32(x);x+=4;let M=A-1;M=9>M?9:M;let T=my[M]/2|0,R=my[A]/2|0;d[0]=d[1]=d[2]=my[A];let O=4*Math.ceil(e.getInt32(x)/4);x+=4;const L=1/w;let P=0,I=0;const N=new Uint8Array(r,x);for(u[0]=u[1]=u[2]=0;I<S;){v===0?(u[0]=yy(y,N,l[0],b),u[1]=yy(y,N,l[1],b),u[2]=yy(y,N,l[2],b)):_y(y,N,3,v,a,u,b),I++,u[0]+=o[0],u[1]+=o[1],u[2]+=o[2],g[0]=u[0],g[1]=u[1],g[2]=u[2];let U=0;if(yy(y,N,1,b)===1&&(P=yy(y,N,5,b),U=P%3,P-=U,U--),P>0){u[0]=u[1]=u[2]=0;for(let F=0;F<P;F+=3){if(_y(y,N,3,A,d,u,b),I++,u[0]+=g[0]-R,u[1]+=g[1]-R,u[2]+=g[2]-R,F===0){let k=u[0];u[0]=g[0],g[0]=k,k=u[1],u[1]=g[1],g[1]=k,k=u[2],u[2]=g[2],g[2]=k,_[m++]=g[0]*L,_[m++]=g[1]*L,_[m++]=g[2]*L}else g[0]=u[0],g[1]=u[1],g[2]=u[2];_[m++]=u[0]*L,_[m++]=u[1]*L,_[m++]=u[2]*L}}else _[m++]=u[0]*L,_[m++]=u[1]*L,_[m++]=u[2]*L;if(A+=U,U<0?(R=T,T=A>9?my[A-1]/2|0:0):U>0&&(T=R,R=my[A]/2|0),d[0]=d[1]=d[2]=my[A],d[0]===0||d[1]===0||d[2]===0)return void console.error("(xdrfile error) Undefined error.")}x+=O}for(let m=0;m<f;m++)_[m]*=10;if(n.push(_),x>=r.byteLength)break}s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),De&&ke.timeEnd("XtcParser._parse "+this.name)}});class xy extends sg{constructor(e,t){const n=t||{};super(e,n),this.volume=new $o(this.name,this.path),this.voxelSize=nt(n.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new Matrix4}}const vy=/\s+/,wy=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,Ay=.529177210859;class Sy extends xy{get type(){return"cube"}_parse(){De&&ke.time("CubeParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(6),n={},i=Ay*this.voxelSize;function s(u,g){var x=t[u].trim().split(vy)[g];return parseFloat(x)}n.atomCount=Math.abs(s(2,0)),n.originX=s(2,1)*Ay,n.originY=s(2,2)*Ay,n.originZ=s(2,3)*Ay,n.NVX=s(3,0),n.NVY=s(4,0),n.NVZ=s(5,0),n.basisX=new Vector3(s(3,1),s(3,2),s(3,3)).multiplyScalar(i),n.basisY=new Vector3(s(4,1),s(4,2),s(4,3)).multiplyScalar(i),n.basisZ=new Vector3(s(5,1),s(5,2),s(5,3)).multiplyScalar(i);const o=new Float32Array(n.NVX*n.NVY*n.NVZ);let a=0,l=0;const d=s(2,0)>0?0:1;this.streamer.eachChunkOfLines((function(u){(function(g,x,y){for(let b=g;b<x;++b){const _=y[b].trim();if(_!==""&&l>=n.atomCount+6+d){const h=_.match(wy);for(let f=0,E=h.length;f<E;++f)o[a]=parseFloat(h[f]),++a}++l}})(0,u.length,u)})),e.header=n,e.setData(o,n.NVZ,n.NVY,n.NVX),De&&ke.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=new Matrix4;return t.multiply(new Matrix4().makeTranslation(e.originX,e.originY,e.originZ)),t.multiply(new Matrix4().makeBasis(e.basisZ,e.basisY,e.basisX)),t}}Ne.add("cub",Sy),Ne.add("cube",Sy);class Cy extends xy{get type(){return"dsn6"}get isBinary(){return!0}_parse(){De&&ke.time("Dsn6Parser._parse "+this.name);const e=this.volume,t={};let n,i;const s=_t(this.streamer.data),o=new Int16Array(s),a=new Uint8Array(s),l=String.fromCharCode.apply(null,a.subarray(0,512));if(l.startsWith(":-)"))t.xStart=parseInt(l.substr(10,5)),t.yStart=parseInt(l.substr(15,5)),t.zStart=parseInt(l.substr(20,5)),t.xExtent=parseInt(l.substr(32,5)),t.yExtent=parseInt(l.substr(38,5)),t.zExtent=parseInt(l.substr(42,5)),t.xRate=parseInt(l.substr(52,5)),t.yRate=parseInt(l.substr(58,5)),t.zRate=parseInt(l.substr(62,5)),t.xlen=parseFloat(l.substr(73,10))*this.voxelSize,t.ylen=parseFloat(l.substr(83,10))*this.voxelSize,t.zlen=parseFloat(l.substr(93,10))*this.voxelSize,t.alpha=parseFloat(l.substr(103,10)),t.beta=parseFloat(l.substr(113,10)),t.gamma=parseFloat(l.substr(123,10)),n=parseFloat(l.substr(138,12))/100,i=parseInt(l.substr(155,8)),t.sigma=100*parseFloat(l.substr(170,12));else{if(o[18]!==100)for(let T=0,R=o.length;T<R;++T){const O=o[T];o[T]=(255&O)<<8|O>>8&255}t.xStart=o[0],t.yStart=o[1],t.zStart=o[2],t.xExtent=o[3],t.yExtent=o[4],t.zExtent=o[5],t.xRate=o[6],t.yRate=o[7],t.zRate=o[8];const A=1/o[17],M=A*this.voxelSize;t.xlen=o[9]*M,t.ylen=o[10]*M,t.zlen=o[11]*M,t.alpha=o[12]*A,t.beta=o[13]*A,t.gamma=o[14]*A,n=o[15]/100,i=o[16],t.gamma=o[14]*A}e.header=t,De&&ke.log(t,n,i);const d=new Float32Array(t.xExtent*t.yExtent*t.zExtent);let u=512;const g=Math.ceil(t.xExtent/8),x=Math.ceil(t.yExtent/8),y=Math.ceil(t.zExtent/8);for(var b=0;b<y;++b)for(var _=0;_<x;++_)for(var h=0;h<g;++h)for(var f=0;f<8;++f)for(var E=8*b+f,m=0;m<8;++m)for(var S=8*_+m,w=0;w<8;++w){var v=8*h+w;if(!(v<t.xExtent&&S<t.yExtent&&E<t.zExtent)){u+=8-w;break}d[(v*t.yExtent+S)*t.zExtent+E]=(a[u]-i)/n,++u}e.setData(d,t.zExtent,t.yExtent,t.xExtent),t.sigma&&e.setStats(void 0,void 0,void 0,t.sigma),De&&ke.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const s=[[],t,n,i],o=[0,e.xRate,e.yRate,e.zRate],a=[0,1,2,3],l=new Matrix4;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.multiply(new Matrix4().makeRotationY(It(90))),l.multiply(new Matrix4().makeTranslation(-e.zStart,e.yStart,e.xStart)),l.multiply(new Matrix4().makeScale(-1,1,1)),l}}Ne.add("dsn6",Cy),Ne.add("brix",Cy);const Py=/\s+/;class Iy extends xy{get type(){return"dx"}_parse(){De&&ke.time("DxParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(30),n=this.parseHeaderLines(t),i=this.volume.header,s=n.dataLineStart,o=i.nx*i.ny*i.nz,a=new Float32Array(o);let l=0,d=0;this.streamer.eachChunkOfLines((function(u){(function(g,x,y){for(let b=g;b<x;++b){if(l<o&&d>s){const _=y[b].trim();if(_!==""){const h=_.split(Py);for(let f=0,E=h.length;f<E;++f)a[l]=parseFloat(h[f]),++l}}++d}})(0,u.length,u)})),e.setData(a,i.nz,i.ny,i.nx),De&&ke.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(e){const t={},n=e.length;let i=0,s=0,o=0;for(let a=0;a<n;++a){let l;const d=e[a];if(d.startsWith("object 1"))l=d.split(Py),t.nx=parseInt(l[5]),t.ny=parseInt(l[6]),t.nz=parseInt(l[7]);else if(d.startsWith("origin"))l=d.split(Py),t.xmin=parseFloat(l[1]),t.ymin=parseFloat(l[2]),t.zmin=parseFloat(l[3]);else if(d.startsWith("delta"))l=d.split(Py),o===0?t.hx=parseFloat(l[1])*this.voxelSize:o===1?t.hy=parseFloat(l[2])*this.voxelSize:o===2&&(t.hz=parseFloat(l[3])*this.voxelSize),o+=1;else if(d.startsWith("object 3")){i=a,s+=d.length+1;break}s+=d.length+1}return this.volume.header=t,{dataLineStart:i,headerByteCount:s}}getMatrix(){const e=this.volume.header,t=new Matrix4;return t.multiply(new Matrix4().makeRotationY(It(90))),t.multiply(new Matrix4().makeTranslation(-e.zmin,e.ymin,e.xmin)),t.multiply(new Matrix4().makeScale(-e.hz,e.hy,e.hx)),t}}Ne.add("dx",Iy);Ne.add("dxbin",class extends Iy{get type(){return"dxbin"}get isBinary(){return!0}_parse(){De&&ke.time("DxbinParser._parse "+this.name);const r=_t(this.streamer.data),e=(function(l,d=10485760,u=`
`){let g="",x=[];for(let y=0;y<l.length;y+=d){const b=gt(l.subarray(y,y+d)),_=b.lastIndexOf(u);if(_===-1)g+=b;else{const h=g+b.substr(0,_);x=x.concat(h.split(u)),g=_===b.length-u.length?"":b.substr(_+u.length)}}return g!==""&&x.push(g),x})(new Uint8Array(r,0,1e3)),t=this.parseHeaderLines(e),n=this.volume.header,i=t.headerByteCount,s=n.nx*n.ny*n.nz,o=new DataView(r),a=new Float32Array(s);for(let l=0;l<s;++l)a[l]=o.getFloat64(8*l+i,!0);this.volume.setData(a,n.nz,n.ny,n.nx),De&&ke.timeEnd("DxbinParser._parse "+this.name)}});class ky extends xy{get type(){return"mrc"}get isBinary(){return!0}_parse(){De&&ke.time("MrcParser._parse "+this.name);const e=this.volume,t={},n=_t(this.streamer.data),i=new Int32Array(n,0,56),s=new Float32Array(n,0,56),o=new DataView(n);if(t.MAP=String.fromCharCode(o.getUint8(208),o.getUint8(209),o.getUint8(210),o.getUint8(211)),t.MACHST=[o.getUint8(212),o.getUint8(213)],t.MACHST[0]===17&&t.MACHST[1]===17){const l=n.byteLength;for(let d=0;d<l;d+=4)o.setFloat32(d,o.getFloat32(d),!0)}let a;if(t.NX=i[0],t.NY=i[1],t.NZ=i[2],t.MODE=i[3],t.NXSTART=i[4],t.NYSTART=i[5],t.NZSTART=i[6],t.MX=i[7],t.MY=i[8],t.MZ=i[9],t.xlen=s[10]*this.voxelSize,t.ylen=s[11]*this.voxelSize,t.zlen=s[12]*this.voxelSize,t.alpha=s[13],t.beta=s[14],t.gamma=s[15],t.MAPC=i[16],t.MAPR=i[17],t.MAPS=i[18],t.DMIN=s[19],t.DMAX=s[20],t.DMEAN=s[21],t.ISPG=i[22],t.NSYMBT=i[23],t.LSKFLG=i[24],t.originX=s[49],t.originY=s[50],t.originZ=s[51],t.ARMS=s[54],e.header=t,t.MODE===2)a=new Float32Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ);else if(t.MODE===0){if(a=new Float32Array(new Int8Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ)),i[39]===-128&&i[40]===127){const l=(t.DMAX-t.DMIN)/255,d=.5*(t.DMIN+t.DMAX+l);for(let u=0,g=a.length;u<g;++u)a[u]=l*a[u]+d}}else ke.error("MrcParser unknown mode",t.MODE);e.setData(a,t.NX,t.NY,t.NZ),t.ARMS!==0&&e.setStats(t.DMIN,t.DMAX,t.DMEAN,t.ARMS),De&&ke.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const s=[[],t,n,i],o=[0,e.MX,e.MY,e.MZ],a=[0,e.MAPC,e.MAPR,e.MAPS],l=new Matrix4;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.setPosition(new Vector3(e.originX,e.originY,e.originZ)),l.multiply(new Matrix4().makeTranslation(e.NXSTART,e.NYSTART,e.NZSTART)),l}}Ne.add("mrc",ky),Ne.add("ccp4",ky),Ne.add("map",ky);const My=/\s+/;function Ty(r){return r.trim().split(My).map(parseFloat)}class Dy extends xy{get type(){return"xplor"}_parse(){De&&ke.time("XplorParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(8),n={};let i;i=t[2].startsWith("REMARKS")?parseInt(t[1].substring(0,8))+2:5;const s=i+3,o=Ty(t[i]);n.NA=o[0],n.AMIN=o[1],n.AMAX=o[2],n.NB=o[3],n.BMIN=o[4],n.BMAX=o[5],n.NC=o[6],n.CMIN=o[7],n.CMAX=o[8];const a=Ty(t[i+1]);n.a=a[0]*this.voxelSize,n.b=a[1]*this.voxelSize,n.c=a[2]*this.voxelSize,n.alpha=a[3],n.beta=a[4],n.gamma=a[5];const l=n.AMAX-n.AMIN+1,d=n.BMAX-n.BMIN+1,u=n.CMAX-n.CMIN+1,g=l*d*u,x=new Float32Array(g),y=Math.ceil(1+l*d/6);let b=0,_=0;this.streamer.eachChunkOfLines((function(h){(function(f,E,m){for(let S=f;S<E;++S){const w=m[S];if(_>=s&&(_-s)%y!=0&&b<g)for(let v=0,A=6;v<A;++v){const M=parseFloat(w.substr(12*v,12));if(isNaN(M))break;x[b++]=M}else if(b===g){const v=w.trim();if(v&&v!=="-9999"){const A=Ty(w);n.RAVE=A[0],n.RSIGMA=A[1]}}++_}})(0,h.length,h)})),e.header=n,e.setData(x,l,d,u),n.RAVE!==0&&n.RSIGMA!==1&&e.setStats(void 0,void 0,n.RAVE,n.RSIGMA),De&&ke.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.a,0,0],n=[e.b*Math.cos(Math.PI/180*e.gamma),e.b*Math.sin(Math.PI/180*e.gamma),0],i=[e.c*Math.cos(Math.PI/180*e.beta),e.c*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.c*e.c*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const s=[[],t,n,i],o=[0,e.NA,e.NB,e.NC],a=[0,1,2,3],l=new Matrix4;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.multiply(new Matrix4().makeTranslation(e.AMIN,e.BMIN,e.CMIN)),l}}function By(r,e,t){let n,i,s;r/=360,e/=100,t/=100;const o=Math.floor(6*r),a=6*r-o,l=t*(1-e),d=t*(1-a*e),u=t*(1-(1-a)*e);switch(o%6){case 0:n=t,i=u,s=l;break;case 1:n=d,i=t,s=l;break;case 2:n=l,i=t,s=u;break;case 3:n=l,i=d,s=t;break;case 4:n=u,i=l,s=t;break;case 5:n=t,i=l,s=d}return[n,i,s]}Ne.add("xplor",Dy),Ne.add("cns",Dy);const Fy={red:By(0,100,100),orange:By(20,100,100),gold:By(40,100,100),yellow:By(60,100,100),lime:By(80,100,100),green:By(120,80,100),sea:By(150,100,100),cyan:By(180,100,85),sky:By(210,75,95),blue:By(240,70,100),purple:By(275,75,100),magenta:By(300,95,100),hotpink:By(335,100,100),pink:By(350,55,100),peach:By(25,75,100),lilac:By(275,55,100),pinktint:By(340,30,100),peachtint:By(25,50,100),yellowtint:By(60,50,100),greentint:By(135,40,100),bluetint:By(220,40,100),lilactint:By(275,35,100),white:By(0,0,100),gray:By(0,0,50),brown:By(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},Ey=/[\s,]+/,$y=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,Oy=/^{+|}+$/g,Ry=/^['"]+|['"]+$/g,Ly=/\s*=\s*/g;function Ny(r){let e,t,n,i=[];const s=(r=r.replace(Ly,"=")).match($y);for(let o=1;o<s.length;++o){const a=s[o];if(a[0]==="{")e=a.substring(1,a.length-1);else{const l=a.split("=");l.length===2&&(l[0]==="color"?t=Fy[l[1]]:l[0]==="width"?n=parseInt(l[1]):l[0]==="master"&&i.push(l[1].replace(Oy,"")))}}return{listName:e,listColor:t,listMasters:i,listWidth:n}}function zy(r){const e=(r=r.trim()).indexOf("{"),t=r.indexOf("}"),n=r.substr(t+1).split(Ey),i=r.substr(e+1,t-1),s=[parseFloat(n[n.length-3]),parseFloat(n[n.length-2]),parseFloat(n[n.length-1])];let o,a,l,d=!1,u=!1;for(let g=4;g<=n.length;g++){const x=n[n.length-g];x in Fy&&(o=Fy[n[n.length-g]]),x.startsWith("width")&&(a=parseInt(x.substring(5))),x.startsWith("r=")&&(l=parseFloat(x.split("=")[1])),x.startsWith("P")&&(d=!0),x.startsWith("X")&&(u=!0)}return{label:i,position:s,color:o,radius:l,width:a,isLineBreak:d,isTriangleBreak:u}}function Uy(r){const e=r.indexOf("{"),t=r.indexOf("}");return r.substring(e!==-1?e+1:0,t!==-1?t:void 0).trim()}function Vy(r){const e=r.indexOf("}");return e===-1?void 0:r.substr(e+1).trim()}function jy(r){let e="",t=[],n={};const i=(r=r.replace(Ly,"=")).match($y);for(let s=1;s<i.length;++s){const o=i[s];if(o[0]==="{")e=o.substring(1,o.length-1);else{const a=o.split("=");a.length===2?a[0]==="master"?t.push(a[1].replace(Oy,"")):n[a[0]]=a[1].replace(Oy,""):n[a[0]]=!0}}return{groupName:e,groupFlags:n,groupMasters:t}}Ne.add("kin",class extends sg{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){De&&ke.time(`KinParser._parse ${this.name}`);const r={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let e,t;this.kinemage=r;let n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T=!1,R="",O=!1,L="",P=null,I=null,N=!1,U="",F=!1,k="",j=!1,H=!1;if(this.streamer.eachChunkOfLines((function(B){(function(V,Y,K){for(let Te=V;Te<Y;++Te){const He=K[Te];if(He[0]==="@"&&(T=!1,O=!1,N=!1,F=!1,j=!1,H=!1),He)if(He.startsWith("@dotlist")){let{listColor:Q,listName:Xe,listMasters:ut}=Ny(He);T=!0,R="",i=[],s=[],o=[],n=Q,e&&(ut=ut.concat(e)),t&&(ut=ut.concat(t)),r.dotLists.push({name:Xe,masterArray:ut,labelArray:i,positionArray:s,colorArray:o})}else if(He.startsWith("@vectorlist")){let{listMasters:Q,listName:Xe,listWidth:ut,listColor:Ji}=Ny(He);Q&&Q.forEach((function(er){r.masterDict[er]||(r.masterDict[er]={indent:!1,visible:!1})})),O=!0,L="",P=null,I=null,d=[],u=[],g=[],x=[],y=[],b=[],a=Ji,l=[],ut&&l.push(ut),e&&(Q=Q.concat(e)),t&&(Q=Q.concat(t)),r.vectorLists.push({name:Xe,masterArray:Q,label1Array:d,label2Array:u,position1Array:g,position2Array:x,color1Array:y,color2Array:b,width:l})}else if(He.startsWith("@balllist")){let{listName:Q,listColor:Xe,listMasters:ut}=Ny(He);ut&&ut.forEach((function(Ji){r.masterDict[Ji]||(r.masterDict[Ji]={indent:!1,visible:!1})})),N=!0,U="",f=[],_=[],E=[],m=[],h=Xe,e&&(ut=ut.concat(e)),t&&(ut=ut.concat(t)),r.ballLists.push({name:Q,masterArray:ut,labelArray:f,radiusArray:_,positionArray:E,colorArray:m})}else if(He.startsWith("@ribbonlist")||He.startsWith("@trianglelist")){let{listMasters:Q,listName:Xe,listColor:ut}=Ny(He);Q&&Q.forEach((function(Ji){r.masterDict[Ji]||(r.masterDict[Ji]={indent:!1,visible:!1})})),F=!0,k="",w=[],v=[],A=[],M=[],S=ut,e&&(Q=Q.concat(e)),t&&(Q=Q.concat(t)),r.ribbonLists.push({name:Xe,masterArray:Q,labelArray:w,positionArray:v,breakArray:A,colorArray:M})}else if(He.startsWith("@text"))j=!0,r.texts.push(He.substr(5));else if(He.startsWith("@caption"))H=!0,r.captions.push(He.substr(8));else if(T){let{label:Q,color:Xe,position:ut}=zy(He);Q==='"'?Q=R:R=Q,Xe===void 0&&(Xe=n),i.push(Q),s.push(...ut),o.push(...Xe)}else if(O){let Q=He.replace(/(?!^){/g,`
{`).split(/\n/);for(var J=0;J<Q.length;J++){let Xe=Q[J],{label:ut,color:Ji,width:er,position:ec,isLineBreak:ai}=zy(Xe);ut==='"'?ut=L:L=ut,Ji===void 0&&(Ji=a),ai||P!==null&&(er&&l.push(er),d.push(L),g.push(...P),y.push(...I),u.push(ut),x.push(...ec),b.push(...Ji)),L=ut,P=ec,I=Ji}}else if(N){let{label:Q,radius:Xe,color:ut,position:Ji}=zy(He);Q==='"'?Q=U:U=Q,Xe===void 0&&(Xe=1),ut===void 0&&(ut=h),f.push(Q),_.push(Xe),E.push(...Ji),m.push(...ut)}else if(F){let{label:Q,color:Xe,position:ut,isTriangleBreak:Ji}=zy(He);Q==='"'?Q=k:k=Q,Xe===void 0&&(Xe=S),w.push(Q),v.push(...ut),A.push(Ji),M.push(...Xe)}else if(j)r.texts.push(He);else if(H)r.captions.push(He);else if(He.startsWith("@kinemage"))r.kinemage=parseInt(He.substr(9).trim());else if(He.startsWith("@onewidth"))r.onewidth=!0;else if(He.startsWith("@1viewid"))r["1viewid"]=Uy(He);else if(He.startsWith("@pdbfile"))r.pdbfile=Uy(He);else if(He.startsWith("@group")){let{groupName:Q,groupFlags:Xe,groupMasters:ut}=jy(He);r.groupDict[Q]||(r.groupDict[Q]={dominant:!1,animate:!1},e=ut),e&&e.forEach((function(Ji){r.masterDict[Ji]||(r.masterDict[Ji]={indent:!1,visible:!1})}));for(let Ji in Xe)r.groupDict[Q][Ji]=Xe[Ji]}else if(He.startsWith("@subgroup")){const{groupName:Q,groupFlags:Xe,groupMasters:ut}=jy(He);r.subgroupDict[Q]||(r.subgroupDict[Q]={dominant:!1,animate:!1},t=ut),t&&t.forEach((function(Ji){r.masterDict[Ji]||(r.masterDict[Ji]={indent:!1,visible:!1})}));for(let Ji in Xe)r.subgroupDict[Q][Ji]=Xe[Ji]}else if(He.startsWith("@master")){const Q=Uy(He),Xe=Vy(He);r.masterDict[Q]||(r.masterDict[Q]={indent:!1,visible:!1}),Xe==="on"?r.masterDict[Q].visible=!0:Xe==="off"?r.masterDict[Q].visible=!1:Xe==="indent"&&(r.masterDict[Q].indent=!0)}else if(He.startsWith("@pointmaster")){const{groupName:Q,groupFlags:Xe}=jy(He);r.pointmasterDict[Q]={id:Object.keys(Xe)[0].replace(Ry,"")}}else console.log(He);else T=!1,O=!1,N=!1,F=!1}})(0,B.length,B)})),r.text=r.texts.join(`
`).trim(),r.caption=r.captions.join(`
`).trim(),r.ribbonLists){let B=[];r.ribbonLists.forEach((function(V){B.push((function(Y){let{labelArray:K,positionArray:J,colorArray:Te,breakArray:He}=Y,Q=[],Xe=[],ut=[],Ji=[];for(let er=0;er<He.length/3;er++){let ec=3*er,ai=9*er;He[ec+1]||He[ec+2]||(Q.push(K[ec]),Q.push(K[ec+1]),Q.push(K[ec+2]),Ji.push(He[ec]),Ji.push(He[ec+1]),Ji.push(He[ec+2]),Xe.push(J[ai]),Xe.push(J[ai+1]),Xe.push(J[ai+2]),Xe.push(J[ai+3]),Xe.push(J[ai+4]),Xe.push(J[ai+5]),Xe.push(J[ai+6]),Xe.push(J[ai+7]),Xe.push(J[ai+8]),ut.push(Te[ai]),ut.push(Te[ai+1]),ut.push(Te[ai+2]),ut.push(Te[ai+3]),ut.push(Te[ai+4]),ut.push(Te[ai+5]),ut.push(Te[ai+6]),ut.push(Te[ai+7]),ut.push(Te[ai+8]))}return{name:Y.name,masterArray:Y.masterArray,labelArray:Q,positionArray:Xe,breakArray:Ji,colorArray:ut}})((function(Y){let{labelArray:K,positionArray:J,colorArray:Te,breakArray:He}=Y,Q=[];for(let ec=0;ec<3*(K.length-2);++ec)Q[ec]=K[ec-2*Math.floor(ec/3)];let Xe=[];for(let ec=0;ec<3*(He.length-2);++ec)Xe[ec]=He[ec-2*Math.floor(ec/3)];let ut=[];for(let ec=0;ec<9*(J.length/3-2);++ec)ut[ec]=J[ec-6*Math.floor(ec/9)];let Ji=[];for(let ec=0;ec<9*(Te.length/3-2);++ec)Ji[ec]=Te[ec-6*Math.floor(ec/9)];let er=[];for(let ec=0;ec<ut.length/3;++ec)er.push(new Vector3(ut[3*ec],ut[3*ec]+1,ut[3*ec]+2));return{name:Y.name,masterArray:Y.masterArray,labelArray:Q,positionArray:ut,breakArray:Xe,colorArray:Ji}})(V)))})),r.ribbonLists=B}De&&ke.timeEnd(`KinParser._parse ${this.name}`)}});class Gy extends sg{constructor(e,t){super(e,t),this.loader=this.getLoader(),this.surface=new Fo(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var e=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(e)}}const Hy=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};Hy.prototype={constructor:Hy,setPath:function(r){this.path=r},_createParserState:function(){var r={objects:[],object:{},vertices:[],normals:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);this.object={name:e||"",geometry:{vertices:[],normals:[]},fromDeclaration:t!==!1},this.objects.push(this.object)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},addVertex:function(e,t,n){var i=this.vertices,s=this.object.geometry.vertices;s.push(i[e+0]),s.push(i[e+1]),s.push(i[e+2]),s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2]),s.push(i[n+0]),s.push(i[n+1]),s.push(i[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var i=this.normals,s=this.object.geometry.normals;s.push(i[e+0]),s.push(i[e+1]),s.push(i[e+2]),s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2]),s.push(i[n+0]),s.push(i[n+1]),s.push(i[n+2])},addFace:function(e,t,n,i,s,o,a,l){var d,u=this.vertices.length,g=this.parseVertexIndex(e,u),x=this.parseVertexIndex(t,u),y=this.parseVertexIndex(n,u);if(i===void 0?this.addVertex(g,x,y):(d=this.parseVertexIndex(i,u),this.addVertex(g,x,d),this.addVertex(x,y,d)),s!==void 0){var b=this.normals.length;g=this.parseNormalIndex(s,b),x=s===o?g:this.parseNormalIndex(o,b),y=s===a?g:this.parseNormalIndex(a,b),i===void 0?this.addNormal(g,x,y):(d=this.parseNormalIndex(l,b),this.addNormal(g,x,d),this.addNormal(x,y,d))}},addLineGeometry:function(e){this.object.geometry.type="Line";for(var t=this.vertices.length,n=0,i=e.length;n<i;n++)this.addVertexLine(this.parseVertexIndex(e[n],t))}};return r.startObject("",!1),r},parse:function(r){var e,t,n=this._createParserState();r.indexOf(`\r
`)!==-1&&(r=r.replace(/\r\n/g,`
`)),r.indexOf(`\\
`)!==-1&&(r=r.replace(/\\\n/g,""));var i=r.split(`
`),s="",o="",a="",l=[],d=typeof"".trimLeft=="function";for(e=0,t=i.length;e<t;e++)if(s=i[e],(s=d?s.trimLeft():s.trim()).length!==0&&(o=s.charAt(0))!=="#"){if(o==="v"){if((a=s.charAt(1))===" "&&(l=this.regexp.vertex_pattern.exec(s))!==null)n.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a==="n"&&(l=this.regexp.normal_pattern.exec(s))!==null)n.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a!=="t"||this.regexp.uv_pattern.exec(s)===null)throw new Error("Unexpected vertex/normal/uv line: '"+s+"'")}else if(o==="f"){if((l=this.regexp.face_vertex_uv_normal.exec(s))!==null)n.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(this.regexp.face_vertex_uv.exec(s)===null)if((l=this.regexp.face_vertex_normal.exec(s))!==null)n.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if((l=this.regexp.face_vertex.exec(s))===null)throw new Error("Unexpected face line: '"+s+"'");n.addFace(l[1],l[2],l[3],l[4])}}else if(o==="l"){var u=s.substring(1).trim().split(" "),g=[],x=[];if(s.indexOf("/")===-1)g=u;else for(var y=0,b=u.length;y<b;y++){var _=u[y].split("/");_[0]!==""&&g.push(_[0]),_[1]!==""&&x.push(_[1])}n.addLineGeometry(g,x)}else if((l=this.regexp.object_pattern.exec(s))!==null){var h=l[0].substr(1).trim();n.startObject(h)}else if(!this.regexp.material_use_pattern.test(s)){if(!this.regexp.material_library_pattern.test(s)){if(this.regexp.smoothing_pattern.exec(s)===null){if(s==="\0")continue;throw new Error("Unexpected line: '"+s+"'")}}}}var f=[];for(e=0,t=n.objects.length;e<t;e++){var E=n.objects[e].geometry;if(E.vertices.length!==0){var m=new BufferGeometry;m.setAttribute("position",new BufferAttribute(new Float32Array(E.vertices),3)),E.normals.length>0?m.setAttribute("normal",new BufferAttribute(new Float32Array(E.normals),3)):m.computeVertexNormals(),f.push(m)}}return f}};Ne.add("obj",class extends Gy{get type(){return"obj"}getLoader(){return new Hy}});const qy=["int8","char","uint8","uchar","int16","short","uint16","ushort","int32","int","uint32","uint","float32","float","float64","double"];function Wy(r){if((function(e){return qy.includes(e)})(r))return r;throw new Error(`Unsupported data type: ${r}`)}function Xy(r){if(typeof r!="object"||r===null)throw new Error("Expected element to be an object");if(typeof r.name!="string")throw new Error("Expected element.name to be a string");if(typeof r.count!="number")throw new Error("Expected element.count to be a number");if(!Array.isArray(r.properties))throw new Error("Expected element.properties to be an array")}function Yy(r,e,t){switch(e){case"int8":case"char":return{read:n=>r.getInt8(n),size:1};case"uint8":case"uchar":return{read:n=>r.getUint8(n),size:1};case"int16":case"short":return{read:n=>r.getInt16(n,t),size:2};case"uint16":case"ushort":return{read:n=>r.getUint16(n,t),size:2};case"int32":case"int":return{read:n=>r.getInt32(n,t),size:4};case"uint32":case"uint":return{read:n=>r.getUint32(n,t),size:4};case"float32":case"float":return{read:n=>r.getFloat32(n,t),size:4};case"float64":case"double":return{read:n=>r.getFloat64(n,t),size:8};default:throw new Error(`Unsupported data type: ${e}`)}}function Ky(r,e){const t={};let n=0;for(let i=0;i<e.length;i++){const s=e[i],o=s.valueReader;if(s.isList){const a=[],l=s.countReader.read(r+n);n+=s.countReader.size;for(let d=0;d<l;d++)a.push(o.read(r+n)),n+=o.size;t[s.name]=a}else t[s.name]=o.read(r+n),n+=o.size}return[t,n]}class Zy{constructor(){this._color=new Color,this.propertyNameMapping={},this.customPropertyMapping={}}setPropertyNameMapping(e){this.propertyNameMapping=e}createBuffer(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const t of Object.keys(this.customPropertyMapping))e[t]=[];return e}extractHeaderText(e){let t=0,n=!0,i="";const s=[],o=new TextDecoder().decode(e.subarray(0,5)),a=/^ply\r\n/.test(o);do{const l=String.fromCharCode(e[t++]);l!==`
`&&l!=="\r"?i+=l:(i==="end_header"&&(n=!1),i!==""&&(s.push(i),i=""))}while(n&&t<e.length);return a===!0&&t++,{headerText:s.join("\r")+"\r",headerLength:t}}handleElement(e,t,n,i){if(t==="vertex"){e.vertices.push(n[i.attrX],n[i.attrY],n[i.attrZ]),i.attrNX!==null&&i.attrNY!==null&&i.attrNZ!==null&&e.normals.push(n[i.attrNX],n[i.attrNY],n[i.attrNZ]),i.attrS!==null&&i.attrT!==null&&e.uvs.push(n[i.attrS],n[i.attrT]),i.attrR!==null&&i.attrG!==null&&i.attrB!==null&&(this._color.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255).convertSRGBToLinear(),e.colors.push(this._color.r,this._color.g,this._color.b));for(const s of Object.keys(this.customPropertyMapping))for(const o of this.customPropertyMapping[s])e[s].push(n[o])}else if(t==="face"){const s=n.vertex_indices||n.vertex_index,o=n.texcoord;s.length===3?(e.indices.push(s[0],s[1],s[2]),o&&o.length===6&&(e.faceVertexUvs.push(o[0],o[1]),e.faceVertexUvs.push(o[2],o[3]),e.faceVertexUvs.push(o[4],o[5]))):s.length===4&&(e.indices.push(s[0],s[1],s[3]),e.indices.push(s[1],s[2],s[3])),i.attrR!==null&&i.attrG!==null&&i.attrB!==null&&(this._color.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255).convertSRGBToLinear(),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b))}}parse(e){let t;if(e instanceof ArrayBuffer){const n=new Uint8Array(e),{headerText:i,headerLength:s}=this.extractHeaderText(n),o=this.parseHeader(i,s);if(o.format==="ascii"){const a=new TextDecoder().decode(n);t=this.parseASCII(a,o)}else t=this.parseBinary(n,o)}else t=this.parseASCII(e,this.parseHeader(e));return t}parseHeader(e,t=0){let n="";const i=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);i!==null&&(n=i[1]);const s={comments:[],elements:[],headerLength:t,objInfo:"",format:"",version:""},o=n.split(/\r\n|\r|\n/);let a;for(let l=0;l<o.length;l++){let d=o[l];if(d=d.trim(),d==="")continue;const u=d.split(/\s+/),g=u.shift();switch(d=u.join(" "),g){case"format":s.format=u[0],s.version=u[1];break;case"comment":s.comments.push(d);break;case"element":a!==void 0&&(Xy(a),s.elements.push(a)),a={name:u[0],count:parseInt(u[1]),properties:[]};break;case"property":if(a===void 0){console.warn("property without element");continue}a.properties.push(Qy(u,this.propertyNameMapping));break;case"obj_info":s.objInfo=d;break;default:console.log("unhandled",g,u)}}return a!==void 0&&s.elements.push(a),s}parseASCII(e,t){const n=this.createBuffer();let i,s;i=(s=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(e))!==null?s[1].split(/\s+/):[];const o=new ib(i);e:for(let a=0;a<t.elements.length;a++){const l=t.elements[a],d=eb(l.properties);for(let u=0;u<l.count;u++){const g=tb(l.properties,o);if(!g)break e;this.handleElement(n,l.name,g,d)}}return this.postProcess(n)}parseBinary(e,t){const n=this.createBuffer(),i=t.format==="binary_little_endian",s=new DataView(e,t.headerLength);let o,a=0;for(let l=0;l<t.elements.length;l++){const d=t.elements[l],u=d.properties,g=eb(u),x=this.makeBinaryProperties(u,s,i);for(let y=0;y<d.count;y++){o=Ky(a,x),a+=o[1];const b=o[0];this.handleElement(n,d.name,b,g)}}return this.postProcess(n)}postProcess(e){let t=new BufferGeometry;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new Float32BufferAttribute(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(t=t.toNonIndexed(),e.faceVertexUvs.length>0&&t.setAttribute("uv",new Float32BufferAttribute(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&t.setAttribute("color",new Float32BufferAttribute(e.faceVertexColors,3)));for(const n of Object.keys(this.customPropertyMapping))e[n].length>0&&t.setAttribute(n,new Float32BufferAttribute(e[n],this.customPropertyMapping[n].length));return t.computeBoundingSphere(),t}makeBinaryProperties(e,t,n){const i=[];for(let s=0,o=e.length;s<o;s++){const a=e[s];a.isList?i.push(Object.assign(Object.assign({},a),{countReader:Yy(t,a.countType,n),valueReader:Yy(t,a.type,n)})):i.push(Object.assign(Object.assign({},a),{valueReader:Yy(t,a.type,n)}))}return i}}function Qy(r,e){const t=r[0];let n;return n=t==="list"?{isList:!0,name:r[3],type:Wy(r[2]),countType:Wy(r[1])}:{isList:!1,name:r[1],type:Wy(t)},n.name in e&&(n.name=e[n.name]),n}function Jy(r,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(r);case"float":case"double":case"float32":case"float64":return parseFloat(r)}return 0}function tb(r,e){const t={name:"",type:""};for(let n=0;n<r.length;n++){if(e.empty())return null;const i=r[n];if(i.isList){const s=[],o=Jy(e.next(),i.countType);for(let a=0;a<o;a++){if(e.empty())return null;s.push(Jy(e.next(),i.type))}t[i.name]=s}else t[r[n].name]=Jy(e.next(),r[n].type)}return t}function eb(r){const e=r.map((n=>n.name));function t(n){for(let i=0,s=n.length;i<s;i++){const o=n[i];if(e.includes(o))return o}return null}return{attrX:t(["x","px","posx"])||"x",attrY:t(["y","py","posy"])||"y",attrZ:t(["z","pz","posz"])||"z",attrNX:t(["nx","normalx"]),attrNY:t(["ny","normaly"]),attrNZ:t(["nz","normalz"]),attrS:t(["s","u","texture_u","tx"]),attrT:t(["t","v","texture_v","ty"]),attrR:t(["red","diffuse_red","r","diffuse_r"]),attrG:t(["green","diffuse_green","g","diffuse_g"]),attrB:t(["blue","diffuse_blue","b","diffuse_b"])}}class ib{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}Ne.add("ply",class extends Gy{get type(){return"ply"}getLoader(){return new Zy}});Ne.add("csv",class extends sg{constructor(r,e){const t=e||{};super(r,t),this.delimiter=nt(t.delimiter,","),this.comment=nt(t.comment,"#"),this.columnNames=nt(t.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const r=this.table.data,e=new RegExp("\\s*"+this.delimiter+"\\s*");let t=0;this.streamer.eachChunkOfLines((n=>{const i=n.length;for(let s=0;s<i;++s){const o=n[s].trim();if(o.startsWith(this.comment))continue;const a=o.split(e);t===0?this.table.columnNames=a:o&&r.push(a),++t}}))}});Ne.add("json",class extends sg{constructor(r,e){const t=e||{};super(r,t),this.string=nt(t.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}});Ne.add("msgpack",class extends sg{constructor(r,e){super(r,e||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){De&&ke.time("MsgpackParser._parse "+this.name),this.msgpack.data=$g(this.streamer.data),De&&ke.timeEnd("MsgpackParser._parse "+this.name)}});Ne.add("netcdf",class extends sg{constructor(r,e){super(r,e||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){De&&ke.time("NetcdfParser._parse "+this.name),this.netcdf.data=new uy(this.streamer.data),De&&ke.timeEnd("NetcdfParser._parse "+this.name)}});class rb extends sg{constructor(e,t){super(e,t),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}Ne.add("txt",rb),Ne.add("text",rb);const nb=/^['"]|['"]$/g,sb=/^<([\w-:.]+)\s*/,ob=/^([^<]*)/,ab=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;function cb(r){return r=r.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:e(),root:t()};function e(){if(!i(/^<\?xml\s*/))return;const a={attributes:{}};for(;!s()&&!o("?>");){const l=n();if(!l)return a;a.attributes[l.name]=l.value}return i(/\?>\s*/),a}function t(){const a=i(sb);if(!a)return;const l={name:a[1],attributes:{},children:[]};for(;!(s()||o(">")||o("?>")||o("/>"));){const u=n();if(!u)return l;l.attributes[u.name]=u.value}if(i(/^\s*\/>\s*/))return l;let d;for(i(/\??>\s*/),l.content=(function(){const u=i(ob);return u?u[1]:""})();d=t();)l.children.push(d);return i(/^<\/[\w-:.]+>\s*/),l}function n(){const a=i(ab);var l;if(a)return{name:a[1],value:(l=a[2],l.replace(nb,""))}}function i(a){const l=r.match(a);if(l)return r=r.slice(l[0].length),l}function s(){return r.length===0}function o(a){return r.indexOf(a)===0}}class lb extends sg{constructor(e,t){const n=t||{};super(e,n),this.useDomParser=nt(n.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(e){return cb(e)}__domParser(e){return new window.DOMParser().parseFromString(e,"text/xml")}_parse(){De&&ke.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),De&&ke.timeEnd("XmlParser._parse "+this.name)}}function hb(r,e){const t=r.getNamedItem(e);return t!==null?t.value:""}function ub(r,e,t=!1){const n=hb(r,"icode").trim(),i=hb(r,"chain").trim(),s=hb(r,"altcode");let o=hb(r,"resnum");return n&&(o+="^"+n),i&&(o+=":"+i),e&&(o+="."+e),t&&s.trim()&&(o+="%"+s),o+="/"+(parseInt(hb(r,"model"))-1),o}function db(r){const e=hb(r,"chain").trim();let t=`[${hb(r,"rescode")}]${hb(r,"resnum")}`;return e&&(t+=`:${e}`),t}function mb(r,e,t){r[e]===void 0?r[e]=t:r[e]|=t}function fb(r,e){return r!==null&&r.value===e}function pb(r,e,t){let n=0;const i=e.getElementsByTagName("clash");for(let s=0,o=i.length;s<o;++s)if(r[hb(i[s].attributes,"cid")]){n+=1;break}return e.getElementsByTagName("angle-outlier").length>0&&(n+=1),e.getElementsByTagName("bond-outlier").length>0&&(n+=1),e.getElementsByTagName("plane-outlier").length>0&&(n+=1),fb(t.getNamedItem("rota"),"OUTLIER")&&(n+=1),fb(t.getNamedItem("rama"),"OUTLIER")&&(n+=1),fb(t.getNamedItem("RNApucker"),"outlier")&&(n+=1),n}Ne.add("xml",lb);class gb{constructor(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(e){De&&ke.time("Validation.fromXml");const t=this.rsrzDict,n=this.rsccDict,i=this.rciDict,s=this.clashDict,o=this.clashArray,a=this.geoDict,l=this.geoAtomDict,d=this.atomDict,u=e.getElementsByTagName("Entry");if(u.length===1){const b=u[0].getElementsByTagName("chemical_shift_list");if(b.length===1){const _=b[0].getElementsByTagName("random_coil_index");for(let h=0,f=_.length;h<f;++h){const E=_[h].attributes;i[db(E)]=parseFloat(hb(E,"value"))}}}const g=e.getElementsByTagName("ModelledSubgroup"),x={},y=[];De&&ke.time("Validation.fromXml#clashDict");for(let b=0,_=g.length;b<_;++b){const h=g[b],f=h.attributes,E=ub(f);f.getNamedItem("rsrz")!==null&&(t[E]=parseFloat(hb(f,"rsrz"))),f.getNamedItem("rscc")!==null&&(n[E]=parseFloat(hb(f,"rscc")));const m=e.createAttribute("sele");m.value=E,f.setNamedItem(m);const S=h.getElementsByTagName("clash");for(let w=0,v=S.length;w<v;++w){const A=S[w].attributes,M=hb(A,"atom");if(Ja(M)!=="H"){const T=hb(A,"cid"),R=ub(f,M,!0);if(d[R]=!0,x[T]===void 0)x[T]={sele1:R,res1:E};else{const O=x[T];O.res1!==E&&(O.sele2=R,O.res2=E,y.push(O.res1,E),s[T]=O,o.push(O))}}}}De&&ke.timeEnd("Validation.fromXml#clashDict");for(let b=0,_=g.length;b<_;++b){const h=g[b],f=h.attributes,E=hb(f,"sele");if(hb(f,"seq")!=="."){const m=pb(s,h,f);m>0&&(a[E]=m)}else{const m=h.getElementsByTagName("clash"),S=h.getElementsByTagName("mog-bond-outlier"),w=h.getElementsByTagName("mog-angle-outlier");if(S.length>0||w.length>0||m.length>0){const v={};l[E]=v;for(let A=0,M=m.length;A<M;++A){const T=m[A].attributes;s[hb(T,"cid")]&&mb(v,hb(T,"atom"),1)}for(let A=0,M=S.length;A<M;++A)hb(S[A].attributes,"atoms").split(",").forEach((function(T){mb(v,T,2)}));for(let A=0,M=w.length;A<M;++A)hb(w[A].attributes,"atoms").split(",").forEach((function(T){mb(v,T,4)}))}}}this.clashSele=y.length?y.join(" OR "):"NONE",De&&ke.timeEnd("Validation.fromXml")}getClashData(e){De&&ke.time("Validation.getClashData");const t=e||{},n=t.structure,i=n.atomSet,s=new Color(nt(t.color,"#f0027f")),o=n.getAtomProxy(),a=n.getAtomProxy(),l=new Vector3,d=new Vector3,u=new Vector3,g=this.clashArray,x=g.length,y=new Float32Array(3*x),b=new Float32Array(3*x),_=Si(x,s.r,s.g,s.b),h=new Float32Array(x),f=new Float32Array(x);De&&ke.time("Validation.getClashData#atomDict");const E=this.atomDict;n.eachAtom((function(S){const w=(function(v){const A=v.inscode,M=v.chainname,T=v.atomname,R=v.altloc;let O=v.resno+"";return A&&(O+="^"+A),M&&(O+=":"+M),T&&(O+="."+T),R&&(O+="%"+R),O+="/"+v.modelIndex,O})(S);E[w]===!0&&(E[w]=S.index)})),De&&ke.timeEnd("Validation.getClashData#atomDict");let m=0;return g.forEach((function(S,w){if(o.index=E[S.sele1],a.index=E[S.sele2],o.index===void 0||a.index===void 0||!i.isSet(o.index,a.index))return;l.subVectors(a,o).setLength(o.vdw),d.copy(o).add(l),l.subVectors(o,a).setLength(a.vdw),u.copy(a).add(l);const v=o.distanceTo(a)/2,A=Math.sqrt(o.vdw*o.vdw-v*v),M=Math.sqrt(a.vdw*a.vdw-v*v);d.toArray(y,3*m),u.toArray(b,3*m),h[m]=(A+M)/2,f[m]=w,++m})),De&&ke.timeEnd("Validation.getClashData"),{position1:y.subarray(0,3*m),position2:b.subarray(0,3*m),color:_.subarray(0,3*m),color2:_.subarray(0,3*m),radius:h.subarray(0,m),picking:new Qs(f.subarray(0,m),this,n)}}}function yb(r,e){return r.length===e?r:r.subarray?r.subarray(0,e):(r.length=e,r)}function bb(r,e,t,n,i){if(e.subarray&&r.subarray)r.set(e.subarray(t,t+n),i);else for(var s=0;s<n;s++)r[i+s]=e[t+s]}function _b(r,e,t,n){for(var i=65535&r,s=r>>>16&65535,o=0;t!==0;){t-=o=t>2e3?2e3:t;do s=s+(i=i+e[n++]|0)|0;while(--o);i%=65521,s%=65521}return i|s<<16}Ne.add("validation",class extends lb{constructor(r,e){super(r,e||{}),this.useDomParser=!0,this.validation=new gb(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),De&&ke.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),De&&ke.timeEnd("ValidationParser._parse "+this.name)}});var xb=(function(){for(var r,e=[],t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e})();function vb(r,e,t,n){var i=xb,s=n+t;r^=-1;for(var o=n;o<s;o++)r=r>>>8^i[255&(r^e[o])];return~r}var wb=30,Ab=12;function Sb(r,e){var t,n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R;t=r.state,n=r.next_in,T=r.input,i=n+(r.avail_in-5),s=r.next_out,R=r.output,o=s-(e-r.avail_out),a=s+(r.avail_out-257),l=t.dmax,d=t.wsize,u=t.whave,g=t.wnext,x=t.window,y=t.hold,b=t.bits,_=t.lencode,h=t.distcode,f=(1<<t.lenbits)-1,E=(1<<t.distbits)-1;e:do{b<15&&(y+=T[n++]<<b,b+=8,y+=T[n++]<<b,b+=8),m=_[y&f];t:for(;;){if(y>>>=S=m>>>24,b-=S,(S=m>>>16&255)===0)R[s++]=65535&m;else{if(!(16&S)){if(64&S){if(32&S){t.mode=Ab;break e}r.msg="invalid literal/length code",t.mode=wb;break e}m=_[(65535&m)+(y&(1<<S)-1)];continue t}for(w=65535&m,(S&=15)&&(b<S&&(y+=T[n++]<<b,b+=8),w+=y&(1<<S)-1,y>>>=S,b-=S),b<15&&(y+=T[n++]<<b,b+=8,y+=T[n++]<<b,b+=8),m=h[y&E];;){if(y>>>=S=m>>>24,b-=S,16&(S=m>>>16&255)){if(v=65535&m,b<(S&=15)&&(y+=T[n++]<<b,(b+=8)<S&&(y+=T[n++]<<b,b+=8)),(v+=y&(1<<S)-1)>l){r.msg="invalid distance too far back",t.mode=wb;break e}if(y>>>=S,b-=S,v>(S=s-o)){if((S=v-S)>u&&t.sane){r.msg="invalid distance too far back",t.mode=wb;break e}if(A=0,M=x,g===0){if(A+=d-S,S<w){w-=S;do R[s++]=x[A++];while(--S);A=s-v,M=R}}else if(g<S){if(A+=d+g-S,(S-=g)<w){w-=S;do R[s++]=x[A++];while(--S);if(A=0,g<w){w-=S=g;do R[s++]=x[A++];while(--S);A=s-v,M=R}}}else if(A+=g-S,S<w){w-=S;do R[s++]=x[A++];while(--S);A=s-v,M=R}for(;w>2;)R[s++]=M[A++],R[s++]=M[A++],R[s++]=M[A++],w-=3;w&&(R[s++]=M[A++],w>1&&(R[s++]=M[A++]))}else{A=s-v;do R[s++]=R[A++],R[s++]=R[A++],R[s++]=R[A++],w-=3;while(w>2);w&&(R[s++]=R[A++],w>1&&(R[s++]=R[A++]))}break}if(64&S){r.msg="invalid distance code",t.mode=wb;break e}m=h[(65535&m)+(y&(1<<S)-1)]}}break}}while(n<i&&s<a);n-=w=b>>3,y&=(1<<(b-=w<<3))-1,r.next_in=n,r.next_out=s,r.avail_in=n<i?i-n+5:5-(n-i),r.avail_out=s<a?a-s+257:257-(s-a),t.hold=y,t.bits=b}var Cb=15,Pb=852,Ib=592,kb=0,Mb=1,Tb=2,Db=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Bb=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Fb=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Eb=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function $b(r,e,t,n,i,s,o,a){var l,d,u,g,x,y,b,_,h,f=a.bits,E=0,m=0,S=0,w=0,v=0,A=0,M=0,T=0,R=0,O=0,L=null,P=0,I=new Uint16Array(Cb+1),N=new Uint16Array(Cb+1),U=null,F=0;for(E=0;E<=Cb;E++)I[E]=0;for(m=0;m<n;m++)I[e[t+m]]++;for(v=f,w=Cb;w>=1&&I[w]===0;w--);if(v>w&&(v=w),w===0)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(S=1;S<w&&I[S]===0;S++);for(v<S&&(v=S),T=1,E=1;E<=Cb;E++)if(T<<=1,(T-=I[E])<0)return-1;if(T>0&&(r===kb||w!==1))return-1;for(N[1]=0,E=1;E<Cb;E++)N[E+1]=N[E]+I[E];for(m=0;m<n;m++)e[t+m]!==0&&(o[N[e[t+m]]++]=m);if(r===kb?(L=U=o,y=19):r===Mb?(L=Db,P-=257,U=Bb,F-=257,y=256):(L=Fb,U=Eb,y=-1),O=0,m=0,E=S,x=s,A=v,M=0,u=-1,g=(R=1<<v)-1,r===Mb&&R>Pb||r===Tb&&R>Ib)return 1;for(;;){b=E-M,o[m]<y?(_=0,h=o[m]):o[m]>y?(_=U[F+o[m]],h=L[P+o[m]]):(_=96,h=0),l=1<<E-M,S=d=1<<A;do i[x+(O>>M)+(d-=l)]=b<<24|_<<16|h;while(d!==0);for(l=1<<E-1;O&l;)l>>=1;if(l!==0?(O&=l-1,O+=l):O=0,m++,--I[E]==0){if(E===w)break;E=e[t+o[m]]}if(E>v&&(O&g)!==u){for(M===0&&(M=v),x+=S,T=1<<(A=E-M);A+M<w&&!((T-=I[A+M])<=0);)A++,T<<=1;if(R+=1<<A,r===Mb&&R>Pb||r===Tb&&R>Ib)return 1;i[u=O&g]=v<<24|A<<16|x-s}}return O!==0&&(i[x+O]=E-M<<24|64<<16),a.bits=v,0}var Ob=1,Rb=2,Lb=0,Nb=-2,zb=1,Ub=12,Vb=30,jb=852,Gb=592;function Hb(r){return(r>>>24&255)+(r>>>8&65280)+((65280&r)<<8)+((255&r)<<24)}function qb(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Wb(r){var e;return r&&r.state?((e=r.state).wsize=0,e.whave=0,e.wnext=0,(function(t){var n;return t&&t.state?(n=t.state,t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=1&n.wrap),n.mode=zb,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(jb),n.distcode=n.distdyn=new Int32Array(Gb),n.sane=1,n.back=-1,Lb):Nb})(r)):Nb}function Xb(r,e){var t,n;return r?(n=new qb,r.state=n,n.window=null,t=(function(i,s){var o,a;return i&&i.state?(a=i.state,s<0?(o=0,s=-s):(o=1+(s>>4),s<48&&(s&=15)),s&&(s<8||s>15)?Nb:(a.window!==null&&a.wbits!==s&&(a.window=null),a.wrap=o,a.wbits=s,Wb(i))):Nb})(r,e),t!==Lb&&(r.state=null),t):Nb}var Yb,Kb,Zb=!0;function Qb(r){if(Zb){var e;for(Yb=new Int32Array(512),Kb=new Int32Array(32),e=0;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for($b(Ob,r.lens,0,288,Yb,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;$b(Rb,r.lens,0,32,Kb,0,r.work,{bits:5}),Zb=!1}r.lencode=Yb,r.lenbits=9,r.distcode=Kb,r.distbits=5}function Jb(r,e,t,n){var i,s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(bb(s.window,e,t-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((i=s.wsize-s.wnext)>n&&(i=n),bb(s.window,e,t-n,i,s.wnext),(n-=i)?(bb(s.window,e,t-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function t_(r,e){var t,n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R=0,O=new Uint8Array(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return Nb;(t=r.state).mode===Ub&&(t.mode=13),o=r.next_out,i=r.output,l=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,d=t.hold,u=t.bits,g=a,x=l,A=Lb;e:for(;;)switch(t.mode){case zb:if(t.wrap===0){t.mode=13;break}for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(2&t.wrap&&d===35615){t.check=0,O[0]=255&d,O[1]=d>>>8&255,t.check=vb(t.check,O,2,0),d=0,u=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&d)<<8)+(d>>8))%31){r.msg="incorrect header check",t.mode=Vb;break}if((15&d)!=8){r.msg="unknown compression method",t.mode=Vb;break}if(u-=4,v=8+(15&(d>>>=4)),t.wbits===0)t.wbits=v;else if(v>t.wbits){r.msg="invalid window size",t.mode=Vb;break}t.dmax=1<<v,r.adler=t.check=1,t.mode=512&d?10:Ub,d=0,u=0;break;case 2:for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(t.flags=d,(255&t.flags)!=8){r.msg="unknown compression method",t.mode=Vb;break}if(57344&t.flags){r.msg="unknown header flags set",t.mode=Vb;break}t.head&&(t.head.text=d>>8&1),512&t.flags&&(O[0]=255&d,O[1]=d>>>8&255,t.check=vb(t.check,O,2,0)),d=0,u=0,t.mode=3;case 3:for(;u<32;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.head&&(t.head.time=d),512&t.flags&&(O[0]=255&d,O[1]=d>>>8&255,O[2]=d>>>16&255,O[3]=d>>>24&255,t.check=vb(t.check,O,4,0)),d=0,u=0,t.mode=4;case 4:for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.head&&(t.head.xflags=255&d,t.head.os=d>>8),512&t.flags&&(O[0]=255&d,O[1]=d>>>8&255,t.check=vb(t.check,O,2,0)),d=0,u=0,t.mode=5;case 5:if(1024&t.flags){for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.length=d,t.head&&(t.head.extra_len=d),512&t.flags&&(O[0]=255&d,O[1]=d>>>8&255,t.check=vb(t.check,O,2,0)),d=0,u=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((y=t.length)>a&&(y=a),y&&(t.head&&(v=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),bb(t.head.extra,n,s,y,v)),512&t.flags&&(t.check=vb(t.check,n,y,s)),a-=y,s+=y,t.length-=y),t.length))break e;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(a===0)break e;y=0;do v=n[s+y++],t.head&&v&&t.length<65536&&(t.head.name+=String.fromCharCode(v));while(v&&y<a);if(512&t.flags&&(t.check=vb(t.check,n,y,s)),a-=y,s+=y,v)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(a===0)break e;y=0;do v=n[s+y++],t.head&&v&&t.length<65536&&(t.head.comment+=String.fromCharCode(v));while(v&&y<a);if(512&t.flags&&(t.check=vb(t.check,n,y,s)),a-=y,s+=y,v)break e}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(d!==(65535&t.check)){r.msg="header crc mismatch",t.mode=Vb;break}d=0,u=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=Ub;break;case 10:for(;u<32;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}r.adler=t.check=Hb(d),d=0,u=0,t.mode=11;case 11:if(t.havedict===0)return r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=d,t.bits=u,2;r.adler=t.check=1,t.mode=Ub;case Ub:case 13:if(t.last){d>>>=7&u,u-=7&u,t.mode=27;break}for(;u<3;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}switch(t.last=1&d,u-=1,3&(d>>>=1)){case 0:t.mode=14;break;case 1:Qb(t),t.mode=20;break;case 2:t.mode=17;break;case 3:r.msg="invalid block type",t.mode=Vb}d>>>=2,u-=2;break;case 14:for(d>>>=7&u,u-=7&u;u<32;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if((65535&d)!=(d>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Vb;break}t.length=65535&d,d=0,u=0,t.mode=15;case 15:t.mode=16;case 16:if(y=t.length){if(y>a&&(y=a),y>l&&(y=l),y===0)break e;bb(i,n,s,y,o),a-=y,s+=y,l-=y,o+=y,t.length-=y;break}t.mode=Ub;break;case 17:for(;u<14;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(t.nlen=257+(31&d),d>>>=5,u-=5,t.ndist=1+(31&d),d>>>=5,u-=5,t.ncode=4+(15&d),d>>>=4,u-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Vb;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;u<3;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.lens[L[t.have++]]=7&d,d>>>=3,u-=3}for(;t.have<19;)t.lens[L[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,M={bits:t.lenbits},A=$b(0,t.lens,0,19,t.lencode,0,t.work,M),t.lenbits=M.bits,A){r.msg="invalid code lengths set",t.mode=Vb;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;f=(R=t.lencode[d&(1<<t.lenbits)-1])>>>16&255,E=65535&R,!((h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(E<16)d>>>=h,u-=h,t.lens[t.have++]=E;else{if(E===16){for(T=h+2;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(d>>>=h,u-=h,t.have===0){r.msg="invalid bit length repeat",t.mode=Vb;break}v=t.lens[t.have-1],y=3+(3&d),d>>>=2,u-=2}else if(E===17){for(T=h+3;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}u-=h,v=0,y=3+(7&(d>>>=h)),d>>>=3,u-=3}else{for(T=h+7;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}u-=h,v=0,y=11+(127&(d>>>=h)),d>>>=7,u-=7}if(t.have+y>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Vb;break}for(;y--;)t.lens[t.have++]=v}}if(t.mode===Vb)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Vb;break}if(t.lenbits=9,M={bits:t.lenbits},A=$b(Ob,t.lens,0,t.nlen,t.lencode,0,t.work,M),t.lenbits=M.bits,A){r.msg="invalid literal/lengths set",t.mode=Vb;break}if(t.distbits=6,t.distcode=t.distdyn,M={bits:t.distbits},A=$b(Rb,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,M),t.distbits=M.bits,A){r.msg="invalid distances set",t.mode=Vb;break}t.mode=20;case 20:t.mode=21;case 21:if(a>=6&&l>=258){r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=d,t.bits=u,Sb(r,x),o=r.next_out,i=r.output,l=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,d=t.hold,u=t.bits,t.mode===Ub&&(t.back=-1);break}for(t.back=0;f=(R=t.lencode[d&(1<<t.lenbits)-1])>>>16&255,E=65535&R,!((h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(f&&!(240&f)){for(m=h,S=f,w=E;f=(R=t.lencode[w+((d&(1<<m+S)-1)>>m)])>>>16&255,E=65535&R,!(m+(h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}d>>>=m,u-=m,t.back+=m}if(d>>>=h,u-=h,t.back+=h,t.length=E,f===0){t.mode=26;break}if(32&f){t.back=-1,t.mode=Ub;break}if(64&f){r.msg="invalid literal/length code",t.mode=Vb;break}t.extra=15&f,t.mode=22;case 22:if(t.extra){for(T=t.extra;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.length+=d&(1<<t.extra)-1,d>>>=t.extra,u-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;f=(R=t.distcode[d&(1<<t.distbits)-1])>>>16&255,E=65535&R,!((h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(!(240&f)){for(m=h,S=f,w=E;f=(R=t.distcode[w+((d&(1<<m+S)-1)>>m)])>>>16&255,E=65535&R,!(m+(h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}d>>>=m,u-=m,t.back+=m}if(d>>>=h,u-=h,t.back+=h,64&f){r.msg="invalid distance code",t.mode=Vb;break}t.offset=E,t.extra=15&f,t.mode=24;case 24:if(t.extra){for(T=t.extra;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.offset+=d&(1<<t.extra)-1,d>>>=t.extra,u-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Vb;break}t.mode=25;case 25:if(l===0)break e;if(y=x-l,t.offset>y){if((y=t.offset-y)>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Vb;break}y>t.wnext?(y-=t.wnext,b=t.wsize-y):b=t.wnext-y,y>t.length&&(y=t.length),_=t.window}else _=i,b=o-t.offset,y=t.length;y>l&&(y=l),l-=y,t.length-=y;do i[o++]=_[b++];while(--y);t.length===0&&(t.mode=21);break;case 26:if(l===0)break e;i[o++]=t.length,l--,t.mode=21;break;case 27:if(t.wrap){for(;u<32;){if(a===0)break e;a--,d|=n[s++]<<u,u+=8}if(x-=l,r.total_out+=x,t.total+=x,x&&(r.adler=t.check=t.flags?vb(t.check,i,x,o-x):_b(t.check,i,x,o-x)),x=l,(t.flags?d:Hb(d))!==t.check){r.msg="incorrect data check",t.mode=Vb;break}d=0,u=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;u<32;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(d!==(4294967295&t.total)){r.msg="incorrect length check",t.mode=Vb;break}d=0,u=0}t.mode=29;case 29:A=1;break e;case Vb:A=-3;break e;case 31:return-4;default:return Nb}return r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=d,t.bits=u,(t.wsize||x!==r.avail_out&&t.mode<Vb&&(t.mode<27||e!==4))&&Jb(r,r.output,r.next_out,x-r.avail_out),g-=r.avail_in,x-=r.avail_out,r.total_in+=g,r.total_out+=x,t.total+=x,t.wrap&&x&&(r.adler=t.check=t.flags?vb(t.check,i,x,r.next_out-x):_b(t.check,i,x,r.next_out-x)),r.data_type=t.bits+(t.last?64:0)+(t.mode===Ub?128:0)+(t.mode===20||t.mode===15?256:0),(g===0&&x===0||e===4)&&A===Lb&&(A=-5),A}function e_(r,e){var t,n=e.length;return r&&r.state?(t=r.state).wrap!==0&&t.mode!==11?Nb:t.mode===11&&_b(1,e,n,0)!==t.check?-3:Jb(r,e,n,n)?(t.mode=31,-4):(t.havedict=1,Lb):Nb}var i_=!0,r_=!0;try{String.fromCharCode.apply(null,[0])}catch{i_=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r_=!1}for(var n_=new Uint8Array(256),s_=0;s_<256;s_++)n_[s_]=s_>=252?6:s_>=248?5:s_>=240?4:s_>=224?3:s_>=192?2:1;function o_(r){var e,t,n,i,s,o=r.length,a=0;for(i=0;i<o;i++)(64512&(t=r.charCodeAt(i)))==55296&&i+1<o&&(64512&(n=r.charCodeAt(i+1)))==56320&&(t=65536+(t-55296<<10)+(n-56320),i++),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)(64512&(t=r.charCodeAt(i)))==55296&&i+1<o&&(64512&(n=r.charCodeAt(i+1)))==56320&&(t=65536+(t-55296<<10)+(n-56320),i++),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|63&t):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|63&t):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|63&t);return e}function a_(r,e){var t,n,i,s,o=e||r.length,a=new Array(2*o);for(n=0,t=0;t<o;)if((i=r[t++])<128)a[n++]=i;else if((s=n_[i])>4)a[n++]=65533,t+=s-1;else{for(i&=s===2?31:s===3?15:7;s>1&&t<o;)i=i<<6|63&r[t++],s--;s>1?a[n++]=65533:i<65536?a[n++]=i:(i-=65536,a[n++]=55296|i>>10&1023,a[n++]=56320|1023&i)}return(function(l,d){if(d<65537&&(l.subarray&&r_||!l.subarray&&i_))return String.fromCharCode.apply(null,yb(l,d));for(var u="",g=0;g<d;g++)u+=String.fromCharCode(l[g]);return u})(a,n)}function c_(r,e){var t;for((e=e||r.length)>r.length&&(e=r.length),t=e-1;t>=0&&(192&r[t])==128;)t--;return t<0||t===0?e:t+n_[r[t]]>e?t:e}n_[254]=n_[254]=1;var l_=0,h_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function u_(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function d_(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var m_=Object.prototype.toString;function f_(r){if(!(this instanceof f_))return new f_(r);this.options=(function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var d in l)l.hasOwnProperty(d)&&(o[d]=l[d])}}return o})({chunkSize:16384,windowBits:0,to:""},r||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||r&&r.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u_,this.strm.avail_out=0;var t,n,i,s=Xb(this.strm,e.windowBits);if(s!==l_)throw new Error(h_[s]);this.header=new d_,t=this.strm,n=this.header,t&&t.state&&2&(i=t.state).wrap&&(i.head=n,n.done=!1)}f_.prototype.push=function(r,e){var t,n,i,s,o,a,l=this.strm,d=this.options.chunkSize,u=this.options.dictionary,g=!1;if(this.ended)return!1;n=e===~~e?e:e===!0?4:0,typeof r=="string"?l.input=(function(x){for(var y=new Uint8Array(x.length),b=0,_=y.length;b<_;b++)y[b]=x.charCodeAt(b);return y})(r):m_.call(r)==="[object ArrayBuffer]"?l.input=new Uint8Array(r):l.input=r,l.next_in=0,l.avail_in=l.input.length;do{if(l.avail_out===0&&(l.output=new Uint8Array(d),l.next_out=0,l.avail_out=d),(t=t_(l,0))===2&&u&&(a=typeof u=="string"?o_(u):m_.call(u)==="[object ArrayBuffer]"?new Uint8Array(u):u,t=e_(this.strm,a)),t===-5&&g===!0&&(t=l_,g=!1),t!==1&&t!==l_)return this.onEnd(t),this.ended=!0,!1;l.next_out&&(l.avail_out!==0&&t!==1&&(l.avail_in!==0||n!==4&&n!==2)||(this.options.to==="string"?(i=c_(l.output,l.next_out),s=l.next_out-i,o=a_(l.output,i),l.next_out=s,l.avail_out=d-s,s&&bb(l.output,l.output,i,s,0),this.onData(o)):this.onData(yb(l.output,l.next_out)))),l.avail_in===0&&l.avail_out===0&&(g=!0)}while((l.avail_in>0||l.avail_out===0)&&t!==1);return t===1&&(n=4),n===4?(t=(function(x){if(!x||!x.state)return Nb;var y=x.state;return y.window&&(y.window=null),x.state=null,Lb})(this.strm),this.onEnd(t),this.ended=!0,t===l_):n!==2||(this.onEnd(l_),l.avail_out=0,!0)},f_.prototype.onData=function(r){this.chunks.push(r)},f_.prototype.onEnd=function(r){r===l_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=(function(e){var t,n,i,s,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),s=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,s),s+=o.length;return a})(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg},Ue.add("gz",(function(r){let e;r instanceof ArrayBuffer&&(r=new Uint8Array(r));try{e=(function(t,n){var i=new f_(n);if(i.push(t,!0),i.err)throw i.msg;return i.result})(r)}catch{e=r}return e}));class p_{}const g_="https:";Re.add("rcsb",new class extends p_{getUrl(r){const e=ii(r),t=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);return!["pdb","cif"].includes(e.ext)||e.compressed!==!1&&e.compressed!=="gz"?(e.ext==="mmtf"&&(ke.warn(`MMTF files distribution has been discontinued by RCSB PDB as of July 2024.
 Defaulting to bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice`),e.base.endsWith(".bb")&&ke.warn("Backbone only files are not available from RCSB PDB anymore."),e.ext=""),e.ext?ke.warn("unsupported ext",e.ext):ke.warn(`mmCif files available from RCSB PDB lack connectivity information.
 Consider using PDBe as the data provider for using "Updated mmCif files" that contain residues connectivity records.`),g_+"//models.rcsb.org/"+t+".bcif.gz"):g_+"//files.rcsb.org/download/"+e.path}getExt(r){return ii(r).ext||"bcif"}});const y_="//www.ebi.ac.uk/pdbe/entry-files/download/";Re.add("pdbe",new class extends p_{getUrl(r){const e=ii(r);let t,n=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);switch(e.ext){case"cif":t=y_+n+"_updated.cif";break;case"pdb":case"ent":n.startsWith("pdb")||(n="pdb"+n),t=y_+n+".ent";break;case"bcif":t=y_+e.path;break;case"":t=y_+n+".bcif";break;default:ke.warn("unsupported ext",e.ext),t=y_+n+".bcif"}return"https://"+t}getExt(r){return ii(r).ext||"bcif"}});const b_="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",__="/SDF?record_type=3d";Re.add("pubchem",new class extends p_{getUrl(r){const e=ii(r),t=e.name;let n;return e.ext&&e.ext!=="sdf"&&ke.warn("unsupported ext",e.ext),n=b_+t+__,(function(){const i=window.location.protocol;return i.match(/http(s)?:/gi)===null?"http:":i})()+n}getExt(r){return ii(r).ext||"sdf"}});class x_ extends p_{getUrl(e){return e}getExt(e){return ii(e).ext}}Re.add("ftp",new x_),Re.add("http",new x_),Re.add("https",new x_);const v_="//alphafold.ebi.ac.uk/files/AF-",w_="-F1-model_v4.pdb";Re.add("alphafold",new class extends p_{getUrl(r){const e=ii(r),t=e.name;let n;return e.ext&&e.ext!=="pdb"&&ke.warn("unsupported AF ext",e.ext),n=v_+t+w_,"https://"+n}getExt(r){return ii(r).ext||"pdb"}});function M_(...r){return{type:"select",options:r.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:t})),{})}}M_("auto","low","medium","high"),M_("scene","camera"),M_("relative","absolute"),M_("perspective","orthographic","stereo"),M_(...Object.keys(Ko));const toKebabCase=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),toCamelCase=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),toPascalCase=r=>{const e=toCamelCase(r);return e.charAt(0).toUpperCase()+e.slice(1)},mergeClasses=(...r)=>r.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),hasA11yProp=r=>{for(const e in r)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Icon=reactExports.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:i="",children:s,iconNode:o,...a},l)=>reactExports.createElement("svg",{ref:l,...defaultAttributes,width:e,height:e,stroke:r,strokeWidth:n?Number(t)*24/Number(e):t,className:mergeClasses("lucide",i),...!s&&!hasA11yProp(a)&&{"aria-hidden":"true"},...a},[...o.map(([d,u])=>reactExports.createElement(d,u)),...Array.isArray(s)?s:[s]]));const createLucideIcon=(r,e)=>{const t=reactExports.forwardRef(({className:n,...i},s)=>reactExports.createElement(Icon,{ref:s,iconNode:e,className:mergeClasses(`lucide-${toKebabCase(toPascalCase(r))}`,`lucide-${r}`,n),...i}));return t.displayName=toPascalCase(r),t};const __iconNode$d=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ArrowLeft=createLucideIcon("arrow-left",__iconNode$d);const __iconNode$c=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Camera=createLucideIcon("camera",__iconNode$c);const __iconNode$b=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],CircleQuestionMark=createLucideIcon("circle-question-mark",__iconNode$b);const __iconNode$a=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Download=createLucideIcon("download",__iconNode$a);const __iconNode$9=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],FileBraces=createLucideIcon("file-braces",__iconNode$9);const __iconNode$8=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Funnel=createLucideIcon("funnel",__iconNode$8);const __iconNode$7=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],LoaderCircle=createLucideIcon("loader-circle",__iconNode$7);const __iconNode$6=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Move=createLucideIcon("move",__iconNode$6);const __iconNode$5=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],RefreshCw=createLucideIcon("refresh-cw",__iconNode$5);const __iconNode$4=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Search=createLucideIcon("search",__iconNode$4);const __iconNode$3=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],Table=createLucideIcon("table",__iconNode$3);const __iconNode$2=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Upload=createLucideIcon("upload",__iconNode$2);const __iconNode$1=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],ZoomIn=createLucideIcon("zoom-in",__iconNode$1);const __iconNode=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],ZoomOut=createLucideIcon("zoom-out",__iconNode);var _3Dmol$1={exports:{}};var _3Dmol=_3Dmol$1.exports,hasRequired_3Dmol;function require_3Dmol(){return hasRequired_3Dmol||(hasRequired_3Dmol=1,(function(module,exports$1){(function(e,t){module.exports=t()})(_3Dmol,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js":((r,e,t)=>{t.r(e),t.d(e,{IOBuffer:()=>a});var n=t("./node_modules/iobuffer/lib-esm/text.js");const i=1024*8,s=(()=>{const l=new Uint8Array(4),d=new Uint32Array(l.buffer);return!((d[0]=1)&l[0])})(),o={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class a{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(d=i,u={}){let g=!1;typeof d=="number"?d=new ArrayBuffer(d):(g=!0,this.lastWrittenByte=d.byteLength);const x=u.offset?u.offset>>>0:0,y=d.byteLength-x;let b=x;(ArrayBuffer.isView(d)||d instanceof a)&&(d.byteLength!==d.buffer.byteLength&&(b=d.byteOffset+x),d=d.buffer),g?this.lastWrittenByte=y:this.lastWrittenByte=0,this.buffer=d,this.length=y,this.byteLength=y,this.byteOffset=b,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,b,y),this._mark=0,this._marks=[]}available(d=1){return this.offset+d<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(d=1){return this.offset+=d,this}back(d=1){return this.offset-=d,this}seek(d){return this.offset=d,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const d=this._marks.pop();if(d===void 0)throw new Error("Mark stack empty");return this.seek(d),this}rewind(){return this.offset=0,this}ensureAvailable(d=1){if(!this.available(d)){const g=(this.offset+d)*2,x=new Uint8Array(g);x.set(new Uint8Array(this.buffer)),this.buffer=x.buffer,this.length=g,this.byteLength=g,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(d=1){return this.readArray(d,"uint8")}readArray(d,u){const g=o[u].BYTES_PER_ELEMENT*d,x=this.byteOffset+this.offset,y=this.buffer.slice(x,x+g);if(this.littleEndian===s&&u!=="uint8"&&u!=="int8"){const _=new Uint8Array(this.buffer.slice(x,x+g));_.reverse();const h=new o[u](_.buffer);return this.offset+=g,h.reverse(),h}const b=new o[u](y);return this.offset+=g,b}readInt16(){const d=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,d}readUint16(){const d=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,d}readInt32(){const d=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,d}readUint32(){const d=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,d}readFloat32(){const d=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,d}readFloat64(){const d=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,d}readBigInt64(){const d=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,d}readBigUint64(){const d=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,d}readChar(){return String.fromCharCode(this.readInt8())}readChars(d=1){let u="";for(let g=0;g<d;g++)u+=this.readChar();return u}readUtf8(d=1){return(0,n.decode)(this.readBytes(d))}decodeText(d=1,u="utf8"){return(0,n.decode)(this.readBytes(d),u)}writeBoolean(d){return this.writeUint8(d?255:0),this}writeInt8(d){return this.ensureAvailable(1),this._data.setInt8(this.offset++,d),this._updateLastWrittenByte(),this}writeUint8(d){return this.ensureAvailable(1),this._data.setUint8(this.offset++,d),this._updateLastWrittenByte(),this}writeByte(d){return this.writeUint8(d)}writeBytes(d){this.ensureAvailable(d.length);for(let u=0;u<d.length;u++)this._data.setUint8(this.offset++,d[u]);return this._updateLastWrittenByte(),this}writeInt16(d){return this.ensureAvailable(2),this._data.setInt16(this.offset,d,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(d){return this.ensureAvailable(2),this._data.setUint16(this.offset,d,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(d){return this.ensureAvailable(4),this._data.setInt32(this.offset,d,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(d){return this.ensureAvailable(4),this._data.setUint32(this.offset,d,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(d){return this.ensureAvailable(4),this._data.setFloat32(this.offset,d,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(d){return this.ensureAvailable(8),this._data.setFloat64(this.offset,d,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(d){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,d,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(d){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,d,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(d){return this.writeUint8(d.charCodeAt(0))}writeChars(d){for(let u=0;u<d.length;u++)this.writeUint8(d.charCodeAt(u));return this}writeUtf8(d){return this.writeBytes((0,n.encode)(d))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}}),"./node_modules/iobuffer/lib-esm/text.js":((r,e,t)=>{t.r(e),t.d(e,{decode:()=>n,encode:()=>s});function n(o,a="utf8"){return new TextDecoder(a).decode(o)}const i=new TextEncoder;function s(o){return i.encode(o)}}),"./node_modules/netcdfjs/lib-esm/data.js":((r,e,t)=>{t.r(e),t.d(e,{nonRecord:()=>i,record:()=>s});var n=t("./node_modules/netcdfjs/lib-esm/types.js");function i(o,a){const l=(0,n.str2num)(a.type),d=a.size/(0,n.num2bytes)(l),u=new Array(d);for(let g=0;g<d;g++)u[g]=(0,n.readType)(o,l,1);return u}function s(o,a,l){const d=(0,n.str2num)(a.type),u=a.size?a.size/(0,n.num2bytes)(d):1,g=l.length,x=new Array(g),y=l.recordStep;if(y)for(let b=0;b<g;b++){const _=o.offset;x[b]=(0,n.readType)(o,d,u),o.seek(_+y)}else throw new Error("recordDimension.recordStep is undefined");return x}}),"./node_modules/netcdfjs/lib-esm/header.js":((r,e,t)=>{t.r(e),t.d(e,{header:()=>u});var n=t("./node_modules/netcdfjs/lib-esm/types.js"),i=t("./node_modules/netcdfjs/lib-esm/utils.js");const s=0,o=10,a=11,l=12,d=0;function u(b,_){const h={version:_},f={length:b.readUint32()},E=g(b);Array.isArray(E)||(f.id=E.recordId,f.name=E.recordName,h.dimensions=E.dimensions),h.globalAttributes=x(b);const m=y(b,f?.id,_);return Array.isArray(m)||(h.variables=m.variables,f.recordStep=m.recordStep),h.recordDimension=f,h}function g(b){const _={};let h,f;const E=b.readUint32();let m;if(E===s)return(0,i.notNetcdf)(b.readUint32()!==s,"wrong empty tag for list of dimensions"),[];{(0,i.notNetcdf)(E!==o,"wrong tag for list of dimensions");const S=b.readUint32();m=new Array(S);for(let w=0;w<S;w++){const v=(0,i.readName)(b),A=b.readUint32();A===d&&(h=w,f=v),m[w]={name:v,size:A}}}return h!==void 0&&(_.recordId=h),f!==void 0&&(_.recordName=f),_.dimensions=m,_}function x(b){const _=b.readUint32();let h;if(_===s)return(0,i.notNetcdf)(b.readUint32()!==s,"wrong empty tag for list of attributes"),[];{(0,i.notNetcdf)(_!==l,"wrong tag for list of attributes");const f=b.readUint32();h=new Array(f);for(let E=0;E<f;E++){const m=(0,i.readName)(b),S=b.readUint32();(0,i.notNetcdf)(S<1||S>6,`non valid type ${S}`);const w=b.readUint32(),v=(0,n.readType)(b,S,w);(0,i.padding)(b),h[E]={name:m,type:(0,n.num2str)(S),value:v}}}return h}function y(b,_,h){const f=b.readUint32();let E=0,m;if(f===s)return(0,i.notNetcdf)(b.readUint32()!==s,"wrong empty tag for list of variables"),[];{(0,i.notNetcdf)(f!==a,"wrong tag for list of variables");const S=b.readUint32();m=new Array(S);for(let w=0;w<S;w++){const v=(0,i.readName)(b),A=b.readUint32(),M=new Array(A);for(let I=0;I<A;I++)M[I]=b.readUint32();const T=x(b),R=b.readUint32();(0,i.notNetcdf)(R<1&&R>6,`non valid type ${R}`);const O=b.readUint32();let L=b.readUint32();h===2&&((0,i.notNetcdf)(L>0,"offsets larger than 4GB not supported"),L=b.readUint32());let P=!1;typeof _<"u"&&M[0]===_&&(E+=O,P=!0),m[w]={name:v,dimensions:M,attributes:T,type:(0,n.num2str)(R),size:O,offset:L,record:P}}}return{variables:m,recordStep:E}}}),"./node_modules/netcdfjs/lib-esm/index.js":((r,e,t)=>{t.r(e),t.d(e,{NetCDFReader:()=>n.NetCDFReader});var n=t("./node_modules/netcdfjs/lib-esm/parser.js")}),"./node_modules/netcdfjs/lib-esm/parser.js":((r,e,t)=>{t.r(e),t.d(e,{NetCDFReader:()=>l});var n=t("./node_modules/iobuffer/lib-esm/IOBuffer.js"),i=t("./node_modules/netcdfjs/lib-esm/data.js"),s=t("./node_modules/netcdfjs/lib-esm/header.js"),o=t("./node_modules/netcdfjs/lib-esm/toString.js"),a=t("./node_modules/netcdfjs/lib-esm/utils.js");class l{constructor(u){this.toString=o.toString;const g=new n.IOBuffer(u);g.setBigEndian(),(0,a.notNetcdf)(g.readChars(3)!=="CDF","should start with CDF");const x=g.readByte();(0,a.notNetcdf)(x>2,"unknown version"),this.header=(0,s.header)(g,x),this.buffer=g}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(u){const g=this.globalAttributes.find(x=>x.name===u);return g?g.value:null}getDataVariableAsString(u){const g=this.getDataVariable(u);return g?g.join(""):null}get variables(){return this.header.variables}getDataVariable(u){let g;if(typeof u=="string"?g=this.header.variables.find(x=>x.name===u):g=u,g===void 0)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(g.offset),g.record?(0,i.record)(this.buffer,g,this.header.recordDimension):(0,i.nonRecord)(this.buffer,g)}dataVariableExists(u){return this.header.variables.find(x=>x.name===u)!==void 0}attributeExists(u){return this.globalAttributes.find(x=>x.name===u)!==void 0}}}),"./node_modules/netcdfjs/lib-esm/toString.js":((r,e,t)=>{t.r(e),t.d(e,{toString:()=>n});function n(){const i=[];i.push("DIMENSIONS");for(const o of this.dimensions)i.push(`  ${o.name.padEnd(30)} = size: ${o.size}`);i.push(""),i.push("GLOBAL ATTRIBUTES");for(const o of this.globalAttributes)i.push(`  ${o.name.padEnd(30)} = ${o.value}`);const s=JSON.parse(JSON.stringify(this.variables));i.push(""),i.push("VARIABLES:");for(const o of s){o.value=this.getDataVariable(o);let a=JSON.stringify(o.value);a.length>50&&(a=a.substring(0,50)),isNaN(o.value.length)||(a+=` (length: ${o.value.length})`),i.push(`  ${o.name.padEnd(30)} = ${a}`)}return i.join(`
`)}}),"./node_modules/netcdfjs/lib-esm/types.js":((r,e,t)=>{t.r(e),t.d(e,{num2bytes:()=>s,num2str:()=>i,readType:()=>l,str2num:()=>o});const n={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function i(u){switch(Number(u)){case n.BYTE:return"byte";case n.CHAR:return"char";case n.SHORT:return"short";case n.INT:return"int";case n.FLOAT:return"float";case n.DOUBLE:return"double";default:return"undefined"}}function s(u){switch(Number(u)){case n.BYTE:return 1;case n.CHAR:return 1;case n.SHORT:return 2;case n.INT:return 4;case n.FLOAT:return 4;case n.DOUBLE:return 8;default:return-1}}function o(u){switch(String(u)){case"byte":return n.BYTE;case"char":return n.CHAR;case"short":return n.SHORT;case"int":return n.INT;case"float":return n.FLOAT;case"double":return n.DOUBLE;default:return-1}}function a(u,g){if(u!==1){const x=new Array(u);for(let y=0;y<u;y++)x[y]=g();return x}else return g()}function l(u,g,x){switch(g){case n.BYTE:return Array.from(u.readBytes(x));case n.CHAR:return d(u.readChars(x));case n.SHORT:return a(x,u.readInt16.bind(u));case n.INT:return a(x,u.readInt32.bind(u));case n.FLOAT:return a(x,u.readFloat32.bind(u));case n.DOUBLE:return a(x,u.readFloat64.bind(u));default:throw new Error(`non valid type ${g}`)}}function d(u){return u.charCodeAt(u.length-1)===0?u.substring(0,u.length-1):u}}),"./node_modules/netcdfjs/lib-esm/utils.js":((r,e,t)=>{t.r(e),t.d(e,{notNetcdf:()=>n,padding:()=>i,readName:()=>s});function n(o,a){if(o)throw new TypeError(`Not a valid NetCDF v3.x file: ${a}`)}function i(o){o.offset%4!==0&&o.skip(4-o.offset%4)}function s(o){const a=o.readUint32(),l=o.readChars(a);return i(o),l}}),"./node_modules/pako/dist/pako.esm.mjs":((r,e,t)=>{t.r(e),t.d(e,{Deflate:()=>Yx,Inflate:()=>wx,constants:()=>JS,default:()=>Cx,deflate:()=>Kx,deflateRaw:()=>lS,gzip:()=>Mx,inflate:()=>YA,inflateRaw:()=>QS,ungzip:()=>KA});const n=4,i=0,s=1,o=2;function a(z){let si=z.length;for(;--si>=0;)z[si]=0}const l=0,d=1,u=2,g=3,x=258,y=29,b=256,_=b+1+y,h=30,f=19,E=2*_+1,m=15,S=16,w=7,v=256,A=16,M=17,T=18,R=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),O=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),L=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),P=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),I=512,N=new Array((_+2)*2);a(N);const U=new Array(h*2);a(U);const F=new Array(I);a(F);const k=new Array(x-g+1);a(k);const j=new Array(y);a(j);const H=new Array(h);a(H);function B(z,si,X,r0,x0){this.static_tree=z,this.extra_bits=si,this.extra_base=X,this.elems=r0,this.max_length=x0,this.has_stree=z&&z.length}let V,Y,K;function J(z,si){this.dyn_tree=z,this.max_code=0,this.stat_desc=si}const Te=z=>z<256?F[z]:F[256+(z>>>7)],He=(z,si)=>{z.pending_buf[z.pending++]=si&255,z.pending_buf[z.pending++]=si>>>8&255},Q=(z,si,X)=>{z.bi_valid>S-X?(z.bi_buf|=si<<z.bi_valid&65535,He(z,z.bi_buf),z.bi_buf=si>>S-z.bi_valid,z.bi_valid+=X-S):(z.bi_buf|=si<<z.bi_valid&65535,z.bi_valid+=X)},Xe=(z,si,X)=>{Q(z,X[si*2],X[si*2+1])},ut=(z,si)=>{let X=0;do X|=z&1,z>>>=1,X<<=1;while(--si>0);return X>>>1},Ji=z=>{z.bi_valid===16?(He(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):z.bi_valid>=8&&(z.pending_buf[z.pending++]=z.bi_buf&255,z.bi_buf>>=8,z.bi_valid-=8)},er=(z,si)=>{const X=si.dyn_tree,r0=si.max_code,x0=si.stat_desc.static_tree,m0=si.stat_desc.has_stree,X0=si.stat_desc.extra_bits,U0=si.stat_desc.extra_base,m1=si.stat_desc.max_length;let I0,j0,W1,d1,s1,S1,A_=0;for(d1=0;d1<=m;d1++)z.bl_count[d1]=0;for(X[z.heap[z.heap_max]*2+1]=0,I0=z.heap_max+1;I0<E;I0++)j0=z.heap[I0],d1=X[X[j0*2+1]*2+1]+1,d1>m1&&(d1=m1,A_++),X[j0*2+1]=d1,!(j0>r0)&&(z.bl_count[d1]++,s1=0,j0>=U0&&(s1=X0[j0-U0]),S1=X[j0*2],z.opt_len+=S1*(d1+s1),m0&&(z.static_len+=S1*(x0[j0*2+1]+s1)));if(A_!==0){do{for(d1=m1-1;z.bl_count[d1]===0;)d1--;z.bl_count[d1]--,z.bl_count[d1+1]+=2,z.bl_count[m1]--,A_-=2}while(A_>0);for(d1=m1;d1!==0;d1--)for(j0=z.bl_count[d1];j0!==0;)W1=z.heap[--I0],!(W1>r0)&&(X[W1*2+1]!==d1&&(z.opt_len+=(d1-X[W1*2+1])*X[W1*2],X[W1*2+1]=d1),j0--)}},ec=(z,si,X)=>{const r0=new Array(m+1);let x0=0,m0,X0;for(m0=1;m0<=m;m0++)x0=x0+X[m0-1]<<1,r0[m0]=x0;for(X0=0;X0<=si;X0++){let U0=z[X0*2+1];U0!==0&&(z[X0*2]=ut(r0[U0]++,U0))}},ai=()=>{let z,si,X,r0,x0;const m0=new Array(m+1);for(X=0,r0=0;r0<y-1;r0++)for(j[r0]=X,z=0;z<1<<R[r0];z++)k[X++]=r0;for(k[X-1]=r0,x0=0,r0=0;r0<16;r0++)for(H[r0]=x0,z=0;z<1<<O[r0];z++)F[x0++]=r0;for(x0>>=7;r0<h;r0++)for(H[r0]=x0<<7,z=0;z<1<<O[r0]-7;z++)F[256+x0++]=r0;for(si=0;si<=m;si++)m0[si]=0;for(z=0;z<=143;)N[z*2+1]=8,z++,m0[8]++;for(;z<=255;)N[z*2+1]=9,z++,m0[9]++;for(;z<=279;)N[z*2+1]=7,z++,m0[7]++;for(;z<=287;)N[z*2+1]=8,z++,m0[8]++;for(ec(N,_+1,m0),z=0;z<h;z++)U[z*2+1]=5,U[z*2]=ut(z,5);V=new B(N,R,b+1,_,m),Y=new B(U,O,0,h,m),K=new B(new Array(0),L,0,f,w)},u0=z=>{let si;for(si=0;si<_;si++)z.dyn_ltree[si*2]=0;for(si=0;si<h;si++)z.dyn_dtree[si*2]=0;for(si=0;si<f;si++)z.bl_tree[si*2]=0;z.dyn_ltree[v*2]=1,z.opt_len=z.static_len=0,z.sym_next=z.matches=0},o0=z=>{z.bi_valid>8?He(z,z.bi_buf):z.bi_valid>0&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0},E0=(z,si,X,r0)=>{const x0=si*2,m0=X*2;return z[x0]<z[m0]||z[x0]===z[m0]&&r0[si]<=r0[X]},F0=(z,si,X)=>{const r0=z.heap[X];let x0=X<<1;for(;x0<=z.heap_len&&(x0<z.heap_len&&E0(si,z.heap[x0+1],z.heap[x0],z.depth)&&x0++,!E0(si,r0,z.heap[x0],z.depth));)z.heap[X]=z.heap[x0],X=x0,x0<<=1;z.heap[X]=r0},g0=(z,si,X)=>{let r0,x0,m0=0,X0,U0;if(z.sym_next!==0)do r0=z.pending_buf[z.sym_buf+m0++]&255,r0+=(z.pending_buf[z.sym_buf+m0++]&255)<<8,x0=z.pending_buf[z.sym_buf+m0++],r0===0?Xe(z,x0,si):(X0=k[x0],Xe(z,X0+b+1,si),U0=R[X0],U0!==0&&(x0-=j[X0],Q(z,x0,U0)),r0--,X0=Te(r0),Xe(z,X0,X),U0=O[X0],U0!==0&&(r0-=H[X0],Q(z,r0,U0)));while(m0<z.sym_next);Xe(z,v,si)},w0=(z,si)=>{const X=si.dyn_tree,r0=si.stat_desc.static_tree,x0=si.stat_desc.has_stree,m0=si.stat_desc.elems;let X0,U0,m1=-1,I0;for(z.heap_len=0,z.heap_max=E,X0=0;X0<m0;X0++)X[X0*2]!==0?(z.heap[++z.heap_len]=m1=X0,z.depth[X0]=0):X[X0*2+1]=0;for(;z.heap_len<2;)I0=z.heap[++z.heap_len]=m1<2?++m1:0,X[I0*2]=1,z.depth[I0]=0,z.opt_len--,x0&&(z.static_len-=r0[I0*2+1]);for(si.max_code=m1,X0=z.heap_len>>1;X0>=1;X0--)F0(z,X,X0);I0=m0;do X0=z.heap[1],z.heap[1]=z.heap[z.heap_len--],F0(z,X,1),U0=z.heap[1],z.heap[--z.heap_max]=X0,z.heap[--z.heap_max]=U0,X[I0*2]=X[X0*2]+X[U0*2],z.depth[I0]=(z.depth[X0]>=z.depth[U0]?z.depth[X0]:z.depth[U0])+1,X[X0*2+1]=X[U0*2+1]=I0,z.heap[1]=I0++,F0(z,X,1);while(z.heap_len>=2);z.heap[--z.heap_max]=z.heap[1],er(z,si),ec(X,m1,z.bl_count)},L0=(z,si,X)=>{let r0,x0=-1,m0,X0=si[1],U0=0,m1=7,I0=4;for(X0===0&&(m1=138,I0=3),si[(X+1)*2+1]=65535,r0=0;r0<=X;r0++)m0=X0,X0=si[(r0+1)*2+1],!(++U0<m1&&m0===X0)&&(U0<I0?z.bl_tree[m0*2]+=U0:m0!==0?(m0!==x0&&z.bl_tree[m0*2]++,z.bl_tree[A*2]++):U0<=10?z.bl_tree[M*2]++:z.bl_tree[T*2]++,U0=0,x0=m0,X0===0?(m1=138,I0=3):m0===X0?(m1=6,I0=3):(m1=7,I0=4))},T0=(z,si,X)=>{let r0,x0=-1,m0,X0=si[1],U0=0,m1=7,I0=4;for(X0===0&&(m1=138,I0=3),r0=0;r0<=X;r0++)if(m0=X0,X0=si[(r0+1)*2+1],!(++U0<m1&&m0===X0)){if(U0<I0)do Xe(z,m0,z.bl_tree);while(--U0!==0);else m0!==0?(m0!==x0&&(Xe(z,m0,z.bl_tree),U0--),Xe(z,A,z.bl_tree),Q(z,U0-3,2)):U0<=10?(Xe(z,M,z.bl_tree),Q(z,U0-3,3)):(Xe(z,T,z.bl_tree),Q(z,U0-11,7));U0=0,x0=m0,X0===0?(m1=138,I0=3):m0===X0?(m1=6,I0=3):(m1=7,I0=4)}},ht=z=>{let si;for(L0(z,z.dyn_ltree,z.l_desc.max_code),L0(z,z.dyn_dtree,z.d_desc.max_code),w0(z,z.bl_desc),si=f-1;si>=3&&z.bl_tree[P[si]*2+1]===0;si--);return z.opt_len+=3*(si+1)+5+5+4,si},We=(z,si,X,r0)=>{let x0;for(Q(z,si-257,5),Q(z,X-1,5),Q(z,r0-4,4),x0=0;x0<r0;x0++)Q(z,z.bl_tree[P[x0]*2+1],3);T0(z,z.dyn_ltree,si-1),T0(z,z.dyn_dtree,X-1)},h0=z=>{let si=4093624447,X;for(X=0;X<=31;X++,si>>>=1)if(si&1&&z.dyn_ltree[X*2]!==0)return i;if(z.dyn_ltree[18]!==0||z.dyn_ltree[20]!==0||z.dyn_ltree[26]!==0)return s;for(X=32;X<b;X++)if(z.dyn_ltree[X*2]!==0)return s;return i};let M0=!1;const Z=z=>{M0||(ai(),M0=!0),z.l_desc=new J(z.dyn_ltree,V),z.d_desc=new J(z.dyn_dtree,Y),z.bl_desc=new J(z.bl_tree,K),z.bi_buf=0,z.bi_valid=0,u0(z)},tt=(z,si,X,r0)=>{Q(z,(l<<1)+(r0?1:0),3),o0(z),He(z,X),He(z,~X),X&&z.pending_buf.set(z.window.subarray(si,si+X),z.pending),z.pending+=X},tr=z=>{Q(z,d<<1,3),Xe(z,v,N),Ji(z)},s0=(z,si,X,r0)=>{let x0,m0,X0=0;z.level>0?(z.strm.data_type===o&&(z.strm.data_type=h0(z)),w0(z,z.l_desc),w0(z,z.d_desc),X0=ht(z),x0=z.opt_len+3+7>>>3,m0=z.static_len+3+7>>>3,m0<=x0&&(x0=m0)):x0=m0=X+5,X+4<=x0&&si!==-1?tt(z,si,X,r0):z.strategy===n||m0===x0?(Q(z,(d<<1)+(r0?1:0),3),g0(z,N,U)):(Q(z,(u<<1)+(r0?1:0),3),We(z,z.l_desc.max_code+1,z.d_desc.max_code+1,X0+1),g0(z,z.dyn_ltree,z.dyn_dtree)),u0(z),r0&&o0(z)},c0=(z,si,X)=>(z.pending_buf[z.sym_buf+z.sym_next++]=si,z.pending_buf[z.sym_buf+z.sym_next++]=si>>8,z.pending_buf[z.sym_buf+z.sym_next++]=X,si===0?z.dyn_ltree[X*2]++:(z.matches++,si--,z.dyn_ltree[(k[X]+b+1)*2]++,z.dyn_dtree[Te(si)*2]++),z.sym_next===z.sym_end);var A0=Z,P0=tt,Fe=s0,f0=c0,v0=tr,D0={_tr_init:A0,_tr_stored_block:P0,_tr_flush_block:Fe,_tr_tally:f0,_tr_align:v0},y0=(z,si,X,r0)=>{let x0=z&65535|0,m0=z>>>16&65535|0,X0=0;for(;X!==0;){X0=X>2e3?2e3:X,X-=X0;do x0=x0+si[r0++]|0,m0=m0+x0|0;while(--X0);x0%=65521,m0%=65521}return x0|m0<<16|0};const lt=()=>{let z,si=[];for(var X=0;X<256;X++){z=X;for(var r0=0;r0<8;r0++)z=z&1?3988292384^z>>>1:z>>>1;si[X]=z}return si},oi=new Uint32Array(lt());var W=(z,si,X,r0)=>{const x0=oi,m0=r0+X;z^=-1;for(let X0=r0;X0<m0;X0++)z=z>>>8^x0[(z^si[X0])&255];return z^-1},e0={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},a0={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:hi,_tr_stored_block:p0,_tr_flush_block:O0,_tr_tally:q,_tr_align:it}=D0,{Z_NO_FLUSH:at,Z_PARTIAL_FLUSH:t0,Z_FULL_FLUSH:i0,Z_FINISH:d0,Z_BLOCK:_0,Z_OK:S0,Z_STREAM_END:$0,Z_STREAM_ERROR:K0,Z_DATA_ERROR:n1,Z_BUF_ERROR:c1,Z_DEFAULT_COMPRESSION:J0,Z_FILTERED:Z0,Z_HUFFMAN_ONLY:Hm,Z_RLE:C0,Z_FIXED:z0,Z_DEFAULT_STRATEGY:B0,Z_UNKNOWN:V0,Z_DEFLATED:i1}=a0,u1=9,f1=15,a1=8,l1=256+1+29,v1=30,p1=19,b1=2*l1+1,M1=15,o1=3,g1=258,y1=g1+o1+1,C1=32,q1=42,P_=57,ov=69,fv=73,Z1=91,$_=103,z_=113,R_=666,z1=1,pv=2,Z_=3,lv=4,yv=3,cv=(z,si)=>(z.msg=e0[si],si),Wv=z=>z*2-(z>4?9:0),V_=z=>{let si=z.length;for(;--si>=0;)z[si]=0},dx=z=>{let si,X,r0,x0=z.w_size;si=z.hash_size,r0=si;do X=z.head[--r0],z.head[r0]=X>=x0?X-x0:0;while(--si);si=x0,r0=si;do X=z.prev[--r0],z.prev[r0]=X>=x0?X-x0:0;while(--si)};let rv=(z,si,X)=>(si<<z.hash_shift^X)&z.hash_mask;const O_=z=>{const si=z.state;let X=si.pending;X>z.avail_out&&(X=z.avail_out),X!==0&&(z.output.set(si.pending_buf.subarray(si.pending_out,si.pending_out+X),z.next_out),z.next_out+=X,si.pending_out+=X,z.total_out+=X,z.avail_out-=X,si.pending-=X,si.pending===0&&(si.pending_out=0))},X_=(z,si)=>{O0(z,z.block_start>=0?z.block_start:-1,z.strstart-z.block_start,si),z.block_start=z.strstart,O_(z.strm)},G1=(z,si)=>{z.pending_buf[z.pending++]=si},H_=(z,si)=>{z.pending_buf[z.pending++]=si>>>8&255,z.pending_buf[z.pending++]=si&255},Q_=(z,si,X,r0)=>{let x0=z.avail_in;return x0>r0&&(x0=r0),x0===0?0:(z.avail_in-=x0,si.set(z.input.subarray(z.next_in,z.next_in+x0),X),z.state.wrap===1?z.adler=y0(z.adler,si,x0,X):z.state.wrap===2&&(z.adler=W(z.adler,si,x0,X)),z.next_in+=x0,z.total_in+=x0,x0)},tx=(z,si)=>{let X=z.max_chain_length,r0=z.strstart,x0,m0,X0=z.prev_length,U0=z.nice_match;const m1=z.strstart>z.w_size-y1?z.strstart-(z.w_size-y1):0,I0=z.window,j0=z.w_mask,W1=z.prev,d1=z.strstart+g1;let s1=I0[r0+X0-1],S1=I0[r0+X0];z.prev_length>=z.good_match&&(X>>=2),U0>z.lookahead&&(U0=z.lookahead);do if(x0=si,!(I0[x0+X0]!==S1||I0[x0+X0-1]!==s1||I0[x0]!==I0[r0]||I0[++x0]!==I0[r0+1])){r0+=2,x0++;do;while(I0[++r0]===I0[++x0]&&I0[++r0]===I0[++x0]&&I0[++r0]===I0[++x0]&&I0[++r0]===I0[++x0]&&I0[++r0]===I0[++x0]&&I0[++r0]===I0[++x0]&&I0[++r0]===I0[++x0]&&I0[++r0]===I0[++x0]&&r0<d1);if(m0=g1-(d1-r0),r0=d1-g1,m0>X0){if(z.match_start=si,X0=m0,m0>=U0)break;s1=I0[r0+X0-1],S1=I0[r0+X0]}}while((si=W1[si&j0])>m1&&--X!==0);return X0<=z.lookahead?X0:z.lookahead},bv=z=>{const si=z.w_size;let X,r0,x0;do{if(r0=z.window_size-z.lookahead-z.strstart,z.strstart>=si+(si-y1)&&(z.window.set(z.window.subarray(si,si+si-r0),0),z.match_start-=si,z.strstart-=si,z.block_start-=si,z.insert>z.strstart&&(z.insert=z.strstart),dx(z),r0+=si),z.strm.avail_in===0)break;if(X=Q_(z.strm,z.window,z.strstart+z.lookahead,r0),z.lookahead+=X,z.lookahead+z.insert>=o1)for(x0=z.strstart-z.insert,z.ins_h=z.window[x0],z.ins_h=rv(z,z.ins_h,z.window[x0+1]);z.insert&&(z.ins_h=rv(z,z.ins_h,z.window[x0+o1-1]),z.prev[x0&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=x0,x0++,z.insert--,!(z.lookahead+z.insert<o1)););}while(z.lookahead<y1&&z.strm.avail_in!==0)},px=(z,si)=>{let X=z.pending_buf_size-5>z.w_size?z.w_size:z.pending_buf_size-5,r0,x0,m0,X0=0,U0=z.strm.avail_in;do{if(r0=65535,m0=z.bi_valid+42>>3,z.strm.avail_out<m0||(m0=z.strm.avail_out-m0,x0=z.strstart-z.block_start,r0>x0+z.strm.avail_in&&(r0=x0+z.strm.avail_in),r0>m0&&(r0=m0),r0<X&&(r0===0&&si!==d0||si===at||r0!==x0+z.strm.avail_in)))break;X0=si===d0&&r0===x0+z.strm.avail_in?1:0,p0(z,0,0,X0),z.pending_buf[z.pending-4]=r0,z.pending_buf[z.pending-3]=r0>>8,z.pending_buf[z.pending-2]=~r0,z.pending_buf[z.pending-1]=~r0>>8,O_(z.strm),x0&&(x0>r0&&(x0=r0),z.strm.output.set(z.window.subarray(z.block_start,z.block_start+x0),z.strm.next_out),z.strm.next_out+=x0,z.strm.avail_out-=x0,z.strm.total_out+=x0,z.block_start+=x0,r0-=x0),r0&&(Q_(z.strm,z.strm.output,z.strm.next_out,r0),z.strm.next_out+=r0,z.strm.avail_out-=r0,z.strm.total_out+=r0)}while(X0===0);return U0-=z.strm.avail_in,U0&&(U0>=z.w_size?(z.matches=2,z.window.set(z.strm.input.subarray(z.strm.next_in-z.w_size,z.strm.next_in),0),z.strstart=z.w_size,z.insert=z.strstart):(z.window_size-z.strstart<=U0&&(z.strstart-=z.w_size,z.window.set(z.window.subarray(z.w_size,z.w_size+z.strstart),0),z.matches<2&&z.matches++,z.insert>z.strstart&&(z.insert=z.strstart)),z.window.set(z.strm.input.subarray(z.strm.next_in-U0,z.strm.next_in),z.strstart),z.strstart+=U0,z.insert+=U0>z.w_size-z.insert?z.w_size-z.insert:U0),z.block_start=z.strstart),z.high_water<z.strstart&&(z.high_water=z.strstart),X0?lv:si!==at&&si!==d0&&z.strm.avail_in===0&&z.strstart===z.block_start?pv:(m0=z.window_size-z.strstart,z.strm.avail_in>m0&&z.block_start>=z.w_size&&(z.block_start-=z.w_size,z.strstart-=z.w_size,z.window.set(z.window.subarray(z.w_size,z.w_size+z.strstart),0),z.matches<2&&z.matches++,m0+=z.w_size,z.insert>z.strstart&&(z.insert=z.strstart)),m0>z.strm.avail_in&&(m0=z.strm.avail_in),m0&&(Q_(z.strm,z.window,z.strstart,m0),z.strstart+=m0,z.insert+=m0>z.w_size-z.insert?z.w_size-z.insert:m0),z.high_water<z.strstart&&(z.high_water=z.strstart),m0=z.bi_valid+42>>3,m0=z.pending_buf_size-m0>65535?65535:z.pending_buf_size-m0,X=m0>z.w_size?z.w_size:m0,x0=z.strstart-z.block_start,(x0>=X||(x0||si===d0)&&si!==at&&z.strm.avail_in===0&&x0<=m0)&&(r0=x0>m0?m0:x0,X0=si===d0&&z.strm.avail_in===0&&r0===x0?1:0,p0(z,z.block_start,r0,X0),z.block_start+=r0,O_(z.strm)),X0?Z_:z1)},nx=(z,si)=>{let X,r0;for(;;){if(z.lookahead<y1){if(bv(z),z.lookahead<y1&&si===at)return z1;if(z.lookahead===0)break}if(X=0,z.lookahead>=o1&&(z.ins_h=rv(z,z.ins_h,z.window[z.strstart+o1-1]),X=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),X!==0&&z.strstart-X<=z.w_size-y1&&(z.match_length=tx(z,X)),z.match_length>=o1)if(r0=q(z,z.strstart-z.match_start,z.match_length-o1),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=o1){z.match_length--;do z.strstart++,z.ins_h=rv(z,z.ins_h,z.window[z.strstart+o1-1]),X=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart;while(--z.match_length!==0);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=rv(z,z.ins_h,z.window[z.strstart+1]);else r0=q(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(r0&&(X_(z,!1),z.strm.avail_out===0))return z1}return z.insert=z.strstart<o1-1?z.strstart:o1-1,si===d0?(X_(z,!0),z.strm.avail_out===0?Z_:lv):z.sym_next&&(X_(z,!1),z.strm.avail_out===0)?z1:pv},mx=(z,si)=>{let X,r0,x0;for(;;){if(z.lookahead<y1){if(bv(z),z.lookahead<y1&&si===at)return z1;if(z.lookahead===0)break}if(X=0,z.lookahead>=o1&&(z.ins_h=rv(z,z.ins_h,z.window[z.strstart+o1-1]),X=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=o1-1,X!==0&&z.prev_length<z.max_lazy_match&&z.strstart-X<=z.w_size-y1&&(z.match_length=tx(z,X),z.match_length<=5&&(z.strategy===Z0||z.match_length===o1&&z.strstart-z.match_start>4096)&&(z.match_length=o1-1)),z.prev_length>=o1&&z.match_length<=z.prev_length){x0=z.strstart+z.lookahead-o1,r0=q(z,z.strstart-1-z.prev_match,z.prev_length-o1),z.lookahead-=z.prev_length-1,z.prev_length-=2;do++z.strstart<=x0&&(z.ins_h=rv(z,z.ins_h,z.window[z.strstart+o1-1]),X=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart);while(--z.prev_length!==0);if(z.match_available=0,z.match_length=o1-1,z.strstart++,r0&&(X_(z,!1),z.strm.avail_out===0))return z1}else if(z.match_available){if(r0=q(z,0,z.window[z.strstart-1]),r0&&X_(z,!1),z.strstart++,z.lookahead--,z.strm.avail_out===0)return z1}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(r0=q(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<o1-1?z.strstart:o1-1,si===d0?(X_(z,!0),z.strm.avail_out===0?Z_:lv):z.sym_next&&(X_(z,!1),z.strm.avail_out===0)?z1:pv},MS=(z,si)=>{let X,r0,x0,m0;const X0=z.window;for(;;){if(z.lookahead<=g1){if(bv(z),z.lookahead<=g1&&si===at)return z1;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=o1&&z.strstart>0&&(x0=z.strstart-1,r0=X0[x0],r0===X0[++x0]&&r0===X0[++x0]&&r0===X0[++x0])){m0=z.strstart+g1;do;while(r0===X0[++x0]&&r0===X0[++x0]&&r0===X0[++x0]&&r0===X0[++x0]&&r0===X0[++x0]&&r0===X0[++x0]&&r0===X0[++x0]&&r0===X0[++x0]&&x0<m0);z.match_length=g1-(m0-x0),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=o1?(X=q(z,1,z.match_length-o1),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(X=q(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),X&&(X_(z,!1),z.strm.avail_out===0))return z1}return z.insert=0,si===d0?(X_(z,!0),z.strm.avail_out===0?Z_:lv):z.sym_next&&(X_(z,!1),z.strm.avail_out===0)?z1:pv},AA=(z,si)=>{let X;for(;;){if(z.lookahead===0&&(bv(z),z.lookahead===0)){if(si===at)return z1;break}if(z.match_length=0,X=q(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,X&&(X_(z,!1),z.strm.avail_out===0))return z1}return z.insert=0,si===d0?(X_(z,!0),z.strm.avail_out===0?Z_:lv):z.sym_next&&(X_(z,!1),z.strm.avail_out===0)?z1:pv};function uv(z,si,X,r0,x0){this.good_length=z,this.max_lazy=si,this.nice_length=X,this.max_chain=r0,this.func=x0}const mv=[new uv(0,0,0,0,px),new uv(4,4,8,4,nx),new uv(4,5,16,8,nx),new uv(4,6,32,32,nx),new uv(4,4,16,16,mx),new uv(8,16,32,32,mx),new uv(8,16,128,128,mx),new uv(8,32,128,256,mx),new uv(32,128,258,1024,mx),new uv(32,258,258,4096,mx)],wS=z=>{z.window_size=2*z.w_size,V_(z.head),z.max_lazy_match=mv[z.level].max_lazy,z.good_match=mv[z.level].good_length,z.nice_match=mv[z.level].nice_length,z.max_chain_length=mv[z.level].max_chain,z.strstart=0,z.block_start=0,z.lookahead=0,z.insert=0,z.match_length=z.prev_length=o1-1,z.match_available=0,z.ins_h=0};function d2(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=i1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(b1*2),this.dyn_dtree=new Uint16Array((2*v1+1)*2),this.bl_tree=new Uint16Array((2*p1+1)*2),V_(this.dyn_ltree),V_(this.dyn_dtree),V_(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(M1+1),this.heap=new Uint16Array(2*l1+1),V_(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*l1+1),V_(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Sv=z=>{if(!z)return 1;const si=z.state;return!si||si.strm!==z||si.status!==q1&&si.status!==P_&&si.status!==ov&&si.status!==fv&&si.status!==Z1&&si.status!==$_&&si.status!==z_&&si.status!==R_?1:0},G2=z=>{if(Sv(z))return cv(z,K0);z.total_in=z.total_out=0,z.data_type=V0;const si=z.state;return si.pending=0,si.pending_out=0,si.wrap<0&&(si.wrap=-si.wrap),si.status=si.wrap===2?P_:si.wrap?q1:z_,z.adler=si.wrap===2?0:1,si.last_flush=-2,hi(si),S0},f2=z=>{const si=G2(z);return si===S0&&wS(z.state),si},EA=(z,si)=>Sv(z)||z.state.wrap!==2?K0:(z.state.gzhead=si,S0),p2=(z,si,X,r0,x0,m0)=>{if(!z)return K0;let X0=1;if(si===J0&&(si=6),r0<0?(X0=0,r0=-r0):r0>15&&(X0=2,r0-=16),x0<1||x0>u1||X!==i1||r0<8||r0>15||si<0||si>9||m0<0||m0>z0||r0===8&&X0!==1)return cv(z,K0);r0===8&&(r0=9);const U0=new d2;return z.state=U0,U0.strm=z,U0.status=q1,U0.wrap=X0,U0.gzhead=null,U0.w_bits=r0,U0.w_size=1<<U0.w_bits,U0.w_mask=U0.w_size-1,U0.hash_bits=x0+7,U0.hash_size=1<<U0.hash_bits,U0.hash_mask=U0.hash_size-1,U0.hash_shift=~~((U0.hash_bits+o1-1)/o1),U0.window=new Uint8Array(U0.w_size*2),U0.head=new Uint16Array(U0.hash_size),U0.prev=new Uint16Array(U0.w_size),U0.lit_bufsize=1<<x0+6,U0.pending_buf_size=U0.lit_bufsize*4,U0.pending_buf=new Uint8Array(U0.pending_buf_size),U0.sym_buf=U0.lit_bufsize,U0.sym_end=(U0.lit_bufsize-1)*3,U0.level=si,U0.strategy=m0,U0.method=X,f2(z)},V2=(z,si)=>p2(z,si,i1,f1,a1,B0),MA=(z,si)=>{if(Sv(z)||si>_0||si<0)return z?cv(z,K0):K0;const X=z.state;if(!z.output||z.avail_in!==0&&!z.input||X.status===R_&&si!==d0)return cv(z,z.avail_out===0?c1:K0);const r0=X.last_flush;if(X.last_flush=si,X.pending!==0){if(O_(z),z.avail_out===0)return X.last_flush=-1,S0}else if(z.avail_in===0&&Wv(si)<=Wv(r0)&&si!==d0)return cv(z,c1);if(X.status===R_&&z.avail_in!==0)return cv(z,c1);if(X.status===q1&&X.wrap===0&&(X.status=z_),X.status===q1){let x0=i1+(X.w_bits-8<<4)<<8,m0=-1;if(X.strategy>=Hm||X.level<2?m0=0:X.level<6?m0=1:X.level===6?m0=2:m0=3,x0|=m0<<6,X.strstart!==0&&(x0|=C1),x0+=31-x0%31,H_(X,x0),X.strstart!==0&&(H_(X,z.adler>>>16),H_(X,z.adler&65535)),z.adler=1,X.status=z_,O_(z),X.pending!==0)return X.last_flush=-1,S0}if(X.status===P_){if(z.adler=0,G1(X,31),G1(X,139),G1(X,8),X.gzhead)G1(X,(X.gzhead.text?1:0)+(X.gzhead.hcrc?2:0)+(X.gzhead.extra?4:0)+(X.gzhead.name?8:0)+(X.gzhead.comment?16:0)),G1(X,X.gzhead.time&255),G1(X,X.gzhead.time>>8&255),G1(X,X.gzhead.time>>16&255),G1(X,X.gzhead.time>>24&255),G1(X,X.level===9?2:X.strategy>=Hm||X.level<2?4:0),G1(X,X.gzhead.os&255),X.gzhead.extra&&X.gzhead.extra.length&&(G1(X,X.gzhead.extra.length&255),G1(X,X.gzhead.extra.length>>8&255)),X.gzhead.hcrc&&(z.adler=W(z.adler,X.pending_buf,X.pending,0)),X.gzindex=0,X.status=ov;else if(G1(X,0),G1(X,0),G1(X,0),G1(X,0),G1(X,0),G1(X,X.level===9?2:X.strategy>=Hm||X.level<2?4:0),G1(X,yv),X.status=z_,O_(z),X.pending!==0)return X.last_flush=-1,S0}if(X.status===ov){if(X.gzhead.extra){let x0=X.pending,m0=(X.gzhead.extra.length&65535)-X.gzindex;for(;X.pending+m0>X.pending_buf_size;){let U0=X.pending_buf_size-X.pending;if(X.pending_buf.set(X.gzhead.extra.subarray(X.gzindex,X.gzindex+U0),X.pending),X.pending=X.pending_buf_size,X.gzhead.hcrc&&X.pending>x0&&(z.adler=W(z.adler,X.pending_buf,X.pending-x0,x0)),X.gzindex+=U0,O_(z),X.pending!==0)return X.last_flush=-1,S0;x0=0,m0-=U0}let X0=new Uint8Array(X.gzhead.extra);X.pending_buf.set(X0.subarray(X.gzindex,X.gzindex+m0),X.pending),X.pending+=m0,X.gzhead.hcrc&&X.pending>x0&&(z.adler=W(z.adler,X.pending_buf,X.pending-x0,x0)),X.gzindex=0}X.status=fv}if(X.status===fv){if(X.gzhead.name){let x0=X.pending,m0;do{if(X.pending===X.pending_buf_size){if(X.gzhead.hcrc&&X.pending>x0&&(z.adler=W(z.adler,X.pending_buf,X.pending-x0,x0)),O_(z),X.pending!==0)return X.last_flush=-1,S0;x0=0}X.gzindex<X.gzhead.name.length?m0=X.gzhead.name.charCodeAt(X.gzindex++)&255:m0=0,G1(X,m0)}while(m0!==0);X.gzhead.hcrc&&X.pending>x0&&(z.adler=W(z.adler,X.pending_buf,X.pending-x0,x0)),X.gzindex=0}X.status=Z1}if(X.status===Z1){if(X.gzhead.comment){let x0=X.pending,m0;do{if(X.pending===X.pending_buf_size){if(X.gzhead.hcrc&&X.pending>x0&&(z.adler=W(z.adler,X.pending_buf,X.pending-x0,x0)),O_(z),X.pending!==0)return X.last_flush=-1,S0;x0=0}X.gzindex<X.gzhead.comment.length?m0=X.gzhead.comment.charCodeAt(X.gzindex++)&255:m0=0,G1(X,m0)}while(m0!==0);X.gzhead.hcrc&&X.pending>x0&&(z.adler=W(z.adler,X.pending_buf,X.pending-x0,x0))}X.status=$_}if(X.status===$_){if(X.gzhead.hcrc){if(X.pending+2>X.pending_buf_size&&(O_(z),X.pending!==0))return X.last_flush=-1,S0;G1(X,z.adler&255),G1(X,z.adler>>8&255),z.adler=0}if(X.status=z_,O_(z),X.pending!==0)return X.last_flush=-1,S0}if(z.avail_in!==0||X.lookahead!==0||si!==at&&X.status!==R_){let x0=X.level===0?px(X,si):X.strategy===Hm?AA(X,si):X.strategy===C0?MS(X,si):mv[X.level].func(X,si);if((x0===Z_||x0===lv)&&(X.status=R_),x0===z1||x0===Z_)return z.avail_out===0&&(X.last_flush=-1),S0;if(x0===pv&&(si===t0?it(X):si!==_0&&(p0(X,0,0,!1),si===i0&&(V_(X.head),X.lookahead===0&&(X.strstart=0,X.block_start=0,X.insert=0))),O_(z),z.avail_out===0))return X.last_flush=-1,S0}return si!==d0?S0:X.wrap<=0?$0:(X.wrap===2?(G1(X,z.adler&255),G1(X,z.adler>>8&255),G1(X,z.adler>>16&255),G1(X,z.adler>>24&255),G1(X,z.total_in&255),G1(X,z.total_in>>8&255),G1(X,z.total_in>>16&255),G1(X,z.total_in>>24&255)):(H_(X,z.adler>>>16),H_(X,z.adler&65535)),O_(z),X.wrap>0&&(X.wrap=-X.wrap),X.pending!==0?S0:$0)},hv=z=>{if(Sv(z))return K0;const si=z.state.status;return z.state=null,si===z_?cv(z,n1):S0},gx=(z,si)=>{let X=si.length;if(Sv(z))return K0;const r0=z.state,x0=r0.wrap;if(x0===2||x0===1&&r0.status!==q1||r0.lookahead)return K0;if(x0===1&&(z.adler=y0(z.adler,si,X,0)),r0.wrap=0,X>=r0.w_size){x0===0&&(V_(r0.head),r0.strstart=0,r0.block_start=0,r0.insert=0);let m1=new Uint8Array(r0.w_size);m1.set(si.subarray(X-r0.w_size,X),0),si=m1,X=r0.w_size}const m0=z.avail_in,X0=z.next_in,U0=z.input;for(z.avail_in=X,z.next_in=0,z.input=si,bv(r0);r0.lookahead>=o1;){let m1=r0.strstart,I0=r0.lookahead-(o1-1);do r0.ins_h=rv(r0,r0.ins_h,r0.window[m1+o1-1]),r0.prev[m1&r0.w_mask]=r0.head[r0.ins_h],r0.head[r0.ins_h]=m1,m1++;while(--I0);r0.strstart=m1,r0.lookahead=o1-1,bv(r0)}return r0.strstart+=r0.lookahead,r0.block_start=r0.strstart,r0.insert=r0.lookahead,r0.lookahead=0,r0.match_length=r0.prev_length=o1-1,r0.match_available=0,z.next_in=X0,z.input=U0,z.avail_in=m0,r0.wrap=x0,S0};var H2=V2,m2=p2,UE=f2,CS=G2,TS=EA,g2=MA,j2=hv,wA=gx,kE="pako deflate (from Nodeca project)",_2={deflateInit:H2,deflateInit2:m2,deflateReset:UE,deflateResetKeep:CS,deflateSetHeader:TS,deflate:g2,deflateEnd:j2,deflateSetDictionary:wA,deflateInfo:kE};const GE=(z,si)=>Object.prototype.hasOwnProperty.call(z,si);var RS=function(z){const si=Array.prototype.slice.call(arguments,1);for(;si.length;){const X=si.shift();if(X){if(typeof X!="object")throw new TypeError(X+"must be non-object");for(const r0 in X)GE(X,r0)&&(z[r0]=X[r0])}}return z},VE=z=>{let si=0;for(let r0=0,x0=z.length;r0<x0;r0++)si+=z[r0].length;const X=new Uint8Array(si);for(let r0=0,x0=0,m0=z.length;r0<m0;r0++){let X0=z[r0];X.set(X0,x0),x0+=X0.length}return X},W2={assign:RS,flattenChunks:VE};let CA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{CA=!1}const v2=new Uint8Array(256);for(let z=0;z<256;z++)v2[z]=z>=252?6:z>=248?5:z>=240?4:z>=224?3:z>=192?2:1;v2[254]=v2[254]=1;var HE=z=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(z);let si,X,r0,x0,m0,X0=z.length,U0=0;for(x0=0;x0<X0;x0++)X=z.charCodeAt(x0),(X&64512)===55296&&x0+1<X0&&(r0=z.charCodeAt(x0+1),(r0&64512)===56320&&(X=65536+(X-55296<<10)+(r0-56320),x0++)),U0+=X<128?1:X<2048?2:X<65536?3:4;for(si=new Uint8Array(U0),m0=0,x0=0;m0<U0;x0++)X=z.charCodeAt(x0),(X&64512)===55296&&x0+1<X0&&(r0=z.charCodeAt(x0+1),(r0&64512)===56320&&(X=65536+(X-55296<<10)+(r0-56320),x0++)),X<128?si[m0++]=X:X<2048?(si[m0++]=192|X>>>6,si[m0++]=128|X&63):X<65536?(si[m0++]=224|X>>>12,si[m0++]=128|X>>>6&63,si[m0++]=128|X&63):(si[m0++]=240|X>>>18,si[m0++]=128|X>>>12&63,si[m0++]=128|X>>>6&63,si[m0++]=128|X&63);return si};const TA=(z,si)=>{if(si<65534&&z.subarray&&CA)return String.fromCharCode.apply(null,z.length===si?z:z.subarray(0,si));let X="";for(let r0=0;r0<si;r0++)X+=String.fromCharCode(z[r0]);return X};var jE=(z,si)=>{const X=si||z.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(z.subarray(0,si));let r0,x0;const m0=new Array(X*2);for(x0=0,r0=0;r0<X;){let X0=z[r0++];if(X0<128){m0[x0++]=X0;continue}let U0=v2[X0];if(U0>4){m0[x0++]=65533,r0+=U0-1;continue}for(X0&=U0===2?31:U0===3?15:7;U0>1&&r0<X;)X0=X0<<6|z[r0++]&63,U0--;if(U0>1){m0[x0++]=65533;continue}X0<65536?m0[x0++]=X0:(X0-=65536,m0[x0++]=55296|X0>>10&1023,m0[x0++]=56320|X0&1023)}return TA(m0,x0)},WE=(z,si)=>{si=si||z.length,si>z.length&&(si=z.length);let X=si-1;for(;X>=0&&(z[X]&192)===128;)X--;return X<0||X===0?si:X+v2[z[X]]>si?X:si},x2={string2buf:HE,buf2string:jE,utf8border:WE};function $E(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var $2=$E;const RA=Object.prototype.toString,{Z_NO_FLUSH:XE,Z_SYNC_FLUSH:YE,Z_FULL_FLUSH:DA,Z_FINISH:KE,Z_OK:X2,Z_STREAM_END:qE,Z_DEFAULT_COMPRESSION:ZE,Z_DEFAULT_STRATEGY:QE,Z_DEFLATED:JE}=a0;function y2(z){this.options=W2.assign({level:ZE,method:JE,chunkSize:16384,windowBits:15,memLevel:8,strategy:QE},z||{});let si=this.options;si.raw&&si.windowBits>0?si.windowBits=-si.windowBits:si.gzip&&si.windowBits>0&&si.windowBits<16&&(si.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $2,this.strm.avail_out=0;let X=_2.deflateInit2(this.strm,si.level,si.method,si.windowBits,si.memLevel,si.strategy);if(X!==X2)throw new Error(e0[X]);if(si.header&&_2.deflateSetHeader(this.strm,si.header),si.dictionary){let r0;if(typeof si.dictionary=="string"?r0=x2.string2buf(si.dictionary):RA.call(si.dictionary)==="[object ArrayBuffer]"?r0=new Uint8Array(si.dictionary):r0=si.dictionary,X=_2.deflateSetDictionary(this.strm,r0),X!==X2)throw new Error(e0[X]);this._dict_set=!0}}y2.prototype.push=function(z,si){const X=this.strm,r0=this.options.chunkSize;let x0,m0;if(this.ended)return!1;for(si===~~si?m0=si:m0=si===!0?KE:XE,typeof z=="string"?X.input=x2.string2buf(z):RA.call(z)==="[object ArrayBuffer]"?X.input=new Uint8Array(z):X.input=z,X.next_in=0,X.avail_in=X.input.length;;){if(X.avail_out===0&&(X.output=new Uint8Array(r0),X.next_out=0,X.avail_out=r0),(m0===YE||m0===DA)&&X.avail_out<=6){this.onData(X.output.subarray(0,X.next_out)),X.avail_out=0;continue}if(x0=_2.deflate(X,m0),x0===qE)return X.next_out>0&&this.onData(X.output.subarray(0,X.next_out)),x0=_2.deflateEnd(this.strm),this.onEnd(x0),this.ended=!0,x0===X2;if(X.avail_out===0){this.onData(X.output);continue}if(m0>0&&X.next_out>0){this.onData(X.output.subarray(0,X.next_out)),X.avail_out=0;continue}if(X.avail_in===0)break}return!0},y2.prototype.onData=function(z){this.chunks.push(z)},y2.prototype.onEnd=function(z){z===X2&&(this.result=W2.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg};function DS(z,si){const X=new y2(si);if(X.push(z,!0),X.err)throw X.msg||e0[X.err];return X.result}function eM(z,si){return si=si||{},si.raw=!0,DS(z,si)}function LS(z,si){return si=si||{},si.gzip=!0,DS(z,si)}var b2=y2,tM=DS,LA=eM,PA=LS,OA={Deflate:b2,deflate:tM,deflateRaw:LA,gzip:PA};const S2=16209,IA=16191;var Ux=function(si,X){let r0,x0,m0,X0,U0,m1,I0,j0,W1,d1,s1,S1,A_,I1,R1,$1,D1,h1,B1,U_,E1,V1,L1,T1;const N1=si.state;r0=si.next_in,L1=si.input,x0=r0+(si.avail_in-5),m0=si.next_out,T1=si.output,X0=m0-(X-si.avail_out),U0=m0+(si.avail_out-257),m1=N1.dmax,I0=N1.wsize,j0=N1.whave,W1=N1.wnext,d1=N1.window,s1=N1.hold,S1=N1.bits,A_=N1.lencode,I1=N1.distcode,R1=(1<<N1.lenbits)-1,$1=(1<<N1.distbits)-1;e:do{S1<15&&(s1+=L1[r0++]<<S1,S1+=8,s1+=L1[r0++]<<S1,S1+=8),D1=A_[s1&R1];t:for(;;){if(h1=D1>>>24,s1>>>=h1,S1-=h1,h1=D1>>>16&255,h1===0)T1[m0++]=D1&65535;else if(h1&16){B1=D1&65535,h1&=15,h1&&(S1<h1&&(s1+=L1[r0++]<<S1,S1+=8),B1+=s1&(1<<h1)-1,s1>>>=h1,S1-=h1),S1<15&&(s1+=L1[r0++]<<S1,S1+=8,s1+=L1[r0++]<<S1,S1+=8),D1=I1[s1&$1];n:for(;;){if(h1=D1>>>24,s1>>>=h1,S1-=h1,h1=D1>>>16&255,h1&16){if(U_=D1&65535,h1&=15,S1<h1&&(s1+=L1[r0++]<<S1,S1+=8,S1<h1&&(s1+=L1[r0++]<<S1,S1+=8)),U_+=s1&(1<<h1)-1,U_>m1){si.msg="invalid distance too far back",N1.mode=S2;break e}if(s1>>>=h1,S1-=h1,h1=m0-X0,U_>h1){if(h1=U_-h1,h1>j0&&N1.sane){si.msg="invalid distance too far back",N1.mode=S2;break e}if(E1=0,V1=d1,W1===0){if(E1+=I0-h1,h1<B1){B1-=h1;do T1[m0++]=d1[E1++];while(--h1);E1=m0-U_,V1=T1}}else if(W1<h1){if(E1+=I0+W1-h1,h1-=W1,h1<B1){B1-=h1;do T1[m0++]=d1[E1++];while(--h1);if(E1=0,W1<B1){h1=W1,B1-=h1;do T1[m0++]=d1[E1++];while(--h1);E1=m0-U_,V1=T1}}}else if(E1+=W1-h1,h1<B1){B1-=h1;do T1[m0++]=d1[E1++];while(--h1);E1=m0-U_,V1=T1}for(;B1>2;)T1[m0++]=V1[E1++],T1[m0++]=V1[E1++],T1[m0++]=V1[E1++],B1-=3;B1&&(T1[m0++]=V1[E1++],B1>1&&(T1[m0++]=V1[E1++]))}else{E1=m0-U_;do T1[m0++]=T1[E1++],T1[m0++]=T1[E1++],T1[m0++]=T1[E1++],B1-=3;while(B1>2);B1&&(T1[m0++]=T1[E1++],B1>1&&(T1[m0++]=T1[E1++]))}}else if((h1&64)===0){D1=I1[(D1&65535)+(s1&(1<<h1)-1)];continue n}else{si.msg="invalid distance code",N1.mode=S2;break e}break}}else if((h1&64)===0){D1=A_[(D1&65535)+(s1&(1<<h1)-1)];continue t}else if(h1&32){N1.mode=IA;break e}else{si.msg="invalid literal/length code",N1.mode=S2;break e}break}}while(r0<x0&&m0<U0);B1=S1>>3,r0-=B1,S1-=B1<<3,s1&=(1<<S1)-1,si.next_in=r0,si.next_out=m0,si.avail_in=r0<x0?5+(x0-r0):5-(r0-x0),si.avail_out=m0<U0?257+(U0-m0):257-(m0-U0),N1.hold=s1,N1.bits=S1};const kx=15,BA=852,NA=592,PS=0,Y2=1,Gx=2,A2=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),nM=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),K2=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),zA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var vx=(z,si,X,r0,x0,m0,X0,U0)=>{const m1=U0.bits;let I0=0,j0=0,W1=0,d1=0,s1=0,S1=0,A_=0,I1=0,R1=0,$1=0,D1,h1,B1,U_,E1,V1=null,L1;const T1=new Uint16Array(kx+1),N1=new Uint16Array(kx+1);let Qv=null,qx,cx,N2;for(I0=0;I0<=kx;I0++)T1[I0]=0;for(j0=0;j0<r0;j0++)T1[si[X+j0]]++;for(s1=m1,d1=kx;d1>=1&&T1[d1]===0;d1--);if(s1>d1&&(s1=d1),d1===0)return x0[m0++]=1<<24|64<<16|0,x0[m0++]=1<<24|64<<16|0,U0.bits=1,0;for(W1=1;W1<d1&&T1[W1]===0;W1++);for(s1<W1&&(s1=W1),I1=1,I0=1;I0<=kx;I0++)if(I1<<=1,I1-=T1[I0],I1<0)return-1;if(I1>0&&(z===PS||d1!==1))return-1;for(N1[1]=0,I0=1;I0<kx;I0++)N1[I0+1]=N1[I0]+T1[I0];for(j0=0;j0<r0;j0++)si[X+j0]!==0&&(X0[N1[si[X+j0]]++]=j0);if(z===PS?(V1=Qv=X0,L1=20):z===Y2?(V1=A2,Qv=nM,L1=257):(V1=K2,Qv=zA,L1=0),$1=0,j0=0,I0=W1,E1=m0,S1=s1,A_=0,B1=-1,R1=1<<s1,U_=R1-1,z===Y2&&R1>BA||z===Gx&&R1>NA)return 1;for(;;){qx=I0-A_,X0[j0]+1<L1?(cx=0,N2=X0[j0]):X0[j0]>=L1?(cx=Qv[X0[j0]-L1],N2=V1[X0[j0]-L1]):(cx=96,N2=0),D1=1<<I0-A_,h1=1<<S1,W1=h1;do h1-=D1,x0[E1+($1>>A_)+h1]=qx<<24|cx<<16|N2|0;while(h1!==0);for(D1=1<<I0-1;$1&D1;)D1>>=1;if(D1!==0?($1&=D1-1,$1+=D1):$1=0,j0++,--T1[I0]===0){if(I0===d1)break;I0=si[X+X0[j0]]}if(I0>s1&&($1&U_)!==B1){for(A_===0&&(A_=s1),E1+=W1,S1=I0-A_,I1=1<<S1;S1+A_<d1&&(I1-=T1[S1+A_],!(I1<=0));)S1++,I1<<=1;if(R1+=1<<S1,z===Y2&&R1>BA||z===Gx&&R1>NA)return 1;B1=$1&U_,x0[B1]=s1<<24|S1<<16|E1-m0|0}}return $1!==0&&(x0[E1+$1]=I0-A_<<24|64<<16|0),U0.bits=s1,0};const OS=0,IS=1,BS=2,{Z_FINISH:NS,Z_BLOCK:rM,Z_TREES:q2,Z_OK:xx,Z_STREAM_END:sM,Z_NEED_DICT:aM,Z_STREAM_ERROR:I_,Z_DATA_ERROR:Vx,Z_MEM_ERROR:zS,Z_BUF_ERROR:FA,Z_DEFLATED:FS}=a0,E2=16180,Z2=16181,UA=16182,yx=16183,Q2=16184,Hx=16185,J2=16186,US=16187,ix=16188,bx=16189,jx=16190,zv=16191,$v=16192,kS=16193,eS=16194,GS=16195,kA=16196,GA=16197,VA=16198,M2=16199,w2=16200,tS=16201,Av=16202,C2=16203,gv=16204,Sx=16205,T2=16206,R2=16207,D2=16208,S_=16209,rx=16210,VS=16211,nS=852,Wx=592,_v=15,iS=z=>(z>>>24&255)+(z>>>8&65280)+((z&65280)<<8)+((z&255)<<24);function Xv(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const sx=z=>{if(!z)return 1;const si=z.state;return!si||si.strm!==z||si.mode<E2||si.mode>VS?1:0},L2=z=>{if(sx(z))return I_;const si=z.state;return z.total_in=z.total_out=si.total=0,z.msg="",si.wrap&&(z.adler=si.wrap&1),si.mode=E2,si.last=0,si.havedict=0,si.flags=-1,si.dmax=32768,si.head=null,si.hold=0,si.bits=0,si.lencode=si.lendyn=new Int32Array(nS),si.distcode=si.distdyn=new Int32Array(Wx),si.sane=1,si.back=-1,xx},ax=z=>{if(sx(z))return I_;const si=z.state;return si.wsize=0,si.whave=0,si.wnext=0,L2(z)},rS=(z,si)=>{let X;if(sx(z))return I_;const r0=z.state;return si<0?(X=0,si=-si):(X=(si>>4)+5,si<48&&(si&=15)),si&&(si<8||si>15)?I_:(r0.window!==null&&r0.wbits!==si&&(r0.window=null),r0.wrap=X,r0.wbits=si,ax(z))},HS=(z,si)=>{if(!z)return I_;const X=new Xv;z.state=X,X.strm=z,X.window=null,X.mode=E2;const r0=rS(z,si);return r0!==xx&&(z.state=null),r0},jS=z=>HS(z,_v);let WS=!0,dv,ox;const $x=z=>{if(WS){dv=new Int32Array(512),ox=new Int32Array(32);let si=0;for(;si<144;)z.lens[si++]=8;for(;si<256;)z.lens[si++]=9;for(;si<280;)z.lens[si++]=7;for(;si<288;)z.lens[si++]=8;for(vx(IS,z.lens,0,288,dv,0,z.work,{bits:9}),si=0;si<32;)z.lens[si++]=5;vx(BS,z.lens,0,32,ox,0,z.work,{bits:5}),WS=!1}z.lencode=dv,z.lenbits=9,z.distcode=ox,z.distbits=5},P2=(z,si,X,r0)=>{let x0;const m0=z.state;return m0.window===null&&(m0.wsize=1<<m0.wbits,m0.wnext=0,m0.whave=0,m0.window=new Uint8Array(m0.wsize)),r0>=m0.wsize?(m0.window.set(si.subarray(X-m0.wsize,X),0),m0.wnext=0,m0.whave=m0.wsize):(x0=m0.wsize-m0.wnext,x0>r0&&(x0=r0),m0.window.set(si.subarray(X-r0,X-r0+x0),m0.wnext),r0-=x0,r0?(m0.window.set(si.subarray(X-r0,X),0),m0.wnext=r0,m0.whave=m0.wsize):(m0.wnext+=x0,m0.wnext===m0.wsize&&(m0.wnext=0),m0.whave<m0.wsize&&(m0.whave+=x0))),0},O2=(z,si)=>{let X,r0,x0,m0,X0,U0,m1,I0,j0,W1,d1,s1,S1,A_,I1=0,R1,$1,D1,h1,B1,U_,E1,V1;const L1=new Uint8Array(4);let T1,N1;const Qv=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(sx(z)||!z.output||!z.input&&z.avail_in!==0)return I_;X=z.state,X.mode===zv&&(X.mode=$v),X0=z.next_out,x0=z.output,m1=z.avail_out,m0=z.next_in,r0=z.input,U0=z.avail_in,I0=X.hold,j0=X.bits,W1=U0,d1=m1,V1=xx;e:for(;;)switch(X.mode){case E2:if(X.wrap===0){X.mode=$v;break}for(;j0<16;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if(X.wrap&2&&I0===35615){X.wbits===0&&(X.wbits=15),X.check=0,L1[0]=I0&255,L1[1]=I0>>>8&255,X.check=W(X.check,L1,2,0),I0=0,j0=0,X.mode=Z2;break}if(X.head&&(X.head.done=!1),!(X.wrap&1)||(((I0&255)<<8)+(I0>>8))%31){z.msg="incorrect header check",X.mode=S_;break}if((I0&15)!==FS){z.msg="unknown compression method",X.mode=S_;break}if(I0>>>=4,j0-=4,E1=(I0&15)+8,X.wbits===0&&(X.wbits=E1),E1>15||E1>X.wbits){z.msg="invalid window size",X.mode=S_;break}X.dmax=1<<X.wbits,X.flags=0,z.adler=X.check=1,X.mode=I0&512?bx:zv,I0=0,j0=0;break;case Z2:for(;j0<16;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if(X.flags=I0,(X.flags&255)!==FS){z.msg="unknown compression method",X.mode=S_;break}if(X.flags&57344){z.msg="unknown header flags set",X.mode=S_;break}X.head&&(X.head.text=I0>>8&1),X.flags&512&&X.wrap&4&&(L1[0]=I0&255,L1[1]=I0>>>8&255,X.check=W(X.check,L1,2,0)),I0=0,j0=0,X.mode=UA;case UA:for(;j0<32;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}X.head&&(X.head.time=I0),X.flags&512&&X.wrap&4&&(L1[0]=I0&255,L1[1]=I0>>>8&255,L1[2]=I0>>>16&255,L1[3]=I0>>>24&255,X.check=W(X.check,L1,4,0)),I0=0,j0=0,X.mode=yx;case yx:for(;j0<16;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}X.head&&(X.head.xflags=I0&255,X.head.os=I0>>8),X.flags&512&&X.wrap&4&&(L1[0]=I0&255,L1[1]=I0>>>8&255,X.check=W(X.check,L1,2,0)),I0=0,j0=0,X.mode=Q2;case Q2:if(X.flags&1024){for(;j0<16;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}X.length=I0,X.head&&(X.head.extra_len=I0),X.flags&512&&X.wrap&4&&(L1[0]=I0&255,L1[1]=I0>>>8&255,X.check=W(X.check,L1,2,0)),I0=0,j0=0}else X.head&&(X.head.extra=null);X.mode=Hx;case Hx:if(X.flags&1024&&(s1=X.length,s1>U0&&(s1=U0),s1&&(X.head&&(E1=X.head.extra_len-X.length,X.head.extra||(X.head.extra=new Uint8Array(X.head.extra_len)),X.head.extra.set(r0.subarray(m0,m0+s1),E1)),X.flags&512&&X.wrap&4&&(X.check=W(X.check,r0,s1,m0)),U0-=s1,m0+=s1,X.length-=s1),X.length))break e;X.length=0,X.mode=J2;case J2:if(X.flags&2048){if(U0===0)break e;s1=0;do E1=r0[m0+s1++],X.head&&E1&&X.length<65536&&(X.head.name+=String.fromCharCode(E1));while(E1&&s1<U0);if(X.flags&512&&X.wrap&4&&(X.check=W(X.check,r0,s1,m0)),U0-=s1,m0+=s1,E1)break e}else X.head&&(X.head.name=null);X.length=0,X.mode=US;case US:if(X.flags&4096){if(U0===0)break e;s1=0;do E1=r0[m0+s1++],X.head&&E1&&X.length<65536&&(X.head.comment+=String.fromCharCode(E1));while(E1&&s1<U0);if(X.flags&512&&X.wrap&4&&(X.check=W(X.check,r0,s1,m0)),U0-=s1,m0+=s1,E1)break e}else X.head&&(X.head.comment=null);X.mode=ix;case ix:if(X.flags&512){for(;j0<16;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if(X.wrap&4&&I0!==(X.check&65535)){z.msg="header crc mismatch",X.mode=S_;break}I0=0,j0=0}X.head&&(X.head.hcrc=X.flags>>9&1,X.head.done=!0),z.adler=X.check=0,X.mode=zv;break;case bx:for(;j0<32;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}z.adler=X.check=iS(I0),I0=0,j0=0,X.mode=jx;case jx:if(X.havedict===0)return z.next_out=X0,z.avail_out=m1,z.next_in=m0,z.avail_in=U0,X.hold=I0,X.bits=j0,aM;z.adler=X.check=1,X.mode=zv;case zv:if(si===rM||si===q2)break e;case $v:if(X.last){I0>>>=j0&7,j0-=j0&7,X.mode=T2;break}for(;j0<3;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}switch(X.last=I0&1,I0>>>=1,j0-=1,I0&3){case 0:X.mode=kS;break;case 1:if($x(X),X.mode=M2,si===q2){I0>>>=2,j0-=2;break e}break;case 2:X.mode=kA;break;case 3:z.msg="invalid block type",X.mode=S_}I0>>>=2,j0-=2;break;case kS:for(I0>>>=j0&7,j0-=j0&7;j0<32;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if((I0&65535)!==(I0>>>16^65535)){z.msg="invalid stored block lengths",X.mode=S_;break}if(X.length=I0&65535,I0=0,j0=0,X.mode=eS,si===q2)break e;case eS:X.mode=GS;case GS:if(s1=X.length,s1){if(s1>U0&&(s1=U0),s1>m1&&(s1=m1),s1===0)break e;x0.set(r0.subarray(m0,m0+s1),X0),U0-=s1,m0+=s1,m1-=s1,X0+=s1,X.length-=s1;break}X.mode=zv;break;case kA:for(;j0<14;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if(X.nlen=(I0&31)+257,I0>>>=5,j0-=5,X.ndist=(I0&31)+1,I0>>>=5,j0-=5,X.ncode=(I0&15)+4,I0>>>=4,j0-=4,X.nlen>286||X.ndist>30){z.msg="too many length or distance symbols",X.mode=S_;break}X.have=0,X.mode=GA;case GA:for(;X.have<X.ncode;){for(;j0<3;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}X.lens[Qv[X.have++]]=I0&7,I0>>>=3,j0-=3}for(;X.have<19;)X.lens[Qv[X.have++]]=0;if(X.lencode=X.lendyn,X.lenbits=7,T1={bits:X.lenbits},V1=vx(OS,X.lens,0,19,X.lencode,0,X.work,T1),X.lenbits=T1.bits,V1){z.msg="invalid code lengths set",X.mode=S_;break}X.have=0,X.mode=VA;case VA:for(;X.have<X.nlen+X.ndist;){for(;I1=X.lencode[I0&(1<<X.lenbits)-1],R1=I1>>>24,$1=I1>>>16&255,D1=I1&65535,!(R1<=j0);){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if(D1<16)I0>>>=R1,j0-=R1,X.lens[X.have++]=D1;else{if(D1===16){for(N1=R1+2;j0<N1;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if(I0>>>=R1,j0-=R1,X.have===0){z.msg="invalid bit length repeat",X.mode=S_;break}E1=X.lens[X.have-1],s1=3+(I0&3),I0>>>=2,j0-=2}else if(D1===17){for(N1=R1+3;j0<N1;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}I0>>>=R1,j0-=R1,E1=0,s1=3+(I0&7),I0>>>=3,j0-=3}else{for(N1=R1+7;j0<N1;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}I0>>>=R1,j0-=R1,E1=0,s1=11+(I0&127),I0>>>=7,j0-=7}if(X.have+s1>X.nlen+X.ndist){z.msg="invalid bit length repeat",X.mode=S_;break}for(;s1--;)X.lens[X.have++]=E1}}if(X.mode===S_)break;if(X.lens[256]===0){z.msg="invalid code -- missing end-of-block",X.mode=S_;break}if(X.lenbits=9,T1={bits:X.lenbits},V1=vx(IS,X.lens,0,X.nlen,X.lencode,0,X.work,T1),X.lenbits=T1.bits,V1){z.msg="invalid literal/lengths set",X.mode=S_;break}if(X.distbits=6,X.distcode=X.distdyn,T1={bits:X.distbits},V1=vx(BS,X.lens,X.nlen,X.ndist,X.distcode,0,X.work,T1),X.distbits=T1.bits,V1){z.msg="invalid distances set",X.mode=S_;break}if(X.mode=M2,si===q2)break e;case M2:X.mode=w2;case w2:if(U0>=6&&m1>=258){z.next_out=X0,z.avail_out=m1,z.next_in=m0,z.avail_in=U0,X.hold=I0,X.bits=j0,Ux(z,d1),X0=z.next_out,x0=z.output,m1=z.avail_out,m0=z.next_in,r0=z.input,U0=z.avail_in,I0=X.hold,j0=X.bits,X.mode===zv&&(X.back=-1);break}for(X.back=0;I1=X.lencode[I0&(1<<X.lenbits)-1],R1=I1>>>24,$1=I1>>>16&255,D1=I1&65535,!(R1<=j0);){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if($1&&($1&240)===0){for(h1=R1,B1=$1,U_=D1;I1=X.lencode[U_+((I0&(1<<h1+B1)-1)>>h1)],R1=I1>>>24,$1=I1>>>16&255,D1=I1&65535,!(h1+R1<=j0);){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}I0>>>=h1,j0-=h1,X.back+=h1}if(I0>>>=R1,j0-=R1,X.back+=R1,X.length=D1,$1===0){X.mode=Sx;break}if($1&32){X.back=-1,X.mode=zv;break}if($1&64){z.msg="invalid literal/length code",X.mode=S_;break}X.extra=$1&15,X.mode=tS;case tS:if(X.extra){for(N1=X.extra;j0<N1;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}X.length+=I0&(1<<X.extra)-1,I0>>>=X.extra,j0-=X.extra,X.back+=X.extra}X.was=X.length,X.mode=Av;case Av:for(;I1=X.distcode[I0&(1<<X.distbits)-1],R1=I1>>>24,$1=I1>>>16&255,D1=I1&65535,!(R1<=j0);){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if(($1&240)===0){for(h1=R1,B1=$1,U_=D1;I1=X.distcode[U_+((I0&(1<<h1+B1)-1)>>h1)],R1=I1>>>24,$1=I1>>>16&255,D1=I1&65535,!(h1+R1<=j0);){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}I0>>>=h1,j0-=h1,X.back+=h1}if(I0>>>=R1,j0-=R1,X.back+=R1,$1&64){z.msg="invalid distance code",X.mode=S_;break}X.offset=D1,X.extra=$1&15,X.mode=C2;case C2:if(X.extra){for(N1=X.extra;j0<N1;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}X.offset+=I0&(1<<X.extra)-1,I0>>>=X.extra,j0-=X.extra,X.back+=X.extra}if(X.offset>X.dmax){z.msg="invalid distance too far back",X.mode=S_;break}X.mode=gv;case gv:if(m1===0)break e;if(s1=d1-m1,X.offset>s1){if(s1=X.offset-s1,s1>X.whave&&X.sane){z.msg="invalid distance too far back",X.mode=S_;break}s1>X.wnext?(s1-=X.wnext,S1=X.wsize-s1):S1=X.wnext-s1,s1>X.length&&(s1=X.length),A_=X.window}else A_=x0,S1=X0-X.offset,s1=X.length;s1>m1&&(s1=m1),m1-=s1,X.length-=s1;do x0[X0++]=A_[S1++];while(--s1);X.length===0&&(X.mode=w2);break;case Sx:if(m1===0)break e;x0[X0++]=X.length,m1--,X.mode=w2;break;case T2:if(X.wrap){for(;j0<32;){if(U0===0)break e;U0--,I0|=r0[m0++]<<j0,j0+=8}if(d1-=m1,z.total_out+=d1,X.total+=d1,X.wrap&4&&d1&&(z.adler=X.check=X.flags?W(X.check,x0,d1,X0-d1):y0(X.check,x0,d1,X0-d1)),d1=m1,X.wrap&4&&(X.flags?I0:iS(I0))!==X.check){z.msg="incorrect data check",X.mode=S_;break}I0=0,j0=0}X.mode=R2;case R2:if(X.wrap&&X.flags){for(;j0<32;){if(U0===0)break e;U0--,I0+=r0[m0++]<<j0,j0+=8}if(X.wrap&4&&I0!==(X.total&4294967295)){z.msg="incorrect length check",X.mode=S_;break}I0=0,j0=0}X.mode=D2;case D2:V1=sM;break e;case S_:V1=Vx;break e;case rx:return zS;case VS:default:return I_}return z.next_out=X0,z.avail_out=m1,z.next_in=m0,z.avail_in=U0,X.hold=I0,X.bits=j0,(X.wsize||d1!==z.avail_out&&X.mode<S_&&(X.mode<T2||si!==NS))&&P2(z,z.output,z.next_out,d1-z.avail_out),W1-=z.avail_in,d1-=z.avail_out,z.total_in+=W1,z.total_out+=d1,X.total+=d1,X.wrap&4&&d1&&(z.adler=X.check=X.flags?W(X.check,x0,d1,z.next_out-d1):y0(X.check,x0,d1,z.next_out-d1)),z.data_type=X.bits+(X.last?64:0)+(X.mode===zv?128:0)+(X.mode===M2||X.mode===eS?256:0),(W1===0&&d1===0||si===NS)&&V1===xx&&(V1=FA),V1},Ev=z=>{if(sx(z))return I_;let si=z.state;return si.window&&(si.window=null),z.state=null,xx},Mv=(z,si)=>{if(sx(z))return I_;const X=z.state;return(X.wrap&2)===0?I_:(X.head=si,si.done=!1,xx)},lx=(z,si)=>{const X=si.length;let r0,x0,m0;return sx(z)||(r0=z.state,r0.wrap!==0&&r0.mode!==jx)?I_:r0.mode===jx&&(x0=1,x0=y0(x0,si,X,0),x0!==r0.check)?Vx:(m0=P2(z,si,X,X),m0?(r0.mode=rx,zS):(r0.havedict=1,xx))};var Fv=ax,Uv=rS,Yv=L2,HA=jS,$S=HS,XS=O2,jA=Ev,J_=Mv,D_=lx,F1="pako inflate (from Nodeca project)",nv={inflateReset:Fv,inflateReset2:Uv,inflateResetKeep:Yv,inflateInit:HA,inflateInit2:$S,inflate:XS,inflateEnd:jA,inflateGetHeader:J_,inflateSetDictionary:D_,inflateInfo:F1};function wv(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var YS=wv;const Kv=Object.prototype.toString,{Z_NO_FLUSH:WA,Z_FINISH:$A,Z_OK:kv,Z_STREAM_END:qv,Z_NEED_DICT:I2,Z_STREAM_ERROR:B2,Z_DATA_ERROR:sS,Z_MEM_ERROR:Ax}=a0;function vv(z){this.options=W2.assign({chunkSize:65536,windowBits:15,to:""},z||{});const si=this.options;si.raw&&si.windowBits>=0&&si.windowBits<16&&(si.windowBits=-si.windowBits,si.windowBits===0&&(si.windowBits=-15)),si.windowBits>=0&&si.windowBits<16&&!(z&&z.windowBits)&&(si.windowBits+=32),si.windowBits>15&&si.windowBits<48&&(si.windowBits&15)===0&&(si.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $2,this.strm.avail_out=0;let X=nv.inflateInit2(this.strm,si.windowBits);if(X!==kv)throw new Error(e0[X]);if(this.header=new YS,nv.inflateGetHeader(this.strm,this.header),si.dictionary&&(typeof si.dictionary=="string"?si.dictionary=x2.string2buf(si.dictionary):Kv.call(si.dictionary)==="[object ArrayBuffer]"&&(si.dictionary=new Uint8Array(si.dictionary)),si.raw&&(X=nv.inflateSetDictionary(this.strm,si.dictionary),X!==kv)))throw new Error(e0[X])}vv.prototype.push=function(z,si){const X=this.strm,r0=this.options.chunkSize,x0=this.options.dictionary;let m0,X0,U0;if(this.ended)return!1;for(si===~~si?X0=si:X0=si===!0?$A:WA,Kv.call(z)==="[object ArrayBuffer]"?X.input=new Uint8Array(z):X.input=z,X.next_in=0,X.avail_in=X.input.length;;){for(X.avail_out===0&&(X.output=new Uint8Array(r0),X.next_out=0,X.avail_out=r0),m0=nv.inflate(X,X0),m0===I2&&x0&&(m0=nv.inflateSetDictionary(X,x0),m0===kv?m0=nv.inflate(X,X0):m0===sS&&(m0=I2));X.avail_in>0&&m0===qv&&X.state.wrap>0&&z[X.next_in]!==0;)nv.inflateReset(X),m0=nv.inflate(X,X0);switch(m0){case B2:case sS:case I2:case Ax:return this.onEnd(m0),this.ended=!0,!1}if(U0=X.avail_out,X.next_out&&(X.avail_out===0||m0===qv))if(this.options.to==="string"){let m1=x2.utf8border(X.output,X.next_out),I0=X.next_out-m1,j0=x2.buf2string(X.output,m1);X.next_out=I0,X.avail_out=r0-I0,I0&&X.output.set(X.output.subarray(m1,m1+I0),0),this.onData(j0)}else this.onData(X.output.length===X.next_out?X.output:X.output.subarray(0,X.next_out));if(!(m0===kv&&U0===0)){if(m0===qv)return m0=nv.inflateEnd(this.strm),this.onEnd(m0),this.ended=!0,!0;if(X.avail_in===0)break}}return!0},vv.prototype.onData=function(z){this.chunks.push(z)},vv.prototype.onEnd=function(z){z===kv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=W2.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg};function Gv(z,si){const X=new vv(si);if(X.push(z),X.err)throw X.msg||e0[X.err];return X.result}function Zv(z,si){return si=si||{},si.raw=!0,Gv(z,si)}var KS=vv,qS=Gv,Xx=Zv,aS=Gv,Ex={Inflate:KS,inflate:qS,inflateRaw:Xx,ungzip:aS};const{Deflate:ev,deflate:oS,deflateRaw:XA,gzip:oM}=OA,{Inflate:lM,inflate:cM,inflateRaw:F_,ungzip:ZS}=Ex;var Yx=ev,Kx=oS,lS=XA,Mx=oM,wx=lM,YA=cM,QS=F_,KA=ZS,JS=a0,Cx={Deflate:Yx,deflate:Kx,deflateRaw:lS,gzip:Mx,Inflate:wx,inflate:YA,inflateRaw:QS,ungzip:KA,constants:JS}}),"./node_modules/upng-js/UPNG.js":((r,e,t)=>{(function(){var n={},i;r.exports=n,i=t("./node_modules/upng-js/node_modules/pako/index.js"),(function(s,o){s.toRGBA8=function(a){var l=a.width,d=a.height;if(a.tabs.acTL==null)return[s.toRGBA8.decodeImage(a.data,l,d,a).buffer];var u=[];a.frames[0].data==null&&(a.frames[0].data=a.data);for(var g,x=new Uint8Array(l*d*4),y=0;y<a.frames.length;y++){var b=a.frames[y],_=b.rect.x,h=b.rect.y,f=b.rect.width,E=b.rect.height,m=s.toRGBA8.decodeImage(b.data,f,E,a);if(y==0?g=m:b.blend==0?s._copyTile(m,f,E,g,l,d,_,h,0):b.blend==1&&s._copyTile(m,f,E,g,l,d,_,h,1),u.push(g.buffer),g=g.slice(0),b.dispose!=0){if(b.dispose==1)s._copyTile(x,f,E,g,l,d,_,h,0);else if(b.dispose==2){for(var S=y-1;a.frames[S].dispose==2;)S--;g=new Uint8Array(u[S]).slice(0)}}}return u},s.toRGBA8.decodeImage=function(a,l,d,u){var g=l*d,x=s.decode._getBPP(u),y=Math.ceil(l*x/8),b=new Uint8Array(g*4),_=new Uint32Array(b.buffer),h=u.ctype,f=u.depth,E=s._bin.readUshort;if(h==6){var m=g<<2;if(f==8)for(var S=0;S<m;S++)b[S]=a[S];if(f==16)for(var S=0;S<m;S++)b[S]=a[S<<1]}else if(h==2){var w=u.tabs.tRNS,v=-1,A=-1,M=-1;if(w&&(v=w[0],A=w[1],M=w[2]),f==8)for(var S=0;S<g;S++){var T=S<<2,R=S*3;b[T]=a[R],b[T+1]=a[R+1],b[T+2]=a[R+2],b[T+3]=255,v!=-1&&a[R]==v&&a[R+1]==A&&a[R+2]==M&&(b[T+3]=0)}if(f==16)for(var S=0;S<g;S++){var T=S<<2,R=S*6;b[T]=a[R],b[T+1]=a[R+2],b[T+2]=a[R+4],b[T+3]=255,v!=-1&&E(a,R)==v&&E(a,R+2)==A&&E(a,R+4)==M&&(b[T+3]=0)}}else if(h==3){var O=u.tabs.PLTE,L=u.tabs.tRNS,P=L?L.length:0;if(f==1)for(var I=0;I<d;I++)for(var N=I*y,U=I*l,S=0;S<l;S++){var T=U+S<<2,F=a[N+(S>>3)]>>7-((S&7)<<0)&1,k=3*F;b[T]=O[k],b[T+1]=O[k+1],b[T+2]=O[k+2],b[T+3]=F<P?L[F]:255}if(f==2)for(var I=0;I<d;I++)for(var N=I*y,U=I*l,S=0;S<l;S++){var T=U+S<<2,F=a[N+(S>>2)]>>6-((S&3)<<1)&3,k=3*F;b[T]=O[k],b[T+1]=O[k+1],b[T+2]=O[k+2],b[T+3]=F<P?L[F]:255}if(f==4)for(var I=0;I<d;I++)for(var N=I*y,U=I*l,S=0;S<l;S++){var T=U+S<<2,F=a[N+(S>>1)]>>4-((S&1)<<2)&15,k=3*F;b[T]=O[k],b[T+1]=O[k+1],b[T+2]=O[k+2],b[T+3]=F<P?L[F]:255}if(f==8)for(var S=0;S<g;S++){var T=S<<2,F=a[S],k=3*F;b[T]=O[k],b[T+1]=O[k+1],b[T+2]=O[k+2],b[T+3]=F<P?L[F]:255}}else if(h==4){if(f==8)for(var S=0;S<g;S++){var T=S<<2,j=S<<1,H=a[j];b[T]=H,b[T+1]=H,b[T+2]=H,b[T+3]=a[j+1]}if(f==16)for(var S=0;S<g;S++){var T=S<<2,j=S<<2,H=a[j];b[T]=H,b[T+1]=H,b[T+2]=H,b[T+3]=a[j+2]}}else if(h==0){var v=u.tabs.tRNS?u.tabs.tRNS:-1;if(f==1)for(var S=0;S<g;S++){var H=255*(a[S>>3]>>7-(S&7)&1),B=H==v*255?0:255;_[S]=B<<24|H<<16|H<<8|H}if(f==2)for(var S=0;S<g;S++){var H=85*(a[S>>2]>>6-((S&3)<<1)&3),B=H==v*85?0:255;_[S]=B<<24|H<<16|H<<8|H}if(f==4)for(var S=0;S<g;S++){var H=17*(a[S>>1]>>4-((S&1)<<2)&15),B=H==v*17?0:255;_[S]=B<<24|H<<16|H<<8|H}if(f==8)for(var S=0;S<g;S++){var H=a[S],B=H==v?0:255;_[S]=B<<24|H<<16|H<<8|H}if(f==16)for(var S=0;S<g;S++){var H=a[S<<1],B=E(a,S<<1)==v?0:255;_[S]=B<<24|H<<16|H<<8|H}}return b},s.decode=function(a){for(var l=new Uint8Array(a),d=8,u=s._bin,g=u.readUshort,x=u.readUint,y={tabs:{},frames:[]},b=new Uint8Array(l.length),_=0,h,f=0,E=[137,80,78,71,13,10,26,10],m=0;m<8;m++)if(l[m]!=E[m])throw"The input is not a PNG file!";for(;d<l.length;){var S=u.readUint(l,d);d+=4;var w=u.readASCII(l,d,4);if(d+=4,w=="IHDR")s.decode._IHDR(l,d,y);else if(w=="IDAT"){for(var m=0;m<S;m++)b[_+m]=l[d+m];_+=S}else if(w=="acTL")y.tabs[w]={num_frames:x(l,d),num_plays:x(l,d+4)},h=new Uint8Array(l.length);else if(w=="fcTL"){if(f!=0){var v=y.frames[y.frames.length-1];v.data=s.decode._decompress(y,h.slice(0,f),v.rect.width,v.rect.height),f=0}var A={x:x(l,d+12),y:x(l,d+16),width:x(l,d+4),height:x(l,d+8)},M=g(l,d+22);M=g(l,d+20)/(M==0?100:M);var T={rect:A,delay:Math.round(M*1e3),dispose:l[d+24],blend:l[d+25]};y.frames.push(T)}else if(w=="fdAT"){for(var m=0;m<S-4;m++)h[f+m]=l[d+m+4];f+=S-4}else if(w=="pHYs")y.tabs[w]=[u.readUint(l,d),u.readUint(l,d+4),l[d+8]];else if(w=="cHRM"){y.tabs[w]=[];for(var m=0;m<8;m++)y.tabs[w].push(u.readUint(l,d+m*4))}else if(w=="tEXt"){y.tabs[w]==null&&(y.tabs[w]={});var R=u.nextZero(l,d),O=u.readASCII(l,d,R-d),L=u.readASCII(l,R+1,d+S-R-1);y.tabs[w][O]=L}else if(w=="iTXt"){y.tabs[w]==null&&(y.tabs[w]={});var R=0,P=d;R=u.nextZero(l,P);var O=u.readASCII(l,P,R-P);P=R+1,l[P],l[P+1],P+=2,R=u.nextZero(l,P),u.readASCII(l,P,R-P),P=R+1,R=u.nextZero(l,P),u.readUTF8(l,P,R-P),P=R+1;var L=u.readUTF8(l,P,S-(P-d));y.tabs[w][O]=L}else if(w=="PLTE")y.tabs[w]=u.readBytes(l,d,S);else if(w=="hIST"){var I=y.tabs.PLTE.length/3;y.tabs[w]=[];for(var m=0;m<I;m++)y.tabs[w].push(g(l,d+m*2))}else if(w=="tRNS")y.ctype==3?y.tabs[w]=u.readBytes(l,d,S):y.ctype==0?y.tabs[w]=g(l,d):y.ctype==2&&(y.tabs[w]=[g(l,d),g(l,d+2),g(l,d+4)]);else if(w=="gAMA")y.tabs[w]=u.readUint(l,d)/1e5;else if(w=="sRGB")y.tabs[w]=l[d];else if(w=="bKGD")y.ctype==0||y.ctype==4?y.tabs[w]=[g(l,d)]:y.ctype==2||y.ctype==6?y.tabs[w]=[g(l,d),g(l,d+2),g(l,d+4)]:y.ctype==3&&(y.tabs[w]=l[d]);else if(w=="IEND"){if(f!=0){var v=y.frames[y.frames.length-1];v.data=s.decode._decompress(y,h.slice(0,f),v.rect.width,v.rect.height),f=0}y.data=s.decode._decompress(y,b,y.width,y.height);break}d+=S,u.readUint(l,d),d+=4}return delete y.compress,delete y.interlace,delete y.filter,y},s.decode._decompress=function(a,l,d,u){return a.compress==0&&(l=s.decode._inflate(l)),a.interlace==0?l=s.decode._filterZero(l,a,0,d,u):a.interlace==1&&(l=s.decode._readInterlace(l,a)),l},s.decode._inflate=function(a){return o.inflate(a)},s.decode._readInterlace=function(a,l){for(var d=l.width,u=l.height,g=s.decode._getBPP(l),x=g>>3,y=Math.ceil(d*g/8),b=new Uint8Array(u*y),_=0,h=[0,0,4,0,2,0,1],f=[0,4,0,2,0,1,0],E=[8,8,8,4,4,2,2],m=[8,8,4,4,2,2,1],S=0;S<7;){for(var w=E[S],v=m[S],A=0,M=0,T=h[S];T<u;)T+=w,M++;for(var R=f[S];R<d;)R+=v,A++;var O=Math.ceil(A*g/8);s.decode._filterZero(a,l,_,A,M);for(var L=0,P=h[S];P<u;){for(var I=f[S],N=_+L*O<<3;I<d;){if(g==1){var U=a[N>>3];U=U>>7-(N&7)&1,b[P*y+(I>>3)]|=U<<7-((I&3)<<0)}if(g==2){var U=a[N>>3];U=U>>6-(N&7)&3,b[P*y+(I>>2)]|=U<<6-((I&3)<<1)}if(g==4){var U=a[N>>3];U=U>>4-(N&7)&15,b[P*y+(I>>1)]|=U<<4-((I&1)<<2)}if(g>=8)for(var F=P*y+I*x,k=0;k<x;k++)b[F+k]=a[(N>>3)+k];N+=g,I+=v}L++,P+=w}A*M!=0&&(_+=M*(1+O)),S=S+1}return b},s.decode._getBPP=function(a){var l=[1,null,3,1,2,null,4][a.ctype];return l*a.depth},s.decode._filterZero=function(a,l,d,u,g){var x=s.decode._getBPP(l),y=Math.ceil(u*x/8),b=s.decode._paeth;x=Math.ceil(x/8);for(var _=0;_<g;_++){var h=d+_*y,f=h+_+1,E=a[f-1];if(E==0)for(var m=0;m<y;m++)a[h+m]=a[f+m];else if(E==1){for(var m=0;m<x;m++)a[h+m]=a[f+m];for(var m=x;m<y;m++)a[h+m]=a[f+m]+a[h+m-x]&255}else if(_==0){for(var m=0;m<x;m++)a[h+m]=a[f+m];if(E==2)for(var m=x;m<y;m++)a[h+m]=a[f+m]&255;if(E==3)for(var m=x;m<y;m++)a[h+m]=a[f+m]+(a[h+m-x]>>1)&255;if(E==4)for(var m=x;m<y;m++)a[h+m]=a[f+m]+b(a[h+m-x],0,0)&255}else{if(E==2)for(var m=0;m<y;m++)a[h+m]=a[f+m]+a[h+m-y]&255;if(E==3){for(var m=0;m<x;m++)a[h+m]=a[f+m]+(a[h+m-y]>>1)&255;for(var m=x;m<y;m++)a[h+m]=a[f+m]+(a[h+m-y]+a[h+m-x]>>1)&255}if(E==4){for(var m=0;m<x;m++)a[h+m]=a[f+m]+b(0,a[h+m-y],0)&255;for(var m=x;m<y;m++)a[h+m]=a[f+m]+b(a[h+m-x],a[h+m-y],a[h+m-x-y])&255}}}return a},s.decode._paeth=function(a,l,d){var u=a+l-d,g=Math.abs(u-a),x=Math.abs(u-l),y=Math.abs(u-d);return g<=x&&g<=y?a:x<=y?l:d},s.decode._IHDR=function(a,l,d){var u=s._bin;d.width=u.readUint(a,l),l+=4,d.height=u.readUint(a,l),l+=4,d.depth=a[l],l++,d.ctype=a[l],l++,d.compress=a[l],l++,d.filter=a[l],l++,d.interlace=a[l],l++},s._bin={nextZero:function(a,l){for(;a[l]!=0;)l++;return l},readUshort:function(a,l){return a[l]<<8|a[l+1]},writeUshort:function(a,l,d){a[l]=d>>8&255,a[l+1]=d&255},readUint:function(a,l){return a[l]*16777216+(a[l+1]<<16|a[l+2]<<8|a[l+3])},writeUint:function(a,l,d){a[l]=d>>24&255,a[l+1]=d>>16&255,a[l+2]=d>>8&255,a[l+3]=d&255},readASCII:function(a,l,d){for(var u="",g=0;g<d;g++)u+=String.fromCharCode(a[l+g]);return u},writeASCII:function(a,l,d){for(var u=0;u<d.length;u++)a[l+u]=d.charCodeAt(u)},readBytes:function(a,l,d){for(var u=[],g=0;g<d;g++)u.push(a[l+g]);return u},pad:function(a){return a.length<2?"0"+a:a},readUTF8:function(a,l,d){for(var u="",g,x=0;x<d;x++)u+="%"+s._bin.pad(a[l+x].toString(16));try{g=decodeURIComponent(u)}catch{return s._bin.readASCII(a,l,d)}return g}},s._copyTile=function(a,l,d,u,g,x,y,b,_){for(var h=Math.min(l,g),f=Math.min(d,x),E=0,m=0,S=0;S<f;S++)for(var w=0;w<h;w++)if(y>=0&&b>=0?(E=S*l+w<<2,m=(b+S)*g+y+w<<2):(E=(-b+S)*l-y+w<<2,m=S*g+w<<2),_==0)u[m]=a[E],u[m+1]=a[E+1],u[m+2]=a[E+2],u[m+3]=a[E+3];else if(_==1){var v=a[E+3]*.00392156862745098,A=a[E]*v,M=a[E+1]*v,T=a[E+2]*v,R=u[m+3]*(1/255),O=u[m]*R,L=u[m+1]*R,P=u[m+2]*R,I=1-v,N=v+R*I,U=N==0?0:1/N;u[m+3]=255*N,u[m+0]=(A+O*I)*U,u[m+1]=(M+L*I)*U,u[m+2]=(T+P*I)*U}else if(_==2){var v=a[E+3],A=a[E],M=a[E+1],T=a[E+2],R=u[m+3],O=u[m],L=u[m+1],P=u[m+2];v==R&&A==O&&M==L&&T==P?(u[m]=0,u[m+1]=0,u[m+2]=0,u[m+3]=0):(u[m]=A,u[m+1]=M,u[m+2]=T,u[m+3]=v)}else if(_==3){var v=a[E+3],A=a[E],M=a[E+1],T=a[E+2],R=u[m+3],O=u[m],L=u[m+1],P=u[m+2];if(v==R&&A==O&&M==L&&T==P)continue;if(v<220&&R>20)return!1}return!0},s.encode=function(a,l,d,u,g,x){u==null&&(u=0),x==null&&(x=!1);for(var y=new Uint8Array(a[0].byteLength*a.length+100),b=[137,80,78,71,13,10,26,10],_=0;_<8;_++)y[_]=b[_];var h=8,f=s._bin,E=s.crc.crc,m=f.writeUint,S=f.writeUshort,w=f.writeASCII,v=s.encode.compressPNG(a,l,d,u,x);m(y,h,13),h+=4,w(y,h,"IHDR"),h+=4,m(y,h,l),h+=4,m(y,h,d),h+=4,y[h]=v.depth,h++,y[h]=v.ctype,h++,y[h]=0,h++,y[h]=0,h++,y[h]=0,h++,m(y,h,E(y,h-17,17)),h+=4,m(y,h,1),h+=4,w(y,h,"sRGB"),h+=4,y[h]=1,h++,m(y,h,E(y,h-5,5)),h+=4;var A=a.length>1;if(A&&(m(y,h,8),h+=4,w(y,h,"acTL"),h+=4,m(y,h,a.length),h+=4,m(y,h,0),h+=4,m(y,h,E(y,h-12,12)),h+=4),v.ctype==3){var M=v.plte.length;m(y,h,M*3),h+=4,w(y,h,"PLTE"),h+=4;for(var _=0;_<M;_++){var T=_*3,R=v.plte[_],O=R&255,L=R>>8&255,P=R>>16&255;y[h+T+0]=O,y[h+T+1]=L,y[h+T+2]=P}if(h+=M*3,m(y,h,E(y,h-M*3-4,M*3+4)),h+=4,v.gotAlpha){m(y,h,M),h+=4,w(y,h,"tRNS"),h+=4;for(var _=0;_<M;_++)y[h+_]=v.plte[_]>>24&255;h+=M,m(y,h,E(y,h-M-4,M+4)),h+=4}}for(var I=0,N=0;N<v.frames.length;N++){var U=v.frames[N];A&&(m(y,h,26),h+=4,w(y,h,"fcTL"),h+=4,m(y,h,I++),h+=4,m(y,h,U.rect.width),h+=4,m(y,h,U.rect.height),h+=4,m(y,h,U.rect.x),h+=4,m(y,h,U.rect.y),h+=4,S(y,h,g[N]),h+=2,S(y,h,1e3),h+=2,y[h]=U.dispose,h++,y[h]=U.blend,h++,m(y,h,E(y,h-30,30)),h+=4);var F=U.cimg,M=F.length;m(y,h,M+(N==0?0:4)),h+=4;var k=h;w(y,h,N==0?"IDAT":"fdAT"),h+=4,N!=0&&(m(y,h,I++),h+=4);for(var _=0;_<M;_++)y[h+_]=F[_];h+=M,m(y,h,E(y,k,h-k)),h+=4}return m(y,h,0),h+=4,w(y,h,"IEND"),h+=4,m(y,h,E(y,h-4,4)),h+=4,y.buffer.slice(0,h)},s.encode.compressPNG=function(a,l,d,u,g){for(var x=s.encode.compress(a,l,d,u,!1,g),y=0;y<a.length;y++){var b=x.frames[y];b.rect.width;var _=b.rect.height,h=b.bpl,f=b.bpp,E=new Uint8Array(_*h+_);b.cimg=s.encode._filterZero(b.img,_,f,h,E)}return x},s.encode.compress=function(a,l,d,u,g,x){x==null&&(x=!1);for(var y=6,b=8,_=4,h=255,f=0;f<a.length;f++)for(var E=new Uint8Array(a[f]),m=E.length,S=0;S<m;S+=4)h&=E[S+3];var w=h!=255,v={},A=[];if(a.length!=0&&(v[0]=0,A.push(0),u!=0&&u--),u!=0){var M=s.quantize(a,u,g);a=M.bufs;for(var S=0;S<M.plte.length;S++){var T=M.plte[S].est.rgba;v[T]==null&&(v[T]=A.length,A.push(T))}}else for(var f=0;f<a.length;f++)for(var R=new Uint32Array(a[f]),m=R.length,S=0;S<m;S++){var T=R[S];if((S<l||T!=R[S-1]&&T!=R[S-l])&&v[T]==null&&(v[T]=A.length,A.push(T),A.length>=300))break}var O=w?g:!1,L=A.length;L<=256&&x==!1&&(L<=2?b=1:L<=4?b=2:L<=16?b=4:b=8,g&&(b=8),w=!0);for(var P=[],f=0;f<a.length;f++){var I=new Uint8Array(a[f]),N=new Uint32Array(I.buffer),U=0,F=0,k=l,j=d,H=0;if(f!=0&&!O){for(var B=g||f==1||P[P.length-2].dispose==2?1:2,V=0,Y=1e9,K=0;K<B;K++){for(var ec=new Uint8Array(a[f-1-K]),J=new Uint32Array(a[f-1-K]),Te=l,He=d,Q=-1,Xe=-1,ut=0;ut<d;ut++)for(var Ji=0;Ji<l;Ji++){var S=ut*l+Ji;N[S]!=J[S]&&(Ji<Te&&(Te=Ji),Ji>Q&&(Q=Ji),ut<He&&(He=ut),ut>Xe&&(Xe=ut))}var er=Q==-1?1:(Q-Te+1)*(Xe-He+1);er<Y&&(Y=er,V=K,Q==-1?(U=F=0,k=j=1):(U=Te,F=He,k=Q-Te+1,j=Xe-He+1))}var ec=new Uint8Array(a[f-1-V]);V==1&&(P[P.length-1].dispose=2);var ai=new Uint8Array(k*j*4);new Uint32Array(ai.buffer),s._copyTile(ec,l,d,ai,k,j,-U,-F,0),s._copyTile(I,l,d,ai,k,j,-U,-F,3)?(s._copyTile(I,l,d,ai,k,j,-U,-F,2),H=1):(s._copyTile(I,l,d,ai,k,j,-U,-F,0),H=0),I=ai,N=new Uint32Array(I.buffer)}var u0=4*k;if(L<=256&&x==!1){u0=Math.ceil(b*k/8);for(var ai=new Uint8Array(u0*j),ut=0;ut<j;ut++){var S=ut*u0,o0=ut*k;if(b==8)for(var Ji=0;Ji<k;Ji++)ai[S+Ji]=v[N[o0+Ji]];else if(b==4)for(var Ji=0;Ji<k;Ji++)ai[S+(Ji>>1)]|=v[N[o0+Ji]]<<4-(Ji&1)*4;else if(b==2)for(var Ji=0;Ji<k;Ji++)ai[S+(Ji>>2)]|=v[N[o0+Ji]]<<6-(Ji&3)*2;else if(b==1)for(var Ji=0;Ji<k;Ji++)ai[S+(Ji>>3)]|=v[N[o0+Ji]]<<7-(Ji&7)*1}I=ai,y=3,_=1}else if(w==!1&&a.length==1){for(var ai=new Uint8Array(k*j*3),E0=k*j,S=0;S<E0;S++){var F0=S*3,g0=S*4;ai[F0]=I[g0],ai[F0+1]=I[g0+1],ai[F0+2]=I[g0+2]}I=ai,y=2,_=3,u0=3*k}P.push({rect:{x:U,y:F,width:k,height:j},img:I,bpl:u0,bpp:_,blend:H,dispose:O?1:0})}return{ctype:y,depth:b,plte:A,gotAlpha:w,frames:P}},s.encode._filterZero=function(a,l,d,u,g){for(var x=[],y=0;y<5;y++)if(!(l*u>5e5&&(y==2||y==3||y==4))){for(var b=0;b<l;b++)s.encode._filterLine(g,a,b,u,d,y);if(x.push(o.deflate(g)),d==1)break}for(var _,h=1e9,f=0;f<x.length;f++)x[f].length<h&&(_=f,h=x[f].length);return x[_]},s.encode._filterLine=function(a,l,d,u,g,x){var y=d*u,b=y+d,_=s.decode._paeth;if(a[b]=x,b++,x==0)for(var h=0;h<u;h++)a[b+h]=l[y+h];else if(x==1){for(var h=0;h<g;h++)a[b+h]=l[y+h];for(var h=g;h<u;h++)a[b+h]=l[y+h]-l[y+h-g]+256&255}else if(d==0){for(var h=0;h<g;h++)a[b+h]=l[y+h];if(x==2)for(var h=g;h<u;h++)a[b+h]=l[y+h];if(x==3)for(var h=g;h<u;h++)a[b+h]=l[y+h]-(l[y+h-g]>>1)+256&255;if(x==4)for(var h=g;h<u;h++)a[b+h]=l[y+h]-_(l[y+h-g],0,0)+256&255}else{if(x==2)for(var h=0;h<u;h++)a[b+h]=l[y+h]+256-l[y+h-u]&255;if(x==3){for(var h=0;h<g;h++)a[b+h]=l[y+h]+256-(l[y+h-u]>>1)&255;for(var h=g;h<u;h++)a[b+h]=l[y+h]+256-(l[y+h-u]+l[y+h-g]>>1)&255}if(x==4){for(var h=0;h<g;h++)a[b+h]=l[y+h]+256-_(0,l[y+h-u],0)&255;for(var h=g;h<u;h++)a[b+h]=l[y+h]+256-_(l[y+h-g],l[y+h-u],l[y+h-g-u])&255}}},s.crc={table:(function(){for(var a=new Uint32Array(256),l=0;l<256;l++){for(var d=l,u=0;u<8;u++)d&1?d=3988292384^d>>>1:d=d>>>1;a[l]=d}return a})(),update:function(a,l,d,u){for(var g=0;g<u;g++)a=s.crc.table[(a^l[d+g])&255]^a>>>8;return a},crc:function(a,l,d){return s.crc.update(4294967295,a,l,d)^4294967295}},s.quantize=function(a,l,d){for(var u=[],g=0,x=0;x<a.length;x++)u.push(s.encode.alphaMul(new Uint8Array(a[x]),d)),g+=a[x].byteLength;for(var y=new Uint8Array(g),b=new Uint32Array(y.buffer),_=0,x=0;x<u.length;x++){for(var h=u[x],f=h.length,E=0;E<f;E++)y[_+E]=h[E];_+=f}var m={i0:0,i1:y.length,bst:null,est:null,tdst:0,left:null,right:null};m.bst=s.quantize.stats(y,m.i0,m.i1),m.est=s.quantize.estats(m.bst);for(var S=[m];S.length<l;){for(var w=0,v=0,x=0;x<S.length;x++)S[x].est.L>w&&(w=S[x].est.L,v=x);if(w<.001)break;var A=S[v],M=s.quantize.splitPixels(y,b,A.i0,A.i1,A.est.e,A.est.eMq255),T={i0:A.i0,i1:M,bst:null,est:null,tdst:0,left:null,right:null};T.bst=s.quantize.stats(y,T.i0,T.i1),T.est=s.quantize.estats(T.bst);var R={i0:M,i1:A.i1,bst:null,est:null,tdst:0,left:null,right:null};R.bst={R:[],m:[],N:A.bst.N-T.bst.N};for(var x=0;x<16;x++)R.bst.R[x]=A.bst.R[x]-T.bst.R[x];for(var x=0;x<4;x++)R.bst.m[x]=A.bst.m[x]-T.bst.m[x];R.est=s.quantize.estats(R.bst),A.left=T,A.right=R,S[v]=T,S.push(R)}S.sort(function(B,V){return V.bst.N-B.bst.N});for(var O=0;O<u.length;O++){for(var L=s.quantize.planeDst,P=new Uint8Array(u[O].buffer),I=new Uint32Array(u[O].buffer),N=P.length,x=0;x<N;x+=4){for(var U=P[x]*.00392156862745098,F=P[x+1]*(1/255),k=P[x+2]*(1/255),j=P[x+3]*(1/255),H=m;H.left;)H=L(H.est,U,F,k,j)<=0?H.left:H.right;I[x>>2]=H.est.rgba}u[O]=I.buffer}return{bufs:u,plte:S}},s.quantize.getNearest=function(a,l,d,u,g){if(a.left==null)return a.tdst=s.quantize.dist(a.est.q,l,d,u,g),a;var x=s.quantize.planeDst(a.est,l,d,u,g),y=a.left,b=a.right;x>0&&(y=a.right,b=a.left);var _=s.quantize.getNearest(y,l,d,u,g);if(_.tdst<=x*x)return _;var h=s.quantize.getNearest(b,l,d,u,g);return h.tdst<_.tdst?h:_},s.quantize.planeDst=function(a,l,d,u,g){var x=a.e;return x[0]*l+x[1]*d+x[2]*u+x[3]*g-a.eMq},s.quantize.dist=function(a,l,d,u,g){var x=l-a[0],y=d-a[1],b=u-a[2],_=g-a[3];return x*x+y*y+b*b+_*_},s.quantize.splitPixels=function(a,l,d,u,g,x){var y=s.quantize.vecDot;for(u-=4;d<u;){for(;y(a,d,g)<=x;)d+=4;for(;y(a,u,g)>x;)u-=4;if(d>=u)break;var b=l[d>>2];l[d>>2]=l[u>>2],l[u>>2]=b,d+=4,u-=4}for(;y(a,d,g)>x;)d-=4;return d+4},s.quantize.vecDot=function(a,l,d){return a[l]*d[0]+a[l+1]*d[1]+a[l+2]*d[2]+a[l+3]*d[3]},s.quantize.stats=function(a,l,d){for(var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=[0,0,0,0],x=d-l>>2,y=l;y<d;y+=4){var b=a[y]*.00392156862745098,_=a[y+1]*(1/255),h=a[y+2]*(1/255),f=a[y+3]*(1/255);g[0]+=b,g[1]+=_,g[2]+=h,g[3]+=f,u[0]+=b*b,u[1]+=b*_,u[2]+=b*h,u[3]+=b*f,u[5]+=_*_,u[6]+=_*h,u[7]+=_*f,u[10]+=h*h,u[11]+=h*f,u[15]+=f*f}return u[4]=u[1],u[8]=u[2],u[12]=u[3],u[9]=u[6],u[13]=u[7],u[14]=u[11],{R:u,m:g,N:x}},s.quantize.estats=function(a){var l=a.R,d=a.m,u=a.N,g=d[0],x=d[1],y=d[2],b=d[3],_=u==0?0:1/u,h=[l[0]-g*g*_,l[1]-g*x*_,l[2]-g*y*_,l[3]-g*b*_,l[4]-x*g*_,l[5]-x*x*_,l[6]-x*y*_,l[7]-x*b*_,l[8]-y*g*_,l[9]-y*x*_,l[10]-y*y*_,l[11]-y*b*_,l[12]-b*g*_,l[13]-b*x*_,l[14]-b*y*_,l[15]-b*b*_],f=h,E=s.M4,m=[.5,.5,.5,.5],S=0,w=0;if(u!=0)for(var v=0;v<10&&(m=E.multVec(f,m),w=Math.sqrt(E.dot(m,m)),m=E.sml(1/w,m),!(Math.abs(w-S)<1e-9));v++)S=w;var A=[g*_,x*_,y*_,b*_],M=E.dot(E.sml(255,A),m),T=A[3]<.001?0:1/A[3];return{Cov:h,q:A,e:m,L:S,eMq255:M,eMq:E.dot(m,A),rgba:(Math.round(255*A[3])<<24|Math.round(255*A[2]*T)<<16|Math.round(255*A[1]*T)<<8|Math.round(255*A[0]*T)<<0)>>>0}},s.M4={multVec:function(a,l){return[a[0]*l[0]+a[1]*l[1]+a[2]*l[2]+a[3]*l[3],a[4]*l[0]+a[5]*l[1]+a[6]*l[2]+a[7]*l[3],a[8]*l[0]+a[9]*l[1]+a[10]*l[2]+a[11]*l[3],a[12]*l[0]+a[13]*l[1]+a[14]*l[2]+a[15]*l[3]]},dot:function(a,l){return a[0]*l[0]+a[1]*l[1]+a[2]*l[2]+a[3]*l[3]},sml:function(a,l){return[a*l[0],a*l[1],a*l[2],a*l[3]]}},s.encode.alphaMul=function(a,l){for(var d=new Uint8Array(a.length),u=a.length>>2,g=0;g<u;g++){var x=g<<2,y=a[x+3];l&&(y=y<128?0:255);var b=y*(1/255);d[x+0]=a[x+0]*b,d[x+1]=a[x+1]*b,d[x+2]=a[x+2]*b,d[x+3]=y}return d}})(n,i)})()}),"./node_modules/upng-js/node_modules/pako/index.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign,i=t("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),a={};n(a,i,s,o),r.exports=a}),"./node_modules/upng-js/node_modules/pako/lib/deflate.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),i=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),a=t("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),l=Object.prototype.toString,d=0,u=4,g=0,x=1,y=2,b=-1,_=0,h=8;function f(w){if(!(this instanceof f))return new f(w);this.options=i.assign({level:b,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},w||{});var v=this.options;v.raw&&v.windowBits>0?v.windowBits=-v.windowBits:v.gzip&&v.windowBits>0&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var A=n.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(A!==g)throw new Error(o[A]);if(v.header&&n.deflateSetHeader(this.strm,v.header),v.dictionary){var M;if(typeof v.dictionary=="string"?M=s.string2buf(v.dictionary):l.call(v.dictionary)==="[object ArrayBuffer]"?M=new Uint8Array(v.dictionary):M=v.dictionary,A=n.deflateSetDictionary(this.strm,M),A!==g)throw new Error(o[A]);this._dict_set=!0}}f.prototype.push=function(w,v){var A=this.strm,M=this.options.chunkSize,T,R;if(this.ended)return!1;R=v===~~v?v:v===!0?u:d,typeof w=="string"?A.input=s.string2buf(w):l.call(w)==="[object ArrayBuffer]"?A.input=new Uint8Array(w):A.input=w,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new i.Buf8(M),A.next_out=0,A.avail_out=M),T=n.deflate(A,R),T!==x&&T!==g)return this.onEnd(T),this.ended=!0,!1;(A.avail_out===0||A.avail_in===0&&(R===u||R===y))&&(this.options.to==="string"?this.onData(s.buf2binstring(i.shrinkBuf(A.output,A.next_out))):this.onData(i.shrinkBuf(A.output,A.next_out)))}while((A.avail_in>0||A.avail_out===0)&&T!==x);return R===u?(T=n.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===g):(R===y&&(this.onEnd(g),A.avail_out=0),!0)},f.prototype.onData=function(w){this.chunks.push(w)},f.prototype.onEnd=function(w){w===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg};function E(w,v){var A=new f(v);if(A.push(w,!0),A.err)throw A.msg||o[A.err];return A.result}function m(w,v){return v=v||{},v.raw=!0,E(w,v)}function S(w,v){return v=v||{},v.gzip=!0,E(w,v)}e.Deflate=f,e.deflate=E,e.deflateRaw=m,e.gzip=S}),"./node_modules/upng-js/node_modules/pako/lib/inflate.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),i=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),a=t("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),l=t("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),d=t("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),u=Object.prototype.toString;function g(b){if(!(this instanceof g))return new g(b);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},b||{});var _=this.options;_.raw&&_.windowBits>=0&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),_.windowBits>=0&&_.windowBits<16&&!(b&&b.windowBits)&&(_.windowBits+=32),_.windowBits>15&&_.windowBits<48&&(_.windowBits&15)===0&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var h=n.inflateInit2(this.strm,_.windowBits);if(h!==o.Z_OK)throw new Error(a[h]);if(this.header=new d,n.inflateGetHeader(this.strm,this.header),_.dictionary&&(typeof _.dictionary=="string"?_.dictionary=s.string2buf(_.dictionary):u.call(_.dictionary)==="[object ArrayBuffer]"&&(_.dictionary=new Uint8Array(_.dictionary)),_.raw&&(h=n.inflateSetDictionary(this.strm,_.dictionary),h!==o.Z_OK)))throw new Error(a[h])}g.prototype.push=function(b,_){var h=this.strm,f=this.options.chunkSize,E=this.options.dictionary,m,S,w,v,A,M=!1;if(this.ended)return!1;S=_===~~_?_:_===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof b=="string"?h.input=s.binstring2buf(b):u.call(b)==="[object ArrayBuffer]"?h.input=new Uint8Array(b):h.input=b,h.next_in=0,h.avail_in=h.input.length;do{if(h.avail_out===0&&(h.output=new i.Buf8(f),h.next_out=0,h.avail_out=f),m=n.inflate(h,o.Z_NO_FLUSH),m===o.Z_NEED_DICT&&E&&(m=n.inflateSetDictionary(this.strm,E)),m===o.Z_BUF_ERROR&&M===!0&&(m=o.Z_OK,M=!1),m!==o.Z_STREAM_END&&m!==o.Z_OK)return this.onEnd(m),this.ended=!0,!1;h.next_out&&(h.avail_out===0||m===o.Z_STREAM_END||h.avail_in===0&&(S===o.Z_FINISH||S===o.Z_SYNC_FLUSH))&&(this.options.to==="string"?(w=s.utf8border(h.output,h.next_out),v=h.next_out-w,A=s.buf2string(h.output,w),h.next_out=v,h.avail_out=f-v,v&&i.arraySet(h.output,h.output,w,v,0),this.onData(A)):this.onData(i.shrinkBuf(h.output,h.next_out))),h.avail_in===0&&h.avail_out===0&&(M=!0)}while((h.avail_in>0||h.avail_out===0)&&m!==o.Z_STREAM_END);return m===o.Z_STREAM_END&&(S=o.Z_FINISH),S===o.Z_FINISH?(m=n.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===o.Z_OK):(S===o.Z_SYNC_FLUSH&&(this.onEnd(o.Z_OK),h.avail_out=0),!0)},g.prototype.onData=function(b){this.chunks.push(b)},g.prototype.onEnd=function(b){b===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg};function x(b,_){var h=new g(_);if(h.push(b,!0),h.err)throw h.msg||a[h.err];return h.result}function y(b,_){return _=_||{},_.raw=!0,x(b,_)}e.Inflate=g,e.inflate=x,e.inflateRaw=y,e.ungzip=x}),"./node_modules/upng-js/node_modules/pako/lib/utils/common.js":((r,e)=>{var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function n(o,a){return Object.prototype.hasOwnProperty.call(o,a)}e.assign=function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var d in l)n(l,d)&&(o[d]=l[d])}}return o},e.shrinkBuf=function(o,a){return o.length===a?o:o.subarray?o.subarray(0,a):(o.length=a,o)};var i={arraySet:function(o,a,l,d,u){if(a.subarray&&o.subarray){o.set(a.subarray(l,l+d),u);return}for(var g=0;g<d;g++)o[u+g]=a[l+g]},flattenChunks:function(o){var a,l,d,u,g,x;for(d=0,a=0,l=o.length;a<l;a++)d+=o[a].length;for(x=new Uint8Array(d),u=0,a=0,l=o.length;a<l;a++)g=o[a],x.set(g,u),u+=g.length;return x}},s={arraySet:function(o,a,l,d,u){for(var g=0;g<d;g++)o[u+g]=a[l+g]},flattenChunks:function(o){return[].concat.apply([],o)}};e.setTyped=function(o){o?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,i)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(t)}),"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var o=new n.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;o[254]=o[254]=1,e.string2buf=function(d){var u,g,x,y,b,_=d.length,h=0;for(y=0;y<_;y++)g=d.charCodeAt(y),(g&64512)===55296&&y+1<_&&(x=d.charCodeAt(y+1),(x&64512)===56320&&(g=65536+(g-55296<<10)+(x-56320),y++)),h+=g<128?1:g<2048?2:g<65536?3:4;for(u=new n.Buf8(h),b=0,y=0;b<h;y++)g=d.charCodeAt(y),(g&64512)===55296&&y+1<_&&(x=d.charCodeAt(y+1),(x&64512)===56320&&(g=65536+(g-55296<<10)+(x-56320),y++)),g<128?u[b++]=g:g<2048?(u[b++]=192|g>>>6,u[b++]=128|g&63):g<65536?(u[b++]=224|g>>>12,u[b++]=128|g>>>6&63,u[b++]=128|g&63):(u[b++]=240|g>>>18,u[b++]=128|g>>>12&63,u[b++]=128|g>>>6&63,u[b++]=128|g&63);return u};function l(d,u){if(u<65534&&(d.subarray&&s||!d.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(d,u));for(var g="",x=0;x<u;x++)g+=String.fromCharCode(d[x]);return g}e.buf2binstring=function(d){return l(d,d.length)},e.binstring2buf=function(d){for(var u=new n.Buf8(d.length),g=0,x=u.length;g<x;g++)u[g]=d.charCodeAt(g);return u},e.buf2string=function(d,u){var g,x,y,b,_=u||d.length,h=new Array(_*2);for(x=0,g=0;g<_;){if(y=d[g++],y<128){h[x++]=y;continue}if(b=o[y],b>4){h[x++]=65533,g+=b-1;continue}for(y&=b===2?31:b===3?15:7;b>1&&g<_;)y=y<<6|d[g++]&63,b--;if(b>1){h[x++]=65533;continue}y<65536?h[x++]=y:(y-=65536,h[x++]=55296|y>>10&1023,h[x++]=56320|y&1023)}return l(h,x)},e.utf8border=function(d,u){var g;for(u=u||d.length,u>d.length&&(u=d.length),g=u-1;g>=0&&(d[g]&192)===128;)g--;return g<0||g===0?u:g+o[d[g]]>u?g:u}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js":(r=>{function e(t,n,i,s){for(var o=t&65535|0,a=t>>>16&65535|0,l=0;i!==0;){l=i>2e3?2e3:i,i-=l;do o=o+n[s++]|0,a=a+o|0;while(--l);o%=65521,a%=65521}return o|a<<16|0}r.exports=e}),"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js":(r=>{r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js":(r=>{function e(){for(var i,s=[],o=0;o<256;o++){i=o;for(var a=0;a<8;a++)i=i&1?3988292384^i>>>1:i>>>1;s[o]=i}return s}var t=e();function n(i,s,o,a){var l=t,d=a+o;i^=-1;for(var u=a;u<d;u++)i=i>>>8^l[(i^s[u])&255];return i^-1}r.exports=n}),"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=t("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),a=t("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),l=0,d=1,u=3,g=4,x=5,y=0,b=1,_=-2,h=-3,f=-5,E=-1,m=1,S=2,w=3,v=4,A=0,M=2,T=8,R=9,O=15,L=8,P=29,I=256,N=I+1+P,U=30,F=19,k=2*N+1,j=15,H=3,B=258,V=B+H+1,Y=32,K=42,J=69,Te=73,He=91,Q=103,Xe=113,ut=666,Ji=1,er=2,ec=3,ai=4,u0=3;function o0(W,e0){return W.msg=a[e0],e0}function E0(W){return(W<<1)-(W>4?9:0)}function F0(W){for(var e0=W.length;--e0>=0;)W[e0]=0}function g0(W){var e0=W.state,a0=e0.pending;a0>W.avail_out&&(a0=W.avail_out),a0!==0&&(n.arraySet(W.output,e0.pending_buf,e0.pending_out,a0,W.next_out),W.next_out+=a0,e0.pending_out+=a0,W.total_out+=a0,W.avail_out-=a0,e0.pending-=a0,e0.pending===0&&(e0.pending_out=0))}function w0(W,e0){i._tr_flush_block(W,W.block_start>=0?W.block_start:-1,W.strstart-W.block_start,e0),W.block_start=W.strstart,g0(W.strm)}function L0(W,e0){W.pending_buf[W.pending++]=e0}function T0(W,e0){W.pending_buf[W.pending++]=e0>>>8&255,W.pending_buf[W.pending++]=e0&255}function ht(W,e0,a0,hi){var p0=W.avail_in;return p0>hi&&(p0=hi),p0===0?0:(W.avail_in-=p0,n.arraySet(e0,W.input,W.next_in,p0,a0),W.state.wrap===1?W.adler=s(W.adler,e0,p0,a0):W.state.wrap===2&&(W.adler=o(W.adler,e0,p0,a0)),W.next_in+=p0,W.total_in+=p0,p0)}function We(W,e0){var a0=W.max_chain_length,hi=W.strstart,p0,O0,q=W.prev_length,it=W.nice_match,at=W.strstart>W.w_size-V?W.strstart-(W.w_size-V):0,t0=W.window,i0=W.w_mask,d0=W.prev,_0=W.strstart+B,S0=t0[hi+q-1],$0=t0[hi+q];W.prev_length>=W.good_match&&(a0>>=2),it>W.lookahead&&(it=W.lookahead);do if(p0=e0,!(t0[p0+q]!==$0||t0[p0+q-1]!==S0||t0[p0]!==t0[hi]||t0[++p0]!==t0[hi+1])){hi+=2,p0++;do;while(t0[++hi]===t0[++p0]&&t0[++hi]===t0[++p0]&&t0[++hi]===t0[++p0]&&t0[++hi]===t0[++p0]&&t0[++hi]===t0[++p0]&&t0[++hi]===t0[++p0]&&t0[++hi]===t0[++p0]&&t0[++hi]===t0[++p0]&&hi<_0);if(O0=B-(_0-hi),hi=_0-B,O0>q){if(W.match_start=e0,q=O0,O0>=it)break;S0=t0[hi+q-1],$0=t0[hi+q]}}while((e0=d0[e0&i0])>at&&--a0!==0);return q<=W.lookahead?q:W.lookahead}function h0(W){var e0=W.w_size,a0,hi,p0,O0,q;do{if(O0=W.window_size-W.lookahead-W.strstart,W.strstart>=e0+(e0-V)){n.arraySet(W.window,W.window,e0,e0,0),W.match_start-=e0,W.strstart-=e0,W.block_start-=e0,hi=W.hash_size,a0=hi;do p0=W.head[--a0],W.head[a0]=p0>=e0?p0-e0:0;while(--hi);hi=e0,a0=hi;do p0=W.prev[--a0],W.prev[a0]=p0>=e0?p0-e0:0;while(--hi);O0+=e0}if(W.strm.avail_in===0)break;if(hi=ht(W.strm,W.window,W.strstart+W.lookahead,O0),W.lookahead+=hi,W.lookahead+W.insert>=H)for(q=W.strstart-W.insert,W.ins_h=W.window[q],W.ins_h=(W.ins_h<<W.hash_shift^W.window[q+1])&W.hash_mask;W.insert&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[q+H-1])&W.hash_mask,W.prev[q&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=q,q++,W.insert--,!(W.lookahead+W.insert<H)););}while(W.lookahead<V&&W.strm.avail_in!==0)}function M0(W,e0){var a0=65535;for(a0>W.pending_buf_size-5&&(a0=W.pending_buf_size-5);;){if(W.lookahead<=1){if(h0(W),W.lookahead===0&&e0===l)return Ji;if(W.lookahead===0)break}W.strstart+=W.lookahead,W.lookahead=0;var hi=W.block_start+a0;if((W.strstart===0||W.strstart>=hi)&&(W.lookahead=W.strstart-hi,W.strstart=hi,w0(W,!1),W.strm.avail_out===0)||W.strstart-W.block_start>=W.w_size-V&&(w0(W,!1),W.strm.avail_out===0))return Ji}return W.insert=0,e0===g?(w0(W,!0),W.strm.avail_out===0?ec:ai):(W.strstart>W.block_start&&(w0(W,!1),W.strm.avail_out===0),Ji)}function Z(W,e0){for(var a0,hi;;){if(W.lookahead<V){if(h0(W),W.lookahead<V&&e0===l)return Ji;if(W.lookahead===0)break}if(a0=0,W.lookahead>=H&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+H-1])&W.hash_mask,a0=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),a0!==0&&W.strstart-a0<=W.w_size-V&&(W.match_length=We(W,a0)),W.match_length>=H)if(hi=i._tr_tally(W,W.strstart-W.match_start,W.match_length-H),W.lookahead-=W.match_length,W.match_length<=W.max_lazy_match&&W.lookahead>=H){W.match_length--;do W.strstart++,W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+H-1])&W.hash_mask,a0=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart;while(--W.match_length!==0);W.strstart++}else W.strstart+=W.match_length,W.match_length=0,W.ins_h=W.window[W.strstart],W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+1])&W.hash_mask;else hi=i._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++;if(hi&&(w0(W,!1),W.strm.avail_out===0))return Ji}return W.insert=W.strstart<H-1?W.strstart:H-1,e0===g?(w0(W,!0),W.strm.avail_out===0?ec:ai):W.last_lit&&(w0(W,!1),W.strm.avail_out===0)?Ji:er}function tt(W,e0){for(var a0,hi,p0;;){if(W.lookahead<V){if(h0(W),W.lookahead<V&&e0===l)return Ji;if(W.lookahead===0)break}if(a0=0,W.lookahead>=H&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+H-1])&W.hash_mask,a0=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),W.prev_length=W.match_length,W.prev_match=W.match_start,W.match_length=H-1,a0!==0&&W.prev_length<W.max_lazy_match&&W.strstart-a0<=W.w_size-V&&(W.match_length=We(W,a0),W.match_length<=5&&(W.strategy===m||W.match_length===H&&W.strstart-W.match_start>4096)&&(W.match_length=H-1)),W.prev_length>=H&&W.match_length<=W.prev_length){p0=W.strstart+W.lookahead-H,hi=i._tr_tally(W,W.strstart-1-W.prev_match,W.prev_length-H),W.lookahead-=W.prev_length-1,W.prev_length-=2;do++W.strstart<=p0&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+H-1])&W.hash_mask,a0=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart);while(--W.prev_length!==0);if(W.match_available=0,W.match_length=H-1,W.strstart++,hi&&(w0(W,!1),W.strm.avail_out===0))return Ji}else if(W.match_available){if(hi=i._tr_tally(W,0,W.window[W.strstart-1]),hi&&w0(W,!1),W.strstart++,W.lookahead--,W.strm.avail_out===0)return Ji}else W.match_available=1,W.strstart++,W.lookahead--}return W.match_available&&(hi=i._tr_tally(W,0,W.window[W.strstart-1]),W.match_available=0),W.insert=W.strstart<H-1?W.strstart:H-1,e0===g?(w0(W,!0),W.strm.avail_out===0?ec:ai):W.last_lit&&(w0(W,!1),W.strm.avail_out===0)?Ji:er}function tr(W,e0){for(var a0,hi,p0,O0,q=W.window;;){if(W.lookahead<=B){if(h0(W),W.lookahead<=B&&e0===l)return Ji;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=H&&W.strstart>0&&(p0=W.strstart-1,hi=q[p0],hi===q[++p0]&&hi===q[++p0]&&hi===q[++p0])){O0=W.strstart+B;do;while(hi===q[++p0]&&hi===q[++p0]&&hi===q[++p0]&&hi===q[++p0]&&hi===q[++p0]&&hi===q[++p0]&&hi===q[++p0]&&hi===q[++p0]&&p0<O0);W.match_length=B-(O0-p0),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=H?(a0=i._tr_tally(W,1,W.match_length-H),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(a0=i._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),a0&&(w0(W,!1),W.strm.avail_out===0))return Ji}return W.insert=0,e0===g?(w0(W,!0),W.strm.avail_out===0?ec:ai):W.last_lit&&(w0(W,!1),W.strm.avail_out===0)?Ji:er}function s0(W,e0){for(var a0;;){if(W.lookahead===0&&(h0(W),W.lookahead===0)){if(e0===l)return Ji;break}if(W.match_length=0,a0=i._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,a0&&(w0(W,!1),W.strm.avail_out===0))return Ji}return W.insert=0,e0===g?(w0(W,!0),W.strm.avail_out===0?ec:ai):W.last_lit&&(w0(W,!1),W.strm.avail_out===0)?Ji:er}function c0(W,e0,a0,hi,p0){this.good_length=W,this.max_lazy=e0,this.nice_length=a0,this.max_chain=hi,this.func=p0}var A0;A0=[new c0(0,0,0,0,M0),new c0(4,4,8,4,Z),new c0(4,5,16,8,Z),new c0(4,6,32,32,Z),new c0(4,4,16,16,tt),new c0(8,16,32,32,tt),new c0(8,16,128,128,tt),new c0(8,32,128,256,tt),new c0(32,128,258,1024,tt),new c0(32,258,258,4096,tt)];function P0(W){W.window_size=2*W.w_size,F0(W.head),W.max_lazy_match=A0[W.level].max_lazy,W.good_match=A0[W.level].good_length,W.nice_match=A0[W.level].nice_length,W.max_chain_length=A0[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=H-1,W.match_available=0,W.ins_h=0}function Fe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(k*2),this.dyn_dtree=new n.Buf16((2*U+1)*2),this.bl_tree=new n.Buf16((2*F+1)*2),F0(this.dyn_ltree),F0(this.dyn_dtree),F0(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(j+1),this.heap=new n.Buf16(2*N+1),F0(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*N+1),F0(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function f0(W){var e0;return!W||!W.state?o0(W,_):(W.total_in=W.total_out=0,W.data_type=M,e0=W.state,e0.pending=0,e0.pending_out=0,e0.wrap<0&&(e0.wrap=-e0.wrap),e0.status=e0.wrap?K:Xe,W.adler=e0.wrap===2?0:1,e0.last_flush=l,i._tr_init(e0),y)}function v0(W){var e0=f0(W);return e0===y&&P0(W.state),e0}function D0(W,e0){return!W||!W.state||W.state.wrap!==2?_:(W.state.gzhead=e0,y)}function l0(W,e0,a0,hi,p0,O0){if(!W)return _;var q=1;if(e0===E&&(e0=6),hi<0?(q=0,hi=-hi):hi>15&&(q=2,hi-=16),p0<1||p0>R||a0!==T||hi<8||hi>15||e0<0||e0>9||O0<0||O0>v)return o0(W,_);hi===8&&(hi=9);var it=new Fe;return W.state=it,it.strm=W,it.wrap=q,it.gzhead=null,it.w_bits=hi,it.w_size=1<<it.w_bits,it.w_mask=it.w_size-1,it.hash_bits=p0+7,it.hash_size=1<<it.hash_bits,it.hash_mask=it.hash_size-1,it.hash_shift=~~((it.hash_bits+H-1)/H),it.window=new n.Buf8(it.w_size*2),it.head=new n.Buf16(it.hash_size),it.prev=new n.Buf16(it.w_size),it.lit_bufsize=1<<p0+6,it.pending_buf_size=it.lit_bufsize*4,it.pending_buf=new n.Buf8(it.pending_buf_size),it.d_buf=1*it.lit_bufsize,it.l_buf=3*it.lit_bufsize,it.level=e0,it.strategy=O0,it.method=a0,v0(W)}function y0(W,e0){return l0(W,e0,T,O,L,A)}function lt(W,e0){var a0,hi,p0,O0;if(!W||!W.state||e0>x||e0<0)return W?o0(W,_):_;if(hi=W.state,!W.output||!W.input&&W.avail_in!==0||hi.status===ut&&e0!==g)return o0(W,W.avail_out===0?f:_);if(hi.strm=W,a0=hi.last_flush,hi.last_flush=e0,hi.status===K)if(hi.wrap===2)W.adler=0,L0(hi,31),L0(hi,139),L0(hi,8),hi.gzhead?(L0(hi,(hi.gzhead.text?1:0)+(hi.gzhead.hcrc?2:0)+(hi.gzhead.extra?4:0)+(hi.gzhead.name?8:0)+(hi.gzhead.comment?16:0)),L0(hi,hi.gzhead.time&255),L0(hi,hi.gzhead.time>>8&255),L0(hi,hi.gzhead.time>>16&255),L0(hi,hi.gzhead.time>>24&255),L0(hi,hi.level===9?2:hi.strategy>=S||hi.level<2?4:0),L0(hi,hi.gzhead.os&255),hi.gzhead.extra&&hi.gzhead.extra.length&&(L0(hi,hi.gzhead.extra.length&255),L0(hi,hi.gzhead.extra.length>>8&255)),hi.gzhead.hcrc&&(W.adler=o(W.adler,hi.pending_buf,hi.pending,0)),hi.gzindex=0,hi.status=J):(L0(hi,0),L0(hi,0),L0(hi,0),L0(hi,0),L0(hi,0),L0(hi,hi.level===9?2:hi.strategy>=S||hi.level<2?4:0),L0(hi,u0),hi.status=Xe);else{var q=T+(hi.w_bits-8<<4)<<8,it=-1;hi.strategy>=S||hi.level<2?it=0:hi.level<6?it=1:hi.level===6?it=2:it=3,q|=it<<6,hi.strstart!==0&&(q|=Y),q+=31-q%31,hi.status=Xe,T0(hi,q),hi.strstart!==0&&(T0(hi,W.adler>>>16),T0(hi,W.adler&65535)),W.adler=1}if(hi.status===J)if(hi.gzhead.extra){for(p0=hi.pending;hi.gzindex<(hi.gzhead.extra.length&65535)&&!(hi.pending===hi.pending_buf_size&&(hi.gzhead.hcrc&&hi.pending>p0&&(W.adler=o(W.adler,hi.pending_buf,hi.pending-p0,p0)),g0(W),p0=hi.pending,hi.pending===hi.pending_buf_size));)L0(hi,hi.gzhead.extra[hi.gzindex]&255),hi.gzindex++;hi.gzhead.hcrc&&hi.pending>p0&&(W.adler=o(W.adler,hi.pending_buf,hi.pending-p0,p0)),hi.gzindex===hi.gzhead.extra.length&&(hi.gzindex=0,hi.status=Te)}else hi.status=Te;if(hi.status===Te)if(hi.gzhead.name){p0=hi.pending;do{if(hi.pending===hi.pending_buf_size&&(hi.gzhead.hcrc&&hi.pending>p0&&(W.adler=o(W.adler,hi.pending_buf,hi.pending-p0,p0)),g0(W),p0=hi.pending,hi.pending===hi.pending_buf_size)){O0=1;break}hi.gzindex<hi.gzhead.name.length?O0=hi.gzhead.name.charCodeAt(hi.gzindex++)&255:O0=0,L0(hi,O0)}while(O0!==0);hi.gzhead.hcrc&&hi.pending>p0&&(W.adler=o(W.adler,hi.pending_buf,hi.pending-p0,p0)),O0===0&&(hi.gzindex=0,hi.status=He)}else hi.status=He;if(hi.status===He)if(hi.gzhead.comment){p0=hi.pending;do{if(hi.pending===hi.pending_buf_size&&(hi.gzhead.hcrc&&hi.pending>p0&&(W.adler=o(W.adler,hi.pending_buf,hi.pending-p0,p0)),g0(W),p0=hi.pending,hi.pending===hi.pending_buf_size)){O0=1;break}hi.gzindex<hi.gzhead.comment.length?O0=hi.gzhead.comment.charCodeAt(hi.gzindex++)&255:O0=0,L0(hi,O0)}while(O0!==0);hi.gzhead.hcrc&&hi.pending>p0&&(W.adler=o(W.adler,hi.pending_buf,hi.pending-p0,p0)),O0===0&&(hi.status=Q)}else hi.status=Q;if(hi.status===Q&&(hi.gzhead.hcrc?(hi.pending+2>hi.pending_buf_size&&g0(W),hi.pending+2<=hi.pending_buf_size&&(L0(hi,W.adler&255),L0(hi,W.adler>>8&255),W.adler=0,hi.status=Xe)):hi.status=Xe),hi.pending!==0){if(g0(W),W.avail_out===0)return hi.last_flush=-1,y}else if(W.avail_in===0&&E0(e0)<=E0(a0)&&e0!==g)return o0(W,f);if(hi.status===ut&&W.avail_in!==0)return o0(W,f);if(W.avail_in!==0||hi.lookahead!==0||e0!==l&&hi.status!==ut){var at=hi.strategy===S?s0(hi,e0):hi.strategy===w?tr(hi,e0):A0[hi.level].func(hi,e0);if((at===ec||at===ai)&&(hi.status=ut),at===Ji||at===ec)return W.avail_out===0&&(hi.last_flush=-1),y;if(at===er&&(e0===d?i._tr_align(hi):e0!==x&&(i._tr_stored_block(hi,0,0,!1),e0===u&&(F0(hi.head),hi.lookahead===0&&(hi.strstart=0,hi.block_start=0,hi.insert=0))),g0(W),W.avail_out===0))return hi.last_flush=-1,y}return e0!==g?y:hi.wrap<=0?b:(hi.wrap===2?(L0(hi,W.adler&255),L0(hi,W.adler>>8&255),L0(hi,W.adler>>16&255),L0(hi,W.adler>>24&255),L0(hi,W.total_in&255),L0(hi,W.total_in>>8&255),L0(hi,W.total_in>>16&255),L0(hi,W.total_in>>24&255)):(T0(hi,W.adler>>>16),T0(hi,W.adler&65535)),g0(W),hi.wrap>0&&(hi.wrap=-hi.wrap),hi.pending!==0?y:b)}function oi(W){var e0;return!W||!W.state?_:(e0=W.state.status,e0!==K&&e0!==J&&e0!==Te&&e0!==He&&e0!==Q&&e0!==Xe&&e0!==ut?o0(W,_):(W.state=null,e0===Xe?o0(W,h):y))}function b0(W,e0){var a0=e0.length,hi,p0,O0,q,it,at,t0,i0;if(!W||!W.state||(hi=W.state,q=hi.wrap,q===2||q===1&&hi.status!==K||hi.lookahead))return _;for(q===1&&(W.adler=s(W.adler,e0,a0,0)),hi.wrap=0,a0>=hi.w_size&&(q===0&&(F0(hi.head),hi.strstart=0,hi.block_start=0,hi.insert=0),i0=new n.Buf8(hi.w_size),n.arraySet(i0,e0,a0-hi.w_size,hi.w_size,0),e0=i0,a0=hi.w_size),it=W.avail_in,at=W.next_in,t0=W.input,W.avail_in=a0,W.next_in=0,W.input=e0,h0(hi);hi.lookahead>=H;){p0=hi.strstart,O0=hi.lookahead-(H-1);do hi.ins_h=(hi.ins_h<<hi.hash_shift^hi.window[p0+H-1])&hi.hash_mask,hi.prev[p0&hi.w_mask]=hi.head[hi.ins_h],hi.head[hi.ins_h]=p0,p0++;while(--O0);hi.strstart=p0,hi.lookahead=H-1,h0(hi)}return hi.strstart+=hi.lookahead,hi.block_start=hi.strstart,hi.insert=hi.lookahead,hi.lookahead=0,hi.match_length=hi.prev_length=H-1,hi.match_available=0,W.next_in=at,W.input=t0,W.avail_in=it,hi.wrap=q,y}e.deflateInit=y0,e.deflateInit2=l0,e.deflateReset=v0,e.deflateResetKeep=f0,e.deflateSetHeader=D0,e.deflate=lt,e.deflateEnd=oi,e.deflateSetDictionary=b0,e.deflateInfo="pako deflate (from Nodeca project)"}),"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js":(r=>{function e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}r.exports=e}),"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js":(r=>{var e=30,t=12;r.exports=function(i,s){var o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R,O,L,P,I;o=i.state,a=i.next_in,P=i.input,l=a+(i.avail_in-5),d=i.next_out,I=i.output,u=d-(s-i.avail_out),g=d+(i.avail_out-257),x=o.dmax,y=o.wsize,b=o.whave,_=o.wnext,h=o.window,f=o.hold,E=o.bits,m=o.lencode,S=o.distcode,w=(1<<o.lenbits)-1,v=(1<<o.distbits)-1;e:do{E<15&&(f+=P[a++]<<E,E+=8,f+=P[a++]<<E,E+=8),A=m[f&w];t:for(;;){if(M=A>>>24,f>>>=M,E-=M,M=A>>>16&255,M===0)I[d++]=A&65535;else if(M&16){T=A&65535,M&=15,M&&(E<M&&(f+=P[a++]<<E,E+=8),T+=f&(1<<M)-1,f>>>=M,E-=M),E<15&&(f+=P[a++]<<E,E+=8,f+=P[a++]<<E,E+=8),A=S[f&v];n:for(;;){if(M=A>>>24,f>>>=M,E-=M,M=A>>>16&255,M&16){if(R=A&65535,M&=15,E<M&&(f+=P[a++]<<E,E+=8,E<M&&(f+=P[a++]<<E,E+=8)),R+=f&(1<<M)-1,R>x){i.msg="invalid distance too far back",o.mode=e;break e}if(f>>>=M,E-=M,M=d-u,R>M){if(M=R-M,M>b&&o.sane){i.msg="invalid distance too far back",o.mode=e;break e}if(O=0,L=h,_===0){if(O+=y-M,M<T){T-=M;do I[d++]=h[O++];while(--M);O=d-R,L=I}}else if(_<M){if(O+=y+_-M,M-=_,M<T){T-=M;do I[d++]=h[O++];while(--M);if(O=0,_<T){M=_,T-=M;do I[d++]=h[O++];while(--M);O=d-R,L=I}}}else if(O+=_-M,M<T){T-=M;do I[d++]=h[O++];while(--M);O=d-R,L=I}for(;T>2;)I[d++]=L[O++],I[d++]=L[O++],I[d++]=L[O++],T-=3;T&&(I[d++]=L[O++],T>1&&(I[d++]=L[O++]))}else{O=d-R;do I[d++]=I[O++],I[d++]=I[O++],I[d++]=I[O++],T-=3;while(T>2);T&&(I[d++]=I[O++],T>1&&(I[d++]=I[O++]))}}else if((M&64)===0){A=S[(A&65535)+(f&(1<<M)-1)];continue n}else{i.msg="invalid distance code",o.mode=e;break e}break}}else if((M&64)===0){A=m[(A&65535)+(f&(1<<M)-1)];continue t}else if(M&32){o.mode=t;break e}else{i.msg="invalid literal/length code",o.mode=e;break e}break}}while(a<l&&d<g);T=E>>3,a-=T,E-=T<<3,f&=(1<<E)-1,i.next_in=a,i.next_out=d,i.avail_in=a<l?5+(l-a):5-(a-l),i.avail_out=d<g?257+(g-d):257-(d-g),o.hold=f,o.bits=E}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=t("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),a=t("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),l=0,d=1,u=2,g=4,x=5,y=6,b=0,_=1,h=2,f=-2,E=-3,m=-4,S=-5,w=8,v=1,A=2,M=3,T=4,R=5,O=6,L=7,P=8,I=9,N=10,U=11,F=12,k=13,j=14,H=15,B=16,V=17,Y=18,K=19,J=20,Te=21,He=22,Q=23,Xe=24,ut=25,Ji=26,er=27,ec=28,ai=29,u0=30,o0=31,E0=32,F0=852,g0=592,w0=15,L0=w0;function T0(l0){return(l0>>>24&255)+(l0>>>8&65280)+((l0&65280)<<8)+((l0&255)<<24)}function ht(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function We(l0){var y0;return!l0||!l0.state?f:(y0=l0.state,l0.total_in=l0.total_out=y0.total=0,l0.msg="",y0.wrap&&(l0.adler=y0.wrap&1),y0.mode=v,y0.last=0,y0.havedict=0,y0.dmax=32768,y0.head=null,y0.hold=0,y0.bits=0,y0.lencode=y0.lendyn=new n.Buf32(F0),y0.distcode=y0.distdyn=new n.Buf32(g0),y0.sane=1,y0.back=-1,b)}function h0(l0){var y0;return!l0||!l0.state?f:(y0=l0.state,y0.wsize=0,y0.whave=0,y0.wnext=0,We(l0))}function M0(l0,y0){var lt,oi;return!l0||!l0.state||(oi=l0.state,y0<0?(lt=0,y0=-y0):(lt=(y0>>4)+1,y0<48&&(y0&=15)),y0&&(y0<8||y0>15))?f:(oi.window!==null&&oi.wbits!==y0&&(oi.window=null),oi.wrap=lt,oi.wbits=y0,h0(l0))}function Z(l0,y0){var lt,oi;return l0?(oi=new ht,l0.state=oi,oi.window=null,lt=M0(l0,y0),lt!==b&&(l0.state=null),lt):f}function tt(l0){return Z(l0,L0)}var tr=!0,s0,c0;function A0(l0){if(tr){var y0;for(s0=new n.Buf32(512),c0=new n.Buf32(32),y0=0;y0<144;)l0.lens[y0++]=8;for(;y0<256;)l0.lens[y0++]=9;for(;y0<280;)l0.lens[y0++]=7;for(;y0<288;)l0.lens[y0++]=8;for(a(d,l0.lens,0,288,s0,0,l0.work,{bits:9}),y0=0;y0<32;)l0.lens[y0++]=5;a(u,l0.lens,0,32,c0,0,l0.work,{bits:5}),tr=!1}l0.lencode=s0,l0.lenbits=9,l0.distcode=c0,l0.distbits=5}function P0(l0,y0,lt,oi){var b0,W=l0.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new n.Buf8(W.wsize)),oi>=W.wsize?(n.arraySet(W.window,y0,lt-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(b0=W.wsize-W.wnext,b0>oi&&(b0=oi),n.arraySet(W.window,y0,lt-oi,b0,W.wnext),oi-=b0,oi?(n.arraySet(W.window,y0,lt-oi,oi,0),W.wnext=oi,W.whave=W.wsize):(W.wnext+=b0,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=b0))),0}function Fe(l0,y0){var lt,oi,b0,W,e0,a0,hi,p0,O0,q,it,at,t0,i0,d0=0,_0,S0,$0,K0,n1,c1,J0,Z0,Hm=new n.Buf8(4),C0,z0,B0=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!l0||!l0.state||!l0.output||!l0.input&&l0.avail_in!==0)return f;lt=l0.state,lt.mode===F&&(lt.mode=k),e0=l0.next_out,b0=l0.output,hi=l0.avail_out,W=l0.next_in,oi=l0.input,a0=l0.avail_in,p0=lt.hold,O0=lt.bits,q=a0,it=hi,Z0=b;e:for(;;)switch(lt.mode){case v:if(lt.wrap===0){lt.mode=k;break}for(;O0<16;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if(lt.wrap&2&&p0===35615){lt.check=0,Hm[0]=p0&255,Hm[1]=p0>>>8&255,lt.check=s(lt.check,Hm,2,0),p0=0,O0=0,lt.mode=A;break}if(lt.flags=0,lt.head&&(lt.head.done=!1),!(lt.wrap&1)||(((p0&255)<<8)+(p0>>8))%31){l0.msg="incorrect header check",lt.mode=u0;break}if((p0&15)!==w){l0.msg="unknown compression method",lt.mode=u0;break}if(p0>>>=4,O0-=4,J0=(p0&15)+8,lt.wbits===0)lt.wbits=J0;else if(J0>lt.wbits){l0.msg="invalid window size",lt.mode=u0;break}lt.dmax=1<<J0,l0.adler=lt.check=1,lt.mode=p0&512?N:F,p0=0,O0=0;break;case A:for(;O0<16;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if(lt.flags=p0,(lt.flags&255)!==w){l0.msg="unknown compression method",lt.mode=u0;break}if(lt.flags&57344){l0.msg="unknown header flags set",lt.mode=u0;break}lt.head&&(lt.head.text=p0>>8&1),lt.flags&512&&(Hm[0]=p0&255,Hm[1]=p0>>>8&255,lt.check=s(lt.check,Hm,2,0)),p0=0,O0=0,lt.mode=M;case M:for(;O0<32;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}lt.head&&(lt.head.time=p0),lt.flags&512&&(Hm[0]=p0&255,Hm[1]=p0>>>8&255,Hm[2]=p0>>>16&255,Hm[3]=p0>>>24&255,lt.check=s(lt.check,Hm,4,0)),p0=0,O0=0,lt.mode=T;case T:for(;O0<16;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}lt.head&&(lt.head.xflags=p0&255,lt.head.os=p0>>8),lt.flags&512&&(Hm[0]=p0&255,Hm[1]=p0>>>8&255,lt.check=s(lt.check,Hm,2,0)),p0=0,O0=0,lt.mode=R;case R:if(lt.flags&1024){for(;O0<16;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}lt.length=p0,lt.head&&(lt.head.extra_len=p0),lt.flags&512&&(Hm[0]=p0&255,Hm[1]=p0>>>8&255,lt.check=s(lt.check,Hm,2,0)),p0=0,O0=0}else lt.head&&(lt.head.extra=null);lt.mode=O;case O:if(lt.flags&1024&&(at=lt.length,at>a0&&(at=a0),at&&(lt.head&&(J0=lt.head.extra_len-lt.length,lt.head.extra||(lt.head.extra=new Array(lt.head.extra_len)),n.arraySet(lt.head.extra,oi,W,at,J0)),lt.flags&512&&(lt.check=s(lt.check,oi,at,W)),a0-=at,W+=at,lt.length-=at),lt.length))break e;lt.length=0,lt.mode=L;case L:if(lt.flags&2048){if(a0===0)break e;at=0;do J0=oi[W+at++],lt.head&&J0&&lt.length<65536&&(lt.head.name+=String.fromCharCode(J0));while(J0&&at<a0);if(lt.flags&512&&(lt.check=s(lt.check,oi,at,W)),a0-=at,W+=at,J0)break e}else lt.head&&(lt.head.name=null);lt.length=0,lt.mode=P;case P:if(lt.flags&4096){if(a0===0)break e;at=0;do J0=oi[W+at++],lt.head&&J0&&lt.length<65536&&(lt.head.comment+=String.fromCharCode(J0));while(J0&&at<a0);if(lt.flags&512&&(lt.check=s(lt.check,oi,at,W)),a0-=at,W+=at,J0)break e}else lt.head&&(lt.head.comment=null);lt.mode=I;case I:if(lt.flags&512){for(;O0<16;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if(p0!==(lt.check&65535)){l0.msg="header crc mismatch",lt.mode=u0;break}p0=0,O0=0}lt.head&&(lt.head.hcrc=lt.flags>>9&1,lt.head.done=!0),l0.adler=lt.check=0,lt.mode=F;break;case N:for(;O0<32;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}l0.adler=lt.check=T0(p0),p0=0,O0=0,lt.mode=U;case U:if(lt.havedict===0)return l0.next_out=e0,l0.avail_out=hi,l0.next_in=W,l0.avail_in=a0,lt.hold=p0,lt.bits=O0,h;l0.adler=lt.check=1,lt.mode=F;case F:if(y0===x||y0===y)break e;case k:if(lt.last){p0>>>=O0&7,O0-=O0&7,lt.mode=er;break}for(;O0<3;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}switch(lt.last=p0&1,p0>>>=1,O0-=1,p0&3){case 0:lt.mode=j;break;case 1:if(A0(lt),lt.mode=J,y0===y){p0>>>=2,O0-=2;break e}break;case 2:lt.mode=V;break;case 3:l0.msg="invalid block type",lt.mode=u0}p0>>>=2,O0-=2;break;case j:for(p0>>>=O0&7,O0-=O0&7;O0<32;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if((p0&65535)!==(p0>>>16^65535)){l0.msg="invalid stored block lengths",lt.mode=u0;break}if(lt.length=p0&65535,p0=0,O0=0,lt.mode=H,y0===y)break e;case H:lt.mode=B;case B:if(at=lt.length,at){if(at>a0&&(at=a0),at>hi&&(at=hi),at===0)break e;n.arraySet(b0,oi,W,at,e0),a0-=at,W+=at,hi-=at,e0+=at,lt.length-=at;break}lt.mode=F;break;case V:for(;O0<14;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if(lt.nlen=(p0&31)+257,p0>>>=5,O0-=5,lt.ndist=(p0&31)+1,p0>>>=5,O0-=5,lt.ncode=(p0&15)+4,p0>>>=4,O0-=4,lt.nlen>286||lt.ndist>30){l0.msg="too many length or distance symbols",lt.mode=u0;break}lt.have=0,lt.mode=Y;case Y:for(;lt.have<lt.ncode;){for(;O0<3;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}lt.lens[B0[lt.have++]]=p0&7,p0>>>=3,O0-=3}for(;lt.have<19;)lt.lens[B0[lt.have++]]=0;if(lt.lencode=lt.lendyn,lt.lenbits=7,C0={bits:lt.lenbits},Z0=a(l,lt.lens,0,19,lt.lencode,0,lt.work,C0),lt.lenbits=C0.bits,Z0){l0.msg="invalid code lengths set",lt.mode=u0;break}lt.have=0,lt.mode=K;case K:for(;lt.have<lt.nlen+lt.ndist;){for(;d0=lt.lencode[p0&(1<<lt.lenbits)-1],_0=d0>>>24,S0=d0>>>16&255,$0=d0&65535,!(_0<=O0);){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if($0<16)p0>>>=_0,O0-=_0,lt.lens[lt.have++]=$0;else{if($0===16){for(z0=_0+2;O0<z0;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if(p0>>>=_0,O0-=_0,lt.have===0){l0.msg="invalid bit length repeat",lt.mode=u0;break}J0=lt.lens[lt.have-1],at=3+(p0&3),p0>>>=2,O0-=2}else if($0===17){for(z0=_0+3;O0<z0;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}p0>>>=_0,O0-=_0,J0=0,at=3+(p0&7),p0>>>=3,O0-=3}else{for(z0=_0+7;O0<z0;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}p0>>>=_0,O0-=_0,J0=0,at=11+(p0&127),p0>>>=7,O0-=7}if(lt.have+at>lt.nlen+lt.ndist){l0.msg="invalid bit length repeat",lt.mode=u0;break}for(;at--;)lt.lens[lt.have++]=J0}}if(lt.mode===u0)break;if(lt.lens[256]===0){l0.msg="invalid code -- missing end-of-block",lt.mode=u0;break}if(lt.lenbits=9,C0={bits:lt.lenbits},Z0=a(d,lt.lens,0,lt.nlen,lt.lencode,0,lt.work,C0),lt.lenbits=C0.bits,Z0){l0.msg="invalid literal/lengths set",lt.mode=u0;break}if(lt.distbits=6,lt.distcode=lt.distdyn,C0={bits:lt.distbits},Z0=a(u,lt.lens,lt.nlen,lt.ndist,lt.distcode,0,lt.work,C0),lt.distbits=C0.bits,Z0){l0.msg="invalid distances set",lt.mode=u0;break}if(lt.mode=J,y0===y)break e;case J:lt.mode=Te;case Te:if(a0>=6&&hi>=258){l0.next_out=e0,l0.avail_out=hi,l0.next_in=W,l0.avail_in=a0,lt.hold=p0,lt.bits=O0,o(l0,it),e0=l0.next_out,b0=l0.output,hi=l0.avail_out,W=l0.next_in,oi=l0.input,a0=l0.avail_in,p0=lt.hold,O0=lt.bits,lt.mode===F&&(lt.back=-1);break}for(lt.back=0;d0=lt.lencode[p0&(1<<lt.lenbits)-1],_0=d0>>>24,S0=d0>>>16&255,$0=d0&65535,!(_0<=O0);){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if(S0&&(S0&240)===0){for(K0=_0,n1=S0,c1=$0;d0=lt.lencode[c1+((p0&(1<<K0+n1)-1)>>K0)],_0=d0>>>24,S0=d0>>>16&255,$0=d0&65535,!(K0+_0<=O0);){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}p0>>>=K0,O0-=K0,lt.back+=K0}if(p0>>>=_0,O0-=_0,lt.back+=_0,lt.length=$0,S0===0){lt.mode=Ji;break}if(S0&32){lt.back=-1,lt.mode=F;break}if(S0&64){l0.msg="invalid literal/length code",lt.mode=u0;break}lt.extra=S0&15,lt.mode=He;case He:if(lt.extra){for(z0=lt.extra;O0<z0;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}lt.length+=p0&(1<<lt.extra)-1,p0>>>=lt.extra,O0-=lt.extra,lt.back+=lt.extra}lt.was=lt.length,lt.mode=Q;case Q:for(;d0=lt.distcode[p0&(1<<lt.distbits)-1],_0=d0>>>24,S0=d0>>>16&255,$0=d0&65535,!(_0<=O0);){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if((S0&240)===0){for(K0=_0,n1=S0,c1=$0;d0=lt.distcode[c1+((p0&(1<<K0+n1)-1)>>K0)],_0=d0>>>24,S0=d0>>>16&255,$0=d0&65535,!(K0+_0<=O0);){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}p0>>>=K0,O0-=K0,lt.back+=K0}if(p0>>>=_0,O0-=_0,lt.back+=_0,S0&64){l0.msg="invalid distance code",lt.mode=u0;break}lt.offset=$0,lt.extra=S0&15,lt.mode=Xe;case Xe:if(lt.extra){for(z0=lt.extra;O0<z0;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}lt.offset+=p0&(1<<lt.extra)-1,p0>>>=lt.extra,O0-=lt.extra,lt.back+=lt.extra}if(lt.offset>lt.dmax){l0.msg="invalid distance too far back",lt.mode=u0;break}lt.mode=ut;case ut:if(hi===0)break e;if(at=it-hi,lt.offset>at){if(at=lt.offset-at,at>lt.whave&&lt.sane){l0.msg="invalid distance too far back",lt.mode=u0;break}at>lt.wnext?(at-=lt.wnext,t0=lt.wsize-at):t0=lt.wnext-at,at>lt.length&&(at=lt.length),i0=lt.window}else i0=b0,t0=e0-lt.offset,at=lt.length;at>hi&&(at=hi),hi-=at,lt.length-=at;do b0[e0++]=i0[t0++];while(--at);lt.length===0&&(lt.mode=Te);break;case Ji:if(hi===0)break e;b0[e0++]=lt.length,hi--,lt.mode=Te;break;case er:if(lt.wrap){for(;O0<32;){if(a0===0)break e;a0--,p0|=oi[W++]<<O0,O0+=8}if(it-=hi,l0.total_out+=it,lt.total+=it,it&&(l0.adler=lt.check=lt.flags?s(lt.check,b0,it,e0-it):i(lt.check,b0,it,e0-it)),it=hi,(lt.flags?p0:T0(p0))!==lt.check){l0.msg="incorrect data check",lt.mode=u0;break}p0=0,O0=0}lt.mode=ec;case ec:if(lt.wrap&&lt.flags){for(;O0<32;){if(a0===0)break e;a0--,p0+=oi[W++]<<O0,O0+=8}if(p0!==(lt.total&4294967295)){l0.msg="incorrect length check",lt.mode=u0;break}p0=0,O0=0}lt.mode=ai;case ai:Z0=_;break e;case u0:Z0=E;break e;case o0:return m;case E0:default:return f}return l0.next_out=e0,l0.avail_out=hi,l0.next_in=W,l0.avail_in=a0,lt.hold=p0,lt.bits=O0,(lt.wsize||it!==l0.avail_out&&lt.mode<u0&&(lt.mode<er||y0!==g))&&P0(l0,l0.output,l0.next_out,it-l0.avail_out),q-=l0.avail_in,it-=l0.avail_out,l0.total_in+=q,l0.total_out+=it,lt.total+=it,lt.wrap&&it&&(l0.adler=lt.check=lt.flags?s(lt.check,b0,it,l0.next_out-it):i(lt.check,b0,it,l0.next_out-it)),l0.data_type=lt.bits+(lt.last?64:0)+(lt.mode===F?128:0)+(lt.mode===J||lt.mode===H?256:0),(q===0&&it===0||y0===g)&&Z0===b&&(Z0=S),Z0}function f0(l0){if(!l0||!l0.state)return f;var y0=l0.state;return y0.window&&(y0.window=null),l0.state=null,b}function v0(l0,y0){var lt;return!l0||!l0.state||(lt=l0.state,(lt.wrap&2)===0)?f:(lt.head=y0,y0.done=!1,b)}function D0(l0,y0){var lt=y0.length,oi,b0,W;return!l0||!l0.state||(oi=l0.state,oi.wrap!==0&&oi.mode!==U)?f:oi.mode===U&&(b0=1,b0=i(b0,y0,lt,0),b0!==oi.check)?E:(W=P0(l0,y0,lt,lt),W?(oi.mode=o0,m):(oi.havedict=1,b))}e.inflateReset=h0,e.inflateReset2=M0,e.inflateResetKeep=We,e.inflateInit=tt,e.inflateInit2=Z,e.inflate=Fe,e.inflateEnd=f0,e.inflateGetHeader=v0,e.inflateSetDictionary=D0,e.inflateInfo="pako inflate (from Nodeca project)"}),"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=15,s=852,o=592,a=0,l=1,d=2,u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],g=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(_,h,f,E,m,S,w,v){var A=v.bits,M=0,T=0,R=0,O=0,L=0,P=0,I=0,N=0,U=0,F=0,k,j,H,B,V,Y=null,K=0,J,Te=new n.Buf16(i+1),He=new n.Buf16(i+1),Q=null,Xe=0,ut,Ji,er;for(M=0;M<=i;M++)Te[M]=0;for(T=0;T<E;T++)Te[h[f+T]]++;for(L=A,O=i;O>=1&&Te[O]===0;O--);if(L>O&&(L=O),O===0)return m[S++]=20971520,m[S++]=20971520,v.bits=1,0;for(R=1;R<O&&Te[R]===0;R++);for(L<R&&(L=R),N=1,M=1;M<=i;M++)if(N<<=1,N-=Te[M],N<0)return-1;if(N>0&&(_===a||O!==1))return-1;for(He[1]=0,M=1;M<i;M++)He[M+1]=He[M]+Te[M];for(T=0;T<E;T++)h[f+T]!==0&&(w[He[h[f+T]]++]=T);if(_===a?(Y=Q=w,J=19):_===l?(Y=u,K-=257,Q=g,Xe-=257,J=256):(Y=x,Q=y,J=-1),F=0,T=0,M=R,V=S,P=L,I=0,H=-1,U=1<<L,B=U-1,_===l&&U>s||_===d&&U>o)return 1;for(;;){ut=M-I,w[T]<J?(Ji=0,er=w[T]):w[T]>J?(Ji=Q[Xe+w[T]],er=Y[K+w[T]]):(Ji=96,er=0),k=1<<M-I,j=1<<P,R=j;do j-=k,m[V+(F>>I)+j]=ut<<24|Ji<<16|er|0;while(j!==0);for(k=1<<M-1;F&k;)k>>=1;if(k!==0?(F&=k-1,F+=k):F=0,T++,--Te[M]===0){if(M===O)break;M=h[f+w[T]]}if(M>L&&(F&B)!==H){for(I===0&&(I=L),V+=R,P=M-I,N=1<<P;P+I<O&&(N-=Te[P+I],!(N<=0));)P++,N<<=1;if(U+=1<<P,_===l&&U>s||_===d&&U>o)return 1;H=F&B,m[H]=L<<24|P<<16|V-S|0}}return F!==0&&(m[V+F]=M-I<<24|4194304|0),v.bits=L,0}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js":(r=>{r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=4,s=0,o=1,a=2;function l(Fe){for(var f0=Fe.length;--f0>=0;)Fe[f0]=0}var d=0,u=1,g=2,x=3,y=258,b=29,_=256,h=_+1+b,f=30,E=19,m=2*h+1,S=15,w=16,v=7,A=256,M=16,T=17,R=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N=512,U=new Array((h+2)*2);l(U);var F=new Array(f*2);l(F);var k=new Array(N);l(k);var j=new Array(y-x+1);l(j);var H=new Array(b);l(H);var B=new Array(f);l(B);function V(Fe,f0,v0,D0,l0){this.static_tree=Fe,this.extra_bits=f0,this.extra_base=v0,this.elems=D0,this.max_length=l0,this.has_stree=Fe&&Fe.length}var Y,K,J;function Te(Fe,f0){this.dyn_tree=Fe,this.max_code=0,this.stat_desc=f0}function He(Fe){return Fe<256?k[Fe]:k[256+(Fe>>>7)]}function Q(Fe,f0){Fe.pending_buf[Fe.pending++]=f0&255,Fe.pending_buf[Fe.pending++]=f0>>>8&255}function Xe(Fe,f0,v0){Fe.bi_valid>w-v0?(Fe.bi_buf|=f0<<Fe.bi_valid&65535,Q(Fe,Fe.bi_buf),Fe.bi_buf=f0>>w-Fe.bi_valid,Fe.bi_valid+=v0-w):(Fe.bi_buf|=f0<<Fe.bi_valid&65535,Fe.bi_valid+=v0)}function ut(Fe,f0,v0){Xe(Fe,v0[f0*2],v0[f0*2+1])}function Ji(Fe,f0){var v0=0;do v0|=Fe&1,Fe>>>=1,v0<<=1;while(--f0>0);return v0>>>1}function er(Fe){Fe.bi_valid===16?(Q(Fe,Fe.bi_buf),Fe.bi_buf=0,Fe.bi_valid=0):Fe.bi_valid>=8&&(Fe.pending_buf[Fe.pending++]=Fe.bi_buf&255,Fe.bi_buf>>=8,Fe.bi_valid-=8)}function ec(Fe,f0){var v0=f0.dyn_tree,D0=f0.max_code,l0=f0.stat_desc.static_tree,y0=f0.stat_desc.has_stree,lt=f0.stat_desc.extra_bits,oi=f0.stat_desc.extra_base,b0=f0.stat_desc.max_length,W,e0,a0,hi,p0,O0,q=0;for(hi=0;hi<=S;hi++)Fe.bl_count[hi]=0;for(v0[Fe.heap[Fe.heap_max]*2+1]=0,W=Fe.heap_max+1;W<m;W++)e0=Fe.heap[W],hi=v0[v0[e0*2+1]*2+1]+1,hi>b0&&(hi=b0,q++),v0[e0*2+1]=hi,!(e0>D0)&&(Fe.bl_count[hi]++,p0=0,e0>=oi&&(p0=lt[e0-oi]),O0=v0[e0*2],Fe.opt_len+=O0*(hi+p0),y0&&(Fe.static_len+=O0*(l0[e0*2+1]+p0)));if(q!==0){do{for(hi=b0-1;Fe.bl_count[hi]===0;)hi--;Fe.bl_count[hi]--,Fe.bl_count[hi+1]+=2,Fe.bl_count[b0]--,q-=2}while(q>0);for(hi=b0;hi!==0;hi--)for(e0=Fe.bl_count[hi];e0!==0;)a0=Fe.heap[--W],!(a0>D0)&&(v0[a0*2+1]!==hi&&(Fe.opt_len+=(hi-v0[a0*2+1])*v0[a0*2],v0[a0*2+1]=hi),e0--)}}function ai(Fe,f0,v0){var D0=new Array(S+1),l0=0,y0,lt;for(y0=1;y0<=S;y0++)D0[y0]=l0=l0+v0[y0-1]<<1;for(lt=0;lt<=f0;lt++){var oi=Fe[lt*2+1];oi!==0&&(Fe[lt*2]=Ji(D0[oi]++,oi))}}function u0(){var Fe,f0,v0,D0,l0,y0=new Array(S+1);for(v0=0,D0=0;D0<b-1;D0++)for(H[D0]=v0,Fe=0;Fe<1<<O[D0];Fe++)j[v0++]=D0;for(j[v0-1]=D0,l0=0,D0=0;D0<16;D0++)for(B[D0]=l0,Fe=0;Fe<1<<L[D0];Fe++)k[l0++]=D0;for(l0>>=7;D0<f;D0++)for(B[D0]=l0<<7,Fe=0;Fe<1<<L[D0]-7;Fe++)k[256+l0++]=D0;for(f0=0;f0<=S;f0++)y0[f0]=0;for(Fe=0;Fe<=143;)U[Fe*2+1]=8,Fe++,y0[8]++;for(;Fe<=255;)U[Fe*2+1]=9,Fe++,y0[9]++;for(;Fe<=279;)U[Fe*2+1]=7,Fe++,y0[7]++;for(;Fe<=287;)U[Fe*2+1]=8,Fe++,y0[8]++;for(ai(U,h+1,y0),Fe=0;Fe<f;Fe++)F[Fe*2+1]=5,F[Fe*2]=Ji(Fe,5);Y=new V(U,O,_+1,h,S),K=new V(F,L,0,f,S),J=new V(new Array(0),P,0,E,v)}function o0(Fe){var f0;for(f0=0;f0<h;f0++)Fe.dyn_ltree[f0*2]=0;for(f0=0;f0<f;f0++)Fe.dyn_dtree[f0*2]=0;for(f0=0;f0<E;f0++)Fe.bl_tree[f0*2]=0;Fe.dyn_ltree[A*2]=1,Fe.opt_len=Fe.static_len=0,Fe.last_lit=Fe.matches=0}function E0(Fe){Fe.bi_valid>8?Q(Fe,Fe.bi_buf):Fe.bi_valid>0&&(Fe.pending_buf[Fe.pending++]=Fe.bi_buf),Fe.bi_buf=0,Fe.bi_valid=0}function F0(Fe,f0,v0,D0){E0(Fe),Q(Fe,v0),Q(Fe,~v0),n.arraySet(Fe.pending_buf,Fe.window,f0,v0,Fe.pending),Fe.pending+=v0}function g0(Fe,f0,v0,D0){var l0=f0*2,y0=v0*2;return Fe[l0]<Fe[y0]||Fe[l0]===Fe[y0]&&D0[f0]<=D0[v0]}function w0(Fe,f0,v0){for(var D0=Fe.heap[v0],l0=v0<<1;l0<=Fe.heap_len&&(l0<Fe.heap_len&&g0(f0,Fe.heap[l0+1],Fe.heap[l0],Fe.depth)&&l0++,!g0(f0,D0,Fe.heap[l0],Fe.depth));)Fe.heap[v0]=Fe.heap[l0],v0=l0,l0<<=1;Fe.heap[v0]=D0}function L0(Fe,f0,v0){var D0,l0,y0=0,lt,oi;if(Fe.last_lit!==0)do D0=Fe.pending_buf[Fe.d_buf+y0*2]<<8|Fe.pending_buf[Fe.d_buf+y0*2+1],l0=Fe.pending_buf[Fe.l_buf+y0],y0++,D0===0?ut(Fe,l0,f0):(lt=j[l0],ut(Fe,lt+_+1,f0),oi=O[lt],oi!==0&&(l0-=H[lt],Xe(Fe,l0,oi)),D0--,lt=He(D0),ut(Fe,lt,v0),oi=L[lt],oi!==0&&(D0-=B[lt],Xe(Fe,D0,oi)));while(y0<Fe.last_lit);ut(Fe,A,f0)}function T0(Fe,f0){var v0=f0.dyn_tree,D0=f0.stat_desc.static_tree,l0=f0.stat_desc.has_stree,y0=f0.stat_desc.elems,lt,oi,b0=-1,W;for(Fe.heap_len=0,Fe.heap_max=m,lt=0;lt<y0;lt++)v0[lt*2]!==0?(Fe.heap[++Fe.heap_len]=b0=lt,Fe.depth[lt]=0):v0[lt*2+1]=0;for(;Fe.heap_len<2;)W=Fe.heap[++Fe.heap_len]=b0<2?++b0:0,v0[W*2]=1,Fe.depth[W]=0,Fe.opt_len--,l0&&(Fe.static_len-=D0[W*2+1]);for(f0.max_code=b0,lt=Fe.heap_len>>1;lt>=1;lt--)w0(Fe,v0,lt);W=y0;do lt=Fe.heap[1],Fe.heap[1]=Fe.heap[Fe.heap_len--],w0(Fe,v0,1),oi=Fe.heap[1],Fe.heap[--Fe.heap_max]=lt,Fe.heap[--Fe.heap_max]=oi,v0[W*2]=v0[lt*2]+v0[oi*2],Fe.depth[W]=(Fe.depth[lt]>=Fe.depth[oi]?Fe.depth[lt]:Fe.depth[oi])+1,v0[lt*2+1]=v0[oi*2+1]=W,Fe.heap[1]=W++,w0(Fe,v0,1);while(Fe.heap_len>=2);Fe.heap[--Fe.heap_max]=Fe.heap[1],ec(Fe,f0),ai(v0,b0,Fe.bl_count)}function ht(Fe,f0,v0){var D0,l0=-1,y0,lt=f0[1],oi=0,b0=7,W=4;for(lt===0&&(b0=138,W=3),f0[(v0+1)*2+1]=65535,D0=0;D0<=v0;D0++)y0=lt,lt=f0[(D0+1)*2+1],!(++oi<b0&&y0===lt)&&(oi<W?Fe.bl_tree[y0*2]+=oi:y0!==0?(y0!==l0&&Fe.bl_tree[y0*2]++,Fe.bl_tree[M*2]++):oi<=10?Fe.bl_tree[T*2]++:Fe.bl_tree[R*2]++,oi=0,l0=y0,lt===0?(b0=138,W=3):y0===lt?(b0=6,W=3):(b0=7,W=4))}function We(Fe,f0,v0){var D0,l0=-1,y0,lt=f0[1],oi=0,b0=7,W=4;for(lt===0&&(b0=138,W=3),D0=0;D0<=v0;D0++)if(y0=lt,lt=f0[(D0+1)*2+1],!(++oi<b0&&y0===lt)){if(oi<W)do ut(Fe,y0,Fe.bl_tree);while(--oi!==0);else y0!==0?(y0!==l0&&(ut(Fe,y0,Fe.bl_tree),oi--),ut(Fe,M,Fe.bl_tree),Xe(Fe,oi-3,2)):oi<=10?(ut(Fe,T,Fe.bl_tree),Xe(Fe,oi-3,3)):(ut(Fe,R,Fe.bl_tree),Xe(Fe,oi-11,7));oi=0,l0=y0,lt===0?(b0=138,W=3):y0===lt?(b0=6,W=3):(b0=7,W=4)}}function h0(Fe){var f0;for(ht(Fe,Fe.dyn_ltree,Fe.l_desc.max_code),ht(Fe,Fe.dyn_dtree,Fe.d_desc.max_code),T0(Fe,Fe.bl_desc),f0=E-1;f0>=3&&Fe.bl_tree[I[f0]*2+1]===0;f0--);return Fe.opt_len+=3*(f0+1)+5+5+4,f0}function M0(Fe,f0,v0,D0){var l0;for(Xe(Fe,f0-257,5),Xe(Fe,v0-1,5),Xe(Fe,D0-4,4),l0=0;l0<D0;l0++)Xe(Fe,Fe.bl_tree[I[l0]*2+1],3);We(Fe,Fe.dyn_ltree,f0-1),We(Fe,Fe.dyn_dtree,v0-1)}function Z(Fe){var f0=4093624447,v0;for(v0=0;v0<=31;v0++,f0>>>=1)if(f0&1&&Fe.dyn_ltree[v0*2]!==0)return s;if(Fe.dyn_ltree[18]!==0||Fe.dyn_ltree[20]!==0||Fe.dyn_ltree[26]!==0)return o;for(v0=32;v0<_;v0++)if(Fe.dyn_ltree[v0*2]!==0)return o;return s}var tt=!1;function tr(Fe){tt||(u0(),tt=!0),Fe.l_desc=new Te(Fe.dyn_ltree,Y),Fe.d_desc=new Te(Fe.dyn_dtree,K),Fe.bl_desc=new Te(Fe.bl_tree,J),Fe.bi_buf=0,Fe.bi_valid=0,o0(Fe)}function s0(Fe,f0,v0,D0){Xe(Fe,(d<<1)+(D0?1:0),3),F0(Fe,f0,v0)}function c0(Fe){Xe(Fe,u<<1,3),ut(Fe,A,U),er(Fe)}function A0(Fe,f0,v0,D0){var l0,y0,lt=0;Fe.level>0?(Fe.strm.data_type===a&&(Fe.strm.data_type=Z(Fe)),T0(Fe,Fe.l_desc),T0(Fe,Fe.d_desc),lt=h0(Fe),l0=Fe.opt_len+3+7>>>3,y0=Fe.static_len+3+7>>>3,y0<=l0&&(l0=y0)):l0=y0=v0+5,v0+4<=l0&&f0!==-1?s0(Fe,f0,v0,D0):Fe.strategy===i||y0===l0?(Xe(Fe,(u<<1)+(D0?1:0),3),L0(Fe,U,F)):(Xe(Fe,(g<<1)+(D0?1:0),3),M0(Fe,Fe.l_desc.max_code+1,Fe.d_desc.max_code+1,lt+1),L0(Fe,Fe.dyn_ltree,Fe.dyn_dtree)),o0(Fe),D0&&E0(Fe)}function P0(Fe,f0,v0){return Fe.pending_buf[Fe.d_buf+Fe.last_lit*2]=f0>>>8&255,Fe.pending_buf[Fe.d_buf+Fe.last_lit*2+1]=f0&255,Fe.pending_buf[Fe.l_buf+Fe.last_lit]=v0&255,Fe.last_lit++,f0===0?Fe.dyn_ltree[v0*2]++:(Fe.matches++,f0--,Fe.dyn_ltree[(j[v0]+_+1)*2]++,Fe.dyn_dtree[He(f0)*2]++),Fe.last_lit===Fe.lit_bufsize-1}e._tr_init=tr,e._tr_stored_block=s0,e._tr_flush_block=A0,e._tr_tally=P0,e._tr_align=c0}),"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js":(r=>{function e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}r.exports=e}),"./src/3Dmol.ts":((r,e,t)=>{t.r(e),t.d(e,{CAP:()=>o.CAP,CC:()=>i.CC,CONTEXTS_PER_VIEWPORT:()=>d.CONTEXTS_PER_VIEWPORT,Color:()=>i.Color,CustomLinear:()=>u.CustomLinear,Cylinder:()=>m.Cylinder,GLDraw:()=>o.GLDraw,GLModel:()=>a.GLModel,GLShape:()=>l.GLShape,GLViewer:()=>d.GLViewer,GLVolumetricRender:()=>f.GLVolumetricRender,Gradient:()=>u.Gradient,GradientType:()=>u.GradientType,Label:()=>g.Label,LabelCount:()=>g.LabelCount,MarchingCube:()=>b.MarchingCube,MarchingCubeInitializer:()=>b.MarchingCubeInitializer,Matrix3:()=>E.Matrix3,Matrix4:()=>E.Matrix4,Parsers:()=>x.Parsers,PausableTimer:()=>_.PausableTimer,PointGrid:()=>b.PointGrid,ProteinSurface:()=>b.ProteinSurface,Quaternion:()=>E.Quaternion,ROYGB:()=>u.ROYGB,RWB:()=>u.RWB,Ray:()=>E.Ray,Sinebow:()=>u.Sinebow,Sphere:()=>m.Sphere,SurfaceType:()=>b.SurfaceType,Triangle:()=>m.Triangle,Vector2:()=>E.Vector2,Vector3:()=>E.Vector3,VolumeData:()=>h.VolumeData,adjustVolumeStyle:()=>_.adjustVolumeStyle,applyPartialCharges:()=>y.applyPartialCharges,autoinit:()=>n.autoinit,autoload:()=>n.autoload,base64ToArray:()=>_.base64ToArray,bondLength:()=>x.bondLength,builtinColorSchemes:()=>i.builtinColorSchemes,builtinGradients:()=>u.builtinGradients,chains:()=>i.chains,clamp:()=>E.clamp,conversionMatrix3:()=>E.conversionMatrix3,createStereoViewer:()=>d.createStereoViewer,createViewer:()=>d.createViewer,createViewerGrid:()=>d.createViewerGrid,deepCopy:()=>_.deepCopy,degToRad:()=>E.degToRad,download:()=>_.download,drawCartoon:()=>s.drawCartoon,elementColors:()=>i.elementColors,extend:()=>_.extend,get:()=>_.get,getAtomProperty:()=>_.getAtomProperty,getColorFromStyle:()=>_.getColorFromStyle,getElement:()=>_.getElement,getExtent:()=>_.getExtent,getGradient:()=>u.getGradient,getPropertyRange:()=>_.getPropertyRange,getbin:()=>_.getbin,htmlColors:()=>i.htmlColors,inflateString:()=>_.inflateString,isEmptyObject:()=>_.isEmptyObject,isNumeric:()=>_.isNumeric,makeFunction:()=>_.makeFunction,mergeGeos:()=>_.mergeGeos,normalizeValue:()=>u.normalizeValue,partialCharges:()=>y.partialCharges,processing_autoinit:()=>n.processing_autoinit,residues:()=>i.residues,setBondLength:()=>x.setBondLength,setSyncSurface:()=>b.setSyncSurface,specStringToObject:()=>_.specStringToObject,splitMesh:()=>l.splitMesh,ssColors:()=>i.ssColors,subdivide_spline:()=>s.subdivide_spline,syncSurface:()=>b.syncSurface,viewers:()=>n.viewers});var n=t("./src/autoload.ts"),i=t("./src/colors.ts"),s=t("./src/glcartoon.ts"),o=t("./src/GLDraw.ts"),a=t("./src/GLModel.ts"),l=t("./src/GLShape.ts"),d=t("./src/GLViewer.ts"),u=t("./src/Gradient.ts"),g=t("./src/Label.ts"),x=t("./src/parsers/index.ts"),y=t("./src/partialCharges.ts"),b=t("./src/ProteinSurface4.ts");t("./src/specs.ts");var _=t("./src/utilities.ts"),h=t("./src/VolumeData.ts"),f=t("./src/VolumetricRender.ts"),E=t("./src/WebGL/math/index.ts"),m=t("./src/WebGL/shapes/index.ts")}),"./src/GLDraw.ts":((r,e,t)=>{t.r(e),t.d(e,{CAP:()=>i,GLDraw:()=>s});var n=t("./src/WebGL/math/index.ts"),i;(function(o){o[o.NONE=0]="NONE",o[o.FLAT=1]="FLAT",o[o.ROUND=2]="ROUND"})(i||(i={}));var s;(function(o){function a(_,h,f){var E=Math.hypot(_,h),m,S,w,v,A;E<1e-4?(S=0,w=1):(S=-_/E,w=h/E),h=-S*_+w*h,m=Math.hypot(h,f),m<1e-4?(v=0,A=1):(v=f/m,A=h/m);var M=new Float32Array(9);return M[0]=w,M[1]=S,M[2]=0,M[3]=-S*A,M[4]=w*A,M[5]=v,M[6]=S*v,M[7]=-w*v,M[8]=A,M}class l{constructor(){this.cache={};let h=[],f=4,E=Math.pow(2,f),m=2,S=Math.pow(2,m),w=E/S,v;for(h[0]=new n.Vector3(-1,0,0),h[w]=new n.Vector3(0,0,1),h[w*2]=new n.Vector3(1,0,0),h[w*3]=new n.Vector3(0,0,-1),m=3;m<=f;m++){for(S=Math.pow(2,m-1),w=E/S,v=0;v<S-1;v++)h[w/2+v*w]=h[v*w].clone().add(h[(v+1)*w]).normalize();v=S-1,h[w/2+v*w]=h[v*w].clone().add(h[0]).normalize()}this.basisVectors=h}getVerticesForRadius(h,f,E){if(typeof this.cache<"u"&&this.cache[h]!==void 0&&this.cache[h][f+E]!==void 0)return this.cache[h][f+E];for(var m=this.basisVectors.length,S=[],w=[],v,A=0;A<m;A++)S.push(this.basisVectors[A].clone().multiplyScalar(h)),S.push(this.basisVectors[A].clone().multiplyScalar(h)),v=this.basisVectors[A].clone().normalize(),w.push(v),w.push(v);var M=[],T=10,R=m,O=0,L=Math.PI*2,P=0,I=Math.PI,N,U,F=!1,k=!1;for(U=0;U<=T;U++){F=U===0||U===T,k=U===T/2;var j=[],H=[];for(N=0;N<=R;N++){if(k){var B=N<R?2*N:0;H.push(B+1),j.push(B);continue}var V=N/R,Y=U/T;if(!F||N===0)if(N<R){var K=new n.Vector3;K.x=-h*Math.cos(O+V*L)*Math.sin(P+Y*I),f==1?K.y=0:K.y=h*Math.cos(P+Y*I),K.z=h*Math.sin(O+V*L)*Math.sin(P+Y*I),Math.abs(K.x)<1e-5&&(K.x=0),Math.abs(K.y)<1e-5&&(K.y=0),Math.abs(K.z)<1e-5&&(K.z=0),f==i.FLAT?(v=new n.Vector3(0,Math.cos(P+Y*I),0),v.normalize()):(v=new n.Vector3(K.x,K.y,K.z),v.normalize()),S.push(K),w.push(v),j.push(S.length-1)}else j.push(S.length-R);else F&&j.push(S.length-1)}k&&M.push(H),M.push(j)}var J={vertices:S,normals:w,verticesRows:M,w:R,h:T};return h in this.cache||(this.cache[h]={}),this.cache[h][f+E]=J,J}}var d=new l;function u(_,h,f,E,m,S=0,w=0){if(!h||!f)return;let v=function(O0){if(typeof O0=="string"){let q=O0;return q.toLowerCase()=="flat"?i.FLAT:q.toLowerCase()=="round"?i.ROUND:i.NONE}else return O0};S=v(S),w=v(w);var A=w||S;m=m||{r:0,g:0,b:0};var M=a(f.x-h.x,f.y-h.y,f.z-h.z),T=d.getVerticesForRadius(E,w,"to"),R=T.w,O=T.h,L=A?O*R+2:2*R,P=_.updateGeoGroup(L),I=T.vertices,N=T.normals,U=T.verticesRows,F=U[O/2],k=U[O/2+1],j=P.vertices,H,B,V,Y,K,J,Te=P.vertexArray,He=P.normalArray,Q=P.colorArray,Xe=P.faceArray;for(V=0;V<R;++V){var ut=2*V;Y=M[0]*I[ut].x+M[3]*I[ut].y+M[6]*I[ut].z,K=M[1]*I[ut].x+M[4]*I[ut].y+M[7]*I[ut].z,J=M[5]*I[ut].y+M[8]*I[ut].z,H=3*(j+ut),B=P.faceidx,Te[H]=Y+h.x,Te[H+1]=K+h.y,Te[H+2]=J+h.z,Te[H+3]=Y+f.x,Te[H+4]=K+f.y,Te[H+5]=J+f.z,He[H]=Y,He[H+3]=Y,He[H+1]=K,He[H+4]=K,He[H+2]=J,He[H+5]=J,Q[H]=m.r,Q[H+3]=m.r,Q[H+1]=m.g,Q[H+4]=m.g,Q[H+2]=m.b,Q[H+5]=m.b,Xe[B]=k[V]+j,Xe[B+1]=k[V+1]+j,Xe[B+2]=F[V]+j,Xe[B+3]=F[V]+j,Xe[B+4]=k[V+1]+j,Xe[B+5]=F[V+1]+j,P.faceidx+=6}if(A){var Ji=w?0:O/2,er=S?O+1:O/2+1,ec,ai,u0,o0,E0,F0,g0,w0,L0,T0,ht,We,h0,M0,Z,tt,tr,s0,c0,A0,P0,Fe,f0,v0,D0,l0,y0,lt,oi,b0,W,e0;for(K=Ji;K<er;K++)if(K!==O/2){var a0=K<=O/2?f:h,hi=d.getVerticesForRadius(E,w,"to"),p0=d.getVerticesForRadius(E,S,"from");for(a0===f?(I=hi.vertices,N=hi.normals,U=hi.verticesRows):a0==h&&(I=p0.vertices,N=p0.normals,U=p0.verticesRows),Y=0;Y<R;Y++)B=P.faceidx,ec=U[K][Y+1],oi=(ec+j)*3,ai=U[K][Y],b0=(ai+j)*3,u0=U[K+1][Y],W=(u0+j)*3,o0=U[K+1][Y+1],e0=(o0+j)*3,E0=M[0]*I[ec].x+M[3]*I[ec].y+M[6]*I[ec].z,F0=M[0]*I[ai].x+M[3]*I[ai].y+M[6]*I[ai].z,g0=M[0]*I[u0].x+M[3]*I[u0].y+M[6]*I[u0].z,w0=M[0]*I[o0].x+M[3]*I[o0].y+M[6]*I[o0].z,L0=M[1]*I[ec].x+M[4]*I[ec].y+M[7]*I[ec].z,T0=M[1]*I[ai].x+M[4]*I[ai].y+M[7]*I[ai].z,ht=M[1]*I[u0].x+M[4]*I[u0].y+M[7]*I[u0].z,We=M[1]*I[o0].x+M[4]*I[o0].y+M[7]*I[o0].z,h0=M[5]*I[ec].y+M[8]*I[ec].z,M0=M[5]*I[ai].y+M[8]*I[ai].z,Z=M[5]*I[u0].y+M[8]*I[u0].z,tt=M[5]*I[o0].y+M[8]*I[o0].z,Te[oi]=E0+a0.x,Te[b0]=F0+a0.x,Te[W]=g0+a0.x,Te[e0]=w0+a0.x,Te[oi+1]=L0+a0.y,Te[b0+1]=T0+a0.y,Te[W+1]=ht+a0.y,Te[e0+1]=We+a0.y,Te[oi+2]=h0+a0.z,Te[b0+2]=M0+a0.z,Te[W+2]=Z+a0.z,Te[e0+2]=tt+a0.z,Q[oi]=m.r,Q[b0]=m.r,Q[W]=m.r,Q[e0]=m.r,Q[oi+1]=m.g,Q[b0+1]=m.g,Q[W+1]=m.g,Q[e0+1]=m.g,Q[oi+2]=m.b,Q[b0+2]=m.b,Q[W+2]=m.b,Q[e0+2]=m.b,tr=M[0]*N[ec].x+M[3]*N[ec].y+M[6]*N[ec].z,s0=M[0]*N[ai].x+M[3]*N[ai].y+M[6]*N[ai].z,c0=M[0]*N[u0].x+M[3]*N[u0].y+M[6]*N[u0].z,A0=M[0]*N[o0].x+M[3]*N[o0].y+M[6]*N[o0].z,P0=M[1]*N[ec].x+M[4]*N[ec].y+M[7]*N[ec].z,Fe=M[1]*N[ai].x+M[4]*N[ai].y+M[7]*N[ai].z,f0=M[1]*N[u0].x+M[4]*N[u0].y+M[7]*N[u0].z,v0=M[1]*N[o0].x+M[4]*N[o0].y+M[7]*N[o0].z,D0=M[5]*N[ec].y+M[8]*N[ec].z,l0=M[5]*N[ai].y+M[8]*N[ai].z,y0=M[5]*N[u0].y+M[8]*N[u0].z,lt=M[5]*N[o0].y+M[8]*N[o0].z,K===0?(He[oi]=tr,He[W]=c0,He[e0]=A0,He[oi+1]=P0,He[W+1]=f0,He[e0+1]=v0,He[oi+2]=D0,He[W+2]=y0,He[e0+2]=lt,Xe[B]=ec+j,Xe[B+1]=u0+j,Xe[B+2]=o0+j,P.faceidx+=3):K===er-1?(He[oi]=tr,He[b0]=s0,He[W]=c0,He[oi+1]=P0,He[b0+1]=Fe,He[W+1]=f0,He[oi+2]=D0,He[b0+2]=l0,He[W+2]=y0,Xe[B]=ec+j,Xe[B+1]=ai+j,Xe[B+2]=u0+j,P.faceidx+=3):(He[oi]=tr,He[b0]=s0,He[e0]=A0,He[oi+1]=P0,He[b0+1]=Fe,He[e0+1]=v0,He[oi+2]=D0,He[b0+2]=l0,He[e0+2]=lt,He[b0]=s0,He[W]=c0,He[e0]=A0,He[b0+1]=Fe,He[W+1]=f0,He[e0+1]=v0,He[b0+2]=l0,He[W+2]=y0,He[e0+2]=lt,Xe[B]=ec+j,Xe[B+1]=ai+j,Xe[B+2]=o0+j,Xe[B+3]=ai+j,Xe[B+4]=u0+j,Xe[B+5]=o0+j,P.faceidx+=6)}}P.vertices+=L}o.drawCylinder=u;function g(_,h,f,E,m){if(!h||!f)return;m=m||{r:0,g:0,b:0};let S=new n.Vector3(f.x-h.x,f.y-h.y,f.z-h.z);var w=a(S.x,S.y,S.z);S=S.normalize();var v=d.basisVectors.length,A=d.basisVectors,M=v+2,T=_.updateGeoGroup(M),R=T.vertices,O,L,P,I,N,U,F=T.vertexArray,k=T.normalArray,j=T.colorArray,H=T.faceArray;for(O=R*3,F[O]=h.x,F[O+1]=h.y,F[O+2]=h.z,k[O]=-S.x,k[O+1]=-S.y,k[O+2]=-S.z,j[O]=m.r,j[O+1]=m.g,j[O+2]=m.b,F[O+3]=f.x,F[O+4]=f.y,F[O+5]=f.z,k[O+3]=S.x,k[O+4]=S.y,k[O+5]=S.z,j[O+3]=m.r,j[O+4]=m.g,j[O+5]=m.b,O+=6,P=0;P<v;++P){var B=A[P].clone();B.multiplyScalar(E),I=w[0]*B.x+w[3]*B.y+w[6]*B.z,N=w[1]*B.x+w[4]*B.y+w[7]*B.z,U=w[5]*B.y+w[8]*B.z,F[O]=I+h.x,F[O+1]=N+h.y,F[O+2]=U+h.z,k[O]=I,k[O+1]=N,k[O+2]=U,j[O]=m.r,j[O+1]=m.g,j[O+2]=m.b,O+=3}for(T.vertices+=v+2,L=T.faceidx,P=0;P<v;P++){var V=R+2+P,Y=R+2+(P+1)%v;H[L]=V,H[L+1]=Y,H[L+2]=R,L+=3,H[L]=V,H[L+1]=Y,H[L+2]=R+1,L+=3}T.faceidx+=6*v}o.drawCone=g;class x{constructor(){this.cache=new Map}getVerticesForRadius(h,f){f=f||2,this.cache.has(f)||this.cache.set(f,new Map);let E=this.cache.get(f);if(E.has(h))return E.get(h);var m={vertices:[],verticesRows:[],normals:[]},S=16*f,w=10*f;h<1&&(S=10*f,w=8*f);var v=0,A=Math.PI*2,M=0,T=Math.PI,R,O;for(O=0;O<=w;O++){let P=[];for(R=0;R<=S;R++){let I=R/S,N=O/w,U=-h*Math.cos(v+I*A)*Math.sin(M+N*T),F=h*Math.cos(M+N*T),k=h*Math.sin(v+I*A)*Math.sin(M+N*T);var L=new n.Vector3(U,F,k);L.normalize(),m.vertices.push({x:U,y:F,z:k}),m.normals.push(L),P.push(m.vertices.length-1)}m.verticesRows.push(P)}return E.set(h,m),m}}var y=new x;function b(_,h,f,E,m){var S=y.getVerticesForRadius(f,m),w=S.vertices,v=S.normals,A=_.updateGeoGroup(w.length),M=A.vertices,T=A.vertexArray,R=A.colorArray,O=A.faceArray,L=A.lineArray,P=A.normalArray;for(let U=0,F=w.length;U<F;++U){let k=3*(M+U),j=w[U];T[k]=j.x+h.x,T[k+1]=j.y+h.y,T[k+2]=j.z+h.z,R[k]=E.r,R[k+1]=E.g,R[k+2]=E.b}A.vertices+=w.length;let I=S.verticesRows,N=I.length-1;for(let U=0;U<N;U++){let F=I[U].length-1;for(let k=0;k<F;k++){let j=A.faceidx,H=A.lineidx,B=I[U][k+1]+M,V=B*3,Y=I[U][k]+M,K=Y*3,J=I[U+1][k]+M,Te=J*3,He=I[U+1][k+1]+M,Q=He*3,Xe=v[B-M],ut=v[Y-M],Ji=v[J-M],er=v[He-M];Math.abs(w[B-M].y)===f?(P[V]=Xe.x,P[Te]=Ji.x,P[Q]=er.x,P[V+1]=Xe.y,P[Te+1]=Ji.y,P[Q+1]=er.y,P[V+2]=Xe.z,P[Te+2]=Ji.z,P[Q+2]=er.z,O[j]=B,O[j+1]=J,O[j+2]=He,L[H]=B,L[H+1]=J,L[H+2]=B,L[H+3]=He,L[H+4]=J,L[H+5]=He,A.faceidx+=3,A.lineidx+=6):Math.abs(w[J-M].y)===f?(P[V]=Xe.x,P[K]=ut.x,P[Te]=Ji.x,P[V+1]=Xe.y,P[K+1]=ut.y,P[Te+1]=Ji.y,P[V+2]=Xe.z,P[K+2]=ut.z,P[Te+2]=Ji.z,O[j]=B,O[j+1]=Y,O[j+2]=J,L[H]=B,L[H+1]=Y,L[H+2]=B,L[H+3]=J,L[H+4]=Y,L[H+5]=J,A.faceidx+=3,A.lineidx+=6):(P[V]=Xe.x,P[K]=ut.x,P[Q]=er.x,P[V+1]=Xe.y,P[K+1]=ut.y,P[Q+1]=er.y,P[V+2]=Xe.z,P[K+2]=ut.z,P[Q+2]=er.z,P[K]=ut.x,P[Te]=Ji.x,P[Q]=er.x,P[K+1]=ut.y,P[Te+1]=Ji.y,P[Q+1]=er.y,P[K+2]=ut.z,P[Te+2]=Ji.z,P[Q+2]=er.z,O[j]=B,O[j+1]=Y,O[j+2]=He,O[j+3]=Y,O[j+4]=J,O[j+5]=He,L[H]=B,L[H+1]=Y,L[H+2]=B,L[H+3]=He,L[H+4]=Y,L[H+5]=J,L[H+6]=J,L[H+7]=He,A.faceidx+=6,A.lineidx+=8)}}}o.drawSphere=b})(s||(s={}))}),"./src/GLModel.ts":((r,e,t)=>{t.r(e),t.d(e,{GLModel:()=>b});var n=t("./src/WebGL/index.ts"),i=t("./src/WebGL/shapes/index.ts"),s=t("./src/WebGL/math/index.ts"),o=t("./src/colors.ts"),a=t("./src/GLDraw.ts"),l=t("./src/glcartoon.ts"),d=t("./src/utilities.ts"),u=t("./src/Gradient.ts"),g=t("./src/parsers/index.ts"),x=t("./node_modules/netcdfjs/lib-esm/index.js"),y=t("./src/parsers/utils/assignBonds.ts");class b{static sameObj(h,f){return h&&f?JSON.stringify(h)==JSON.stringify(f):h==f}constructor(h,f,E){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new s.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=o.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=f||{},this.viewer=E,this.ElementColors=this.options.defaultcolors?this.options.defaultcolors:o.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius?this.options.defaultSphereRadius:1.5,this.defaultCartoonQuality=this.options.cartoonQuality?this.options.cartoonQuality:10,this.id=h}getRadiusFromStyle(h,f){var E=this.defaultSphereRadius;if(typeof f.radius<"u")E=f.radius;else if(b.vdwRadii[h.elem])E=b.vdwRadii[h.elem];else if(h.elem.length>1){let m=h.elem;m=m[0].toUpperCase()+m[1].toLowerCase(),b.vdwRadii[m]&&(E=b.vdwRadii[m])}return typeof f.scale<"u"&&(E*=f.scale),E}drawAtomCross(h,f){if(h.style.cross){var E=h.style.cross;if(!E.hidden){var m=E.linewidth||b.defaultlineWidth;f[m]||(f[m]=new n.Geometry);var S=f[m].updateGeoGroup(6),w=this.getRadiusFromStyle(h,E),v=[[w,0,0],[-w,0,0],[0,w,0],[0,-w,0],[0,0,w],[0,0,-w]],A=h.clickable||h.hoverable;A&&h.intersectionShape===void 0&&(h.intersectionShape={sphere:[],cylinder:[],line:[]});for(var M=(0,d.getColorFromStyle)(h,E),T=S.vertexArray,R=S.colorArray,O=0;O<6;O++){var L=S.vertices*3;if(S.vertices++,T[L]=h.x+v[O][0],T[L+1]=h.y+v[O][1],T[L+2]=h.z+v[O][2],R[L]=M.r,R[L+1]=M.g,R[L+2]=M.b,A){var P=new s.Vector3(v[O][0],v[O][1],v[O][2]);P.multiplyScalar(.1),P.set(P.x+h.x,P.y+h.y,P.z+h.z),h.intersectionShape.line.push(P)}}}}}getGoodCross(h,f,E,m){for(var S=null,w=-1,v=0,A=h.bonds.length;v<A;v++)if(h.bonds[v]!=f.index){let T=h.bonds[v],R=this.atoms[T],L=new s.Vector3(R.x,R.y,R.z).clone();L.sub(E);let P=L.clone();P.cross(m);var M=P.lengthSq();if(M>w&&(w=M,S=P,w>.1))return S}return S}getSideBondV(h,f,E){var m,S,w,v,A,M=new s.Vector3(h.x,h.y,h.z),T=new s.Vector3(f.x,f.y,f.z),R=T.clone(),O=null;if(R.sub(M),h.bonds.length===1)f.bonds.length===1?(O=R.clone(),Math.abs(O.x)>1e-4?O.y+=1:O.x+=1):(m=(E+1)%f.bonds.length,S=f.bonds[m],w=this.atoms[S],w.index==h.index&&(m=(m+1)%f.bonds.length,S=f.bonds[m],w=this.atoms[S]),v=new s.Vector3(w.x,w.y,w.z),A=v.clone(),A.sub(M),O=A.clone(),O.cross(R));else if(O=this.getGoodCross(h,f,M,R),O.lengthSq()<.01){var L=this.getGoodCross(f,h,M,R);L!=null&&(O=L)}return O.lengthSq()<.01&&(O=R.clone(),Math.abs(O.x)>1e-4?O.y+=1:O.x+=1),O.cross(R),O.normalize(),O}addLine(h,f,E,m,S,w){h[E]=m.x,h[E+1]=m.y,h[E+2]=m.z,f[E]=w.r,f[E+1]=w.g,f[E+2]=w.b,h[E+3]=S.x,h[E+4]=S.y,h[E+5]=S.z,f[E+3]=w.r,f[E+4]=w.g,f[E+5]=w.b}drawBondLines(h,f,E){if(h.style.line){var m=h.style.line;if(!m.hidden){var S,w,v,A,M=m.linewidth||b.defaultlineWidth;E[M]||(E[M]=new n.Geometry);for(var T=E[M].updateGeoGroup(6*h.bonds.length),R=T.vertexArray,O=T.colorArray,L=0;L<h.bonds.length;L++){var P=h.bonds[L],I=f[P];if(I.style.line&&!(h.index>=I.index)){var N=new s.Vector3(h.x,h.y,h.z),U=new s.Vector3(I.x,I.y,I.z),F=N.clone().add(U).multiplyScalar(.5),k=!1,j=h.clickable||h.hoverable,H=I.clickable||I.hoverable;(j||H)&&(j&&(h.intersectionShape===void 0&&(h.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),h.intersectionShape.line.push(N),h.intersectionShape.line.push(F)),H&&(I.intersectionShape===void 0&&(I.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),I.intersectionShape.line.push(F),I.intersectionShape.line.push(U)));var B=(0,d.getColorFromStyle)(h,h.style.line),V=(0,d.getColorFromStyle)(I,I.style.line);if(h.bondStyles&&h.bondStyles[L]){var Y=h.bondStyles[L];if(!Y.iswire)continue;Y.singleBond&&(k=!0),typeof Y.color1<"u"&&(B=o.CC.color(Y.color1)),typeof Y.color2<"u"&&(V=o.CC.color(Y.color2))}var K=T.vertices*3,J,Te;if(h.bondOrder[L]>1&&h.bondOrder[L]<4&&!k){var He=this.getSideBondV(h,I,L),Q=U.clone();Q.sub(N),h.bondOrder[L]==2?(He.multiplyScalar(.1),S=N.clone(),S.add(He),w=N.clone(),w.sub(He),v=S.clone(),v.add(Q),A=w.clone(),A.add(Q),B==V?(T.vertices+=4,this.addLine(R,O,K,S,v,B),this.addLine(R,O,K+6,w,A,B)):(T.vertices+=8,Q.multiplyScalar(.5),J=S.clone(),J.add(Q),Te=w.clone(),Te.add(Q),this.addLine(R,O,K,S,J,B),this.addLine(R,O,K+6,J,v,V),this.addLine(R,O,K+12,w,Te,B),this.addLine(R,O,K+18,Te,A,V))):h.bondOrder[L]==3&&(He.multiplyScalar(.1),S=N.clone(),S.add(He),w=N.clone(),w.sub(He),v=S.clone(),v.add(Q),A=w.clone(),A.add(Q),B==V?(T.vertices+=6,this.addLine(R,O,K,N,U,B),this.addLine(R,O,K+6,S,v,B),this.addLine(R,O,K+12,w,A,B)):(T.vertices+=12,Q.multiplyScalar(.5),J=S.clone(),J.add(Q),Te=w.clone(),Te.add(Q),this.addLine(R,O,K,N,F,B),this.addLine(R,O,K+6,F,U,V),this.addLine(R,O,K+12,S,J,B),this.addLine(R,O,K+18,J,v,V),this.addLine(R,O,K+24,w,Te,B),this.addLine(R,O,K+30,Te,A,V)))}else B==V?(T.vertices+=2,this.addLine(R,O,K,N,U,B)):(T.vertices+=4,this.addLine(R,O,K,N,F,B),this.addLine(R,O,K+6,F,U,V))}}}}}drawAtomSphere(h,f){if(h.style.sphere){var E=h.style.sphere;if(!E.hidden){var m=(0,d.getColorFromStyle)(h,E),S=this.getRadiusFromStyle(h,E);if((h.clickable===!0||h.hoverable)&&h.intersectionShape!==void 0){var w=new s.Vector3(h.x,h.y,h.z);h.intersectionShape.sphere.push(new i.Sphere(w,S))}a.GLDraw.drawSphere(f,h,S,m)}}}drawAtomClickSphere(h){if(h.style.clicksphere){var f=h.style.clicksphere;if(!f.hidden){var E=this.getRadiusFromStyle(h,f);if((h.clickable===!0||h.hoverable)&&h.intersectionShape!==void 0){var m=new s.Vector3(h.x,h.y,h.z);h.intersectionShape.sphere.push(new i.Sphere(m,E))}}}}drawAtomInstanced(h,f){if(h.style.sphere){var E=h.style.sphere;if(!E.hidden){var m=this.getRadiusFromStyle(h,E),S=(0,d.getColorFromStyle)(h,E),w=f.updateGeoGroup(1),v=w.vertices,A=v*3,M=w.vertexArray,T=w.colorArray,R=w.radiusArray;if(M[A]=h.x,M[A+1]=h.y,M[A+2]=h.z,T[A]=S.r,T[A+1]=S.g,T[A+2]=S.b,R[v]=m,(h.clickable===!0||h.hoverable)&&h.intersectionShape!==void 0){var O=new s.Vector3(h.x,h.y,h.z);h.intersectionShape.sphere.push(new i.Sphere(O,m))}w.vertices+=1}}}drawSphereImposter(h,f,E,m){var S=h.updateGeoGroup(4),w,v=S.vertices,A=v*3,M=S.vertexArray,T=S.colorArray;for(w=0;w<4;w++)M[A+3*w]=f.x,M[A+3*w+1]=f.y,M[A+3*w+2]=f.z;var R=S.normalArray;for(w=0;w<4;w++)T[A+3*w]=m.r,T[A+3*w+1]=m.g,T[A+3*w+2]=m.b;R[A+0]=-E,R[A+1]=E,R[A+2]=0,R[A+3]=-E,R[A+4]=-E,R[A+5]=0,R[A+6]=E,R[A+7]=-E,R[A+8]=0,R[A+9]=E,R[A+10]=E,R[A+11]=0,S.vertices+=4;var O=S.faceArray,L=S.faceidx;O[L+0]=v,O[L+1]=v+1,O[L+2]=v+2,O[L+3]=v+2,O[L+4]=v+3,O[L+5]=v,S.faceidx+=6}drawAtomImposter(h,f){if(h.style.sphere){var E=h.style.sphere;if(!E.hidden){var m=this.getRadiusFromStyle(h,E),S=(0,d.getColorFromStyle)(h,E);if((h.clickable===!0||h.hoverable)&&h.intersectionShape!==void 0){var w=new s.Vector3(h.x,h.y,h.z);h.intersectionShape.sphere.push(new i.Sphere(w,m))}this.drawSphereImposter(f,h,m,S)}}}calculateDashes(h,f,E,m,S){var w=Math.sqrt(Math.pow(h.x-f.x,2)+Math.pow(h.y-f.y,2)+Math.pow(h.z-f.z,2));E=Math.max(E,0),S=Math.max(S,0)+2*E,m=Math.max(m,.001),m+S>w&&(m=w,S=0);var v=Math.floor((w-m)/(m+S))+1,A=v*m;S=(w-A)/v;for(var M,T=new s.Vector3(h.x,h.y,h.z),R=new s.Vector3((f.x-h.x)/(w/S),(f.y-h.y)/(w/S),(f.z-h.z)/(w/S)),O=new s.Vector3((f.x-h.x)/(w/m),(f.y-h.y)/(w/m),(f.z-h.z)/(w/m)),L=[],P=0;P<v;P++)M=new s.Vector3(T.x+O.x,T.y+O.y,T.z+O.z),L.push({from:T,to:M}),T=new s.Vector3(M.x+R.x,M.y+R.y,M.z+R.z);return L}static drawStickImposter(h,f,E,m,S,w=0,v=0){for(var A=h.updateGeoGroup(4),M=A.vertices,T=M*3,R=A.vertexArray,O=A.colorArray,L=A.radiusArray,P=A.normalArray,I=S.r,N=S.g,U=S.b,F=function(V){var Y=-V;return Y==0&&(Y=-1e-4),Y},k=T,j=0;j<4;j++)R[k]=f.x,P[k]=E.x,O[k]=I,k++,R[k]=f.y,P[k]=E.y,O[k]=N,k++,R[k]=f.z,P[k]=E.z,j<2?O[k]=U:O[k]=F(U),k++;A.vertices+=4,L[M]=-m,L[M+1]=m,L[M+2]=-m,L[M+3]=m;var H=A.faceArray,B=A.faceidx;H[B+0]=M,H[B+1]=M+1,H[B+2]=M+2,H[B+3]=M+2,H[B+4]=M+3,H[B+5]=M,A.faceidx+=6}drawBondSticks(h,f,E){var m,S;if(h.style.stick){var w=h.style.stick;if(!w.hidden){var v=w.radius||this.defaultStickRadius,A=w.doubleBondScaling||.4,M=w.tripleBondScaling||.25,T=((m=w.dashedBondConfig)===null||m===void 0?void 0:m.dashLength)||.1,R=((S=w.dashedBondConfig)===null||S===void 0?void 0:S.gapLength)||.25,O=v,L=w.singleBonds||!1,P=w.dashedBonds||!1,I=0,N=0,U,F,k,j,H,B,V,Y,K,J,Te,He=(0,d.getColorFromStyle)(h,w),Q,Xe,ut;!h.capDrawn&&h.bonds.length<4&&(I=2);var Ji=f0=>{var v0=E.imposter?b.drawStickImposter:a.GLDraw.drawCylinder;return!P&&f0>=1?v0:(D0,l0,y0,lt,oi,b0=0,W=0,e0=.1,a0=.25)=>{var hi=this.calculateDashes(l0,y0,lt,e0,a0);hi.forEach(p0=>{v0(D0,p0.from,p0.to,lt,oi,b0,W)})}};for(k=0;k<h.bonds.length;k++){var er=Ji(h.bondOrder[k]),ec=h.bonds[k],ai=f[ec];if(Q=Xe=ut=null,h.index<ai.index){var u0=ai.style;if(!u0.stick||u0.stick.hidden)continue;var o0=(0,d.getColorFromStyle)(ai,u0.stick);if(O=v,j=L,h.bondStyles&&h.bondStyles[k]){if(H=h.bondStyles[k],H.iswire)continue;H.radius&&(O=H.radius),H.singleBond&&(j=!0),typeof H.color1<"u"&&(He=o.CC.color(H.color1)),typeof H.color2<"u"&&(o0=o.CC.color(H.color2))}var E0=new s.Vector3(h.x,h.y,h.z),F0=new s.Vector3(ai.x,ai.y,ai.z);if(h.bondOrder[k]<=1||j||h.bondOrder[k]>3){if(h.bondOrder[k]<1&&(O*=h.bondOrder[k]),!ai.capDrawn&&ai.bonds.length<4&&(N=2),He!=o0?(Q=new s.Vector3().addVectors(E0,F0).multiplyScalar(.5),er(E,E0,Q,O,He,I,0,T,R),er(E,Q,F0,O,o0,0,N,T,R)):er(E,E0,F0,O,He,I,N,T,R),U=h.clickable||h.hoverable,F=ai.clickable||ai.hoverable,U||F){if(Q||(Q=new s.Vector3().addVectors(E0,F0).multiplyScalar(.5)),U){var g0=new i.Cylinder(E0,Q,O),w0=new i.Sphere(E0,O);h.intersectionShape.cylinder.push(g0),h.intersectionShape.sphere.push(w0)}if(F){var L0=new i.Cylinder(F0,Q,O),T0=new i.Sphere(F0,O);ai.intersectionShape.cylinder.push(L0),ai.intersectionShape.sphere.push(T0)}}}else if(h.bondOrder[k]>1){var ht=0,We=0;O!=v&&(ht=2,We=2);var h0=F0.clone(),M0=null;h0.sub(E0);var Z,tt,tr,s0,c0;M0=this.getSideBondV(h,ai,k),h.bondOrder[k]==2?(Z=O*A,M0.multiplyScalar(Z*1.5),tt=E0.clone(),tt.add(M0),tr=E0.clone(),tr.sub(M0),s0=tt.clone(),s0.add(h0),c0=tr.clone(),c0.add(h0),He!=o0?(Q=new s.Vector3().addVectors(tt,s0).multiplyScalar(.5),Xe=new s.Vector3().addVectors(tr,c0).multiplyScalar(.5),er(E,tt,Q,Z,He,ht,0),er(E,Q,s0,Z,o0,0,We),er(E,tr,Xe,Z,He,ht,0),er(E,Xe,c0,Z,o0,0,We)):(er(E,tt,s0,Z,He,ht,We),er(E,tr,c0,Z,He,ht,We)),U=h.clickable||h.hoverable,F=ai.clickable||ai.hoverable,(U||F)&&(Q||(Q=new s.Vector3().addVectors(tt,s0).multiplyScalar(.5)),Xe||(Xe=new s.Vector3().addVectors(tr,c0).multiplyScalar(.5)),U&&(B=new i.Cylinder(tt,Q,Z),V=new i.Cylinder(tr,Xe,Z),h.intersectionShape.cylinder.push(B),h.intersectionShape.cylinder.push(V)),F&&(K=new i.Cylinder(s0,Q,Z),J=new i.Cylinder(c0,Xe,Z),ai.intersectionShape.cylinder.push(K),ai.intersectionShape.cylinder.push(J)))):h.bondOrder[k]==3&&(Z=O*M,M0.cross(h0),M0.normalize(),M0.multiplyScalar(Z*3),tt=E0.clone(),tt.add(M0),tr=E0.clone(),tr.sub(M0),s0=tt.clone(),s0.add(h0),c0=tr.clone(),c0.add(h0),He!=o0?(Q=new s.Vector3().addVectors(tt,s0).multiplyScalar(.5),Xe=new s.Vector3().addVectors(tr,c0).multiplyScalar(.5),ut=new s.Vector3().addVectors(E0,F0).multiplyScalar(.5),er(E,tt,Q,Z,He,ht,0),er(E,Q,s0,Z,o0,0,We),er(E,E0,ut,Z,He,I,0),er(E,ut,F0,Z,o0,0,N),er(E,tr,Xe,Z,He,ht,0),er(E,Xe,c0,Z,o0,0,We)):(er(E,tt,s0,Z,He,ht,We),er(E,E0,F0,Z,He,I,N),er(E,tr,c0,Z,He,ht,We)),U=h.clickable||h.hoverable,F=ai.clickable||ai.hoverable,(U||F)&&(Q||(Q=new s.Vector3().addVectors(tt,s0).multiplyScalar(.5)),Xe||(Xe=new s.Vector3().addVectors(tr,c0).multiplyScalar(.5)),ut||(ut=new s.Vector3().addVectors(E0,F0).multiplyScalar(.5)),U&&(B=new i.Cylinder(tt.clone(),Q.clone(),Z),V=new i.Cylinder(tr.clone(),Xe.clone(),Z),Y=new i.Cylinder(E0.clone(),ut.clone(),Z),h.intersectionShape.cylinder.push(B),h.intersectionShape.cylinder.push(V),h.intersectionShape.cylinder.push(Y)),F&&(K=new i.Cylinder(s0.clone(),Q.clone(),Z),J=new i.Cylinder(c0.clone(),Xe.clone(),Z),Te=new i.Cylinder(F0.clone(),ut.clone(),Z),ai.intersectionShape.cylinder.push(K),ai.intersectionShape.cylinder.push(J),ai.intersectionShape.cylinder.push(Te))))}}}var A0=!1,P0=0,Fe=!1;for(k=0;k<h.bonds.length;k++)j=L,h.bondStyles&&h.bondStyles[k]&&(H=h.bondStyles[k],H.singleBond&&(j=!0),H.radius&&H.radius!=v&&(Fe=!0)),(j||h.bondOrder[k]==1)&&P0++;Fe?P0>0&&(A0=!0):P0==0&&(h.bonds.length>0||w.showNonBonded)&&(A0=!0),A0&&(O=v,E.imposter?this.drawSphereImposter(E.sphereGeometry,h,O,He):a.GLDraw.drawSphere(E,h,O,He))}}}createMolObj(h,f){f=f||{};var E=new n.Object3D,m=[],S={},w={},v=this.drawAtomSphere,A=null,M=null;f.supportsImposters?(v=this.drawAtomImposter,A=new n.Geometry(!0),A.imposter=!0,M=new n.Geometry(!0,!0),M.imposter=!0,M.sphereGeometry=new n.Geometry(!0),M.sphereGeometry.imposter=!0,M.drawnCaps={}):f.supportsAIA?(v=this.drawAtomInstanced,A=new n.Geometry(!1,!0,!0),A.instanced=!0,M=new n.Geometry(!0)):(A=new n.Geometry(!0),M=new n.Geometry(!0));var T,R,O,L,P={},I=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(T=0,O=h.length;T<O;T++){var N=h[T];if(N&&N.style){(N.clickable||N.hoverable)&&N.intersectionShape===void 0&&(N.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),L={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(R in L)N.style[R]?N.style[R].opacity?L[R]=parseFloat(N.style[R].opacity):L[R]=1:L[R]=void 0,P[R]?L[R]!=null&&P[R]!=L[R]&&(console.log("Warning: "+R+" opacity is ambiguous"),P[R]=1):P[R]=L[R];v.call(this,N,A),this.drawAtomClickSphere(N),this.drawAtomCross(N,w),this.drawBondLines(N,h,S),this.drawBondSticks(N,h,M),typeof N.style.cartoon<"u"&&!N.style.cartoon.hidden&&(N.style.cartoon.color==="spectrum"&&typeof N.resi=="number"&&!N.hetflag&&(N.resi<I[0]&&(I[0]=N.resi),N.resi>I[1]&&(I[1]=N.resi)),m.push(N))}}if(m.length>0&&(0,l.drawCartoon)(E,m,I,this.defaultCartoonQuality),A&&A.vertices>0){A.initTypedArrays();var U=null,F=null;A.imposter?U=new n.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):A.instanced?(F=new n.Geometry(!0),a.GLDraw.drawSphere(F,{x:0,y:0,z:0},1,new o.Color(.5,.5,.5)),F.initTypedArrays(),U=new n.InstancedMaterial({sphereMaterial:new n.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:F})):U=new n.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),P.sphere<1&&P.sphere>=0&&(U.transparent=!0,U.opacity=P.sphere),F=new n.Mesh(A,U),E.add(F)}if(M.vertices>0){var k=null,j=null,H=M.sphereGeometry;(!H||typeof H.vertices>"u"||H.vertices==0)&&(H=null),M.initTypedArrays(),H&&H.initTypedArrays();var B={ambient:0,vertexColors:!0,reflectivity:0};M.imposter?(k=new n.StickImposterMaterial(B),j=new n.SphereImposterMaterial(B)):(k=new n.MeshLambertMaterial(B),j=new n.MeshLambertMaterial(B),k.wireframe&&(M.setUpWireframe(),H&&H.setUpWireframe())),P.stick<1&&P.stick>=0&&(k.transparent=!0,k.opacity=P.stick,j.transparent=!0,j.opacity=P.stick);var V=new n.Mesh(M,k);if(E.add(V),H){var Y=new n.Mesh(H,j);E.add(Y)}}var K;for(T in S)if(S.hasOwnProperty(T)){K=T;var J=new n.LineBasicMaterial({linewidth:K,vertexColors:!0});P.line<1&&P.line>=0&&(J.transparent=!0,J.opacity=P.line),S[T].initTypedArrays();var Te=new n.Line(S[T],J,n.LineStyle.LinePieces);E.add(Te)}for(T in w)if(w.hasOwnProperty(T)){K=T;var He=new n.LineBasicMaterial({linewidth:K,vertexColors:!0});P.cross<1&&P.cross>=0&&(He.transparent=!0,He.opacity=P.cross),w[T].initTypedArrays();var Q=new n.Line(w[T],He,n.LineStyle.LinePieces);E.add(Q)}if(this.dontDuplicateAtoms&&this.modelData.symmetries&&this.modelData.symmetries.length>0){var Xe=new n.Object3D,ut;for(ut=0;ut<this.modelData.symmetries.length;ut++){var Ji=new n.Object3D;Ji=E.clone(),Ji.matrix.copy(this.modelData.symmetries[ut]),Ji.matrixAutoUpdate=!1,Xe.add(Ji)}return Xe}return E}getViewer(){return this.viewer}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(h){this.atoms=h.atoms,this.frames=h.frames,this.molObj=null}getCrystData(){if(this.modelData.cryst){if(!this.modelData.cryst.matrix){const h=this.modelData.cryst;this.modelData.cryst.matrix=(0,s.conversionMatrix3)(h.a,h.b,h.c,h.alpha,h.beta,h.gamma)}return this.modelData.cryst}else return null}setCrystData(h,f,E,m,S,w){h=h||1,f=f||1,E=E||1,m=m||90,S=S||90,w=w||90;const v=(0,s.conversionMatrix3)(h,f,E,m,S,w);this.modelData.cryst={a:h,b:f,c:E,alpha:m,beta:S,gamma:w,matrix:v}}setCrystMatrix(h){h=h||new s.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:h}}getSymmetries(){return typeof this.modelData.symmetries>"u"&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(h){typeof h>"u"?this.modelData.symmetries=[this.idMatrix]:(this.modelData.symmetries=h,this.molObj=null)}getID(){return this.id}getNumFrames(){return this.frames.numFrames!=null?this.frames.numFrames:this.frames.length}adjustCoord(h,f,E,m){var S=f-h;return S<-E?f+m:S>E?f-m:f}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var h=this.box[0],f=this.box[1],E=this.box[2],m=h*.9,S=f*.9,w=E*.9,v=0;v<this.atomdfs.length;v++)for(var A=this.atomdfs[v],M=1;M<A.length;M++){var T=this.atoms[A[M][0]],R=this.atoms[A[M][1]];T.x=this.adjustCoord(R.x,T.x,m,h),T.y=this.adjustCoord(R.y,T.y,S,f),T.z=this.adjustCoord(R.z,T.z,w,E)}}setFrame(h){var f=this.getNumFrames();let E=this,m=this.viewer;return new Promise(function(S,w){if(f==0&&S(),(h<0||h>=f)&&(h=f-1),E.frames.url!=null){var v=E.frames.url;(0,d.getbin)(v+"/traj/frame/"+h+"/"+E.frames.path,void 0,"POST",void 0).then(function(A){for(var M=new Float32Array(A,44),T=0,R=0;R<E.atoms.length;R++)E.atoms[R].x=M[T++],E.atoms[R].y=M[T++],E.atoms[R].z=M[T++];E.box&&E.atomdfs&&E.adjustCoordinatesToBox(),S()}).catch(w)}else E.atoms=E.frames[h],S();E.molObj=null,E.modelDatas&&h<E.modelDatas.length&&(E.modelData=E.modelDatas[h],E.unitCellObjects&&m&&(m.removeUnitCell(E),m.addUnitCell(E)))})}addFrame(h){this.frames.push(h)}vibrate(h=10,f=1,E=!1,m){var S=0,w=h;let v=this.viewer;E&&(S=-h,w=h),this.frames!==void 0&&this.frames.origIndex!==void 0?this.setFrame(this.frames.origIndex):this.setFrame(0),S<w&&(this.frames=[]),E&&(this.frames.origIndex=h);for(var A=S;A<w;A++){var M=[],T=this.frames.length;if(A==0&&!m){this.frames.push(this.atoms);continue}for(var R=0;R<this.atoms.length;R++){var O=(0,d.getAtomProperty)(this.atoms[R],"dx"),L=(0,d.getAtomProperty)(this.atoms[R],"dy"),P=(0,d.getAtomProperty)(this.atoms[R],"dz"),I=new s.Vector3(O,L,P),N=new s.Vector3(this.atoms[R].x,this.atoms[R].y,this.atoms[R].z),U=A*f/h;I.multiplyScalar(U),N.add(I);var F={};for(var k in this.atoms[R])F[k]=this.atoms[R][k];if(F.x=N.x,F.y=N.y,F.z=N.z,M.push(F),v&&m){var j=(0,d.extend)({},m),H=new s.Vector3(O,L,P);if(H.multiplyScalar(f),H.add(N),j.start=N,j.end=H,j.frame=T,!j.color){var B=F.style.sphere;B||(B=F.style.stick),B||(B=F.style.line),j.color=(0,d.getColorFromStyle)(F,B)}v.addArrow(j)}}this.frames.push(M)}}setAtomDefaults(h){for(let f=0;f<h.length;f++){let E=h[f];E&&(E.style=E.style||(0,d.deepCopy)(b.defaultAtomStyle),E.color=E.color||this.ElementColors[E.elem]||this.defaultColor,E.model=this.id,(E.clickable||E.hoverable)&&(E.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(h,f,E={}){var m=b.parseMolData(h,f,E);this.dontDuplicateAtoms=!E.duplicateAssemblyAtoms;var S=m.modelData;if(S&&(Array.isArray(S)?(this.modelData=S[0],E.frames&&(this.modelDatas=S)):this.modelData=S),m.box?this.box=m.box:this.box=null,this.frames.length==0){for(let v=0;v<m.length;v++)m[v].length!=0&&this.frames.push(m[v]);this.frames[0]&&(this.atoms=this.frames[0])}else if(E.frames)for(let v=0;v<m.length;v++)this.frames.push(m[v]);else for(var w=0;w<m.length;w++)this.addAtoms(m[w]);for(let v=0;v<this.frames.length;v++)this.setAtomDefaults(this.frames[v]);E.vibrate&&E.vibrate.frames&&E.vibrate.amplitude&&this.vibrate(E.vibrate.frames,E.vibrate.amplitude),E.style&&this.setStyle({},E.style)}setDontDuplicateAtoms(h){this.dontDuplicateAtoms=h}setModelData(h){this.modelData=h}propertyMatches(h,f){if(h==f)return!0;if(typeof f=="string"&&typeof h=="number"){var E=f.match(/(-?\d+)\s*-\s*(-?\d+)/);if(E){var m=parseInt(E[1]),S=parseInt(E[2]);if(E&&h>=m&&h<=S)return!0}}return!1}static deepCopyAndCache(h,f){if(typeof h!="object"||h==null||h instanceof b||h.__cache_created)return h;const E={};for(const m in h){const S=h[m];if(Array.isArray(S)){E[m]=[];for(let w=0;w<S.length;w++)E[m].push(b.deepCopyAndCache(S[w],f))}else typeof S=="object"&&m!="properties"&&m!="model"?E[m]=b.deepCopyAndCache(S,f):E[m]=S;if(m=="and"||m=="or"){const w=[];for(const v of E[m]){const A=new Set;for(const M of f.selectedAtoms(v))A.add(M.index);w.push(A)}if(m=="and"){const v=function(M,T){const R=new Set;for(const O of T)M.has(O)&&R.add(O);return R};let A=new Set(w[0]);for(const M of w.splice(1))A=v(A,M);E[m].__cached_results=A}else if(m=="or"){const v=new Set;for(const A of w)for(const M of A)v.add(M);E[m].__cached_results=v}}}return E.__cache_created=!0,E}atomIsSelected(h,f){if(typeof f>"u")return!0;var E=!!f.invert,m=!0;for(var S in f)if(S=="and"||S=="or"||S=="not"){if(S=="not"){if(this.atomIsSelected(h,f[S])){m=!1;break}}else if(f[S].__cached_results===void 0&&(f=b.deepCopyAndCache(f,this)),m=f[S].__cached_results.has(h.index),!m)break}else if(S==="predicate"){if(!f.predicate(h)){m=!1;break}}else if(S=="properties"&&h[S]){for(var w in f.properties)if(!w.startsWith("__cache")){if(typeof h.properties[w]>"u"){m=!1;break}if(h.properties[w]!=f.properties[w]){m=!1;break}}}else if(S=="model"){let T=f.model;if(typeof T=="number"&&T<0&&(T=this.viewer.getNextModelId()+T),Array.isArray(T)){let R=!1;for(let O=0;O<T.length;O++)if(T[O]==this||T[O]==this.id){R=!0;break}if(!R){m=!1;break}}else if(T!=this&&T!=this.id){m=!1;break}}else if(f.hasOwnProperty(S)&&!b.ignoredKeys.has(S)&&!S.startsWith("__cache")){if(typeof h[S]>"u"){m=!1;break}let T=!1;if(S==="bonds"){var v=f[S];if(v!=h.bonds.length){m=!1;break}}else if(Array.isArray(f[S])){var A=f[S],M=h[S];for(let R=0;R<A.length;R++)if(this.propertyMatches(M,A[R])){T=!0;break}if(!T){m=!1;break}}else{let R=f[S];if(!this.propertyMatches(h[S],R)){m=!1;break}}}return E?!m:m}static squaredDistance(h,f){var E=f.x-h.x,m=f.y-h.y,S=f.z-h.z;return E*E+m*m+S*S}expandAtomList(h,f){if(f<=0)return h;for(var E=(0,d.getExtent)(h,void 0),m=[[],[],[]],S=0;S<3;S++)m[0][S]=E[0][S]-f,m[1][S]=E[1][S]+f,m[2][S]=E[2][S];var w=[];for(let T=0;T<this.atoms.length;T++){var v=this.atoms[T].x,A=this.atoms[T].y,M=this.atoms[T].z;v>=m[0][0]&&v<=m[1][0]&&A>=m[0][1]&&A<=m[1][1]&&M>=m[0][2]&&M<=m[1][2]&&(v>=E[0][0]&&v<=E[1][0]&&A>=E[0][1]&&A<=E[1][1]&&M>=E[0][2]&&M<=E[1][2]||w.push(this.atoms[T]))}return w}static getFloat(h){return typeof h=="number"?h:parseFloat(h)}selectedAtoms(h,f){var E=[];h=b.deepCopyAndCache(h||{},this),f||(f=this.atoms);for(var m=f.length,S=0;S<m;S++){var w=f[S];w&&this.atomIsSelected(w,h)&&E.push(w)}if(h.hasOwnProperty("expand")){const F=b.getFloat(h.expand);let k=this.expandAtomList(E,F),j=E.length;const H=F*F;for(let B=0;B<k.length;B++)for(let V=0;V<j;V++){var v=b.squaredDistance(k[B],E[V]);v<H&&v>0&&E.push(k[B])}}if(h.hasOwnProperty("within")&&h.within.hasOwnProperty("sel")&&h.within.hasOwnProperty("distance")){var A=this.selectedAtoms(h.within.sel,this.atoms),M={};const F=b.getFloat(h.within.distance),k=F*F;for(let j=0;j<A.length;j++)for(let H=0;H<E.length;H++){let B=b.squaredDistance(A[j],E[H]);B<k&&B>0&&(M[H]=1)}var T=[];if(h.within.invert)for(let j=0;j<E.length;j++)M[j]||T.push(E[j]);else for(let j in M)T.push(E[j]);E=T}if(h.hasOwnProperty("byres")){var R={},O=[],L=[];for(let F=0;F<E.length;F++){let k=E[F];var P=k.chain,I=k.resi;if(R[P]===void 0&&(R[P]={}),k.hasOwnProperty("resi")&&R[P][I]===void 0){for(R[P][I]=!0,L.push(k);L.length>0;)if(k=L.pop(),P=k.chain,I=k.resi,O[k.index]===void 0){O[k.index]=!0;for(var N=0;N<k.bonds.length;N++){var U=this.atoms[k.bonds[N]];O[U.index]===void 0&&U.hasOwnProperty("resi")&&U.chain==P&&U.resi==I&&(L.push(U),E.push(U))}}}}}return E}addAtoms(h){this.molObj=null;var f=this.atoms.length,E=[],m;for(m=0;m<h.length;m++)typeof h[m].index>"u"&&(h[m].index=m),typeof h[m].serial>"u"&&(h[m].serial=m),E[h[m].index]=f+m;for(m=0;m<h.length;m++){var S=h[m],w=E[S.index],v=(0,d.extend)({},S);v.index=w,v.bonds=[],v.bondOrder=[],v.model=this.id,v.style=v.style||(0,d.deepCopy)(b.defaultAtomStyle),typeof v.color>"u"&&(v.color=this.ElementColors[v.elem]||this.defaultColor);for(var A=S.bonds?S.bonds.length:0,M=0;M<A;M++){var T=E[S.bonds[M]];typeof T<"u"&&(v.bonds.push(T),v.bondOrder.push(S.bondOrder?S.bondOrder[M]:1))}this.atoms.push(v)}}assignBonds(){(0,y.assignBonds)(this.atoms,{assignBonds:!0})}removeAtoms(h){this.molObj=null;var f=[],E;for(E=0;E<h.length;E++)f[h[E].index]=!0;var m=[];for(E=0;E<this.atoms.length;E++){var S=this.atoms[E];f[S.index]||m.push(S)}this.atoms=[],this.addAtoms(m)}setStyle(h,f,E){typeof f>"u"&&typeof E>"u"&&(f=h,h={}),h=h,typeof f=="string"&&(f=(0,d.specStringToObject)(f));var m=!1,S=this,w=function(A){var M=S.selectedAtoms(h,A);for(let T=0;T<A.length;T++)A[T]&&(A[T].capDrawn=!1);for(let T=0;T<M.length;T++){m=!0,(M[T].clickable||M[T].hoverable)&&(M[T].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),E||(M[T].style={});for(let R in f)f.hasOwnProperty(R)&&(M[T].style[R]=M[T].style[R]||{},Object.assign(M[T].style[R],f[R]))}};if(h.frame!==void 0&&h.frame<this.frames.length){let A=h.frame;A<0&&(A=this.frames.length+A),w(this.frames[A])}else{w(this.atoms);for(var v=0;v<this.frames.length;v++)this.frames[v]!==this.atoms&&w(this.frames[v])}m&&(this.molObj=null)}setClickable(h,f,E){if(f=!!f,E=(0,d.makeFunction)(E),E===null){console.log("Callback is not a function");return}var m=this.selectedAtoms(h,this.atoms),S=m.length;for(let w=0;w<S;w++)m[w].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},m[w].clickable=f,E&&(m[w].callback=E);S>0&&(this.molObj=null)}setHoverable(h,f,E,m){if(f=!!f,E=(0,d.makeFunction)(E),m=(0,d.makeFunction)(m),E===null){console.log("Hover_callback is not a function");return}if(m===null){console.log("Unhover_callback is not a function");return}var S=this.selectedAtoms(h,this.atoms),w=S.length;for(let v=0;v<w;v++)S[v].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},S[v].hoverable=f,E&&(S[v].hover_callback=E),m&&(S[v].unhover_callback=m);w>0&&(this.molObj=null)}enableContextMenu(h,f){f=!!f;var E,m=this.selectedAtoms(h,this.atoms),S=m.length;for(E=0;E<S;E++)m[E].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},m[E].contextMenuEnabled=f;S>0&&(this.molObj=null)}setColorByElement(h,f){if(!(this.molObj!==null&&b.sameObj(f,this.lastColors))){this.lastColors=f;var E=this.selectedAtoms(h,E);E.length>0&&(this.molObj=null);for(var m=0;m<E.length;m++){var S=E[m];typeof f[S.elem]<"u"&&(S.color=f[S.elem])}}}setColorByProperty(h,f,E,m){var S,w,v=this.selectedAtoms(h,v);for(this.lastColors=null,v.length>0&&(this.molObj=null),typeof E=="string"&&typeof u.Gradient.builtinGradients[E]<"u"&&(E=new u.Gradient.builtinGradients[E]),E=E,m||(m=E.range()),m||(m=(0,d.getPropertyRange)(v,f)),S=0;S<v.length;S++){w=v[S];var A=(0,d.getAtomProperty)(w,f);A!=null&&(w.color=E.valueToHex(parseFloat(w.properties[f]),m))}}setColorByFunction(h,f){var E=this.selectedAtoms(h,E);if(typeof f=="function"){this.lastColors=null,E.length>0&&(this.molObj=null);for(let m=0;m<E.length;m++){let S=E[m];S.color=f(S)}}}toCDObject(h=!1){var f={a:[],b:[]};h&&(f.s=[]);for(let m=0;m<this.atoms.length;m++){let S={},w=this.atoms[m];if(S.x=w.x,S.y=w.y,S.z=w.z,w.elem!="C"&&(S.l=w.elem),h){for(var E=0;E<f.s.length&&JSON.stringify(w.style)!==JSON.stringify(f.s[E]);)E++;E===f.s.length&&f.s.push(w.style),E!==0&&(S.s=E)}f.a.push(S);for(let v=0;v<w.bonds.length;v++){let A=m,M=w.bonds[v];if(A>=M)continue;let T={b:A,e:M},R=w.bondOrder[v];R!=1&&(T.o=R),f.b.push(T)}}return f}globj(h,f){(this.molObj===null||f.regen)&&(this.molObj=this.createMolObj(this.atoms,f),this.renderedMolObj&&(h.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),h.add(this.renderedMolObj))}exportVRML(){var h=this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1});return h.vrml()}removegl(h){this.renderedMolObj&&(this.renderedMolObj.geometry!==void 0&&this.renderedMolObj.geometry.dispose(),this.renderedMolObj.material!==void 0&&this.renderedMolObj.material.dispose(),h.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(h,f,E){let m=this.selectedAtoms(f),S=this.viewer,w=(0,d.deepCopy)(E);for(let A=0;A<m.length;A++){let M=m[A];var v=null;typeof M[h]<"u"?v=String(M[h]):typeof M.properties[h]<"u"&&(v=String(M.properties[h])),v!=null&&(w.position=M,S.addLabel(v,w))}}addResLabels(h,f,E=!1){let m=this.viewer;var S=[],w=function(A,M){for(var T=A.selectedAtoms(h,T),R={},O=0;O<T.length;O++){var L=T[O],P=L.chain,I=L.resn,N=L.resi,U=I+""+N;R[P]||(R[P]={}),R[P][U]||(R[P][U]=[]),R[P][U].push(L)}var F=(0,d.deepCopy)(f);for(let j in R)if(R.hasOwnProperty(j)){var k=R[j];for(let H in k)if(k.hasOwnProperty(H)){let B=k[H],V=new s.Vector3(0,0,0);for(let K=0;K<B.length;K++){let J=B[K];V.x+=J.x,V.y+=J.y,V.z+=J.z}V.divideScalar(B.length),F.position=V,F.frame=M;let Y=m.addLabel(H,F,void 0,!0);S.push(Y)}}};if(E){var v=this.getNumFrames();let A=this.atoms;for(let M=0;M<v;M++)this.frames[M]&&(this.atoms=this.frames[M],w(this,M));this.atoms=A}else w(this);return S}setupDFS(){this.atomdfs=[];var h=this,f=new Int8Array(this.atoms.length);f.fill(0);for(var E=function(v,A,M){M.push([v,A]);var T=h.atoms[v];f[v]=1;for(var R=0;R<T.bonds.length;R++){var O=T.bonds[R];h.atoms[O]&&!f[O]&&E(O,v,M)}},m=0;m<this.atoms.length;m++){var S=this.atoms[m];if(S&&!f[m]){var w=[];E(m,-1,w),this.atomdfs.push(w)}}}setCoordinatesFromURL(h,f){this.frames=[];var E=this;return this.box&&this.setupDFS(),h.startsWith("http")||(h="http://"+h),(0,d.get)(h+"/traj/numframes/"+f,function(m){if(!isNaN(parseInt(m)))return E.frames.push(E.atoms),E.frames.numFrames=m,E.frames.url=h,E.frames.path=f,E.setFrame(0)})}setCoordinates(h,f){if(f=f||"",!h)return[];if(/\.gz$/.test(f)){f=f.replace(/\.gz$/,"");try{h=(0,d.inflateString)(h)}catch(R){console.log(R)}}var E={mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""};if(E.hasOwnProperty(f)){this.frames=[];for(var m=this.atoms.length,S=b.parseCrd(h,f),w=0;w<S.length;){for(var v=[],A=0;A<m;A++){var M={};for(var T in this.atoms[A])M[T]=this.atoms[A][T];v[A]=M,v[A].x=S[w++],v[A].y=S[w++],v[A].z=S[w++]}this.frames.push(v)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(h){}static parseCrd(h,f){var E=[],m=0;if(f=="pdb")for(var S=h.indexOf(`
ATOM`);S!=-1;){for(;h.slice(S,S+5)==`
ATOM`||h.slice(S,S+7)==`
HETATM`;)E[m++]=parseFloat(h.slice(S+31,S+39)),E[m++]=parseFloat(h.slice(S+39,S+47)),E[m++]=parseFloat(h.slice(S+47,S+55)),S=h.indexOf(`
`,S+54),h.slice(S,S+4)==`
TER`&&(S=h.indexOf(`
`,S+5));S=h.indexOf(`
ATOM`,S)}else if(f=="netcdf"){var w=new x.NetCDFReader(h);E=[].concat.apply([],w.getDataVariable("coordinates"))}else{if(f=="array"||Array.isArray(h))return h.flat(2);{let v=h.indexOf(`
`);f=="inpcrd"&&(v=h.indexOf(`
`,v+1)),h=h.slice(v+1),E=h.match(/\S+/g).map(parseFloat)}}return E}static parseMolData(h,f="",E){if(!h)return[];if(/\.gz$/.test(f)){f=f.replace(/\.gz$/,"");try{f.match(/bcif/i)?h=(0,d.inflateString)(h,!1):h=(0,d.inflateString)(h)}catch(w){console.log(w)}}typeof g.Parsers[f]>"u"&&(f=f.split(".").pop(),typeof g.Parsers[f]>"u"&&(console.log("Unknown format: "+f),h instanceof Uint8Array?f="bcif":h.match(/^@<TRIPOS>MOLECULE/gm)?f="mol2":h.match(/^data_/gm)&&h.match(/^loop_/gm)?f="cif":h.match(/^HETATM/gm)||h.match(/^ATOM/gm)?f="pdb":h.match(/ITEM: TIMESTEP/gm)?f="lammpstrj":h.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?f="sdf":h.match(/^%VERSION\s+VERSION_STAMP/gm)?f="prmtop":f="xyz",console.log("Best guess: "+f)));var m=g.Parsers[f],S=m(h,E);return S}}b.defaultAtomStyle={line:{}},b.defaultlineWidth=1,b.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86},b.ignoredKeys=new Set(["props","invert","model","frame","byres","expand","within","and","or","not"])}),"./src/GLShape.ts":((r,e,t)=>{t.r(e),t.d(e,{GLShape:()=>x,splitMesh:()=>y});var n=t("./src/WebGL/index.ts"),i=t("./src/WebGL/shapes/index.ts"),s=t("./src/WebGL/math/index.ts"),o=t("./src/colors.ts"),a=t("./src/ProteinSurface4.ts"),l=t("./src/VolumeData.ts"),d=t("./src/GLDraw.ts"),u=t("./src/glcartoon.ts"),g=t("./src/utilities.ts");class x{static finalizeGeo(_){var h=_.updateGeoGroup(0);h.vertices>0&&h.truncateArrayBuffers(!0,!0)}static updateColor(_,h){h=h||o.CC.color(h),_.colorsNeedUpdate=!0;var f,E,m;h.constructor!==Array&&(f=h.r,E=h.g,m=h.b);for(let S in _.geometryGroups){let w=_.geometryGroups[S],v=w.colorArray;for(let A=0,M=w.vertices;A<M;++A){if(h.constructor===Array){let T=h[A];f=T.r,E=T.g,m=T.b}v[A*3]=f,v[A*3+1]=E,v[A*3+2]=m}}}static drawArrow(_,h,f){var E=f.start,m=f.end,S=f.radius,w=f.radiusRatio,v=f.mid,A=f.midpos;if(!(E&&m))return;var M=h.updateGeoGroup(51),T=new s.Vector3(m.x,m.y,m.z).sub(E);if(A){let l0=T.length();A>0?v=A/l0:v=(l0+A)/l0}T.multiplyScalar(v);var R=new s.Vector3(E.x,E.y,E.z).add(T),O=T.clone().negate();let L=new s.Vector3(E.x,E.y,E.z);_.intersectionShape.cylinder.push(new i.Cylinder(L,R.clone(),S)),_.intersectionShape.sphere.push(new i.Sphere(L,S));var P=[];P[0]=T.clone(),Math.abs(P[0].x)>1e-4?P[0].y+=1:P[0].x+=1,P[0].cross(T),P[0].normalize(),P[4]=P[0].clone(),P[4].crossVectors(P[0],T),P[4].normalize(),P[8]=P[0].clone().negate(),P[12]=P[4].clone().negate(),P[2]=P[0].clone().add(P[4]).normalize(),P[6]=P[4].clone().add(P[8]).normalize(),P[10]=P[8].clone().add(P[12]).normalize(),P[14]=P[12].clone().add(P[0]).normalize(),P[1]=P[0].clone().add(P[2]).normalize(),P[3]=P[2].clone().add(P[4]).normalize(),P[5]=P[4].clone().add(P[6]).normalize(),P[7]=P[6].clone().add(P[8]).normalize(),P[9]=P[8].clone().add(P[10]).normalize(),P[11]=P[10].clone().add(P[12]).normalize(),P[13]=P[12].clone().add(P[14]).normalize(),P[15]=P[14].clone().add(P[0]).normalize();var I=M.vertices,N=M.vertexArray,U=M.faceArray,F=M.normalArray,k=M.lineArray,j,H,B;for(H=0,B=P.length;H<B;++H){j=3*(I+3*H);var V=P[H].clone().multiplyScalar(S).add(E),Y=P[H].clone().multiplyScalar(S).add(R),K=P[H].clone().multiplyScalar(S*w).add(R);if(N[j]=V.x,N[j+1]=V.y,N[j+2]=V.z,N[j+3]=Y.x,N[j+4]=Y.y,N[j+5]=Y.z,N[j+6]=K.x,N[j+7]=K.y,N[j+8]=K.z,H>0){var J=N[j-3],Te=N[j-2],He=N[j-1],Q=new s.Vector3(J,Te,He),Xe=new s.Vector3(m.x,m.y,m.z),ut=R.clone(),Ji=new s.Vector3(K.x,K.y,K.z);_.intersectionShape.triangle.push(new i.Triangle(Ji,Xe,Q)),_.intersectionShape.triangle.push(new i.Triangle(Q.clone(),ut,Ji.clone()))}}M.vertices+=48,j=M.vertices*3,N[j]=E.x,N[j+1]=E.y,N[j+2]=E.z,N[j+3]=R.x,N[j+4]=R.y,N[j+5]=R.z,N[j+6]=m.x,N[j+7]=m.y,N[j+8]=m.z,M.vertices+=3;var er,ec,ai,u0,o0,E0,F0,g0,w0,L0,T0,ht,We,h0,M0,Z,tt,tr,s0,c0=M.vertices-3,A0=M.vertices-2,P0=M.vertices-1,Fe=c0*3,f0=A0*3,v0=P0*3;for(H=0,B=P.length-1;H<B;++H){var D0=I+3*H;j=D0*3,ec=M.faceidx,ai=M.lineidx,u0=D0,L0=u0*3,o0=D0+1,T0=o0*3,E0=D0+2,ht=E0*3,F0=D0+4,We=F0*3,g0=D0+5,h0=g0*3,w0=D0+3,M0=w0*3,Z=tt=P[H],tr=s0=P[H+1],F[L0]=Z.x,F[T0]=tt.x,F[M0]=s0.x,F[L0+1]=Z.y,F[T0+1]=tt.y,F[M0+1]=s0.y,F[L0+2]=Z.z,F[T0+2]=tt.z,F[M0+2]=s0.z,F[T0]=tt.x,F[We]=tr.x,F[M0]=s0.x,F[T0+1]=tt.y,F[We+1]=tr.y,F[M0+1]=s0.y,F[T0+2]=tt.z,F[We+2]=tr.z,F[M0+2]=s0.z,F[ht]=tt.x,F[h0]=tr.x,F[ht+1]=tt.y,F[h0+1]=tr.y,F[ht+2]=tt.z,F[h0+2]=tr.z,U[ec]=u0,U[ec+1]=o0,U[ec+2]=w0,U[ec+3]=o0,U[ec+4]=F0,U[ec+5]=w0,U[ec+6]=u0,U[ec+7]=w0,U[ec+8]=c0,U[ec+9]=E0,U[ec+10]=A0,U[ec+11]=g0,U[ec+12]=E0,U[ec+13]=P0,U[ec+14]=g0,k[ai]=u0,k[ai+1]=o0,k[ai+2]=u0,k[ai+3]=w0,k[ai+4]=F0,k[ai+5]=w0,k[ai+6]=u0,k[ai+7]=w0,k[ai+8]=E0,k[ai+9]=o0,k[ai+10]=E0,k[ai+11]=g0,k[ai+12]=F0,k[ai+13]=g0,k[ai+14]=E0,k[ai+15]=P0,k[ai+16]=E0,k[ai+17]=g0,k[ai+18]=P0,k[ai+19]=g0,M.faceidx+=15,M.lineidx+=20}er=[I+45,I+46,I+1,I,I+47,I+2],ec=M.faceidx,ai=M.lineidx,u0=er[0],L0=u0*3,o0=er[1],T0=o0*3,E0=er[4],ht=E0*3,F0=er[2],We=F0*3,g0=er[5],h0=g0*3,w0=er[3],M0=w0*3,Z=tt=P[15],tr=s0=P[0],F[L0]=Z.x,F[T0]=tt.x,F[M0]=s0.x,F[L0+1]=Z.y,F[T0+1]=tt.y,F[M0+1]=s0.y,F[L0+2]=Z.z,F[T0+2]=tt.z,F[M0+2]=s0.z,F[T0]=tt.x,F[We]=tr.x,F[M0]=s0.x,F[T0+1]=tt.y,F[We+1]=tr.y,F[M0+1]=s0.y,F[T0+2]=tt.z,F[We+2]=tr.z,F[M0+2]=s0.z,F[ht]=tt.x,F[h0]=tr.x,F[ht+1]=tt.y,F[h0+1]=tr.y,F[ht+2]=tt.z,F[h0+2]=tr.z,T.normalize(),O.normalize(),F[Fe]=O.x,F[f0]=F[v0]=T.x,F[Fe+1]=O.y,F[f0+1]=F[v0+1]=T.y,F[Fe+2]=O.z,F[f0+2]=F[v0+2]=T.z,U[ec]=u0,U[ec+1]=o0,U[ec+2]=w0,U[ec+3]=o0,U[ec+4]=F0,U[ec+5]=w0,U[ec+6]=u0,U[ec+7]=w0,U[ec+8]=c0,U[ec+9]=E0,U[ec+10]=A0,U[ec+11]=g0,U[ec+12]=E0,U[ec+13]=P0,U[ec+14]=g0,k[ai]=u0,k[ai+1]=o0,k[ai+2]=u0,k[ai+3]=w0,k[ai+4]=F0,k[ai+5]=w0,k[ai+6]=u0,k[ai+7]=w0,k[ai+8]=E0,k[ai+9]=o0,k[ai+10]=E0,k[ai+11]=g0,k[ai+12]=F0,k[ai+13]=g0,k[ai+14]=E0,k[ai+15]=P0,k[ai+16]=E0,k[ai+17]=g0,k[ai+18]=P0,k[ai+19]=g0,M.faceidx+=15,M.lineidx+=20}static updateBoundingFromPoints(_,h,f,E){_.center.set(0,0,0);let m=1/0,S=1/0,w=1/0,v=-1/0,A=-1/0,M=-1/0;_.box&&(m=_.box.min.x,v=_.box.max.x,S=_.box.min.y,A=_.box.max.y,w=_.box.min.z,M=_.box.max.z);for(let L=0,P=E;L<P;L++){var T=f[L*3],R=f[L*3+1],O=f[L*3+2];T<m&&(m=T),R<S&&(S=R),O<w&&(w=O),T>v&&(v=T),R>A&&(A=R),O>M&&(M=O)}_.center.set((v+m)/2,(A+S)/2,(M+w)/2),_.radius=_.center.distanceTo({x:v,y:A,z:M}),_.box={min:{x:m,y:S,z:w},max:{x:v,y:A,z:M}}}static addCustomGeo(_,h,f,E,m){var S=h.addGeoGroup(),w=f.vertexArr,v=f.normalArr,A=f.faceArr;S.vertices=w.length,S.faceidx=A.length;var M,T,R,O,L,P,I,N,U,F=S.vertexArray,k=S.colorArray;for(E.constructor!==Array&&(N=E.r,U=E.g,O=E.b),P=0,I=S.vertices;P<I;++P)M=P*3,T=w[P],F[M]=T.x,F[M+1]=T.y,F[M+2]=T.z,E.constructor===Array&&(L=E[P],N=L.r,U=L.g,O=L.b),k[M]=N,k[M+1]=U,k[M+2]=O;if(m)for(P=0,I=S.faceidx/3;P<I;++P){M=P*3,R=A[M],O=A[M+1],L=A[M+2];var j=new s.Vector3,H=new s.Vector3,B=new s.Vector3;_.intersectionShape.triangle.push(new i.Triangle(j.copy(w[R]),H.copy(w[O]),B.copy(w[L])))}if(m){var V=new s.Vector3(0,0,0),Y=0;for(let Te=0;Te<h.geometryGroups.length;Te++)V.add(h.geometryGroups[Te].getCentroid()),Y++;V.divideScalar(Y),x.updateBoundingFromPoints(_.boundingSphere,{centroid:V},F,S.vertices)}if(S.faceArray=new Uint16Array(A),S.truncateArrayBuffers(!0,!0),v.length<S.vertices)S.setNormals();else{var K=S.normalArray=new Float32Array(S.vertices*3),J;for(P=0,I=S.vertices;P<I;++P)M=P*3,J=v[P],K[M]=J.x,K[M+1]=J.y,K[M+2]=J.z}S.setLineIndices(),S.lineidx=S.lineArray.length}static updateFromStyle(_,h){typeof h.color<"u"?(_.color=h.color||new o.Color,h.color instanceof o.Color||(_.color=o.CC.color(h.color))):_.color=o.CC.color(0),_.wireframe=!!h.wireframe,_.opacity=h.alpha?(0,s.clamp)(h.alpha,0,1):1,typeof h.opacity<"u"&&(_.opacity=(0,s.clamp)(h.opacity,0,1)),_.side=h.side!==void 0?h.side:n.DoubleSide,_.linewidth=typeof h.linewidth>"u"?1:h.linewidth,_.clickable=!!h.clickable,_.callback=(0,g.makeFunction)(h.callback),_.hoverable=!!h.hoverable,_.hover_callback=(0,g.makeFunction)(h.hover_callback),_.unhover_callback=(0,g.makeFunction)(h.unhover_callback),_.contextMenuEnabled=!!h.contextMenuEnabled,_.hidden=h.hidden,_.frame=h.frame}constructor(_){this.color=16777215,this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.contextMenuEnabled=!1,this.side=n.DoubleSide,this.stylespec=_||{},this.boundingSphere=new i.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},x.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new n.Geometry(!0),this.linegeo=new n.Geometry(!0)}updateStyle(_){for(var h in _)this.stylespec[h]=_[h];if(x.updateFromStyle(this,this.stylespec),_.voldata&&_.volscheme){(0,g.adjustVolumeStyle)(_);const f=_.volscheme,E=_.voldata,m=o.CC,S=f.range()||[-1,1];this.geo.setColors(function(w,v,A){let M=E.getVal(w,v,A);return m.color(f.valueToHex(M,S))}),delete this.color}}addCustom(_){_.vertexArr=_.vertexArr||[],_.faceArr=_.faceArr||[],_.normalArr=_.normalArr||[],x.drawCustom(this,this.geo,_)}addSphere(_){_.center||(_.center=new s.Vector3(0,0,0)),_.radius=_.radius?(0,s.clamp)(_.radius,0,1/0):1.5,_.color=o.CC.color(_.color),this.intersectionShape.sphere.push(new i.Sphere(_.center,_.radius)),d.GLDraw.drawSphere(this.geo,_.center,_.radius,_.color,_.quality),this.components.push({centroid:new s.Vector3(_.center.x,_.center.y,_.center.z)});var h=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,h.vertexArray,h.vertices)}addBox(_){var h=_.dimensions||{w:1,h:1,d:1},f;typeof h.w=="number"?f={x:h.w,y:0,z:0}:f=h.w;var E;typeof h.h=="number"?E={x:0,y:h.h,z:0}:E=h.h;var m;typeof h.d=="number"?m={x:0,y:0,z:h.d}:m=h.d;var S=_.corner;S==null&&(_.center!==void 0?S={x:_.center.x-.5*(f.x+E.x+m.x),y:_.center.y-.5*(f.y+E.y+m.y),z:_.center.z-.5*(f.z+E.z+m.z)}:S={x:0,y:0,z:0});var w=[{x:S.x,y:S.y,z:S.z},{x:S.x+f.x,y:S.y+f.y,z:S.z+f.z},{x:S.x+E.x,y:S.y+E.y,z:S.z+E.z},{x:S.x+f.x+E.x,y:S.y+f.y+E.y,z:S.z+f.z+E.z},{x:S.x+m.x,y:S.y+m.y,z:S.z+m.z},{x:S.x+f.x+m.x,y:S.y+f.y+m.y,z:S.z+f.z+m.z},{x:S.x+E.x+m.x,y:S.y+E.y+m.y,z:S.z+E.z+m.z},{x:S.x+f.x+E.x+m.x,y:S.y+f.y+E.y+m.y,z:S.z+f.z+E.z+m.z}],v=[],A=[];v.splice(v.length,0,w[0],w[1],w[2],w[3]),A.splice(A.length,0,0,2,1,1,2,3);var M=4;v.splice(v.length,0,w[2],w[3],w[6],w[7]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4,v.splice(v.length,0,w[4],w[5],w[0],w[1]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4,v.splice(v.length,0,w[6],w[7],w[4],w[5]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4,v.splice(v.length,0,w[3],w[1],w[7],w[5]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4,v.splice(v.length,0,w[2],w[6],w[0],w[4]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4;var T=(0,g.extend)({},_);T.vertexArr=v,T.faceArr=A,T.normalArr=[],x.drawCustom(this,this.geo,T);var R=new s.Vector3;this.components.push({centroid:R.addVectors(w[0],w[7]).multiplyScalar(.5)});var O=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,O.vertexArray,O.vertices)}addCylinder(_){var h,f;_.start?h=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):h=new s.Vector3(0,0,0),_.end?(f=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),typeof f.x>"u"&&(f.x=3)):f=new s.Vector3(0,0,0);var E=_.radius||.1,m=o.CC.color(_.color);this.intersectionShape.cylinder.push(new i.Cylinder(h,f,E)),d.GLDraw.drawCylinder(this.geo,h,f,E,m,_.fromCap,_.toCap);var S=new s.Vector3;this.components.push({centroid:S.addVectors(h,f).multiplyScalar(.5)});var w=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,w.vertexArray,w.vertices)}addDashedCylinder(_){_.dashLength=_.dashLength||.25,_.gapLength=_.gapLength||.25;var h;_.start?h=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):h=new s.Vector3(0,0,0);var f;_.end?(f=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),typeof f.x>"u"&&(f.x=3)):f=new s.Vector3(3,0,0);for(var E=_.radius||.1,m=o.CC.color(_.color),S=Math.sqrt(Math.pow(h.x-f.x,2)+Math.pow(h.y-f.y,2)+Math.pow(h.z-f.z,2)),w=S/(_.gapLength+_.dashLength),v=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0),A=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),M=new s.Vector3((f.x-h.x)/(S/_.gapLength),(f.y-h.y)/(S/_.gapLength),(f.z-h.z)/(S/_.gapLength)),T=new s.Vector3((f.x-h.x)/(S/_.dashLength),(f.y-h.y)/(S/_.dashLength),(f.z-h.z)/(S/_.dashLength)),R=0;R<w;R++)A=new s.Vector3(v.x+T.x,v.y+T.y,v.z+T.z),this.intersectionShape.cylinder.push(new i.Cylinder(v,A,E)),d.GLDraw.drawCylinder(this.geo,v,A,E,m,_.fromCap,_.toCap),v=new s.Vector3(A.x+M.x,A.y+M.y,A.z+M.z);var O=new s.Vector3;this.components.push({centroid:O.addVectors(h,f).multiplyScalar(.5)});var L=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,L.vertexArray,L.vertices)}addCurve(_){_.points=_.points||[],_.smooth=_.smooth||10,typeof _.fromCap>"u"&&(_.fromCap=2),typeof _.toCap>"u"&&(_.toCap=2);var h=(0,u.subdivide_spline)(_.points,_.smooth);if(h.length<3){console.log("Too few points in addCurve");return}var f=_.radius||.1,E=o.CC.color(_.color),m=0,S=h.length-1,w=h[0].distanceTo(h[1]),v=Math.ceil(2*f/w);if(_.toArrow){S-=v;let R={start:h[S],end:h[h.length-1],radius:f,color:E,mid:1e-4};this.addArrow(R)}if(_.fromArrow){m+=v;let R={start:h[m],end:h[0],radius:f,color:E,mid:1e-4};this.addArrow(R)}for(var A=Math.ceil(h.length/2),M={radius:f,color:E,fromCap:2,toCap:2},T=m;T<S;T++)M.start=h[T],M.end=h[T+1],M.fromCap=2,M.toCap=2,T<A?(M.fromCap=2,M.toCap=0):T>A?(M.fromCap=0,M.toCap=2):(M.fromCap=2,M.toCap=2),this.addCylinder(M)}addLine(_){var h,f;_.start?h=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):h=new s.Vector3(0,0,0),_.end?(f=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),typeof f.x>"u"&&(f.x=3)):f=new s.Vector3(3,0,0);var E=this.geo.updateGeoGroup(2),m=E.vertices,S=m*3,w=E.vertexArray;w[S]=h.x,w[S+1]=h.y,w[S+2]=h.z,w[S+3]=f.x,w[S+4]=f.y,w[S+5]=f.z,E.vertices+=2;var v=E.lineArray,A=E.lineidx;v[A]=m,v[A+1]=m+1,E.lineidx+=2;var M=new s.Vector3;this.components.push({centroid:M.addVectors(h,f).multiplyScalar(.5)}),E=this.geo.updateGeoGroup(0),x.updateBoundingFromPoints(this.boundingSphere,this.components,E.vertexArray,E.vertices)}addArrow(_){if(_.start?_.start=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):_.start=new s.Vector3(0,0,0),_.dir instanceof s.Vector3&&typeof _.length=="number"){var h=_.dir.clone().multiplyScalar(_.length).add(_.start);_.end=h}else _.end?(_.end=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),typeof _.end.x>"u"&&(_.end.x=3)):_.end=new s.Vector3(3,0,0);_.radius=_.radius||.1,_.radiusRatio=_.radiusRatio||1.618034,_.mid=0<_.mid&&_.mid<1?_.mid:.618034,x.drawArrow(this,this.geo,_);var f=new s.Vector3;this.components.push({centroid:f.addVectors(_.start,_.end).multiplyScalar(.5)});var E=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,E.vertexArray,E.vertices)}static distance_from(_,h){return Math.sqrt(Math.pow(_.x-h.x,2)+Math.pow(_.y-h.y,2)+Math.pow(_.z-h.z,2))}static inSelectedRegion(_,h,f){for(var E=0;E<h.length;E++)if(x.distance_from(h[E],_)<=f)return!0;return!1}addIsosurface(_,h,f,E){var m=h.isoval!==void 0&&typeof h.isoval=="number"?h.isoval:0,S=!!h.voxel,w=h.smoothness===void 0?1:h.smoothness,v=_.size.x,A=_.size.y,M=_.size.z,T=new Int16Array(v*A*M),R=_.data,O,L;for(O=0,L=T.length;O<L;++O)T[O]=-1;var P=new Uint8Array(v*A*M);for(O=0,L=R.length;O<L;++O){var I=m>=0?R[O]-m:m-R[O];I>0&&(P[O]|=x.ISDONE)}var N=[],U=[];a.MarchingCube.march(P,N,U,{fulltable:!0,voxel:S,unitCube:_.unit,origin:_.origin,matrix:_.matrix,nX:v,nY:A,nZ:M}),!S&&w>0&&a.MarchingCube.laplacianSmooth(w,N,U);var F=[],k=[],j=[];if(h.selectedRegion&&h.coords===void 0&&(h.coords=h.selectedRegion),h.coords===void 0&&h.selection!==void 0&&(E?h.coords=E.selectedAtoms(h.selection):console.log("addIsosurface needs viewer is selection provided.")),h.coords!==void 0){var H=h.coords[0].x,B=h.coords[0].y,V=h.coords[0].z,Y=h.coords[0].x,K=h.coords[0].y,J=h.coords[0].z;for(let ai=0;ai<h.coords.length;ai++)h.coords[ai].x>H?H=h.coords[ai].x:h.coords[ai].x<Y&&(Y=h.coords[ai].x),h.coords[ai].y>B?B=h.coords[ai].y:h.coords[ai].y<K&&(K=h.coords[ai].y),h.coords[ai].z>V?V=h.coords[ai].z:h.coords[ai].z<J&&(J=h.coords[ai].z);var Te=2;h.radius!==void 0&&(Te=h.radius),h.selectedOffset!==void 0&&(Te=h.selectedOffset),h.seldist!==void 0&&(Te=h.seldist),Y-=Te,H+=Te,K-=Te,B+=Te,J-=Te,V+=Te;for(let ai=0;ai<N.length;ai++)N[ai].x>Y&&N[ai].x<H&&N[ai].y>K&&N[ai].y<B&&N[ai].z>J&&N[ai].z<V&&x.inSelectedRegion(N[ai],h.coords,Te)?(F.push(k.length),k.push(N[ai])):F.push(-1);for(let ai=0;ai+2<U.length;ai+=3)F[U[ai]]!==-1&&F[U[ai+1]]!==-1&&F[U[ai+2]]!==-1&&(j.push(U[ai]-(U[ai]-F[U[ai]])),j.push(U[ai+1]-(U[ai+1]-F[U[ai+1]])),j.push(U[ai+2]-(U[ai+2]-F[U[ai+2]])));N=k,U=j}x.drawCustom(this,this.geo,{vertexArr:N,faceArr:U,normalArr:[],clickable:h.clickable,hoverable:h.hoverable}),this.updateStyle(h);var He=new s.Vector3(_.origin.x,_.origin.y,_.origin.z),Q=new s.Vector3(_.size.x*_.unit.x,_.size.y*_.unit.y,_.size.z*_.unit.z),Xe=new s.Vector3(0,0,0),ut=He.clone(),Ji=He.clone().add(Q);for(let ai=0;ai<N.length;ai++)Xe.add(N[ai]),ut.max(N[ai]),Ji.min(N[ai]);Xe.divideScalar(N.length);var er=Xe.distanceTo(Ji),ec=Xe.distanceTo(ut);this.boundingSphere.center=Xe,this.boundingSphere.radius=Math.max(er,ec),typeof f=="function"&&f()}addVolumetricData(_,h,f){_=new l.VolumeData(_,h),this.addIsosurface(_,f)}finalize(){return x.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(_){if(this.renderedShapeObj&&(_.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){x.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),typeof this.color<"u"&&x.updateColor(this.geo,this.color),this.shapeObj=new n.Object3D;var h=null;this.side==n.DoubleSide?h=new n.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:n.Coloring.VertexColors}):h=new n.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:n.Coloring.VertexColors});var f=new n.Mesh(this.geo,h);if(this.shapeObj.add(f),this.linegeo&&this.linegeo.vertices>0){var E=new n.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),m=new n.Line(this.linegeo,E,n.LineStyle.LinePieces);this.shapeObj.add(m)}this.renderedShapeObj=this.shapeObj.clone(),_.add(this.renderedShapeObj)}}removegl(_){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),_.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}x.ISDONE=2,x.drawCustom=function(b,_,h){var f=h,E=f.vertexArr,m=f.faceArr;(E.length===0||m.length===0)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var S=h.color;typeof S>"u"&&(S=b.color),S=o.CC.color(S);for(var w=y(f),v=0,A=w.length;v<A;v++)x.addCustomGeo(b,_,w[v],w[v].colorArr?w[v].colorArr:S,h.clickable)};function y(b){var _=64e3;if(b.vertexArr.length<_)return[b];var h=[{vertexArr:[],normalArr:[],faceArr:[]}];b.colorArr&&(h.colorArr=[]);var f=[],E=[],m=0,S=b.faceArr;for(let v=0,A=S.length;v<A;v+=3){let M=h[m];for(let T=0;T<3;T++){var w=S[v+T];f[w]!==m&&(f[w]=m,E[w]=M.vertexArr.length,M.vertexArr.push(b.vertexArr[w]),b.normalArr&&b.normalArr[w]&&M.normalArr.push(b.normalArr[w]),b.colorArr&&b.colorArr[w]&&M.colorArr.push(b.colorArr[w])),M.faceArr.push(E[w])}M.vertexArr.length>=_&&(h.push({vertexArr:[],normalArr:[],faceArr:[]}),b.colorArr&&(h.colorArr=[]),m++)}return h}}),"./src/GLViewer.ts":((r,e,t)=>{t.r(e),t.d(e,{CONTEXTS_PER_VIEWPORT:()=>_,GLViewer:()=>f,createStereoViewer:()=>S,createViewer:()=>E,createViewerGrid:()=>m});var n=t("./node_modules/upng-js/UPNG.js"),i=t("./src/GLModel.ts"),s=t("./src/GLShape.ts"),o=t("./src/Gradient.ts"),a=t("./src/Label.ts"),l=t("./src/ProteinSurface4.ts"),d=t("./src/VolumeData.ts"),u=t("./src/VolumetricRender.ts"),g=t("./src/WebGL/index.ts"),x=t("./src/WebGL/math/index.ts"),y=t("./src/colors.ts"),b=t("./src/utilities.ts");const _=16;class h extends Array{constructor(v){super(...v)}getSymmetries(){if(this.length==0)return[];let v=this[0];return typeof v.symmetries>"u"&&this.setSymmetries([new x.Matrix4]),v.symmetries}setSymmetries(v){typeof v>"u"&&(v=[new x.Matrix4]);for(let A of this)A.symmetries=v,A.finished=!1}}class f{getWidth(){let v=this.container,A=v.offsetWidth;if(A==0&&v.style.display==="none"){let M=v.style.position,T=v.style.visibility;v.style.display="block",v.style.visibility="hidden",v.style.position="absolute",A=v.offsetWidth,v.style.display="none",v.style.visibility=T,v.style.position=M}return A}getHeight(){let v=this.container,A=v.offsetHeight;if(A==0&&v.style.display==="none"){let M=v.style.position,T=v.style.visibility;v.style.display="block",v.style.visibility="hidden",v.style.position="absolute",A=v.offsetHeight,v.style.display="none",v.style.visibility=T,v.style.position=M}return A}setupRenderer(){let v=Object.assign(Object.assign({},this.config),{preserveDrawingBuffer:!0,premultipliedAlpha:!1,containerWidth:this.WIDTH,containerHeight:this.HEIGHT});this.renderer=new g.Renderer(v),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new g.Scene,this.scene.fog=new g.Fog(this.bgColor,100,200),this.modelGroup=new g.Object3D,this.rotationGroup=new g.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new x.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var v=new g.Light(16777215);v.position=new x.Vector3(.2,.2,1).normalize(),v.intensity=1,this.scene.add(v)}_handleLostContext(v){const A=function(M){const T=M.getBoundingClientRect();return!(T.right<0||T.bottom<0||T.top>(window.innerHeight||document.documentElement.clientHeight)||T.left>(window.innerWidth||document.documentElement.clientWidth))};if(A(this.container)){let M=0;for(let T of document.getElementsByTagName("canvas"))if(A(T)&&T._3dmol_viewer!=null&&(T._3dmol_viewer.resize(),M+=1,M>=_))break}}initContainer(v){this.container=v,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,this.glDOM._3dmol_viewer=this,this.glDOM.addEventListener("webglcontextlost",this._handleLostContext.bind(this)),this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var v=0;for(let M in this.surfaces)if(this.surfaces.hasOwnProperty(M)){var A=parseInt(M);isNaN(A)||A>v&&(v=A)}return v+1}setSlabAndFog(){let v=this.camera.position.z-this.rotationGroup.position.z;v<1&&(v=1),this.camera.near=v+this.slabNear,!this.camera.ortho&&this.camera.near<1&&(this.camera.near=1),this.camera.far=v+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=v*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.near+this.fogEnd*(this.camera.far-this.camera.near),this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(v){if(this.renderer.setViewport(),!!this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!v&&this.linkedViewers.length>0))for(var A=this._viewer.getView(),M=0;M<this.linkedViewers.length;M++){var T=this.linkedViewers[M];T.setView(A,!0)}}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledObjects.splice(0,this.contextMenuEnabledObjects.length);for(let v=0,A=this.models.length;v<A;v++){let M=this.models[v];if(M){let T=M.selectedAtoms({clickable:!0}),R=M.selectedAtoms({hoverable:!0}),O=M.selectedAtoms({contextMenuEnabled:!0});for(let L=0;L<R.length;L++)this.hoverables.push(R[L]);for(let L=0;L<T.length;L++)this.clickables.push(T[L]);for(let L=0;L<O.length;L++)this.contextMenuEnabledObjects.push(O[L])}}for(let v=0,A=this.shapes.length;v<A;v++){let M=this.shapes[v];M&&M.clickable&&this.clickables.push(M),M&&M.hoverable&&this.hoverables.push(M),M&&M.contextMenuEnabled&&this.contextMenuEnabledObjects.push(M)}}handleClickSelection(v,A,M){let T=this.targetedObjects(v,A,this.clickables);if(T.length){var R=T[0].clickable;R.callback!==void 0&&(typeof R.callback!="function"&&(R.callback=(0,b.makeFunction)(R.callback)),typeof R.callback=="function"&&(this.mouseButton===3&&this.contextMenuEnabledObjects.includes(R)&&this.userContextMenuHandler||R.callback(R,this._viewer,M,this.container,T)))}}canvasOffset(){let v=this.glDOM,A=v.getBoundingClientRect(),M=v.ownerDocument,T=M.documentElement,R=M.defaultView;return{top:A.top+R.pageYOffset-T.clientTop,left:A.left+R.pageXOffset-T.clientLeft}}setHover(v,A,M){this.current_hover!=v&&(this.current_hover&&(typeof this.current_hover.unhover_callback!="function"&&(this.current_hover.unhover_callback=(0,b.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,A,this.container,M)),this.current_hover=v,v&&v.hover_callback!==void 0&&(typeof v.hover_callback!="function"&&(v.hover_callback=(0,b.makeFunction)(v.hover_callback)),typeof v.hover_callback=="function"&&v.hover_callback(v,this._viewer,A,this.container,M)))}handleHoverSelection(v,A,M){if(this.hoverables.length==0)return;let T=this.targetedObjects(v,A,this.hoverables);if(T.length){var R=T[0].clickable;this.setHover(R,M,T),this.current_hover=R}else this.setHover(null)}handleHoverContinue(v,A){let M=this.targetedObjects(v,A,this.hoverables);(M.length==0||M[0]===void 0)&&this.setHover(null),M[0]!==void 0&&M[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(v,{allowTolerance:A=v.targetTouches,tolerance:M=5}={}){const T=this.getX(v),R=this.getY(v);if(A){const O=Math.abs(T-this.mouseStartX),L=Math.abs(R-this.mouseStartY);return O<=M&&L<=M}else return T===this.mouseStartX&&R===this.mouseStartY}calcTouchDistance(v){var A=v.targetTouches[0].pageX-v.targetTouches[1].pageX,M=v.targetTouches[0].pageY-v.targetTouches[1].pageY;return Math.hypot(A,M)}getX(v){var A=v.pageX;return A==null&&(A=v.pageX),v.targetTouches&&v.targetTouches[0]?A=v.targetTouches[0].pageX:v.changedTouches&&v.changedTouches[0]&&(A=v.changedTouches[0].pageX),A}getY(v){var A=v.pageY;return A==null&&(A=v.pageY),v.targetTouches&&v.targetTouches[0]?A=v.targetTouches[0].pageY:v.changedTouches&&v.changedTouches[0]&&(A=v.changedTouches[0].pageY),A}isInViewer(v,A){if(this.viewers!=null){var M=this.WIDTH/this.cols,T=this.HEIGHT/this.rows,R=this.canvasOffset(),O=v-R.left,L=A-R.top,P=this.rows-Math.floor(L/T)-1,I=Math.floor(O/M);if(P!=this.row||I!=this.col)return!1}return!0}adjustZoomToLimits(v){if(this.config.lowerZoomLimit&&this.config.lowerZoomLimit>0){let A=this.CAMERA_Z-this.config.lowerZoomLimit;v>A&&(v=A)}if(this.config.upperZoomLimit&&this.config.upperZoomLimit>0){let A=this.CAMERA_Z-this.config.upperZoomLimit;v<A&&(v=A)}return v>this.CAMERA_Z-1&&(v=this.CAMERA_Z-1),v}static slerp(v,A,M){if(M==1)return A.clone();if(M==0)return v.clone();let T=v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w;if(T>.9995){let U=new x.Quaternion(v.x+M*(A.x-v.x),v.y+M*(A.y-v.y),v.z+M*(A.z-v.z),v.w+M*(A.w-v.w));return U.normalize(),U}T<0&&(A=A.clone().multiplyScalar(-1),T=-T),T>1?T=1:T<-1&&(T=-1);var R=Math.acos(T),O=R*M,L=A.clone();L.sub(v.clone().multiplyScalar(T)),L.normalize();var P=Math.cos(O),I=Math.sin(O),N=new x.Quaternion(v.x*P+L.x*I,v.y*P+L.y*I,v.z*P+L.z*I,v.w*P+L.w*I);return N.normalize(),N}constructor(v,A={}){if(this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledObjects=[],this.current_hover=null,this.hoverDuration=500,this.longTouchDuration=1e3,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.fogEnd=1,this.slabNear=-50,this.slabFar=50,this.cq=new x.Quaternion(0,0,0,1),this.dq=new x.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=A,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=y.elementColors.defaultColors),this.nomouse=!!this.config.nomouse,this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",typeof this.config.backgroundColor<"u"&&(this.bgColor=y.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=this.config.backgroundAlpha==null?1:this.config.backgroundAlpha,this.camerax=0,typeof this.config.camerax<"u"&&(this.camerax=typeof this.config.camerax=="string"?parseFloat(this.config.camerax):this.config.camerax),this._viewer=this,this.container=v,this.config.hoverDuration!=null&&(this.hoverDuration=this.config.hoverDuration),this.config.antialias===void 0&&(this.config.antialias=!0),this.config.cartoonQuality===void 0&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=this.config.row==null?0:this.config.row,this.col=this.config.col==null?0:this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new g.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new x.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new x.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new g.Raycaster(new x.Vector3(0,0,0),new x.Vector3(0,0,0)),this.projector=new g.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=y.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),typeof window.ResizeObserver<"u"&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container)),typeof window.IntersectionObserver<"u"){let M=(T,R)=>{T.forEach(O=>{O.isIntersecting&&this.resize()})};this.intwatcher=new window.IntersectionObserver(M),this.intwatcher.observe(this.container)}try{typeof this.callback=="function"&&this.callback(this)}catch(M){console.log("error with glviewer callback: "+M)}}targetedObjects(v,A,M){var T={x:v,y:A,z:-1};return Array.isArray(M)||(M=this.selectedAtoms(M)),M.length==0?[]:(this.raycaster.setFromCamera(T,this.camera),this.raycaster.intersectObjects(this.modelGroup,M))}modelToScreen(v){let A=!1;Array.isArray(v)||(v=[v],A=!0);let M=this.renderer.getXRatio(),T=this.renderer.getYRatio(),R=this.col,O=this.row,L=R*(this.WIDTH/M),P=(T-O-1)*(this.HEIGHT/T),I=[],N=this.canvasOffset();return v.forEach(U=>{let F=new x.Vector3(U.x,U.y,U.z);F.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(F,this.camera);let k=this.WIDTH/M*(F.x+1)/2+N.left+L,j=-(this.HEIGHT/T)*(F.y-1)/2+N.top+P;I.push({x:k,y:j})}),A&&(I=I[0]),I}screenOffsetToModel(v,A,M){var T=v/this.WIDTH,R=A/this.HEIGHT,O=M===void 0?this.rotationGroup.position.z:M,L=this.rotationGroup.quaternion,P=new x.Vector3(0,0,O);return this.projector.projectVector(P,this.camera),P.x+=T*2,P.y-=R*2,this.projector.unprojectVector(P,this.camera),P.z=0,P.applyQuaternion(L),P}screenToModelDistance(v,A){let M=this.canvasOffset(),T=new x.Vector3(A.x,A.y,A.z);T.applyMatrix4(this.modelGroup.matrixWorld);let R=T.clone();this.projector.projectVector(T,this.camera);let O=new x.Vector3((v.x-M.left)*2/this.WIDTH-1,(v.y-M.top)*2/-this.HEIGHT+1,T.z);return this.projector.unprojectVector(O,this.camera),O.distanceTo(R)}setViewChangeCallback(v){(typeof v=="function"||v==null)&&(this.viewChangeCallback=v)}setStateChangeCallback(v){(typeof v=="function"||v==null)&&(this.stateChangeCallback=v)}getConfig(){return this.config}setConfig(v){this.config=v,v.ambientOcclusion&&this.renderer.enableAmbientOcclusion(v.ambientOcclusion)}getInternalState(){var v={models:[],surfaces:[],shapes:[],labels:[]};for(let A=0;A<this.models.length;A++)this.models[A]&&(v.models[A]=this.models[A].getInternalState());return v}setInternalState(v){this.clear();var A=v.models;for(let M=0;M<A.length;M++)A[M]&&(this.models[M]=new i.GLModel(M,void 0,this),this.models[M].setInternalState(A[M]));this.render()}setZoomLimits(v,A){typeof v<"u"&&(this.config.lowerZoomLimit=v),A&&(this.config.upperZoomLimit=A),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(v){v.fov!==void 0&&(this.fov=v.fov,this.camera.fov=this.fov),v.z!==void 0&&(this.CAMERA_Z=v.z,this.camera.z=this.CAMERA_Z),v.orthographic!==void 0&&(this.camera.ortho=v.orthographic),this.setSlabAndFog()}_handleMouseDown(v){if(v.preventDefault(),!this.scene)return;var A=this.getX(v),M=this.getY(v);if(A===void 0)return;this.isDragging=!0,this.mouseButton=v.which,this.mouseStartX=A,this.mouseStartY=M,this.touchHold=!0,this.touchDistanceStart=0,v.targetTouches&&v.targetTouches.length==2&&(this.touchDistanceStart=this.calcTouchDistance(v)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let T=this;v.targetTouches&&v.targetTouches.length===1&&(this.longTouchTimeout=setTimeout(function(){if(T.touchHold==!0){T.glDOM=T.renderer.domElement;const R=v.targetTouches[0],O=new PointerEvent("contextmenu",Object.assign(Object.assign({},v),{pageX:R.pageX,pageY:R.pageY,screenX:R.screenX,screenY:R.screenY,clientX:R.clientX,clientY:R.clientY}));T.glDOM.dispatchEvent(O)}},this.longTouchDuration))}_handleMouseUp(v){if(this.touchHold=!1,this.isDragging&&this.scene){var A=this.getX(v),M=this.getY(v);if(this.closeEnoughForClick(v)&&this.isInViewer(A,M)){let T=this.mouseXY(A,M);this.handleClickSelection(T.x,T.y,v)}}this.isDragging=!1}_handleMouseScroll(v){if(v.preventDefault(),!!this.scene){var A=this.getX(v),M=this.getY(v);if(A!==void 0&&!(!this.control_all&&!this.isInViewer(A,M))){var T=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,R=1;if(v.ctrlKey&&(R=-1),v.detail)this.rotationGroup.position.z+=R*T*v.detail/10;else if(v.wheelDelta){let O=v.wheelDelta*600/(v.wheelDelta+600);this.rotationGroup.position.z-=R*T*O/400}this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}}}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(v){let A=this;return v=v||1,new Promise(function(M){let T=0,R=A.viewChangeCallback,O=[],L=[],P=Date.now();A.viewChangeCallback=function(){L.push(Date.now()-P),P=Date.now(),O.push(new Promise(I=>{A.getCanvas().toBlob(function(N){N.arrayBuffer().then(I)},"image/png")})),T+=1,T==v&&(A.viewChangeCallback=R,Promise.all(O).then(I=>{let N=[];for(let B=0;B<I.length;B++){let V=(0,n.decode)(I[B]);N.push((0,n.toRGBA8)(V)[0])}let U=A.getCanvas().width,F=A.getCanvas().height,k=(0,n.encode)(N,U,F,0,L),j=new Blob([k],{type:"image/png"}),H=new FileReader;H.onload=function(B){M(B.target.result)},H.readAsDataURL(j)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(v){this.hoverDuration=v}mouseXY(v,A){let M=this.canvasOffset(),T=this.renderer.getXRatio(),R=this.renderer.getYRatio(),O=this.col,L=this.row,P=O*(this.WIDTH/T),I=(R-L-1)*(this.HEIGHT/R),N=(v-M.left-P)/(this.WIDTH/T)*2-1,U=-((A-M.top-I)/(this.HEIGHT/R))*2+1;return{x:N,y:U}}_handleMouseMove(v){clearTimeout(this.hoverTimeout),v.preventDefault();let A=this.getX(v),M=this.getY(v);if(A===void 0)return;let T=this.renderer.getXRatio(),R=this.renderer.getYRatio(),O=this.mouseXY(A,M),L=this;this.current_hover!==null&&this.handleHoverContinue(O.x,O.y);var P=0;if(!(!this.control_all&&!this.isInViewer(A,M))&&this.scene&&(this.hoverables.length>0&&(this.hoverTimeout=setTimeout(function(){L.handleHoverSelection(O.x,O.y,v)},this.hoverDuration)),!!this.isDragging)){v.targetTouches&&(v.targetTouches.length>1||v.targetTouches.length===1&&!this.closeEnoughForClick(v))&&clearTimeout(this.longTouchTimeout);var I=(A-this.mouseStartX)/this.WIDTH,N=(M-this.mouseStartY)/this.HEIGHT;if(this.touchDistanceStart!=0&&v.targetTouches&&v.targetTouches.length==2){var U=this.calcTouchDistance(v);P=2,N=(U-this.touchDistanceStart)*2/(this.WIDTH+this.HEIGHT)}else v.targetTouches&&v.targetTouches.length==3&&(P=1);I*=T,N*=R;var F=Math.hypot(I,N),k;if(P==3||this.mouseButton==3&&v.ctrlKey)this.slabNear=this.cslabNear+I*100,this.slabFar=this.cslabFar-N*100;else if(P==2||this.mouseButton==3||v.shiftKey)k=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,k<80&&(k=80),this.rotationGroup.position.z=this.cz+N*k,this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z);else if(P==1||this.mouseButton==2||v.ctrlKey){var j=this.screenOffsetToModel(T*(A-this.mouseStartX),R*(M-this.mouseStartY));this.modelGroup.position.addVectors(this.currentModelPos,j)}else if((P===0||this.mouseButton==1)&&F!==0){var H=Math.sin(F*Math.PI)/F;this.dq.x=Math.cos(F*Math.PI),this.dq.y=0,this.dq.z=H*I,this.dq.w=-H*N,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)}this.show()}}_handleContextMenu(v){if(v.preventDefault(),this.closeEnoughForClick(v)){var T=this.mouseStartX,R=this.mouseStartY,M=this.canvasOffset();let O=this.mouseXY(T,R),L=O.x,P=O.y,I=this.targetedObjects(L,P,this.contextMenuEnabledObjects);var A=null;I.length&&(A=I[0].clickable);var M=this.canvasOffset(),T=this.mouseStartX-M.left,R=this.mouseStartY-M.top;this.userContextMenuHandler&&(this.userContextMenuHandler(A,T,R,I,v),this.isDragging=!1)}}setContainer(v){let A=(0,b.getElement)(v)||this.container;return this.initContainer(A),this}setBackgroundColor(v,A){(typeof A>"u"||A<0||A>1)&&(A=1);var M=y.CC.color(v);return this.scene.fog.color=M,this.bgColor=M.getHex(),this.renderer.setClearColorHex(M.getHex(),A),this.show(),this}setProjection(v){this.camera.ortho=v==="orthographic",this.setSlabAndFog()}setViewStyle(v){if(v=v||{},v.style=v.style||"",v.style.includes("outline")?this.renderer.enableOutline(v):this.renderer.disableOutline(),v.style.includes("ambientOcclusion")){var A={};v.strength&&(A.strength=v.strength),v.radius&&(A.radius=v.radius),this.renderer.enableAmbientOcclusion(A)}else this.renderer.disableAmbientOcclusion();return this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(v){return this.WIDTH=v||this.WIDTH,this.updateSize(),this}setHeight(v){return this.HEIGHT=v||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let v=!1;if(this.renderer.isLost()&&this.WIDTH>0&&this.HEIGHT>0){let A=!1,M=this.container.querySelector("canvas");M&&M!=this.renderer.getCanvas()?this.config.canvas=M:(M.remove(),this.config&&this.config.canvas!=null&&(delete this.config.canvas,A=!0)),this.setupRenderer(),this.initContainer(this.container),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),v=!0,A&&(this.config.canvas=this.renderer.getCanvas())}if(this.WIDTH==0||this.HEIGHT==0?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),v){let A=this.renderer.supportedExtensions();if(A.regen=!0,this.viewers)for(let M=0,T=this.viewers.length;M<T;M++)for(let R=0,O=this.viewers[M].length;R<O;R++)this.viewers[M][R].render(null,A);this._viewer.render(null,A)}else this.WIDTH>0&&this.HEIGHT>0&&this.show();return this}getModel(v){return v===void 0?this.models.length==0?null:this.models[this.models.length-1]:v instanceof i.GLModel?v:v in this.models?this.models[v]:this.models.length==0?null:this.models[this.models.length-1]}spin(v,A=1,M=!1){if(clearInterval(this.spinInterval),typeof v>"u"&&(v="y"),typeof v=="boolean")if(v)v="y";else return;Array.isArray(v)&&(v={x:v[0],y:v[1],z:v[2]});var T=this;this.spinInterval=setInterval(function(){!T.getCanvas().isConnected&&T.renderer.isLost()&&clearInterval(T.spinInterval),(!M||T.container.checkVisibility&&T.container.checkVisibility())&&T.rotate(1*A,v)},25)}animateMotion(v,A,M,T,R,O){var L=20,P=Math.ceil(v/L);P<1&&(P=1),this.incAnim();var I={mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()};if(A){let F=new Array(P);for(let B=0;B<P;B++){let V=(B+1)/P,Y={mpos:I.mpos,rz:I.rz,rot:I.rot};Y.mpos=M.clone().sub(I.mpos).multiplyScalar(V).add(I.mpos),Y.rz=I.rz+V*(T-I.rz),Y.rot=f.slerp(I.rot,R,V),Y.cam=O.clone().sub(I.cam).multiplyScalar(V).add(I.cam),F[B]=Y}let k=0,j=this,H=function(){var B=F[k];k+=1,j.modelGroup.position=B.mpos,j.rotationGroup.position.z=B.rz,j.rotationGroup.quaternion=B.rot,j.camera.lookAt(B.cam),k<F.length?setTimeout(H,L):j.decAnim(),j.show()};setTimeout(H,L)}else{var N={};let F=1/P;if(M&&(N.mpos=M.clone().sub(I.mpos).multiplyScalar(F)),typeof T<"u"&&T!=null&&(N.rz=F*(T-I.rz)),R){var U=f.slerp(I.rot,R,F);N.rot=I.rot.clone().inverse().multiply(U)}O&&(N.cam=O.clone().sub(I.cam).multiplyScalar(F));let k=0,j=this,H=function(){k+=1,N.mpos&&j.modelGroup.position.add(N.mpos),N.rz&&(j.rotationGroup.position.z+=N.rz),N.rot&&j.rotationGroup.quaternion.multiply(N.rot),N.cam&&(j.lookingAt.add(N.cam),j.camera.lookAt(j.lookingAt)),k<P?setTimeout(H,L):j.decAnim(),j.show()};setTimeout(H,L)}}rotate(v,A="y",M=0,T=!1){if(A=="x"?A={x:1,y:0,z:0}:A=="y"?A={x:0,y:1,z:0}:A=="z"&&(A={x:0,y:0,z:1}),A=="vx"?A={vx:1,vy:0,vz:0}:A=="vy"?A={vx:0,vy:1,vz:0}:A=="vz"&&(A={vx:0,vy:0,vz:1}),typeof A.vx<"u"){var R=new x.Vector3(A.vx,A.vy,A.vz);R.applyQuaternion(this.rotationGroup.quaternion),A={x:R.x,y:R.y,z:R.z}}var O=function(N){var U=Math.sin(N/2),F=Math.cos(N/2),k=0,j=0,H=0;return k=A.x*U,j=A.y*U,H=A.z*U,new x.Quaternion(k,j,H,F).normalize()},L=Math.PI*v/180,P=O(L);if(M){var I=new x.Quaternion().copy(this.rotationGroup.quaternion).multiply(P);this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,I,this.lookingAt)}else this.rotationGroup.quaternion.multiply(P),this.show();return this}surfacesFinished(){for(var v in this.surfaces)if(!this.surfaces[v][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var v=this.modelGroup.position,A=this.rotationGroup.quaternion;return[v.x,v.y,v.z,this.rotationGroup.position.z,A.x,A.y,A.z,A.w]}setView(v,A){return v===void 0||!(v instanceof Array||v.length!==8)?this:!this.modelGroup||!this.rotationGroup?this:(this.modelGroup.position.x=v[0],this.modelGroup.position.y=v[1],this.modelGroup.position.z=v[2],this.rotationGroup.position.z=v[3],this.rotationGroup.quaternion.x=v[4],this.rotationGroup.quaternion.y=v[5],this.rotationGroup.quaternion.z=v[6],this.rotationGroup.quaternion.w=v[7],typeof v[8]<"u"&&(this.rotationGroup.position.x=v[8],this.rotationGroup.position.y=v[9]),this.show(A),this)}render(v,A){this.renderer.setViewport(),this.updateClickables();var M=this.getView();this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState());var T,R;for(A||(A=this.renderer.supportedExtensions()),T=0;T<this.models.length;T++)this.models[T]&&this.models[T].globj(this.modelGroup,A);for(T=0;T<this.shapes.length;T++)this.shapes[T]&&(typeof this.shapes[T].frame>"u"||this.viewer_frame<0||this.shapes[T].frame<0||this.shapes[T].frame==this.viewer_frame?this.shapes[T].globj(this.modelGroup,A):this.shapes[T].removegl(this.modelGroup));for(T=0;T<this.labels.length;T++)A.regen&&(this.labels[T].dispose(),this.modelGroup.remove(this.labels[T].sprite),this.labels[T].setContext(),this.modelGroup.add(this.labels[T].sprite)),this.labels[T]&&typeof this.labels[T].frame<"u"&&this.labels[T].frame>=0&&(this.modelGroup.remove(this.labels[T].sprite),(this.viewer_frame<0||this.labels[T].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[T].sprite));for(T in this.surfaces)if(this.surfaces.hasOwnProperty(T)){var O=this.surfaces[T];for(R=0;R<O.length;R++)if(O.hasOwnProperty(R)){var L=O[R].geo;if(!O[R].finished||A.regen){L.verticesNeedUpdate=!0,L.elementsNeedUpdate=!0,L.normalsNeedUpdate=!0,L.colorsNeedUpdate=!0,L.buffersNeedUpdate=!0,O[R].mat.needsUpdate=!0,O[R].done&&(O[R].finished=!0),O[R].lastGL&&this.modelGroup.remove(O[R].lastGL);var P=null;if(O[R].mat instanceof g.LineBasicMaterial?P=new g.Line(L,O[R].mat):("wireframe"in O.style&&O.style.wireframe&&L.setUpWireframe(),P=new g.Mesh(L,O[R].mat)),O[R].mat.transparent&&O[R].mat.opacity==0?P.visible=!1:P.visible=!0,O[R].symmetries.length>1||O[R].symmetries.length==1&&!O[R].symmetries[0].isIdentity()){var I,N=new g.Object3D;for(I=0;I<O[R].symmetries.length;I++){var U=P.clone();U.matrix=O[R].symmetries[I],U.matrixAutoUpdate=!1,N.add(U)}O[R].lastGL=N,this.modelGroup.add(N)}else O[R].lastGL=P,this.modelGroup.add(P)}}}return this.setView(M),typeof v=="function"&&v(this),this}getModelList(v){let A=[];if(typeof v>"u"||typeof v.model>"u")for(let T=0;T<this.models.length;T++)this.models[T]&&A.push(this.models[T]);else{let T=v.model;Array.isArray(T)||(T=[T]);for(let R=0;R<T.length;R++)if(typeof T[R]=="number"){var M=T[R];M<0&&(M+=this.models.length),A.push(this.models[M])}else A.push(T[R])}return A}getAtomsFromSel(v){var A=[];typeof v>"u"&&(v={});var M=this.getModelList(v);for(let T=0;T<M.length;T++)A=A.concat(M[T].selectedAtoms(v));return A}atomIsSelected(v,A){typeof A>"u"&&(A={});for(var M=this.getModelList(A),T=0;T<M.length;T++)if(M[T].atomIsSelected(v,A))return!0;return!1}selectedAtoms(v){return this.getAtomsFromSel(v)}getUniqueValues(v,A){typeof A>"u"&&(A={});var M=this.getAtomsFromSel(A),T={};for(var R in M)if(M[R].hasOwnProperty(v)){var O=M[R][v];T[O]=!0}return Object.keys(T)}pdbData(v){for(var A=this.getAtomsFromSel(v),M="",T=0,R=A.length;T<R;++T)M+=A[T].pdbline+`
`;return M}zoom(v=2,A=0,M=!1){var T=(this.CAMERA_Z-this.rotationGroup.position.z)/v,R=this.CAMERA_Z-T;return A>0?this.animateMotion(A,M,this.modelGroup.position,this.adjustZoomToLimits(R),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(R),this.show()),this}translate(v,A,M=0,T=!1){var R=v/this.WIDTH,O=A/this.HEIGHT,L=new x.Vector3(0,0,-this.CAMERA_Z);this.projector.projectVector(L,this.camera),L.x-=R,L.y-=O,this.projector.unprojectVector(L,this.camera),L.z=0;var P=this.lookingAt.clone().add(L);return M>0?this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,P):(this.lookingAt=P,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(v,A,M=0,T=!1){var R=this.screenOffsetToModel(v,A),O=this.modelGroup.position.clone().add(R);return M>0?this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=O,this.show()),this}fitSlab(v){v=v||{};var A=this.getAtomsFromSel(v),M=(0,b.getExtent)(A),T=M[1][0]-M[0][0],R=M[1][1]-M[0][1],O=M[1][2]-M[0][2],L=Math.hypot(T,R,O);return L<5&&(L=5),this.slabNear=-L/1.9,this.slabFar=L/2,this}center(v={},A=0,M=!1){var T,R,O=this.getAtomsFromSel(v),L=(0,b.getExtent)(O);(0,b.isEmptyObject)(v)?(this.shapes.forEach(V=>{if(V&&V.boundingSphere&&V.boundingSphere.center){var Y=V.boundingSphere.center,K=V.boundingSphere.radius;K>0?(O.push(new x.Vector3(Y.x+K,Y.y,Y.z)),O.push(new x.Vector3(Y.x-K,Y.y,Y.z)),O.push(new x.Vector3(Y.x,Y.y+K,Y.z)),O.push(new x.Vector3(Y.x,Y.y-K,Y.z)),O.push(new x.Vector3(Y.x,Y.y,Y.z+K)),O.push(new x.Vector3(Y.x,Y.y,Y.z-K))):O.push(Y)}}),L=(0,b.getExtent)(O),T=O,R=L):(T=this.getAtomsFromSel({}),R=(0,b.getExtent)(T));var P=new x.Vector3(L[2][0],L[2][1],L[2][2]),I=R[1][0]-R[0][0],N=R[1][1]-R[0][1],U=R[1][2]-R[0][2],F=Math.hypot(I,N,U);F<5&&(F=5),this.slabNear=-F/1.9,this.slabFar=F/2,I=L[1][0]-L[0][0],N=L[1][1]-L[0][1],U=L[1][2]-L[0][2],F=Math.hypot(I,N,U),F<5&&(F=5);for(var k=25,j=0;j<O.length;j++)if(O[j]){var H=P.distanceToSquared(O[j]);H>k&&(k=H)}F=Math.sqrt(k)*2;var B=P.clone().multiplyScalar(-1);return A>0?this.animateMotion(A,M,B,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=B,this.show()),this}zoomTo(v={},A=0,M=!1){let T=this.getAtomsFromSel(v),R=(0,b.getExtent)(T),O=R;if((0,b.isEmptyObject)(v)){let Y=T&&T.length;if(this.shapes.forEach(K=>{if(K&&K.boundingSphere){if(K.boundingSphere.box){let He=K.boundingSphere.box;T.push(new x.Vector3(He.min.x,He.min.y,He.min.z)),T.push(new x.Vector3(He.max.x,He.max.y,He.max.z))}else if(K.boundingSphere.center){var J=K.boundingSphere.center,Te=K.boundingSphere.radius;Te>0?(T.push(new x.Vector3(J.x+Te,J.y,J.z)),T.push(new x.Vector3(J.x-Te,J.y,J.z)),T.push(new x.Vector3(J.x,J.y+Te,J.z)),T.push(new x.Vector3(J.x,J.y-Te,J.z)),T.push(new x.Vector3(J.x,J.y,J.z+Te)),T.push(new x.Vector3(J.x,J.y,J.z-Te))):T.push(J)}}}),O=(0,b.getExtent)(T),!Y)for(let K=0;K<3;K++)R[2][K]=(O[0][K]+O[1][K])/2}else{let Y=this.getAtomsFromSel({});O=(0,b.getExtent)(Y)}var L=new x.Vector3(R[2][0],R[2][1],R[2][2]),P=O[1][0]-O[0][0],I=O[1][1]-O[0][1],N=O[1][2]-O[0][2],U=Math.hypot(P,I,N);U<5&&(U=5),this.slabNear=-U/1.9,this.slabFar=U/2,Object.keys(v).length===0&&(this.slabNear=Math.min(-U*2,-50),this.slabFar=Math.max(U*2,50));var F=this.config.minimumZoomToDistance||5;P=R[1][0]-R[0][0],I=R[1][1]-R[0][1],N=R[1][2]-R[0][2],U=Math.hypot(P,I,N),U<F&&(U=F);for(var k=F*F,j=0;j<T.length;j++)if(T[j]){var H=L.distanceToSquared(T[j]);H>k&&(k=H)}U=Math.sqrt(k)*2;var B=L.clone().multiplyScalar(-1),V=-(U*.5/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z);return V=this.adjustZoomToLimits(V),A>0?this.animateMotion(A,M,B,V,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=B,this.rotationGroup.position.z=V,this.show()),this}setSlab(v,A){this.slabNear=v,this.slabFar=A}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(v,A={},M,T=!1){if(M){var R=(0,b.getExtent)(this.getAtomsFromSel(M));A.position={x:R[2][0],y:R[2][1],z:R[2][2]}}var O=new a.Label(v,A);return O.setContext(),this.modelGroup.add(O.sprite),this.labels.push(O),T||this.show(),O}addResLabels(v,A,M=!1){let T=this.labels.length;return this.applyToModels("addResLabels",v,A,M),this.show(),this.labels.slice(T)}addPropertyLabels(v,A,M){return this.applyToModels("addPropertyLabels",v,A,M),this.show(),this}removeLabel(v){for(var A=0;A<this.labels.length;A++)if(this.labels[A]==v){this.labels.splice(A,1),v.dispose(),this.modelGroup.remove(v.sprite);break}return this.show(),this}removeAllLabels(){for(var v=0;v<this.labels.length;v++)this.labels[v]&&this.labels[v].sprite&&this.modelGroup.remove(this.labels[v].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}hideAllLabels(){for(var v=0;v<this.labels.length;v++)this.labels[v]&&this.labels[v].hide();return this.show(),this}showAllLabels(){for(var v=0;v<this.labels.length;v++)this.labels[v]&&this.labels[v].show();return this.show(),this}setLabelStyle(v,A){return this.modelGroup.remove(v.sprite),v.dispose(),v.stylespec=A,v.setContext(),this.modelGroup.add(v.sprite),this.show(),v}setLabelText(v,A){return this.modelGroup.remove(v.sprite),v.dispose(),v.text=A,v.setContext(),this.modelGroup.add(v.sprite),this.show(),v}addShape(v){v=v||{};var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,this.shapes.push(A),A}removeShape(v){if(!v)return this;for(v.removegl(this.modelGroup),delete this.shapes[v.shapePosition];this.shapes.length>0&&typeof this.shapes[this.shapes.length-1]>"u";)this.shapes.pop();return this}removeAllShapes(){for(var v=0;v<this.shapes.length;v++){var A=this.shapes[v];A&&A.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(v){if(v.hasOwnProperty("x")&&v.hasOwnProperty("y")&&v.hasOwnProperty("z"))return v;var A=this.getAtomsFromSel(v);if(A.length==0)return{x:0,y:0,z:0};var M=(0,b.getExtent)(A);return{x:M[0][0]+(M[1][0]-M[0][0])/2,y:M[0][1]+(M[1][1]-M[0][1])/2,z:M[0][2]+(M[1][2]-M[0][2])/2}}addSphere(v){v=v||{},v.center=this.getSelectionCenter(v.center);var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addSphere(v),this.shapes.push(A),A.finalize(),A}addBox(v={}){v.corner!=null&&(v.corner=this.getSelectionCenter(v.corner)),v.center!=null&&(v.center=this.getSelectionCenter(v.center));var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addBox(v),this.shapes.push(A),A.finalize(),A}addArrow(v={}){v.start=this.getSelectionCenter(v.start),v.end=this.getSelectionCenter(v.end);var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addArrow(v),this.shapes.push(A),A.finalize(),A}addCylinder(v={}){v.start=this.getSelectionCenter(v.start),v.end=this.getSelectionCenter(v.end);var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,v.dashed?A.addDashedCylinder(v):A.addCylinder(v),this.shapes.push(A),A.finalize(),A}addCurve(v={}){var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addCurve(v),this.shapes.push(A),A.finalize(),A}addLine(v={}){v.start=this.getSelectionCenter(v.start),v.end=this.getSelectionCenter(v.end),v.wireframe=!0;var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,v.dashed?A=this.addLineDashed(v,A):A.addLine(v),this.shapes.push(A),A.finalize(),A}addUnitCell(v,A){v=this.getModel(v),A=A||{alabel:"a",blabel:"b",clabel:"c"},A.box=A.box||{},A.astyle=A.astyle||{color:"red",radius:.1,midpos:-1},A.bstyle=A.bstyle||{color:"green",radius:.1,midpos:-1},A.cstyle=A.cstyle||{color:"blue",radius:.1,midpos:-1},A.alabelstyle=A.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},A.blabelstyle=A.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},A.clabelstyle=A.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},v.unitCellObjects&&this.removeUnitCell(v),v.unitCellObjects={shapes:[],labels:[]};var M=v.getCrystData(),T=null;if(M){if(M.matrix)T=M.matrix;else{var R=M.a,O=M.b,L=M.c,P=M.alpha,I=M.beta,N=M.gamma;P=P*Math.PI/180,I=I*Math.PI/180,N=N*Math.PI/180;var U,F,k;U=Math.cos(I),F=(Math.cos(P)-Math.cos(I)*Math.cos(N))/Math.sin(N),k=Math.sqrt(Math.max(0,1-U*U-F*F)),T=new x.Matrix3(R,O*Math.cos(N),L*U,0,O*Math.sin(N),L*F,0,0,L*k)}var j=[new x.Vector3(0,0,0),new x.Vector3(1,0,0),new x.Vector3(0,1,0),new x.Vector3(0,0,1),new x.Vector3(1,1,0),new x.Vector3(0,1,1),new x.Vector3(1,0,1),new x.Vector3(1,1,1)];if(M.matrix4)for(let B=0;B<j.length;B++)M.size&&j[B].multiplyVectors(j[B],M.size),j[B]=j[B].applyMatrix4(M.matrix4);else for(let B=0;B<j.length;B++)j[B]=j[B].applyMatrix3(T);if(A.box&&!A.box.hidden){A.box.wireframe=!0;var H=new s.GLShape(A.box);H.shapePosition=this.shapes.length,H.addLine({start:j[0],end:j[1]}),H.addLine({start:j[0],end:j[2]}),H.addLine({start:j[1],end:j[4]}),H.addLine({start:j[2],end:j[4]}),H.addLine({start:j[0],end:j[3]}),H.addLine({start:j[3],end:j[5]}),H.addLine({start:j[2],end:j[5]}),H.addLine({start:j[1],end:j[6]}),H.addLine({start:j[4],end:j[7]}),H.addLine({start:j[6],end:j[7]}),H.addLine({start:j[3],end:j[6]}),H.addLine({start:j[5],end:j[7]}),this.shapes.push(H),v.unitCellObjects.shapes.push(H),H.finalize()}if(!A.astyle.hidden){A.astyle.start=j[0],A.astyle.end=j[1];let B=this.addArrow(A.astyle);v.unitCellObjects.shapes.push(B)}if(!A.bstyle.hidden){A.bstyle.start=j[0],A.bstyle.end=j[2];let B=this.addArrow(A.bstyle);v.unitCellObjects.shapes.push(B)}if(!A.cstyle.hidden){A.cstyle.start=j[0],A.cstyle.end=j[3];let B=this.addArrow(A.cstyle);v.unitCellObjects.shapes.push(B)}if(A.alabel){A.alabelstyle.position=j[1];let B=this.addLabel(A.alabel,A.alabelstyle);v.unitCellObjects.labels.push(B)}if(A.blabel){A.blabelstyle.position=j[2];let B=this.addLabel(A.blabel,A.blabelstyle);v.unitCellObjects.labels.push(B)}if(A.clabel){A.clabelstyle.position=j[3];let B=this.addLabel(A.clabel,A.clabelstyle);v.unitCellObjects.labels.push(B)}}}removeUnitCell(v){if(v=this.getModel(v),v.unitCellObjects){let A=this;v.unitCellObjects.shapes.forEach(function(M){A.removeShape(M)}),v.unitCellObjects.labels.forEach(function(M){A.removeLabel(M)})}delete v.unitCellObjects}replicateUnitCell(v=3,A=v,M=A,T,R,O){T=this.getModel(T);let L=T.getCrystData();if(L){const P=T.selectedAtoms({}),I=L.matrix;let N=function(F){return F%2==0?-F/2:Math.ceil(F/2)};v<=1&&A<=1&&M<=1&&(O=!0,v=A=M=3);let U=function(F,k,j){return!1};if(O){const F=new x.Matrix3().getInverse3(I);U=function(k,j,H){let B=new x.Vector3(k,j,H).applyMatrix3(F);return!(B.x>-1e-4&&B.x<1.0001&&B.y>-1e-4&&B.y<1.0001&&B.z>-1e-4&&B.z<1.0001)}}for(let F=0;F<v;F++)for(let k=0;k<A;k++)for(let j=0;j<M;j++){if(F==0&&k==0&&j==0)continue;let H=new x.Vector3(N(F),N(k),N(j));H.applyMatrix3(I);let B=[];for(let V=0;V<P.length;V++){let Y=P[V].x+H.x,K=P[V].y+H.y,J=P[V].z+H.z;if(U(Y,K,J))continue;let Te={};for(let He in P[V])Te[He]=P[V][He];Te.x=Y,Te.y=K,Te.z=J,B.push(Te)}T.addAtoms(B)}R&&T.assignBonds()}}addLineDashed(v,A){v.dashLength=v.dashLength||.5,v.gapLength=v.gapLength||.5;var M;v.start?M=new x.Vector3(v.start.x||0,v.start.y||0,v.start.z||0):M=new x.Vector3(0,0,0);var T;v.end?T=new x.Vector3(v.end.x,v.end.y||0,v.end.z||0):T=new x.Vector3(0,0,0);var R=new x.Vector3,O=new x.Vector3,L=new x.Vector3,P,I,N,U=M.clone(),F=0;for(R.subVectors(T,M),P=R.length(),R.normalize(),O=R.clone(),L=R.clone(),O.multiplyScalar(v.dashLength),L.multiplyScalar(v.gapLength),I=O.length(),N=L.length();F<P;){if(F+I>P){v.start=M,v.end=T,A.addLine(v);break}U.addVectors(M,O),v.start=M,v.end=U,A.addLine(v),M=U.clone(),F+=I,U.addVectors(M,L),M=U.clone(),F+=N}return A.finalize(),A}addCustom(v){v=v||{};var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addCustom(v),this.shapes.push(A),A.finalize(),A}addVolumetricData(v,A,M={}){var T=new d.VolumeData(v,A);return M.hasOwnProperty("transferfn")?this.addVolumetricRender(T,M):this.addIsosurface(T,M)}addIsosurface(v,A={},M){var T=new s.GLShape(A);return T.shapePosition=this.shapes.length,T.addIsosurface(v,A,M,this),this.shapes.push(T),T}addVolumetricRender(v,A){A=A||{};var M=new u.GLVolumetricRender(v,A,this);return M.shapePosition=this.shapes.length,this.shapes.push(M),M}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(v){if(v){this.scene.fog=new g.Fog(this.bgColor,100,200),this.config.disableFog=!1;const A=v;A.fogStart==null?this.fogStart=.4:this.fogStart=A.fogStart,A.fogEnd==null?this.fogEnd=1:this.fogEnd=A.fogEnd}else this.config.disableFog=!0,this.show()}setFrame(v){this.viewer_frame=v;let A=this;return new Promise(function(M){var T=A.models.map(function(R){return R.setFrame(v)});Promise.all(T).then(function(){M()})})}getFrame(){return this.viewer_frame}getNumFrames(){var v=0;for(let A=0;A<this.models.length;A++)this.models[A].getNumFrames()>v&&(v=this.models[A].getNumFrames());for(let A=0;A<this.shapes.length;A++)this.shapes[A].frame&&this.shapes[A].frame>=v&&(v=this.shapes[A].frame+1);for(let A=0;A<this.labels.length;A++)this.labels[A].frame&&this.labels[A].frame>=v&&(v=this.labels[A].frame+1);return v}getNextModelId(){return this.models.length}animate(v){this.incAnim();var A=100,M="forward",T=1/0;v=v||{},v.interval&&(A=v.interval),v.loop&&(M=v.loop),v.reps&&(T=v.reps);var R=this.getNumFrames(),O=this,L=0;v.startFrame&&(L=v.startFrame%R);var P=1;v.step&&(P=v.step,T/=P);var I=0,N=R*T,U=new Date,F,k,j=function(H){U=new Date,H=="forward"?O.setFrame(L).then(function(){L=(L+P)%R,F()}):H=="backward"?O.setFrame(R-1-L).then(function(){L=(L+P)%R,F()}):O.setFrame(L).then(function(){L+=P,P*=L%(R-1)==0?-1:1,F()})};return F=function(){if(O.render(),!O.getCanvas().isConnected)O.stopAnimate();else if(++I>=N||!O.isAnimated())k.cancel(),O.animationTimers.delete(k),O.decAnim();else{var H=A-(new Date().getTime()-U.getTime());H=H>0?H:0,k.cancel(),O.animationTimers.delete(k),k=new b.PausableTimer(j,H,M),O.animationTimers.add(k)}},k=new b.PausableTimer(j,0,M),this.animationTimers.add(k),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(v){v.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(v){v.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(v){v.resume()}),this}isAnimated(){return this.animated>0}getModelOpt(v){return v&&!v.defaultcolors?(v.defaultcolors=this.defaultcolors,v.cartoonQuality=v.cartoonQuality||this.config.cartoonQuality):typeof v>"u"&&(v={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality}),v}addModel(v,A="",M){M=this.getModelOpt(M);var T=new i.GLModel(this.models.length,M,this);return T.addMolData(v,A,M),this.models.push(T),T}addModels(v,A,M){M=this.getModelOpt(M),M.multimodel=!0,M.frames=!0;for(var T=i.GLModel.parseMolData(v,A,M),R=0;R<T.length;R++){var O=new i.GLModel(this.models.length,M,this);O.setAtomDefaults(T[R]),O.addFrame(T[R]),O.setFrame(0),T.modelData&&O.setModelData(T.modelData[R]),O.setDontDuplicateAtoms(!M.duplicateAssemblyAtoms),this.models.push(O)}return this.models}addModelsAsFrames(v,A,M){M=this.getModelOpt(M),M.multimodel=!0,M.frames=!0;var T=new i.GLModel(this.models.length,M,this);return T.addMolData(v,A,M),this.models.push(T),T}addAsOneMolecule(v,A,M){M=this.getModelOpt(M),M.multimodel=!0,M.onemol=!0;var T=new i.GLModel(this.models.length,M,this);return T.addMolData(v,A,M),this.models.push(T),T}removeModel(v){if(v=this.getModel(v),!!v){for(v.removegl(this.modelGroup),delete this.models[v.getID()];this.models.length>0&&typeof this.models[this.models.length-1]>"u";)this.models.pop();return this}}removeAllModels(){for(var v=0;v<this.models.length;v++){var A=this.models[v];A&&A.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(v,A){var M={};return A===void 0?M.m=this.models.map(function(T){return T.toCDObject(v)}):M.m=[this.models[A].toCDObject()],JSON.stringify(M)}exportVRML(){var v=this.modelGroup;this.applyToModels("removegl",this.modelGroup),this.modelGroup=new g.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var A=`#VRML V2.0 utf8
`+this.modelGroup.vrml()+`
`;return this.applyToModels("removegl",this.modelGroup),this.modelGroup=v,A}createModelFrom(v,A=!1){for(var M=new i.GLModel(this.models.length,this.defaultcolors,this),T=0;T<this.models.length;T++)if(this.models[T]){var R=this.models[T].selectedAtoms(v);M.addAtoms(R),A&&this.models[T].removeAtoms(R)}return this.models.push(M),M}applyToModels(v,A,M,T,R,O,L){for(var P=this.getModelList(A),I=0;I<P.length;I++)P[I][v](A,M,T,R,O,L)}setStyle(v,A){return typeof A>"u"&&(A=v,v={}),this.applyToModels("setStyle",v,A,!1),this}addStyle(v,A){return typeof A>"u"&&(A=v,v={}),this.applyToModels("setStyle",v,A,!0),this}setClickable(v,A,M){return this.applyToModels("setClickable",v,A,M),this}setHoverable(v,A,M,T){return this.applyToModels("setHoverable",v,A,M,T),this}enableContextMenu(v,A){return this.applyToModels("enableContextMenu",v,A),this}vibrate(v,A,M,T){return this.applyToModels("vibrate",v,A,M,T),this}setColorByProperty(v,A,M,T){return this.applyToModels("setColorByProperty",v,A,M,T),this}setColorByElement(v,A){return this.applyToModels("setColorByElement",v,A),this}static getAtomsWithin(v,A){var M=[];for(let R=0;R<v.length;R++){var T=v[R];typeof T>"u"||T.x<A[0][0]||T.x>A[1][0]||T.y<A[0][1]||T.y>A[1][1]||T.z<A[0][2]||T.z>A[1][2]||M.push(T)}return M}static volume(v){var A=v[1][0]-v[0][0],M=v[1][1]-v[0][1],T=v[1][2]-v[0][2];return A*M*T}carveUpExtent(v,A,M){let T=[],R={};for(let U=0,F=A.length;U<F;U++)R[A[U].index]=U;let O=function(U){let F=[];for(let k=0,j=U.length;k<j;k++)U[k].index in R&&F.push(R[U[k].index]);return F},L=function(U){let F=[];return F[0]=[U[0][0],U[0][1],U[0][2]],F[1]=[U[1][0],U[1][1],U[1][2]],F},P=function(U){if(f.volume(U)<f.maxVolume)return[U];var F=U[1][0]-U[0][0],k=U[1][1]-U[0][1],j=U[1][2]-U[0][2],H;F>k&&F>j?H=0:k>F&&k>j?H=1:H=2;var B=L(U),V=L(U),Y=(U[1][H]-U[0][H])/2+U[0][H];B[1][H]=Y,V[0][H]=Y;var K=P(B),J=P(V);return K.concat(J)},I=P(v),N=6;for(let U=0,F=I.length;U<F;U++){let k=L(I[U]);k[0][0]-=N,k[0][1]-=N,k[0][2]-=N,k[1][0]+=N,k[1][1]+=N,k[1][2]+=N;let j=f.getAtomsWithin(A,k),H=f.getAtomsWithin(M,I[U]);T.push({extent:I[U],atoms:O(j),toshow:O(H)})}return T}static generateSurfaceMesh(v,A,M){var T=new g.Geometry(!0),R=T.updateGeoGroup(0),O=[];for(let ai=0,u0=v.length;ai<u0;ai++){var L=v[ai];L&&(typeof L.surfaceColor<"u"?O[ai]=L.surfaceColor:L.color&&(O[ai]=y.CC.color(L.color)))}var P=R.vertexArray,I=A.vertices;for(let ai=0,u0=I.length;ai<u0;ai++){let o0=R.vertices*3;P[o0]=I[ai].x,P[o0+1]=I[ai].y,P[o0+2]=I[ai].z,R.vertices++}var N=R.colorArray;let U=R.atomArray;if(M.voldata&&M.volscheme){var F=M.volscheme,k=M.voldata,j=F.range()||[-1,1];for(let ai=0,u0=I.length;ai<u0;ai++){let o0=I[ai].atomid,E0=k.getVal(I[ai].x,I[ai].y,I[ai].z),F0=y.CC.color(F.valueToHex(E0,j)),g0=ai*3;N[g0]=F0.r,N[g0+1]=F0.g,N[g0+2]=F0.b,U[ai]=v[o0]}}else if(O.length>0)for(let ai=0,u0=I.length;ai<u0;ai++){let o0=I[ai].atomid,E0=ai*3;N[E0]=O[o0].r,N[E0+1]=O[o0].g,N[E0+2]=O[o0].b,U[ai]=v[o0]}var H=A.faces;R.faceidx=H.length,T.initTypedArrays();var B=R.vertexArray,V=R.normalArray,Y,K,J,Te;for(let ai=0,u0=H.length;ai<u0;ai+=3){var He=H[ai],Q=H[ai+1],Xe=H[ai+2],ut=He*3,Ji=Q*3,er=Xe*3;Y=new x.Vector3(B[ut],B[ut+1],B[ut+2]),K=new x.Vector3(B[Ji],B[Ji+1],B[Ji+2]),J=new x.Vector3(B[er],B[er+1],B[er+2]),J.subVectors(J,K),Y.subVectors(Y,K),J.cross(Y),Te=J,Te.normalize(),V[ut]+=Te.x,V[Ji]+=Te.x,V[er]+=Te.x,V[ut+1]+=Te.y,V[Ji+1]+=Te.y,V[er+1]+=Te.y,V[ut+2]+=Te.z,V[Ji+2]+=Te.z,V[er+2]+=Te.z}R.faceArray=new Uint16Array(H);var ec=new g.Mesh(T,M);return ec}static generateMeshSyncHelper(v,A,M,T,R,O){var L=new l.ProteinSurface;return L.initparm(A,v!==1,O),L.fillvoxels(R,M),L.buildboundary(),(v==l.SurfaceType.SES||v==l.SurfaceType.MS)&&(L.fastdistancemap(),L.boundingatom(!1),L.fillvoxelswaals(R,M)),L.marchingcube(v),L.getFacesAndVertices(T)}static getMatWithStyle(v){let A=null;v.onesided?A=new g.MeshLambertMaterial:A=new g.MeshDoubleLambertMaterial,A.vertexColors=g.Coloring.VertexColors;for(var M in v)M==="color"||M==="map"||v.hasOwnProperty(M)&&(A[M]=v[M]);return v.opacity!==void 0&&(v.opacity===1?A.transparent=!1:A.transparent=!0),v.wireframe!==void 0&&(A.wireframe=v.wireframe),A}addMesh(v){let A={geo:v.geometry,mat:v.material,done:!0,finished:!1};var M=this.nextSurfID();return this.surfaces[M]=new h([A]),M}static shallowCopy(v){var A=[];let M=v.length;for(let T=0;T<M;T++)A[T]=(0,b.extend)({},v[T]);return A}addSurface(v,A={},M={},T,R,O){let L=this.nextSurfID(),P=null,I=this,N=l.SurfaceType.VDW;typeof v=="string"?f.surfaceTypeMap[v.toUpperCase()]!==void 0?N=f.surfaceTypeMap[v]:console.log("Surface type : "+v+" is not recognized"):typeof v=="number"&&(N=v);var U=null,F=null,k=f.shallowCopy(this.getAtomsFromSel(M));T?U=f.shallowCopy(this.getAtomsFromSel(T)):U=k,(0,b.adjustVolumeStyle)(A);var j=!1,H;for(H=0;H<this.models.length;H++)if(this.models[H]){var B=this.models[H].getSymmetries();if(B.length>1||B.length==1&&!B[0].isIdentity()){j=!0;break}}var V=function(Xe,ut,Ji){R?F=f.shallowCopy(I.getAtomsFromSel(R)):F=Ji;var er,ec=(0,b.getExtent)(Ji,!0);if(A.map&&A.map.prop){var ai=A.map.prop;let h0=(0,o.getGradient)(A.map.scheme||A.map.gradient||new o.Gradient.RWB),M0=h0.range();M0||(M0=(0,b.getPropertyRange)(Ji,ai)),A.colorscheme={prop:ai,gradient:h0}}for(let h0=0,M0=ut.length;h0<M0;h0++)er=ut[h0],er.surfaceColor=(0,b.getColorFromStyle)(er,A);var u0=f.volume(ec),o0=I.carveUpExtent(ec,ut,Ji);if(F&&F.length&&F.length>0){var E0=(0,b.getExtent)(F,!0),F0=function(h0,M0){var Z=function(s0,c0){var A0=s0.extent,P0=A0[1][0]-A0[0][0],Fe=A0[1][1]-A0[0][1],f0=A0[1][2]-A0[0][2],v0=P0-c0[2][0];v0*=v0;var D0=Fe-c0[2][1];D0*=D0;var l0=f0-c0[2][2];return l0*=l0,v0+D0+l0},tt=Z(h0,E0),tr=Z(M0,E0);return tt-tr};o0.sort(F0)}var g0=[];for(let h0=0,M0=ut.length;h0<M0;h0++)er=ut[h0],g0[h0]={x:er.x,y:er.y,z:er.z,serial:h0,elem:er.elem};var w0=!!l.syncSurface;if((typeof $3Dmol>"u"||typeof $3Dmol.SurfaceWorker>"u")&&(console.log("$3Dmol.SurfaceWorker is not defined, using synchronous surface generation."),w0=!0),w0){var L0=function(M0){return new Promise(function(Z){for(var tt=f.generateMeshSyncHelper(N,o0[M0].extent,o0[M0].atoms,o0[M0].toshow,g0,u0),tr=(0,s.splitMesh)({vertexArr:tt.vertices,faceArr:tt.faces}),s0=0,c0=tr.length;s0<c0;s0++){tt={vertices:tr[s0].vertexArr,faces:tr[s0].faceArr};var A0=f.generateSurfaceMesh(ut,tt,P);(0,b.mergeGeos)(Xe.geo,A0)}I.render(),Z()})},T0=[];for(let h0=0;h0<o0.length;h0++)T0.push(L0(h0));return Promise.all(T0).then(function(){return Xe.done=!0,I.render(),Promise.resolve(L)})}else{var ht=[];N<0&&(N=0);for(let h0=0,M0=f.numWorkers;h0<M0;h0++){var We=new Worker($3Dmol.SurfaceWorker);ht.push(We),We.postMessage({type:-1,atoms:g0,volume:u0})}return new Promise(function(h0,M0){var Z=0,tt=function(){!ht||!ht.length||ht.forEach(function(A0){A0&&A0.terminate&&A0.terminate()})},tr=function(A0){for(var P0=(0,s.splitMesh)({vertexArr:A0.data.vertices,faceArr:A0.data.faces}),Fe=0,f0=P0.length;Fe<f0;Fe++){var v0={vertices:P0[Fe].vertexArr,faces:P0[Fe].faceArr},D0=f.generateSurfaceMesh(ut,v0,P);(0,b.mergeGeos)(Xe.geo,D0)}I.render(),Z++,Z==o0.length&&(Xe.done=!0,tt(),h0(L))},s0=function(A0){tt(),console.log(A0.message+" ("+A0.filename+":"+A0.lineno+")"),M0(A0)};for(let A0=0;A0<o0.length;A0++){var c0=ht[A0%ht.length];c0.onmessage=tr,c0.onerror=s0,c0.postMessage({type:N,expandedExtent:o0[A0].extent,extendedAtoms:o0[A0].atoms,atomsToShow:o0[A0].toshow})}})}};A=A||{},P=f.getMatWithStyle(A);let Y=new h([]);Y.style=A,Y.atomsel=M,Y.allsel=T,Y.focus=R;var K=null;if(j){var J={},Te={};for(H=0;H<this.models.length;H++)J[H]=[],Te[H]=[];for(H=0;H<U.length;H++)J[U[H].model].push(U[H]);for(H=0;H<k.length;H++)Te[k[H].model].push(k[H]);var He=[];for(H=0;H<this.models.length;H++)Te[H].length>0&&(Y.push({geo:new g.Geometry(!0),mat:P,done:!1,finished:!1,symmetries:this.models[H].getSymmetries()}),He.push(V(Y[Y.length-1],J[H],Te[H])));K=Promise.all(He)}else Y.push({geo:new g.Geometry(!0),mat:P,done:!1,finished:!1,symmetries:[new x.Matrix4]}),K=V(Y[Y.length-1],U,k);return this.surfaces[L]=Y,K.surfid=L,O&&typeof O=="function"?(K.then(function(Q){O(Q)}),L):K}setSurfaceMaterialStyle(v,A){if((0,b.adjustVolumeStyle)(A),this.surfaces[v]){var M=this.surfaces[v];for(let R=0;R<M.length;R++){var T=M[R].mat=f.getMatWithStyle(A);if(M[R].mat.side=g.FrontSide,A.wireframe&&M[R].geo.setUpWireframe(),A.color){M[R].mat.color=y.CC.color(A.color),M[R].geo.colorsNeedUpdate=!0;const O=y.CC.color(A.color);M[R].geo.setColor(O)}else if(T.voldata&&T.volscheme){const O=T.volscheme,L=T.voldata,P=y.CC,I=O.range()||[-1,1];M[R].geo.setColors(function(N,U,F){let k=L.getVal(N,U,F);return P.color(O.valueToHex(k,I))})}else{M[R].geo.colorsNeedUpdate=!0;for(let O of M[R].geo.geometryGroups)for(let L=0;L<O.vertices;L++){let P=(0,b.getColorFromStyle)(O.atomArray[L],A),I=3*L;O.colorArray[I]=P.r,O.colorArray[I+1]=P.g,O.colorArray[I+2]=P.b}}M[R].finished=!1}}return this}getSurface(v){return this.surfaces[v]}removeSurface(v){for(var A=this.surfaces[v],M=0;M<A.length;M++)A[M]&&A[M].lastGL&&(A[M].geo!==void 0&&A[M].geo.dispose(),A[M].mat!==void 0&&A[M].mat.dispose(),this.modelGroup.remove(A[M].lastGL));return delete this.surfaces[v],this.show(),this}removeAllSurfaces(){for(var v in this.surfaces)if(this.surfaces.hasOwnProperty(v)){for(var A=this.surfaces[v],M=0;M<A.length;M++)A[M]&&A[M].lastGL&&(A[M].geo!==void 0&&A[M].geo.dispose(),A[M].mat!==void 0&&A[M].mat.dispose(),this.modelGroup.remove(A[M].lastGL));delete this.surfaces[v]}return this.show(),this}jmolMoveTo(){var v=this.modelGroup.position,A="center { "+-v.x+" "+-v.y+" "+-v.z+" }; ",M=this.rotationGroup.quaternion;return A+="moveto .5 quaternion { "+M.x+" "+M.y+" "+M.z+" "+M.w+" };",A}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(v,A){A=A||{};var M=this.getAtomsFromSel(A);if(typeof v=="function")for(let O=0,L=M.length;O<L;O++){let P=M[O];v(P)}else for(let O=0,L=M.length;O<L;O++){var T=M[O];for(let P=0,I=v.length;P<I;P++){let N=v[P];if(N.props)for(var R in N.props)N.props.hasOwnProperty(R)&&this.atomIsSelected(T,N)&&(T.properties||(T.properties={}),T.properties[R]=N.props[R])}}return this}linkViewer(v){return this.linkedViewers.push(v),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(v){this.rotationGroup.position.z=this.CAMERA_Z-v}setAutoEyeSeparation(v,A){var M=this.getPerceivedDistance();return A||(A=5),v||this.camera.position.x>0?this.camera.position.x=M*Math.tan(Math.PI/180*A):this.camera.position.x=-M*Math.tan(Math.PI/180*A),this.camera.lookAt(new x.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(v){this.config.cartoonQuality=v}}f.numWorkers=4,f.maxVolume=64e3,f.surfaceTypeMap={VDW:l.SurfaceType.VDW,MS:l.SurfaceType.MS,SAS:l.SurfaceType.SAS,SES:l.SurfaceType.SES};function E(w,v){if(w=(0,b.getElement)(w),!!w){v=v||{};try{var A=new f(w,v);return A}catch(M){throw"error creating viewer: "+M}}}function m(w,v={},A={}){if(w=(0,b.getElement)(w),!!w){var M=[],T=document.createElement("canvas");A.rows=v.rows,A.cols=v.cols,A.control_all=v.control_all!=null?v.control_all:!1,w.appendChild(T);try{for(var R=0;R<v.rows;R++){for(var O=[],L=0;L<v.cols;L++){A.row=R,A.col=L,A.canvas=T,A.viewers=M,A.control_all=v.control_all;var P=E(w,(0,b.extend)({},A));O.push(P)}M.unshift(O)}}catch(I){throw"error creating viewer grid: "+I}return M}}function S(w){var v=this;if(w=(0,b.getElement)(w),!!w){var A=m(w,{rows:1,cols:2,control_all:!0});this.glviewer1=A[0][0],this.glviewer2=A[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var M=Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(R){return typeof v.glviewer1[R]=="function"}),T=0;T<M.length;T++)this[M[T]]=(function(R){return function(){var O=this.glviewer1[R].apply(this.glviewer1,arguments),L=this.glviewer2[R].apply(this.glviewer2,arguments);return[O,L]}})(M[T]);this.setCoordinates=function(R,O,L){for(var P=0;P<R.length;P++)R[P].setCoordinates(O,L)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(R){this.glviewer1.render(),this.glviewer2.render(),R&&R(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}}}),"./src/Gradient.ts":((r,e,t)=>{t.r(e),t.d(e,{CustomLinear:()=>u,Gradient:()=>x,GradientType:()=>i,ROYGB:()=>l,RWB:()=>a,Sinebow:()=>d,builtinGradients:()=>g,getGradient:()=>o,normalizeValue:()=>s});var n=t("./src/colors.ts");class i{}function s(y,b,_){return b>=y?(_<y&&(_=y),_>b&&(_=b),{lo:y,hi:b,val:_}):(_>y&&(_=y),_<b&&(_=b),_=y-_+b,{lo:b,hi:y,val:_})}function o(y){if(y instanceof i)return y;if(y.gradient!==void 0&&g[y.gradient]){let b=y.min===void 0?-1:y.min,_=y.max===void 0?1:y.max;return y.mid===void 0?y.colors===void 0?new g[y.gradient](b,_):new g[y.gradient](b,_,y.colors):new g[y.gradient](b,_,y.mid)}else if(typeof y.gradient=="string"&&y.gradient.startsWith("linear_")){let b=y.gradient.split("_");b.shift();let _=y.min===void 0?-1:y.min,h=y.max===void 0?1:y.max;return new u(_,h,b)}return y}class a extends i{constructor(b,_,h){super(),this.gradient="RWB",this.mult=1,this.mid=h,this.min=b,this.max=_,typeof _>"u"&&Array.isArray(b)&&b.length>=2?(this.max=b[1],this.min=b[0]):b&&_&&!Array.isArray(b)&&(this.min=b,this.max=_)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(b,_){var h,f;if(b=this.mult*b,_?(h=_[0],f=_[1]):(h=this.min,f=this.max),b===void 0)return 16777215;var E=s(h,f,b);h=E.lo,f=E.hi,b=E.val;var m=(f+h)/2;_&&typeof _[2]<"u"?m=_[2]:typeof this.mid<"u"?m=this.mid:m=(h+f)/2;var S,w;return b<m?(S=Math.floor(255*Math.sqrt((b-h)/(m-h))),w=16711680+256*S+S,w):b>m?(S=Math.floor(255*Math.sqrt(1-(b-m)/(f-m))),w=65536*S+256*S+255,w):16777215}}class l extends i{constructor(b,_){super(),this.gradient="ROYGB",this.mult=1,this.min=b,this.max=_,typeof _>"u"&&Array.isArray(b)&&b.length>=2?(this.max=b[1],this.min=b[0]):b&&_&&!Array.isArray(b)&&(this.min=b,this.max=_)}valueToHex(b,_){var h,f;if(b=this.mult*b,_?(h=_[0],f=_[1]):(h=this.min,f=this.max),typeof b>"u")return 16777215;var E=s(h,f,b);h=E.lo,f=E.hi,b=E.val;var m=(h+f)/2,S=(h+m)/2,w=(m+f)/2,v,A;return b<S?(v=Math.floor(255*Math.sqrt((b-h)/(S-h))),A=16711680+256*v+0,A):b<m?(v=Math.floor(255*Math.sqrt(1-(b-S)/(m-S))),A=65536*v+65280+0,A):b<w?(v=Math.floor(255*Math.sqrt((b-m)/(w-m))),A=65280+1*v,A):(v=Math.floor(255*Math.sqrt(1-(b-w)/(f-w))),A=0+256*v+255,A)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class d extends i{constructor(b,_){super(),this.gradient="Sinebow",this.mult=1,this.min=b,this.max=_,typeof _>"u"&&Array.isArray(b)&&b.length>=2&&(this.max=b[1],this.min=b[0]),_<b&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(b,_){var h,f;if(b=this.mult*b,_?(h=_[0],f=_[1]):(h=this.min,f=this.max),typeof b>"u")return 16777215;var E=x.normalizeValue(h,f,b);h=E.lo,f=E.hi,b=E.val;var m=(b-h)/(f-h),S=5*m/6+.5,w=Math.sin(Math.PI*S);w*=w*255;var v=Math.sin(Math.PI*(S+1/3));v*=v*255;var A=Math.sin(Math.PI*(S+2/3));return A*=A*255,65536*Math.floor(w)+256*Math.floor(A)+1*Math.floor(v)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class u extends i{constructor(b,_,h){super(),this.gradient="linear",this.colors=new Array;var f;if(Array.isArray(b)&&b.length>=2?(this.max=b[1],this.min=b[0],f=_):(this.min=b,this.max=_,f=h),f)for(let E of f)this.colors.push(n.CC.color(E));else this.colors.push(n.CC.color(0))}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(b,_){var h,f;if(_?(h=_[0],f=_[1]):(h=this.min,f=this.max),b===void 0)return 16777215;var E=s(h,f,b);h=E.lo,f=E.hi,b=E.val;let m=this.colors.length,S=(f-h)/m,w=Math.min(Math.floor((b-h)/S),m-1),v=Math.min(w+1,m-1),A=(b-h-w*S)/S,M=this.colors[w],T=this.colors[v];return new n.Color(M.r+A*(T.r-M.r),M.g+A*(T.g-M.g),M.b+A*(T.b-M.b)).getHex()}}const g={rwb:a,RWB:a,roygb:l,ROYGB:l,sinebow:d,linear:u};class x extends i{valueToHex(b,_){return 0}range(){return null}}x.RWB=a,x.ROYGB=l,x.Sinebow=d,x.CustomLinear=u,x.builtinGradients=g,x.normalizeValue=s,x.getGradient=o}),"./src/Label.ts":((r,e,t)=>{t.r(e),t.d(e,{Label:()=>d,LabelCount:()=>o});var n=t("./src/WebGL/index.ts"),i=t("./src/Gradient.ts"),s=t("./src/colors.ts");let o=0;function a(u,g,x,y,b,_,h){u.beginPath(),u.moveTo(g+_,x),u.lineTo(g+y-_,x),u.quadraticCurveTo(g+y,x,g+y,x+_),u.lineTo(g+y,x+b-_),u.quadraticCurveTo(g+y,x+b,g+y-_,x+b),u.lineTo(g+_,x+b),u.quadraticCurveTo(g,x+b,g,x+b-_),u.lineTo(g,x+_),u.quadraticCurveTo(g,x,g+_,x),u.closePath(),u.fill(),h&&u.stroke()}function l(u,g,x){var y=x;return typeof u<"u"&&(u instanceof s.Color?y=u.scaled():(y=s.CC.color(u),typeof y.scaled<"u"&&(y=y.scaled()))),typeof g<"u"&&(y.a=parseFloat(g)),y}class d{constructor(g,x){this.id=o++,this.stylespec=x||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new n.Sprite,this.text=g,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}hide(){this.sprite&&(this.sprite.visible=!1)}show(){this.sprite&&(this.sprite.visible=!0)}setContext(){var g=this.stylespec,x=typeof g.useScreen>"u"?!1:g.useScreen,y=g.showBackground;(y==="0"||y==="false")&&(y=!1),typeof y>"u"&&(y=!0);var b=g.font?g.font:"sans-serif",_=parseInt(g.fontSize)?parseInt(g.fontSize):18,h=l(g.fontColor,g.fontOpacity,{r:255,g:255,b:255,a:1}),f=g.padding?g.padding:4,E=g.borderThickness?g.borderThickness:0,m=l(g.backgroundColor,g.backgroundOpacity,{r:0,g:0,b:0,a:1}),S=l(g.borderColor,g.borderOpacity,m),w=g.position?g.position:{x:-10,y:1,z:1},v=g.inFront!==void 0?g.inFront:!0;(v==="false"||v==="0")&&(v=!1);var A=g.alignment||n.SpriteAlignment.topLeft;typeof A=="string"&&A in n.SpriteAlignment&&(A=n.SpriteAlignment[A]);var M="";g.bold&&(M="bold "),this.context.font=M+_+"px  "+b;var T=this.context.measureText(this.text),R=T.width;y||(E=0);var O=R+2.5*E+2*f,L=_*1.25+2*E+2*f;if(g.backgroundImage){var P=g.backgroundImage,I=g.backgroundWidth?g.backgroundWidth:P.width,N=g.backgroundHeight?g.backgroundHeight:P.height;I>O&&(O=I),N>L&&(L=N)}if(this.canvas.width=O,this.canvas.height=L,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),M="",g.bold&&(M="bold "),this.context.font=M+_+"px  "+b,this.context.fillStyle="rgba("+m.r+","+m.g+","+m.b+","+m.a+")",this.context.strokeStyle="rgba("+S.r+","+S.g+","+S.b+","+S.a+")",g.backgroundGradient){let F=this.context.createLinearGradient(0,L/2,O,L/2),k=i.Gradient.getGradient(g.backgroundGradient),j=k.range(),H=-1,B=1;j&&(H=j[0],B=j[1]);let V=B-H;for(let Y=0;Y<1.01;Y+=.1){let K=l(k.valueToHex(H+V*Y)),J="rgba("+K.r+","+K.g+","+K.b+","+K.a+")";F.addColorStop(Y,J)}this.context.fillStyle=F}this.context.lineWidth=E,y&&a(this.context,E,E,O-2*E,L-2*E,6,E>0),g.backgroundImage&&this.context.drawImage(P,0,0,O,L),this.context.fillStyle="rgba("+h.r+","+h.g+","+h.b+","+h.a+")",this.context.fillText(this.text,E+f,_+E+f,R);var U=new n.Texture(this.canvas);U.needsUpdate=!0,this.sprite.material=new n.SpriteMaterial({map:U,useScreenCoordinates:x,alignment:A,depthTest:!v,screenOffset:g.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(w.x,w.y,w.z)}dispose(){this.sprite.material.map!==void 0&&this.sprite.material.map.dispose(),this.sprite.material!==void 0&&this.sprite.material.dispose()}}}),"./src/ProteinSurface4.ts":((r,e,t)=>{t.r(e),t.d(e,{MarchingCube:()=>l,MarchingCubeInitializer:()=>a,PointGrid:()=>d,ProteinSurface:()=>u,SurfaceType:()=>i,setSyncSurface:()=>o,syncSurface:()=>s});var n=t("./src/WebGL/math/index.ts"),i;(function(g){g[g.VDW=1]="VDW",g[g.MS=2]="MS",g[g.SAS=3]="SAS",g[g.SES=4]="SES"})(i||(i={}));var s=!1;function o(g){s=g}(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(s=!0);class a{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(x,y,b,_){let h=!!_.fulltable,f=_.hasOwnProperty("origin")&&_.origin.hasOwnProperty("x")?_.origin:{x:0,y:0,z:0},E=!!_.voxel,m=_.matrix,S=_.nX||0,w=_.nY||0,v=_.nZ||0,A=_.scale||1,M=null;_.unitCube?M=_.unitCube:M={x:A,y:A,z:A};let T=new Int32Array(S*w*v),R,O;for(R=0,O=T.length;R<O;++R)T[R]=-1;let L=function(U,F,k,j,H,B){let V={x:0,y:0,z:0},Y=!!(j&1<<H),K=!!(j&1<<B),J=H;if(!Y&&K&&(J=B),J&1&&k++,J&2&&F++,J&4&&U++,m){let He=new n.Vector3(U,F,k);He=He.applyMatrix4(m),V={x:He.x,y:He.y,z:He.z}}else V.x=f.x+M.x*U,V.y=f.y+M.y*F,V.z=f.z+M.z*k;let Te=(w*U+F)*v+k;return E?(y.push(V),y.length-1):(T[Te]<0&&(T[Te]=y.length,y.push(V)),T[Te])},P=new Int32Array(12),I=h?this.edgeTable2:this.edgeTable,N=h?this.triTable2:this.triTable;for(R=0;R<S-1;++R)for(let U=0;U<w-1;++U)for(let F=0;F<v-1;++F){let k=0;for(let B=0;B<8;++B){let V=(w*(R+((B&4)>>2))+U+((B&2)>>1))*v+F+(B&1),Y=!!(x[V]&this.ISDONE);k|=Y<<B}if(k===0||k===255)continue;let j=I[k];if(j===0)continue;let H=N[k];j&1&&(P[0]=L(R,U,F,k,0,1)),j&2&&(P[1]=L(R,U,F,k,1,3)),j&4&&(P[2]=L(R,U,F,k,3,2)),j&8&&(P[3]=L(R,U,F,k,2,0)),j&16&&(P[4]=L(R,U,F,k,4,5)),j&32&&(P[5]=L(R,U,F,k,5,7)),j&64&&(P[6]=L(R,U,F,k,7,6)),j&128&&(P[7]=L(R,U,F,k,6,4)),j&256&&(P[8]=L(R,U,F,k,0,4)),j&512&&(P[9]=L(R,U,F,k,1,5)),j&1024&&(P[10]=L(R,U,F,k,3,7)),j&2048&&(P[11]=L(R,U,F,k,2,6));for(let B=0;B<H.length;B+=3){let V=P[H[B]],Y=P[H[B+1]],K=P[H[B+2]];E&&B>=3&&(y.push(y[V]),V=y.length-1,y.push(y[Y]),Y=y.length-1,y.push(y[K]),K=y.length-1),b.push(V),b.push(Y),b.push(K)}}}laplacianSmooth(x,y,b){let _=new Array(y.length),h,f,E,m,S;for(h=0,f=y.length;h<f;h++)_[h]={x:0,y:0,z:0};let w=new Array(20),v;for(h=0;h<20;h++)w[h]=new Array(y.length);for(h=0,f=y.length;h<f;h++)w[0][h]=0;for(h=0,f=b.length/3;h<f;h++){let T=h*3,R=h*3+1,O=h*3+2;for(v=!0,E=0,m=w[0][b[T]];E<m;E++)if(b[R]==w[E+1][b[T]]){v=!1;break}for(v&&(w[0][b[T]]++,w[w[0][b[T]]][b[T]]=b[R]),v=!0,E=0,m=w[0][b[T]];E<m;E++)if(b[O]==w[E+1][b[T]]){v=!1;break}for(v&&(w[0][b[T]]++,w[w[0][b[T]]][b[T]]=b[O]),v=!0,E=0,m=w[0][b[R]];E<m;E++)if(b[T]==w[E+1][b[R]]){v=!1;break}for(v&&(w[0][b[R]]++,w[w[0][b[R]]][b[R]]=b[T]),v=!0,E=0,m=w[0][b[R]];E<m;E++)if(b[O]==w[E+1][b[R]]){v=!1;break}for(v&&(w[0][b[R]]++,w[w[0][b[R]]][b[R]]=b[O]),v=!0,E=0;E<w[0][b[O]];E++)if(b[T]==w[E+1][b[O]]){v=!1;break}for(v&&(w[0][b[O]]++,w[w[0][b[O]]][b[O]]=b[T]),v=!0,E=0,m=w[0][b[O]];E<m;E++)if(b[R]==w[E+1][b[O]]){v=!1;break}v&&(w[0][b[O]]++,w[w[0][b[O]]][b[O]]=b[R])}let A=1,M=.5;for(S=0;S<x;S++){for(h=0,f=y.length;h<f;h++)if(w[0][h]<3)_[h].x=y[h].x,_[h].y=y[h].y,_[h].z=y[h].z;else if(w[0][h]==3||w[0][h]==4){for(_[h].x=0,_[h].y=0,_[h].z=0,E=0,m=w[0][h];E<m;E++)_[h].x+=y[w[E+1][h]].x,_[h].y+=y[w[E+1][h]].y,_[h].z+=y[w[E+1][h]].z;_[h].x+=M*y[h].x,_[h].y+=M*y[h].y,_[h].z+=M*y[h].z,_[h].x/=M+w[0][h],_[h].y/=M+w[0][h],_[h].z/=M+w[0][h]}else{for(_[h].x=0,_[h].y=0,_[h].z=0,E=0,m=w[0][h];E<m;E++)_[h].x+=y[w[E+1][h]].x,_[h].y+=y[w[E+1][h]].y,_[h].z+=y[w[E+1][h]].z;_[h].x+=A*y[h].x,_[h].y+=A*y[h].y,_[h].z+=A*y[h].z,_[h].x/=A+w[0][h],_[h].y/=A+w[0][h],_[h].z/=A+w[0][h]}for(h=0,f=y.length;h<f;h++)y[h].x=_[h].x,y[h].y=_[h].y,y[h].z=_[h].z}}}let l=new a;class d{constructor(x,y,b){this.data=new Int32Array(x*y*b*3),this.width=y,this.height=b}set(x,y,b,_){let h=((x*this.width+y)*this.height+b)*3;this.data[h]=_.ix,this.data[h+1]=_.iy,this.data[h+2]=_.iz}get(x,y,b){let _=((x*this.width+y)*this.height+b)*3;return{ix:this.data[_],iy:this.data[_+1],iz:this.data[_+2]}}}class u{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],u.MarchingCube||(u.MarchingCube=new a)}getVDWIndex(x){return!x.elem||typeof this.vdwRadii[x.elem]>"u"?"X":x.elem}getFacesAndVertices(x){let y={};for(let h=0,f=x.length;h<f;h++)y[x[h]]=!0;let b=this.verts;for(let h=0,f=b.length;h<f;h++)b[h].x=b[h].x/this.scaleFactor-this.ptranx,b[h].y=b[h].y/this.scaleFactor-this.ptrany,b[h].z=b[h].z/this.scaleFactor-this.ptranz;let _=[];for(let h=0,f=this.faces.length;h<f;h+=3){let E=this.faces[h],m=this.faces[h+1],S=this.faces[h+2],w=b[E].atomid,v=b[m].atomid,A=b[S].atomid,M=w;v<M&&(M=v),A<M&&(M=A),y[M]&&E!==m&&m!==S&&E!==S&&(_.push(E),_.push(m),_.push(S))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:b,faces:_}}initparm(x,y,b){b>1e6&&(this.scaleFactor=this.defaultScaleFactor/2);let _=1/this.scaleFactor*5.5;this.pminx=x[0][0],this.pmaxx=x[1][0],this.pminy=x[0][1],this.pmaxy=x[1][1],this.pminz=x[0][2],this.pmaxz=x[1][2],y?(this.pminx-=this.probeRadius+_,this.pminy-=this.probeRadius+_,this.pminz-=this.probeRadius+_,this.pmaxx+=this.probeRadius+_,this.pmaxy+=this.probeRadius+_,this.pmaxz+=this.probeRadius+_):(this.pminx-=_,this.pminy-=_,this.pminz-=_,this.pmaxx+=_,this.pmaxy+=_,this.pmaxz+=_),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(y),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(x){let y={};for(const b in this.vdwRadii){let _=this.vdwRadii[b];x?y[b]=(_+this.probeRadius)*this.scaleFactor+.5:y[b]=_*this.scaleFactor+.5;let h=y[b]*y[b];this.widxz[b]=Math.floor(y[b])+1,this.depty[b]=new Int32Array(this.widxz[b]*this.widxz[b]);let f=0;for(let E=0;E<this.widxz[b];E++)for(let m=0;m<this.widxz[b];m++){let S=E*E+m*m;if(S>h)this.depty[b][f]=-1;else{let w=Math.sqrt(h-S);this.depty[b][f]=Math.floor(w)}f++}}}fillvoxels(x,y){for(let b=0,_=this.vpBits.length;b<_;b++)this.vpBits[b]=0,this.vpDistance[b]=-1,this.vpAtomID[b]=-1;for(let b in y){let _=x[y[b]];_!==void 0&&this.fillAtom(_,x)}for(let b=0,_=this.vpBits.length;b<_;b++)this.vpBits[b]&this.INOUT&&(this.vpBits[b]|=this.ISDONE)}fillAtom(x,y){let b=Math.floor(.5+this.scaleFactor*(x.x+this.ptranx)),_=Math.floor(.5+this.scaleFactor*(x.y+this.ptrany)),h=Math.floor(.5+this.scaleFactor*(x.z+this.ptranz)),f=this.getVDWIndex(x),E=0,m=this.pWidth*this.pHeight;for(let S=0,w=this.widxz[f];S<w;S++)for(let v=0;v<w;v++){if(this.depty[f][E]!=-1){for(let A=-1;A<2;A++)for(let M=-1;M<2;M++)for(let T=-1;T<2;T++)if(A!==0&&M!==0&&T!==0){let R=A*S,O=T*v;for(let L=0;L<=this.depty[f][E];L++){let P=L*M,I=b+R,N=_+P,U=h+O;if(I<0||N<0||U<0||I>=this.pLength||N>=this.pWidth||U>=this.pHeight)continue;let F=I*m+N*this.pHeight+U;if(!(this.vpBits[F]&this.INOUT))this.vpBits[F]|=this.INOUT,this.vpAtomID[F]=x.serial;else{let k=y[this.vpAtomID[F]];if(k.serial!=x.serial){let j=b+R-Math.floor(.5+this.scaleFactor*(k.x+this.ptranx)),H=_+P-Math.floor(.5+this.scaleFactor*(k.y+this.ptrany)),B=h+O-Math.floor(.5+this.scaleFactor*(k.z+this.ptranz));R*R+P*P+O*O<j*j+H*H+B*B&&(this.vpAtomID[F]=x.serial)}}}}}E++}}fillvoxelswaals(x,y){for(let b=0,_=this.vpBits.length;b<_;b++)this.vpBits[b]&=~this.ISDONE;for(let b in y){let _=x[y[b]];_!==void 0&&this.fillAtomWaals(_,x)}}fillAtomWaals(x,y){let b=0,_=Math.floor(.5+this.scaleFactor*(x.x+this.ptranx)),h=Math.floor(.5+this.scaleFactor*(x.y+this.ptrany)),f=Math.floor(.5+this.scaleFactor*(x.z+this.ptranz)),E=this.getVDWIndex(x),m=this.pWidth*this.pHeight;for(let S=0,w=this.widxz[E];S<w;S++)for(let v=0;v<w;v++){if(this.depty[E][b]!=-1){for(let A=-1;A<2;A++)for(let M=-1;M<2;M++)for(let T=-1;T<2;T++)if(A!==0&&M!==0&&T!==0){let R=A*S,O=T*v;for(let L=0;L<=this.depty[E][b];L++){let P=L*M,I=_+R,N=h+P,U=f+O;if(I<0||N<0||U<0||I>=this.pLength||N>=this.pWidth||U>=this.pHeight)continue;let F=I*m+N*this.pHeight+U;if(!(this.vpBits[F]&this.ISDONE))this.vpBits[F]|=this.ISDONE,this.vpAtomID[F]=x.serial;else{let k=y[this.vpAtomID[F]];if(k.serial!=x.serial){let j=_+R-Math.floor(.5+this.scaleFactor*(k.x+this.ptranx)),H=h+P-Math.floor(.5+this.scaleFactor*(k.y+this.ptrany)),B=f+O-Math.floor(.5+this.scaleFactor*(k.z+this.ptranz));R*R+P*P+O*O<j*j+H*H+B*B&&(this.vpAtomID[F]=x.serial)}}}}}b++}}buildboundary(){let x=this.pWidth*this.pHeight;for(let y=0;y<this.pLength;y++)for(let b=0;b<this.pHeight;b++)for(let _=0;_<this.pWidth;_++){let h=y*x+_*this.pHeight+b;if(this.vpBits[h]&this.INOUT){let f=0;for(;f<26;){let E=y+this.nb[f][0],m=b+this.nb[f][2],S=_+this.nb[f][1];if(E>-1&&E<this.pLength&&S>-1&&S<this.pWidth&&m>-1&&m<this.pHeight&&!(this.vpBits[E*x+S*this.pHeight+m]&this.INOUT)){this.vpBits[h]|=this.ISBOUND;break}else f++}}}}fastdistancemap(){let x=new d(this.pLength,this.pWidth,this.pHeight),y=this.pWidth*this.pHeight,b=this.cutRadius*this.cutRadius,_=[],h=[],f;for(let S=0;S<this.pLength;S++)for(let w=0;w<this.pWidth;w++)for(let v=0;v<this.pHeight;v++)if(f=S*y+w*this.pHeight+v,this.vpBits[f]&=~this.ISDONE,this.vpBits[f]&this.INOUT&&this.vpBits[f]&this.ISBOUND){let A={ix:S,iy:w,iz:v};x.set(S,w,v,A),_.push(A),this.vpDistance[f]=0,this.vpBits[f]|=this.ISDONE,this.vpBits[f]&=~this.ISBOUND}do{h=this.fastoneshell(_,x),_=[];for(let S=0,w=h.length;S<w;S++)f=y*h[S].ix+this.pHeight*h[S].iy+h[S].iz,this.vpBits[f]&=~this.ISBOUND,this.vpDistance[f]<=1.0404*b&&_.push({ix:h[S].ix,iy:h[S].iy,iz:h[S].iz})}while(_.length!==0);_=[],h=[],x=null;let E=this.scaleFactor-.5;E<0&&(E=0);let m=b-.5/(.1+E);for(let S=0;S<this.pLength;S++)for(let w=0;w<this.pWidth;w++)for(let v=0;v<this.pHeight;v++)f=S*y+w*this.pHeight+v,this.vpBits[f]&=~this.ISBOUND,this.vpBits[f]&this.INOUT&&(!(this.vpBits[f]&this.ISDONE)||this.vpBits[f]&this.ISDONE&&this.vpDistance[f]>=m)&&(this.vpBits[f]|=this.ISBOUND)}fastoneshell(x,y){let b,_,h,f,E,m,S,w,v,A=[];if(x.length===0)return A;let M={ix:-1,iy:-1,iz:-1},T=this.pWidth*this.pHeight;for(let R=0,O=x.length;R<O;R++){b=x[R].ix,_=x[R].iy,h=x[R].iz,w=y.get(b,_,h);for(let L=0;L<6;L++)M.ix=b+this.nb[L][0],M.iy=_+this.nb[L][1],M.iz=h+this.nb[L][2],M.ix<this.pLength&&M.ix>-1&&M.iy<this.pWidth&&M.iy>-1&&M.iz<this.pHeight&&M.iz>-1&&(v=M.ix*T+this.pHeight*M.iy+M.iz,this.vpBits[v]&this.INOUT&&!(this.vpBits[v]&this.ISDONE)?(y.set(M.ix,M.iy,h+this.nb[L][2],w),f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,this.vpDistance[v]=S,this.vpBits[v]|=this.ISDONE,this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})):this.vpBits[v]&this.INOUT&&this.vpBits[v]&this.ISDONE&&(f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,S<this.vpDistance[v]&&(y.set(M.ix,M.iy,M.iz,w),this.vpDistance[v]=S,this.vpBits[v]&this.ISBOUND||(this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})))))}for(let R=0,O=x.length;R<O;R++){b=x[R].ix,_=x[R].iy,h=x[R].iz,w=y.get(b,_,h);for(let L=6;L<18;L++)M.ix=b+this.nb[L][0],M.iy=_+this.nb[L][1],M.iz=h+this.nb[L][2],M.ix<this.pLength&&M.ix>-1&&M.iy<this.pWidth&&M.iy>-1&&M.iz<this.pHeight&&M.iz>-1&&(v=M.ix*T+this.pHeight*M.iy+M.iz,this.vpBits[v]&this.INOUT&&!(this.vpBits[v]&this.ISDONE)?(y.set(M.ix,M.iy,h+this.nb[L][2],w),f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,this.vpDistance[v]=S,this.vpBits[v]|=this.ISDONE,this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})):this.vpBits[v]&this.INOUT&&this.vpBits[v]&this.ISDONE&&(f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,S<this.vpDistance[v]&&(y.set(M.ix,M.iy,M.iz,w),this.vpDistance[v]=S,this.vpBits[v]&this.ISBOUND||(this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})))))}for(let R=0,O=x.length;R<O;R++){b=x[R].ix,_=x[R].iy,h=x[R].iz,w=y.get(b,_,h);for(let L=18;L<26;L++)M.ix=b+this.nb[L][0],M.iy=_+this.nb[L][1],M.iz=h+this.nb[L][2],M.ix<this.pLength&&M.ix>-1&&M.iy<this.pWidth&&M.iy>-1&&M.iz<this.pHeight&&M.iz>-1&&(v=M.ix*T+this.pHeight*M.iy+M.iz,this.vpBits[v]&this.INOUT&&!(this.vpBits[v]&this.ISDONE)?(y.set(M.ix,M.iy,h+this.nb[L][2],w),f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,this.vpDistance[v]=S,this.vpBits[v]|=this.ISDONE,this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})):this.vpBits[v]&this.INOUT&&this.vpBits[v]&this.ISDONE&&(f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,S<this.vpDistance[v]&&(y.set(M.ix,M.iy,M.iz,w),this.vpDistance[v]=S,this.vpBits[v]&this.ISBOUND||(this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})))))}return A}marchingcubeinit(x){for(let y=0,b=this.vpBits.length;y<b;y++)x==1?this.vpBits[y]&=~this.ISBOUND:x==4?(this.vpBits[y]&=~this.ISDONE,this.vpBits[y]&this.ISBOUND&&(this.vpBits[y]|=this.ISDONE),this.vpBits[y]&=~this.ISBOUND):x==2?this.vpBits[y]&this.ISBOUND&&this.vpBits[y]&this.ISDONE?this.vpBits[y]&=~this.ISBOUND:this.vpBits[y]&this.ISBOUND&&!(this.vpBits[y]&this.ISDONE)&&(this.vpBits[y]|=this.ISDONE):x==3&&(this.vpBits[y]&=~this.ISBOUND)}marchingcube(x){this.marchingcubeinit(x),this.verts=[],this.faces=[],u.MarchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let y=this.pWidth*this.pHeight;for(let b=0,_=this.verts.length;b<_;b++)this.verts[b].atomid=this.vpAtomID[this.verts[b].x*y+this.pHeight*this.verts[b].y+this.verts[b].z];u.MarchingCube.laplacianSmooth(1,this.verts,this.faces)}}u.MarchingCube=new a}),"./src/SurfaceWorker.js":(()=>{$3Dmol.workerString=(function(){self.onmessage=function(r){var e=r.data,t=e.type;if(t<0)self.atomData=e.atoms,self.volume=e.volume,self.ps=new ProteinSurface;else{var n=self.ps;n.initparm(e.expandedExtent,t!=1,self.volume),n.fillvoxels(self.atomData,e.extendedAtoms),n.buildboundary(),(t===4||t===2)&&(n.fastdistancemap(),n.boundingatom(!1),n.fillvoxelswaals(self.atomData,e.extendedAtoms)),n.marchingcube(t);var i=n.getFacesAndVertices(e.atomsToShow);self.postMessage(i)}}}).toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=`;
function _classCallCheck() {};`,$3Dmol.workerString+=`;
`+$3Dmol.Vector3.toString(),$3Dmol.workerString+=`;
`+$3Dmol.MarchingCubeInitializer.toString()+`;

`,$3Dmol.workerString+=`;
`+$3Dmol.PointGrid.toString()+`;
`,$3Dmol.workerString+=`;
var ProteinSurface = `+$3Dmol.ProteinSurface.toString()+`;
`,$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0}),"./src/VolumeData.ts":((r,e,t)=>{t.r(e),t.d(e,{VolumeData:()=>l});var n=t("./src/utilities.ts"),i=t("./src/WebGL/math/index.ts"),s=t("./src/parsers/VASP.ts"),o=t("./src/parsers/CUBE.ts"),a=t("./node_modules/pako/dist/pako.esm.mjs");class l{constructor(u,g,x){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(f){var E=f/(this.size.y*this.size.z),m=f%(this.size.y*this.size.z),S=f%this.size.z;return E*=this.unit.x,m*=this.unit.y,S*=this.unit.z,E+=this.origin.x,m+=this.origin.y,S+=this.origin.z,{x:E,y:m,z:S}},this.vasp=function(f){var E=f.replace(/^\s+/,"").split(/[\n\r]/),m=(0,s.VASP)(f)[0],S=m.length;if(S==0){console.warn("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var w=1.889725992,v=.036749309,A=parseFloat(E[1]),M;M=E[2].replace(/^\s+/,"").split(/\s+/);var T=new i.Vector3(parseFloat(M[0]),parseFloat(M[1]),parseFloat(M[2])).multiplyScalar(A*w);M=E[3].replace(/^\s+/,"").split(/\s+/);var R=new i.Vector3(parseFloat(M[0]),parseFloat(M[1]),parseFloat(M[2])).multiplyScalar(A*w);M=E[4].replace(/^\s+/,"").split(/\s+/);var O=new i.Vector3(parseFloat(M[0]),parseFloat(M[1]),parseFloat(M[2])).multiplyScalar(A*w),L=T.x*(R.y*O.z-O.y*R.z)-R.x*(T.y*O.z-O.y*T.z)+O.x*(T.y*R.z-R.y*T.z);L=Math.abs(L)/Math.pow(w,3);var P=1/L;E.splice(0,8+S+1);var I=E[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),N=Math.abs(parseFloat(I[0])),U=Math.abs(parseFloat(I[1])),F=Math.abs(parseFloat(I[2])),k=this.origin=new i.Vector3(0,0,0);this.size={x:N,y:U,z:F},this.unit=new i.Vector3(T.x,R.y,O.z),T=T.multiplyScalar(1/(w*N)),R=R.multiplyScalar(1/(w*U)),O=O.multiplyScalar(1/(w*F)),(T.y!=0||T.z!=0||R.x!=0||R.z!=0||O.x!=0||O.y!=0)&&(this.matrix=new i.Matrix4(T.x,R.x,O.x,0,T.y,R.y,O.y,0,T.z,R.z,O.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new i.Matrix4().makeTranslation(k.x,k.y,k.z)),this.origin=new i.Vector3(0,0,0),this.unit=new i.Vector3(1,1,1)),E.splice(0,1);var j=E.join(" ");j=j.replace(/^\s+/,"");var H=j.split(/[\s\r]+/);H.splice(N*U*F+1);for(var B=Float32Array.from(H,parseFloat),V=0;V<B.length;V++)B[V]=B[V]*P*v;this.data=B},this.dx=function(f){var E=f.split(/[\n\r]+/),m,S=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,w=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,v=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,A=/data follows/,M=0;for(M=0;M<E.length;M++){var T=E[M];if(m=S.exec(T)){var R=parseInt(m[1]),O=parseInt(m[2]),L=parseInt(m[3]);this.size={x:R,y:O,z:L}}else if(m=v.exec(T)){var P=parseFloat(m[1]);if((parseFloat(m[2])!=0||parseFloat(m[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),M+=1,T=E[M],m=v.exec(T),m==null){console.error("Parse error in dx delta matrix");return}var I=parseFloat(m[2]);if((parseFloat(m[1])!=0||parseFloat(m[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),M+=1,T=E[M],m=v.exec(T),m==null){console.error("Parse error in dx delta matrix");return}var N=parseFloat(m[3]);(parseFloat(m[1])!=0||parseFloat(m[2])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new i.Vector3(P,I,N)}else if(m=w.exec(T)){var U=parseFloat(m[1]),F=parseFloat(m[2]),k=parseFloat(m[3]);this.origin=new i.Vector3(U,F,k)}else if(m=A.exec(T))break}if(M+=1,!this.size||!this.origin||!this.unit||!this.size){console.error("Error parsing dx format");return}var j=E.splice(M).join(" "),H=j.split(/[\s\r]+/);this.data=Float32Array.from(H,parseFloat)},g=g.toLowerCase(),/\.gz$/.test(g)){g=g.replace(/\.gz$/,"");try{this[g]&&this.isbinary.has(g)?(typeof u=="string"&&(u=(0,n.base64ToArray)(u)),u=(0,a.inflate)(u)):u=new TextDecoder("utf-8").decode((0,a.inflate)(u))}catch(f){console.error(f)}}if(this[g]&&(this.isbinary.has(g)&&typeof u=="string"&&(u=(0,n.base64ToArray)(u)),this[g](u)),x){if(x.negate)for(let f=0,E=this.data.length;f<E;f++)this.data[f]=-this.data[f];if(x.normalize){var y=0;for(let f=0,E=this.data.length;f<E;f++)y+=this.data[f];var b=y/this.data.length;y=0;for(let f=0,E=this.data.length;f<E;f++){var _=this.data[f]-b;y+=_*_}var h=y/this.data.length;for(let f=0,E=this.data.length;f<E;f++)this.data[f]=(this.data[f]-b)/h}}}getIndex(u,g,x){if(this.matrix){this.inversematrix==null&&(this.inversematrix=new i.Matrix4().getInverse(this.matrix));var y=new i.Vector3(u,g,x);y=y.applyMatrix4(this.inversematrix),u=y.x,g=y.y,x=y.z}else u-=this.origin.x,g-=this.origin.y,x-=this.origin.z,u/=this.unit.x,g/=this.unit.y,x/=this.unit.z;return u=Math.round(u),g=Math.round(g),x=Math.round(x),u<0||u>=this.size.x||g<0||g>=this.size.y||x<0||x>=this.size.z?-1:u*this.size.y*this.size.z+g*this.size.z+x}getVal(u,g,x){let y=this.getIndex(u,g,x);return y<0?0:this.data[y]}cube(u){var g=u.split(/\r?\n/);if(!(g.length<6)){var x=(0,o.CUBE)(u,{}).modelData[0].cryst,y=g[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),b=parseFloat(y[0]),_=Math.abs(b);this.origin=x.origin,this.size=x.size,this.unit=x.unit,this.matrix=x.matrix4;var h=6;b<0&&h++;var f=g.splice(_+h).join(" ");f=f.replace(/^\s+/,"");var E=f.split(/[\s\r]+/);this.data=Float32Array.from(E,parseFloat)}}ccp4(u){var g={};u=new Int8Array(u);var x=new Int32Array(u.buffer,0,56),y=new Float32Array(u.buffer,0,56),b=new DataView(u.buffer);if(g.MAP=String.fromCharCode(b.getUint8(208),b.getUint8(209),b.getUint8(210),b.getUint8(211)),g.MACHST=[b.getUint8(212),b.getUint8(213)],g.MACHST[0]===17&&g.MACHST[1]===17)for(var _=u.byteLength,h=0;h<_;h+=4)b.setFloat32(h,b.getFloat32(h),!0);g.NX=x[0],g.NY=x[1],g.NZ=x[2],g.MODE=x[3],g.NXSTART=x[4],g.NYSTART=x[5],g.NZSTART=x[6],g.MX=x[7],g.MY=x[8],g.MZ=x[9],g.xlen=y[10],g.ylen=y[11],g.zlen=y[12],g.alpha=y[13],g.beta=y[14],g.gamma=y[15],g.MAPC=x[16],g.MAPR=x[17],g.MAPS=x[18],g.DMIN=y[19],g.DMAX=y[20],g.DMEAN=y[21],g.ISPG=x[22],g.NSYMBT=x[23],g.LSKFLG=x[24],g.originX=y[49],g.originY=y[50],g.originZ=y[51],g.ARMS=y[54];var f=g,E=[f.xlen,0,0],m=[f.ylen*Math.cos(Math.PI/180*f.gamma),f.ylen*Math.sin(Math.PI/180*f.gamma),0],S=[f.zlen*Math.cos(Math.PI/180*f.beta),f.zlen*(Math.cos(Math.PI/180*f.alpha)-Math.cos(Math.PI/180*f.gamma)*Math.cos(Math.PI/180*f.beta))/Math.sin(Math.PI/180*f.gamma),0];S[2]=Math.sqrt(f.zlen*f.zlen*Math.sin(Math.PI/180*f.beta)*Math.sin(Math.PI/180*f.beta)-S[1]*S[1]);var w=[0,E,m,S],v=[0,f.MX,f.MY,f.MZ],A=[0,f.MAPC,f.MAPR,f.MAPS];this.matrix=new i.Matrix4,this.matrix.set(w[A[1]][0]/v[A[1]],w[A[2]][0]/v[A[2]],w[A[3]][0]/v[A[3]],0,w[A[1]][1]/v[A[1]],w[A[2]][1]/v[A[2]],w[A[3]][1]/v[A[3]],0,w[A[1]][2]/v[A[1]],w[A[2]][2]/v[A[2]],w[A[3]][2]/v[A[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new i.Matrix4().makeTranslation(f.NXSTART+f.originX,f.NYSTART+f.originY,f.NZSTART+f.originZ)),this.origin=new i.Vector3(0,0,0),this.unit=new i.Vector3(1,1,1),this.size={x:g.NX,y:g.NY,z:g.NZ},this.dimensionorder=[g.MAPC,g.MAPR,g.MAPS];var M=new Float32Array(u.buffer,1024+g.NSYMBT),T=g.NX,R=g.NY,O=g.NZ;this.data=new Float32Array(T*R*O);for(let L=0;L<T;L++)for(let P=0;P<R;P++)for(let I=0;I<O;I++)this.data[(L*R+P)*O+I]=M[(I*R+P)*T+L]}}}),"./src/VolumetricRender.ts":((r,e,t)=>{t.r(e),t.d(e,{GLVolumetricRender:()=>l});var n=t("./src/WebGL/shapes/index.ts"),i=t("./src/WebGL/math/index.ts"),s=t("./src/WebGL/index.ts"),o=t("./src/colors.ts"),a=t("./src/GLShape.ts");class l{static interpolateArray(u,g){function x(S,w,v){return S+(w-S)*v}var y=[],b=(u.length-1)/(g-1);y[0]=u[0];for(var _=1;_<g-1;_++){var h=_*b,f=Math.floor(h),E=Math.ceil(h),m=h-f;y[_]=x(u[f],u[E],m)}return y[g-1]=u[u.length-1],y}constructor(u,g,x){this.hidden=!1,this.boundingSphere=new n.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,g=g||{};var y=Object.assign([],g.transferfn);this.subsamples=g.subsamples||5;let b=256;y.forEach(function(R){R.value=parseFloat(R.value)}),y.sort(function(R,O){return R.value-O.value}),this.min=y[0].value,y.length==0&&y.push(y[0]),this.max=y[y.length-1].value;var _,h,f,E,m,S,w,v,A,M;for(let R=0;R<y.length-1;R++)if(f=o.CC.color(y[R].color),E=o.CC.color(y[R+1].color),A=y[R].opacity,M=y[R+1].opacity,_=Math.floor((y[R].value-this.min)*b/(this.max-this.min)),h=Math.floor((y[R+1].value-this.min)*b/(this.max-this.min)),_!=h){m=l.interpolateArray([f.r*255,E.r*255],h-_),S=l.interpolateArray([f.g*255,E.g*255],h-_),w=l.interpolateArray([f.b*255,E.b*255],h-_),v=l.interpolateArray([A*255,M*255],h-_);for(let O=0;O<m.length;O++)this.transferfunctionbuffer.push(m[O]),this.transferfunctionbuffer.push(S[O]),this.transferfunctionbuffer.push(w[O]),this.transferfunctionbuffer.push(v[O])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),u.matrix){let R=new i.Vector3(0,0,0),O=new i.Vector3(u.size.x,u.size.y,u.size.z),L=new i.Vector3(1,1,1);R.applyMatrix4(u.matrix),O.applyMatrix4(u.matrix),L.applyMatrix4(u.matrix).sub(R),this.extent=[[R.x,R.y,R.z],[O.x,O.y,O.z]];for(let U=1;U<7;U++)O.x=U&1?u.size.x:0,O.y=U&2?u.size.y:0,O.z=U&4?u.size.z:0,O.applyMatrix4(u.matrix),this.extent[0][0]=Math.min(this.extent[0][0],O.x),this.extent[0][1]=Math.min(this.extent[0][1],O.y),this.extent[0][2]=Math.min(this.extent[0][2],O.z),this.extent[1][0]=Math.max(this.extent[1][0],O.x),this.extent[1][1]=Math.max(this.extent[1][1],O.y),this.extent[1][2]=Math.max(this.extent[1][2],O.z);let P=O.x-R.x,I=O.y-R.y,N=O.z-R.z;this.maxdepth=Math.sqrt(P*P+I*I+N*N),this.minunit=Math.min(Math.min(L.x,L.y),L.z),this.texmatrix=new i.Matrix4().identity().scale({x:u.size.x,y:u.size.y,z:u.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(u.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=new i.Matrix4().identity();let R=u.unit.x*u.size.x,O=u.unit.y*u.size.y,L=u.unit.z*u.size.z;this.texmatrix.makeTranslation(-u.origin.x/R,-u.origin.y/O,-u.origin.z/L),this.texmatrix.scale({x:1/R,y:1/O,z:1/L}),this.minunit=Math.min(Math.min(u.unit.x,u.unit.y),u.unit.z),this.extent=[[u.origin.x,u.origin.y,u.origin.z],[u.origin.x+R,u.origin.y+O,u.origin.z+L]],this.maxdepth=Math.sqrt(R*R+O*O+L*L)}var T=new a.GLShape({});if(T.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=T.finalize(),this.boundingSphere.center=new i.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,g.coords===void 0&&g.selection!==void 0&&(x?g.coords=x.selectedAtoms(g.selection):console.log("Need to provide viewer to volumetric renderer if selection specified.")),g.coords!==void 0&&g.seldist!==void 0){let R=new Uint8Array(u.data.length),O=g.seldist,L=O*O;for(let P=0,I=g.coords.length;P<I;P++){let N=g.coords[P],U=N.x-O,F=N.y-O,k=N.z-O,j=N.x+O,H=N.y+O,B=N.z+O;if(u.getIndex(U,F,k)>=0||u.getIndex(j,H,B)>=0)for(let V=U;V<j;V+=this.minunit)for(let Y=F;Y<H;Y+=this.minunit)for(let K=k;K<B;K+=this.minunit){let J=u.getIndex(V,Y,K);J>=0&&!R[J]&&(V-N.x)*(V-N.x)+(Y-N.y)*(Y-N.y)+(K-N.z)*(K-N.z)<L&&(R[J]=1)}}for(let P=0,I=u.data.length;P<I;P++)R[P]==0&&(u.data[P]=1/0)}this.data=u}globj(u){if(this.renderedShapeObj&&(u.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){this.shapeObj=new s.Object3D;var g=null,x=new s.Texture(this.data,!0),y=new s.Texture(this.transferfunctionbuffer,!1);x.needsUpdate=!0,y.needsUpdate=!0,y.flipY=!1,g=new s.VolumetricMaterial({transferfn:y,transfermin:this.min,transfermax:this.max,map:x,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples});var b=new s.Mesh(this.geo,g);this.shapeObj.add(b),this.renderedShapeObj=this.shapeObj.clone(),u.add(this.renderedShapeObj)}}removegl(u){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),u.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}}),"./src/WebGL/Camera.ts":((r,e,t)=>{t.r(e),t.d(e,{Camera:()=>s});var n=t("./src/WebGL/core/index.ts"),i=t("./src/WebGL/math/index.ts");class s extends n.Object3D{constructor(a=50,l=1,d=.1,u=2e3,g=!1){super(),this.projectionMatrix=new i.Matrix4,this.projectionMatrixInverse=new i.Matrix4,this.matrixWorldInverse=new i.Matrix4,this.fov=a,this.aspect=l,this.near=d,this.far=u;var x=this.position.z;this.right=x*Math.tan(Math.PI/180*a),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!g,this.updateProjectionMatrix()}lookAt(a){this.matrix.lookAt(this.position,a,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1&&this.rotation instanceof i.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}}),"./src/WebGL/Fog.ts":((r,e,t)=>{t.r(e),t.d(e,{Fog:()=>i});var n=t("./src/colors.ts");class i{constructor(o,a=1,l=1e3){this.name="",this.color=new n.Color(o),this.near=a,this.far=l}clone(){return new i(this.color.getHex(),this.near,this.far)}}}),"./src/WebGL/Renderer.ts":((r,e,t)=>{t.r(e),t.d(e,{Renderer:()=>_});var n=t("./src/WebGL/Camera.ts"),i=t("./src/WebGL/constants/Sides.ts"),s=t("./src/WebGL/constants/TextureConstants.ts"),o=t("./src/WebGL/core/index.ts"),a=t("./src/colors.ts"),l=t("./src/WebGL/materials/index.ts"),d=t("./src/WebGL/math/index.ts"),u=t("./src/WebGL/objects/index.ts"),g=t("./src/WebGL/shaders/index.ts"),x=t("./src/WebGL/SpritePlugin.ts"),y=null,b=null;class _{constructor(f){this.context=null,this.devicePixelRatio=1,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._offscreen=null,this._bitmap=null,this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._vector3=new d.Vector3,this._worldInverse=new d.Matrix4,this._projInverse=new d.Matrix4,this._textureMatrix=new d.Matrix4,this._fullProjModelMatrix=new d.Matrix4,this._fullProjModelMatrixInv=new d.Matrix4,this._direction=new d.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new x.SpritePlugin,this._screenshader=null,this._AOshader=null,this._blurshader=null,this._vertexattribpos=null,this._aovertexattribpos=null,this._blurvertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,this._shadingTexture=null,this._scratchTexture=null,this._upscale=null,this._AOstrength=1,this._AOradius=5,this.SHADE_TEXTURE=3,f=f||{},this.row=f.row,this.col=f.col,this.rows=f.rows,this.cols=f.cols,this._canvas=f.canvas!==void 0?f.canvas:document.createElement("canvas"),this._precision=f.precision!==void 0?f.precision:"highp",this._alpha=f.alpha!==void 0?f.alpha:!0,this._premultipliedAlpha=f.premultipliedAlpha!==void 0?f.premultipliedAlpha:!0,this._antialias=f.antialias!==void 0?f.antialias:!1,this._upscale=f.upscale!==void 0?f.upscale:this._antialias,this._preserveDrawingBuffer=f.preserveDrawingBuffer!==void 0?f.preserveDrawingBuffer:!1,this._clearColor=f.clearColor!==void 0?new a.Color(f.clearColor):new a.Color(0),this._clearAlpha=f.clearAlpha!==void 0?f.clearAlpha:0,this._outlineMaterial=new l.MeshOutlineMaterial(f.outline),this._outlineSphereImposterMaterial=new l.SphereImposterOutlineMaterial(f.outline),this._outlineStickImposterMaterial=new l.StickImposterOutlineMaterial(f.outline),this._outlineEnabled=!!f.outline,this._AOEnabled=!!f.ambientOcclusion,f.ambientOcclusion&&typeof f.ambientOcclusion.strength<"u"&&(this._AOstrength=parseFloat(f.ambientOcclusion.strength)),this._AOstrength==0&&(this._AOEnabled=!1),f.ambientOcclusion&&typeof f.ambientOcclusion.radius<"u"&&(this._AOradius=parseFloat(f.ambientOcclusion.radius)),this.domElement=this._canvas,this._canvas.id=f.id,!(f.containerWidth==0||f.containerHeight==0)&&(this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this))}supportedExtensions(){return{supportsAIA:!!this._extInstanced,supportsImposters:!!this._extFragDepth||!this.isWebGL1(),regen:!1}}getContext(){return this._gl}getCanvas(){return this._canvas}isLost(){return this._gl==null||this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(f,E){this._clearColor.setHex(f),this._clearAlpha=E,this.isLost()||this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(f){this._outlineMaterial=new l.MeshOutlineMaterial(f),this._outlineSphereImposterMaterial=new l.SphereImposterOutlineMaterial(f),this._outlineStickImposterMaterial=new l.StickImposterOutlineMaterial(f),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}enableAmbientOcclusion(f){f&&(f.strength&&(this._AOstrength=f.strength),f.scale&&(this._AOradius=f.scale)),this._AOEnabled=this._AOstrength>0}disableAmbientOcclusion(){this._AOEnabled=!1}setViewport(){if(this._offscreen&&(this._offscreen.width=this._canvas.width,this._offscreen.height=this._canvas.height),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null&&!this.isLost()){var f=this._gl.drawingBufferWidth/this.cols,E=this._gl.drawingBufferHeight/this.rows;this._viewportWidth=f,this._viewportHeight=E,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(f*this.col,E*this.row,f,E),this._gl.viewport(f*this.col,E*this.row,f,E)}}setSize(f,E){this.devicePixelRatio=window.devicePixelRatio!==void 0?window.devicePixelRatio:1,this._upscale&&this.devicePixelRatio<2&&(this.devicePixelRatio=2),this._canvas.width=f*this.devicePixelRatio,this._canvas.height=E*this.devicePixelRatio,this._canvas.style.width=f+"px",this._canvas.style.height=E+"px",this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null?(this.isLost()||(this._viewportWidth=this._gl.drawingBufferWidth/this.cols,this._viewportHeight=this._gl.drawingBufferHeight/this.rows),this.setViewport()):(this._viewportWidth=this._canvas.width,this._viewportHeight=this._canvas.height,this.isLost()||this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight)),this.initFrameBuffer()}clear(f,E,m){var S=0;(f===void 0||f)&&(S|=this._gl.COLOR_BUFFER_BIT),(E===void 0||E)&&(S|=this._gl.DEPTH_BUFFER_BIT),(m===void 0||m)&&(S|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(S)}setMaterialFaces(f,E){var m=f.side===i.DoubleSide,S=f.side===i.BackSide;f.imposter||(S=E?!S:S),this._oldDoubleSided!==m&&(m?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=m),this._oldFlipSided!==S&&(S?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=S),this._gl.cullFace(this._gl.BACK)}setDepthTest(f){this._oldDepthTest!==f&&(f?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=f)}setDepthWrite(f){this._oldDepthWrite!==f&&(this._gl.depthMask(f),this._oldDepthWrite=f)}setBlending(f){f?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND)}initMaterial(f,E,m,S){f.addEventListener("dispose",this.onMaterialDispose.bind(this));var w,v;if(v=f.shaderID,v){var A=g.ShaderLib[v];f.vertexShader=A.vertexShader,f.fragmentShader=A.fragmentShader,f.uniforms=g.ShaderUtils.clone(A.uniforms),f.shaded&&f.makeShaded(this.SHADE_TEXTURE)}w={wireframe:f.wireframe,fragdepth:f.imposter,volumetric:f.volumetric,shaded:f.shaded},f.program=this.buildProgram(f.fragmentShader,f.vertexShader,f.uniforms,w)}renderBuffer(f,E,m,S,w,v){if(S.visible){var A,M;if(A=this.setProgram(f,E,m,S,v,this),!!A){M=A.attributes;var T=!1,R=S.wireframe?1:0,O=w.id*16777215+A.id*2+R;O!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=O,T=!0),T&&(this.disableAttributes(),M.position>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglVertexBuffer),this.enableAttribute(M.position),this._gl.vertexAttribPointer(M.position,3,this._gl.FLOAT,!1,0,0)),M.color>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglColorBuffer),this.enableAttribute(M.color),this._gl.vertexAttribPointer(M.color,3,this._gl.FLOAT,!1,0,0)),M.normal>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglNormalBuffer),this.enableAttribute(M.normal),this._gl.vertexAttribPointer(M.normal,3,this._gl.FLOAT,!1,0,0)),M.offset>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglOffsetBuffer),this.enableAttribute(M.offset),this._gl.vertexAttribPointer(M.offset,3,this._gl.FLOAT,!1,0,0)),M.radius>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglRadiusBuffer),this.enableAttribute(M.radius),this._gl.vertexAttribPointer(M.radius,1,this._gl.FLOAT,!1,0,0)));var L,P;if(v instanceof u.Mesh){if(S.shaderID==="instanced"){var I=S.sphere.geometryGroups[0];T&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,I.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,I.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,I.faceArray,this._gl.STATIC_DRAW)),L=I.faceidx,this._extInstanced.vertexAttribDivisorANGLE(M.offset,1),this._extInstanced.vertexAttribDivisorANGLE(M.radius,1),this._extInstanced.vertexAttribDivisorANGLE(M.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,L,this._gl.UNSIGNED_SHORT,0,w.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(M.offset,0),this._extInstanced.vertexAttribDivisorANGLE(M.radius,0),this._extInstanced.vertexAttribDivisorANGLE(M.color,0)}else S.wireframe?(P=w.lineidx,this.setLineWidth(S.wireframeLinewidth),T&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,P,this._gl.UNSIGNED_SHORT,0)):(L=w.faceidx,T&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,L,this._gl.UNSIGNED_SHORT,0));this.info.render.calls++,this.info.render.vertices+=L,this.info.render.faces+=L/3}else v instanceof u.Line&&(P=w.vertices,this.setLineWidth(S.linewidth),this._gl.drawArrays(this._gl.LINES,0,P),this.info.render.calls++)}}}clearShading(){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}setShading(f,E,m){let S=f.__lights,w=f.fog,v=[];for(let T=0,R=f.__webglObjects.length;T<R;T++){let O=f.__webglObjects[T];O.render&&O[m]&&v.push(O)}if(v.length==0)return;this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,null,0),this.renderObjects(f.__webglObjects,!0,m+"Depth",E,S,w,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._scratchTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._AOshader),this._currentProgram=this._AOshader,this.setDepthTest(-1),this.setDepthWrite(-1);let A=this._AOshader.uniforms;this._gl.uniform1f(A.total_strength,this._AOstrength),this._gl.uniform1f(A.radius,this._AOradius),this._fullProjModelMatrix=new d.Matrix4,this._fullProjModelMatrixInv=new d.Matrix4;let M=v[0].object;this._fullProjModelMatrix.multiplyMatrices(E.projectionMatrix,M._modelViewMatrix),this._fullProjModelMatrixInv.getInverse(this._fullProjModelMatrix),this._gl.uniformMatrix4fv(A.projectionMatrix,!1,this._fullProjModelMatrix.elements),this._gl.uniformMatrix4fv(A.projinv,!1,this._fullProjModelMatrixInv.elements),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._aovertexattribpos),this._gl.vertexAttribPointer(this._aovertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._blurshader),this._currentProgram=this._blurshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._blurvertexattribpos),this._gl.vertexAttribPointer(this._blurvertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}render(f,E){if(!(E instanceof n.Camera)){console.error("Renderer.render: camera is not an instance of Camera.");return}var m,S,w,v,A,M=f.__lights,T=f.fog;if(this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&f.updateMatrixWorld(),E.parent===void 0&&E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),this.isLost())return;this.autoUpdateObjects&&this.initWebGLObjects(f),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(!0,!0,!0),A=f.__webglObjects;let R=!1,O=this._AOEnabled;for(m=0,S=A.length;m<S;m++)w=A[m],v=w.object,w.render=!1,v.visible&&(this.setupMatrices(v,E),this.unrollBufferMaterial(w),w.render=!0,w.volumetric&&(R=!0),w.hasAO&&(O=!0));if(this.setBlending(!1),O&&this.setShading(f,E,"opaque"),this.renderObjects(f.__webglObjects,!0,"opaque",E,M,T,!1),O&&this.clearShading(),this.renderSprites(f,E,!1),this.renderObjects(f.__webglObjects,!0,"transparentDepth",E,M,T,!0),this.renderObjects(f.__webglObjects,!1,"transparent",E,M,T,!0),R&&this._fb&&(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,null,0),this.renderObjects(f.__webglObjects,!1,"volumetric",E,M,T,!0)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(f,E,!0),this._bitmap){const L=this._offscreen.transferToImageBitmap();this._bitmap.transferFromImageBitmap(L),L.close()}}setFrameBuffer(){if(this.isWebGL1()||!this._fb)return;let f=this._viewportWidth,E=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,f,E),this._gl.viewport(0,0,f,E),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,f,E,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,f,E,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._shadingTexture&&(this._gl.deleteTexture(this._shadingTexture),this._shadingTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,f,E,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.deleteTexture(this._scratchTexture),this._scratchTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,f,E,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.clearDepth(1),this._gl.clear(this._gl.DEPTH_BUFFER_BIT),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}initFrameBuffer(){if(this.isWebGL1())return;let f=this._viewportWidth,E=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,f,E),this._gl.viewport(0,0,f,E),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._shadingTexture=this._gl.createTexture(),this._scratchTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer();var m=this._antialias?g.ShaderLib.screenaa:g.ShaderLib.screen;this._screenshader=this.buildProgram(m.fragmentShader,m.vertexShader,m.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition");var S=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(S),this._gl.STATIC_DRAW);let w=g.ShaderLib.ssao;this._AOshader=this.buildProgram(w.fragmentShader,w.vertexShader,w.uniforms,{}),this._aovertexattribpos=this._gl.getAttribLocation(this._AOshader,"vertexPosition");let v=g.ShaderLib.blur;this._blurshader=this.buildProgram(v.fragmentShader,v.vertexShader,v.uniforms,{}),this._blurvertexattribpos=this._gl.getAttribLocation(this._blurshader,"vertexPosition")}renderFrameBuffertoScreen(){this.isWebGL1()||this._fb===null||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(f){if(f.__webglObjects||(f.__webglObjects=[],f.__webglObjectsImmediate=[],f.__webglSprites=[],f.__webglFlares=[]),f.__objectsAdded.length){for(;f.__objectsAdded.length;)this.addObject(f.__objectsAdded[0],f),f.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;f.__objectsRemoved.length;)this.removeObject(f.__objectsRemoved[0],f),f.__objectsRemoved.splice(0,1);for(var E=0,m=f.__webglObjects.length;E<m;E++)this.updateObject(f.__webglObjects[E].object)}getYRatio(){return this.rows!==void 0&&this.row!==void 0?this.rows:1}getXRatio(){return this.cols!==void 0&&this.col!==void 0?this.cols:1}getAspect(f,E){(f==null||E==null)&&(f=this._canvas.width,E=this._canvas.height);var m=f/E;if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var S=f/this.cols,w=E/this.rows;m=S/w}return m}setTexture(f,E,m){if(f.needsUpdate){f.__webglInit||(f.__webglInit=!0,f.addEventListener("dispose",this.onTextureDispose.bind(this)),f.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+E);var S=m?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D;this._gl.bindTexture(S,f.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,f.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,f.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,f.unpackAlignment);var w=this.paramToGL(f.format),v=this.paramToGL(f.type);if(m)this.setTextureParameters(this._gl.TEXTURE_3D,f),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,f.image.size.z,f.image.size.y,f.image.size.x,0,this._gl.RED,this._gl.FLOAT,f.image.data);else{var A=f.image,M=A.width,T=A.height;typeof M>"u"&&(M=A.length,w==this._gl.RGBA&&(M/=4),T=1),this.setTextureParameters(this._gl.TEXTURE_2D,f),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,w,w,v,f.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,w,M,T,0,w,v,f.image)}f.needsUpdate=!1,f.onUpdate&&f.onUpdate()}else this._gl.activeTexture(this._gl.TEXTURE0+E),m?this._gl.bindTexture(this._gl.TEXTURE_3D,f.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,f.__webglTexture)}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(f){this._enabledAttributes[f]||(this._gl.enableVertexAttribArray(f),this._enabledAttributes[f]=!0)}disableAttributes(){for(let f in this._enabledAttributes)this._enabledAttributes[f]&&(this._gl.disableVertexAttribArray(f),this._enabledAttributes[f]=!1)}setPolygonOffset(f,E,m){this._oldPolygonOffset!==f&&(f?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(f){f!==this._oldLineWidth&&(this._gl.lineWidth(f),this._oldLineWidth=f)}deallocateGeometry(f){if(f.__webglInit=void 0,f.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(f.__webglVertexBuffer),f.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(f.__webglColorBuffer),f.geometryGroups!==void 0)for(var E=0,m=f.groups;E<m;E++){var S=f.geometryGroups[E];S.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(S.__webglVertexBuffer),S.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(S.__webglColorBuffer),S.__webglNormalBuffer!==void 0&&this._gl.deleteBuffer(S.__webglNormalBuffer),S.__webglFaceBuffer!==void 0&&this._gl.deleteBuffer(S.__webglFaceBuffer),S.__webglLineBuffer!==void 0&&this._gl.deleteBuffer(S.__webglLineBuffer)}}deallocateMaterial(f){var E=f.program;if(E!==void 0){f.program=void 0;var m,S,w,v=!1;for(m=0,S=this._programs.length;m<S;m++)if(w=this._programs[m],w.program===E){w.usedTimes--,w.usedTimes===0&&(v=!0);break}if(v===!0){var A=[];for(m=0,S=this._programs.length;m<S;m++)w=this._programs[m],w.program!==E&&A.push(w);this._programs=A,this._gl.deleteProgram(E),this.info.memory.programs--}}}deallocateTexture(f){if(f.image&&f.image.__webglTextureCube)this._gl.deleteTexture(f.image.__webglTextureCube);else{if(!f.__webglInit)return;f.__webglInit=!1,this._gl.deleteTexture(f.__webglTexture)}}onGeometryDispose(f){var E=f.target;E.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(E),this.info.memory.geometries--}onTextureDispose(f){var E=f.target;E.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(E),this.info.memory.textures--}onMaterialDispose(f){var E=f.target;E.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(E)}getShader(f,E){var m;return!this.isWebGL1()&&!E.startsWith("#version")&&(E=E.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),f=="fragment"?E=E.replace(/varying/g,"in"):E=E.replace(/varying/g,"out"),E=E.replace(/attribute/g,"in"),E=E.replace(/texture2D/g,"texture"),E=E.replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;"),E=E.replace(/gl_FragColor/g,"glFragColor"),E=`#version 300 es
`+E),f==="fragment"?m=this._gl.createShader(this._gl.FRAGMENT_SHADER):f==="vertex"&&(m=this._gl.createShader(this._gl.VERTEX_SHADER)),m==null?null:(this._gl.shaderSource(m,E),this._gl.compileShader(m),this._gl.getShaderParameter(m,this._gl.COMPILE_STATUS)?m:(console.error(this._gl.getShaderInfoLog(m)),console.error("could not initialize shader"),null))}buildProgram(f,E,m,S){var w,v,A,M,T=[];T.push(f),T.push(E);for(w in S)T.push(w),T.push(S[w]);for(M=T.join(),w=0,v=this._programs.length;w<v;w++){var R=this._programs[w];if(R.code===M)return R.usedTimes++,R.program}if(this.isWebGL1()&&S.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");if(A=this._gl.createProgram(),A==null)return null;var O=this._precision,L="precision "+O+" float;",P=[S.volumetric?"#version 300 es":"",L].join(`
`),I=[S.volumetric?"#version 300 es":"",S.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",S.shaded?"#define SHADED 1":"",S.wireframe?"#define WIREFRAME 1":"",L].join(`
`),N=this.getShader("fragment",I+f),U=this.getShader("vertex",P+E);U!=null&&this._gl.attachShader(A,U),N!=null&&this._gl.attachShader(A,N),this._gl.linkProgram(A),this._gl.getProgramParameter(A,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),A.uniforms={},A.attributes={};var F,k,j;F=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","vWidth","vHeight"];for(k in m)F.push(k);for(j=0;j<F.length;j++){var H=F[j];A.uniforms[H]=this._gl.getUniformLocation(A,H)}for(F=["position","normal","color","lineDistance","offset","radius"],j=0;j<F.length;j++){var B=F[j];A.attributes[B]=this._gl.getAttribLocation(A,B)}return A.id=this._programs_counter++,this._programs.push({program:A,code:M,usedTimes:1}),this.info.memory.programs=this._programs.length,A}setProgram(f,E,m,S,w,v){if(S.needsUpdate&&(S.program&&this.deallocateMaterial(S),this.initMaterial(S,E,m,w),S.needsUpdate=!1),S.program==null)return null;var A=!1,M=S.program,T=M.uniforms,R=S.uniforms;if(M!=this._currentProgram&&(this._gl.useProgram(M),this._currentProgram=M,A=!0),S.id!=this._currentMaterialId&&(this._currentMaterialId=S.id,A=!0),f!=this._currentCamera&&(this._currentCamera=f,A=!0),T.projectionMatrix&&this._gl.uniformMatrix4fv(T.projectionMatrix,!1,f.projectionMatrix.elements),T.modelViewMatrix&&this._gl.uniformMatrix4fv(T.modelViewMatrix,!1,w._modelViewMatrix.elements),T.normalMatrix&&this._gl.uniformMatrix3fv(T.normalMatrix,!1,w._normalMatrix.elements),T.projinv&&(this._projInverse.getInverse(f.projectionMatrix),this._gl.uniformMatrix4fv(T.projinv,!1,this._projInverse.elements)),T.viewMatrix&&this._gl.uniformMatrix4fv(T.viewMatrix,!1,f.matrixWorldInverse.elements),T.vWidth&&this._gl.uniform1f(T.vWidth,this._viewportWidth),T.vHeight&&this._gl.uniform1f(T.vHeight,this._viewportHeight),A){if(R.fogColor.value=m.color,R.fogNear.value=m.near,R.fogFar.value=m.far,S.shaderID.startsWith("lambert")||S.shaderID==="instanced"||S.shaderID.endsWith("imposter"))this._lightsNeedUpdate&&(this.setupLights(M,E),this._lightsNeedUpdate=!1),R.directionalLightColor.value=this._lights.directional.colors,R.directionalLightDirection.value=this._lights.directional.positions;else if(S.shaderID.endsWith("outline"))R.outlineColor.value=S.outlineColor,R.outlineWidth.value=S.outlineWidth,R.outlinePushback.value=S.outlinePushback,R.outlineMaxPixels.value=S.outlineMaxPixels*this.devicePixelRatio;else if(S.shaderID==="volumetric"){w._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(w._modelViewMatrix),this._projInverse.getInverse(f.projectionMatrix),this._textureMatrix.multiplyMatrices(w.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(T.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(T.projinv,!1,this._projInverse.elements);let O=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z);R.step.value=w.material.unit*O,R.maxdepth.value=w.material.maxdepth*O,R.transfermax.value=w.material.transfermax,R.transfermin.value=w.material.transfermin,R.subsamples.value=w.material.subsamples,v.setTexture(w.material.transferfn,4,!1),v.setTexture(w.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)}R.opacity.value=S.opacity,this.loadMaterialUniforms(T,R)}return R.shading&&(R.shading.value==3?(this._gl.activeTexture(this._gl.TEXTURE0+this.SHADE_TEXTURE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture)):console.error("Invalid shading textures.")),M}loadMaterialUniforms(f,E){var m,S,w,v;for(m in E)f[m]&&(S=E[m].type,w=E[m].value,v=f[m],S==="f"?this._gl.uniform1f(v,w):S==="i"?this._gl.uniform1i(v,w):S==="fv"?this._gl.uniform3fv(v,w):S==="c"?this._gl.uniform3f(v,w.r,w.g,w.b):S==="f4"&&this._gl.uniform4f(v,w[0],w[1],w[2],w[3]))}addObject(f,E){var m,S,w,v;if(!f.__webglInit&&(f.__webglInit=!0,f._modelViewMatrix=new d.Matrix4,f._normalMatrix=new d.Matrix3,f.geometry!==void 0&&f.geometry.__webglInit===void 0&&(f.geometry.__webglInit=!0,f.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),f instanceof u.Mesh||f instanceof u.Line))for(w=f.geometry,m=0,S=w.geometryGroups.length;m<S;m++)v=w.geometryGroups[m],v.id=this._geometryGroupCounter++,v.__webglVertexBuffer||(f instanceof u.Mesh?(this.createMeshBuffers(v),w.elementsNeedUpdate=!0,w.normalsNeedUpdate=!0):f instanceof u.Line&&this.createLineBuffers(v),w.verticesNeedUpdate=!0,w.colorsNeedUpdate=!0);if(!f.__webglActive){if(f instanceof u.Mesh||f instanceof u.Line)for(w=f.geometry,m=0,S=w.geometryGroups.length;m<S;m++)v=w.geometryGroups[m],this.addBuffer(E.__webglObjects,v,f);else f instanceof u.Sprite&&E.__webglSprites.push(f);f.__webglActive=!0}}updateObject(f){var E=f.geometry,m;if(f instanceof u.Mesh||f instanceof u.Line){for(var S=0,w=E.geometryGroups.length;S<w;S++)m=E.geometryGroups[S],(E.verticesNeedUpdate||E.elementsNeedUpdate||E.colorsNeedUpdate||E.normalsNeedUpdate)&&this.setBuffers(m,this._gl.STATIC_DRAW);E.verticesNeedUpdate=!1,E.elementsNeedUpdate=!1,E.normalsNeedUpdate=!1,E.colorsNeedUpdate=!1,E.buffersNeedUpdate=!1}}removeObject(f,E){f instanceof u.Mesh||f instanceof u.Line?this.removeInstances(E.__webglObjects,f):f instanceof u.Sprite&&this.removeInstancesDirect(E.__webglSprites,f),f.__webglActive=!1}removeInstances(f,E){for(var m=f.length-1;m>=0;--m)f[m].object===E&&f.splice(m,1)}removeInstancesDirect(f,E){for(var m=f.length-1;m>=0;--m)f[m]===E&&f.splice(m,1)}unrollBufferMaterial(f){var E=f.object,m=E.material;if(m.volumetric)f.opaque=null,f.transparent=null,f.volumetric=m;else if(m.transparent){if(f.opaque=null,f.volumetric=null,f.transparent=m,!m.wireframe){let S=m.clone();S.opacity=0,f.transparentDepth=S}}else{if(f.opaque=m,f.transparent=null,f.volumetric=null,!m.wireframe){let S=m.clone();S.opacity=0,f.opaqueDepth=S}m.hasAO&&(f.hasAO=!0),(this._AOEnabled||f.hasAO)&&(f.opaqueShaded=m.clone(),f.opaqueShaded.shaded=!0)}}setBuffers(f,E){var m=f.vertexArray,S=f.colorArray;if(f.__webglOffsetBuffer!==void 0?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglOffsetBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,m,E)):(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,m,E)),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,S,E),f.normalArray&&f.__webglNormalBuffer!==void 0){var w=f.normalArray;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,w,E)}if(f.radiusArray&&f.__webglRadiusBuffer!==void 0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,f.radiusArray,E)),f.faceArray&&f.__webglFaceBuffer!==void 0){var v=f.faceArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,v,E)}if(f.lineArray&&f.__webglLineBuffer!==void 0){var A=f.lineArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,A,E)}}createMeshBuffers(f){f.radiusArray&&(f.__webglRadiusBuffer=this._gl.createBuffer()),f.useOffset&&(f.__webglOffsetBuffer=this._gl.createBuffer()),f.__webglVertexBuffer=this._gl.createBuffer(),f.__webglNormalBuffer=this._gl.createBuffer(),f.__webglColorBuffer=this._gl.createBuffer(),f.__webglFaceBuffer=this._gl.createBuffer(),f.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(f){f.__webglVertexBuffer=this._gl.createBuffer(),f.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(f,E,m){f.push({buffer:E,object:m,opaque:null,transparent:null})}setupMatrices(f,E){f._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,f.matrixWorld),f._normalMatrix.getInverse(f._modelViewMatrix),f._normalMatrix.transpose()}filterFallback(f){return this._gl.LINEAR}setTextureParameters(f,E){f==this._gl.TEXTURE_2D?(this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(E.magFilter)),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(E.minFilter))):(this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(f){return f===s.UnsignedByteType?this._gl.UNSIGNED_BYTE:f===s.RGBAFormat?this._gl.RGBA:f===s.NearestFilter?this._gl.NEAREST:0}setupLights(f,E){var m,S,w,v=0,A=0,M=0,T,R,O=this._lights,L=O.directional.colors,P=O.directional.positions,I=0,N=0;for(m=0,S=E.length;m<S;m++)if(w=E[m],T=w.color,R=w.intensity,w instanceof o.Light){if(this._direction.getPositionFromMatrix(w.matrixWorld),this._vector3.getPositionFromMatrix(w.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),this._direction.x===0&&this._direction.y===0&&this._direction.z===0)continue;P[N]=this._direction.x,P[N+1]=this._direction.y,P[N+2]=this._direction.z,L[N]=T.r*R,L[N+1]=T.g*R,L[N+2]=T.b*R,N+=3,I++}O.ambient[0]=v,O.ambient[1]=A,O.ambient[2]=M,O.directional.length=I}initGL(){try{if(OffscreenCanvas&&!(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null))(b==null||b.isContextLost())&&(y=new OffscreenCanvas(this._canvas.width,this._canvas.height),b=y.getContext("webgl2",{alpha:!0,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})),this._offscreen=y,this._gl=b,this._bitmap=this._canvas.getContext("bitmaprenderer",{alpha:!0});else if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context.";var f=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(f[6])}catch(E){console.error(E)}}isWebGL1(){return this._webglversion==1}setDefaultGLState(){this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(f,E,m,S,w,v,A){var M,T,R,O,L,P,I;E?(L=f.length-1,P=-1,I=-1):(L=0,P=f.length,I=1);for(var N=L;N!==P;N+=I)if(M=f[N],M.render){if(T=M.object,R=M.buffer,O=M[m],(M.hasAO||this._AOEnabled)&&M[m+"Shaded"]&&(O=M[m+"Shaded"]),!O)continue;this.setBlending(A),this.setDepthTest(O.depthTest),this.setDepthWrite(O.depthWrite),this.setPolygonOffset(O.polygonOffset,O.polygonOffsetFactor,O.polygonOffsetUnits);var U=T._modelViewMatrix.isReflected();if(this.setMaterialFaces(O,U),this.renderBuffer(S,w,v,O,R,T),(this._outlineEnabled||O.outline)&&!O.wireframe&&O.shaderID!=="basic"&&O.opacity!==0){let F=this._outlineMaterial;O.shaderID=="sphereimposter"?F=this._outlineSphereImposterMaterial:O.shaderID=="stickimposter"&&(F=this._outlineStickImposterMaterial),this.renderBuffer(S,w,v,F,R,T)}}}renderSprites(f,E,m){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(f,E,this._currentWidth,this._currentHeight,m),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}}),"./src/WebGL/SpritePlugin.ts":((r,e,t)=>{t.r(e),t.d(e,{SpritePlugin:()=>i});var n=t("./src/WebGL/shaders/index.ts");class i{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(a){this.gl=a.context,this.renderer=a,this.precision=a.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);var l=0;this.sprite.vertices[l++]=-1,this.sprite.vertices[l++]=-1,this.sprite.vertices[l++]=0,this.sprite.vertices[l++]=0,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=-1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=0,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=-1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=0,this.sprite.vertices[l++]=1,l=0,this.sprite.faces[l++]=0,this.sprite.faces[l++]=1,this.sprite.faces[l++]=2,this.sprite.faces[l++]=0,this.sprite.faces[l++]=2,this.sprite.faces[l++]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(n.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const d={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),d.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),d.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),d.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),d.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),d.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),d.color=this.gl.getUniformLocation(this.sprite.program,"color"),d.map=this.gl.getUniformLocation(this.sprite.program,"map"),d.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),d.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),d.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),d.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),d.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),d.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),d.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),d.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),d.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=d}render(a,l,d,u,g){var x,y,b,_,h,f,E,m,S,w;if(!this.gl)throw new Error("WebGLRenderer not initialized");let v=[];(x=a?.__webglSprites)===null||x===void 0||x.forEach(H=>{(g&&H.material.depthTest==!1||!g&&H.material.depthTest)&&v.push(H)});let A=v.length;if(!A)return;const M=this.sprite.attributes,T=this.sprite.uniforms;if(!T)throw new Error("Uniforms not defined");var R=d*.5,O=u*.5;this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(M.position),this.gl.enableVertexAttribArray(M.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(M.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(M.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(T.projectionMatrix,!1,l.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(T.map,0);var L=a.fog;L?(this.gl.uniform3f(T.fogColor,L.color.r,L.color.g,L.color.b),this.gl.uniform1f(T.fogNear,L.near),this.gl.uniform1f(T.fogFar,L.far)):(this.gl.uniform1f(T.fogNear,0),this.gl.uniform1f(T.fogFar,0));var P;let I,N,U,F=[];for(P=0;P<A;P++)I=v[P],N=I.material,N&&(N.depthTest==!1&&!g||!I.visible||N.opacity===0||(N.useScreenCoordinates?I.z=-I.position.z:(I._modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,I.matrixWorld),I.z=-I._modelViewMatrix.elements[14])));for(v.sort(s),P=0;P<A;P++)if(I=v[P],N=I.material,!!N&&!(!I.visible||N.opacity===0)&&N.map&&N.map.image&&N.map.image.width){this.gl.uniform1f(T?.alphaTest||null,N.alphaTest);var k=N.map.image.width,j=N.map.image.height;F[0]=k*this.renderer.devicePixelRatio/d,F[1]=j*this.renderer.devicePixelRatio/u,N.useScreenCoordinates===!0?(this.gl.uniform1i(T.useScreenCoordinates,1),this.gl.uniform3f(T.screenPosition,(I.position.x*this.renderer.devicePixelRatio-R)/R,(O-I.position.y*this.renderer.devicePixelRatio)/O,Math.max(0,Math.min(1,I.position.z)))):(this.gl.uniform1i(T.useScreenCoordinates,0),this.gl.uniformMatrix4fv(T.modelViewMatrix,!1,I._modelViewMatrix.elements)),U=1/(N.scaleByViewport?u:1),F[0]*=U*I.scale.x,F[1]*=U*I.scale.y;let H=(y=N?.alignment)===null||y===void 0?void 0:y.x,B=(b=N?.alignment)===null||b===void 0?void 0:b.y;N.screenOffset&&(H=(H||0)+2*N.screenOffset.x/k,B=(B||0)+2*N.screenOffset.y/j),this.gl.uniform2f(T.uvScale,((_=N?.uvScale)===null||_===void 0?void 0:_.x)||1,((h=N?.uvScale)===null||h===void 0?void 0:h.y)||1),this.gl.uniform2f(T.uvOffset,((f=N?.uvOffset)===null||f===void 0?void 0:f.x)||0,((E=N?.uvOffset)===null||E===void 0?void 0:E.y)||0),this.gl.uniform2f(T.alignment,H||0,B||0),this.gl.uniform1f(T.opacity,N.opacity),this.gl.uniform3f(T.color,((m=N?.color)===null||m===void 0?void 0:m.r)||0,((S=N?.color)===null||S===void 0?void 0:S.g)||0,((w=N?.color)===null||w===void 0?void 0:w.b)||0),this.gl.uniform1f(T.rotation,I.rotation),this.gl.uniform2fv(T.scale,F),this.renderer.setDepthTest(N.depthTest),this.renderer.setDepthWrite(N.depthWrite),this.renderer.setTexture(N.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}createProgram(a,l){if(!this.gl)throw new Error("WebGL Rendering context not found");var d=this.gl.createProgram();if(!d)throw new Error("Error creating webgl program");var u=this.gl.createShader(this.gl.FRAGMENT_SHADER),g=this.gl.createShader(this.gl.VERTEX_SHADER);if(!u)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!g)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");var x="precision "+l+` float;
`;if(this.gl.shaderSource(u,x+a.fragmentShader),this.gl.shaderSource(g,x+a.vertexShader),this.gl.compileShader(u),this.gl.compileShader(g),!this.gl.getShaderParameter(u,this.gl.COMPILE_STATUS)||!this.gl.getShaderParameter(g,this.gl.COMPILE_STATUS))throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(u)} 
      ${this.gl.getShaderInfoLog(g)}`);return this.gl.attachShader(d,u),this.gl.attachShader(d,g),this.gl.linkProgram(d),this.gl.getProgramParameter(d,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),d}}function s(o,a){return o.z!==a.z?a.z-o.z:a.id-o.id}}),"./src/WebGL/constants/Coloring.ts":((r,e,t)=>{t.r(e),t.d(e,{Coloring:()=>n});var n;(function(i){i[i.NoColors=0]="NoColors",i[i.FaceColors=1]="FaceColors",i[i.VertexColors=2]="VertexColors"})(n||(n={}))}),"./src/WebGL/constants/Shading.ts":((r,e,t)=>{t.r(e),t.d(e,{Shading:()=>n});var n;(function(i){i[i.NoShading=0]="NoShading",i[i.FlatShading=1]="FlatShading",i[i.SmoothShading=2]="SmoothShading"})(n||(n={}))}),"./src/WebGL/constants/Sides.ts":((r,e,t)=>{t.r(e),t.d(e,{BackSide:()=>i,DoubleSide:()=>s,FrontSide:()=>n});const n=0,i=1,s=2}),"./src/WebGL/constants/SpriteAlignment.ts":((r,e,t)=>{t.r(e),t.d(e,{SpriteAlignment:()=>i});var n=t("./src/WebGL/math/index.ts");const i={topLeft:new n.Vector2(1,-1),topCenter:new n.Vector2(0,-1),topRight:new n.Vector2(-1,-1),centerLeft:new n.Vector2(1,0),center:new n.Vector2(0,0),centerRight:new n.Vector2(-1,0),bottomLeft:new n.Vector2(1,1),bottomCenter:new n.Vector2(0,1),bottomRight:new n.Vector2(-1,1)}}),"./src/WebGL/constants/TextureConstants.ts":((r,e,t)=>{t.r(e),t.d(e,{ClampToEdgeWrapping:()=>n,FloatType:()=>l,LinearFilter:()=>i,LinearMipMapLinearFilter:()=>o,NearestFilter:()=>s,R32Format:()=>g,RFormat:()=>u,RGBAFormat:()=>d,UnsignedByteType:()=>a});const n=1001,i=1006,s=1007,o=1008,a=1009,l=1010,d=1021,u=1022,g=1023}),"./src/WebGL/constants/TextureOperations.ts":((r,e,t)=>{t.r(e),t.d(e,{TextureOperations:()=>n});var n;(function(i){i[i.MultiplyOperation=0]="MultiplyOperation",i[i.MixOperation=1]="MixOperation",i[i.AddOperation=2]="AddOperation"})(n||(n={}))}),"./src/WebGL/constants/index.ts":((r,e,t)=>{t.r(e),t.d(e,{BackSide:()=>i.BackSide,ClampToEdgeWrapping:()=>a.ClampToEdgeWrapping,Coloring:()=>n.Coloring,DoubleSide:()=>i.DoubleSide,FloatType:()=>a.FloatType,FrontSide:()=>i.FrontSide,LinearFilter:()=>a.LinearFilter,LinearMipMapLinearFilter:()=>a.LinearMipMapLinearFilter,NearestFilter:()=>a.NearestFilter,R32Format:()=>a.R32Format,RFormat:()=>a.RFormat,RGBAFormat:()=>a.RGBAFormat,Shading:()=>s.Shading,SpriteAlignment:()=>o.SpriteAlignment,TextureOperations:()=>l.TextureOperations,UnsignedByteType:()=>a.UnsignedByteType});var n=t("./src/WebGL/constants/Coloring.ts"),i=t("./src/WebGL/constants/Sides.ts"),s=t("./src/WebGL/constants/Shading.ts"),o=t("./src/WebGL/constants/SpriteAlignment.ts"),a=t("./src/WebGL/constants/TextureConstants.ts"),l=t("./src/WebGL/constants/TextureOperations.ts")}),"./src/WebGL/core/EventDispatcher.ts":((r,e,t)=>{t.r(e),t.d(e,{EventDispatcher:()=>n});class n{constructor(){this.listeners={}}dispatchEvent(s){var o=this.listeners[s.type];if(o!==void 0){s.target=this;for(var a=0,l=o.length;a<l;a++)o[a].call(this,s)}}removeEventListener(s,o){if(!o)this.listeners[s]=[];else{var a=this.listeners[s].indexOf(o);a!==-1&&this.listeners[s].splice(a,1)}}addEventListener(s,o){this.listeners[s]===void 0&&(this.listeners[s]=[]),this.listeners[s].indexOf(o)===-1&&this.listeners[s].push(o)}}}),"./src/WebGL/core/Geometry.ts":((r,e,t)=>{t.r(e),t.d(e,{Geometry:()=>d,GeometryGroup:()=>l,GeometryIDCount:()=>u});var n=t("./src/WebGL/materials/LineBasicMaterial.ts"),i=t("./src/WebGL/core/EventDispatcher.ts"),s=t("./src/WebGL/math/index.ts"),o=t("./src/colors.ts");const a=65535;class l{constructor(x=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.atomArray=Array(),this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=x}setColor(x){var y=this.vertexArray,b=this.colorArray;if(!y)throw new Error("vertex array not initialized");if(!b)throw new Error("color array not initialized");let _=o.CC.color(x);for(var h=0;h<y.length;h+=3)b[h]=_.r,b[h+1]=_.g,b[h+2]=_.b}setColors(x){var y=this.vertexArray,b=this.colorArray;if(!y)throw new Error("vertex array not initialized");if(!b)throw new Error("color array not initialized");if(y.length!=b.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var _=0;_<y.length;_+=3){var h=x(y[_],y[_+1],y[_+2]);h instanceof o.Color||(h=o.CC.color(h)),b[_]=h.r,b[_+1]=h.g,b[_+2]=h.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var x=new s.Vector3,y,b,_,h,f=0;f<this.vertices;++f)y=f*3,b=this.vertexArray[y],_=this.vertexArray[y+1],h=this.vertexArray[y+2],x.x+=b,x.y+=_,x.z+=h;return x.divideScalar(this.vertices),x}setNormals(){var x=this.faceArray,y=this.vertexArray,b=this.normalArray;if(!(!this.vertices||!this.faceidx)){if(!x)throw new Error("face array not initialized");if(!y)throw new Error("vertex array not initialized");if(!b)throw new Error("normal array not initialized");for(var _,h,f,E,m,S,w,v=0;v<x.length/3;++v)_=x[v*3]*3,h=x[v*3+1]*3,f=x[v*3+2]*3,E=new s.Vector3(y[_],y[_+1],y[_+2]),m=new s.Vector3(y[h],y[h+1],y[h+2]),S=new s.Vector3(y[f],y[f+1],y[f+2]),E.subVectors(E,m),S.subVectors(S,m),S.cross(E),w=S,w.normalize(),b[_]+=w.x,b[h]+=w.x,b[f]+=w.x,b[_+1]+=w.y,b[h+1]+=w.y,b[f+1]+=w.y,b[_+2]+=w.z,b[h+2]+=w.z,b[f+2]+=w.z}}setLineIndices(){if(this.faceidx&&!(this.lineArray&&this.lineArray.length==this.faceidx*2&&this.lineidx==this.faceidx*2)){var x=this.faceArray,y=this.lineArray=new Uint16Array(this.faceidx*2);if(this.lineidx=this.faceidx*2,!x)throw new Error("face array not initialized");for(var b=0;b<this.faceidx/3;++b){var _=b*3,h=_*2,f=x[_],E=x[_+1],m=x[_+2];y[h]=f,y[h+1]=E,y[h+2]=f,y[h+3]=m,y[h+4]=E,y[h+5]=m}}}vrml(x,y){var b,_,h,f,E,m,S,w,v,A,M,T,R,O,L,P,I,N,U="";if(U+=x+`Shape {
`+x+` appearance Appearance {
`+x+`  material Material {
`+x+"   diffuseColor "+((b=y?.color)===null||b===void 0?void 0:b.r)+" "+((_=y?.color)===null||_===void 0?void 0:_.g)+" "+((h=y?.color)===null||h===void 0?void 0:h.b)+`
`,y.wireframe&&this.colorArray){let k=this.colorArray;U+=x+"    emissiveColor "+k[0]+" "+k[1]+" "+k[2]+`
`}y?.transparent&&(U+=x+"   transparency "+(1-y.opacity)+`
`),U+=x+`  }
`,U+=x+` }
`;var F=x;if(x+=" ",y instanceof n.LineBasicMaterial||y.wireframe){U+=x+`geometry IndexedLineSet {
`+x+` colorPerVertex TRUE
`+x+` coord Coordinate {
`+x+`  point [
`;let k,j,H;for(let B=0;B<this.vertices;++B){let V=B*3;k=(f=this.vertexArray)===null||f===void 0?void 0:f[V],j=(E=this.vertexArray)===null||E===void 0?void 0:E[V+1],H=(m=this.vertexArray)===null||m===void 0?void 0:m[V+2],U+=x+"   "+k+" "+j+" "+H+`,
`}if(U+=x+`  ]
`,U+=x+` }
`,this.colorArray&&!y.wireframe){U+=x+` color Color {
`+x+`  color [
`;for(let B=0;B<this.vertices;++B){let V=B*3;k=this.colorArray[V],j=this.colorArray[V+1],H=this.colorArray[V+2],U+=x+"   "+k+" "+j+" "+H+`,
`}U+=x+`  ]
`,U+=x+` }
`}if(U+=x+` coordIndex [
`,y.wireframe&&this.faceArray)for(let B=0;B<this.faceidx;B+=3)k=(S=this.faceArray)===null||S===void 0?void 0:S[B],j=(w=this.faceArray)===null||w===void 0?void 0:w[B+1],H=(v=this.faceArray)===null||v===void 0?void 0:v[B+2],U+=x+"  "+k+", "+j+", "+H+`, -1,
`;else for(let B=0;B<this.vertices-1;B+=2)U+=x+"  "+B+", "+(B+1)+`, -1,
`;U+=x+` ]
`,U+=x+`}
`}else{U+=x+`geometry IndexedFaceSet {
`+x+` colorPerVertex TRUE
`+x+` normalPerVertex TRUE
`+x+` solid FALSE
`,U+=x+` coord Coordinate {
`+x+`  point [
`;let k,j,H;for(let B=0;B<this.vertices;++B){let V=B*3;k=(A=this.vertexArray)===null||A===void 0?void 0:A[V],j=(M=this.vertexArray)===null||M===void 0?void 0:M[V+1],H=(T=this.vertexArray)===null||T===void 0?void 0:T[V+2],U+=x+"   "+k+" "+j+" "+H+`,
`}U+=x+`  ]
`,U+=x+` }
`,U+=x+` normal Normal {
`+x+`  vector [
`;for(let B=0;B<this.vertices;++B){let V=B*3;k=(R=this.normalArray)===null||R===void 0?void 0:R[V],j=(O=this.normalArray)===null||O===void 0?void 0:O[V+1],H=(L=this.normalArray)===null||L===void 0?void 0:L[V+2],U+=x+"   "+k+" "+j+" "+H+`,
`}if(U+=x+`  ]
`,U+=x+` }
`,this.colorArray){U+=x+` color Color {
`+x+`  color [
`;for(let B=0;B<this.vertices;++B){let V=B*3;k=this.colorArray[V],j=this.colorArray[V+1],H=this.colorArray[V+2],U+=x+"   "+k+" "+j+" "+H+`,
`}U+=x+`  ]
`,U+=x+` }
`}U+=x+` coordIndex [
`;for(let B=0;B<this.faceidx;B+=3)k=(P=this.faceArray)===null||P===void 0?void 0:P[B],j=(I=this.faceArray)===null||I===void 0?void 0:I[B+1],H=(N=this.faceArray)===null||N===void 0?void 0:N[B+2],U+=x+"  "+k+", "+j+", "+H+`, -1,
`;U+=x+` ]
`,U+=x+`}
`}return U+=F+"}",U}truncateArrayBuffers(x=!0,y=!1){var b=this.vertexArray,_=this.colorArray,h=this.normalArray,f=this.faceArray,E=this.lineArray,m=this.radiusArray;this.vertexArray=b?.subarray(0,this.vertices*3)||null,this.colorArray=_?.subarray(0,this.vertices*3)||null,x?(this.normalArray=h?.subarray(0,this.vertices*3)||null,this.faceArray=f?.subarray(0,this.faceidx)||null,this.lineidx>0?this.lineArray=E?.subarray(0,this.lineidx)||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),m&&(this.radiusArray=m.subarray(0,this.vertices)),y&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class d extends i.EventDispatcher{constructor(x=!1,y=!1,b=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=u++,this.mesh=x,this.radii=y,this.offset=b}updateGeoGroup(x=0){var y,b=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!b||b.vertices+x>(((y=b?.vertexArray)===null||y===void 0?void 0:y.length)||0)/3)&&(b=this.addGeoGroup()),b}vrml(x,y){for(var b="",_=this.geometryGroups.length,h=0;h<_;h++){var f=this.geometryGroups[h];b+=f.vrml(x,y)+`,
`}return b}addGeoGroup(){var x=new l(this.geometryGroups.length);return this.geometryGroups.push(x),this.groups=this.geometryGroups.length,x.vertexArray=new Float32Array(a*3),x.colorArray=new Float32Array(a*3),this.mesh&&(x.normalArray=new Float32Array(a*3),x.faceArray=new Uint16Array(a*6),x.lineArray=new Uint16Array(a*6)),this.radii&&(x.radiusArray=new Float32Array(a)),x.useOffset=this.offset,x}setUpNormals(...x){for(var y=0;y<this.groups;y++){var b=this.geometryGroups[y];b.setNormals(...x)}}setColors(...x){for(var y=this.geometryGroups.length,b=0;b<y;b++){var _=this.geometryGroups[b];_.setColors(...x)}}setColor(...x){let y=this.geometryGroups.length;for(var b=0;b<y;b++){var _=this.geometryGroups[b];_.setColor(...x)}}setUpWireframe(...x){let y=this.geometryGroups.length;for(var b=0;b<y;b++){var _=this.geometryGroups[b];_.setLineIndices(...x)}}initTypedArrays(){for(var x=0;x<this.groups;x++){var y=this.geometryGroups[x];y.__inittedArrays!==!0&&y.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var x=0,y=0;y<this.groups;y++)x+=this.geometryGroups[y].vertices;return x}}let u=0}),"./src/WebGL/core/Object3D.ts":((r,e,t)=>{t.r(e),t.d(e,{Light:()=>l,Object3D:()=>o,Object3DIDCount:()=>s,Scene:()=>a});var n=t("./src/WebGL/math/index.ts"),i=t("./src/colors.ts");let s=0;class o{constructor(){this.id=s++,this.name="",this.children=[],this.position=new n.Vector3,this.rotation=new n.Vector3,this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.quaternion=new n.Quaternion,this.eulerOrder="XYZ",this.up=new n.Vector3(0,1,0),this.scale=new n.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(u){this.matrix.lookAt(u,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?console.error("Unimplemented math operation."):this.rotation instanceof n.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(u){if(u===this){console.error("Can't add $3Dmol.Object3D to itself");return}u.parent=this,this.children.push(u);for(var g=this;g.parent!==void 0;)g=g.parent;g!==void 0&&g instanceof a&&g.__addObject(u)}remove(u){var g=this.children.indexOf(u);if(g!==-1){u.parent=void 0,this.children.splice(g,1);for(var x=this;x.parent!==void 0;)x=x.parent;x!==void 0&&x instanceof a&&x.__removeObject(u)}}vrml(u){u||(u=" ");var g=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),x=0,y=0,b=0;if(g!=0){let f=Math.sin(g/2);x=this.quaternion.x/f,y=this.quaternion.y/f,b=this.quaternion.z/f}var _=u+`Transform {
`+u+" center "+this.position.x+" "+this.position.y+" "+this.position.z+`
`+u+" rotation "+x+" "+y+" "+b+" "+g+`
`+u+` children [
`;this.geometry&&(_+=this.geometry.vrml(u,this.material));for(var h=0;h<this.children.length;h++)_+=this.children[h].vrml(u+" ")+`,
`;return _+=` ]
`,_+="}",_}updateMatrix(){this.matrix.setPosition(this.position),this.useQuaternion===!1&&this.rotation instanceof n.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(u){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||u===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var g=0;g<this.children.length;g++)this.children[g].updateMatrixWorld(!0)}clone(u){u===void 0&&(u=new o),u.name=this.name,u.up.copy(this.up),u.position.copy(this.position),u.rotation instanceof n.Vector3&&this.rotation instanceof n.Vector3?u.rotation.copy(this.rotation):u.rotation=this.rotation,u.eulerOrder=this.eulerOrder,u.scale.copy(this.scale),u.rotationAutoUpdate=this.rotationAutoUpdate,u.matrix.copy(this.matrix),u.matrixWorld.copy(this.matrixWorld),u.quaternion.copy(this.quaternion),u.matrixAutoUpdate=this.matrixAutoUpdate,u.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,u.useQuaternion=this.useQuaternion,u.visible=this.visible;for(var g=0;g<this.children.length;g++){var x=this.children[g];u.add(x.clone())}return u}setVisible(u){this.visible=u;for(var g=0;g<this.children.length;g++){var x=this.children[g];x.setVisible(u)}}}class a extends o{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(u){if(u instanceof l)this.__lights.indexOf(u)===-1&&this.__lights.push(u),u.target&&u.target.parent===void 0&&this.add(u.target);else if(this.__objects.indexOf(u)===-1){this.__objects.push(u),this.__objectsAdded.push(u);var g=this.__objectsRemoved.indexOf(u);g!==-1&&this.__objectsRemoved.splice(g,1)}for(var x=0;x<u.children.length;x++)this.__addObject(u.children[x])}__removeObject(u){var g;if(u instanceof l)g=this.__lights.indexOf(u),g!==-1&&this.__lights.splice(g,1);else if(g=this.__objects.indexOf(u),g!==-1){this.__objects.splice(g,1),this.__objectsRemoved.push(u);var x=this.__objectsAdded.indexOf(u);x!==-1&&this.__objectsAdded.splice(g,1)}for(var y=0;y<u.children.length;y++)this.__removeObject(u.children[y])}}class l extends o{constructor(u,g=1){super(),this.position=new n.Vector3(0,1,0),this.target=new o,this.castShadow=!1,this.onlyShadow=!1,this.color=new i.Color(u),this.intensity=g}}}),"./src/WebGL/core/Projector.ts":((r,e,t)=>{t.r(e),t.d(e,{Projector:()=>s});var n=t("./src/WebGL/math/index.ts");const i=new n.Matrix4;class s{static unprojectVector(a,l){return l.projectionMatrixInverse.getInverse(l.projectionMatrix),i.multiplyMatrices(l.matrixWorld,l.projectionMatrixInverse),a.applyProjection(i)}static projectVector(a,l){return l.matrixWorldInverse.getInverse(l.matrixWorld),i.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),a.applyProjection(i)}projectVector(a,l){return s.projectVector(a,l)}unprojectVector(a,l){return s.unprojectVector(a,l)}}}),"./src/WebGL/core/Raycaster.ts":((r,e,t)=>{t.r(e),t.d(e,{Raycaster:()=>a,intersectObject:()=>f});var n=t("./src/WebGL/math/index.ts"),i=t("./src/WebGL/shapes/index.ts");const s=(E,m)=>E.distance-m.distance,o=new n.Matrix4;class a{constructor(m,S,w,v){this.precision=1e-4,this.linePrecision=.2,this.ray=new n.Ray(m,S),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=v||0,this.far=w||1/0}set(m,S){this.ray.set(m,S)}setFromCamera(m,S){S.ortho?(this.ray.origin.set(m.x,m.y,(S.near+S.far)/(S.near-S.far)).unproject(S),this.ray.direction.set(0,0,-1).transformDirection(S.matrixWorld)):(this.ray.origin.setFromMatrixPosition(S.matrixWorld),this.ray.direction.set(m.x,m.y,m.z),S.projectionMatrixInverse.getInverse(S.projectionMatrix),o.multiplyMatrices(S.matrixWorld,S.projectionMatrixInverse),this.ray.direction.applyProjection(o),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(m,S){for(var w=[],v=0,A=S.length;v<A;v++)f(m,S[v],this,w);return w.sort(s),w}}const l=E=>Math.min(Math.max(E,-1),1);var d=new i.Sphere,u=new i.Cylinder,g=new i.Triangle,x=new n.Vector3,y=new n.Vector3,b=new n.Vector3,_=new n.Vector3,h=new n.Vector3;function f(E,m,S,w){if(h.getPositionFromMatrix(E.matrixWorld),m.intersectionShape===void 0||m.hidden)return w;var v=m.intersectionShape,A=S.linePrecision;A*=E.matrixWorld.getMaxScaleOnAxis();var M=A*A;if(m.boundingSphere!==void 0&&m.boundingSphere instanceof i.Sphere&&(d.copy(m.boundingSphere),d.applyMatrix4(E.matrixWorld),!S.ray.isIntersectionSphere(d)))return w;var T,R,O,L,P,I,N,U,F,k,j,H,B,V;for(T=0,R=v.triangle.length;T<R;T++)if(v.triangle[T]instanceof i.Triangle){if(g.copy(v.triangle[T]),g.applyMatrix4(E.matrixWorld),O=g.getNormal(),L=S.ray.direction.dot(O),L>=0||(x.subVectors(g.a,S.ray.origin),N=O.dot(x)/L,N<0))continue;y.copy(S.ray.direction).multiplyScalar(N).add(S.ray.origin),y.sub(g.a),b.copy(g.b).sub(g.a),_.copy(g.c).sub(g.a);var Y=b.dot(_),K=b.lengthSq(),J=_.lengthSq();if(H=(K*y.dot(_)-Y*y.dot(b))/(K*J-Y*Y),H<0||H>1||(j=(y.dot(b)-H*Y)/K,j<0||j>1||j+H>1))continue;w.push({clickable:m,distance:N})}for(T=0,R=v.cylinder.length;T<R;T++)if(v.cylinder[T]instanceof i.Cylinder){if(u.copy(v.cylinder[T]),u.applyMatrix4(E.matrixWorld),x.subVectors(u.c1,S.ray.origin),P=x.dot(u.direction),I=x.dot(S.ray.direction),L=l(S.ray.direction.dot(u.direction)),F=1-L*L,F===0)continue;B=(L*I-P)/F,V=(I-L*P)/F,y.copy(u.direction).multiplyScalar(B).add(u.c1),b.copy(S.ray.direction).multiplyScalar(V).add(S.ray.origin),U=_.subVectors(y,b).lengthSq();var Te=u.radius*u.radius;if(U<=Te){if(k=(L*P-I)*(L*P-I)-F*(x.lengthSq()-P*P-Te),k<=0?H=N=Math.sqrt(U):H=N=(I-L*P-Math.sqrt(k))/F,j=L*H-P,j<0||j*j>u.lengthSq()||H<0)continue;w.push({clickable:m,distance:N})}}for(T=0,R=v.line.length;T<R;T+=2){y.copy(v.line[T]),y.applyMatrix4(E.matrixWorld),b.copy(v.line[T+1]),b.applyMatrix4(E.matrixWorld),_.subVectors(b,y);var He=_.lengthSq();_.normalize(),x.subVectors(y,S.ray.origin);var Q=x.dot(_);I=x.dot(S.ray.direction),L=l(S.ray.direction.dot(_)),F=1-L*L,F!==0&&(B=(L*I-Q)/F,V=(I-L*Q)/F,y.add(_.multiplyScalar(B)),b.copy(S.ray.direction).multiplyScalar(V).add(S.ray.origin),U=_.subVectors(b,y).lengthSq(),U<M&&B*B<He&&w.push({clickable:m,distance:V}))}for(T=0,R=v.sphere.length;T<R;T++)if(v.sphere[T]instanceof i.Sphere&&(d.copy(v.sphere[T]),d.applyMatrix4(E.matrixWorld),S.ray.isIntersectionSphere(d))){y.subVectors(d.center,S.ray.origin);var Xe=y.dot(S.ray.direction);if(k=Xe*Xe-(y.lengthSq()-d.radius*d.radius),Xe<0)return w;k<=0?N=Xe:N=Xe-Math.sqrt(k),w.push({clickable:m,distance:N})}return w}}),"./src/WebGL/core/Texture.ts":((r,e,t)=>{t.r(e),t.d(e,{Texture:()=>a,TextureIdCount:()=>l});var n=t("./src/WebGL/constants/TextureConstants.ts"),i=t("./src/WebGL/math/index.ts"),s=t("./src/WebGL/core/EventDispatcher.ts"),o=t("./src/WebGL/core/UVMapping.ts");class a extends s.EventDispatcher{constructor(u,g){super(),this.id=l++,this.name="",this.image=u,this.mapping=new o.UVMapping,this.wrapS=n.ClampToEdgeWrapping,this.wrapT=n.ClampToEdgeWrapping,this.anisotropy=1,g?(this.format=n.RFormat,this.type=n.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=n.NearestFilter,this.minFilter=n.NearestFilter):(this.format=n.RGBAFormat,this.type=n.UnsignedByteType,this.offset=new i.Vector2(0,0),this.repeat=new i.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=n.LinearFilter,this.minFilter=n.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(u=new a){return u.image=this.image,u.mapping=this.mapping,u.wrapS=this.wrapS,u.wrapT=this.wrapT,u.magFilter=this.magFilter,u.minFilter=this.minFilter,u.anisotropy=this.anisotropy,u.format=this.format,u.type=this.type,u.offset.copy(this.offset),u.repeat.copy(this.repeat),u.premultiplyAlpha=this.premultiplyAlpha,u.flipY=this.flipY,u.unpackAlignment=this.unpackAlignment,u}dispose(){this.dispatchEvent({type:"dispose"})}}let l=0}),"./src/WebGL/core/UVMapping.ts":((r,e,t)=>{t.r(e),t.d(e,{UVMapping:()=>n});class n{}}),"./src/WebGL/core/index.ts":((r,e,t)=>{t.r(e),t.d(e,{EventDispatcher:()=>n.EventDispatcher,Geometry:()=>i.Geometry,GeometryGroup:()=>i.GeometryGroup,GeometryIDCount:()=>i.GeometryIDCount,Light:()=>s.Light,Object3D:()=>s.Object3D,Object3DIDCount:()=>s.Object3DIDCount,Projector:()=>o.Projector,Raycaster:()=>a.Raycaster,Scene:()=>s.Scene,Texture:()=>l.Texture,TextureIdCount:()=>l.TextureIdCount,UVMapping:()=>d.UVMapping,intersectObject:()=>a.intersectObject});var n=t("./src/WebGL/core/EventDispatcher.ts"),i=t("./src/WebGL/core/Geometry.ts"),s=t("./src/WebGL/core/Object3D.ts"),o=t("./src/WebGL/core/Projector.ts"),a=t("./src/WebGL/core/Raycaster.ts"),l=t("./src/WebGL/core/Texture.ts"),d=t("./src/WebGL/core/UVMapping.ts")}),"./src/WebGL/index.ts":((r,e,t)=>{t.r(e),t.d(e,{BackSide:()=>n.BackSide,Camera:()=>u.Camera,ClampToEdgeWrapping:()=>n.ClampToEdgeWrapping,Coloring:()=>n.Coloring,Cylinder:()=>d.Cylinder,DoubleSide:()=>n.DoubleSide,EventDispatcher:()=>i.EventDispatcher,FloatType:()=>n.FloatType,Fog:()=>g.Fog,FrontSide:()=>n.FrontSide,Geometry:()=>i.Geometry,GeometryGroup:()=>i.GeometryGroup,GeometryIDCount:()=>i.GeometryIDCount,ImposterMaterial:()=>s.ImposterMaterial,InstancedMaterial:()=>s.InstancedMaterial,Light:()=>i.Light,Line:()=>a.Line,LineBasicMaterial:()=>s.LineBasicMaterial,LineStyle:()=>a.LineStyle,LinearFilter:()=>n.LinearFilter,LinearMipMapLinearFilter:()=>n.LinearMipMapLinearFilter,Material:()=>s.Material,MaterialIdCount:()=>s.MaterialIdCount,Matrix3:()=>o.Matrix3,Matrix4:()=>o.Matrix4,Mesh:()=>a.Mesh,MeshDoubleLambertMaterial:()=>s.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>s.MeshLambertMaterial,MeshOutlineMaterial:()=>s.MeshOutlineMaterial,NearestFilter:()=>n.NearestFilter,Object3D:()=>i.Object3D,Object3DIDCount:()=>i.Object3DIDCount,Projector:()=>i.Projector,Quaternion:()=>o.Quaternion,R32Format:()=>n.R32Format,RFormat:()=>n.RFormat,RGBAFormat:()=>n.RGBAFormat,Ray:()=>o.Ray,Raycaster:()=>i.Raycaster,Renderer:()=>x.Renderer,Scene:()=>i.Scene,ShaderLib:()=>l.ShaderLib,ShaderUtils:()=>l.ShaderUtils,Shading:()=>n.Shading,Sphere:()=>d.Sphere,SphereImposterMaterial:()=>s.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>s.SphereImposterOutlineMaterial,Sprite:()=>a.Sprite,SpriteAlignment:()=>n.SpriteAlignment,SpriteMaterial:()=>s.SpriteMaterial,SpritePlugin:()=>y.SpritePlugin,StickImposterMaterial:()=>s.StickImposterMaterial,StickImposterOutlineMaterial:()=>s.StickImposterOutlineMaterial,Texture:()=>i.Texture,TextureIdCount:()=>i.TextureIdCount,TextureOperations:()=>n.TextureOperations,Triangle:()=>d.Triangle,UVMapping:()=>i.UVMapping,UnsignedByteType:()=>n.UnsignedByteType,Vector2:()=>o.Vector2,Vector3:()=>o.Vector3,VolumetricMaterial:()=>s.VolumetricMaterial,basic:()=>l.basic,clamp:()=>o.clamp,clone:()=>l.clone,conversionMatrix3:()=>o.conversionMatrix3,degToRad:()=>o.degToRad,instanced:()=>l.instanced,intersectObject:()=>i.intersectObject,lambert:()=>l.lambert,lambertdouble:()=>l.lambertdouble,outline:()=>l.outline,screen:()=>l.screen,screenaa:()=>l.screenaa,sphereimposter:()=>l.sphereimposter,sphereimposteroutline:()=>l.sphereimposteroutline,sprite:()=>l.sprite,stickimposter:()=>l.stickimposter,stickimposteroutline:()=>l.stickimposteroutline,volumetric:()=>l.volumetric});var n=t("./src/WebGL/constants/index.ts"),i=t("./src/WebGL/core/index.ts"),s=t("./src/WebGL/materials/index.ts"),o=t("./src/WebGL/math/index.ts"),a=t("./src/WebGL/objects/index.ts"),l=t("./src/WebGL/shaders/index.ts"),d=t("./src/WebGL/shapes/index.ts"),u=t("./src/WebGL/Camera.ts"),g=t("./src/WebGL/Fog.ts"),x=t("./src/WebGL/Renderer.ts"),y=t("./src/WebGL/SpritePlugin.ts")}),"./src/WebGL/materials/ImposterMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{ImposterMaterial:()=>l});var n=t("./src/WebGL/constants/Coloring.ts"),i=t("./src/WebGL/constants/Shading.ts"),s=t("./src/colors.ts"),o=t("./src/WebGL/math/index.ts"),a=t("./src/WebGL/materials/Material.ts");class l extends a.Material{constructor(u){super(),this.color=new s.Color(16777215),this.ambient=new s.Color(1048575),this.emissive=new s.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new o.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=i.Shading.SmoothShading,this.shaderID=null,this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.setValues(u)}clone(u=new l){return super.clone.call(this,u),u.color.copy(this.color),u.ambient.copy(this.ambient),u.emissive.copy(this.emissive),u.wrapAround=this.wrapAround,u.wrapRGB.copy(this.wrapRGB),u.map=this.map,u.lightMap=this.lightMap,u.specularMap=this.specularMap,u.envMap=this.envMap,u.combine=this.combine,u.reflectivity=this.reflectivity,u.refractionRatio=this.refractionRatio,u.fog=this.fog,u.shading=this.shading,u.shaderID=this.shaderID,u.vertexColors=this.vertexColors,u.skinning=this.skinning,u.morphTargets=this.morphTargets,u.morphNormals=this.morphNormals,u}}}),"./src/WebGL/materials/InstancedMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{InstancedMaterial:()=>l});var n=t("./src/WebGL/constants/Coloring.ts"),i=t("./src/WebGL/constants/Shading.ts"),s=t("./src/colors.ts"),o=t("./src/WebGL/math/index.ts"),a=t("./src/WebGL/materials/Material.ts");class l extends a.Material{constructor(u){super(),this.color=new s.Color(16777215),this.ambient=new s.Color(1048575),this.emissive=new s.Color(0),this.wrapAround=!1,this.wrapRGB=new o.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=i.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(u)}clone(u=new l){return super.clone.call(this,u),u.color.copy(this.color),u.ambient.copy(this.ambient),u.emissive.copy(this.emissive),u.wrapAround=this.wrapAround,u.wrapRGB.copy(this.wrapRGB),u.map=this.map,u.lightMap=this.lightMap,u.specularMap=this.specularMap,u.envMap=this.envMap,u.combine=this.combine,u.reflectivity=this.reflectivity,u.refractionRatio=this.refractionRatio,u.fog=this.fog,u.shading=this.shading,u.shaderID=this.shaderID,u.vertexColors=this.vertexColors,u.skinning=this.skinning,u.morphTargets=this.morphTargets,u.morphNormals=this.morphNormals,u.sphere=this.sphere,u}}}),"./src/WebGL/materials/LineBasicMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{LineBasicMaterial:()=>s});var n=t("./src/colors.ts"),i=t("./src/WebGL/materials/Material.ts");class s extends i.Material{constructor(a){super(),this.color=new n.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(a)}clone(a=new s){return super.clone.call(this,a),a.color.copy(this.color),a}}}),"./src/WebGL/materials/Material.ts":((r,e,t)=>{t.r(e),t.d(e,{Material:()=>a,MaterialIdCount:()=>l});var n=t("./src/WebGL/constants/Sides.ts"),i=t("./src/WebGL/core/index.ts"),s=t("./src/WebGL/math/index.ts"),o=t("./src/colors.ts");class a extends i.EventDispatcher{constructor(){super(...arguments),this.id=l++,this.name="",this.side=n.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1,this.wireframe=!1,this.shaded=!1}setValues(u={}){if(u!==void 0)for(var g in u){var x=u[g];if(x===void 0){console.warn("$3Dmol.Material: '"+g+"' parameter is undefined.");continue}if(g in this){var y=this[g];y instanceof o.Color&&x instanceof o.Color?y.copy(x):y instanceof o.Color?y.set(x):y instanceof s.Vector3&&x instanceof s.Vector3?y.copy(x):this[g]=x}}}clone(u=new a){return u.name=this.name,u.side=this.side,u.opacity=this.opacity,u.transparent=this.transparent,u.depthTest=this.depthTest,u.depthWrite=this.depthWrite,u.polygonOffset=this.polygonOffset,u.polygonOffsetFactor=this.polygonOffsetFactor,u.polygonOffsetUnits=this.polygonOffsetUnits,u.alphaTest=this.alphaTest,u.overdraw=this.overdraw,u.visible=this.visible,u}makeShaded(u){this.shaded=!0,this.uniforms&&(this.uniforms.shading={type:"i",value:u},this.uniforms.vWidth={type:"f",value:1},this.uniforms.vHeight={type:"f",value:1})}dispose(){this.dispatchEvent({type:"dispose"})}}let l=0}),"./src/WebGL/materials/MeshDoubleLambertMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{MeshDoubleLambertMaterial:()=>s});var n=t("./src/WebGL/constants/Sides.ts"),i=t("./src/WebGL/materials/MeshLambertMaterial.ts");class s extends i.MeshLambertMaterial{constructor(a){super(a),this.shaderID="lambertdouble",this.side=n.DoubleSide,this.outline=!1}clone(a=new s){return super.clone.call(this,a),a}}}),"./src/WebGL/materials/MeshLambertMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{MeshLambertMaterial:()=>l});var n=t("./src/WebGL/constants/Coloring.ts"),i=t("./src/WebGL/constants/Shading.ts"),s=t("./src/WebGL/materials/Material.ts"),o=t("./src/colors.ts"),a=t("./src/WebGL/math/index.ts");class l extends s.Material{constructor(u){super(),this.color=new o.Color(16777215),this.ambient=new o.Color(1048575),this.emissive=new o.Color(0),this.wrapAround=!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=i.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.setValues(u)}clone(u=new l){return super.clone.call(this,u),u.color.copy(this.color),u.ambient.copy(this.ambient),u.emissive.copy(this.emissive),u.wrapAround=this.wrapAround,u.wrapRGB.copy(this.wrapRGB),u.map=this.map,u.lightMap=this.lightMap,u.specularMap=this.specularMap,u.envMap=this.envMap,u.combine=this.combine,u.reflectivity=this.reflectivity,u.refractionRatio=this.refractionRatio,u.fog=this.fog,u.shading=this.shading,u.shaderID=this.shaderID,u.vertexColors=this.vertexColors,u.skinning=this.skinning,u.morphTargets=this.morphTargets,u.morphNormals=this.morphNormals,u}}}),"./src/WebGL/materials/MeshOutlineMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{MeshOutlineMaterial:()=>s});var n=t("./src/colors.ts"),i=t("./src/WebGL/materials/Material.ts");class s extends i.Material{constructor(a){super(),a=a||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=n.CC.color(a.color||new n.Color(0,0,0)),this.outlineWidth=a.width||.1,this.outlinePushback=a.pushback||1,this.outlineMaxPixels=a.maxpixels||0}clone(a=new s){return super.clone.call(this,a),a.fog=this.fog,a.shaderID=this.shaderID,a.wireframe=this.wireframe,a.outlineColor=this.outlineColor,a.outlineWidth=this.outlineWidth,a.outlinePushback=this.outlinePushback,a.outlineMaxPixels=this.outlineMaxPixels,a}}}),"./src/WebGL/materials/SphereImposterMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{SphereImposterMaterial:()=>i});var n=t("./src/WebGL/materials/ImposterMaterial.ts");class i extends n.ImposterMaterial{constructor(o){super(o),this.shaderID="sphereimposter",this.setValues(o)}clone(o=new i){return super.clone.call(this,o),o}}}),"./src/WebGL/materials/SphereImposterOutlineMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{SphereImposterOutlineMaterial:()=>s});var n=t("./src/colors.ts"),i=t("./src/WebGL/materials/ImposterMaterial.ts");class s extends i.ImposterMaterial{constructor(a){super(a),a=a||{},this.shaderID="sphereimposteroutline",this.outlineColor=n.CC.color(a.color||new n.Color(0,0,0)),this.outlineWidth=a.width||.1,this.outlinePushback=a.pushback||1,this.outlineMaxPixels=a.maxpixels||0,this.setValues(a)}clone(a=new s){return super.clone.call(this,a),a.outlineColor=this.outlineColor,a.outlineWidth=this.outlineWidth,a.outlinePushback=this.outlinePushback,a.outlineMaxPixels=this.outlineMaxPixels,a}}}),"./src/WebGL/materials/SpriteMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{SpriteMaterial:()=>l});var n=t("./src/WebGL/constants/SpriteAlignment.ts"),i=t("./src/WebGL/core/Texture.ts"),s=t("./src/colors.ts"),o=t("./src/WebGL/math/index.ts"),a=t("./src/WebGL/materials/Material.ts");class l extends a.Material{constructor(u){super(),this.color=new s.Color(16777215),this.map=new i.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new o.Vector2(0,0),this.uvScale=new o.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=n.SpriteAlignment.center.clone(),this.setValues(u),u=u||{},u.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),u.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),u.scaleByViewPort===void 0&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(u=new l){return super.clone.call(this,u),u.color.copy(this.color),u.map=this.map,u.useScreenCoordinates=this.useScreenCoordinates,u.screenOffset=this.screenOffset,u.sizeAttenuation=this.sizeAttenuation,u.scaleByViewport=this.scaleByViewPort,u.alignment.copy(this.alignment),u.uvOffset.copy(this.uvOffset),u}}}),"./src/WebGL/materials/StickImposterMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{StickImposterMaterial:()=>i});var n=t("./src/WebGL/materials/ImposterMaterial.ts");class i extends n.ImposterMaterial{constructor(o){super(o),this.shaderID="stickimposter",this.setValues(o)}clone(o=new i){return super.clone.call(this,o),o}}}),"./src/WebGL/materials/StickImposterOutlineMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{StickImposterOutlineMaterial:()=>s});var n=t("./src/colors.ts"),i=t("./src/WebGL/materials/ImposterMaterial.ts");class s extends i.ImposterMaterial{constructor(a={}){super(a),this.shaderID="stickimposteroutline",this.outlineColor=new n.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,this.outlineMaxPixels=0,a.color&&(this.outlineColor=n.CC.color(a.color)),a.width&&(this.outlineWidth=a.width),a.pushback&&(this.outlinePushback=a.pushback),a.maxpixels&&(this.outlineMaxPixels=a.maxpixels),this.setValues(a)}clone(a=new s){return super.clone.call(this,a),a.outlineColor=this.outlineColor,a.outlineWidth=this.outlineWidth,a.outlinePushback=this.outlinePushback,a.outlineMaxPixels=this.outlineMaxPixels,a}}}),"./src/WebGL/materials/VolumetricMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{VolumetricMaterial:()=>o});var n=t("./src/WebGL/constants/Sides.ts"),i=t("./src/colors.ts"),s=t("./src/WebGL/materials/Material.ts");class o extends s.Material{constructor(l){super(),this.transparent=!1,this.volumetric=!0,this.color=new i.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=n.FrontSide,this.setValues(l)}clone(l=new o){return super.clone.call(this,l),l.transparent=this.transparent,l.volumetric=this.volumetric,l.color=this.color,l.transferfn=this.transferfn,l.map=this.map,l.extent=this.extent,l.maxdepth=this.maxdepth,l.unit=this.unit,l.texmatrix=this.texmatrix,l.transfermin=this.transfermin,l.transfermax=this.transfermax,l.subsamples=this.subsamples,l.shaderID=this.shaderID,l.side=this.side,l}}}),"./src/WebGL/materials/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ImposterMaterial:()=>n.ImposterMaterial,InstancedMaterial:()=>i.InstancedMaterial,LineBasicMaterial:()=>s.LineBasicMaterial,Material:()=>o.Material,MaterialIdCount:()=>o.MaterialIdCount,MeshDoubleLambertMaterial:()=>a.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>l.MeshLambertMaterial,MeshOutlineMaterial:()=>d.MeshOutlineMaterial,SphereImposterMaterial:()=>u.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>g.SphereImposterOutlineMaterial,SpriteMaterial:()=>x.SpriteMaterial,StickImposterMaterial:()=>y.StickImposterMaterial,StickImposterOutlineMaterial:()=>b.StickImposterOutlineMaterial,VolumetricMaterial:()=>_.VolumetricMaterial});var n=t("./src/WebGL/materials/ImposterMaterial.ts"),i=t("./src/WebGL/materials/InstancedMaterial.ts"),s=t("./src/WebGL/materials/LineBasicMaterial.ts"),o=t("./src/WebGL/materials/Material.ts"),a=t("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),l=t("./src/WebGL/materials/MeshLambertMaterial.ts"),d=t("./src/WebGL/materials/MeshOutlineMaterial.ts"),u=t("./src/WebGL/materials/SphereImposterMaterial.ts"),g=t("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),x=t("./src/WebGL/materials/SpriteMaterial.ts"),y=t("./src/WebGL/materials/StickImposterMaterial.ts"),b=t("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),_=t("./src/WebGL/materials/VolumetricMaterial.ts")}),"./src/WebGL/math/Quaternion.ts":((r,e,t)=>{t.r(e),t.d(e,{Quaternion:()=>n});class n{constructor(s,o,a,l){this.x=s||0,this.y=o||0,this.z=a||0,this.w=l!==void 0?l:1}set(s,o,a,l){return this.x=s,this.y=o,this.z=a,this.w=l,this}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let s=this.length();return s===0?(this.x=0,this.y=0,this.z=0,this.w=1):(s=1/s,this.x*=s,this.y*=s,this.z*=s,this.w*=s),this}multiply(s){return this.multiplyQuaternions(this,s)}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}multiplyQuaternions(s,o){const a=s.x,l=s.y,d=s.z,u=s.w,g=o.x,x=o.y,y=o.z,b=o.w;return this.x=a*b+u*g+l*y-d*x,this.y=l*b+u*x+d*g-a*y,this.z=d*b+u*y+a*x-l*g,this.w=u*b-a*g-l*x-d*y,this}sub(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this.w-=s.w,this}clone(){return new n(this.x,this.y,this.z,this.w)}setFromEuler(s){const o=Math.cos(s.x/2),a=Math.cos(s.y/2),l=Math.cos(s.z/2),d=Math.sin(s.x/2),u=Math.sin(s.y/2),g=Math.sin(s.z/2);return this.x=d*a*l+o*u*g,this.y=o*u*l-d*a*g,this.z=o*a*g+d*u*l,this.w=o*a*l-d*u*g,this}}}),"./src/WebGL/math/Vector2.ts":((r,e,t)=>{t.r(e),t.d(e,{Vector2:()=>n});class n{constructor(s,o){this.x=s||0,this.y=o||0}set(s,o){return this.x=s,this.y=o,this}subVectors(s,o){return this.x=s.x-o.x,this.y=s.y-o.y,this}copy(s){return this.x=s.x,this.y=s.y,this}clone(){return new n(this.x,this.y)}}}),"./src/WebGL/math/index.ts":((r,e,t)=>{t.r(e),t.d(e,{Matrix3:()=>l.Matrix3,Matrix4:()=>l.Matrix4,Quaternion:()=>n.Quaternion,Ray:()=>l.Ray,Vector2:()=>i.Vector2,Vector3:()=>l.Vector3,clamp:()=>s.clamp,conversionMatrix3:()=>o.conversionMatrix3,degToRad:()=>a.degToRad});var n=t("./src/WebGL/math/Quaternion.ts"),i=t("./src/WebGL/math/Vector2.ts"),s=t("./src/WebGL/math/utils/clamp.ts"),o=t("./src/WebGL/math/utils/conversionMatrix3.ts"),a=t("./src/WebGL/math/utils/degToRad.ts"),l=t("./src/WebGL/math/math.ts")}),"./src/WebGL/math/math.ts":((r,e,t)=>{t.r(e),t.d(e,{Matrix3:()=>x,Matrix4:()=>u,Ray:()=>y,Vector3:()=>g});var n=t("./src/WebGL/math/utils/degToRad.ts"),i=t("./src/WebGL/math/utils/clamp.ts"),s,o,a,l,d;class u{constructor(_=1,h=0,f=0,E=0,m=0,S=1,w=0,v=0,A=0,M=0,T=1,R=0,O=0,L=0,P=0,I=1){typeof _<"u"&&typeof _!="number"?this.elements=new Float32Array(_):(this.elements=new Float32Array(16),this.elements[0]=_,this.elements[4]=h,this.elements[8]=f,this.elements[12]=E,this.elements[1]=m,this.elements[5]=S,this.elements[9]=w,this.elements[13]=v,this.elements[2]=A,this.elements[6]=M,this.elements[10]=T,this.elements[14]=R,this.elements[3]=O,this.elements[7]=L,this.elements[11]=P,this.elements[15]=I)}makeScale(_,h,f){throw new Error("Method not implemented.")}set(_,h,f,E,m,S,w,v,A,M,T,R,O,L,P,I){const N=this.elements;return N[0]=_,N[4]=h,N[8]=f,N[12]=E,N[1]=m,N[5]=S,N[9]=w,N[13]=v,N[2]=A,N[6]=M,N[10]=T,N[14]=R,N[3]=O,N[7]=L,N[11]=P,N[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(_){const h=_.elements;return this.set(h[0],h[4],h[8],h[12],h[1],h[5],h[9],h[13],h[2],h[6],h[10],h[14],h[3],h[7],h[11],h[15]),this}matrix3FromTopLeft(){const _=this.elements;return new x(_[0],_[4],_[8],_[1],_[5],_[9],_[2],_[6],_[10])}setRotationFromEuler(_,h){const f=this.elements,{x:E,y:m,z:S}=_,w=Math.cos(E),v=Math.sin(E),A=Math.cos(m),M=Math.sin(m),T=Math.cos(S),R=Math.sin(S);if(h===void 0||h==="XYZ"){const O=w*T,L=w*R,P=v*T,I=v*R;f[0]=A*T,f[4]=-A*R,f[8]=M,f[1]=L+P*M,f[5]=O-I*M,f[9]=-v*A,f[2]=I-O*M,f[6]=P+L*M,f[10]=w*A}else console.error(`Error with matrix4 setRotationFromEuler. Order: ${h}`);return this}setRotationFromQuaternion(_){const h=this.elements,{x:f,y:E,z:m,w:S}=_,w=f+f,v=E+E,A=m+m,M=f*w,T=f*v,R=f*A,O=E*v,L=E*A,P=m*A,I=S*w,N=S*v,U=S*A;return h[0]=1-(O+P),h[4]=T-U,h[8]=R+N,h[1]=T+U,h[5]=1-(M+P),h[9]=L-I,h[2]=R-N,h[6]=L+I,h[10]=1-(M+O),this}multiplyMatrices(_,h){const f=_.elements,E=h.elements,m=this.elements,S=f[0],w=f[4],v=f[8],A=f[12],M=f[1],T=f[5],R=f[9],O=f[13],L=f[2],P=f[6],I=f[10],N=f[14],U=f[3],F=f[7],k=f[11],j=f[15],H=E[0],B=E[4],V=E[8],Y=E[12],K=E[1],J=E[5],Te=E[9],He=E[13],Q=E[2],Xe=E[6],ut=E[10],Ji=E[14],er=E[3],ec=E[7],ai=E[11],u0=E[15];return m[0]=S*H+w*K+v*Q+A*er,m[4]=S*B+w*J+v*Xe+A*ec,m[8]=S*V+w*Te+v*ut+A*ai,m[12]=S*Y+w*He+v*Ji+A*u0,m[1]=M*H+T*K+R*Q+O*er,m[5]=M*B+T*J+R*Xe+O*ec,m[9]=M*V+T*Te+R*ut+O*ai,m[13]=M*Y+T*He+R*Ji+O*u0,m[2]=L*H+P*K+I*Q+N*er,m[6]=L*B+P*J+I*Xe+N*ec,m[10]=L*V+P*Te+I*ut+N*ai,m[14]=L*Y+P*He+I*Ji+N*u0,m[3]=U*H+F*K+k*Q+j*er,m[7]=U*B+F*J+k*Xe+j*ec,m[11]=U*V+F*Te+k*ut+j*ai,m[15]=U*Y+F*He+k*Ji+j*u0,this}multiplyScalar(_){const h=this.elements;return h[0]*=_,h[4]*=_,h[8]*=_,h[12]*=_,h[1]*=_,h[5]*=_,h[9]*=_,h[13]*=_,h[2]*=_,h[6]*=_,h[10]*=_,h[14]*=_,h[3]*=_,h[7]*=_,h[11]*=_,h[15]*=_,this}makeTranslation(_,h,f){return this.set(1,0,0,_,0,1,0,h,0,0,1,f,0,0,0,1),this}snap(_){const h=Math.pow(10,4),f=this.elements;for(let E=0;E<16;E++){const m=Math.round(f[E]);m===Math.round(f[E]*h)/h&&(f[E]=m)}return this}transpose(){const _=this.elements;let h;return h=_[1],_[1]=_[4],_[4]=h,h=_[2],_[2]=_[8],_[8]=h,h=_[6],_[6]=_[9],_[9]=h,h=_[3],_[3]=_[12],_[12]=h,h=_[7],_[7]=_[13],_[13]=h,h=_[11],_[11]=_[14],_[14]=h,this}setPosition(_){const h=this.elements;return h[12]=_.x,h[13]=_.y,h[14]=_.z,this}translate(_){const h=this.elements;return h[12]+=_.x,h[13]+=_.y,h[14]+=_.z,this}getInverse(_,h){const f=this.elements,E=_.elements,m=E[0],S=E[4],w=E[8],v=E[12],A=E[1],M=E[5],T=E[9],R=E[13],O=E[2],L=E[6],P=E[10],I=E[14],N=E[3],U=E[7],F=E[11],k=E[15];f[0]=T*I*U-R*P*U+R*L*F-M*I*F-T*L*k+M*P*k,f[4]=v*P*U-w*I*U-v*L*F+S*I*F+w*L*k-S*P*k,f[8]=w*R*U-v*T*U+v*M*F-S*R*F-w*M*k+S*T*k,f[12]=v*T*L-w*R*L-v*M*P+S*R*P+w*M*I-S*T*I,f[1]=R*P*N-T*I*N-R*O*F+A*I*F+T*O*k-A*P*k,f[5]=w*I*N-v*P*N+v*O*F-m*I*F-w*O*k+m*P*k,f[9]=v*T*N-w*R*N-v*A*F+m*R*F+w*A*k-m*T*k,f[13]=w*R*O-v*T*O+v*A*P-m*R*P-w*A*I+m*T*I,f[2]=M*I*N-R*L*N+R*O*U-A*I*U-M*O*k+A*L*k,f[6]=v*L*N-S*I*N-v*O*U+m*I*U+S*O*k-m*L*k,f[10]=S*R*N-v*M*N+v*A*U-m*R*U-S*A*k+m*M*k,f[14]=v*M*O-S*R*O-v*A*L+m*R*L+S*A*I-m*M*I,f[3]=T*L*N-M*P*N-T*O*U+A*P*U+M*O*F-A*L*F,f[7]=S*P*N-w*L*N+w*O*U-m*P*U-S*O*F+m*L*F,f[11]=w*M*N-S*T*N-w*A*U+m*T*U+S*A*F-m*M*F,f[15]=S*T*O-w*M*O+w*A*L-m*T*L-S*A*P+m*M*P;const j=m*f[0]+A*f[4]+O*f[8]+N*f[12];if(j===0){const H="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(h)throw new Error(H);return console.warn(H),this.identity(),this}return this.multiplyScalar(1/j),this}isReflected(){const _=this.elements,h=_[0],f=_[4],E=_[8],m=_[1],S=_[5],w=_[9],v=_[2],A=_[6],M=_[10];return h*S*M+m*A*E+v*f*w-v*S*E-m*f*M-h*A*w<0}scale(_){const h=this.elements,{x:f}=_,{y:E}=_,{z:m}=_;return h[0]*=f,h[4]*=E,h[8]*=m,h[1]*=f,h[5]*=E,h[9]*=m,h[2]*=f,h[6]*=E,h[10]*=m,h[3]*=f,h[7]*=E,h[11]*=m,this}getMaxScaleOnAxis(){const _=this.elements,h=_[0]*_[0]+_[1]*_[1]+_[2]*_[2],f=_[4]*_[4]+_[5]*_[5]+_[6]*_[6],E=_[8]*_[8]+_[9]*_[9]+_[10]*_[10];return Math.sqrt(Math.max(h,Math.max(f,E)))}makeFrustum(_,h,f,E,m,S){const w=this.elements,v=2*m/(h-_),A=2*m/(E-f),M=(h+_)/(h-_),T=(E+f)/(E-f),R=-(S+m)/(S-m),O=-2*S*m/(S-m);return w[0]=v,w[4]=0,w[8]=M,w[12]=0,w[1]=0,w[5]=A,w[9]=T,w[13]=0,w[2]=0,w[6]=0,w[10]=R,w[14]=O,w[3]=0,w[7]=0,w[11]=-1,w[15]=0,this}makePerspective(_,h,f,E){const m=f*Math.tan((0,n.degToRad)(_*.5)),S=-m,w=S*h,v=m*h;return this.makeFrustum(w,v,S,m,f,E)}makeOrthographic(_,h,f,E,m,S){const w=this.elements,v=1/(h-_),A=1/(f-E),M=1/(S-m),T=(h+_)*v,R=(f+E)*A,O=(S+m)*M;return w[0]=2*v,w[4]=0,w[8]=0,w[12]=-T,w[1]=0,w[5]=2*A,w[9]=0,w[13]=-R,w[2]=0,w[6]=0,w[10]=-2*M,w[14]=-O,w[3]=0,w[7]=0,w[11]=0,w[15]=1,this}isEqual(_){const h=_.elements,f=this.elements;return f[0]===h[0]&&f[4]===h[4]&&f[8]===h[8]&&f[12]===h[12]&&f[1]===h[1]&&f[5]===h[5]&&f[9]===h[9]&&f[13]===h[13]&&f[2]===h[2]&&f[6]===h[6]&&f[10]===h[10]&&f[14]===h[14]&&f[3]===h[3]&&f[7]===h[7]&&f[11]===h[11]&&f[15]===h[15]}clone(){const _=this.elements;return new u(_[0],_[4],_[8],_[12],_[1],_[5],_[9],_[13],_[2],_[6],_[10],_[14],_[3],_[7],_[11],_[15])}isIdentity(){const _=this.elements;return _[0]===1&&_[4]===0&&_[8]===0&&_[12]===0&&_[1]===0&&_[5]===1&&_[9]===0&&_[13]===0&&_[2]===0&&_[6]===0&&_[10]===1&&_[14]===0&&_[3]===0&&_[7]===0&&_[11]===0&&_[15]===1}isNearlyIdentity(_){return this.clone().snap(_).isIdentity()}getScale(_){const h=this.elements;return _=_||new g,a.set(h[0],h[1],h[2]),l.set(h[4],h[5],h[6]),d.set(h[8],h[9],h[10]),_.x=a.length(),_.y=l.length(),_.z=d.length(),_}lookAt(_,h,f){const E=this.elements;return d.subVectors(_,h).normalize(),d.length()===0&&(d.z=1),a.crossVectors(f,d).normalize(),a.length()===0&&(d.x+=1e-4,a.crossVectors(f,d).normalize()),l.crossVectors(d,a),E[0]=a.x,E[4]=l.x,E[8]=d.x,E[1]=a.y,E[5]=l.y,E[9]=d.y,E[2]=a.z,E[6]=l.z,E[10]=d.z,this}compose(_,h,f){const E=this.elements;return s.identity(),s.setRotationFromQuaternion(h),o.makeScale(f.x,f.y,f.z),this.multiplyMatrices(s,o),E[12]=_.x,E[13]=_.y,E[14]=_.z,this}}s=new u,o=new u;class g{constructor(_,h,f){this.x=_||0,this.y=h||0,this.z=f||0,this.atomid=void 0}set(_,h,f){return this.x=_,this.y=h,this.z=f,this}copy(_){return this.x=_.x,this.y=_.y,this.z=_.z,this}add(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this}addVectors(_,h){return this.x=_.x+h.x,this.y=_.y+h.y,this.z=_.z+h.z,this}multiplyVectors(_,h){return this.x=_.x*h.x,this.y=_.y*h.y,this.z=_.z*h.z,this}sub(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this}subVectors(_,h){return this.x=_.x-h.x,this.y=_.y-h.y,this.z=_.z-h.z,this}multiplyScalar(_){return this.x*=_,this.y*=_,this.z*=_,this}divideScalar(_){return _!==0?(this.x/=_,this.y/=_,this.z/=_):(this.x=0,this.y=0,this.z=0),this}max(_){return this.x=Math.max(this.x,_.x),this.y=Math.max(this.y,_.y),this.z=Math.max(this.z,_.z),this}min(_){return this.x=Math.min(this.x,_.x),this.y=Math.min(this.y,_.y),this.z=Math.min(this.z,_.z),this}distanceTo(_){return Math.sqrt(this.distanceToSquared(_))}distanceToSquared(_){const h=this.x-_.x,f=this.y-_.y,E=this.z-_.z;return h*h+f*f+E*E}applyMatrix3(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.elements;return this.x=m[0]*h+m[3]*f+m[6]*E,this.y=m[1]*h+m[4]*f+m[7]*E,this.z=m[2]*h+m[5]*f+m[8]*E,this}applyMatrix4(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.elements;return this.x=m[0]*h+m[4]*f+m[8]*E+m[12],this.y=m[1]*h+m[5]*f+m[9]*E+m[13],this.z=m[2]*h+m[6]*f+m[10]*E+m[14],this}applyProjection(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.elements,S=m[3]*h+m[7]*f+m[11]*E+m[15];return this.x=(m[0]*h+m[4]*f+m[8]*E+m[12])/S,this.y=(m[1]*h+m[5]*f+m[9]*E+m[13])/S,this.z=(m[2]*h+m[6]*f+m[10]*E+m[14])/S,this}applyQuaternion(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.x,S=_.y,w=_.z,v=_.w,A={};A.x=2*(f*w-E*S),A.y=2*(E*m-h*w),A.z=2*(h*S-f*m);const M={};return M.x=A.y*w-A.z*S,M.y=A.z*m-A.x*w,M.z=A.x*S-A.y*m,this.x=h+v*A.x+M.x,this.y=f+v*A.y+M.y,this.z=E+v*A.z+M.z,this}negate(){return this.multiplyScalar(-1)}dot(_){return this.x*_.x+this.y*_.y+this.z*_.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(_){const{x:h}=this,{y:f}=this,{z:E}=this;return this.x=f*_.z-E*_.y,this.y=E*_.x-h*_.z,this.z=h*_.y-f*_.x,this}crossVectors(_,h){return this.x=_.y*h.z-_.z*h.y,this.y=_.z*h.x-_.x*h.z,this.z=_.x*h.y-_.y*h.x,this}equals(_){return this.x==_.x&&this.y==_.y&&this.z==_.z}getPositionFromMatrix(_){return this.x=_.elements[12],this.y=_.elements[13],this.z=_.elements[14],this}setEulerFromRotationMatrix(_,h){const f=_.elements,E=f[0],m=f[4],S=f[8],w=f[5],v=f[9],A=f[6],M=f[10];return h===void 0||h==="XYZ"?(this.y=Math.asin((0,i.clamp)(S,-1,1)),Math.abs(S)<.99999?(this.x=Math.atan2(-v,M),this.z=Math.atan2(-m,E)):(this.x=Math.atan2(A,w),this.z=0)):console.error(`Error with vector's setEulerFromRotationMatrix: Unknown order: ${h}`),this}rotateAboutVector(_,h){_.normalize();const f=Math.cos(h),E=Math.sin(h),m=this.clone().multiplyScalar(f),S=_.clone().cross(this).multiplyScalar(E),w=_.clone().multiplyScalar(_.clone().dot(this)).multiplyScalar(1-f),v=m.add(S).add(w);return this.x=v.x,this.y=v.y,this.z=v.z,this}setFromMatrixPosition(_){const h=_.elements;return this.x=h[12],this.y=h[13],this.z=h[14],this}transformDirection(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.elements;return this.x=m[0]*h+m[4]*f+m[8]*E,this.y=m[1]*h+m[5]*f+m[9]*E,this.z=m[2]*h+m[6]*f+m[10]*E,this.normalize()}clone(){return new g(this.x,this.y,this.z)}unproject(_){const h=s;return h.multiplyMatrices(_.matrixWorld,h.getInverse(_.projectionMatrix)),this.applyMatrix4(h)}}a=new g,l=new g,d=new g;class x{constructor(_=1,h=0,f=0,E=0,m=1,S=0,w=0,v=0,A=1){this.elements=new Float32Array(9),this.set(_,h,f,E,m,S,w,v,A)}set(_,h,f,E,m,S,w,v,A){const M=this.elements;return M[0]=_,M[3]=h,M[6]=f,M[1]=E,M[4]=m,M[7]=S,M[2]=w,M[5]=v,M[8]=A,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(_){const h=_.elements;this.set(h[0],h[3],h[6],h[1],h[4],h[7],h[2],h[5],h[8])}multiplyScalar(_){const h=this.elements;return h[0]*=_,h[3]*=_,h[6]*=_,h[1]*=_,h[4]*=_,h[7]*=_,h[2]*=_,h[5]*=_,h[8]*=_,this}getInverse3(_){const h=_.elements,f=this.elements;f[0]=h[4]*h[8]-h[5]*h[7],f[3]=h[6]*h[5]-h[3]*h[8],f[6]=h[3]*h[7]-h[6]*h[4],f[1]=h[7]*h[2]-h[1]*h[8],f[4]=h[0]*h[8]-h[6]*h[2],f[7]=h[1]*h[6]-h[0]*h[7],f[2]=h[1]*h[5]-h[2]*h[4],f[5]=h[2]*h[3]-h[0]*h[5],f[8]=h[0]*h[4]-h[1]*h[3];const E=h[0]*f[0]+h[3]*f[1]+h[6]*f[2];return this.multiplyScalar(1/E),this}getInverse(_,h){const f=_.elements,E=this.elements;E[0]=f[10]*f[5]-f[6]*f[9],E[1]=-f[10]*f[1]+f[2]*f[9],E[2]=f[6]*f[1]-f[2]*f[5],E[3]=-f[10]*f[4]+f[6]*f[8],E[4]=f[10]*f[0]-f[2]*f[8],E[5]=-f[6]*f[0]+f[2]*f[4],E[6]=f[9]*f[4]-f[5]*f[8],E[7]=-f[9]*f[0]+f[1]*f[8],E[8]=f[5]*f[0]-f[1]*f[4];const m=f[0]*E[0]+f[1]*E[3]+f[2]*E[6];if(m===0){const S="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(h)throw new Error(S);return console.warn(S),this.identity(),this}return this.multiplyScalar(1/m),this}getDeterminant(){const _=this.elements;return _[0]*_[4]*_[8]+_[1]*_[5]*_[6]+_[2]*_[3]*_[7]-_[2]*_[4]*_[6]-_[1]*_[3]*_[8]-_[0]*_[5]*_[7]}transpose(){let _;const h=this.elements;return _=h[1],h[1]=h[3],h[3]=_,_=h[2],h[2]=h[6],h[6]=_,_=h[5],h[5]=h[7],h[7]=_,this}clone(){const _=this.elements;return new x(_[0],_[3],_[6],_[1],_[4],_[7],_[2],_[5],_[8])}getMatrix4(){const _=this.elements;return new u(_[0],_[3],_[6],0,_[1],_[4],_[7],0,_[2],_[5],_[8],0)}}class y{constructor(_,h){this.origin=_!==void 0?_:new g,this.direction=h!==void 0?h:new g}set(_,h){return this.origin.copy(_),this.direction.copy(h),this}copy(_){return this.origin.copy(_.origin),this.direction.copy(_.direction),this}at(_,h){return(h||new g).copy(this.direction).multiplyScalar(_).add(this.origin)}recast(_){const h=a;return this.origin.copy(this.at(_,h)),this}closestPointToPoint(_,h){const f=h||new g;f.subVectors(_,this.origin);const E=f.dot(this.direction);return f.copy(this.direction).multiplyScalar(E).add(this.origin)}distanceToPoint(_){const h=a,f=h.subVectors(_,this.origin).dot(this.direction);return h.copy(this.direction).multiplyScalar(f).add(this.origin),h.distanceTo(_)}isIntersectionCylinder(){}isIntersectionSphere(_){return this.distanceToPoint(_.center)<=_.radius}isIntersectionPlane(_){return _.normal.dot(this.direction)!==0||_.distanceToPoint(this.origin)===0}distanceToPlane(_){const h=_.normal.dot(this.direction);return h===0?_.distanceToPoint(this.origin)===0?0:void 0:-(this.origin.dot(_.normal)+_.constant)/h}intersectPlane(_,h){const f=this.distanceToPlane(_);if(f!==void 0)return this.at(f,h)}applyMatrix4(_){return this.direction.add(this.origin).applyMatrix4(_),this.origin.applyMatrix4(_),this.direction.sub(this.origin),this}clone(){return new y().copy(this)}}}),"./src/WebGL/math/utils/clamp.ts":((r,e,t)=>{t.r(e),t.d(e,{clamp:()=>n});function n(i,s,o){return Math.min(Math.max(i,s),o)}}),"./src/WebGL/math/utils/conversionMatrix3.ts":((r,e,t)=>{t.r(e),t.d(e,{conversionMatrix3:()=>i});var n=t("./src/WebGL/math/math.ts");function i(s,o,a,l,d,u){l=l*Math.PI/180,d=d*Math.PI/180,u=u*Math.PI/180;const g=f=>f*f,x=Math.cos(l),y=Math.cos(d),b=Math.cos(u),_=Math.sin(u);return new n.Matrix3(s,o*b,a*y,0,o*_,a*(x-y*b)/_,0,0,a*Math.sqrt(1-g(x)-g(y)-g(b)+2*x*y*b)/_)}}),"./src/WebGL/math/utils/degToRad.ts":((r,e,t)=>{t.r(e),t.d(e,{degToRad:()=>i});const n=Math.PI/180;function i(s){return s*n}}),"./src/WebGL/objects/Line.ts":((r,e,t)=>{t.r(e),t.d(e,{Line:()=>o,LineStyle:()=>s});var n=t("./src/WebGL/materials/index.ts"),i=t("./src/WebGL/core/index.ts"),s;(function(a){a[a.LineStrip=0]="LineStrip",a[a.LinePieces=1]="LinePieces"})(s||(s={}));class o extends i.Object3D{constructor(l,d=new n.LineBasicMaterial({color:Math.random()*16777215}),u=s.LineStrip){super(),this.geometry=l,this.material=d,this.type=u}clone(l=new o(this.geometry,this.material,this.type)){return super.clone.call(this,l),l}}}),"./src/WebGL/objects/Mesh.ts":((r,e,t)=>{t.r(e),t.d(e,{Mesh:()=>i});var n=t("./src/WebGL/core/index.ts");class i extends n.Object3D{constructor(o,a){super(),this.geometry=o,this.material=a}clone(o){return o===void 0&&(o=new i(this.geometry,this.material)),super.clone.call(this,o),o}}}),"./src/WebGL/objects/Sprite.ts":((r,e,t)=>{t.r(e),t.d(e,{Sprite:()=>s});var n=t("./src/WebGL/materials/index.ts"),i=t("./src/WebGL/core/index.ts");class s extends i.Object3D{constructor(a=new n.SpriteMaterial){super(),this.material=a,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(a=new s(this.material)){return i.Object3D.prototype.clone.call(this,a),a}}}),"./src/WebGL/objects/index.ts":((r,e,t)=>{t.r(e),t.d(e,{Line:()=>n.Line,LineStyle:()=>n.LineStyle,Mesh:()=>i.Mesh,Sprite:()=>s.Sprite});var n=t("./src/WebGL/objects/Line.ts"),i=t("./src/WebGL/objects/Mesh.ts"),s=t("./src/WebGL/objects/Sprite.ts")}),"./src/WebGL/shaders/ShaderType.ts":((r,e,t)=>{t.r(e)}),"./src/WebGL/shaders/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ShaderLib:()=>n.ShaderLib,ShaderUtils:()=>i.ShaderUtils,basic:()=>n.basic,clone:()=>i.clone,instanced:()=>n.instanced,lambert:()=>n.lambert,lambertdouble:()=>n.lambertdouble,outline:()=>n.outline,screen:()=>n.screen,screenaa:()=>n.screenaa,sphereimposter:()=>n.sphereimposter,sphereimposteroutline:()=>n.sphereimposteroutline,sprite:()=>n.sprite,stickimposter:()=>n.stickimposter,stickimposteroutline:()=>n.stickimposteroutline,volumetric:()=>n.volumetric});var n=t("./src/WebGL/shaders/lib/index.ts"),i=t("./src/WebGL/shaders/utils/index.ts");t("./src/WebGL/shaders/ShaderType.ts")}),"./src/WebGL/shaders/lib/basic/basic.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
varying vec3 vColor;
varying vec4 mvPosition;

//DEFINEFRAGCOLOR
void main() {
    gl_FragColor = vec4( vColor, opacity );
    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`}),"./src/WebGL/shaders/lib/basic/basic.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

attribute vec3 position;
attribute vec3 color;

varying vec3 vColor;
varying vec4 mvPosition;

void main() {

    vColor = color;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;

}`}),"./src/WebGL/shaders/lib/basic/index.ts":((r,e,t)=>{t.r(e),t.d(e,{basic:()=>o});var n=t("./src/WebGL/shaders/lib/basic/uniforms.ts"),i=t("./src/WebGL/shaders/lib/basic/basic.frag"),s=t("./src/WebGL/shaders/lib/basic/basic.vert");const o={vertexShader:s.default.replace("#define GLSLIFY 1",""),fragmentShader:i.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/basic/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}}),"./src/WebGL/shaders/lib/blur/blur.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`const float INV_TOTAL_SAMPLES_FACTOR = 1.0 / 9.0;
uniform highp sampler2D inTex;
varying highp vec2 vTexCoords;
    
void main() {
 
 vec2 texelSize = 1.0 / vec2(textureSize(inTex,0));
 float blurred_visibility_factor = 0.0f;
 for (int t = -1; t <= 1; ++t) {
  for (int s = -1; s <= 1; ++s) {
   vec2 offset = vec2(float(s), float(t)) * texelSize;
   blurred_visibility_factor += texture2D(inTex, vTexCoords + offset).r;
  }
 }
    
 gl_FragDepthEXT = blurred_visibility_factor * INV_TOTAL_SAMPLES_FACTOR;
 
}`}),"./src/WebGL/shaders/lib/blur/blur.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `}),"./src/WebGL/shaders/lib/blur/index.ts":((r,e,t)=>{t.r(e),t.d(e,{blur:()=>o});var n=t("./src/WebGL/shaders/lib/blur/uniforms.ts"),i=t("./src/WebGL/shaders/lib/blur/blur.frag"),s=t("./src/WebGL/shaders/lib/blur/blur.vert");const o={fragmentShader:i.default,vertexShader:s.default,uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/blur/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={}}),"./src/WebGL/shaders/lib/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ShaderLib:()=>E,basic:()=>n.basic,instanced:()=>i.instanced,lambert:()=>s.lambert,lambertdouble:()=>o.lambertdouble,outline:()=>a.outline,screen:()=>l.screen,screenaa:()=>d.screenaa,sphereimposter:()=>u.sphereimposter,sphereimposteroutline:()=>g.sphereimposteroutline,sprite:()=>x.sprite,stickimposter:()=>y.stickimposter,stickimposteroutline:()=>b.stickimposteroutline,volumetric:()=>_.volumetric});var n=t("./src/WebGL/shaders/lib/basic/index.ts"),i=t("./src/WebGL/shaders/lib/instanced/index.ts"),s=t("./src/WebGL/shaders/lib/lambert/index.ts"),o=t("./src/WebGL/shaders/lib/lambertdouble/index.ts"),a=t("./src/WebGL/shaders/lib/outline/index.ts"),l=t("./src/WebGL/shaders/lib/screen/index.ts"),d=t("./src/WebGL/shaders/lib/screenaa/index.ts"),u=t("./src/WebGL/shaders/lib/sphereimposter/index.ts"),g=t("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),x=t("./src/WebGL/shaders/lib/sprite/index.ts"),y=t("./src/WebGL/shaders/lib/stickimposter/index.ts"),b=t("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),_=t("./src/WebGL/shaders/lib/volumetric/index.ts"),h=t("./src/WebGL/shaders/lib/ssao/index.ts"),f=t("./src/WebGL/shaders/lib/blur/index.ts");const E={basic:n.basic,blur:f.blur,instanced:i.instanced,lambert:s.lambert,lambertdouble:o.lambertdouble,outline:a.outline,screen:l.screen,screenaa:d.screenaa,ssao:h.ssao,sphereimposter:u.sphereimposter,sphereimposteroutline:g.sphereimposteroutline,sprite:x.sprite,stickimposter:y.stickimposter,stickimposteroutline:b.stickimposteroutline,volumetric:_.volumetric}}),"./src/WebGL/shaders/lib/instanced/index.ts":((r,e,t)=>{t.r(e),t.d(e,{instanced:()=>o});var n=t("./src/WebGL/shaders/lib/instanced/uniforms.ts"),i=t("./src/WebGL/shaders/lib/instanced/instanced.frag"),s=t("./src/WebGL/shaders/lib/instanced/instanced.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/instanced/instanced.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`}),"./src/WebGL/shaders/lib/instanced/instanced.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 offset;
attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}

`}),"./src/WebGL/shaders/lib/instanced/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/lambert/index.ts":((r,e,t)=>{t.r(e),t.d(e,{lambert:()=>o});var n=t("./src/WebGL/shaders/lib/lambert/uniforms.ts"),i=t("./src/WebGL/shaders/lib/lambert/lambert.frag"),s=t("./src/WebGL/shaders/lib/lambert/lambert.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/lambert/lambert.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
varying vec4 mvPosition;


//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }

}`}),"./src/WebGL/shaders/lib/lambert/lambert.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec4 mvPosition;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}`}),"./src/WebGL/shaders/lib/lambert/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/lambertdouble/index.ts":((r,e,t)=>{t.r(e),t.d(e,{lambertdouble:()=>o});var n=t("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),i=t("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),s=t("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
#ifdef SHADED
uniform highp sampler2D shading;
#endif

uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vLightBack;

varying vec3 vColor;
varying vec4 mvPosition;

//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    if ( gl_FrontFacing )
       gl_FragColor.xyz *= vLightFront;
    else
       gl_FragColor.xyz *= vLightBack;
    #endif

    vec3 color = vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( color, opacity );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }

}


`}),"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec3 vLightBack;
varying vec4 mvPosition;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );
    vLightBack = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;
    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;

    gl_Position = projectionMatrix * mvPosition;
}

`}),"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/outline/index.ts":((r,e,t)=>{t.r(e),t.d(e,{outline:()=>o});var n=t("./src/WebGL/shaders/lib/outline/uniforms.ts"),i=t("./src/WebGL/shaders/lib/outline/outline.frag"),s=t("./src/WebGL/shaders/lib/outline/outline.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/outline/outline.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec4 mvPosition;
//DEFINEFRAGCOLOR

void main() {
    gl_FragColor = vec4( outlineColor, 1 );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}


`}),"./src/WebGL/shaders/lib/outline/outline.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float vWidth;
uniform float vHeight;
uniform float outlineMaxPixels;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec4 mvPosition;

void main() {

    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);
    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    mvPosition.xy += norm.xy*outlineWidth;
    vec4 outpos = projectionMatrix * mvPosition;

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*modelViewMatrix * vec4( position, 1.0 );
        float w = outpos.w;
        //normalize homogeneous coords
        unadjusted /= unadjusted.w;
        outpos /= outpos.w;
        vec2 diff = outpos.xy-unadjusted.xy;
        //put into pixels
        diff.x *= vWidth;
        diff.y *= vHeight;
        if ( length(diff) > outlineMaxPixels) {
            vec2 ndiff = normalize(diff)*outlineMaxPixels;
            ndiff.x /= vWidth;
            ndiff.y /= vHeight;
            outpos.xy = unadjusted.xy;
            outpos.xy += ndiff;
        }
        outpos *= w; //if I don't do this things blow up
    }
    gl_Position = outpos;
    mvPosition.z -= outlinePushback; //go backwards in model space
    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..
    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;
}

`}),"./src/WebGL/shaders/lib/outline/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new n.Color(0,0,0)},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}}),"./src/WebGL/shaders/lib/screen/index.ts":((r,e,t)=>{t.r(e),t.d(e,{screen:()=>o});var n=t("./src/WebGL/shaders/lib/screen/uniforms.ts"),i=t("./src/WebGL/shaders/lib/screen/screen.frag"),s=t("./src/WebGL/shaders/lib/screen/screen.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/screen/screen.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = texture2D(colormap, vTexCoords);

   //gl_FragColor.g = gl_FragColor.b =  gl_FragColor.r; //debug shading 
}
        `}),"./src/WebGL/shaders/lib/screen/screen.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `}),"./src/WebGL/shaders/lib/screen/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={}}),"./src/WebGL/shaders/lib/screenaa/index.ts":((r,e,t)=>{t.r(e),t.d(e,{screenaa:()=>o});var n=t("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),i=t("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),s=t("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/screenaa/screenaa.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
        
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
varying highp vec2 vTexCoords;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez
// by way of molstar (https://github.com/molstar/molstar/blob/master/src/mol-gl/shader/fxaa.frag.ts)

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

//DEFINEFRAGCOLOR
void main(void) {
    ivec2 dim = textureSize(tColor,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseScreenSize = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec2 coords = vTexCoords;

    vec4 colorCenter = texture2D(tColor, coords);
    float dEdgeThresholdMin = 0.0312;
    float dEdgeThresholdMax = 0.125;
    int dIterations = 12;
    float dSubpixelQuality = 0.3;

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -inverseScreenSize.y);
    float lumaUp = sampleLuma(coords, 0.0, inverseScreenSize.y);
    float lumaLeft = sampleLuma(coords, -inverseScreenSize.x, 0.0);
    float lumaRight = sampleLuma(coords, inverseScreenSize.x, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -inverseScreenSize.x, -inverseScreenSize.y);
    float lumaUpRight = sampleLuma(coords, inverseScreenSize.x, inverseScreenSize.y);
    float lumaUpLeft = sampleLuma(coords, -inverseScreenSize.x, inverseScreenSize.y);
    float lumaDownRight = sampleLuma(coords, inverseScreenSize.x, -inverseScreenSize.y);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}        

/* old fxaa implementation
uniform highp sampler2D colormap;
varying highp vec2 vTexCoords;


// Basic FXAA implementation based on the code on geeks3d.com 
#define FXAA_REDUCE_MIN (1.0/ 128.0)
#define FXAA_REDUCE_MUL (1.0 / 8.0)
#define FXAA_SPAN_MAX 8.0


vec4 applyFXAA(vec2 fragCoord, highp sampler2D tex)
{
    vec4 color;
    ivec2 dim = textureSize(tex,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec4 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP);
    vec4 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP);
    vec4 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP);
    vec4 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP);
    vec4 rgbM  = texture2D(tex, fragCoord );
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW.xyz, luma);
    float lumaNE = dot(rgbNE.xyz, luma);
    float lumaSW = dot(rgbSW.xyz, luma);
    float lumaSE = dot(rgbSE.xyz, luma);
    float lumaM  = dot(rgbM.xyz,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
            dir * rcpDirMin)) * inverseVP;

    vec4 rgbA = 0.5 * (
        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)) +
        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)));
    vec4 rgbB = rgbA * 0.5 + 0.25 * (
        texture2D(tex, fragCoord  + dir * -0.5) +
        texture2D(tex, fragCoord  + dir * 0.5));

    float lumaB = dot(rgbB.xyz, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = rgbA;
    else
        color = rgbB;

    return color;
}


//DEFINEFRAGCOLOR
void main (void) {
    ivec2 dim = textureSize(colormap,0);

  gl_FragColor = applyFXAA(vTexCoords, colormap);
}
        
*/`}),"./src/WebGL/shaders/lib/screenaa/screenaa.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `}),"./src/WebGL/shaders/lib/screenaa/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={}}),"./src/WebGL/shaders/lib/sphereimposter/index.ts":((r,e,t)=>{t.r(e),t.d(e,{sphereimposter:()=>o});var n=t("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),i=t("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"),s=t("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert");const o={vertexShader:s.default.replace("#define GLSLIFY 1",""),fragmentShader:i.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
uniform mat4 viewMatrix;
uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float uDepth;
uniform vec3 directionalLightColor[ 1 ];

varying vec3 vColor;
varying vec2 mapping;
varying float rval;
varying vec3 vLight;
varying vec3 center;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));
    float dotProduct = dot( norm, vLight );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;
    vec3 color = vLight*vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );

    if(fogNear != fogFar) {
        float depth = -cameraPos.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
     
}

`}),"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying vec3 vColor;
varying float rval;
varying vec3 vLight;
varying vec3 center;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz );
    mapping = normal.xy;
    rval = abs(normal.x);
    gl_Position = projPosition+adjust;

}
`}),"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts":((r,e,t)=>{t.r(e),t.d(e,{sphereimposteroutline:()=>o});var n=t("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),i=t("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),s=t("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform mat4 projectionMatrix;
varying vec2 mapping;
varying float rval;
varying vec3 center;

uniform float outlinePushback;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragColor = vec4(outlineColor, 1 );

    if(fogNear != fogFar) {
        float depth = -cameraPos.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}


`}),"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform float vHeight;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying float rval;
varying vec3 center;

void main() {

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);

    vec4 adjust = projectionMatrix* vec4(norm,normal.z,1.0); 
    mapping = norm.xy;
    rval = abs(norm.x);
    gl_Position = projPosition+vec4(adjust.xy,0.0,0.0);

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*vec4(center.x+normal.x, center.y,center.z,1.0); 
        vec4 ccoord = projectionMatrix*vec4(center.xyz,1.0);
        adjust = projectionMatrix* vec4(center.x+norm.x,center.y,center.z,1.0); 
        //subtract center 
        unadjusted.xyz -= ccoord.xyz;
        adjust.xyz -= ccoord.xyz;
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth;
        if(diff > outlineMaxPixels) {
            
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth;
            //adjsut reval by ratio of lengths
            rval *= fixlen/abs(adjust.x);
        }

    }
}

`}),"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new n.Color(0,0,0)},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}}),"./src/WebGL/shaders/lib/sprite/index.ts":((r,e,t)=>{t.r(e),t.d(e,{sprite:()=>o});var n=t("./src/WebGL/shaders/lib/sprite/uniforms.ts"),i=t("./src/WebGL/shaders/lib/sprite/sprite.frag"),s=t("./src/WebGL/shaders/lib/sprite/sprite.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/sprite/sprite.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform vec3 color;
uniform sampler2D map;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float alphaTest;

varying vec2 vUV;
//DEFINEFRAGCOLOR

void main() {

    vec4 texture = texture2D(map, vUV);

    if (texture.a <= alphaTest) discard;

    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);

    if (fogNear != fogFar) {

        float depth = gl_FragCoord.z / gl_FragCoord.w; //probably wrong
        float fogFactor = smoothstep(fogNear, fogFar, depth);        
        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);
    }
}

`}),"./src/WebGL/shaders/lib/sprite/sprite.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform int useScreenCoordinates;
uniform vec3 screenPosition;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float rotation;
uniform vec2 scale;
uniform vec2 alignment;
uniform vec2 uvOffset;
uniform vec2 uvScale;

attribute vec2 position;
attribute vec2 uv;

varying vec2 vUV;

void main() {

    vUV = uvOffset + uv * uvScale;

    vec2 alignedPosition = position + alignment;

    vec2 rotatedPosition;
    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;
    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;

    vec4 finalPosition;

    if(useScreenCoordinates != 0) {
        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);
    }

    else {
        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;
        finalPosition.xy += rotatedPosition; 
    }

    gl_Position = finalPosition;

}

`}),"./src/WebGL/shaders/lib/sprite/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={}}),"./src/WebGL/shaders/lib/ssao/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ssao:()=>o});var n=t("./src/WebGL/shaders/lib/ssao/uniforms.ts"),i=t("./src/WebGL/shaders/lib/ssao/ssao.frag"),s=t("./src/WebGL/shaders/lib/ssao/ssao.vert");const o={fragmentShader:i.default,vertexShader:s.default,uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/ssao/ssao.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform sampler2D depthmap;
varying highp vec2 vTexCoords;
uniform float vWidth;
uniform float vHeight;
uniform float total_strength;
uniform float radius;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

//code for pseudorandom vector from chatgpt
float hash(vec3 p) {
    p = fract(p * vec3(0.1031, 0.1030, 0.0973));
    p += dot(p, p.yzx + 33.33);
    return fract((p.x + p.y) * p.z);
}

// Generate a pseudorandom vec3 from a seed vec3
vec3 pseudorandomVec3(vec3 seed) {
    vec3 randomVec;
    randomVec.x = hash(seed);
    randomVec.y = hash(seed + vec3(1.0, 0.0, 17.1));
    randomVec.z = hash(seed + vec3(0.0, 13.23, 0.0));
    return randomVec;
}

void main(void)
{   
   const float base = 0.2;
   const float area = 0.75;
   const int cycles = 1;

   const int samples = 64;
   vec3 sample_sphere[64] = vec3[](
      vec3(0.091258,-0.510164,0.000000),
      vec3(-0.204347,-0.872967,0.187199),
      vec3(0.009690,-0.263696,-0.110414),
      vec3(0.175208,-0.563987,0.228527),
      vec3(-0.001824,-0.003113,-0.000323),
      vec3(0.411134,-0.719869,-0.261530),
      vec3(-0.074272,-0.377368,0.276290),
      vec3(-0.147773,-0.381587,-0.284529),
      vec3(0.173317,-0.199635,0.063295),
      vec3(-0.186452,-0.199460,0.076965),
      vec3(0.143985,-0.308160,-0.307687),
      vec3(0.053194,-0.148286,0.169589),
      vec3(-0.547656,-0.486476,-0.317378),
      vec3(0.020804,-0.015092,-0.004574),
      vec3(-0.038006,-0.043165,0.054059),
      vec3(-0.094795,-0.443908,-0.731525),
      vec3(0.547552,-0.396466,0.461477),
      vec3(-0.176886,-0.089989,0.007315),
      vec3(0.074401,-0.048840,-0.074039),
      vec3(-0.008240,-0.075697,0.178197),
      vec3(-0.307880,-0.185053,-0.368943),
      vec3(0.309520,-0.108483,0.041646),
      vec3(-0.773478,-0.292946,0.538166),
      vec3(0.184487,-0.231594,-0.820065),
      vec3(0.207318,-0.100531,0.361797),
      vec3(-0.173306,-0.037737,-0.055289),
      vec3(0.548102,-0.105342,-0.253237),
      vec3(-0.119342,-0.043907,0.285162),
      vec3(-0.270247,-0.087861,-0.751357),
      vec3(0.449312,-0.039777,0.236146),
      vec3(-0.743773,-0.036095,0.196056),
      vec3(0.148819,-0.004300,-0.231448),
      vec3(0.008773,0.000809,0.051047),
      vec3(-0.461467,0.027390,-0.357386),
      vec3(0.169626,0.013338,-0.014053),
      vec3(-0.043786,0.007095,0.047331),
      vec3(0.004821,0.140371,-0.988260),
      vec3(0.092402,0.023994,0.101860),
      vec3(-0.295335,0.061530,-0.027372),
      vec3(0.024903,0.007537,-0.018901),
      vec3(-0.081463,0.125402,0.447794),
      vec3(-0.397119,0.231805,-0.631062),
      vec3(0.163853,0.059014,0.044905),
      vec3(-0.495220,0.214357,0.254139),
      vec3(0.306123,0.373687,-0.825715),
      vec3(0.021665,0.026737,0.053220),
      vec3(-0.208231,0.117129,-0.098685),
      vec3(0.139749,0.080968,-0.043086),
      vec3(-0.153599,0.182814,0.262090),
      vec3(-0.159673,0.496777,-0.743568),
      vec3(0.134797,0.117152,0.095753),
      vec3(-0.155626,0.120533,0.019395),
      vec3(0.042311,0.054462,-0.049709),
      vec3(0.001257,0.031288,0.034468),
      vec3(-0.002271,0.003199,-0.002304),
      vec3(0.662104,0.717307,0.033854),
      vec3(-0.373100,0.576021,0.308274),
      vec3(0.024233,0.231316,-0.173688),
      vec3(0.161311,0.420217,0.234273),
      vec3(-0.045248,0.078031,-0.010411),
      vec3(0.167453,0.376942,-0.094872),
      vec3(-0.056194,0.433247,0.173218),
      vec3(-0.016224,0.123149,-0.035569),
      vec3(0.067127,0.407641,0.028479)
   );

   float depth = texture2D(depthmap, vTexCoords).r;
   if(depth == 1.0) {
      discard;
   }

   vec4 screen_position = vec4(vTexCoords, depth,1.0);
   vec4 pos = projinv*screen_position;
   pos /= pos.w;
   vec3 position = pos.xyz;

   //approximate the normal from the depth map; I find this simpler
   //than trying to recompute the exact normal within every possible object shader

   //pixel offset positions in screen space
   ivec2 dim = textureSize(depthmap,0);
   vec2 offset1 = vec2(0.0,1.0/float(dim.y));
   vec2 offset2 = vec2(1.0/float(dim.x),0.0);
   float depth1 = texture2D(depthmap, vTexCoords + offset1).r;
   float depth2 = texture2D(depthmap, vTexCoords + offset2).r;
   
   vec3 p1 = vec3(screen_position.xy+offset1, depth1 - depth);
   vec3 p2 = vec3(screen_position.xy+offset2, depth2 - depth);

   //convert to model space
   vec4 pos1 = projinv*vec4(p1,1);
   pos1 /= pos1.w;
   vec4 pos2 = projinv*vec4(p2,1);
   pos2 /= pos2.w;

   vec3 normal = normalize(cross(pos1.xyz-position, pos2.xyz-position)); //model normal, important we normalize in model space

   //pseudo random number

   float occlusion = 0.0;
   for(int c = 0; c < cycles; c++) {
   vec3 random = normalize(pseudorandomVec3(position+float(c)));
   for(int i=0; i < samples; i++) {

      vec3 ray = radius * reflect(sample_sphere[i],random);
      vec3 hemi_ray = position + sign(dot(ray,normal)) * ray; //model space
      vec4 hemi_screen = projectionMatrix*vec4(hemi_ray,1.0);
      hemi_screen /= hemi_screen.w;
      
      float occ_depth = texture2D(depthmap, clamp(hemi_screen.xy,0.0,1.0)).r;
      float difference = hemi_screen.z - occ_depth;
      
      occlusion += step(0.0, difference) * (1.0-smoothstep(0.0, area, difference));
   }
   }
   float ao = 1.0 - total_strength * occlusion * (1.0 / float(cycles*samples));
   gl_FragDepthEXT = clamp(ao+base,0.0,1.0);

}`}),"./src/WebGL/shaders/lib/ssao/ssao.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `}),"./src/WebGL/shaders/lib/ssao/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={total_strength:{type:"f",value:1},radius:{type:"f",value:5},projinv:{type:"mat4",value:[]}}}),"./src/WebGL/shaders/lib/stickimposter/index.ts":((r,e,t)=>{t.r(e),t.d(e,{stickimposter:()=>l});var n=t("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),i=t("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),s=t("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),o=t("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const l={fragmentShader:[i.default,s.default].join(`
`),vertexShader:o.default,uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`    float dotProduct = dot( norm, vLight );
    vec3 light = vec3( max( dotProduct, 0.0 ) );
    color *= light;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );
    if(fogNear != fogFar) {
        float depth = -qi.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`}),"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary
    r = abs(radius);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
    bool isperspective = (projectionMatrix[3][3] == 0.0);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       if(isperspective) { //perspective
         vec3 pnorm = normalize(p1);
         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
         mvPosition.xyz = p1+t*pnorm; 
       } else { //orthographic
         mvPosition.xyz = p1;
       }
    } else {
      if(isperspective) { //perspective
         vec3 pnorm = normalize(p2);
         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
         mvPosition.xyz = p2+t*pnorm;
       } else { //orthographic
         mvPosition.xyz = p2;
       } 
       mult *= -1.0;
    }

    if(isperspective) { //perspective
      vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;
      vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;
    } else {
      vec3 cr = normalize(cross(vec3(0.0,0.0,-1.0),norm))*radius;
      vec3 doublecr = normalize(cross(vec3(0.0,0.0,-1.0),cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;     
    }

    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..
}

`}),"./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLight;
varying vec3 vColor;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf
//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl
//with a bit more care (caps) this could be a general cylinder imposter (see also outline)
void main() {
    vec3 color = abs(vColor);
    vec3 pos = cposition;
    vec3 p = pos; //ray point
    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic
    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective
    vec3 pa = p1; //cyl start
    vec3 va = normalize(p2-p1); //cyl norm
    vec3 tmp1 = v-(dot(v,va)*va);
    vec3 deltap = p-pa;
    float A = dot(tmp1,tmp1);
    if(A == 0.0) discard;
    vec3 tmp2 = deltap-(dot(deltap,va)*va);
    float B = 2.0*dot(tmp1, tmp2);
    float C = dot(tmp2,tmp2)-r*r;
//quadratic equation!
    float det = (B*B) - (4.0*A*C);
    if(det < 0.0) discard;
    float sqrtDet = sqrt(det);
    float posT = (-B+sqrtDet)/(2.0*A);
    float negT = (-B-sqrtDet)/(2.0*A);
    float intersectionT = min(posT,negT);
    vec3 qi = p+v*intersectionT;
    float dotp1 = dot(va,qi-p1);
    float dotp2 = dot(va,qi-p2);
    vec3 norm;
    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0
       vec3 cp;
       if( dotp1 < 0.0) {  
//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not
        cp = p1;
       } else {
//          if(vColor.y < 0.0 ) discard;
          cp = p2;
       }
       vec3 diff = p-cp;
       A = dot(v,v);
       B = dot(diff,v)*2.0;
       C = dot(diff,diff)-r*r;
       det = (B*B) - (4.0*C);
       if(det < 0.0) discard;
       sqrtDet = sqrt(det);
       posT = (-B+sqrtDet)/(2.0);
       negT = (-B-sqrtDet)/(2.0);
       float t = min(posT,negT);
       qi = p+v*t; 
       norm = normalize(qi-cp); 
    } else {
       norm = normalize(qi-(dotp1*va + p1));
    }
    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragDepthEXT = depth;`}),"./src/WebGL/shaders/lib/stickimposter/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/stickimposteroutline/index.ts":((r,e,t)=>{t.r(e),t.d(e,{stickimposteroutline:()=>l});var n=t("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),i=t("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),s=t("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag"),o=t("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const l={fragmentShader:i.default+s.default,vertexShader:o.default,uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
    gl_FragColor = vec4(color, opacity*opacity );
    if(fogNear != fogFar) {
        float depth = -qi.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`}),"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];
uniform vec3 outlineColor;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform mat4 projinv;


attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = outlineColor;
    float rad = radius+sign(radius)*outlineWidth;
    r = abs(rad);

    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
//pushback
    float scale = 1.0;
    if(projectionMatrix[3][3] != 0.0) { //orthographic
        to.z -= outlinePushback;
        pt.z -= outlinePushback;
    } else { //perspective
        vec4 midbefore = pt;
        if(length(to.xyz) < length(pt)) {
            midbefore = to;
        }
        vec4 midafter = midbefore;
        midafter.xyz += normalize(midbefore.xyz)*outlinePushback;

        to.xyz += normalize(to.xyz)*outlinePushback;
        pt.xyz += normalize(pt.xyz)*outlinePushback;

        //figure out a scaling factor for radius to account for perspective setback
        vec4 midbeforer = vec4(midbefore.x+rad,midbefore.y, midbefore.z, midbefore.w);
        vec4 midafterr = vec4(midafter.x+rad,midafter.y, midafter.z, midafter.w);

        vec4 mb = projectionMatrix*midbefore;
        vec4 mbr = projectionMatrix*midbeforer;
        vec4 ma = projectionMatrix*midafter;
        vec4 mar = projectionMatrix*midafterr;
        mb /= mb.w;
        mbr /= mbr.w;
        ma /= ma.w;
        mar /= mar.w;
        scale = abs((mbr.x-mb.x)/(mar.x-ma.x));
        rad *= scale;
        r = abs(rad);
    }
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }

    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       vec3 pnorm = normalize(p1);
       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
       mvPosition.xyz = p1+t*pnorm;
    } else {
       vec3 pnorm = normalize(p2);
       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
       mvPosition.xyz = p2+t*pnorm;
       mult *= -1.0;
    }

    if(outlineMaxPixels > 0.0) {
        vec4 cpos = mvPosition;
        vec4 unadjusted = projectionMatrix*vec4(cpos.x+abs(scale*radius), cpos.y,cpos.z,cpos.w); 
        vec4 ccoord = projectionMatrix*cpos;
        vec4 adjust = projectionMatrix*vec4(cpos.x+r,cpos.y,cpos.z,cpos.w); 
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        unadjusted.xyz -= ccoord.xyz/ccoord.w;
        adjust.xyz -= ccoord.xyz/ccoord.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth; //this should now be in pixels
        if(diff > outlineMaxPixels) {
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth; 
            vec4 pcoord = ccoord;
            pcoord.x += fixlen*pcoord.w;
            vec4 altc = projinv*pcoord;
            r= abs(altc.x-cpos.x);
        }
    }

    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;
    mvPosition.xy +=  mult*(cr + doublecr).xy;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vLight = vec3(1.0,1.0,1.0);
}

`}),"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new n.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0},projinv:{type:"mat4",value:[]}}}),"./src/WebGL/shaders/lib/volumetric/index.ts":((r,e,t)=>{t.r(e),t.d(e,{volumetric:()=>o});var n=t("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),i=t("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),s=t("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/volumetric/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}}),"./src/WebGL/shaders/lib/volumetric/volumetric.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
uniform highp sampler3D data;
uniform highp sampler2D colormap;
uniform highp sampler2D depthmap;


uniform mat4 textmat;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

uniform float step;
uniform float subsamples;
uniform float maxdepth;
uniform float transfermin;
uniform float transfermax;
in  vec4 mvPosition;
out vec4 color;
void main(void) {

   vec4 pos = mvPosition;
   bool seengood = false;
   float i = 0.0;
   color = vec4(1,1,1,0);
   float increment = 1.0/subsamples;
   float maxsteps = (maxdepth*subsamples/step);
//there's probably a better way to do this..
//calculate farthest possible point in model coordinates
   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);
// convert to projection
   maxpos = projectionMatrix*maxpos;
   vec4 startp = projectionMatrix*pos;
// homogonize
   maxpos /= maxpos.w;
   startp /= startp.w;
//take x,y from start and z from max
   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);
//convert back to model space
   maxpos = projinv*maxpos;
   maxpos /= maxpos.w;
   float incr = step/subsamples;
//get depth from depthmap
//startp is apparently [-1,1]
   vec2 tpos = startp.xy/2.0+0.5;
   float depth = texture(depthmap, tpos).r;
//compute vector between start and end
   vec4 direction = maxpos-pos;
   for( i = 0.0; i <= maxsteps; i++) {
      vec4 pt = (pos+(i/maxsteps)*direction);
      vec4 ppt = projectionMatrix*pt;
      float ptdepth = ppt.z/ppt.w;
      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
      if(ptdepth > depth) break;
      pt = textmat*pt;
//       pt /= pt.w;
      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {
         seengood = true;
      } else if(seengood) {
         break;
      }
      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){
          color.a = 0.0;
          continue;
      }
      else {
         float val = texture(data, pt.zyx).r;
         if(isinf(val)) continue; //masked out
         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range
         vec4 val_color = texture(colormap, vec2(cval,0.5));
         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;
         color.a += (1.0 - color.a) * val_color.a; 
         if(color.a > 0.0) color.rgb /= color.a;
//          color = vec4(pt.x, pt.y, pt.z, 1.0);
      }
//       color = vec4(pt.x, pt.y, pt.z, 0.0)
    }
}

        `}),"./src/WebGL/shaders/lib/volumetric/volumetric.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

in vec3 position;
out vec4 mvPosition;
void main() {

    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix*mvPosition;
}
`}),"./src/WebGL/shaders/utils/clone.ts":((r,e,t)=>{t.r(e),t.d(e,{clone:()=>i});var n=t("./src/colors.ts");function i(s){let o={};for(const l in s){o[l]={},o[l].type=s[l].type;var a=s[l].value;a instanceof n.Color?o[l].value=a.clone():typeof a=="number"?o[l].value=a:a instanceof Array?o[l].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return o}}),"./src/WebGL/shaders/utils/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ShaderUtils:()=>i,clone:()=>n.clone});var n=t("./src/WebGL/shaders/utils/clone.ts");const i={clone:n.clone}}),"./src/WebGL/shapes/Cylinder.ts":((r,e,t)=>{t.r(e),t.d(e,{Cylinder:()=>s});var n=t("./src/WebGL/math/index.ts");let i=new n.Vector3;class s{constructor(a=new n.Vector3,l=new n.Vector3,d=0){this.c1=a,this.c2=l,this.radius=d,this.direction=new n.Vector3().subVectors(this.c2,this.c1).normalize()}copy(a){return this.c1.copy(a.c1),this.c2.copy(a.c2),this.direction.copy(a.direction),this.radius=a.radius,this}lengthSq(){return i.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(a){return this.direction.add(this.c1).applyMatrix4(a),this.c1.applyMatrix4(a),this.c2.applyMatrix4(a),this.direction.sub(this.c1).normalize(),this.radius=this.radius*a.getMaxScaleOnAxis(),this}}}),"./src/WebGL/shapes/Sphere.ts":((r,e,t)=>{t.r(e),t.d(e,{Sphere:()=>i});var n=t("./src/WebGL/math/index.ts");class i{constructor(o={x:0,y:0,z:0},a=0){this.center=new n.Vector3(o.x,o.y,o.z),this.radius=a}set(o,a){return this.center.copy(o),this.radius=a,this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new i().copy(this)}}}),"./src/WebGL/shapes/Triangle.ts":((r,e,t)=>{t.r(e),t.d(e,{Triangle:()=>s});var n=t("./src/WebGL/math/index.ts");const i=new n.Vector3;class s{constructor(a=new n.Vector3,l=new n.Vector3,d=new n.Vector3){this.a=a,this.b=l,this.c=d}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}applyMatrix4(a){return this.a.applyMatrix4(a),this.b.applyMatrix4(a),this.c.applyMatrix4(a),this}getNormal(){var a=this.a.clone();return a.sub(this.b),i.subVectors(this.c,this.b),a.cross(i),a.normalize(),a}}}),"./src/WebGL/shapes/index.ts":((r,e,t)=>{t.r(e),t.d(e,{Cylinder:()=>i.Cylinder,Sphere:()=>n.Sphere,Triangle:()=>s.Triangle});var n=t("./src/WebGL/shapes/Sphere.ts"),i=t("./src/WebGL/shapes/Cylinder.ts"),s=t("./src/WebGL/shapes/Triangle.ts")}),"./src/autoload.ts":((r,e,t)=>{t.r(e),t.d(e,{autoinit:()=>a,autoload:()=>u,processing_autoinit:()=>l,viewers:()=>d});var n=t("./src/GLViewer.ts"),i=t("./src/ProteinSurface4.ts"),s=t("./src/utilities.ts"),o=t("./src/colors.ts"),a=!1,l=!1,d={};function u(g,x){var y,b,_;if(document.querySelector(".viewer_3Dmoljs")!=null&&(a=!0),a){l=!0,g=g??null;var h=0;document.querySelectorAll(".viewer_3Dmoljs").forEach(f=>{var E=[],m=[],S="";f.style.position=="static"&&(f.style.position="relative");var w=null;if(_=null,f.dataset.pdb)E.push("https://files.rcsb.org/view/"+f.dataset.pdb+".pdb"),m.push("pdb");else if(f.dataset.cid)m.push("sdf"),E.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+f.dataset.cid+"/SDF?record_type=3d");else if(f.dataset.href||f.dataset.url){if(f.dataset.href?S=f.dataset.href:S=f.dataset.url,E.push(S),_=S.substring(S.lastIndexOf(".")+1),_=="gz"){let ec=S.substring(0,S.lastIndexOf(".")).lastIndexOf(".");_=S.substring(ec+1)}m.push(_);var v=S.substring(S.lastIndexOf("/")+1,S.lastIndexOf("."));v=="/"&&(v=S.substring(S.lastIndexOf("/")+1)),f.dataset[m[m.length-1]]=v}let A=f.dataset;for(y in A)y.substring(0,3)==="pdb"&&y!=="pdb"?(E.push("https://files.rcsb.org/view/"+A[y]+".pdb"),m.push("pdb")):y.substring(0,4)==="href"&&y!=="href"?(S=A[y],E.push(S),m.push(S.substring(S.lastIndexOf(".")+1))):y.substring(0,3)==="cid"&&y!=="cid"&&(E.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+A[y]+"/SDF?record_type=3d"),m.push("sdf"));var M={};f.dataset.options&&(M=(0,s.specStringToObject)(f.dataset.options));var T=o.CC.color(f.dataset.backgroundcolor),R=f.dataset.backgroundalpha;R=R==null?1:parseFloat(R);var O={line:{}};f.dataset.style&&(O=(0,s.specStringToObject)(f.dataset.style));var L={};f.dataset.select&&(L=(0,s.specStringToObject)(f.dataset.select));var P=[],I=[],N=[],U={},F=null,k=f.dataset,j=/style(.+)/,H=/surface(.*)/,B=/labelres(.*)/,V=[];for(b in k)Object.prototype.hasOwnProperty.call(k,b)&&V.push(b);for(V.sort(),y=0;y<V.length;y++){b=V[y];var Y=j.exec(b),K,J,Te;Y&&(K="select"+Y[1],J=(0,s.specStringToObject)(k[K]),Te=(0,s.specStringToObject)(k[b]),P.push([J,Te])),Y=H.exec(b),Y&&(K="select"+Y[1],J=(0,s.specStringToObject)(k[K]),Te=(0,s.specStringToObject)(k[b]),I.push([J,Te])),Y=B.exec(b),Y&&(K="select"+Y[1],J=(0,s.specStringToObject)(k[K]),Te=(0,s.specStringToObject)(k[b]),N.push([J,Te])),b=="zoomto"&&(U=(0,s.specStringToObject)(k[b])),b=="spin"&&(F=(0,s.specStringToObject)(k[b]))}var He=function(ec){for(ec.setStyle(L,O),w&&w.createSelectionAndStyle(L,O),y=0;y<P.length;y++){let ai=P[y][0]||{},u0=P[y][1]||{line:{}};ec.setStyle(ai,u0),w&&w.createSelectionAndStyle(L,O)}for(y=0;y<I.length;y++){let ai=I[y][0]||{},u0=I[y][1]||{};w?ec.addSurface(i.SurfaceType.VDW,u0,ai,ai).then(E0=>{w.loadSurface("VDW",ai,u0,E0)}):ec.addSurface(i.SurfaceType.VDW,u0,ai,ai)}for(y=0;y<N.length;y++){let ai=N[y][0]||{},u0=N[y][1]||{};ec.addResLabels(ai,u0)}ec.render(),ec.zoomTo(U),F&&ec.spin(F.axis,F.speed)};let Q=g;try{var Xe=(0,s.specStringToObject)(f.dataset.config)||{};Xe.backgroundColor===void 0&&(Xe.backgroundColor=T),Xe.backgroundAlpha===void 0&&(Xe.backgroundAlpha=R),Q==null?Q=d[f.id||h++]=(0,n.createViewer)(f,Xe):(Q.setBackgroundColor(T,R),Q.setConfig(Xe),w&&w.initiateUI()),f.dataset.ui&&$3Dmol.StateManager&&(w=new $3Dmol.StateManager(Q))}catch(ec){console.log(ec),f.textContent="WebGL appears to be disabled."}if(E.length!=0){let ec=0,ai=((u0,o0)=>function(E0){S=E[ec];var F0=u0.dataset.type||u0.dataset.datatype||m[ec];if(o0.addModel(E0,F0,M),w){var g0=u0.dataset[m[ec]];w.setModelTitle(g0)}ec+=1,ec<E.length?(0,s.get)(E[ec]).then(ai):(He(o0),u0.dataset.callback&&(0,s.makeFunction)(u0.dataset.callback)(o0),l=!1,x&&x(o0))})(f,Q);_&&_.endsWith("gz")?(0,s.getbin)(E[0]).then(ai):(0,s.get)(E[0]).then(ai)}else{if(f.dataset.element){var ut="#"+f.dataset.element,Ji=document.querySelector(ut),er=Ji?Ji.textContent:"";_=f.dataset.type||f.dataset.datatype,Q.addModel(er,_,M)}He(Q),f.dataset.callback&&(0,s.makeFunction)(f.dataset.callback)(Q),l=!1,x&&x(Q)}})}}document.onreadystatechange=()=>{document.readyState==="complete"&&u()}}),"./src/colors.ts":((r,e,t)=>{t.r(e),t.d(e,{CC:()=>i,Color:()=>n,builtinColorSchemes:()=>g,chains:()=>u,elementColors:()=>l,htmlColors:()=>s,residues:()=>d,ssColors:()=>o});class n{constructor(y,b,_){return this.r=0,this.g=0,this.b=0,arguments.length>1&&typeof y=="number"?(this.r=y||0,this.g=b||0,this.b=_||0,this):this.set(y||0)}set(y){return y instanceof n?y.clone():(typeof y=="number"?this.setHex(y):typeof y=="object"&&(this.r=y?.r||0,this.g=y?.g||0,this.b=y?.b||0),this)}setHex(y){return y=Math.floor(y),this.r=(y>>16&255)/255,this.g=(y>>8&255)/255,this.b=(y&255)/255,this}getHex(){var y=Math.round(this.r*255),b=Math.round(this.g*255),_=Math.round(this.b*255);return y<<16|b<<8|_}clone(){return new n(this.r,this.g,this.b)}copy(y){return this.r=y.r,this.g=y.g,this.b=y.b,this}scaled(){var y={};return y.r=Math.round(this.r*255),y.g=Math.round(this.g*255),y.b=Math.round(this.b*255),y.a=1,y}}class i{static color(y){if(!y)return i.cache[0];if(y instanceof n)return y;if(typeof y=="number"&&typeof i.cache[y]<"u")return i.cache[y];if(y&&Array.isArray(y))return y.map(i.color);let b=i.getHex(y),_=new n(b);return i.cache[b]=_,_}static getHex(y){if(Array.isArray(y))return y.map(i.getHex);if(typeof y=="string"){let b=y;if(!isNaN(parseInt(b)))return parseInt(b);if(b=b.trim(),b.length==4&&b[0]=="#"&&(b="#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]),b.length==7&&b[0]=="#")return parseInt(b.substring(1),16);let _=i.rgbRegEx.exec(b);if(_){_[1]!=""&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let f=0;for(let E=2;E<5;E++){f*=256;let m=_[E].endsWith("%")?255*parseFloat(_[E])/100:parseFloat(_[E]);f+=Math.round(m)}return f}let h=s[b.toLowerCase()];return h!==void 0?h:(console.error("color not found",y.toLowerCase(),s),0)}return y}}i.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,i.cache={0:new n(0)};const s={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074,b:255,g:32768,r:16711680,c:49087,m:12517567,y:12566272,k:0,w:16777215},o={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}},a={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},l={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:a,defaultColors:Object.assign({},a),greenCarbon:Object.assign(Object.assign({},a),{C:65280}),cyanCarbon:Object.assign(Object.assign({},a),{C:65535}),magentaCarbon:Object.assign(Object.assign({},a),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},a),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},a),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},a),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},a),{C:8388736}),blueCarbon:Object.assign(Object.assign({},a),{C:255})},d={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},u={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},g={ssPyMol:{prop:"ss",map:o.pyMol},ssJmol:{prop:"ss",map:o.Jmol},Jmol:{prop:"elem",map:l.Jmol},amino:{prop:"resn",map:d.amino},shapely:{prop:"resn",map:d.shapely},nucleic:{prop:"resn",map:d.nucleic},chain:{prop:"chain",map:u.atom},rasmol:{prop:"elem",map:l.rasmol},default:{prop:"elem",map:l.defaultColors},greenCarbon:{prop:"elem",map:l.greenCarbon},chainHetatm:{prop:"chain",map:u.hetatm},cyanCarbon:{prop:"elem",map:l.cyanCarbon},magentaCarbon:{prop:"elem",map:l.magentaCarbon},purpleCarbon:{prop:"elem",map:l.purpleCarbon},whiteCarbon:{prop:"elem",map:l.whiteCarbon},orangeCarbon:{prop:"elem",map:l.orangeCarbon},yellowCarbon:{prop:"elem",map:l.yellowCarbon},blueCarbon:{prop:"elem",map:l.blueCarbon}}}),"./src/exporter.js":(r=>{typeof r.exports=="object"&&(r.exports=window.$3Dmol)}),"./src/glcartoon.ts":((r,e,t)=>{t.r(e),t.d(e,{drawCartoon:()=>L,subdivide_spline:()=>u});var n=t("./src/WebGL/math/index.ts"),i=t("./src/WebGL/shapes/index.ts"),s=t("./src/WebGL/index.ts"),o=t("./src/Gradient.ts"),a=t("./src/colors.ts"),l=t("./src/GLDraw.ts"),d=t("./src/utilities.ts");function u(P,I){var N=[],U=P;U=[],U.push(P[0]);var F,k,j,H,B,V,Y,K,J;for(F=1,k=P.length-1;F<k;F++)if(B=P[F],V=P[F+1],B.smoothen){var Te=new n.Vector3((B.x+V.x)/2,(B.y+V.y)/2,(B.z+V.z)/2);Te.atom=B.atom,U.push(Te)}else U.push(B);for(U.push(P[P.length-1]),F=-1,j=U.length;F<=j-3;F++)if(H=U[F===-1?0:F],B=U[F+1],V=U[F+2],Y=U[F===j-3?j-1:F+3],K=new n.Vector3().subVectors(V,H).multiplyScalar(.5),J=new n.Vector3().subVectors(Y,B).multiplyScalar(.5),!V.skip)for(var He=0;He<I;He++){var Q=1/I*He,Xe=B.x+Q*K.x+Q*Q*(-3*B.x+3*V.x-2*K.x-J.x)+Q*Q*Q*(2*B.x-2*V.x+K.x+J.x),ut=B.y+Q*K.y+Q*Q*(-3*B.y+3*V.y-2*K.y-J.y)+Q*Q*Q*(2*B.y-2*V.y+K.y+J.y),Ji=B.z+Q*K.z+Q*Q*(-3*B.z+3*V.z-2*K.z-J.z)+Q*Q*Q*(2*B.z-2*V.z+K.z+J.z),er=new n.Vector3(Xe,ut,Ji);He<I/2?er.atom=B.atom:er.atom=V.atom,N.push(er)}return N.push(U[U.length-1]),N}const g=.5,x=1.3,y=.8,b=.4,_=.4;function h(P,I,N,U){for(var F,k,j,H,B=0,V=I.length;B<V;B++){H=Math.round(B*(U.length-1)/V),j=a.CC.color(U[H]);var Y=P.updateGeoGroup(2),K=Y.vertexArray,J=Y.colorArray,Te=Y.faceArray;F=Y.vertices,k=F*3,K[k]=I[B].x,K[k+1]=I[B].y,K[k+2]=I[B].z,K[k+3]=N[B].x,K[k+4]=N[B].y,K[k+5]=N[B].z;for(var He=0;He<6;++He)J[k+3*He]=j.r,J[k+1+3*He]=j.g,J[k+2+3*He]=j.b;if(B>0){var Q=[F,F+1,F-1,F-2],Xe=Y.faceidx;Te[Xe]=Q[0],Te[Xe+1]=Q[1],Te[Xe+2]=Q[3],Te[Xe+3]=Q[1],Te[Xe+4]=Q[2],Te[Xe+5]=Q[3],Y.faceidx+=6}Y.vertices+=2}}function f(P,I,N,U,F,k,j){var H,B,V,Y;if(V=I.length,V<2||I[0].length<2)return;for(H=0;H<V;H++)I[H]=u(I[H],U);if(Y=I[0].length,!F)return h(P,I[0],I[V-1],N);var K,J,Te,He,Q,Xe,ut=[],Ji=[],er=[];for(B=0;B<V;B++)ut.push(.25+1.5*Math.sqrt((V-1)*B-Math.pow(B,2))/(V-1)),Ji.push(.5),er.push(2*(Math.pow(B/V,2)-B/V)+.6);var ec=[];for(B=0;B<V*2-1;B++)ec[B]=[B,B+1,B+1-2*V,B-2*V];ec[V*2-1]=[B,B+1-2*V,B+1-4*V,B-2*V];var ai,u0,o0,E0,F0,g0,w0,L0,T0,ht;let We=P.updateGeoGroup();for(H=0;H<Y;H++){let tt=P.groups,tr=!1;We=P.updateGeoGroup(2*V),tt!=P.groups&&H>0&&(H=H-1,tr=!0),g0=Math.round(H*(N.length-1)/Y),F0=a.CC.color(N[g0]),Q=Te,Xe=He,Te=[],He=[],K=[],I[0][H].atom!==void 0&&(E0=I[0][H].atom,j==="oval"?J=ut:j==="rectangle"?J=Ji:j==="parabola"&&(J=er)),J||(J=Ji);var h0,M0;for(B=0;B<V;B++)H<Y-1?h0=I[B][H+1].clone().sub(I[B][H]):h0=I[B][H-1].clone().sub(I[B][H]).negate(),B<V-1?M0=I[B+1][H].clone().sub(I[B][H]):M0=I[B-1][H].clone().sub(I[B][H]).negate(),K[B]=M0.cross(h0).normalize().multiplyScalar(F*J[B]);for(B=0;B<V;B++)Te[B]=I[B][H].clone().add(K[B].clone().negate());for(B=0;B<V;B++)He[B]=I[B][H].clone().add(K[B]);for(w0=We.vertexArray,L0=We.colorArray,T0=We.faceArray,ai=We.vertices,u0=ai*3,B=0;B<V;B++)w0[u0+3*B+0]=Te[B].x,w0[u0+3*B+1]=Te[B].y,w0[u0+3*B+2]=Te[B].z;for(B=0;B<V;B++)w0[u0+3*B+0+3*V]=He[V-1-B].x,w0[u0+3*B+1+3*V]=He[V-1-B].y,w0[u0+3*B+2+3*V]=He[V-1-B].z;for(B=0;B<2*V;++B)L0[u0+3*B+0]=F0.r,L0[u0+3*B+1]=F0.g,L0[u0+3*B+2]=F0.b;if(H>0&&!tr){for(B=0;B<V*2;B++)ht=[ai+ec[B][0],ai+ec[B][1],ai+ec[B][2],ai+ec[B][3]],o0=We.faceidx,T0[o0]=ht[0],T0[o0+1]=ht[1],T0[o0+2]=ht[3],T0[o0+3]=ht[1],T0[o0+4]=ht[2],T0[o0+5]=ht[3],We.faceidx+=6;if(E0.clickable||E0.hoverable){var Z=[];Z.push(new i.Triangle(Q[0],Te[0],Te[V-1])),Z.push(new i.Triangle(Q[0],Te[V-1],Q[V-1])),Z.push(new i.Triangle(Q[V-1],Te[V-1],He[V-1])),Z.push(new i.Triangle(Q[V-1],He[V-1],Xe[V-1])),Z.push(new i.Triangle(He[0],Xe[0],Xe[V-1])),Z.push(new i.Triangle(He[V-1],He[0],Xe[V-1])),Z.push(new i.Triangle(Te[0],Q[0],Xe[0])),Z.push(new i.Triangle(He[0],Te[0],Xe[0]));for(B in Z)E0.intersectionShape.triangle.push(Z[B])}}We.vertices+=2*V}for(w0=We.vertexArray,L0=We.colorArray,T0=We.faceArray,ai=We.vertices,u0=ai*3,o0=We.faceidx,H=0;H<V-1;H++)ht=[H,H+1,2*V-2-H,2*V-1-H],o0=We.faceidx,T0[o0]=ht[0],T0[o0+1]=ht[1],T0[o0+2]=ht[3],T0[o0+3]=ht[1],T0[o0+4]=ht[2],T0[o0+5]=ht[3],We.faceidx+=6;for(H=0;H<V-1;H++)ht=[ai-1-H,ai-2-H,ai-2*V+H+1,ai-2*V+H],o0=We.faceidx,T0[o0]=ht[0],T0[o0+1]=ht[1],T0[o0+2]=ht[3],T0[o0+3]=ht[1],T0[o0+4]=ht[2],T0[o0+5]=ht[3],We.faceidx+=6}function E(P,I,N,U,F,k){if(!(I.length<2)){var j,H;if(j=I[0],H=I[I.length-1],j=u(j,U),H=u(H,U),!F)return h(P,j,H,N);var B=[],V,Y,K,J,Te,He=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],Q,Xe,ut,Ji,er,ec,ai,u0,o0,E0,F0,g0,w0,L0,T0,ht,We;for(u0=0,o0=j.length;u0<o0;u0++){if(er=Math.round(u0*(N.length-1)/o0),Ji=a.CC.color(N[er]),B.push(Y=j[u0]),B.push(Y),B.push(K=H[u0]),B.push(K),u0<o0-1){var h0=j[u0+1].clone().sub(j[u0]),M0=H[u0].clone().sub(j[u0]);V=M0.cross(h0).normalize().multiplyScalar(F)}for(B.push(J=j[u0].clone().add(V)),B.push(J),B.push(Te=H[u0].clone().add(V)),B.push(Te),Y.atom!==void 0&&(ec=Y.atom),L0=P.updateGeoGroup(8),T0=L0.vertexArray,ht=L0.colorArray,We=L0.faceArray,Q=L0.vertices,Xe=Q*3,T0[Xe]=Y.x,T0[Xe+1]=Y.y,T0[Xe+2]=Y.z,T0[Xe+3]=Y.x,T0[Xe+4]=Y.y,T0[Xe+5]=Y.z,T0[Xe+6]=K.x,T0[Xe+7]=K.y,T0[Xe+8]=K.z,T0[Xe+9]=K.x,T0[Xe+10]=K.y,T0[Xe+11]=K.z,T0[Xe+12]=J.x,T0[Xe+13]=J.y,T0[Xe+14]=J.z,T0[Xe+15]=J.x,T0[Xe+16]=J.y,T0[Xe+17]=J.z,T0[Xe+18]=Te.x,T0[Xe+19]=Te.y,T0[Xe+20]=Te.z,T0[Xe+21]=Te.x,T0[Xe+22]=Te.y,T0[Xe+23]=Te.z,E0=0;E0<8;++E0)ht[Xe+3*E0]=Ji.r,ht[Xe+1+3*E0]=Ji.g,ht[Xe+2+3*E0]=Ji.b;if(u0>0){var Z=ai!==void 0&&ec!==void 0&&ai.serial!==ec.serial;for(E0=0;E0<4;E0++){var tt=[Q+He[E0][0],Q+He[E0][1],Q+He[E0][2],Q+He[E0][3]];if(ut=L0.faceidx,We[ut]=tt[0],We[ut+1]=tt[1],We[ut+2]=tt[3],We[ut+3]=tt[1],We[ut+4]=tt[2],We[ut+5]=tt[3],L0.faceidx+=6,ec.clickable||ai.clickable||ec.hoverable||ai.hoverable){var tr=B[tt[3]].clone(),s0=B[tt[0]].clone(),c0=B[tt[2]].clone(),A0=B[tt[1]].clone();if(tr.atom=B[tt[3]].atom||null,c0.atom=B[tt[2]].atom||null,s0.atom=B[tt[0]].atom||null,A0.atom=B[tt[1]].atom||null,Z){var P0=tr.clone().add(s0).multiplyScalar(.5),Fe=c0.clone().add(A0).multiplyScalar(.5),f0=tr.clone().add(A0).multiplyScalar(.5);E0%2===0?((ai.clickable||ai.hoverable)&&(F0=new i.Triangle(P0,f0,tr),g0=new i.Triangle(Fe,c0,f0),w0=new i.Triangle(f0,c0,tr),ai.intersectionShape.triangle.push(F0),ai.intersectionShape.triangle.push(g0),ai.intersectionShape.triangle.push(w0)),(ec.clickable||ec.hoverable)&&(F0=new i.Triangle(s0,A0,f0),g0=new i.Triangle(A0,Fe,f0),w0=new i.Triangle(s0,f0,P0),ec.intersectionShape.triangle.push(F0),ec.intersectionShape.triangle.push(g0),ec.intersectionShape.triangle.push(w0))):((ec.clickable||ec.hoverable)&&(F0=new i.Triangle(P0,f0,tr),g0=new i.Triangle(Fe,c0,f0),w0=new i.Triangle(f0,c0,tr),ec.intersectionShape.triangle.push(F0),ec.intersectionShape.triangle.push(g0),ec.intersectionShape.triangle.push(w0)),(ai.clickable||ai.hoverable)&&(F0=new i.Triangle(s0,A0,f0),g0=new i.Triangle(A0,Fe,f0),w0=new i.Triangle(s0,f0,P0),ai.intersectionShape.triangle.push(F0),ai.intersectionShape.triangle.push(g0),ai.intersectionShape.triangle.push(w0)))}else(ec.clickable||ec.hoverable)&&(F0=new i.Triangle(s0,A0,tr),g0=new i.Triangle(A0,c0,tr),ec.intersectionShape.triangle.push(F0),ec.intersectionShape.triangle.push(g0))}}}L0.vertices+=8,ai=ec}var v0=B.length-8;for(L0=P.updateGeoGroup(8),T0=L0.vertexArray,ht=L0.colorArray,We=L0.faceArray,Q=L0.vertices,Xe=Q*3,ut=L0.faceidx,u0=0;u0<4;u0++){B.push(B[u0*2]),B.push(B[v0+u0*2]);var D0=B[u0*2],l0=B[v0+u0*2];T0[Xe+6*u0]=D0.x,T0[Xe+1+6*u0]=D0.y,T0[Xe+2+6*u0]=D0.z,T0[Xe+3+6*u0]=l0.x,T0[Xe+4+6*u0]=l0.y,T0[Xe+5+6*u0]=l0.z,ht[Xe+6*u0]=Ji.r,ht[Xe+1+6*u0]=Ji.g,ht[Xe+2+6*u0]=Ji.b,ht[Xe+3+6*u0]=Ji.r,ht[Xe+4+6*u0]=Ji.g,ht[Xe+5+6*u0]=Ji.b}v0+=8,F0=[Q,Q+2,Q+6,Q+4],g0=[Q+1,Q+5,Q+7,Q+3],We[ut]=F0[0],We[ut+1]=F0[1],We[ut+2]=F0[3],We[ut+3]=F0[1],We[ut+4]=F0[2],We[ut+5]=F0[3],We[ut+6]=g0[0],We[ut+7]=g0[1],We[ut+8]=g0[3],We[ut+9]=g0[1],We[ut+10]=g0[2],We[ut+11]=g0[3],L0.faceidx+=12,L0.vertices+=8}}function m(P,I,N,U,F,k,j){(!j||j==="default")&&(j="rectangle"),j==="edged"?E(P,I,N,U,F):(j==="rectangle"||j==="oval"||j==="parabola")&&f(P,I,N,U,F,k,j)}function S(P){return P&&P.elem==="C"&&P.atom==="CA"}function w(P,I){if(P&&I&&P.chain===I.chain){if(!P.hetflag&&!I.hetflag&&P.reschain===I.reschain&&(P.resi===I.resi||P.resi===I.resi-1))return!0;if(P.resi<I.resi){var N=P.x-I.x,U=P.y-I.y,F=P.z-I.z,k=N*N+U*U+F*F;if(P.atom=="CA"&&I.atom=="CA"&&k<16)return!0;if((P.atom=="P"||I.atom=="P")&&k<64)return!0}}return!1}function v(P,I,N,U,F){if(!(I==null||I.vertices==0)){F&&(I.initTypedArrays(),I.setUpNormals());var k=new s.MeshDoubleLambertMaterial;k.vertexColors=s.Coloring.FaceColors,typeof N=="number"&&N>=0&&N<1&&(k.transparent=!0,k.opacity=N),k.outline=U;var j=new s.Mesh(I,k);P.add(j)}}function A(P,I,N,U,F,k,j,H,B){var V,Y,K,J,Te,He;if(!(!U||!F||!j)){var Q=F.sub(U);Q.normalize();var Xe=H[B];for(Y=B+1;Y<H.length&&(Xe=H[Y],Xe.atom!=j.atom);Y++);if(Xe=Xe?new n.Vector3(Xe.x,Xe.y,Xe.z):new n.Vector3(0,0,0),Xe.sub(U),j.ss==="arrow start"){var ut=Xe.clone().multiplyScalar(.3).cross(F);U.add(ut);var Ji=Xe.clone().cross(Q).normalize();Q.rotateAboutVector(Ji,.43)}for(j.style.cartoon.ribbon?V=j.style.cartoon.thickness||b:j.style.cartoon.width?V=j.style.cartoon.width:j.ss==="c"?j.atom==="P"?V=y:V=g:j.ss==="arrow start"?(V=x,Te=!0):j.ss==="arrow end"||j.ss==="h"&&j.style.cartoon.tubes||j.ss==="tube start"?V=g:V=x,k!=null&&Q.dot(k)<0&&Q.negate(),Q.multiplyScalar(V),Y=0;Y<I;Y++)K=-1+Y*2/(I-1),J=new n.Vector3(U.x+K*Q.x,U.y+K*Q.y,U.z+K*Q.z),J.atom=j,j.ss==="s"&&(J.smoothen=!0),P[Y].push(J);if(Te)for(Q.multiplyScalar(2),Y=0;Y<I;Y++)K=-1+Y*2/(I-1),J=new n.Vector3(U.x+K*Q.x,U.y+K*Q.y,U.z+K*Q.z),J.atom=j,J.smoothen=!1,J.skip=!0,P[Y].push(J);return He=j.style.cartoon.style||"default",P.style?P.style!=He&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),P.style="default"):P.style=He,(j.ss==="arrow start"||j.ss==="arrow end")&&(j.ss="s"),Te}}const M={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},T={DA:!0,DG:!0,A:!0,G:!0},R={DT:!0,DC:!0,U:!0,C:!0,T:!0},O={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0};function L(P,I,N,U=10){let F=U,k=U;var j,H,B,V,Y,K,J,Te,He,Q,Xe,ut,Ji,er,ec,ai,u0,o0,E0=new s.Geometry(!0),F0=new s.Geometry(!0),g0=[],w0=[],L0=1,T0=!1,ht={};for(var We in o.Gradient.builtinGradients)o.Gradient.builtinGradients.hasOwnProperty(We)&&(ht[We]=new o.Gradient.builtinGradients[We](N[1],N[0]));var h0=function(b0,W){return N&&W.color==="spectrum"?W.colorscheme in ht?ht[W.colorscheme].valueToHex(b0.resi):ht.sinebow.valueToHex(b0.resi):(0,d.getColorFromStyle)(b0,W).getHex()};for(Te=0;Te<F;Te++)w0[Te]=[];var M0=!1,Z=!1,tt=[];for(Te in I){if(V=I[Te],V.elem==="C"&&V.atom==="CA"){var tr=w(B,V);tr&&V.ss==="s"?M0=!0:M0&&(B&&H&&B.style.cartoon.arrows&&H.style.cartoon.arrows&&(B.ss="arrow end",H.ss="arrow start"),M0=!1),tr&&(B.ss==="h"||B.ss=="tube start")&&B.style.cartoon.tubes?!Z&&B.ss!="tube start"&&V.style.cartoon.tubes&&(V.ss="tube start",Z=!0):Z&&(B.ss==="tube start"?B.ss="tube end":H&&H.style.cartoon.tubes&&(H.ss="tube end"),Z=!1),H=B,B=V}V&&V.atom in M&&tt.push(V)}Z&&B.style.cartoon.tubes&&(B.ss="tube end",Z=!1);var s0=function(b0){w0[0].length>0&&m(F0,w0,g0,k,J,L0,w0.style);var W=[],e0=null;if(b0){for(Te=0;Te<F;Te++)W[Te]=w0[Te][w0[Te].length-1];e0=g0[g0.length-1]}for(w0=[],Te=0;Te<F;Te++)w0[Te]=[];if(g0=[],b0){for(Te=0;Te<F;Te++)w0[Te].push(W[Te]);g0.push(e0)}v(P,F0,L0,T0,!0),v(P,E0,L0,T0,!1),F0=new s.Geometry(!0),E0=new s.Geometry(!0)};B=void 0;let c0=[];for(var A0=0;A0<tt.length;A0++){V=tt[A0];var P0=V.resn.trim(),Fe=P0 in O;if(L0=1,j=V.style.cartoon,B&&B.style.cartoon&&(L0=B.style.cartoon.opacity),B&&B.style.cartoon&&B.style.cartoon.outline&&(T0=B.style.cartoon.outline),B&&B.style.cartoon&&(!V.style.cartoon||B.style.cartoon.opacity!=V.style.cartoon.opacity)&&s0(B.chain==V.chain),B&&V&&!w(B,V)&&B.chain&&B.chain==V.chain&&!B.hetflag&&!V.hetflag&&B.reschain+1==V.reschain&&c0.push([B,V]),j.style==="trace"){if(!V.hetflag){if(V.elem==="C"&&V.atom==="CA"||Fe&&V.atom==="P"||V.atom==="BB"){if(K=h0(V,j),(0,d.isNumeric)(j.thickness)?J=j.thickness:J=b,w(B,V))if(K==Y){var f0=a.CC.color(K);l.GLDraw.drawCylinder(E0,B,V,J,f0,2,2)}else{var v0=new n.Vector3().addVectors(B,V).multiplyScalar(.5),D0=a.CC.color(Y),l0=a.CC.color(K);l.GLDraw.drawCylinder(E0,B,v0,J,D0,2,0),l.GLDraw.drawCylinder(E0,v0,V,J,l0,0,2)}if((V.clickable===!0||V.hoverable)&&V.intersectionShape!==void 0){var y0=new n.Vector3(V.x,V.y,V.z);V.intersectionShape.sphere.push(new i.Sphere(y0,J))}B=V,Y=K}}}else{if(S(V)||Fe&&(V.atom==="P"||V.atom.indexOf("O5")==0)){if(o0)if(V.ss==="tube end")o0=!1,u0=new n.Vector3(V.x,V.y,V.z),l.GLDraw.drawCylinder(E0,ai,u0,2,a.CC.color(Y),1,1),V.ss="h";else if(B.chain!=V.chain||B.ss==="tube end")o0=!1,B.ss="h",u0=new n.Vector3(B.x,B.y,B.z),l.GLDraw.drawCylinder(E0,ai,u0,2,a.CC.color(Y),1,1);else continue;if(B&&(!w(B,V)||B.ss==="tube start")){for(B.ss==="tube start"&&(o0=!0,ai=new n.Vector3(B.x,B.y,B.z),B.ss="h"),ec&&(ut?er=new n.Vector3().addVectors(B,ut).multiplyScalar(.5):er=new n.Vector3(B.x,B.y,B.z),l.GLDraw.drawCylinder(E0,er,ec,_,a.CC.color(ec.color),0,2),A(w0,F,!0,ut,Ji,Xe,B,tt,A0),g0.push(K),er=null,ec=null),w0[0].length>0&&m(F0,w0,g0,k,J,L0,w0.style),w0=[],Te=0;Te<F;Te++)w0[Te]=[];g0=[]}if(B===void 0||B.rescode!=V.rescode||B.resi!=V.resi){if(ec&&B!=null){er=new n.Vector3().addVectors(B,V).multiplyScalar(.5);var lt=er.clone().sub(ec).multiplyScalar(.02);er.add(lt),l.GLDraw.drawCylinder(E0,er,ec,_,a.CC.color(ec.color),0,2),er=null,ec=null}K=h0(V,j),g0.push(K),(0,d.isNumeric)(j.thickness)?J=j.thickness:J=b,B=V,He=new n.Vector3(B.x,B.y,B.z),He.resi=B.resi,Y=K}(V.clickable===!0||V.hoverable===!0)&&(V.intersectionShape===void 0||V.intersectionShape.triangle===void 0)&&(V.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else B!=null&&(S(B)&&V.atom==="O"||Fe&&B.atom==="P"&&(V.atom==="OP2"||V.atom==="O2P")||Fe&&B.atom.indexOf("O5")==0&&V.atom.indexOf("C5")==0)?(Q=new n.Vector3(V.x,V.y,V.z),Q.resi=V.resi,(V.atom==="OP2"||V.atom==="O2P")&&(Ji=new n.Vector3(V.x,V.y,V.z))):Fe&&V.atom.indexOf("O3")==0?ut=new n.Vector3(V.x,V.y,V.z):(V.atom==="N1"&&P0 in T||V.atom==="N3"&&P0 in R)&&(ec=new n.Vector3(V.x,V.y,V.z),ec.color=(0,d.getColorFromStyle)(V,j).getHex());Q&&He&&Q.resi===He.resi&&(A(w0,F,!0,He,Q,Xe,B,tt,A0),Xe=Q,He=null,Q=null,g0.push(K))}}ec&&(ut?er=new n.Vector3().addVectors(B,ut).multiplyScalar(.5):er=new n.Vector3(B.x,B.y,B.z),l.GLDraw.drawCylinder(E0,er,ec,_,a.CC.color(ec.color),0,2),A(w0,F,!0,ut,Ji,Xe,B,tt,A0),g0.push(K)),s0(!1);var oi=function(b0,W){if(b0.style.cartoon.gapcutoff&&b0.style.cartoon.gapcutoff==W.style.cartoon.gapcutoff){let a0=b0.style.cartoon.gapcutoff,hi=W.resi-b0.resi;if(hi>0&&hi<a0){let p0=.25,O0=W.x-b0.x,q=W.y-b0.y,it=W.z-b0.z,at=Math.sqrt(O0*O0+q*q+it*it),t0=at/(2*hi),i0=new n.Vector3(b0.x,b0.y,b0.z),d0=at/t0,_0=new n.Vector3((W.x-b0.x)/d0,(W.y-b0.y)/d0,(W.z-b0.z)/d0);i0.add({x:_0.x/2,y:_0.y/2,z:_0.z/2});let S0=i0.clone().add(_0);_0.multiplyScalar(2);let $0=(0,d.extend)({},b0);for(var e0=0;e0<hi;e0++){$0.resi+=1;let K0=h0($0,$0.style.cartoon);l.GLDraw.drawCylinder(E0,i0,S0,p0,a.CC.color(K0),l.CAP.FLAT,l.CAP.FLAT),i0.add(_0),S0.add(_0)}s0(!1)}}};for(let b0 of c0)oi(b0[0],b0[1])}}),"./src/index.ts":((r,e,t)=>{t.r(e),t.d(e,{CAP:()=>n.CAP,CC:()=>n.CC,CONTEXTS_PER_VIEWPORT:()=>n.CONTEXTS_PER_VIEWPORT,Color:()=>n.Color,CustomLinear:()=>n.CustomLinear,Cylinder:()=>n.Cylinder,GLDraw:()=>n.GLDraw,GLModel:()=>n.GLModel,GLShape:()=>n.GLShape,GLViewer:()=>n.GLViewer,GLVolumetricRender:()=>n.GLVolumetricRender,Gradient:()=>n.Gradient,GradientType:()=>n.GradientType,Label:()=>n.Label,LabelCount:()=>n.LabelCount,MarchingCube:()=>n.MarchingCube,MarchingCubeInitializer:()=>n.MarchingCubeInitializer,Matrix3:()=>n.Matrix3,Matrix4:()=>n.Matrix4,Parsers:()=>n.Parsers,PausableTimer:()=>n.PausableTimer,PointGrid:()=>n.PointGrid,ProteinSurface:()=>n.ProteinSurface,Quaternion:()=>n.Quaternion,ROYGB:()=>n.ROYGB,RWB:()=>n.RWB,Ray:()=>n.Ray,Sinebow:()=>n.Sinebow,Sphere:()=>n.Sphere,SurfaceType:()=>n.SurfaceType,Triangle:()=>n.Triangle,Vector2:()=>n.Vector2,Vector3:()=>n.Vector3,VolumeData:()=>n.VolumeData,adjustVolumeStyle:()=>n.adjustVolumeStyle,applyPartialCharges:()=>n.applyPartialCharges,autoinit:()=>n.autoinit,autoload:()=>n.autoload,base64ToArray:()=>n.base64ToArray,bondLength:()=>n.bondLength,builtinColorSchemes:()=>n.builtinColorSchemes,builtinGradients:()=>n.builtinGradients,chains:()=>n.chains,clamp:()=>n.clamp,conversionMatrix3:()=>n.conversionMatrix3,createStereoViewer:()=>n.createStereoViewer,createViewer:()=>n.createViewer,createViewerGrid:()=>n.createViewerGrid,deepCopy:()=>n.deepCopy,degToRad:()=>n.degToRad,download:()=>n.download,drawCartoon:()=>n.drawCartoon,elementColors:()=>n.elementColors,extend:()=>n.extend,get:()=>n.get,getAtomProperty:()=>n.getAtomProperty,getColorFromStyle:()=>n.getColorFromStyle,getElement:()=>n.getElement,getExtent:()=>n.getExtent,getGradient:()=>n.getGradient,getPropertyRange:()=>n.getPropertyRange,getbin:()=>n.getbin,htmlColors:()=>n.htmlColors,inflateString:()=>n.inflateString,isEmptyObject:()=>n.isEmptyObject,isNumeric:()=>n.isNumeric,makeFunction:()=>n.makeFunction,mergeGeos:()=>n.mergeGeos,normalizeValue:()=>n.normalizeValue,partialCharges:()=>n.partialCharges,processing_autoinit:()=>n.processing_autoinit,residues:()=>n.residues,setBondLength:()=>n.setBondLength,setSyncSurface:()=>n.setSyncSurface,specStringToObject:()=>n.specStringToObject,splitMesh:()=>n.splitMesh,ssColors:()=>n.ssColors,subdivide_spline:()=>n.subdivide_spline,syncSurface:()=>n.syncSurface,viewers:()=>n.viewers});var n=t("./src/3Dmol.ts");window&&(window.$3Dmol=e)}),"./src/parsers/BCIF.ts":((r,e,t)=>{t.r(e),t.d(e,{BCIF:()=>b});var n=t("./src/utilities.ts"),i=t("./src/parsers/utils/computeSecondaryStructure.ts"),s=t("./src/parsers/utils/processSymmetries.ts"),o=t("./src/parsers/cifutils/category.ts"),a=t("./src/parsers/utils/assignPDBBonds.ts"),l=t("./src/WebGL/index.ts"),d=t("./src/parsers/utils/isEmpty.ts"),u=t("./src/vendor/mmtf.js");class g{constructor(h){if(this.C={},h){let f=h.getField("comp_id"),E=h.getField("atom_id_1"),m=h.getField("atom_id_2"),S=h.getField("value_order");for(let w=0;w<f.length;w++){let v=f[w],A=E[w],M=m[w],T=S[w],R=1;T=="doub"?R=2:T=="trip"&&(R=3),this.C[v]==null&&(this.C[v]={}),this.C[v][A]==null&&(this.C[v][A]={}),this.C[v][M]==null&&(this.C[v][M]={}),this.C[v][A][M]=R,this.C[v][M][A]=R}}}order(h,f,E){return this.C[h]!==void 0&&this.C[h][f]!==void 0&&this.C[h][f][E]!==void 0?this.C[h][f][E]:0}}class x{constructor(h){if(this.C=[],h){let f=h.getField("conn_type_id"),E=h.getField("ptnr1_label_asym_id"),m=h.getField("ptnr1_label_seq_id"),S=h.getField("ptnr1_label_comp_id"),w=h.getField("ptnr1_label_atom_id"),v=h.getField("ptnr2_label_asym_id"),A=h.getField("ptnr2_label_seq_id"),M=h.getField("ptnr2_label_comp_id"),T=h.getField("ptnr2_label_atom_id"),R=h.getField("pdbx_value_order");for(let O=0;O<f.length;O++)if(f[O]=="disulf"||f[O]=="covale"){let L=R?R[O]==""?1:parseInt(R[O]):1;this.C.push([[E[O],m[O],S[O],w[O]],[v[O],A[O],M[O],T[O]],L])}}}}class y{constructor(){this.R={}}add(h){this.R[h.lchain]==null&&(this.R[h.lchain]={}),this.R[h.lchain][h.lresi]==null&&(this.R[h.lchain][h.lresi]={}),this.R[h.lchain][h.lresi][h.lresn]==null&&(this.R[h.lchain][h.lresi][h.lresn]=[]),this.R[h.lchain][h.lresi][h.lresn].push(h),this.R[h.lchain][h.lresi][h.lresn][h.atom]=h}geta([h,f,E,m]){if(this.R[h]!==void 0&&this.R[h][f]!==void 0&&this.R[h][f][E]!==void 0)return this.R[h][f][E][m]}setBonds(h,f){for(let E in this.R)for(let m in this.R[E])for(let S in this.R[E][m]){let w=this.R[E][m][S];for(let v=0;v<w.length;v++)for(let A=v+1;A<w.length;A++){let M=w[v],T=w[A],R=h.order(S,M.atom,T.atom);M.altLoc!=T.altLoc&&M.altLoc!=""&&T.altLoc!=""&&(R=0),R>0&&(M.bonds.push(T.index),T.bonds.push(M.index),M.bondOrder.push(R),T.bondOrder.push(R))}}for(let E of f.C){let m=E[0],S=E[1],w=E[2],v=this.geta(m),A=this.geta(S);v!=null&&A!=null&&(v.bonds.push(A.index),A.bonds.push(v.index),v.bondOrder.push(w),A.bondOrder.push(w))}}}function b(_,h){var f=!h.keepH,E=h.altLoc?h.altLoc:"A",m=!h.noComputeSecondaryStructure;const S=!h.doAssembly,w=h.assignBonds===void 0?!0:h.assignBonds;if(typeof _=="string")try{_=(0,n.base64ToArray)(_)}catch{_=new TextEncoder().encode(_)}else _=new Uint8Array(_);var v=u.decodeMsgpack(_);v==31&&(_=(0,n.inflateString)(_,!1),v=u.decodeMsgpack(_));var A=[],M=A.modelData=[],T=v.dataBlocks.length;if(T==0)return A;h.multimodel||(T=1);for(let R=0;R<T;R++){let O=A.length;const L=[];M.push({symmetries:[]}),A.push([]);const P=v.dataBlocks[R],I=Object.create(null);for(const ht of P.categories)I[ht.name.substr(1)]=(0,o.Category)(ht);let N={},U=I.struct_conf;if(U){let ht=U.getField("conf_type_id"),We=U.getField("beg_label_asym_id"),h0=U.getField("beg_label_seq_id"),M0=U.getField("end_label_seq_id");for(let Z=0;Z<ht.length;Z++)if(ht[Z].startsWith("H")){let tt=We[Z],tr=h0[Z],s0=M0[Z];tt in N||(N[tt]={}),N[tt][tr]="h1";for(let c0=tr+1;c0<s0;c0++)N[tt][c0]="h";N[tt][s0]="h2"}}let F=I.struct_sheet_range;if(F){let ht=F.getField("id"),We=F.getField("beg_label_asym_id"),h0=F.getField("beg_label_seq_id"),M0=F.getField("end_label_seq_id");for(let Z=0;Z<ht.length;Z++){let tt=We[Z],tr=h0[Z],s0=M0[Z];tt in N||(N[tt]={}),N[tt][tr]="s1";for(let c0=tr+1;c0<s0;c0++)N[tt][c0]="s";N[tt][s0]="s2"}}let k=I.pdbx_struct_oper_list,j=k.getField("id");if(j&&!S){let ht=k.getField("matrix[1][1]"),We=k.getField("matrix[1][2]"),h0=k.getField("matrix[1][3]"),M0=k.getField("matrix[2][1]"),Z=k.getField("matrix[2][2]"),tt=k.getField("matrix[2][3]"),tr=k.getField("matrix[3][1]"),s0=k.getField("matrix[3][2]"),c0=k.getField("matrix[3][3]"),A0=k.getField("vector[1]"),P0=k.getField("vector[2]"),Fe=k.getField("vector[3]");for(let f0=0;f0<j.length;f0++){const v0=new l.Matrix4(ht[f0],We[f0],h0[f0],A0[f0],M0[f0],Z[f0],tt[f0],P0[f0],tr[f0],s0[f0],c0[f0],Fe[f0]);M[M.length-1].symmetries.push(v0)}}let H=new g(I.chem_comp_bond),B=new y,V=new x(I.struct_conn),Y=I.atom_site,K=Y.rowCount,J=Y.getField("group_PDB"),Te=Y.getField("Cartn_x"),He=Y.getField("Cartn_y"),Q=Y.getField("Cartn_z"),Xe=Y.getField("auth_asym_id"),ut=Y.getField("label_asym_id"),Ji=Y.getField("auth_seq_id"),er=Y.getField("label_seq_id"),ec=Y.getField("auth_comp_id"),ai=Y.getField("label_comp_id"),u0=Y.getField("auth_atom_id"),o0=Y.getField("label_atom_id"),E0=Y.getField("type_symbol"),F0=Y.getField("B_iso_or_equiv"),g0=Y.getField("id"),w0=Y.getField("label_alt_id"),L0=Y.getField("pdbx_PDB_model_num"),T0=L0?L0[0]:0;for(let ht=0;ht<K;ht++){if(J!==void 0&&J[ht]==="TER")continue;if(L0&&L0[ht]!=T0)if(T0=L0[ht],h.multimodel)h.onemol||(A.push([]),M.push(M[M.length-1]),T0=L0[ht],B.setBonds(H,V),B=new y);else break;const We={};We.x=Te[ht],We.y=He[ht],We.z=Q[ht],We.chain=Xe?Xe[ht]:ut?ut[ht]:void 0,We.lchain=ut?ut[ht]:void 0,We.resi=Ji?Ji[ht]:er?er[ht]:void 0,We.lresi=er?er[ht]:void 0,We.resn=ec?ec[ht].trim():ai?ai[ht].trim():void 0,We.lresn=ai?ai[ht].trim():void 0,We.atom=u0?u0[ht].replace(/"/gm,""):o0?o0[ht].replace(/"/gm,""):void 0,We.icode=w0?w0[ht]:void 0,We.altLoc=We.icode,We.hetflag=!J||J[ht]==="HETA"||J[ht]==="HETATM";let h0="X";E0&&(h0=E0[ht].replace(/\(?\+?\d+.*/,"")),We.elem=h0[0].toUpperCase()+h0.substring(1,2).toLowerCase(),F0&&(We.b=F0[ht]),!(f&&We.elem=="H")&&(We.altLoc!=""&&We.altLoc!=E&&E!="*"||(We.bonds=[],We.ss="c",We.serial=g0[ht],We.model=T0,We.bondOrder=[],We.properties={},We.index=A[A.length-1].length,L[We.serial]=[A.length,We.index],A[A.length-1].push(We),B.add(We)))}if(B.setBonds(H,V),!(0,d.isEmpty)(N))for(let ht=O;ht<A.length;ht++){let We=A[ht];for(let h0=0;h0<We.length;h0++){const M0=We[h0];if(M0!==void 0&&M0.lchain in N&&M0.lresi in N[M0.lchain]){const Z=N[M0.lchain][M0.lresi];M0.ss=Z[0],Z.length>1&&(Z[1]=="1"?M0.ssbegin=!0:Z[1]=="2"&&(M0.ssend=!0))}}}h.multimodel&&R<T-1&&(h.onemol||(A.push([]),M.push({symmetries:[]})))}for(let R=0;R<A.length;R++)w&&!(h.duplicateAssemblyAtoms&&!h.dontConnectDuplicatedAtoms)&&(0,a.assignPDBBonds)(A[R],h),m&&(0,i.computeSecondaryStructure)(A[R],h.hbondCutoff),(0,s.processSymmetries)(M[R].symmetries,A[R],h,M[R].cryst),h.duplicateAssemblyAtoms&&!h.dontConnectDuplicatedAtoms&&w&&(0,a.assignPDBBonds)(A[R],h);return A}}),"./src/parsers/CDJSON.ts":((r,e,t)=>{t.r(e),t.d(e,{CDJSON:()=>n});function n(i,s){var o=[[]];typeof i=="string"&&(i=JSON.parse(i));for(var a=i.m,l=a[0].a,d=a[0].b,u=a[0].s,g=s!==void 0&&s.parseStyle!==void 0?s.parseStyle:u!==void 0,x=o[o.length-1].length,y=0;y<l.length;y++){var b=l[y],_={};_.id=b.i,_.x=b.x,_.y=b.y,_.z=b.z||0,_.bonds=[],_.bondOrder=[];var h=b.l||"C";_.elem=h[0].toUpperCase()+h.substring(1).toLowerCase(),_.serial=o[o.length-1].length,g&&(_.style=u[b.s||0]),o[o.length-1].push(_)}for(let f=0;f<d.length;f++){let E=d[f],m=E.b+x,S=E.e+x,w=E.o||1,v=o[o.length-1][m],A=o[o.length-1][S];v.bonds.push(S),v.bondOrder.push(w),A.bonds.push(m),A.bondOrder.push(w)}return o}}),"./src/parsers/CIF.ts":((r,e,t)=>{t.r(e),t.d(e,{CIF:()=>l});var n=t("./src/parsers/utils/computeSecondaryStructure.ts"),i=t("./src/parsers/utils/processSymmetries.ts"),s=t("./src/WebGL/index.ts"),o=t("./src/parsers/utils/assignPDBBonds.ts");const a=function(d,u,g,x){return new s.Vector3(u,g,x).applyMatrix3(d)};function l(d,u={}){const g=[],x=!u.doAssembly,y=g.modelData=[],b=u.assignBonds===void 0?!0:u.assignBonds;function _(w,v){const A=[];let M=0,T=0;for(;T<w.length;){for(;w.substring(T,T+v.length)!==v&&T<w.length;)if(w[T]==="'"){for(T++;T<w.length&&w[T]!=="'";)T++;for(;w.substring(T,T+v.length)!==v&&T<w.length;)T++}else if(w[T]==='"'){for(T++;T<w.length&&w[T]!=='"';)T++;T++}else T++;A.push(w.substring(M,T)),M=T=T+v.length}return A}const h=d.split(/\r?\n|\r/),f=[];let E=!1;for(let w=0;w<h.length;w++){var m=h[w].split("#")[0];if(E?m[0]===";"&&(E=!1):m[0]===";"&&(E=!0),E||m!==""){if(!E&&(m=m.trim(),m[0]==="_")){const v=m.split(/\s/)[0].indexOf(".");if(v>-1){let A=m.split("");A[v]="_",m=A.join(""),m=m.substring(0,v)+"_"+m.substring(v+1)}}f.push(m)}}let S=0;for(;S<f.length;){for(;!f[S].startsWith("data_")||f[S]==="data_global";)S++;S++;const w={};for(;S<f.length&&!f[S].startsWith("data_");)if(f[S][0]===void 0)S++;else if(f[S][0]==="_"){const T=f[S].split(/\s/)[0].toLowerCase(),R=w[T]=w[T]||[],O=f[S].substring(f[S].indexOf(T)+T.length);if(O==="")if(S++,f[S][0]===";"){let L=f[S].substring(1);for(S++;f[S]!==";";)L=L+`
`+f[S],S++;R.push(L)}else R.push(f[S]);else R.push(O.trim());S++}else if(f[S].substring(0,5)==="loop_"){S++;const T=[];for(;f[S]===""||f[S][0]==="_";){if(f[S]!==""){let O=f[S].split(/\s/)[0].toLowerCase(),L=w[O]=w[O]||[];T.push(L)}S++}let R=0;for(;S<f.length&&f[S][0]!=="_"&&!f[S].startsWith("loop_")&&!f[S].startsWith("data_");){let O=_(f[S]," ");for(let L=0;L<O.length;L++)O[L]!==""&&(T[R].push(O[L]),R=(R+1)%T.length);S++}}else S++;y.push({symmetries:[]}),g.push([]);const v=w._atom_site_id!==void 0?w._atom_site_id.length:w._atom_site_label.length;let A;if(w._cell_length_a!==void 0){const T=parseFloat(w._cell_length_a),R=parseFloat(w._cell_length_b),O=parseFloat(w._cell_length_c),L=parseFloat(w._cell_angle_alpha)||90,P=parseFloat(w._cell_angle_beta)||90,I=parseFloat(w._cell_angle_gamma)||90;A=(0,s.conversionMatrix3)(T,R,O,L,P,I),y[y.length-1].cryst={a:T,b:R,c:O,alpha:L,beta:P,gamma:I}}for(let T=0;T<v;T++){if(w._atom_site_group_pdb!==void 0&&w._atom_site_group_pdb[T]==="TER")continue;const R={};if(w._atom_site_cartn_x!==void 0)R.x=parseFloat(w._atom_site_cartn_x[T]),R.y=parseFloat(w._atom_site_cartn_y[T]),R.z=parseFloat(w._atom_site_cartn_z[T]);else{const L=a(A,parseFloat(w._atom_site_fract_x[T]),parseFloat(w._atom_site_fract_y[T]),parseFloat(w._atom_site_fract_z[T]));R.x=L.x,R.y=L.y,R.z=L.z}R.chain=w._atom_site_auth_asym_id?w._atom_site_auth_asym_id[T]:w._atom_site_label_asym_id?w._atom_site_label_asym_id[T]:void 0,R.lchain=w._atom_site_label_asym_id?w._atom_site_label_asym_id[T]:void 0,R.resi=w._atom_site_auth_seq_id?parseInt(w._atom_site_auth_seq_id[T]):w._atom_site_label_seq_id?w._atom_site_label_seq_id[T]:void 0,R.resn=w._atom_site_auth_comp_id?w._atom_site_auth_comp_id[T].trim():w._atom_site_label_comp_id?w._atom_site_label_comp_id[T].trim():void 0,R.atom=w._atom_site_auth_atom_id?w._atom_site_auth_atom_id[T].replace(/"/gm,""):w._atom_site_label_atom_id?w._atom_site_label_atom_id[T].replace(/"/gm,""):void 0,R.hetflag=!w._atom_site_group_pdb||w._atom_site_group_pdb[T]==="HETA"||w._atom_site_group_pdb[T]==="HETATM",w._atom_site_b_iso_or_equiv&&(R.b=parseFloat(w._atom_site_b_iso_or_equiv[T]));let O="X";w._atom_site_type_symbol?O=w._atom_site_type_symbol[T].replace(/\(?\+?\d+.*/,""):w._atom_site_label&&(O=w._atom_site_label[T].split("_")[0].replace(/\(?\d+.*/,"")),R.elem=O[0].toUpperCase()+O.substring(1,2).toLowerCase(),R.bonds=[],R.ss="c",R.serial=T,R.bondOrder=[],R.properties={},g[g.length-1].push(R)}if(w._pdbx_struct_oper_list_id!==void 0&&!x)for(let T=0;T<w._pdbx_struct_oper_list_id.length;T++){const R=parseFloat(w["_pdbx_struct_oper_list_matrix[1][1]"][T]),O=parseFloat(w["_pdbx_struct_oper_list_matrix[1][2]"][T]),L=parseFloat(w["_pdbx_struct_oper_list_matrix[1][3]"][T]),P=parseFloat(w["_pdbx_struct_oper_list_vector[1]"][T]),I=parseFloat(w["_pdbx_struct_oper_list_matrix[2][1]"][T]),N=parseFloat(w["_pdbx_struct_oper_list_matrix[2][2]"][T]),U=parseFloat(w["_pdbx_struct_oper_list_matrix[2][3]"][T]),F=parseFloat(w["_pdbx_struct_oper_list_vector[2]"][T]),k=parseFloat(w["_pdbx_struct_oper_list_matrix[3][1]"][T]),j=parseFloat(w["_pdbx_struct_oper_list_matrix[3][2]"][T]),H=parseFloat(w["_pdbx_struct_oper_list_matrix[3][3]"][T]),B=parseFloat(w["_pdbx_struct_oper_list_vector[3]"][T]),V=new s.Matrix4(R,O,L,P,I,N,U,F,k,j,H,B);y[y.length-1].symmetries.push(V)}const M=function(T){const R=T.match("-");T=T.replace(/[-xyz]/g,"");const O=T.split("/");let L,P;return O[1]===void 0?P=1:P=parseInt(O[1]),O[0]===""?L=1:L=parseInt(O[0]),L/P*(R?-1:1)};if(w._symmetry_equiv_pos_as_xyz!==void 0&&!x)for(let T=0;T<w._symmetry_equiv_pos_as_xyz.length;T++){const O=w._symmetry_equiv_pos_as_xyz[T].replace(/["' ]/g,"").split(",").map(function(N){return N.replace(/-/g,"+-")});let L=new s.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let N=0;N<3;N++){const U=O[N].split("+");for(let F=0;F<U.length;F++){const k=U[F];if(k==="")continue;const j=M(k);k.match("x")?L.elements[N+0]=j:k.match("y")?L.elements[N+4]=j:k.match("z")?L.elements[N+8]=j:L.elements[N+12]=j}}const P=A.getMatrix4(),I=new s.Matrix4().getInverse(P,!0);L=new s.Matrix4().multiplyMatrices(L,I),L=new s.Matrix4().multiplyMatrices(P,L),y[y.length-1].symmetries.push(L)}}for(let w=0;w<g.length;w++)b&&!(u.duplicateAssemblyAtoms&&!u.dontConnectDuplicatedAtoms)&&(0,o.assignPDBBonds)(g[w],u),(0,n.computeSecondaryStructure)(g[w],u.hbondCutoff),(0,i.processSymmetries)(y[w].symmetries,g[w],u,y[w].cryst),u.duplicateAssemblyAtoms&&!u.dontConnectDuplicatedAtoms&&b&&(0,o.assignPDBBonds)(g[w],u);return g}}),"./src/parsers/CUBE.ts":((r,e,t)=>{t.r(e),t.d(e,{CUBE:()=>o});var n=t("./src/WebGL/index.ts"),i=t("./src/parsers/utils/assignBonds.ts"),s=t("./src/parsers/utils/anumToSymbol.ts");function o(a,l){l=l||{};const d=[[]];let u=a.split(/\r?\n/);const g=l.assignBonds===void 0?!0:l.assignBonds;if(u.length<6)return d;let x=u[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const y=Math.abs(parseFloat(x[0]));let b={origin:void 0,size:void 0,unit:void 0,matrix4:void 0,matrix:void 0};const _=b.origin=new n.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3]));x=u[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),x=u[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const h=x[0]>0?.529177:1;_.multiplyScalar(h);const f=Math.abs(x[0]),E=new n.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(h);x=u[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const m=Math.abs(x[0]),S=new n.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(h);x=u[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const w=Math.abs(x[0]),v=new n.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(h);if(b.size={x:f,y:m,z:w},b.unit=new n.Vector3(E.x,S.y,v.z),E.y!=0||E.z!=0||S.x!=0||S.z!=0||v.x!=0||v.y!=0){b.matrix4=new n.Matrix4(E.x,S.x,v.x,0,E.y,S.y,v.y,0,E.z,S.z,v.z,0,0,0,0,1);let P=new n.Matrix4().makeTranslation(_.x,_.y,_.z);b.matrix4=b.matrix4.multiplyMatrices(P,b.matrix4),b.matrix=b.matrix4.matrix3FromTopLeft(),b.origin=new n.Vector3(0,0,0),b.unit=new n.Vector3(1,1,1)}d.modelData=[{cryst:b}],u=u.splice(6,y);for(var A=d[d.length-1].length,M=A+u.length,T=A;T<M;++T){var R={};R.serial=T;var O=u[T-A],L=O.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");R.elem=s.anumToSymbol[L[0]],R.x=parseFloat(L[2])*h,R.y=parseFloat(L[3])*h,R.z=parseFloat(L[4])*h,R.hetflag=!0,R.bonds=[],R.bondOrder=[],R.properties={},d[d.length-1].push(R)}if(g)for(let P=0;P<d.length;P++)(0,i.assignBonds)(d[P],l);return d}}),"./src/parsers/GRO.ts":((r,e,t)=>{t.r(e),t.d(e,{GRO:()=>s});var n=t("./src/parsers/utils/assignPDBBonds.ts"),i=t("./src/parsers/utils/atomNameToElem.ts");function s(o,a){const l=[],d=o.split(/\r?\n|\r/);for(;d.length>0;){const u=parseInt(d[1]);if(d.length<3||isNaN(u)||u<=0||d.length<u+3)break;const x=[];l.push(x);let y=2;const b=x.length,_=b+u;for(let h=b;h<_;h++){const f=d[y++],E={};E.serial=h,E.atom=f.slice(10,15).trim(),E.elem=(0,i.atomNameToElem)(E.atom,!0),E.x=10*parseFloat(f.slice(20,28)),E.y=10*parseFloat(f.slice(28,36)),E.z=10*parseFloat(f.slice(36,44)),E.resi=parseInt(f.slice(0,5)),E.resn=f.slice(5,10).trim(),E.bonds=[],E.bondOrder=[],E.properties={},f.length>44&&(E.dx=10*parseFloat(f.slice(44,52)),E.dy=10*parseFloat(f.slice(52,60)),E.dz=10*parseFloat(f.slice(60,68))),x[h]=E}if(d.length<=y+3){const f=d[y++].trim().split(/\s+/);if(f.length===3){for(let E=0;E<3;E++)f[E]=(parseFloat(f[E])*10).toString();l.box=f}}d.splice(0,++y)}for(let u=0;u<l.length;u++)(0,n.assignPDBBonds)(l[u],a);return l}}),"./src/parsers/LAMMPSTRJ.ts":((r,e,t)=>{t.r(e),t.d(e,{LAMMPSTRJ:()=>s});var n=t("./src/parsers/utils/assignBonds.ts");const i={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"};function s(o,a){const l=[],d=o.split(/\r?\n|\r/);let u=0,g=0,x=0;for(;x<d.length-9;){for(var y=x;y<d.length;y++)if(d[y].match(/ITEM: NUMBER OF ATOMS/)&&(g=parseInt(d[y+1])),d[y].match(/ITEM: ATOMS/)){u=y+1;break}const b=d[u-1].replace("ITEM: ATOMS ","").split(" ");l.push([]);for(let _=u;_<u+g;_++){const h={},f={},E=d[_].split(" ");for(let m=0;m<E.length;m++){const S=i[b[m]];S!==void 0&&(S==="serial"?h[S]=parseInt(E[m]):S==="x"||S==="y"||S==="z"?h[S]=parseFloat(E[m]):S==="charge"||S==="radius"?f[S]=parseFloat(E[m]):h[S]=E[m]),h.properties=f,h.bonds=[],h.bondOrder=[]}l[l.length-1][_-u]=h}x=u+g-1}if(a.assignBonds)for(let b=0;b<l.length;b++)(0,n.assignBonds)(l[b],a);return l}}),"./src/parsers/MMTF.ts":((r,e,t)=>{t.r(e),t.d(e,{MMTFparser:()=>g});var n=t("./src/utilities.ts"),i=t("./src/WebGL/index.ts"),s=t("./src/parsers/utils/computeSecondaryStructure.ts"),o=t("./src/parsers/utils/processSymmetries.ts"),a=t("./src/vendor/mmtf.js"),l=function(x){return String.fromCharCode.apply(null,x).replace(/\0/g,"")},d=function(x){return x==0||x==2||x==4?"h":x==3?"s":"c"};let u=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);function g(x,y){var b=!y.keepH,_=y.altLoc?y.altLoc:"A",h=!!y.noSecondaryStructure,f=!y.noComputeSecondaryStructure,E=!y.doAssembly,m=y.assemblyIndex?y.assemblyIndex:0;typeof x=="string"?x=(0,n.base64ToArray)(x):x=new Uint8Array(x);var S=a.decode(x),w=[[]],v=w.modelData=[],A=0,M=0,T=0,R=S.secStructList,O=S.bFactorList,L=S.altLocList,P=S.occupancyList,I=S.bondAtomList,N=S.bondOrderList,U=S.numModels;if(U==0)return w;y.multimodel||(U=1);var F,k,j,H,B,V,Y=[];if(!E&&S.bioAssemblyList&&S.bioAssemblyList.length>0){var K=S.bioAssemblyList[m].transformList;for(F=0,V=K.length;F<V;F++){var J=new i.Matrix4(K[F].matrix);J.transpose(),Y.push(J)}}var Te=null;if(S.unitCell){var He=S.unitCell;Te={a:He[0],b:He[1],c:He[2],alpha:He[3],beta:He[4],gamma:He[5]}}let Q=[];S.entityList.forEach(a0=>{a0.chainIndexList.forEach(hi=>{Q[hi]=a0.type=="polymer"})});var Xe=0;for(B=0;B<U;B++){var ut=S.chainsPerModel[B],Ji=w[w.length-1],er=[];for(v.push({symmetries:Y,cryst:Te}),F=0;F<ut;++F){var ec=S.groupsPerChain[A],ai=l(S.chainIdList.subarray(A*4,A*4+4));S.chainNameList&&(ai=l(S.chainNameList.subarray(A*4,A*4+4)));var u0=M,o0="";for(k=0;k<ec;++k){var E0=S.groupList[S.groupTypeList[M]],F0=E0.atomNameList.length,g0=0,w0=!1,L0=!1;if(R){g0=R[M];var T0=d(g0);(M==0||T0!=o0)&&(w0=!0),o0=T0;var ht=M+1;(ht>=R.length||d(R[ht]!=T0))&&(L0=!0)}var We=S.groupIdList[M],h0=E0.groupName;let a0=E0.chemCompType;var M0=T;let hi=u.has(a0)||!Q[A];for(j=0;j<F0;++j){var Z=E0.elementList[j];if(b&&Z=="H"){T+=1;continue}var tt="";O&&(tt=O[T]);var tr="";L&&L[T]&&(tr=String.fromCharCode(L[T]));var s0="";if(P&&(s0=P[T]),tr!=""&&tr!=_&&_!="*"){T+=1;continue}var c0=S.atomIdList[T],A0=E0.atomNameList[j],P0=0;E0.atomChargeList&&(P0=E0.atomChargeList[j]);var Fe=S.xCoordList[T],f0=S.yCoordList[T],v0=S.zCoordList[T];er[T]=Ji.length,Ji.push({resn:h0,x:Fe,y:f0,z:v0,elem:Z,hetflag:hi,chain:ai,resi:We,icode:tr,rescode:We+(tr!=" "?"^"+tr:""),serial:c0,altLoc:tr,index:T,atom:A0,bonds:[],ss:d(g0),ssbegin:w0,ssend:L0,bondOrder:[],properties:{charge:P0,occupancy:s0},b:tt}),T+=1}var D0=E0.bondAtomList;for(j=0,H=E0.bondOrderList.length;j<H;++j){var l0=M0+D0[j*2],y0=M0+D0[j*2+1],lt=E0.bondOrderList[j],oi=er[l0],b0=er[y0],W=Ji[oi],e0=Ji[b0];W&&e0&&(W.bonds.push(b0),W.bondOrder.push(lt),e0.bonds.push(oi),e0.bondOrder.push(lt))}M+=1}for(M=u0,k=0;k<ec;++k)M+=1;A+=1}if(I)for(let a0=Xe,hi=I.length;a0<hi;a0+=2){let p0=I[a0],O0=I[a0+1],q=N?N[a0/2]:1;if(p0>=T){Xe=a0;break}let it=er[p0],at=er[O0],t0=Ji[it],i0=Ji[at];t0&&i0&&(t0.bonds.push(at),t0.bondOrder.push(q),i0.bonds.push(it),i0.bondOrder.push(q))}y.multimodel&&(y.onemol||w.push([]))}if(!E)for(let a0=0;a0<w.length;a0++)(0,o.processSymmetries)(v[a0].symmetries,w[a0],y,v[a0].cryst);return f&&!h&&(0,s.computeSecondaryStructure)(w,y.hbondCutoff),w}}),"./src/parsers/MOL2.ts":((r,e,t)=>{t.r(e),t.d(e,{MOL2:()=>i});let n={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"};function i(s,o){var a=[[]],l=!1;typeof o.keepH<"u"&&(l=!o.keepH);var d=s.search(/@<TRIPOS>MOLECULE/),u=s.search(/@<TRIPOS>ATOM/);if(d==-1||u==-1)return a;for(var g=s.substring(d).split(/\r?\n|\r/);g.length>0;){var x=[],y=g[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),b=parseInt(y[0]),_=0;y.length>1&&(_=parseInt(y[1]));var h=4,f;for(f=3;f<g.length;f++)if(g[f]=="@<TRIPOS>ATOM"){h=f+1;break}var E=a[a.length-1].length,m=E+b,S;for(f=E;f<m;f++){S=g[h++],y=S.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var w={},v=y[5];if(n[v]!==void 0?v=n[v]:(v=v.split(".")[0],v=v[0].toUpperCase()+v.substring(1).toLowerCase()),w.atom=y[1],w.elem=v,!(w.elem=="H"&&l)){var A=a[a.length-1].length,M=parseInt(y[0]);w.serial=M,w.x=parseFloat(y[2]),w.y=parseFloat(y[3]),w.z=parseFloat(y[4]),w.atom=y[5];var T=parseFloat(y[8]);w.index=A,w.bonds=[],w.bondOrder=[],w.properties={charge:T,partialCharge:T},x[M]=A,a[a.length-1].push(w)}}for(var R=!1;h<g.length;)if(g[h++]=="@<TRIPOS>BOND"){R=!0;break}if(R&&_)for(f=0;f<_;f++){S=g[h++],y=S.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var O=parseInt(y[1]),L=a[a.length-1][x[O]],P=parseInt(y[2]),I=a[a.length-1][x[P]],N=parseInt(y[3]);isNaN(N)&&(N=1),L!==void 0&&I!==void 0&&(L.bonds.push(x[P]),L.bondOrder.push(N),I.bonds.push(x[O]),I.bondOrder.push(N))}if(o.multimodel){o.onemol||a.push([]),g.splice(0,h),s=g.join(`
`);continue}else break}return a}}),"./src/parsers/PDB.ts":((r,e,t)=>{t.r(e),t.d(e,{PDB:()=>i});var n=t("./src/parsers/utils/getSinglePDB.ts");function i(s,o){o=o||{};var a=[],l={};a.modelData=[];for(var d=s.split(/\r?\n|\r/);d.length>0;){var u=(0,n.getSinglePDB)(d,o,l),g=u[0],x=u[1];if(d=u[2],g.length!=0){if(o.multimodel&&o.onemol&&a.length>0)for(var y=a[0].length,b=0;b<g.length;b++){var _=g[b];_.index=b;for(var h=0;h<_.bonds.length;h++)_.bonds[h]+=y;a[0].push(_)}else a.modelData.push(x),a.push(g);if(!o.multimodel)break}}return a}}),"./src/parsers/PQR.ts":((r,e,t)=>{t.r(e),t.d(e,{PQR:()=>s});var n=t("./src/parsers/utils/assignPDBBonds.ts"),i=t("./src/parsers/utils/computeSecondaryStructure.ts");function s(o,a){var l=[[]],d=!a.noSecondaryStructure;l.modelData=[{symmetries:[]}];var u=[],g=o.split(/\r?\n|\r/),x;for(let R=0;R<g.length;R++){x=g[R].replace(/^\s*/,"");var y=x.substring(0,6);if(y.indexOf("END")==0)if(a.multimodel){a.onemol||l.push([]);continue}else break;else if(y=="ATOM  "||y=="HETATM"){var b;let O=parseInt(x.substring(6,11)),L=x.substring(12,16).replace(/ /g,""),P=x.substring(17,20).trim(),I=x.substring(21,22),N=parseInt(x.substring(22,26));var _=x.substring(30).trim().split(/\s+/),h=parseFloat(_[0]),f=parseFloat(_[1]),E=parseFloat(_[2]),m=parseFloat(_[3]),S=parseFloat(_[4]),w=L[0];L.length>1&&L[1].toUpperCase()!=L[1]&&(w=L.substring(0,2)),x[0]=="H"?b=!0:b=!1,u[O]=l[l.length-1].length,l[l.length-1].push({resn:P,x:h,y:f,z:E,elem:w,hetflag:b,chain:I,resi:N,serial:O,atom:L,bonds:[],ss:"c",bondOrder:[],properties:{charge:m,partialCharge:m,radius:S},pdbline:x})}else if(y=="CONECT"){var v=parseInt(x.substring(6,11)),A=l[l.length-1][u[v]];for(let O=0;O<4;O++){var M=parseInt(x.substring([11,16,21,26][O],[11,16,21,26][O]+5)),T=l[l.length-1][u[M]];A!==void 0&&T!==void 0&&(A.bonds.push(u[M]),A.bondOrder.push(1))}}}for(let R=0;R<l.length;R++)(0,n.assignPDBBonds)(l[R],a),d&&(0,i.computeSecondaryStructure)(l[R],a.hbondCutoff);return l}}),"./src/parsers/PRMTOP.ts":((r,e,t)=>{t.r(e),t.d(e,{PRMTOP:()=>n});function n(i){var s=[],o,a=0,l=i.split(/\r?\n|\r/);if(l.length>0&&l[0].includes("VERSION")){var d=l.filter(function(E){return E.includes("POINTERS")||E.includes("ATOM_NAME")||E.includes("CHARGE")||E.includes("RADII")||E.includes("BONDS_INC_HYDROGEN")||E.includes("BONDS_WITHOUT_HYDROGEN")||E.includes("RESIDUE_LABEL")||E.includes("RESIDUE_POINTER")}),u=_("POINTERS");if(u==-1)return[];var g=h(u),x=parseInt(l[u+1].slice(0,g[1]));let f=parseInt(l[u+2].slice(g[1],g[0]+g[1]));if(isNaN(x)||x<=0)return[];if(u=_("ATOM_NAME"),u==-1)return[];g=h(u);var y=g[0];for(let E=0;E<x/g[0];E++){E==parseInt(x/g[0])&&(y=x%g[0]);for(let m=0;m<y;m++){let S={},w={charge:"",radii:""};S.serial=a,S.x=0,S.y=0,S.z=0,S.atom=l[u+1].slice(g[1]*m,g[1]*(m+1)).trim(),S.elem=l[u+1].slice(g[1]*m,g[1]*m+1).trim(),S.properties=w,S.bonds=[],S.bondOrder=[],S.index=s.length,s.push(S),a++}u++}if(u=_("CHARGE"),u!=-1){g=h(u),a=0,y=g[0];for(let E=0;E<x/g[0];E++){E==parseInt(x/g[0])&&(y=x%g[0]);for(let m=0;m<y;m++)s[a].properties.charge=parseFloat(l[u+1].slice(g[1]*m,g[1]*(m+1))),a++;u++}}u=_("RESIDUE_POINTER");var b=[];if(u!=-1){g=h(u),y=g[0],u+=1;for(let E=0;E<f/g[0];E++){E==parseInt(f/g[0])&&(y=f%g[0]);for(let m=0;m<y;m++)b.push(parseInt(l[u].slice(g[1]*m,g[1]*(m+1))));u++}if(u=_("RESIDUE_LABEL"),u!=-1){let E=[];g=h(u),y=g[0],u+=1;for(let v=0;v<f/g[0];v++){v==parseInt(f/g[0])&&(y=f%g[0]);for(let A=0;A<y;A++)E.push(l[u].slice(g[1]*A,g[1]*(A+1)).trim());u++}let m=0,S=0,w="";b.push(s.length+1);for(let v=0;v<s.length;v++)v+1>=b[m]&&(w=E[m],m+=1,S+=1),s[v].resi=S,s[v].resn=w}}if(u=_("RADII"),u!=-1){g=h(u),a=0,y=g[0];for(let E=0;E<x/g[0];E++){E==parseInt(x/g[0])&&(y=x%g[0]);for(let m=0;m<y;m++)s[a].properties.radii=parseFloat(l[u+1].slice(g[1]*m,g[1]*(m+1))),a++;u++}}if(u=_("BONDS_WITHOUT_HYDROGEN"),u!=-1)for(g=h(u),a=0,y=g[0],u=u+1;!l[u].match(/^%FLAG/);){l[u+1].match(/^%FLAG/)&&(y=x%g[0]);for(let E=0;E<y;E++)a%3==0?o=parseInt(l[u].slice(g[1]*E,g[1]*(E+1))/3):a%3==1&&(s[o].bonds.push(parseInt(l[u].slice(g[1]*E,g[1]*(E+1))/3)),s[o].bondOrder.push(1)),a++;u++}if(u=_("BONDS_INC_HYDROGEN"),u!=-1)for(g=h(u),a=0,y=g[0],u=u+1;!l[u].match(/^%FLAG/);){l[u+1].match(/^%FLAG/)&&(y=x%g[0]);for(let E=0;E<y;E++)a%3==0?o=parseInt(l[u].slice(g[1]*E,g[1]*(E+1))/3):a%3==1&&(s[o].bonds.push(parseInt(l[u].slice(g[1]*E,g[1]*(E+1))/3)),s[o].bonds.push(1)),a++;u++}}else return[];function _(f){var E=l.indexOf(d.filter(function(m){return m.includes(f)})[0]);if(Number.isInteger(E)&&E>0){for(;!l[E].includes("FORMAT");)E++;return E}else return-1}function h(f){var E=l[f].match(/\((\d*)\S*/),m=l[f].match(/[a-zA-Z](\d*)\)\s*/);return m==null&&(m=l[f].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[parseInt(E[1]),parseInt(m[1])]}return[s]}}),"./src/parsers/SDF.ts":((r,e,t)=>{t.r(e),t.d(e,{SDF:()=>s});var n=function(o,a){var l=[[]],d=!1;for(typeof a.keepH<"u"&&(d=!a.keepH);o.length>0&&!(o.length<4);){var u=parseInt(o[3].substring(0,3));if(isNaN(u)||u<=0)break;var g=parseInt(o[3].substring(3,6)),x=4;if(o.length<4+u+g)break;var y=[],b=l[l.length-1].length,_=b+u,h,f;for(h=b;h<_;h++,x++){f=o[x];var E={},m=f.substring(31,34).replace(/ /g,"");E.atom=E.elem=m[0].toUpperCase()+m.substring(1).toLowerCase(),(E.elem!=="H"||!d)&&(E.serial=h,y[h]=l[l.length-1].length,E.x=parseFloat(f.substring(0,10)),E.y=parseFloat(f.substring(10,20)),E.z=parseFloat(f.substring(20,30)),E.hetflag=!0,E.bonds=[],E.bondOrder=[],E.properties={},E.index=l[l.length-1].length,l[l.length-1].push(E))}for(h=0;h<g;h++,x++){f=o[x];var S=y[parseInt(f.substring(0,3))-1+b],w=y[parseInt(f.substring(3,6))-1+b],v=parseFloat(f.substring(6));typeof S<"u"&&typeof w<"u"&&(l[l.length-1][S].bonds.push(w),l[l.length-1][S].bondOrder.push(v),l[l.length-1][w].bonds.push(S),l[l.length-1][w].bondOrder.push(v))}if(a.multimodel){for(a.onemol||l.push([]);o[x]!=="$$$$"&&x<o.length;)x++;o.splice(0,++x)}else break}return l},i=function(o,a){var l=[[]],d=!1;for(typeof a.keepH<"u"&&(d=!a.keepH);o.length>0&&!(o.length<8||!o[4].startsWith("M  V30 BEGIN CTAB")||!o[5].startsWith("M  V30 COUNTS")||o[5].length<14);){var u=o[5].substring(13).match(/\S+/g);if(u.length<2)break;var g=parseInt(u[0]);if(isNaN(g)||g<=0)break;var x=parseInt(u[1]),y=7;if(o.length<8+g+x)break;var b=[],_=l[l.length-1].length,h=_+g,f,E;for(f=_;f<h;f++,y++){E=o[y];var m=E.substring(6).match(/\S+/g);if(m.length>4){var S={},w=m[1].replace(/ /g,"");S.atom=S.elem=w[0].toUpperCase()+w.substring(1).toLowerCase(),(S.elem!=="H"||!d)&&(S.serial=f,b[f]=l[l.length-1].length,S.x=parseFloat(m[2]),S.y=parseFloat(m[3]),S.z=parseFloat(m[4]),S.hetflag=!0,S.bonds=[],S.bondOrder=[],S.properties={},S.index=l[l.length-1].length,l[l.length-1].push(S))}}if(o[y]==="M  V30 END ATOM")y++;else break;if(x!==0&&o[y]==="M  V30 BEGIN BOND")y++;else break;for(f=0;f<x;f++,y++){E=o[y];var v=E.substring(6).match(/\S+/g);if(v.length>3){var A=b[parseInt(v[2])-1+_],M=b[parseInt(v[3])-1+_],T=parseFloat(v[1]);typeof A<"u"&&typeof M<"u"&&(l[l.length-1][A].bonds.push(M),l[l.length-1][A].bondOrder.push(T),l[l.length-1][M].bonds.push(A),l[l.length-1][M].bondOrder.push(T))}}if(a.multimodel){for(a.onemol||l.push([]);o[y]!=="$$$$"&&y<o.length;)y++;o.splice(0,++y)}else break}return l};function s(o,a){var l="V2000",d=o.split(/\r?\n|\r/);return d.length>3&&d[3].length>38&&(l=d[3].substring(34,39)),l==="V2000"?n(d,a):l==="V3000"?i(d,a):[[""]]}}),"./src/parsers/VASP.ts":((r,e,t)=>{t.r(e),t.d(e,{VASP:()=>s});var n=t("./src/WebGL/index.ts"),i=t("./src/parsers/utils/assignBonds.ts");function s(o,a={}){var l=[[]],d={};const u=a.assignBonds===void 0?!0:a.assignBonds;var g=o.replace(/^\s+/,"").split(/\r?\n/);if(g.length<3)return l;if(g[1].match(/\d+/))d.length=parseFloat(g[1]);else return console.log("Warning: second line of the vasp structure file must be a number"),l;if(d.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),l;d.xVec=new Float32Array(g[2].replace(/^\s+/,"").split(/\s+/)),d.yVec=new Float32Array(g[3].replace(/^\s+/,"").split(/\s+/)),d.zVec=new Float32Array(g[4].replace(/^\s+/,"").split(/\s+/));var x=new n.Matrix3(d.xVec[0],d.xVec[1],d.xVec[2],d.yVec[0],d.yVec[1],d.yVec[2],d.zVec[0],d.zVec[1],d.zVec[2]);x.multiplyScalar(d.length),l.modelData=[{symmetries:[],cryst:{matrix:x}}];var y=g[5].trim().split(/\s+/),b=new Int16Array(g[6].trim().split(/\s+/)),_=g[7].trim(),h=!1;if(_.match(/S/)&&(h=!0,_=g[8].trim()),_.toLowerCase()[0]=="c")_="cartesian";else if(_.toLowerCase()[0]=="d")_="direct";else return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),l;if(y.length!=b.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(y),console.log(b),l;h?g.splice(0,9):g.splice(0,8);for(var f=0,E=0,m=y.length;E<m;E++){for(var S=y[E],w=0,v=b[E];w<v;w++){var A=new Float32Array(g[f+w].trim().split(/\s+/)),M={};M.elem=S,_=="cartesian"?(M.x=d.length*A[0],M.y=d.length*A[1],M.z=d.length*A[2]):(M.x=d.length*(A[0]*d.xVec[0]+A[1]*d.yVec[0]+A[2]*d.zVec[0]),M.y=d.length*(A[0]*d.xVec[1]+A[1]*d.yVec[1]+A[2]*d.zVec[1]),M.z=d.length*(A[0]*d.xVec[2]+A[1]*d.yVec[2]+A[2]*d.zVec[2])),M.bonds=[],M.bondOrder=[],l[0].push(M)}f+=b[E]}if(u)for(let T=0;T<l.length;T++)(0,i.assignBonds)(l[T],a);return l}}),"./src/parsers/XYZ.ts":((r,e,t)=>{t.r(e),t.d(e,{XYZ:()=>s});var n=t("./src/WebGL/index.ts"),i=t("./src/parsers/utils/assignBonds.ts");function s(o,a){a=a||{};for(var l=[[]],d=a.assignBonds===void 0?!0:a.assignBonds,u=o.trimStart().split(/\r?\n|\r/);u.length>0&&!(u.length<3);){var g=parseInt(u[0]);if(isNaN(g)||g<=0||u.length<g+2)break;var x=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi,y=x.exec(u[1]);if(y!=null&&y.length>1){var b=new Float32Array(y[1].split(/\s+/)),_=new n.Matrix3(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);l.modelData=[{cryst:{matrix:_}}]}for(var h=2,f=l[l.length-1].length,E=f+g,m=f;m<E;m++){var S=u[h++],w=S.trim().split(/\s+/),v={};v.serial=m;var A=w[0];v.atom=v.elem=A[0].toUpperCase()+A.substring(1,2).toLowerCase(),v.x=parseFloat(w[1]),v.y=parseFloat(w[2]),v.z=parseFloat(w[3]),v.hetflag=!0,v.bonds=[],v.bondOrder=[],v.properties={},l[l.length-1][m]=v,w.length>=7&&(v.dx=parseFloat(w[4]),v.dy=parseFloat(w[5]),v.dz=parseFloat(w[6]))}if(a.multimodel)l.push([]),u.splice(0,h);else break}if(d)for(let T=0;T<l.length;T++)(0,i.assignBonds)(l[T],a);if(a.onemol){var M=l;l=[],l.push(M[0]);for(let T=1;T<M.length;T++){let R=l[0].length;for(let O=0;O<M[T].length;O++){let L=M[T][O];for(let P=0;P<L.bonds.length;P++)L.bonds[P]=L.bonds[P]+R;L.index=l[0].length,L.serial=l[0].length,l[0].push(L)}}}return l}}),"./src/parsers/cifutils/category.ts":((r,e,t)=>{t.r(e),t.d(e,{Category:()=>i});var n=t("./src/parsers/cifutils/decoder.ts");function i(s){const o=Object.create(null),a=Object.create(null);for(const l of s.columns)o[l.name]=l;return{rowCount:s.rowCount,name:s.name.substring(1),fieldNames:s.columns.map(l=>l.name),getField(l){const d=o[l];if(d)return a[l]||(a[l]=(0,n.decode)(d.data)),a[l]}}}}),"./src/parsers/cifutils/decoder.ts":((r,e,t)=>{t.r(e),t.d(e,{decode:()=>o});var n=t("./src/parsers/cifutils/encoding.ts");const i=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function s(R,O){const L=new ArrayBuffer(R.length),P=new Uint8Array(L);for(let I=0,N=R.length;I<N;I+=O)for(let U=0;U<O;U++)P[I+O-U-1]=R[I+U];return L}function o(R){let O=R.data;for(let L=R.encoding.length-1;L>=0;L--)O=a(O,R.encoding[L]);return O}function a(R,O){switch(O.kind){case"ByteArray":switch(O.type){case n.Encoding.IntDataType.Uint8:return R;case n.Encoding.IntDataType.Int8:return u(R);case n.Encoding.IntDataType.Int16:return x(R);case n.Encoding.IntDataType.Uint16:return y(R);case n.Encoding.IntDataType.Int32:return b(R);case n.Encoding.IntDataType.Uint32:return _(R);case n.Encoding.FloatDataType.Float32:return h(R);case n.Encoding.FloatDataType.Float64:return f(R);default:throw new Error("unreachable")}case"FixedPoint":return E(R,O);case"IntervalQuantization":return m(R,O);case"RunLength":return S(R,O);case"Delta":return w(R,O);case"IntegerPacking":return M(R,O);case"StringArray":return T(R,O)}}function l(R,O){switch(R){case n.Encoding.IntDataType.Int8:return new Int8Array(O);case n.Encoding.IntDataType.Int16:return new Int16Array(O);case n.Encoding.IntDataType.Int32:return new Int32Array(O);case n.Encoding.IntDataType.Uint8:return new Uint8Array(O);case n.Encoding.IntDataType.Uint16:return new Uint16Array(O);case n.Encoding.IntDataType.Uint32:return new Uint32Array(O);default:return new Int32Array(O)}}function d(R,O){switch(R){case n.Encoding.FloatDataType.Float32:return new Float32Array(O);case n.Encoding.FloatDataType.Float64:return new Float64Array(O);default:return new Float64Array(O)}}function u(R){return new Int8Array(R.buffer,R.byteOffset)}function g(R,O,L){return(R.byteOffset!=0||R.byteLength!=R.buffer.byteLength)&&(R=new Uint8Array(R)),i?new L(R.buffer):new L(s(R,O))}function x(R){return g(R,2,Int16Array)}function y(R){return g(R,2,Uint16Array)}function b(R){return g(R,4,Int32Array)}function _(R){return g(R,4,Uint32Array)}function h(R){return g(R,4,Float32Array)}function f(R){return g(R,8,Float64Array)}function E(R,O){const L=R.length,P=d(O.srcType,L),I=1/O.factor;for(let N=0;N<L;N++)P[N]=I*R[N];return P}function m(R,O){const L=R.length,P=d(O.srcType,L),I=(O.max-O.min)/(O.numSteps-1),N=O.min;for(let U=0;U<L;U++)P[U]=N+I*R[U];return P}function S(R,O){const L=l(O.srcType,O.srcSize);let P=0;for(let I=0,N=R.length;I<N;I+=2){const U=R[I],F=R[I+1];for(let k=0;k<F;++k)L[P++]=U}return L}function w(R,O){const L=R.length,P=l(O.srcType,L);if(!L)return R;P[0]=R[0]+(O.origin|0);for(let I=1;I<L;++I)P[I]=R[I]+P[I-1];return P}function v(R,O){const L=O.byteCount===1?127:32767,P=-L-1,I=R.length,N=new Int32Array(O.srcSize);let U=0,F=0;for(;U<I;){let k=0,j=R[U];for(;j===L||j===P;)k+=j,U++,j=R[U];k+=j,N[F]=k,U++,F++}return N}function A(R,O){const L=O.byteCount===1?255:65535,P=R.length,I=new Int32Array(O.srcSize);let N=0,U=0;for(;N<P;){let F=0,k=R[N];for(;k===L;)F+=k,N++,k=R[N];F+=k,I[U]=F,N++,U++}return I}function M(R,O){return R.length===O.srcSize?R:O.isUnsigned?A(R,O):v(R,O)}function T(R,O){const L=o({encoding:O.offsetEncoding,data:O.offsets}),P=o({encoding:O.dataEncoding,data:R}),I=O.stringData,N=new Array(L.length);N[0]="";for(let k=1,j=L.length;k<j;k++)N[k]=I.substring(L[k-1],L[k]);let U=0;const F=new Array(P.length);for(let k=0,j=P.length;k<j;k++)F[U++]=N[P[k]+1];return F}}),"./src/parsers/cifutils/encoding.ts":((r,e,t)=>{t.r(e),t.d(e,{Encoding:()=>i,VERSION:()=>n});const n="0.3.0";var i;(function(s){(function(l){l[l.Int8=1]="Int8",l[l.Int16=2]="Int16",l[l.Int32=3]="Int32",l[l.Uint8=4]="Uint8",l[l.Uint16=5]="Uint16",l[l.Uint32=6]="Uint32"})(s.IntDataType||(s.IntDataType={})),(function(l){l[l.Float32=32]="Float32",l[l.Float64=33]="Float64"})(s.FloatDataType||(s.FloatDataType={}));function o(l){let d;return l instanceof Int8Array?d=s.IntDataType.Int8:l instanceof Int16Array?d=s.IntDataType.Int16:l instanceof Int32Array?d=s.IntDataType.Int32:l instanceof Uint8Array?d=s.IntDataType.Uint8:l instanceof Uint16Array?d=s.IntDataType.Uint16:l instanceof Uint32Array?d=s.IntDataType.Uint32:l instanceof Float32Array?d=s.FloatDataType.Float32:l instanceof Float64Array?d=s.FloatDataType.Float64:d=s.IntDataType.Int32,d}s.getDataType=o;function a(l){if(l instanceof Int8Array||l instanceof Int16Array||l instanceof Int32Array)return!0;for(let d=0,u=l.length;d<u;d++)if(d<0)return!1;return!0}s.isSignedIntegerDataType=a})(i||(i={}))}),"./src/parsers/index.ts":((r,e,t)=>{t.r(e),t.d(e,{Parsers:()=>E,bondLength:()=>f.bondLength,setBondLength:()=>f.setBondLength});var n=t("./src/parsers/VASP.ts"),i=t("./src/parsers/CUBE.ts"),s=t("./src/parsers/XYZ.ts"),o=t("./src/parsers/SDF.ts"),a=t("./src/parsers/CDJSON.ts"),l=t("./src/parsers/CIF.ts"),d=t("./src/parsers/MOL2.ts"),u=t("./src/parsers/PDB.ts"),g=t("./src/parsers/PQR.ts"),x=t("./src/parsers/MMTF.ts"),y=t("./src/parsers/PRMTOP.ts"),b=t("./src/parsers/GRO.ts"),_=t("./src/parsers/LAMMPSTRJ.ts"),h=t("./src/parsers/BCIF.ts"),f=t("./src/parsers/utils/bondLength.ts");const E={vasp:n.VASP,VASP:n.VASP,cube:i.CUBE,CUBE:i.CUBE,xyz:s.XYZ,XYZ:s.XYZ,sdf:o.SDF,SDF:o.SDF,json:a.CDJSON,cdjson:a.CDJSON,CDJSON:a.CDJSON,mcif:l.CIF,cif:l.CIF,CIF:l.CIF,mol2:d.MOL2,MOL2:d.MOL2,pdb:u.PDB,PDB:u.PDB,pdbqt:u.PDB,PDBQT:u.PDB,pqr:g.PQR,PQR:g.PQR,mmtf:x.MMTFparser,MMTF:x.MMTFparser,prmtop:y.PRMTOP,PRMTOP:y.PRMTOP,gro:b.GRO,GRO:b.GRO,lammpstrj:_.LAMMPSTRJ,LAMMPSTRJ:_.LAMMPSTRJ,bcif:h.BCIF,BCIF:h.BCIF}}),"./src/parsers/utils/anumToSymbol.ts":((r,e,t)=>{t.r(e),t.d(e,{anumToSymbol:()=>n});const n={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}}),"./src/parsers/utils/areConnected.ts":((r,e,t)=>{t.r(e),t.d(e,{areConnected:()=>s});var n=t("./src/parsers/utils/bondLength.ts");const i=new Set(["Na","K","Ca","Mg","Mn","Sr"]);function s(o,a,l){if(l&&l.unboundCations&&(i.has(o.elem)||i.has(a.elem)))return!1;let d=(0,n.bondLength)(o.elem)+(0,n.bondLength)(a.elem);d+=.25,d*=d;let u=o.x-a.x;if(u*=u,u>d)return!1;let g=o.y-a.y;if(g*=g,g>d)return!1;let x=o.z-a.z;if(x*=x,x>d)return!1;const y=u+g+x;return!(isNaN(y)||y<.5||y>d||o.altLoc!==a.altLoc&&o.altLoc.trim()!==""&&a.altLoc.trim()!=="")}}),"./src/parsers/utils/assignBackboneHBonds.ts":((r,e,t)=>{t.r(e),t.d(e,{assignBackboneHBonds:()=>n});function n(i,s){const o=s||3.2,a=o*o,l=[];for(let d=0,u=i.length;d<u;d++){i[d].index=d;const g=i[d];!g.hetflag&&(g.atom==="N"||g.atom==="O")&&(l.push(g),g.hbondOther=null,g.hbondDistanceSq=Number.POSITIVE_INFINITY)}l.sort(function(d,u){return d.z-u.z});for(let d=0,u=l.length;d<u;d++){const g=l[d];for(let x=d+1;x<u;x++){const y=l[x],b=y.z-g.z;if(b>o)break;if(y.atom==g.atom)continue;const _=Math.abs(y.y-g.y);if(_>o)continue;const h=Math.abs(y.x-g.x);if(h>o)continue;const f=h*h+_*_+b*b;f>a||y.chain==g.chain&&Math.abs(y.resi-g.resi)<4||(f<g.hbondDistanceSq&&(g.hbondOther=y,g.hbondDistanceSq=f),f<y.hbondDistanceSq&&(y.hbondOther=g,y.hbondDistanceSq=f))}}}}),"./src/parsers/utils/assignBonds.ts":((r,e,t)=>{t.r(e),t.d(e,{assignBonds:()=>o});var n=t("./src/parsers/utils/areConnected.ts");const i=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}],s=4.95;function o(a,l){for(let g=0,x=a.length;g<x;g++)a[g].index||(a[g].index=g);const d={x:{y:{z:[]}}};for(let g=0;g<a.length;g++){const x=a[g],y=Math.floor(x.x/s),b=Math.floor(x.y/s),_=Math.floor(x.z/s);d[y]||(d[y]={}),d[y][b]||(d[y][b]={}),d[y][b][_]||(d[y][b][_]=[]),d[y][b][_].push(x)}function u(g,x){for(let y=0;y<g.length;y++){const b=g[y];for(let _=0;_<x.length;_++){const h=x[_];if((0,n.areConnected)(b,h,l)){const f=b.bonds.indexOf(h.index),E=h.bonds.indexOf(b.index);f===-1&&E===-1?(b.bonds.push(h.index),b.bondOrder.push(1),h.bonds.push(b.index),h.bondOrder.push(1)):f===-1?(b.bonds.push(h.index),b.bondOrder.push(h.bondOrder[E])):E===-1&&(h.bonds.push(b.index),h.bondOrder.push(b.bondOrder[f]))}}}}for(let g in d){const x=parseInt(g);for(let y in d[x]){const b=parseInt(y);for(let _ in d[x][b]){const h=parseInt(_),f=d[x][b][h];for(let E=0;E<f.length;E++){const m=f[E];for(let S=E+1;S<f.length;S++){const w=f[S];(0,n.areConnected)(m,w,l)&&m.bonds.indexOf(w.index)==-1&&(m.bonds.push(w.index),m.bondOrder.push(1),w.bonds.push(m.index),w.bondOrder.push(1))}}for(let E=0;E<i.length;E++){const m=i[E];if(!d[x+m.x]||!d[x+m.x][b+m.y]||!d[x+m.x][b+m.y][h+m.z])continue;const S=d[x+m.x][b+m.y][h+m.z];u(f,S)}}}}}}),"./src/parsers/utils/assignPDBBonds.ts":((r,e,t)=>{t.r(e),t.d(e,{assignPDBBonds:()=>o});var n=t("./src/parsers/utils/areConnected.ts"),i=t("./src/parsers/utils/assignBonds.ts"),s=t("./src/parsers/utils/standardResidues.ts");function o(a,l){const d=[],u=[];for(let b=0,_=a.length;b<_;b++){const h=a[b];h.index=b,h.hetflag||!s.standardResidues.has(h.resn)?u.push(h):d.push(h)}(0,i.assignBonds)(u,l),d.sort(function(b,_){return b.chain!==_.chain?b.chain<_.chain?-1:1:b.resi-_.resi});let g=-1,x=-1,y;for(let b=0,_=d.length;b<_;b++){const h=d[b];h.resi!==g&&(g=h.resi,y||x++,y=!1),h.reschain=x;for(let f=b+1;f<d.length;f++){const E=d[f];if(E.chain!==h.chain||E.resi-h.resi>1)break;(0,n.areConnected)(h,E,l)&&(h.bonds.indexOf(E.index)===-1&&(h.bonds.push(E.index),h.bondOrder.push(1),E.bonds.push(h.index),E.bondOrder.push(1)),h.resi!==E.resi&&(y=!0))}}}}),"./src/parsers/utils/atomNameToElem.ts":((r,e,t)=>{t.r(e),t.d(e,{atomNameToElem:()=>i});var n=t("./src/parsers/utils/bondLength.ts");function i(s,o){let a=s.replace(/ /g,"");return a.length>0&&a[0]==="H"&&a!=="Hg"&&a!=="He"&&a!=="Hf"&&a!=="Hs"&&a!=="Ho"&&(a="H"),a.length>1&&(a=a[0].toUpperCase()+a.substring(1).toLowerCase(),n.bondTable[a]===void 0?a=a[0]:o&&(a==="Ca"||a==="Cd")&&(a="C")),a}}),"./src/parsers/utils/bondLength.ts":((r,e,t)=>{t.r(e),t.d(e,{bondLength:()=>i,bondTable:()=>n,setBondLength:()=>s});let n={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45};function i(o){return n[o]||1.6}function s(o,a){a<0&&(a=0),n[o]=a}}),"./src/parsers/utils/computeSecondaryStructure.ts":((r,e,t)=>{t.r(e),t.d(e,{computeSecondaryStructure:()=>i});var n=t("./src/parsers/utils/assignBackboneHBonds.ts");function i(s,o){(0,n.assignBackboneHBonds)(s,o);const a={};let l,d,u,g,x,y;for(l=0,d=s.length;l<d;l++)if(x=s[l],a[x.chain]===void 0&&(a[x.chain]=[]),isFinite(x.hbondDistanceSq)){const b=x.hbondOther;a[b.chain]===void 0&&(a[b.chain]=[]),Math.abs(b.resi-x.resi)===4&&(a[x.chain][x.resi]="h")}for(u in a)for(g=1;g<a[u].length-1;g++){const b=a[u][g-1],_=a[u][g+1];y=a[u][g],b=="h"&&b==_&&y!=b&&(a[u][g]=b)}for(l=0,d=s.length;l<d;l++)x=s[l],isFinite(x.hbondDistanceSq)&&a[x.chain][x.resi]!="h"&&x.ss!=="h"&&(a[x.chain][x.resi]="maybesheet");for(let b=0,_=s.length;b<_;b++)if(x=s[b],isFinite(x.hbondDistanceSq)&&a[x.chain][x.resi]=="maybesheet"){let h=x.hbondOther,f=a[h.chain][h.resi];(f=="maybesheet"||f=="s")&&(a[x.chain][x.resi]="s",a[h.chain][h.resi]="s")}for(let b in a){for(let _=1;_<a[b].length-1;_++){const h=a[b][_-1],f=a[b][_+1];y=a[b][_],h=="s"&&h==f&&y!=h&&(a[b][_]=h)}for(let _=0;_<a[b].length;_++){const h=a[b][_];(h=="h"||h=="s")&&a[b][_-1]!=h&&a[b][_+1]!=h&&delete a[b][_]}}for(l=0,d=s.length;l<d;l++)x=s[l],y=a[x.chain][x.resi],delete x.hbondOther,delete x.hbondDistanceSq,!(y===void 0||y==="maybesheet")&&(x.ss=y,a[x.chain][x.resi-1]!=y&&(x.ssbegin=!0),a[x.chain][x.resi+1]!=y&&(x.ssend=!0))}}),"./src/parsers/utils/getSinglePDB.ts":((r,e,t)=>{t.r(e),t.d(e,{getSinglePDB:()=>g});var n=t("./src/WebGL/index.ts"),i=t("./src/parsers/utils/atomNameToElem.ts"),s=t("./src/parsers/utils/bondLength.ts"),o=t("./src/parsers/utils/computeSecondaryStructure.ts"),a=t("./src/parsers/utils/isEmpty.ts"),l=t("./src/parsers/utils/processSymmetries.ts"),d=t("./src/parsers/utils/assignPDBBonds.ts"),u=t("./src/parsers/utils/validateBonds.ts");function g(x,y,b){const _=[],h=y.assignBonds===void 0?!0:y.assignBonds,f=!y.keepH,E=!!y.noSecondaryStructure,m=!y.noComputeSecondaryStructure,S=!y.doAssembly,w=y.altLoc?y.altLoc:"A",v={symmetries:[],cryst:void 0};let A,M=[];const T=[];let R;const O={};for(let L=0;L<x.length;L++){R=x[L].replace(/^\s*/,"");const P=R.substring(0,6);let I,N,U;if(P.indexOf("END")===0){if(M=x.slice(L+1),P==="END")for(const F in b)b.hasOwnProperty(F)&&delete b[F];break}else if(P==="ATOM  "||P==="HETATM"){let F,k,j,H,B,V,Y,K,J,Te,He,Q;if(He=R.substring(16,17),He!==" "&&He!==w&&w!=="*"||(Te=parseInt(R.substring(6,11)),A=R.substring(12,16).replace(/ /g,""),F=R.substring(17,20).replace(/ /g,""),k=R.substring(21,22),j=parseInt(R.substring(22,26)),H=R.substring(26,27),B=parseFloat(R.substring(30,38)),V=parseFloat(R.substring(38,46)),Y=parseFloat(R.substring(46,54)),Q=parseFloat(R.substring(60,68)),J=R.substring(76,78).replace(/ /g,""),J===""||s.bondTable[J]===void 0?J=(0,i.atomNameToElem)(R.substring(12,14),R[0]=="A"):J=J[0].toUpperCase()+J.substring(1).toLowerCase(),J==="H"&&f))continue;P[0]=="H"?K=!0:K=!1,T[Te]=_.length,_.push({resn:F,x:B,y:V,z:Y,elem:J,hetflag:K,altLoc:He,chain:k,resi:j,icode:H,rescode:j+(H!==" "?"^"+H:""),serial:Te,atom:A,bonds:[],ss:"c",bondOrder:[],properties:{},b:Q,pdbline:R})}else if(P==="SHEET "){I=R.substring(21,22),N=parseInt(R.substring(22,26)),U=parseInt(R.substring(33,37)),I in b||(b[I]={}),b[I][N]="s1";for(let F=N+1;F<U;F++)b[I][F]="s";b[I][U]="s2"}else if(P==="CONECT"){const F=parseInt(R.substring(6,11)),k=T[F],j=_[k],H=[11,16,21,26];for(let B=0;B<4;B++){const V=parseInt(R.substring(H[B],H[B]+5)),Y=T[V];let K=k+":"+Y;const J=_[Y];if(j!==void 0&&J!==void 0)if(!O[K])O[K]=1,(j.bonds.length==0||j.bonds[j.bonds.length-1]!==Y)&&(j.bonds.push(Y),j.bondOrder.push(1));else{O[K]+=1;for(let Te=0;Te<j.bonds.length;Te++)if(j.bonds[Te]==Y){const He=O[K];He>=4?j.bondOrder[Te]=1:j.bondOrder[Te]=He}}}}else if(P==="HELIX "){I=R.substring(19,20),N=parseInt(R.substring(21,25)),U=parseInt(R.substring(33,37)),I in b||(b[I]={}),b[I][N]="h1";for(let F=N+1;F<U;F++)b[I][F]="h";b[I][U]="h2"}else if(!S&&P==="REMARK"&&R.substring(13,18)==="BIOMT"){let F,k=new n.Matrix4;for(F=1;F<=3;F++)if(R=x[L].replace(/^\s*/,""),parseInt(R.substring(18,19))==F)k.elements[F-1]=parseFloat(R.substring(23,33)),k.elements[F-1+4]=parseFloat(R.substring(33,43)),k.elements[F-1+8]=parseFloat(R.substring(43,53)),k.elements[F-1+12]=parseFloat(R.substring(53)),L++;else for(;R.substring(13,18)==="BIOMT";)L++,R=x[L].replace(/^\s*/,"");k.elements[3]=0,k.elements[7]=0,k.elements[11]=0,k.elements[15]=1,v.symmetries.push(k),L--}else if(P==="CRYST1"){let F,k,j,H,B,V;F=parseFloat(R.substring(7,15)),k=parseFloat(R.substring(16,24)),j=parseFloat(R.substring(25,33)),H=parseFloat(R.substring(34,40)),B=parseFloat(R.substring(41,47)),V=parseFloat(R.substring(48,54)),v.cryst={a:F,b:k,c:j,alpha:H,beta:B,gamma:V}}else if(P==="ANISOU"){const F=parseInt(R.substring(6,11)),k=T[F],j=_[k];if(j){const H=R.substring(30).trim().split(/\s+/),B={u11:parseInt(H[0]),u22:parseInt(H[1]),u33:parseInt(H[2]),u12:parseInt(H[3]),u13:parseInt(H[4]),u23:parseInt(H[5])};j.uMat=B}}}if((0,u.validateBonds)(_,T),h&&(0,d.assignPDBBonds)(_,y),S||(0,l.processSymmetries)(v.symmetries,_,y,v.cryst),m&&!E&&(0,o.computeSecondaryStructure)(_,y.hbondCutoff),!(0,a.isEmpty)(b))for(let L=0;L<_.length;L++){const P=_[L];if(P!==void 0&&P.chain in b&&P.resi in b[P.chain]){const I=b[P.chain][P.resi];P.ss=I[0],I.length>1&&(I[1]=="1"?P.ssbegin=!0:I[1]=="2"&&(P.ssend=!0))}}return[_,v,M]}}),"./src/parsers/utils/isEmpty.ts":((r,e,t)=>{t.r(e),t.d(e,{isEmpty:()=>n});function n(i){for(const s in i)return!1;return!0}}),"./src/parsers/utils/processSymmetries.ts":((r,e,t)=>{t.r(e),t.d(e,{processSymmetries:()=>i});var n=t("./src/WebGL/index.ts");function i(s,o,a,l){const d=!a.duplicateAssemblyAtoms,u=o.length;let g=u,x=-1,y=null,b=null;(a.normalizeAssembly||a.wrapAtoms)&&l&&(y=(0,n.conversionMatrix3)(l.a,l.b,l.c,l.alpha,l.beta,l.gamma),b=new n.Matrix3,b.getInverse3(y));let _=function(E){let m=E.clone().applyMatrix3(b);const S=[m.x,m.y,m.z],w=[0,0,0];for(let A=0;A<3;A++){for(;S[A]<-.001;)S[A]+=1,w[A]+=1;for(;S[A]>1.001;)S[A]-=1,w[A]-=1}const v=new n.Vector3(w[0],w[1],w[2]);return v.applyMatrix3(y),v};if(a.normalizeAssembly&&l)for(let E=0;E<s.length;E++){const m=new n.Vector3(0,0,0);for(let w=0;w<u;w++){const v=new n.Vector3(o[w].x,o[w].y,o[w].z);v.applyMatrix4(s[E]),m.add(v)}m.divideScalar(u);const S=_(m);s[E].isNearlyIdentity()&&S.lengthSq()>.001&&(x=E),s[E].translate(S)}if(d){if(s.length>1)for(let E=0;E<o.length;E++){var h=[];for(let m=0;m<s.length;m++)if(!s[m].isNearlyIdentity()){var f=new n.Vector3;f.set(o[E].x,o[E].y,o[E].z),f.applyMatrix4(s[m]),h.push(f)}o[E].symmetries=h}}else{for(let E=0;E<u;E++)o[E].sym=-1;for(let E=0;E<s.length;E++)if(!s[E].isNearlyIdentity()&&x!=E){let m=new n.Vector3;for(let S=0;S<u;S++){const w=[];for(let A=0;A<o[S].bonds.length;A++)w.push(o[S].bonds[A]+g);if(m.set(o[S].x,o[S].y,o[S].z),m.applyMatrix4(s[E]),a.wrapAtoms&&l){let A=_(m);m.add(A)}const v={};for(const A in o[S])v[A]=o[S][A];v.x=m.x,v.y=m.y,v.z=m.z,v.bonds=w,v.sym=E,v.index=o.length,o.push(v)}g=o.length}else for(let m=0;m<u;m++)o[m].sym=E;if(a.wrapAtoms&&l){let E=new n.Vector3;for(let m=0;m<u;m++){E.set(o[m].x,o[m].y,o[m].z);let S=_(E);E.add(S),o[m].x=E.x,o[m].y=E.y,o[m].z=E.z}}if(x>=0){const E=new n.Vector3;for(let m=0;m<u;m++)E.set(o[m].x,o[m].y,o[m].z),E.applyMatrix4(s[x]),o[m].x=E.x,o[m].y=E.y,o[m].z=E.z}s.length=0}}}),"./src/parsers/utils/standardResidues.ts":((r,e,t)=>{t.r(e),t.d(e,{standardResidues:()=>n});const n=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])}),"./src/parsers/utils/validateBonds.ts":((r,e,t)=>{t.r(e),t.d(e,{validateBonds:()=>n});function n(i,s){for(let o=0,a=i.length;o<a;o++){const l=i[o];for(let d=0;d<l.bonds.length;d++){const u=l.bonds[d],g=i[u],x=s[l.serial];g&&x&&g.bonds.indexOf(x)<0&&(g.bonds.push(x),g.bondOrder.push(l.bondOrder[d]))}}}}),"./src/partialCharges.ts":((r,e,t)=>{t.r(e),t.d(e,{applyPartialCharges:()=>i,partialCharges:()=>n});const n={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55};function i(s,o){if((!o||typeof s.partialCharge>"u")&&s.resn&&s.atom){var a=s.resn+":"+s.atom;s.properties.partialCharge=n[a]}}}),"./src/specs.ts":((r,e,t)=>{t.r(e)}),"./src/utilities.ts":((__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,inflateString:()=>inflateString,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts"),pako__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/pako/dist/pako.esm.mjs");function extend(r,e){for(var t in e)e.hasOwnProperty(t)&&e[t]!==void 0&&(r[t]=e[t]);return r}function deepCopy(r){let e,t,n;if(r==null)return{};if(typeof r!="object"||r===null)return r;e=Array.isArray(r)?[]:{};for(n in r)t=r[n],e[n]=deepCopy(t);return e}function isNumeric(r){var e=typeof r;return(e==="number"||e==="string")&&!isNaN(r-parseFloat(r))}function isEmptyObject(r){return Object.keys(r).length===0}function makeFunction(callback){return callback&&typeof callback=="string"&&(callback=eval("("+callback+")")),callback&&typeof callback!="function"?(console.warn("Invalid callback provided."),()=>{}):callback}function adjustVolumeStyle(r){r&&(r.volformat&&!(r.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData)&&(r.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData(r.voldata,r.volformat)),r.volscheme&&(r.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient(r.volscheme)))}function getExtent(r,e){var t,n,i,s,o,a,l,d,u,g,x=!e;if(t=n=i=9999,s=o=a=-9999,l=d=u=g=0,r.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var y=0;y<r.length;y++){var b=r[y];if(!(typeof b>"u"||!isFinite(b.x)||!isFinite(b.y)||!isFinite(b.z))&&(g++,l+=b.x,d+=b.y,u+=b.z,t=t<b.x?t:b.x,n=n<b.y?n:b.y,i=i<b.z?i:b.z,s=s>b.x?s:b.x,o=o>b.y?o:b.y,a=a>b.z?a:b.z,b.symmetries&&x))for(var _=0;_<b.symmetries.length;_++)g++,l+=b.symmetries[_].x,d+=b.symmetries[_].y,u+=b.symmetries[_].z,t=t<b.symmetries[_].x?t:b.symmetries[_].x,n=n<b.symmetries[_].y?n:b.symmetries[_].y,i=i<b.symmetries[_].z?i:b.symmetries[_].z,s=s>b.symmetries[_].x?s:b.symmetries[_].x,o=o>b.symmetries[_].y?o:b.symmetries[_].y,a=a>b.symmetries[_].z?a:b.symmetries[_].z}return[[t,n,i],[s,o,a],[l/g,d/g,u/g]]}function getPropertyRange(r,e){for(var t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=0,s=r.length;i<s;i++){var o=r[i],a=getAtomProperty(o,e);a!=null&&(a<t&&(t=a),a>n&&(n=a))}return!isFinite(t)&&!isFinite(n)?t=n=0:isFinite(t)?isFinite(n)||(n=t):t=n,[t,n]}class PausableTimer{constructor(e,t,n){this.total_time_run=0,this.fn=e,this.arg=n,this.countdown=t,this.start_time=new Date().getTime(),this.ident=setTimeout(e,t,n)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=new Date().getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray(r){for(var e=window.atob(r),t=e.length,n=new Uint8Array(t),i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}function getAtomProperty(r,e){var t=null;return r.properties&&typeof r.properties[e]<"u"?t=r.properties[e]:typeof r[e]<"u"&&(t=r[e]),t}function mergeGeos(r,e){var t=e.geometry;t!==void 0&&r.geometryGroups.push(t.geometryGroups[0])}function specStringToObject(r){if(typeof r=="object")return r;if(typeof r>"u"||r==null)return r;try{return JSON.parse(r)}catch{}r=r.replace(/%7E/g,"~");var e=function(x){return isNumeric(x)?Math.floor(parseFloat(x))==parseInt(x)||x.indexOf(".")>=0?parseFloat(x):parseInt(x):x==="true"?!0:x==="false"?!1:x},t={};if(r==="all")return t;for(var n=r.split(";"),i=0;i<n.length;i++){var s=n[i].split(":"),o=s[0],a={},l=s[1];if(l)if(l=l.replace(/~/g,"="),l.indexOf("=")!==-1)for(var d=l.split(","),u=0;u<d.length;u++){var g=d[u].split("=",2);a[g[0]]=e(g[1])}else l.indexOf(",")!==-1?a=l.split(","):a=e(l);t[o]=a}return t}function checkStatus(r){if(!r.ok)throw new Error(`HTTP ${r.status} - ${r.statusText}`);return r}function get(r,e){var t=fetch(r).then(checkStatus).then(n=>n.text());return e?t.then(e):t}function getbin(r,e,t,n){var i;return t=="POST"?i=fetch(r,{method:"POST",body:n}).then(s=>checkStatus(s)).then(s=>s.arrayBuffer()):i=fetch(r).then(s=>checkStatus(s)).then(s=>s.arrayBuffer()),e?i.then(e):i}function download(r,e,t,n){var i="",s="",o="",a=null,l=e.addModel();if(r.indexOf(":")<0&&(r.length==4?r="pdb:"+r:isNaN(r)?r="url:"+r:r="cid:"+r),r.substring(0,5)=="mmtf:"&&(console.warn("WARNING: MMTF now deprecated.  Reverting to bcif."),r="bcif:"+r.slice(5)),r.substring(0,5)==="bcif:")r=r.substring(5).toUpperCase(),o="https://models.rcsb.org/"+r+".bcif.gz",t&&typeof t.noComputeSecondaryStructure>"u"&&(t.noComputeSecondaryStructure=!0),a=new Promise(function(u){getbin(o).then(function(g){l.addMolData(g,"bcif.gz",t),e.zoomTo(),e.render(),u(l)},function(){console.error("fetch of "+o+" failed.")})});else{if(r.substring(0,4)==="pdb:"){if(i="bcif",t&&t.format&&(i=t.format),t&&typeof t.noComputeSecondaryStructure>"u"&&(t.noComputeSecondaryStructure=!0),r=r.substring(4).toUpperCase(),!r.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}i=="bcif"?o="https://models.rcsb.org/"+r.toUpperCase()+".bcif.gz":(s=t&&t.pdbUri?t.pdbUri:"https://files.rcsb.org/view/",o=s+r+"."+i)}else if(r.substring(0,4)=="cid:"){if(i="sdf",r=r.substring(4),!r.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}o="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+r+"/SDF?record_type=3d"}else r.substring(0,4)=="url:"&&(o=r.substring(4),i=o);var d=function(u){l.addMolData(u,i,t),e.zoomTo(),e.render()};a=new Promise(function(u){i=="bcif"?getbin(o).then(function(g){d(g),u(l)}).catch(function(){s=t&&t.pdbUri?t.pdbUri:"https://files.rcsb.org/view/",o=s+r+".pdb",i="pdb",console.warn("falling back to pdb format"),get(o).then(function(g){d(g),u(l)}).catch(function(g){d(""),u(l),console.error("fetch of "+o+" failed: "+g.statusText)})}):get(o).then(function(g){d(g),u(l)}).catch(function(g){d(""),u(l),console.error("fetch of "+o+" failed: "+g.statusText)})})}return n?(a.then(function(u){n(u)}),l):a}function getColorFromStyle(r,e){let t=e.colorscheme;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[t]<"u")t=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[t];else if(typeof t=="string"&&t.endsWith("Carbon")){let o=t.substring(0,t.lastIndexOf("Carbon")).toLowerCase();if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[o]<"u"){let a=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);a.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[o],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[t]={prop:"elem",map:a},t=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[t]}}let n=r.color;if(typeof e.color<"u"&&e.color!="spectrum"&&(n=e.color),typeof t<"u"){let o,a;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[t]<"u")t=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[t],typeof t[r[t.prop]]<"u"&&(n=t.map[r[t.prop]]);else if(typeof t[r[t.prop]]<"u")n=t.map[r[t.prop]];else if(typeof t.prop<"u"&&typeof t.gradient<"u"){o=t.prop;var i=t.gradient;i instanceof _Gradient__WEBPACK_IMPORTED_MODULE_0__.GradientType||(i=(0,_Gradient__WEBPACK_IMPORTED_MODULE_0__.getGradient)(t));let l=i.range()||[-1,1];a=getAtomProperty(r,o),a!=null&&(n=i.valueToHex(a,l))}else typeof t.prop<"u"&&typeof t.map<"u"?(o=t.prop,a=getAtomProperty(r,o),typeof t.map[a]<"u"&&(n=t.map[a])):typeof e.colorscheme[r.elem]<"u"?n=e.colorscheme[r.elem]:console.warn("Could not interpret colorscheme "+t)}else typeof e.colorfunc<"u"&&(n=e.colorfunc(r));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(n)}function getElement(r){let e=r;return typeof r=="string"?e=document.querySelector("#"+r):typeof r=="object"&&r.get&&(e=r.get(0)),e}function inflateString(r,e=!0){let t;return typeof r=="string"?t=new TextEncoder().encode(r):t=new Uint8Array(r),(0,pako__WEBPACK_IMPORTED_MODULE_3__.inflate)(t,{to:e?"string":null})}}),"./src/vendor/mmtf.js":(function(r,e){(function(t,n){n(e)})(this,function(t){function n(Z,tt,tr){for(var s0=(Z.byteLength,0),c0=tr.length;c0>s0;s0++){var A0=tr.charCodeAt(s0);if(128>A0)Z.setUint8(tt++,A0>>>0&127|0);else if(2048>A0)Z.setUint8(tt++,A0>>>6&31|192),Z.setUint8(tt++,A0>>>0&63|128);else if(65536>A0)Z.setUint8(tt++,A0>>>12&15|224),Z.setUint8(tt++,A0>>>6&63|128),Z.setUint8(tt++,A0>>>0&63|128);else{if(!(1114112>A0))throw new Error("bad codepoint "+A0);Z.setUint8(tt++,A0>>>18&7|240),Z.setUint8(tt++,A0>>>12&63|128),Z.setUint8(tt++,A0>>>6&63|128),Z.setUint8(tt++,A0>>>0&63|128)}}}function i(Z){for(var tt=0,tr=0,s0=Z.length;s0>tr;tr++){var c0=Z.charCodeAt(tr);if(128>c0)tt+=1;else if(2048>c0)tt+=2;else if(65536>c0)tt+=3;else{if(!(1114112>c0))throw new Error("bad codepoint "+c0);tt+=4}}return tt}function s(Z,tt,tr){var s0=typeof Z;if(s0==="string"){var c0=i(Z);if(32>c0)return tt.setUint8(tr,160|c0),n(tt,tr+1,Z),1+c0;if(256>c0)return tt.setUint8(tr,217),tt.setUint8(tr+1,c0),n(tt,tr+2,Z),2+c0;if(65536>c0)return tt.setUint8(tr,218),tt.setUint16(tr+1,c0),n(tt,tr+3,Z),3+c0;if(4294967296>c0)return tt.setUint8(tr,219),tt.setUint32(tr+1,c0),n(tt,tr+5,Z),5+c0}if(Z instanceof Uint8Array){var c0=Z.byteLength,A0=new Uint8Array(tt.buffer);if(256>c0)return tt.setUint8(tr,196),tt.setUint8(tr+1,c0),A0.set(Z,tr+2),2+c0;if(65536>c0)return tt.setUint8(tr,197),tt.setUint16(tr+1,c0),A0.set(Z,tr+3),3+c0;if(4294967296>c0)return tt.setUint8(tr,198),tt.setUint32(tr+1,c0),A0.set(Z,tr+5),5+c0}if(s0==="number"){if(!isFinite(Z))throw new Error("Number not finite: "+Z);if(Math.floor(Z)!==Z)return tt.setUint8(tr,203),tt.setFloat64(tr+1,Z),9;if(Z>=0){if(128>Z)return tt.setUint8(tr,Z),1;if(256>Z)return tt.setUint8(tr,204),tt.setUint8(tr+1,Z),2;if(65536>Z)return tt.setUint8(tr,205),tt.setUint16(tr+1,Z),3;if(4294967296>Z)return tt.setUint8(tr,206),tt.setUint32(tr+1,Z),5;throw new Error("Number too big 0x"+Z.toString(16))}if(Z>=-32)return tt.setInt8(tr,Z),1;if(Z>=-128)return tt.setUint8(tr,208),tt.setInt8(tr+1,Z),2;if(Z>=-32768)return tt.setUint8(tr,209),tt.setInt16(tr+1,Z),3;if(Z>=-2147483648)return tt.setUint8(tr,210),tt.setInt32(tr+1,Z),5;throw new Error("Number too small -0x"+(-Z).toString(16).substr(1))}if(Z===null)return tt.setUint8(tr,192),1;if(s0==="boolean")return tt.setUint8(tr,Z?195:194),1;if(s0==="object"){var c0,f0=0,P0=Array.isArray(Z);if(P0)c0=Z.length;else{var Fe=Object.keys(Z);c0=Fe.length}var f0;if(16>c0?(tt.setUint8(tr,c0|(P0?144:128)),f0=1):65536>c0?(tt.setUint8(tr,P0?220:222),tt.setUint16(tr+1,c0),f0=3):4294967296>c0&&(tt.setUint8(tr,P0?221:223),tt.setUint32(tr+1,c0),f0=5),P0)for(var v0=0;c0>v0;v0++)f0+=s(Z[v0],tt,tr+f0);else for(var v0=0;c0>v0;v0++){var D0=Fe[v0];f0+=s(D0,tt,tr+f0),f0+=s(Z[D0],tt,tr+f0)}return f0}throw new Error("Unknown type "+s0)}function o(Z){var tt=typeof Z;if(tt==="string"){var tr=i(Z);if(32>tr)return 1+tr;if(256>tr)return 2+tr;if(65536>tr)return 3+tr;if(4294967296>tr)return 5+tr}if(Z instanceof Uint8Array){var tr=Z.byteLength;if(256>tr)return 2+tr;if(65536>tr)return 3+tr;if(4294967296>tr)return 5+tr}if(tt==="number"){if(Math.floor(Z)!==Z)return 9;if(Z>=0){if(128>Z)return 1;if(256>Z)return 2;if(65536>Z)return 3;if(4294967296>Z)return 5;throw new Error("Number too big 0x"+Z.toString(16))}if(Z>=-32)return 1;if(Z>=-128)return 2;if(Z>=-32768)return 3;if(Z>=-2147483648)return 5;throw new Error("Number too small -0x"+Z.toString(16).substr(1))}if(tt==="boolean"||Z===null)return 1;if(tt==="object"){var tr,s0=0;if(Array.isArray(Z)){tr=Z.length;for(var c0=0;tr>c0;c0++)s0+=o(Z[c0])}else{var A0=Object.keys(Z);tr=A0.length;for(var c0=0;tr>c0;c0++){var P0=A0[c0];s0+=o(P0)+o(Z[P0])}}if(16>tr)return 1+s0;if(65536>tr)return 3+s0;if(4294967296>tr)return 5+s0;throw new Error("Array or object too long 0x"+tr.toString(16))}throw new Error("Unknown type "+tt)}function a(Z){var tt=new ArrayBuffer(o(Z)),tr=new DataView(tt);return s(Z,tr,0),new Uint8Array(tt)}function l(Z,tt,tr){return tt?new Z(tt.buffer,tt.byteOffset,tt.byteLength/(tr||1)):void 0}function d(Z){return l(DataView,Z)}function u(Z){return l(Uint8Array,Z)}function g(Z){return l(Int8Array,Z)}function x(Z){return l(Int32Array,Z,4)}function y(Z){return l(Float32Array,Z,4)}function b(Z,tt){var tr=Z.length/2;tt||(tt=new Int16Array(tr));for(var s0=0,c0=0;tr>s0;++s0,c0+=2)tt[s0]=Z[c0]<<8^Z[c0+1]<<0;return tt}function _(Z,tt){var tr=Z.length;tt||(tt=new Uint8Array(2*tr));for(var s0=d(tt),c0=0;tr>c0;++c0)s0.setInt16(2*c0,Z[c0]);return u(tt)}function h(Z,tt){var tr=Z.length/4;tt||(tt=new Int32Array(tr));for(var s0=0,c0=0;tr>s0;++s0,c0+=4)tt[s0]=Z[c0]<<24^Z[c0+1]<<16^Z[c0+2]<<8^Z[c0+3]<<0;return tt}function f(Z,tt){var tr=Z.length;tt||(tt=new Uint8Array(4*tr));for(var s0=d(tt),c0=0;tr>c0;++c0)s0.setInt32(4*c0,Z[c0]);return u(tt)}function E(Z,tt){var tr=Z.length;tt||(tt=new Float32Array(tr/4));for(var s0=d(tt),c0=d(Z),A0=0,P0=0,Fe=tr/4;Fe>A0;++A0,P0+=4)s0.setFloat32(P0,c0.getFloat32(P0),!0);return tt}function m(Z,tt,tr){var s0=Z.length,c0=1/tt;tr||(tr=new Float32Array(s0));for(var A0=0;s0>A0;++A0)tr[A0]=Z[A0]*c0;return tr}function S(Z,tt,tr){var s0=Z.length;tr||(tr=new Int32Array(s0));for(var c0=0;s0>c0;++c0)tr[c0]=Math.round(Z[c0]*tt);return tr}function w(Z,tt){var tr,s0;if(!tt){var c0=0;for(tr=0,s0=Z.length;s0>tr;tr+=2)c0+=Z[tr+1];tt=new Z.constructor(c0)}var A0=0;for(tr=0,s0=Z.length;s0>tr;tr+=2)for(var P0=Z[tr],Fe=Z[tr+1],f0=0;Fe>f0;++f0)tt[A0]=P0,++A0;return tt}function v(Z){if(Z.length===0)return new Int32Array;var tt,tr,s0=2;for(tt=1,tr=Z.length;tr>tt;++tt)Z[tt-1]!==Z[tt]&&(s0+=2);var c0=new Int32Array(s0),A0=0,P0=1;for(tt=1,tr=Z.length;tr>tt;++tt)Z[tt-1]!==Z[tt]?(c0[A0]=Z[tt-1],c0[A0+1]=P0,P0=1,A0+=2):++P0;return c0[A0]=Z[Z.length-1],c0[A0+1]=P0,c0}function A(Z,tt){var tr=Z.length;tt||(tt=new Z.constructor(tr)),tr&&(tt[0]=Z[0]);for(var s0=1;tr>s0;++s0)tt[s0]=Z[s0]+tt[s0-1];return tt}function M(Z,tt){var tr=Z.length;tt||(tt=new Z.constructor(tr)),tt[0]=Z[0];for(var s0=1;tr>s0;++s0)tt[s0]=Z[s0]-Z[s0-1];return tt}function T(Z,tt){var tr,s0,c0=Z instanceof Int8Array?127:32767,A0=-c0-1,P0=Z.length;if(!tt){var Fe=0;for(tr=0;P0>tr;++tr)Z[tr]<c0&&Z[tr]>A0&&++Fe;tt=new Int32Array(Fe)}for(tr=0,s0=0;P0>tr;){for(var f0=0;Z[tr]===c0||Z[tr]===A0;)f0+=Z[tr],++tr;f0+=Z[tr],++tr,tt[s0]=f0,++s0}return tt}function R(Z,tt){var tr,s0=32767,c0=-s0-1,A0=Z.length,P0=0;for(tr=0;A0>tr;++tr){var Fe=Z[tr];Fe===0?++P0:Fe>0?(P0+=Math.ceil(Fe/s0),Fe%s0===0&&(P0+=1)):(P0+=Math.ceil(Fe/c0),Fe%c0===0&&(P0+=1))}var f0=new Int16Array(P0),v0=0;for(tr=0;A0>tr;++tr){var Fe=Z[tr];if(Fe>=0)for(;Fe>=s0;)f0[v0]=s0,++v0,Fe-=s0;else for(;c0>=Fe;)f0[v0]=c0,++v0,Fe-=c0;f0[v0]=Fe,++v0}return f0}function O(Z,tt){return A(w(Z),tt)}function L(Z){return v(M(Z))}function P(Z,tt,tr){return m(w(Z,x(tr)),tt,tr)}function I(Z,tt){return v(S(Z,tt))}function N(Z,tt,tr){return m(A(Z,x(tr)),tt,tr)}function U(Z,tt,tr){return M(S(Z,tt),tr)}function F(Z,tt,tr){return m(T(Z,x(tr)),tt,tr)}function k(Z,tt,tr){var s0=T(Z,x(tr));return N(s0,tt,y(s0))}function j(Z,tt,tr){return R(U(Z,tt))}function H(A0){var tt=d(A0),tr=tt.getInt32(0),s0=tt.getInt32(4),c0=A0.subarray(8,12),A0=A0.subarray(12);return[tr,A0,s0,c0]}function B(Z,tt,tr,s0){var c0=new ArrayBuffer(12+s0.byteLength),A0=new Uint8Array(c0),P0=new DataView(c0);return P0.setInt32(0,Z),P0.setInt32(4,tt),tr&&A0.set(tr,8),A0.set(s0,12),A0}function V(Z){var tt=Z.length,tr=u(Z);return B(2,tt,void 0,tr)}function Y(Z){var tt=Z.length,tr=f(Z);return B(4,tt,void 0,tr)}function K(Z,tt){var tr=Z.length/tt,s0=f([tt]),c0=u(Z);return B(5,tr,s0,c0)}function J(Z){var tt=Z.length,tr=f(v(Z));return B(6,tt,void 0,tr)}function Te(Z){var tt=Z.length,tr=f(L(Z));return B(8,tt,void 0,tr)}function He(Z,tt){var tr=Z.length,s0=f([tt]),c0=f(I(Z,tt));return B(9,tr,s0,c0)}function Q(Z,tt){var tr=Z.length,s0=f([tt]),c0=_(j(Z,tt));return B(10,tr,s0,c0)}function Xe(Z){var tt={};return w0.forEach(function(tr){Z[tr]!==void 0&&(tt[tr]=Z[tr])}),Z.bondAtomList&&(tt.bondAtomList=Y(Z.bondAtomList)),Z.bondOrderList&&(tt.bondOrderList=V(Z.bondOrderList)),tt.xCoordList=Q(Z.xCoordList,1e3),tt.yCoordList=Q(Z.yCoordList,1e3),tt.zCoordList=Q(Z.zCoordList,1e3),Z.bFactorList&&(tt.bFactorList=Q(Z.bFactorList,100)),Z.atomIdList&&(tt.atomIdList=Te(Z.atomIdList)),Z.altLocList&&(tt.altLocList=J(Z.altLocList)),Z.occupancyList&&(tt.occupancyList=He(Z.occupancyList,100)),tt.groupIdList=Te(Z.groupIdList),tt.groupTypeList=Y(Z.groupTypeList),Z.secStructList&&(tt.secStructList=V(Z.secStructList)),Z.insCodeList&&(tt.insCodeList=J(Z.insCodeList)),Z.sequenceIndexList&&(tt.sequenceIndexList=Te(Z.sequenceIndexList)),tt.chainIdList=K(Z.chainIdList,4),Z.chainNameList&&(tt.chainNameList=K(Z.chainNameList,4)),tt}function ut(Z){function tt(f0){for(var v0={},D0=0;f0>D0;D0++){var l0=A0();v0[l0]=A0()}return v0}function tr(f0){var v0=Z.subarray(P0,P0+f0);return P0+=f0,v0}function s0(f0){var v0=Z.subarray(P0,P0+f0);P0+=f0;var D0=65535;if(f0>D0){for(var l0=[],y0=0;y0<v0.length;y0+=D0)l0.push(String.fromCharCode.apply(null,v0.subarray(y0,y0+D0)));return l0.join("")}return String.fromCharCode.apply(null,v0)}function c0(f0){for(var v0=new Array(f0),D0=0;f0>D0;D0++)v0[D0]=A0();return v0}function A0(){var f0,v0,D0=Z[P0];if((128&D0)===0)return P0++,D0;if((240&D0)===128)return v0=15&D0,P0++,tt(v0);if((240&D0)===144)return v0=15&D0,P0++,c0(v0);if((224&D0)===160)return v0=31&D0,P0++,s0(v0);if((224&D0)===224)return f0=Fe.getInt8(P0),P0++,f0;switch(D0){case 192:return P0++,null;case 194:return P0++,!1;case 195:return P0++,!0;case 196:return v0=Fe.getUint8(P0+1),P0+=2,tr(v0);case 197:return v0=Fe.getUint16(P0+1),P0+=3,tr(v0);case 198:return v0=Fe.getUint32(P0+1),P0+=5,tr(v0);case 202:return f0=Fe.getFloat32(P0+1),P0+=5,f0;case 203:return f0=Fe.getFloat64(P0+1),P0+=9,f0;case 204:return f0=Z[P0+1],P0+=2,f0;case 205:return f0=Fe.getUint16(P0+1),P0+=3,f0;case 206:return f0=Fe.getUint32(P0+1),P0+=5,f0;case 208:return f0=Fe.getInt8(P0+1),P0+=2,f0;case 209:return f0=Fe.getInt16(P0+1),P0+=3,f0;case 210:return f0=Fe.getInt32(P0+1),P0+=5,f0;case 217:return v0=Fe.getUint8(P0+1),P0+=2,s0(v0);case 218:return v0=Fe.getUint16(P0+1),P0+=3,s0(v0);case 219:return v0=Fe.getUint32(P0+1),P0+=5,s0(v0);case 220:return v0=Fe.getUint16(P0+1),P0+=3,c0(v0);case 221:return v0=Fe.getUint32(P0+1),P0+=5,c0(v0);case 222:return v0=Fe.getUint16(P0+1),P0+=3,tt(v0);case 223:return v0=Fe.getUint32(P0+1),P0+=5,tt(v0)}throw new Error("Unknown type 0x"+D0.toString(16))}var P0=0,Fe=new DataView(Z.buffer);return A0()}function Ji(Z,tt,tr,s0){switch(Z){case 1:return E(tt);case 2:return g(tt);case 3:return b(tt);case 4:return h(tt);case 5:return u(tt);case 6:return w(h(tt),new Uint8Array(tr));case 7:return w(h(tt));case 8:return O(h(tt));case 9:return P(h(tt),h(s0)[0]);case 10:return k(b(tt),h(s0)[0]);case 11:return m(b(tt),h(s0)[0]);case 12:return F(b(tt),h(s0)[0]);case 13:return F(g(tt),h(s0)[0]);case 14:return T(b(tt));case 15:return T(g(tt))}}function er(Z,tt){tt=tt||{};var tr=tt.ignoreFields,s0={};return T0.forEach(function(c0){var A0=tr?tr.indexOf(c0)!==-1:!1,P0=Z[c0];A0||P0===void 0||(P0 instanceof Uint8Array?s0[c0]=Ji.apply(null,H(P0)):s0[c0]=P0)}),s0}function ec(Z){return String.fromCharCode.apply(null,Z).replace(/\0/g,"")}function ai(Z,tt,tr){tr=tr||{};var s0,c0,A0,P0,Fe,f0,v0=tr.firstModelOnly,D0=tt.onModel,l0=tt.onChain,y0=tt.onGroup,lt=tt.onAtom,oi=tt.onBond,b0=0,W=0,e0=0,a0=0,hi=0,p0=-1,O0=Z.chainNameList,q=Z.secStructList,it=Z.insCodeList,at=Z.sequenceIndexList,t0=Z.atomIdList,i0=Z.bFactorList,d0=Z.altLocList,_0=Z.occupancyList,S0=Z.bondAtomList,$0=Z.bondOrderList;for(s0=0,c0=Z.chainsPerModel.length;c0>s0&&!(v0&&b0>0);++s0){var K0=Z.chainsPerModel[b0];for(D0&&D0({chainCount:K0,modelIndex:b0}),A0=0;K0>A0;++A0){var n1=Z.groupsPerChain[W];if(l0){var c1=ec(Z.chainIdList.subarray(4*W,4*W+4)),J0=null;O0&&(J0=ec(O0.subarray(4*W,4*W+4))),l0({groupCount:n1,chainIndex:W,modelIndex:b0,chainId:c1,chainName:J0})}for(P0=0;n1>P0;++P0){var Z0=Z.groupList[Z.groupTypeList[e0]],Hm=Z0.atomNameList.length;if(y0){var C0=null;q&&(C0=q[e0]);var z0=null;Z.insCodeList&&(z0=String.fromCharCode(it[e0]));var B0=null;at&&(B0=at[e0]),y0({atomCount:Hm,groupIndex:e0,chainIndex:W,modelIndex:b0,groupId:Z.groupIdList[e0],groupType:Z.groupTypeList[e0],groupName:Z0.groupName,singleLetterCode:Z0.singleLetterCode,chemCompType:Z0.chemCompType,secStruct:C0,insCode:z0,sequenceIndex:B0})}for(Fe=0;Hm>Fe;++Fe){if(lt){var V0=null;t0&&(V0=t0[a0]);var i1=null;i0&&(i1=i0[a0]);var u1=null;d0&&(u1=String.fromCharCode(d0[a0]));var f1=null;_0&&(f1=_0[a0]),lt({atomIndex:a0,groupIndex:e0,chainIndex:W,modelIndex:b0,atomId:V0,element:Z0.elementList[Fe],atomName:Z0.atomNameList[Fe],formalCharge:Z0.formalChargeList[Fe],xCoord:Z.xCoordList[a0],yCoord:Z.yCoordList[a0],zCoord:Z.zCoordList[a0],bFactor:i1,altLoc:u1,occupancy:f1})}a0+=1}if(oi){var a1=Z0.bondAtomList;for(Fe=0,f0=Z0.bondOrderList.length;f0>Fe;++Fe)oi({atomIndex1:a0-Hm+a1[2*Fe],atomIndex2:a0-Hm+a1[2*Fe+1],bondOrder:Z0.bondOrderList[Fe]})}e0+=1}W+=1}if(hi=p0+1,p0=a0-1,oi&&S0)for(Fe=0,f0=S0.length;f0>Fe;Fe+=2){var k0=S0[Fe],r1=S0[Fe+1];(k0>=hi&&p0>=k0||r1>=hi&&p0>=r1)&&oi({atomIndex1:k0,atomIndex2:r1,bondOrder:$0?$0[Fe/2]:null})}b0+=1}}function u0(Z){return a(Xe(Z))}function o0(Z,tt){Z instanceof ArrayBuffer&&(Z=new Uint8Array(Z));var tr;return tr=Z instanceof Uint8Array?ut(Z):Z,er(tr,tt)}function E0(Z,tt,tr,s0){function c0(){try{var P0=o0(A0.response);tr(P0)}catch(Fe){s0(Fe)}}var A0=new XMLHttpRequest;A0.addEventListener("load",c0,!0),A0.addEventListener("error",s0,!0),A0.responseType="arraybuffer",A0.open("GET",tt+Z.toUpperCase()),A0.send()}function F0(Z,tt,tr){E0(Z,h0,tt,tr)}function g0(Z,tt,tr){E0(Z,M0,tt,tr)}var w0=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],L0=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],T0=w0.concat(L0),ht="v1.0.1",We="//mmtf.rcsb.org/v1.0/",h0=We+"full/",M0=We+"reduced/";t.encode=u0,t.decode=o0,t.traverse=ai,t.fetch=F0,t.fetchReduced=g0,t.version=ht,t.fetchUrl=h0,t.fetchReducedUrl=M0,t.encodeMsgpack=a,t.encodeMmtf=Xe,t.decodeMsgpack=ut,t.decodeMmtf=er})})},__webpack_module_cache__={};function __webpack_require__(r){var e=__webpack_module_cache__[r];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[r]={exports:{}};return __webpack_modules__[r].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(r,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},__webpack_require__.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),__webpack_require__.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})())})(_3Dmol$1)),_3Dmol$1.exports}var _3DmolExports=require_3Dmol();const InteractionType={HydrogenBond:"Hydrogen Bond",Hydrophobic:"Hydrophobic",SaltBridge:"Salt Bridge",PiStacking:"Pi-Stacking",HalogenBond:"Halogen Bond",MetalCoordination:"Metal Coordination",Unknown:"Unknown"},Viewer3Dmol=({file:r,onStructureLoaded:e,selectedLigand:t,interactions:n,showInteractions:i,visualSettings:s,triggerRecenter:o})=>{const a=reactExports.useRef(null),l=reactExports.useRef(null),[d,u]=reactExports.useState(!1);reactExports.useEffect(()=>{if(!a.current)return;const b={backgroundColor:"white"},_=_3DmolExports.createViewer(a.current,b);return l.current=_,()=>{l.current&&l.current.clear()}},[]),reactExports.useEffect(()=>{if(!r||!l.current)return;u(!0);const b=new FileReader;b.onload=_=>{const h=_.target?.result,f=r.name.split(".").pop()||"pdb",E=l.current;E.clear(),E.addModel(h,f),E.setStyle({},{cartoon:{color:"#888888",opacity:1}}),E.zoomTo(),E.render();const m=new Blob([h],{type:"text/plain"}),S=new Ol(document.createElement("div"));S.loadFile(m,{ext:f}).then(w=>{w&&(e(w.structure),S.dispose()),u(!1)}).catch(w=>{console.error("NGL Parse Error:",w),u(!1)})},b.readAsText(r)},[r,e]),reactExports.useEffect(()=>{if(o>0&&l.current)if(t){const b={resi:t.resNo,chain:t.chain};l.current.zoomTo(b,500)}else l.current.zoomTo({},500)},[o,t]),reactExports.useEffect(()=>{const b=l.current;if(!b)return;b.removeAllShapes(),b.setStyle({},{});let _={};if(t&&(_={resi:t.resNo,chain:t.chain}),s.proteinStyle!=="hidden"){let h={};const f="#cccccc";switch(s.proteinStyle){case"cartoon":h={cartoon:{color:f,opacity:.15}};break;case"rope":h={cartoon:{color:f,style:"trace",radius:.3}};break;case"trace":h={stick:{radius:.2,color:f}};break;case"line":h={line:{color:f}};break;default:h={cartoon:{color:f}}}b.setStyle({},h)}if(t&&n&&n.length>0)try{const h=n.filter(f=>f&&f.proteinAtom).map(f=>({resi:f.proteinAtom.resNo,chain:f.proteinAtom.chain}));if(h.length>0){const f=Array.from(new Set(h.map(S=>JSON.stringify(S)))).map(S=>JSON.parse(S)),E={or:f};let m={};switch(s.pocketStyle){case"licorice":m={stick:{radius:.2}};break;case"stick":m={stick:{radius:.2}};break;case"ball+stick":m={stick:{radius:.2},sphere:{scale:.25}};break;default:m={stick:{radius:.2}};break}b.addStyle(E,m),b.removeAllLabels(),f.forEach(S=>{const w=n.find(M=>M.proteinAtom&&M.proteinAtom.resNo===S.resi&&M.proteinAtom.chain===S.chain),v=w?w.proteinAtom.resName:"",A=v?`${v} ${S.resi}`:`${S.resi}`;b.addLabel(A,{fontSize:11,fontColor:"#374151",backgroundColor:"white",backgroundOpacity:.85,inFront:!0,alignment:"center"},{resi:S.resi,chain:S.chain,atom:"CA"})})}}catch(h){console.error("Error rendering pocket:",h)}if(t){let h={};switch(s.ligandStyle){case"ball+stick":h={stick:{radius:.25,colorscheme:{prop:"elem",map:{C:s.ligandColor,N:"#3b82f6",O:"#ef4444",S:"#fbbf24",P:"#f97316",default:"#9ca3af"}}},sphere:{scale:.25,colorscheme:{prop:"elem",map:{C:s.ligandColor,N:"#3b82f6",O:"#ef4444",S:"#fbbf24",P:"#f97316",default:"#9ca3af"}}}};break;case"spacefill":h={sphere:{colorscheme:{prop:"elem",map:{C:s.ligandColor,N:"#3b82f6",O:"#ef4444",S:"#fbbf24",P:"#f97316",default:"#9ca3af"}}}};break;case"licorice":h={stick:{radius:.3,colorscheme:{prop:"elem",map:{C:s.ligandColor,N:"#3b82f6",O:"#ef4444",S:"#fbbf24",P:"#f97316",default:"#9ca3af"}}}};break}b.setStyle(_,h)}i&&n.length>0&&n.forEach(h=>{const f={x:h.proteinAtom.x,y:h.proteinAtom.y,z:h.proteinAtom.z},E={x:h.ligandAtom.x,y:h.ligandAtom.y,z:h.ligandAtom.z};let m="gray",S=!1;switch(h.type){case InteractionType.HydrogenBond:m="#3b82f6",S=!0;break;case InteractionType.SaltBridge:m="#eab308",S=!0;break;case InteractionType.PiStacking:m="#22c55e",S=!1;break;case InteractionType.Hydrophobic:m="#a3a3a3",S=!0;break;case InteractionType.HalogenBond:m="#a855f7",S=!0;break}b.addCylinder({start:f,end:E,radius:s.interactionWidth/20,color:m,dashed:S,fromCap:1,toCap:1})}),b.render(),t&&n.length>0&&setTimeout(()=>{b.zoomTo(_,500,1.5)},100)},[t,n,i,s]);const g=b=>{if(l.current){const _=b>0?.8:1.2;l.current.zoom(_)}},x=(b,_)=>{l.current&&l.current.translate(b,_)},y=b=>{if(b.stopPropagation(),l.current){const _=l.current.pngURI(),h=document.createElement("a");h.href=_,h.download="ligand_view.png",h.click()}};return r?jsxRuntimeExports.jsxs("div",{className:"relative w-full h-full bg-white overflow-hidden group shadow-inner rounded-lg",children:[d&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"animate-spin text-indigo-600",size:32}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Loading Structure..."})]})}),jsxRuntimeExports.jsx("div",{ref:a,className:"absolute inset-0 w-full h-full"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-4 right-4 flex flex-col gap-2 bg-white/95 p-2 rounded-lg shadow-md border border-slate-200 backdrop-blur-sm z-10",children:[jsxRuntimeExports.jsx("button",{onClick:()=>g(-5),className:"p-2 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Zoom In",children:jsxRuntimeExports.jsx(ZoomIn,{size:18})}),jsxRuntimeExports.jsx("button",{onClick:()=>g(5),className:"p-2 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Zoom Out",children:jsxRuntimeExports.jsx(ZoomOut,{size:18})}),jsxRuntimeExports.jsx("hr",{className:"border-slate-200 my-1"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-0.5",children:[jsxRuntimeExports.jsx("div",{className:"col-start-2",children:jsxRuntimeExports.jsx("button",{onClick:()=>x(0,20),className:"p-1.5 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Pan Up",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M8 3l4 4H4z"})})})}),jsxRuntimeExports.jsx("button",{onClick:()=>x(-20,0),className:"p-1.5 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors col-start-1 row-start-2",title:"Pan Left",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M3 8l4-4v8z"})})}),jsxRuntimeExports.jsx("button",{onClick:()=>x(20,0),className:"p-1.5 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors col-start-3 row-start-2",title:"Pan Right",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M13 8l-4 4V4z"})})}),jsxRuntimeExports.jsx("div",{className:"col-start-2 row-start-3",children:jsxRuntimeExports.jsx("button",{onClick:()=>x(0,-20),className:"p-1.5 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Pan Down",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M8 13l-4-4h8z"})})})})]}),jsxRuntimeExports.jsx("hr",{className:"border-slate-200 my-1"}),jsxRuntimeExports.jsx("button",{onClick:y,className:"p-2 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Snapshot",children:jsxRuntimeExports.jsx(Camera,{size:18})})]})]}):jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-400 bg-slate-50 border-dashed border-2 border-slate-200 rounded-lg select-none",children:[jsxRuntimeExports.jsx(Camera,{className:"w-12 h-12 mb-2 opacity-50"}),jsxRuntimeExports.jsx("p",{className:"font-medium",children:"3D Viewer (3Dmol)"}),jsxRuntimeExports.jsx("p",{className:"text-sm",children:"Upload a file to begin"})]})},InteractionTable=({interactions:r})=>{const e=()=>{const i=["ID","Type","Distance ()","Ligand Atom","Protein Atom","Residue"],s=r.map(u=>[u.id,u.type,u.distance.toFixed(2),`${u.ligandAtom.element}:${u.ligandAtom.name}`,`${u.proteinAtom.element}:${u.proteinAtom.name}`,`${u.proteinAtom.resName} ${u.proteinAtom.resNo}`]),o=[i.join(","),...s.map(u=>u.join(","))].join(`
`),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),d=document.createElement("a");d.setAttribute("href",l),d.setAttribute("download","interactions.csv"),d.click()},t=()=>{const i=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),s=URL.createObjectURL(i),o=document.createElement("a");o.setAttribute("href",s),o.setAttribute("download","interactions.json"),o.click()},n=reactExports.useMemo(()=>[...r].sort((i,s)=>i.type!==s.type?i.type.localeCompare(s.type):i.distance-s.distance),[r]);return r.length===0?jsxRuntimeExports.jsx("div",{className:"h-full flex items-center justify-center text-slate-400",children:jsxRuntimeExports.jsx("p",{children:"No interaction data available."})}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col h-full",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 py-2 bg-white border-b border-slate-100 flex justify-end gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:e,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-slate-100 border border-slate-300 rounded hover:bg-slate-200 text-slate-700",children:[jsxRuntimeExports.jsx(Download,{size:12})," Export CSV"]}),jsxRuntimeExports.jsxs("button",{onClick:t,className:"flex items-center gap-1 px-2 py-1 text-xs font-medium bg-slate-100 border border-slate-300 rounded hover:bg-slate-200 text-slate-700",children:[jsxRuntimeExports.jsx(FileBraces,{size:12})," Export JSON"]})]}),jsxRuntimeExports.jsx("div",{className:"overflow-auto flex-1 bg-white",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm text-left text-slate-600",children:[jsxRuntimeExports.jsx("thead",{className:"text-xs text-slate-700 uppercase bg-slate-50 sticky top-0 z-10 shadow-sm",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-4 py-2 border-b",children:"Type"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-2 border-b",children:"Dist ()"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-2 border-b",children:"Ligand Atom"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-2 border-b",children:"Protein Res"}),jsxRuntimeExports.jsx("th",{className:"px-4 py-2 border-b",children:"Protein Atom"})]})}),jsxRuntimeExports.jsx("tbody",{className:"divide-y divide-slate-100",children:n.map(i=>{let s="bg-slate-100 text-slate-800";return i.type===InteractionType.HydrogenBond&&(s="bg-blue-50 text-blue-700 border border-blue-100"),i.type===InteractionType.Hydrophobic&&(s="bg-orange-50 text-orange-700 border border-orange-100"),i.type===InteractionType.SaltBridge&&(s="bg-yellow-50 text-yellow-700 border border-yellow-100"),i.type===InteractionType.HalogenBond&&(s="bg-purple-50 text-purple-700 border border-purple-100"),jsxRuntimeExports.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-2",children:jsxRuntimeExports.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wide ${s}`,children:i.type})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-2 font-mono text-slate-900 font-medium",children:i.distance.toFixed(2)}),jsxRuntimeExports.jsxs("td",{className:"px-4 py-2 text-slate-600",children:[i.ligandAtom.name," ",jsxRuntimeExports.jsxs("span",{className:"text-slate-400 text-xs",children:["(",i.ligandAtom.element,")"]})]}),jsxRuntimeExports.jsxs("td",{className:"px-4 py-2 font-medium text-slate-800",children:[i.proteinAtom.resName," ",i.proteinAtom.resNo," ",jsxRuntimeExports.jsxs("span",{className:"text-slate-400 font-normal",children:["(",i.proteinAtom.chain,")"]})]}),jsxRuntimeExports.jsx("td",{className:"px-4 py-2 text-slate-600",children:i.proteinAtom.name})]},i.id)})})]})})]})},HelpPage=({onBack:r})=>jsxRuntimeExports.jsxs("div",{className:"h-screen bg-slate-100 flex flex-col font-sans text-slate-900 overflow-hidden",children:[jsxRuntimeExports.jsx("header",{className:"bg-white border-b border-slate-200 shrink-0 h-14 flex items-center justify-between px-6 z-40 shadow-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-slate-600 hover:text-indigo-600 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{size:18}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"Back"})]}),jsxRuntimeExports.jsxs("h1",{className:"text-lg font-bold text-slate-800",children:["LigPlot",jsxRuntimeExports.jsx("span",{className:"text-indigo-600",children:"3D"}),"  Documentation"]})]})}),jsxRuntimeExports.jsx("main",{className:"flex-1 overflow-auto p-6",children:jsxRuntimeExports.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-3",children:"About LigPlot3D"}),jsxRuntimeExports.jsx("p",{className:"text-slate-600 leading-relaxed",children:"LigPlot3D is a web-based tool for analyzing and visualizing protein-ligand interactions from molecular docking studies. It uses geometric algorithms inspired by PLIP (Protein-Ligand Interaction Profiler) to detect and classify different types of non-covalent interactions."})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Interaction Detection"}),jsxRuntimeExports.jsx("p",{className:"text-slate-600 mb-4",children:"All interactions are detected using distance and angle-based geometric criteria. The following table summarizes the thresholds used:"}),jsxRuntimeExports.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm",children:[jsxRuntimeExports.jsx("thead",{className:"bg-slate-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Interaction Type"}),jsxRuntimeExports.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Distance Cutoff"}),jsxRuntimeExports.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Additional Criteria"})]})}),jsxRuntimeExports.jsxs("tbody",{className:"bg-white divide-y divide-slate-100",children:[jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-medium",children:"Hydrogen Bond"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 3.5 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Between donor (N, O, S) and acceptor atoms. DonorHAcceptor angle  120."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-yellow-50 text-yellow-700 rounded text-xs font-medium",children:"Salt Bridge"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 4.0 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Between charged heavy atoms: ARG/LYS/HIS (positive)  ASP/GLU or ligand carboxyl/phosphate/sulfate (negative)."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-orange-50 text-orange-700 rounded text-xs font-medium",children:"Hydrophobic"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 4.5 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Nonpolar carboncarbon contacts (aliphatic or aromatic)."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded text-xs font-medium",children:"Pi-Stacking"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 5.5 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Centroidcentroid distance. Parallel: angle < 30. T-shaped: angle 60120."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-purple-50 text-purple-700 rounded text-xs font-medium",children:"Halogen Bond"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 3.5 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Between halogen (Cl, Br, I) on ligand and acceptor (N, O, S). CXA angle  140."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-slate-100 text-slate-700 rounded text-xs font-medium",children:"Metal Coordination"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 2.8 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Involving metal ions (Zn, Mg, Fe, Cu, Ca, Na, K, Mn, Co, Ni). Distance varies by metal type."})]})]})]})})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"How Detection Works"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 text-slate-600",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"1. Ligand Identification"}),jsxRuntimeExports.jsx("p",{children:"Heteroatoms (HETATM records) are scanned to identify potential ligands. Common residues like water (HOH), ions (NA, CL, CA), and buffers are excluded. Common ligand names (LIG, UNK, DRG) are prioritized."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"2. Binding Pocket Detection"}),jsxRuntimeExports.jsx("p",{children:"All protein atoms within 18  of the ligand center are considered for interaction analysis. This creates a sphere around the ligand for efficient computation."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"3. Ring Detection"}),jsxRuntimeExports.jsx("p",{children:"For Pi-stacking, aromatic rings in the ligand are detected using a geometric DFS algorithm that identifies 56 membered rings based on bond lengths (< 1.65 )."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"4. Deduplication"}),jsxRuntimeExports.jsx("p",{children:"If multiple interaction types are detected for the same atom pair, only the strongest is kept. Priority: Salt Bridge > Pi-Stacking > Hydrogen Bond > Hydrophobic."})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Export File Formats"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"CSV Export"}),jsxRuntimeExports.jsx("p",{className:"text-slate-600 mb-2",children:"Comma-separated values with the following columns:"}),jsxRuntimeExports.jsx("code",{className:"block bg-slate-50 p-3 rounded text-sm font-mono text-slate-700",children:"ID, Type, Distance (), Ligand Atom, Protein Atom, Residue"}),jsxRuntimeExports.jsxs("p",{className:"text-slate-500 text-sm mt-2",children:["Example: ",jsxRuntimeExports.jsx("code",{children:"hb-0, Hydrogen Bond, 2.45, O:O1, N:NH1, ARG 42"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"JSON Export"}),jsxRuntimeExports.jsx("p",{className:"text-slate-600 mb-2",children:"Full interaction data as JSON array. Each object contains:"}),jsxRuntimeExports.jsx("pre",{className:"bg-slate-50 p-3 rounded text-sm font-mono text-slate-700 overflow-x-auto",children:`{
  "id": "hb-0",
  "type": "Hydrogen Bond",
  "distance": 2.45,
  "ligandAtom": {
    "index": 145,
    "name": "O1",
    "element": "O",
    "x": 12.34, "y": 5.67, "z": 8.90,
    "resName": "LIG",
    "resNo": 1,
    "chain": "A"
  },
  "proteinAtom": {
    "index": 234,
    "name": "NH1",
    "element": "N",
    "x": 10.12, "y": 4.56, "z": 7.89,
    "resName": "ARG",
    "resNo": 42,
    "chain": "A"
  }
}`})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Residue Classifications"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Hydrophobic Residues"}),jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-600",children:"ALA, VAL, LEU, ILE, MET, PHE, TRP, PRO, CYS"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Aromatic Residues"}),jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-600",children:"PHE, TYR, TRP, HIS"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Positively Charged"}),jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-600",children:"ARG, LYS, HIS"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Negatively Charged"}),jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-600",children:"ASP, GLU"})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Limitations"}),jsxRuntimeExports.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[jsxRuntimeExports.jsx("li",{children:"Hydrogen atoms are often missing from PDB files; H-bond detection uses heavy-atom distances."}),jsxRuntimeExports.jsx("li",{children:"Water-mediated hydrogen bonds are not currently detected."}),jsxRuntimeExports.jsx("li",{children:"Covalent bonds between ligand and protein are not analyzed."}),jsxRuntimeExports.jsx("li",{children:"Angle criteria for H-bonds may be relaxed when hydrogen positions are unavailable."})]})]}),jsxRuntimeExports.jsxs("section",{className:"pb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"References"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-2 text-slate-600",children:[jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"PLIP:"})," Salentin et al. (2015). PLIP: fully automated protein-ligand interaction profiler. ",jsxRuntimeExports.jsx("em",{children:"Nucleic Acids Research"}),"."]}),jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"NGL Viewer:"})," Rose et al. (2018). NGL viewer: web-based molecular graphics for large complexes. ",jsxRuntimeExports.jsx("em",{children:"Bioinformatics"}),"."]}),jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"3Dmol.js:"})," Rego & Koes (2015). 3Dmol.js: molecular visualization with WebGL. ",jsxRuntimeExports.jsx("em",{children:"Bioinformatics"}),"."]})]})]})]})})]}),THRESHOLDS={HBOND_DIST:3.5,SALT_BRIDGE_DIST:4,HYDROPHOBIC_DIST:4.5,PI_STACKING_DIST:5.5,PI_STACKING_ANGLE_PARALLEL:30,PI_STACKING_ANGLE_TSHAPED:60,PI_CATION_DIST:5,HALOGEN_DIST:3.5,METAL_DIST:2.8},COMMON_LIGANDS=new Set(["LIG","UNK","DRG","INH","001","1"]),IGNORED_RESIDUES=new Set(["HOH","DOD","TIP","WAT","SOL","NA","CL","K","MG","ZN","CA","MN","SO4","PO4"]),ATOM_PROPS={POS_CHARGE_ATOMS:{ARG:["NH1","NH2","CZ"],LYS:["NZ"],HIS:["ND1","NE2"]},NEG_CHARGE_ATOMS:{ASP:["OD1","OD2"],GLU:["OE1","OE2"]},AROMATIC_PLANES:{PHE:["CG","CD1","CD2","CE1","CE2","CZ"],TYR:["CG","CD1","CD2","CE1","CE2","CZ"],TRP:["CG","CD1","CD2","NE1","CE2","CE3","CZ2","CZ3","CH2"],HIS:["CG","ND1","CD2","CE1","NE2"]},DONORS:new Set(["N","O","S"]),ACCEPTORS:new Set(["N","O","S"]),HALOGENS:new Set(["CL","BR","I"]),METALS:new Set(["ZN","MG","FE","CU","CA","NA","K","MN","CO","NI"])},distance=(r,e)=>{const t=r.x-e.x,n=r.y-e.y,i=r.z-e.z;return Math.sqrt(t*t+n*n+i*i)},getCenter=r=>{if(r.length===0)return{x:0,y:0,z:0};let e=0,t=0,n=0;return r.forEach(i=>{e+=i.x,t+=i.y,n+=i.z}),{x:e/r.length,y:t/r.length,z:n/r.length}},sub=(r,e)=>({x:r.x-e.x,y:r.y-e.y,z:r.z-e.z}),dot=(r,e)=>r.x*e.x+r.y*e.y+r.z*e.z,cross=(r,e)=>({x:r.y*e.z-r.z*e.y,y:r.z*e.x-r.x*e.z,z:r.x*e.y-r.y*e.x}),mag=r=>Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z),normalize=r=>{const e=mag(r);return e===0?{x:0,y:0,z:0}:{x:r.x/e,y:r.y/e,z:r.z/e}},angleBetween=(r,e)=>{const t=dot(r,e),n=mag(r),i=mag(e);if(n===0||i===0)return 0;const s=Math.max(-1,Math.min(1,Math.abs(t)/(n*i)));return Math.acos(s)*180/Math.PI},getPlaneNormal=r=>{if(r.length<3)return{x:0,y:0,z:1};const e=r[0],t=r[Math.floor(r.length/2)],n=r[r.length-1],i=sub(t,e),s=sub(n,e);return normalize(cross(i,s))},parseNGLAtom=r=>({index:r.index,name:r.atomname,element:r.element,x:r.x,y:r.y,z:r.z,resName:r.resname,resNo:r.resno,chain:r.chainname,isHet:r.isHetero()}),findLigandRings=r=>{if(!r||r.length===0)return[];const e=[],t=r.map(()=>[]);for(let s=0;s<r.length;s++)for(let o=s+1;o<r.length;o++)distance(r[s],r[o])<1.65&&(t[s].push(o),t[o].push(s));const n=new Set,i=(s,o,a)=>{if(!(a.length>6)){if(a.length>=5&&t[o].includes(s)){const d=[...a].sort((u,g)=>u-g).join(",");n.has(d)||(n.add(d),e.push(a.map(u=>r[u])));return}for(const l of t[o])a.includes(l)||i(s,l,[...a,l])}};for(let s=0;s<r.length;s++)["C","N"].includes(r[s].element)&&i(s,s,[s]);return e},getLigandCandidates=r=>{const e=new Map;return r.eachResidue(t=>{const n=t.resname.toUpperCase(),i=COMMON_LIGANDS.has(n),s=t.isHetero(),o=IGNORED_RESIDUES.has(n);if(i||s&&!o){const a=`${t.chainname}:${t.resno}`;e.has(a)||e.set(a,{resName:t.resname,resNo:t.resno,chain:t.chainname,atomCount:t.atomCount})}}),Array.from(e.values()).sort((t,n)=>{const i=COMMON_LIGANDS.has(t.resName.toUpperCase()),s=COMMON_LIGANDS.has(n.resName.toUpperCase());return i&&!s?-1:!i&&s?1:n.atomCount-t.atomCount})},findResidueByName=(r,e)=>{let t=null;const n=e.toUpperCase().trim();return r.eachResidue(i=>{t||i.resname.toUpperCase()===n&&(t={resName:i.resname,resNo:i.resno,chain:i.chainname,atomCount:i.atomCount})}),t},analyzeInteractions=(r,e)=>{const t=[],n=[],i=[];if(r.eachAtom(x=>{x.resno===e.resNo&&x.chainname===e.chain&&x.resname===e.resName?n.push(parseNGLAtom(x)):x.isHetero()||i.push(parseNGLAtom(x))}),n.length===0)return{interactions:[],ligandCenter:{x:0,y:0,z:0}};const s=getCenter(n);let o=0;const a=i.filter(x=>distance(x,s)<18),l={};a.forEach(x=>{const y=`${x.chain}:${x.resNo}`;l[y]||(l[y]=[]),l[y].push(x)});const u=findLigandRings(n).map(x=>({center:getCenter(x),normal:getPlaneNormal(x),atoms:x}));Object.values(l).forEach(x=>{const y=x[0].resName,b=ATOM_PROPS.AROMATIC_PLANES[y];if(b){const f=x.filter(E=>b.includes(E.name));if(f.length>=3){const E=getCenter(f),m=getPlaneNormal(f);u.forEach(S=>{const w=distance(E,S.center);if(w<=THRESHOLDS.PI_STACKING_DIST){const v=angleBetween(m,S.normal),A=v<THRESHOLDS.PI_STACKING_ANGLE_PARALLEL||v>180-THRESHOLDS.PI_STACKING_ANGLE_PARALLEL,M=v>THRESHOLDS.PI_STACKING_ANGLE_TSHAPED&&v<120;(A||M)&&t.push({id:`pi-${o++}`,type:InteractionType.PiStacking,distance:w,ligandAtom:S.atoms[0],proteinAtom:f[0],angle:v})}}),n.forEach(S=>{(S.element==="N"||S.name.includes("NH"))&&distance(S,E)<THRESHOLDS.PI_CATION_DIST&&t.push({id:`pic-${o++}`,type:InteractionType.PiStacking,distance:distance(S,E),ligandAtom:S,proteinAtom:f[0]})})}}const _=ATOM_PROPS.POS_CHARGE_ATOMS[y],h=ATOM_PROPS.NEG_CHARGE_ATOMS[y];if(_){const f=x.filter(E=>_.includes(E.name));if(f.length>0){const E=getCenter(f);u.forEach(m=>{distance(E,m.center)<THRESHOLDS.PI_CATION_DIST&&t.push({id:`pic-${o++}`,type:InteractionType.PiStacking,distance:distance(E,m.center),ligandAtom:m.atoms[0],proteinAtom:f[0]})}),n.forEach(m=>{if(["O","S","P"].includes(m.element)){const S=distance(m,E);S<THRESHOLDS.SALT_BRIDGE_DIST&&t.push({id:`sb-${o++}`,type:InteractionType.SaltBridge,distance:S,ligandAtom:m,proteinAtom:f[0]})}})}}if(h){const f=x.filter(E=>h.includes(E.name));if(f.length>0){const E=getCenter(f);n.forEach(m=>{if(m.element==="N"||m.name.includes("NH")){const S=distance(m,E);S<THRESHOLDS.SALT_BRIDGE_DIST&&t.push({id:`sb-${o++}`,type:InteractionType.SaltBridge,distance:S,ligandAtom:m,proteinAtom:f[0]})}})}}}),n.forEach(x=>{a.forEach(y=>{const b=distance(x,y);if(!(b>Math.max(THRESHOLDS.HBOND_DIST,THRESHOLDS.HYDROPHOBIC_DIST))){if(b<=THRESHOLDS.HBOND_DIST){const _=ATOM_PROPS.DONORS.has(x.element),h=ATOM_PROPS.ACCEPTORS.has(x.element),f=ATOM_PROPS.DONORS.has(y.element),E=ATOM_PROPS.ACCEPTORS.has(y.element);(_&&E||h&&f)&&t.push({id:`hb-${o++}`,type:InteractionType.HydrogenBond,distance:b,ligandAtom:x,proteinAtom:y})}ATOM_PROPS.HALOGENS.has(x.element.toUpperCase())&&ATOM_PROPS.ACCEPTORS.has(y.element)&&b<=THRESHOLDS.HALOGEN_DIST&&t.push({id:`xb-${o++}`,type:InteractionType.HalogenBond,distance:b,ligandAtom:x,proteinAtom:y}),x.element==="C"&&y.element==="C"&&b<=THRESHOLDS.HYDROPHOBIC_DIST&&t.push({id:`hp-${o++}`,type:InteractionType.Hydrophobic,distance:b,ligandAtom:x,proteinAtom:y}),(ATOM_PROPS.METALS.has(x.element.toUpperCase())||ATOM_PROPS.METALS.has(y.element.toUpperCase()))&&b<=THRESHOLDS.METAL_DIST&&t.push({id:`mt-${o++}`,type:InteractionType.MetalCoordination,distance:b,ligandAtom:x,proteinAtom:y})}})});const g=new Map;return t.forEach(x=>{const y=`${x.ligandAtom.index}-${x.proteinAtom.index}`,b=g.get(y);if(!b)g.set(y,x);else{const _=h=>h===InteractionType.SaltBridge?4:h===InteractionType.PiStacking?3:h===InteractionType.HydrogenBond?2:1;_(x.type)>_(b.type)&&g.set(y,x)}}),{interactions:Array.from(g.values()),ligandCenter:s}},App=()=>{const[r,e]=reactExports.useState(null),[t,n]=reactExports.useState(null),[i,s]=reactExports.useState([]),[o,a]=reactExports.useState(null),[l,d]=reactExports.useState(null),[u]=reactExports.useState(!0),[g,x]=reactExports.useState(""),[y,b]=reactExports.useState(!1),[_,h]=reactExports.useState({[InteractionType.HydrogenBond]:!0,[InteractionType.SaltBridge]:!0,[InteractionType.Hydrophobic]:!0,[InteractionType.PiStacking]:!1,[InteractionType.HalogenBond]:!1,[InteractionType.MetalCoordination]:!1,[InteractionType.Unknown]:!1}),f=reactExports.useRef(null),[E,m]=reactExports.useState({proteinStyle:"cartoon",ligandStyle:"ball+stick",pocketStyle:"stick",interactionWidth:2,ligandColor:"#22c55e"}),[S,w]=reactExports.useState(0),v=[".pdb",".ent",".cif",".sdf",".mol2"],A=P=>{if(P.target.files&&P.target.files[0]){const I=P.target.files[0],N=I.name.toLowerCase();if(!v.some(F=>N.endsWith(F))){alert(`Unsupported file format. Please upload a molecular structure file.

Supported formats: ${v.join(", ")}`),f.current&&(f.current.value="");return}e(I),n(null),s([]),a(null),d(null)}},M=()=>{e(null),n(null),s([]),a(null),d(null),x(""),f.current&&(f.current.value="")},T=reactExports.useCallback(P=>{n(P);const I=getLigandCandidates(P);s(I),I.length>0&&a(I[0])},[]),R=()=>{if(!t||!g)return;const P=findResidueByName(t,g);P?(s(I=>I.some(U=>U.chain===P.chain&&U.resNo===P.resNo)?I:[P,...I]),a(P)):alert(`Residue '${g}' not found.`)};reactExports.useEffect(()=>{if(t&&o){const P=analyzeInteractions(t,o);d(P)}},[t,o]);const O=reactExports.useMemo(()=>l?l.interactions.filter(P=>_[P.type]):[],[l,_]),L=P=>{h(I=>({...I,[P]:!I[P]}))};return jsxRuntimeExports.jsxs("div",{className:"h-screen bg-slate-100 flex flex-col font-sans text-slate-900 overflow-hidden selection:bg-indigo-100",style:{maxWidth:"100%",width:"100%"},children:[jsxRuntimeExports.jsxs("header",{className:"bg-white border-b border-slate-200 shrink-0 h-14 flex items-center justify-between px-6 z-40 shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-slate-800",children:"LigPlot3D"})}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-2 px-3 py-1.5 text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-md text-sm font-medium transition-colors",children:[jsxRuntimeExports.jsx(CircleQuestionMark,{size:14})," Help"]}),r&&jsxRuntimeExports.jsxs("button",{onClick:M,className:"flex items-center gap-2 px-3 py-1.5 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-md text-sm font-medium transition-colors",children:[jsxRuntimeExports.jsx(RefreshCw,{size:14})," New Analysis"]}),jsxRuntimeExports.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-2 px-4 py-1.5 bg-slate-600 hover:bg-slate-700 text-white rounded-md text-sm font-medium transition-all shadow-sm",children:[jsxRuntimeExports.jsx(Upload,{size:14}),jsxRuntimeExports.jsx("span",{children:"Upload Structure"}),jsxRuntimeExports.jsx("input",{ref:f,type:"file",accept:".pdb,.ent,.cif,.sdf,.mol2",onChange:A,className:"hidden"})]})]})]}),y?jsxRuntimeExports.jsx(HelpPage,{onBack:()=>b(!1)}):jsxRuntimeExports.jsxs("main",{className:"flex-1 w-full flex flex-col lg:flex-row overflow-hidden",children:[jsxRuntimeExports.jsx("aside",{className:"w-full lg:w-80 bg-white border-r border-slate-200 flex flex-col shrink-0 z-30 overflow-y-auto",children:jsxRuntimeExports.jsxs("div",{className:"p-4 flex flex-col gap-6",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 rounded-lg border border-slate-200 p-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xs font-bold uppercase text-slate-500 mb-3 flex items-center gap-2",children:"Target Selection"}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Ligand"}),jsxRuntimeExports.jsxs("select",{className:"w-full border-slate-300 rounded text-sm p-2 border bg-white focus:ring-2 focus:ring-indigo-500 outline-none",value:o?`${o.chain}:${o.resNo}`:"",onChange:P=>{const[I,N]=P.target.value.split(":"),U=i.find(F=>F.chain===I&&F.resNo===parseInt(N));U&&a(U)},disabled:i.length===0,children:[i.map(P=>jsxRuntimeExports.jsxs("option",{value:`${P.chain}:${P.resNo}`,children:[P.resName," ",P.resNo," (Chain ",P.chain,")"]},`${P.chain}:${P.resNo}`)),i.length===0&&jsxRuntimeExports.jsx("option",{children:"No ligands found"})]})]}),jsxRuntimeExports.jsx("div",{className:"pt-3 border-t border-slate-200",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("input",{type:"text",className:"flex-1 border border-slate-300 rounded text-sm px-2 py-1",placeholder:"Search residue (e.g. LIG)",value:g,onChange:P=>x(P.target.value),onKeyDown:P=>P.key==="Enter"&&R()}),jsxRuntimeExports.jsx("button",{onClick:R,className:"px-3 py-1 bg-white border border-slate-300 hover:bg-slate-100 rounded text-sm shadow-sm",children:jsxRuntimeExports.jsx(Search,{size:14})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 rounded-lg border border-slate-200 p-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xs font-bold uppercase text-slate-500 mb-3",children:"Visualization"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Protein"}),jsxRuntimeExports.jsxs("select",{className:"w-full text-xs border p-1 rounded",value:E.proteinStyle,onChange:P=>m({...E,proteinStyle:P.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"cartoon",children:"Cartoon"}),jsxRuntimeExports.jsx("option",{value:"rope",children:"Rope"}),jsxRuntimeExports.jsx("option",{value:"line",children:"Lines"}),jsxRuntimeExports.jsx("option",{value:"hidden",children:"Hidden"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Ligand"}),jsxRuntimeExports.jsxs("select",{className:"w-full text-xs border p-1 rounded",value:E.ligandStyle,onChange:P=>m({...E,ligandStyle:P.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"ball+stick",children:"Ball & Stick"}),jsxRuntimeExports.jsx("option",{value:"licorice",children:"Licorice"}),jsxRuntimeExports.jsx("option",{value:"spacefill",children:"Spacefill"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Ligand Color"}),jsxRuntimeExports.jsx("input",{type:"color",value:E.ligandColor,onChange:P=>m({...E,ligandColor:P.target.value}),className:"w-full h-8 border rounded cursor-pointer",title:"Change ligand carbon color"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Pocket Residues"}),jsxRuntimeExports.jsxs("select",{className:"w-full text-xs border p-1 rounded",value:E.pocketStyle,onChange:P=>m({...E,pocketStyle:P.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"stick",children:"Stick"}),jsxRuntimeExports.jsx("option",{value:"licorice",children:"Licorice"}),jsxRuntimeExports.jsx("option",{value:"ball+stick",children:"Ball & Stick"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Interaction Line Width"}),jsxRuntimeExports.jsx("input",{type:"range",min:"1",max:"8",step:"1",value:E.interactionWidth,onChange:P=>m({...E,interactionWidth:parseInt(P.target.value)}),className:"w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 rounded-lg border border-slate-200 p-4",children:[jsxRuntimeExports.jsxs("h2",{className:"text-xs font-bold uppercase text-slate-500 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Funnel,{size:14})," Interaction Filters"]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:[{type:InteractionType.HydrogenBond,color:"bg-blue-500",label:"H-Bonds"},{type:InteractionType.SaltBridge,color:"bg-yellow-500",label:"Salt Bridges"},{type:InteractionType.PiStacking,color:"bg-green-600",label:"Pi-Stacking"},{type:InteractionType.Hydrophobic,color:"bg-slate-400",label:"Hydrophobic"},{type:InteractionType.HalogenBond,color:"bg-purple-600",label:"Halogen Bonds"}].map(P=>jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-700 cursor-pointer hover:bg-slate-100 p-1 rounded -mx-1 transition-colors",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:_[P.type],onChange:()=>L(P.type),className:"rounded text-indigo-600 focus:ring-0"}),jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${P.color}`}),jsxRuntimeExports.jsx("span",{children:P.label})]},P.type))})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>w(P=>P+1),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-slate-300 rounded text-sm font-medium hover:bg-slate-100 text-slate-700",children:[jsxRuntimeExports.jsx(Move,{size:14})," Recenter View"]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 w-full flex flex-col overflow-hidden relative",children:[jsxRuntimeExports.jsx("div",{className:"flex-[2] w-full relative border-b border-slate-200 bg-white min-h-0",children:jsxRuntimeExports.jsx(Viewer3Dmol,{file:r,onStructureLoaded:T,selectedLigand:o,interactions:O,showInteractions:u,visualSettings:E,triggerRecenter:S},r?r.name:"empty")}),jsxRuntimeExports.jsxs("div",{className:"flex-[1] w-full overflow-hidden flex flex-col bg-white min-h-0",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 px-4 py-2 border-b border-slate-200 flex items-center gap-2 text-sm font-bold text-slate-700 shrink-0",children:[jsxRuntimeExports.jsx(Table,{size:16})," Interaction Data"]}),jsxRuntimeExports.jsx("div",{className:"flex-1 overflow-auto",children:jsxRuntimeExports.jsx(InteractionTable,{interactions:O})})]})]})]})]})};clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
