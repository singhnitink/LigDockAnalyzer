(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var jsxRuntime={exports:{}},reactJsxRuntime_production={};var hasRequiredReactJsxRuntime_production;function requireReactJsxRuntime_production(){if(hasRequiredReactJsxRuntime_production)return reactJsxRuntime_production;hasRequiredReactJsxRuntime_production=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var a in i)a!=="key"&&(s[a]=i[a])}else s=i;return i=s.ref,{$$typeof:r,type:n,key:o,ref:i!==void 0?i:null,props:s}}return reactJsxRuntime_production.Fragment=e,reactJsxRuntime_production.jsx=t,reactJsxRuntime_production.jsxs=t,reactJsxRuntime_production}var hasRequiredJsxRuntime;function requireJsxRuntime(){return hasRequiredJsxRuntime||(hasRequiredJsxRuntime=1,jsxRuntime.exports=requireReactJsxRuntime_production()),jsxRuntime.exports}var jsxRuntimeExports=requireJsxRuntime(),react={exports:{}},react_production={};var hasRequiredReact_production;function requireReact_production(){if(hasRequiredReact_production)return react_production;hasRequiredReact_production=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),u=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),x=Symbol.iterator;function y(B){return B===null||typeof B!="object"?null:(B=x&&B[x]||B["@@iterator"],typeof B=="function"?B:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,h={};function f(B,V,K){this.props=B,this.context=V,this.refs=h,this.updater=K||b}f.prototype.isReactComponent={},f.prototype.setState=function(B,V){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,V,"setState")},f.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function E(){}E.prototype=f.prototype;function m(B,V,K){this.props=B,this.context=V,this.refs=h,this.updater=K||b}var S=m.prototype=new E;S.constructor=m,_(S,f.prototype),S.isPureReactComponent=!0;var w=Array.isArray;function v(){}var A={H:null,A:null,T:null,S:null},M=Object.prototype.hasOwnProperty;function T(B,V,K){var q=K.ref;return{$$typeof:r,type:B,key:V,ref:q!==void 0?q:null,props:K}}function R(B,V){return T(B.type,V,B.props)}function P(B){return typeof B=="object"&&B!==null&&B.$$typeof===r}function L(B){var V={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(K){return V[K]})}var O=/\/+/g;function I(B,V){return typeof B=="object"&&B!==null&&B.key!=null?L(""+B.key):V.toString(36)}function N(B){switch(B.status){case"fulfilled":return B.value;case"rejected":throw B.reason;default:switch(typeof B.status=="string"?B.then(v,v):(B.status="pending",B.then(function(V){B.status==="pending"&&(B.status="fulfilled",B.value=V)},function(V){B.status==="pending"&&(B.status="rejected",B.reason=V)})),B.status){case"fulfilled":return B.value;case"rejected":throw B.reason}}throw B}function k(B,V,K,q,Te){var Fe=typeof B;(Fe==="undefined"||Fe==="boolean")&&(B=null);var We=!1;if(B===null)We=!0;else switch(Fe){case"bigint":case"string":case"number":We=!0;break;case"object":switch(B.$$typeof){case r:case e:We=!0;break;case u:return We=B._init,k(We(B._payload),V,K,q,Te)}}if(We)return Te=Te(B),We=q===""?"."+I(B,0):q,w(Te)?(K="",We!=null&&(K=We.replace(O,"$&/")+"/"),k(Te,V,K,"",function(ht){return ht})):Te!=null&&(P(Te)&&(Te=R(Te,K+(Te.key==null||B&&B.key===Te.key?"":(""+Te.key).replace(O,"$&/")+"/")+We)),V.push(Te)),1;We=0;var J=q===""?".":q+":";if(w(B))for(var et=0;et<B.length;et++)q=B[et],Fe=J+I(q,et),We+=k(q,V,K,Fe,Te);else if(et=y(B),typeof et=="function")for(B=et.call(B),et=0;!(q=B.next()).done;)q=q.value,Fe=J+I(q,et++),We+=k(q,V,K,Fe,Te);else if(Fe==="object"){if(typeof B.then=="function")return k(N(B),V,K,q,Te);throw V=String(B),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return We}function U(B,V,K){if(B==null)return B;var q=[],Te=0;return k(B,q,"","",function(Fe){return V.call(K,Fe,Te++)}),q}function F(B){if(B._status===-1){var V=B._result;V=V(),V.then(function(K){(B._status===0||B._status===-1)&&(B._status=1,B._result=K)},function(K){(B._status===0||B._status===-1)&&(B._status=2,B._result=K)}),B._status===-1&&(B._status=0,B._result=V)}if(B._status===1)return B._result.default;throw B._result}var j=typeof reportError=="function"?reportError:function(B){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof B=="object"&&B!==null&&typeof B.message=="string"?String(B.message):String(B),error:B});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",B);return}console.error(B)},H={map:U,forEach:function(B,V,K){U(B,function(){V.apply(this,arguments)},K)},count:function(B){var V=0;return U(B,function(){V++}),V},toArray:function(B){return U(B,function(V){return V})||[]},only:function(B){if(!P(B))throw Error("React.Children.only expected to receive a single React element child.");return B}};return react_production.Activity=g,react_production.Children=H,react_production.Component=f,react_production.Fragment=t,react_production.Profiler=i,react_production.PureComponent=m,react_production.StrictMode=n,react_production.Suspense=l,react_production.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,react_production.__COMPILER_RUNTIME={__proto__:null,c:function(B){return A.H.useMemoCache(B)}},react_production.cache=function(B){return function(){return B.apply(null,arguments)}},react_production.cacheSignal=function(){return null},react_production.cloneElement=function(B,V,K){if(B==null)throw Error("The argument must be a React element, but you passed "+B+".");var q=_({},B.props),Te=B.key;if(V!=null)for(Fe in V.key!==void 0&&(Te=""+V.key),V)!M.call(V,Fe)||Fe==="key"||Fe==="__self"||Fe==="__source"||Fe==="ref"&&V.ref===void 0||(q[Fe]=V[Fe]);var Fe=arguments.length-2;if(Fe===1)q.children=K;else if(1<Fe){for(var We=Array(Fe),J=0;J<Fe;J++)We[J]=arguments[J+2];q.children=We}return T(B.type,Te,q)},react_production.createContext=function(B){return B={$$typeof:o,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null},B.Provider=B,B.Consumer={$$typeof:s,_context:B},B},react_production.createElement=function(B,V,K){var q,Te={},Fe=null;if(V!=null)for(q in V.key!==void 0&&(Fe=""+V.key),V)M.call(V,q)&&q!=="key"&&q!=="__self"&&q!=="__source"&&(Te[q]=V[q]);var We=arguments.length-2;if(We===1)Te.children=K;else if(1<We){for(var J=Array(We),et=0;et<We;et++)J[et]=arguments[et+2];Te.children=J}if(B&&B.defaultProps)for(q in We=B.defaultProps,We)Te[q]===void 0&&(Te[q]=We[q]);return T(B,Fe,Te)},react_production.createRef=function(){return{current:null}},react_production.forwardRef=function(B){return{$$typeof:a,render:B}},react_production.isValidElement=P,react_production.lazy=function(B){return{$$typeof:u,_payload:{_status:-1,_result:B},_init:F}},react_production.memo=function(B,V){return{$$typeof:d,type:B,compare:V===void 0?null:V}},react_production.startTransition=function(B){var V=A.T,K={};A.T=K;try{var q=B(),Te=A.S;Te!==null&&Te(K,q),typeof q=="object"&&q!==null&&typeof q.then=="function"&&q.then(v,j)}catch(Fe){j(Fe)}finally{V!==null&&K.types!==null&&(V.types=K.types),A.T=V}},react_production.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},react_production.use=function(B){return A.H.use(B)},react_production.useActionState=function(B,V,K){return A.H.useActionState(B,V,K)},react_production.useCallback=function(B,V){return A.H.useCallback(B,V)},react_production.useContext=function(B){return A.H.useContext(B)},react_production.useDebugValue=function(){},react_production.useDeferredValue=function(B,V){return A.H.useDeferredValue(B,V)},react_production.useEffect=function(B,V){return A.H.useEffect(B,V)},react_production.useEffectEvent=function(B){return A.H.useEffectEvent(B)},react_production.useId=function(){return A.H.useId()},react_production.useImperativeHandle=function(B,V,K){return A.H.useImperativeHandle(B,V,K)},react_production.useInsertionEffect=function(B,V){return A.H.useInsertionEffect(B,V)},react_production.useLayoutEffect=function(B,V){return A.H.useLayoutEffect(B,V)},react_production.useMemo=function(B,V){return A.H.useMemo(B,V)},react_production.useOptimistic=function(B,V){return A.H.useOptimistic(B,V)},react_production.useReducer=function(B,V,K){return A.H.useReducer(B,V,K)},react_production.useRef=function(B){return A.H.useRef(B)},react_production.useState=function(B){return A.H.useState(B)},react_production.useSyncExternalStore=function(B,V,K){return A.H.useSyncExternalStore(B,V,K)},react_production.useTransition=function(){return A.H.useTransition()},react_production.version="19.2.0",react_production}var hasRequiredReact;function requireReact(){return hasRequiredReact||(hasRequiredReact=1,react.exports=requireReact_production()),react.exports}var reactExports=requireReact(),client={exports:{}},reactDomClient_production={},scheduler={exports:{}},scheduler_production={};var hasRequiredScheduler_production;function requireScheduler_production(){return hasRequiredScheduler_production||(hasRequiredScheduler_production=1,(function(r){function e(k,U){var F=k.length;k.push(U);e:for(;0<F;){var j=F-1>>>1,H=k[j];if(0<i(H,U))k[j]=U,k[F]=H,F=j;else break e}}function t(k){return k.length===0?null:k[0]}function n(k){if(k.length===0)return null;var U=k[0],F=k.pop();if(F!==U){k[0]=F;e:for(var j=0,H=k.length,B=H>>>1;j<B;){var V=2*(j+1)-1,K=k[V],q=V+1,Te=k[q];if(0>i(K,F))q<H&&0>i(Te,K)?(k[j]=Te,k[q]=F,j=q):(k[j]=K,k[V]=F,j=V);else if(q<H&&0>i(Te,F))k[j]=Te,k[q]=F,j=q;else break e}}return U}function i(k,U){var F=k.sortIndex-U.sortIndex;return F!==0?F:k.id-U.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();r.unstable_now=function(){return o.now()-a}}var l=[],d=[],u=1,g=null,x=3,y=!1,b=!1,_=!1,h=!1,f=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;function S(k){for(var U=t(d);U!==null;){if(U.callback===null)n(d);else if(U.startTime<=k)n(d),U.sortIndex=U.expirationTime,e(l,U);else break;U=t(d)}}function w(k){if(_=!1,S(k),!b)if(t(l)!==null)b=!0,v||(v=!0,L());else{var U=t(d);U!==null&&N(w,U.startTime-k)}}var v=!1,A=-1,M=5,T=-1;function R(){return h?!0:!(r.unstable_now()-T<M)}function P(){if(h=!1,v){var k=r.unstable_now();T=k;var U=!0;try{e:{b=!1,_&&(_=!1,E(A),A=-1),y=!0;var F=x;try{t:{for(S(k),g=t(l);g!==null&&!(g.expirationTime>k&&R());){var j=g.callback;if(typeof j=="function"){g.callback=null,x=g.priorityLevel;var H=j(g.expirationTime<=k);if(k=r.unstable_now(),typeof H=="function"){g.callback=H,S(k),U=!0;break t}g===t(l)&&n(l),S(k)}else n(l);g=t(l)}if(g!==null)U=!0;else{var B=t(d);B!==null&&N(w,B.startTime-k),U=!1}}break e}finally{g=null,x=F,y=!1}U=void 0}}finally{U?L():v=!1}}}var L;if(typeof m=="function")L=function(){m(P)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,I=O.port2;O.port1.onmessage=P,L=function(){I.postMessage(null)}}else L=function(){f(P,0)};function N(k,U){A=f(function(){k(r.unstable_now())},U)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(k){k.callback=null},r.unstable_forceFrameRate=function(k){0>k||125<k?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):M=0<k?Math.floor(1e3/k):5},r.unstable_getCurrentPriorityLevel=function(){return x},r.unstable_next=function(k){switch(x){case 1:case 2:case 3:var U=3;break;default:U=x}var F=x;x=U;try{return k()}finally{x=F}},r.unstable_requestPaint=function(){h=!0},r.unstable_runWithPriority=function(k,U){switch(k){case 1:case 2:case 3:case 4:case 5:break;default:k=3}var F=x;x=k;try{return U()}finally{x=F}},r.unstable_scheduleCallback=function(k,U,F){var j=r.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?j+F:j):F=j,k){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=F+H,k={id:u++,callback:U,priorityLevel:k,startTime:F,expirationTime:H,sortIndex:-1},F>j?(k.sortIndex=F,e(d,k),t(l)===null&&k===t(d)&&(_?(E(A),A=-1):_=!0,N(w,F-j))):(k.sortIndex=H,e(l,k),b||y||(b=!0,v||(v=!0,L()))),k},r.unstable_shouldYield=R,r.unstable_wrapCallback=function(k){var U=x;return function(){var F=x;x=U;try{return k.apply(this,arguments)}finally{x=F}}}})(scheduler_production)),scheduler_production}var hasRequiredScheduler;function requireScheduler(){return hasRequiredScheduler||(hasRequiredScheduler=1,scheduler.exports=requireScheduler_production()),scheduler.exports}var reactDom={exports:{}},reactDom_production={};var hasRequiredReactDom_production;function requireReactDom_production(){if(hasRequiredReactDom_production)return reactDom_production;hasRequiredReactDom_production=1;var r=requireReact();function e(l){var d="https://react.dev/errors/"+l;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)d+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+l+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(l,d,u){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:g==null?null:""+g,children:l,containerInfo:d,implementation:u}}var o=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function a(l,d){if(l==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return reactDom_production.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,reactDom_production.createPortal=function(l,d){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(l,d,null,u)},reactDom_production.flushSync=function(l){var d=o.T,u=n.p;try{if(o.T=null,n.p=2,l)return l()}finally{o.T=d,n.p=u,n.d.f()}},reactDom_production.preconnect=function(l,d){typeof l=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,n.d.C(l,d))},reactDom_production.prefetchDNS=function(l){typeof l=="string"&&n.d.D(l)},reactDom_production.preinit=function(l,d){if(typeof l=="string"&&d&&typeof d.as=="string"){var u=d.as,g=a(u,d.crossOrigin),x=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;u==="style"?n.d.S(l,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:g,integrity:x,fetchPriority:y}):u==="script"&&n.d.X(l,{crossOrigin:g,integrity:x,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},reactDom_production.preinitModule=function(l,d){if(typeof l=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var u=a(d.as,d.crossOrigin);n.d.M(l,{crossOrigin:u,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&n.d.M(l)},reactDom_production.preload=function(l,d){if(typeof l=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var u=d.as,g=a(u,d.crossOrigin);n.d.L(l,u,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},reactDom_production.preloadModule=function(l,d){if(typeof l=="string")if(d){var u=a(d.as,d.crossOrigin);n.d.m(l,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:u,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else n.d.m(l)},reactDom_production.requestFormReset=function(l){n.d.r(l)},reactDom_production.unstable_batchedUpdates=function(l,d){return l(d)},reactDom_production.useFormState=function(l,d,u){return o.H.useFormState(l,d,u)},reactDom_production.useFormStatus=function(){return o.H.useHostTransitionStatus()},reactDom_production.version="19.2.0",reactDom_production}var hasRequiredReactDom;function requireReactDom(){if(hasRequiredReactDom)return reactDom.exports;hasRequiredReactDom=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),reactDom.exports=requireReactDom_production(),reactDom.exports}var hasRequiredReactDomClient_production;function requireReactDomClient_production(){if(hasRequiredReactDomClient_production)return reactDomClient_production;hasRequiredReactDomClient_production=1;var r=requireScheduler(),e=requireReact(),t=requireReactDom();function n(c){var p="https://react.dev/errors/"+c;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)p+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+c+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function s(c){var p=c,C=c;if(c.alternate)for(;p.return;)p=p.return;else{c=p;do p=c,(p.flags&4098)!==0&&(C=p.return),c=p.return;while(c)}return p.tag===3?C:null}function o(c){if(c.tag===13){var p=c.memoizedState;if(p===null&&(c=c.alternate,c!==null&&(p=c.memoizedState)),p!==null)return p.dehydrated}return null}function a(c){if(c.tag===31){var p=c.memoizedState;if(p===null&&(c=c.alternate,c!==null&&(p=c.memoizedState)),p!==null)return p.dehydrated}return null}function l(c){if(s(c)!==c)throw Error(n(188))}function d(c){var p=c.alternate;if(!p){if(p=s(c),p===null)throw Error(n(188));return p!==c?null:c}for(var C=c,D=p;;){var G=C.return;if(G===null)break;var $=G.alternate;if($===null){if(D=G.return,D!==null){C=D;continue}break}if(G.child===$.child){for($=G.child;$;){if($===C)return l(G),c;if($===D)return l(G),p;$=$.sibling}throw Error(n(188))}if(C.return!==D.return)C=G,D=$;else{for(var tt=!1,i0=G.child;i0;){if(i0===C){tt=!0,C=G,D=$;break}if(i0===D){tt=!0,D=G,C=$;break}i0=i0.sibling}if(!tt){for(i0=$.child;i0;){if(i0===C){tt=!0,C=$,D=G;break}if(i0===D){tt=!0,D=$,C=G;break}i0=i0.sibling}if(!tt)throw Error(n(189))}}if(C.alternate!==D)throw Error(n(190))}if(C.tag!==3)throw Error(n(188));return C.stateNode.current===C?c:p}function u(c){var p=c.tag;if(p===5||p===26||p===27||p===6)return c;for(c=c.child;c!==null;){if(p=u(c),p!==null)return p;c=c.sibling}return null}var g=Object.assign,x=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),b=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),E=Symbol.for("react.consumer"),m=Symbol.for("react.context"),S=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),M=Symbol.for("react.lazy"),T=Symbol.for("react.activity"),R=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function L(c){return c===null||typeof c!="object"?null:(c=P&&c[P]||c["@@iterator"],typeof c=="function"?c:null)}var O=Symbol.for("react.client.reference");function I(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===O?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case _:return"Fragment";case f:return"Profiler";case h:return"StrictMode";case w:return"Suspense";case v:return"SuspenseList";case T:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case b:return"Portal";case m:return c.displayName||"Context";case E:return(c._context.displayName||"Context")+".Consumer";case S:var p=c.render;return c=c.displayName,c||(c=p.displayName||p.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case A:return p=c.displayName||null,p!==null?p:I(c.type)||"Memo";case M:p=c._payload,c=c._init;try{return I(c(p))}catch{}}return null}var N=Array.isArray,k=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,U=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,F={pending:!1,data:null,method:null,action:null},j=[],H=-1;function B(c){return{current:c}}function V(c){0>H||(c.current=j[H],j[H]=null,H--)}function K(c,p){H++,j[H]=c.current,c.current=p}var q=B(null),Te=B(null),Fe=B(null),We=B(null);function J(c,p){switch(K(Fe,p),K(Te,c),K(q,null),p.nodeType){case 9:case 11:c=(c=p.documentElement)&&(c=c.namespaceURI)?FT(c):0;break;default:if(c=p.tagName,p=p.namespaceURI)p=FT(p),c=UT(p,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}V(q),K(q,c)}function et(){V(q),V(Te),V(Fe)}function ht(c){c.memoizedState!==null&&K(We,c);var p=q.current,C=UT(p,c.type);p!==C&&(K(Te,c),K(q,C))}function er(c){Te.current===c&&(V(q),V(Te)),We.current===c&&(V(We),yA._currentValue=F)}var tr,Hm;function oi(c){if(tr===void 0)try{throw Error()}catch(C){var p=C.stack.trim().match(/\n( *(at )?)/);tr=p&&p[1]||"",Hm=-1<C.stack.indexOf(`
    at`)?" (<anonymous>)":-1<C.stack.indexOf("@")?"@unknown:0:0":""}return`
`+tr+c+Hm}var h0=!1;function l0(c,p){if(!c||h0)return"";h0=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var D={DetermineComponentFrameRoot:function(){try{if(p){var n1=function(){throw Error()};if(Object.defineProperty(n1.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n1,[])}catch(Z0){var K0=Z0}Reflect.construct(c,[],n1)}else{try{n1.call()}catch(Z0){K0=Z0}c.call(n1.prototype)}}else{try{throw Error()}catch(Z0){K0=Z0}(n1=c())&&typeof n1.catch=="function"&&n1.catch(function(){})}}catch(Z0){if(Z0&&K0&&typeof Z0.stack=="string")return[Z0.stack,K0.stack]}return[null,null]}};D.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var G=Object.getOwnPropertyDescriptor(D.DetermineComponentFrameRoot,"name");G&&G.configurable&&Object.defineProperty(D.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var $=D.DetermineComponentFrameRoot(),tt=$[0],i0=$[1];if(tt&&i0){var D0=tt.split(`
`),$0=i0.split(`
`);for(G=D=0;D<D0.length&&!D0[D].includes("DetermineComponentFrameRoot");)D++;for(;G<$0.length&&!$0[G].includes("DetermineComponentFrameRoot");)G++;if(D===D0.length||G===$0.length)for(D=D0.length-1,G=$0.length-1;1<=D&&0<=G&&D0[D]!==$0[G];)G--;for(;1<=D&&0<=G;D--,G--)if(D0[D]!==$0[G]){if(D!==1||G!==1)do if(D--,G--,0>G||D0[D]!==$0[G]){var J0=`
`+D0[D].replace(" at new "," at ");return c.displayName&&J0.includes("<anonymous>")&&(J0=J0.replace("<anonymous>",c.displayName)),J0}while(1<=D&&0<=G);break}}}finally{h0=!1,Error.prepareStackTrace=C}return(C=c?c.displayName||c.name:"")?oi(C):""}function M0(c,p){switch(c.tag){case 26:case 27:case 5:return oi(c.type);case 16:return oi("Lazy");case 13:return c.child!==p&&p!==null?oi("Suspense Fallback"):oi("Suspense");case 19:return oi("SuspenseList");case 0:case 15:return l0(c.type,!1);case 11:return l0(c.type.render,!1);case 1:return l0(c.type,!0);case 31:return oi("Activity");default:return""}}function U0(c){try{var p="",C=null;do p+=M0(c,C),C=c,c=c.return;while(c);return p}catch(D){return`
Error generating stack: `+D.message+`
`+D.stack}}var _0=Object.prototype.hasOwnProperty,C0=r.unstable_scheduleCallback,P0=r.unstable_cancelCallback,R0=r.unstable_shouldYield,si=r.unstable_requestPaint,Xe=r.unstable_now,d0=r.unstable_getCurrentPriorityLevel,w0=r.unstable_ImmediatePriority,Q=r.unstable_UserBlockingPriority,it=r.unstable_NormalPriority,ec=r.unstable_LowPriority,a0=r.unstable_IdlePriority,u0=r.log,E0=r.unstable_setDisableYieldValue,O0=null,He=null;function p0(c){if(typeof u0=="function"&&E0(c),He&&typeof He.setStrictMode=="function")try{He.setStrictMode(O0,c)}catch{}}var x0=Math.clz32?Math.clz32:b0,L0=Math.log,c0=Math.LN2;function b0(c){return c>>>=0,c===0?32:31-(L0(c)/c0|0)|0}var ut=256,hi=262144,S0=4194304;function W(c){var p=c&42;if(p!==0)return p;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function t0(c,p,C){var D=c.pendingLanes;if(D===0)return 0;var G=0,$=c.suspendedLanes,tt=c.pingedLanes;c=c.warmLanes;var i0=D&134217727;return i0!==0?(D=i0&~$,D!==0?G=W(D):(tt&=i0,tt!==0?G=W(tt):C||(C=i0&~c,C!==0&&(G=W(C))))):(i0=D&~$,i0!==0?G=W(i0):tt!==0?G=W(tt):C||(C=D&~c,C!==0&&(G=W(C)))),G===0?0:p!==0&&p!==G&&(p&$)===0&&($=G&-G,C=p&-p,$>=C||$===32&&(C&4194048)!==0)?p:G}function o0(c,p){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&p)===0}function Ji(c,p){switch(c){case 1:case 2:case 4:case 8:case 64:return p+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function m0(){var c=S0;return S0<<=1,(S0&62914560)===0&&(S0=4194304),c}function I0(c){for(var p=[],C=0;31>C;C++)p.push(c);return p}function Z(c,p){c.pendingLanes|=p,p!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function at(c,p,C,D,G,$){var tt=c.pendingLanes;c.pendingLanes=C,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=C,c.entangledLanes&=C,c.errorRecoveryDisabledLanes&=C,c.shellSuspendCounter=0;var i0=c.entanglements,D0=c.expirationTimes,$0=c.hiddenUpdates;for(C=tt&~C;0<C;){var J0=31-x0(C),n1=1<<J0;i0[J0]=0,D0[J0]=-1;var K0=$0[J0];if(K0!==null)for($0[J0]=null,J0=0;J0<K0.length;J0++){var Z0=K0[J0];Z0!==null&&(Z0.lane&=-536870913)}C&=~n1}D!==0&&lt(c,D,0),$!==0&&G===0&&c.tag!==0&&(c.suspendedLanes|=$&~(tt&~p))}function lt(c,p,C){c.pendingLanes|=p,c.suspendedLanes&=~p;var D=31-x0(p);c.entangledLanes|=p,c.entanglements[D]=c.entanglements[D]|1073741824|C&261930}function n0(c,p){var C=c.entangledLanes|=p;for(c=c.entanglements;C;){var D=31-x0(C),G=1<<D;G&p|c[D]&p&&(c[D]|=p),C&=~G}}function r0(c,p){var C=p&-p;return C=(C&42)!==0?1:f0(C),(C&(c.suspendedLanes|p))!==0?0:C}function f0(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function v0(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function A0(){var c=U.p;return c!==0?c:(c=window.event,c===void 0?32:l3(c.type))}function X0(c,p){var C=U.p;try{return U.p=c,p()}finally{U.p=C}}var q0=Math.random().toString(36).slice(2),i1="__reactFiber$"+q0,u1="__reactProps$"+q0,e1="__reactContainer$"+q0,Q0="__reactEvents$"+q0,e0="__reactListeners$"+q0,T0="__reactHandles$"+q0,F0="__reactResources$"+q0,N0="__reactMarker$"+q0;function H0(c){delete c[i1],delete c[u1],delete c[Q0],delete c[e0],delete c[T0]}function r1(c){var p=c[i1];if(p)return p;for(var C=c.parentNode;C;){if(p=C[e1]||C[i1]){if(C=p.alternate,p.child!==null||C!==null&&C.child!==null)for(c=$T(c);c!==null;){if(C=c[i1])return C;c=$T(c)}return p}c=C,C=c.parentNode}return null}function h1(c){if(c=c[i1]||c[e1]){var p=c.tag;if(p===5||p===6||p===13||p===31||p===26||p===27||p===3)return c}return null}function p1(c){var p=c.tag;if(p===5||p===26||p===27||p===6)return c.stateNode;throw Error(n(33))}function o1(c){var p=c[F0];return p||(p=c[F0]={hoistableStyles:new Map,hoistableScripts:new Map}),p}function G0(c){c[N0]=!0}var s1=new Set,c1={};function x1(c,p){m1(c,p),m1(c+"Capture",p)}function m1(c,p){for(c1[c]=p,c=0;c<p.length;c++)s1.add(p[c])}var S1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),w1={},l1={};function _1(c){return _0.call(l1,c)?!0:_0.call(w1,c)?!1:S1.test(c)?l1[c]=!0:(w1[c]=!0,!1)}function b1(c,p,C){if(_1(p))if(C===null)c.removeAttribute(p);else{switch(typeof C){case"undefined":case"function":case"symbol":c.removeAttribute(p);return;case"boolean":var D=p.toLowerCase().slice(0,5);if(D!=="data-"&&D!=="aria-"){c.removeAttribute(p);return}}c.setAttribute(p,""+C)}}function T1(c,p,C){if(C===null)c.removeAttribute(p);else{switch(typeof C){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(p);return}c.setAttribute(p,""+C)}}function Z1(c,p,C,D){if(D===null)c.removeAttribute(C);else{switch(typeof D){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(C);return}c.setAttributeNS(p,C,""+D)}}function O_(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function lv(c){var p=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function pv(c,p,C){var D=Object.getOwnPropertyDescriptor(c.constructor.prototype,p);if(!c.hasOwnProperty(p)&&typeof D<"u"&&typeof D.get=="function"&&typeof D.set=="function"){var G=D.get,$=D.set;return Object.defineProperty(c,p,{configurable:!0,get:function(){return G.call(this)},set:function(tt){C=""+tt,$.call(this,tt)}}),Object.defineProperty(c,p,{enumerable:D.enumerable}),{getValue:function(){return C},setValue:function(tt){C=""+tt},stopTracking:function(){c._valueTracker=null,delete c[p]}}}}function Q1(c){if(!c._valueTracker){var p=lv(c)?"checked":"value";c._valueTracker=pv(c,p,""+c[p])}}function X_(c){if(!c)return!1;var p=c._valueTracker;if(!p)return!0;var C=p.getValue(),D="";return c&&(D=lv(c)?c.checked?"true":"false":c.value),c=D,c!==C?(p.setValue(c),!0):!1}function F_(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var D_=/[\n"\\]/g;function F1(c){return c.replace(D_,function(p){return"\\"+p.charCodeAt(0).toString(16)+" "})}function mv(c,p,C,D,G,$,tt,i0){c.name="",tt!=null&&typeof tt!="function"&&typeof tt!="symbol"&&typeof tt!="boolean"?c.type=tt:c.removeAttribute("type"),p!=null?tt==="number"?(p===0&&c.value===""||c.value!=p)&&(c.value=""+O_(p)):c.value!==""+O_(p)&&(c.value=""+O_(p)):tt!=="submit"&&tt!=="reset"||c.removeAttribute("value"),p!=null?cv(c,tt,O_(p)):C!=null?cv(c,tt,O_(C)):D!=null&&c.removeAttribute("value"),G==null&&$!=null&&(c.defaultChecked=!!$),G!=null&&(c.checked=G&&typeof G!="function"&&typeof G!="symbol"),i0!=null&&typeof i0!="function"&&typeof i0!="symbol"&&typeof i0!="boolean"?c.name=""+O_(i0):c.removeAttribute("name")}function Q_(c,p,C,D,G,$,tt,i0){if($!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(c.type=$),p!=null||C!=null){if(!($!=="submit"&&$!=="reset"||p!=null)){Q1(c);return}C=C!=null?""+O_(C):"",p=p!=null?""+O_(p):C,i0||p===c.value||(c.value=p),c.defaultValue=p}D=D??G,D=typeof D!="function"&&typeof D!="symbol"&&!!D,c.checked=i0?c.checked:!!D,c.defaultChecked=!!D,tt!=null&&typeof tt!="function"&&typeof tt!="symbol"&&typeof tt!="boolean"&&(c.name=tt),Q1(c)}function cv(c,p,C){p==="number"&&F_(c.ownerDocument)===c||c.defaultValue===""+C||(c.defaultValue=""+C)}function bv(c,p,C,D){if(c=c.options,p){p={};for(var G=0;G<C.length;G++)p["$"+C[G]]=!0;for(C=0;C<c.length;C++)G=p.hasOwnProperty("$"+c[C].value),c[C].selected!==G&&(c[C].selected=G),G&&D&&(c[C].defaultSelected=!0)}else{for(C=""+O_(C),p=null,G=0;G<c.length;G++){if(c[G].value===C){c[G].selected=!0,D&&(c[G].defaultSelected=!0);return}p!==null||c[G].disabled||(p=c[G])}p!==null&&(p.selected=!0)}}function uv(c,p,C){if(p!=null&&(p=""+O_(p),p!==c.value&&(c.value=p),C==null)){c.defaultValue!==p&&(c.defaultValue=p);return}c.defaultValue=C!=null?""+O_(C):""}function $v(c,p,C,D){if(p==null){if(D!=null){if(C!=null)throw Error(n(92));if(N(D)){if(1<D.length)throw Error(n(93));D=D[0]}C=D}C==null&&(C=""),p=C}C=O_(p),c.defaultValue=C,D=c.textContent,D===C&&D!==""&&D!==null&&(c.value=D),Q1(c)}function H_(c,p){if(p){var C=c.firstChild;if(C&&C===c.lastChild&&C.nodeType===3){C.nodeValue=p;return}}c.textContent=p}var fx=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function px(c,p,C){var D=p.indexOf("--")===0;C==null||typeof C=="boolean"||C===""?D?c.setProperty(p,""):p==="float"?c.cssFloat="":c[p]="":D?c.setProperty(p,C):typeof C!="number"||C===0||fx.has(p)?p==="float"?c.cssFloat=C:c[p]=(""+C).trim():c[p]=C+"px"}function sv(c,p,C){if(p!=null&&typeof p!="object")throw Error(n(62));if(c=c.style,C!=null){for(var D in C)!C.hasOwnProperty(D)||p!=null&&p.hasOwnProperty(D)||(D.indexOf("--")===0?c.setProperty(D,""):D==="float"?c.cssFloat="":c[D]="");for(var G in p)D=p[G],p.hasOwnProperty(G)&&C[G]!==D&&px(c,G,D)}else for(var $ in p)p.hasOwnProperty($)&&px(c,$,p[$])}function I_(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Y_=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),V1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function j_(c){return V1.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function J_(){}var nx=null;function Sv(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var mx=null,ix=null;function gx(c){var p=h1(c);if(p&&(c=p.stateNode)){var C=c[u1]||null;e:switch(c=p.stateNode,p.type){case"input":if(mv(c,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name),p=C.name,C.type==="radio"&&p!=null){for(C=c;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll('input[name="'+F1(""+p)+'"][type="radio"]'),p=0;p<C.length;p++){var D=C[p];if(D!==c&&D.form===c.form){var G=D[u1]||null;if(!G)throw Error(n(90));mv(D,G.value,G.defaultValue,G.defaultValue,G.checked,G.defaultChecked,G.type,G.name)}}for(p=0;p<C.length;p++)D=C[p],D.form===c.form&&X_(D)}break e;case"textarea":uv(c,C.value,C.defaultValue);break e;case"select":p=C.value,p!=null&&bv(c,!!C.multiple,p,!1)}}}var wS=!1;function EA(c,p,C){if(wS)return c(p,C);wS=!0;try{var D=c(p);return D}finally{if(wS=!1,(mx!==null||ix!==null)&&(vE(),mx&&(p=mx,c=ix,ix=mx=null,gx(p),c)))for(p=0;p<c.length;p++)gx(c[p])}}function hv(c,p){var C=c.stateNode;if(C===null)return null;var D=C[u1]||null;if(D===null)return null;C=D[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(c=c.type,D=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!D;break e;default:c=!1}if(c)return null;if(C&&typeof C!="function")throw Error(n(231,p,typeof C));return C}var gv=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),CS=!1;if(gv)try{var f2={};Object.defineProperty(f2,"passive",{get:function(){CS=!0}}),window.addEventListener("test",f2,f2),window.removeEventListener("test",f2,f2)}catch{CS=!1}var Av=null,V2=null,p2=null;function MA(){if(p2)return p2;var c,p=V2,C=p.length,D,G="value"in Av?Av.value:Av.textContent,$=G.length;for(c=0;c<C&&p[c]===G[c];c++);var tt=C-c;for(D=1;D<=tt&&p[C-D]===G[$-D];D++);return p2=G.slice(c,1<D?1-D:void 0)}function m2(c){var p=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&p===13&&(c=13)):c=p,c===10&&(c=13),32<=c||c===13?c:0}function H2(){return!0}function wA(){return!1}function dv(c){function p(C,D,G,$,tt){this._reactName=C,this._targetInst=G,this.type=D,this.nativeEvent=$,this.target=tt,this.currentTarget=null;for(var i0 in c)c.hasOwnProperty(i0)&&(C=c[i0],this[i0]=C?C($):$[i0]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?H2:wA,this.isPropagationStopped=wA,this}return g(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=H2)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=H2)},persist:function(){},isPersistent:H2}),p}var vx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},j2=dv(vx),g2=g({},vx,{view:0,detail:0}),kE=dv(g2),TS,RS,_2,W2=g({},g2,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:X2,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==_2&&(_2&&c.type==="mousemove"?(TS=c.screenX-_2.screenX,RS=c.screenY-_2.screenY):RS=TS=0,_2=c),TS)},movementY:function(c){return"movementY"in c?c.movementY:RS}}),CA=dv(W2),GE=g({},W2,{dataTransfer:0}),v2=dv(GE),VE=g({},g2,{relatedTarget:0}),DS=dv(VE),HE=g({},vx,{animationName:0,elapsedTime:0,pseudoElement:0}),$2=dv(HE),TA=g({},vx,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),x2=dv(TA),jE=g({},vx,{data:0}),RA=dv(jE),WE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$E={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},y2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function XE(c){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(c):(c=y2[c])?!!p[c]:!1}function X2(){return XE}var DA=g({},g2,{key:function(c){if(c.key){var p=WE[c.key]||c.key;if(p!=="Unidentified")return p}return c.type==="keypress"?(c=m2(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?$E[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:X2,charCode:function(c){return c.type==="keypress"?m2(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?m2(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),YE=dv(DA),KE=g({},W2,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),LA=dv(KE),qE=g({},g2,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:X2}),Y2=dv(qE),ZE=g({},vx,{propertyName:0,elapsedTime:0,pseudoElement:0}),QE=dv(ZE),JE=g({},W2,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),eM=dv(JE),b2=g({},vx,{newState:0,oldState:0}),LS=dv(b2),tM=[9,13,27,32],PS=gv&&"CompositionEvent"in window,S2=null;gv&&"documentMode"in document&&(S2=document.documentMode);var nM=gv&&"TextEvent"in window&&!S2,PA=gv&&(!PS||S2&&8<S2&&11>=S2),OA=" ",IA=!1;function A2(c,p){switch(c){case"keyup":return tM.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function BA(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var kx=!1;function Gx(c,p){switch(c){case"compositionend":return BA(p);case"keypress":return p.which!==32?null:(IA=!0,OA);case"textInput":return c=p.data,c===OA&&IA?null:c;default:return null}}function NA(c,p){if(kx)return c==="compositionend"||!PS&&A2(c,p)?(c=MA(),p2=V2=Av=null,kx=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return PA&&p.locale!=="ko"?null:p.data;default:return null}}var zA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function OS(c){var p=c&&c.nodeName&&c.nodeName.toLowerCase();return p==="input"?!!zA[c.type]:p==="textarea"}function K2(c,p,C,D){mx?ix?ix.push(D):ix=[D]:mx=D,p=ME(p,"onChange"),0<p.length&&(C=new j2("onChange","change",null,C,D),c.push({event:C,listeners:p}))}var Vx=null,E2=null;function iM(c){PT(c,0)}function q2(c){var p=p1(c);if(X_(p))return c}function FA(c,p){if(c==="change")return p}var rM=!1;if(gv){var xx;if(gv){var IS="oninput"in document;if(!IS){var BS=document.createElement("div");BS.setAttribute("oninput","return;"),IS=typeof BS.oninput=="function"}xx=IS}else xx=!1;rM=xx&&(!document.documentMode||9<document.documentMode)}function NS(){Vx&&(Vx.detachEvent("onpropertychange",zS),E2=Vx=null)}function zS(c){if(c.propertyName==="value"&&q2(E2)){var p=[];K2(p,E2,c,Sv(c)),EA(iM,p)}}function sM(c,p,C){c==="focusin"?(NS(),Vx=p,E2=C,Vx.attachEvent("onpropertychange",zS)):c==="focusout"&&NS()}function Z2(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return q2(E2)}function yx(c,p){if(c==="click")return q2(p)}function aM(c,p){if(c==="input"||c==="change")return q2(p)}function oM(c,p){return c===p&&(c!==0||1/c===1/p)||c!==c&&p!==p}var B_=typeof Object.is=="function"?Object.is:oM;function Hx(c,p){if(B_(c,p))return!0;if(typeof c!="object"||c===null||typeof p!="object"||p===null)return!1;var C=Object.keys(c),D=Object.keys(p);if(C.length!==D.length)return!1;for(D=0;D<C.length;D++){var G=C[D];if(!_0.call(p,G)||!B_(c[G],p[G]))return!1}return!0}function FS(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function UA(c,p){var C=FS(c);c=0;for(var D;C;){if(C.nodeType===3){if(D=c+C.textContent.length,c<=p&&D>=p)return{node:C,offset:p-c};c=D}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=FS(C)}}function US(c,p){return c&&p?c===p?!0:c&&c.nodeType===3?!1:p&&p.nodeType===3?US(c,p.parentNode):"contains"in c?c.contains(p):c.compareDocumentPosition?!!(c.compareDocumentPosition(p)&16):!1:!1}function M2(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var p=F_(c.document);p instanceof c.HTMLIFrameElement;){try{var C=typeof p.contentWindow.location.href=="string"}catch{C=!1}if(C)c=p.contentWindow;else break;p=F_(c.document)}return p}function Q2(c){var p=c&&c.nodeName&&c.nodeName.toLowerCase();return p&&(p==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||p==="textarea"||c.contentEditable==="true")}var kA=gv&&"documentMode"in document&&11>=document.documentMode,bx=null,J2=null,jx=null,eS=!1;function kS(c,p,C){var D=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;eS||bx==null||bx!==F_(D)||(D=bx,"selectionStart"in D&&Q2(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),jx&&Hx(jx,D)||(jx=D,D=ME(J2,"onSelect"),0<D.length&&(p=new j2("onSelect","select",null,p,C),c.push({event:p,listeners:D}),p.target=bx)))}function rx(c,p){var C={};return C[c.toLowerCase()]=p.toLowerCase(),C["Webkit"+c]="webkit"+p,C["Moz"+c]="moz"+p,C}var Sx={animationend:rx("Animation","AnimationEnd"),animationiteration:rx("Animation","AnimationIteration"),animationstart:rx("Animation","AnimationStart"),transitionrun:rx("Transition","TransitionRun"),transitionstart:rx("Transition","TransitionStart"),transitioncancel:rx("Transition","TransitionCancel"),transitionend:rx("Transition","TransitionEnd")},Wx={},Fv={};gv&&(Fv=document.createElement("div").style,"AnimationEvent"in window||(delete Sx.animationend.animation,delete Sx.animationiteration.animation,delete Sx.animationstart.animation),"TransitionEvent"in window||delete Sx.transitionend.transition);function Xv(c){if(Wx[c])return Wx[c];if(!Sx[c])return c;var p=Sx[c],C;for(C in p)if(p.hasOwnProperty(C)&&C in Fv)return Wx[c]=p[C];return c}var GS=Xv("animationend"),tS=Xv("animationiteration"),VS=Xv("animationstart"),GA=Xv("transitionrun"),VA=Xv("transitionstart"),HA=Xv("transitioncancel"),w2=Xv("transitionend"),C2=new Map,nS="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");nS.push("scrollEnd");function Ev(c,p){C2.set(c,p),x1(p,[c])}var T2=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var p=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(p))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},_v=[],Ax=0,R2=0;function D2(){for(var c=Ax,p=R2=Ax=0;p<c;){var C=_v[p];_v[p++]=null;var D=_v[p];_v[p++]=null;var G=_v[p];_v[p++]=null;var $=_v[p];if(_v[p++]=null,D!==null&&G!==null){var tt=D.pending;tt===null?G.next=G:(G.next=tt.next,tt.next=G),D.pending=G}$!==0&&HS(C,G,$)}}function L2(c,p,C,D){_v[Ax++]=c,_v[Ax++]=p,_v[Ax++]=C,_v[Ax++]=D,R2|=D,c.lanes|=D,c=c.alternate,c!==null&&(c.lanes|=D)}function A_(c,p,C,D){return L2(c,p,C,D),iS(c)}function sx(c,p){return L2(c,null,null,p),iS(c)}function HS(c,p,C){c.lanes|=C;var D=c.alternate;D!==null&&(D.lanes|=C);for(var G=!1,$=c.return;$!==null;)$.childLanes|=C,D=$.alternate,D!==null&&(D.childLanes|=C),$.tag===22&&(c=$.stateNode,c===null||c._visibility&1||(G=!0)),c=$,$=$.return;return c.tag===3?($=c.stateNode,G&&p!==null&&(G=31-x0(C),c=$.hiddenUpdates,D=c[G],D===null?c[G]=[p]:D.push(p),p.lane=C|536870912),$):null}function iS(c){if(50<fA)throw fA=0,tw=null,Error(n(185));for(var p=c.return;p!==null;)c=p,p=c.return;return c.tag===3?c.stateNode:null}var $x={};function Lw(c,p,C,D){this.tag=c,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vv(c,p,C,D){return new Lw(c,p,C,D)}function rS(c){return c=c.prototype,!(!c||!c.isReactComponent)}function Yv(c,p){var C=c.alternate;return C===null?(C=vv(c.tag,p,c.key,c.mode),C.elementType=c.elementType,C.type=c.type,C.stateNode=c.stateNode,C.alternate=c,c.alternate=C):(C.pendingProps=p,C.type=c.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=c.flags&65011712,C.childLanes=c.childLanes,C.lanes=c.lanes,C.child=c.child,C.memoizedProps=c.memoizedProps,C.memoizedState=c.memoizedState,C.updateQueue=c.updateQueue,p=c.dependencies,C.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},C.sibling=c.sibling,C.index=c.index,C.ref=c.ref,C.refCleanup=c.refCleanup,C}function ax(c,p){c.flags&=65011714;var C=c.alternate;return C===null?(c.childLanes=0,c.lanes=p,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=C.childLanes,c.lanes=C.lanes,c.child=C.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=C.memoizedProps,c.memoizedState=C.memoizedState,c.updateQueue=C.updateQueue,c.type=C.type,p=C.dependencies,c.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext}),c}function P2(c,p,C,D,G,$){var tt=0;if(D=c,typeof c=="function")rS(c)&&(tt=1);else if(typeof c=="string")tt=pR(c,C,q.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case T:return c=vv(31,C,p,G),c.elementType=T,c.lanes=$,c;case _:return ox(C.children,G,$,p);case h:tt=8,G|=24;break;case f:return c=vv(12,C,p,G|2),c.elementType=f,c.lanes=$,c;case w:return c=vv(13,C,p,G),c.elementType=w,c.lanes=$,c;case v:return c=vv(19,C,p,G),c.elementType=v,c.lanes=$,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case m:tt=10;break e;case E:tt=9;break e;case S:tt=11;break e;case A:tt=14;break e;case M:tt=16,D=null;break e}tt=29,C=Error(n(130,c===null?"null":typeof c,"")),D=null}return p=vv(tt,C,p,G),p.elementType=c,p.type=D,p.lanes=$,p}function ox(c,p,C,D){return c=vv(7,c,D,p),c.lanes=C,c}function sS(c,p,C){return c=vv(6,c,null,p),c.lanes=C,c}function jS(c){var p=vv(18,null,null,0);return p.stateNode=c,p}function WS(c,p,C){return p=vv(4,c.children!==null?c.children:[],c.key,p),p.lanes=C,p.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},p}var $S=new WeakMap;function fv(c,p){if(typeof c=="object"&&c!==null){var C=$S.get(c);return C!==void 0?C:(p={value:c,source:p,stack:U0(p)},$S.set(c,p),p)}return{value:c,source:p,stack:U0(p)}}var lx=[],Xx=0,O2=null,I2=0,Mv=[],wv=0,cx=null,Uv=1,kv="";function Kv(c,p){lx[Xx++]=I2,lx[Xx++]=O2,O2=c,I2=p}function jA(c,p,C){Mv[wv++]=Uv,Mv[wv++]=kv,Mv[wv++]=cx,cx=c;var D=Uv;c=kv;var G=32-x0(D)-1;D&=~(1<<G),C+=1;var $=32-x0(p)+G;if(30<$){var tt=G-G%5;$=(D&(1<<tt)-1).toString(32),D>>=tt,G-=tt,Uv=1<<32-x0(p)+G|C<<G|D,kv=$+c}else Uv=1<<$|C<<G|D,kv=c}function XS(c){c.return!==null&&(Kv(c,1),jA(c,1,0))}function YS(c){for(;c===O2;)O2=lx[--Xx],lx[Xx]=null,I2=lx[--Xx],lx[Xx]=null;for(;c===cx;)cx=Mv[--wv],Mv[wv]=null,kv=Mv[--wv],Mv[wv]=null,Uv=Mv[--wv],Mv[wv]=null}function WA(c,p){Mv[wv++]=Uv,Mv[wv++]=kv,Mv[wv++]=cx,Uv=p.id,kv=p.overflow,cx=c}var ev=null,L_=null,U1=!1,iv=null,Cv=!1,KS=Error(n(519));function qv(c){var p=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw N2(fv(p,c)),KS}function $A(c){var p=c.stateNode,C=c.type,D=c.memoizedProps;switch(p[i1]=c,p[u1]=D,C){case"dialog":G1("cancel",p),G1("close",p);break;case"iframe":case"object":case"embed":G1("load",p);break;case"video":case"audio":for(C=0;C<mA.length;C++)G1(mA[C],p);break;case"source":G1("error",p);break;case"img":case"image":case"link":G1("error",p),G1("load",p);break;case"details":G1("toggle",p);break;case"input":G1("invalid",p),Q_(p,D.value,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name,!0);break;case"select":G1("invalid",p);break;case"textarea":G1("invalid",p),$v(p,D.value,D.defaultValue,D.children)}C=D.children,typeof C!="string"&&typeof C!="number"&&typeof C!="bigint"||p.textContent===""+C||D.suppressHydrationWarning===!0||NT(p.textContent,C)?(D.popover!=null&&(G1("beforetoggle",p),G1("toggle",p)),D.onScroll!=null&&G1("scroll",p),D.onScrollEnd!=null&&G1("scrollend",p),D.onClick!=null&&(p.onclick=J_),p=!0):p=!1,p||qv(c,!0)}function XA(c){for(ev=c.return;ev;)switch(ev.tag){case 5:case 31:case 13:Cv=!1;return;case 27:case 3:Cv=!0;return;default:ev=ev.return}}function Gv(c){if(c!==ev)return!1;if(!U1)return XA(c),U1=!0,!1;var p=c.tag,C;if((C=p!==3&&p!==27)&&((C=p===5)&&(C=c.type,C=!(C!=="form"&&C!=="button")||gw(c.type,c.memoizedProps)),C=!C),C&&L_&&qv(c),XA(c),p===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(317));L_=WT(c)}else if(p===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(317));L_=WT(c)}else p===27?(p=L_,o2(c.type)?(c=bw,bw=null,L_=c):L_=p):L_=ev?jv(c.stateNode.nextSibling):null;return!0}function Zv(){L_=ev=null,U1=!1}function B2(){var c=iv;return c!==null&&(Lv===null?Lv=c:Lv.push.apply(Lv,c),iv=null),c}function N2(c){iv===null?iv=[c]:iv.push(c)}var aS=B(null),Ex=null,xv=null;function Vv(c,p,C){K(aS,p._currentValue),p._currentValue=C}function Qv(c){c._currentValue=aS.current,V(aS)}function qS(c,p,C){for(;c!==null;){var D=c.alternate;if((c.childLanes&p)!==p?(c.childLanes|=p,D!==null&&(D.childLanes|=p)):D!==null&&(D.childLanes&p)!==p&&(D.childLanes|=p),c===C)break;c=c.return}}function ZS(c,p,C,D){var G=c.child;for(G!==null&&(G.return=c);G!==null;){var $=G.dependencies;if($!==null){var tt=G.child;$=$.firstContext;e:for(;$!==null;){var i0=$;$=G;for(var D0=0;D0<p.length;D0++)if(i0.context===p[D0]){$.lanes|=C,i0=$.alternate,i0!==null&&(i0.lanes|=C),qS($.return,C,c),D||(tt=null);break e}$=i0.next}}else if(G.tag===18){if(tt=G.return,tt===null)throw Error(n(341));tt.lanes|=C,$=tt.alternate,$!==null&&($.lanes|=C),qS(tt,C,c),tt=null}else tt=G.child;if(tt!==null)tt.return=G;else for(tt=G;tt!==null;){if(tt===c){tt=null;break}if(G=tt.sibling,G!==null){G.return=tt.return,tt=G;break}tt=tt.return}G=tt}}function Yx(c,p,C,D){c=null;for(var G=p,$=!1;G!==null;){if(!$){if((G.flags&524288)!==0)$=!0;else if((G.flags&262144)!==0)break}if(G.tag===10){var tt=G.alternate;if(tt===null)throw Error(n(387));if(tt=tt.memoizedProps,tt!==null){var i0=G.type;B_(G.pendingProps.value,tt.value)||(c!==null?c.push(i0):c=[i0])}}else if(G===We.current){if(tt=G.alternate,tt===null)throw Error(n(387));tt.memoizedState.memoizedState!==G.memoizedState.memoizedState&&(c!==null?c.push(yA):c=[yA])}G=G.return}c!==null&&ZS(p,c,C,D),p.flags|=262144}function oS(c){for(c=c.firstContext;c!==null;){if(!B_(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function Mx(c){Ex=c,xv=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function tv(c){return YA(Ex,c)}function lS(c,p){return Ex===null&&Mx(c),YA(c,p)}function YA(c,p){var C=p._currentValue;if(p={context:p,memoizedValue:C,next:null},xv===null){if(c===null)throw Error(n(308));xv=p,c.dependencies={lanes:0,firstContext:p},c.flags|=524288}else xv=xv.next=p;return C}var lM=typeof AbortController<"u"?AbortController:function(){var c=[],p=this.signal={aborted:!1,addEventListener:function(C,D){c.push(D)}};this.abort=function(){p.aborted=!0,c.forEach(function(C){return C()})}},cM=r.unstable_scheduleCallback,uM=r.unstable_NormalPriority,U_={$$typeof:m,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function QS(){return{controller:new lM,data:new Map,refCount:0}}function Kx(c){c.refCount--,c.refCount===0&&cM(uM,function(){c.controller.abort()})}var qx=null,cS=0,wx=0,Cx=null;function KA(c,p){if(qx===null){var C=qx=[];cS=0,wx=ow(),Cx={status:"pending",value:void 0,then:function(D){C.push(D)}}}return cS++,p.then(JS,JS),p}function JS(){if(--cS===0&&qx!==null){Cx!==null&&(Cx.status="fulfilled");var c=qx;qx=null,wx=0,Cx=null;for(var p=0;p<c.length;p++)(0,c[p])()}}function qA(c,p){var C=[],D={status:"pending",value:null,reason:null,then:function(G){C.push(G)}};return c.then(function(){D.status="fulfilled",D.value=p;for(var G=0;G<C.length;G++)(0,C[G])(p)},function(G){for(D.status="rejected",D.reason=G,G=0;G<C.length;G++)(0,C[G])(void 0)}),D}var eA=k.S;k.S=function(c,p){aT=Xe(),typeof p=="object"&&p!==null&&typeof p.then=="function"&&KA(c,p),eA!==null&&eA(c,p)};var Tx=B(null);function z(){var c=Tx.current;return c!==null?c:P_.pooledCache}function ai(c,p){p===null?K(Tx,Tx.current):K(Tx,p.pool)}function Y(){var c=z();return c===null?null:{parent:U_._currentValue,pool:c}}var s0=Error(n(460)),y0=Error(n(474)),g0=Error(n(542)),Y0={then:function(){}};function k0(c){return c=c.status,c==="fulfilled"||c==="rejected"}function g1(c,p,C){switch(C=c[C],C===void 0?c.push(p):C!==p&&(p.then(J_,J_),p=C),p.status){case"fulfilled":return p.value;case"rejected":throw c=p.reason,f1(c),c;default:if(typeof p.status=="string")p.then(J_,J_);else{if(c=P_,c!==null&&100<c.shellSuspendCounter)throw Error(n(482));c=p,c.status="pending",c.then(function(D){if(p.status==="pending"){var G=p;G.status="fulfilled",G.value=D}},function(D){if(p.status==="pending"){var G=p;G.status="rejected",G.reason=D}})}switch(p.status){case"fulfilled":return p.value;case"rejected":throw c=p.reason,f1(c),c}throw W0=p,s0}}function B0(c){try{var p=c._init;return p(c._payload)}catch(C){throw C!==null&&typeof C=="object"&&typeof C.then=="function"?(W0=C,s0):C}}var W0=null;function $1(){if(W0===null)throw Error(n(459));var c=W0;return W0=null,c}function f1(c){if(c===s0||c===g0)throw Error(n(483))}var a1=null,A1=0;function E_(c){var p=A1;return A1+=1,a1===null&&(a1=[]),g1(a1,c,p)}function B1(c,p){p=p.props.ref,c.ref=p!==void 0?p:null}function D1(c,p){throw p.$$typeof===x?Error(n(525)):(c=Object.prototype.toString.call(p),Error(n(31,c==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":c)))}function X1(c){function p(V0,z0){if(c){var j0=V0.deletions;j0===null?(V0.deletions=[z0],V0.flags|=16):j0.push(z0)}}function C(V0,z0){if(!c)return null;for(;z0!==null;)p(V0,z0),z0=z0.sibling;return null}function D(V0){for(var z0=new Map;V0!==null;)V0.key!==null?z0.set(V0.key,V0):z0.set(V0.index,V0),V0=V0.sibling;return z0}function G(V0,z0){return V0=Yv(V0,z0),V0.index=0,V0.sibling=null,V0}function $(V0,z0,j0){return V0.index=j0,c?(j0=V0.alternate,j0!==null?(j0=j0.index,j0<z0?(V0.flags|=67108866,z0):j0):(V0.flags|=67108866,z0)):(V0.flags|=1048576,z0)}function tt(V0){return c&&V0.alternate===null&&(V0.flags|=67108866),V0}function i0(V0,z0,j0,t1){return z0===null||z0.tag!==6?(z0=sS(j0,V0.mode,t1),z0.return=V0,z0):(z0=G(z0,j0),z0.return=V0,z0)}function D0(V0,z0,j0,t1){var E1=j0.type;return E1===_?J0(V0,z0,j0.props.children,t1,j0.key):z0!==null&&(z0.elementType===E1||typeof E1=="object"&&E1!==null&&E1.$$typeof===M&&B0(E1)===z0.type)?(z0=G(z0,j0.props),B1(z0,j0),z0.return=V0,z0):(z0=P2(j0.type,j0.key,j0.props,null,V0.mode,t1),B1(z0,j0),z0.return=V0,z0)}function $0(V0,z0,j0,t1){return z0===null||z0.tag!==4||z0.stateNode.containerInfo!==j0.containerInfo||z0.stateNode.implementation!==j0.implementation?(z0=WS(j0,V0.mode,t1),z0.return=V0,z0):(z0=G(z0,j0.children||[]),z0.return=V0,z0)}function J0(V0,z0,j0,t1,E1){return z0===null||z0.tag!==7?(z0=ox(j0,V0.mode,t1,E1),z0.return=V0,z0):(z0=G(z0,j0),z0.return=V0,z0)}function n1(V0,z0,j0){if(typeof z0=="string"&&z0!==""||typeof z0=="number"||typeof z0=="bigint")return z0=sS(""+z0,V0.mode,j0),z0.return=V0,z0;if(typeof z0=="object"&&z0!==null){switch(z0.$$typeof){case y:return j0=P2(z0.type,z0.key,z0.props,null,V0.mode,j0),B1(j0,z0),j0.return=V0,j0;case b:return z0=WS(z0,V0.mode,j0),z0.return=V0,z0;case M:return z0=B0(z0),n1(V0,z0,j0)}if(N(z0)||L(z0))return z0=ox(z0,V0.mode,j0,null),z0.return=V0,z0;if(typeof z0.then=="function")return n1(V0,E_(z0),j0);if(z0.$$typeof===m)return n1(V0,lS(V0,z0),j0);D1(V0,z0)}return null}function K0(V0,z0,j0,t1){var E1=z0!==null?z0.key:null;if(typeof j0=="string"&&j0!==""||typeof j0=="number"||typeof j0=="bigint")return E1!==null?null:i0(V0,z0,""+j0,t1);if(typeof j0=="object"&&j0!==null){switch(j0.$$typeof){case y:return j0.key===E1?D0(V0,z0,j0,t1):null;case b:return j0.key===E1?$0(V0,z0,j0,t1):null;case M:return j0=B0(j0),K0(V0,z0,j0,t1)}if(N(j0)||L(j0))return E1!==null?null:J0(V0,z0,j0,t1,null);if(typeof j0.then=="function")return K0(V0,z0,E_(j0),t1);if(j0.$$typeof===m)return K0(V0,z0,lS(V0,j0),t1);D1(V0,j0)}return null}function Z0(V0,z0,j0,t1,E1){if(typeof t1=="string"&&t1!==""||typeof t1=="number"||typeof t1=="bigint")return V0=V0.get(j0)||null,i0(z0,V0,""+t1,E1);if(typeof t1=="object"&&t1!==null){switch(t1.$$typeof){case y:return V0=V0.get(t1.key===null?j0:t1.key)||null,D0(z0,V0,t1,E1);case b:return V0=V0.get(t1.key===null?j0:t1.key)||null,$0(z0,V0,t1,E1);case M:return t1=B0(t1),Z0(V0,z0,j0,t1,E1)}if(N(t1)||L(t1))return V0=V0.get(j0)||null,J0(z0,V0,t1,E1,null);if(typeof t1.then=="function")return Z0(V0,z0,j0,E_(t1),E1);if(t1.$$typeof===m)return Z0(V0,z0,j0,lS(z0,t1),E1);D1(z0,t1)}return null}function v1(V0,z0,j0,t1){for(var E1=null,Y1=null,y1=z0,I1=z0=0,W1=null;y1!==null&&I1<j0.length;I1++){y1.index>I1?(W1=y1,y1=null):W1=y1.sibling;var K1=K0(V0,y1,j0[I1],t1);if(K1===null){y1===null&&(y1=W1);break}c&&y1&&K1.alternate===null&&p(V0,y1),z0=$(K1,z0,I1),Y1===null?E1=K1:Y1.sibling=K1,Y1=K1,y1=W1}if(I1===j0.length)return C(V0,y1),U1&&Kv(V0,I1),E1;if(y1===null){for(;I1<j0.length;I1++)y1=n1(V0,j0[I1],t1),y1!==null&&(z0=$(y1,z0,I1),Y1===null?E1=y1:Y1.sibling=y1,Y1=y1);return U1&&Kv(V0,I1),E1}for(y1=D(y1);I1<j0.length;I1++)W1=Z0(y1,V0,I1,j0[I1],t1),W1!==null&&(c&&W1.alternate!==null&&y1.delete(W1.key===null?I1:W1.key),z0=$(W1,z0,I1),Y1===null?E1=W1:Y1.sibling=W1,Y1=W1);return c&&y1.forEach(function(d2){return p(V0,d2)}),U1&&Kv(V0,I1),E1}function C1(V0,z0,j0,t1){if(j0==null)throw Error(n(151));for(var E1=null,Y1=null,y1=z0,I1=z0=0,W1=null,K1=j0.next();y1!==null&&!K1.done;I1++,K1=j0.next()){y1.index>I1?(W1=y1,y1=null):W1=y1.sibling;var d2=K0(V0,y1,K1.value,t1);if(d2===null){y1===null&&(y1=W1);break}c&&y1&&d2.alternate===null&&p(V0,y1),z0=$(d2,z0,I1),Y1===null?E1=d2:Y1.sibling=d2,Y1=d2,y1=W1}if(K1.done)return C(V0,y1),U1&&Kv(V0,I1),E1;if(y1===null){for(;!K1.done;I1++,K1=j0.next())K1=n1(V0,K1.value,t1),K1!==null&&(z0=$(K1,z0,I1),Y1===null?E1=K1:Y1.sibling=K1,Y1=K1);return U1&&Kv(V0,I1),E1}for(y1=D(y1);!K1.done;I1++,K1=j0.next())K1=Z0(y1,V0,I1,K1.value,t1),K1!==null&&(c&&K1.alternate!==null&&y1.delete(K1.key===null?I1:K1.key),z0=$(K1,z0,I1),Y1===null?E1=K1:Y1.sibling=K1,Y1=K1);return c&&y1.forEach(function(MR){return p(V0,MR)}),U1&&Kv(V0,I1),E1}function R_(V0,z0,j0,t1){if(typeof j0=="object"&&j0!==null&&j0.type===_&&j0.key===null&&(j0=j0.props.children),typeof j0=="object"&&j0!==null){switch(j0.$$typeof){case y:e:{for(var E1=j0.key;z0!==null;){if(z0.key===E1){if(E1=j0.type,E1===_){if(z0.tag===7){C(V0,z0.sibling),t1=G(z0,j0.props.children),t1.return=V0,V0=t1;break e}}else if(z0.elementType===E1||typeof E1=="object"&&E1!==null&&E1.$$typeof===M&&B0(E1)===z0.type){C(V0,z0.sibling),t1=G(z0,j0.props),B1(t1,j0),t1.return=V0,V0=t1;break e}C(V0,z0);break}else p(V0,z0);z0=z0.sibling}j0.type===_?(t1=ox(j0.props.children,V0.mode,t1,j0.key),t1.return=V0,V0=t1):(t1=P2(j0.type,j0.key,j0.props,null,V0.mode,t1),B1(t1,j0),t1.return=V0,V0=t1)}return tt(V0);case b:e:{for(E1=j0.key;z0!==null;){if(z0.key===E1)if(z0.tag===4&&z0.stateNode.containerInfo===j0.containerInfo&&z0.stateNode.implementation===j0.implementation){C(V0,z0.sibling),t1=G(z0,j0.children||[]),t1.return=V0,V0=t1;break e}else{C(V0,z0);break}else p(V0,z0);z0=z0.sibling}t1=WS(j0,V0.mode,t1),t1.return=V0,V0=t1}return tt(V0);case M:return j0=B0(j0),R_(V0,z0,j0,t1)}if(N(j0))return v1(V0,z0,j0,t1);if(L(j0)){if(E1=L(j0),typeof E1!="function")throw Error(n(150));return j0=E1.call(j0),C1(V0,z0,j0,t1)}if(typeof j0.then=="function")return R_(V0,z0,E_(j0),t1);if(j0.$$typeof===m)return R_(V0,z0,lS(V0,j0),t1);D1(V0,j0)}return typeof j0=="string"&&j0!==""||typeof j0=="number"||typeof j0=="bigint"?(j0=""+j0,z0!==null&&z0.tag===6?(C(V0,z0.sibling),t1=G(z0,j0),t1.return=V0,V0=t1):(C(V0,z0),t1=sS(j0,V0.mode,t1),t1.return=V0,V0=t1),tt(V0)):C(V0,z0)}return function(V0,z0,j0,t1){try{A1=0;var E1=R_(V0,z0,j0,t1);return a1=null,E1}catch(y1){if(y1===s0||y1===g0)throw y1;var Y1=vv(29,y1,null,V0.mode);return Y1.lanes=t1,Y1.return=V0,Y1}finally{}}}var L1=X1(!0),d1=X1(!1),N1=!1;function k_(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function M1(c,p){c=c.updateQueue,p.updateQueue===c&&(p.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function H1(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function P1(c,p,C){var D=c.updateQueue;if(D===null)return null;if(D=D.shared,(q1&2)!==0){var G=D.pending;return G===null?p.next=p:(p.next=G.next,G.next=p),D.pending=p,p=iS(c),HS(c,null,C),p}return L2(c,D,p,C),iS(c)}function R1(c,p,C){if(p=p.updateQueue,p!==null&&(p=p.shared,(C&4194048)!==0)){var D=p.lanes;D&=c.pendingLanes,C|=D,p.lanes=C,n0(c,C)}}function z1(c,p){var C=c.updateQueue,D=c.alternate;if(D!==null&&(D=D.updateQueue,C===D)){var G=null,$=null;if(C=C.firstBaseUpdate,C!==null){do{var tt={lane:C.lane,tag:C.tag,payload:C.payload,callback:null,next:null};$===null?G=$=tt:$=$.next=tt,C=C.next}while(C!==null);$===null?G=$=p:$=$.next=p}else G=$=p;C={baseState:D.baseState,firstBaseUpdate:G,lastBaseUpdate:$,shared:D.shared,callbacks:D.callbacks},c.updateQueue=C;return}c=C.lastBaseUpdate,c===null?C.firstBaseUpdate=p:c.next=p,C.lastBaseUpdate=p}var Jv=!1;function Zx(){if(Jv){var c=Cx;if(c!==null)throw c}}function ux(c,p,C,D){Jv=!1;var G=c.updateQueue;N1=!1;var $=G.firstBaseUpdate,tt=G.lastBaseUpdate,i0=G.shared.pending;if(i0!==null){G.shared.pending=null;var D0=i0,$0=D0.next;D0.next=null,tt===null?$=$0:tt.next=$0,tt=D0;var J0=c.alternate;J0!==null&&(J0=J0.updateQueue,i0=J0.lastBaseUpdate,i0!==tt&&(i0===null?J0.firstBaseUpdate=$0:i0.next=$0,J0.lastBaseUpdate=D0))}if($!==null){var n1=G.baseState;tt=0,J0=$0=D0=null,i0=$;do{var K0=i0.lane&-536870913,Z0=K0!==i0.lane;if(Z0?(j1&K0)===K0:(D&K0)===K0){K0!==0&&K0===wx&&(Jv=!0),J0!==null&&(J0=J0.next={lane:0,tag:i0.tag,payload:i0.payload,callback:null,next:null});e:{var v1=c,C1=i0;K0=p;var R_=C;switch(C1.tag){case 1:if(v1=C1.payload,typeof v1=="function"){n1=v1.call(R_,n1,K0);break e}n1=v1;break e;case 3:v1.flags=v1.flags&-65537|128;case 0:if(v1=C1.payload,K0=typeof v1=="function"?v1.call(R_,n1,K0):v1,K0==null)break e;n1=g({},n1,K0);break e;case 2:N1=!0}}K0=i0.callback,K0!==null&&(c.flags|=64,Z0&&(c.flags|=8192),Z0=G.callbacks,Z0===null?G.callbacks=[K0]:Z0.push(K0))}else Z0={lane:K0,tag:i0.tag,payload:i0.payload,callback:i0.callback,next:null},J0===null?($0=J0=Z0,D0=n1):J0=J0.next=Z0,tt|=K0;if(i0=i0.next,i0===null){if(i0=G.shared.pending,i0===null)break;Z0=i0,i0=Z0.next,Z0.next=null,G.lastBaseUpdate=Z0,G.shared.pending=null}}while(!0);J0===null&&(D0=n1),G.baseState=D0,G.firstBaseUpdate=$0,G.lastBaseUpdate=J0,$===null&&(G.shared.lanes=0),n2|=tt,c.lanes=tt,c.memoizedState=n1}}function z2(c,p){if(typeof c!="function")throw Error(n(191,c));c.call(p)}function Pw(c,p){var C=c.callbacks;if(C!==null)for(c.callbacks=null,c=0;c<C.length;c++)z2(C[c],p)}var uS=B(null),ZA=B(0);function Ow(c,p){c=zx,K(ZA,c),K(uS,p),zx=c|p.baseLanes}function hM(){K(ZA,zx),K(uS,uS.current)}function dM(){zx=ZA.current,V(uS),V(ZA)}var Ov=B(null),Hv=null;function Qx(c){var p=c.alternate;K(W_,W_.current&1),K(Ov,c),Hv===null&&(p===null||uS.current!==null||p.memoizedState!==null)&&(Hv=c)}function fM(c){K(W_,W_.current),K(Ov,c),Hv===null&&(Hv=c)}function Iw(c){c.tag===22?(K(W_,W_.current),K(Ov,c),Hv===null&&(Hv=c)):Jx()}function Jx(){K(W_,W_.current),K(Ov,Ov.current)}function Iv(c){V(Ov),Hv===c&&(Hv=null),V(W_)}var W_=B(0);function QA(c){for(var p=c;p!==null;){if(p.tag===13){var C=p.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||xw(C)||yw(C)))return p}else if(p.tag===19&&(p.memoizedProps.revealOrder==="forwards"||p.memoizedProps.revealOrder==="backwards"||p.memoizedProps.revealOrder==="unstable_legacy-backwards"||p.memoizedProps.revealOrder==="together")){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var Rx=0,O1=null,C_=null,K_=null,JA=!1,hS=!1,F2=!1,eE=0,tA=0,dS=null,m3=0;function G_(){throw Error(n(321))}function pM(c,p){if(p===null)return!1;for(var C=0;C<p.length&&C<c.length;C++)if(!B_(c[C],p[C]))return!1;return!0}function mM(c,p,C,D,G,$){return Rx=$,O1=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,k.H=c===null||c.memoizedState===null?_C:DM,F2=!1,$=C(D,G),F2=!1,hS&&($=Nw(p,C,D,G)),Bw(c),$}function Bw(c){k.H=rA;var p=C_!==null&&C_.next!==null;if(Rx=0,K_=C_=O1=null,JA=!1,tA=0,dS=null,p)throw Error(n(300));c===null||q_||(c=c.dependencies,c!==null&&oS(c)&&(q_=!0))}function Nw(c,p,C,D){O1=c;var G=0;do{if(hS&&(dS=null),tA=0,hS=!1,25<=G)throw Error(n(301));if(G+=1,K_=C_=null,c.updateQueue!=null){var $=c.updateQueue;$.lastEffect=null,$.events=null,$.stores=null,$.memoCache!=null&&($.memoCache.index=0)}k.H=vC,$=p(C,D)}while(hS);return $}function g3(){var c=k.H,p=c.useState()[0];return p=typeof p.then=="function"?nA(p):p,c=c.useState()[0],(C_!==null?C_.memoizedState:null)!==c&&(O1.flags|=1024),p}function gM(){var c=eE!==0;return eE=0,c}function _M(c,p,C){p.updateQueue=c.updateQueue,p.flags&=-2053,c.lanes&=~C}function vM(c){if(JA){for(c=c.memoizedState;c!==null;){var p=c.queue;p!==null&&(p.pending=null),c=c.next}JA=!1}Rx=0,K_=C_=O1=null,hS=!1,tA=eE=0,dS=null}function yv(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return K_===null?O1.memoizedState=K_=c:K_=K_.next=c,K_}function $_(){if(C_===null){var c=O1.alternate;c=c!==null?c.memoizedState:null}else c=C_.next;var p=K_===null?O1.memoizedState:K_.next;if(p!==null)K_=p,C_=c;else{if(c===null)throw O1.alternate===null?Error(n(467)):Error(n(310));C_=c,c={memoizedState:C_.memoizedState,baseState:C_.baseState,baseQueue:C_.baseQueue,queue:C_.queue,next:null},K_===null?O1.memoizedState=K_=c:K_=K_.next=c}return K_}function tE(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function nA(c){var p=tA;return tA+=1,dS===null&&(dS=[]),c=g1(dS,c,p),p=O1,(K_===null?p.memoizedState:K_.next)===null&&(p=p.alternate,k.H=p===null||p.memoizedState===null?_C:DM),c}function nE(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return nA(c);if(c.$$typeof===m)return tv(c)}throw Error(n(438,String(c)))}function xM(c){var p=null,C=O1.updateQueue;if(C!==null&&(p=C.memoCache),p==null){var D=O1.alternate;D!==null&&(D=D.updateQueue,D!==null&&(D=D.memoCache,D!=null&&(p={data:D.data.map(function(G){return G.slice()}),index:0})))}if(p==null&&(p={data:[],index:0}),C===null&&(C=tE(),O1.updateQueue=C),C.memoCache=p,C=p.data[p.index],C===void 0)for(C=p.data[p.index]=Array(c),D=0;D<c;D++)C[D]=R;return p.index++,C}function Dx(c,p){return typeof p=="function"?p(c):p}function iE(c){var p=$_();return yM(p,C_,c)}function yM(c,p,C){var D=c.queue;if(D===null)throw Error(n(311));D.lastRenderedReducer=C;var G=c.baseQueue,$=D.pending;if($!==null){if(G!==null){var tt=G.next;G.next=$.next,$.next=tt}p.baseQueue=G=$,D.pending=null}if($=c.baseState,G===null)c.memoizedState=$;else{p=G.next;var i0=tt=null,D0=null,$0=p,J0=!1;do{var n1=$0.lane&-536870913;if(n1!==$0.lane?(j1&n1)===n1:(Rx&n1)===n1){var K0=$0.revertLane;if(K0===0)D0!==null&&(D0=D0.next={lane:0,revertLane:0,gesture:null,action:$0.action,hasEagerState:$0.hasEagerState,eagerState:$0.eagerState,next:null}),n1===wx&&(J0=!0);else if((Rx&K0)===K0){$0=$0.next,K0===wx&&(J0=!0);continue}else n1={lane:0,revertLane:$0.revertLane,gesture:null,action:$0.action,hasEagerState:$0.hasEagerState,eagerState:$0.eagerState,next:null},D0===null?(i0=D0=n1,tt=$):D0=D0.next=n1,O1.lanes|=K0,n2|=K0;n1=$0.action,F2&&C($,n1),$=$0.hasEagerState?$0.eagerState:C($,n1)}else K0={lane:n1,revertLane:$0.revertLane,gesture:$0.gesture,action:$0.action,hasEagerState:$0.hasEagerState,eagerState:$0.eagerState,next:null},D0===null?(i0=D0=K0,tt=$):D0=D0.next=K0,O1.lanes|=n1,n2|=n1;$0=$0.next}while($0!==null&&$0!==p);if(D0===null?tt=$:D0.next=i0,!B_($,c.memoizedState)&&(q_=!0,J0&&(C=Cx,C!==null)))throw C;c.memoizedState=$,c.baseState=tt,c.baseQueue=D0,D.lastRenderedState=$}return G===null&&(D.lanes=0),[c.memoizedState,D.dispatch]}function bM(c){var p=$_(),C=p.queue;if(C===null)throw Error(n(311));C.lastRenderedReducer=c;var D=C.dispatch,G=C.pending,$=p.memoizedState;if(G!==null){C.pending=null;var tt=G=G.next;do $=c($,tt.action),tt=tt.next;while(tt!==G);B_($,p.memoizedState)||(q_=!0),p.memoizedState=$,p.baseQueue===null&&(p.baseState=$),C.lastRenderedState=$}return[$,D]}function zw(c,p,C){var D=O1,G=$_(),$=U1;if($){if(C===void 0)throw Error(n(407));C=C()}else C=p();var tt=!B_((C_||G).memoizedState,C);if(tt&&(G.memoizedState=C,q_=!0),G=G.queue,EM(kw.bind(null,D,G,c),[c]),G.getSnapshot!==p||tt||K_!==null&&K_.memoizedState.tag&1){if(D.flags|=2048,fS(9,{destroy:void 0},Uw.bind(null,D,G,C,p),null),P_===null)throw Error(n(349));$||(Rx&127)!==0||Fw(D,p,C)}return C}function Fw(c,p,C){c.flags|=16384,c={getSnapshot:p,value:C},p=O1.updateQueue,p===null?(p=tE(),O1.updateQueue=p,p.stores=[c]):(C=p.stores,C===null?p.stores=[c]:C.push(c))}function Uw(c,p,C,D){p.value=C,p.getSnapshot=D,Gw(p)&&Vw(c)}function kw(c,p,C){return C(function(){Gw(p)&&Vw(c)})}function Gw(c){var p=c.getSnapshot;c=c.value;try{var C=p();return!B_(c,C)}catch{return!0}}function Vw(c){var p=sx(c,2);p!==null&&Pv(p,c,2)}function SM(c){var p=yv();if(typeof c=="function"){var C=c;if(c=C(),F2){p0(!0);try{C()}finally{p0(!1)}}}return p.memoizedState=p.baseState=c,p.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dx,lastRenderedState:c},p}function Hw(c,p,C,D){return c.baseState=C,yM(c,C_,typeof D=="function"?D:Dx)}function _3(c,p,C,D,G){if(aE(c))throw Error(n(485));if(c=p.action,c!==null){var $={payload:G,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(tt){$.listeners.push(tt)}};k.T!==null?C(!0):$.isTransition=!1,D($),C=p.pending,C===null?($.next=p.pending=$,jw(p,$)):($.next=C.next,p.pending=C.next=$)}}function jw(c,p){var C=p.action,D=p.payload,G=c.state;if(p.isTransition){var $=k.T,tt={};k.T=tt;try{var i0=C(G,D),D0=k.S;D0!==null&&D0(tt,i0),Ww(c,p,i0)}catch($0){AM(c,p,$0)}finally{$!==null&&tt.types!==null&&($.types=tt.types),k.T=$}}else try{$=C(G,D),Ww(c,p,$)}catch($0){AM(c,p,$0)}}function Ww(c,p,C){C!==null&&typeof C=="object"&&typeof C.then=="function"?C.then(function(D){$w(c,p,D)},function(D){return AM(c,p,D)}):$w(c,p,C)}function $w(c,p,C){p.status="fulfilled",p.value=C,Xw(p),c.state=C,p=c.pending,p!==null&&(C=p.next,C===p?c.pending=null:(C=C.next,p.next=C,jw(c,C)))}function AM(c,p,C){var D=c.pending;if(c.pending=null,D!==null){D=D.next;do p.status="rejected",p.reason=C,Xw(p),p=p.next;while(p!==D)}c.action=null}function Xw(c){c=c.listeners;for(var p=0;p<c.length;p++)(0,c[p])()}function Yw(c,p){return p}function Kw(c,p){if(U1){var C=P_.formState;if(C!==null){e:{var D=O1;if(U1){if(L_){t:{for(var G=L_,$=Cv;G.nodeType!==8;){if(!$){G=null;break t}if(G=jv(G.nextSibling),G===null){G=null;break t}}$=G.data,G=$==="F!"||$==="F"?G:null}if(G){L_=jv(G.nextSibling),D=G.data==="F!";break e}}qv(D)}D=!1}D&&(p=C[0])}}return C=yv(),C.memoizedState=C.baseState=p,D={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Yw,lastRenderedState:p},C.queue=D,C=pC.bind(null,O1,D),D.dispatch=C,D=SM(!1),$=RM.bind(null,O1,!1,D.queue),D=yv(),G={state:p,dispatch:null,action:c,pending:null},D.queue=G,C=_3.bind(null,O1,G,$,C),G.dispatch=C,D.memoizedState=c,[p,C,!1]}function qw(c){var p=$_();return Zw(p,C_,c)}function Zw(c,p,C){if(p=yM(c,p,Yw)[0],c=iE(Dx)[0],typeof p=="object"&&p!==null&&typeof p.then=="function")try{var D=nA(p)}catch(tt){throw tt===s0?g0:tt}else D=p;p=$_();var G=p.queue,$=G.dispatch;return C!==p.memoizedState&&(O1.flags|=2048,fS(9,{destroy:void 0},v3.bind(null,G,C),null)),[D,$,c]}function v3(c,p){c.action=p}function Qw(c){var p=$_(),C=C_;if(C!==null)return Zw(p,C,c);$_(),p=p.memoizedState,C=$_();var D=C.queue.dispatch;return C.memoizedState=c,[p,D,!1]}function fS(c,p,C,D){return c={tag:c,create:C,deps:D,inst:p,next:null},p=O1.updateQueue,p===null&&(p=tE(),O1.updateQueue=p),C=p.lastEffect,C===null?p.lastEffect=c.next=c:(D=C.next,C.next=c,c.next=D,p.lastEffect=c),c}function Jw(){return $_().memoizedState}function rE(c,p,C,D){var G=yv();O1.flags|=c,G.memoizedState=fS(1|p,{destroy:void 0},C,D===void 0?null:D)}function sE(c,p,C,D){var G=$_();D=D===void 0?null:D;var $=G.memoizedState.inst;C_!==null&&D!==null&&pM(D,C_.memoizedState.deps)?G.memoizedState=fS(p,$,C,D):(O1.flags|=c,G.memoizedState=fS(1|p,$,C,D))}function eC(c,p){rE(8390656,8,c,p)}function EM(c,p){sE(2048,8,c,p)}function x3(c){O1.flags|=4;var p=O1.updateQueue;if(p===null)p=tE(),O1.updateQueue=p,p.events=[c];else{var C=p.events;C===null?p.events=[c]:C.push(c)}}function tC(c){var p=$_().memoizedState;return x3({ref:p,nextImpl:c}),function(){if((q1&2)!==0)throw Error(n(440));return p.impl.apply(void 0,arguments)}}function nC(c,p){return sE(4,2,c,p)}function iC(c,p){return sE(4,4,c,p)}function rC(c,p){if(typeof p=="function"){c=c();var C=p(c);return function(){typeof C=="function"?C():p(null)}}if(p!=null)return c=c(),p.current=c,function(){p.current=null}}function sC(c,p,C){C=C!=null?C.concat([c]):null,sE(4,4,rC.bind(null,p,c),C)}function MM(){}function aC(c,p){var C=$_();p=p===void 0?null:p;var D=C.memoizedState;return p!==null&&pM(p,D[1])?D[0]:(C.memoizedState=[c,p],c)}function oC(c,p){var C=$_();p=p===void 0?null:p;var D=C.memoizedState;if(p!==null&&pM(p,D[1]))return D[0];if(D=c(),F2){p0(!0);try{c()}finally{p0(!1)}}return C.memoizedState=[D,p],D}function wM(c,p,C){return C===void 0||(Rx&1073741824)!==0&&(j1&261930)===0?c.memoizedState=p:(c.memoizedState=C,c=lT(),O1.lanes|=c,n2|=c,C)}function lC(c,p,C,D){return B_(C,p)?C:uS.current!==null?(c=wM(c,C,D),B_(c,p)||(q_=!0),c):(Rx&42)===0||(Rx&1073741824)!==0&&(j1&261930)===0?(q_=!0,c.memoizedState=C):(c=lT(),O1.lanes|=c,n2|=c,p)}function cC(c,p,C,D,G){var $=U.p;U.p=$!==0&&8>$?$:8;var tt=k.T,i0={};k.T=i0,RM(c,!1,p,C);try{var D0=G(),$0=k.S;if($0!==null&&$0(i0,D0),D0!==null&&typeof D0=="object"&&typeof D0.then=="function"){var J0=qA(D0,D);iA(c,p,J0,zv(c))}else iA(c,p,D,zv(c))}catch(n1){iA(c,p,{then:function(){},status:"rejected",reason:n1},zv())}finally{U.p=$,tt!==null&&i0.types!==null&&(tt.types=i0.types),k.T=tt}}function y3(){}function CM(c,p,C,D){if(c.tag!==5)throw Error(n(476));var G=uC(c).queue;cC(c,G,p,F,C===null?y3:function(){return hC(c),C(D)})}function uC(c){var p=c.memoizedState;if(p!==null)return p;p={memoizedState:F,baseState:F,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dx,lastRenderedState:F},next:null};var C={};return p.next={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dx,lastRenderedState:C},next:null},c.memoizedState=p,c=c.alternate,c!==null&&(c.memoizedState=p),p}function hC(c){var p=uC(c);p.next===null&&(p=c.alternate.memoizedState),iA(c,p.next.queue,{},zv())}function TM(){return tv(yA)}function dC(){return $_().memoizedState}function fC(){return $_().memoizedState}function b3(c){for(var p=c.return;p!==null;){switch(p.tag){case 24:case 3:var C=zv();c=H1(C);var D=P1(p,c,C);D!==null&&(Pv(D,p,C),R1(D,p,C)),p={cache:QS()},c.payload=p;return}p=p.return}}function S3(c,p,C){var D=zv();C={lane:D,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null},aE(c)?mC(p,C):(C=A_(c,p,C,D),C!==null&&(Pv(C,c,D),gC(C,p,D)))}function pC(c,p,C){var D=zv();iA(c,p,C,D)}function iA(c,p,C,D){var G={lane:D,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null};if(aE(c))mC(p,G);else{var $=c.alternate;if(c.lanes===0&&($===null||$.lanes===0)&&($=p.lastRenderedReducer,$!==null))try{var tt=p.lastRenderedState,i0=$(tt,C);if(G.hasEagerState=!0,G.eagerState=i0,B_(i0,tt))return L2(c,p,G,0),P_===null&&D2(),!1}catch{}finally{}if(C=A_(c,p,G,D),C!==null)return Pv(C,c,D),gC(C,p,D),!0}return!1}function RM(c,p,C,D){if(D={lane:2,revertLane:ow(),gesture:null,action:D,hasEagerState:!1,eagerState:null,next:null},aE(c)){if(p)throw Error(n(479))}else p=A_(c,C,D,2),p!==null&&Pv(p,c,2)}function aE(c){var p=c.alternate;return c===O1||p!==null&&p===O1}function mC(c,p){hS=JA=!0;var C=c.pending;C===null?p.next=p:(p.next=C.next,C.next=p),c.pending=p}function gC(c,p,C){if((C&4194048)!==0){var D=p.lanes;D&=c.pendingLanes,C|=D,p.lanes=C,n0(c,C)}}var rA={readContext:tv,use:nE,useCallback:G_,useContext:G_,useEffect:G_,useImperativeHandle:G_,useLayoutEffect:G_,useInsertionEffect:G_,useMemo:G_,useReducer:G_,useRef:G_,useState:G_,useDebugValue:G_,useDeferredValue:G_,useTransition:G_,useSyncExternalStore:G_,useId:G_,useHostTransitionStatus:G_,useFormState:G_,useActionState:G_,useOptimistic:G_,useMemoCache:G_,useCacheRefresh:G_};rA.useEffectEvent=G_;var _C={readContext:tv,use:nE,useCallback:function(c,p){return yv().memoizedState=[c,p===void 0?null:p],c},useContext:tv,useEffect:eC,useImperativeHandle:function(c,p,C){C=C!=null?C.concat([c]):null,rE(4194308,4,rC.bind(null,p,c),C)},useLayoutEffect:function(c,p){return rE(4194308,4,c,p)},useInsertionEffect:function(c,p){rE(4,2,c,p)},useMemo:function(c,p){var C=yv();p=p===void 0?null:p;var D=c();if(F2){p0(!0);try{c()}finally{p0(!1)}}return C.memoizedState=[D,p],D},useReducer:function(c,p,C){var D=yv();if(C!==void 0){var G=C(p);if(F2){p0(!0);try{C(p)}finally{p0(!1)}}}else G=p;return D.memoizedState=D.baseState=G,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:G},D.queue=c,c=c.dispatch=S3.bind(null,O1,c),[D.memoizedState,c]},useRef:function(c){var p=yv();return c={current:c},p.memoizedState=c},useState:function(c){c=SM(c);var p=c.queue,C=pC.bind(null,O1,p);return p.dispatch=C,[c.memoizedState,C]},useDebugValue:MM,useDeferredValue:function(c,p){var C=yv();return wM(C,c,p)},useTransition:function(){var c=SM(!1);return c=cC.bind(null,O1,c.queue,!0,!1),yv().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,p,C){var D=O1,G=yv();if(U1){if(C===void 0)throw Error(n(407));C=C()}else{if(C=p(),P_===null)throw Error(n(349));(j1&127)!==0||Fw(D,p,C)}G.memoizedState=C;var $={value:C,getSnapshot:p};return G.queue=$,eC(kw.bind(null,D,$,c),[c]),D.flags|=2048,fS(9,{destroy:void 0},Uw.bind(null,D,$,C,p),null),C},useId:function(){var c=yv(),p=P_.identifierPrefix;if(U1){var C=kv,D=Uv;C=(D&~(1<<32-x0(D)-1)).toString(32)+C,p="_"+p+"R_"+C,C=eE++,0<C&&(p+="H"+C.toString(32)),p+="_"}else C=m3++,p="_"+p+"r_"+C.toString(32)+"_";return c.memoizedState=p},useHostTransitionStatus:TM,useFormState:Kw,useActionState:Kw,useOptimistic:function(c){var p=yv();p.memoizedState=p.baseState=c;var C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return p.queue=C,p=RM.bind(null,O1,!0,C),C.dispatch=p,[c,p]},useMemoCache:xM,useCacheRefresh:function(){return yv().memoizedState=b3.bind(null,O1)},useEffectEvent:function(c){var p=yv(),C={impl:c};return p.memoizedState=C,function(){if((q1&2)!==0)throw Error(n(440));return C.impl.apply(void 0,arguments)}}},DM={readContext:tv,use:nE,useCallback:aC,useContext:tv,useEffect:EM,useImperativeHandle:sC,useInsertionEffect:nC,useLayoutEffect:iC,useMemo:oC,useReducer:iE,useRef:Jw,useState:function(){return iE(Dx)},useDebugValue:MM,useDeferredValue:function(c,p){var C=$_();return lC(C,C_.memoizedState,c,p)},useTransition:function(){var c=iE(Dx)[0],p=$_().memoizedState;return[typeof c=="boolean"?c:nA(c),p]},useSyncExternalStore:zw,useId:dC,useHostTransitionStatus:TM,useFormState:qw,useActionState:qw,useOptimistic:function(c,p){var C=$_();return Hw(C,C_,c,p)},useMemoCache:xM,useCacheRefresh:fC};DM.useEffectEvent=tC;var vC={readContext:tv,use:nE,useCallback:aC,useContext:tv,useEffect:EM,useImperativeHandle:sC,useInsertionEffect:nC,useLayoutEffect:iC,useMemo:oC,useReducer:bM,useRef:Jw,useState:function(){return bM(Dx)},useDebugValue:MM,useDeferredValue:function(c,p){var C=$_();return C_===null?wM(C,c,p):lC(C,C_.memoizedState,c,p)},useTransition:function(){var c=bM(Dx)[0],p=$_().memoizedState;return[typeof c=="boolean"?c:nA(c),p]},useSyncExternalStore:zw,useId:dC,useHostTransitionStatus:TM,useFormState:Qw,useActionState:Qw,useOptimistic:function(c,p){var C=$_();return C_!==null?Hw(C,C_,c,p):(C.baseState=c,[c,C.queue.dispatch])},useMemoCache:xM,useCacheRefresh:fC};vC.useEffectEvent=tC;function LM(c,p,C,D){p=c.memoizedState,C=C(D,p),C=C==null?p:g({},p,C),c.memoizedState=C,c.lanes===0&&(c.updateQueue.baseState=C)}var PM={enqueueSetState:function(c,p,C){c=c._reactInternals;var D=zv(),G=H1(D);G.payload=p,C!=null&&(G.callback=C),p=P1(c,G,D),p!==null&&(Pv(p,c,D),R1(p,c,D))},enqueueReplaceState:function(c,p,C){c=c._reactInternals;var D=zv(),G=H1(D);G.tag=1,G.payload=p,C!=null&&(G.callback=C),p=P1(c,G,D),p!==null&&(Pv(p,c,D),R1(p,c,D))},enqueueForceUpdate:function(c,p){c=c._reactInternals;var C=zv(),D=H1(C);D.tag=2,p!=null&&(D.callback=p),p=P1(c,D,C),p!==null&&(Pv(p,c,C),R1(p,c,C))}};function xC(c,p,C,D,G,$,tt){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(D,$,tt):p.prototype&&p.prototype.isPureReactComponent?!Hx(C,D)||!Hx(G,$):!0}function yC(c,p,C,D){c=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(C,D),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(C,D),p.state!==c&&PM.enqueueReplaceState(p,p.state,null)}function U2(c,p){var C=p;if("ref"in p){C={};for(var D in p)D!=="ref"&&(C[D]=p[D])}if(c=c.defaultProps){C===p&&(C=g({},C));for(var G in c)C[G]===void 0&&(C[G]=c[G])}return C}function bC(c){T2(c)}function SC(c){console.error(c)}function AC(c){T2(c)}function oE(c,p){try{var C=c.onUncaughtError;C(p.value,{componentStack:p.stack})}catch(D){setTimeout(function(){throw D})}}function EC(c,p,C){try{var D=c.onCaughtError;D(C.value,{componentStack:C.stack,errorBoundary:p.tag===1?p.stateNode:null})}catch(G){setTimeout(function(){throw G})}}function OM(c,p,C){return C=H1(C),C.tag=3,C.payload={element:null},C.callback=function(){oE(c,p)},C}function MC(c){return c=H1(c),c.tag=3,c}function wC(c,p,C,D){var G=C.type.getDerivedStateFromError;if(typeof G=="function"){var $=D.value;c.payload=function(){return G($)},c.callback=function(){EC(p,C,D)}}var tt=C.stateNode;tt!==null&&typeof tt.componentDidCatch=="function"&&(c.callback=function(){EC(p,C,D),typeof G!="function"&&(i2===null?i2=new Set([this]):i2.add(this));var i0=D.stack;this.componentDidCatch(D.value,{componentStack:i0!==null?i0:""})})}function A3(c,p,C,D,G){if(C.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){if(p=C.alternate,p!==null&&Yx(p,C,G,!0),C=Ov.current,C!==null){switch(C.tag){case 31:case 13:return Hv===null?xE():C.alternate===null&&V_===0&&(V_=3),C.flags&=-257,C.flags|=65536,C.lanes=G,D===Y0?C.flags|=16384:(p=C.updateQueue,p===null?C.updateQueue=new Set([D]):p.add(D),rw(c,D,G)),!1;case 22:return C.flags|=65536,D===Y0?C.flags|=16384:(p=C.updateQueue,p===null?(p={transitions:null,markerInstances:null,retryQueue:new Set([D])},C.updateQueue=p):(C=p.retryQueue,C===null?p.retryQueue=new Set([D]):C.add(D)),rw(c,D,G)),!1}throw Error(n(435,C.tag))}return rw(c,D,G),xE(),!1}if(U1)return p=Ov.current,p!==null?((p.flags&65536)===0&&(p.flags|=256),p.flags|=65536,p.lanes=G,D!==KS&&(c=Error(n(422),{cause:D}),N2(fv(c,C)))):(D!==KS&&(p=Error(n(423),{cause:D}),N2(fv(p,C))),c=c.current.alternate,c.flags|=65536,G&=-G,c.lanes|=G,D=fv(D,C),G=OM(c.stateNode,D,G),z1(c,G),V_!==4&&(V_=2)),!1;var $=Error(n(520),{cause:D});if($=fv($,C),dA===null?dA=[$]:dA.push($),V_!==4&&(V_=2),p===null)return!0;D=fv(D,C),C=p;do{switch(C.tag){case 3:return C.flags|=65536,c=G&-G,C.lanes|=c,c=OM(C.stateNode,D,c),z1(C,c),!1;case 1:if(p=C.type,$=C.stateNode,(C.flags&128)===0&&(typeof p.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(i2===null||!i2.has($))))return C.flags|=65536,G&=-G,C.lanes|=G,G=MC(G),wC(G,c,C,D),z1(C,G),!1}C=C.return}while(C!==null);return!1}var IM=Error(n(461)),q_=!1;function av(c,p,C,D){p.child=c===null?d1(p,null,C,D):L1(p,c.child,C,D)}function CC(c,p,C,D,G){C=C.render;var $=p.ref;if("ref"in D){var tt={};for(var i0 in D)i0!=="ref"&&(tt[i0]=D[i0])}else tt=D;return Mx(p),D=mM(c,p,C,tt,$,G),i0=gM(),c!==null&&!q_?(_M(c,p,G),Lx(c,p,G)):(U1&&i0&&XS(p),p.flags|=1,av(c,p,D,G),p.child)}function TC(c,p,C,D,G){if(c===null){var $=C.type;return typeof $=="function"&&!rS($)&&$.defaultProps===void 0&&C.compare===null?(p.tag=15,p.type=$,RC(c,p,$,D,G)):(c=P2(C.type,null,D,p,p.mode,G),c.ref=p.ref,c.return=p,p.child=c)}if($=c.child,!VM(c,G)){var tt=$.memoizedProps;if(C=C.compare,C=C!==null?C:Hx,C(tt,D)&&c.ref===p.ref)return Lx(c,p,G)}return p.flags|=1,c=Yv($,D),c.ref=p.ref,c.return=p,p.child=c}function RC(c,p,C,D,G){if(c!==null){var $=c.memoizedProps;if(Hx($,D)&&c.ref===p.ref)if(q_=!1,p.pendingProps=D=$,VM(c,G))(c.flags&131072)!==0&&(q_=!0);else return p.lanes=c.lanes,Lx(c,p,G)}return BM(c,p,C,D,G)}function DC(c,p,C,D){var G=D.children,$=c!==null?c.memoizedState:null;if(c===null&&p.stateNode===null&&(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),D.mode==="hidden"){if((p.flags&128)!==0){if($=$!==null?$.baseLanes|C:C,c!==null){for(D=p.child=c.child,G=0;D!==null;)G=G|D.lanes|D.childLanes,D=D.sibling;D=G&~$}else D=0,p.child=null;return LC(c,p,$,C,D)}if((C&536870912)!==0)p.memoizedState={baseLanes:0,cachePool:null},c!==null&&ai(p,$!==null?$.cachePool:null),$!==null?Ow(p,$):hM(),Iw(p);else return D=p.lanes=536870912,LC(c,p,$!==null?$.baseLanes|C:C,C,D)}else $!==null?(ai(p,$.cachePool),Ow(p,$),Jx(),p.memoizedState=null):(c!==null&&ai(p,null),hM(),Jx());return av(c,p,G,C),p.child}function sA(c,p){return c!==null&&c.tag===22||p.stateNode!==null||(p.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),p.sibling}function LC(c,p,C,D,G){var $=z();return $=$===null?null:{parent:U_._currentValue,pool:$},p.memoizedState={baseLanes:C,cachePool:$},c!==null&&ai(p,null),hM(),Iw(p),c!==null&&Yx(c,p,D,!0),p.childLanes=G,null}function lE(c,p){return p=uE({mode:p.mode,children:p.children},c.mode),p.ref=c.ref,c.child=p,p.return=c,p}function PC(c,p,C){return L1(p,c.child,null,C),c=lE(p,p.pendingProps),c.flags|=2,Iv(p),p.memoizedState=null,c}function E3(c,p,C){var D=p.pendingProps,G=(p.flags&128)!==0;if(p.flags&=-129,c===null){if(U1){if(D.mode==="hidden")return c=lE(p,D),p.lanes=536870912,sA(null,c);if(fM(p),(c=L_)?(c=jT(c,Cv),c=c!==null&&c.data==="&"?c:null,c!==null&&(p.memoizedState={dehydrated:c,treeContext:cx!==null?{id:Uv,overflow:kv}:null,retryLane:536870912,hydrationErrors:null},C=jS(c),C.return=p,p.child=C,ev=p,L_=null)):c=null,c===null)throw qv(p);return p.lanes=536870912,null}return lE(p,D)}var $=c.memoizedState;if($!==null){var tt=$.dehydrated;if(fM(p),G)if(p.flags&256)p.flags&=-257,p=PC(c,p,C);else if(p.memoizedState!==null)p.child=c.child,p.flags|=128,p=null;else throw Error(n(558));else if(q_||Yx(c,p,C,!1),G=(C&c.childLanes)!==0,q_||G){if(D=P_,D!==null&&(tt=r0(D,C),tt!==0&&tt!==$.retryLane))throw $.retryLane=tt,sx(c,tt),Pv(D,c,tt),IM;xE(),p=PC(c,p,C)}else c=$.treeContext,L_=jv(tt.nextSibling),ev=p,U1=!0,iv=null,Cv=!1,c!==null&&WA(p,c),p=lE(p,D),p.flags|=4096;return p}return c=Yv(c.child,{mode:D.mode,children:D.children}),c.ref=p.ref,p.child=c,c.return=p,c}function cE(c,p){var C=p.ref;if(C===null)c!==null&&c.ref!==null&&(p.flags|=4194816);else{if(typeof C!="function"&&typeof C!="object")throw Error(n(284));(c===null||c.ref!==C)&&(p.flags|=4194816)}}function BM(c,p,C,D,G){return Mx(p),C=mM(c,p,C,D,void 0,G),D=gM(),c!==null&&!q_?(_M(c,p,G),Lx(c,p,G)):(U1&&D&&XS(p),p.flags|=1,av(c,p,C,G),p.child)}function OC(c,p,C,D,G,$){return Mx(p),p.updateQueue=null,C=Nw(p,D,C,G),Bw(c),D=gM(),c!==null&&!q_?(_M(c,p,$),Lx(c,p,$)):(U1&&D&&XS(p),p.flags|=1,av(c,p,C,$),p.child)}function IC(c,p,C,D,G){if(Mx(p),p.stateNode===null){var $=$x,tt=C.contextType;typeof tt=="object"&&tt!==null&&($=tv(tt)),$=new C(D,$),p.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,$.updater=PM,p.stateNode=$,$._reactInternals=p,$=p.stateNode,$.props=D,$.state=p.memoizedState,$.refs={},k_(p),tt=C.contextType,$.context=typeof tt=="object"&&tt!==null?tv(tt):$x,$.state=p.memoizedState,tt=C.getDerivedStateFromProps,typeof tt=="function"&&(LM(p,C,tt,D),$.state=p.memoizedState),typeof C.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(tt=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),tt!==$.state&&PM.enqueueReplaceState($,$.state,null),ux(p,D,$,G),Zx(),$.state=p.memoizedState),typeof $.componentDidMount=="function"&&(p.flags|=4194308),D=!0}else if(c===null){$=p.stateNode;var i0=p.memoizedProps,D0=U2(C,i0);$.props=D0;var $0=$.context,J0=C.contextType;tt=$x,typeof J0=="object"&&J0!==null&&(tt=tv(J0));var n1=C.getDerivedStateFromProps;J0=typeof n1=="function"||typeof $.getSnapshotBeforeUpdate=="function",i0=p.pendingProps!==i0,J0||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(i0||$0!==tt)&&yC(p,$,D,tt),N1=!1;var K0=p.memoizedState;$.state=K0,ux(p,D,$,G),Zx(),$0=p.memoizedState,i0||K0!==$0||N1?(typeof n1=="function"&&(LM(p,C,n1,D),$0=p.memoizedState),(D0=N1||xC(p,C,D0,D,K0,$0,tt))?(J0||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount()),typeof $.componentDidMount=="function"&&(p.flags|=4194308)):(typeof $.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=D,p.memoizedState=$0),$.props=D,$.state=$0,$.context=tt,D=D0):(typeof $.componentDidMount=="function"&&(p.flags|=4194308),D=!1)}else{$=p.stateNode,M1(c,p),tt=p.memoizedProps,J0=U2(C,tt),$.props=J0,n1=p.pendingProps,K0=$.context,$0=C.contextType,D0=$x,typeof $0=="object"&&$0!==null&&(D0=tv($0)),i0=C.getDerivedStateFromProps,($0=typeof i0=="function"||typeof $.getSnapshotBeforeUpdate=="function")||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(tt!==n1||K0!==D0)&&yC(p,$,D,D0),N1=!1,K0=p.memoizedState,$.state=K0,ux(p,D,$,G),Zx();var Z0=p.memoizedState;tt!==n1||K0!==Z0||N1||c!==null&&c.dependencies!==null&&oS(c.dependencies)?(typeof i0=="function"&&(LM(p,C,i0,D),Z0=p.memoizedState),(J0=N1||xC(p,C,J0,D,K0,Z0,D0)||c!==null&&c.dependencies!==null&&oS(c.dependencies))?($0||typeof $.UNSAFE_componentWillUpdate!="function"&&typeof $.componentWillUpdate!="function"||(typeof $.componentWillUpdate=="function"&&$.componentWillUpdate(D,Z0,D0),typeof $.UNSAFE_componentWillUpdate=="function"&&$.UNSAFE_componentWillUpdate(D,Z0,D0)),typeof $.componentDidUpdate=="function"&&(p.flags|=4),typeof $.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof $.componentDidUpdate!="function"||tt===c.memoizedProps&&K0===c.memoizedState||(p.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||tt===c.memoizedProps&&K0===c.memoizedState||(p.flags|=1024),p.memoizedProps=D,p.memoizedState=Z0),$.props=D,$.state=Z0,$.context=D0,D=J0):(typeof $.componentDidUpdate!="function"||tt===c.memoizedProps&&K0===c.memoizedState||(p.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||tt===c.memoizedProps&&K0===c.memoizedState||(p.flags|=1024),D=!1)}return $=D,cE(c,p),D=(p.flags&128)!==0,$||D?($=p.stateNode,C=D&&typeof C.getDerivedStateFromError!="function"?null:$.render(),p.flags|=1,c!==null&&D?(p.child=L1(p,c.child,null,G),p.child=L1(p,null,C,G)):av(c,p,C,G),p.memoizedState=$.state,c=p.child):c=Lx(c,p,G),c}function BC(c,p,C,D){return Zv(),p.flags|=256,av(c,p,C,D),p.child}var NM={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zM(c){return{baseLanes:c,cachePool:Y()}}function FM(c,p,C){return c=c!==null?c.childLanes&~C:0,p&&(c|=Nv),c}function NC(c,p,C){var D=p.pendingProps,G=!1,$=(p.flags&128)!==0,tt;if((tt=$)||(tt=c!==null&&c.memoizedState===null?!1:(W_.current&2)!==0),tt&&(G=!0,p.flags&=-129),tt=(p.flags&32)!==0,p.flags&=-33,c===null){if(U1){if(G?Qx(p):Jx(),(c=L_)?(c=jT(c,Cv),c=c!==null&&c.data!=="&"?c:null,c!==null&&(p.memoizedState={dehydrated:c,treeContext:cx!==null?{id:Uv,overflow:kv}:null,retryLane:536870912,hydrationErrors:null},C=jS(c),C.return=p,p.child=C,ev=p,L_=null)):c=null,c===null)throw qv(p);return yw(c)?p.lanes=32:p.lanes=536870912,null}var i0=D.children;return D=D.fallback,G?(Jx(),G=p.mode,i0=uE({mode:"hidden",children:i0},G),D=ox(D,G,C,null),i0.return=p,D.return=p,i0.sibling=D,p.child=i0,D=p.child,D.memoizedState=zM(C),D.childLanes=FM(c,tt,C),p.memoizedState=NM,sA(null,D)):(Qx(p),UM(p,i0))}var D0=c.memoizedState;if(D0!==null&&(i0=D0.dehydrated,i0!==null)){if($)p.flags&256?(Qx(p),p.flags&=-257,p=kM(c,p,C)):p.memoizedState!==null?(Jx(),p.child=c.child,p.flags|=128,p=null):(Jx(),i0=D.fallback,G=p.mode,D=uE({mode:"visible",children:D.children},G),i0=ox(i0,G,C,null),i0.flags|=2,D.return=p,i0.return=p,D.sibling=i0,p.child=D,L1(p,c.child,null,C),D=p.child,D.memoizedState=zM(C),D.childLanes=FM(c,tt,C),p.memoizedState=NM,p=sA(null,D));else if(Qx(p),yw(i0)){if(tt=i0.nextSibling&&i0.nextSibling.dataset,tt)var $0=tt.dgst;tt=$0,D=Error(n(419)),D.stack="",D.digest=tt,N2({value:D,source:null,stack:null}),p=kM(c,p,C)}else if(q_||Yx(c,p,C,!1),tt=(C&c.childLanes)!==0,q_||tt){if(tt=P_,tt!==null&&(D=r0(tt,C),D!==0&&D!==D0.retryLane))throw D0.retryLane=D,sx(c,D),Pv(tt,c,D),IM;xw(i0)||xE(),p=kM(c,p,C)}else xw(i0)?(p.flags|=192,p.child=c.child,p=null):(c=D0.treeContext,L_=jv(i0.nextSibling),ev=p,U1=!0,iv=null,Cv=!1,c!==null&&WA(p,c),p=UM(p,D.children),p.flags|=4096);return p}return G?(Jx(),i0=D.fallback,G=p.mode,D0=c.child,$0=D0.sibling,D=Yv(D0,{mode:"hidden",children:D.children}),D.subtreeFlags=D0.subtreeFlags&65011712,$0!==null?i0=Yv($0,i0):(i0=ox(i0,G,C,null),i0.flags|=2),i0.return=p,D.return=p,D.sibling=i0,p.child=D,sA(null,D),D=p.child,i0=c.child.memoizedState,i0===null?i0=zM(C):(G=i0.cachePool,G!==null?(D0=U_._currentValue,G=G.parent!==D0?{parent:D0,pool:D0}:G):G=Y(),i0={baseLanes:i0.baseLanes|C,cachePool:G}),D.memoizedState=i0,D.childLanes=FM(c,tt,C),p.memoizedState=NM,sA(c.child,D)):(Qx(p),C=c.child,c=C.sibling,C=Yv(C,{mode:"visible",children:D.children}),C.return=p,C.sibling=null,c!==null&&(tt=p.deletions,tt===null?(p.deletions=[c],p.flags|=16):tt.push(c)),p.child=C,p.memoizedState=null,C)}function UM(c,p){return p=uE({mode:"visible",children:p},c.mode),p.return=c,c.child=p}function uE(c,p){return c=vv(22,c,null,p),c.lanes=0,c}function kM(c,p,C){return L1(p,c.child,null,C),c=UM(p,p.pendingProps.children),c.flags|=2,p.memoizedState=null,c}function zC(c,p,C){c.lanes|=p;var D=c.alternate;D!==null&&(D.lanes|=p),qS(c.return,p,C)}function GM(c,p,C,D,G,$){var tt=c.memoizedState;tt===null?c.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:D,tail:C,tailMode:G,treeForkCount:$}:(tt.isBackwards=p,tt.rendering=null,tt.renderingStartTime=0,tt.last=D,tt.tail=C,tt.tailMode=G,tt.treeForkCount=$)}function FC(c,p,C){var D=p.pendingProps,G=D.revealOrder,$=D.tail;D=D.children;var tt=W_.current,i0=(tt&2)!==0;if(i0?(tt=tt&1|2,p.flags|=128):tt&=1,K(W_,tt),av(c,p,D,C),D=U1?I2:0,!i0&&c!==null&&(c.flags&128)!==0)e:for(c=p.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&zC(c,C,p);else if(c.tag===19)zC(c,C,p);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===p)break e;for(;c.sibling===null;){if(c.return===null||c.return===p)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(G){case"forwards":for(C=p.child,G=null;C!==null;)c=C.alternate,c!==null&&QA(c)===null&&(G=C),C=C.sibling;C=G,C===null?(G=p.child,p.child=null):(G=C.sibling,C.sibling=null),GM(p,!1,G,C,$,D);break;case"backwards":case"unstable_legacy-backwards":for(C=null,G=p.child,p.child=null;G!==null;){if(c=G.alternate,c!==null&&QA(c)===null){p.child=G;break}c=G.sibling,G.sibling=C,C=G,G=c}GM(p,!0,C,null,$,D);break;case"together":GM(p,!1,null,null,void 0,D);break;default:p.memoizedState=null}return p.child}function Lx(c,p,C){if(c!==null&&(p.dependencies=c.dependencies),n2|=p.lanes,(C&p.childLanes)===0)if(c!==null){if(Yx(c,p,C,!1),(C&p.childLanes)===0)return null}else return null;if(c!==null&&p.child!==c.child)throw Error(n(153));if(p.child!==null){for(c=p.child,C=Yv(c,c.pendingProps),p.child=C,C.return=p;c.sibling!==null;)c=c.sibling,C=C.sibling=Yv(c,c.pendingProps),C.return=p;C.sibling=null}return p.child}function VM(c,p){return(c.lanes&p)!==0?!0:(c=c.dependencies,!!(c!==null&&oS(c)))}function M3(c,p,C){switch(p.tag){case 3:J(p,p.stateNode.containerInfo),Vv(p,U_,c.memoizedState.cache),Zv();break;case 27:case 5:ht(p);break;case 4:J(p,p.stateNode.containerInfo);break;case 10:Vv(p,p.type,p.memoizedProps.value);break;case 31:if(p.memoizedState!==null)return p.flags|=128,fM(p),null;break;case 13:var D=p.memoizedState;if(D!==null)return D.dehydrated!==null?(Qx(p),p.flags|=128,null):(C&p.child.childLanes)!==0?NC(c,p,C):(Qx(p),c=Lx(c,p,C),c!==null?c.sibling:null);Qx(p);break;case 19:var G=(c.flags&128)!==0;if(D=(C&p.childLanes)!==0,D||(Yx(c,p,C,!1),D=(C&p.childLanes)!==0),G){if(D)return FC(c,p,C);p.flags|=128}if(G=p.memoizedState,G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),K(W_,W_.current),D)break;return null;case 22:return p.lanes=0,DC(c,p,C,p.pendingProps);case 24:Vv(p,U_,c.memoizedState.cache)}return Lx(c,p,C)}function UC(c,p,C){if(c!==null)if(c.memoizedProps!==p.pendingProps)q_=!0;else{if(!VM(c,C)&&(p.flags&128)===0)return q_=!1,M3(c,p,C);q_=(c.flags&131072)!==0}else q_=!1,U1&&(p.flags&1048576)!==0&&jA(p,I2,p.index);switch(p.lanes=0,p.tag){case 16:e:{var D=p.pendingProps;if(c=B0(p.elementType),p.type=c,typeof c=="function")rS(c)?(D=U2(c,D),p.tag=1,p=IC(null,p,c,D,C)):(p.tag=0,p=BM(null,p,c,D,C));else{if(c!=null){var G=c.$$typeof;if(G===S){p.tag=11,p=CC(null,p,c,D,C);break e}else if(G===A){p.tag=14,p=TC(null,p,c,D,C);break e}}throw p=I(c)||c,Error(n(306,p,""))}}return p;case 0:return BM(c,p,p.type,p.pendingProps,C);case 1:return D=p.type,G=U2(D,p.pendingProps),IC(c,p,D,G,C);case 3:e:{if(J(p,p.stateNode.containerInfo),c===null)throw Error(n(387));D=p.pendingProps;var $=p.memoizedState;G=$.element,M1(c,p),ux(p,D,null,C);var tt=p.memoizedState;if(D=tt.cache,Vv(p,U_,D),D!==$.cache&&ZS(p,[U_],C,!0),Zx(),D=tt.element,$.isDehydrated)if($={element:D,isDehydrated:!1,cache:tt.cache},p.updateQueue.baseState=$,p.memoizedState=$,p.flags&256){p=BC(c,p,D,C);break e}else if(D!==G){G=fv(Error(n(424)),p),N2(G),p=BC(c,p,D,C);break e}else{switch(c=p.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(L_=jv(c.firstChild),ev=p,U1=!0,iv=null,Cv=!0,C=d1(p,null,D,C),p.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling}else{if(Zv(),D===G){p=Lx(c,p,C);break e}av(c,p,D,C)}p=p.child}return p;case 26:return cE(c,p),c===null?(C=qT(p.type,null,p.pendingProps,null))?p.memoizedState=C:U1||(C=p.type,c=p.pendingProps,D=wE(Fe.current).createElement(C),D[i1]=p,D[u1]=c,ov(D,C,c),G0(D),p.stateNode=D):p.memoizedState=qT(p.type,c.memoizedProps,p.pendingProps,c.memoizedState),null;case 27:return ht(p),c===null&&U1&&(D=p.stateNode=XT(p.type,p.pendingProps,Fe.current),ev=p,Cv=!0,G=L_,o2(p.type)?(bw=G,L_=jv(D.firstChild)):L_=G),av(c,p,p.pendingProps.children,C),cE(c,p),c===null&&(p.flags|=4194304),p.child;case 5:return c===null&&U1&&((G=D=L_)&&(D=tR(D,p.type,p.pendingProps,Cv),D!==null?(p.stateNode=D,ev=p,L_=jv(D.firstChild),Cv=!1,G=!0):G=!1),G||qv(p)),ht(p),G=p.type,$=p.pendingProps,tt=c!==null?c.memoizedProps:null,D=$.children,gw(G,$)?D=null:tt!==null&&gw(G,tt)&&(p.flags|=32),p.memoizedState!==null&&(G=mM(c,p,g3,null,null,C),yA._currentValue=G),cE(c,p),av(c,p,D,C),p.child;case 6:return c===null&&U1&&((c=C=L_)&&(C=nR(C,p.pendingProps,Cv),C!==null?(p.stateNode=C,ev=p,L_=null,c=!0):c=!1),c||qv(p)),null;case 13:return NC(c,p,C);case 4:return J(p,p.stateNode.containerInfo),D=p.pendingProps,c===null?p.child=L1(p,null,D,C):av(c,p,D,C),p.child;case 11:return CC(c,p,p.type,p.pendingProps,C);case 7:return av(c,p,p.pendingProps,C),p.child;case 8:return av(c,p,p.pendingProps.children,C),p.child;case 12:return av(c,p,p.pendingProps.children,C),p.child;case 10:return D=p.pendingProps,Vv(p,p.type,D.value),av(c,p,D.children,C),p.child;case 9:return G=p.type._context,D=p.pendingProps.children,Mx(p),G=tv(G),D=D(G),p.flags|=1,av(c,p,D,C),p.child;case 14:return TC(c,p,p.type,p.pendingProps,C);case 15:return RC(c,p,p.type,p.pendingProps,C);case 19:return FC(c,p,C);case 31:return E3(c,p,C);case 22:return DC(c,p,C,p.pendingProps);case 24:return Mx(p),D=tv(U_),c===null?(G=z(),G===null&&(G=P_,$=QS(),G.pooledCache=$,$.refCount++,$!==null&&(G.pooledCacheLanes|=C),G=$),p.memoizedState={parent:D,cache:G},k_(p),Vv(p,U_,G)):((c.lanes&C)!==0&&(M1(c,p),ux(p,null,null,C),Zx()),G=c.memoizedState,$=p.memoizedState,G.parent!==D?(G={parent:D,cache:D},p.memoizedState=G,p.lanes===0&&(p.memoizedState=p.updateQueue.baseState=G),Vv(p,U_,D)):(D=$.cache,Vv(p,U_,D),D!==G.cache&&ZS(p,[U_],C,!0))),av(c,p,p.pendingProps.children,C),p.child;case 29:throw p.pendingProps}throw Error(n(156,p.tag))}function Px(c){c.flags|=4}function HM(c,p,C,D,G){if((p=(c.mode&32)!==0)&&(p=!1),p){if(c.flags|=16777216,(G&335544128)===G)if(c.stateNode.complete)c.flags|=8192;else if(dT())c.flags|=8192;else throw W0=Y0,y0}else c.flags&=-16777217}function kC(c,p){if(p.type!=="stylesheet"||(p.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!t3(p))if(dT())c.flags|=8192;else throw W0=Y0,y0}function hE(c,p){p!==null&&(c.flags|=4),c.flags&16384&&(p=c.tag!==22?m0():536870912,c.lanes|=p,_S|=p)}function aA(c,p){if(!U1)switch(c.tailMode){case"hidden":p=c.tail;for(var C=null;p!==null;)p.alternate!==null&&(C=p),p=p.sibling;C===null?c.tail=null:C.sibling=null;break;case"collapsed":C=c.tail;for(var D=null;C!==null;)C.alternate!==null&&(D=C),C=C.sibling;D===null?p||c.tail===null?c.tail=null:c.tail.sibling=null:D.sibling=null}}function N_(c){var p=c.alternate!==null&&c.alternate.child===c.child,C=0,D=0;if(p)for(var G=c.child;G!==null;)C|=G.lanes|G.childLanes,D|=G.subtreeFlags&65011712,D|=G.flags&65011712,G.return=c,G=G.sibling;else for(G=c.child;G!==null;)C|=G.lanes|G.childLanes,D|=G.subtreeFlags,D|=G.flags,G.return=c,G=G.sibling;return c.subtreeFlags|=D,c.childLanes=C,p}function w3(c,p,C){var D=p.pendingProps;switch(YS(p),p.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return N_(p),null;case 1:return N_(p),null;case 3:return C=p.stateNode,D=null,c!==null&&(D=c.memoizedState.cache),p.memoizedState.cache!==D&&(p.flags|=2048),Qv(U_),et(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(c===null||c.child===null)&&(Gv(p)?Px(p):c===null||c.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,B2())),N_(p),null;case 26:var G=p.type,$=p.memoizedState;return c===null?(Px(p),$!==null?(N_(p),kC(p,$)):(N_(p),HM(p,G,null,D,C))):$?$!==c.memoizedState?(Px(p),N_(p),kC(p,$)):(N_(p),p.flags&=-16777217):(c=c.memoizedProps,c!==D&&Px(p),N_(p),HM(p,G,c,D,C)),null;case 27:if(er(p),C=Fe.current,G=p.type,c!==null&&p.stateNode!=null)c.memoizedProps!==D&&Px(p);else{if(!D){if(p.stateNode===null)throw Error(n(166));return N_(p),null}c=q.current,Gv(p)?$A(p):(c=XT(G,D,C),p.stateNode=c,Px(p))}return N_(p),null;case 5:if(er(p),G=p.type,c!==null&&p.stateNode!=null)c.memoizedProps!==D&&Px(p);else{if(!D){if(p.stateNode===null)throw Error(n(166));return N_(p),null}if($=q.current,Gv(p))$A(p);else{var tt=wE(Fe.current);switch($){case 1:$=tt.createElementNS("http://www.w3.org/2000/svg",G);break;case 2:$=tt.createElementNS("http://www.w3.org/1998/Math/MathML",G);break;default:switch(G){case"svg":$=tt.createElementNS("http://www.w3.org/2000/svg",G);break;case"math":$=tt.createElementNS("http://www.w3.org/1998/Math/MathML",G);break;case"script":$=tt.createElement("div"),$.innerHTML="<script><\/script>",$=$.removeChild($.firstChild);break;case"select":$=typeof D.is=="string"?tt.createElement("select",{is:D.is}):tt.createElement("select"),D.multiple?$.multiple=!0:D.size&&($.size=D.size);break;default:$=typeof D.is=="string"?tt.createElement(G,{is:D.is}):tt.createElement(G)}}$[i1]=p,$[u1]=D;e:for(tt=p.child;tt!==null;){if(tt.tag===5||tt.tag===6)$.appendChild(tt.stateNode);else if(tt.tag!==4&&tt.tag!==27&&tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===p)break e;for(;tt.sibling===null;){if(tt.return===null||tt.return===p)break e;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}p.stateNode=$;e:switch(ov($,G,D),G){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}D&&Px(p)}}return N_(p),HM(p,p.type,c===null?null:c.memoizedProps,p.pendingProps,C),null;case 6:if(c&&p.stateNode!=null)c.memoizedProps!==D&&Px(p);else{if(typeof D!="string"&&p.stateNode===null)throw Error(n(166));if(c=Fe.current,Gv(p)){if(c=p.stateNode,C=p.memoizedProps,D=null,G=ev,G!==null)switch(G.tag){case 27:case 5:D=G.memoizedProps}c[i1]=p,c=!!(c.nodeValue===C||D!==null&&D.suppressHydrationWarning===!0||NT(c.nodeValue,C)),c||qv(p,!0)}else c=wE(c).createTextNode(D),c[i1]=p,p.stateNode=c}return N_(p),null;case 31:if(C=p.memoizedState,c===null||c.memoizedState!==null){if(D=Gv(p),C!==null){if(c===null){if(!D)throw Error(n(318));if(c=p.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(n(557));c[i1]=p}else Zv(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;N_(p),c=!1}else C=B2(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=C),c=!0;if(!c)return p.flags&256?(Iv(p),p):(Iv(p),null);if((p.flags&128)!==0)throw Error(n(558))}return N_(p),null;case 13:if(D=p.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(G=Gv(p),D!==null&&D.dehydrated!==null){if(c===null){if(!G)throw Error(n(318));if(G=p.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(n(317));G[i1]=p}else Zv(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;N_(p),G=!1}else G=B2(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=G),G=!0;if(!G)return p.flags&256?(Iv(p),p):(Iv(p),null)}return Iv(p),(p.flags&128)!==0?(p.lanes=C,p):(C=D!==null,c=c!==null&&c.memoizedState!==null,C&&(D=p.child,G=null,D.alternate!==null&&D.alternate.memoizedState!==null&&D.alternate.memoizedState.cachePool!==null&&(G=D.alternate.memoizedState.cachePool.pool),$=null,D.memoizedState!==null&&D.memoizedState.cachePool!==null&&($=D.memoizedState.cachePool.pool),$!==G&&(D.flags|=2048)),C!==c&&C&&(p.child.flags|=8192),hE(p,p.updateQueue),N_(p),null);case 4:return et(),c===null&&hw(p.stateNode.containerInfo),N_(p),null;case 10:return Qv(p.type),N_(p),null;case 19:if(V(W_),D=p.memoizedState,D===null)return N_(p),null;if(G=(p.flags&128)!==0,$=D.rendering,$===null)if(G)aA(D,!1);else{if(V_!==0||c!==null&&(c.flags&128)!==0)for(c=p.child;c!==null;){if($=QA(c),$!==null){for(p.flags|=128,aA(D,!1),c=$.updateQueue,p.updateQueue=c,hE(p,c),p.subtreeFlags=0,c=C,C=p.child;C!==null;)ax(C,c),C=C.sibling;return K(W_,W_.current&1|2),U1&&Kv(p,D.treeForkCount),p.child}c=c.sibling}D.tail!==null&&Xe()>gE&&(p.flags|=128,G=!0,aA(D,!1),p.lanes=4194304)}else{if(!G)if(c=QA($),c!==null){if(p.flags|=128,G=!0,c=c.updateQueue,p.updateQueue=c,hE(p,c),aA(D,!0),D.tail===null&&D.tailMode==="hidden"&&!$.alternate&&!U1)return N_(p),null}else 2*Xe()-D.renderingStartTime>gE&&C!==536870912&&(p.flags|=128,G=!0,aA(D,!1),p.lanes=4194304);D.isBackwards?($.sibling=p.child,p.child=$):(c=D.last,c!==null?c.sibling=$:p.child=$,D.last=$)}return D.tail!==null?(c=D.tail,D.rendering=c,D.tail=c.sibling,D.renderingStartTime=Xe(),c.sibling=null,C=W_.current,K(W_,G?C&1|2:C&1),U1&&Kv(p,D.treeForkCount),c):(N_(p),null);case 22:case 23:return Iv(p),dM(),D=p.memoizedState!==null,c!==null?c.memoizedState!==null!==D&&(p.flags|=8192):D&&(p.flags|=8192),D?(C&536870912)!==0&&(p.flags&128)===0&&(N_(p),p.subtreeFlags&6&&(p.flags|=8192)):N_(p),C=p.updateQueue,C!==null&&hE(p,C.retryQueue),C=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(C=c.memoizedState.cachePool.pool),D=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(D=p.memoizedState.cachePool.pool),D!==C&&(p.flags|=2048),c!==null&&V(Tx),null;case 24:return C=null,c!==null&&(C=c.memoizedState.cache),p.memoizedState.cache!==C&&(p.flags|=2048),Qv(U_),N_(p),null;case 25:return null;case 30:return null}throw Error(n(156,p.tag))}function C3(c,p){switch(YS(p),p.tag){case 1:return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 3:return Qv(U_),et(),c=p.flags,(c&65536)!==0&&(c&128)===0?(p.flags=c&-65537|128,p):null;case 26:case 27:case 5:return er(p),null;case 31:if(p.memoizedState!==null){if(Iv(p),p.alternate===null)throw Error(n(340));Zv()}return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 13:if(Iv(p),c=p.memoizedState,c!==null&&c.dehydrated!==null){if(p.alternate===null)throw Error(n(340));Zv()}return c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 19:return V(W_),null;case 4:return et(),null;case 10:return Qv(p.type),null;case 22:case 23:return Iv(p),dM(),c!==null&&V(Tx),c=p.flags,c&65536?(p.flags=c&-65537|128,p):null;case 24:return Qv(U_),null;case 25:return null;default:return null}}function GC(c,p){switch(YS(p),p.tag){case 3:Qv(U_),et();break;case 26:case 27:case 5:er(p);break;case 4:et();break;case 31:p.memoizedState!==null&&Iv(p);break;case 13:Iv(p);break;case 19:V(W_);break;case 10:Qv(p.type);break;case 22:case 23:Iv(p),dM(),c!==null&&V(Tx);break;case 24:Qv(U_)}}function oA(c,p){try{var C=p.updateQueue,D=C!==null?C.lastEffect:null;if(D!==null){var G=D.next;C=G;do{if((C.tag&c)===c){D=void 0;var $=C.create,tt=C.inst;D=$(),tt.destroy=D}C=C.next}while(C!==G)}}catch(i0){S_(p,p.return,i0)}}function e2(c,p,C){try{var D=p.updateQueue,G=D!==null?D.lastEffect:null;if(G!==null){var $=G.next;D=$;do{if((D.tag&c)===c){var tt=D.inst,i0=tt.destroy;if(i0!==void 0){tt.destroy=void 0,G=p;var D0=C,$0=i0;try{$0()}catch(J0){S_(G,D0,J0)}}}D=D.next}while(D!==$)}}catch(J0){S_(p,p.return,J0)}}function VC(c){var p=c.updateQueue;if(p!==null){var C=c.stateNode;try{Pw(p,C)}catch(D){S_(c,c.return,D)}}}function HC(c,p,C){C.props=U2(c.type,c.memoizedProps),C.state=c.memoizedState;try{C.componentWillUnmount()}catch(D){S_(c,p,D)}}function lA(c,p){try{var C=c.ref;if(C!==null){switch(c.tag){case 26:case 27:case 5:var D=c.stateNode;break;case 30:D=c.stateNode;break;default:D=c.stateNode}typeof C=="function"?c.refCleanup=C(D):C.current=D}}catch(G){S_(c,p,G)}}function hx(c,p){var C=c.ref,D=c.refCleanup;if(C!==null)if(typeof D=="function")try{D()}catch(G){S_(c,p,G)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof C=="function")try{C(null)}catch(G){S_(c,p,G)}else C.current=null}function jC(c){var p=c.type,C=c.memoizedProps,D=c.stateNode;try{e:switch(p){case"button":case"input":case"select":case"textarea":C.autoFocus&&D.focus();break e;case"img":C.src?D.src=C.src:C.srcSet&&(D.srcset=C.srcSet)}}catch(G){S_(c,c.return,G)}}function jM(c,p,C){try{var D=c.stateNode;K3(D,c.type,C,p),D[u1]=p}catch(G){S_(c,c.return,G)}}function WC(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&o2(c.type)||c.tag===4}function WM(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||WC(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&o2(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function $M(c,p,C){var D=c.tag;if(D===5||D===6)c=c.stateNode,p?(C.nodeType===9?C.body:C.nodeName==="HTML"?C.ownerDocument.body:C).insertBefore(c,p):(p=C.nodeType===9?C.body:C.nodeName==="HTML"?C.ownerDocument.body:C,p.appendChild(c),C=C._reactRootContainer,C!=null||p.onclick!==null||(p.onclick=J_));else if(D!==4&&(D===27&&o2(c.type)&&(C=c.stateNode,p=null),c=c.child,c!==null))for($M(c,p,C),c=c.sibling;c!==null;)$M(c,p,C),c=c.sibling}function dE(c,p,C){var D=c.tag;if(D===5||D===6)c=c.stateNode,p?C.insertBefore(c,p):C.appendChild(c);else if(D!==4&&(D===27&&o2(c.type)&&(C=c.stateNode),c=c.child,c!==null))for(dE(c,p,C),c=c.sibling;c!==null;)dE(c,p,C),c=c.sibling}function $C(c){var p=c.stateNode,C=c.memoizedProps;try{for(var D=c.type,G=p.attributes;G.length;)p.removeAttributeNode(G[0]);ov(p,D,C),p[i1]=c,p[u1]=C}catch($){S_(c,c.return,$)}}var Ox=!1,Z_=!1,XM=!1,XC=typeof WeakSet=="function"?WeakSet:Set,rv=null;function T3(c,p){if(c=c.containerInfo,pw=OE,c=M2(c),Q2(c)){if("selectionStart"in c)var C={start:c.selectionStart,end:c.selectionEnd};else e:{C=(C=c.ownerDocument)&&C.defaultView||window;var D=C.getSelection&&C.getSelection();if(D&&D.rangeCount!==0){C=D.anchorNode;var G=D.anchorOffset,$=D.focusNode;D=D.focusOffset;try{C.nodeType,$.nodeType}catch{C=null;break e}var tt=0,i0=-1,D0=-1,$0=0,J0=0,n1=c,K0=null;t:for(;;){for(var Z0;n1!==C||G!==0&&n1.nodeType!==3||(i0=tt+G),n1!==$||D!==0&&n1.nodeType!==3||(D0=tt+D),n1.nodeType===3&&(tt+=n1.nodeValue.length),(Z0=n1.firstChild)!==null;)K0=n1,n1=Z0;for(;;){if(n1===c)break t;if(K0===C&&++$0===G&&(i0=tt),K0===$&&++J0===D&&(D0=tt),(Z0=n1.nextSibling)!==null)break;n1=K0,K0=n1.parentNode}n1=Z0}C=i0===-1||D0===-1?null:{start:i0,end:D0}}else C=null}C=C||{start:0,end:0}}else C=null;for(mw={focusedElem:c,selectionRange:C},OE=!1,rv=p;rv!==null;)if(p=rv,c=p.child,(p.subtreeFlags&1028)!==0&&c!==null)c.return=p,rv=c;else for(;rv!==null;){switch(p=rv,$=p.alternate,c=p.flags,p.tag){case 0:if((c&4)!==0&&(c=p.updateQueue,c=c!==null?c.events:null,c!==null))for(C=0;C<c.length;C++)G=c[C],G.ref.impl=G.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&$!==null){c=void 0,C=p,G=$.memoizedProps,$=$.memoizedState,D=C.stateNode;try{var v1=U2(C.type,G);c=D.getSnapshotBeforeUpdate(v1,$),D.__reactInternalSnapshotBeforeUpdate=c}catch(C1){S_(C,C.return,C1)}}break;case 3:if((c&1024)!==0){if(c=p.stateNode.containerInfo,C=c.nodeType,C===9)vw(c);else if(C===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":vw(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(n(163))}if(c=p.sibling,c!==null){c.return=p.return,rv=c;break}rv=p.return}}function YC(c,p,C){var D=C.flags;switch(C.tag){case 0:case 11:case 15:Bx(c,C),D&4&&oA(5,C);break;case 1:if(Bx(c,C),D&4)if(c=C.stateNode,p===null)try{c.componentDidMount()}catch(tt){S_(C,C.return,tt)}else{var G=U2(C.type,p.memoizedProps);p=p.memoizedState;try{c.componentDidUpdate(G,p,c.__reactInternalSnapshotBeforeUpdate)}catch(tt){S_(C,C.return,tt)}}D&64&&VC(C),D&512&&lA(C,C.return);break;case 3:if(Bx(c,C),D&64&&(c=C.updateQueue,c!==null)){if(p=null,C.child!==null)switch(C.child.tag){case 27:case 5:p=C.child.stateNode;break;case 1:p=C.child.stateNode}try{Pw(c,p)}catch(tt){S_(C,C.return,tt)}}break;case 27:p===null&&D&4&&$C(C);case 26:case 5:Bx(c,C),p===null&&D&4&&jC(C),D&512&&lA(C,C.return);break;case 12:Bx(c,C);break;case 31:Bx(c,C),D&4&&ZC(c,C);break;case 13:Bx(c,C),D&4&&QC(c,C),D&64&&(c=C.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(C=z3.bind(null,C),iR(c,C))));break;case 22:if(D=C.memoizedState!==null||Ox,!D){p=p!==null&&p.memoizedState!==null||Z_,G=Ox;var $=Z_;Ox=D,(Z_=p)&&!$?Nx(c,C,(C.subtreeFlags&8772)!==0):Bx(c,C),Ox=G,Z_=$}break;case 30:break;default:Bx(c,C)}}function KC(c){var p=c.alternate;p!==null&&(c.alternate=null,KC(p)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(p=c.stateNode,p!==null&&H0(p)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var z_=null,Tv=!1;function Ix(c,p,C){for(C=C.child;C!==null;)qC(c,p,C),C=C.sibling}function qC(c,p,C){if(He&&typeof He.onCommitFiberUnmount=="function")try{He.onCommitFiberUnmount(O0,C)}catch{}switch(C.tag){case 26:Z_||hx(C,p),Ix(c,p,C),C.memoizedState?C.memoizedState.count--:C.stateNode&&(C=C.stateNode,C.parentNode.removeChild(C));break;case 27:Z_||hx(C,p);var D=z_,G=Tv;o2(C.type)&&(z_=C.stateNode,Tv=!1),Ix(c,p,C),_A(C.stateNode),z_=D,Tv=G;break;case 5:Z_||hx(C,p);case 6:if(D=z_,G=Tv,z_=null,Ix(c,p,C),z_=D,Tv=G,z_!==null)if(Tv)try{(z_.nodeType===9?z_.body:z_.nodeName==="HTML"?z_.ownerDocument.body:z_).removeChild(C.stateNode)}catch($){S_(C,p,$)}else try{z_.removeChild(C.stateNode)}catch($){S_(C,p,$)}break;case 18:z_!==null&&(Tv?(c=z_,VT(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,C.stateNode),MS(c)):VT(z_,C.stateNode));break;case 4:D=z_,G=Tv,z_=C.stateNode.containerInfo,Tv=!0,Ix(c,p,C),z_=D,Tv=G;break;case 0:case 11:case 14:case 15:e2(2,C,p),Z_||e2(4,C,p),Ix(c,p,C);break;case 1:Z_||(hx(C,p),D=C.stateNode,typeof D.componentWillUnmount=="function"&&HC(C,p,D)),Ix(c,p,C);break;case 21:Ix(c,p,C);break;case 22:Z_=(D=Z_)||C.memoizedState!==null,Ix(c,p,C),Z_=D;break;default:Ix(c,p,C)}}function ZC(c,p){if(p.memoizedState===null&&(c=p.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{MS(c)}catch(C){S_(p,p.return,C)}}}function QC(c,p){if(p.memoizedState===null&&(c=p.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{MS(c)}catch(C){S_(p,p.return,C)}}function R3(c){switch(c.tag){case 31:case 13:case 19:var p=c.stateNode;return p===null&&(p=c.stateNode=new XC),p;case 22:return c=c.stateNode,p=c._retryCache,p===null&&(p=c._retryCache=new XC),p;default:throw Error(n(435,c.tag))}}function fE(c,p){var C=R3(c);p.forEach(function(D){if(!C.has(D)){C.add(D);var G=F3.bind(null,c,D);D.then(G,G)}})}function Rv(c,p){var C=p.deletions;if(C!==null)for(var D=0;D<C.length;D++){var G=C[D],$=c,tt=p,i0=tt;e:for(;i0!==null;){switch(i0.tag){case 27:if(o2(i0.type)){z_=i0.stateNode,Tv=!1;break e}break;case 5:z_=i0.stateNode,Tv=!1;break e;case 3:case 4:z_=i0.stateNode.containerInfo,Tv=!0;break e}i0=i0.return}if(z_===null)throw Error(n(160));qC($,tt,G),z_=null,Tv=!1,$=G.alternate,$!==null&&($.return=null),G.return=null}if(p.subtreeFlags&13886)for(p=p.child;p!==null;)JC(p,c),p=p.sibling}var ex=null;function JC(c,p){var C=c.alternate,D=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:Rv(p,c),Dv(c),D&4&&(e2(3,c,c.return),oA(3,c),e2(5,c,c.return));break;case 1:Rv(p,c),Dv(c),D&512&&(Z_||C===null||hx(C,C.return)),D&64&&Ox&&(c=c.updateQueue,c!==null&&(D=c.callbacks,D!==null&&(C=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=C===null?D:C.concat(D))));break;case 26:var G=ex;if(Rv(p,c),Dv(c),D&512&&(Z_||C===null||hx(C,C.return)),D&4){var $=C!==null?C.memoizedState:null;if(D=c.memoizedState,C===null)if(D===null)if(c.stateNode===null){e:{D=c.type,C=c.memoizedProps,G=G.ownerDocument||G;t:switch(D){case"title":$=G.getElementsByTagName("title")[0],(!$||$[N0]||$[i1]||$.namespaceURI==="http://www.w3.org/2000/svg"||$.hasAttribute("itemprop"))&&($=G.createElement(D),G.head.insertBefore($,G.querySelector("head > title"))),ov($,D,C),$[i1]=c,G0($),D=$;break e;case"link":var tt=JT("link","href",G).get(D+(C.href||""));if(tt){for(var i0=0;i0<tt.length;i0++)if($=tt[i0],$.getAttribute("href")===(C.href==null||C.href===""?null:C.href)&&$.getAttribute("rel")===(C.rel==null?null:C.rel)&&$.getAttribute("title")===(C.title==null?null:C.title)&&$.getAttribute("crossorigin")===(C.crossOrigin==null?null:C.crossOrigin)){tt.splice(i0,1);break t}}$=G.createElement(D),ov($,D,C),G.head.appendChild($);break;case"meta":if(tt=JT("meta","content",G).get(D+(C.content||""))){for(i0=0;i0<tt.length;i0++)if($=tt[i0],$.getAttribute("content")===(C.content==null?null:""+C.content)&&$.getAttribute("name")===(C.name==null?null:C.name)&&$.getAttribute("property")===(C.property==null?null:C.property)&&$.getAttribute("http-equiv")===(C.httpEquiv==null?null:C.httpEquiv)&&$.getAttribute("charset")===(C.charSet==null?null:C.charSet)){tt.splice(i0,1);break t}}$=G.createElement(D),ov($,D,C),G.head.appendChild($);break;default:throw Error(n(468,D))}$[i1]=c,G0($),D=$}c.stateNode=D}else e3(G,c.type,c.stateNode);else c.stateNode=QT(G,D,c.memoizedProps);else $!==D?($===null?C.stateNode!==null&&(C=C.stateNode,C.parentNode.removeChild(C)):$.count--,D===null?e3(G,c.type,c.stateNode):QT(G,D,c.memoizedProps)):D===null&&c.stateNode!==null&&jM(c,c.memoizedProps,C.memoizedProps)}break;case 27:Rv(p,c),Dv(c),D&512&&(Z_||C===null||hx(C,C.return)),C!==null&&D&4&&jM(c,c.memoizedProps,C.memoizedProps);break;case 5:if(Rv(p,c),Dv(c),D&512&&(Z_||C===null||hx(C,C.return)),c.flags&32){G=c.stateNode;try{H_(G,"")}catch(v1){S_(c,c.return,v1)}}D&4&&c.stateNode!=null&&(G=c.memoizedProps,jM(c,G,C!==null?C.memoizedProps:G)),D&1024&&(XM=!0);break;case 6:if(Rv(p,c),Dv(c),D&4){if(c.stateNode===null)throw Error(n(162));D=c.memoizedProps,C=c.stateNode;try{C.nodeValue=D}catch(v1){S_(c,c.return,v1)}}break;case 3:if(RE=null,G=ex,ex=CE(p.containerInfo),Rv(p,c),ex=G,Dv(c),D&4&&C!==null&&C.memoizedState.isDehydrated)try{MS(p.containerInfo)}catch(v1){S_(c,c.return,v1)}XM&&(XM=!1,eT(c));break;case 4:D=ex,ex=CE(c.stateNode.containerInfo),Rv(p,c),Dv(c),ex=D;break;case 12:Rv(p,c),Dv(c);break;case 31:Rv(p,c),Dv(c),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,fE(c,D)));break;case 13:Rv(p,c),Dv(c),c.child.flags&8192&&c.memoizedState!==null!=(C!==null&&C.memoizedState!==null)&&(mE=Xe()),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,fE(c,D)));break;case 22:G=c.memoizedState!==null;var D0=C!==null&&C.memoizedState!==null,$0=Ox,J0=Z_;if(Ox=$0||G,Z_=J0||D0,Rv(p,c),Z_=J0,Ox=$0,Dv(c),D&8192)e:for(p=c.stateNode,p._visibility=G?p._visibility&-2:p._visibility|1,G&&(C===null||D0||Ox||Z_||k2(c)),C=null,p=c;;){if(p.tag===5||p.tag===26){if(C===null){D0=C=p;try{if($=D0.stateNode,G)tt=$.style,typeof tt.setProperty=="function"?tt.setProperty("display","none","important"):tt.display="none";else{i0=D0.stateNode;var n1=D0.memoizedProps.style,K0=n1!=null&&n1.hasOwnProperty("display")?n1.display:null;i0.style.display=K0==null||typeof K0=="boolean"?"":(""+K0).trim()}}catch(v1){S_(D0,D0.return,v1)}}}else if(p.tag===6){if(C===null){D0=p;try{D0.stateNode.nodeValue=G?"":D0.memoizedProps}catch(v1){S_(D0,D0.return,v1)}}}else if(p.tag===18){if(C===null){D0=p;try{var Z0=D0.stateNode;G?HT(Z0,!0):HT(D0.stateNode,!1)}catch(v1){S_(D0,D0.return,v1)}}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===c)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===c)break e;for(;p.sibling===null;){if(p.return===null||p.return===c)break e;C===p&&(C=null),p=p.return}C===p&&(C=null),p.sibling.return=p.return,p=p.sibling}D&4&&(D=c.updateQueue,D!==null&&(C=D.retryQueue,C!==null&&(D.retryQueue=null,fE(c,C))));break;case 19:Rv(p,c),Dv(c),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,fE(c,D)));break;case 30:break;case 21:break;default:Rv(p,c),Dv(c)}}function Dv(c){var p=c.flags;if(p&2){try{for(var C,D=c.return;D!==null;){if(WC(D)){C=D;break}D=D.return}if(C==null)throw Error(n(160));switch(C.tag){case 27:var G=C.stateNode,$=WM(c);dE(c,$,G);break;case 5:var tt=C.stateNode;C.flags&32&&(H_(tt,""),C.flags&=-33);var i0=WM(c);dE(c,i0,tt);break;case 3:case 4:var D0=C.stateNode.containerInfo,$0=WM(c);$M(c,$0,D0);break;default:throw Error(n(161))}}catch(J0){S_(c,c.return,J0)}c.flags&=-3}p&4096&&(c.flags&=-4097)}function eT(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var p=c;eT(p),p.tag===5&&p.flags&1024&&p.stateNode.reset(),c=c.sibling}}function Bx(c,p){if(p.subtreeFlags&8772)for(p=p.child;p!==null;)YC(c,p.alternate,p),p=p.sibling}function k2(c){for(c=c.child;c!==null;){var p=c;switch(p.tag){case 0:case 11:case 14:case 15:e2(4,p,p.return),k2(p);break;case 1:hx(p,p.return);var C=p.stateNode;typeof C.componentWillUnmount=="function"&&HC(p,p.return,C),k2(p);break;case 27:_A(p.stateNode);case 26:case 5:hx(p,p.return),k2(p);break;case 22:p.memoizedState===null&&k2(p);break;case 30:k2(p);break;default:k2(p)}c=c.sibling}}function Nx(c,p,C){for(C=C&&(p.subtreeFlags&8772)!==0,p=p.child;p!==null;){var D=p.alternate,G=c,$=p,tt=$.flags;switch($.tag){case 0:case 11:case 15:Nx(G,$,C),oA(4,$);break;case 1:if(Nx(G,$,C),D=$,G=D.stateNode,typeof G.componentDidMount=="function")try{G.componentDidMount()}catch($0){S_(D,D.return,$0)}if(D=$,G=D.updateQueue,G!==null){var i0=D.stateNode;try{var D0=G.shared.hiddenCallbacks;if(D0!==null)for(G.shared.hiddenCallbacks=null,G=0;G<D0.length;G++)z2(D0[G],i0)}catch($0){S_(D,D.return,$0)}}C&&tt&64&&VC($),lA($,$.return);break;case 27:$C($);case 26:case 5:Nx(G,$,C),C&&D===null&&tt&4&&jC($),lA($,$.return);break;case 12:Nx(G,$,C);break;case 31:Nx(G,$,C),C&&tt&4&&ZC(G,$);break;case 13:Nx(G,$,C),C&&tt&4&&QC(G,$);break;case 22:$.memoizedState===null&&Nx(G,$,C),lA($,$.return);break;case 30:break;default:Nx(G,$,C)}p=p.sibling}}function YM(c,p){var C=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(C=c.memoizedState.cachePool.pool),c=null,p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(c=p.memoizedState.cachePool.pool),c!==C&&(c!=null&&c.refCount++,C!=null&&Kx(C))}function KM(c,p){c=null,p.alternate!==null&&(c=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==c&&(p.refCount++,c!=null&&Kx(c))}function tx(c,p,C,D){if(p.subtreeFlags&10256)for(p=p.child;p!==null;)tT(c,p,C,D),p=p.sibling}function tT(c,p,C,D){var G=p.flags;switch(p.tag){case 0:case 11:case 15:tx(c,p,C,D),G&2048&&oA(9,p);break;case 1:tx(c,p,C,D);break;case 3:tx(c,p,C,D),G&2048&&(c=null,p.alternate!==null&&(c=p.alternate.memoizedState.cache),p=p.memoizedState.cache,p!==c&&(p.refCount++,c!=null&&Kx(c)));break;case 12:if(G&2048){tx(c,p,C,D),c=p.stateNode;try{var $=p.memoizedProps,tt=$.id,i0=$.onPostCommit;typeof i0=="function"&&i0(tt,p.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(D0){S_(p,p.return,D0)}}else tx(c,p,C,D);break;case 31:tx(c,p,C,D);break;case 13:tx(c,p,C,D);break;case 23:break;case 22:$=p.stateNode,tt=p.alternate,p.memoizedState!==null?$._visibility&2?tx(c,p,C,D):cA(c,p):$._visibility&2?tx(c,p,C,D):($._visibility|=2,pS(c,p,C,D,(p.subtreeFlags&10256)!==0||!1)),G&2048&&YM(tt,p);break;case 24:tx(c,p,C,D),G&2048&&KM(p.alternate,p);break;default:tx(c,p,C,D)}}function pS(c,p,C,D,G){for(G=G&&((p.subtreeFlags&10256)!==0||!1),p=p.child;p!==null;){var $=c,tt=p,i0=C,D0=D,$0=tt.flags;switch(tt.tag){case 0:case 11:case 15:pS($,tt,i0,D0,G),oA(8,tt);break;case 23:break;case 22:var J0=tt.stateNode;tt.memoizedState!==null?J0._visibility&2?pS($,tt,i0,D0,G):cA($,tt):(J0._visibility|=2,pS($,tt,i0,D0,G)),G&&$0&2048&&YM(tt.alternate,tt);break;case 24:pS($,tt,i0,D0,G),G&&$0&2048&&KM(tt.alternate,tt);break;default:pS($,tt,i0,D0,G)}p=p.sibling}}function cA(c,p){if(p.subtreeFlags&10256)for(p=p.child;p!==null;){var C=c,D=p,G=D.flags;switch(D.tag){case 22:cA(C,D),G&2048&&YM(D.alternate,D);break;case 24:cA(C,D),G&2048&&KM(D.alternate,D);break;default:cA(C,D)}p=p.sibling}}var uA=8192;function mS(c,p,C){if(c.subtreeFlags&uA)for(c=c.child;c!==null;)nT(c,p,C),c=c.sibling}function nT(c,p,C){switch(c.tag){case 26:mS(c,p,C),c.flags&uA&&c.memoizedState!==null&&mR(C,ex,c.memoizedState,c.memoizedProps);break;case 5:mS(c,p,C);break;case 3:case 4:var D=ex;ex=CE(c.stateNode.containerInfo),mS(c,p,C),ex=D;break;case 22:c.memoizedState===null&&(D=c.alternate,D!==null&&D.memoizedState!==null?(D=uA,uA=16777216,mS(c,p,C),uA=D):mS(c,p,C));break;default:mS(c,p,C)}}function iT(c){var p=c.alternate;if(p!==null&&(c=p.child,c!==null)){p.child=null;do p=c.sibling,c.sibling=null,c=p;while(c!==null)}}function hA(c){var p=c.deletions;if((c.flags&16)!==0){if(p!==null)for(var C=0;C<p.length;C++){var D=p[C];rv=D,sT(D,c)}iT(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)rT(c),c=c.sibling}function rT(c){switch(c.tag){case 0:case 11:case 15:hA(c),c.flags&2048&&e2(9,c,c.return);break;case 3:hA(c);break;case 12:hA(c);break;case 22:var p=c.stateNode;c.memoizedState!==null&&p._visibility&2&&(c.return===null||c.return.tag!==13)?(p._visibility&=-3,pE(c)):hA(c);break;default:hA(c)}}function pE(c){var p=c.deletions;if((c.flags&16)!==0){if(p!==null)for(var C=0;C<p.length;C++){var D=p[C];rv=D,sT(D,c)}iT(c)}for(c=c.child;c!==null;){switch(p=c,p.tag){case 0:case 11:case 15:e2(8,p,p.return),pE(p);break;case 22:C=p.stateNode,C._visibility&2&&(C._visibility&=-3,pE(p));break;default:pE(p)}c=c.sibling}}function sT(c,p){for(;rv!==null;){var C=rv;switch(C.tag){case 0:case 11:case 15:e2(8,C,p);break;case 23:case 22:if(C.memoizedState!==null&&C.memoizedState.cachePool!==null){var D=C.memoizedState.cachePool.pool;D!=null&&D.refCount++}break;case 24:Kx(C.memoizedState.cache)}if(D=C.child,D!==null)D.return=C,rv=D;else e:for(C=c;rv!==null;){D=rv;var G=D.sibling,$=D.return;if(KC(D),D===C){rv=null;break e}if(G!==null){G.return=$,rv=G;break e}rv=$}}}var D3={getCacheForType:function(c){var p=tv(U_),C=p.data.get(c);return C===void 0&&(C=c(),p.data.set(c,C)),C},cacheSignal:function(){return tv(U_).controller.signal}},L3=typeof WeakMap=="function"?WeakMap:Map,q1=0,P_=null,k1=null,j1=0,J1=0,Bv=null,t2=!1,gS=!1,qM=!1,zx=0,V_=0,n2=0,G2=0,ZM=0,Nv=0,_S=0,dA=null,Lv=null,QM=!1,mE=0,aT=0,gE=1/0,_E=null,i2=null,nv=0,r2=null,vS=null,Fx=0,JM=0,ew=null,oT=null,fA=0,tw=null;function zv(){return(q1&2)!==0&&j1!==0?j1&-j1:k.T!==null?ow():A0()}function lT(){if(Nv===0)if((j1&536870912)===0||U1){var c=hi;hi<<=1,(hi&3932160)===0&&(hi=262144),Nv=c}else Nv=536870912;return c=Ov.current,c!==null&&(c.flags|=32),Nv}function Pv(c,p,C){(c===P_&&(J1===2||J1===9)||c.cancelPendingCommit!==null)&&(xS(c,0),s2(c,j1,Nv,!1)),Z(c,C),((q1&2)===0||c!==P_)&&(c===P_&&((q1&2)===0&&(G2|=C),V_===4&&s2(c,j1,Nv,!1)),dx(c))}function cT(c,p,C){if((q1&6)!==0)throw Error(n(327));var D=!C&&(p&127)===0&&(p&c.expiredLanes)===0||o0(c,p),G=D?I3(c,p):iw(c,p,!0),$=D;do{if(G===0){gS&&!D&&s2(c,p,0,!1);break}else{if(C=c.current.alternate,$&&!P3(C)){G=iw(c,p,!1),$=!1;continue}if(G===2){if($=p,c.errorRecoveryDisabledLanes&$)var tt=0;else tt=c.pendingLanes&-536870913,tt=tt!==0?tt:tt&536870912?536870912:0;if(tt!==0){p=tt;e:{var i0=c;G=dA;var D0=i0.current.memoizedState.isDehydrated;if(D0&&(xS(i0,tt).flags|=256),tt=iw(i0,tt,!1),tt!==2){if(qM&&!D0){i0.errorRecoveryDisabledLanes|=$,G2|=$,G=4;break e}$=Lv,Lv=G,$!==null&&(Lv===null?Lv=$:Lv.push.apply(Lv,$))}G=tt}if($=!1,G!==2)continue}}if(G===1){xS(c,0),s2(c,p,0,!0);break}e:{switch(D=c,$=G,$){case 0:case 1:throw Error(n(345));case 4:if((p&4194048)!==p)break;case 6:s2(D,p,Nv,!t2);break e;case 2:Lv=null;break;case 3:case 5:break;default:throw Error(n(329))}if((p&62914560)===p&&(G=mE+300-Xe(),10<G)){if(s2(D,p,Nv,!t2),t0(D,0,!0)!==0)break e;Fx=p,D.timeoutHandle=kT(uT.bind(null,D,C,Lv,_E,QM,p,Nv,G2,_S,t2,$,"Throttled",-0,0),G);break e}uT(D,C,Lv,_E,QM,p,Nv,G2,_S,t2,$,null,-0,0)}}break}while(!0);dx(c)}function uT(c,p,C,D,G,$,tt,i0,D0,$0,J0,n1,K0,Z0){if(c.timeoutHandle=-1,n1=p.subtreeFlags,n1&8192||(n1&16785408)===16785408){n1={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:J_},nT(p,$,n1);var v1=($&62914560)===$?mE-Xe():($&4194048)===$?aT-Xe():0;if(v1=gR(n1,v1),v1!==null){Fx=$,c.cancelPendingCommit=v1(vT.bind(null,c,p,$,C,D,G,tt,i0,D0,J0,n1,null,K0,Z0)),s2(c,$,tt,!$0);return}}vT(c,p,$,C,D,G,tt,i0,D0)}function P3(c){for(var p=c;;){var C=p.tag;if((C===0||C===11||C===15)&&p.flags&16384&&(C=p.updateQueue,C!==null&&(C=C.stores,C!==null)))for(var D=0;D<C.length;D++){var G=C[D],$=G.getSnapshot;G=G.value;try{if(!B_($(),G))return!1}catch{return!1}}if(C=p.child,p.subtreeFlags&16384&&C!==null)C.return=p,p=C;else{if(p===c)break;for(;p.sibling===null;){if(p.return===null||p.return===c)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function s2(c,p,C,D){p&=~ZM,p&=~G2,c.suspendedLanes|=p,c.pingedLanes&=~p,D&&(c.warmLanes|=p),D=c.expirationTimes;for(var G=p;0<G;){var $=31-x0(G),tt=1<<$;D[$]=-1,G&=~tt}C!==0&&lt(c,C,p)}function vE(){return(q1&6)===0?(pA(0),!1):!0}function nw(){if(k1!==null){if(J1===0)var c=k1.return;else c=k1,xv=Ex=null,vM(c),a1=null,A1=0,c=k1;for(;c!==null;)GC(c.alternate,c),c=c.return;k1=null}}function xS(c,p){var C=c.timeoutHandle;C!==-1&&(c.timeoutHandle=-1,Q3(C)),C=c.cancelPendingCommit,C!==null&&(c.cancelPendingCommit=null,C()),Fx=0,nw(),P_=c,k1=C=Yv(c.current,null),j1=p,J1=0,Bv=null,t2=!1,gS=o0(c,p),qM=!1,_S=Nv=ZM=G2=n2=V_=0,Lv=dA=null,QM=!1,(p&8)!==0&&(p|=p&32);var D=c.entangledLanes;if(D!==0)for(c=c.entanglements,D&=p;0<D;){var G=31-x0(D),$=1<<G;p|=c[G],D&=~$}return zx=p,D2(),C}function hT(c,p){O1=null,k.H=rA,p===s0||p===g0?(p=$1(),J1=3):p===y0?(p=$1(),J1=4):J1=p===IM?8:p!==null&&typeof p=="object"&&typeof p.then=="function"?6:1,Bv=p,k1===null&&(V_=1,oE(c,fv(p,c.current)))}function dT(){var c=Ov.current;return c===null?!0:(j1&4194048)===j1?Hv===null:(j1&62914560)===j1||(j1&536870912)!==0?c===Hv:!1}function fT(){var c=k.H;return k.H=rA,c===null?rA:c}function pT(){var c=k.A;return k.A=D3,c}function xE(){V_=4,t2||(j1&4194048)!==j1&&Ov.current!==null||(gS=!0),(n2&134217727)===0&&(G2&134217727)===0||P_===null||s2(P_,j1,Nv,!1)}function iw(c,p,C){var D=q1;q1|=2;var G=fT(),$=pT();(P_!==c||j1!==p)&&(_E=null,xS(c,p)),p=!1;var tt=V_;e:do try{if(J1!==0&&k1!==null){var i0=k1,D0=Bv;switch(J1){case 8:nw(),tt=6;break e;case 3:case 2:case 9:case 6:Ov.current===null&&(p=!0);var $0=J1;if(J1=0,Bv=null,yS(c,i0,D0,$0),C&&gS){tt=0;break e}break;default:$0=J1,J1=0,Bv=null,yS(c,i0,D0,$0)}}O3(),tt=V_;break}catch(J0){hT(c,J0)}while(!0);return p&&c.shellSuspendCounter++,xv=Ex=null,q1=D,k.H=G,k.A=$,k1===null&&(P_=null,j1=0,D2()),tt}function O3(){for(;k1!==null;)mT(k1)}function I3(c,p){var C=q1;q1|=2;var D=fT(),G=pT();P_!==c||j1!==p?(_E=null,gE=Xe()+500,xS(c,p)):gS=o0(c,p);e:do try{if(J1!==0&&k1!==null){p=k1;var $=Bv;t:switch(J1){case 1:J1=0,Bv=null,yS(c,p,$,1);break;case 2:case 9:if(k0($)){J1=0,Bv=null,gT(p);break}p=function(){J1!==2&&J1!==9||P_!==c||(J1=7),dx(c)},$.then(p,p);break e;case 3:J1=7;break e;case 4:J1=5;break e;case 7:k0($)?(J1=0,Bv=null,gT(p)):(J1=0,Bv=null,yS(c,p,$,7));break;case 5:var tt=null;switch(k1.tag){case 26:tt=k1.memoizedState;case 5:case 27:var i0=k1;if(tt?t3(tt):i0.stateNode.complete){J1=0,Bv=null;var D0=i0.sibling;if(D0!==null)k1=D0;else{var $0=i0.return;$0!==null?(k1=$0,yE($0)):k1=null}break t}}J1=0,Bv=null,yS(c,p,$,5);break;case 6:J1=0,Bv=null,yS(c,p,$,6);break;case 8:nw(),V_=6;break e;default:throw Error(n(462))}}B3();break}catch(J0){hT(c,J0)}while(!0);return xv=Ex=null,k.H=D,k.A=G,q1=C,k1!==null?0:(P_=null,j1=0,D2(),V_)}function B3(){for(;k1!==null&&!R0();)mT(k1)}function mT(c){var p=UC(c.alternate,c,zx);c.memoizedProps=c.pendingProps,p===null?yE(c):k1=p}function gT(c){var p=c,C=p.alternate;switch(p.tag){case 15:case 0:p=OC(C,p,p.pendingProps,p.type,void 0,j1);break;case 11:p=OC(C,p,p.pendingProps,p.type.render,p.ref,j1);break;case 5:vM(p);default:GC(C,p),p=k1=ax(p,zx),p=UC(C,p,zx)}c.memoizedProps=c.pendingProps,p===null?yE(c):k1=p}function yS(c,p,C,D){xv=Ex=null,vM(p),a1=null,A1=0;var G=p.return;try{if(A3(c,G,p,C,j1)){V_=1,oE(c,fv(C,c.current)),k1=null;return}}catch($){if(G!==null)throw k1=G,$;V_=1,oE(c,fv(C,c.current)),k1=null;return}p.flags&32768?(U1||D===1?c=!0:gS||(j1&536870912)!==0?c=!1:(t2=c=!0,(D===2||D===9||D===3||D===6)&&(D=Ov.current,D!==null&&D.tag===13&&(D.flags|=16384))),_T(p,c)):yE(p)}function yE(c){var p=c;do{if((p.flags&32768)!==0){_T(p,t2);return}c=p.return;var C=w3(p.alternate,p,zx);if(C!==null){k1=C;return}if(p=p.sibling,p!==null){k1=p;return}k1=p=c}while(p!==null);V_===0&&(V_=5)}function _T(c,p){do{var C=C3(c.alternate,c);if(C!==null){C.flags&=32767,k1=C;return}if(C=c.return,C!==null&&(C.flags|=32768,C.subtreeFlags=0,C.deletions=null),!p&&(c=c.sibling,c!==null)){k1=c;return}k1=c=C}while(c!==null);V_=6,k1=null}function vT(c,p,C,D,G,$,tt,i0,D0){c.cancelPendingCommit=null;do bE();while(nv!==0);if((q1&6)!==0)throw Error(n(327));if(p!==null){if(p===c.current)throw Error(n(177));if($=p.lanes|p.childLanes,$|=R2,at(c,C,$,tt,i0,D0),c===P_&&(k1=P_=null,j1=0),vS=p,r2=c,Fx=C,JM=$,ew=G,oT=D,(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,U3(it,function(){return AT(),null})):(c.callbackNode=null,c.callbackPriority=0),D=(p.flags&13878)!==0,(p.subtreeFlags&13878)!==0||D){D=k.T,k.T=null,G=U.p,U.p=2,tt=q1,q1|=4;try{T3(c,p,C)}finally{q1=tt,U.p=G,k.T=D}}nv=1,xT(),yT(),bT()}}function xT(){if(nv===1){nv=0;var c=r2,p=vS,C=(p.flags&13878)!==0;if((p.subtreeFlags&13878)!==0||C){C=k.T,k.T=null;var D=U.p;U.p=2;var G=q1;q1|=4;try{JC(p,c);var $=mw,tt=M2(c.containerInfo),i0=$.focusedElem,D0=$.selectionRange;if(tt!==i0&&i0&&i0.ownerDocument&&US(i0.ownerDocument.documentElement,i0)){if(D0!==null&&Q2(i0)){var $0=D0.start,J0=D0.end;if(J0===void 0&&(J0=$0),"selectionStart"in i0)i0.selectionStart=$0,i0.selectionEnd=Math.min(J0,i0.value.length);else{var n1=i0.ownerDocument||document,K0=n1&&n1.defaultView||window;if(K0.getSelection){var Z0=K0.getSelection(),v1=i0.textContent.length,C1=Math.min(D0.start,v1),R_=D0.end===void 0?C1:Math.min(D0.end,v1);!Z0.extend&&C1>R_&&(tt=R_,R_=C1,C1=tt);var V0=UA(i0,C1),z0=UA(i0,R_);if(V0&&z0&&(Z0.rangeCount!==1||Z0.anchorNode!==V0.node||Z0.anchorOffset!==V0.offset||Z0.focusNode!==z0.node||Z0.focusOffset!==z0.offset)){var j0=n1.createRange();j0.setStart(V0.node,V0.offset),Z0.removeAllRanges(),C1>R_?(Z0.addRange(j0),Z0.extend(z0.node,z0.offset)):(j0.setEnd(z0.node,z0.offset),Z0.addRange(j0))}}}}for(n1=[],Z0=i0;Z0=Z0.parentNode;)Z0.nodeType===1&&n1.push({element:Z0,left:Z0.scrollLeft,top:Z0.scrollTop});for(typeof i0.focus=="function"&&i0.focus(),i0=0;i0<n1.length;i0++){var t1=n1[i0];t1.element.scrollLeft=t1.left,t1.element.scrollTop=t1.top}}OE=!!pw,mw=pw=null}finally{q1=G,U.p=D,k.T=C}}c.current=p,nv=2}}function yT(){if(nv===2){nv=0;var c=r2,p=vS,C=(p.flags&8772)!==0;if((p.subtreeFlags&8772)!==0||C){C=k.T,k.T=null;var D=U.p;U.p=2;var G=q1;q1|=4;try{YC(c,p.alternate,p)}finally{q1=G,U.p=D,k.T=C}}nv=3}}function bT(){if(nv===4||nv===3){nv=0,si();var c=r2,p=vS,C=Fx,D=oT;(p.subtreeFlags&10256)!==0||(p.flags&10256)!==0?nv=5:(nv=0,vS=r2=null,ST(c,c.pendingLanes));var G=c.pendingLanes;if(G===0&&(i2=null),v0(C),p=p.stateNode,He&&typeof He.onCommitFiberRoot=="function")try{He.onCommitFiberRoot(O0,p,void 0,(p.current.flags&128)===128)}catch{}if(D!==null){p=k.T,G=U.p,U.p=2,k.T=null;try{for(var $=c.onRecoverableError,tt=0;tt<D.length;tt++){var i0=D[tt];$(i0.value,{componentStack:i0.stack})}}finally{k.T=p,U.p=G}}(Fx&3)!==0&&bE(),dx(c),G=c.pendingLanes,(C&261930)!==0&&(G&42)!==0?c===tw?fA++:(fA=0,tw=c):fA=0,pA(0)}}function ST(c,p){(c.pooledCacheLanes&=p)===0&&(p=c.pooledCache,p!=null&&(c.pooledCache=null,Kx(p)))}function bE(){return xT(),yT(),bT(),AT()}function AT(){if(nv!==5)return!1;var c=r2,p=JM;JM=0;var C=v0(Fx),D=k.T,G=U.p;try{U.p=32>C?32:C,k.T=null,C=ew,ew=null;var $=r2,tt=Fx;if(nv=0,vS=r2=null,Fx=0,(q1&6)!==0)throw Error(n(331));var i0=q1;if(q1|=4,rT($.current),tT($,$.current,tt,C),q1=i0,pA(0,!1),He&&typeof He.onPostCommitFiberRoot=="function")try{He.onPostCommitFiberRoot(O0,$)}catch{}return!0}finally{U.p=G,k.T=D,ST(c,p)}}function ET(c,p,C){p=fv(C,p),p=OM(c.stateNode,p,2),c=P1(c,p,2),c!==null&&(Z(c,2),dx(c))}function S_(c,p,C){if(c.tag===3)ET(c,c,C);else for(;p!==null;){if(p.tag===3){ET(p,c,C);break}else if(p.tag===1){var D=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(i2===null||!i2.has(D))){c=fv(C,c),C=MC(2),D=P1(p,C,2),D!==null&&(wC(C,D,p,c),Z(D,2),dx(D));break}}p=p.return}}function rw(c,p,C){var D=c.pingCache;if(D===null){D=c.pingCache=new L3;var G=new Set;D.set(p,G)}else G=D.get(p),G===void 0&&(G=new Set,D.set(p,G));G.has(C)||(qM=!0,G.add(C),c=N3.bind(null,c,p,C),p.then(c,c))}function N3(c,p,C){var D=c.pingCache;D!==null&&D.delete(p),c.pingedLanes|=c.suspendedLanes&C,c.warmLanes&=~C,P_===c&&(j1&C)===C&&(V_===4||V_===3&&(j1&62914560)===j1&&300>Xe()-mE?(q1&2)===0&&xS(c,0):ZM|=C,_S===j1&&(_S=0)),dx(c)}function MT(c,p){p===0&&(p=m0()),c=sx(c,p),c!==null&&(Z(c,p),dx(c))}function z3(c){var p=c.memoizedState,C=0;p!==null&&(C=p.retryLane),MT(c,C)}function F3(c,p){var C=0;switch(c.tag){case 31:case 13:var D=c.stateNode,G=c.memoizedState;G!==null&&(C=G.retryLane);break;case 19:D=c.stateNode;break;case 22:D=c.stateNode._retryCache;break;default:throw Error(n(314))}D!==null&&D.delete(p),MT(c,C)}function U3(c,p){return C0(c,p)}var SE=null,bS=null,sw=!1,AE=!1,aw=!1,a2=0;function dx(c){c!==bS&&c.next===null&&(bS===null?SE=bS=c:bS=bS.next=c),AE=!0,sw||(sw=!0,G3())}function pA(c,p){if(!aw&&AE){aw=!0;do for(var C=!1,D=SE;D!==null;){if(c!==0){var G=D.pendingLanes;if(G===0)var $=0;else{var tt=D.suspendedLanes,i0=D.pingedLanes;$=(1<<31-x0(42|c)+1)-1,$&=G&~(tt&~i0),$=$&201326741?$&201326741|1:$?$|2:0}$!==0&&(C=!0,RT(D,$))}else $=j1,$=t0(D,D===P_?$:0,D.cancelPendingCommit!==null||D.timeoutHandle!==-1),($&3)===0||o0(D,$)||(C=!0,RT(D,$));D=D.next}while(C);aw=!1}}function k3(){wT()}function wT(){AE=sw=!1;var c=0;a2!==0&&Z3()&&(c=a2);for(var p=Xe(),C=null,D=SE;D!==null;){var G=D.next,$=CT(D,p);$===0?(D.next=null,C===null?SE=G:C.next=G,G===null&&(bS=C)):(C=D,(c!==0||($&3)!==0)&&(AE=!0)),D=G}nv!==0&&nv!==5||pA(c),a2!==0&&(a2=0)}function CT(c,p){for(var C=c.suspendedLanes,D=c.pingedLanes,G=c.expirationTimes,$=c.pendingLanes&-62914561;0<$;){var tt=31-x0($),i0=1<<tt,D0=G[tt];D0===-1?((i0&C)===0||(i0&D)!==0)&&(G[tt]=Ji(i0,p)):D0<=p&&(c.expiredLanes|=i0),$&=~i0}if(p=P_,C=j1,C=t0(c,c===p?C:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),D=c.callbackNode,C===0||c===p&&(J1===2||J1===9)||c.cancelPendingCommit!==null)return D!==null&&D!==null&&P0(D),c.callbackNode=null,c.callbackPriority=0;if((C&3)===0||o0(c,C)){if(p=C&-C,p===c.callbackPriority)return p;switch(D!==null&&P0(D),v0(C)){case 2:case 8:C=Q;break;case 32:C=it;break;case 268435456:C=a0;break;default:C=it}return D=TT.bind(null,c),C=C0(C,D),c.callbackPriority=p,c.callbackNode=C,p}return D!==null&&D!==null&&P0(D),c.callbackPriority=2,c.callbackNode=null,2}function TT(c,p){if(nv!==0&&nv!==5)return c.callbackNode=null,c.callbackPriority=0,null;var C=c.callbackNode;if(bE()&&c.callbackNode!==C)return null;var D=j1;return D=t0(c,c===P_?D:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),D===0?null:(cT(c,D,p),CT(c,Xe()),c.callbackNode!=null&&c.callbackNode===C?TT.bind(null,c):null)}function RT(c,p){if(bE())return null;cT(c,p,!0)}function G3(){J3(function(){(q1&6)!==0?C0(w0,k3):wT()})}function ow(){if(a2===0){var c=wx;c===0&&(c=ut,ut<<=1,(ut&261888)===0&&(ut=256)),a2=c}return a2}function DT(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:j_(""+c)}function LT(c,p){var C=p.ownerDocument.createElement("input");return C.name=p.name,C.value=p.value,c.id&&C.setAttribute("form",c.id),p.parentNode.insertBefore(C,p),c=new FormData(c),C.parentNode.removeChild(C),c}function V3(c,p,C,D,G){if(p==="submit"&&C&&C.stateNode===G){var $=DT((G[u1]||null).action),tt=D.submitter;tt&&(p=(p=tt[u1]||null)?DT(p.formAction):tt.getAttribute("formAction"),p!==null&&($=p,tt=null));var i0=new j2("action","action",null,D,G);c.push({event:i0,listeners:[{instance:null,listener:function(){if(D.defaultPrevented){if(a2!==0){var D0=tt?LT(G,tt):new FormData(G);CM(C,{pending:!0,data:D0,method:G.method,action:$},null,D0)}}else typeof $=="function"&&(i0.preventDefault(),D0=tt?LT(G,tt):new FormData(G),CM(C,{pending:!0,data:D0,method:G.method,action:$},$,D0))},currentTarget:G}]})}}for(var lw=0;lw<nS.length;lw++){var cw=nS[lw],H3=cw.toLowerCase(),j3=cw[0].toUpperCase()+cw.slice(1);Ev(H3,"on"+j3)}Ev(GS,"onAnimationEnd"),Ev(tS,"onAnimationIteration"),Ev(VS,"onAnimationStart"),Ev("dblclick","onDoubleClick"),Ev("focusin","onFocus"),Ev("focusout","onBlur"),Ev(GA,"onTransitionRun"),Ev(VA,"onTransitionStart"),Ev(HA,"onTransitionCancel"),Ev(w2,"onTransitionEnd"),m1("onMouseEnter",["mouseout","mouseover"]),m1("onMouseLeave",["mouseout","mouseover"]),m1("onPointerEnter",["pointerout","pointerover"]),m1("onPointerLeave",["pointerout","pointerover"]),x1("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),x1("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),x1("onBeforeInput",["compositionend","keypress","textInput","paste"]),x1("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),x1("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),x1("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var mA="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),W3=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(mA));function PT(c,p){p=(p&4)!==0;for(var C=0;C<c.length;C++){var D=c[C],G=D.event;D=D.listeners;e:{var $=void 0;if(p)for(var tt=D.length-1;0<=tt;tt--){var i0=D[tt],D0=i0.instance,$0=i0.currentTarget;if(i0=i0.listener,D0!==$&&G.isPropagationStopped())break e;$=i0,G.currentTarget=$0;try{$(G)}catch(J0){T2(J0)}G.currentTarget=null,$=D0}else for(tt=0;tt<D.length;tt++){if(i0=D[tt],D0=i0.instance,$0=i0.currentTarget,i0=i0.listener,D0!==$&&G.isPropagationStopped())break e;$=i0,G.currentTarget=$0;try{$(G)}catch(J0){T2(J0)}G.currentTarget=null,$=D0}}}}function G1(c,p){var C=p[Q0];C===void 0&&(C=p[Q0]=new Set);var D=c+"__bubble";C.has(D)||(OT(p,c,2,!1),C.add(D))}function uw(c,p,C){var D=0;p&&(D|=4),OT(C,c,D,p)}var EE="_reactListening"+Math.random().toString(36).slice(2);function hw(c){if(!c[EE]){c[EE]=!0,s1.forEach(function(C){C!=="selectionchange"&&(W3.has(C)||uw(C,!1,c),uw(C,!0,c))});var p=c.nodeType===9?c:c.ownerDocument;p===null||p[EE]||(p[EE]=!0,uw("selectionchange",!1,p))}}function OT(c,p,C,D){switch(l3(p)){case 2:var G=xR;break;case 8:G=yR;break;default:G=ww}C=G.bind(null,p,C,c),G=void 0,!CS||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(G=!0),D?G!==void 0?c.addEventListener(p,C,{capture:!0,passive:G}):c.addEventListener(p,C,!0):G!==void 0?c.addEventListener(p,C,{passive:G}):c.addEventListener(p,C,!1)}function dw(c,p,C,D,G){var $=D;if((p&1)===0&&(p&2)===0&&D!==null)e:for(;;){if(D===null)return;var tt=D.tag;if(tt===3||tt===4){var i0=D.stateNode.containerInfo;if(i0===G)break;if(tt===4)for(tt=D.return;tt!==null;){var D0=tt.tag;if((D0===3||D0===4)&&tt.stateNode.containerInfo===G)return;tt=tt.return}for(;i0!==null;){if(tt=r1(i0),tt===null)return;if(D0=tt.tag,D0===5||D0===6||D0===26||D0===27){D=$=tt;continue e}i0=i0.parentNode}}D=D.return}EA(function(){var $0=$,J0=Sv(C),n1=[];e:{var K0=C2.get(c);if(K0!==void 0){var Z0=j2,v1=c;switch(c){case"keypress":if(m2(C)===0)break e;case"keydown":case"keyup":Z0=YE;break;case"focusin":v1="focus",Z0=DS;break;case"focusout":v1="blur",Z0=DS;break;case"beforeblur":case"afterblur":Z0=DS;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Z0=CA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Z0=v2;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Z0=Y2;break;case GS:case tS:case VS:Z0=$2;break;case w2:Z0=QE;break;case"scroll":case"scrollend":Z0=kE;break;case"wheel":Z0=eM;break;case"copy":case"cut":case"paste":Z0=x2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Z0=LA;break;case"toggle":case"beforetoggle":Z0=LS}var C1=(p&4)!==0,R_=!C1&&(c==="scroll"||c==="scrollend"),V0=C1?K0!==null?K0+"Capture":null:K0;C1=[];for(var z0=$0,j0;z0!==null;){var t1=z0;if(j0=t1.stateNode,t1=t1.tag,t1!==5&&t1!==26&&t1!==27||j0===null||V0===null||(t1=hv(z0,V0),t1!=null&&C1.push(gA(z0,t1,j0))),R_)break;z0=z0.return}0<C1.length&&(K0=new Z0(K0,v1,null,C,J0),n1.push({event:K0,listeners:C1}))}}if((p&7)===0){e:{if(K0=c==="mouseover"||c==="pointerover",Z0=c==="mouseout"||c==="pointerout",K0&&C!==nx&&(v1=C.relatedTarget||C.fromElement)&&(r1(v1)||v1[e1]))break e;if((Z0||K0)&&(K0=J0.window===J0?J0:(K0=J0.ownerDocument)?K0.defaultView||K0.parentWindow:window,Z0?(v1=C.relatedTarget||C.toElement,Z0=$0,v1=v1?r1(v1):null,v1!==null&&(R_=s(v1),C1=v1.tag,v1!==R_||C1!==5&&C1!==27&&C1!==6)&&(v1=null)):(Z0=null,v1=$0),Z0!==v1)){if(C1=CA,t1="onMouseLeave",V0="onMouseEnter",z0="mouse",(c==="pointerout"||c==="pointerover")&&(C1=LA,t1="onPointerLeave",V0="onPointerEnter",z0="pointer"),R_=Z0==null?K0:p1(Z0),j0=v1==null?K0:p1(v1),K0=new C1(t1,z0+"leave",Z0,C,J0),K0.target=R_,K0.relatedTarget=j0,t1=null,r1(J0)===$0&&(C1=new C1(V0,z0+"enter",v1,C,J0),C1.target=j0,C1.relatedTarget=R_,t1=C1),R_=t1,Z0&&v1)t:{for(C1=$3,V0=Z0,z0=v1,j0=0,t1=V0;t1;t1=C1(t1))j0++;t1=0;for(var E1=z0;E1;E1=C1(E1))t1++;for(;0<j0-t1;)V0=C1(V0),j0--;for(;0<t1-j0;)z0=C1(z0),t1--;for(;j0--;){if(V0===z0||z0!==null&&V0===z0.alternate){C1=V0;break t}V0=C1(V0),z0=C1(z0)}C1=null}else C1=null;Z0!==null&&IT(n1,K0,Z0,C1,!1),v1!==null&&R_!==null&&IT(n1,R_,v1,C1,!0)}}e:{if(K0=$0?p1($0):window,Z0=K0.nodeName&&K0.nodeName.toLowerCase(),Z0==="select"||Z0==="input"&&K0.type==="file")var Y1=FA;else if(OS(K0))if(rM)Y1=aM;else{Y1=Z2;var y1=sM}else Z0=K0.nodeName,!Z0||Z0.toLowerCase()!=="input"||K0.type!=="checkbox"&&K0.type!=="radio"?$0&&I_($0.elementType)&&(Y1=FA):Y1=yx;if(Y1&&(Y1=Y1(c,$0))){K2(n1,Y1,C,J0);break e}y1&&y1(c,K0,$0),c==="focusout"&&$0&&K0.type==="number"&&$0.memoizedProps.value!=null&&cv(K0,"number",K0.value)}switch(y1=$0?p1($0):window,c){case"focusin":(OS(y1)||y1.contentEditable==="true")&&(bx=y1,J2=$0,jx=null);break;case"focusout":jx=J2=bx=null;break;case"mousedown":eS=!0;break;case"contextmenu":case"mouseup":case"dragend":eS=!1,kS(n1,C,J0);break;case"selectionchange":if(kA)break;case"keydown":case"keyup":kS(n1,C,J0)}var I1;if(PS)e:{switch(c){case"compositionstart":var W1="onCompositionStart";break e;case"compositionend":W1="onCompositionEnd";break e;case"compositionupdate":W1="onCompositionUpdate";break e}W1=void 0}else kx?A2(c,C)&&(W1="onCompositionEnd"):c==="keydown"&&C.keyCode===229&&(W1="onCompositionStart");W1&&(PA&&C.locale!=="ko"&&(kx||W1!=="onCompositionStart"?W1==="onCompositionEnd"&&kx&&(I1=MA()):(Av=J0,V2="value"in Av?Av.value:Av.textContent,kx=!0)),y1=ME($0,W1),0<y1.length&&(W1=new RA(W1,c,null,C,J0),n1.push({event:W1,listeners:y1}),I1?W1.data=I1:(I1=BA(C),I1!==null&&(W1.data=I1)))),(I1=nM?Gx(c,C):NA(c,C))&&(W1=ME($0,"onBeforeInput"),0<W1.length&&(y1=new RA("onBeforeInput","beforeinput",null,C,J0),n1.push({event:y1,listeners:W1}),y1.data=I1)),V3(n1,c,$0,C,J0)}PT(n1,p)})}function gA(c,p,C){return{instance:c,listener:p,currentTarget:C}}function ME(c,p){for(var C=p+"Capture",D=[];c!==null;){var G=c,$=G.stateNode;if(G=G.tag,G!==5&&G!==26&&G!==27||$===null||(G=hv(c,C),G!=null&&D.unshift(gA(c,G,$)),G=hv(c,p),G!=null&&D.push(gA(c,G,$))),c.tag===3)return D;c=c.return}return[]}function $3(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function IT(c,p,C,D,G){for(var $=p._reactName,tt=[];C!==null&&C!==D;){var i0=C,D0=i0.alternate,$0=i0.stateNode;if(i0=i0.tag,D0!==null&&D0===D)break;i0!==5&&i0!==26&&i0!==27||$0===null||(D0=$0,G?($0=hv(C,$),$0!=null&&tt.unshift(gA(C,$0,D0))):G||($0=hv(C,$),$0!=null&&tt.push(gA(C,$0,D0)))),C=C.return}tt.length!==0&&c.push({event:p,listeners:tt})}var X3=/\r\n?/g,Y3=/\u0000|\uFFFD/g;function BT(c){return(typeof c=="string"?c:""+c).replace(X3,`
`).replace(Y3,"")}function NT(c,p){return p=BT(p),BT(c)===p}function T_(c,p,C,D,G,$){switch(C){case"children":typeof D=="string"?p==="body"||p==="textarea"&&D===""||H_(c,D):(typeof D=="number"||typeof D=="bigint")&&p!=="body"&&H_(c,""+D);break;case"className":T1(c,"class",D);break;case"tabIndex":T1(c,"tabindex",D);break;case"dir":case"role":case"viewBox":case"width":case"height":T1(c,C,D);break;case"style":sv(c,D,$);break;case"data":if(p!=="object"){T1(c,"data",D);break}case"src":case"href":if(D===""&&(p!=="a"||C!=="href")){c.removeAttribute(C);break}if(D==null||typeof D=="function"||typeof D=="symbol"||typeof D=="boolean"){c.removeAttribute(C);break}D=j_(""+D),c.setAttribute(C,D);break;case"action":case"formAction":if(typeof D=="function"){c.setAttribute(C,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof $=="function"&&(C==="formAction"?(p!=="input"&&T_(c,p,"name",G.name,G,null),T_(c,p,"formEncType",G.formEncType,G,null),T_(c,p,"formMethod",G.formMethod,G,null),T_(c,p,"formTarget",G.formTarget,G,null)):(T_(c,p,"encType",G.encType,G,null),T_(c,p,"method",G.method,G,null),T_(c,p,"target",G.target,G,null)));if(D==null||typeof D=="symbol"||typeof D=="boolean"){c.removeAttribute(C);break}D=j_(""+D),c.setAttribute(C,D);break;case"onClick":D!=null&&(c.onclick=J_);break;case"onScroll":D!=null&&G1("scroll",c);break;case"onScrollEnd":D!=null&&G1("scrollend",c);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(n(61));if(C=D.__html,C!=null){if(G.children!=null)throw Error(n(60));c.innerHTML=C}}break;case"multiple":c.multiple=D&&typeof D!="function"&&typeof D!="symbol";break;case"muted":c.muted=D&&typeof D!="function"&&typeof D!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(D==null||typeof D=="function"||typeof D=="boolean"||typeof D=="symbol"){c.removeAttribute("xlink:href");break}C=j_(""+D),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",C);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":D!=null&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(C,""+D):c.removeAttribute(C);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":D&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(C,""):c.removeAttribute(C);break;case"capture":case"download":D===!0?c.setAttribute(C,""):D!==!1&&D!=null&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(C,D):c.removeAttribute(C);break;case"cols":case"rows":case"size":case"span":D!=null&&typeof D!="function"&&typeof D!="symbol"&&!isNaN(D)&&1<=D?c.setAttribute(C,D):c.removeAttribute(C);break;case"rowSpan":case"start":D==null||typeof D=="function"||typeof D=="symbol"||isNaN(D)?c.removeAttribute(C):c.setAttribute(C,D);break;case"popover":G1("beforetoggle",c),G1("toggle",c),b1(c,"popover",D);break;case"xlinkActuate":Z1(c,"http://www.w3.org/1999/xlink","xlink:actuate",D);break;case"xlinkArcrole":Z1(c,"http://www.w3.org/1999/xlink","xlink:arcrole",D);break;case"xlinkRole":Z1(c,"http://www.w3.org/1999/xlink","xlink:role",D);break;case"xlinkShow":Z1(c,"http://www.w3.org/1999/xlink","xlink:show",D);break;case"xlinkTitle":Z1(c,"http://www.w3.org/1999/xlink","xlink:title",D);break;case"xlinkType":Z1(c,"http://www.w3.org/1999/xlink","xlink:type",D);break;case"xmlBase":Z1(c,"http://www.w3.org/XML/1998/namespace","xml:base",D);break;case"xmlLang":Z1(c,"http://www.w3.org/XML/1998/namespace","xml:lang",D);break;case"xmlSpace":Z1(c,"http://www.w3.org/XML/1998/namespace","xml:space",D);break;case"is":b1(c,"is",D);break;case"innerText":case"textContent":break;default:(!(2<C.length)||C[0]!=="o"&&C[0]!=="O"||C[1]!=="n"&&C[1]!=="N")&&(C=Y_.get(C)||C,b1(c,C,D))}}function fw(c,p,C,D,G,$){switch(C){case"style":sv(c,D,$);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(n(61));if(C=D.__html,C!=null){if(G.children!=null)throw Error(n(60));c.innerHTML=C}}break;case"children":typeof D=="string"?H_(c,D):(typeof D=="number"||typeof D=="bigint")&&H_(c,""+D);break;case"onScroll":D!=null&&G1("scroll",c);break;case"onScrollEnd":D!=null&&G1("scrollend",c);break;case"onClick":D!=null&&(c.onclick=J_);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!c1.hasOwnProperty(C))e:{if(C[0]==="o"&&C[1]==="n"&&(G=C.endsWith("Capture"),p=C.slice(2,G?C.length-7:void 0),$=c[u1]||null,$=$!=null?$[C]:null,typeof $=="function"&&c.removeEventListener(p,$,G),typeof D=="function")){typeof $!="function"&&$!==null&&(C in c?c[C]=null:c.hasAttribute(C)&&c.removeAttribute(C)),c.addEventListener(p,D,G);break e}C in c?c[C]=D:D===!0?c.setAttribute(C,""):b1(c,C,D)}}}function ov(c,p,C){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":G1("error",c),G1("load",c);var D=!1,G=!1,$;for($ in C)if(C.hasOwnProperty($)){var tt=C[$];if(tt!=null)switch($){case"src":D=!0;break;case"srcSet":G=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:T_(c,p,$,tt,C,null)}}G&&T_(c,p,"srcSet",C.srcSet,C,null),D&&T_(c,p,"src",C.src,C,null);return;case"input":G1("invalid",c);var i0=$=tt=G=null,D0=null,$0=null;for(D in C)if(C.hasOwnProperty(D)){var J0=C[D];if(J0!=null)switch(D){case"name":G=J0;break;case"type":tt=J0;break;case"checked":D0=J0;break;case"defaultChecked":$0=J0;break;case"value":$=J0;break;case"defaultValue":i0=J0;break;case"children":case"dangerouslySetInnerHTML":if(J0!=null)throw Error(n(137,p));break;default:T_(c,p,D,J0,C,null)}}Q_(c,$,i0,D0,$0,tt,G,!1);return;case"select":G1("invalid",c),D=tt=$=null;for(G in C)if(C.hasOwnProperty(G)&&(i0=C[G],i0!=null))switch(G){case"value":$=i0;break;case"defaultValue":tt=i0;break;case"multiple":D=i0;default:T_(c,p,G,i0,C,null)}p=$,C=tt,c.multiple=!!D,p!=null?bv(c,!!D,p,!1):C!=null&&bv(c,!!D,C,!0);return;case"textarea":G1("invalid",c),$=G=D=null;for(tt in C)if(C.hasOwnProperty(tt)&&(i0=C[tt],i0!=null))switch(tt){case"value":D=i0;break;case"defaultValue":G=i0;break;case"children":$=i0;break;case"dangerouslySetInnerHTML":if(i0!=null)throw Error(n(91));break;default:T_(c,p,tt,i0,C,null)}$v(c,D,G,$);return;case"option":for(D0 in C)if(C.hasOwnProperty(D0)&&(D=C[D0],D!=null))switch(D0){case"selected":c.selected=D&&typeof D!="function"&&typeof D!="symbol";break;default:T_(c,p,D0,D,C,null)}return;case"dialog":G1("beforetoggle",c),G1("toggle",c),G1("cancel",c),G1("close",c);break;case"iframe":case"object":G1("load",c);break;case"video":case"audio":for(D=0;D<mA.length;D++)G1(mA[D],c);break;case"image":G1("error",c),G1("load",c);break;case"details":G1("toggle",c);break;case"embed":case"source":case"link":G1("error",c),G1("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for($0 in C)if(C.hasOwnProperty($0)&&(D=C[$0],D!=null))switch($0){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,p));default:T_(c,p,$0,D,C,null)}return;default:if(I_(p)){for(J0 in C)C.hasOwnProperty(J0)&&(D=C[J0],D!==void 0&&fw(c,p,J0,D,C,void 0));return}}for(i0 in C)C.hasOwnProperty(i0)&&(D=C[i0],D!=null&&T_(c,p,i0,D,C,null))}function K3(c,p,C,D){switch(p){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var G=null,$=null,tt=null,i0=null,D0=null,$0=null,J0=null;for(Z0 in C){var n1=C[Z0];if(C.hasOwnProperty(Z0)&&n1!=null)switch(Z0){case"checked":break;case"value":break;case"defaultValue":D0=n1;default:D.hasOwnProperty(Z0)||T_(c,p,Z0,null,D,n1)}}for(var K0 in D){var Z0=D[K0];if(n1=C[K0],D.hasOwnProperty(K0)&&(Z0!=null||n1!=null))switch(K0){case"type":$=Z0;break;case"name":G=Z0;break;case"checked":$0=Z0;break;case"defaultChecked":J0=Z0;break;case"value":tt=Z0;break;case"defaultValue":i0=Z0;break;case"children":case"dangerouslySetInnerHTML":if(Z0!=null)throw Error(n(137,p));break;default:Z0!==n1&&T_(c,p,K0,Z0,D,n1)}}mv(c,tt,i0,D0,$0,J0,$,G);return;case"select":Z0=tt=i0=K0=null;for($ in C)if(D0=C[$],C.hasOwnProperty($)&&D0!=null)switch($){case"value":break;case"multiple":Z0=D0;default:D.hasOwnProperty($)||T_(c,p,$,null,D,D0)}for(G in D)if($=D[G],D0=C[G],D.hasOwnProperty(G)&&($!=null||D0!=null))switch(G){case"value":K0=$;break;case"defaultValue":i0=$;break;case"multiple":tt=$;default:$!==D0&&T_(c,p,G,$,D,D0)}p=i0,C=tt,D=Z0,K0!=null?bv(c,!!C,K0,!1):!!D!=!!C&&(p!=null?bv(c,!!C,p,!0):bv(c,!!C,C?[]:"",!1));return;case"textarea":Z0=K0=null;for(i0 in C)if(G=C[i0],C.hasOwnProperty(i0)&&G!=null&&!D.hasOwnProperty(i0))switch(i0){case"value":break;case"children":break;default:T_(c,p,i0,null,D,G)}for(tt in D)if(G=D[tt],$=C[tt],D.hasOwnProperty(tt)&&(G!=null||$!=null))switch(tt){case"value":K0=G;break;case"defaultValue":Z0=G;break;case"children":break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(n(91));break;default:G!==$&&T_(c,p,tt,G,D,$)}uv(c,K0,Z0);return;case"option":for(var v1 in C)if(K0=C[v1],C.hasOwnProperty(v1)&&K0!=null&&!D.hasOwnProperty(v1))switch(v1){case"selected":c.selected=!1;break;default:T_(c,p,v1,null,D,K0)}for(D0 in D)if(K0=D[D0],Z0=C[D0],D.hasOwnProperty(D0)&&K0!==Z0&&(K0!=null||Z0!=null))switch(D0){case"selected":c.selected=K0&&typeof K0!="function"&&typeof K0!="symbol";break;default:T_(c,p,D0,K0,D,Z0)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var C1 in C)K0=C[C1],C.hasOwnProperty(C1)&&K0!=null&&!D.hasOwnProperty(C1)&&T_(c,p,C1,null,D,K0);for($0 in D)if(K0=D[$0],Z0=C[$0],D.hasOwnProperty($0)&&K0!==Z0&&(K0!=null||Z0!=null))switch($0){case"children":case"dangerouslySetInnerHTML":if(K0!=null)throw Error(n(137,p));break;default:T_(c,p,$0,K0,D,Z0)}return;default:if(I_(p)){for(var R_ in C)K0=C[R_],C.hasOwnProperty(R_)&&K0!==void 0&&!D.hasOwnProperty(R_)&&fw(c,p,R_,void 0,D,K0);for(J0 in D)K0=D[J0],Z0=C[J0],!D.hasOwnProperty(J0)||K0===Z0||K0===void 0&&Z0===void 0||fw(c,p,J0,K0,D,Z0);return}}for(var V0 in C)K0=C[V0],C.hasOwnProperty(V0)&&K0!=null&&!D.hasOwnProperty(V0)&&T_(c,p,V0,null,D,K0);for(n1 in D)K0=D[n1],Z0=C[n1],!D.hasOwnProperty(n1)||K0===Z0||K0==null&&Z0==null||T_(c,p,n1,K0,D,Z0)}function zT(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function q3(){if(typeof performance.getEntriesByType=="function"){for(var c=0,p=0,C=performance.getEntriesByType("resource"),D=0;D<C.length;D++){var G=C[D],$=G.transferSize,tt=G.initiatorType,i0=G.duration;if($&&i0&&zT(tt)){for(tt=0,i0=G.responseEnd,D+=1;D<C.length;D++){var D0=C[D],$0=D0.startTime;if($0>i0)break;var J0=D0.transferSize,n1=D0.initiatorType;J0&&zT(n1)&&(D0=D0.responseEnd,tt+=J0*(D0<i0?1:(i0-$0)/(D0-$0)))}if(--D,p+=8*($+tt)/(G.duration/1e3),c++,10<c)break}}if(0<c)return p/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var pw=null,mw=null;function wE(c){return c.nodeType===9?c:c.ownerDocument}function FT(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function UT(c,p){if(c===0)switch(p){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&p==="foreignObject"?0:c}function gw(c,p){return c==="textarea"||c==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.children=="bigint"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var _w=null;function Z3(){var c=window.event;return c&&c.type==="popstate"?c===_w?!1:(_w=c,!0):(_w=null,!1)}var kT=typeof setTimeout=="function"?setTimeout:void 0,Q3=typeof clearTimeout=="function"?clearTimeout:void 0,GT=typeof Promise=="function"?Promise:void 0,J3=typeof queueMicrotask=="function"?queueMicrotask:typeof GT<"u"?function(c){return GT.resolve(null).then(c).catch(eR)}:kT;function eR(c){setTimeout(function(){throw c})}function o2(c){return c==="head"}function VT(c,p){var C=p,D=0;do{var G=C.nextSibling;if(c.removeChild(C),G&&G.nodeType===8)if(C=G.data,C==="/$"||C==="/&"){if(D===0){c.removeChild(G),MS(p);return}D--}else if(C==="$"||C==="$?"||C==="$~"||C==="$!"||C==="&")D++;else if(C==="html")_A(c.ownerDocument.documentElement);else if(C==="head"){C=c.ownerDocument.head,_A(C);for(var $=C.firstChild;$;){var tt=$.nextSibling,i0=$.nodeName;$[N0]||i0==="SCRIPT"||i0==="STYLE"||i0==="LINK"&&$.rel.toLowerCase()==="stylesheet"||C.removeChild($),$=tt}}else C==="body"&&_A(c.ownerDocument.body);C=G}while(C);MS(p)}function HT(c,p){var C=c;c=0;do{var D=C.nextSibling;if(C.nodeType===1?p?(C._stashedDisplay=C.style.display,C.style.display="none"):(C.style.display=C._stashedDisplay||"",C.getAttribute("style")===""&&C.removeAttribute("style")):C.nodeType===3&&(p?(C._stashedText=C.nodeValue,C.nodeValue=""):C.nodeValue=C._stashedText||""),D&&D.nodeType===8)if(C=D.data,C==="/$"){if(c===0)break;c--}else C!=="$"&&C!=="$?"&&C!=="$~"&&C!=="$!"||c++;C=D}while(C)}function vw(c){var p=c.firstChild;for(p&&p.nodeType===10&&(p=p.nextSibling);p;){var C=p;switch(p=p.nextSibling,C.nodeName){case"HTML":case"HEAD":case"BODY":vw(C),H0(C);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(C.rel.toLowerCase()==="stylesheet")continue}c.removeChild(C)}}function tR(c,p,C,D){for(;c.nodeType===1;){var G=C;if(c.nodeName.toLowerCase()!==p.toLowerCase()){if(!D&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(D){if(!c[N0])switch(p){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if($=c.getAttribute("rel"),$==="stylesheet"&&c.hasAttribute("data-precedence"))break;if($!==G.rel||c.getAttribute("href")!==(G.href==null||G.href===""?null:G.href)||c.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin)||c.getAttribute("title")!==(G.title==null?null:G.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if($=c.getAttribute("src"),($!==(G.src==null?null:G.src)||c.getAttribute("type")!==(G.type==null?null:G.type)||c.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin))&&$&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(p==="input"&&c.type==="hidden"){var $=G.name==null?null:""+G.name;if(G.type==="hidden"&&c.getAttribute("name")===$)return c}else return c;if(c=jv(c.nextSibling),c===null)break}return null}function nR(c,p,C){if(p==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!C||(c=jv(c.nextSibling),c===null))return null;return c}function jT(c,p){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!p||(c=jv(c.nextSibling),c===null))return null;return c}function xw(c){return c.data==="$?"||c.data==="$~"}function yw(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function iR(c,p){var C=c.ownerDocument;if(c.data==="$~")c._reactRetry=p;else if(c.data!=="$?"||C.readyState!=="loading")p();else{var D=function(){p(),C.removeEventListener("DOMContentLoaded",D)};C.addEventListener("DOMContentLoaded",D),c._reactRetry=D}}function jv(c){for(;c!=null;c=c.nextSibling){var p=c.nodeType;if(p===1||p===3)break;if(p===8){if(p=c.data,p==="$"||p==="$!"||p==="$?"||p==="$~"||p==="&"||p==="F!"||p==="F")break;if(p==="/$"||p==="/&")return null}}return c}var bw=null;function WT(c){c=c.nextSibling;for(var p=0;c;){if(c.nodeType===8){var C=c.data;if(C==="/$"||C==="/&"){if(p===0)return jv(c.nextSibling);p--}else C!=="$"&&C!=="$!"&&C!=="$?"&&C!=="$~"&&C!=="&"||p++}c=c.nextSibling}return null}function $T(c){c=c.previousSibling;for(var p=0;c;){if(c.nodeType===8){var C=c.data;if(C==="$"||C==="$!"||C==="$?"||C==="$~"||C==="&"){if(p===0)return c;p--}else C!=="/$"&&C!=="/&"||p++}c=c.previousSibling}return null}function XT(c,p,C){switch(p=wE(C),c){case"html":if(c=p.documentElement,!c)throw Error(n(452));return c;case"head":if(c=p.head,!c)throw Error(n(453));return c;case"body":if(c=p.body,!c)throw Error(n(454));return c;default:throw Error(n(451))}}function _A(c){for(var p=c.attributes;p.length;)c.removeAttributeNode(p[0]);H0(c)}var Wv=new Map,YT=new Set;function CE(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var Ux=U.d;U.d={f:rR,r:sR,D:aR,C:oR,L:lR,m:cR,X:hR,S:uR,M:dR};function rR(){var c=Ux.f(),p=vE();return c||p}function sR(c){var p=h1(c);p!==null&&p.tag===5&&p.type==="form"?hC(p):Ux.r(c)}var SS=typeof document>"u"?null:document;function KT(c,p,C){var D=SS;if(D&&typeof p=="string"&&p){var G=F1(p);G='link[rel="'+c+'"][href="'+G+'"]',typeof C=="string"&&(G+='[crossorigin="'+C+'"]'),YT.has(G)||(YT.add(G),c={rel:c,crossOrigin:C,href:p},D.querySelector(G)===null&&(p=D.createElement("link"),ov(p,"link",c),G0(p),D.head.appendChild(p)))}}function aR(c){Ux.D(c),KT("dns-prefetch",c,null)}function oR(c,p){Ux.C(c,p),KT("preconnect",c,p)}function lR(c,p,C){Ux.L(c,p,C);var D=SS;if(D&&c&&p){var G='link[rel="preload"][as="'+F1(p)+'"]';p==="image"&&C&&C.imageSrcSet?(G+='[imagesrcset="'+F1(C.imageSrcSet)+'"]',typeof C.imageSizes=="string"&&(G+='[imagesizes="'+F1(C.imageSizes)+'"]')):G+='[href="'+F1(c)+'"]';var $=G;switch(p){case"style":$=AS(c);break;case"script":$=ES(c)}Wv.has($)||(c=g({rel:"preload",href:p==="image"&&C&&C.imageSrcSet?void 0:c,as:p},C),Wv.set($,c),D.querySelector(G)!==null||p==="style"&&D.querySelector(vA($))||p==="script"&&D.querySelector(xA($))||(p=D.createElement("link"),ov(p,"link",c),G0(p),D.head.appendChild(p)))}}function cR(c,p){Ux.m(c,p);var C=SS;if(C&&c){var D=p&&typeof p.as=="string"?p.as:"script",G='link[rel="modulepreload"][as="'+F1(D)+'"][href="'+F1(c)+'"]',$=G;switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":$=ES(c)}if(!Wv.has($)&&(c=g({rel:"modulepreload",href:c},p),Wv.set($,c),C.querySelector(G)===null)){switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(C.querySelector(xA($)))return}D=C.createElement("link"),ov(D,"link",c),G0(D),C.head.appendChild(D)}}}function uR(c,p,C){Ux.S(c,p,C);var D=SS;if(D&&c){var G=o1(D).hoistableStyles,$=AS(c);p=p||"default";var tt=G.get($);if(!tt){var i0={loading:0,preload:null};if(tt=D.querySelector(vA($)))i0.loading=5;else{c=g({rel:"stylesheet",href:c,"data-precedence":p},C),(C=Wv.get($))&&Sw(c,C);var D0=tt=D.createElement("link");G0(D0),ov(D0,"link",c),D0._p=new Promise(function($0,J0){D0.onload=$0,D0.onerror=J0}),D0.addEventListener("load",function(){i0.loading|=1}),D0.addEventListener("error",function(){i0.loading|=2}),i0.loading|=4,TE(tt,p,D)}tt={type:"stylesheet",instance:tt,count:1,state:i0},G.set($,tt)}}}function hR(c,p){Ux.X(c,p);var C=SS;if(C&&c){var D=o1(C).hoistableScripts,G=ES(c),$=D.get(G);$||($=C.querySelector(xA(G)),$||(c=g({src:c,async:!0},p),(p=Wv.get(G))&&Aw(c,p),$=C.createElement("script"),G0($),ov($,"link",c),C.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},D.set(G,$))}}function dR(c,p){Ux.M(c,p);var C=SS;if(C&&c){var D=o1(C).hoistableScripts,G=ES(c),$=D.get(G);$||($=C.querySelector(xA(G)),$||(c=g({src:c,async:!0,type:"module"},p),(p=Wv.get(G))&&Aw(c,p),$=C.createElement("script"),G0($),ov($,"link",c),C.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},D.set(G,$))}}function qT(c,p,C,D){var G=(G=Fe.current)?CE(G):null;if(!G)throw Error(n(446));switch(c){case"meta":case"title":return null;case"style":return typeof C.precedence=="string"&&typeof C.href=="string"?(p=AS(C.href),C=o1(G).hoistableStyles,D=C.get(p),D||(D={type:"style",instance:null,count:0,state:null},C.set(p,D)),D):{type:"void",instance:null,count:0,state:null};case"link":if(C.rel==="stylesheet"&&typeof C.href=="string"&&typeof C.precedence=="string"){c=AS(C.href);var $=o1(G).hoistableStyles,tt=$.get(c);if(tt||(G=G.ownerDocument||G,tt={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},$.set(c,tt),($=G.querySelector(vA(c)))&&!$._p&&(tt.instance=$,tt.state.loading=5),Wv.has(c)||(C={rel:"preload",as:"style",href:C.href,crossOrigin:C.crossOrigin,integrity:C.integrity,media:C.media,hrefLang:C.hrefLang,referrerPolicy:C.referrerPolicy},Wv.set(c,C),$||fR(G,c,C,tt.state))),p&&D===null)throw Error(n(528,""));return tt}if(p&&D!==null)throw Error(n(529,""));return null;case"script":return p=C.async,C=C.src,typeof C=="string"&&p&&typeof p!="function"&&typeof p!="symbol"?(p=ES(C),C=o1(G).hoistableScripts,D=C.get(p),D||(D={type:"script",instance:null,count:0,state:null},C.set(p,D)),D):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,c))}}function AS(c){return'href="'+F1(c)+'"'}function vA(c){return'link[rel="stylesheet"]['+c+"]"}function ZT(c){return g({},c,{"data-precedence":c.precedence,precedence:null})}function fR(c,p,C,D){c.querySelector('link[rel="preload"][as="style"]['+p+"]")?D.loading=1:(p=c.createElement("link"),D.preload=p,p.addEventListener("load",function(){return D.loading|=1}),p.addEventListener("error",function(){return D.loading|=2}),ov(p,"link",C),G0(p),c.head.appendChild(p))}function ES(c){return'[src="'+F1(c)+'"]'}function xA(c){return"script[async]"+c}function QT(c,p,C){if(p.count++,p.instance===null)switch(p.type){case"style":var D=c.querySelector('style[data-href~="'+F1(C.href)+'"]');if(D)return p.instance=D,G0(D),D;var G=g({},C,{"data-href":C.href,"data-precedence":C.precedence,href:null,precedence:null});return D=(c.ownerDocument||c).createElement("style"),G0(D),ov(D,"style",G),TE(D,C.precedence,c),p.instance=D;case"stylesheet":G=AS(C.href);var $=c.querySelector(vA(G));if($)return p.state.loading|=4,p.instance=$,G0($),$;D=ZT(C),(G=Wv.get(G))&&Sw(D,G),$=(c.ownerDocument||c).createElement("link"),G0($);var tt=$;return tt._p=new Promise(function(i0,D0){tt.onload=i0,tt.onerror=D0}),ov($,"link",D),p.state.loading|=4,TE($,C.precedence,c),p.instance=$;case"script":return $=ES(C.src),(G=c.querySelector(xA($)))?(p.instance=G,G0(G),G):(D=C,(G=Wv.get($))&&(D=g({},C),Aw(D,G)),c=c.ownerDocument||c,G=c.createElement("script"),G0(G),ov(G,"link",D),c.head.appendChild(G),p.instance=G);case"void":return null;default:throw Error(n(443,p.type))}else p.type==="stylesheet"&&(p.state.loading&4)===0&&(D=p.instance,p.state.loading|=4,TE(D,C.precedence,c));return p.instance}function TE(c,p,C){for(var D=C.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),G=D.length?D[D.length-1]:null,$=G,tt=0;tt<D.length;tt++){var i0=D[tt];if(i0.dataset.precedence===p)$=i0;else if($!==G)break}$?$.parentNode.insertBefore(c,$.nextSibling):(p=C.nodeType===9?C.head:C,p.insertBefore(c,p.firstChild))}function Sw(c,p){c.crossOrigin==null&&(c.crossOrigin=p.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=p.referrerPolicy),c.title==null&&(c.title=p.title)}function Aw(c,p){c.crossOrigin==null&&(c.crossOrigin=p.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=p.referrerPolicy),c.integrity==null&&(c.integrity=p.integrity)}var RE=null;function JT(c,p,C){if(RE===null){var D=new Map,G=RE=new Map;G.set(C,D)}else G=RE,D=G.get(C),D||(D=new Map,G.set(C,D));if(D.has(c))return D;for(D.set(c,null),C=C.getElementsByTagName(c),G=0;G<C.length;G++){var $=C[G];if(!($[N0]||$[i1]||c==="link"&&$.getAttribute("rel")==="stylesheet")&&$.namespaceURI!=="http://www.w3.org/2000/svg"){var tt=$.getAttribute(p)||"";tt=c+tt;var i0=D.get(tt);i0?i0.push($):D.set(tt,[$])}}return D}function e3(c,p,C){c=c.ownerDocument||c,c.head.insertBefore(C,p==="title"?c.querySelector("head > title"):null)}function pR(c,p,C){if(C===1||p.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof p.precedence!="string"||typeof p.href!="string"||p.href==="")break;return!0;case"link":if(typeof p.rel!="string"||typeof p.href!="string"||p.href===""||p.onLoad||p.onError)break;switch(p.rel){case"stylesheet":return c=p.disabled,typeof p.precedence=="string"&&c==null;default:return!0}case"script":if(p.async&&typeof p.async!="function"&&typeof p.async!="symbol"&&!p.onLoad&&!p.onError&&p.src&&typeof p.src=="string")return!0}return!1}function t3(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function mR(c,p,C,D){if(C.type==="stylesheet"&&(typeof D.media!="string"||matchMedia(D.media).matches!==!1)&&(C.state.loading&4)===0){if(C.instance===null){var G=AS(D.href),$=p.querySelector(vA(G));if($){p=$._p,p!==null&&typeof p=="object"&&typeof p.then=="function"&&(c.count++,c=DE.bind(c),p.then(c,c)),C.state.loading|=4,C.instance=$,G0($);return}$=p.ownerDocument||p,D=ZT(D),(G=Wv.get(G))&&Sw(D,G),$=$.createElement("link"),G0($);var tt=$;tt._p=new Promise(function(i0,D0){tt.onload=i0,tt.onerror=D0}),ov($,"link",D),C.instance=$}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(C,p),(p=C.state.preload)&&(C.state.loading&3)===0&&(c.count++,C=DE.bind(c),p.addEventListener("load",C),p.addEventListener("error",C))}}var Ew=0;function gR(c,p){return c.stylesheets&&c.count===0&&PE(c,c.stylesheets),0<c.count||0<c.imgCount?function(C){var D=setTimeout(function(){if(c.stylesheets&&PE(c,c.stylesheets),c.unsuspend){var $=c.unsuspend;c.unsuspend=null,$()}},6e4+p);0<c.imgBytes&&Ew===0&&(Ew=62500*q3());var G=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&PE(c,c.stylesheets),c.unsuspend)){var $=c.unsuspend;c.unsuspend=null,$()}},(c.imgBytes>Ew?50:800)+p);return c.unsuspend=C,function(){c.unsuspend=null,clearTimeout(D),clearTimeout(G)}}:null}function DE(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)PE(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var LE=null;function PE(c,p){c.stylesheets=null,c.unsuspend!==null&&(c.count++,LE=new Map,p.forEach(_R,c),LE=null,DE.call(c))}function _R(c,p){if(!(p.state.loading&4)){var C=LE.get(c);if(C)var D=C.get(null);else{C=new Map,LE.set(c,C);for(var G=c.querySelectorAll("link[data-precedence],style[data-precedence]"),$=0;$<G.length;$++){var tt=G[$];(tt.nodeName==="LINK"||tt.getAttribute("media")!=="not all")&&(C.set(tt.dataset.precedence,tt),D=tt)}D&&C.set(null,D)}G=p.instance,tt=G.getAttribute("data-precedence"),$=C.get(tt)||D,$===D&&C.set(null,G),C.set(tt,G),this.count++,D=DE.bind(this),G.addEventListener("load",D),G.addEventListener("error",D),$?$.parentNode.insertBefore(G,$.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(G,c.firstChild)),p.state.loading|=4}}var yA={$$typeof:m,Provider:null,Consumer:null,_currentValue:F,_currentValue2:F,_threadCount:0};function vR(c,p,C,D,G,$,tt,i0,D0){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=I0(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=I0(0),this.hiddenUpdates=I0(null),this.identifierPrefix=D,this.onUncaughtError=G,this.onCaughtError=$,this.onRecoverableError=tt,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=D0,this.incompleteTransitions=new Map}function n3(c,p,C,D,G,$,tt,i0,D0,$0,J0,n1){return c=new vR(c,p,C,tt,D0,$0,J0,n1,i0),p=1,$===!0&&(p|=24),$=vv(3,null,null,p),c.current=$,$.stateNode=c,p=QS(),p.refCount++,c.pooledCache=p,p.refCount++,$.memoizedState={element:D,isDehydrated:C,cache:p},k_($),c}function i3(c){return c?(c=$x,c):$x}function r3(c,p,C,D,G,$){G=i3(G),D.context===null?D.context=G:D.pendingContext=G,D=H1(p),D.payload={element:C},$=$===void 0?null:$,$!==null&&(D.callback=$),C=P1(c,D,p),C!==null&&(Pv(C,c,p),R1(C,c,p))}function s3(c,p){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var C=c.retryLane;c.retryLane=C!==0&&C<p?C:p}}function Mw(c,p){s3(c,p),(c=c.alternate)&&s3(c,p)}function a3(c){if(c.tag===13||c.tag===31){var p=sx(c,67108864);p!==null&&Pv(p,c,67108864),Mw(c,67108864)}}function o3(c){if(c.tag===13||c.tag===31){var p=zv();p=f0(p);var C=sx(c,p);C!==null&&Pv(C,c,p),Mw(c,p)}}var OE=!0;function xR(c,p,C,D){var G=k.T;k.T=null;var $=U.p;try{U.p=2,ww(c,p,C,D)}finally{U.p=$,k.T=G}}function yR(c,p,C,D){var G=k.T;k.T=null;var $=U.p;try{U.p=8,ww(c,p,C,D)}finally{U.p=$,k.T=G}}function ww(c,p,C,D){if(OE){var G=Cw(D);if(G===null)dw(c,p,D,IE,C),c3(c,D);else if(SR(G,c,p,C,D))D.stopPropagation();else if(c3(c,D),p&4&&-1<bR.indexOf(c)){for(;G!==null;){var $=h1(G);if($!==null)switch($.tag){case 3:if($=$.stateNode,$.current.memoizedState.isDehydrated){var tt=W($.pendingLanes);if(tt!==0){var i0=$;for(i0.pendingLanes|=2,i0.entangledLanes|=2;tt;){var D0=1<<31-x0(tt);i0.entanglements[1]|=D0,tt&=~D0}dx($),(q1&6)===0&&(gE=Xe()+500,pA(0))}}break;case 31:case 13:i0=sx($,2),i0!==null&&Pv(i0,$,2),vE(),Mw($,2)}if($=Cw(D),$===null&&dw(c,p,D,IE,C),$===G)break;G=$}G!==null&&D.stopPropagation()}else dw(c,p,D,null,C)}}function Cw(c){return c=Sv(c),Tw(c)}var IE=null;function Tw(c){if(IE=null,c=r1(c),c!==null){var p=s(c);if(p===null)c=null;else{var C=p.tag;if(C===13){if(c=o(p),c!==null)return c;c=null}else if(C===31){if(c=a(p),c!==null)return c;c=null}else if(C===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;c=null}else p!==c&&(c=null)}}return IE=c,null}function l3(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(d0()){case w0:return 2;case Q:return 8;case it:case ec:return 32;case a0:return 268435456;default:return 32}default:return 32}}var Rw=!1,l2=null,c2=null,u2=null,bA=new Map,SA=new Map,h2=[],bR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function c3(c,p){switch(c){case"focusin":case"focusout":l2=null;break;case"dragenter":case"dragleave":c2=null;break;case"mouseover":case"mouseout":u2=null;break;case"pointerover":case"pointerout":bA.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":SA.delete(p.pointerId)}}function AA(c,p,C,D,G,$){return c===null||c.nativeEvent!==$?(c={blockedOn:p,domEventName:C,eventSystemFlags:D,nativeEvent:$,targetContainers:[G]},p!==null&&(p=h1(p),p!==null&&a3(p)),c):(c.eventSystemFlags|=D,p=c.targetContainers,G!==null&&p.indexOf(G)===-1&&p.push(G),c)}function SR(c,p,C,D,G){switch(p){case"focusin":return l2=AA(l2,c,p,C,D,G),!0;case"dragenter":return c2=AA(c2,c,p,C,D,G),!0;case"mouseover":return u2=AA(u2,c,p,C,D,G),!0;case"pointerover":var $=G.pointerId;return bA.set($,AA(bA.get($)||null,c,p,C,D,G)),!0;case"gotpointercapture":return $=G.pointerId,SA.set($,AA(SA.get($)||null,c,p,C,D,G)),!0}return!1}function u3(c){var p=r1(c.target);if(p!==null){var C=s(p);if(C!==null){if(p=C.tag,p===13){if(p=o(C),p!==null){c.blockedOn=p,X0(c.priority,function(){o3(C)});return}}else if(p===31){if(p=a(C),p!==null){c.blockedOn=p,X0(c.priority,function(){o3(C)});return}}else if(p===3&&C.stateNode.current.memoizedState.isDehydrated){c.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}c.blockedOn=null}function BE(c){if(c.blockedOn!==null)return!1;for(var p=c.targetContainers;0<p.length;){var C=Cw(c.nativeEvent);if(C===null){C=c.nativeEvent;var D=new C.constructor(C.type,C);nx=D,C.target.dispatchEvent(D),nx=null}else return p=h1(C),p!==null&&a3(p),c.blockedOn=C,!1;p.shift()}return!0}function h3(c,p,C){BE(c)&&C.delete(p)}function AR(){Rw=!1,l2!==null&&BE(l2)&&(l2=null),c2!==null&&BE(c2)&&(c2=null),u2!==null&&BE(u2)&&(u2=null),bA.forEach(h3),SA.forEach(h3)}function NE(c,p){c.blockedOn===p&&(c.blockedOn=null,Rw||(Rw=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,AR)))}var zE=null;function d3(c){zE!==c&&(zE=c,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){zE===c&&(zE=null);for(var p=0;p<c.length;p+=3){var C=c[p],D=c[p+1],G=c[p+2];if(typeof D!="function"){if(Tw(D||C)===null)continue;break}var $=h1(C);$!==null&&(c.splice(p,3),p-=3,CM($,{pending:!0,data:G,method:C.method,action:D},D,G))}}))}function MS(c){function p(D0){return NE(D0,c)}l2!==null&&NE(l2,c),c2!==null&&NE(c2,c),u2!==null&&NE(u2,c),bA.forEach(p),SA.forEach(p);for(var C=0;C<h2.length;C++){var D=h2[C];D.blockedOn===c&&(D.blockedOn=null)}for(;0<h2.length&&(C=h2[0],C.blockedOn===null);)u3(C),C.blockedOn===null&&h2.shift();if(C=(c.ownerDocument||c).$$reactFormReplay,C!=null)for(D=0;D<C.length;D+=3){var G=C[D],$=C[D+1],tt=G[u1]||null;if(typeof $=="function")tt||d3(C);else if(tt){var i0=null;if($&&$.hasAttribute("formAction")){if(G=$,tt=$[u1]||null)i0=tt.formAction;else if(Tw(G)!==null)continue}else i0=tt.action;typeof i0=="function"?C[D+1]=i0:(C.splice(D,3),D-=3),d3(C)}}}function f3(){function c($){$.canIntercept&&$.info==="react-transition"&&$.intercept({handler:function(){return new Promise(function(tt){return G=tt})},focusReset:"manual",scroll:"manual"})}function p(){G!==null&&(G(),G=null),D||setTimeout(C,20)}function C(){if(!D&&!navigation.transition){var $=navigation.currentEntry;$&&$.url!=null&&navigation.navigate($.url,{state:$.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var D=!1,G=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",p),navigation.addEventListener("navigateerror",p),setTimeout(C,100),function(){D=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",p),navigation.removeEventListener("navigateerror",p),G!==null&&(G(),G=null)}}}function Dw(c){this._internalRoot=c}FE.prototype.render=Dw.prototype.render=function(c){var p=this._internalRoot;if(p===null)throw Error(n(409));var C=p.current,D=zv();r3(C,D,c,p,null,null)},FE.prototype.unmount=Dw.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var p=c.containerInfo;r3(c.current,2,null,c,null,null),vE(),p[e1]=null}};function FE(c){this._internalRoot=c}FE.prototype.unstable_scheduleHydration=function(c){if(c){var p=A0();c={blockedOn:null,target:c,priority:p};for(var C=0;C<h2.length&&p!==0&&p<h2[C].priority;C++);h2.splice(C,0,c),C===0&&u3(c)}};var p3=e.version;if(p3!=="19.2.0")throw Error(n(527,p3,"19.2.0"));U.findDOMNode=function(c){var p=c._reactInternals;if(p===void 0)throw typeof c.render=="function"?Error(n(188)):(c=Object.keys(c).join(","),Error(n(268,c)));return c=d(p),c=c!==null?u(c):null,c=c===null?null:c.stateNode,c};var ER={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:k,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var UE=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!UE.isDisabled&&UE.supportsFiber)try{O0=UE.inject(ER),He=UE}catch{}}return reactDomClient_production.createRoot=function(c,p){if(!i(c))throw Error(n(299));var C=!1,D="",G=bC,$=SC,tt=AC;return p!=null&&(p.unstable_strictMode===!0&&(C=!0),p.identifierPrefix!==void 0&&(D=p.identifierPrefix),p.onUncaughtError!==void 0&&(G=p.onUncaughtError),p.onCaughtError!==void 0&&($=p.onCaughtError),p.onRecoverableError!==void 0&&(tt=p.onRecoverableError)),p=n3(c,1,!1,null,null,C,D,null,G,$,tt,f3),c[e1]=p.current,hw(c),new Dw(p)},reactDomClient_production.hydrateRoot=function(c,p,C){if(!i(c))throw Error(n(299));var D=!1,G="",$=bC,tt=SC,i0=AC,D0=null;return C!=null&&(C.unstable_strictMode===!0&&(D=!0),C.identifierPrefix!==void 0&&(G=C.identifierPrefix),C.onUncaughtError!==void 0&&($=C.onUncaughtError),C.onCaughtError!==void 0&&(tt=C.onCaughtError),C.onRecoverableError!==void 0&&(i0=C.onRecoverableError),C.formState!==void 0&&(D0=C.formState)),p=n3(c,1,!0,p,C??null,D,G,D0,$,tt,i0,f3),p.context=i3(null),C=p.current,D=zv(),D=f0(D),G=H1(D),G.callback=null,P1(C,G,D),C=D,p.current.lanes=C,Z(p,C),dx(p),c[e1]=p.current,hw(c),new FE(p)},reactDomClient_production.version="19.2.0",reactDomClient_production}var hasRequiredClient;function requireClient(){if(hasRequiredClient)return client.exports;hasRequiredClient=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),client.exports=requireReactDomClient_production(),client.exports}var clientExports=requireClient();const REVISION="158",CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipmapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipmapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,AlphaFormat=1021,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LinearEncoding=3e3,sRGBEncoding=3001,BasicDepthPacking=3200,RGBADepthPacking=3201,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",DisplayP3ColorSpace="display-p3",LinearDisplayP3ColorSpace="display-p3-linear",LinearTransfer="linear",SRGBTransfer="srgb",Rec709Primaries="rec709",P3Primaries="p3",KeepStencilOp=7680,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,GLSL3="300 es",_SRGBAFormat=1035,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(_lut[r&255]+_lut[r>>8&255]+_lut[r>>16&255]+_lut[r>>24&255]+"-"+_lut[e&255]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[t&63|128]+_lut[t>>8&255]+"-"+_lut[t>>16&255]+_lut[t>>24&255]+_lut[n&255]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]).toLowerCase()}function clamp(r,e,t){return Math.max(e,Math.min(t,r))}function euclideanModulo(r,e){return(r%e+e)%e}function lerp(r,e,t){return(1-t)*r+t*e}function isPowerOfTwo(r){return(r&r-1)===0&&r!==0}function floorPowerOfTwo(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function denormalize(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function normalize$1(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}class Vector2{constructor(e=0,t=0){Vector2.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*i+e.x,this.y=s*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(e,t,n,i,s,o,a,l,d){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,o,a,l,d)}set(e,t,n,i,s,o,a,l,d){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=n,u[7]=o,u[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],a=n[3],l=n[6],d=n[1],u=n[4],g=n[7],x=n[2],y=n[5],b=n[8],_=i[0],h=i[3],f=i[6],E=i[1],m=i[4],S=i[7],w=i[2],v=i[5],A=i[8];return s[0]=o*_+a*E+l*w,s[3]=o*h+a*m+l*v,s[6]=o*f+a*S+l*A,s[1]=d*_+u*E+g*w,s[4]=d*h+u*m+g*v,s[7]=d*f+u*S+g*A,s[2]=x*_+y*E+b*w,s[5]=x*h+y*m+b*v,s[8]=x*f+y*S+b*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],d=e[7],u=e[8];return t*o*u-t*a*d-n*s*u+n*a*l+i*s*d-i*o*l}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],d=e[7],u=e[8],g=u*o-a*d,x=a*l-u*s,y=d*s-o*l,b=t*g+n*x+i*y;if(b===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/b;return e[0]=g*_,e[1]=(i*d-u*n)*_,e[2]=(a*n-i*o)*_,e[3]=x*_,e[4]=(u*t-i*l)*_,e[5]=(i*s-a*t)*_,e[6]=y*_,e[7]=(n*l-d*t)*_,e[8]=(o*t-n*s)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,o,a){const l=Math.cos(s),d=Math.sin(s);return this.set(n*l,n*d,-n*(l*o+d*a)+o+e,-i*d,i*l,-i*(-d*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(_m3.makeScale(e,t)),this}rotate(e){return this.premultiply(_m3.makeRotation(-e)),this}translate(e,t){return this.premultiply(_m3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function createElementNS(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function createCanvasElement(){const r=createElementNS("canvas");return r.style.display="block",r}const _cache={};function warnOnce(r){r in _cache||(_cache[r]=!0,console.warn(r))}const LINEAR_SRGB_TO_LINEAR_DISPLAY_P3=new Matrix3().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),LINEAR_DISPLAY_P3_TO_LINEAR_SRGB=new Matrix3().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),COLOR_SPACES={[LinearSRGBColorSpace]:{transfer:LinearTransfer,primaries:Rec709Primaries,toReference:r=>r,fromReference:r=>r},[SRGBColorSpace]:{transfer:SRGBTransfer,primaries:Rec709Primaries,toReference:r=>r.convertSRGBToLinear(),fromReference:r=>r.convertLinearToSRGB()},[LinearDisplayP3ColorSpace]:{transfer:LinearTransfer,primaries:P3Primaries,toReference:r=>r.applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:r=>r.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3)},[DisplayP3ColorSpace]:{transfer:SRGBTransfer,primaries:P3Primaries,toReference:r=>r.convertSRGBToLinear().applyMatrix3(LINEAR_DISPLAY_P3_TO_LINEAR_SRGB),fromReference:r=>r.applyMatrix3(LINEAR_SRGB_TO_LINEAR_DISPLAY_P3).convertLinearToSRGB()}},SUPPORTED_WORKING_COLOR_SPACES=new Set([LinearSRGBColorSpace,LinearDisplayP3ColorSpace]),ColorManagement={enabled:!0,_workingColorSpace:LinearSRGBColorSpace,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(r){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!r},get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(r){if(!SUPPORTED_WORKING_COLOR_SPACES.has(r))throw new Error(`Unsupported working color space, "${r}".`);this._workingColorSpace=r},convert:function(r,e,t){if(this.enabled===!1||e===t||!e||!t)return r;const n=COLOR_SPACES[e].toReference,i=COLOR_SPACES[t].fromReference;return i(n(r))},fromWorkingColorSpace:function(r,e){return this.convert(r,this._workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this._workingColorSpace)},getPrimaries:function(r){return COLOR_SPACES[r].primaries},getTransfer:function(r){return r===NoColorSpace?LinearTransfer:COLOR_SPACES[r].transfer}};function SRGBToLinear(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function LinearToSRGB(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let _canvas;class ImageUtils{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=e.width,_canvas.height=e.height;const n=_canvas.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=_canvas}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=createElementNS("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=SRGBToLinear(s[o]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(SRGBToLinear(t[n]/255)*255):t[n]=SRGBToLinear(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let _sourceId=0;class Source{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?s.push(serializeImage(i[o].image)):s.push(serializeImage(i[o]))}else s=serializeImage(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function serializeImage(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?ImageUtils.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,n=ClampToEdgeWrapping,i=ClampToEdgeWrapping,s=LinearFilter,o=LinearMipmapLinearFilter,a=RGBAFormat,l=UnsignedByteType,d=Texture.DEFAULT_ANISOTROPY,u=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=d,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==UVMapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case RepeatWrapping:e.x=e.x-Math.floor(e.x);break;case ClampToEdgeWrapping:e.x=e.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case RepeatWrapping:e.y=e.y-Math.floor(e.y);break;case ClampToEdgeWrapping:e.y=e.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set encoding(e){warnOnce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===sRGBEncoding?SRGBColorSpace:NoColorSpace}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(e=0,t=0,n=0,i=1){Vector4.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const l=e.elements,d=l[0],u=l[4],g=l[8],x=l[1],y=l[5],b=l[9],_=l[2],h=l[6],f=l[10];if(Math.abs(u-x)<.01&&Math.abs(g-_)<.01&&Math.abs(b-h)<.01){if(Math.abs(u+x)<.1&&Math.abs(g+_)<.1&&Math.abs(b+h)<.1&&Math.abs(d+y+f-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const m=(d+1)/2,S=(y+1)/2,w=(f+1)/2,v=(u+x)/4,A=(g+_)/4,M=(b+h)/4;return m>S&&m>w?m<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(m),i=v/n,s=A/n):S>w?S<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(S),n=v/i,s=M/i):w<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(w),n=A/s,i=M/s),this.set(n,i,s,t),this}let E=Math.sqrt((h-b)*(h-b)+(g-_)*(g-_)+(x-u)*(x-u));return Math.abs(E)<.001&&(E=1),this.x=(h-b)/E,this.y=(g-_)/E,this.z=(x-u)/E,this.w=Math.acos((d+y+f-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t);const i={width:e,height:t,depth:1};n.encoding!==void 0&&(warnOnce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},n),this.texture=new Texture(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps,this.texture.internalFormat=n.internalFormat,this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.depthTexture=n.depthTexture,this.samples=n.samples}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new Source(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Data3DTexture extends Texture{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Quaternion{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,o,a){let l=n[i+0],d=n[i+1],u=n[i+2],g=n[i+3];const x=s[o+0],y=s[o+1],b=s[o+2],_=s[o+3];if(a===0){e[t+0]=l,e[t+1]=d,e[t+2]=u,e[t+3]=g;return}if(a===1){e[t+0]=x,e[t+1]=y,e[t+2]=b,e[t+3]=_;return}if(g!==_||l!==x||d!==y||u!==b){let h=1-a;const f=l*x+d*y+u*b+g*_,E=f>=0?1:-1,m=1-f*f;if(m>Number.EPSILON){const w=Math.sqrt(m),v=Math.atan2(w,f*E);h=Math.sin(h*v)/w,a=Math.sin(a*v)/w}const S=a*E;if(l=l*h+x*S,d=d*h+y*S,u=u*h+b*S,g=g*h+_*S,h===1-a){const w=1/Math.sqrt(l*l+d*d+u*u+g*g);l*=w,d*=w,u*=w,g*=w}}e[t]=l,e[t+1]=d,e[t+2]=u,e[t+3]=g}static multiplyQuaternionsFlat(e,t,n,i,s,o){const a=n[i],l=n[i+1],d=n[i+2],u=n[i+3],g=s[o],x=s[o+1],y=s[o+2],b=s[o+3];return e[t]=a*b+u*g+l*y-d*x,e[t+1]=l*b+u*x+d*g-a*y,e[t+2]=d*b+u*y+a*x-l*g,e[t+3]=u*b-a*g-l*x-d*y,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const n=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,d=a(n/2),u=a(i/2),g=a(s/2),x=l(n/2),y=l(i/2),b=l(s/2);switch(o){case"XYZ":this._x=x*u*g+d*y*b,this._y=d*y*g-x*u*b,this._z=d*u*b+x*y*g,this._w=d*u*g-x*y*b;break;case"YXZ":this._x=x*u*g+d*y*b,this._y=d*y*g-x*u*b,this._z=d*u*b-x*y*g,this._w=d*u*g+x*y*b;break;case"ZXY":this._x=x*u*g-d*y*b,this._y=d*y*g+x*u*b,this._z=d*u*b+x*y*g,this._w=d*u*g-x*y*b;break;case"ZYX":this._x=x*u*g-d*y*b,this._y=d*y*g+x*u*b,this._z=d*u*b-x*y*g,this._w=d*u*g+x*y*b;break;case"YZX":this._x=x*u*g+d*y*b,this._y=d*y*g+x*u*b,this._z=d*u*b-x*y*g,this._w=d*u*g-x*y*b;break;case"XZY":this._x=x*u*g-d*y*b,this._y=d*y*g-x*u*b,this._z=d*u*b+x*y*g,this._w=d*u*g+x*y*b;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],o=t[1],a=t[5],l=t[9],d=t[2],u=t[6],g=t[10],x=n+a+g;if(x>0){const y=.5/Math.sqrt(x+1);this._w=.25/y,this._x=(u-l)*y,this._y=(s-d)*y,this._z=(o-i)*y}else if(n>a&&n>g){const y=2*Math.sqrt(1+n-a-g);this._w=(u-l)/y,this._x=.25*y,this._y=(i+o)/y,this._z=(s+d)/y}else if(a>g){const y=2*Math.sqrt(1+a-n-g);this._w=(s-d)/y,this._x=(i+o)/y,this._y=.25*y,this._z=(l+u)/y}else{const y=2*Math.sqrt(1+g-n-a);this._w=(o-i)/y,this._x=(s+d)/y,this._y=(l+u)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,o=e._w,a=t._x,l=t._y,d=t._z,u=t._w;return this._x=n*u+o*a+i*d-s*l,this._y=i*u+o*l+s*a-n*d,this._z=s*u+o*d+n*l-i*a,this._w=o*u-n*a-i*l-s*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+n*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=i,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const y=1-t;return this._w=y*o+t*this._w,this._x=y*n+t*this._x,this._y=y*i+t*this._y,this._z=y*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const d=Math.sqrt(l),u=Math.atan2(d,a),g=Math.sin((1-t)*u)/d,x=Math.sin(t*u)/d;return this._w=o*g+this._w*x,this._x=n*g+this._x*x,this._y=i*g+this._y*x,this._z=s*g+this._z*x,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(i),n*Math.sin(s),n*Math.cos(s),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(e=0,t=0,n=0){Vector3.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_quaternion$4.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,a=e.z,l=e.w,d=2*(o*i-a*n),u=2*(a*t-s*i),g=2*(s*n-o*t);return this.x=t+l*d+o*g-a*u,this.y=n+l*u+a*d-s*g,this.z=i+l*g+s*u-o*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=i*l-s*a,this.y=s*o-n*l,this.z=n*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return _vector$b.copy(this).projectOnVector(e),this.sub(_vector$b)}reflect(e){return this.sub(_vector$b.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(clamp(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$b=new Vector3,_quaternion$4=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(_vector$a.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(_vector$a.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=_vector$a.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,_vector$a):_vector$a.fromBufferAttribute(s,o),_vector$a.applyMatrix4(e.matrixWorld),this.expandByPoint(_vector$a);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),_box$3.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),_box$3.copy(n.boundingBox)),_box$3.applyMatrix4(e.matrixWorld),this.union(_box$3)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,_vector$a),_vector$a.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(_center),_extents.subVectors(this.max,_center),_v0$2.subVectors(e.a,_center),_v1$7.subVectors(e.b,_center),_v2$4.subVectors(e.c,_center),_f0.subVectors(_v1$7,_v0$2),_f1.subVectors(_v2$4,_v1$7),_f2.subVectors(_v0$2,_v2$4);let t=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(t,_v0$2,_v1$7,_v2$4,_extents)||(t=[1,0,0,0,1,0,0,0,1],!satForAxes(t,_v0$2,_v1$7,_v2$4,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),t=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(t,_v0$2,_v1$7,_v2$4,_extents))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_vector$a).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_vector$a).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(_points),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const _points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],_vector$a=new Vector3,_box$3=new Box3,_v0$2=new Vector3,_v1$7=new Vector3,_v2$4=new Vector3,_f0=new Vector3,_f1=new Vector3,_f2=new Vector3,_center=new Vector3,_extents=new Vector3,_triangleNormal=new Vector3,_testAxis=new Vector3;function satForAxes(r,e,t,n,i){for(let s=0,o=r.length-3;s<=o;s+=3){_testAxis.fromArray(r,s);const a=i.x*Math.abs(_testAxis.x)+i.y*Math.abs(_testAxis.y)+i.z*Math.abs(_testAxis.z),l=e.dot(_testAxis),d=t.dot(_testAxis),u=n.dot(_testAxis);if(Math.max(-Math.max(l,d,u),Math.min(l,d,u))>a)return!1}return!0}const _box$2=new Box3,_v1$6=new Vector3,_v2$3=new Vector3;class Sphere{constructor(e=new Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):_box$2.setFromPoints(e).getCenter(n);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;_v1$6.subVectors(e,this.center);const t=_v1$6.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(_v1$6,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(_v2$3.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(_v1$6.copy(e.center).add(_v2$3)),this.expandByPoint(_v1$6.copy(e.center).sub(_v2$3))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$9=new Vector3,_segCenter=new Vector3,_segDir=new Vector3,_diff=new Vector3,_edge1=new Vector3,_edge2=new Vector3,_normal$1=new Vector3;class Ray{constructor(e=new Vector3,t=new Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_vector$9)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=_vector$9.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_vector$9.copy(this.origin).addScaledVector(this.direction,t),_vector$9.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){_segCenter.copy(e).add(t).multiplyScalar(.5),_segDir.copy(t).sub(e).normalize(),_diff.copy(this.origin).sub(_segCenter);const s=e.distanceTo(t)*.5,o=-this.direction.dot(_segDir),a=_diff.dot(this.direction),l=-_diff.dot(_segDir),d=_diff.lengthSq(),u=Math.abs(1-o*o);let g,x,y,b;if(u>0)if(g=o*l-a,x=o*a-l,b=s*u,g>=0)if(x>=-b)if(x<=b){const _=1/u;g*=_,x*=_,y=g*(g+o*x+2*a)+x*(o*g+x+2*l)+d}else x=s,g=Math.max(0,-(o*x+a)),y=-g*g+x*(x+2*l)+d;else x=-s,g=Math.max(0,-(o*x+a)),y=-g*g+x*(x+2*l)+d;else x<=-b?(g=Math.max(0,-(-o*s+a)),x=g>0?-s:Math.min(Math.max(-s,-l),s),y=-g*g+x*(x+2*l)+d):x<=b?(g=0,x=Math.min(Math.max(-s,-l),s),y=x*(x+2*l)+d):(g=Math.max(0,-(o*s+a)),x=g>0?s:Math.min(Math.max(-s,-l),s),y=-g*g+x*(x+2*l)+d);else x=o>0?-s:s,g=Math.max(0,-(o*x+a)),y=-g*g+x*(x+2*l)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,g),i&&i.copy(_segCenter).addScaledVector(_segDir,x),y}intersectSphere(e,t){_vector$9.subVectors(e.center,this.origin);const n=_vector$9.dot(this.direction),i=_vector$9.dot(_vector$9)-n*n,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,o,a,l;const d=1/this.direction.x,u=1/this.direction.y,g=1/this.direction.z,x=this.origin;return d>=0?(n=(e.min.x-x.x)*d,i=(e.max.x-x.x)*d):(n=(e.max.x-x.x)*d,i=(e.min.x-x.x)*d),u>=0?(s=(e.min.y-x.y)*u,o=(e.max.y-x.y)*u):(s=(e.max.y-x.y)*u,o=(e.min.y-x.y)*u),n>o||s>i||((s>n||isNaN(n))&&(n=s),(o<i||isNaN(i))&&(i=o),g>=0?(a=(e.min.z-x.z)*g,l=(e.max.z-x.z)*g):(a=(e.max.z-x.z)*g,l=(e.min.z-x.z)*g),n>l||a>i)||((a>n||n!==n)&&(n=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,_vector$9)!==null}intersectTriangle(e,t,n,i,s){_edge1.subVectors(t,e),_edge2.subVectors(n,e),_normal$1.crossVectors(_edge1,_edge2);let o=this.direction.dot(_normal$1),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;_diff.subVectors(this.origin,e);const l=a*this.direction.dot(_edge2.crossVectors(_diff,_edge2));if(l<0)return null;const d=a*this.direction.dot(_edge1.cross(_diff));if(d<0||l+d>o)return null;const u=-a*_diff.dot(_normal$1);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Matrix4{constructor(e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h)}set(e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h){const f=this.elements;return f[0]=e,f[4]=t,f[8]=n,f[12]=i,f[1]=s,f[5]=o,f[9]=a,f[13]=l,f[2]=d,f[6]=u,f[10]=g,f[14]=x,f[3]=y,f[7]=b,f[11]=_,f[15]=h,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/_v1$5.setFromMatrixColumn(e,0).length(),s=1/_v1$5.setFromMatrixColumn(e,1).length(),o=1/_v1$5.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(i),d=Math.sin(i),u=Math.cos(s),g=Math.sin(s);if(e.order==="XYZ"){const x=o*u,y=o*g,b=a*u,_=a*g;t[0]=l*u,t[4]=-l*g,t[8]=d,t[1]=y+b*d,t[5]=x-_*d,t[9]=-a*l,t[2]=_-x*d,t[6]=b+y*d,t[10]=o*l}else if(e.order==="YXZ"){const x=l*u,y=l*g,b=d*u,_=d*g;t[0]=x+_*a,t[4]=b*a-y,t[8]=o*d,t[1]=o*g,t[5]=o*u,t[9]=-a,t[2]=y*a-b,t[6]=_+x*a,t[10]=o*l}else if(e.order==="ZXY"){const x=l*u,y=l*g,b=d*u,_=d*g;t[0]=x-_*a,t[4]=-o*g,t[8]=b+y*a,t[1]=y+b*a,t[5]=o*u,t[9]=_-x*a,t[2]=-o*d,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const x=o*u,y=o*g,b=a*u,_=a*g;t[0]=l*u,t[4]=b*d-y,t[8]=x*d+_,t[1]=l*g,t[5]=_*d+x,t[9]=y*d-b,t[2]=-d,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const x=o*l,y=o*d,b=a*l,_=a*d;t[0]=l*u,t[4]=_-x*g,t[8]=b*g+y,t[1]=g,t[5]=o*u,t[9]=-a*u,t[2]=-d*u,t[6]=y*g+b,t[10]=x-_*g}else if(e.order==="XZY"){const x=o*l,y=o*d,b=a*l,_=a*d;t[0]=l*u,t[4]=-g,t[8]=d*u,t[1]=x*g+_,t[5]=o*u,t[9]=y*g-b,t[2]=b*g-y,t[6]=a*u,t[10]=_*g+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,t,n){const i=this.elements;return _z.subVectors(e,t),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(n,_z),_x.lengthSq()===0&&(Math.abs(n.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(n,_z)),_x.normalize(),_y$1.crossVectors(_z,_x),i[0]=_x.x,i[4]=_y$1.x,i[8]=_z.x,i[1]=_x.y,i[5]=_y$1.y,i[9]=_z.y,i[2]=_x.z,i[6]=_y$1.z,i[10]=_z.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],a=n[4],l=n[8],d=n[12],u=n[1],g=n[5],x=n[9],y=n[13],b=n[2],_=n[6],h=n[10],f=n[14],E=n[3],m=n[7],S=n[11],w=n[15],v=i[0],A=i[4],M=i[8],T=i[12],R=i[1],P=i[5],L=i[9],O=i[13],I=i[2],N=i[6],k=i[10],U=i[14],F=i[3],j=i[7],H=i[11],B=i[15];return s[0]=o*v+a*R+l*I+d*F,s[4]=o*A+a*P+l*N+d*j,s[8]=o*M+a*L+l*k+d*H,s[12]=o*T+a*O+l*U+d*B,s[1]=u*v+g*R+x*I+y*F,s[5]=u*A+g*P+x*N+y*j,s[9]=u*M+g*L+x*k+y*H,s[13]=u*T+g*O+x*U+y*B,s[2]=b*v+_*R+h*I+f*F,s[6]=b*A+_*P+h*N+f*j,s[10]=b*M+_*L+h*k+f*H,s[14]=b*T+_*O+h*U+f*B,s[3]=E*v+m*R+S*I+w*F,s[7]=E*A+m*P+S*N+w*j,s[11]=E*M+m*L+S*k+w*H,s[15]=E*T+m*O+S*U+w*B,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],o=e[1],a=e[5],l=e[9],d=e[13],u=e[2],g=e[6],x=e[10],y=e[14],b=e[3],_=e[7],h=e[11],f=e[15];return b*(+s*l*g-i*d*g-s*a*x+n*d*x+i*a*y-n*l*y)+_*(+t*l*y-t*d*x+s*o*x-i*o*y+i*d*u-s*l*u)+h*(+t*d*g-t*a*y-s*o*g+n*o*y+s*a*u-n*d*u)+f*(-i*a*u-t*l*g+t*a*x+i*o*g-n*o*x+n*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],d=e[7],u=e[8],g=e[9],x=e[10],y=e[11],b=e[12],_=e[13],h=e[14],f=e[15],E=g*h*d-_*x*d+_*l*y-a*h*y-g*l*f+a*x*f,m=b*x*d-u*h*d-b*l*y+o*h*y+u*l*f-o*x*f,S=u*_*d-b*g*d+b*a*y-o*_*y-u*a*f+o*g*f,w=b*g*l-u*_*l-b*a*x+o*_*x+u*a*h-o*g*h,v=t*E+n*m+i*S+s*w;if(v===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/v;return e[0]=E*A,e[1]=(_*x*s-g*h*s-_*i*y+n*h*y+g*i*f-n*x*f)*A,e[2]=(a*h*s-_*l*s+_*i*d-n*h*d-a*i*f+n*l*f)*A,e[3]=(g*l*s-a*x*s-g*i*d+n*x*d+a*i*y-n*l*y)*A,e[4]=m*A,e[5]=(u*h*s-b*x*s+b*i*y-t*h*y-u*i*f+t*x*f)*A,e[6]=(b*l*s-o*h*s-b*i*d+t*h*d+o*i*f-t*l*f)*A,e[7]=(o*x*s-u*l*s+u*i*d-t*x*d-o*i*y+t*l*y)*A,e[8]=S*A,e[9]=(b*g*s-u*_*s-b*n*y+t*_*y+u*n*f-t*g*f)*A,e[10]=(o*_*s-b*a*s+b*n*d-t*_*d-o*n*f+t*a*f)*A,e[11]=(u*a*s-o*g*s-u*n*d+t*g*d+o*n*y-t*a*y)*A,e[12]=w*A,e[13]=(u*_*i-b*g*i+b*n*x-t*_*x-u*n*h+t*g*h)*A,e[14]=(b*a*i-o*_*i-b*n*l+t*_*l+o*n*h-t*a*h)*A,e[15]=(o*g*i-u*a*i+u*n*l-t*g*l-o*n*x+t*a*x)*A,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,o=e.x,a=e.y,l=e.z,d=s*o,u=s*a;return this.set(d*o+n,d*a-i*l,d*l+i*a,0,d*a+i*l,u*a+n,u*l-i*o,0,d*l-i*a,u*l+i*o,s*l*l+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,o){return this.set(1,n,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,d=s+s,u=o+o,g=a+a,x=s*d,y=s*u,b=s*g,_=o*u,h=o*g,f=a*g,E=l*d,m=l*u,S=l*g,w=n.x,v=n.y,A=n.z;return i[0]=(1-(_+f))*w,i[1]=(y+S)*w,i[2]=(b-m)*w,i[3]=0,i[4]=(y-S)*v,i[5]=(1-(x+f))*v,i[6]=(h+E)*v,i[7]=0,i[8]=(b+m)*A,i[9]=(h-E)*A,i[10]=(1-(x+_))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=_v1$5.set(i[0],i[1],i[2]).length();const o=_v1$5.set(i[4],i[5],i[6]).length(),a=_v1$5.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],_m1$2.copy(this);const d=1/s,u=1/o,g=1/a;return _m1$2.elements[0]*=d,_m1$2.elements[1]*=d,_m1$2.elements[2]*=d,_m1$2.elements[4]*=u,_m1$2.elements[5]*=u,_m1$2.elements[6]*=u,_m1$2.elements[8]*=g,_m1$2.elements[9]*=g,_m1$2.elements[10]*=g,t.setFromRotationMatrix(_m1$2),n.x=s,n.y=o,n.z=a,this}makePerspective(e,t,n,i,s,o,a=WebGLCoordinateSystem){const l=this.elements,d=2*s/(t-e),u=2*s/(n-i),g=(t+e)/(t-e),x=(n+i)/(n-i);let y,b;if(a===WebGLCoordinateSystem)y=-(o+s)/(o-s),b=-2*o*s/(o-s);else if(a===WebGPUCoordinateSystem)y=-o/(o-s),b=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=d,l[4]=0,l[8]=g,l[12]=0,l[1]=0,l[5]=u,l[9]=x,l[13]=0,l[2]=0,l[6]=0,l[10]=y,l[14]=b,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,s,o,a=WebGLCoordinateSystem){const l=this.elements,d=1/(t-e),u=1/(n-i),g=1/(o-s),x=(t+e)*d,y=(n+i)*u;let b,_;if(a===WebGLCoordinateSystem)b=(o+s)*g,_=-2*g;else if(a===WebGPUCoordinateSystem)b=s*g,_=-1*g;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*d,l[4]=0,l[8]=0,l[12]=-x,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-y,l[2]=0,l[6]=0,l[10]=_,l[14]=-b,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const _v1$5=new Vector3,_m1$2=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y$1=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion$3=new Quaternion;class Euler{constructor(e=0,t=0,n=0,i=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],l=i[1],d=i[5],u=i[9],g=i[2],x=i[6],y=i[10];switch(t){case"XYZ":this._y=Math.asin(clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,y),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(x,d),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,y),this._z=Math.atan2(l,d)):(this._y=Math.atan2(-g,s),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(-g,y),this._z=Math.atan2(-o,d)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-clamp(g,-1,1)),Math.abs(g)<.9999999?(this._x=Math.atan2(x,y),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,d));break;case"YZX":this._z=Math.asin(clamp(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,d),this._y=Math.atan2(-g,s)):(this._x=0,this._y=Math.atan2(a,y));break;case"XZY":this._z=Math.asin(-clamp(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(x,d),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,y),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return _matrix.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _quaternion$3.setFromEuler(this),this.setFromQuaternion(_quaternion$3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let _object3DId=0;const _v1$4=new Vector3,_q1=new Quaternion,_m1$1=new Matrix4,_target=new Vector3,_position$3=new Vector3,_scale$2=new Vector3,_quaternion$2=new Quaternion,_xAxis=new Vector3(1,0,0),_yAxis=new Vector3(0,1,0),_zAxis=new Vector3(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const e=new Vector3,t=new Euler,n=new Quaternion,i=new Vector3(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(e,t){return _q1.setFromAxisAngle(e,t),this.quaternion.premultiply(_q1),this}rotateX(e){return this.rotateOnAxis(_xAxis,e)}rotateY(e){return this.rotateOnAxis(_yAxis,e)}rotateZ(e){return this.rotateOnAxis(_zAxis,e)}translateOnAxis(e,t){return _v1$4.copy(e).applyQuaternion(this.quaternion),this.position.add(_v1$4.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(_xAxis,e)}translateY(e){return this.translateOnAxis(_yAxis,e)}translateZ(e){return this.translateOnAxis(_zAxis,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(_m1$1.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?_target.copy(e):_target.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$1.lookAt(_position$3,_target,this.up):_m1$1.lookAt(_target,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$1),i&&(_m1$1.extractRotation(i.matrixWorld),_q1.setFromRotationMatrix(_m1$1),this.quaternion.premultiply(_q1.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(_addedEvent)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(_removedEvent)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),_m1$1.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),_m1$1.multiply(e.parent.matrixWorld)),e.applyMatrix4(_m1$1),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t){let n=[];this[e]===t&&n.push(this);for(let i=0,s=this.children.length;i<s;i++){const o=this.children[i].getObjectsByProperty(e,t);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,e,_scale$2),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++){const s=t[n];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++){const a=i[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let d=0,u=l.length;d<u;d++){const g=l[d];s(e.shapes,g)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,d=this.material.length;l<d;l++)a.push(s(e.materials,this.material[l]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),d=o(e.textures),u=o(e.images),g=o(e.shapes),x=o(e.skeletons),y=o(e.animations),b=o(e.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),d.length>0&&(n.textures=d),u.length>0&&(n.images=u),g.length>0&&(n.shapes=g),x.length>0&&(n.skeletons=x),y.length>0&&(n.animations=y),b.length>0&&(n.nodes=b)}return n.object=i,n;function o(a){const l=[];for(const d in a){const u=a[d];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Object3D.DEFAULT_UP=new Vector3(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$1=new Vector3,_v1$3=new Vector3,_v2$2=new Vector3,_v3$1=new Vector3,_vab=new Vector3,_vac=new Vector3,_vbc=new Vector3,_vap=new Vector3,_vbp=new Vector3,_vcp=new Vector3;let warnedGetUV=!1;class Triangle{constructor(e=new Vector3,t=new Vector3,n=new Vector3){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),_v0$1.subVectors(e,t),i.cross(_v0$1);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){_v0$1.subVectors(i,t),_v1$3.subVectors(n,t),_v2$2.subVectors(e,t);const o=_v0$1.dot(_v0$1),a=_v0$1.dot(_v1$3),l=_v0$1.dot(_v2$2),d=_v1$3.dot(_v1$3),u=_v1$3.dot(_v2$2),g=o*d-a*a;if(g===0)return s.set(-2,-1,-1);const x=1/g,y=(d*l-a*u)*x,b=(o*u-a*l)*x;return s.set(1-y-b,b,y)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,_v3$1),_v3$1.x>=0&&_v3$1.y>=0&&_v3$1.x+_v3$1.y<=1}static getUV(e,t,n,i,s,o,a,l){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),this.getInterpolation(e,t,n,i,s,o,a,l)}static getInterpolation(e,t,n,i,s,o,a,l){return this.getBarycoord(e,t,n,i,_v3$1),l.setScalar(0),l.addScaledVector(s,_v3$1.x),l.addScaledVector(o,_v3$1.y),l.addScaledVector(a,_v3$1.z),l}static isFrontFacing(e,t,n,i){return _v0$1.subVectors(n,t),_v1$3.subVectors(e,t),_v0$1.cross(_v1$3).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return _v0$1.subVectors(this.c,this.b),_v1$3.subVectors(this.a,this.b),_v0$1.cross(_v1$3).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,i,s){return warnedGetUV===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),warnedGetUV=!0),Triangle.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}getInterpolation(e,t,n,i,s){return Triangle.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let o,a;_vab.subVectors(i,n),_vac.subVectors(s,n),_vap.subVectors(e,n);const l=_vab.dot(_vap),d=_vac.dot(_vap);if(l<=0&&d<=0)return t.copy(n);_vbp.subVectors(e,i);const u=_vab.dot(_vbp),g=_vac.dot(_vbp);if(u>=0&&g<=u)return t.copy(i);const x=l*g-u*d;if(x<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(n).addScaledVector(_vab,o);_vcp.subVectors(e,s);const y=_vab.dot(_vcp),b=_vac.dot(_vcp);if(b>=0&&y<=b)return t.copy(s);const _=y*d-l*b;if(_<=0&&d>=0&&b<=0)return a=d/(d-b),t.copy(n).addScaledVector(_vac,a);const h=u*b-y*g;if(h<=0&&g-u>=0&&y-b>=0)return _vbc.subVectors(s,i),a=(g-u)/(g-u+(y-b)),t.copy(i).addScaledVector(_vbc,a);const f=1/(h+_+x);return o=_*f,a=x*f,t.copy(n).addScaledVector(_vab,o).addScaledVector(_vac,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class Color{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=SRGBColorSpace){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ColorManagement.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=ColorManagement.workingColorSpace){return this.r=e,this.g=t,this.b=n,ColorManagement.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=ColorManagement.workingColorSpace){if(e=euclideanModulo(e,1),t=clamp(t,0,1),n=clamp(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=hue2rgb(o,s,e+1/3),this.g=hue2rgb(o,s,e),this.b=hue2rgb(o,s,e-1/3)}return ColorManagement.toWorkingColorSpace(this,i),this}setStyle(e,t=SRGBColorSpace){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=SRGBColorSpace){const n=_colorKeywords[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=SRGBToLinear(e.r),this.g=SRGBToLinear(e.g),this.b=SRGBToLinear(e.b),this}copyLinearToSRGB(e){return this.r=LinearToSRGB(e.r),this.g=LinearToSRGB(e.g),this.b=LinearToSRGB(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),e),Math.round(clamp(_color.r*255,0,255))*65536+Math.round(clamp(_color.g*255,0,255))*256+Math.round(clamp(_color.b*255,0,255))}getHexString(e=SRGBColorSpace){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),t);const n=_color.r,i=_color.g,s=_color.b,o=Math.max(n,i,s),a=Math.min(n,i,s);let l,d;const u=(a+o)/2;if(a===o)l=0,d=0;else{const g=o-a;switch(d=u<=.5?g/(o+a):g/(2-o-a),o){case n:l=(i-s)/g+(i<s?6:0);break;case i:l=(s-n)/g+2;break;case s:l=(n-i)/g+4;break}l/=6}return e.h=l,e.s=d,e.l=u,e}getRGB(e,t=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color.copy(this),t),e.r=_color.r,e.g=_color.g,e.b=_color.b,e}getStyle(e=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color.copy(this),e);const t=_color.r,n=_color.g,i=_color.b;return e!==SRGBColorSpace?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(_hslA),this.setHSL(_hslA.h+e,_hslA.s+t,_hslA.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(_hslA),e.getHSL(_hslB);const n=lerp(_hslA.h,_hslB.h,t),i=lerp(_hslA.s,_hslB.s,t),s=lerp(_hslA.l,_hslB.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.type="Material",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(n.blending=this.blending),this.side!==FrontSide&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(n.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(n.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(n.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=i(e.textures),o=i(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class MeshBasicMaterial extends Material{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const _vector$8=new Vector3,_vector2$1=new Vector2;class BufferAttribute{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=StaticDrawUsage,this.updateRange={offset:0,count:-1},this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)_vector2$1.fromBufferAttribute(this,t),_vector2$1.applyMatrix3(e),this.setXY(t,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)_vector$8.fromBufferAttribute(this,t),_vector$8.applyMatrix3(e),this.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)_vector$8.fromBufferAttribute(this,t),_vector$8.applyMatrix4(e),this.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)_vector$8.fromBufferAttribute(this,t),_vector$8.applyNormalMatrix(e),this.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)_vector$8.fromBufferAttribute(this,t),_vector$8.transformDirection(e),this.setXYZ(t,_vector$8.x,_vector$8.y,_vector$8.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=denormalize(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=normalize$1(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=denormalize(t,this.array)),t}setX(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=denormalize(t,this.array)),t}setY(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=denormalize(t,this.array)),t}setZ(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=denormalize(t,this.array)),t}setW(e,t){return this.normalized&&(t=normalize$1(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),n=normalize$1(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),n=normalize$1(n,this.array),i=normalize$1(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=normalize$1(t,this.array),n=normalize$1(n,this.array),i=normalize$1(i,this.array),s=normalize$1(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==StaticDrawUsage&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}}class Uint16BufferAttribute extends BufferAttribute{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Uint32BufferAttribute extends BufferAttribute{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class Float32BufferAttribute extends BufferAttribute{constructor(e,t,n){super(new Float32Array(e),t,n)}}let _id$2=0;const _m1=new Matrix4,_obj=new Object3D,_offset=new Vector3,_box$1=new Box3,_boxMorphTargets=new Box3,_vector$7=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(arrayNeedsUint32(e)?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Matrix3().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return _m1.makeRotationFromQuaternion(e),this.applyMatrix4(_m1),this}rotateX(e){return _m1.makeRotationX(e),this.applyMatrix4(_m1),this}rotateY(e){return _m1.makeRotationY(e),this.applyMatrix4(_m1),this}rotateZ(e){return _m1.makeRotationZ(e),this.applyMatrix4(_m1),this}translate(e,t,n){return _m1.makeTranslation(e,t,n),this.applyMatrix4(_m1),this}scale(e,t,n){return _m1.makeScale(e,t,n),this.applyMatrix4(_m1),this}lookAt(e){return _obj.lookAt(e),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset).negate(),this.translate(_offset.x,_offset.y,_offset.z),this}setFromPoints(e){const t=[];for(let n=0,i=e.length;n<i;n++){const s=e[n];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const s=t[n];_box$1.setFromBufferAttribute(s),this.morphTargetsRelative?(_vector$7.addVectors(this.boundingBox.min,_box$1.min),this.boundingBox.expandByPoint(_vector$7),_vector$7.addVectors(this.boundingBox.max,_box$1.max),this.boundingBox.expandByPoint(_vector$7)):(this.boundingBox.expandByPoint(_box$1.min),this.boundingBox.expandByPoint(_box$1.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new Vector3,1/0);return}if(e){const n=this.boundingSphere.center;if(_box$1.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];_boxMorphTargets.setFromBufferAttribute(a),this.morphTargetsRelative?(_vector$7.addVectors(_box$1.min,_boxMorphTargets.min),_box$1.expandByPoint(_vector$7),_vector$7.addVectors(_box$1.max,_boxMorphTargets.max),_box$1.expandByPoint(_vector$7)):(_box$1.expandByPoint(_boxMorphTargets.min),_box$1.expandByPoint(_boxMorphTargets.max))}_box$1.getCenter(n);let i=0;for(let s=0,o=e.count;s<o;s++)_vector$7.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(_vector$7));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let d=0,u=a.count;d<u;d++)_vector$7.fromBufferAttribute(a,d),l&&(_offset.fromBufferAttribute(e,d),_vector$7.add(_offset)),i=Math.max(i,n.distanceToSquared(_vector$7))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.array,i=t.position.array,s=t.normal.array,o=t.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,d=[],u=[];for(let R=0;R<a;R++)d[R]=new Vector3,u[R]=new Vector3;const g=new Vector3,x=new Vector3,y=new Vector3,b=new Vector2,_=new Vector2,h=new Vector2,f=new Vector3,E=new Vector3;function m(R,P,L){g.fromArray(i,R*3),x.fromArray(i,P*3),y.fromArray(i,L*3),b.fromArray(o,R*2),_.fromArray(o,P*2),h.fromArray(o,L*2),x.sub(g),y.sub(g),_.sub(b),h.sub(b);const O=1/(_.x*h.y-h.x*_.y);isFinite(O)&&(f.copy(x).multiplyScalar(h.y).addScaledVector(y,-_.y).multiplyScalar(O),E.copy(y).multiplyScalar(_.x).addScaledVector(x,-h.x).multiplyScalar(O),d[R].add(f),d[P].add(f),d[L].add(f),u[R].add(E),u[P].add(E),u[L].add(E))}let S=this.groups;S.length===0&&(S=[{start:0,count:n.length}]);for(let R=0,P=S.length;R<P;++R){const L=S[R],O=L.start,I=L.count;for(let N=O,k=O+I;N<k;N+=3)m(n[N+0],n[N+1],n[N+2])}const w=new Vector3,v=new Vector3,A=new Vector3,M=new Vector3;function T(R){A.fromArray(s,R*3),M.copy(A);const P=d[R];w.copy(P),w.sub(A.multiplyScalar(A.dot(P))).normalize(),v.crossVectors(M,P);const O=v.dot(u[R])<0?-1:1;l[R*4]=w.x,l[R*4+1]=w.y,l[R*4+2]=w.z,l[R*4+3]=O}for(let R=0,P=S.length;R<P;++R){const L=S[R],O=L.start,I=L.count;for(let N=O,k=O+I;N<k;N+=3)T(n[N+0]),T(n[N+1]),T(n[N+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new BufferAttribute(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let x=0,y=n.count;x<y;x++)n.setXYZ(x,0,0,0);const i=new Vector3,s=new Vector3,o=new Vector3,a=new Vector3,l=new Vector3,d=new Vector3,u=new Vector3,g=new Vector3;if(e)for(let x=0,y=e.count;x<y;x+=3){const b=e.getX(x+0),_=e.getX(x+1),h=e.getX(x+2);i.fromBufferAttribute(t,b),s.fromBufferAttribute(t,_),o.fromBufferAttribute(t,h),u.subVectors(o,s),g.subVectors(i,s),u.cross(g),a.fromBufferAttribute(n,b),l.fromBufferAttribute(n,_),d.fromBufferAttribute(n,h),a.add(u),l.add(u),d.add(u),n.setXYZ(b,a.x,a.y,a.z),n.setXYZ(_,l.x,l.y,l.z),n.setXYZ(h,d.x,d.y,d.z)}else for(let x=0,y=t.count;x<y;x+=3)i.fromBufferAttribute(t,x+0),s.fromBufferAttribute(t,x+1),o.fromBufferAttribute(t,x+2),u.subVectors(o,s),g.subVectors(i,s),u.cross(g),n.setXYZ(x+0,u.x,u.y,u.z),n.setXYZ(x+1,u.x,u.y,u.z),n.setXYZ(x+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)_vector$7.fromBufferAttribute(e,t),_vector$7.normalize(),e.setXYZ(t,_vector$7.x,_vector$7.y,_vector$7.z)}toNonIndexed(){function e(a,l){const d=a.array,u=a.itemSize,g=a.normalized,x=new d.constructor(l.length*u);let y=0,b=0;for(let _=0,h=l.length;_<h;_++){a.isInterleavedBufferAttribute?y=l[_]*a.data.stride+a.offset:y=l[_]*u;for(let f=0;f<u;f++)x[b++]=d[y++]}return new BufferAttribute(x,u,g)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new BufferGeometry,n=this.index.array,i=this.attributes;for(const a in i){const l=i[a],d=e(l,n);t.setAttribute(a,d)}const s=this.morphAttributes;for(const a in s){const l=[],d=s[a];for(let u=0,g=d.length;u<g;u++){const x=d[u],y=e(x,n);l.push(y)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const d=o[a];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const d in l)l[d]!==void 0&&(e[d]=l[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const l in n){const d=n[l];e.data.attributes[l]=d.toJSON(e.data)}const i={};let s=!1;for(const l in this.morphAttributes){const d=this.morphAttributes[l],u=[];for(let g=0,x=d.length;g<x;g++){const y=d[g];u.push(y.toJSON(e.data))}u.length>0&&(i[l]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone(t));const i=e.attributes;for(const d in i){const u=i[d];this.setAttribute(d,u.clone(t))}const s=e.morphAttributes;for(const d in s){const u=[],g=s[d];for(let x=0,y=g.length;x<y;x++)u.push(g[x].clone(t));this.morphAttributes[d]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let d=0,u=o.length;d<u;d++){const g=o[d];this.addGroup(g.start,g.count,g.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray,_sphere$5=new Sphere,_sphereHitAt=new Vector3,_vA$1=new Vector3,_vB$1=new Vector3,_vC$1=new Vector3,_tempA=new Vector3,_morphA=new Vector3,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2,_normalA=new Vector3,_normalB=new Vector3,_normalC=new Vector3,_intersectionPoint=new Vector3,_intersectionPointWorld=new Vector3;class Mesh extends Object3D{constructor(e=new BufferGeometry,t=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(s&&a){_morphA.set(0,0,0);for(let l=0,d=s.length;l<d;l++){const u=a[l],g=s[l];u!==0&&(_tempA.fromBufferAttribute(g,e),o?_morphA.addScaledVector(_tempA,u):_morphA.addScaledVector(_tempA.sub(t),u))}t.add(_morphA)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere$5.copy(n.boundingSphere),_sphere$5.applyMatrix4(s),_ray$3.copy(e.ray).recast(e.near),!(_sphere$5.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$5,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(e.far-e.near)**2))&&(_inverseMatrix$3.copy(s).invert(),_ray$3.copy(e.ray).applyMatrix4(_inverseMatrix$3),!(n.boundingBox!==null&&_ray$3.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,_ray$3)))}_computeIntersections(e,t,n){let i;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,d=s.attributes.uv,u=s.attributes.uv1,g=s.attributes.normal,x=s.groups,y=s.drawRange;if(a!==null)if(Array.isArray(o))for(let b=0,_=x.length;b<_;b++){const h=x[b],f=o[h.materialIndex],E=Math.max(h.start,y.start),m=Math.min(a.count,Math.min(h.start+h.count,y.start+y.count));for(let S=E,w=m;S<w;S+=3){const v=a.getX(S),A=a.getX(S+1),M=a.getX(S+2);i=checkGeometryIntersection(this,f,e,n,d,u,g,v,A,M),i&&(i.faceIndex=Math.floor(S/3),i.face.materialIndex=h.materialIndex,t.push(i))}}else{const b=Math.max(0,y.start),_=Math.min(a.count,y.start+y.count);for(let h=b,f=_;h<f;h+=3){const E=a.getX(h),m=a.getX(h+1),S=a.getX(h+2);i=checkGeometryIntersection(this,o,e,n,d,u,g,E,m,S),i&&(i.faceIndex=Math.floor(h/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(o))for(let b=0,_=x.length;b<_;b++){const h=x[b],f=o[h.materialIndex],E=Math.max(h.start,y.start),m=Math.min(l.count,Math.min(h.start+h.count,y.start+y.count));for(let S=E,w=m;S<w;S+=3){const v=S,A=S+1,M=S+2;i=checkGeometryIntersection(this,f,e,n,d,u,g,v,A,M),i&&(i.faceIndex=Math.floor(S/3),i.face.materialIndex=h.materialIndex,t.push(i))}}else{const b=Math.max(0,y.start),_=Math.min(l.count,y.start+y.count);for(let h=b,f=_;h<f;h+=3){const E=h,m=h+1,S=h+2;i=checkGeometryIntersection(this,o,e,n,d,u,g,E,m,S),i&&(i.faceIndex=Math.floor(h/3),t.push(i))}}}}function checkIntersection(r,e,t,n,i,s,o,a){let l;if(e.side===BackSide?l=n.intersectTriangle(o,s,i,!0,a):l=n.intersectTriangle(i,s,o,e.side===FrontSide,a),l===null)return null;_intersectionPointWorld.copy(a),_intersectionPointWorld.applyMatrix4(r.matrixWorld);const d=t.ray.origin.distanceTo(_intersectionPointWorld);return d<t.near||d>t.far?null:{distance:d,point:_intersectionPointWorld.clone(),object:r}}function checkGeometryIntersection(r,e,t,n,i,s,o,a,l,d){r.getVertexPosition(a,_vA$1),r.getVertexPosition(l,_vB$1),r.getVertexPosition(d,_vC$1);const u=checkIntersection(r,e,t,n,_vA$1,_vB$1,_vC$1,_intersectionPoint);if(u){i&&(_uvA$1.fromBufferAttribute(i,a),_uvB$1.fromBufferAttribute(i,l),_uvC$1.fromBufferAttribute(i,d),u.uv=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2)),s&&(_uvA$1.fromBufferAttribute(s,a),_uvB$1.fromBufferAttribute(s,l),_uvC$1.fromBufferAttribute(s,d),u.uv1=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_uvA$1,_uvB$1,_uvC$1,new Vector2),u.uv2=u.uv1),o&&(_normalA.fromBufferAttribute(o,a),_normalB.fromBufferAttribute(o,l),_normalC.fromBufferAttribute(o,d),u.normal=Triangle.getInterpolation(_intersectionPoint,_vA$1,_vB$1,_vC$1,_normalA,_normalB,_normalC,new Vector3),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const g={a,b:l,c:d,normal:new Vector3,materialIndex:0};Triangle.getNormal(_vA$1,_vB$1,_vC$1,g.normal),u.face=g}return u}class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,n=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const l=[],d=[],u=[],g=[];let x=0,y=0;b("z","y","x",-1,-1,n,t,e,o,s,0),b("z","y","x",1,-1,n,t,-e,o,s,1),b("x","z","y",1,1,e,n,t,i,o,2),b("x","z","y",1,-1,e,n,-t,i,o,3),b("x","y","z",1,-1,e,t,n,i,s,4),b("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(l),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(u,3)),this.setAttribute("uv",new Float32BufferAttribute(g,2));function b(_,h,f,E,m,S,w,v,A,M,T){const R=S/A,P=w/M,L=S/2,O=w/2,I=v/2,N=A+1,k=M+1;let U=0,F=0;const j=new Vector3;for(let H=0;H<k;H++){const B=H*P-O;for(let V=0;V<N;V++){const K=V*R-L;j[_]=K*E,j[h]=B*m,j[f]=I,d.push(j.x,j.y,j.z),j[_]=0,j[h]=0,j[f]=v>0?1:-1,u.push(j.x,j.y,j.z),g.push(V/A),g.push(1-H/M),U+=1}}for(let H=0;H<M;H++)for(let B=0;B<A;B++){const V=x+B+N*H,K=x+B+N*(H+1),q=x+(B+1)+N*(H+1),Te=x+(B+1)+N*H;l.push(V,K,Te),l.push(K,q,Te),F+=6}a.addGroup(y,F,T),y+=F,x+=U}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function cloneUniforms(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const i=r[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function mergeUniforms(r){const e={};for(let t=0;t<r.length;t++){const n=cloneUniforms(r[t]);for(const i in n)e[i]=n[i]}return e}function cloneUniformsGroups(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function getUnlitUniformColorSpace(r){return r.getRenderTarget()===null?r.outputColorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=cloneUniforms(e.uniforms),this.uniformsGroups=cloneUniformsGroups(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}let Camera$1=class extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};class PerspectiveCamera extends Camera$1{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,i,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,d=o.fullHeight;s+=o.offsetX*i/l,t-=o.offsetY*n/d,i*=o.width/l,n*=o.height/d}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new PerspectiveCamera(fov,aspect,e,t);i.layers=this.layers,this.add(i);const s=new PerspectiveCamera(fov,aspect,e,t);s.layers=this.layers,this.add(s);const o=new PerspectiveCamera(fov,aspect,e,t);o.layers=this.layers,this.add(o);const a=new PerspectiveCamera(fov,aspect,e,t);a.layers=this.layers,this.add(a);const l=new PerspectiveCamera(fov,aspect,e,t);l.layers=this.layers,this.add(l);const d=new PerspectiveCamera(fov,aspect,e,t);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,o,a,l]=t;for(const d of t)this.remove(d);if(e===WebGLCoordinateSystem)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===WebGPUCoordinateSystem)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of t)this.add(d),d.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,d,u]=this.children,g=e.getRenderTarget(),x=e.getActiveCubeFace(),y=e.getActiveMipmapLevel(),b=e.xr.enabled;e.xr.enabled=!1;const _=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,s),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,a),e.setRenderTarget(n,3,i),e.render(t,l),e.setRenderTarget(n,4,i),e.render(t,d),n.texture.generateMipmaps=_,e.setRenderTarget(n,5,i),e.render(t,u),e.setRenderTarget(g,x,y),e.xr.enabled=b,n.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(e,t,n,i,s,o,a,l,d,u){e=e!==void 0?e:[],t=t!==void 0?t:CubeReflectionMapping,super(e,t,n,i,s,o,a,l,d,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];t.encoding!==void 0&&(warnOnce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),t.colorSpace=t.encoding===sRGBEncoding?SRGBColorSpace:NoColorSpace),this.texture=new CubeTexture(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:LinearFilter}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new BoxGeometry(5,5,5),s=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:BackSide,blending:NoBlending});s.uniforms.tEquirect.value=t;const o=new Mesh(i,s),a=t.minFilter;return t.minFilter===LinearMipmapLinearFilter&&(t.minFilter=LinearFilter),new CubeCamera(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(s)}}const _vector1=new Vector3,_vector2=new Vector3,_normalMatrix=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=_vector1.subVectors(n,t).cross(_vector2.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(_vector1),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||_normalMatrix.getNormalMatrix(e),i=this.coplanarPoint(_vector1).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$4=new Sphere,_vector$6=new Vector3;class Frustum{constructor(e=new Plane,t=new Plane,n=new Plane,i=new Plane,s=new Plane,o=new Plane){this.planes=[e,t,n,i,s,o]}set(e,t,n,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=WebGLCoordinateSystem){const n=this.planes,i=e.elements,s=i[0],o=i[1],a=i[2],l=i[3],d=i[4],u=i[5],g=i[6],x=i[7],y=i[8],b=i[9],_=i[10],h=i[11],f=i[12],E=i[13],m=i[14],S=i[15];if(n[0].setComponents(l-s,x-d,h-y,S-f).normalize(),n[1].setComponents(l+s,x+d,h+y,S+f).normalize(),n[2].setComponents(l+o,x+u,h+b,S+E).normalize(),n[3].setComponents(l-o,x-u,h-b,S-E).normalize(),n[4].setComponents(l-a,x-g,h-_,S-m).normalize(),t===WebGLCoordinateSystem)n[5].setComponents(l+a,x+g,h+_,S+m).normalize();else if(t===WebGPUCoordinateSystem)n[5].setComponents(a,g,_,m).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),_sphere$4.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),_sphere$4.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(_sphere$4)}intersectsSprite(e){return _sphere$4.center.set(0,0,0),_sphere$4.radius=.7071067811865476,_sphere$4.applyMatrix4(e.matrixWorld),this.intersectsSphere(_sphere$4)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(_vector$6.x=i.normal.x>0?e.max.x:e.min.x,_vector$6.y=i.normal.y>0?e.max.y:e.min.y,_vector$6.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(_vector$6)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let r=null,e=!1,t=null,n=null;function i(s,o){t(s,o),n=r.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(i),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){r=s}}}function WebGLAttributes(r,e){const t=e.isWebGL2,n=new WeakMap;function i(d,u){const g=d.array,x=d.usage,y=r.createBuffer();r.bindBuffer(u,y),r.bufferData(u,g,x),d.onUploadCallback();let b;if(g instanceof Float32Array)b=r.FLOAT;else if(g instanceof Uint16Array)if(d.isFloat16BufferAttribute)if(t)b=r.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else b=r.UNSIGNED_SHORT;else if(g instanceof Int16Array)b=r.SHORT;else if(g instanceof Uint32Array)b=r.UNSIGNED_INT;else if(g instanceof Int32Array)b=r.INT;else if(g instanceof Int8Array)b=r.BYTE;else if(g instanceof Uint8Array)b=r.UNSIGNED_BYTE;else if(g instanceof Uint8ClampedArray)b=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+g);return{buffer:y,type:b,bytesPerElement:g.BYTES_PER_ELEMENT,version:d.version}}function s(d,u,g){const x=u.array,y=u.updateRange;r.bindBuffer(g,d),y.count===-1?r.bufferSubData(g,0,x):(t?r.bufferSubData(g,y.offset*x.BYTES_PER_ELEMENT,x,y.offset,y.count):r.bufferSubData(g,y.offset*x.BYTES_PER_ELEMENT,x.subarray(y.offset,y.offset+y.count)),y.count=-1),u.onUploadCallback()}function o(d){return d.isInterleavedBufferAttribute&&(d=d.data),n.get(d)}function a(d){d.isInterleavedBufferAttribute&&(d=d.data);const u=n.get(d);u&&(r.deleteBuffer(u.buffer),n.delete(d))}function l(d,u){if(d.isGLBufferAttribute){const x=n.get(d);(!x||x.version<d.version)&&n.set(d,{buffer:d.buffer,type:d.type,bytesPerElement:d.elementSize,version:d.version});return}d.isInterleavedBufferAttribute&&(d=d.data);const g=n.get(d);g===void 0?n.set(d,i(d,u)):g.version<d.version&&(s(g.buffer,d,u),g.version=d.version)}return{get:o,remove:a,update:l}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(n),l=Math.floor(i),d=a+1,u=l+1,g=e/a,x=t/l,y=[],b=[],_=[],h=[];for(let f=0;f<u;f++){const E=f*x-o;for(let m=0;m<d;m++){const S=m*g-s;b.push(S,-E,0),_.push(0,0,1),h.push(m/a),h.push(1-f/l)}}for(let f=0;f<l;f++)for(let E=0;E<a;E++){const m=E+d*f,S=E+d*(f+1),w=E+1+d*(f+1),v=E+1+d*f;y.push(m,S,v),y.push(S,w,v)}this.setIndex(y),this.setAttribute("position",new Float32BufferAttribute(b,3)),this.setAttribute("normal",new Float32BufferAttribute(_,3)),this.setAttribute("uv",new Float32BufferAttribute(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0};function WebGLBackground(r,e,t,n,i,s,o){const a=new Color(0);let l=s===!0?0:1,d,u,g=null,x=0,y=null;function b(h,f){let E=!1,m=f.isScene===!0?f.background:null;m&&m.isTexture&&(m=(f.backgroundBlurriness>0?t:e).get(m)),m===null?_(a,l):m&&m.isColor&&(_(m,1),E=!0);const S=r.xr.getEnvironmentBlendMode();S==="additive"?n.buffers.color.setClear(0,0,0,1,o):S==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(r.autoClear||E)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),m&&(m.isCubeTexture||m.mapping===CubeUVReflectionMapping)?(u===void 0&&(u=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(w,v,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),u.material.uniforms.envMap.value=m,u.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,u.material.toneMapped=ColorManagement.getTransfer(m.colorSpace)!==SRGBTransfer,(g!==m||x!==m.version||y!==r.toneMapping)&&(u.material.needsUpdate=!0,g=m,x=m.version,y=r.toneMapping),u.layers.enableAll(),h.unshift(u,u.geometry,u.material,0,0,null)):m&&m.isTexture&&(d===void 0&&(d=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(d)),d.material.uniforms.t2D.value=m,d.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,d.material.toneMapped=ColorManagement.getTransfer(m.colorSpace)!==SRGBTransfer,m.matrixAutoUpdate===!0&&m.updateMatrix(),d.material.uniforms.uvTransform.value.copy(m.matrix),(g!==m||x!==m.version||y!==r.toneMapping)&&(d.material.needsUpdate=!0,g=m,x=m.version,y=r.toneMapping),d.layers.enableAll(),h.unshift(d,d.geometry,d.material,0,0,null))}function _(h,f){h.getRGB(_rgb,getUnlitUniformColorSpace(r)),n.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,f,o)}return{getClearColor:function(){return a},setClearColor:function(h,f=1){a.set(h),l=f,_(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(h){l=h,_(a,l)},render:b}}function WebGLBindingStates(r,e,t,n){const i=r.getParameter(r.MAX_VERTEX_ATTRIBS),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||s!==null,a={},l=h(null);let d=l,u=!1;function g(I,N,k,U,F){let j=!1;if(o){const H=_(U,k,N);d!==H&&(d=H,y(d.object)),j=f(I,U,k,F),j&&E(I,U,k,F)}else{const H=N.wireframe===!0;(d.geometry!==U.id||d.program!==k.id||d.wireframe!==H)&&(d.geometry=U.id,d.program=k.id,d.wireframe=H,j=!0)}F!==null&&t.update(F,r.ELEMENT_ARRAY_BUFFER),(j||u)&&(u=!1,M(I,N,k,U),F!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.get(F).buffer))}function x(){return n.isWebGL2?r.createVertexArray():s.createVertexArrayOES()}function y(I){return n.isWebGL2?r.bindVertexArray(I):s.bindVertexArrayOES(I)}function b(I){return n.isWebGL2?r.deleteVertexArray(I):s.deleteVertexArrayOES(I)}function _(I,N,k){const U=k.wireframe===!0;let F=a[I.id];F===void 0&&(F={},a[I.id]=F);let j=F[N.id];j===void 0&&(j={},F[N.id]=j);let H=j[U];return H===void 0&&(H=h(x()),j[U]=H),H}function h(I){const N=[],k=[],U=[];for(let F=0;F<i;F++)N[F]=0,k[F]=0,U[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:N,enabledAttributes:k,attributeDivisors:U,object:I,attributes:{},index:null}}function f(I,N,k,U){const F=d.attributes,j=N.attributes;let H=0;const B=k.getAttributes();for(const V in B)if(B[V].location>=0){const q=F[V];let Te=j[V];if(Te===void 0&&(V==="instanceMatrix"&&I.instanceMatrix&&(Te=I.instanceMatrix),V==="instanceColor"&&I.instanceColor&&(Te=I.instanceColor)),q===void 0||q.attribute!==Te||Te&&q.data!==Te.data)return!0;H++}return d.attributesNum!==H||d.index!==U}function E(I,N,k,U){const F={},j=N.attributes;let H=0;const B=k.getAttributes();for(const V in B)if(B[V].location>=0){let q=j[V];q===void 0&&(V==="instanceMatrix"&&I.instanceMatrix&&(q=I.instanceMatrix),V==="instanceColor"&&I.instanceColor&&(q=I.instanceColor));const Te={};Te.attribute=q,q&&q.data&&(Te.data=q.data),F[V]=Te,H++}d.attributes=F,d.attributesNum=H,d.index=U}function m(){const I=d.newAttributes;for(let N=0,k=I.length;N<k;N++)I[N]=0}function S(I){w(I,0)}function w(I,N){const k=d.newAttributes,U=d.enabledAttributes,F=d.attributeDivisors;k[I]=1,U[I]===0&&(r.enableVertexAttribArray(I),U[I]=1),F[I]!==N&&((n.isWebGL2?r:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](I,N),F[I]=N)}function v(){const I=d.newAttributes,N=d.enabledAttributes;for(let k=0,U=N.length;k<U;k++)N[k]!==I[k]&&(r.disableVertexAttribArray(k),N[k]=0)}function A(I,N,k,U,F,j,H){H===!0?r.vertexAttribIPointer(I,N,k,F,j):r.vertexAttribPointer(I,N,k,U,F,j)}function M(I,N,k,U){if(n.isWebGL2===!1&&(I.isInstancedMesh||U.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;m();const F=U.attributes,j=k.getAttributes(),H=N.defaultAttributeValues;for(const B in j){const V=j[B];if(V.location>=0){let K=F[B];if(K===void 0&&(B==="instanceMatrix"&&I.instanceMatrix&&(K=I.instanceMatrix),B==="instanceColor"&&I.instanceColor&&(K=I.instanceColor)),K!==void 0){const q=K.normalized,Te=K.itemSize,Fe=t.get(K);if(Fe===void 0)continue;const We=Fe.buffer,J=Fe.type,et=Fe.bytesPerElement,ht=n.isWebGL2===!0&&(J===r.INT||J===r.UNSIGNED_INT||K.gpuType===IntType);if(K.isInterleavedBufferAttribute){const er=K.data,tr=er.stride,Hm=K.offset;if(er.isInstancedInterleavedBuffer){for(let oi=0;oi<V.locationSize;oi++)w(V.location+oi,er.meshPerAttribute);I.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=er.meshPerAttribute*er.count)}else for(let oi=0;oi<V.locationSize;oi++)S(V.location+oi);r.bindBuffer(r.ARRAY_BUFFER,We);for(let oi=0;oi<V.locationSize;oi++)A(V.location+oi,Te/V.locationSize,J,q,tr*et,(Hm+Te/V.locationSize*oi)*et,ht)}else{if(K.isInstancedBufferAttribute){for(let er=0;er<V.locationSize;er++)w(V.location+er,K.meshPerAttribute);I.isInstancedMesh!==!0&&U._maxInstanceCount===void 0&&(U._maxInstanceCount=K.meshPerAttribute*K.count)}else for(let er=0;er<V.locationSize;er++)S(V.location+er);r.bindBuffer(r.ARRAY_BUFFER,We);for(let er=0;er<V.locationSize;er++)A(V.location+er,Te/V.locationSize,J,q,Te*et,Te/V.locationSize*er*et,ht)}}else if(H!==void 0){const q=H[B];if(q!==void 0)switch(q.length){case 2:r.vertexAttrib2fv(V.location,q);break;case 3:r.vertexAttrib3fv(V.location,q);break;case 4:r.vertexAttrib4fv(V.location,q);break;default:r.vertexAttrib1fv(V.location,q)}}}}v()}function T(){L();for(const I in a){const N=a[I];for(const k in N){const U=N[k];for(const F in U)b(U[F].object),delete U[F];delete N[k]}delete a[I]}}function R(I){if(a[I.id]===void 0)return;const N=a[I.id];for(const k in N){const U=N[k];for(const F in U)b(U[F].object),delete U[F];delete N[k]}delete a[I.id]}function P(I){for(const N in a){const k=a[N];if(k[I.id]===void 0)continue;const U=k[I.id];for(const F in U)b(U[F].object),delete U[F];delete k[I.id]}}function L(){O(),u=!0,d!==l&&(d=l,y(d.object))}function O(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:g,reset:L,resetDefaultState:O,dispose:T,releaseStatesOfGeometry:R,releaseStatesOfProgram:P,initAttributes:m,enableAttribute:S,disableUnusedAttributes:v}}function WebGLBufferRenderer(r,e,t,n){const i=n.isWebGL2;let s;function o(d){s=d}function a(d,u){r.drawArrays(s,d,u),t.update(u,s,1)}function l(d,u,g){if(g===0)return;let x,y;if(i)x=r,y="drawArraysInstanced";else if(x=e.get("ANGLE_instanced_arrays"),y="drawArraysInstancedANGLE",x===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}x[y](s,d,u,g),t.update(u,s,g)}this.setMode=o,this.render=a,this.renderInstances=l}function WebGLCapabilities(r,e,t){let n;function i(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){const A=e.get("EXT_texture_filter_anisotropic");n=r.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function s(A){if(A==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";A="mediump"}return A==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&r.constructor.name==="WebGL2RenderingContext";let a=t.precision!==void 0?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const d=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,g=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),x=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),y=r.getParameter(r.MAX_TEXTURE_SIZE),b=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),_=r.getParameter(r.MAX_VERTEX_ATTRIBS),h=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),f=r.getParameter(r.MAX_VARYING_VECTORS),E=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),m=x>0,S=o||e.has("OES_texture_float"),w=m&&S,v=o?r.getParameter(r.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:d,getMaxAnisotropy:i,getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:g,maxVertexTextures:x,maxTextureSize:y,maxCubemapSize:b,maxAttributes:_,maxVertexUniforms:h,maxVaryings:f,maxFragmentUniforms:E,vertexTextures:m,floatFragmentTextures:S,floatVertexTextures:w,maxSamples:v}}function WebGLClipping(r){const e=this;let t=null,n=0,i=!1,s=!1;const o=new Plane,a=new Matrix3,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(g,x){const y=g.length!==0||x||n!==0||i;return i=x,n=g.length,y},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(g,x){t=u(g,x,0)},this.setState=function(g,x,y){const b=g.clippingPlanes,_=g.clipIntersection,h=g.clipShadows,f=r.get(g);if(!i||b===null||b.length===0||s&&!h)s?u(null):d();else{const E=s?0:n,m=E*4;let S=f.clippingState||null;l.value=S,S=u(b,x,m,y);for(let w=0;w!==m;++w)S[w]=t[w];f.clippingState=S,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=E}};function d(){l.value!==t&&(l.value=t,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(g,x,y,b){const _=g!==null?g.length:0;let h=null;if(_!==0){if(h=l.value,b!==!0||h===null){const f=y+_*4,E=x.matrixWorldInverse;a.getNormalMatrix(E),(h===null||h.length<f)&&(h=new Float32Array(f));for(let m=0,S=y;m!==_;++m,S+=4)o.copy(g[m]).applyMatrix4(E,a),o.normal.toArray(h,S),h[S+3]=o.constant}l.value=h,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,h}}function WebGLCubeMaps(r){let e=new WeakMap;function t(o,a){return a===EquirectangularReflectionMapping?o.mapping=CubeReflectionMapping:a===EquirectangularRefractionMapping&&(o.mapping=CubeRefractionMapping),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===EquirectangularReflectionMapping||a===EquirectangularRefractionMapping)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const d=new WebGLCubeRenderTarget(l.height/2);return d.fromEquirectangularTexture(r,o),e.set(o,d),o.addEventListener("dispose",i),t(d.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}class OrthographicCamera extends Camera$1{constructor(e=-1,t=1,n=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,o=n+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=d*this.view.offsetX,o=s+d*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,PHI,INV_PHI),new Vector3(0,PHI,-INV_PHI),new Vector3(INV_PHI,0,PHI),new Vector3(-INV_PHI,0,PHI),new Vector3(PHI,INV_PHI,0),new Vector3(-PHI,INV_PHI,0)];class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100){_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,n,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),e.scissorTest=!1,_setViewport(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},i=_createRenderTarget(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(s)),this._blurMaterial=_getBlurShader(s,e,t)}return i}_compileMaterial(e){const t=new Mesh(this._lodPlanes[0],e);this._renderer.compile(t,_flatCamera)}_sceneToCubeUV(e,t,n,i){const a=new PerspectiveCamera(90,1,t,n),l=[1,-1,1,1,1,1],d=[1,1,1,-1,-1,-1],u=this._renderer,g=u.autoClear,x=u.toneMapping;u.getClearColor(_clearColor),u.toneMapping=NoToneMapping,u.autoClear=!1;const y=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),b=new Mesh(new BoxGeometry,y);let _=!1;const h=e.background;h?h.isColor&&(y.color.copy(h),e.background=null,_=!0):(y.color.copy(_clearColor),_=!0);for(let f=0;f<6;f++){const E=f%3;E===0?(a.up.set(0,l[f],0),a.lookAt(d[f],0,0)):E===1?(a.up.set(0,0,l[f]),a.lookAt(0,d[f],0)):(a.up.set(0,l[f],0),a.lookAt(0,0,d[f]));const m=this._cubeSize;_setViewport(i,E*m,f>2?m:0,m,m),u.setRenderTarget(i),_&&u.render(b,a),u.render(e,a)}b.geometry.dispose(),b.material.dispose(),u.toneMapping=x,u.autoClear=g,e.background=h}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===CubeReflectionMapping||e.mapping===CubeRefractionMapping;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new Mesh(this._lodPlanes[0],s),a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;_setViewport(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(o,_flatCamera)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const s=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),o=_axisDirections[(i-1)%_axisDirections.length];this._blur(e,i-1,i,s,o)}t.autoClear=n}_blur(e,t,n,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",s),this._halfBlur(o,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,o,a){const l=this._renderer,d=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,g=new Mesh(this._lodPlanes[i],d),x=d.uniforms,y=this._sizeLods[n]-1,b=isFinite(s)?Math.PI/(2*y):2*Math.PI/(2*MAX_SAMPLES-1),_=s/b,h=isFinite(s)?1+Math.floor(u*_):MAX_SAMPLES;h>MAX_SAMPLES&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${h} samples when the maximum is set to ${MAX_SAMPLES}`);const f=[];let E=0;for(let A=0;A<MAX_SAMPLES;++A){const M=A/_,T=Math.exp(-M*M/2);f.push(T),A===0?E+=T:A<h&&(E+=2*T)}for(let A=0;A<f.length;A++)f[A]=f[A]/E;x.envMap.value=e.texture,x.samples.value=h,x.weights.value=f,x.latitudinal.value=o==="latitudinal",a&&(x.poleAxis.value=a);const{_lodMax:m}=this;x.dTheta.value=b,x.mipInt.value=m-n;const S=this._sizeLods[i],w=3*S*(i>m-LOD_MIN?i-m+LOD_MIN:0),v=4*(this._cubeSize-S);_setViewport(t,w,v,3*S,2*S),l.setRenderTarget(t),l.render(g,_flatCamera)}}function _createPlanes(r){const e=[],t=[],n=[];let i=r;const s=r-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let l=1/a;o>r-LOD_MIN?l=EXTRA_LOD_SIGMA[o-r+LOD_MIN-1]:o===0&&(l=0),n.push(l);const d=1/(a-2),u=-d,g=1+d,x=[u,u,g,u,g,g,u,u,g,g,u,g],y=6,b=6,_=3,h=2,f=1,E=new Float32Array(_*b*y),m=new Float32Array(h*b*y),S=new Float32Array(f*b*y);for(let v=0;v<y;v++){const A=v%3*2/3-1,M=v>2?0:-1,T=[A,M,0,A+2/3,M,0,A+2/3,M+1,0,A,M,0,A+2/3,M+1,0,A,M+1,0];E.set(T,_*b*v),m.set(x,h*b*v);const R=[v,v,v,v,v,v];S.set(R,f*b*v)}const w=new BufferGeometry;w.setAttribute("position",new BufferAttribute(E,_)),w.setAttribute("uv",new BufferAttribute(m,h)),w.setAttribute("faceIndex",new BufferAttribute(S,f)),e.push(w),i>LOD_MIN&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function _createRenderTarget(r,e,t){const n=new WebGLRenderTarget(r,e,t);return n.texture.mapping=CubeUVReflectionMapping,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function _setViewport(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function _getBlurShader(r,e,t){const n=new Float32Array(MAX_SAMPLES),i=new Vector3(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(r){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){const l=a.mapping,d=l===EquirectangularReflectionMapping||l===EquirectangularRefractionMapping,u=l===CubeReflectionMapping||l===CubeRefractionMapping;if(d||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let g=e.get(a);return t===null&&(t=new PMREMGenerator(r)),g=d?t.fromEquirectangular(a,g):t.fromCubemap(a,g),e.set(a,g),g.texture}else{if(e.has(a))return e.get(a).texture;{const g=a.image;if(d&&g&&g.height>0||u&&g&&i(g)){t===null&&(t=new PMREMGenerator(r));const x=d?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,x),a.addEventListener("dispose",s),x.texture}else return null}}}return a}function i(a){let l=0;const d=6;for(let u=0;u<d;u++)a[u]!==void 0&&l++;return l===d}function s(a){const l=a.target;l.removeEventListener("dispose",s);const d=e.get(l);d!==void 0&&(e.delete(l),d.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function WebGLExtensions(r){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=r.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){const i=t(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function WebGLGeometries(r,e,t,n){const i={},s=new WeakMap;function o(g){const x=g.target;x.index!==null&&e.remove(x.index);for(const b in x.attributes)e.remove(x.attributes[b]);for(const b in x.morphAttributes){const _=x.morphAttributes[b];for(let h=0,f=_.length;h<f;h++)e.remove(_[h])}x.removeEventListener("dispose",o),delete i[x.id];const y=s.get(x);y&&(e.remove(y),s.delete(x)),n.releaseStatesOfGeometry(x),x.isInstancedBufferGeometry===!0&&delete x._maxInstanceCount,t.memory.geometries--}function a(g,x){return i[x.id]===!0||(x.addEventListener("dispose",o),i[x.id]=!0,t.memory.geometries++),x}function l(g){const x=g.attributes;for(const b in x)e.update(x[b],r.ARRAY_BUFFER);const y=g.morphAttributes;for(const b in y){const _=y[b];for(let h=0,f=_.length;h<f;h++)e.update(_[h],r.ARRAY_BUFFER)}}function d(g){const x=[],y=g.index,b=g.attributes.position;let _=0;if(y!==null){const E=y.array;_=y.version;for(let m=0,S=E.length;m<S;m+=3){const w=E[m+0],v=E[m+1],A=E[m+2];x.push(w,v,v,A,A,w)}}else if(b!==void 0){const E=b.array;_=b.version;for(let m=0,S=E.length/3-1;m<S;m+=3){const w=m+0,v=m+1,A=m+2;x.push(w,v,v,A,A,w)}}else return;const h=new(arrayNeedsUint32(x)?Uint32BufferAttribute:Uint16BufferAttribute)(x,1);h.version=_;const f=s.get(g);f&&e.remove(f),s.set(g,h)}function u(g){const x=s.get(g);if(x){const y=g.index;y!==null&&x.version<y.version&&d(g)}else d(g);return s.get(g)}return{get:a,update:l,getWireframeAttribute:u}}function WebGLIndexedBufferRenderer(r,e,t,n){const i=n.isWebGL2;let s;function o(x){s=x}let a,l;function d(x){a=x.type,l=x.bytesPerElement}function u(x,y){r.drawElements(s,y,a,x*l),t.update(y,s,1)}function g(x,y,b){if(b===0)return;let _,h;if(i)_=r,h="drawElementsInstanced";else if(_=e.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",_===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}_[h](s,y,a,x*l,b),t.update(y,s,b)}this.setMode=o,this.setIndex=d,this.render=u,this.renderInstances=g}function WebGLInfo(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,a){switch(t.calls++,o){case r.TRIANGLES:t.triangles+=a*(s/3);break;case r.LINES:t.lines+=a*(s/2);break;case r.LINE_STRIP:t.lines+=a*(s-1);break;case r.LINE_LOOP:t.lines+=a*s;break;case r.POINTS:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function numericalSort(r,e){return r[0]-e[0]}function absNumericalSort(r,e){return Math.abs(e[1])-Math.abs(r[1])}function WebGLMorphtargets(r,e,t){const n={},i=new Float32Array(8),s=new WeakMap,o=new Vector4,a=[];for(let d=0;d<8;d++)a[d]=[d,0];function l(d,u,g){const x=d.morphTargetInfluences;if(e.isWebGL2===!0){const b=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,_=b!==void 0?b.length:0;let h=s.get(u);if(h===void 0||h.count!==_){let N=function(){O.dispose(),s.delete(u),u.removeEventListener("dispose",N)};var y=N;h!==void 0&&h.texture.dispose();const m=u.morphAttributes.position!==void 0,S=u.morphAttributes.normal!==void 0,w=u.morphAttributes.color!==void 0,v=u.morphAttributes.position||[],A=u.morphAttributes.normal||[],M=u.morphAttributes.color||[];let T=0;m===!0&&(T=1),S===!0&&(T=2),w===!0&&(T=3);let R=u.attributes.position.count*T,P=1;R>e.maxTextureSize&&(P=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const L=new Float32Array(R*P*4*_),O=new DataArrayTexture(L,R,P,_);O.type=FloatType,O.needsUpdate=!0;const I=T*4;for(let k=0;k<_;k++){const U=v[k],F=A[k],j=M[k],H=R*P*4*k;for(let B=0;B<U.count;B++){const V=B*I;m===!0&&(o.fromBufferAttribute(U,B),L[H+V+0]=o.x,L[H+V+1]=o.y,L[H+V+2]=o.z,L[H+V+3]=0),S===!0&&(o.fromBufferAttribute(F,B),L[H+V+4]=o.x,L[H+V+5]=o.y,L[H+V+6]=o.z,L[H+V+7]=0),w===!0&&(o.fromBufferAttribute(j,B),L[H+V+8]=o.x,L[H+V+9]=o.y,L[H+V+10]=o.z,L[H+V+11]=j.itemSize===4?o.w:1)}}h={count:_,texture:O,size:new Vector2(R,P)},s.set(u,h),u.addEventListener("dispose",N)}let f=0;for(let m=0;m<x.length;m++)f+=x[m];const E=u.morphTargetsRelative?1:1-f;g.getUniforms().setValue(r,"morphTargetBaseInfluence",E),g.getUniforms().setValue(r,"morphTargetInfluences",x),g.getUniforms().setValue(r,"morphTargetsTexture",h.texture,t),g.getUniforms().setValue(r,"morphTargetsTextureSize",h.size)}else{const b=x===void 0?0:x.length;let _=n[u.id];if(_===void 0||_.length!==b){_=[];for(let S=0;S<b;S++)_[S]=[S,0];n[u.id]=_}for(let S=0;S<b;S++){const w=_[S];w[0]=S,w[1]=x[S]}_.sort(absNumericalSort);for(let S=0;S<8;S++)S<b&&_[S][1]?(a[S][0]=_[S][0],a[S][1]=_[S][1]):(a[S][0]=Number.MAX_SAFE_INTEGER,a[S][1]=0);a.sort(numericalSort);const h=u.morphAttributes.position,f=u.morphAttributes.normal;let E=0;for(let S=0;S<8;S++){const w=a[S],v=w[0],A=w[1];v!==Number.MAX_SAFE_INTEGER&&A?(h&&u.getAttribute("morphTarget"+S)!==h[v]&&u.setAttribute("morphTarget"+S,h[v]),f&&u.getAttribute("morphNormal"+S)!==f[v]&&u.setAttribute("morphNormal"+S,f[v]),i[S]=A,E+=A):(h&&u.hasAttribute("morphTarget"+S)===!0&&u.deleteAttribute("morphTarget"+S),f&&u.hasAttribute("morphNormal"+S)===!0&&u.deleteAttribute("morphNormal"+S),i[S]=0)}const m=u.morphTargetsRelative?1:1-E;g.getUniforms().setValue(r,"morphTargetBaseInfluence",m),g.getUniforms().setValue(r,"morphTargetInfluences",i)}}return{update:l}}function WebGLObjects(r,e,t,n){let i=new WeakMap;function s(l){const d=n.render.frame,u=l.geometry,g=e.get(l,u);if(i.get(g)!==d&&(e.update(g),i.set(g,d)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),i.get(l)!==d&&(t.update(l.instanceMatrix,r.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,r.ARRAY_BUFFER),i.set(l,d))),l.isSkinnedMesh){const x=l.skeleton;i.get(x)!==d&&(x.update(),i.set(x,d))}return g}function o(){i=new WeakMap}function a(l){const d=l.target;d.removeEventListener("dispose",a),t.remove(d.instanceMatrix),d.instanceColor!==null&&t.remove(d.instanceColor)}return{update:s,dispose:o}}const emptyTexture=new Texture,emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(r,e,t){const n=r[0];if(n<=0||n>0)return r;const i=e*t;let s=arrayCacheF32[i];if(s===void 0&&(s=new Float32Array(i),arrayCacheF32[i]=s),e!==0){n.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,r[o].toArray(s,a)}return s}function arraysEqual(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function copyArray(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function allocTexUnits(r,e){let t=arrayCacheI32[e];t===void 0&&(t=new Int32Array(e),arrayCacheI32[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function setValueV1f(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function setValueV2f(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(arraysEqual(t,e))return;r.uniform2fv(this.addr,e),copyArray(t,e)}}function setValueV3f(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(arraysEqual(t,e))return;r.uniform3fv(this.addr,e),copyArray(t,e)}}function setValueV4f(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(arraysEqual(t,e))return;r.uniform4fv(this.addr,e),copyArray(t,e)}}function setValueM2(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(arraysEqual(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),copyArray(t,e)}else{if(arraysEqual(t,n))return;mat2array.set(n),r.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(t,n)}}function setValueM3(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(arraysEqual(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),copyArray(t,e)}else{if(arraysEqual(t,n))return;mat3array.set(n),r.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(t,n)}}function setValueM4(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(arraysEqual(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),copyArray(t,e)}else{if(arraysEqual(t,n))return;mat4array.set(n),r.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(t,n)}}function setValueV1i(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function setValueV2i(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(arraysEqual(t,e))return;r.uniform2iv(this.addr,e),copyArray(t,e)}}function setValueV3i(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(arraysEqual(t,e))return;r.uniform3iv(this.addr,e),copyArray(t,e)}}function setValueV4i(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(arraysEqual(t,e))return;r.uniform4iv(this.addr,e),copyArray(t,e)}}function setValueV1ui(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function setValueV2ui(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(arraysEqual(t,e))return;r.uniform2uiv(this.addr,e),copyArray(t,e)}}function setValueV3ui(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(arraysEqual(t,e))return;r.uniform3uiv(this.addr,e),copyArray(t,e)}}function setValueV4ui(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(arraysEqual(t,e))return;r.uniform4uiv(this.addr,e),copyArray(t,e)}}function setValueT1(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2D(e||emptyTexture,i)}function setValueT3D1(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||empty3dTexture,i)}function setValueT6(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||emptyCubeTexture,i)}function setValueT2DArray1(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||emptyArrayTexture,i)}function getSingularSetter(r){switch(r){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(r,e){r.uniform1fv(this.addr,e)}function setValueV2fArray(r,e){const t=flatten(e,this.size,2);r.uniform2fv(this.addr,t)}function setValueV3fArray(r,e){const t=flatten(e,this.size,3);r.uniform3fv(this.addr,t)}function setValueV4fArray(r,e){const t=flatten(e,this.size,4);r.uniform4fv(this.addr,t)}function setValueM2Array(r,e){const t=flatten(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function setValueM3Array(r,e){const t=flatten(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function setValueM4Array(r,e){const t=flatten(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function setValueV1iArray(r,e){r.uniform1iv(this.addr,e)}function setValueV2iArray(r,e){r.uniform2iv(this.addr,e)}function setValueV3iArray(r,e){r.uniform3iv(this.addr,e)}function setValueV4iArray(r,e){r.uniform4iv(this.addr,e)}function setValueV1uiArray(r,e){r.uniform1uiv(this.addr,e)}function setValueV2uiArray(r,e){r.uniform2uiv(this.addr,e)}function setValueV3uiArray(r,e){r.uniform3uiv(this.addr,e)}function setValueV4uiArray(r,e){r.uniform4uiv(this.addr,e)}function setValueT1Array(r,e,t){const n=this.cache,i=e.length,s=allocTexUnits(t,i);arraysEqual(n,s)||(r.uniform1iv(this.addr,s),copyArray(n,s));for(let o=0;o!==i;++o)t.setTexture2D(e[o]||emptyTexture,s[o])}function setValueT3DArray(r,e,t){const n=this.cache,i=e.length,s=allocTexUnits(t,i);arraysEqual(n,s)||(r.uniform1iv(this.addr,s),copyArray(n,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||empty3dTexture,s[o])}function setValueT6Array(r,e,t){const n=this.cache,i=e.length,s=allocTexUnits(t,i);arraysEqual(n,s)||(r.uniform1iv(this.addr,s),copyArray(n,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||emptyCubeTexture,s[o])}function setValueT2DArrayArray(r,e,t){const n=this.cache,i=e.length,s=allocTexUnits(t,i);arraysEqual(n,s)||(r.uniform1iv(this.addr,s),copyArray(n,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||emptyArrayTexture,s[o])}function getPureArraySetter(r){switch(r){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=getSingularSetter(t.type)}}class PureArrayUniform{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=getPureArraySetter(t.type)}}class StructuredUniform{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const a=i[s];a.setValue(e,t[a.id],n)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(r,e){r.seq.push(e),r.map[e.id]=e}function parseUniform(r,e,t){const n=r.name,i=n.length;for(RePathPart.lastIndex=0;;){const s=RePathPart.exec(n),o=RePathPart.lastIndex;let a=s[1];const l=s[2]==="]",d=s[3];if(l&&(a=a|0),d===void 0||d==="["&&o+2===i){addUniform(t,d===void 0?new SingleUniform(a,r,e):new PureArrayUniform(a,r,e));break}else{let g=t.map[a];g===void 0&&(g=new StructuredUniform(a),addUniform(t,g)),t=g}}}class WebGLUniforms{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const s=e.getActiveUniform(t,i),o=e.getUniformLocation(t,s.name);parseUniform(s,o,this)}}setValue(e,t,n,i){const s=this.map[t];s!==void 0&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=n[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&n.push(o)}return n}}function WebGLShader(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(r,e){const t=r.split(`
`),n=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const a=o+1;n.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return n.join(`
`)}function getEncodingComponents(r){const e=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),t=ColorManagement.getPrimaries(r);let n;switch(e===t?n="":e===P3Primaries&&t===Rec709Primaries?n="LinearDisplayP3ToLinearSRGB":e===Rec709Primaries&&t===P3Primaries&&(n="LinearSRGBToLinearDisplayP3"),r){case LinearSRGBColorSpace:case LinearDisplayP3ColorSpace:return[n,"LinearTransferOETF"];case SRGBColorSpace:case DisplayP3ColorSpace:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",r),[n,"LinearTransferOETF"]}}function getShaderErrors(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),i=r.getShaderInfoLog(e).trim();if(n&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+handleSource(r.getShaderSource(e),o)}else return i}function getTexelEncodingFunction(r,e){const t=getEncodingComponents(e);return`vec4 ${r}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function getToneMappingFunction(r,e){let t;switch(e){case LinearToneMapping:t="Linear";break;case ReinhardToneMapping:t="Reinhard";break;case CineonToneMapping:t="OptimizedCineon";break;case ACESFilmicToneMapping:t="ACESFilmic";break;case CustomToneMapping:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function generateExtensions(r){return[r.extensionDerivatives||r.envMapCubeUVHeight||r.bumpMap||r.normalMapTangentSpace||r.clearcoatNormalMap||r.flatShading||r.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(filterEmptyLine).join(`
`)}function generateDefines(r){const e=[];for(const t in r){const n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function fetchAttributeLocations(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=r.getActiveAttrib(e,i),o=s.name;let a=1;s.type===r.FLOAT_MAT2&&(a=2),s.type===r.FLOAT_MAT3&&(a=3),s.type===r.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:r.getAttribLocation(e,o),locationSize:a}}return t}function filterEmptyLine(r){return r!==""}function replaceLightNums(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function replaceClippingPlaneNums(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(r){return r.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function includeReplacer(r,e){let t=ShaderChunk[e];if(t===void 0){const n=shaderChunkMap.get(e);if(n!==void 0)t=ShaderChunk[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return resolveIncludes(t)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(r){return r.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(r,e,t,n){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function generatePrecision(r){let e="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function generateShadowMapTypeDefine(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===PCFShadowMap?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===PCFSoftShadowMap?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===VSMShadowMap&&(e="SHADOWMAP_TYPE_VSM"),e}function generateEnvMapTypeDefine(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:e="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:e="ENVMAP_TYPE_CUBE_UV";break}return e}function generateEnvMapModeDefine(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case CubeRefractionMapping:e="ENVMAP_MODE_REFRACTION";break}return e}function generateEnvMapBlendingDefine(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case MultiplyOperation:e="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:e="ENVMAP_BLENDING_MIX";break;case AddOperation:e="ENVMAP_BLENDING_ADD";break}return e}function generateCubeUVSize(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function WebGLProgram(r,e,t,n){const i=r.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=generateShadowMapTypeDefine(t),d=generateEnvMapTypeDefine(t),u=generateEnvMapModeDefine(t),g=generateEnvMapBlendingDefine(t),x=generateCubeUVSize(t),y=t.isWebGL2?"":generateExtensions(t),b=generateDefines(s),_=i.createProgram();let h,f,E=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(h=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b].filter(filterEmptyLine).join(`
`),h.length>0&&(h+=`
`),f=[y,"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b].filter(filterEmptyLine).join(`
`),f.length>0&&(f+=`
`)):(h=[generatePrecision(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),f=[y,generatePrecision(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,b,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.envMap?"#define "+u:"",t.envMap?"#define "+g:"",x?"#define CUBEUV_TEXEL_WIDTH "+x.texelWidth:"",x?"#define CUBEUV_TEXEL_HEIGHT "+x.texelHeight:"",x?"#define CUBEUV_MAX_MIP "+x.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",t.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",t.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),o=resolveIncludes(o),o=replaceLightNums(o,t),o=replaceClippingPlaneNums(o,t),a=resolveIncludes(a),a=replaceLightNums(a,t),a=replaceClippingPlaneNums(a,t),o=unrollLoops(o),a=unrollLoops(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(E=`#version 300 es
`,h=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+h,f=["precision mediump sampler2DArray;","#define varying in",t.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+f);const m=E+h+o,S=E+f+a,w=WebGLShader(i,i.VERTEX_SHADER,m),v=WebGLShader(i,i.FRAGMENT_SHADER,S);i.attachShader(_,w),i.attachShader(_,v),t.index0AttributeName!==void 0?i.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(_,0,"position"),i.linkProgram(_);function A(P){if(r.debug.checkShaderErrors){const L=i.getProgramInfoLog(_).trim(),O=i.getShaderInfoLog(w).trim(),I=i.getShaderInfoLog(v).trim();let N=!0,k=!0;if(i.getProgramParameter(_,i.LINK_STATUS)===!1)if(N=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,_,w,v);else{const U=getShaderErrors(i,w,"vertex"),F=getShaderErrors(i,v,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(_,i.VALIDATE_STATUS)+`

Program Info Log: `+L+`
`+U+`
`+F)}else L!==""?console.warn("THREE.WebGLProgram: Program Info Log:",L):(O===""||I==="")&&(k=!1);k&&(P.diagnostics={runnable:N,programLog:L,vertexShader:{log:O,prefix:h},fragmentShader:{log:I,prefix:f}})}i.deleteShader(w),i.deleteShader(v),M=new WebGLUniforms(i,_),T=fetchAttributeLocations(i,_)}let M;this.getUniforms=function(){return M===void 0&&A(this),M};let T;this.getAttributes=function(){return T===void 0&&A(this),T};let R=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return R===!1&&(R=i.getProgramParameter(_,COMPLETION_STATUS_KHR)),R},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=programIdCount++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=w,this.fragmentShader=v,this}let _id$1=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new WebGLShaderStage(e),t.set(e,n)),n}}class WebGLShaderStage{constructor(e){this.id=_id$1++,this.code=e,this.usedTimes=0}}function WebGLPrograms(r,e,t,n,i,s,o){const a=new Layers,l=new WebGLShaderCache,d=[],u=i.isWebGL2,g=i.logarithmicDepthBuffer,x=i.vertexTextures;let y=i.precision;const b={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(T){return T===0?"uv":`uv${T}`}function h(T,R,P,L,O){const I=L.fog,N=O.geometry,k=T.isMeshStandardMaterial?L.environment:null,U=(T.isMeshStandardMaterial?t:e).get(T.envMap||k),F=U&&U.mapping===CubeUVReflectionMapping?U.image.height:null,j=b[T.type];T.precision!==null&&(y=i.getMaxPrecision(T.precision),y!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",y,"instead."));const H=N.morphAttributes.position||N.morphAttributes.normal||N.morphAttributes.color,B=H!==void 0?H.length:0;let V=0;N.morphAttributes.position!==void 0&&(V=1),N.morphAttributes.normal!==void 0&&(V=2),N.morphAttributes.color!==void 0&&(V=3);let K,q,Te,Fe;if(j){const I0=ShaderLib[j];K=I0.vertexShader,q=I0.fragmentShader}else K=T.vertexShader,q=T.fragmentShader,l.update(T),Te=l.getVertexShaderID(T),Fe=l.getFragmentShaderID(T);const We=r.getRenderTarget(),J=O.isInstancedMesh===!0,et=!!T.map,ht=!!T.matcap,er=!!U,tr=!!T.aoMap,Hm=!!T.lightMap,oi=!!T.bumpMap,h0=!!T.normalMap,l0=!!T.displacementMap,M0=!!T.emissiveMap,U0=!!T.metalnessMap,_0=!!T.roughnessMap,C0=T.anisotropy>0,P0=T.clearcoat>0,R0=T.iridescence>0,si=T.sheen>0,Xe=T.transmission>0,d0=C0&&!!T.anisotropyMap,w0=P0&&!!T.clearcoatMap,Q=P0&&!!T.clearcoatNormalMap,it=P0&&!!T.clearcoatRoughnessMap,ec=R0&&!!T.iridescenceMap,a0=R0&&!!T.iridescenceThicknessMap,u0=si&&!!T.sheenColorMap,E0=si&&!!T.sheenRoughnessMap,O0=!!T.specularMap,He=!!T.specularColorMap,p0=!!T.specularIntensityMap,x0=Xe&&!!T.transmissionMap,L0=Xe&&!!T.thicknessMap,c0=!!T.gradientMap,b0=!!T.alphaMap,ut=T.alphaTest>0,hi=!!T.alphaHash,S0=!!T.extensions,W=!!N.attributes.uv1,t0=!!N.attributes.uv2,o0=!!N.attributes.uv3;let Ji=NoToneMapping;return T.toneMapped&&(We===null||We.isXRRenderTarget===!0)&&(Ji=r.toneMapping),{isWebGL2:u,shaderID:j,shaderType:T.type,shaderName:T.name,vertexShader:K,fragmentShader:q,defines:T.defines,customVertexShaderID:Te,customFragmentShaderID:Fe,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:y,instancing:J,instancingColor:J&&O.instanceColor!==null,supportsVertexTextures:x,outputColorSpace:We===null?r.outputColorSpace:We.isXRRenderTarget===!0?We.texture.colorSpace:LinearSRGBColorSpace,map:et,matcap:ht,envMap:er,envMapMode:er&&U.mapping,envMapCubeUVHeight:F,aoMap:tr,lightMap:Hm,bumpMap:oi,normalMap:h0,displacementMap:x&&l0,emissiveMap:M0,normalMapObjectSpace:h0&&T.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:h0&&T.normalMapType===TangentSpaceNormalMap,metalnessMap:U0,roughnessMap:_0,anisotropy:C0,anisotropyMap:d0,clearcoat:P0,clearcoatMap:w0,clearcoatNormalMap:Q,clearcoatRoughnessMap:it,iridescence:R0,iridescenceMap:ec,iridescenceThicknessMap:a0,sheen:si,sheenColorMap:u0,sheenRoughnessMap:E0,specularMap:O0,specularColorMap:He,specularIntensityMap:p0,transmission:Xe,transmissionMap:x0,thicknessMap:L0,gradientMap:c0,opaque:T.transparent===!1&&T.blending===NormalBlending,alphaMap:b0,alphaTest:ut,alphaHash:hi,combine:T.combine,mapUv:et&&_(T.map.channel),aoMapUv:tr&&_(T.aoMap.channel),lightMapUv:Hm&&_(T.lightMap.channel),bumpMapUv:oi&&_(T.bumpMap.channel),normalMapUv:h0&&_(T.normalMap.channel),displacementMapUv:l0&&_(T.displacementMap.channel),emissiveMapUv:M0&&_(T.emissiveMap.channel),metalnessMapUv:U0&&_(T.metalnessMap.channel),roughnessMapUv:_0&&_(T.roughnessMap.channel),anisotropyMapUv:d0&&_(T.anisotropyMap.channel),clearcoatMapUv:w0&&_(T.clearcoatMap.channel),clearcoatNormalMapUv:Q&&_(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:it&&_(T.clearcoatRoughnessMap.channel),iridescenceMapUv:ec&&_(T.iridescenceMap.channel),iridescenceThicknessMapUv:a0&&_(T.iridescenceThicknessMap.channel),sheenColorMapUv:u0&&_(T.sheenColorMap.channel),sheenRoughnessMapUv:E0&&_(T.sheenRoughnessMap.channel),specularMapUv:O0&&_(T.specularMap.channel),specularColorMapUv:He&&_(T.specularColorMap.channel),specularIntensityMapUv:p0&&_(T.specularIntensityMap.channel),transmissionMapUv:x0&&_(T.transmissionMap.channel),thicknessMapUv:L0&&_(T.thicknessMap.channel),alphaMapUv:b0&&_(T.alphaMap.channel),vertexTangents:!!N.attributes.tangent&&(h0||C0),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!N.attributes.color&&N.attributes.color.itemSize===4,vertexUv1s:W,vertexUv2s:t0,vertexUv3s:o0,pointsUvs:O.isPoints===!0&&!!N.attributes.uv&&(et||b0),fog:!!I,useFog:T.fog===!0,fogExp2:I&&I.isFogExp2,flatShading:T.flatShading===!0,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:g,skinning:O.isSkinnedMesh===!0,morphTargets:N.morphAttributes.position!==void 0,morphNormals:N.morphAttributes.normal!==void 0,morphColors:N.morphAttributes.color!==void 0,morphTargetsCount:B,morphTextureStride:V,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:T.dithering,shadowMapEnabled:r.shadowMap.enabled&&P.length>0,shadowMapType:r.shadowMap.type,toneMapping:Ji,useLegacyLights:r._useLegacyLights,decodeVideoTexture:et&&T.map.isVideoTexture===!0&&ColorManagement.getTransfer(T.map.colorSpace)===SRGBTransfer,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===DoubleSide,flipSided:T.side===BackSide,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionDerivatives:S0&&T.extensions.derivatives===!0,extensionFragDepth:S0&&T.extensions.fragDepth===!0,extensionDrawBuffers:S0&&T.extensions.drawBuffers===!0,extensionShaderTextureLOD:S0&&T.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()}}function f(T){const R=[];if(T.shaderID?R.push(T.shaderID):(R.push(T.customVertexShaderID),R.push(T.customFragmentShaderID)),T.defines!==void 0)for(const P in T.defines)R.push(P),R.push(T.defines[P]);return T.isRawShaderMaterial===!1&&(E(R,T),m(R,T),R.push(r.outputColorSpace)),R.push(T.customProgramCacheKey),R.join()}function E(T,R){T.push(R.precision),T.push(R.outputColorSpace),T.push(R.envMapMode),T.push(R.envMapCubeUVHeight),T.push(R.mapUv),T.push(R.alphaMapUv),T.push(R.lightMapUv),T.push(R.aoMapUv),T.push(R.bumpMapUv),T.push(R.normalMapUv),T.push(R.displacementMapUv),T.push(R.emissiveMapUv),T.push(R.metalnessMapUv),T.push(R.roughnessMapUv),T.push(R.anisotropyMapUv),T.push(R.clearcoatMapUv),T.push(R.clearcoatNormalMapUv),T.push(R.clearcoatRoughnessMapUv),T.push(R.iridescenceMapUv),T.push(R.iridescenceThicknessMapUv),T.push(R.sheenColorMapUv),T.push(R.sheenRoughnessMapUv),T.push(R.specularMapUv),T.push(R.specularColorMapUv),T.push(R.specularIntensityMapUv),T.push(R.transmissionMapUv),T.push(R.thicknessMapUv),T.push(R.combine),T.push(R.fogExp2),T.push(R.sizeAttenuation),T.push(R.morphTargetsCount),T.push(R.morphAttributeCount),T.push(R.numDirLights),T.push(R.numPointLights),T.push(R.numSpotLights),T.push(R.numSpotLightMaps),T.push(R.numHemiLights),T.push(R.numRectAreaLights),T.push(R.numDirLightShadows),T.push(R.numPointLightShadows),T.push(R.numSpotLightShadows),T.push(R.numSpotLightShadowsWithMaps),T.push(R.numLightProbes),T.push(R.shadowMapType),T.push(R.toneMapping),T.push(R.numClippingPlanes),T.push(R.numClipIntersection),T.push(R.depthPacking)}function m(T,R){a.disableAll(),R.isWebGL2&&a.enable(0),R.supportsVertexTextures&&a.enable(1),R.instancing&&a.enable(2),R.instancingColor&&a.enable(3),R.matcap&&a.enable(4),R.envMap&&a.enable(5),R.normalMapObjectSpace&&a.enable(6),R.normalMapTangentSpace&&a.enable(7),R.clearcoat&&a.enable(8),R.iridescence&&a.enable(9),R.alphaTest&&a.enable(10),R.vertexColors&&a.enable(11),R.vertexAlphas&&a.enable(12),R.vertexUv1s&&a.enable(13),R.vertexUv2s&&a.enable(14),R.vertexUv3s&&a.enable(15),R.vertexTangents&&a.enable(16),R.anisotropy&&a.enable(17),R.alphaHash&&a.enable(18),T.push(a.mask),a.disableAll(),R.fog&&a.enable(0),R.useFog&&a.enable(1),R.flatShading&&a.enable(2),R.logarithmicDepthBuffer&&a.enable(3),R.skinning&&a.enable(4),R.morphTargets&&a.enable(5),R.morphNormals&&a.enable(6),R.morphColors&&a.enable(7),R.premultipliedAlpha&&a.enable(8),R.shadowMapEnabled&&a.enable(9),R.useLegacyLights&&a.enable(10),R.doubleSided&&a.enable(11),R.flipSided&&a.enable(12),R.useDepthPacking&&a.enable(13),R.dithering&&a.enable(14),R.transmission&&a.enable(15),R.sheen&&a.enable(16),R.opaque&&a.enable(17),R.pointsUvs&&a.enable(18),R.decodeVideoTexture&&a.enable(19),T.push(a.mask)}function S(T){const R=b[T.type];let P;if(R){const L=ShaderLib[R];P=UniformsUtils.clone(L.uniforms)}else P=T.uniforms;return P}function w(T,R){let P;for(let L=0,O=d.length;L<O;L++){const I=d[L];if(I.cacheKey===R){P=I,++P.usedTimes;break}}return P===void 0&&(P=new WebGLProgram(r,R,T,s),d.push(P)),P}function v(T){if(--T.usedTimes===0){const R=d.indexOf(T);d[R]=d[d.length-1],d.pop(),T.destroy()}}function A(T){l.remove(T)}function M(){l.dispose()}return{getParameters:h,getProgramCacheKey:f,getUniforms:S,acquireProgram:w,releaseProgram:v,releaseShaderCache:A,programs:d,dispose:M}}function WebGLProperties(){let r=new WeakMap;function e(s){let o=r.get(s);return o===void 0&&(o={},r.set(s,o)),o}function t(s){r.delete(s)}function n(s,o,a){r.get(s)[o]=a}function i(){r=new WeakMap}return{get:e,remove:t,update:n,dispose:i}}function painterSortStable(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function reversePainterSortStable(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function WebGLRenderList(){const r=[];let e=0;const t=[],n=[],i=[];function s(){e=0,t.length=0,n.length=0,i.length=0}function o(g,x,y,b,_,h){let f=r[e];return f===void 0?(f={id:g.id,object:g,geometry:x,material:y,groupOrder:b,renderOrder:g.renderOrder,z:_,group:h},r[e]=f):(f.id=g.id,f.object=g,f.geometry=x,f.material=y,f.groupOrder=b,f.renderOrder=g.renderOrder,f.z=_,f.group=h),e++,f}function a(g,x,y,b,_,h){const f=o(g,x,y,b,_,h);y.transmission>0?n.push(f):y.transparent===!0?i.push(f):t.push(f)}function l(g,x,y,b,_,h){const f=o(g,x,y,b,_,h);y.transmission>0?n.unshift(f):y.transparent===!0?i.unshift(f):t.unshift(f)}function d(g,x){t.length>1&&t.sort(g||painterSortStable),n.length>1&&n.sort(x||reversePainterSortStable),i.length>1&&i.sort(x||reversePainterSortStable)}function u(){for(let g=e,x=r.length;g<x;g++){const y=r[g];if(y.id===null)break;y.id=null,y.object=null,y.geometry=null,y.material=null,y.group=null}}return{opaque:t,transmissive:n,transparent:i,init:s,push:a,unshift:l,finish:u,sort:d}}function WebGLRenderLists(){let r=new WeakMap;function e(n,i){const s=r.get(n);let o;return s===void 0?(o=new WebGLRenderList,r.set(n,[o])):i>=s.length?(o=new WebGLRenderList,s.push(o)):o=s[i],o}function t(){r=new WeakMap}return{get:e,dispose:t}}function UniformsCache(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Vector3,color:new Color};break;case"SpotLight":t={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":t={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break}return r[e.id]=t,t}}}function ShadowUniformsCache(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function WebGLLights(r,e){const t=new UniformsCache,n=ShadowUniformsCache(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)i.probe.push(new Vector3);const s=new Vector3,o=new Matrix4,a=new Matrix4;function l(u,g){let x=0,y=0,b=0;for(let L=0;L<9;L++)i.probe[L].set(0,0,0);let _=0,h=0,f=0,E=0,m=0,S=0,w=0,v=0,A=0,M=0,T=0;u.sort(shadowCastingAndTexturingLightsFirst);const R=g===!0?Math.PI:1;for(let L=0,O=u.length;L<O;L++){const I=u[L],N=I.color,k=I.intensity,U=I.distance,F=I.shadow&&I.shadow.map?I.shadow.map.texture:null;if(I.isAmbientLight)x+=N.r*k*R,y+=N.g*k*R,b+=N.b*k*R;else if(I.isLightProbe){for(let j=0;j<9;j++)i.probe[j].addScaledVector(I.sh.coefficients[j],k);T++}else if(I.isDirectionalLight){const j=t.get(I);if(j.color.copy(I.color).multiplyScalar(I.intensity*R),I.castShadow){const H=I.shadow,B=n.get(I);B.shadowBias=H.bias,B.shadowNormalBias=H.normalBias,B.shadowRadius=H.radius,B.shadowMapSize=H.mapSize,i.directionalShadow[_]=B,i.directionalShadowMap[_]=F,i.directionalShadowMatrix[_]=I.shadow.matrix,S++}i.directional[_]=j,_++}else if(I.isSpotLight){const j=t.get(I);j.position.setFromMatrixPosition(I.matrixWorld),j.color.copy(N).multiplyScalar(k*R),j.distance=U,j.coneCos=Math.cos(I.angle),j.penumbraCos=Math.cos(I.angle*(1-I.penumbra)),j.decay=I.decay,i.spot[f]=j;const H=I.shadow;if(I.map&&(i.spotLightMap[A]=I.map,A++,H.updateMatrices(I),I.castShadow&&M++),i.spotLightMatrix[f]=H.matrix,I.castShadow){const B=n.get(I);B.shadowBias=H.bias,B.shadowNormalBias=H.normalBias,B.shadowRadius=H.radius,B.shadowMapSize=H.mapSize,i.spotShadow[f]=B,i.spotShadowMap[f]=F,v++}f++}else if(I.isRectAreaLight){const j=t.get(I);j.color.copy(N).multiplyScalar(k),j.halfWidth.set(I.width*.5,0,0),j.halfHeight.set(0,I.height*.5,0),i.rectArea[E]=j,E++}else if(I.isPointLight){const j=t.get(I);if(j.color.copy(I.color).multiplyScalar(I.intensity*R),j.distance=I.distance,j.decay=I.decay,I.castShadow){const H=I.shadow,B=n.get(I);B.shadowBias=H.bias,B.shadowNormalBias=H.normalBias,B.shadowRadius=H.radius,B.shadowMapSize=H.mapSize,B.shadowCameraNear=H.camera.near,B.shadowCameraFar=H.camera.far,i.pointShadow[h]=B,i.pointShadowMap[h]=F,i.pointShadowMatrix[h]=I.shadow.matrix,w++}i.point[h]=j,h++}else if(I.isHemisphereLight){const j=t.get(I);j.skyColor.copy(I.color).multiplyScalar(k*R),j.groundColor.copy(I.groundColor).multiplyScalar(k*R),i.hemi[m]=j,m++}}E>0&&(e.isWebGL2||r.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,i.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):r.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=UniformsLib.LTC_HALF_1,i.rectAreaLTC2=UniformsLib.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=x,i.ambient[1]=y,i.ambient[2]=b;const P=i.hash;(P.directionalLength!==_||P.pointLength!==h||P.spotLength!==f||P.rectAreaLength!==E||P.hemiLength!==m||P.numDirectionalShadows!==S||P.numPointShadows!==w||P.numSpotShadows!==v||P.numSpotMaps!==A||P.numLightProbes!==T)&&(i.directional.length=_,i.spot.length=f,i.rectArea.length=E,i.point.length=h,i.hemi.length=m,i.directionalShadow.length=S,i.directionalShadowMap.length=S,i.pointShadow.length=w,i.pointShadowMap.length=w,i.spotShadow.length=v,i.spotShadowMap.length=v,i.directionalShadowMatrix.length=S,i.pointShadowMatrix.length=w,i.spotLightMatrix.length=v+A-M,i.spotLightMap.length=A,i.numSpotLightShadowsWithMaps=M,i.numLightProbes=T,P.directionalLength=_,P.pointLength=h,P.spotLength=f,P.rectAreaLength=E,P.hemiLength=m,P.numDirectionalShadows=S,P.numPointShadows=w,P.numSpotShadows=v,P.numSpotMaps=A,P.numLightProbes=T,i.version=nextVersion++)}function d(u,g){let x=0,y=0,b=0,_=0,h=0;const f=g.matrixWorldInverse;for(let E=0,m=u.length;E<m;E++){const S=u[E];if(S.isDirectionalLight){const w=i.directional[x];w.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(f),x++}else if(S.isSpotLight){const w=i.spot[b];w.position.setFromMatrixPosition(S.matrixWorld),w.position.applyMatrix4(f),w.direction.setFromMatrixPosition(S.matrixWorld),s.setFromMatrixPosition(S.target.matrixWorld),w.direction.sub(s),w.direction.transformDirection(f),b++}else if(S.isRectAreaLight){const w=i.rectArea[_];w.position.setFromMatrixPosition(S.matrixWorld),w.position.applyMatrix4(f),a.identity(),o.copy(S.matrixWorld),o.premultiply(f),a.extractRotation(o),w.halfWidth.set(S.width*.5,0,0),w.halfHeight.set(0,S.height*.5,0),w.halfWidth.applyMatrix4(a),w.halfHeight.applyMatrix4(a),_++}else if(S.isPointLight){const w=i.point[y];w.position.setFromMatrixPosition(S.matrixWorld),w.position.applyMatrix4(f),y++}else if(S.isHemisphereLight){const w=i.hemi[h];w.direction.setFromMatrixPosition(S.matrixWorld),w.direction.transformDirection(f),h++}}}return{setup:l,setupView:d,state:i}}function WebGLRenderState(r,e){const t=new WebGLLights(r,e),n=[],i=[];function s(){n.length=0,i.length=0}function o(g){n.push(g)}function a(g){i.push(g)}function l(g){t.setup(n,g)}function d(g){t.setupView(n,g)}return{init:s,state:{lightsArray:n,shadowsArray:i,lights:t},setupLights:l,setupLightsView:d,pushLight:o,pushShadow:a}}function WebGLRenderStates(r,e){let t=new WeakMap;function n(s,o=0){const a=t.get(s);let l;return a===void 0?(l=new WebGLRenderState(r,e),t.set(s,[l])):o>=a.length?(l=new WebGLRenderState(r,e),a.push(l)):l=a[o],l}function i(){t=new WeakMap}return{get:n,dispose:i}}class MeshDepthMaterial extends Material{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(r,e,t){let n=new Frustum;const i=new Vector2,s=new Vector2,o=new Vector4,a=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),l=new MeshDistanceMaterial,d={},u=t.maxTextureSize,g={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},x=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),y=x.clone();y.defines.HORIZONTAL_PASS=1;const b=new BufferGeometry;b.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new Mesh(b,x),h=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let f=this.type;this.render=function(w,v,A){if(h.enabled===!1||h.autoUpdate===!1&&h.needsUpdate===!1||w.length===0)return;const M=r.getRenderTarget(),T=r.getActiveCubeFace(),R=r.getActiveMipmapLevel(),P=r.state;P.setBlending(NoBlending),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);const L=f!==VSMShadowMap&&this.type===VSMShadowMap,O=f===VSMShadowMap&&this.type!==VSMShadowMap;for(let I=0,N=w.length;I<N;I++){const k=w[I],U=k.shadow;if(U===void 0){console.warn("THREE.WebGLShadowMap:",k,"has no shadow.");continue}if(U.autoUpdate===!1&&U.needsUpdate===!1)continue;i.copy(U.mapSize);const F=U.getFrameExtents();if(i.multiply(F),s.copy(U.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/F.x),i.x=s.x*F.x,U.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/F.y),i.y=s.y*F.y,U.mapSize.y=s.y)),U.map===null||L===!0||O===!0){const H=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};U.map!==null&&U.map.dispose(),U.map=new WebGLRenderTarget(i.x,i.y,H),U.map.texture.name=k.name+".shadowMap",U.camera.updateProjectionMatrix()}r.setRenderTarget(U.map),r.clear();const j=U.getViewportCount();for(let H=0;H<j;H++){const B=U.getViewport(H);o.set(s.x*B.x,s.y*B.y,s.x*B.z,s.y*B.w),P.viewport(o),U.updateMatrices(k,H),n=U.getFrustum(),S(v,A,U.camera,k,this.type)}U.isPointLightShadow!==!0&&this.type===VSMShadowMap&&E(U,A),U.needsUpdate=!1}f=this.type,h.needsUpdate=!1,r.setRenderTarget(M,T,R)};function E(w,v){const A=e.update(_);x.defines.VSM_SAMPLES!==w.blurSamples&&(x.defines.VSM_SAMPLES=w.blurSamples,y.defines.VSM_SAMPLES=w.blurSamples,x.needsUpdate=!0,y.needsUpdate=!0),w.mapPass===null&&(w.mapPass=new WebGLRenderTarget(i.x,i.y)),x.uniforms.shadow_pass.value=w.map.texture,x.uniforms.resolution.value=w.mapSize,x.uniforms.radius.value=w.radius,r.setRenderTarget(w.mapPass),r.clear(),r.renderBufferDirect(v,null,A,x,_,null),y.uniforms.shadow_pass.value=w.mapPass.texture,y.uniforms.resolution.value=w.mapSize,y.uniforms.radius.value=w.radius,r.setRenderTarget(w.map),r.clear(),r.renderBufferDirect(v,null,A,y,_,null)}function m(w,v,A,M){let T=null;const R=A.isPointLight===!0?w.customDistanceMaterial:w.customDepthMaterial;if(R!==void 0)T=R;else if(T=A.isPointLight===!0?l:a,r.localClippingEnabled&&v.clipShadows===!0&&Array.isArray(v.clippingPlanes)&&v.clippingPlanes.length!==0||v.displacementMap&&v.displacementScale!==0||v.alphaMap&&v.alphaTest>0||v.map&&v.alphaTest>0){const P=T.uuid,L=v.uuid;let O=d[P];O===void 0&&(O={},d[P]=O);let I=O[L];I===void 0&&(I=T.clone(),O[L]=I),T=I}if(T.visible=v.visible,T.wireframe=v.wireframe,M===VSMShadowMap?T.side=v.shadowSide!==null?v.shadowSide:v.side:T.side=v.shadowSide!==null?v.shadowSide:g[v.side],T.alphaMap=v.alphaMap,T.alphaTest=v.alphaTest,T.map=v.map,T.clipShadows=v.clipShadows,T.clippingPlanes=v.clippingPlanes,T.clipIntersection=v.clipIntersection,T.displacementMap=v.displacementMap,T.displacementScale=v.displacementScale,T.displacementBias=v.displacementBias,T.wireframeLinewidth=v.wireframeLinewidth,T.linewidth=v.linewidth,A.isPointLight===!0&&T.isMeshDistanceMaterial===!0){const P=r.properties.get(T);P.light=A}return T}function S(w,v,A,M,T){if(w.visible===!1)return;if(w.layers.test(v.layers)&&(w.isMesh||w.isLine||w.isPoints)&&(w.castShadow||w.receiveShadow&&T===VSMShadowMap)&&(!w.frustumCulled||n.intersectsObject(w))){w.modelViewMatrix.multiplyMatrices(A.matrixWorldInverse,w.matrixWorld);const L=e.update(w),O=w.material;if(Array.isArray(O)){const I=L.groups;for(let N=0,k=I.length;N<k;N++){const U=I[N],F=O[U.materialIndex];if(F&&F.visible){const j=m(w,F,M,T);r.renderBufferDirect(A,null,L,j,w,U)}}}else if(O.visible){const I=m(w,O,M,T);r.renderBufferDirect(A,null,L,I,w,null)}}const P=w.children;for(let L=0,O=P.length;L<O;L++)S(P[L],v,A,M,T)}}function WebGLState(r,e,t){const n=t.isWebGL2;function i(){let hi=!1;const S0=new Vector4;let W=null;const t0=new Vector4(0,0,0,0);return{setMask:function(o0){W!==o0&&!hi&&(r.colorMask(o0,o0,o0,o0),W=o0)},setLocked:function(o0){hi=o0},setClear:function(o0,Ji,m0,I0,Z){Z===!0&&(o0*=I0,Ji*=I0,m0*=I0),S0.set(o0,Ji,m0,I0),t0.equals(S0)===!1&&(r.clearColor(o0,Ji,m0,I0),t0.copy(S0))},reset:function(){hi=!1,W=null,t0.set(-1,0,0,0)}}}function s(){let hi=!1,S0=null,W=null,t0=null;return{setTest:function(o0){o0?et(r.DEPTH_TEST):ht(r.DEPTH_TEST)},setMask:function(o0){S0!==o0&&!hi&&(r.depthMask(o0),S0=o0)},setFunc:function(o0){if(W!==o0){switch(o0){case NeverDepth:r.depthFunc(r.NEVER);break;case AlwaysDepth:r.depthFunc(r.ALWAYS);break;case LessDepth:r.depthFunc(r.LESS);break;case LessEqualDepth:r.depthFunc(r.LEQUAL);break;case EqualDepth:r.depthFunc(r.EQUAL);break;case GreaterEqualDepth:r.depthFunc(r.GEQUAL);break;case GreaterDepth:r.depthFunc(r.GREATER);break;case NotEqualDepth:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}W=o0}},setLocked:function(o0){hi=o0},setClear:function(o0){t0!==o0&&(r.clearDepth(o0),t0=o0)},reset:function(){hi=!1,S0=null,W=null,t0=null}}}function o(){let hi=!1,S0=null,W=null,t0=null,o0=null,Ji=null,m0=null,I0=null,Z=null;return{setTest:function(at){hi||(at?et(r.STENCIL_TEST):ht(r.STENCIL_TEST))},setMask:function(at){S0!==at&&!hi&&(r.stencilMask(at),S0=at)},setFunc:function(at,lt,n0){(W!==at||t0!==lt||o0!==n0)&&(r.stencilFunc(at,lt,n0),W=at,t0=lt,o0=n0)},setOp:function(at,lt,n0){(Ji!==at||m0!==lt||I0!==n0)&&(r.stencilOp(at,lt,n0),Ji=at,m0=lt,I0=n0)},setLocked:function(at){hi=at},setClear:function(at){Z!==at&&(r.clearStencil(at),Z=at)},reset:function(){hi=!1,S0=null,W=null,t0=null,o0=null,Ji=null,m0=null,I0=null,Z=null}}}const a=new i,l=new s,d=new o,u=new WeakMap,g=new WeakMap;let x={},y={},b=new WeakMap,_=[],h=null,f=!1,E=null,m=null,S=null,w=null,v=null,A=null,M=null,T=new Color(0,0,0),R=0,P=!1,L=null,O=null,I=null,N=null,k=null;const U=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,j=0;const H=r.getParameter(r.VERSION);H.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(H)[1]),F=j>=1):H.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(H)[1]),F=j>=2);let B=null,V={};const K=r.getParameter(r.SCISSOR_BOX),q=r.getParameter(r.VIEWPORT),Te=new Vector4().fromArray(K),Fe=new Vector4().fromArray(q);function We(hi,S0,W,t0){const o0=new Uint8Array(4),Ji=r.createTexture();r.bindTexture(hi,Ji),r.texParameteri(hi,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(hi,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let m0=0;m0<W;m0++)n&&(hi===r.TEXTURE_3D||hi===r.TEXTURE_2D_ARRAY)?r.texImage3D(S0,0,r.RGBA,1,1,t0,0,r.RGBA,r.UNSIGNED_BYTE,o0):r.texImage2D(S0+m0,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,o0);return Ji}const J={};J[r.TEXTURE_2D]=We(r.TEXTURE_2D,r.TEXTURE_2D,1),J[r.TEXTURE_CUBE_MAP]=We(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(J[r.TEXTURE_2D_ARRAY]=We(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),J[r.TEXTURE_3D]=We(r.TEXTURE_3D,r.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),d.setClear(0),et(r.DEPTH_TEST),l.setFunc(LessEqualDepth),U0(!1),_0(CullFaceBack),et(r.CULL_FACE),l0(NoBlending);function et(hi){x[hi]!==!0&&(r.enable(hi),x[hi]=!0)}function ht(hi){x[hi]!==!1&&(r.disable(hi),x[hi]=!1)}function er(hi,S0){return y[hi]!==S0?(r.bindFramebuffer(hi,S0),y[hi]=S0,n&&(hi===r.DRAW_FRAMEBUFFER&&(y[r.FRAMEBUFFER]=S0),hi===r.FRAMEBUFFER&&(y[r.DRAW_FRAMEBUFFER]=S0)),!0):!1}function tr(hi,S0){let W=_,t0=!1;if(hi)if(W=b.get(S0),W===void 0&&(W=[],b.set(S0,W)),hi.isWebGLMultipleRenderTargets){const o0=hi.texture;if(W.length!==o0.length||W[0]!==r.COLOR_ATTACHMENT0){for(let Ji=0,m0=o0.length;Ji<m0;Ji++)W[Ji]=r.COLOR_ATTACHMENT0+Ji;W.length=o0.length,t0=!0}}else W[0]!==r.COLOR_ATTACHMENT0&&(W[0]=r.COLOR_ATTACHMENT0,t0=!0);else W[0]!==r.BACK&&(W[0]=r.BACK,t0=!0);t0&&(t.isWebGL2?r.drawBuffers(W):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(W))}function Hm(hi){return h!==hi?(r.useProgram(hi),h=hi,!0):!1}const oi={[AddEquation]:r.FUNC_ADD,[SubtractEquation]:r.FUNC_SUBTRACT,[ReverseSubtractEquation]:r.FUNC_REVERSE_SUBTRACT};if(n)oi[MinEquation]=r.MIN,oi[MaxEquation]=r.MAX;else{const hi=e.get("EXT_blend_minmax");hi!==null&&(oi[MinEquation]=hi.MIN_EXT,oi[MaxEquation]=hi.MAX_EXT)}const h0={[ZeroFactor]:r.ZERO,[OneFactor]:r.ONE,[SrcColorFactor]:r.SRC_COLOR,[SrcAlphaFactor]:r.SRC_ALPHA,[SrcAlphaSaturateFactor]:r.SRC_ALPHA_SATURATE,[DstColorFactor]:r.DST_COLOR,[DstAlphaFactor]:r.DST_ALPHA,[OneMinusSrcColorFactor]:r.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:r.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:r.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:r.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:r.CONSTANT_COLOR,[OneMinusConstantColorFactor]:r.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:r.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:r.ONE_MINUS_CONSTANT_ALPHA};function l0(hi,S0,W,t0,o0,Ji,m0,I0,Z,at){if(hi===NoBlending){f===!0&&(ht(r.BLEND),f=!1);return}if(f===!1&&(et(r.BLEND),f=!0),hi!==CustomBlending){if(hi!==E||at!==P){if((m!==AddEquation||v!==AddEquation)&&(r.blendEquation(r.FUNC_ADD),m=AddEquation,v=AddEquation),at)switch(hi){case NormalBlending:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:r.blendFunc(r.ONE,r.ONE);break;case SubtractiveBlending:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case MultiplyBlending:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",hi);break}else switch(hi){case NormalBlending:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case SubtractiveBlending:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case MultiplyBlending:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",hi);break}S=null,w=null,A=null,M=null,T.set(0,0,0),R=0,E=hi,P=at}return}o0=o0||S0,Ji=Ji||W,m0=m0||t0,(S0!==m||o0!==v)&&(r.blendEquationSeparate(oi[S0],oi[o0]),m=S0,v=o0),(W!==S||t0!==w||Ji!==A||m0!==M)&&(r.blendFuncSeparate(h0[W],h0[t0],h0[Ji],h0[m0]),S=W,w=t0,A=Ji,M=m0),(I0.equals(T)===!1||Z!==R)&&(r.blendColor(I0.r,I0.g,I0.b,Z),T.copy(I0),R=Z),E=hi,P=!1}function M0(hi,S0){hi.side===DoubleSide?ht(r.CULL_FACE):et(r.CULL_FACE);let W=hi.side===BackSide;S0&&(W=!W),U0(W),hi.blending===NormalBlending&&hi.transparent===!1?l0(NoBlending):l0(hi.blending,hi.blendEquation,hi.blendSrc,hi.blendDst,hi.blendEquationAlpha,hi.blendSrcAlpha,hi.blendDstAlpha,hi.blendColor,hi.blendAlpha,hi.premultipliedAlpha),l.setFunc(hi.depthFunc),l.setTest(hi.depthTest),l.setMask(hi.depthWrite),a.setMask(hi.colorWrite);const t0=hi.stencilWrite;d.setTest(t0),t0&&(d.setMask(hi.stencilWriteMask),d.setFunc(hi.stencilFunc,hi.stencilRef,hi.stencilFuncMask),d.setOp(hi.stencilFail,hi.stencilZFail,hi.stencilZPass)),P0(hi.polygonOffset,hi.polygonOffsetFactor,hi.polygonOffsetUnits),hi.alphaToCoverage===!0?et(r.SAMPLE_ALPHA_TO_COVERAGE):ht(r.SAMPLE_ALPHA_TO_COVERAGE)}function U0(hi){L!==hi&&(hi?r.frontFace(r.CW):r.frontFace(r.CCW),L=hi)}function _0(hi){hi!==CullFaceNone?(et(r.CULL_FACE),hi!==O&&(hi===CullFaceBack?r.cullFace(r.BACK):hi===CullFaceFront?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):ht(r.CULL_FACE),O=hi}function C0(hi){hi!==I&&(F&&r.lineWidth(hi),I=hi)}function P0(hi,S0,W){hi?(et(r.POLYGON_OFFSET_FILL),(N!==S0||k!==W)&&(r.polygonOffset(S0,W),N=S0,k=W)):ht(r.POLYGON_OFFSET_FILL)}function R0(hi){hi?et(r.SCISSOR_TEST):ht(r.SCISSOR_TEST)}function si(hi){hi===void 0&&(hi=r.TEXTURE0+U-1),B!==hi&&(r.activeTexture(hi),B=hi)}function Xe(hi,S0,W){W===void 0&&(B===null?W=r.TEXTURE0+U-1:W=B);let t0=V[W];t0===void 0&&(t0={type:void 0,texture:void 0},V[W]=t0),(t0.type!==hi||t0.texture!==S0)&&(B!==W&&(r.activeTexture(W),B=W),r.bindTexture(hi,S0||J[hi]),t0.type=hi,t0.texture=S0)}function d0(){const hi=V[B];hi!==void 0&&hi.type!==void 0&&(r.bindTexture(hi.type,null),hi.type=void 0,hi.texture=void 0)}function w0(){try{r.compressedTexImage2D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function Q(){try{r.compressedTexImage3D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function it(){try{r.texSubImage2D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function ec(){try{r.texSubImage3D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function a0(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function u0(){try{r.compressedTexSubImage3D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function E0(){try{r.texStorage2D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function O0(){try{r.texStorage3D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function He(){try{r.texImage2D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function p0(){try{r.texImage3D.apply(r,arguments)}catch(hi){console.error("THREE.WebGLState:",hi)}}function x0(hi){Te.equals(hi)===!1&&(r.scissor(hi.x,hi.y,hi.z,hi.w),Te.copy(hi))}function L0(hi){Fe.equals(hi)===!1&&(r.viewport(hi.x,hi.y,hi.z,hi.w),Fe.copy(hi))}function c0(hi,S0){let W=g.get(S0);W===void 0&&(W=new WeakMap,g.set(S0,W));let t0=W.get(hi);t0===void 0&&(t0=r.getUniformBlockIndex(S0,hi.name),W.set(hi,t0))}function b0(hi,S0){const t0=g.get(S0).get(hi);u.get(S0)!==t0&&(r.uniformBlockBinding(S0,t0,hi.__bindingPointIndex),u.set(S0,t0))}function ut(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),n===!0&&(r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),x={},B=null,V={},y={},b=new WeakMap,_=[],h=null,f=!1,E=null,m=null,S=null,w=null,v=null,A=null,M=null,T=new Color(0,0,0),R=0,P=!1,L=null,O=null,I=null,N=null,k=null,Te.set(0,0,r.canvas.width,r.canvas.height),Fe.set(0,0,r.canvas.width,r.canvas.height),a.reset(),l.reset(),d.reset()}return{buffers:{color:a,depth:l,stencil:d},enable:et,disable:ht,bindFramebuffer:er,drawBuffers:tr,useProgram:Hm,setBlending:l0,setMaterial:M0,setFlipSided:U0,setCullFace:_0,setLineWidth:C0,setPolygonOffset:P0,setScissorTest:R0,activeTexture:si,bindTexture:Xe,unbindTexture:d0,compressedTexImage2D:w0,compressedTexImage3D:Q,texImage2D:He,texImage3D:p0,updateUBOMapping:c0,uniformBlockBinding:b0,texStorage2D:E0,texStorage3D:O0,texSubImage2D:it,texSubImage3D:ec,compressedTexSubImage2D:a0,compressedTexSubImage3D:u0,scissor:x0,viewport:L0,reset:ut}}function WebGLTextures(r,e,t,n,i,s,o){const a=i.isWebGL2,l=i.maxTextures,d=i.maxCubemapSize,u=i.maxTextureSize,g=i.maxSamples,x=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,y=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),b=new WeakMap;let _;const h=new WeakMap;let f=!1;try{f=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function E(si,Xe){return f?new OffscreenCanvas(si,Xe):createElementNS("canvas")}function m(si,Xe,d0,w0){let Q=1;if((si.width>w0||si.height>w0)&&(Q=w0/Math.max(si.width,si.height)),Q<1||Xe===!0)if(typeof HTMLImageElement<"u"&&si instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&si instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&si instanceof ImageBitmap){const it=Xe?floorPowerOfTwo:Math.floor,ec=it(Q*si.width),a0=it(Q*si.height);_===void 0&&(_=E(ec,a0));const u0=d0?E(ec,a0):_;return u0.width=ec,u0.height=a0,u0.getContext("2d").drawImage(si,0,0,ec,a0),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+si.width+"x"+si.height+") to ("+ec+"x"+a0+")."),u0}else return"data"in si&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+si.width+"x"+si.height+")."),si;return si}function S(si){return isPowerOfTwo(si.width)&&isPowerOfTwo(si.height)}function w(si){return a?!1:si.wrapS!==ClampToEdgeWrapping||si.wrapT!==ClampToEdgeWrapping||si.minFilter!==NearestFilter&&si.minFilter!==LinearFilter}function v(si,Xe){return si.generateMipmaps&&Xe&&si.minFilter!==NearestFilter&&si.minFilter!==LinearFilter}function A(si){r.generateMipmap(si)}function M(si,Xe,d0,w0,Q=!1){if(a===!1)return Xe;if(si!==null){if(r[si]!==void 0)return r[si];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+si+"'")}let it=Xe;if(Xe===r.RED&&(d0===r.FLOAT&&(it=r.R32F),d0===r.HALF_FLOAT&&(it=r.R16F),d0===r.UNSIGNED_BYTE&&(it=r.R8)),Xe===r.RED_INTEGER&&(d0===r.UNSIGNED_BYTE&&(it=r.R8UI),d0===r.UNSIGNED_SHORT&&(it=r.R16UI),d0===r.UNSIGNED_INT&&(it=r.R32UI),d0===r.BYTE&&(it=r.R8I),d0===r.SHORT&&(it=r.R16I),d0===r.INT&&(it=r.R32I)),Xe===r.RG&&(d0===r.FLOAT&&(it=r.RG32F),d0===r.HALF_FLOAT&&(it=r.RG16F),d0===r.UNSIGNED_BYTE&&(it=r.RG8)),Xe===r.RGBA){const ec=Q?LinearTransfer:ColorManagement.getTransfer(w0);d0===r.FLOAT&&(it=r.RGBA32F),d0===r.HALF_FLOAT&&(it=r.RGBA16F),d0===r.UNSIGNED_BYTE&&(it=ec===SRGBTransfer?r.SRGB8_ALPHA8:r.RGBA8),d0===r.UNSIGNED_SHORT_4_4_4_4&&(it=r.RGBA4),d0===r.UNSIGNED_SHORT_5_5_5_1&&(it=r.RGB5_A1)}return(it===r.R16F||it===r.R32F||it===r.RG16F||it===r.RG32F||it===r.RGBA16F||it===r.RGBA32F)&&e.get("EXT_color_buffer_float"),it}function T(si,Xe,d0){return v(si,d0)===!0||si.isFramebufferTexture&&si.minFilter!==NearestFilter&&si.minFilter!==LinearFilter?Math.log2(Math.max(Xe.width,Xe.height))+1:si.mipmaps!==void 0&&si.mipmaps.length>0?si.mipmaps.length:si.isCompressedTexture&&Array.isArray(si.image)?Xe.mipmaps.length:1}function R(si){return si===NearestFilter||si===NearestMipmapNearestFilter||si===NearestMipmapLinearFilter?r.NEAREST:r.LINEAR}function P(si){const Xe=si.target;Xe.removeEventListener("dispose",P),O(Xe),Xe.isVideoTexture&&b.delete(Xe)}function L(si){const Xe=si.target;Xe.removeEventListener("dispose",L),N(Xe)}function O(si){const Xe=n.get(si);if(Xe.__webglInit===void 0)return;const d0=si.source,w0=h.get(d0);if(w0){const Q=w0[Xe.__cacheKey];Q.usedTimes--,Q.usedTimes===0&&I(si),Object.keys(w0).length===0&&h.delete(d0)}n.remove(si)}function I(si){const Xe=n.get(si);r.deleteTexture(Xe.__webglTexture);const d0=si.source,w0=h.get(d0);delete w0[Xe.__cacheKey],o.memory.textures--}function N(si){const Xe=si.texture,d0=n.get(si),w0=n.get(Xe);if(w0.__webglTexture!==void 0&&(r.deleteTexture(w0.__webglTexture),o.memory.textures--),si.depthTexture&&si.depthTexture.dispose(),si.isWebGLCubeRenderTarget)for(let Q=0;Q<6;Q++){if(Array.isArray(d0.__webglFramebuffer[Q]))for(let it=0;it<d0.__webglFramebuffer[Q].length;it++)r.deleteFramebuffer(d0.__webglFramebuffer[Q][it]);else r.deleteFramebuffer(d0.__webglFramebuffer[Q]);d0.__webglDepthbuffer&&r.deleteRenderbuffer(d0.__webglDepthbuffer[Q])}else{if(Array.isArray(d0.__webglFramebuffer))for(let Q=0;Q<d0.__webglFramebuffer.length;Q++)r.deleteFramebuffer(d0.__webglFramebuffer[Q]);else r.deleteFramebuffer(d0.__webglFramebuffer);if(d0.__webglDepthbuffer&&r.deleteRenderbuffer(d0.__webglDepthbuffer),d0.__webglMultisampledFramebuffer&&r.deleteFramebuffer(d0.__webglMultisampledFramebuffer),d0.__webglColorRenderbuffer)for(let Q=0;Q<d0.__webglColorRenderbuffer.length;Q++)d0.__webglColorRenderbuffer[Q]&&r.deleteRenderbuffer(d0.__webglColorRenderbuffer[Q]);d0.__webglDepthRenderbuffer&&r.deleteRenderbuffer(d0.__webglDepthRenderbuffer)}if(si.isWebGLMultipleRenderTargets)for(let Q=0,it=Xe.length;Q<it;Q++){const ec=n.get(Xe[Q]);ec.__webglTexture&&(r.deleteTexture(ec.__webglTexture),o.memory.textures--),n.remove(Xe[Q])}n.remove(Xe),n.remove(si)}let k=0;function U(){k=0}function F(){const si=k;return si>=l&&console.warn("THREE.WebGLTextures: Trying to use "+si+" texture units while this GPU supports only "+l),k+=1,si}function j(si){const Xe=[];return Xe.push(si.wrapS),Xe.push(si.wrapT),Xe.push(si.wrapR||0),Xe.push(si.magFilter),Xe.push(si.minFilter),Xe.push(si.anisotropy),Xe.push(si.internalFormat),Xe.push(si.format),Xe.push(si.type),Xe.push(si.generateMipmaps),Xe.push(si.premultiplyAlpha),Xe.push(si.flipY),Xe.push(si.unpackAlignment),Xe.push(si.colorSpace),Xe.join()}function H(si,Xe){const d0=n.get(si);if(si.isVideoTexture&&P0(si),si.isRenderTargetTexture===!1&&si.version>0&&d0.__version!==si.version){const w0=si.image;if(w0===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(w0.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{et(d0,si,Xe);return}}t.bindTexture(r.TEXTURE_2D,d0.__webglTexture,r.TEXTURE0+Xe)}function B(si,Xe){const d0=n.get(si);if(si.version>0&&d0.__version!==si.version){et(d0,si,Xe);return}t.bindTexture(r.TEXTURE_2D_ARRAY,d0.__webglTexture,r.TEXTURE0+Xe)}function V(si,Xe){const d0=n.get(si);if(si.version>0&&d0.__version!==si.version){et(d0,si,Xe);return}t.bindTexture(r.TEXTURE_3D,d0.__webglTexture,r.TEXTURE0+Xe)}function K(si,Xe){const d0=n.get(si);if(si.version>0&&d0.__version!==si.version){ht(d0,si,Xe);return}t.bindTexture(r.TEXTURE_CUBE_MAP,d0.__webglTexture,r.TEXTURE0+Xe)}const q={[RepeatWrapping]:r.REPEAT,[ClampToEdgeWrapping]:r.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:r.MIRRORED_REPEAT},Te={[NearestFilter]:r.NEAREST,[NearestMipmapNearestFilter]:r.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:r.NEAREST_MIPMAP_LINEAR,[LinearFilter]:r.LINEAR,[LinearMipmapNearestFilter]:r.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:r.LINEAR_MIPMAP_LINEAR},Fe={[NeverCompare]:r.NEVER,[AlwaysCompare]:r.ALWAYS,[LessCompare]:r.LESS,[LessEqualCompare]:r.LEQUAL,[EqualCompare]:r.EQUAL,[GreaterEqualCompare]:r.GEQUAL,[GreaterCompare]:r.GREATER,[NotEqualCompare]:r.NOTEQUAL};function We(si,Xe,d0){if(d0?(r.texParameteri(si,r.TEXTURE_WRAP_S,q[Xe.wrapS]),r.texParameteri(si,r.TEXTURE_WRAP_T,q[Xe.wrapT]),(si===r.TEXTURE_3D||si===r.TEXTURE_2D_ARRAY)&&r.texParameteri(si,r.TEXTURE_WRAP_R,q[Xe.wrapR]),r.texParameteri(si,r.TEXTURE_MAG_FILTER,Te[Xe.magFilter]),r.texParameteri(si,r.TEXTURE_MIN_FILTER,Te[Xe.minFilter])):(r.texParameteri(si,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(si,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(si===r.TEXTURE_3D||si===r.TEXTURE_2D_ARRAY)&&r.texParameteri(si,r.TEXTURE_WRAP_R,r.CLAMP_TO_EDGE),(Xe.wrapS!==ClampToEdgeWrapping||Xe.wrapT!==ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(si,r.TEXTURE_MAG_FILTER,R(Xe.magFilter)),r.texParameteri(si,r.TEXTURE_MIN_FILTER,R(Xe.minFilter)),Xe.minFilter!==NearestFilter&&Xe.minFilter!==LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),Xe.compareFunction&&(r.texParameteri(si,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(si,r.TEXTURE_COMPARE_FUNC,Fe[Xe.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){const w0=e.get("EXT_texture_filter_anisotropic");if(Xe.magFilter===NearestFilter||Xe.minFilter!==NearestMipmapLinearFilter&&Xe.minFilter!==LinearMipmapLinearFilter||Xe.type===FloatType&&e.has("OES_texture_float_linear")===!1||a===!1&&Xe.type===HalfFloatType&&e.has("OES_texture_half_float_linear")===!1)return;(Xe.anisotropy>1||n.get(Xe).__currentAnisotropy)&&(r.texParameterf(si,w0.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Xe.anisotropy,i.getMaxAnisotropy())),n.get(Xe).__currentAnisotropy=Xe.anisotropy)}}function J(si,Xe){let d0=!1;si.__webglInit===void 0&&(si.__webglInit=!0,Xe.addEventListener("dispose",P));const w0=Xe.source;let Q=h.get(w0);Q===void 0&&(Q={},h.set(w0,Q));const it=j(Xe);if(it!==si.__cacheKey){Q[it]===void 0&&(Q[it]={texture:r.createTexture(),usedTimes:0},o.memory.textures++,d0=!0),Q[it].usedTimes++;const ec=Q[si.__cacheKey];ec!==void 0&&(Q[si.__cacheKey].usedTimes--,ec.usedTimes===0&&I(Xe)),si.__cacheKey=it,si.__webglTexture=Q[it].texture}return d0}function et(si,Xe,d0){let w0=r.TEXTURE_2D;(Xe.isDataArrayTexture||Xe.isCompressedArrayTexture)&&(w0=r.TEXTURE_2D_ARRAY),Xe.isData3DTexture&&(w0=r.TEXTURE_3D);const Q=J(si,Xe),it=Xe.source;t.bindTexture(w0,si.__webglTexture,r.TEXTURE0+d0);const ec=n.get(it);if(it.version!==ec.__version||Q===!0){t.activeTexture(r.TEXTURE0+d0);const a0=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),u0=Xe.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(Xe.colorSpace),E0=Xe.colorSpace===NoColorSpace||a0===u0?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Xe.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Xe.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Xe.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,E0);const O0=w(Xe)&&S(Xe.image)===!1;let He=m(Xe.image,O0,!1,u);He=R0(Xe,He);const p0=S(He)||a,x0=s.convert(Xe.format,Xe.colorSpace);let L0=s.convert(Xe.type),c0=M(Xe.internalFormat,x0,L0,Xe.colorSpace,Xe.isVideoTexture);We(w0,Xe,p0);let b0;const ut=Xe.mipmaps,hi=a&&Xe.isVideoTexture!==!0,S0=ec.__version===void 0||Q===!0,W=T(Xe,He,p0);if(Xe.isDepthTexture)c0=r.DEPTH_COMPONENT,a?Xe.type===FloatType?c0=r.DEPTH_COMPONENT32F:Xe.type===UnsignedIntType?c0=r.DEPTH_COMPONENT24:Xe.type===UnsignedInt248Type?c0=r.DEPTH24_STENCIL8:c0=r.DEPTH_COMPONENT16:Xe.type===FloatType&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Xe.format===DepthFormat&&c0===r.DEPTH_COMPONENT&&Xe.type!==UnsignedShortType&&Xe.type!==UnsignedIntType&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Xe.type=UnsignedIntType,L0=s.convert(Xe.type)),Xe.format===DepthStencilFormat&&c0===r.DEPTH_COMPONENT&&(c0=r.DEPTH_STENCIL,Xe.type!==UnsignedInt248Type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Xe.type=UnsignedInt248Type,L0=s.convert(Xe.type))),S0&&(hi?t.texStorage2D(r.TEXTURE_2D,1,c0,He.width,He.height):t.texImage2D(r.TEXTURE_2D,0,c0,He.width,He.height,0,x0,L0,null));else if(Xe.isDataTexture)if(ut.length>0&&p0){hi&&S0&&t.texStorage2D(r.TEXTURE_2D,W,c0,ut[0].width,ut[0].height);for(let t0=0,o0=ut.length;t0<o0;t0++)b0=ut[t0],hi?t.texSubImage2D(r.TEXTURE_2D,t0,0,0,b0.width,b0.height,x0,L0,b0.data):t.texImage2D(r.TEXTURE_2D,t0,c0,b0.width,b0.height,0,x0,L0,b0.data);Xe.generateMipmaps=!1}else hi?(S0&&t.texStorage2D(r.TEXTURE_2D,W,c0,He.width,He.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,He.width,He.height,x0,L0,He.data)):t.texImage2D(r.TEXTURE_2D,0,c0,He.width,He.height,0,x0,L0,He.data);else if(Xe.isCompressedTexture)if(Xe.isCompressedArrayTexture){hi&&S0&&t.texStorage3D(r.TEXTURE_2D_ARRAY,W,c0,ut[0].width,ut[0].height,He.depth);for(let t0=0,o0=ut.length;t0<o0;t0++)b0=ut[t0],Xe.format!==RGBAFormat?x0!==null?hi?t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,t0,0,0,0,b0.width,b0.height,He.depth,x0,b0.data,0,0):t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,t0,c0,b0.width,b0.height,He.depth,0,b0.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):hi?t.texSubImage3D(r.TEXTURE_2D_ARRAY,t0,0,0,0,b0.width,b0.height,He.depth,x0,L0,b0.data):t.texImage3D(r.TEXTURE_2D_ARRAY,t0,c0,b0.width,b0.height,He.depth,0,x0,L0,b0.data)}else{hi&&S0&&t.texStorage2D(r.TEXTURE_2D,W,c0,ut[0].width,ut[0].height);for(let t0=0,o0=ut.length;t0<o0;t0++)b0=ut[t0],Xe.format!==RGBAFormat?x0!==null?hi?t.compressedTexSubImage2D(r.TEXTURE_2D,t0,0,0,b0.width,b0.height,x0,b0.data):t.compressedTexImage2D(r.TEXTURE_2D,t0,c0,b0.width,b0.height,0,b0.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):hi?t.texSubImage2D(r.TEXTURE_2D,t0,0,0,b0.width,b0.height,x0,L0,b0.data):t.texImage2D(r.TEXTURE_2D,t0,c0,b0.width,b0.height,0,x0,L0,b0.data)}else if(Xe.isDataArrayTexture)hi?(S0&&t.texStorage3D(r.TEXTURE_2D_ARRAY,W,c0,He.width,He.height,He.depth),t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,He.width,He.height,He.depth,x0,L0,He.data)):t.texImage3D(r.TEXTURE_2D_ARRAY,0,c0,He.width,He.height,He.depth,0,x0,L0,He.data);else if(Xe.isData3DTexture)hi?(S0&&t.texStorage3D(r.TEXTURE_3D,W,c0,He.width,He.height,He.depth),t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,He.width,He.height,He.depth,x0,L0,He.data)):t.texImage3D(r.TEXTURE_3D,0,c0,He.width,He.height,He.depth,0,x0,L0,He.data);else if(Xe.isFramebufferTexture){if(S0)if(hi)t.texStorage2D(r.TEXTURE_2D,W,c0,He.width,He.height);else{let t0=He.width,o0=He.height;for(let Ji=0;Ji<W;Ji++)t.texImage2D(r.TEXTURE_2D,Ji,c0,t0,o0,0,x0,L0,null),t0>>=1,o0>>=1}}else if(ut.length>0&&p0){hi&&S0&&t.texStorage2D(r.TEXTURE_2D,W,c0,ut[0].width,ut[0].height);for(let t0=0,o0=ut.length;t0<o0;t0++)b0=ut[t0],hi?t.texSubImage2D(r.TEXTURE_2D,t0,0,0,x0,L0,b0):t.texImage2D(r.TEXTURE_2D,t0,c0,x0,L0,b0);Xe.generateMipmaps=!1}else hi?(S0&&t.texStorage2D(r.TEXTURE_2D,W,c0,He.width,He.height),t.texSubImage2D(r.TEXTURE_2D,0,0,0,x0,L0,He)):t.texImage2D(r.TEXTURE_2D,0,c0,x0,L0,He);v(Xe,p0)&&A(w0),ec.__version=it.version,Xe.onUpdate&&Xe.onUpdate(Xe)}si.__version=Xe.version}function ht(si,Xe,d0){if(Xe.image.length!==6)return;const w0=J(si,Xe),Q=Xe.source;t.bindTexture(r.TEXTURE_CUBE_MAP,si.__webglTexture,r.TEXTURE0+d0);const it=n.get(Q);if(Q.version!==it.__version||w0===!0){t.activeTexture(r.TEXTURE0+d0);const ec=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),a0=Xe.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(Xe.colorSpace),u0=Xe.colorSpace===NoColorSpace||ec===a0?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,Xe.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Xe.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,Xe.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,u0);const E0=Xe.isCompressedTexture||Xe.image[0].isCompressedTexture,O0=Xe.image[0]&&Xe.image[0].isDataTexture,He=[];for(let t0=0;t0<6;t0++)!E0&&!O0?He[t0]=m(Xe.image[t0],!1,!0,d):He[t0]=O0?Xe.image[t0].image:Xe.image[t0],He[t0]=R0(Xe,He[t0]);const p0=He[0],x0=S(p0)||a,L0=s.convert(Xe.format,Xe.colorSpace),c0=s.convert(Xe.type),b0=M(Xe.internalFormat,L0,c0,Xe.colorSpace),ut=a&&Xe.isVideoTexture!==!0,hi=it.__version===void 0||w0===!0;let S0=T(Xe,p0,x0);We(r.TEXTURE_CUBE_MAP,Xe,x0);let W;if(E0){ut&&hi&&t.texStorage2D(r.TEXTURE_CUBE_MAP,S0,b0,p0.width,p0.height);for(let t0=0;t0<6;t0++){W=He[t0].mipmaps;for(let o0=0;o0<W.length;o0++){const Ji=W[o0];Xe.format!==RGBAFormat?L0!==null?ut?t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,o0,0,0,Ji.width,Ji.height,L0,Ji.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,o0,b0,Ji.width,Ji.height,0,Ji.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ut?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,o0,0,0,Ji.width,Ji.height,L0,c0,Ji.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,o0,b0,Ji.width,Ji.height,0,L0,c0,Ji.data)}}}else{W=Xe.mipmaps,ut&&hi&&(W.length>0&&S0++,t.texStorage2D(r.TEXTURE_CUBE_MAP,S0,b0,He[0].width,He[0].height));for(let t0=0;t0<6;t0++)if(O0){ut?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,0,0,0,He[t0].width,He[t0].height,L0,c0,He[t0].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,0,b0,He[t0].width,He[t0].height,0,L0,c0,He[t0].data);for(let o0=0;o0<W.length;o0++){const m0=W[o0].image[t0].image;ut?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,o0+1,0,0,m0.width,m0.height,L0,c0,m0.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,o0+1,b0,m0.width,m0.height,0,L0,c0,m0.data)}}else{ut?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,0,0,0,L0,c0,He[t0]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,0,b0,L0,c0,He[t0]);for(let o0=0;o0<W.length;o0++){const Ji=W[o0];ut?t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,o0+1,0,0,L0,c0,Ji.image[t0]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+t0,o0+1,b0,L0,c0,Ji.image[t0])}}}v(Xe,x0)&&A(r.TEXTURE_CUBE_MAP),it.__version=Q.version,Xe.onUpdate&&Xe.onUpdate(Xe)}si.__version=Xe.version}function er(si,Xe,d0,w0,Q,it){const ec=s.convert(d0.format,d0.colorSpace),a0=s.convert(d0.type),u0=M(d0.internalFormat,ec,a0,d0.colorSpace);if(!n.get(Xe).__hasExternalTextures){const O0=Math.max(1,Xe.width>>it),He=Math.max(1,Xe.height>>it);Q===r.TEXTURE_3D||Q===r.TEXTURE_2D_ARRAY?t.texImage3D(Q,it,u0,O0,He,Xe.depth,0,ec,a0,null):t.texImage2D(Q,it,u0,O0,He,0,ec,a0,null)}t.bindFramebuffer(r.FRAMEBUFFER,si),C0(Xe)?x.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,w0,Q,n.get(d0).__webglTexture,0,_0(Xe)):(Q===r.TEXTURE_2D||Q>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&Q<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,w0,Q,n.get(d0).__webglTexture,it),t.bindFramebuffer(r.FRAMEBUFFER,null)}function tr(si,Xe,d0){if(r.bindRenderbuffer(r.RENDERBUFFER,si),Xe.depthBuffer&&!Xe.stencilBuffer){let w0=a===!0?r.DEPTH_COMPONENT24:r.DEPTH_COMPONENT16;if(d0||C0(Xe)){const Q=Xe.depthTexture;Q&&Q.isDepthTexture&&(Q.type===FloatType?w0=r.DEPTH_COMPONENT32F:Q.type===UnsignedIntType&&(w0=r.DEPTH_COMPONENT24));const it=_0(Xe);C0(Xe)?x.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,it,w0,Xe.width,Xe.height):r.renderbufferStorageMultisample(r.RENDERBUFFER,it,w0,Xe.width,Xe.height)}else r.renderbufferStorage(r.RENDERBUFFER,w0,Xe.width,Xe.height);r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,si)}else if(Xe.depthBuffer&&Xe.stencilBuffer){const w0=_0(Xe);d0&&C0(Xe)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,w0,r.DEPTH24_STENCIL8,Xe.width,Xe.height):C0(Xe)?x.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,w0,r.DEPTH24_STENCIL8,Xe.width,Xe.height):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,Xe.width,Xe.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,si)}else{const w0=Xe.isWebGLMultipleRenderTargets===!0?Xe.texture:[Xe.texture];for(let Q=0;Q<w0.length;Q++){const it=w0[Q],ec=s.convert(it.format,it.colorSpace),a0=s.convert(it.type),u0=M(it.internalFormat,ec,a0,it.colorSpace),E0=_0(Xe);d0&&C0(Xe)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,E0,u0,Xe.width,Xe.height):C0(Xe)?x.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,E0,u0,Xe.width,Xe.height):r.renderbufferStorage(r.RENDERBUFFER,u0,Xe.width,Xe.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function Hm(si,Xe){if(Xe&&Xe.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,si),!(Xe.depthTexture&&Xe.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(Xe.depthTexture).__webglTexture||Xe.depthTexture.image.width!==Xe.width||Xe.depthTexture.image.height!==Xe.height)&&(Xe.depthTexture.image.width=Xe.width,Xe.depthTexture.image.height=Xe.height,Xe.depthTexture.needsUpdate=!0),H(Xe.depthTexture,0);const w0=n.get(Xe.depthTexture).__webglTexture,Q=_0(Xe);if(Xe.depthTexture.format===DepthFormat)C0(Xe)?x.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,w0,0,Q):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,w0,0);else if(Xe.depthTexture.format===DepthStencilFormat)C0(Xe)?x.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,w0,0,Q):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,w0,0);else throw new Error("Unknown depthTexture format")}function oi(si){const Xe=n.get(si),d0=si.isWebGLCubeRenderTarget===!0;if(si.depthTexture&&!Xe.__autoAllocateDepthBuffer){if(d0)throw new Error("target.depthTexture not supported in Cube render targets");Hm(Xe.__webglFramebuffer,si)}else if(d0){Xe.__webglDepthbuffer=[];for(let w0=0;w0<6;w0++)t.bindFramebuffer(r.FRAMEBUFFER,Xe.__webglFramebuffer[w0]),Xe.__webglDepthbuffer[w0]=r.createRenderbuffer(),tr(Xe.__webglDepthbuffer[w0],si,!1)}else t.bindFramebuffer(r.FRAMEBUFFER,Xe.__webglFramebuffer),Xe.__webglDepthbuffer=r.createRenderbuffer(),tr(Xe.__webglDepthbuffer,si,!1);t.bindFramebuffer(r.FRAMEBUFFER,null)}function h0(si,Xe,d0){const w0=n.get(si);Xe!==void 0&&er(w0.__webglFramebuffer,si,si.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),d0!==void 0&&oi(si)}function l0(si){const Xe=si.texture,d0=n.get(si),w0=n.get(Xe);si.addEventListener("dispose",L),si.isWebGLMultipleRenderTargets!==!0&&(w0.__webglTexture===void 0&&(w0.__webglTexture=r.createTexture()),w0.__version=Xe.version,o.memory.textures++);const Q=si.isWebGLCubeRenderTarget===!0,it=si.isWebGLMultipleRenderTargets===!0,ec=S(si)||a;if(Q){d0.__webglFramebuffer=[];for(let a0=0;a0<6;a0++)if(a&&Xe.mipmaps&&Xe.mipmaps.length>0){d0.__webglFramebuffer[a0]=[];for(let u0=0;u0<Xe.mipmaps.length;u0++)d0.__webglFramebuffer[a0][u0]=r.createFramebuffer()}else d0.__webglFramebuffer[a0]=r.createFramebuffer()}else{if(a&&Xe.mipmaps&&Xe.mipmaps.length>0){d0.__webglFramebuffer=[];for(let a0=0;a0<Xe.mipmaps.length;a0++)d0.__webglFramebuffer[a0]=r.createFramebuffer()}else d0.__webglFramebuffer=r.createFramebuffer();if(it)if(i.drawBuffers){const a0=si.texture;for(let u0=0,E0=a0.length;u0<E0;u0++){const O0=n.get(a0[u0]);O0.__webglTexture===void 0&&(O0.__webglTexture=r.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&si.samples>0&&C0(si)===!1){const a0=it?Xe:[Xe];d0.__webglMultisampledFramebuffer=r.createFramebuffer(),d0.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,d0.__webglMultisampledFramebuffer);for(let u0=0;u0<a0.length;u0++){const E0=a0[u0];d0.__webglColorRenderbuffer[u0]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,d0.__webglColorRenderbuffer[u0]);const O0=s.convert(E0.format,E0.colorSpace),He=s.convert(E0.type),p0=M(E0.internalFormat,O0,He,E0.colorSpace,si.isXRRenderTarget===!0),x0=_0(si);r.renderbufferStorageMultisample(r.RENDERBUFFER,x0,p0,si.width,si.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+u0,r.RENDERBUFFER,d0.__webglColorRenderbuffer[u0])}r.bindRenderbuffer(r.RENDERBUFFER,null),si.depthBuffer&&(d0.__webglDepthRenderbuffer=r.createRenderbuffer(),tr(d0.__webglDepthRenderbuffer,si,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(Q){t.bindTexture(r.TEXTURE_CUBE_MAP,w0.__webglTexture),We(r.TEXTURE_CUBE_MAP,Xe,ec);for(let a0=0;a0<6;a0++)if(a&&Xe.mipmaps&&Xe.mipmaps.length>0)for(let u0=0;u0<Xe.mipmaps.length;u0++)er(d0.__webglFramebuffer[a0][u0],si,Xe,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+a0,u0);else er(d0.__webglFramebuffer[a0],si,Xe,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+a0,0);v(Xe,ec)&&A(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(it){const a0=si.texture;for(let u0=0,E0=a0.length;u0<E0;u0++){const O0=a0[u0],He=n.get(O0);t.bindTexture(r.TEXTURE_2D,He.__webglTexture),We(r.TEXTURE_2D,O0,ec),er(d0.__webglFramebuffer,si,O0,r.COLOR_ATTACHMENT0+u0,r.TEXTURE_2D,0),v(O0,ec)&&A(r.TEXTURE_2D)}t.unbindTexture()}else{let a0=r.TEXTURE_2D;if((si.isWebGL3DRenderTarget||si.isWebGLArrayRenderTarget)&&(a?a0=si.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(a0,w0.__webglTexture),We(a0,Xe,ec),a&&Xe.mipmaps&&Xe.mipmaps.length>0)for(let u0=0;u0<Xe.mipmaps.length;u0++)er(d0.__webglFramebuffer[u0],si,Xe,r.COLOR_ATTACHMENT0,a0,u0);else er(d0.__webglFramebuffer,si,Xe,r.COLOR_ATTACHMENT0,a0,0);v(Xe,ec)&&A(a0),t.unbindTexture()}si.depthBuffer&&oi(si)}function M0(si){const Xe=S(si)||a,d0=si.isWebGLMultipleRenderTargets===!0?si.texture:[si.texture];for(let w0=0,Q=d0.length;w0<Q;w0++){const it=d0[w0];if(v(it,Xe)){const ec=si.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:r.TEXTURE_2D,a0=n.get(it).__webglTexture;t.bindTexture(ec,a0),A(ec),t.unbindTexture()}}}function U0(si){if(a&&si.samples>0&&C0(si)===!1){const Xe=si.isWebGLMultipleRenderTargets?si.texture:[si.texture],d0=si.width,w0=si.height;let Q=r.COLOR_BUFFER_BIT;const it=[],ec=si.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,a0=n.get(si),u0=si.isWebGLMultipleRenderTargets===!0;if(u0)for(let E0=0;E0<Xe.length;E0++)t.bindFramebuffer(r.FRAMEBUFFER,a0.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+E0,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,a0.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+E0,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,a0.__webglMultisampledFramebuffer),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,a0.__webglFramebuffer);for(let E0=0;E0<Xe.length;E0++){it.push(r.COLOR_ATTACHMENT0+E0),si.depthBuffer&&it.push(ec);const O0=a0.__ignoreDepthValues!==void 0?a0.__ignoreDepthValues:!1;if(O0===!1&&(si.depthBuffer&&(Q|=r.DEPTH_BUFFER_BIT),si.stencilBuffer&&(Q|=r.STENCIL_BUFFER_BIT)),u0&&r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,a0.__webglColorRenderbuffer[E0]),O0===!0&&(r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[ec]),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[ec])),u0){const He=n.get(Xe[E0]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,He,0)}r.blitFramebuffer(0,0,d0,w0,0,0,d0,w0,Q,r.NEAREST),y&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,it)}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),u0)for(let E0=0;E0<Xe.length;E0++){t.bindFramebuffer(r.FRAMEBUFFER,a0.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+E0,r.RENDERBUFFER,a0.__webglColorRenderbuffer[E0]);const O0=n.get(Xe[E0]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,a0.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+E0,r.TEXTURE_2D,O0,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,a0.__webglMultisampledFramebuffer)}}function _0(si){return Math.min(g,si.samples)}function C0(si){const Xe=n.get(si);return a&&si.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Xe.__useRenderToTexture!==!1}function P0(si){const Xe=o.render.frame;b.get(si)!==Xe&&(b.set(si,Xe),si.update())}function R0(si,Xe){const d0=si.colorSpace,w0=si.format,Q=si.type;return si.isCompressedTexture===!0||si.isVideoTexture===!0||si.format===_SRGBAFormat||d0!==LinearSRGBColorSpace&&d0!==NoColorSpace&&(ColorManagement.getTransfer(d0)===SRGBTransfer?a===!1?e.has("EXT_sRGB")===!0&&w0===RGBAFormat?(si.format=_SRGBAFormat,si.minFilter=LinearFilter,si.generateMipmaps=!1):Xe=ImageUtils.sRGBToLinear(Xe):(w0!==RGBAFormat||Q!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",d0)),Xe}this.allocateTextureUnit=F,this.resetTextureUnits=U,this.setTexture2D=H,this.setTexture2DArray=B,this.setTexture3D=V,this.setTextureCube=K,this.rebindTextures=h0,this.setupRenderTarget=l0,this.updateRenderTargetMipmap=M0,this.updateMultisampleRenderTarget=U0,this.setupDepthRenderbuffer=oi,this.setupFrameBufferTexture=er,this.useMultisampledRTT=C0}function WebGLUtils(r,e,t){const n=t.isWebGL2;function i(s,o=NoColorSpace){let a;const l=ColorManagement.getTransfer(o);if(s===UnsignedByteType)return r.UNSIGNED_BYTE;if(s===UnsignedShort4444Type)return r.UNSIGNED_SHORT_4_4_4_4;if(s===UnsignedShort5551Type)return r.UNSIGNED_SHORT_5_5_5_1;if(s===ByteType)return r.BYTE;if(s===ShortType)return r.SHORT;if(s===UnsignedShortType)return r.UNSIGNED_SHORT;if(s===IntType)return r.INT;if(s===UnsignedIntType)return r.UNSIGNED_INT;if(s===FloatType)return r.FLOAT;if(s===HalfFloatType)return n?r.HALF_FLOAT:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(s===AlphaFormat)return r.ALPHA;if(s===RGBAFormat)return r.RGBA;if(s===LuminanceFormat)return r.LUMINANCE;if(s===LuminanceAlphaFormat)return r.LUMINANCE_ALPHA;if(s===DepthFormat)return r.DEPTH_COMPONENT;if(s===DepthStencilFormat)return r.DEPTH_STENCIL;if(s===_SRGBAFormat)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(s===RedFormat)return r.RED;if(s===RedIntegerFormat)return r.RED_INTEGER;if(s===RGFormat)return r.RG;if(s===RGIntegerFormat)return r.RG_INTEGER;if(s===RGBAIntegerFormat)return r.RGBA_INTEGER;if(s===RGB_S3TC_DXT1_Format||s===RGBA_S3TC_DXT1_Format||s===RGBA_S3TC_DXT3_Format||s===RGBA_S3TC_DXT5_Format)if(l===SRGBTransfer)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(s===RGB_S3TC_DXT1_Format)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT1_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT3_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(s===RGBA_S3TC_DXT5_Format)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(s===RGB_S3TC_DXT1_Format)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT1_Format)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(s===RGBA_S3TC_DXT3_Format)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(s===RGBA_S3TC_DXT5_Format)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(s===RGB_PVRTC_4BPPV1_Format||s===RGB_PVRTC_2BPPV1_Format||s===RGBA_PVRTC_4BPPV1_Format||s===RGBA_PVRTC_2BPPV1_Format)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(s===RGB_PVRTC_4BPPV1_Format)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(s===RGB_PVRTC_2BPPV1_Format)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(s===RGBA_PVRTC_4BPPV1_Format)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(s===RGBA_PVRTC_2BPPV1_Format)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(s===RGB_ETC1_Format)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(s===RGB_ETC2_Format||s===RGBA_ETC2_EAC_Format)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(s===RGB_ETC2_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(s===RGBA_ETC2_EAC_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(s===RGBA_ASTC_4x4_Format||s===RGBA_ASTC_5x4_Format||s===RGBA_ASTC_5x5_Format||s===RGBA_ASTC_6x5_Format||s===RGBA_ASTC_6x6_Format||s===RGBA_ASTC_8x5_Format||s===RGBA_ASTC_8x6_Format||s===RGBA_ASTC_8x8_Format||s===RGBA_ASTC_10x5_Format||s===RGBA_ASTC_10x6_Format||s===RGBA_ASTC_10x8_Format||s===RGBA_ASTC_10x10_Format||s===RGBA_ASTC_12x10_Format||s===RGBA_ASTC_12x12_Format)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(s===RGBA_ASTC_4x4_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(s===RGBA_ASTC_5x4_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(s===RGBA_ASTC_5x5_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(s===RGBA_ASTC_6x5_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(s===RGBA_ASTC_6x6_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(s===RGBA_ASTC_8x5_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(s===RGBA_ASTC_8x6_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(s===RGBA_ASTC_8x8_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(s===RGBA_ASTC_10x5_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(s===RGBA_ASTC_10x6_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(s===RGBA_ASTC_10x8_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(s===RGBA_ASTC_10x10_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(s===RGBA_ASTC_12x10_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(s===RGBA_ASTC_12x12_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(s===RGBA_BPTC_Format||s===RGB_BPTC_SIGNED_Format||s===RGB_BPTC_UNSIGNED_Format)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(s===RGBA_BPTC_Format)return l===SRGBTransfer?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(s===RGB_BPTC_SIGNED_Format)return a.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(s===RGB_BPTC_UNSIGNED_Format)return a.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(s===RED_RGTC1_Format||s===SIGNED_RED_RGTC1_Format||s===RED_GREEN_RGTC2_Format||s===SIGNED_RED_GREEN_RGTC2_Format)if(a=e.get("EXT_texture_compression_rgtc"),a!==null){if(s===RGBA_BPTC_Format)return a.COMPRESSED_RED_RGTC1_EXT;if(s===SIGNED_RED_RGTC1_Format)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(s===RED_GREEN_RGTC2_Format)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(s===SIGNED_RED_GREEN_RGTC2_Format)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return s===UnsignedInt248Type?n?r.UNSIGNED_INT_24_8:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):r[s]!==void 0?r[s]:null}return{convert:i}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,o=null;const a=this._targetRay,l=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){o=!0;for(const _ of e.hand.values()){const h=t.getJointPose(_,n),f=this._getHandJoint(d,_);h!==null&&(f.matrix.fromArray(h.transform.matrix),f.matrix.decompose(f.position,f.rotation,f.scale),f.matrixWorldNeedsUpdate=!0,f.jointRadius=h.radius),f.visible=h!==null}const u=d.joints["index-finger-tip"],g=d.joints["thumb-tip"],x=u.position.distanceTo(g.position),y=.02,b=.005;d.inputState.pinching&&x>y+b?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&x<=y-b&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=s!==null),d!==null&&(d.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Group;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class DepthTexture extends Texture{constructor(e,t,n,i,s,o,a,l,d,u){if(u=u!==void 0?u:DepthFormat,u!==DepthFormat&&u!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===DepthFormat&&(n=UnsignedIntType),n===void 0&&u===DepthStencilFormat&&(n=UnsignedInt248Type),super(null,i,s,o,a,l,u,n,d),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:NearestFilter,this.minFilter=l!==void 0?l:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class WebXRManager extends EventDispatcher{constructor(e,t){super();const n=this;let i=null,s=1,o=null,a="local-floor",l=1,d=null,u=null,g=null,x=null,y=null,b=null;const _=t.getContextAttributes();let h=null,f=null;const E=[],m=[],S=new PerspectiveCamera;S.layers.enable(1),S.viewport=new Vector4;const w=new PerspectiveCamera;w.layers.enable(2),w.viewport=new Vector4;const v=[S,w],A=new ArrayCamera;A.layers.enable(1),A.layers.enable(2);let M=null,T=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(B){let V=E[B];return V===void 0&&(V=new WebXRController,E[B]=V),V.getTargetRaySpace()},this.getControllerGrip=function(B){let V=E[B];return V===void 0&&(V=new WebXRController,E[B]=V),V.getGripSpace()},this.getHand=function(B){let V=E[B];return V===void 0&&(V=new WebXRController,E[B]=V),V.getHandSpace()};function R(B){const V=m.indexOf(B.inputSource);if(V===-1)return;const K=E[V];K!==void 0&&(K.update(B.inputSource,B.frame,d||o),K.dispatchEvent({type:B.type,data:B.inputSource}))}function P(){i.removeEventListener("select",R),i.removeEventListener("selectstart",R),i.removeEventListener("selectend",R),i.removeEventListener("squeeze",R),i.removeEventListener("squeezestart",R),i.removeEventListener("squeezeend",R),i.removeEventListener("end",P),i.removeEventListener("inputsourceschange",L);for(let B=0;B<E.length;B++){const V=m[B];V!==null&&(m[B]=null,E[B].disconnect(V))}M=null,T=null,e.setRenderTarget(h),y=null,x=null,g=null,i=null,f=null,H.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(B){s=B,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(B){a=B,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||o},this.setReferenceSpace=function(B){d=B},this.getBaseLayer=function(){return x!==null?x:y},this.getBinding=function(){return g},this.getFrame=function(){return b},this.getSession=function(){return i},this.setSession=async function(B){if(i=B,i!==null){if(h=e.getRenderTarget(),i.addEventListener("select",R),i.addEventListener("selectstart",R),i.addEventListener("selectend",R),i.addEventListener("squeeze",R),i.addEventListener("squeezestart",R),i.addEventListener("squeezeend",R),i.addEventListener("end",P),i.addEventListener("inputsourceschange",L),_.xrCompatible!==!0&&await t.makeXRCompatible(),i.renderState.layers===void 0||e.capabilities.isWebGL2===!1){const V={antialias:i.renderState.layers===void 0?_.antialias:!0,alpha:!0,depth:_.depth,stencil:_.stencil,framebufferScaleFactor:s};y=new XRWebGLLayer(i,t,V),i.updateRenderState({baseLayer:y}),f=new WebGLRenderTarget(y.framebufferWidth,y.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:e.outputColorSpace,stencilBuffer:_.stencil})}else{let V=null,K=null,q=null;_.depth&&(q=_.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,V=_.stencil?DepthStencilFormat:DepthFormat,K=_.stencil?UnsignedInt248Type:UnsignedIntType);const Te={colorFormat:t.RGBA8,depthFormat:q,scaleFactor:s};g=new XRWebGLBinding(i,t),x=g.createProjectionLayer(Te),i.updateRenderState({layers:[x]}),f=new WebGLRenderTarget(x.textureWidth,x.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(x.textureWidth,x.textureHeight,K,void 0,void 0,void 0,void 0,void 0,void 0,V),stencilBuffer:_.stencil,colorSpace:e.outputColorSpace,samples:_.antialias?4:0});const Fe=e.properties.get(f);Fe.__ignoreDepthValues=x.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(l),d=null,o=await i.requestReferenceSpace(a),H.setContext(i),H.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function L(B){for(let V=0;V<B.removed.length;V++){const K=B.removed[V],q=m.indexOf(K);q>=0&&(m[q]=null,E[q].disconnect(K))}for(let V=0;V<B.added.length;V++){const K=B.added[V];let q=m.indexOf(K);if(q===-1){for(let Fe=0;Fe<E.length;Fe++)if(Fe>=m.length){m.push(K),q=Fe;break}else if(m[Fe]===null){m[Fe]=K,q=Fe;break}if(q===-1)break}const Te=E[q];Te&&Te.connect(K)}}const O=new Vector3,I=new Vector3;function N(B,V,K){O.setFromMatrixPosition(V.matrixWorld),I.setFromMatrixPosition(K.matrixWorld);const q=O.distanceTo(I),Te=V.projectionMatrix.elements,Fe=K.projectionMatrix.elements,We=Te[14]/(Te[10]-1),J=Te[14]/(Te[10]+1),et=(Te[9]+1)/Te[5],ht=(Te[9]-1)/Te[5],er=(Te[8]-1)/Te[0],tr=(Fe[8]+1)/Fe[0],Hm=We*er,oi=We*tr,h0=q/(-er+tr),l0=h0*-er;V.matrixWorld.decompose(B.position,B.quaternion,B.scale),B.translateX(l0),B.translateZ(h0),B.matrixWorld.compose(B.position,B.quaternion,B.scale),B.matrixWorldInverse.copy(B.matrixWorld).invert();const M0=We+h0,U0=J+h0,_0=Hm-l0,C0=oi+(q-l0),P0=et*J/U0*M0,R0=ht*J/U0*M0;B.projectionMatrix.makePerspective(_0,C0,P0,R0,M0,U0),B.projectionMatrixInverse.copy(B.projectionMatrix).invert()}function k(B,V){V===null?B.matrixWorld.copy(B.matrix):B.matrixWorld.multiplyMatrices(V.matrixWorld,B.matrix),B.matrixWorldInverse.copy(B.matrixWorld).invert()}this.updateCamera=function(B){if(i===null)return;A.near=w.near=S.near=B.near,A.far=w.far=S.far=B.far,(M!==A.near||T!==A.far)&&(i.updateRenderState({depthNear:A.near,depthFar:A.far}),M=A.near,T=A.far);const V=B.parent,K=A.cameras;k(A,V);for(let q=0;q<K.length;q++)k(K[q],V);K.length===2?N(A,S,w):A.projectionMatrix.copy(S.projectionMatrix),U(B,A,V)};function U(B,V,K){K===null?B.matrix.copy(V.matrixWorld):(B.matrix.copy(K.matrixWorld),B.matrix.invert(),B.matrix.multiply(V.matrixWorld)),B.matrix.decompose(B.position,B.quaternion,B.scale),B.updateMatrixWorld(!0),B.projectionMatrix.copy(V.projectionMatrix),B.projectionMatrixInverse.copy(V.projectionMatrixInverse),B.isPerspectiveCamera&&(B.fov=RAD2DEG*2*Math.atan(1/B.projectionMatrix.elements[5]),B.zoom=1)}this.getCamera=function(){return A},this.getFoveation=function(){if(!(x===null&&y===null))return l},this.setFoveation=function(B){l=B,x!==null&&(x.fixedFoveation=B),y!==null&&y.fixedFoveation!==void 0&&(y.fixedFoveation=B)};let F=null;function j(B,V){if(u=V.getViewerPose(d||o),b=V,u!==null){const K=u.views;y!==null&&(e.setRenderTargetFramebuffer(f,y.framebuffer),e.setRenderTarget(f));let q=!1;K.length!==A.cameras.length&&(A.cameras.length=0,q=!0);for(let Te=0;Te<K.length;Te++){const Fe=K[Te];let We=null;if(y!==null)We=y.getViewport(Fe);else{const et=g.getViewSubImage(x,Fe);We=et.viewport,Te===0&&(e.setRenderTargetTextures(f,et.colorTexture,x.ignoreDepthValues?void 0:et.depthStencilTexture),e.setRenderTarget(f))}let J=v[Te];J===void 0&&(J=new PerspectiveCamera,J.layers.enable(Te),J.viewport=new Vector4,v[Te]=J),J.matrix.fromArray(Fe.transform.matrix),J.matrix.decompose(J.position,J.quaternion,J.scale),J.projectionMatrix.fromArray(Fe.projectionMatrix),J.projectionMatrixInverse.copy(J.projectionMatrix).invert(),J.viewport.set(We.x,We.y,We.width,We.height),Te===0&&(A.matrix.copy(J.matrix),A.matrix.decompose(A.position,A.quaternion,A.scale)),q===!0&&A.cameras.push(J)}}for(let K=0;K<E.length;K++){const q=m[K],Te=E[K];q!==null&&Te!==void 0&&Te.update(q,V,d||o)}F&&F(B,V),V.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:V}),b=null}const H=new WebGLAnimation;H.setAnimationLoop(j),this.setAnimationLoop=function(B){F=B},this.dispose=function(){}}}function WebGLMaterials(r,e){function t(h,f){h.matrixAutoUpdate===!0&&h.updateMatrix(),f.value.copy(h.matrix)}function n(h,f){f.color.getRGB(h.fogColor.value,getUnlitUniformColorSpace(r)),f.isFog?(h.fogNear.value=f.near,h.fogFar.value=f.far):f.isFogExp2&&(h.fogDensity.value=f.density)}function i(h,f,E,m,S){f.isMeshBasicMaterial||f.isMeshLambertMaterial?s(h,f):f.isMeshToonMaterial?(s(h,f),g(h,f)):f.isMeshPhongMaterial?(s(h,f),u(h,f)):f.isMeshStandardMaterial?(s(h,f),x(h,f),f.isMeshPhysicalMaterial&&y(h,f,S)):f.isMeshMatcapMaterial?(s(h,f),b(h,f)):f.isMeshDepthMaterial?s(h,f):f.isMeshDistanceMaterial?(s(h,f),_(h,f)):f.isMeshNormalMaterial?s(h,f):f.isLineBasicMaterial?(o(h,f),f.isLineDashedMaterial&&a(h,f)):f.isPointsMaterial?l(h,f,E,m):f.isSpriteMaterial?d(h,f):f.isShadowMaterial?(h.color.value.copy(f.color),h.opacity.value=f.opacity):f.isShaderMaterial&&(f.uniformsNeedUpdate=!1)}function s(h,f){h.opacity.value=f.opacity,f.color&&h.diffuse.value.copy(f.color),f.emissive&&h.emissive.value.copy(f.emissive).multiplyScalar(f.emissiveIntensity),f.map&&(h.map.value=f.map,t(f.map,h.mapTransform)),f.alphaMap&&(h.alphaMap.value=f.alphaMap,t(f.alphaMap,h.alphaMapTransform)),f.bumpMap&&(h.bumpMap.value=f.bumpMap,t(f.bumpMap,h.bumpMapTransform),h.bumpScale.value=f.bumpScale,f.side===BackSide&&(h.bumpScale.value*=-1)),f.normalMap&&(h.normalMap.value=f.normalMap,t(f.normalMap,h.normalMapTransform),h.normalScale.value.copy(f.normalScale),f.side===BackSide&&h.normalScale.value.negate()),f.displacementMap&&(h.displacementMap.value=f.displacementMap,t(f.displacementMap,h.displacementMapTransform),h.displacementScale.value=f.displacementScale,h.displacementBias.value=f.displacementBias),f.emissiveMap&&(h.emissiveMap.value=f.emissiveMap,t(f.emissiveMap,h.emissiveMapTransform)),f.specularMap&&(h.specularMap.value=f.specularMap,t(f.specularMap,h.specularMapTransform)),f.alphaTest>0&&(h.alphaTest.value=f.alphaTest);const E=e.get(f).envMap;if(E&&(h.envMap.value=E,h.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,h.reflectivity.value=f.reflectivity,h.ior.value=f.ior,h.refractionRatio.value=f.refractionRatio),f.lightMap){h.lightMap.value=f.lightMap;const m=r._useLegacyLights===!0?Math.PI:1;h.lightMapIntensity.value=f.lightMapIntensity*m,t(f.lightMap,h.lightMapTransform)}f.aoMap&&(h.aoMap.value=f.aoMap,h.aoMapIntensity.value=f.aoMapIntensity,t(f.aoMap,h.aoMapTransform))}function o(h,f){h.diffuse.value.copy(f.color),h.opacity.value=f.opacity,f.map&&(h.map.value=f.map,t(f.map,h.mapTransform))}function a(h,f){h.dashSize.value=f.dashSize,h.totalSize.value=f.dashSize+f.gapSize,h.scale.value=f.scale}function l(h,f,E,m){h.diffuse.value.copy(f.color),h.opacity.value=f.opacity,h.size.value=f.size*E,h.scale.value=m*.5,f.map&&(h.map.value=f.map,t(f.map,h.uvTransform)),f.alphaMap&&(h.alphaMap.value=f.alphaMap,t(f.alphaMap,h.alphaMapTransform)),f.alphaTest>0&&(h.alphaTest.value=f.alphaTest)}function d(h,f){h.diffuse.value.copy(f.color),h.opacity.value=f.opacity,h.rotation.value=f.rotation,f.map&&(h.map.value=f.map,t(f.map,h.mapTransform)),f.alphaMap&&(h.alphaMap.value=f.alphaMap,t(f.alphaMap,h.alphaMapTransform)),f.alphaTest>0&&(h.alphaTest.value=f.alphaTest)}function u(h,f){h.specular.value.copy(f.specular),h.shininess.value=Math.max(f.shininess,1e-4)}function g(h,f){f.gradientMap&&(h.gradientMap.value=f.gradientMap)}function x(h,f){h.metalness.value=f.metalness,f.metalnessMap&&(h.metalnessMap.value=f.metalnessMap,t(f.metalnessMap,h.metalnessMapTransform)),h.roughness.value=f.roughness,f.roughnessMap&&(h.roughnessMap.value=f.roughnessMap,t(f.roughnessMap,h.roughnessMapTransform)),e.get(f).envMap&&(h.envMapIntensity.value=f.envMapIntensity)}function y(h,f,E){h.ior.value=f.ior,f.sheen>0&&(h.sheenColor.value.copy(f.sheenColor).multiplyScalar(f.sheen),h.sheenRoughness.value=f.sheenRoughness,f.sheenColorMap&&(h.sheenColorMap.value=f.sheenColorMap,t(f.sheenColorMap,h.sheenColorMapTransform)),f.sheenRoughnessMap&&(h.sheenRoughnessMap.value=f.sheenRoughnessMap,t(f.sheenRoughnessMap,h.sheenRoughnessMapTransform))),f.clearcoat>0&&(h.clearcoat.value=f.clearcoat,h.clearcoatRoughness.value=f.clearcoatRoughness,f.clearcoatMap&&(h.clearcoatMap.value=f.clearcoatMap,t(f.clearcoatMap,h.clearcoatMapTransform)),f.clearcoatRoughnessMap&&(h.clearcoatRoughnessMap.value=f.clearcoatRoughnessMap,t(f.clearcoatRoughnessMap,h.clearcoatRoughnessMapTransform)),f.clearcoatNormalMap&&(h.clearcoatNormalMap.value=f.clearcoatNormalMap,t(f.clearcoatNormalMap,h.clearcoatNormalMapTransform),h.clearcoatNormalScale.value.copy(f.clearcoatNormalScale),f.side===BackSide&&h.clearcoatNormalScale.value.negate())),f.iridescence>0&&(h.iridescence.value=f.iridescence,h.iridescenceIOR.value=f.iridescenceIOR,h.iridescenceThicknessMinimum.value=f.iridescenceThicknessRange[0],h.iridescenceThicknessMaximum.value=f.iridescenceThicknessRange[1],f.iridescenceMap&&(h.iridescenceMap.value=f.iridescenceMap,t(f.iridescenceMap,h.iridescenceMapTransform)),f.iridescenceThicknessMap&&(h.iridescenceThicknessMap.value=f.iridescenceThicknessMap,t(f.iridescenceThicknessMap,h.iridescenceThicknessMapTransform))),f.transmission>0&&(h.transmission.value=f.transmission,h.transmissionSamplerMap.value=E.texture,h.transmissionSamplerSize.value.set(E.width,E.height),f.transmissionMap&&(h.transmissionMap.value=f.transmissionMap,t(f.transmissionMap,h.transmissionMapTransform)),h.thickness.value=f.thickness,f.thicknessMap&&(h.thicknessMap.value=f.thicknessMap,t(f.thicknessMap,h.thicknessMapTransform)),h.attenuationDistance.value=f.attenuationDistance,h.attenuationColor.value.copy(f.attenuationColor)),f.anisotropy>0&&(h.anisotropyVector.value.set(f.anisotropy*Math.cos(f.anisotropyRotation),f.anisotropy*Math.sin(f.anisotropyRotation)),f.anisotropyMap&&(h.anisotropyMap.value=f.anisotropyMap,t(f.anisotropyMap,h.anisotropyMapTransform))),h.specularIntensity.value=f.specularIntensity,h.specularColor.value.copy(f.specularColor),f.specularColorMap&&(h.specularColorMap.value=f.specularColorMap,t(f.specularColorMap,h.specularColorMapTransform)),f.specularIntensityMap&&(h.specularIntensityMap.value=f.specularIntensityMap,t(f.specularIntensityMap,h.specularIntensityMapTransform))}function b(h,f){f.matcap&&(h.matcap.value=f.matcap)}function _(h,f){const E=e.get(f).light;h.referencePosition.value.setFromMatrixPosition(E.matrixWorld),h.nearDistance.value=E.shadow.camera.near,h.farDistance.value=E.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function WebGLUniformsGroups(r,e,t,n){let i={},s={},o=[];const a=t.isWebGL2?r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(E,m){const S=m.program;n.uniformBlockBinding(E,S)}function d(E,m){let S=i[E.id];S===void 0&&(b(E),S=u(E),i[E.id]=S,E.addEventListener("dispose",h));const w=m.program;n.updateUBOMapping(E,w);const v=e.render.frame;s[E.id]!==v&&(x(E),s[E.id]=v)}function u(E){const m=g();E.__bindingPointIndex=m;const S=r.createBuffer(),w=E.__size,v=E.usage;return r.bindBuffer(r.UNIFORM_BUFFER,S),r.bufferData(r.UNIFORM_BUFFER,w,v),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,m,S),S}function g(){for(let E=0;E<a;E++)if(o.indexOf(E)===-1)return o.push(E),E;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function x(E){const m=i[E.id],S=E.uniforms,w=E.__cache;r.bindBuffer(r.UNIFORM_BUFFER,m);for(let v=0,A=S.length;v<A;v++){const M=S[v];if(y(M,v,w)===!0){const T=M.__offset,R=Array.isArray(M.value)?M.value:[M.value];let P=0;for(let L=0;L<R.length;L++){const O=R[L],I=_(O);typeof O=="number"?(M.__data[0]=O,r.bufferSubData(r.UNIFORM_BUFFER,T+P,M.__data)):O.isMatrix3?(M.__data[0]=O.elements[0],M.__data[1]=O.elements[1],M.__data[2]=O.elements[2],M.__data[3]=O.elements[0],M.__data[4]=O.elements[3],M.__data[5]=O.elements[4],M.__data[6]=O.elements[5],M.__data[7]=O.elements[0],M.__data[8]=O.elements[6],M.__data[9]=O.elements[7],M.__data[10]=O.elements[8],M.__data[11]=O.elements[0]):(O.toArray(M.__data,P),P+=I.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,T,M.__data)}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function y(E,m,S){const w=E.value;if(S[m]===void 0){if(typeof w=="number")S[m]=w;else{const v=Array.isArray(w)?w:[w],A=[];for(let M=0;M<v.length;M++)A.push(v[M].clone());S[m]=A}return!0}else if(typeof w=="number"){if(S[m]!==w)return S[m]=w,!0}else{const v=Array.isArray(S[m])?S[m]:[S[m]],A=Array.isArray(w)?w:[w];for(let M=0;M<v.length;M++){const T=v[M];if(T.equals(A[M])===!1)return T.copy(A[M]),!0}}return!1}function b(E){const m=E.uniforms;let S=0;const w=16;let v=0;for(let A=0,M=m.length;A<M;A++){const T=m[A],R={boundary:0,storage:0},P=Array.isArray(T.value)?T.value:[T.value];for(let L=0,O=P.length;L<O;L++){const I=P[L],N=_(I);R.boundary+=N.boundary,R.storage+=N.storage}if(T.__data=new Float32Array(R.storage/Float32Array.BYTES_PER_ELEMENT),T.__offset=S,A>0){v=S%w;const L=w-v;v!==0&&L-R.boundary<0&&(S+=w-v,T.__offset=S)}S+=R.storage}return v=S%w,v>0&&(S+=w-v),E.__size=S,E.__cache={},this}function _(E){const m={boundary:0,storage:0};return typeof E=="number"?(m.boundary=4,m.storage=4):E.isVector2?(m.boundary=8,m.storage=8):E.isVector3||E.isColor?(m.boundary=16,m.storage=12):E.isVector4?(m.boundary=16,m.storage=16):E.isMatrix3?(m.boundary=48,m.storage=48):E.isMatrix4?(m.boundary=64,m.storage=64):E.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",E),m}function h(E){const m=E.target;m.removeEventListener("dispose",h);const S=o.indexOf(m.__bindingPointIndex);o.splice(S,1),r.deleteBuffer(i[m.id]),delete i[m.id],delete s[m.id]}function f(){for(const E in i)r.deleteBuffer(i[E]);o=[],i={},s={}}return{bind:l,update:d,dispose:f}}class WebGLRenderer{constructor(e={}){const{canvas:t=createCanvasElement(),context:n=null,depth:i=!0,stencil:s=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:d=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:g=!1}=e;this.isWebGLRenderer=!0;let x;n!==null?x=n.getContextAttributes().alpha:x=o;const y=new Uint32Array(4),b=new Int32Array(4);let _=null,h=null;const f=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this._useLegacyLights=!1,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const m=this;let S=!1,w=0,v=0,A=null,M=-1,T=null;const R=new Vector4,P=new Vector4;let L=null;const O=new Color(0);let I=0,N=t.width,k=t.height,U=1,F=null,j=null;const H=new Vector4(0,0,N,k),B=new Vector4(0,0,N,k);let V=!1;const K=new Frustum;let q=!1,Te=!1,Fe=null;const We=new Matrix4,J=new Vector2,et=new Vector3,ht={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function er(){return A===null?U:1}let tr=n;function Hm(e0,T0){for(let F0=0;F0<e0.length;F0++){const N0=e0[F0],H0=t.getContext(N0,T0);if(H0!==null)return H0}return null}try{const e0={alpha:!0,depth:i,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:d,powerPreference:u,failIfMajorPerformanceCaveat:g};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${REVISION}`),t.addEventListener("webglcontextlost",ut,!1),t.addEventListener("webglcontextrestored",hi,!1),t.addEventListener("webglcontextcreationerror",S0,!1),tr===null){const T0=["webgl2","webgl","experimental-webgl"];if(m.isWebGL1Renderer===!0&&T0.shift(),tr=Hm(T0,e0),tr===null)throw Hm(T0)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&tr instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),tr.getShaderPrecisionFormat===void 0&&(tr.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e0){throw console.error("THREE.WebGLRenderer: "+e0.message),e0}let oi,h0,l0,M0,U0,_0,C0,P0,R0,si,Xe,d0,w0,Q,it,ec,a0,u0,E0,O0,He,p0,x0,L0;function c0(){oi=new WebGLExtensions(tr),h0=new WebGLCapabilities(tr,oi,e),oi.init(h0),p0=new WebGLUtils(tr,oi,h0),l0=new WebGLState(tr,oi,h0),M0=new WebGLInfo(tr),U0=new WebGLProperties,_0=new WebGLTextures(tr,oi,l0,U0,h0,p0,M0),C0=new WebGLCubeMaps(m),P0=new WebGLCubeUVMaps(m),R0=new WebGLAttributes(tr,h0),x0=new WebGLBindingStates(tr,oi,R0,h0),si=new WebGLGeometries(tr,R0,M0,x0),Xe=new WebGLObjects(tr,si,R0,M0),E0=new WebGLMorphtargets(tr,h0,_0),ec=new WebGLClipping(U0),d0=new WebGLPrograms(m,C0,P0,oi,h0,x0,ec),w0=new WebGLMaterials(m,U0),Q=new WebGLRenderLists,it=new WebGLRenderStates(oi,h0),u0=new WebGLBackground(m,C0,P0,l0,Xe,x,l),a0=new WebGLShadowMap(m,Xe,h0),L0=new WebGLUniformsGroups(tr,M0,h0,l0),O0=new WebGLBufferRenderer(tr,oi,M0,h0),He=new WebGLIndexedBufferRenderer(tr,oi,M0,h0),M0.programs=d0.programs,m.capabilities=h0,m.extensions=oi,m.properties=U0,m.renderLists=Q,m.shadowMap=a0,m.state=l0,m.info=M0}c0();const b0=new WebXRManager(m,tr);this.xr=b0,this.getContext=function(){return tr},this.getContextAttributes=function(){return tr.getContextAttributes()},this.forceContextLoss=function(){const e0=oi.get("WEBGL_lose_context");e0&&e0.loseContext()},this.forceContextRestore=function(){const e0=oi.get("WEBGL_lose_context");e0&&e0.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(e0){e0!==void 0&&(U=e0,this.setSize(N,k,!1))},this.getSize=function(e0){return e0.set(N,k)},this.setSize=function(e0,T0,F0=!0){if(b0.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}N=e0,k=T0,t.width=Math.floor(e0*U),t.height=Math.floor(T0*U),F0===!0&&(t.style.width=e0+"px",t.style.height=T0+"px"),this.setViewport(0,0,e0,T0)},this.getDrawingBufferSize=function(e0){return e0.set(N*U,k*U).floor()},this.setDrawingBufferSize=function(e0,T0,F0){N=e0,k=T0,U=F0,t.width=Math.floor(e0*F0),t.height=Math.floor(T0*F0),this.setViewport(0,0,e0,T0)},this.getCurrentViewport=function(e0){return e0.copy(R)},this.getViewport=function(e0){return e0.copy(H)},this.setViewport=function(e0,T0,F0,N0){e0.isVector4?H.set(e0.x,e0.y,e0.z,e0.w):H.set(e0,T0,F0,N0),l0.viewport(R.copy(H).multiplyScalar(U).floor())},this.getScissor=function(e0){return e0.copy(B)},this.setScissor=function(e0,T0,F0,N0){e0.isVector4?B.set(e0.x,e0.y,e0.z,e0.w):B.set(e0,T0,F0,N0),l0.scissor(P.copy(B).multiplyScalar(U).floor())},this.getScissorTest=function(){return V},this.setScissorTest=function(e0){l0.setScissorTest(V=e0)},this.setOpaqueSort=function(e0){F=e0},this.setTransparentSort=function(e0){j=e0},this.getClearColor=function(e0){return e0.copy(u0.getClearColor())},this.setClearColor=function(){u0.setClearColor.apply(u0,arguments)},this.getClearAlpha=function(){return u0.getClearAlpha()},this.setClearAlpha=function(){u0.setClearAlpha.apply(u0,arguments)},this.clear=function(e0=!0,T0=!0,F0=!0){let N0=0;if(e0){let H0=!1;if(A!==null){const r1=A.texture.format;H0=r1===RGBAIntegerFormat||r1===RGIntegerFormat||r1===RedIntegerFormat}if(H0){const r1=A.texture.type,h1=r1===UnsignedByteType||r1===UnsignedIntType||r1===UnsignedShortType||r1===UnsignedInt248Type||r1===UnsignedShort4444Type||r1===UnsignedShort5551Type,p1=u0.getClearColor(),o1=u0.getClearAlpha(),G0=p1.r,s1=p1.g,c1=p1.b;h1?(y[0]=G0,y[1]=s1,y[2]=c1,y[3]=o1,tr.clearBufferuiv(tr.COLOR,0,y)):(b[0]=G0,b[1]=s1,b[2]=c1,b[3]=o1,tr.clearBufferiv(tr.COLOR,0,b))}else N0|=tr.COLOR_BUFFER_BIT}T0&&(N0|=tr.DEPTH_BUFFER_BIT),F0&&(N0|=tr.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),tr.clear(N0)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",ut,!1),t.removeEventListener("webglcontextrestored",hi,!1),t.removeEventListener("webglcontextcreationerror",S0,!1),Q.dispose(),it.dispose(),U0.dispose(),C0.dispose(),P0.dispose(),Xe.dispose(),x0.dispose(),L0.dispose(),d0.dispose(),b0.dispose(),b0.removeEventListener("sessionstart",Z),b0.removeEventListener("sessionend",at),Fe&&(Fe.dispose(),Fe=null),lt.stop()};function ut(e0){e0.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),S=!0}function hi(){console.log("THREE.WebGLRenderer: Context Restored."),S=!1;const e0=M0.autoReset,T0=a0.enabled,F0=a0.autoUpdate,N0=a0.needsUpdate,H0=a0.type;c0(),M0.autoReset=e0,a0.enabled=T0,a0.autoUpdate=F0,a0.needsUpdate=N0,a0.type=H0}function S0(e0){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e0.statusMessage)}function W(e0){const T0=e0.target;T0.removeEventListener("dispose",W),t0(T0)}function t0(e0){o0(e0),U0.remove(e0)}function o0(e0){const T0=U0.get(e0).programs;T0!==void 0&&(T0.forEach(function(F0){d0.releaseProgram(F0)}),e0.isShaderMaterial&&d0.releaseShaderCache(e0))}this.renderBufferDirect=function(e0,T0,F0,N0,H0,r1){T0===null&&(T0=ht);const h1=H0.isMesh&&H0.matrixWorld.determinant()<0,p1=u1(e0,T0,F0,N0,H0);l0.setMaterial(N0,h1);let o1=F0.index,G0=1;if(N0.wireframe===!0){if(o1=si.getWireframeAttribute(F0),o1===void 0)return;G0=2}const s1=F0.drawRange,c1=F0.attributes.position;let x1=s1.start*G0,m1=(s1.start+s1.count)*G0;r1!==null&&(x1=Math.max(x1,r1.start*G0),m1=Math.min(m1,(r1.start+r1.count)*G0)),o1!==null?(x1=Math.max(x1,0),m1=Math.min(m1,o1.count)):c1!=null&&(x1=Math.max(x1,0),m1=Math.min(m1,c1.count));const S1=m1-x1;if(S1<0||S1===1/0)return;x0.setup(H0,N0,p1,F0,o1);let w1,l1=O0;if(o1!==null&&(w1=R0.get(o1),l1=He,l1.setIndex(w1)),H0.isMesh)N0.wireframe===!0?(l0.setLineWidth(N0.wireframeLinewidth*er()),l1.setMode(tr.LINES)):l1.setMode(tr.TRIANGLES);else if(H0.isLine){let _1=N0.linewidth;_1===void 0&&(_1=1),l0.setLineWidth(_1*er()),H0.isLineSegments?l1.setMode(tr.LINES):H0.isLineLoop?l1.setMode(tr.LINE_LOOP):l1.setMode(tr.LINE_STRIP)}else H0.isPoints?l1.setMode(tr.POINTS):H0.isSprite&&l1.setMode(tr.TRIANGLES);if(H0.isInstancedMesh)l1.renderInstances(x1,S1,H0.count);else if(F0.isInstancedBufferGeometry){const _1=F0._maxInstanceCount!==void 0?F0._maxInstanceCount:1/0,b1=Math.min(F0.instanceCount,_1);l1.renderInstances(x1,S1,b1)}else l1.render(x1,S1)};function Ji(e0,T0,F0){e0.transparent===!0&&e0.side===DoubleSide&&e0.forceSinglePass===!1?(e0.side=BackSide,e0.needsUpdate=!0,X0(e0,T0,F0),e0.side=FrontSide,e0.needsUpdate=!0,X0(e0,T0,F0),e0.side=DoubleSide):X0(e0,T0,F0)}this.compile=function(e0,T0,F0=null){F0===null&&(F0=e0),h=it.get(F0),h.init(),E.push(h),F0.traverseVisible(function(H0){H0.isLight&&H0.layers.test(T0.layers)&&(h.pushLight(H0),H0.castShadow&&h.pushShadow(H0))}),e0!==F0&&e0.traverseVisible(function(H0){H0.isLight&&H0.layers.test(T0.layers)&&(h.pushLight(H0),H0.castShadow&&h.pushShadow(H0))}),h.setupLights(m._useLegacyLights);const N0=new Set;return e0.traverse(function(H0){const r1=H0.material;if(r1)if(Array.isArray(r1))for(let h1=0;h1<r1.length;h1++){const p1=r1[h1];Ji(p1,F0,H0),N0.add(p1)}else Ji(r1,F0,H0),N0.add(r1)}),E.pop(),h=null,N0},this.compileAsync=function(e0,T0,F0=null){const N0=this.compile(e0,T0,F0);return new Promise(H0=>{function r1(){if(N0.forEach(function(h1){U0.get(h1).currentProgram.isReady()&&N0.delete(h1)}),N0.size===0){H0(e0);return}setTimeout(r1,10)}oi.get("KHR_parallel_shader_compile")!==null?r1():setTimeout(r1,10)})};let m0=null;function I0(e0){m0&&m0(e0)}function Z(){lt.stop()}function at(){lt.start()}const lt=new WebGLAnimation;lt.setAnimationLoop(I0),typeof self<"u"&&lt.setContext(self),this.setAnimationLoop=function(e0){m0=e0,b0.setAnimationLoop(e0),e0===null?lt.stop():lt.start()},b0.addEventListener("sessionstart",Z),b0.addEventListener("sessionend",at),this.render=function(e0,T0){if(T0!==void 0&&T0.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(S===!0)return;e0.matrixWorldAutoUpdate===!0&&e0.updateMatrixWorld(),T0.parent===null&&T0.matrixWorldAutoUpdate===!0&&T0.updateMatrixWorld(),b0.enabled===!0&&b0.isPresenting===!0&&(b0.cameraAutoUpdate===!0&&b0.updateCamera(T0),T0=b0.getCamera()),e0.isScene===!0&&e0.onBeforeRender(m,e0,T0,A),h=it.get(e0,E.length),h.init(),E.push(h),We.multiplyMatrices(T0.projectionMatrix,T0.matrixWorldInverse),K.setFromProjectionMatrix(We),Te=this.localClippingEnabled,q=ec.init(this.clippingPlanes,Te),_=Q.get(e0,f.length),_.init(),f.push(_),n0(e0,T0,0,m.sortObjects),_.finish(),m.sortObjects===!0&&_.sort(F,j),this.info.render.frame++,q===!0&&ec.beginShadows();const F0=h.state.shadowsArray;if(a0.render(F0,e0,T0),q===!0&&ec.endShadows(),this.info.autoReset===!0&&this.info.reset(),u0.render(_,e0),h.setupLights(m._useLegacyLights),T0.isArrayCamera){const N0=T0.cameras;for(let H0=0,r1=N0.length;H0<r1;H0++){const h1=N0[H0];r0(_,e0,h1,h1.viewport)}}else r0(_,e0,T0);A!==null&&(_0.updateMultisampleRenderTarget(A),_0.updateRenderTargetMipmap(A)),e0.isScene===!0&&e0.onAfterRender(m,e0,T0),x0.resetDefaultState(),M=-1,T=null,E.pop(),E.length>0?h=E[E.length-1]:h=null,f.pop(),f.length>0?_=f[f.length-1]:_=null};function n0(e0,T0,F0,N0){if(e0.visible===!1)return;if(e0.layers.test(T0.layers)){if(e0.isGroup)F0=e0.renderOrder;else if(e0.isLOD)e0.autoUpdate===!0&&e0.update(T0);else if(e0.isLight)h.pushLight(e0),e0.castShadow&&h.pushShadow(e0);else if(e0.isSprite){if(!e0.frustumCulled||K.intersectsSprite(e0)){N0&&et.setFromMatrixPosition(e0.matrixWorld).applyMatrix4(We);const h1=Xe.update(e0),p1=e0.material;p1.visible&&_.push(e0,h1,p1,F0,et.z,null)}}else if((e0.isMesh||e0.isLine||e0.isPoints)&&(!e0.frustumCulled||K.intersectsObject(e0))){const h1=Xe.update(e0),p1=e0.material;if(N0&&(e0.boundingSphere!==void 0?(e0.boundingSphere===null&&e0.computeBoundingSphere(),et.copy(e0.boundingSphere.center)):(h1.boundingSphere===null&&h1.computeBoundingSphere(),et.copy(h1.boundingSphere.center)),et.applyMatrix4(e0.matrixWorld).applyMatrix4(We)),Array.isArray(p1)){const o1=h1.groups;for(let G0=0,s1=o1.length;G0<s1;G0++){const c1=o1[G0],x1=p1[c1.materialIndex];x1&&x1.visible&&_.push(e0,h1,x1,F0,et.z,c1)}}else p1.visible&&_.push(e0,h1,p1,F0,et.z,null)}}const r1=e0.children;for(let h1=0,p1=r1.length;h1<p1;h1++)n0(r1[h1],T0,F0,N0)}function r0(e0,T0,F0,N0){const H0=e0.opaque,r1=e0.transmissive,h1=e0.transparent;h.setupLightsView(F0),q===!0&&ec.setGlobalState(m.clippingPlanes,F0),r1.length>0&&f0(H0,r1,T0,F0),N0&&l0.viewport(R.copy(N0)),H0.length>0&&v0(H0,T0,F0),r1.length>0&&v0(r1,T0,F0),h1.length>0&&v0(h1,T0,F0),l0.buffers.depth.setTest(!0),l0.buffers.depth.setMask(!0),l0.buffers.color.setMask(!0),l0.setPolygonOffset(!1)}function f0(e0,T0,F0,N0){if((F0.isScene===!0?F0.overrideMaterial:null)!==null)return;const r1=h0.isWebGL2;Fe===null&&(Fe=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:oi.has("EXT_color_buffer_half_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:r1?4:0})),m.getDrawingBufferSize(J),r1?Fe.setSize(J.x,J.y):Fe.setSize(floorPowerOfTwo(J.x),floorPowerOfTwo(J.y));const h1=m.getRenderTarget();m.setRenderTarget(Fe),m.getClearColor(O),I=m.getClearAlpha(),I<1&&m.setClearColor(16777215,.5),m.clear();const p1=m.toneMapping;m.toneMapping=NoToneMapping,v0(e0,F0,N0),_0.updateMultisampleRenderTarget(Fe),_0.updateRenderTargetMipmap(Fe);let o1=!1;for(let G0=0,s1=T0.length;G0<s1;G0++){const c1=T0[G0],x1=c1.object,m1=c1.geometry,S1=c1.material,w1=c1.group;if(S1.side===DoubleSide&&x1.layers.test(N0.layers)){const l1=S1.side;S1.side=BackSide,S1.needsUpdate=!0,A0(x1,F0,N0,m1,S1,w1),S1.side=l1,S1.needsUpdate=!0,o1=!0}}o1===!0&&(_0.updateMultisampleRenderTarget(Fe),_0.updateRenderTargetMipmap(Fe)),m.setRenderTarget(h1),m.setClearColor(O,I),m.toneMapping=p1}function v0(e0,T0,F0){const N0=T0.isScene===!0?T0.overrideMaterial:null;for(let H0=0,r1=e0.length;H0<r1;H0++){const h1=e0[H0],p1=h1.object,o1=h1.geometry,G0=N0===null?h1.material:N0,s1=h1.group;p1.layers.test(F0.layers)&&A0(p1,T0,F0,o1,G0,s1)}}function A0(e0,T0,F0,N0,H0,r1){e0.onBeforeRender(m,T0,F0,N0,H0,r1),e0.modelViewMatrix.multiplyMatrices(F0.matrixWorldInverse,e0.matrixWorld),e0.normalMatrix.getNormalMatrix(e0.modelViewMatrix),H0.onBeforeRender(m,T0,F0,N0,e0,r1),H0.transparent===!0&&H0.side===DoubleSide&&H0.forceSinglePass===!1?(H0.side=BackSide,H0.needsUpdate=!0,m.renderBufferDirect(F0,T0,N0,H0,e0,r1),H0.side=FrontSide,H0.needsUpdate=!0,m.renderBufferDirect(F0,T0,N0,H0,e0,r1),H0.side=DoubleSide):m.renderBufferDirect(F0,T0,N0,H0,e0,r1),e0.onAfterRender(m,T0,F0,N0,H0,r1)}function X0(e0,T0,F0){T0.isScene!==!0&&(T0=ht);const N0=U0.get(e0),H0=h.state.lights,r1=h.state.shadowsArray,h1=H0.state.version,p1=d0.getParameters(e0,H0.state,r1,T0,F0),o1=d0.getProgramCacheKey(p1);let G0=N0.programs;N0.environment=e0.isMeshStandardMaterial?T0.environment:null,N0.fog=T0.fog,N0.envMap=(e0.isMeshStandardMaterial?P0:C0).get(e0.envMap||N0.environment),G0===void 0&&(e0.addEventListener("dispose",W),G0=new Map,N0.programs=G0);let s1=G0.get(o1);if(s1!==void 0){if(N0.currentProgram===s1&&N0.lightsStateVersion===h1)return i1(e0,p1),s1}else p1.uniforms=d0.getUniforms(e0),e0.onBuild(F0,p1,m),e0.onBeforeCompile(p1,m),s1=d0.acquireProgram(p1,o1),G0.set(o1,s1),N0.uniforms=p1.uniforms;const c1=N0.uniforms;return(!e0.isShaderMaterial&&!e0.isRawShaderMaterial||e0.clipping===!0)&&(c1.clippingPlanes=ec.uniform),i1(e0,p1),N0.needsLights=Q0(e0),N0.lightsStateVersion=h1,N0.needsLights&&(c1.ambientLightColor.value=H0.state.ambient,c1.lightProbe.value=H0.state.probe,c1.directionalLights.value=H0.state.directional,c1.directionalLightShadows.value=H0.state.directionalShadow,c1.spotLights.value=H0.state.spot,c1.spotLightShadows.value=H0.state.spotShadow,c1.rectAreaLights.value=H0.state.rectArea,c1.ltc_1.value=H0.state.rectAreaLTC1,c1.ltc_2.value=H0.state.rectAreaLTC2,c1.pointLights.value=H0.state.point,c1.pointLightShadows.value=H0.state.pointShadow,c1.hemisphereLights.value=H0.state.hemi,c1.directionalShadowMap.value=H0.state.directionalShadowMap,c1.directionalShadowMatrix.value=H0.state.directionalShadowMatrix,c1.spotShadowMap.value=H0.state.spotShadowMap,c1.spotLightMatrix.value=H0.state.spotLightMatrix,c1.spotLightMap.value=H0.state.spotLightMap,c1.pointShadowMap.value=H0.state.pointShadowMap,c1.pointShadowMatrix.value=H0.state.pointShadowMatrix),N0.currentProgram=s1,N0.uniformsList=null,s1}function q0(e0){if(e0.uniformsList===null){const T0=e0.currentProgram.getUniforms();e0.uniformsList=WebGLUniforms.seqWithValue(T0.seq,e0.uniforms)}return e0.uniformsList}function i1(e0,T0){const F0=U0.get(e0);F0.outputColorSpace=T0.outputColorSpace,F0.instancing=T0.instancing,F0.instancingColor=T0.instancingColor,F0.skinning=T0.skinning,F0.morphTargets=T0.morphTargets,F0.morphNormals=T0.morphNormals,F0.morphColors=T0.morphColors,F0.morphTargetsCount=T0.morphTargetsCount,F0.numClippingPlanes=T0.numClippingPlanes,F0.numIntersection=T0.numClipIntersection,F0.vertexAlphas=T0.vertexAlphas,F0.vertexTangents=T0.vertexTangents,F0.toneMapping=T0.toneMapping}function u1(e0,T0,F0,N0,H0){T0.isScene!==!0&&(T0=ht),_0.resetTextureUnits();const r1=T0.fog,h1=N0.isMeshStandardMaterial?T0.environment:null,p1=A===null?m.outputColorSpace:A.isXRRenderTarget===!0?A.texture.colorSpace:LinearSRGBColorSpace,o1=(N0.isMeshStandardMaterial?P0:C0).get(N0.envMap||h1),G0=N0.vertexColors===!0&&!!F0.attributes.color&&F0.attributes.color.itemSize===4,s1=!!F0.attributes.tangent&&(!!N0.normalMap||N0.anisotropy>0),c1=!!F0.morphAttributes.position,x1=!!F0.morphAttributes.normal,m1=!!F0.morphAttributes.color;let S1=NoToneMapping;N0.toneMapped&&(A===null||A.isXRRenderTarget===!0)&&(S1=m.toneMapping);const w1=F0.morphAttributes.position||F0.morphAttributes.normal||F0.morphAttributes.color,l1=w1!==void 0?w1.length:0,_1=U0.get(N0),b1=h.state.lights;if(q===!0&&(Te===!0||e0!==T)){const D_=e0===T&&N0.id===M;ec.setState(N0,e0,D_)}let T1=!1;N0.version===_1.__version?(_1.needsLights&&_1.lightsStateVersion!==b1.state.version||_1.outputColorSpace!==p1||H0.isInstancedMesh&&_1.instancing===!1||!H0.isInstancedMesh&&_1.instancing===!0||H0.isSkinnedMesh&&_1.skinning===!1||!H0.isSkinnedMesh&&_1.skinning===!0||H0.isInstancedMesh&&_1.instancingColor===!0&&H0.instanceColor===null||H0.isInstancedMesh&&_1.instancingColor===!1&&H0.instanceColor!==null||_1.envMap!==o1||N0.fog===!0&&_1.fog!==r1||_1.numClippingPlanes!==void 0&&(_1.numClippingPlanes!==ec.numPlanes||_1.numIntersection!==ec.numIntersection)||_1.vertexAlphas!==G0||_1.vertexTangents!==s1||_1.morphTargets!==c1||_1.morphNormals!==x1||_1.morphColors!==m1||_1.toneMapping!==S1||h0.isWebGL2===!0&&_1.morphTargetsCount!==l1)&&(T1=!0):(T1=!0,_1.__version=N0.version);let Z1=_1.currentProgram;T1===!0&&(Z1=X0(N0,T0,H0));let O_=!1,lv=!1,pv=!1;const Q1=Z1.getUniforms(),X_=_1.uniforms;if(l0.useProgram(Z1.program)&&(O_=!0,lv=!0,pv=!0),N0.id!==M&&(M=N0.id,lv=!0),O_||T!==e0){Q1.setValue(tr,"projectionMatrix",e0.projectionMatrix),Q1.setValue(tr,"viewMatrix",e0.matrixWorldInverse);const D_=Q1.map.cameraPosition;D_!==void 0&&D_.setValue(tr,et.setFromMatrixPosition(e0.matrixWorld)),h0.logarithmicDepthBuffer&&Q1.setValue(tr,"logDepthBufFC",2/(Math.log(e0.far+1)/Math.LN2)),(N0.isMeshPhongMaterial||N0.isMeshToonMaterial||N0.isMeshLambertMaterial||N0.isMeshBasicMaterial||N0.isMeshStandardMaterial||N0.isShaderMaterial)&&Q1.setValue(tr,"isOrthographic",e0.isOrthographicCamera===!0),T!==e0&&(T=e0,lv=!0,pv=!0)}if(H0.isSkinnedMesh){Q1.setOptional(tr,H0,"bindMatrix"),Q1.setOptional(tr,H0,"bindMatrixInverse");const D_=H0.skeleton;D_&&(h0.floatVertexTextures?(D_.boneTexture===null&&D_.computeBoneTexture(),Q1.setValue(tr,"boneTexture",D_.boneTexture,_0),Q1.setValue(tr,"boneTextureSize",D_.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const F_=F0.morphAttributes;if((F_.position!==void 0||F_.normal!==void 0||F_.color!==void 0&&h0.isWebGL2===!0)&&E0.update(H0,F0,Z1),(lv||_1.receiveShadow!==H0.receiveShadow)&&(_1.receiveShadow=H0.receiveShadow,Q1.setValue(tr,"receiveShadow",H0.receiveShadow)),N0.isMeshGouraudMaterial&&N0.envMap!==null&&(X_.envMap.value=o1,X_.flipEnvMap.value=o1.isCubeTexture&&o1.isRenderTargetTexture===!1?-1:1),lv&&(Q1.setValue(tr,"toneMappingExposure",m.toneMappingExposure),_1.needsLights&&e1(X_,pv),r1&&N0.fog===!0&&w0.refreshFogUniforms(X_,r1),w0.refreshMaterialUniforms(X_,N0,U,k,Fe),WebGLUniforms.upload(tr,q0(_1),X_,_0)),N0.isShaderMaterial&&N0.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(tr,q0(_1),X_,_0),N0.uniformsNeedUpdate=!1),N0.isSpriteMaterial&&Q1.setValue(tr,"center",H0.center),Q1.setValue(tr,"modelViewMatrix",H0.modelViewMatrix),Q1.setValue(tr,"normalMatrix",H0.normalMatrix),Q1.setValue(tr,"modelMatrix",H0.matrixWorld),N0.isShaderMaterial||N0.isRawShaderMaterial){const D_=N0.uniformsGroups;for(let F1=0,mv=D_.length;F1<mv;F1++)if(h0.isWebGL2){const Q_=D_[F1];L0.update(Q_,Z1),L0.bind(Q_,Z1)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Z1}function e1(e0,T0){e0.ambientLightColor.needsUpdate=T0,e0.lightProbe.needsUpdate=T0,e0.directionalLights.needsUpdate=T0,e0.directionalLightShadows.needsUpdate=T0,e0.pointLights.needsUpdate=T0,e0.pointLightShadows.needsUpdate=T0,e0.spotLights.needsUpdate=T0,e0.spotLightShadows.needsUpdate=T0,e0.rectAreaLights.needsUpdate=T0,e0.hemisphereLights.needsUpdate=T0}function Q0(e0){return e0.isMeshLambertMaterial||e0.isMeshToonMaterial||e0.isMeshPhongMaterial||e0.isMeshStandardMaterial||e0.isShadowMaterial||e0.isShaderMaterial&&e0.lights===!0}this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return v},this.getRenderTarget=function(){return A},this.setRenderTargetTextures=function(e0,T0,F0){U0.get(e0.texture).__webglTexture=T0,U0.get(e0.depthTexture).__webglTexture=F0;const N0=U0.get(e0);N0.__hasExternalTextures=!0,N0.__hasExternalTextures&&(N0.__autoAllocateDepthBuffer=F0===void 0,N0.__autoAllocateDepthBuffer||oi.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),N0.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e0,T0){const F0=U0.get(e0);F0.__webglFramebuffer=T0,F0.__useDefaultFramebuffer=T0===void 0},this.setRenderTarget=function(e0,T0=0,F0=0){A=e0,w=T0,v=F0;let N0=!0,H0=null,r1=!1,h1=!1;if(e0){const o1=U0.get(e0);o1.__useDefaultFramebuffer!==void 0?(l0.bindFramebuffer(tr.FRAMEBUFFER,null),N0=!1):o1.__webglFramebuffer===void 0?_0.setupRenderTarget(e0):o1.__hasExternalTextures&&_0.rebindTextures(e0,U0.get(e0.texture).__webglTexture,U0.get(e0.depthTexture).__webglTexture);const G0=e0.texture;(G0.isData3DTexture||G0.isDataArrayTexture||G0.isCompressedArrayTexture)&&(h1=!0);const s1=U0.get(e0).__webglFramebuffer;e0.isWebGLCubeRenderTarget?(Array.isArray(s1[T0])?H0=s1[T0][F0]:H0=s1[T0],r1=!0):h0.isWebGL2&&e0.samples>0&&_0.useMultisampledRTT(e0)===!1?H0=U0.get(e0).__webglMultisampledFramebuffer:Array.isArray(s1)?H0=s1[F0]:H0=s1,R.copy(e0.viewport),P.copy(e0.scissor),L=e0.scissorTest}else R.copy(H).multiplyScalar(U).floor(),P.copy(B).multiplyScalar(U).floor(),L=V;if(l0.bindFramebuffer(tr.FRAMEBUFFER,H0)&&h0.drawBuffers&&N0&&l0.drawBuffers(e0,H0),l0.viewport(R),l0.scissor(P),l0.setScissorTest(L),r1){const o1=U0.get(e0.texture);tr.framebufferTexture2D(tr.FRAMEBUFFER,tr.COLOR_ATTACHMENT0,tr.TEXTURE_CUBE_MAP_POSITIVE_X+T0,o1.__webglTexture,F0)}else if(h1){const o1=U0.get(e0.texture),G0=T0||0;tr.framebufferTextureLayer(tr.FRAMEBUFFER,tr.COLOR_ATTACHMENT0,o1.__webglTexture,F0||0,G0)}M=-1},this.readRenderTargetPixels=function(e0,T0,F0,N0,H0,r1,h1){if(!(e0&&e0.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let p1=U0.get(e0).__webglFramebuffer;if(e0.isWebGLCubeRenderTarget&&h1!==void 0&&(p1=p1[h1]),p1){l0.bindFramebuffer(tr.FRAMEBUFFER,p1);try{const o1=e0.texture,G0=o1.format,s1=o1.type;if(G0!==RGBAFormat&&p0.convert(G0)!==tr.getParameter(tr.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const c1=s1===HalfFloatType&&(oi.has("EXT_color_buffer_half_float")||h0.isWebGL2&&oi.has("EXT_color_buffer_float"));if(s1!==UnsignedByteType&&p0.convert(s1)!==tr.getParameter(tr.IMPLEMENTATION_COLOR_READ_TYPE)&&!(s1===FloatType&&(h0.isWebGL2||oi.has("OES_texture_float")||oi.has("WEBGL_color_buffer_float")))&&!c1){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}T0>=0&&T0<=e0.width-N0&&F0>=0&&F0<=e0.height-H0&&tr.readPixels(T0,F0,N0,H0,p0.convert(G0),p0.convert(s1),r1)}finally{const o1=A!==null?U0.get(A).__webglFramebuffer:null;l0.bindFramebuffer(tr.FRAMEBUFFER,o1)}}},this.copyFramebufferToTexture=function(e0,T0,F0=0){const N0=Math.pow(2,-F0),H0=Math.floor(T0.image.width*N0),r1=Math.floor(T0.image.height*N0);_0.setTexture2D(T0,0),tr.copyTexSubImage2D(tr.TEXTURE_2D,F0,0,0,e0.x,e0.y,H0,r1),l0.unbindTexture()},this.copyTextureToTexture=function(e0,T0,F0,N0=0){const H0=T0.image.width,r1=T0.image.height,h1=p0.convert(F0.format),p1=p0.convert(F0.type);_0.setTexture2D(F0,0),tr.pixelStorei(tr.UNPACK_FLIP_Y_WEBGL,F0.flipY),tr.pixelStorei(tr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,F0.premultiplyAlpha),tr.pixelStorei(tr.UNPACK_ALIGNMENT,F0.unpackAlignment),T0.isDataTexture?tr.texSubImage2D(tr.TEXTURE_2D,N0,e0.x,e0.y,H0,r1,h1,p1,T0.image.data):T0.isCompressedTexture?tr.compressedTexSubImage2D(tr.TEXTURE_2D,N0,e0.x,e0.y,T0.mipmaps[0].width,T0.mipmaps[0].height,h1,T0.mipmaps[0].data):tr.texSubImage2D(tr.TEXTURE_2D,N0,e0.x,e0.y,h1,p1,T0.image),N0===0&&F0.generateMipmaps&&tr.generateMipmap(tr.TEXTURE_2D),l0.unbindTexture()},this.copyTextureToTexture3D=function(e0,T0,F0,N0,H0=0){if(m.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const r1=e0.max.x-e0.min.x+1,h1=e0.max.y-e0.min.y+1,p1=e0.max.z-e0.min.z+1,o1=p0.convert(N0.format),G0=p0.convert(N0.type);let s1;if(N0.isData3DTexture)_0.setTexture3D(N0,0),s1=tr.TEXTURE_3D;else if(N0.isDataArrayTexture)_0.setTexture2DArray(N0,0),s1=tr.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}tr.pixelStorei(tr.UNPACK_FLIP_Y_WEBGL,N0.flipY),tr.pixelStorei(tr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,N0.premultiplyAlpha),tr.pixelStorei(tr.UNPACK_ALIGNMENT,N0.unpackAlignment);const c1=tr.getParameter(tr.UNPACK_ROW_LENGTH),x1=tr.getParameter(tr.UNPACK_IMAGE_HEIGHT),m1=tr.getParameter(tr.UNPACK_SKIP_PIXELS),S1=tr.getParameter(tr.UNPACK_SKIP_ROWS),w1=tr.getParameter(tr.UNPACK_SKIP_IMAGES),l1=F0.isCompressedTexture?F0.mipmaps[0]:F0.image;tr.pixelStorei(tr.UNPACK_ROW_LENGTH,l1.width),tr.pixelStorei(tr.UNPACK_IMAGE_HEIGHT,l1.height),tr.pixelStorei(tr.UNPACK_SKIP_PIXELS,e0.min.x),tr.pixelStorei(tr.UNPACK_SKIP_ROWS,e0.min.y),tr.pixelStorei(tr.UNPACK_SKIP_IMAGES,e0.min.z),F0.isDataTexture||F0.isData3DTexture?tr.texSubImage3D(s1,H0,T0.x,T0.y,T0.z,r1,h1,p1,o1,G0,l1.data):F0.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),tr.compressedTexSubImage3D(s1,H0,T0.x,T0.y,T0.z,r1,h1,p1,o1,l1.data)):tr.texSubImage3D(s1,H0,T0.x,T0.y,T0.z,r1,h1,p1,o1,G0,l1),tr.pixelStorei(tr.UNPACK_ROW_LENGTH,c1),tr.pixelStorei(tr.UNPACK_IMAGE_HEIGHT,x1),tr.pixelStorei(tr.UNPACK_SKIP_PIXELS,m1),tr.pixelStorei(tr.UNPACK_SKIP_ROWS,S1),tr.pixelStorei(tr.UNPACK_SKIP_IMAGES,w1),H0===0&&N0.generateMipmaps&&tr.generateMipmap(s1),l0.unbindTexture()},this.initTexture=function(e0){e0.isCubeTexture?_0.setTextureCube(e0,0):e0.isData3DTexture?_0.setTexture3D(e0,0):e0.isDataArrayTexture||e0.isCompressedArrayTexture?_0.setTexture2DArray(e0,0):_0.setTexture2D(e0,0),l0.unbindTexture()},this.resetState=function(){w=0,v=0,A=null,l0.reset(),x0.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===DisplayP3ColorSpace?"display-p3":"srgb",t.unpackColorSpace=ColorManagement.workingColorSpace===LinearDisplayP3ColorSpace?"display-p3":"srgb"}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(e){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!e}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===SRGBColorSpace?sRGBEncoding:LinearEncoding}set outputEncoding(e){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=e===sRGBEncoding?SRGBColorSpace:LinearSRGBColorSpace}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class WebGL1Renderer extends WebGLRenderer{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class Fog{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new Color(e),this.near=t,this.far=n}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t}}class DataTexture extends Texture{constructor(e=null,t=1,n=1,i,s,o,a,l,d=NearestFilter,u=NearestFilter,g,x){super(null,o,a,l,d,u,i,s,g,x),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class LineBasicMaterial extends Material{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _start$1=new Vector3,_end$1=new Vector3,_inverseMatrix$1=new Matrix4,_ray$1=new Ray,_sphere$1=new Sphere;class Line extends Object3D{constructor(e=new BufferGeometry,t=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,s=t.count;i<s;i++)_start$1.fromBufferAttribute(t,i-1),_end$1.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=_start$1.distanceTo(_end$1);e.setAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere$1.copy(n.boundingSphere),_sphere$1.applyMatrix4(i),_sphere$1.radius+=s,e.ray.intersectsSphere(_sphere$1)===!1)return;_inverseMatrix$1.copy(i).invert(),_ray$1.copy(e.ray).applyMatrix4(_inverseMatrix$1);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,d=new Vector3,u=new Vector3,g=new Vector3,x=new Vector3,y=this.isLineSegments?2:1,b=n.index,h=n.attributes.position;if(b!==null){const f=Math.max(0,o.start),E=Math.min(b.count,o.start+o.count);for(let m=f,S=E-1;m<S;m+=y){const w=b.getX(m),v=b.getX(m+1);if(d.fromBufferAttribute(h,w),u.fromBufferAttribute(h,v),_ray$1.distanceSqToSegment(d,u,x,g)>l)continue;x.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(x);M<e.near||M>e.far||t.push({distance:M,point:g.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else{const f=Math.max(0,o.start),E=Math.min(h.count,o.start+o.count);for(let m=f,S=E-1;m<S;m+=y){if(d.fromBufferAttribute(h,m),u.fromBufferAttribute(h,m+1),_ray$1.distanceSqToSegment(d,u,x,g)>l)continue;x.applyMatrix4(this.matrixWorld);const v=e.ray.origin.distanceTo(x);v<e.near||v>e.far||t.push({distance:v,point:g.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const _start=new Vector3,_end=new Vector3;class LineSegments extends Line{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,s=t.count;i<s;i+=2)_start.fromBufferAttribute(t,i),_end.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+_start.distanceTo(_end);e.setAttribute("lineDistance",new Float32BufferAttribute(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class PointsMaterial extends Material{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const _inverseMatrix=new Matrix4,_ray=new Ray,_sphere=new Sphere,_position$2=new Vector3;class Points extends Object3D{constructor(e=new BufferGeometry,t=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),_sphere.copy(n.boundingSphere),_sphere.applyMatrix4(i),_sphere.radius+=s,e.ray.intersectsSphere(_sphere)===!1)return;_inverseMatrix.copy(i).invert(),_ray.copy(e.ray).applyMatrix4(_inverseMatrix);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,d=n.index,g=n.attributes.position;if(d!==null){const x=Math.max(0,o.start),y=Math.min(d.count,o.start+o.count);for(let b=x,_=y;b<_;b++){const h=d.getX(b);_position$2.fromBufferAttribute(g,h),testPoint(_position$2,h,l,i,e,t,this)}}else{const x=Math.max(0,o.start),y=Math.min(g.count,o.start+o.count);for(let b=x,_=y;b<_;b++)_position$2.fromBufferAttribute(g,b),testPoint(_position$2,b,l,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function testPoint(r,e,t,n,i,s,o){const a=_ray.distanceSqToPoint(r);if(a<t){const l=new Vector3;_ray.closestPointToPoint(r,l),l.applyMatrix4(n);const d=i.ray.origin.distanceTo(l);if(d<i.near||d>i.far)return;s.push({distance:d,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}class CanvasTexture extends Texture{constructor(e,t,n,i,s,o,a,l,d){super(e,t,n,i,s,o,a,l,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class CylinderGeometry extends BufferGeometry{constructor(e=1,t=1,n=1,i=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const d=this;i=Math.floor(i),s=Math.floor(s);const u=[],g=[],x=[],y=[];let b=0;const _=[],h=n/2;let f=0;E(),o===!1&&(e>0&&m(!0),t>0&&m(!1)),this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(g,3)),this.setAttribute("normal",new Float32BufferAttribute(x,3)),this.setAttribute("uv",new Float32BufferAttribute(y,2));function E(){const S=new Vector3,w=new Vector3;let v=0;const A=(t-e)/n;for(let M=0;M<=s;M++){const T=[],R=M/s,P=R*(t-e)+e;for(let L=0;L<=i;L++){const O=L/i,I=O*l+a,N=Math.sin(I),k=Math.cos(I);w.x=P*N,w.y=-R*n+h,w.z=P*k,g.push(w.x,w.y,w.z),S.set(N,A,k).normalize(),x.push(S.x,S.y,S.z),y.push(O,1-R),T.push(b++)}_.push(T)}for(let M=0;M<i;M++)for(let T=0;T<s;T++){const R=_[T][M],P=_[T+1][M],L=_[T+1][M+1],O=_[T][M+1];u.push(R,P,O),u.push(P,L,O),v+=6}d.addGroup(f,v,0),f+=v}function m(S){const w=b,v=new Vector2,A=new Vector3;let M=0;const T=S===!0?e:t,R=S===!0?1:-1;for(let L=1;L<=i;L++)g.push(0,h*R,0),x.push(0,R,0),y.push(.5,.5),b++;const P=b;for(let L=0;L<=i;L++){const I=L/i*l+a,N=Math.cos(I),k=Math.sin(I);A.x=T*k,A.y=h*R,A.z=T*N,g.push(A.x,A.y,A.z),x.push(0,R,0),v.x=N*.5+.5,v.y=k*.5*R+.5,y.push(v.x,v.y),b++}for(let L=0;L<i;L++){const O=w+L,I=P+L;S===!0?u.push(I,I+1,O):u.push(I+1,I,O),M+=3}d.addGroup(f,M,S===!0?1:2),f+=M}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(e=1,t=1,n=32,i=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,n,i,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],o=[];a(i),d(n),u(),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(s.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(E){const m=new Vector3,S=new Vector3,w=new Vector3;for(let v=0;v<t.length;v+=3)y(t[v+0],m),y(t[v+1],S),y(t[v+2],w),l(m,S,w,E)}function l(E,m,S,w){const v=w+1,A=[];for(let M=0;M<=v;M++){A[M]=[];const T=E.clone().lerp(S,M/v),R=m.clone().lerp(S,M/v),P=v-M;for(let L=0;L<=P;L++)L===0&&M===v?A[M][L]=T:A[M][L]=T.clone().lerp(R,L/P)}for(let M=0;M<v;M++)for(let T=0;T<2*(v-M)-1;T++){const R=Math.floor(T/2);T%2===0?(x(A[M][R+1]),x(A[M+1][R]),x(A[M][R])):(x(A[M][R+1]),x(A[M+1][R+1]),x(A[M+1][R]))}}function d(E){const m=new Vector3;for(let S=0;S<s.length;S+=3)m.x=s[S+0],m.y=s[S+1],m.z=s[S+2],m.normalize().multiplyScalar(E),s[S+0]=m.x,s[S+1]=m.y,s[S+2]=m.z}function u(){const E=new Vector3;for(let m=0;m<s.length;m+=3){E.x=s[m+0],E.y=s[m+1],E.z=s[m+2];const S=h(E)/2/Math.PI+.5,w=f(E)/Math.PI+.5;o.push(S,1-w)}b(),g()}function g(){for(let E=0;E<o.length;E+=6){const m=o[E+0],S=o[E+2],w=o[E+4],v=Math.max(m,S,w),A=Math.min(m,S,w);v>.9&&A<.1&&(m<.2&&(o[E+0]+=1),S<.2&&(o[E+2]+=1),w<.2&&(o[E+4]+=1))}}function x(E){s.push(E.x,E.y,E.z)}function y(E,m){const S=E*3;m.x=e[S+0],m.y=e[S+1],m.z=e[S+2]}function b(){const E=new Vector3,m=new Vector3,S=new Vector3,w=new Vector3,v=new Vector2,A=new Vector2,M=new Vector2;for(let T=0,R=0;T<s.length;T+=9,R+=6){E.set(s[T+0],s[T+1],s[T+2]),m.set(s[T+3],s[T+4],s[T+5]),S.set(s[T+6],s[T+7],s[T+8]),v.set(o[R+0],o[R+1]),A.set(o[R+2],o[R+3]),M.set(o[R+4],o[R+5]),w.copy(E).add(m).add(S).divideScalar(3);const P=h(w);_(v,R+0,E,P),_(A,R+2,m,P),_(M,R+4,S,P)}}function _(E,m,S,w){w<0&&E.x===1&&(o[m]=E.x-1),S.x===0&&S.z===0&&(o[m]=w/2/Math.PI+.5)}function h(E){return Math.atan2(E.z,-E.x)}function f(E){return Math.atan2(-E.y,Math.sqrt(E.x*E.x+E.z*E.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new PolyhedronGeometry(e.vertices,e.indices,e.radius,e.details)}}class IcosahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new IcosahedronGeometry(e.radius,e.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new OctahedronGeometry(e.radius,e.detail)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new TetrahedronGeometry(e.radius,e.detail)}}class TorusGeometry extends BufferGeometry{constructor(e=1,t=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],l=[],d=[],u=new Vector3,g=new Vector3,x=new Vector3;for(let y=0;y<=n;y++)for(let b=0;b<=i;b++){const _=b/i*s,h=y/n*Math.PI*2;g.x=(e+t*Math.cos(h))*Math.cos(_),g.y=(e+t*Math.cos(h))*Math.sin(_),g.z=t*Math.sin(h),a.push(g.x,g.y,g.z),u.x=e*Math.cos(_),u.y=e*Math.sin(_),x.subVectors(g,u).normalize(),l.push(x.x,x.y,x.z),d.push(b/i),d.push(y/n)}for(let y=1;y<=n;y++)for(let b=1;b<=i;b++){const _=(i+1)*y+b-1,h=(i+1)*(y-1)+b-1,f=(i+1)*(y-1)+b,E=(i+1)*y+b;o.push(_,h,E),o.push(h,f,E)}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Light extends Object3D{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3,_lookTarget$1=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(e.matrixWorld),t.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(_lookTarget$1),t.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(_projScreenMatrix$1)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class AmbientLight extends Light{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,_projectionMatrix.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,o=t.near*Math.tan(DEG2RAD*t.fov*.5)/t.zoom;let a,l;_eyeLeft.elements[12]=-i,_eyeRight.elements[12]=i,a=-o*t.aspect+s,l=o*t.aspect+s,_projectionMatrix.elements[0]=2*t.near/(l-a),_projectionMatrix.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(_projectionMatrix),a=-o*t.aspect-s,l=o*t.aspect-s,_projectionMatrix.elements[0]=2*t.near/(l-a),_projectionMatrix.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(_eyeRight)}}class Uniform{constructor(e){this.value=e}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);var chroma$1={exports:{}},chroma=chroma$1.exports,hasRequiredChroma;function requireChroma(){return hasRequiredChroma||(hasRequiredChroma=1,(function(r,e){(function(){var t,n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R,P,L,O,I,N,k,U,F,j,H,B,V,K,q,Te,Fe,We,J,et,ht,er,tr,Hm,oi,h0,l0,M0,U0,_0,C0,P0,R0,si,Xe,d0,w0,Q,it,ec,a0,u0,E0,O0,He,p0,x0,L0,c0,b0,ut,hi,S0,W,t0,o0,Ji,m0,I0=[].slice;W=(function(){var Z,at,lt,n0,r0;for(Z={},r0="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),n0=0,at=r0.length;n0<at;n0++)lt=r0[n0],Z["[object "+lt+"]"]=lt.toLowerCase();return function(f0){var v0;return v0=Object.prototype.toString.call(f0),Z[v0]||"object"}})(),tr=function(Z,at,lt){return at==null&&(at=0),lt==null&&(lt=1),Z<at&&(Z=at),Z>lt&&(Z=lt),Z},t0=function(Z){return Z.length>=3?Array.prototype.slice.call(Z):Z[0]},v=function(Z){var at,lt;for(Z._clipped=!1,Z._unclipped=Z.slice(0),at=lt=0;lt<3;at=++lt)at<3?((Z[at]<0||Z[at]>255)&&(Z._clipped=!0),Z[at]<0&&(Z[at]=0),Z[at]>255&&(Z[at]=255)):at===3&&(Z[at]<0&&(Z[at]=0),Z[at]>1&&(Z[at]=1));return Z._clipped||delete Z._unclipped,Z},s=Math.PI,c0=Math.round,M=Math.cos,O=Math.floor,P0=Math.pow,Hm=Math.log,ut=Math.sin,hi=Math.sqrt,_=Math.atan2,l0=Math.max,b=Math.abs,l=s*2,o=s/3,n=s/180,a=180/s,w=function(){return arguments[0]instanceof t?arguments[0]:(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,arguments,function(){})},w.default=w,y=[],r!==null&&r.exports!=null&&(r.exports=w),L0=e!==null?e:this,L0.chroma=w,w.version="1.4.1",x={},u=[],g=!1,t=(function(){function Z(){var at,lt,n0,r0,f0,v0,A0,X0,q0;for(v0=this,lt=[],X0=0,r0=arguments.length;X0<r0;X0++)at=arguments[X0],at!=null&&lt.push(at);if(lt.length>1&&(A0=lt[lt.length-1]),x[A0]!=null)v0._rgb=v(x[A0](t0(lt.slice(0,-1))));else{for(g||(u=u.sort(function(i1,u1){return u1.p-i1.p}),g=!0),q0=0,f0=u.length;q0<f0&&(n0=u[q0],A0=n0.test.apply(n0,lt),!A0);q0++);A0&&(v0._rgb=v(x[A0].apply(x,lt)))}v0._rgb==null&&console.warn("unknown format: "+lt),v0._rgb==null&&(v0._rgb=[0,0,0]),v0._rgb.length===3&&v0._rgb.push(1)}return Z.prototype.toString=function(){return this.hex()},Z})(),w._input=x;w.brewer=m={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},(function(){var Z,at;at=[];for(Z in m)at.push(m[Z.toLowerCase()]=m[Z]);return at})(),o0={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},w.colors=o0,We=function(){var Z,at,lt,n0,r0,f0,v0,A0,X0;return at=t0(arguments),r0=at[0],Z=at[1],lt=at[2],A0=(r0+16)/116,v0=isNaN(Z)?A0:A0+Z/500,X0=isNaN(lt)?A0:A0-lt/200,A0=i.Yn*J(A0),v0=i.Xn*J(v0),X0=i.Zn*J(X0),f0=m0(3.2404542*v0-1.5371385*A0-.4985314*X0),n0=m0(-.969266*v0+1.8760108*A0+.041556*X0),lt=m0(.0556434*v0-.2040259*A0+1.0572252*X0),[f0,n0,lt,at.length>3?at[3]:1]},m0=function(Z){return 255*(Z<=.00304?12.92*Z:1.055*P0(Z,1/2.4)-.055)},J=function(Z){return Z>i.t1?Z*Z*Z:i.t2*(Z-i.t0)},i={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},ec=function(){var Z,at,lt,n0,r0,f0,v0,A0;return n0=t0(arguments),lt=n0[0],at=n0[1],Z=n0[2],r0=He(lt,at,Z),f0=r0[0],v0=r0[1],A0=r0[2],[116*v0-16,500*(f0-v0),200*(v0-A0)]},p0=function(Z){return(Z/=255)<=.04045?Z/12.92:P0((Z+.055)/1.055,2.4)},Ji=function(Z){return Z>i.t3?P0(Z,1/3):Z/i.t2+i.t0},He=function(){var Z,at,lt,n0,r0,f0,v0;return n0=t0(arguments),lt=n0[0],at=n0[1],Z=n0[2],lt=p0(lt),at=p0(at),Z=p0(Z),r0=Ji((.4124564*lt+.3575761*at+.1804375*Z)/i.Xn),f0=Ji((.2126729*lt+.7151522*at+.072175*Z)/i.Yn),v0=Ji((.0193339*lt+.119192*at+.9503041*Z)/i.Zn),[r0,f0,v0]},w.lab=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["lab"]),function(){})},x.lab=We,t.prototype.lab=function(){return ec(this._rgb)},h=function(Z){var at,lt,n0,r0,f0,v0,A0,X0,q0,i1,u1;return Z=(function(){var e1,Q0,e0;for(e0=[],Q0=0,e1=Z.length;Q0<e1;Q0++)r0=Z[Q0],e0.push(w(r0));return e0})(),Z.length===2?(q0=(function(){var e1,Q0,e0;for(e0=[],Q0=0,e1=Z.length;Q0<e1;Q0++)r0=Z[Q0],e0.push(r0.lab());return e0})(),f0=q0[0],v0=q0[1],at=function(e1){var Q0,e0;return e0=(function(){var T0,F0;for(F0=[],Q0=T0=0;T0<=2;Q0=++T0)F0.push(f0[Q0]+e1*(v0[Q0]-f0[Q0]));return F0})(),w.lab.apply(w,e0)}):Z.length===3?(i1=(function(){var e1,Q0,e0;for(e0=[],Q0=0,e1=Z.length;Q0<e1;Q0++)r0=Z[Q0],e0.push(r0.lab());return e0})(),f0=i1[0],v0=i1[1],A0=i1[2],at=function(e1){var Q0,e0;return e0=(function(){var T0,F0;for(F0=[],Q0=T0=0;T0<=2;Q0=++T0)F0.push((1-e1)*(1-e1)*f0[Q0]+2*(1-e1)*e1*v0[Q0]+e1*e1*A0[Q0]);return F0})(),w.lab.apply(w,e0)}):Z.length===4?(u1=(function(){var e1,Q0,e0;for(e0=[],Q0=0,e1=Z.length;Q0<e1;Q0++)r0=Z[Q0],e0.push(r0.lab());return e0})(),f0=u1[0],v0=u1[1],A0=u1[2],X0=u1[3],at=function(e1){var Q0,e0;return e0=(function(){var T0,F0;for(F0=[],Q0=T0=0;T0<=2;Q0=++T0)F0.push((1-e1)*(1-e1)*(1-e1)*f0[Q0]+3*(1-e1)*(1-e1)*e1*v0[Q0]+3*(1-e1)*e1*e1*A0[Q0]+e1*e1*e1*X0[Q0]);return F0})(),w.lab.apply(w,e0)}):Z.length===5&&(lt=h(Z.slice(0,3)),n0=h(Z.slice(2,5)),at=function(e1){return e1<.5?lt(e1*2):n0((e1-.5)*2)}),at},w.bezier=function(Z){var at;return at=h(Z),at.scale=function(){return w.scale(at)},at},w.cubehelix=function(Z,at,lt,n0,r0){var f0,v0,A0;return Z==null&&(Z=300),at==null&&(at=-1.5),lt==null&&(lt=1),n0==null&&(n0=1),r0==null&&(r0=[0,1]),f0=0,W(r0)==="array"?v0=r0[1]-r0[0]:(v0=0,r0=[r0,r0]),A0=function(X0){var q0,i1,u1,e1,Q0,e0,T0,F0,N0;return q0=l*((Z+120)/360+at*X0),T0=P0(r0[0]+v0*X0,n0),e0=f0!==0?lt[0]+X0*f0:lt,i1=e0*T0*(1-T0)/2,e1=M(q0),N0=ut(q0),F0=T0+i1*(-.14861*e1+1.78277*N0),Q0=T0+i1*(-.29227*e1-.90649*N0),u1=T0+i1*(1.97294*e1),w(v([F0*255,Q0*255,u1*255,1]))},A0.start=function(X0){return X0==null?Z:(Z=X0,A0)},A0.rotations=function(X0){return X0==null?at:(at=X0,A0)},A0.gamma=function(X0){return X0==null?n0:(n0=X0,A0)},A0.hue=function(X0){return X0==null?lt:(lt=X0,W(lt)==="array"?(f0=lt[1]-lt[0],f0===0&&(lt=lt[1])):f0=0,A0)},A0.lightness=function(X0){return X0==null?r0:(W(X0)==="array"?(r0=X0,v0=X0[1]-X0[0]):(r0=[X0,X0],v0=0),A0)},A0.scale=function(){return w.scale(A0)},A0.hue(lt),A0},w.random=function(){var Z,at,lt;for(at="0123456789abcdef",Z="#",lt=0;lt<6;++lt)Z+=at.charAt(O(Math.random()*16));return new t(Z)},y=[],H=function(Z,at,lt,n0){var r0,f0,v0,A0;for(lt==null&&(lt=.5),n0==null&&(n0="rgb"),W(Z)!=="object"&&(Z=w(Z)),W(at)!=="object"&&(at=w(at)),v0=0,f0=y.length;v0<f0;v0++)if(r0=y[v0],n0===r0[0]){A0=r0[1](Z,at,lt,n0);break}if(A0==null)throw"color mode "+n0+" is not supported";return A0.alpha(Z.alpha()+lt*(at.alpha()-Z.alpha()))},w.interpolate=H,t.prototype.interpolate=function(Z,at,lt){return H(this,Z,at,lt)},w.mix=H,t.prototype.mix=t.prototype.interpolate,x.rgb=function(){var Z,at,lt,n0;at=t0(arguments),lt=[];for(Z in at)n0=at[Z],lt.push(n0);return lt},w.rgb=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["rgb"]),function(){})},t.prototype.rgb=function(Z){return Z==null&&(Z=!0),Z?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},t.prototype.rgba=function(Z){return Z==null&&(Z=!0),Z?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},u.push({p:3,test:function(Z){var at;if(at=t0(arguments),W(at)==="array"&&at.length===3||at.length===4&&W(at[3])==="number"&&at[3]>=0&&at[3]<=1)return"rgb"}}),x.lrgb=x.rgb,K=function(Z,at,lt,n0){var r0,f0;return r0=Z._rgb,f0=at._rgb,new t(hi(P0(r0[0],2)*(1-lt)+P0(f0[0],2)*lt),hi(P0(r0[1],2)*(1-lt)+P0(f0[1],2)*lt),hi(P0(r0[2],2)*(1-lt)+P0(f0[2],2)*lt),n0)},d=function(Z){var at,lt,n0,r0,f0,v0;for(lt=1/Z.length,v0=[0,0,0,0],r0=0,n0=Z.length;r0<n0;r0++)at=Z[r0],f0=at._rgb,v0[0]+=P0(f0[0],2)*lt,v0[1]+=P0(f0[1],2)*lt,v0[2]+=P0(f0[2],2)*lt,v0[3]+=f0[3]*lt;return v0[0]=hi(v0[0]),v0[1]=hi(v0[1]),v0[2]=hi(v0[2]),v0[3]>1&&(v0[3]=1),new t(v(v0))},y.push(["lrgb",K]),w.average=function(Z,at){var lt,n0,r0,f0,v0,A0,X0,q0,i1,u1,e1,Q0,e0;if(at==null&&(at="rgb"),i1=Z.length,Z=Z.map(function(T0){return w(T0)}),X0=Z.splice(0,1)[0],at==="lrgb")return d(Z);Q0=X0.get(at),f0=[],v0=0,A0=0;for(q0 in Q0)Q0[q0]=Q0[q0]||0,f0.push(isNaN(Q0[q0])?0:1),at.charAt(q0)==="h"&&!isNaN(Q0[q0])&&(lt=Q0[q0]/180*s,v0+=M(lt),A0+=ut(lt));for(n0=X0.alpha(),e1=0,u1=Z.length;e1<u1;e1++){r0=Z[e1],e0=r0.get(at),n0+=r0.alpha();for(q0 in Q0)isNaN(e0[q0])||(f0[q0]+=1,at.charAt(q0)==="h"?(lt=e0[q0]/180*s,v0+=M(lt),A0+=ut(lt)):Q0[q0]+=e0[q0])}for(q0 in Q0)if(at.charAt(q0)==="h"){for(lt=_(A0/f0[q0],v0/f0[q0])/s*180;lt<0;)lt+=360;for(;lt>=360;)lt-=360;Q0[q0]=lt}else Q0[q0]=Q0[q0]/f0[q0];return w(Q0,at).alpha(n0/i1)},N=function(Z){var at,lt,n0,r0,f0,v0;if(Z.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(Z.length===4||Z.length===7)&&(Z=Z.substr(1)),Z.length===3&&(Z=Z.split(""),Z=Z[0]+Z[0]+Z[1]+Z[1]+Z[2]+Z[2]),v0=parseInt(Z,16),r0=v0>>16,n0=v0>>8&255,lt=v0&255,[r0,n0,lt,1];if(Z.match(/^#?([A-Fa-f0-9]{8})$/))return Z.length===9&&(Z=Z.substr(1)),v0=parseInt(Z,16),r0=v0>>24&255,n0=v0>>16&255,lt=v0>>8&255,at=c0((v0&255)/255*100)/100,[r0,n0,lt,at];if(x.css!=null&&(f0=x.css(Z)))return f0;throw"unknown color: "+Z},d0=function(Z,at){var lt,n0,r0,f0,v0,A0,X0;return at==null&&(at="auto"),v0=Z[0],r0=Z[1],n0=Z[2],lt=Z[3],at==="auto"&&(at=lt<1?"rgba":"rgb"),v0=Math.round(v0),r0=Math.round(r0),n0=Math.round(n0),X0=v0<<16|r0<<8|n0,A0="000000"+X0.toString(16),A0=A0.substr(A0.length-6),f0="0"+c0(lt*255).toString(16),f0=f0.substr(f0.length-2),"#"+(function(){switch(at.toLowerCase()){case"rgba":return A0+f0;case"argb":return f0+A0;default:return A0}})()},x.hex=function(Z){return N(Z)},w.hex=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["hex"]),function(){})},t.prototype.hex=function(Z){return Z==null&&(Z="auto"),d0(this._rgb,Z)},u.push({p:4,test:function(Z){if(arguments.length===1&&W(Z)==="string")return"hex"}}),F=function(){var Z,at,lt,n0,r0,f0,v0,A0,X0,q0,i1,u1,e1,Q0;if(Z=t0(arguments),r0=Z[0],i1=Z[1],v0=Z[2],i1===0)X0=n0=at=v0*255;else{for(Q0=[0,0,0],lt=[0,0,0],e1=v0<.5?v0*(1+i1):v0+i1-v0*i1,u1=2*v0-e1,r0/=360,Q0[0]=r0+1/3,Q0[1]=r0,Q0[2]=r0-1/3,f0=A0=0;A0<=2;f0=++A0)Q0[f0]<0&&(Q0[f0]+=1),Q0[f0]>1&&(Q0[f0]-=1),6*Q0[f0]<1?lt[f0]=u1+(e1-u1)*6*Q0[f0]:2*Q0[f0]<1?lt[f0]=e1:3*Q0[f0]<2?lt[f0]=u1+(e1-u1)*(2/3-Q0[f0])*6:lt[f0]=u1;q0=[c0(lt[0]*255),c0(lt[1]*255),c0(lt[2]*255)],X0=q0[0],n0=q0[1],at=q0[2]}return Z.length>3?[X0,n0,at,Z[3]]:[X0,n0,at]},Q=function(Z,at,lt){var n0,r0,f0,v0,A0;return Z!==void 0&&Z.length>=3&&(v0=Z,Z=v0[0],at=v0[1],lt=v0[2]),Z/=255,at/=255,lt/=255,f0=Math.min(Z,at,lt),l0=Math.max(Z,at,lt),r0=(l0+f0)/2,l0===f0?(A0=0,n0=Number.NaN):A0=r0<.5?(l0-f0)/(l0+f0):(l0-f0)/(2-l0-f0),Z===l0?n0=(at-lt)/(l0-f0):at===l0?n0=2+(lt-Z)/(l0-f0):lt===l0&&(n0=4+(Z-at)/(l0-f0)),n0*=60,n0<0&&(n0+=360),[n0,A0,r0]},w.hsl=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["hsl"]),function(){})},x.hsl=F,t.prototype.hsl=function(){return Q(this._rgb)},j=function(){var Z,at,lt,n0,r0,f0,v0,A0,X0,q0,i1,u1,e1,Q0,e0,T0,F0,N0;if(Z=t0(arguments),r0=Z[0],T0=Z[1],N0=Z[2],N0*=255,T0===0)X0=n0=at=N0;else switch(r0===360&&(r0=0),r0>360&&(r0-=360),r0<0&&(r0+=360),r0/=60,f0=O(r0),lt=r0-f0,v0=N0*(1-T0),A0=N0*(1-T0*lt),F0=N0*(1-T0*(1-lt)),f0){case 0:q0=[N0,F0,v0],X0=q0[0],n0=q0[1],at=q0[2];break;case 1:i1=[A0,N0,v0],X0=i1[0],n0=i1[1],at=i1[2];break;case 2:u1=[v0,N0,F0],X0=u1[0],n0=u1[1],at=u1[2];break;case 3:e1=[v0,A0,N0],X0=e1[0],n0=e1[1],at=e1[2];break;case 4:Q0=[F0,v0,N0],X0=Q0[0],n0=Q0[1],at=Q0[2];break;case 5:e0=[N0,v0,A0],X0=e0[0],n0=e0[1],at=e0[2]}return[X0,n0,at,Z.length>3?Z[3]:1]},it=function(){var Z,at,lt,n0,r0,f0,v0,A0,X0;return v0=t0(arguments),f0=v0[0],lt=v0[1],Z=v0[2],r0=Math.min(f0,lt,Z),l0=Math.max(f0,lt,Z),at=l0-r0,X0=l0/255,l0===0?(n0=Number.NaN,A0=0):(A0=at/l0,f0===l0&&(n0=(lt-Z)/at),lt===l0&&(n0=2+(Z-f0)/at),Z===l0&&(n0=4+(f0-lt)/at),n0*=60,n0<0&&(n0+=360)),[n0,A0,X0]},w.hsv=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["hsv"]),function(){})},x.hsv=j,t.prototype.hsv=function(){return it(this._rgb)},_0=function(Z){var at,lt,n0;return W(Z)==="number"&&Z>=0&&Z<=16777215?(n0=Z>>16,lt=Z>>8&255,at=Z&255,[n0,lt,at,1]):(console.warn("unknown num color: "+Z),[0,0,0,1])},E0=function(){var Z,at,lt,n0;return n0=t0(arguments),lt=n0[0],at=n0[1],Z=n0[2],(lt<<16)+(at<<8)+Z},w.num=function(Z){return new t(Z,"num")},t.prototype.num=function(Z){return Z==null&&(Z="rgb"),E0(this._rgb,Z)},x.num=_0,u.push({p:1,test:function(Z){if(arguments.length===1&&W(Z)==="number"&&Z>=0&&Z<=16777215)return"num"}}),I=function(){var Z,at,lt,n0,r0,f0,v0,A0,X0,q0,i1,u1,e1,Q0,e0,T0,F0,N0,H0,r1;if(lt=t0(arguments),A0=lt[0],r0=lt[1],at=lt[2],r0=r0/100,v0=v0/100*255,Z=r0*255,r0===0)u1=v0=n0=at;else switch(A0===360&&(A0=0),A0>360&&(A0-=360),A0<0&&(A0+=360),A0/=60,X0=O(A0),f0=A0-X0,q0=at*(1-r0),i1=q0+Z*(1-f0),H0=q0+Z*f0,r1=q0+Z,X0){case 0:e1=[r1,H0,q0],u1=e1[0],v0=e1[1],n0=e1[2];break;case 1:Q0=[i1,r1,q0],u1=Q0[0],v0=Q0[1],n0=Q0[2];break;case 2:e0=[q0,r1,H0],u1=e0[0],v0=e0[1],n0=e0[2];break;case 3:T0=[q0,i1,r1],u1=T0[0],v0=T0[1],n0=T0[2];break;case 4:F0=[H0,q0,r1],u1=F0[0],v0=F0[1],n0=F0[2];break;case 5:N0=[r1,q0,i1],u1=N0[0],v0=N0[1],n0=N0[2]}return[u1,v0,n0,lt.length>3?lt[3]:1]},Xe=function(){var Z,at,lt,n0,r0,f0,v0,A0,X0;return X0=t0(arguments),A0=X0[0],r0=X0[1],at=X0[2],v0=Math.min(A0,r0,at),l0=Math.max(A0,r0,at),n0=l0-v0,lt=n0*100/255,Z=v0/(255-n0)*100,n0===0?f0=Number.NaN:(A0===l0&&(f0=(r0-at)/n0),r0===l0&&(f0=2+(at-A0)/n0),at===l0&&(f0=4+(A0-r0)/n0),f0*=60,f0<0&&(f0+=360)),[f0,lt,Z]},w.hcg=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["hcg"]),function(){})},x.hcg=I,t.prototype.hcg=function(){return Xe(this._rgb)},T=function(Z){var at,lt,n0,r0,f0,v0,A0,X0;if(Z=Z.toLowerCase(),w.colors!=null&&w.colors[Z])return N(w.colors[Z]);if(f0=Z.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(A0=f0.slice(1,4),r0=v0=0;v0<=2;r0=++v0)A0[r0]=+A0[r0];A0[3]=1}else if(f0=Z.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(A0=f0.slice(1,5),r0=X0=0;X0<=3;r0=++X0)A0[r0]=+A0[r0];else if(f0=Z.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(A0=f0.slice(1,4),r0=at=0;at<=2;r0=++at)A0[r0]=c0(A0[r0]*2.55);A0[3]=1}else if(f0=Z.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(A0=f0.slice(1,5),r0=lt=0;lt<=2;r0=++lt)A0[r0]=c0(A0[r0]*2.55);A0[3]=+A0[3]}else(f0=Z.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(n0=f0.slice(1,4),n0[1]*=.01,n0[2]*=.01,A0=F(n0),A0[3]=1):(f0=Z.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(n0=f0.slice(1,4),n0[1]*=.01,n0[2]*=.01,A0=F(n0),A0[3]=+f0[4]);return A0},si=function(Z){var at;if(at=Z[3]<1?"rgba":"rgb",at==="rgb")return at+"("+Z.slice(0,3).map(c0).join(",")+")";if(at==="rgba")return at+"("+Z.slice(0,3).map(c0).join(",")+","+Z[3]+")"},x0=function(Z){return c0(Z*100)/100},U=function(Z,at){var lt;return lt=at<1?"hsla":"hsl",Z[0]=x0(Z[0]||0),Z[1]=x0(Z[1]*100)+"%",Z[2]=x0(Z[2]*100)+"%",lt==="hsla"&&(Z[3]=at),lt+"("+Z.join(",")+")"},x.css=function(Z){return T(Z)},w.css=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["css"]),function(){})},t.prototype.css=function(Z){if(Z==null&&(Z="rgb"),Z.slice(0,3)==="rgb")return si(this._rgb);if(Z.slice(0,3)==="hsl")return U(this.hsl(),this.alpha())},x.named=function(Z){return N(o0[Z])},u.push({p:5,test:function(Z){if(arguments.length===1&&o0[Z]!=null)return"named"}}),t.prototype.name=function(Z){var at,lt;arguments.length&&(o0[Z]&&(this._rgb=N(o0[Z])),this._rgb[3]=1),at=this.hex("rgb");for(lt in o0)if(at===o0[lt])return lt;return at},et=function(){var Z,at,lt,n0;return n0=t0(arguments),lt=n0[0],Z=n0[1],at=n0[2],at=at*n,[lt,M(at)*Z,ut(at)*Z]},ht=function(){var Z,at,lt,n0,r0,f0,v0,A0,X0,q0,i1;return lt=t0(arguments),A0=lt[0],r0=lt[1],v0=lt[2],q0=et(A0,r0,v0),Z=q0[0],at=q0[1],n0=q0[2],i1=We(Z,at,n0),X0=i1[0],f0=i1[1],n0=i1[2],[X0,f0,n0,lt.length>3?lt[3]:1]},Fe=function(){var Z,at,lt,n0,r0,f0;return f0=t0(arguments),r0=f0[0],Z=f0[1],at=f0[2],lt=hi(Z*Z+at*at),n0=(_(at,Z)*a+360)%360,c0(lt*1e4)===0&&(n0=Number.NaN),[r0,lt,n0]},a0=function(){var Z,at,lt,n0,r0,f0,v0;return f0=t0(arguments),r0=f0[0],lt=f0[1],at=f0[2],v0=ec(r0,lt,at),n0=v0[0],Z=v0[1],at=v0[2],Fe(n0,Z,at)},w.lch=function(){var Z;return Z=t0(arguments),new t(Z,"lch")},w.hcl=function(){var Z;return Z=t0(arguments),new t(Z,"hcl")},x.lch=ht,x.hcl=function(){var Z,at,lt,n0;return n0=t0(arguments),at=n0[0],Z=n0[1],lt=n0[2],ht([lt,Z,at])},t.prototype.lch=function(){return a0(this._rgb)},t.prototype.hcl=function(){return a0(this._rgb).reverse()},R0=function(Z){var at,lt,n0,r0,f0,v0,A0,X0,q0;return Z==null&&(Z="rgb"),X0=t0(arguments),A0=X0[0],r0=X0[1],at=X0[2],A0=A0/255,r0=r0/255,at=at/255,f0=1-Math.max(A0,Math.max(r0,at)),n0=f0<1?1/(1-f0):0,lt=(1-A0-f0)*n0,v0=(1-r0-f0)*n0,q0=(1-at-f0)*n0,[lt,v0,q0,f0]},A=function(){var Z,at,lt,n0,r0,f0,v0,A0,X0;return at=t0(arguments),n0=at[0],v0=at[1],X0=at[2],f0=at[3],Z=at.length>4?at[4]:1,f0===1?[0,0,0,Z]:(A0=n0>=1?0:255*(1-n0)*(1-f0),r0=v0>=1?0:255*(1-v0)*(1-f0),lt=X0>=1?0:255*(1-X0)*(1-f0),[A0,r0,lt,Z])},x.cmyk=function(){return A(t0(arguments))},w.cmyk=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["cmyk"]),function(){})},t.prototype.cmyk=function(){return R0(this._rgb)},x.gl=function(){var Z,at,lt,n0,r0;for(n0=(function(){var f0,v0;f0=t0(arguments),v0=[];for(at in f0)r0=f0[at],v0.push(r0);return v0}).apply(this,arguments),Z=lt=0;lt<=2;Z=++lt)n0[Z]*=255;return n0},w.gl=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["gl"]),function(){})},t.prototype.gl=function(){var Z;return Z=this._rgb,[Z[0]/255,Z[1]/255,Z[2]/255,Z[3]]},u0=function(Z,at,lt){var n0;return n0=t0(arguments),Z=n0[0],at=n0[1],lt=n0[2],Z=oi(Z),at=oi(at),lt=oi(lt),.2126*Z+.7152*at+.0722*lt},oi=function(Z){return Z/=255,Z<=.03928?Z/12.92:P0((Z+.055)/1.055,2.4)},Te=function(Z,at,lt,n0){var r0,f0;return r0=Z._rgb,f0=at._rgb,new t(r0[0]+lt*(f0[0]-r0[0]),r0[1]+lt*(f0[1]-r0[1]),r0[2]+lt*(f0[2]-r0[2]),n0)},y.push(["rgb",Te]),t.prototype.luminance=function(Z,at){var lt,n0,r0,f0,v0;return at==null&&(at="rgb"),arguments.length?(f0=this._rgb,Z===0?f0=[0,0,0,this._rgb[3]]:Z===1?f0=[255,255,255,this[3]]:(lt=u0(this._rgb),n0=1e-7,r0=20,v0=function(A0,X0){var q0,i1;return i1=A0.interpolate(X0,.5,at),q0=i1.luminance(),Math.abs(Z-q0)<n0||!r0--?i1:q0>Z?v0(A0,i1):v0(i1,X0)},lt>Z?f0=v0(w("black"),this).rgba():f0=v0(this,w("white")).rgba()),w(f0).alpha(this.alpha())):u0(this._rgb)},S0=function(Z){var at,lt,n0,r0;return r0=Z/100,r0<66?(n0=255,lt=-155.25485562709179-.44596950469579133*(lt=r0-2)+104.49216199393888*Hm(lt),at=r0<20?0:-254.76935184120902+.8274096064007395*(at=r0-10)+115.67994401066147*Hm(at)):(n0=351.97690566805693+.114206453784165*(n0=r0-55)-40.25366309332127*Hm(n0),lt=325.4494125711974+.07943456536662342*(lt=r0-50)-28.0852963507957*Hm(lt),at=255),[n0,lt,at]},O0=function(){var Z,at,lt,n0,r0,f0,v0,A0;for(f0=t0(arguments),r0=f0[0],f0[1],Z=f0[2],n0=1e3,lt=4e4,at=.4;lt-n0>at;)A0=(lt+n0)*.5,v0=S0(A0),v0[2]/v0[0]>=Z/r0?lt=A0:n0=A0;return c0(A0)},w.temperature=w.kelvin=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["temperature"]),function(){})},x.temperature=x.kelvin=x.K=S0,t.prototype.temperature=function(){return O0(this._rgb)},t.prototype.kelvin=t.prototype.temperature,w.contrast=function(Z,at){var lt,n0,r0,f0;return((r0=W(Z))==="string"||r0==="number")&&(Z=new t(Z)),((f0=W(at))==="string"||f0==="number")&&(at=new t(at)),lt=Z.luminance(),n0=at.luminance(),lt>n0?(lt+.05)/(n0+.05):(n0+.05)/(lt+.05)},w.distance=function(Z,at,lt){var n0,r0,f0,v0,A0,X0,q0;lt==null&&(lt="lab"),((A0=W(Z))==="string"||A0==="number")&&(Z=new t(Z)),((X0=W(at))==="string"||X0==="number")&&(at=new t(at)),f0=Z.get(lt),v0=at.get(lt),q0=0;for(r0 in f0)n0=(f0[r0]||0)-(v0[r0]||0),q0+=n0*n0;return Math.sqrt(q0)},w.deltaE=function(Z,at,lt,n0){var r0,f0,v0,A0,X0,q0,i1,u1,e1,Q0,e0,T0,F0,N0,H0,r1,h1,p1,o1,G0,s1,c1,x1,m1,S1,w1,l1;for(lt==null&&(lt=1),n0==null&&(n0=1),((h1=W(Z))==="string"||h1==="number")&&(Z=new t(Z)),((p1=W(at))==="string"||p1==="number")&&(at=new t(at)),o1=Z.lab(),r0=o1[0],v0=o1[1],X0=o1[2],G0=at.lab(),f0=G0[0],A0=G0[1],q0=G0[2],i1=hi(v0*v0+X0*X0),u1=hi(A0*A0+q0*q0),x1=r0<16?.511:.040975*r0/(1+.01765*r0),s1=.0638*i1/(1+.0131*i1)+.638,r1=i1<1e-6?0:_(X0,v0)*180/s;r1<0;)r1+=360;for(;r1>=360;)r1-=360;return m1=r1>=164&&r1<=345?.56+b(.2*M(s*(r1+168)/180)):.36+b(.4*M(s*(r1+35)/180)),e1=i1*i1*i1*i1,H0=hi(e1/(e1+1900)),c1=s1*(H0*m1+1-H0),N0=r0-f0,F0=i1-u1,e0=v0-A0,T0=X0-q0,Q0=e0*e0+T0*T0-F0*F0,S1=N0/(lt*x1),w1=F0/(n0*s1),l1=c1,hi(S1*S1+w1*w1+Q0/(l1*l1))},t.prototype.get=function(Z){var at,lt,n0,r0,f0,v0;return n0=this,f0=Z.split("."),r0=f0[0],at=f0[1],v0=n0[r0](),at?(lt=r0.indexOf(at),lt>-1?v0[lt]:console.warn("unknown channel "+at+" in mode "+r0)):v0},t.prototype.set=function(Z,at){var lt,n0,r0,f0,v0,A0;if(r0=this,v0=Z.split("."),f0=v0[0],lt=v0[1],lt)if(A0=r0[f0](),n0=f0.indexOf(lt),n0>-1)if(W(at)==="string")switch(at.charAt(0)){case"+":A0[n0]+=+at;break;case"-":A0[n0]+=+at;break;case"*":A0[n0]*=+at.substr(1);break;case"/":A0[n0]/=+at.substr(1);break;default:A0[n0]=+at}else A0[n0]=at;else console.warn("unknown channel "+lt+" in mode "+f0);else A0=at;return w(A0,f0).alpha(r0.alpha())},t.prototype.clipped=function(){return this._rgb._clipped||!1},t.prototype.alpha=function(Z){return arguments.length?w.rgb([this._rgb[0],this._rgb[1],this._rgb[2],Z]):this._rgb[3]},t.prototype.darken=function(Z){var at,lt;return Z==null&&(Z=1),lt=this,at=lt.lab(),at[0]-=i.Kn*Z,w.lab(at).alpha(lt.alpha())},t.prototype.brighten=function(Z){return Z==null&&(Z=1),this.darken(-Z)},t.prototype.darker=t.prototype.darken,t.prototype.brighter=t.prototype.brighten,t.prototype.saturate=function(Z){var at,lt;return Z==null&&(Z=1),lt=this,at=lt.lch(),at[1]+=Z*i.Kn,at[1]<0&&(at[1]=0),w.lch(at).alpha(lt.alpha())},t.prototype.desaturate=function(Z){return Z==null&&(Z=1),this.saturate(-Z)},t.prototype.premultiply=function(){var Z,at;return at=this.rgb(),Z=this.alpha(),w(at[0]*Z,at[1]*Z,at[2]*Z,Z)},f=function(Z,at,lt){if(!f[lt])throw"unknown blend mode "+lt;return f[lt](Z,at)},E=function(Z){return function(at,lt){var n0,r0;return n0=w(lt).rgb(),r0=w(at).rgb(),w(Z(n0,r0),"rgb")}},L=function(Z){return function(at,lt){var n0,r0,f0;for(f0=[],n0=r0=0;r0<=3;n0=++r0)f0[n0]=Z(at[n0],lt[n0]);return f0}},U0=function(Z,at){return Z},M0=function(Z,at){return Z*at/255},R=function(Z,at){return Z>at?at:Z},er=function(Z,at){return Z>at?Z:at},b0=function(Z,at){return 255*(1-(1-Z/255)*(1-at/255))},C0=function(Z,at){return at<128?2*Z*at/255:255*(1-2*(1-Z/255)*(1-at/255))},S=function(Z,at){return 255*(1-(1-at/255)/(Z/255))},P=function(Z,at){return Z===255||(Z=255*(at/255)/(1-Z/255),Z>255)?255:Z},f.normal=E(L(U0)),f.multiply=E(L(M0)),f.screen=E(L(b0)),f.overlay=E(L(C0)),f.darken=E(L(R)),f.lighten=E(L(er)),f.dodge=E(L(P)),f.burn=E(L(S)),w.blend=f,w.analyze=function(Z){var at,lt,n0,r0;for(n0={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},lt=0,at=Z.length;lt<at;lt++)r0=Z[lt],r0!=null&&!isNaN(r0)&&(n0.values.push(r0),n0.sum+=r0,r0<n0.min&&(n0.min=r0),r0>n0.max&&(n0.max=r0),n0.count+=1);return n0.domain=[n0.min,n0.max],n0.limits=function(f0,v0){return w.limits(n0,f0,v0)},n0},w.scale=function(Z,at){var lt,n0,r0,f0,v0,A0,X0,q0,i1,u1,e1,Q0,e0,T0,F0,N0,H0,r1,h1,p1,o1;return i1="rgb",u1=w("#ccc"),T0=0,v0=[0,1],e0=[],Q0=[0,0],lt=!1,r0=[],e1=!1,q0=0,X0=1,f0=!1,n0={},F0=!0,A0=1,p1=function(G0){var s1,c1,x1,m1,S1,w1;if(G0==null&&(G0=["#fff","#000"]),G0!=null&&W(G0)==="string"&&w.brewer!=null&&(G0=w.brewer[G0]||w.brewer[G0.toLowerCase()]||G0),W(G0)==="array"){for(G0.length===1&&(G0=[G0[0],G0[0]]),G0=G0.slice(0),s1=x1=0,m1=G0.length-1;0<=m1?x1<=m1:x1>=m1;s1=0<=m1?++x1:--x1)c1=G0[s1],W(c1)==="string"&&(G0[s1]=w(c1));for(e0.length=0,s1=w1=0,S1=G0.length-1;0<=S1?w1<=S1:w1>=S1;s1=0<=S1?++w1:--w1)e0.push(s1/(G0.length-1))}return h1(),r0=G0},H0=function(G0){var s1,c1;if(lt!=null){for(c1=lt.length-1,s1=0;s1<c1&&G0>=lt[s1];)s1++;return s1-1}return 0},o1=function(G0){return G0},r1=function(G0,s1){var c1,x1,m1,S1,w1,l1,_1,b1;if(s1==null&&(s1=!1),isNaN(G0)||G0===null)return u1;if(s1?b1=G0:lt&&lt.length>2?(c1=H0(G0),b1=c1/(lt.length-2)):X0!==q0?b1=(G0-q0)/(X0-q0):b1=1,s1||(b1=o1(b1)),A0!==1&&(b1=P0(b1,A0)),b1=Q0[0]+b1*(1-Q0[0]-Q0[1]),b1=Math.min(1,Math.max(0,b1)),S1=Math.floor(b1*1e4),F0&&n0[S1])x1=n0[S1];else{if(W(r0)==="array")for(m1=w1=0,_1=e0.length-1;0<=_1?w1<=_1:w1>=_1;m1=0<=_1?++w1:--w1){if(l1=e0[m1],b1<=l1){x1=r0[m1];break}if(b1>=l1&&m1===e0.length-1){x1=r0[m1];break}if(b1>l1&&b1<e0[m1+1]){b1=(b1-l1)/(e0[m1+1]-l1),x1=w.interpolate(r0[m1],r0[m1+1],b1,i1);break}}else W(r0)==="function"&&(x1=r0(b1));F0&&(n0[S1]=x1)}return x1},h1=function(){return n0={}},p1(Z),N0=function(G0){var s1;return s1=w(r1(G0)),e1&&s1[e1]?s1[e1]():s1},N0.classes=function(G0){var s1;return G0!=null?(W(G0)==="array"?(lt=G0,v0=[G0[0],G0[G0.length-1]]):(s1=w.analyze(v0),G0===0?lt=[s1.min,s1.max]:lt=w.limits(s1,"e",G0)),N0):lt},N0.domain=function(G0){var s1,c1,x1,m1,S1,w1,l1;if(!arguments.length)return v0;if(q0=G0[0],X0=G0[G0.length-1],e0=[],x1=r0.length,G0.length===x1&&q0!==X0)for(S1=0,m1=G0.length;S1<m1;S1++)c1=G0[S1],e0.push((c1-q0)/(X0-q0));else for(s1=l1=0,w1=x1-1;0<=w1?l1<=w1:l1>=w1;s1=0<=w1?++l1:--l1)e0.push(s1/(x1-1));return v0=[q0,X0],N0},N0.mode=function(G0){return arguments.length?(i1=G0,h1(),N0):i1},N0.range=function(G0,s1){return p1(G0,s1),N0},N0.out=function(G0){return e1=G0,N0},N0.spread=function(G0){return arguments.length?(T0=G0,N0):T0},N0.correctLightness=function(G0){return G0==null&&(G0=!0),f0=G0,h1(),f0?o1=function(s1){var c1,x1,m1,S1,w1,l1,_1,b1,T1;for(c1=r1(0,!0).lab()[0],x1=r1(1,!0).lab()[0],_1=c1>x1,m1=r1(s1,!0).lab()[0],w1=c1+(x1-c1)*s1,S1=m1-w1,b1=0,T1=1,l1=20;Math.abs(S1)>.01&&l1-- >0;)(function(){return _1&&(S1*=-1),S1<0?(b1=s1,s1+=(T1-s1)*.5):(T1=s1,s1+=(b1-s1)*.5),m1=r1(s1,!0).lab()[0],S1=m1-w1})();return s1}:o1=function(s1){return s1},N0},N0.padding=function(G0){return G0!=null?(W(G0)==="number"&&(G0=[G0,G0]),Q0=G0,N0):Q0},N0.colors=function(G0,s1){var c1,x1,m1,S1,w1,l1,_1,b1;if(arguments.length<2&&(s1="hex"),w1=[],arguments.length===0)w1=r0.slice(0);else if(G0===1)w1=[N0(.5)];else if(G0>1)x1=v0[0],c1=v0[1]-x1,w1=(function(){l1=[];for(var T1=0;0<=G0?T1<G0:T1>G0;0<=G0?T1++:T1--)l1.push(T1);return l1}).apply(this).map(function(T1){return N0(x1+T1/(G0-1)*c1)});else{if(Z=[],_1=[],lt&&lt.length>2)for(m1=b1=1,S1=lt.length;1<=S1?b1<S1:b1>S1;m1=1<=S1?++b1:--b1)_1.push((lt[m1-1]+lt[m1])*.5);else _1=v0;w1=_1.map(function(T1){return N0(T1)})}return w[s1]&&(w1=w1.map(function(T1){return T1[s1]()})),w1},N0.cache=function(G0){return G0!=null?(F0=G0,N0):F0},N0.gamma=function(G0){return G0!=null?(A0=G0,N0):A0},N0.nodata=function(G0){return G0!=null?(u1=w(G0),N0):u1},N0},w.scales==null&&(w.scales={}),w.scales.cool=function(){return w.scale([w.hsl(180,1,.9),w.hsl(250,.7,.4)])},w.scales.hot=function(){return w.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},w.analyze=function(Z,at,lt){var n0,r0,f0,v0,A0,X0,q0;if(A0={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},lt==null&&(lt=function(){return!0}),n0=function(i1){i1!=null&&!isNaN(i1)&&(A0.values.push(i1),A0.sum+=i1,i1<A0.min&&(A0.min=i1),i1>A0.max&&(A0.max=i1),A0.count+=1)},q0=function(i1,u1){if(lt(i1,u1))return at!=null&&W(at)==="function"?n0(at(i1)):at!=null&&W(at)==="string"||W(at)==="number"?n0(i1[at]):n0(i1)},W(Z)==="array")for(v0=0,f0=Z.length;v0<f0;v0++)X0=Z[v0],q0(X0);else for(r0 in Z)X0=Z[r0],q0(X0,r0);return A0.domain=[A0.min,A0.max],A0.limits=function(i1,u1){return w.limits(A0,i1,u1)},A0},w.limits=function(Z,at,lt){var n0,r0,f0,v0,A0,X0,q0,i1,u1,e1,Q0,e0,T0,F0,N0,H0,r1,h1,p1,o1,G0,s1,c1,x1,m1,S1,w1,l1,_1,b1,T1,Z1,O_,lv,pv,Q1,X_,F_,D_,F1,mv,Q_,cv,bv,uv,$v,H_,fx,px,sv,I_,Y_,V1,j_,J_;if(at==null&&(at="equal"),lt==null&&(lt=7),W(Z)==="array"&&(Z=w.analyze(Z)),m1=Z.min,l0=Z.max,Z.sum,j_=Z.values.sort(function(nx,Sv){return nx-Sv}),lt===1)return[m1,l0];if(c1=[],at.substr(0,1)==="c"&&(c1.push(m1),c1.push(l0)),at.substr(0,1)==="e"){for(c1.push(m1),o1=T1=1,pv=lt-1;1<=pv?T1<=pv:T1>=pv;o1=1<=pv?++T1:--T1)c1.push(m1+o1/lt*(l0-m1));c1.push(l0)}else if(at.substr(0,1)==="l"){if(m1<=0)throw"Logarithmic scales are only possible for values > 0";for(S1=Math.LOG10E*Hm(m1),x1=Math.LOG10E*Hm(l0),c1.push(m1),o1=J_=1,Q1=lt-1;1<=Q1?J_<=Q1:J_>=Q1;o1=1<=Q1?++J_:--J_)c1.push(P0(10,S1+o1/lt*(x1-S1)));c1.push(l0)}else if(at.substr(0,1)==="q"){for(c1.push(m1),o1=n0=1,Q_=lt-1;1<=Q_?n0<=Q_:n0>=Q_;o1=1<=Q_?++n0:--n0)Z1=(j_.length-1)*o1/lt,O_=O(Z1),O_===Z1?c1.push(j_[O_]):(lv=Z1-O_,c1.push(j_[O_]*(1-lv)+j_[O_+1]*lv));c1.push(l0)}else if(at.substr(0,1)==="k"){for(l1=j_.length,F0=new Array(l1),h1=new Array(lt),sv=!0,_1=0,H0=null,H0=[],H0.push(m1),o1=r0=1,cv=lt-1;1<=cv?r0<=cv:r0>=cv;o1=1<=cv?++r0:--r0)H0.push(m1+o1/lt*(l0-m1));for(H0.push(l0);sv;){for(G0=f0=0,bv=lt-1;0<=bv?f0<=bv:f0>=bv;G0=0<=bv?++f0:--f0)h1[G0]=0;for(o1=v0=0,uv=l1-1;0<=uv?v0<=uv:v0>=uv;o1=0<=uv?++v0:--v0){for(V1=j_[o1],w1=Number.MAX_VALUE,G0=A0=0,$v=lt-1;0<=$v?A0<=$v:A0>=$v;G0=0<=$v?++A0:--A0)p1=b(H0[G0]-V1),p1<w1&&(w1=p1,N0=G0);h1[N0]++,F0[o1]=N0}for(b1=new Array(lt),G0=X0=0,H_=lt-1;0<=H_?X0<=H_:X0>=H_;G0=0<=H_?++X0:--X0)b1[G0]=null;for(o1=q0=0,fx=l1-1;0<=fx?q0<=fx:q0>=fx;o1=0<=fx?++q0:--q0)r1=F0[o1],b1[r1]===null?b1[r1]=j_[o1]:b1[r1]+=j_[o1];for(G0=i1=0,px=lt-1;0<=px?i1<=px:i1>=px;G0=0<=px?++i1:--i1)b1[G0]*=1/h1[G0];for(sv=!1,G0=u1=0,X_=lt-1;0<=X_?u1<=X_:u1>=X_;G0=0<=X_?++u1:--u1)if(b1[G0]!==H0[o1]){sv=!0;break}H0=b1,_1++,_1>200&&(sv=!1)}for(s1={},G0=e1=0,F_=lt-1;0<=F_?e1<=F_:e1>=F_;G0=0<=F_?++e1:--e1)s1[G0]=[];for(o1=Q0=0,D_=l1-1;0<=D_?Q0<=D_:Q0>=D_;o1=0<=D_?++Q0:--Q0)r1=F0[o1],s1[r1].push(j_[o1]);for(I_=[],G0=e0=0,F1=lt-1;0<=F1?e0<=F1:e0>=F1;G0=0<=F1?++e0:--e0)I_.push(s1[G0][0]),I_.push(s1[G0][s1[G0].length-1]);for(I_=I_.sort(function(nx,Sv){return nx-Sv}),c1.push(I_[0]),o1=T0=1,mv=I_.length-1;T0<=mv;o1=T0+=2)Y_=I_[o1],!isNaN(Y_)&&c1.indexOf(Y_)===-1&&c1.push(Y_)}return c1},k=function(Z,at,lt){var n0,r0,f0,v0;return n0=t0(arguments),Z=n0[0],at=n0[1],lt=n0[2],isNaN(Z)&&(Z=0),Z/=360,Z<1/3?(r0=(1-at)/3,v0=(1+at*M(l*Z)/M(o-l*Z))/3,f0=1-(r0+v0)):Z<2/3?(Z-=1/3,v0=(1-at)/3,f0=(1+at*M(l*Z)/M(o-l*Z))/3,r0=1-(v0+f0)):(Z-=2/3,f0=(1-at)/3,r0=(1+at*M(l*Z)/M(o-l*Z))/3,v0=1-(f0+r0)),v0=tr(lt*v0*3),f0=tr(lt*f0*3),r0=tr(lt*r0*3),[v0*255,f0*255,r0*255,n0.length>3?n0[3]:1]},w0=function(){var Z,at,lt,n0,r0,f0,v0,A0;return v0=t0(arguments),f0=v0[0],at=v0[1],Z=v0[2],l=Math.PI*2,f0/=255,at/=255,Z/=255,r0=Math.min(f0,at,Z),n0=(f0+at+Z)/3,A0=1-r0/n0,A0===0?lt=0:(lt=(f0-at+(f0-Z))/2,lt/=Math.sqrt((f0-at)*(f0-at)+(f0-Z)*(at-Z)),lt=Math.acos(lt),Z>at&&(lt=l-lt),lt/=l),[lt*360,A0,n0]},w.hsi=function(){return(function(Z,at,lt){lt.prototype=Z.prototype;var n0=new lt,r0=Z.apply(n0,at);return Object(r0)===r0?r0:n0})(t,I0.call(arguments).concat(["hsi"]),function(){})},x.hsi=k,t.prototype.hsi=function(){return w0(this._rgb)},B=function(Z,at,lt,n0){var r0,f0,v0,A0,X0,q0,i1,u1,e1,Q0,e0,T0;return n0==="hsl"?(e0=Z.hsl(),T0=at.hsl()):n0==="hsv"?(e0=Z.hsv(),T0=at.hsv()):n0==="hcg"?(e0=Z.hcg(),T0=at.hcg()):n0==="hsi"?(e0=Z.hsi(),T0=at.hsi()):(n0==="lch"||n0==="hcl")&&(n0="hcl",e0=Z.hcl(),T0=at.hcl()),n0.substr(0,1)==="h"&&(v0=e0[0],e1=e0[1],q0=e0[2],A0=T0[0],Q0=T0[1],i1=T0[2]),!isNaN(v0)&&!isNaN(A0)?(A0>v0&&A0-v0>180?r0=A0-(v0+360):A0<v0&&v0-A0>180?r0=A0+360-v0:r0=A0-v0,f0=v0+lt*r0):isNaN(v0)?isNaN(A0)?f0=Number.NaN:(f0=A0,(q0===1||q0===0)&&n0!=="hsv"&&(u1=Q0)):(f0=v0,(i1===1||i1===0)&&n0!=="hsv"&&(u1=e1)),u1==null&&(u1=e1+lt*(Q0-e1)),X0=q0+lt*(i1-q0),w[n0](f0,u1,X0)},y=y.concat((function(){var Z,at,lt,n0;for(lt=["hsv","hsl","hsi","hcl","lch","hcg"],n0=[],at=0,Z=lt.length;at<Z;at++)h0=lt[at],n0.push([h0,B]);return n0})()),q=function(Z,at,lt,n0){var r0,f0;return r0=Z.num(),f0=at.num(),w.num(r0+(f0-r0)*lt,"num")},y.push(["num",q]),V=function(Z,at,lt,n0){var r0,f0;return r0=Z.lab(),f0=at.lab(),new t(r0[0]+lt*(f0[0]-r0[0]),r0[1]+lt*(f0[1]-r0[1]),r0[2]+lt*(f0[2]-r0[2]),n0)},y.push(["lab",V])}).call(chroma)})(chroma$1,chroma$1.exports)),chroma$1.exports}var chromaExports=requireChroma(),signals$1={exports:{}},signals=signals$1.exports,hasRequiredSignals;function requireSignals(){return hasRequiredSignals||(hasRequiredSignals=1,(function(r){(function(e){function t(o,a,l,d,u){this._listener=a,this._isOnce=l,this.context=d,this._signal=o,this._priority=u||0}t.prototype={active:!0,params:null,execute:function(o){var a,l;return this.active&&this._listener&&(l=this.params?this.params.concat(o):o,a=this._listener.apply(this.context,l),this._isOnce&&this.detach()),a},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal,delete this._listener,delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};function n(o,a){if(typeof o!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",a))}function i(){this._bindings=[],this._prevParams=null;var o=this;this.dispatch=function(){i.prototype.dispatch.apply(o,arguments)}}i.prototype={VERSION:"1.0.0",memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(o,a,l,d){var u=this._indexOfListener(o,l),g;if(u!==-1){if(g=this._bindings[u],g.isOnce()!==a)throw new Error("You cannot add"+(a?"":"Once")+"() then add"+(a?"Once":"")+"() the same listener without removing the relationship first.")}else g=new t(this,o,a,l,d),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(o){var a=this._bindings.length;do--a;while(this._bindings[a]&&o._priority<=this._bindings[a]._priority);this._bindings.splice(a+1,0,o)},_indexOfListener:function(o,a){for(var l=this._bindings.length,d;l--;)if(d=this._bindings[l],d._listener===o&&d.context===a)return l;return-1},has:function(o,a){return this._indexOfListener(o,a)!==-1},add:function(o,a,l){return n(o,"add"),this._registerListener(o,!1,a,l)},addOnce:function(o,a,l){return n(o,"addOnce"),this._registerListener(o,!0,a,l)},remove:function(o,a){n(o,"remove");var l=this._indexOfListener(o,a);return l!==-1&&(this._bindings[l]._destroy(),this._bindings.splice(l,1)),o},removeAll:function(){for(var o=this._bindings.length;o--;)this._bindings[o]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(o){if(this.active){var a=Array.prototype.slice.call(arguments),l=this._bindings.length,d;if(this.memorize&&(this._prevParams=a),!!l){d=this._bindings.slice(),this._shouldPropagate=!0;do l--;while(d[l]&&this._shouldPropagate&&d[l].execute(a)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var s=i;s.Signal=i,r.exports?r.exports=s:e.signals=s})(signals)})(signals$1)),signals$1.exports}var signalsExports=requireSignals(),sprintf={},hasRequiredSprintf;function requireSprintf(){return hasRequiredSprintf||(hasRequiredSprintf=1,(function(r){(function(){var e={not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function t(a){return i(o(a),arguments)}function n(a,l){return t.apply(null,[a].concat(l||[]))}function i(a,l){var d=1,u=a.length,g,x="",y,b,_,h,f,E,m,S;for(y=0;y<u;y++)if(typeof a[y]=="string")x+=a[y];else if(typeof a[y]=="object"){if(_=a[y],_.keys)for(g=l[d],b=0;b<_.keys.length;b++){if(g==null)throw new Error(t('[sprintf] Cannot access property "%s" of undefined value "%s"',_.keys[b],_.keys[b-1]));g=g[_.keys[b]]}else _.param_no?g=l[_.param_no]:g=l[d++];if(e.not_type.test(_.type)&&e.not_primitive.test(_.type)&&g instanceof Function&&(g=g()),e.numeric_arg.test(_.type)&&typeof g!="number"&&isNaN(g))throw new TypeError(t("[sprintf] expecting number but found %T",g));switch(e.number.test(_.type)&&(m=g>=0),_.type){case"b":g=parseInt(g,10).toString(2);break;case"c":g=String.fromCharCode(parseInt(g,10));break;case"d":case"i":g=parseInt(g,10);break;case"j":g=JSON.stringify(g,null,_.width?parseInt(_.width):0);break;case"e":g=_.precision?parseFloat(g).toExponential(_.precision):parseFloat(g).toExponential();break;case"f":g=_.precision?parseFloat(g).toFixed(_.precision):parseFloat(g);break;case"g":g=_.precision?String(Number(g.toPrecision(_.precision))):parseFloat(g);break;case"o":g=(parseInt(g,10)>>>0).toString(8);break;case"s":g=String(g),g=_.precision?g.substring(0,_.precision):g;break;case"t":g=String(!!g),g=_.precision?g.substring(0,_.precision):g;break;case"T":g=Object.prototype.toString.call(g).slice(8,-1).toLowerCase(),g=_.precision?g.substring(0,_.precision):g;break;case"u":g=parseInt(g,10)>>>0;break;case"v":g=g.valueOf(),g=_.precision?g.substring(0,_.precision):g;break;case"x":g=(parseInt(g,10)>>>0).toString(16);break;case"X":g=(parseInt(g,10)>>>0).toString(16).toUpperCase();break}e.json.test(_.type)?x+=g:(e.number.test(_.type)&&(!m||_.sign)?(S=m?"+":"-",g=g.toString().replace(e.sign,"")):S="",f=_.pad_char?_.pad_char==="0"?"0":_.pad_char.charAt(1):" ",E=_.width-(S+g).length,h=_.width&&E>0?f.repeat(E):"",x+=_.align?S+g+h:f==="0"?S+h+g:h+S+g)}return x}var s=Object.create(null);function o(a){if(s[a])return s[a];for(var l=a,d,u=[],g=0;l;){if((d=e.text.exec(l))!==null)u.push(d[0]);else if((d=e.modulo.exec(l))!==null)u.push("%");else if((d=e.placeholder.exec(l))!==null){if(d[2]){g|=1;var x=[],y=d[2],b=[];if((b=e.key.exec(y))!==null)for(x.push(b[1]);(y=y.substring(b[0].length))!=="";)if((b=e.key_access.exec(y))!==null)x.push(b[1]);else if((b=e.index_access.exec(y))!==null)x.push(b[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");d[2]=x}else g|=2;if(g===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");u.push({placeholder:d[0],param_no:d[1],keys:d[2],sign:d[3],pad_char:d[4],align:d[5],width:d[6],precision:d[7],type:d[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");l=l.substring(d[0].length)}return s[a]=u}r.sprintf=t,r.vsprintf=n,typeof window<"u"&&(window.sprintf=t,window.vsprintf=n)})()})(sprintf)),sprintf}var sprintfExports=requireSprintf(),define_process_env_default={};function rt(r){if(typeof window>"u")return;const e=new RegExp(`${r}=([^&#=]*)`).exec(window.location.search);return e?decodeURIComponent(e[1]):void 0}function nt(r,e){return r!==void 0?r:e}function st(r,e){const t=Object.assign({},r);for(const n in e)r[n]===void 0&&(t[n]=e[n]);return t}function ot(r,e){for(const t in e){const n=e[t];n!==void 0&&(r[t]=n)}return r}function ct(){if(typeof window>"u")return!1;const r=window.navigator.userAgent;return/Opera|OPR/.test(r)?"Opera":/Chrome/i.test(r)?"Chrome":/Firefox/i.test(r)?"Firefox":/Mobile(\/.*)? Safari/i.test(r)?"Mobile Safari":/MSIE/i.test(r)?"Internet Explorer":!!/Safari/i.test(r)&&"Safari"}function dt(r,e){return r<e?-1:r>e?1:0}function mt(r,e,t=dt){let n=0,i=r.length-1;for(;n<=i;){const s=n+i>>1,o=t(e,r[s]);if(o>0)n=s+1;else{if(!(o<0))return s;i=s-1}}return-n-1}function ft(r,e,t){const n=(function(s,o){let a=s.length-1;if(s[a]<o)return-1;let l=0;for(;l<=a;){const d=l+a>>1;s[d]>=o?a=d-1:l=d+1}return a+1})(r,e),i=(function(s,o){if(s[0]>o)return-1;let a=0,l=s.length-1;for(;a<=l;){const d=a+l>>1;s[d]>o?l=d-1:a=d+1}return a-1})(r,t);return n===-1||i===-1||n>i?0:i-n+1}function pt(r){return r.sort().filter((function(e,t,n){return t===0||e!==n[t-1]}))}function gt(r){if(r.length>28672){const t=[];for(let n=0;n<r.length;n+=28672)t.push(String.fromCharCode.apply(null,r.subarray(n,n+28672)));return t.join("")}return String.fromCharCode.apply(null,r)}function yt(r,e){switch(r){case"int8":return new Int8Array(e);case"int16":return new Int16Array(e);case"int32":return new Int32Array(e);case"uint8":return new Uint8Array(e);case"uint16":return new Uint16Array(e);case"uint32":return new Uint32Array(e);case"float32":return new Float32Array(e);default:throw new Error("arrayType unknown: "+r)}}function bt(r,e){return new(e>65535?Uint32Array:Uint16Array)(r)}function _t(r){return r.buffer&&r.buffer instanceof ArrayBuffer?r.buffer:r}function xt(r,e){return r===void 0?r=new e:Array.isArray(r)&&(r=new e().fromArray(r)),r}function vt(r){return xt(r,Vector3)}function wt(r){return xt(r,Matrix4)}function At(r){return xt(r,Quaternion)}function St(r){return e=r,t=Float32Array,e instanceof t?e:new t(e);var e,t}function Ct(r){return nt(r,"").toString().toLowerCase()}class Pt{constructor(e){this.name=e,this._dict={}}add(e,t){this._dict[Ct(e)]=t}get(e){return this._dict[Ct(e)]}get names(){return Object.keys(this._dict)}}function It(r){return .01745*r}const kt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Mt=new Array(36);function Tt(){let r,e=0;for(let t=0;t<36;t++)t===8||t===13||t===18||t===23?Mt[t]="-":t===14?Mt[t]="4":(e<=2&&(e=33554432+16777216*Math.random()|0),r=15&e,e>>=4,Mt[t]=kt[t===19?3&r|8:r]);return Mt.join("")}function Dt(r,e,t){return Math.max(e,Math.min(t,r))}function Bt(r,e,t){return r+(e-r)*t}function Ft(r,e,t,n,i,s){const o=(t-r)*s,a=(n-e)*s,l=i*i;return(2*e-2*t+o+a)*(i*l)+(-3*e+3*t-2*o-a)*l+o*i+e}function Et(r,e,t){var n;return n=(function(i,s,o){return(i-s)/(o-s)})(t,r,e),(t=Dt(n,0,1))*t*(3-2*t)}var $t="sRGB";const Ot={scale:"uniform",mode:"hcl",domain:[0,1],value:16777215,reverse:!1},Rt=new Color;function Lt(r,e,t){const n=t.value;return t.value=function(i,s){let o=n.bind(this,i,s)();return $t=="linear"?(Rt.set(o),Rt.convertSRGBToLinear(),Rt.getHex()):o},t}class Nt{constructor(e={}){this.parameters=st(e,Ot),typeof this.parameters.value=="string"&&(this.parameters.value=Rt.set(this.parameters.value).getHex()),this.parameters.structure&&(this.atomProxy=this.parameters.structure.getAtomProxy())}getScale(e={}){const t=st(e,this.parameters);return t.scale==="rainbow"?t.scale=["red","orange","yellow","green","blue"]:t.scale==="rwb"&&(t.scale=["red","white","blue"]),t.reverse&&(t.domain=t.domain.slice().reverse()),chromaExports.scale(t.scale).mode(t.mode).domain(t.domain).out("num")}colorToArray(e,t=[],n=0){return t[n]=(e>>16&255)/255,t[n+1]=(e>>8&255)/255,t[n+2]=(255&e)/255,t}atomColorToArray(e,t,n){return this.colorToArray(this.atomColor?this.atomColor(e):0,t,n)}bondColor(e,t){return this.atomProxy&&this.atomColor?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):0}bondColorToArray(e,t,n,i){return this.colorToArray(this.bondColor(e,t),n,i)}volumeColorToArray(e,t,n){return this.colorToArray(this.volumeColor?this.volumeColor(e):0,t,n)}positionColorToArray(e,t,n){return this.colorToArray(this.positionColor?this.positionColor(e):0,t,n)}}var zt;(function(r){r[r.PROTEIN=1]="PROTEIN",r[r.NUCLEIC=2]="NUCLEIC",r[r.RNA=3]="RNA",r[r.DNA=4]="DNA",r[r.POLYMER=5]="POLYMER",r[r.WATER=6]="WATER",r[r.HELIX=7]="HELIX",r[r.SHEET=8]="SHEET",r[r.TURN=9]="TURN",r[r.BACKBONE=10]="BACKBONE",r[r.SIDECHAIN=11]="SIDECHAIN",r[r.ALL=12]="ALL",r[r.HETERO=13]="HETERO",r[r.ION=14]="ION",r[r.SACCHARIDE=15]="SACCHARIDE",r[r.SUGAR=15]="SUGAR",r[r.BONDED=16]="BONDED",r[r.RING=17]="RING",r[r.AROMATICRING=18]="AROMATICRING",r[r.METAL=19]="METAL",r[r.POLARH=20]="POLARH",r[r.NONE=21]="NONE"})(zt||(zt={}));const Ut=["*","","ALL"],Vt=["NONE"],jt=[zt.BACKBONE,zt.SIDECHAIN,zt.BONDED,zt.RING,zt.AROMATICRING,zt.METAL,zt.POLARH],Gt=[zt.POLYMER,zt.WATER],Ht=["ALA","GLY","SER"],qt=["CYS","SER","THR"],Wt=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],Xt=["PHE","TRP","TYR","HIS"],Yt=["ASN","GLN"],Kt=["ASP","GLU"],Zt=["ARG","HIS","LYS"],Qt=["ARG","ASP","GLU","HIS","LYS"],Jt=["ASN","ARG","ASP","CYS","GLY","GLN","GLU","HIS","LYS","SER","THR","TYR"],te=["ALA","ILE","LEU","MET","PHE","PRO","TRP","VAL"],ee=["HIS","PHE","PRO","TRP","TYR"],ie=["ALA","GLY","ILE","LEU","VAL"];function re(r,e){if(e.atomname===void 0&&e.element===void 0&&e.altloc===void 0&&e.atomindex===void 0&&e.keyword===void 0&&e.inscode===void 0&&e.resname===void 0&&e.sstruc===void 0&&e.resno===void 0&&e.chainname===void 0&&e.model===void 0)return-1;if(e.keyword!==void 0&&(e.keyword===zt.BACKBONE&&!r.isBackbone()||e.keyword===zt.SIDECHAIN&&!r.isSidechain()||e.keyword===zt.BONDED&&!r.isBonded()||e.keyword===zt.RING&&!r.isRing()||e.keyword===zt.AROMATICRING&&!r.isAromatic()||e.keyword===zt.HETERO&&!r.isHetero()||e.keyword===zt.PROTEIN&&!r.isProtein()||e.keyword===zt.NUCLEIC&&!r.isNucleic()||e.keyword===zt.RNA&&!r.isRna()||e.keyword===zt.DNA&&!r.isDna()||e.keyword===zt.POLYMER&&!r.isPolymer()||e.keyword===zt.WATER&&!r.isWater()||e.keyword===zt.HELIX&&!r.isHelix()||e.keyword===zt.SHEET&&!r.isSheet()||e.keyword===zt.TURN&&!r.isTurn()||e.keyword===zt.ION&&!r.isIon()||e.keyword===zt.SACCHARIDE&&!r.isSaccharide()||e.keyword===zt.METAL&&!r.isMetal()||e.keyword===zt.POLARH&&!r.isPolarHydrogen())||e.atomname!==void 0&&e.atomname!==r.atomname||e.element!==void 0&&e.element!==r.element||e.altloc!==void 0&&e.altloc!==r.altloc||e.atomindex!==void 0&&mt(e.atomindex,r.index)<0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(r.resname))return!1}else if(e.resname!==r.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==r.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>r.resno||e.resno[1]<r.resno)return!1}else if(e.resno!==r.resno)return!1}return(e.inscode===void 0||e.inscode===r.inscode)&&(e.chainname===void 0||e.chainname===r.chainname)&&(e.model===void 0||e.model===r.modelIndex)}function ne(r,e){if(e.resname===void 0&&e.resno===void 0&&e.inscode===void 0&&e.sstruc===void 0&&e.model===void 0&&e.chainname===void 0&&e.atomindex===void 0&&(e.keyword===void 0||jt.includes(e.keyword)))return-1;if(e.keyword!==void 0&&(e.keyword===zt.HETERO&&!r.isHetero()||e.keyword===zt.PROTEIN&&!r.isProtein()||e.keyword===zt.NUCLEIC&&!r.isNucleic()||e.keyword===zt.RNA&&!r.isRna()||e.keyword===zt.DNA&&!r.isDna()||e.keyword===zt.POLYMER&&!r.isPolymer()||e.keyword===zt.WATER&&!r.isWater()||e.keyword===zt.HELIX&&!r.isHelix()||e.keyword===zt.SHEET&&!r.isSheet()||e.keyword===zt.TURN&&!r.isTurn()||e.keyword===zt.ION&&!r.isIon()||e.keyword===zt.SACCHARIDE&&!r.isSaccharide())||e.atomindex!==void 0&&ft(e.atomindex,r.atomOffset,r.atomEnd)===0)return!1;if(e.resname!==void 0){if(Array.isArray(e.resname)){if(!e.resname.includes(r.resname))return!1}else if(e.resname!==r.resname)return!1}if(e.sstruc!==void 0&&e.sstruc!==r.sstruc)return!1;if(e.resno!==void 0){if(Array.isArray(e.resno)&&e.resno.length===2){if(e.resno[0]>r.resno||e.resno[1]<r.resno)return!1}else if(e.resno!==r.resno)return!1}return(e.inscode===void 0||e.inscode===r.inscode)&&(e.chainname===void 0||e.chainname===r.chainname)&&(e.model===void 0||e.model===r.modelIndex)}function se(r,e){return e.chainname!==void 0||e.model!==void 0||e.atomindex!==void 0||e.keyword!==void 0&&Gt.includes(e.keyword)&&r.entity?e.keyword!==void 0&&(e.keyword===zt.POLYMER&&!r.entity.isPolymer()||e.keyword===zt.WATER&&!r.entity.isWater())?!1:(e.atomindex===void 0||ft(e.atomindex,r.atomOffset,r.atomEnd)!==0)&&(e.chainname===void 0||e.chainname===r.chainname)&&(e.model===void 0||e.model===r.modelIndex):-1}function oe(r,e){return e.model===void 0&&e.atomindex===void 0?-1:(e.atomindex===void 0||ft(e.atomindex,r.atomOffset,r.atomEnd)!==0)&&(e.model===void 0||e.model===r.index)}function ae(r,e){if(r===null||r.error||!r.rules||r.rules.length===0)return!1;const t=r.rules.length,n=!r.negate,i=!!r.negate,s=[];for(let o=0;o<t;++o){const a=r.rules[o];a.hasOwnProperty("operator")&&(s[o]=ae(a,e))}return function(o){const a=r.operator==="AND";let l=!1;for(let d=0;d<t;++d){const u=r.rules[d];let g;if(u.hasOwnProperty("operator")){const x=s[d];if(g=x!==!1?x(o):-1,g===-1){l=!0;continue}if(g===!0){if(a)continue;return n}if(a)return i}else{if(u.keyword===zt.ALL){if(a)continue;return n}if(u.keyword===zt.NONE){if(a)continue;return i}if(g=e(o,u),g!==-1){if(g===!0){if(a)continue;return n}if(a)return i}else l=!0}}return l?-1:a?n:i}}function ce(r,e){if(r.error||!r.rules||r.rules.length===0)return r;const t=r.rules.length,n={operator:r.operator,rules:[]};r.hasOwnProperty("negate")&&(n.negate=r.negate);for(let i=0;i<t;++i){const s=r.rules[i];if(s.hasOwnProperty("operator")){const o=ce(s,e);o!==null&&n.rules.push(o)}else e(s)||n.rules.push(s)}return n.rules.length>0?r:null}function le(r,e=!1){let t=r;return e&&(t=ce(r,(function(n){return n.keyword!==void 0&&!jt.includes(n.keyword)||n.model!==void 0||n.chainname!==void 0||n.resname!==void 0||n.resno!==void 0||n.sstruc!==void 0}))),ae(t,re)}function he(r,e=!1){let t=r;return e&&(t=ce(r,(function(n){return!(n.keyword===void 0||!jt.includes(n.keyword))||n.model!==void 0||n.chainname!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0}))),ae(t,ne)}function ue(r,e=!1){let t=r;return e&&(t=ce(r,(function(n){return n.keyword!==void 0&&!Gt.includes(n.keyword)||n.resname!==void 0||n.resno!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0||n.sstruc!==void 0||n.inscode!==void 0}))),ae(t,se)}function de(r,e=!1){let t=r;return e&&(t=ce(r,(function(n){return n.keyword!==void 0||n.chainname!==void 0||n.resname!==void 0||n.resno!==void 0||n.atomname!==void 0||n.element!==void 0||n.altloc!==void 0||n.sstruc!==void 0||n.inscode!==void 0}))),ae(t,oe)}class me{constructor(e){this.signals={stringChanged:new signalsExports.Signal},this.setString(e)}get type(){return"selection"}setString(e,t){if(e===void 0&&(e=this.string||""),e===this.string)return;try{this.selection=(function(i){let s={operator:void 0,rules:[]};if(!i)return s;let o,a,l=s;const d=[];(i=i.replace(/\(/g," ( ").replace(/\)/g," ) ").trim()).charAt(0)==="("&&i.substr(-1)===")"&&(i=i.slice(1,-1).trim());const u=i.split(/\s+/),g=_=>{o={operator:_,rules:[]},l===void 0?(l=o,s=o):(l.rules.push(o),d.push(l),l=o)},x=function(_){a=l,l=d.pop(),l===void 0&&(g(_),y(a))},y=function(_){l.rules.push(_)};let b=!1;for(let _=0;_<u.length;++_){const h=u[_],f=h.toUpperCase();if(h==="("){b=!1,g();continue}if(h===")"){x(),l.negate&&x();continue}if(b>0)if(f==="NOT")b=1;else if(b===1)b=2;else{if(b!==2)throw new Error("something went wrong with 'not'");b=!1,x()}if(f==="AND"){if(l.operator==="OR"){const M=l.rules.pop();g("AND"),y(M)}else l.operator="AND";continue}if(f==="OR"){l.operator==="AND"?x("OR"):l.operator="OR";continue}if(h.toUpperCase()==="NOT"){b=1,g(),l.negate=!0;continue}if(+f!=+f){const M=zt[f];if(M!==void 0){y({keyword:M});continue}}if(f==="HYDROGEN"){y({operator:"OR",rules:[{element:"H"},{element:"D"}]});continue}if(f==="SMALL"){y({resname:Ht});continue}if(f==="NUCLEOPHILIC"){y({resname:qt});continue}if(f==="HYDROPHOBIC"){y({resname:Wt});continue}if(f==="AROMATIC"){y({resname:Xt});continue}if(f==="AMIDE"){y({resname:Yt});continue}if(f==="ACIDIC"){y({resname:Kt});continue}if(f==="BASIC"){y({resname:Zt});continue}if(f==="CHARGED"){y({resname:Qt});continue}if(f==="POLAR"){y({resname:Jt});continue}if(f==="NONPOLAR"){y({resname:te});continue}if(f==="CYCLIC"){y({resname:ee});continue}if(f==="ALIPHATIC"){y({resname:ie});continue}if(f==="SIDECHAINATTACHED"){y({operator:"OR",rules:[{keyword:zt.SIDECHAIN},{operator:"AND",negate:!1,rules:[{keyword:zt.PROTEIN},{operator:"OR",negate:!1,rules:[{atomname:"CA"},{atomname:"BB"}]}]},{operator:"AND",negate:!1,rules:[{resname:"PRO"},{atomname:"N"}]},{operator:"AND",negate:!1,rules:[{keyword:zt.NUCLEIC},{operator:"OR",negate:!0,rules:[{atomname:"P"},{atomname:"OP1"},{atomname:"OP2"},{atomname:"O3'"},{atomname:"O3*"},{atomname:"HO3'"},{atomname:"O5'"},{atomname:"O5*"},{atomname:"HO5'"},{atomname:"C5'"},{atomname:"C5*"},{atomname:"H5'"},{atomname:"H5''"}]}]}]});continue}if(f==="APOLARH"){y({operator:"AND",negate:!1,rules:[{element:"H"},{negate:!0,operator:void 0,rules:[{keyword:zt.POLARH}]}]});continue}if(f==="LIGAND"){y({operator:"AND",rules:[{operator:"OR",rules:[{operator:"AND",rules:[{keyword:zt.HETERO},{negate:!0,operator:void 0,rules:[{keyword:zt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{keyword:zt.POLYMER}]}]},{negate:!0,operator:void 0,rules:[{operator:"OR",rules:[{keyword:zt.WATER},{keyword:zt.ION}]}]}]});continue}if(Ut.indexOf(f)!==-1){y({keyword:zt.ALL});continue}if(h.charAt(0)==="@"){const M=h.substr(1).split(",").map((T=>parseInt(T)));M.sort((function(T,R){return T-R})),y({atomindex:M});continue}if(h.charAt(0)==="#"){console.error("# for element selection deprecated, use _"),y({element:f.substr(1)});continue}if(h.charAt(0)==="_"){y({element:f.substr(1)});continue}if(h[0]==="["&&h[h.length-1]==="]"){const M=f.substr(1,h.length-2).split(","),T=M.length>1?M:M[0];y({resname:T});continue}if(h.length>=1&&h.length<=4&&h[0]!=="^"&&h[0]!==":"&&h[0]!=="."&&h[0]!=="%"&&h[0]!=="/"&&isNaN(parseInt(h))){y({resname:f});continue}const E={operator:"AND",rules:[]},m=h.split("/");if(m.length>1&&m[1]){if(isNaN(parseInt(m[1])))throw new Error("model must be an integer");E.rules.push({model:parseInt(m[1])})}const S=m[0].split("%");S.length>1&&E.rules.push({altloc:S[1]});const w=S[0].split(".");if(w.length>1&&w[1]){if(w[1].length>4)throw new Error("atomname must be one to four characters");E.rules.push({atomname:w[1].substring(0,4).toUpperCase()})}const v=w[0].split(":");v.length>1&&v[1]&&E.rules.push({chainname:v[1]});const A=v[0].split("^");if(A.length>1&&E.rules.push({inscode:A[1]}),A[0]){let M,T;A[0][0]==="-"&&(A[0]=A[0].substr(1),M=!0),A[0].includes("--")&&(A[0]=A[0].replace("--","-"),T=!0);let R=A[0].split("-");if(R.length===1){let P=parseInt(R[0]);if(isNaN(P))throw new Error("resi must be an integer");M&&(P*=-1),E.rules.push({resno:P})}else{if(R.length!==2)throw new Error("resi range must contain one '-'");{const P=R.map((L=>parseInt(L)));M&&(P[0]*=-1),T&&(P[1]*=-1),E.rules.push({resno:[P[0],P[1]]})}}}if(E.rules.length===1)y(E.rules[0]);else{if(!(E.rules.length>1))throw new Error("empty selection chunk");y(E)}}return s.operator===void 0&&s.rules.length===1&&s.rules[0].hasOwnProperty("operator")&&(s=s.rules[0]),s})(e)}catch(i){this.selection={error:i.message}}const n=this.selection;this.string=e,this.test=le(n),this.residueTest=he(n),this.chainTest=ue(n),this.modelTest=de(n),this.atomOnlyTest=le(n,!0),this.residueOnlyTest=he(n,!0),this.chainOnlyTest=ue(n,!0),this.modelOnlyTest=de(n,!0),t||this.signals.stringChanged.dispatch(this.string)}isAllSelection(){return Ut.includes(this.string.toUpperCase())}isNoneSelection(){return Vt.includes(this.string.toUpperCase())}}class fe extends Nt{constructor(e){super(e),this.colormakerList=[],this.selectionList=[],(e.dataList||[]).forEach((t=>{const[n,i,s={}]=t;Oe.hasScheme(n)?Object.assign(s,{scheme:n,structure:this.parameters.structure}):Object.assign(s,{scheme:"uniform",value:new Color(n).getHex()}),this.colormakerList.push(Oe.getScheme(s)),this.selectionList.push(new me(i))}))}atomColor(e){for(let t=0,n=this.selectionList.length;t<n;++t){const i=this.selectionList[t].test;if(i&&i(e))return this.colormakerList[t].atomColor(e)}return 16777215}}const pe={"":"",OrRd:"[S] Orange-Red",PuBu:"[S] Purple-Blue",BuPu:"[S] Blue-Purple",Oranges:"[S] Oranges",BuGn:"[S] Blue-Green",YlOrBr:"[S] Yellow-Orange-Brown",YlGn:"[S] Yellow-Green",Reds:"[S] Reds",RdPu:"[S] Red-Purple",Greens:"[S] Greens",YlGnBu:"[S] Yellow-Green-Blue",Purples:"[S] Purples",GnBu:"[S] Green-Blue",Greys:"[S] Greys",YlOrRd:"[S] Yellow-Orange-Red",PuRd:"[S] Purple-Red",Blues:"[S] Blues",PuBuGn:"[S] Purple-Blue-Green",Viridis:"[D] Viridis",Spectral:"[D] Spectral",RdYlGn:"[D] Red-Yellow-Green",RdBu:"[D] Red-Blue",PiYG:"[D] Pink-Yellowgreen",PRGn:"[D] Purplered-Green",RdYlBu:"[D] Red-Yellow-Blue",BrBG:"[D] Brown-Bluegreen",RdGy:"[D] Red-Grey",PuOr:"[D] Purple-Orange",Set1:"[Q] Set1",Set2:"[Q] Set2",Set3:"[Q] Set3",Dark2:"[Q] Dark2",Paired:"[Q] Paired",Pastel1:"[Q] Pastel1",Pastel2:"[Q] Pastel2",Accent:"[Q] Accent",rainbow:"[?] Rainbow",rwb:"[?] Red-White-Blue"},ge={"":"",rgb:"Red Green Blue",hsv:"Hue Saturation Value",hsl:"Hue Saturation Lightness",hsi:"Hue Saturation Intensity",lab:"CIE L*a*b*",hcl:"Hue Chroma Lightness"};function ye(r){const e=r;return r.forEach((function(t){t.__deps&&Array.prototype.push.apply(e,ye(t.__deps))})),e}function be(r){return pt(ye(r)).map((function(e){return e.toString()})).join(`


`)}function _e(r){const e=r.data.__name,t=r.data.__postId;if(e===void 0)console.error("message __name undefined");else if(self.func===void 0)console.error("worker func undefined",e);else{const n=function(i,s){i=i||{},t!==void 0&&(i.__postId=t);try{self.postMessage(i,s)}catch(o){console.error("self.postMessage:",o),self.postMessage(i)}};self.func(r,n)}}function xe(r,e){let t=`'use strict';

`+be(e);return t+=`


self.func = `+r.toString()+";",t+=`


self.onmessage = `+_e.toString()+";",new Blob([t],{type:"application/javascript"})}const ve=ct();let we=!1;try{const r=Object.defineProperty({},"passive",{get:function(){we=!0}});window.addEventListener("test",(e=>{}),r)}catch{}const Ae=typeof window<"u"&&window.orientation!==void 0;let Se=!1;function Ce(r){Se=r}let Pe=!1;function Ie(r){Pe=r}const ke={log:Function.prototype.bind.call(console.log,console),info:Function.prototype.bind.call(console.info,console),warn:Function.prototype.bind.call(console.warn,console),error:Function.prototype.bind.call(console.error,console),time:Function.prototype.bind.call(console.time,console),timeEnd:Function.prototype.bind.call(console.timeEnd,console)};let Me={color:"green",labelColor:8421504,labelAttachment:"bottom-center",labelSize:.7,labelZOffset:.5,labelYOffset:.1,labelBorder:!0,labelBorderColor:13882323,labelBorderWidth:.25,lineOpacity:.8,linewidth:5,opacity:.6,labelUnit:"angstrom",arcVisible:!0,planeVisible:!1},De=!!(Be=rt("debug"))&&(typeof Be!="string"||/^1|true|t|yes|y$/i.test(Be));var Be;const Ee=["ngl","js"],$e=new class{constructor(){this.activeWorkerCount=0,this._funcDict={},this._depsDict={},this._blobDict={}}add(r,e,t){this._funcDict[r]=e,this._depsDict[r]=t}get(r){return this._blobDict[r]||(this._blobDict[r]=xe(this._funcDict[r],this._depsDict[r])),this._blobDict[r]}},Oe=new class{constructor(){this.schemes={},this.userSchemes={}}getScheme(r){const e=((r||{}).scheme||"").toLowerCase();let t;return t=e in this.schemes?this.schemes[e]:e in this.userSchemes?this.userSchemes[e]:Nt,new t(r)}getSchemes(){const r={};return Object.keys(this.schemes).forEach((function(e){r[e]=e})),Object.keys(this.userSchemes).forEach((function(e){r[e]=e.split("|")[1]})),r}getScales(){return pe}getModes(){return ge}add(r,e){r=r.toLowerCase(),this.schemes[r]=e}addScheme(r,e){return(function(t){return t instanceof Nt})(r)||(r=this._createScheme(r)),this._addUserScheme(r,e)}_addUserScheme(r,e){e=e||"";const t=`${Tt()}|${e}`.toLowerCase();return this.userSchemes[t]=r,t}removeScheme(r){r=r.toLowerCase(),delete this.userSchemes[r]}_createScheme(r){return class extends Nt{constructor(e){super(e),r.call(this,e)}}}addSelectionScheme(r,e){return this._addUserScheme(class extends fe{constructor(t){super(Object.assign({dataList:r},t))}},e)}hasScheme(r){return(r=r.toLowerCase())in this.schemes||r in this.userSchemes}},Re=new Pt("datasource"),Le=new Pt("representatation"),Ne=new class extends Pt{constructor(){super("parser")}__hasObjName(r,e){const t=this.get(r);return t&&t.prototype.__objName===e}isTrajectory(r){return this.__hasObjName(r,"frames")}isStructure(r){return this.__hasObjName(r,"structure")}isVolume(r){return this.__hasObjName(r,"volume")}isSurface(r){return this.__hasObjName(r,"surface")}isBinary(r){const e=this.get(r);return e&&e.prototype.isBinary}isXml(r){const e=this.get(r);return e&&e.prototype.isXml}isJson(r){const e=this.get(r);return e&&e.prototype.isJson}getTrajectoryExtensions(){return this.names.filter((r=>this.isTrajectory(r)))}getStructureExtensions(){return this.names.filter((r=>this.isStructure(r)))}getVolumeExtensions(){return this.names.filter((r=>this.isVolume(r)))}getSurfaceExtensions(){return this.names.filter((r=>this.isSurface(r)))}},ze=new Pt("shader"),Ue=new Pt("decompressor"),Ve=new Pt("component"),je=new Pt("buffer"),Ge=new Pt("picker");let qe;class Ye{constructor(e,t={}){this.chunkSize=10485760,this.newline=`
`,this.__pointer=0,this.__partialLine="",this.compressed=nt(t.compressed,!1),this.binary=nt(t.binary,!1),this.json=nt(t.json,!1),this.xml=nt(t.xml,!1),this.src=e}isBinary(){return this.binary||this.compressed}read(){return this._read().then((e=>{const t=this.compressed?Ue.get(this.compressed):void 0;return this.compressed&&t?this.data=t(e):((this.binary||this.compressed)&&e instanceof ArrayBuffer&&(e=new Uint8Array(e)),this.data=e),this.data}))}_chunk(e,t){return t=Math.min(this.data.length,t),e===0&&this.data.length===t?this.data:this.isBinary()?this.data.subarray(e,t):this.data.substring(e,t)}chunk(e){const t=e+this.chunkSize;return this._chunk(e,t)}peekLines(e){const t=this.data,n=t.length,i=this.isBinary()?this.newline.charCodeAt(0):this.newline;let s,o=0;for(s=0;s<n&&(t[s]===i&&++o,o!==e);++s);const a=this._chunk(0,s+1);return this.chunkToLines(a,"",s>n).lines}chunkCount(){return Math.floor(this.data.length/this.chunkSize)+1}asText(){return this.isBinary()?gt(this.data):this.data}chunkToLines(e,t,n){const i=this.newline;if(!this.isBinary()&&e.length===this.data.length)return{lines:e.split(i),partialLine:""};let s=[];const o=this.isBinary()?gt(e):e,a=o.lastIndexOf(i);if(a===-1)t+=o;else{const l=t+o.substr(0,a);s=s.concat(l.split(i)),t=a===o.length-i.length?"":o.substr(a+i.length)}return n&&t!==""&&s.push(t),{lines:s,partialLine:t}}nextChunk(){const e=this.__pointer;if(!(e>this.data.length))return this.__pointer+=this.chunkSize,this.chunk(e)}nextChunkOfLines(){const e=this.nextChunk();if(e===void 0)return;const t=this.__pointer>this.data.length,n=this.chunkToLines(e,this.__partialLine,t);return this.__partialLine=n.partialLine,n.lines}eachChunk(e){const t=this.chunkSize,n=this.data.length,i=this.chunkCount();for(let s=0;s<n;s+=t)e(this.chunk(s),Math.round(s/t),i)}eachChunkOfLines(e){this.eachChunk(((t,n,i)=>{const s=n===i+1,o=this.chunkToLines(t,this.__partialLine,s);this.__partialLine=o.partialLine,e(o.lines,n,i)}))}dispose(){delete this.src}}class Ke extends Ye{_read(){return new Promise(((e,t)=>{const n=this.src,i=new FileReader;i.onload=s=>{s.target&&e(s.target.result)},i.onerror=s=>t(s),this.binary||this.compressed?i.readAsArrayBuffer(n):i.readAsText(n)}))}}class Ze extends Ye{_read(){return new Promise(((e,t)=>{const n=this.src,i=new XMLHttpRequest;i.open("GET",n,!0),i.addEventListener("load",(()=>{if(i.status===200||i.status===304||i.status===0)try{e(i.response)}catch(s){t(s)}else t(i.statusText)}),!1),i.addEventListener("error",(s=>t("network error")),!1),this.isBinary()?i.responseType="arraybuffer":this.json?i.responseType="json":this.xml?i.responseType="document":i.responseType="text",i.send()}))}}class Qe{constructor(e,t={}){this.parameters=st(t,{ext:"",compressed:!1,binary:Ne.isBinary(t.ext||""),name:"",dir:"",path:"",protocol:""});const n={compressed:this.parameters.compressed,binary:this.parameters.binary,json:Ne.isJson(this.parameters.ext),xml:Ne.isXml(this.parameters.ext)};typeof File<"u"&&e instanceof File||typeof Blob<"u"&&e instanceof Blob?this.streamer=new Ke(e,n):this.streamer=new Ze(e,n)}}class Je extends Qe{constructor(e,t={}){super(e,t),this.parserParams={voxelSize:t.voxelSize,firstModelOnly:t.firstModelOnly,asTrajectory:t.asTrajectory,cAlphaOnly:t.cAlphaOnly,delimiter:t.delimiter,comment:t.comment,columnNames:t.columnNames,inferBonds:t.inferBonds,name:this.parameters.name,path:this.parameters.path}}load(){return new(Ne.get(this.parameters.ext))(this.streamer,this.parserParams).parse()}}class ti{constructor(e,t,n){this.name=t,this.path=n,this.signals={elementAdded:new signalsExports.Signal,elementRemoved:new signalsExports.Signal,nameChanged:new signalsExports.Signal},this.type="Script",this.dir=n.substring(0,n.lastIndexOf("/")+1);try{this.fn=new Function("stage","__name","__path","__dir",e)}catch(i){ke.error("Script compilation failed",i),this.fn=function(){}}}run(e){return new Promise(((t,n)=>{try{this.fn.apply(null,[e,this.name,this.path,this.dir]),t()}catch(i){ke.error("Script.fn",i),n(i)}}))}}class ei extends Qe{load(){return this.streamer.read().then((()=>new ti(this.streamer.asText(),this.parameters.name,this.parameters.path)))}}function ii(r){const e=Ue.names;let t,n,i="";t=r instanceof File?r.name:r instanceof Blob?"":r;const s=t.lastIndexOf("?"),o=s!==-1?t.substring(s):"";t=t.substring(0,s===-1?t.length:s);const a=t.replace(/^.*[\\/]/,"");let l=a.substring(0,a.lastIndexOf("."));const d=a.split(".");let u=d.length>1?(d.pop()||"").toLowerCase():"";const g=t.match(/^(.+):\/\/(.+)$/);g&&(i=g[1].toLowerCase(),t=g[2]||"");const x=t.substring(0,t.lastIndexOf("/")+1);if(e.includes(u)){n=u;const y=t.length-u.length-1;u=(t.substr(0,y).split(".").pop()||"").toLowerCase();const b=l.length-u.length-1;l=l.substr(0,b)}else n=!1;return{path:t,name:a,ext:u,base:l,dir:x,compressed:n,protocol:i,query:o,src:r}}function ri(r){let e=ii(r);const t=Re.get(e.protocol);return t&&(e=ii(t.getUrl(e.src)),!e.ext&&t.getExt&&(e.ext=t.getExt(r))),e}function ni(r,e={}){const t=Object.assign(ri(r),e);let n;return Ne.names.includes(t.ext)?n=new Je(t.src,t):Ee.includes(t.ext)&&(n=new ei(t.src,t)),n?n.load():Promise.reject(new Error(`autoLoad: ext '${t.ext}' unknown`))}const ci=[];class li{constructor(e,t={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let n=!1;e===void 0&&(e=8192),typeof e=="number"?e=new ArrayBuffer(e):n=!0;const i=t.offset?t.offset>>>0:0;let s=e.byteLength-i,o=i;e instanceof ArrayBuffer||(e.byteLength!==e.buffer.byteLength&&(o=e.byteOffset+i),e=e.buffer),this._lastWrittenByte=n?s:0,this.buffer=e,this.length=s,this.byteLength=s,this.byteOffset=o,this._data=new DataView(this.buffer,o,s)}available(e){return e===void 0&&(e=1),this.offset+e<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(e){return e===void 0&&(e=1),this.offset+=e,this}seek(e){return this.offset=e,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this}rewind(){return this.offset=0,this}ensureAvailable(e){if(e===void 0&&(e=1),!this.available(e)){const t=2*(this.offset+e),n=new Uint8Array(t);n.set(new Uint8Array(this.buffer)),this.buffer=n.buffer,this.length=this.byteLength=t,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(e){e===void 0&&(e=1);for(var t=new Uint8Array(e),n=0;n<e;n++)t[n]=this.readByte();return t}readInt16(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}readUint16(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e}readInt32(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}readUint32(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat32(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}readFloat64(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}readChar(){return String.fromCharCode(this.readInt8())}readChars(e=1){ci.length=e;for(var t=0;t<e;t++)ci[t]=this.readChar();return ci.join("")}writeBoolean(e=!1){return this.writeUint8(e?255:0),this}writeInt8(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this}writeUint8(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this}writeByte(e){return this.writeUint8(e)}writeBytes(e){this.ensureAvailable(e.length);for(var t=0;t<e.length;t++)this._data.setUint8(this.offset++,e[t]);return this._updateLastWrittenByte(),this}writeInt16(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(e){return this.writeUint8(e.charCodeAt(0))}writeChars(e){for(var t=0;t<e.length;t++)this.writeUint8(e.charCodeAt(t));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}class ui{constructor(){this.count=0,this.signals={countChanged:new signalsExports.Signal}}clear(){this.change(-this.count)}change(e){this.count+=e,this.signals.countChanged.dispatch(e,this.count),this.count<0&&ke.warn("Counter.count below zero",this.count)}increment(){this.change(1)}decrement(){this.change(-1)}listen(e){this.change(e.count),e.signals.countChanged.add(this.change,this)}unlisten(e){const t=e.signals.countChanged;t.has(this.change,this)&&t.remove(this.change,this)}onZeroOnce(e,t){if(this.count===0)e.call(t);else{const n=()=>{this.count===0&&(this.signals.countChanged.remove(n,this),e.call(t))};this.signals.countChanged.add(n,this)}}dispose(){this.clear(),this.signals.countChanged.dispose()}}ze.add("shader/BasicLine.vert",`void main(){
#include begin_vertex
#include project_vertex
}`),ze.add("shader/BasicLine.frag",`uniform vec3 uColor;
#include common
#include fog_pars_fragment
void main(){
gl_FragColor = vec4( uColor, 1.0 );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`),ze.add("shader/Quad.vert",`varying vec2 vUv;
void main() {
vUv = uv;
gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`),ze.add("shader/Quad.frag",`varying vec2 vUv;
uniform sampler2D tForeground;
uniform float scale;
void main() {
vec4 foreground = texture2D( tForeground, vUv );
gl_FragColor = foreground * scale;
}`);class di{constructor(){this.signals={updated:new signalsExports.Signal},this.maxDuration=-1/0,this.minDuration=1/0,this.avgDuration=14,this.lastDuration=1/0,this.prevFpsTime=0,this.lastFps=1/0,this.lastFrames=1,this.frames=0,this.count=0,this.begin()}update(){this.startTime=this.end(),this.currentTime=this.startTime,this.signals.updated.dispatch()}begin(){this.startTime=window.performance.now(),this.lastFrames=this.frames}end(){const e=window.performance.now();return this.count+=1,this.frames+=1,this.lastDuration=e-this.startTime,this.minDuration=Math.min(this.minDuration,this.lastDuration),this.maxDuration=Math.max(this.maxDuration,this.lastDuration),this.avgDuration-=this.avgDuration/30,this.avgDuration+=this.lastDuration/30,e>this.prevFpsTime+1e3&&(this.lastFps=this.frames,this.prevFpsTime=e,this.frames=0),e}}ze.add("shader/chunk/fog_fragment.glsl",`#ifdef USE_FOG
float depth = length( vViewPosition );
#ifdef FOG_EXP2
float fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );
#else
float fogFactor = smoothstep( fogNear, fogFar, depth );
#endif
gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`),ze.add("shader/chunk/interior_fragment.glsl",`if( gl_FrontFacing == false ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}`),ze.add("shader/chunk/matrix_scale.glsl",`float matrixScale( in mat4 m ){
vec4 r = m[ 0 ];
return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );
}`),ze.add("shader/chunk/nearclip_vertex.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear - 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),ze.add("shader/chunk/nearclip_fragment.glsl",`#ifdef NEAR_CLIP
if( vViewPosition.z < clipNear )
discard;
#endif`),ze.add("shader/chunk/opaque_back_fragment.glsl",`#ifdef OPAQUE_BACK
#ifdef FLIP_SIDED
if( gl_FrontFacing == true ){
gl_FragColor.a = 1.0;
}
#else
if( gl_FrontFacing == false ){
gl_FragColor.a = 1.0;
}
#endif
#endif`),ze.add("shader/chunk/radiusclip_vertex.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius + 5.0 )
gl_Position.z = 2.0 * gl_Position.w;
#endif`),ze.add("shader/chunk/radiusclip_fragment.glsl",`#ifdef RADIUS_CLIP
if( distance( vViewPosition, vClipCenter ) > clipRadius )
discard;
#endif`),ze.add("shader/chunk/unpack_color.glsl",`vec3 unpackColor(float f) {
vec3 color;
color.r = floor(f / 256.0 / 256.0);
color.g = floor((f - color.r * 256.0 * 256.0) / 256.0);
color.b = floor(f - color.r * 256.0 * 256.0 - color.g * 256.0);
return color / 255.0;
}`);const mi=/^(?!\/\/)\s*#include\s+(\S+)/gim,fi={};function pi(r,e={}){let t=r+"|";for(const n in e)t+=n+":"+e[n];if(!fi[t]){const n=(function(s){if(s===void 0)return"";const o=[];for(const a in s){const l=s[a];l&&o.push(`#define ${a} ${l}`)}return o.join(`
`)+`
`})(e);let i=ze.get(`shader/${r}`);if(!i)throw new Error(`empty shader, '${r}'`);i=i.replace(mi,(function(s,o){const a=`shader/chunk/${o}.glsl`,l=ze.get(a)||ShaderChunk[o];if(!l)throw new Error(`empty chunk, '${o}'`);return l})),fi[t]=n+i}return fi[t]}if(typeof WebGLRenderingContext<"u"){const r=WebGLRenderingContext.prototype,e=r.getShaderParameter;r.getShaderParameter=function(){return!De||e.apply(this,arguments)};const t=r.getShaderInfoLog;r.getShaderInfoLog=function(){return De?t.apply(this,arguments):""};const n=r.getProgramParameter;r.getProgramParameter=function(s,o){return!De&&o===r.LINK_STATUS||n.apply(this,arguments)};const i=r.getProgramInfoLog;r.getProgramInfoLog=function(){return De?i.apply(this,arguments):""}}const gi=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];gi.forEach((r=>{r.forEach((e=>{e[0]*=.0625,e[1]*=.0625}))}));class yi{constructor(e,t,n,i){this.canvas=document.createElement("canvas"),this._viewer=n,this._factor=nt(i.factor,2),this._antialias=nt(i.antialias,!1),this._onProgress=i.onProgress,this._onFinish=i.onFinish,this._antialias&&(this._factor*=2),this._n=this._factor*this._factor,this._width=this._viewer.width,this._height=this._viewer.height,this._antialias?(this.canvas.width=this._width*this._factor/2,this.canvas.height=this._height*this._factor/2):(this.canvas.width=this._width*this._factor,this.canvas.height=this._height*this._factor),this._ctx=this.canvas.getContext("2d"),this._viewerSampleLevel=n.sampleLevel,this._viewer.setSampling(-1)}_renderTile(e){const t=this._viewer,n=this._width,i=this._height,s=this._factor,o=e%s*n,a=Math.floor(e/s)*i;if(t.camera.setViewOffset(n*s,i*s,o,a,n,i),t.render(),this._antialias){const l=Math.round((o+n)/2)-Math.round(o/2),d=Math.round((a+i)/2)-Math.round(a/2);this._ctx.drawImage(t.renderer.domElement,Math.round(o/2),Math.round(a/2),l,d)}else this._ctx.drawImage(t.renderer.domElement,Math.floor(o),Math.floor(a),Math.ceil(n),Math.ceil(i));typeof this._onProgress=="function"&&this._onProgress(e+1,this._n,!1)}_finalize(){this._viewer.setSampling(this._viewerSampleLevel),this._viewer.camera.view=null,typeof this._onFinish=="function"&&this._onFinish(this._n+1,this._n,!1)}render(){for(let e=0;e<=this._n;++e)e===this._n?this._finalize():this._renderTile(e)}renderAsync(){let e=0;const t=this._n,n=()=>{e===t?this._finalize():this._renderTile(e),e+=1};for(let i=0;i<=t;++i)setTimeout(n,0)}}const bi=2*Math.PI,_i=180/Math.PI;function xi(r,e,t=1,n=0,i){const s=i?i.length:r.length/t;let o=0,a=0;if(i)for(let l=0;l<s;++l){const d=(r[i[l]*t+n]+e)%e/e*bi-Math.PI;o+=Math.cos(d),a+=Math.sin(d)}else for(let l=n;l<s;l+=t){const d=(r[l]+e)%e/e*bi-Math.PI;o+=Math.cos(d),a+=Math.sin(d)}return o/=s,a/=s,(Math.atan2(a,o)+Math.PI)/bi*e}function vi(r,e,t,n=0){const i=r.length,s=t||new Float32Array(i);for(let o=0;o<i;o+=3)s[n+o+0]=(r[o+0]+e[o+0])/2,s[n+o+1]=(r[o+1]+e[o+1])/2,s[n+o+2]=(r[o+2]+e[o+2])/2;return s}function wi(r,e){const t=r.length,n=new Float32Array(t);for(let i=0;i<t;i+=3)n[i+0]=e[i+0]-r[i+0],n[i+1]=e[i+1]-r[i+1],n[i+2]=e[i+2]-r[i+2];return n}function Ai(r,e,t){const n=t||new Float32Array(r);for(let i=0;i<r;++i)n[i]=e;return n}function Si(r,e,t,n,i){const s=i||new Float32Array(3*r);for(let o=0;o<r;++o){const a=3*o;s[a+0]=e,s[a+1]=t,s[a+2]=n}return s}function Ci(r){const e=new Float32Array(r);for(let t=0;t<r;++t)e[t]=t;return e}function Pi(r,e,t=0,n){const i=n||new Float32Array(r*e);for(let s=0;s<r;++s){const o=t+s*e;for(let a=0;a<e;++a)i[o+a]=s}return i}function Ii(r,e){const t=r.length,n=new Float32Array(t*e);for(let i=0;i<t;++i){const s=i*e,o=r[i];for(let a=0;a<e;++a)n[s+a]=o}return n}function ki(r,e,t,n,i){for(let s=0;s<i;++s)e[n+s]=r[t+s]}function Mi(r,e,t,n){ki(r,r,e,t,n)}function Ti(r){let e=-1/0;for(let t=0,n=r.length;t<n;++t)r[t]>e&&(e=r[t]);return e}function Di(r){let e=1/0;for(let t=0,n=r.length;t<n;++t)r[t]<e&&(e=r[t]);return e}function Bi(r,e=1,t=0){const n=r.length;let i=0;for(let s=t;s<n;s+=e)i+=r[s];return i}function Fi(r,e=1,t=0){return Bi(r,e,t)/(r.length/e)}const Ei={trim:!1,factor:1,antialias:!1,transparent:!1,onProgress:void 0};function $i(r,e={}){const{trim:t,factor:n,antialias:i,transparent:s}=st(e,Ei),o=r.renderer,a=r.camera,l=o.getClearAlpha(),d=o.getClearColor(new Color);function u(y=!1){let b=n;i&&(b*=2),y&&(b=1/b),r.scene.traverse((function(_){const h=_.material;h&&h.linewidth&&(h.linewidth*=b),h&&h.uniforms&&h.uniforms.size&&h.uniforms.size.__seen===void 0&&(h.uniforms.size.value*=b,h.uniforms.size.__seen=!0),h&&h.uniforms&&h.uniforms.linewidth&&h.uniforms.linewidth.__seen===void 0&&(h.uniforms.linewidth.value*=b,h.uniforms.linewidth.__seen=!0)})),r.scene.traverse((function(_){const h=_.material;h&&h.uniforms&&h.uniforms.size&&delete h.uniforms.size.__seen,h&&h.uniforms&&h.uniforms.linewidth&&delete h.uniforms.linewidth.__seen}))}function g(y){if(t){const b=d;return(function(_,h,f,E,m){const S=_.height,w=_.width,v=_.getContext("2d").getImageData(0,0,w,S).data;let A,M,T,R;for(T=!1,M=0;M<S;M++){for(A=0;A<w;A++)if(R=4*(M*w+A),v[R]!==h||v[R+1]!==f||v[R+2]!==E||v[R+3]!==m){T=!0;break}if(T)break}const P=M;for(T=!1,A=0;A<w;A++){for(M=0;M<S;M++)if(R=4*(M*w+A),v[R]!==h||v[R+1]!==f||v[R+2]!==E||v[R+3]!==m){T=!0;break}if(T)break}const L=A;for(T=!1,M=S-1;M>=0;M--){for(A=w-1;A>=0;A--)if(R=4*(M*w+A),v[R]!==h||v[R+1]!==f||v[R+2]!==E||v[R+3]!==m){T=!0;break}if(T)break}const O=M;for(T=!1,A=w-1;A>=0;A--){for(M=S-1;M>=0;M--)if(R=4*(M*w+A),v[R]!==h||v[R+1]!==f||v[R+2]!==E||v[R+3]!==m){T=!0;break}if(T)break}const I=A,N=document.createElement("canvas");return N.width=I-L,N.height=O-P,N.getContext("2d").drawImage(_,L,P,N.width,N.height,0,0,N.width,N.height),N})(y,s?0:255*b.r,s?0:255*b.g,s?0:255*b.b,s?0:255)}return y}function x(y,b,_){typeof e.onProgress=="function"&&e.onProgress(y,b,_)}return new Promise((function(y,b){const _=new yi(o,a,r,{factor:n,antialias:i,onProgress:x,onFinish:function(h,f){g(_.canvas).toBlob((function(E){o.setClearAlpha(l),u(!0),r.requestRender(),x(f,f,!0),E?y(E):b("error creating image")}),"image/png")}});o.setClearAlpha(s?0:1),u(),_.renderAsync()}))}const Oi=new Vector3,Ri=new Matrix4,Li=new Matrix4,Ni=new Vector2,zi=new Matrix4,Ui=new Matrix4;function Vi(r,e){zi.copy(e.projectionMatrix).invert(),Ui.copy(e.projectionMatrix).transpose(),r.traverse((function(t){const n=t.material;if(!n)return;const i=n.uniforms;i&&(i.projectionMatrixInverse&&i.projectionMatrixInverse.value.copy(zi),i.projectionMatrixTranspose&&i.projectionMatrixTranspose.value.copy(Ui))}))}function ji(r,e,t){const n=r.createShader(t);return n?(r.shaderSource(n,e),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS)?n:(console.log(`error compiling shader ${n}: ${r.getShaderInfoLog(n)}`),r.deleteShader(n),null)):void console.log(`error creating WebGL shader ${t}`)}function Gi(r,e){const t=r.getExtension(e);return t||console.log(`extension '${e}' not available`),t}const Hi=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function qi(r){const e=document.createElement("canvas");e.width=16,e.height=16,e.style.width="16px",e.style.height="16px";const t=e.getContext("webgl")||e.getContext("experimental-webgl");if(!t)return console.log(`error creating webgl context for ${r}`),!1;if(!(t instanceof WebGLRenderingContext))return console.log("Got unexpected type for WebGL rendering context"),!1;Gi(t,"OES_texture_float"),Gi(t,"OES_texture_half_float"),Gi(t,"WEBGL_color_buffer_float");const n=ji(t,`
attribute vec4 a_position;

void main() {
  gl_Position = a_position;
}`,t.VERTEX_SHADER),i=ji(t,`
precision mediump float;
uniform vec4 u_color;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = texture2D(u_texture, vec2(0.5, 0.5)) * u_color;
}`,t.FRAGMENT_SHADER);if(!n||!i)return!1;const s=(function(b,_,h,f){const E=b.createProgram();return E?(_.forEach((m=>b.attachShader(E,m))),b.linkProgram(E),b.getProgramParameter(E,b.LINK_STATUS)?E:(console.log(`error linking program: ${b.getProgramInfoLog(E)}`),b.deleteProgram(E),null)):void console.log("error creating WebGL program")})(t,[n,i]);if(!s)return console.log("error creating WebGL program"),!1;t.useProgram(s);const o=t.getAttribLocation(s,"a_position"),a=t.getUniformLocation(s,"u_color");if(!a)return console.log("error getting 'u_color' uniform location"),!1;const l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,Hi,t.STATIC_DRAW),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0);const d=t.createTexture(),u=new Uint8Array([255,255,255,255]);t.bindTexture(t.TEXTURE_2D,d),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,u);const g=t.createTexture();t.bindTexture(t.TEXTURE_2D,g),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,r,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const x=t.createFramebuffer();if(t.bindFramebuffer(t.FRAMEBUFFER,x),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,g,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)return console.log(`error creating framebuffer for ${r}`),!1;t.bindTexture(t.TEXTURE_2D,d),t.uniform4fv(a,[0,10,20,1]),t.drawArrays(t.TRIANGLES,0,6),t.bindTexture(t.TEXTURE_2D,g),t.bindFramebuffer(t.FRAMEBUFFER,null),t.clearColor(1,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.uniform4fv(a,[0,.1,.05,1]),t.drawArrays(t.TRIANGLES,0,6);const y=new Uint8Array(4);if(t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,y),y[0]!==0||y[1]<248||y[2]<248||y[3]<254)return console.log(`not able to actually render to ${r} texture`),!1;if(r===t.FLOAT){t.bindFramebuffer(t.FRAMEBUFFER,x);const b=new Float32Array(4);t.readPixels(0,0,1,1,t.RGBA,t.FLOAT,b);const _=t.getError();if(_)return console.log(`error reading pixels as float: '${(function(h,f){switch(f){case h.NO_ERROR:return"no error";case h.INVALID_ENUM:return"invalid enum";case h.INVALID_VALUE:return"invalid value";case h.INVALID_OPERATION:return"invalid operation";case h.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case h.OUT_OF_MEMORY:return"out of memory";case h.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"})(t,_)}'`),!1}return!0}const Wi=new Float32Array(100),Xi=new Uint8Array(100),Yi=[12,7,13,17,11,6,8,18,16,2,14,22,10,1,3,9,19,23,21,15,5,0,4,24,20],Ki=new Matrix4;function Zi(r,e,t,n,i){const s=i.uniforms,o=[];if(s&&(s.objectId&&(s.objectId.value=Se?this.id:this.id/255,o.push("objectId")),(s.modelViewMatrixInverse||s.modelViewMatrixInverseTranspose||s.modelViewProjectionMatrix||s.modelViewProjectionMatrixInverse)&&this.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,this.matrixWorld),s.modelViewMatrixInverse&&(s.modelViewMatrixInverse.value.copy(this.modelViewMatrix).invert(),o.push("modelViewMatrixInverse")),s.modelViewMatrixInverseTranspose&&(s.modelViewMatrixInverse?s.modelViewMatrixInverseTranspose.value.copy(s.modelViewMatrixInverse.value).transpose():s.modelViewMatrixInverseTranspose.value.copy(this.modelViewMatrix).invert().transpose(),o.push("modelViewMatrixInverseTranspose")),s.modelViewProjectionMatrix&&(s.modelViewProjectionMatrix.value.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),o.push("modelViewProjectionMatrix")),s.modelViewProjectionMatrixInverse&&(s.modelViewProjectionMatrix?(Ki.copy(s.modelViewProjectionMatrix.value),s.modelViewProjectionMatrixInverse.value.copy(Ki.invert())):(Ki.multiplyMatrices(t.projectionMatrix,this.modelViewMatrix),s.modelViewProjectionMatrixInverse.value.copy(Ki.invert())),o.push("modelViewProjectionMatrixInverse")),o.length)){const a=r.properties.get(i);if(a.program){const l=r.getContext(),d=a.program;l.useProgram(d.program);const u=d.getUniforms();o.forEach((function(g){u.setValue(l,g,s[g].value)}))}}}class Qi{constructor(e){if(this.boundingBox=new Box3,this.boundingBoxSize=new Vector3,this.boundingBoxLength=0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this.distVector=new Vector3,this.signals={ticked:new signalsExports.Signal,rendered:new signalsExports.Signal},typeof e=="string"){const t=document.getElementById(e);this.container=t===null?document.createElement("div"):t}else e instanceof HTMLElement?this.container=e:this.container=document.createElement("div");if(this.container===document.body)this.width=window.innerWidth||1,this.height=window.innerHeight||1;else{const t=this.container.getBoundingClientRect();this.width=t.width||1,this.height=t.height||1,this.container.style.overflow="hidden"}this.wrapper=document.createElement("div"),this.wrapper.style.position="relative",this.container.appendChild(this.wrapper),this._initParams(),this._initStats(),this._initCamera(),this._initScene(),this._initRenderer()!==!1?(this._initHelper(),this.setBackground(),this.setFog(),this.animate=this.animate.bind(this)):ke.error("Viewer: could not initialize renderer")}_initParams(){this.parameters={fogColor:new Color(0),fogNear:50,fogFar:100,backgroundColor:new Color(0),cameraType:"perspective",cameraFov:40,cameraEyeSep:.3,cameraZ:-80,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",lightColor:new Color(14540253),lightIntensity:1.2,ambientColor:new Color(14540253),ambientIntensity:.3,sampleLevel:0,outputColorSpace:"srgb-linear"}}_initCamera(){const e=new Vector3(0,0,0),{width:t,height:n}=this;this.perspectiveCamera=new PerspectiveCamera(this.parameters.cameraFov,t/n),this.perspectiveCamera.position.z=this.parameters.cameraZ,this.perspectiveCamera.lookAt(e),this.orthographicCamera=new OrthographicCamera(t/-2,t/2,n/2,n/-2),this.orthographicCamera.position.z=this.parameters.cameraZ,this.orthographicCamera.lookAt(e),this.stereoCamera=new StereoCamera,this.stereoCamera.aspect=.5,this.stereoCamera.eyeSep=this.parameters.cameraEyeSep;const i=this.parameters.cameraType;if(i==="orthographic")this.camera=this.orthographicCamera;else{if(i!=="perspective"&&i!=="stereo")throw new Error(`Unknown cameraType '${i}'`);this.camera=this.perspectiveCamera}this.camera.updateProjectionMatrix()}_initStats(){this.stats=new di}_initScene(){this.scene||(this.scene=new Scene,this.scene.name="scene"),this.rotationGroup=new Group,this.rotationGroup.name="rotationGroup",this.scene.add(this.rotationGroup),this.translationGroup=new Group,this.translationGroup.name="translationGroup",this.rotationGroup.add(this.translationGroup),this.modelGroup=new Group,this.modelGroup.name="modelGroup",this.translationGroup.add(this.modelGroup),this.pickingGroup=new Group,this.pickingGroup.name="pickingGroup",this.translationGroup.add(this.pickingGroup),this.backgroundGroup=new Group,this.backgroundGroup.name="backgroundGroup",this.translationGroup.add(this.backgroundGroup),this.helperGroup=new Group,this.helperGroup.name="helperGroup",this.translationGroup.add(this.helperGroup),this.scene.fog=new Fog(this.parameters.fogColor.getHex()),this.directionalLight=new DirectionalLight(this.parameters.lightColor.getHex(),this.parameters.lightIntensity),this.scene.add(this.directionalLight),this.ambientLight=new AmbientLight(this.parameters.ambientColor.getHex(),this.parameters.ambientIntensity),this.scene.add(this.ambientLight)}_initRenderer(){const e=window.devicePixelRatio,{width:t,height:n}=this;try{this.renderer=new WebGLRenderer({preserveDrawingBuffer:!0,alpha:!0,antialias:!0})}catch{return this.wrapper.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;"><p style="padding:15px;text-align:center;">Your browser/graphics card does not seem to support <a target="_blank" href="https://en.wikipedia.org/wiki/WebGL">WebGL</a>.<br/><br/>Find out how to get it <a target="_blank" href="http://get.webgl.org/">here</a>.</p></div>',!1}this.renderer.setPixelRatio(e),this.renderer.setSize(t,n),this.renderer.autoClear=!1,this.renderer.sortObjects=!0,this.renderer.outputColorSpace=this.parameters.outputColorSpace,this.renderer.useLegacyLights=!0;const i=this.renderer.getContext();this.renderer.capabilities.isWebGL2?(Ie(!0),Ce(this.renderer.extensions.get("EXT_color_buffer_float")),this.supportsHalfFloat=!0):(Ie(this.renderer.extensions.get("EXT_frag_depth")),this.renderer.extensions.get("OES_element_index_uint"),Ce(this.renderer.extensions.get("OES_texture_float")&&this.renderer.extensions.get("WEBGL_color_buffer_float")||this.renderer.extensions.get("OES_texture_float")&&qi(i.FLOAT)),this.renderer.extensions.get("OES_texture_float"),this.supportsHalfFloat=this.renderer.extensions.get("OES_texture_half_float")&&qi(36193)),this.wrapper.appendChild(this.renderer.domElement);const s=t*e,o=n*e;De&&console.log(JSON.stringify({Browser:ve,OES_texture_float:!!this.renderer.extensions.get("OES_texture_float"),OES_texture_half_float:!!this.renderer.extensions.get("OES_texture_half_float"),WEBGL_color_buffer_float:!!this.renderer.extensions.get("WEBGL_color_buffer_float"),"testTextureSupport Float":qi(i.FLOAT),"testTextureSupport HalfFloat":qi(36193),"this.supportsHalfFloat":this.supportsHalfFloat,SupportsReadPixelsFloat:Se},null,2)),this.pickingTarget=new WebGLRenderTarget(s,o,{minFilter:NearestFilter,magFilter:NearestFilter,stencilBuffer:!1,format:RGBAFormat,type:Se?FloatType:UnsignedByteType}),this.pickingTarget.texture.generateMipmaps=!1,this.pickingTarget.texture.colorSpace=this.parameters.outputColorSpace,this.renderer.setRenderTarget(this.pickingTarget),this.renderer.clear(),this.renderer.setRenderTarget(null),this.sampleTarget=new WebGLRenderTarget(s,o,{minFilter:LinearFilter,magFilter:LinearFilter,format:RGBAFormat,type:this.supportsHalfFloat?HalfFloatType:Se?FloatType:UnsignedByteType}),this.sampleTarget.texture.colorSpace=this.parameters.outputColorSpace,this.holdTarget=new WebGLRenderTarget(s,o,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat,type:this.supportsHalfFloat?HalfFloatType:Se?FloatType:UnsignedByteType}),this.holdTarget.texture.colorSpace=this.parameters.outputColorSpace,this.compositeUniforms={tForeground:new Uniform(this.sampleTarget.texture),scale:new Uniform(1)},this.compositeMaterial=new ShaderMaterial({uniforms:this.compositeUniforms,vertexShader:pi("Quad.vert"),fragmentShader:pi("Quad.frag"),premultipliedAlpha:!0,transparent:!0,blending:AdditiveBlending,depthTest:!1,depthWrite:!1}),this.compositeCamera=new OrthographicCamera(-1,1,1,-1,0,1),this.compositeScene=new Scene,this.compositeScene.name="compositeScene",this.compositeScene.add(new Mesh(new PlaneGeometry(2,2),this.compositeMaterial))}_initHelper(){const e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),t=new Float32Array(24),n=new BufferGeometry;n.setIndex(new BufferAttribute(e,1)),n.setAttribute("position",new BufferAttribute(t,3));const i=new ShaderMaterial({uniforms:{uColor:{value:new Color("skyblue")}},vertexShader:pi("BasicLine.vert"),fragmentShader:pi("BasicLine.frag")});this.boundingBoxMesh=new LineSegments(n,i),this.helperGroup.add(this.boundingBoxMesh)}updateHelper(){const e=this.boundingBoxMesh.geometry.attributes.position,t=e.array,{min:n,max:i}=this.boundingBox;t[0]=i.x,t[1]=i.y,t[2]=i.z,t[3]=n.x,t[4]=i.y,t[5]=i.z,t[6]=n.x,t[7]=n.y,t[8]=i.z,t[9]=i.x,t[10]=n.y,t[11]=i.z,t[12]=i.x,t[13]=i.y,t[14]=n.z,t[15]=n.x,t[16]=i.y,t[17]=n.z,t[18]=n.x,t[19]=n.y,t[20]=n.z,t[21]=i.x,t[22]=n.y,t[23]=n.z,e.needsUpdate=!0,this.boundingBox.isEmpty()||this.boundingBoxMesh.geometry.computeBoundingSphere()}get cameraDistance(){return Math.abs(this.camera.position.z)}set cameraDistance(e){this.camera.position.z=-e}add(e,t){t?t.forEach((n=>this.addBuffer(e,n))):this.addBuffer(e),e.group.name="meshGroup",e.wireframeGroup.name="wireframeGroup",e.parameters.background?(this.backgroundGroup.add(e.group),this.backgroundGroup.add(e.wireframeGroup)):(this.modelGroup.add(e.group),this.modelGroup.add(e.wireframeGroup)),e.pickable&&this.pickingGroup.add(e.pickingGroup),De&&this.updateHelper()}addBuffer(e,t){function n(o){o instanceof Group?o.children.forEach(n):(o.userData.buffer=e,o.userData.instance=t,o.onBeforeRender=Zi)}const i=e.getMesh();t&&i.applyMatrix4(t.matrix),n(i),e.group.add(i);const s=e.getWireframeMesh();if(t&&(s.matrix.copy(i.matrix),s.position.copy(i.position),s.quaternion.copy(i.quaternion),s.scale.copy(i.scale)),n(s),e.wireframeGroup.add(s),e.pickable){const o=e.getPickingMesh();t&&(o.matrix.copy(i.matrix),o.position.copy(i.position),o.quaternion.copy(i.quaternion),o.scale.copy(i.scale)),n(o),e.pickingGroup.add(o)}t?this._updateBoundingBox(e.geometry,e.matrix,t.matrix):this._updateBoundingBox(e.geometry,e.matrix)}remove(e){this.translationGroup.children.forEach((function(t){t.remove(e.group),t.remove(e.wireframeGroup)})),e.pickable&&this.pickingGroup.remove(e.pickingGroup),this.updateBoundingBox(),De&&this.updateHelper()}_updateBoundingBox(e,t,n){const i=this.boundingBox;function s(a,l,d){a.boundingBox==null&&a.computeBoundingBox();const u=a.boundingBox.clone();l&&u.applyMatrix4(l),d&&u.applyMatrix4(d),u.min.equals(u.max)&&u.expandByScalar(5),i.union(u)}function o(a){if(a.geometry!==void 0){let l,d;a.userData.buffer&&(l=a.userData.buffer.matrix),a.userData.instance&&(d=a.userData.instance.matrix),s(a.geometry,l,d)}}e?s(e,t,n):(i.makeEmpty(),this.modelGroup.traverse(o),this.backgroundGroup.traverse(o)),i.getSize(this.boundingBoxSize),this.boundingBoxLength=this.boundingBoxSize.length()}updateBoundingBox(){this._updateBoundingBox(),De&&this.updateHelper()}getPickingPixels(){const{width:e,height:t}=this,n=e*t*4,i=Se?new Float32Array(n):new Uint8Array(n);return this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,0,0,e,t,i),i}getImage(e){return new Promise((t=>{if(e){const{width:n,height:i}=this,s=n*i*4;let o=this.getPickingPixels();if(Se){const u=new Uint8Array(s);for(let g=0;g<s;++g)u[g]=Math.round(255*o[g]);o=u}const a=document.createElement("canvas");a.width=n,a.height=i;const l=a.getContext("2d"),d=l.getImageData(0,0,n,i);d.data.set(o),l.putImageData(d,0,0),a.toBlob(t,"image/png")}else this.renderer.domElement.toBlob(t,"image/png")}))}makeImage(e={}){return $i(this,e)}setLight(e,t,n,i){const s=this.parameters;e!==void 0&&s.lightColor.set(e),t!==void 0&&(s.lightIntensity=t),n!==void 0&&s.ambientColor.set(n),i!==void 0&&(s.ambientIntensity=i),this.requestRender()}setFog(e,t,n){const i=this.parameters;e!==void 0&&i.fogColor.set(e),t!==void 0&&(i.fogNear=t),n!==void 0&&(i.fogFar=n),this.requestRender()}setBackground(e){const t=this.parameters;e&&t.backgroundColor.set(e),this.setFog(t.backgroundColor),this.renderer.setClearColor(t.backgroundColor,0),this.renderer.domElement.style.backgroundColor=t.backgroundColor.getStyle(),this.requestRender()}setSampling(e){e!==void 0&&(this.parameters.sampleLevel=e,this.sampleLevel=e),this.requestRender()}setOutputEncoding(e){this.parameters.outputColorSpace=e,this.renderer.outputColorSpace=e,this.pickingTarget.texture.colorSpace=e,this.sampleTarget.texture.colorSpace=e,this.holdTarget.texture.colorSpace=e}setColorWorkflow(e){if(e!="srgb-linear"&&e!="srgb")throw new Error(`setColorWorkflow: invalid color workflow ${e}`);$t=e=="srgb-linear"?"linear":"sRGB",this.setOutputEncoding(e=="srgb-linear"?"srgb":"srgb-linear"),this.requestRender()}setCamera(e,t,n){const i=this.parameters;if(e&&(i.cameraType=e),t&&(i.cameraFov=t),n&&(i.cameraEyeSep=n),i.cameraType==="orthographic")this.camera!==this.orthographicCamera&&(this.camera=this.orthographicCamera,this.camera.position.copy(this.perspectiveCamera.position),this.camera.up.copy(this.perspectiveCamera.up),this.updateZoom());else{if(i.cameraType!=="perspective"&&i.cameraType!=="stereo")throw new Error(`Unknown cameraType '${i.cameraType}'`);this.camera!==this.perspectiveCamera&&(this.camera=this.perspectiveCamera,this.camera.position.copy(this.orthographicCamera.position),this.camera.up.copy(this.orthographicCamera.up))}this.perspectiveCamera.fov=i.cameraFov,this.stereoCamera.eyeSep=i.cameraEyeSep,this.camera.updateProjectionMatrix(),this.requestRender()}setClip(e,t,n,i,s){const o=this.parameters;e!==void 0&&(o.clipNear=e),t!==void 0&&(o.clipFar=t),n!==void 0&&(o.clipDist=n),i!==void 0&&(o.clipMode=i),s!==void 0&&(o.clipScale=s),this.requestRender()}setSize(e,t){this.width=e||1,this.height=t||1,this.perspectiveCamera.aspect=this.width/this.height,this.orthographicCamera.left=-this.width/2,this.orthographicCamera.right=this.width/2,this.orthographicCamera.top=this.height/2,this.orthographicCamera.bottom=-this.height/2,this.camera.updateProjectionMatrix();const n=window.devicePixelRatio;this.renderer.setPixelRatio(n),this.renderer.setSize(e,t);const i=this.width*n,s=this.height*n;this.pickingTarget.setSize(i,s),this.sampleTarget.setSize(i,s),this.holdTarget.setSize(i,s),this.requestRender()}handleResize(){if(this.container===document.body)this.setSize(window.innerWidth,window.innerHeight);else{const e=this.container.getBoundingClientRect();this.setSize(e.width,e.height)}}updateInfo(e){const{memory:t,render:n}=this.info;if(e)t.programs=0,t.geometries=0,t.textures=0,n.calls=0,n.vertices=0,n.points=0;else{const i=this.renderer.info,s=i.memory,o=i.render;t.geometries=s.geometries,t.textures=s.textures,n.calls+=o.calls,n.faces+=o.triangles,n.points+=o.points}}animate(){if(this.signals.ticked.dispatch(this.stats),window.performance.now()-this.stats.startTime>500&&!this.isStill&&this.sampleLevel<3&&this.sampleLevel!==-1){const e=this.sampleLevel;this.sampleLevel=3,this.renderPending=!0,this.render(),this.isStill=!0,this.sampleLevel=e,De&&ke.log("rendered still frame")}this.frameRequest=window.requestAnimationFrame(this.animate)}pick(e,t){if(this.parameters.cameraType==="stereo")return{pid:0,instance:void 0,picker:void 0};e*=window.devicePixelRatio,t*=window.devicePixelRatio,e=Math.max(e-2,0),t=Math.max(t-2,0);let n,i,s=0;const o=Se?Wi:Xi;this.render(!0),this.renderer.readRenderTargetPixels(this.pickingTarget,e,t,5,5,o);for(let a=0;a<Yi.length;a++){const l=4*Yi[a],d=Math.round(o[l+3]),u=this.pickingGroup.getObjectById(d);u&&(n=u.userData.instance,i=u.userData.buffer.picking,s=Se?Math.round(255*o[l])<<16&16711680|Math.round(255*o[l+1])<<8&65280|255&Math.round(255*o[l+2]):o[l]<<16|o[l+1]<<8|o[l+2])}return{pid:s,instance:n,picker:i}}requestRender(){this.renderPending||(window.performance.now()-this.stats.startTime>22&&(this.stats.begin(),this.isStill=!1),this.renderPending=!0,window.requestAnimationFrame((()=>{this.render(),this.stats.update()})))}updateZoom(){const e=It(this.perspectiveCamera.fov),t=2*Math.tan(e/2)*this.cameraDistance;this.orthographicCamera.zoom=this.height/t}absoluteToRelative(e){return 50*(1-e/this.bRadius)}relativeToAbsolute(e){return this.bRadius*(1-e/50)}__updateClipping(){const e=this.parameters;this.bRadius=Math.max(10,.5*this.boundingBoxLength),isFinite(this.bRadius)||(this.bRadius=50),this.camera.getWorldPosition(this.distVector),this.cDist=this.distVector.length(),this.cDist||(this.cameraDistance=Math.abs(e.cameraZ),this.cDist=Math.abs(e.cameraZ));const t=this.scene.fog;if(t.color.set(e.fogColor),e.clipMode==="camera")this.camera.near=e.clipNear,this.camera.far=e.clipFar,t.near=e.fogNear,t.far=e.fogFar;else if(e.clipScale==="absolute")this.camera.near=this.cDist-e.clipNear,this.camera.far=this.cDist+e.clipFar,t.near=this.cDist-e.fogNear,t.far=this.cDist+e.fogFar;else{const n=(50-e.clipNear)/50,i=-(50-e.clipFar)/50;this.camera.near=this.cDist-this.bRadius*n,this.camera.far=this.cDist+this.bRadius*i;const s=(50-e.fogNear)/50,o=-(50-e.fogFar)/50;t.near=this.cDist-this.bRadius*s,t.far=this.cDist+this.bRadius*o}e.clipMode!=="camera"&&(this.camera.type==="PerspectiveCamera"?(this.camera.near=Math.max(.1,e.clipDist,this.camera.near),this.camera.far=Math.max(1,this.camera.far),t.near=Math.max(.1,t.near),t.far=Math.max(1,t.far)):this.camera.type==="OrthographicCamera"&&e.clipDist>0&&(this.camera.near=Math.max(e.clipDist,this.camera.near)))}__updateCamera(){const e=this.camera;e.updateMatrix(),e.updateMatrixWorld(!0),e.updateProjectionMatrix(),(function(t,n,i,s,o){let a=new Vector2;i.getSize(a);const l=a.height,d=i.getPixelRatio(),u=n.type==="OrthographicCamera";Ni.set(a.width,a.height),zi.copy(n.projectionMatrix).invert(),Ui.copy(n.projectionMatrix).transpose(),t.traverse((function(g){const x=g.material;if(!x)return;const y=x.uniforms;if(y){if(x.clipNear){const b=(50-x.clipNear)/50,_=s-o*b;y.clipNear.value=_}y.canvasHeight&&(y.canvasHeight.value=l),y.resolution&&y.resolution.value.copy(Ni),y.pixelRatio&&(y.pixelRatio.value=d),y.projectionMatrixInverse&&y.projectionMatrixInverse.value.copy(zi),y.projectionMatrixTranspose&&y.projectionMatrixTranspose.value.copy(Ui),y.ortho&&(y.ortho.value=u)}}))})(this.scene,e,this.renderer,this.cDist,this.bRadius),(function(t,n){t.traverseVisible((function(i){if(!(i instanceof Points&&i.userData.buffer.parameters.sortParticles))return;const s=i.geometry.attributes,o=s.position.count;if(o===0)return;let a,l,d,u,g,x,y,b;Ri.multiplyMatrices(n.matrixWorldInverse,i.matrixWorld),Li.multiplyMatrices(n.projectionMatrix,Ri),i.userData.sortData?(a=i.userData.sortData,d=a.__zArray,l=a.__sortArray,u=a.__cmpFn):(d=new Float32Array(o),l=new Uint32Array(o),u=function(_,h){const f=d[_],E=d[h];return f>E?1:f<E?-1:0},a={__zArray:d,__sortArray:l,__cmpFn:u},i.userData.sortData=a);for(let _=0;_<o;++_)Oi.fromArray(s.position.array,3*_),Oi.applyMatrix4(Li),d[_]=-Oi.z,l[_]=_;(function(_,h,f=0,E){h=h||function(P,L){return P>L?1:P<L?-1:0};const m=[];let S,w,v,A=-1,M=f,T=E=(E||_.length)-1;function R(P,L){const O=_[P];_[P]=_[L],_[L]=O}for(;;)if(T-M<=25){for(let P=M+1;P<=T;++P){for(S=_[P],w=P-1;w>=M&&h(_[w],S)>0;)_[w+1]=_[w],--w;_[w+1]=S}if(A===-1)break;T=m[A--],M=m[A--]}else{for(w=M+1,v=T,R(M+T>>1,w),h(_[M],_[T])>0&&R(M,T),h(_[w],_[T])>0&&R(w,T),h(_[M],_[w])>0&&R(M,w),S=_[w];;){do w++;while(h(_[w],S)<0);do v--;while(h(_[v],S)>0);if(v<w)break;R(w,v)}_[M+1]=_[v],_[v]=S,T-w+1>=v-M?(m[++A]=w,m[++A]=T,T=v-1):(m[++A]=M,m[++A]=v-1,M=w)}})(l,u);for(let _ in s){const h=s[_],f=h.array,E=h.itemSize;a[_]||(a[_]=new Float32Array(E*o)),b=a[_],a[_]=f;for(let m=0;m<o;++m){g=l[m];for(let S=0;S<E;++S)x=g*E+S,y=m*E+S,b[y]=f[x]}s[_].array=b,s[_].needsUpdate=!0}}))})(this.scene,e)}__setVisibility(e,t,n,i){this.modelGroup.visible=e,this.pickingGroup.visible=t,this.backgroundGroup.visible=n,this.helperGroup.visible=i}__updateLights(){this.directionalLight.color.set(this.parameters.lightColor),this.directionalLight.intensity=this.parameters.lightIntensity,this.distVector.copy(this.camera.position).setLength(100*this.boundingBoxLength),this.directionalLight.position.copy(this.camera.position).add(this.distVector),this.ambientLight.color.set(this.parameters.ambientColor),this.ambientLight.intensity=this.parameters.ambientIntensity}__renderPickingGroup(e){this.renderer.setRenderTarget(this.pickingTarget||null),this.renderer.clear(),this.__setVisibility(!1,!0,!1,!1),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderModelGroup(e,t){this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.__setVisibility(!1,!1,!0,!1),this.renderer.render(this.scene,e),this.renderer.clear(!1,!0,!0),this.updateInfo(),this.__setVisibility(!0,!1,!1,De),this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.updateInfo()}__renderSuperSample(e,t){const n=gi[Math.max(0,Math.min(this.sampleLevel,5))],i=1/n.length;this.compositeUniforms.tForeground.value=this.sampleTarget.texture;let s=this.sampleTarget.width;const o=this.sampleTarget.height;this.parameters.cameraType==="stereo"&&(s/=2);for(let a=0;a<n.length;++a){const l=n[a];e.setViewOffset(s,o,l[0],l[1],s,o),e.updateProjectionMatrix(),Vi(this.scene,e);let d=i;d+=.03125*((a+.5)/n.length-.5),this.compositeUniforms.scale.value=d,this.__renderModelGroup(e,this.sampleTarget),this.renderer.setRenderTarget(this.holdTarget),a===0&&this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}this.compositeUniforms.scale.value=1,this.compositeUniforms.tForeground.value=this.holdTarget.texture,e.clearViewOffset(),this.renderer.setRenderTarget(t||null),this.renderer.clear(),this.renderer.render(this.compositeScene,this.compositeCamera)}__renderStereo(e=!1,t){const n=this.stereoCamera;n.update(this.perspectiveCamera);const i=this.renderer;let s=new Vector2;i.getSize(s),i.setScissorTest(!0),i.setScissor(0,0,s.width/2,s.height),i.setViewport(0,0,s.width/2,s.height),Vi(this.scene,n.cameraL),this.__render(e,n.cameraL),i.setScissor(s.width/2,0,s.width/2,s.height),i.setViewport(s.width/2,0,s.width/2,s.height),Vi(this.scene,n.cameraR),this.__render(e,n.cameraR),i.setScissorTest(!1),i.setViewport(0,0,s.width,s.height)}__render(e=!1,t,n){e?this.lastRenderedPicking||this.__renderPickingGroup(t):this.sampleLevel>0&&this.parameters.cameraType!=="stereo"?this.__renderSuperSample(t,n):this.__renderModelGroup(t,n)}render(e=!1,t){if(this.rendering)ke.warn("'tried to call 'render' from within 'render'");else{this.rendering=!0;try{this.__updateClipping(),this.__updateCamera(),this.__updateLights(),this.updateInfo(!0),this.parameters.cameraType==="stereo"?this.__renderStereo(e,t):this.__render(e,this.camera,t),this.lastRenderedPicking=e}finally{this.rendering=!1,this.renderPending=!1}this.signals.rendered.dispatch()}}clear(){ke.log("scene cleared"),this.scene.remove(this.rotationGroup),this._initScene(),this.renderer.clear()}dispose(){this.renderer.dispose(),window.cancelAnimationFrame(this.frameRequest)}}function ir(r){const e=r.touches[0].pageX-r.touches[1].pageX,t=r.touches[0].pageY-r.touches[1].pageY;return Math.sqrt(e*e+t*t)}class rr{constructor(e,t={}){this.domElement=e,this.signals={moved:new signalsExports.Signal,scrolled:new signalsExports.Signal,dragged:new signalsExports.Signal,dropped:new signalsExports.Signal,clicked:new signalsExports.Signal,hovered:new signalsExports.Signal,doubleClicked:new signalsExports.Signal},this.position=new Vector2,this.prevPosition=new Vector2,this.down=new Vector2,this.canvasPosition=new Vector2,this.prevClickCP=new Vector2,this.moving=!1,this.hovering=!0,this.scrolled=!1,this.lastMoved=1/0,this.which=0,this.buttons=0,this.pressed=!1,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.domElement.style.touchAction="none",this.hoverTimeout=nt(t.hoverTimeout,50),this.handleScroll=nt(t.handleScroll,!0),this.doubleClickSpeed=nt(t.doubleClickSpeed,500),this._listen=this._listen.bind(this),this._onMousewheel=this._onMousewheel.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMousedown=this._onMousedown.bind(this),this._onMouseup=this._onMouseup.bind(this),this._onContextmenu=this._onContextmenu.bind(this),this._onTouchstart=this._onTouchstart.bind(this),this._onTouchend=this._onTouchend.bind(this),this._onTouchmove=this._onTouchmove.bind(this),this._listen();const n={passive:!1};document.addEventListener("mousewheel",this._onMousewheel,n),document.addEventListener("wheel",this._onMousewheel,n),document.addEventListener("MozMousePixelScroll",this._onMousewheel,n),document.addEventListener("mousemove",this._onMousemove,n),document.addEventListener("mousedown",this._onMousedown,n),document.addEventListener("mouseup",this._onMouseup,n),document.addEventListener("contextmenu",this._onContextmenu,n),document.addEventListener("touchstart",this._onTouchstart,n),document.addEventListener("touchend",this._onTouchend,n),document.addEventListener("touchmove",this._onTouchmove,n)}get key(){let e=0;return this.altKey&&(e+=1),this.ctrlKey&&(e+=2),this.metaKey&&(e+=4),this.shiftKey&&(e+=8),e}setParameters(e={}){this.hoverTimeout=nt(e.hoverTimeout,this.hoverTimeout)}_listen(){const e=window.performance.now(),t=this.canvasPosition;this.doubleClickPending&&e-this.lastClicked>this.doubleClickSpeed&&(this.doubleClickPending=!1),e-this.lastMoved>this.hoverTimeout&&(this.moving=!1),(this.scrolled||!this.moving&&!this.hovering)&&(this.scrolled=!1,this.hoverTimeout!==-1&&this.overElement&&(this.hovering=!0,this.signals.hovered.dispatch(t.x,t.y))),this.frameRequest=window.requestAnimationFrame(this._listen)}_onMousewheel(e){if(e.target!==this.domElement||!this.handleScroll)return;e.preventDefault(),this._setKeys(e);let t=0;"deltaY"in e&&"deltaMode"in e&&e.deltaY!==void 0&&e.deltaMode!==void 0?t=e.deltaMode===WheelEvent.DOM_DELTA_PIXEL?.025*-e.deltaY:e.deltaMode===WheelEvent.DOM_DELTA_LINE?-e.deltaY*(2.5/3):2.5*-e.deltaY:"deltaY"in e&&!("detail"in e)?t=.025*-e.deltaY:e.wheelDelta!==void 0?t=.025*-e.wheelDelta:e.wheelDeltaY!==void 0?t=.025*-e.wheelDeltaY:e.detail!==void 0&&(t=-e.detail/3),this.signals.scrolled.dispatch(t),setTimeout((()=>{this.scrolled=!0}),this.hoverTimeout)}_onMousemove(e){e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,this._setKeys(e),this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.clientX,e.clientY),this._setCanvasPosition(e);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n)}_onMousedown(e){e.target===this.domElement&&(e.preventDefault(),this._setKeys(e),this.moving=!1,this.hovering=!1,this.down.set(e.clientX,e.clientY),this.position.set(e.clientX,e.clientY),this.which=e.which,this.buttons=(function(t){if(typeof t=="object"){if("buttons"in t)return t.buttons;if("which"in t){const n=t.which;if(n===2)return 4;if(n===3)return 2;if(n>0)return 1<<n-1}else if("button"in t){const n=t.button;if(n===1)return 4;if(n===2)return 2;if(n>=0)return 1<<n}}return 0})(e),this.pressed=!0,this._setCanvasPosition(e))}_onMouseup(e){e.target===this.domElement&&e.preventDefault(),this._setKeys(e);const t=this.canvasPosition;this._distance()<4&&(this.lastClicked=window.performance.now(),this.doubleClickPending&&this.prevClickCP.distanceTo(t)<4&&(this.signals.doubleClicked.dispatch(t.x,t.y),this.doubleClickPending=!1),this.signals.clicked.dispatch(t.x,t.y),this.doubleClickPending=!0,this.prevClickCP.copy(t)),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onContextmenu(e){e.target===this.domElement&&e.preventDefault()}_onTouchstart(e){if(e.target===this.domElement)switch(e.preventDefault(),this.pressed=!0,e.touches.length){case 1:this.moving=!1,this.hovering=!1,this.down.set(e.touches[0].pageX,e.touches[0].pageY),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);break;case 2:this.down.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),this.lastTouchDistance=ir(e)}}_onTouchend(e){e.target===this.domElement&&e.preventDefault(),this.which=void 0,this.buttons=void 0,this.pressed=void 0}_onTouchmove(e){switch(e.target===this.domElement?(e.preventDefault(),this.overElement=!0):this.overElement=!1,e.touches.length){case 1:{this._setKeys(e),this.which=1,this.buttons=1,this.moving=!0,this.hovering=!1,this.lastMoved=window.performance.now(),this.prevPosition.copy(this.position),this.position.set(e.touches[0].pageX,e.touches[0].pageY),this._setCanvasPosition(e.touches[0]);const t=this.prevPosition.x-this.position.x,n=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(t,n),this.pressed&&this.signals.dragged.dispatch(t,n);break}case 2:{const t=ir(e),n=t-this.lastTouchDistance;if(this.lastTouchDistance=t,this.prevPosition.copy(this.position),this.position.set((e.touches[0].pageX+e.touches[1].pageX)/2,(e.touches[0].pageY+e.touches[1].pageY)/2),Math.abs(n)>2&&this.handleScroll&&this.position.distanceTo(this.prevPosition)<2)this.which=0,this.buttons=0,this.signals.scrolled.dispatch(n/2);else{this.which=3,this.buttons=2;const i=this.prevPosition.x-this.position.x,s=this.prevPosition.y-this.position.y;this.signals.moved.dispatch(i,s),this.pressed&&this.signals.dragged.dispatch(i,s)}}}}_distance(){return this.position.distanceTo(this.down)}_setCanvasPosition(e){const t=this.domElement.getBoundingClientRect();let n,i;"clientX"in e&&"clientY"in e?(n=e.clientX-t.left,i=e.clientY-t.top):(n=e.offsetX,i=e.offsetY),this.canvasPosition.set(n,t.height-i)}_setKeys(e){this.altKey=e.altKey,this.ctrlKey=e.ctrlKey,this.metaKey=e.metaKey,this.shiftKey=e.shiftKey}dispose(){document.removeEventListener("mousewheel",this._onMousewheel),document.removeEventListener("wheel",this._onMousewheel),document.removeEventListener("MozMousePixelScroll",this._onMousewheel),document.removeEventListener("mousemove",this._onMousemove),document.removeEventListener("mousedown",this._onMousedown),document.removeEventListener("mouseup",this._onMouseup),document.removeEventListener("contextmenu",this._onContextmenu),document.removeEventListener("touchstart",this._onTouchstart),document.removeEventListener("touchend",this._onTouchend),document.removeEventListener("touchmove",this._onTouchmove),window.cancelAnimationFrame(this.frameRequest)}}const nr=new Matrix4,sr=new Matrix4,or=new Matrix4,ar=new Matrix4,cr=new Matrix4,lr=new Vector3,hr=new Quaternion,ur=new Quaternion,dr=new Matrix4,mr=new Vector3,fr=new Vector3;class pr{constructor(e,t={}){this.stage=e,this.rotateSpeed=nt(t.rotateSpeed,2),this.zoomSpeed=nt(t.zoomSpeed,1.2),this.panSpeed=nt(t.panSpeed,1),this.viewer=e.viewer,this.mouse=e.mouseObserver,this.controls=e.viewerControls}get component(){return this.stage.transformComponent}get atom(){return this.stage.transformAtom}_setPanVector(e,t,n=0){const i=this.controls.getCanvasScaleFactor(n);mr.set(e,t,0),mr.multiplyScalar(this.panSpeed*i)}_getRotateXY(e,t){return[this.rotateSpeed*-e*.01,this.rotateSpeed*t*.01]}_getCameraRotation(e){return e.extractRotation(this.viewer.camera.matrixWorld),e.multiply(sr.makeRotationY(Math.PI)),e}_transformPanVector(){this.component&&(dr.extractRotation(this.component.transform),dr.premultiply(this.viewer.rotationGroup.matrix),dr.invert(),dr.multiply(this._getCameraRotation(ar)),mr.applyMatrix4(dr))}zoom(e){this.controls.zoom(this.zoomSpeed*e*.02)}pan(e,t){this._setPanVector(e,t),dr.copy(this.viewer.rotationGroup.matrix).invert(),dr.multiply(this._getCameraRotation(ar)),mr.applyMatrix4(dr),this.controls.translate(mr)}panComponent(e,t){this.component&&(this._setPanVector(e,t),this._transformPanVector(),this.component.position.add(mr),this.component.updateMatrix())}panAtom(e,t){this.atom&&this.component&&(this.atom.positionToVector3(fr),fr.add(this.viewer.translationGroup.position),fr.applyMatrix4(this.viewer.rotationGroup.matrix),this._setPanVector(e,t,fr.z),this._transformPanVector(),this.atom.positionAdd(mr),this.component.updateRepresentations({position:!0}))}rotate(e,t){const[n,i]=this._getRotateXY(e,t);this._getCameraRotation(ar),lr.set(1,0,0),lr.applyMatrix4(ar),hr.setFromAxisAngle(lr,i),lr.set(0,1,0),lr.applyMatrix4(ar),ur.setFromAxisAngle(lr,n),hr.multiply(ur),ar.makeRotationFromQuaternion(hr),this.controls.applyMatrix(ar)}zRotate(e,t){const n=this.rotateSpeed*((-e+t)/-2)*.01;or.makeRotationZ(n),this.controls.applyMatrix(or)}rotateComponent(e,t){if(!this.component)return;const[n,i]=this._getRotateXY(e,t);this._getCameraRotation(cr),ar.extractRotation(this.component.transform),ar.premultiply(this.viewer.rotationGroup.matrix),ar.invert(),ar.premultiply(cr),lr.set(1,0,0),lr.applyMatrix4(ar),nr.makeRotationAxis(lr,i),lr.set(0,1,0),lr.applyMatrix4(ar),sr.makeRotationAxis(lr,n),nr.multiply(sr),hr.setFromRotationMatrix(nr),this.component.quaternion.premultiply(hr),this.component.quaternion.normalize(),this.component.updateMatrix()}}const gr=new Vector3;class yr{constructor(e,t){this.stage=t,this.pid=e.pid,this.picker=e.picker,this.instance=e.instance,this.stage=t,this.controls=t.viewerControls,this.mouse=t.mouseObserver}get type(){return this.picker.type}get altKey(){return this.mouse.altKey}get ctrlKey(){return this.mouse.ctrlKey}get metaKey(){return this.mouse.metaKey}get shiftKey(){return this.mouse.shiftKey}get canvasPosition(){return this.mouse.canvasPosition}get component(){return this.stage.getComponentsByObject(this.picker.data).list[0]}get object(){return this.picker.getObject(this.pid)}get position(){return this.picker.getPosition(this.pid,this.instance,this.component)}get closestBondAtom(){if(this.type!=="bond"||!this.bond)return;const e=this.bond,t=this.controls,n=this.canvasPosition,i=e.atom1.positionToVector3(),s=e.atom2.positionToVector3();i.applyMatrix4(this.component.matrix),s.applyMatrix4(this.component.matrix);const o=t.getPositionOnCanvas(i),a=t.getPositionOnCanvas(s);return d=o,u=a,(l=n).distanceTo(d)<l.distanceTo(u)?e.atom1:e.atom2;var l,d,u}get closeAtom(){const e=this.canvasPosition,t=this.closestBondAtom;if(!t)return;const n=t.positionToVector3().applyMatrix4(this.component.matrix),i=this.controls.getPositionOnCanvas(n);t.positionToVector3(gr),this.instance&&gr.applyMatrix4(this.instance.matrix),gr.applyMatrix4(this.component.matrix);const s=this.controls.viewer;gr.add(s.translationGroup.position),gr.applyMatrix4(s.rotationGroup.matrix);const o=this.controls.getCanvasScaleFactor(gr.z),a=this.component.getMaxRepresentationRadius(t.index);return e.distanceTo(i)<=a/o?t:void 0}get arrow(){return this._objectIfType("arrow")}get atom(){return this._objectIfType("atom")}get axes(){return this._objectIfType("axes")}get bond(){return this._objectIfType("bond")}get box(){return this._objectIfType("box")}get cone(){return this._objectIfType("cone")}get clash(){return this._objectIfType("clash")}get contact(){return this._objectIfType("contact")}get cylinder(){return this._objectIfType("cylinder")}get distance(){return this._objectIfType("distance")}get ellipsoid(){return this._objectIfType("ellipsoid")}get octahedron(){return this._objectIfType("octahedron")}get point(){return this._objectIfType("point")}get mesh(){return this._objectIfType("mesh")}get slice(){return this._objectIfType("slice")}get sphere(){return this._objectIfType("sphere")}get tetrahedron(){return this._objectIfType("tetrahedron")}get torus(){return this._objectIfType("torus")}get surface(){return this._objectIfType("surface")}get unitcell(){return this._objectIfType("unitcell")}get unknown(){return this._objectIfType("unknown")}get volume(){return this._objectIfType("volume")}get wideline(){return this._objectIfType("wideline")}_objectIfType(e){return this.type===e?this.object:void 0}getLabel(){const e=this.atom||this.closeAtom;let t="nothing";return this.arrow?t=this.arrow.name:e?t=`atom: ${e.qualifiedName()} (${e.structure.name})`:this.axes?t="axes":this.bond?t=`bond: ${this.bond.atom1.qualifiedName()} - ${this.bond.atom2.qualifiedName()} (${this.bond.structure.name})`:this.box?t=this.box.name:this.cone?t=this.cone.name:this.clash?t=`clash: ${this.clash.clash.sele1} - ${this.clash.clash.sele2}`:this.contact?t=`${this.contact.type}: ${this.contact.atom1.qualifiedName()} - ${this.contact.atom2.qualifiedName()} (${this.contact.atom1.structure.name})`:this.cylinder?t=this.cylinder.name:this.distance?t=`distance: ${this.distance.atom1.qualifiedName()} - ${this.distance.atom2.qualifiedName()} (${this.distance.structure.name})`:this.ellipsoid?t=this.ellipsoid.name:this.octahedron?t=this.octahedron.name:this.point?t=this.point.name:this.mesh?t=`mesh: ${this.mesh.name||this.mesh.serial} (${this.mesh.shape.name})`:this.slice?t=`slice: ${this.slice.value.toPrecision(3)} (${this.slice.volume.name})`:this.sphere?t=this.sphere.name:this.surface?t=`surface: ${this.surface.surface.name}`:this.tetrahedron?t=this.tetrahedron.name:this.torus?t=this.torus.name:this.unitcell?t=`unitcell: ${this.unitcell.unitcell.spacegroup} (${this.unitcell.structure.name})`:this.unknown?t="unknown":this.volume?t=`volume: ${this.volume.value.toPrecision(3)} (${this.volume.volume.name})`:this.wideline&&(t=this.wideline.name),t}}class br{constructor(e){this.stage=e,this.viewer=e.viewer}pick(e,t){const n=this.viewer.pick(e,t);if(n.picker&&n.picker.type!=="ignore"&&n.pid!==void 0){const i=n.picker.array;if(!(i&&n.pid>=i.length))return new yr(n,this.stage);console.error("pid >= picker.array.length")}}}const _r=new Quaternion,xr=new Vector3,vr=new Vector3,wr=new Vector3,Ar=new Vector3,Sr=new Matrix4,Cr=new Vector3,Pr=new Matrix4;class Ir{constructor(e){this.stage=e,this.signals={changed:new signalsExports.Signal},this.viewer=e.viewer}get position(){return this.viewer.translationGroup.position}get rotation(){return this.viewer.rotationGroup.quaternion}changed(){this.viewer.requestRender(),this.signals.changed.dispatch()}getPositionOnCanvas(e,t){const n=xt(t,Vector2),i=this.viewer;return wr.copy(e).add(i.translationGroup.position).applyMatrix4(i.rotationGroup.matrix).project(i.camera),n.set((wr.x+1)*i.width/2,(wr.y+1)*i.height/2)}getCanvasScaleFactor(e=0){const t=this.viewer.camera;if(t instanceof OrthographicCamera)return 1/t.zoom;{e=Math.abs(e),e+=this.getCameraDistance();const n=It(t.fov);return 2*e*Math.tan(n/2)/this.viewer.height}}getOrientation(e){const t=wt(e);t.copy(this.viewer.rotationGroup.matrix);const n=this.getCameraDistance();return t.scale(Ar.set(n,n,n)),t.setPosition(this.viewer.translationGroup.position),t}orient(e){wt(e).decompose(xr,_r,vr);const t=this.viewer;t.rotationGroup.setRotationFromQuaternion(_r),t.translationGroup.position.copy(xr),t.cameraDistance=vr.z,t.updateZoom(),this.changed()}translate(e){this.viewer.translationGroup.position.add(vt(e)),this.changed()}center(e){this.viewer.translationGroup.position.copy(vt(e)).negate(),this.changed()}zoom(e){this.distance(this.getCameraDistance()*(1-e))}getCameraDistance(){return this.viewer.cameraDistance}distance(e){this.viewer.cameraDistance=Math.max(Math.abs(e),.2),this.viewer.updateZoom(),this.changed()}spin(e,t){Sr.copy(this.viewer.rotationGroup.matrix).invert(),Cr.copy(vt(e)).applyMatrix4(Sr),this.viewer.rotationGroup.rotateOnAxis(Cr,t),this.changed()}rotate(e){this.viewer.rotationGroup.setRotationFromQuaternion(At(e)),this.changed()}align(e){Pr.copy(wt(e)).invert(),this.viewer.rotationGroup.setRotationFromMatrix(Pr),this.changed()}applyMatrix(e){this.viewer.rotationGroup.applyMatrix4(wt(e)),this.changed()}}class kr{constructor(e,t,...n){this.pausedTime=-1,this.elapsedDuration=0,this.pausedDuration=0,this.ignoreGlobalToggle=!1,this._paused=!1,this._resolveList=[],this.duration=nt(e,1e3),this.controls=t,this.startTime=window.performance.now(),this._init(...n)}get done(){return this.alpha===1}get paused(){return this._paused}tick(e){if(!this._paused)return this.elapsedDuration=e.currentTime-this.startTime-this.pausedDuration,this.duration===0?this.alpha=1:this.alpha=Et(0,1,this.elapsedDuration/this.duration),this._tick(e),this.done&&this._resolveList.forEach((t=>t())),this.done}pause(e){e&&(this._hold=!0),this.pausedTime===-1&&(this.pausedTime=window.performance.now()),this._paused=!0}resume(e){!e&&this._hold||(this.pausedDuration+=window.performance.now()-this.pausedTime,this._paused=!1,this._hold=!1,this.pausedTime=-1)}toggle(){this._paused?this.resume():this.pause()}then(e){let t;return t=this.done?Promise.resolve():new Promise((n=>this._resolveList.push(n))),t.then(e)}}class Mr extends kr{constructor(e,t,...n){super(nt(e,1/0),t,...n)}_init(e,t){Array.isArray(e)?this.axis=new Vector3().fromArray(e):this.axis=nt(e,new Vector3(0,1,0)),this.angle=nt(t,.01)}_tick(e){this.axis&&this.angle&&this.controls.spin(this.axis,this.angle*e.lastDuration/16)}}class Tr extends kr{constructor(e,t,...n){super(nt(e,1/0),t,...n),this.angleSum=0,this.direction=1}_init(e,t,n){Array.isArray(e)?this.axis=new Vector3().fromArray(e):this.axis=nt(e,new Vector3(0,1,0)),this.angleStep=nt(t,.01),this.angleEnd=nt(n,.2)}_tick(e){if(!this.axis||!this.angleStep||!this.angleEnd)return;const t=Et(0,1,Math.abs(this.angleSum)/this.angleEnd),n=this.angleStep*this.direction*(1.1-t);this.controls.spin(this.axis,n*e.lastDuration/16),this.angleSum+=this.angleStep,this.angleSum>=this.angleEnd&&(this.direction*=-1,this.angleSum=-this.angleEnd)}}class Dr extends kr{_init(e,t){this.moveFrom=vt(nt(e,new Vector3)),this.moveTo=vt(nt(t,new Vector3))}_tick(){this.controls.position.lerpVectors(this.moveFrom,this.moveTo,this.alpha).negate(),this.controls.changed()}}class Br extends kr{_init(e,t){this.zoomFrom=e,this.zoomTo=t}_tick(){this.controls.distance(Bt(this.zoomFrom,this.zoomTo,this.alpha))}}class Fr extends kr{constructor(){super(...arguments),this._currentRotation=new Quaternion}_init(e,t){this.rotateFrom=At(e),this.rotateTo=At(t),this._currentRotation=new Quaternion}_tick(){this._currentRotation.copy(this.rotateFrom).slerp(this.rotateTo,this.alpha),this.controls.rotate(this._currentRotation)}}class Er extends kr{_init(e,t,n){this.valueFrom=e,this.valueTo=t,this.callback=n}_tick(){this.callback(Bt(this.valueFrom,this.valueTo,this.alpha))}}class $r extends kr{_init(e){this.callback=e}_tick(){this.alpha===1&&this.callback()}}class Or{constructor(e=[]){this._resolveList=[],this._list=e}get done(){return this._list.every((e=>e.done))}then(e){let t;return t=this.done?Promise.resolve():new Promise((n=>{this._resolveList.push(n),this._list.forEach((i=>{i.then((()=>{this._resolveList.forEach((s=>{s()})),this._resolveList.length=0}))}))})),t.then(e)}}class Rr{constructor(e){this.stage=e,this.animationList=[],this.finishedList=[],this.viewer=e.viewer,this.controls=e.viewerControls}get paused(){return this.animationList.every((e=>e.paused))}add(e){return e.duration===0?e.tick(this.viewer.stats):this.animationList.push(e),e}remove(e){const t=this.animationList,n=t.indexOf(e);n>-1&&t.splice(n,1)}run(e){const t=this.finishedList,n=this.animationList,i=n.length;for(let o=0;o<i;++o){const a=n[o];a.tick(e)&&t.push(a)}const s=t.length;if(s){for(let o=0;o<s;++o)this.remove(t[o]);t.length=0}}spin(e,t,n){return this.add(new Mr(n,this.controls,e,t))}rock(e,t,n,i){return this.add(new Tr(i,this.controls,e,t,n))}rotate(e,t){const n=this.viewer.rotationGroup.quaternion.clone();return this.add(new Fr(t,this.controls,n,e))}move(e,t){const n=this.controls.position.clone().negate();return this.add(new Dr(t,this.controls,n,e))}zoom(e,t){const n=this.viewer.camera.position.z;return this.add(new Br(t,this.controls,n,e))}zoomMove(e,t,n){return new Or([this.move(e,n),this.zoom(t,n)])}orient(e,t){const n=new Vector3,i=new Quaternion,s=new Vector3;return wt(e).decompose(n,i,s),new Or([this.move(n.negate(),t),this.rotate(i,t),this.zoom(-s.x,t)])}value(e,t,n,i){return this.add(new Er(i,this.controls,e,t,n))}timeout(e,t){return this.add(new $r(t,this.controls,e))}spinComponent(e,t,n,i){return this.add(new Mr(i,e.controls,t,n))}rockComponent(e,t,n,i,s){return this.add(new Tr(s,e.controls,t,n,i))}moveComponent(e,t,n){const i=e.controls.position.clone().negate();return this.add(new Dr(n,e.controls,i,t))}pause(){this.animationList.forEach((e=>e.pause()))}resume(){this.animationList.forEach((e=>e.resume()))}toggle(){this.paused?this.resume():this.pause()}clear(){this.animationList.length=0}dispose(){this.clear()}}class Lr{constructor(e,t){if(this.fn=e,this.queue=[],this.pending=!1,this.next=this.next.bind(this),t){for(let n=0,i=t.length;n<i;++n)this.queue.push(t[n]);this.next()}}run(e){this.fn(e,this.next)}next(){const e=this.queue.shift();e!==void 0?(this.pending=!0,setTimeout((()=>this.run(e)))):this.pending=!1}push(e){this.queue.push(e),this.pending||this.next()}kill(){this.queue.length=0}length(){return this.queue.length}}class Nr{constructor(e,t,n){this.type="",this.parameters={lazy:{type:"boolean"},clipNear:{type:"range",step:1,max:100,min:0,buffer:!0},clipRadius:{type:"number",precision:1,max:1e3,min:0,buffer:!0},clipCenter:{type:"vector3",precision:1,buffer:!0},flatShaded:{type:"boolean",buffer:!0},opacity:{type:"range",step:.01,max:1,min:0,buffer:!0},depthWrite:{type:"boolean",buffer:!0},side:{type:"select",buffer:!0,options:{front:"front",back:"back",double:"double"}},wireframe:{type:"boolean",buffer:!0},colorData:{type:"hidden",update:"color"},colorScheme:{type:"select",update:"color",options:{}},colorScale:{type:"select",update:"color",options:Oe.getScales()},colorReverse:{type:"boolean",update:"color"},colorValue:{type:"color",update:"color"},colorDomain:{type:"hidden",update:"color"},colorMode:{type:"select",update:"color",options:Oe.getModes()},roughness:{type:"range",step:.01,max:1,min:0,buffer:!0},metalness:{type:"range",step:.01,max:1,min:0,buffer:!0},diffuse:{type:"color",buffer:!0},diffuseInterior:{type:"boolean",buffer:!0},useInteriorColor:{type:"boolean",buffer:!0},interiorColor:{type:"color",buffer:!0},interiorDarkening:{type:"range",step:.01,max:1,min:0,buffer:!0},matrix:{type:"hidden",buffer:!0},disablePicking:{type:"boolean",rebuild:!0}},this.viewer=t,this.tasks=new ui,this.queue=new Lr(this.make.bind(this)),this.bufferList=[],this.parameters.colorScheme&&(this.parameters.colorScheme.options=Oe.getSchemes()),this.toBePrepared=!1}init(e){const t=e||{};this.clipNear=nt(t.clipNear,0),this.clipRadius=nt(t.clipRadius,0),this.clipCenter=nt(t.clipCenter,new Vector3),this.flatShaded=nt(t.flatShaded,!1),this.side=nt(t.side,"double"),this.opacity=nt(t.opacity,1),this.depthWrite=nt(t.depthWrite,!0),this.wireframe=nt(t.wireframe,!1),this.setColor(t.color,t),this.colorData=nt(t.colorData,void 0),this.colorScheme=nt(t.colorScheme,"uniform"),this.colorScale=nt(t.colorScale,""),this.colorReverse=nt(t.colorReverse,!1),this.colorValue=nt(t.colorValue,9474192),this.colorDomain=nt(t.colorDomain,void 0),this.colorMode=nt(t.colorMode,"hcl"),this.visible=nt(t.visible,!0),this.quality=nt(t.quality,void 0),this.roughness=nt(t.roughness,.4),this.metalness=nt(t.metalness,0),this.diffuse=nt(t.diffuse,16777215),this.diffuseInterior=nt(t.diffuseInterior,!1),this.useInteriorColor=nt(t.useInteriorColor,!1),this.interiorColor=nt(t.interiorColor,2236962),this.interiorDarkening=nt(t.interiorDarkening,0),this.lazy=nt(t.lazy,!1),this.lazyProps={build:!1,bufferParams:{},what:{}},this.matrix=nt(t.matrix,new Matrix4),this.disablePicking=nt(t.disablePicking,!1);const n=this.parameters;n.sphereDetail===!0&&(n.sphereDetail={type:"integer",max:3,min:0,rebuild:"impostor"}),n.radialSegments===!0&&(n.radialSegments={type:"integer",max:25,min:5,rebuild:"impostor"}),n.openEnded===!0&&(n.openEnded={type:"boolean",rebuild:"impostor",buffer:!0}),n.disableImpostor===!0&&(n.disableImpostor={type:"boolean",rebuild:!0}),t.quality==="low"?(n.sphereDetail&&(this.sphereDetail=0),n.radialSegments&&(this.radialSegments=5)):t.quality==="medium"?(n.sphereDetail&&(this.sphereDetail=1),n.radialSegments&&(this.radialSegments=10)):t.quality==="high"?(n.sphereDetail&&(this.sphereDetail=2),n.radialSegments&&(this.radialSegments=20)):(n.sphereDetail&&(this.sphereDetail=nt(t.sphereDetail,1)),n.radialSegments&&(this.radialSegments=nt(t.radialSegments,10))),n.openEnded&&(this.openEnded=nt(t.openEnded,!0)),n.disableImpostor&&(this.disableImpostor=nt(t.disableImpostor,!1))}getColorParams(e){return Object.assign({data:this.colorData,scheme:this.colorScheme,scale:this.colorScale,reverse:this.colorReverse,value:this.colorValue,domain:this.colorDomain,mode:this.colorMode,colorSpace:this.colorSpace},e)}getBufferParams(e={}){return Object.assign({clipNear:this.clipNear,clipRadius:this.clipRadius,clipCenter:this.clipCenter,flatShaded:this.flatShaded,opacity:this.opacity,depthWrite:this.depthWrite,side:this.side,wireframe:this.wireframe,roughness:this.roughness,metalness:this.metalness,diffuse:this.diffuse,diffuseInterior:this.diffuseInterior,useInteriorColor:this.useInteriorColor,interiorColor:this.interiorColor,interiorDarkening:this.interiorDarkening,matrix:this.matrix,disablePicking:this.disablePicking},e)}setColor(e,t){const n=Object.keys(Oe.getSchemes());if(typeof e=="string"&&n.includes(e.toLowerCase()))t?t.colorScheme=e:this.setParameters({colorScheme:e});else if(e!==void 0){let i=new Color(e).getHex();t?(t.colorScheme="uniform",t.colorValue=i):this.setParameters({colorScheme:"uniform",colorValue:i})}return this}prepare(e){}create(){}update(e){this.build()}build(e){if(!this.lazy||this.visible&&this.opacity){if(!this.toBePrepared)return this.tasks.increment(),void this.make();this.queue.length()>0?(this.tasks.change(1-this.queue.length()),this.queue.kill()):this.tasks.increment(),this.queue.push(e||!1)}else this.lazyProps.build=!0}make(e,t){De&&ke.time("Representation.make "+this.type);const n=()=>{e?(this.update(e),this.viewer.requestRender(),this.tasks.decrement(),t&&t()):(this.clear(),this.create(),this.manualAttach||this.disposed||(De&&ke.time("Representation.attach "+this.type),this.attach((()=>{De&&ke.timeEnd("Representation.attach "+this.type),this.tasks.decrement(),t&&t()})))),De&&ke.timeEnd("Representation.make "+this.type)};this.toBePrepared?this.prepare(n):n()}attach(e){this.setVisibility(this.visible),e()}setVisibility(e,t){if(this.visible=e,this.visible&&this.opacity){const n=this.lazyProps,i=n.bufferParams,s=n.what;if(n.build)return n.build=!1,this.build(),this;(Object.keys(i).length||Object.keys(s).length)&&(n.bufferParams={},n.what={},this.updateParameters(i,s))}return this.bufferList.forEach((function(n){n.setVisibility(e)})),t||this.viewer.requestRender(),this}setParameters(e,t={},n=!1){const i=e||{},s=this.parameters,o={};this.opacity||i.opacity===void 0||(this.lazyProps.build?(this.lazyProps.build=!1,n=!0):(Object.assign(o,this.lazyProps.bufferParams),Object.assign(t,this.lazyProps.what),this.lazyProps.bufferParams={},this.lazyProps.what={})),this.setColor(i.color,i);for(let a in i)i[a]!==void 0&&s[a]!=null&&(s[a].int&&(i[a]=parseInt(i[a])),s[a].float&&(i[a]=parseFloat(i[a])),i[a]!==this[a]||i[a].equals&&!i[a].equals(this[a]))&&(this[a]&&this[a].copy&&i[a].copy?this[a].copy(i[a]):this[a]&&this[a].set?this[a].set(i[a]):this[a]=i[a],s[a].buffer&&(s[a].buffer===!0?o[a]=i[a]:o[s[a].buffer]=i[a]),s[a].update&&(t[s[a].update]=!0),!s[a].rebuild||s[a].rebuild==="impostor"&&Pe&&!this.disableImpostor||(n=!0));return n?this.build():this.updateParameters(o,t),this}updateParameters(e={},t){if(this.lazy&&(!this.visible||!this.opacity)&&e.hasOwnProperty("opacity")===!1)return Object.assign(this.lazyProps.bufferParams,e),void Object.assign(this.lazyProps.what,t);this.bufferList.forEach((function(n){n.setParameters(e)})),Object.keys(t).length&&this.update(t),this.viewer.requestRender()}getParameters(){const e={lazy:this.lazy,visible:this.visible,quality:this.quality};return Object.keys(this.parameters).forEach((t=>{this.parameters[t]!==null&&(e[t]=this[t])})),e}clear(){this.bufferList.forEach((e=>{this.viewer.remove(e),e.dispose()})),this.bufferList.length=0,this.viewer.requestRender()}dispose(){this.disposed=!0,this.queue.kill(),this.tasks.dispose(),this.clear()}}class zr{constructor(e){this.pending=0,this.postCount=0,this.onmessageDict={},this.onerrorDict={},this.name=e,this.blobUrl=window.URL.createObjectURL($e.get(e)),this.worker=new Worker(this.blobUrl),$e.activeWorkerCount+=1,this.worker.onmessage=t=>{this.pending-=1;const n=t.data.__postId;De&&ke.timeEnd("Worker.postMessage "+e+" #"+n);const i=this.onmessageDict[n];i&&i.call(this.worker,t),delete this.onmessageDict[n],delete this.onerrorDict[n]},this.worker.onerror=t=>{if(this.pending-=1,t.data){const n=t.data.__postId,i=this.onerrorDict[n];i?i.call(this.worker,t):ke.error("Worker.onerror",n,e,t),delete this.onmessageDict[n],delete this.onerrorDict[n]}else ke.error("Worker.onerror",e,t)}}post(e={},t,n,i){this.onmessageDict[this.postCount]=n,this.onerrorDict[this.postCount]=i,e.__name=this.name,e.__postId=this.postCount,e.__debug=De,De&&ke.time(`Worker.postMessage ${this.name} #${this.postCount}`);try{this.worker.postMessage(e,t)}catch(s){ke.error("worker.post:",s),this.worker.postMessage(e)}return this.pending+=1,this.postCount+=1,this}terminate(){this.worker?(this.worker.terminate(),window.URL.revokeObjectURL(this.blobUrl),$e.activeWorkerCount-=1):ke.log("no worker to terminate")}}class Ur{constructor(e,t=2){this.pool=[],this.count=0,this.maxCount=Math.min(8,t),this.name=e}post(e={},t,n,i){const s=this.getNextWorker();return s?s.post(e,t,n,i):console.error("unable to get worker from pool"),this}terminate(){this.pool.forEach((function(e){e.terminate()}))}getNextWorker(){let e,t=1/0;for(let n=0;n<this.maxCount;++n){if(n>=this.count){e=new zr(this.name),this.pool.push(e),this.count+=1;break}const i=this.pool[n];if(i.pending===0){e=i;break}i.pending<t&&(t=i.pending,e=i)}return e}}function Vr(r){const e=r.length,t=e/3;let n=0,i=0,s=0;for(let o=0;o<e;o+=3)n+=r[o+0],i+=r[o+1],s+=r[o+2];return new Vector3(n/t,i/t,s/t)}function jr(r,e,t){return t?r.sub(t).projectOnVector(e).add(t):r.projectOnVector(e),r}function Gr(r){let e=1/0,t=1/0,n=1/0,i=-1/0,s=-1/0,o=-1/0;for(let a=0,l=r.length;a<l;a+=3){const d=r[a],u=r[a+1],g=r[a+2];d<e&&(e=d),u<t&&(t=u),g<n&&(n=g),d>i&&(i=d),u>s&&(s=u),g>o&&(o=g)}return[Xr([e,t,n]),Xr([i,s,o])]}function Hr(r,e){for(let t=0,n=e.length;t<n;t+=3){const i=e[t],s=e[t+1],o=e[t+2];e[t]=r[0]*i+r[4]*s+r[8]*o+r[12],e[t+1]=r[1]*i+r[5]*s+r[9]*o+r[13],e[t+2]=r[2]*i+r[6]*s+r[10]*o+r[14]}}function qr(r,e){for(let t=0,n=e.length;t<n;t+=3){const i=e[t],s=e[t+1],o=e[t+2];e[t]=r[0]*i+r[3]*s+r[6]*o,e[t+1]=r[1]*i+r[4]*s+r[7]*o,e[t+2]=r[2]*i+r[5]*s+r[8]*o}}function Wr(r){for(let e=0,t=r.length;e<t;e+=3){const n=r[e],i=r[e+1],s=r[e+2],o=n*n+i*i+s*s;if(o>0){const a=1/Math.sqrt(o);r[e]=n*a,r[e+1]=i*a,r[e+2]=s*a}}}function Xr(r){return new Float32Array(r||3)}function Yr(r,e,t){const n=e[0],i=e[1],s=e[2],o=t[0],a=t[1],l=t[2];r[0]=i*l-s*a,r[1]=s*o-n*l,r[2]=n*a-i*o}function Kr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Zr(r,e,t){r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2]}function Qr(r,e,t){r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2]}function Jr(r,e,t=0){r[0]=e[t],r[1]=e[t+1],r[2]=e[t+2]}function tn(r,e,t=0){e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2]}function en(r){return r[0]*r[0]+r[1]*r[1]+r[2]*r[2]}function rn(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2])}function nn(r,e,t){sn(r,e,1/t)}function sn(r,e,t){r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t}function on(r,e){const t=en(e);t==0?(r[0]=e[0],r[1]=e[1],r[2]=e[2]):sn(r,e,1/Math.sqrt(t))}function an(r,e,t){r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]-t}function cn(r,e,t){r[0]=e[0]+t,r[1]=e[1]+t,r[2]=e[2]+t}function ln(r,e){r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2])}function hn(r,e){r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2])}function un(r,e){r[0]=-e[0],r[1]=-e[1],r[2]=-e[2]}function dn(r,e){const t=r[0],n=r[1],i=r[2],s=e[0],o=e[1],a=e[2],l=n*a-i*o,d=i*s-t*a,u=t*o-n*s,g=Math.sqrt(l*l+d*d+u*u),x=t*s+n*o+i*a;return Math.atan2(g,x)}function mn(r,e=9){const t=Math.floor(e/2),n=r.position1.length/3,i=3*(t*n),s=1/e,o=wi(r.position1,r.position2),a=new Float32Array(i),l=new Float32Array(i),d=new Vector3;for(let y=0;y<n;++y){const b=3*y;d.set(o[b],o[b+1],o[b+2]);const _=r.position1[b],h=r.position1[b+1],f=r.position1[b+2];for(let E=0;E<t;++E){const m=t*b+3*E,S=s*(2*E+1),w=s*(2*E+2);a[m]=_+d.x*S,a[m+1]=h+d.y*S,a[m+2]=f+d.z*S,l[m]=_+d.x*w,l[m+1]=h+d.y*w,l[m+2]=f+d.z*w}}const u=vi(a,l),g=(function(y,b){const _=y.length/3,h=new Float32Array(_*b*3);for(let f=0;f<_;++f){const E=3*f,m=f*b*3,S=y[E+0],w=y[E+1],v=y[E+2];for(let A=0;A<b;++A){const M=m+3*A;h[M+0]=S,h[M+1]=w,h[M+2]=v}}return h})(r.color,t),x={position:u,position1:a,position2:l,color:g,color2:g};return r.radius&&(x.radius=Ii(r.radius,t)),r.picking&&r.picking.array&&(r.picking.array=Ii(r.picking.array,t),x.picking=r.picking),r.primitiveId&&(x.primitiveId=Ii(r.primitiveId,t)),x}function fn(r,e=.1){const t=wi(r.position1,r.position2),n=[],i=[],s=[],o=r.radius?[]:void 0,a=r.picking?[]:void 0,l=r.primitiveId?[]:void 0,d=new Vector3,u=r.position1.length/3;let g=0;for(let f=0;f<u;++f){const E=3*f;d.set(t[E],t[E+1],t[E+2]);const m=d.length()/e,S=Math.floor(m/2),w=1/m,v=r.position1[E],A=r.position1[E+1],M=r.position1[E+2];for(let T=0;T<S;++T){const R=3*g+3*T,P=w*(2*T+1),L=w*(2*T+2);n[R]=v+d.x*P,n[R+1]=A+d.y*P,n[R+2]=M+d.z*P,i[R]=v+d.x*L,i[R+1]=A+d.y*L,i[R+2]=M+d.z*L,r.color&&(s[R]=r.color[E],s[R+1]=r.color[E+1],s[R+2]=r.color[E+2]),o&&(o[g+T]=r.radius[f]),a&&(r.picking.array?a[g+T]=r.picking.array[f]:a[g+T]=f),l&&(l[g+T]=r.primitiveId[f])}g+=S}const x=new Float32Array(n),y=new Float32Array(i),b=vi(x,y),_=new Float32Array(s),h={position:b,position1:x,position2:y,color:_,color2:_};return o&&(h.radius=new Float32Array(o)),a&&r.picking&&(r.picking.array=new Float32Array(a),h.picking=r.picking),l&&(h.primitiveId=new Float32Array(l)),h}function pn(r,e=.1){const t=wi(r.position1,r.position2),n=[],i=[],s=[],o=r.radius?[]:void 0,a=r.picking?[]:void 0,l=r.primitiveId?[]:void 0,d=new Vector3,u=r.position1.length/3;let g=e,x=!0,y=0,b=0,_=0;for(let w=0;w<u;++w){const v=3*w,A=r.position1[v],M=r.position1[v+1],T=r.position1[v+2];d.set(t[v],t[v+1],t[v+2]);const R=d.length();x&&(n[b]=A,n[b+1]=M,n[b+2]=T);let P=g;const L=1/R;for(;P<R;){const O=x?i:n;O[b]=A+d.x*P*L,O[b+1]=M+d.y*P*L,O[b+2]=T+d.z*P*L,x&&(y++,b=3*y),x=!x,g=e,P+=e}x&&(i[b]=r.position2[v],i[b+1]=r.position2[v+1],i[b+2]=r.position2[v+2],y++,b=3*y),g=P-R;for(let O=_;O<y;O++){if(r.color){const I=3*O;s[I]=r.color[v],s[I+1]=r.color[v+1],s[I+2]=r.color[v+2]}o&&(o[O]=r.radius[w]),a&&(r.picking.array?a[O]=r.picking.array[w]:a[O]=w),l&&(l[O]=r.primitiveId[w])}_=y}if(!x&&u>0){const w=3*y;i[w]=r.position2[3*u-3],i[w+1]=r.position2[3*u-2],i[w+1]=r.position2[3*u-1]}const h=new Float32Array(n),f=new Float32Array(i),E=vi(h,f),m=new Float32Array(s),S={position:E,position1:h,position2:f,color:m,color2:m};return o&&(S.radius=new Float32Array(o)),a&&r.picking&&(r.picking.array=new Float32Array(a),S.picking=r.picking),l&&(S.primitiveId=new Float32Array(l)),S}Ur.prototype.constructor=Ur,Gr.__deps=[Xr],nn.__deps=[sn],on.__deps=[sn,en];const gn=new Vector3;class yn{static get Picker(){return Ge.get(this.type)}static get Buffer(){return je.get(this.type)}static getShapeKey(e){return this.type+e[0].toUpperCase()+e.substr(1)}static expandBoundingBox(e,t){}static valueToShape(e,t,n){const i=e._primitiveData[this.getShapeKey(t)];switch(this.fields[t]){case"v3":case"c":(function(s,o){s.toArray!==void 0?s=s.toArray():s.x!==void 0?s=[s.x,s.y,s.z]:s.r!==void 0&&(s=[s.r,s.g,s.b]),o.push.apply(o,s)})(n,i);break;default:i.push(n)}}static objectToShape(e,t){Object.keys(this.fields).forEach((n=>{this.valueToShape(e,n,t[n])})),this.valueToShape(e,"name",t.name),this.expandBoundingBox(e.boundingBox,t)}static valueFromShape(e,t,n){const i=e._primitiveData[this.getShapeKey(n)];switch(this.fields[n]){case"v3":return new Vector3().fromArray(i,3*t);case"c":return new Color().fromArray(i,3*t);default:return i[t]}}static objectFromShape(e,t){let n=this.valueFromShape(e,t,"name");n===void 0&&(n=`${this.type}: ${t} (${e.name})`);const i={shape:e,name:n};return Object.keys(this.fields).forEach((s=>{i[s]=this.valueFromShape(e,t,s)})),i}static arrayFromShape(e,t){const n=e._primitiveData[this.getShapeKey(t)];return this.fields[t]==="s"?n:new Float32Array(n)}static dataFromShape(e){const t={};return this.Picker&&(t.picking=new this.Picker(e)),Object.keys(this.fields).forEach((n=>{t[n]=this.arrayFromShape(e,n)})),t}static bufferFromShape(e,t){return new this.Buffer(this.dataFromShape(e),t)}}yn.type="",yn.fields={};class bn extends yn{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position))}}bn.type="sphere",bn.fields={position:"v3",color:"c",radius:"f"};class _n extends yn{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position))}}_n.type="box",_n.fields={position:"v3",color:"c",size:"f",heightAxis:"v3",depthAxis:"v3"};class xn extends _n{}xn.type="octahedron";class vn extends _n{}vn.type="tetrahedron";class wn extends yn{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position1)),e.expandByPoint(gn.fromArray(t.position2))}static bufferFromShape(e,t={}){let n=this.dataFromShape(e);return this.type==="cylinder"&&t.dashedCylinder&&(n=fn(n)),new this.Buffer(n,t)}}wn.type="cylinder",wn.fields={position1:"v3",position2:"v3",color:"c",radius:"f"};class An extends wn{}An.type="arrow";class Sn extends wn{}Sn.type="cone";class Cn extends bn{}Cn.type="ellipsoid",Cn.fields={position:"v3",color:"c",radius:"f",majorAxis:"v3",minorAxis:"v3"};class Pn extends Cn{}Pn.type="torus";class In extends yn{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position))}}In.type="text",In.fields={position:"v3",color:"c",size:"f",text:"s"};class kn extends yn{static positionFromShape(e,t){return this.valueFromShape(e,t,"position")}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position))}}kn.type="point",kn.fields={position:"v3",color:"c"};class Mn extends yn{static positionFromShape(e,t){const n=this.valueFromShape(e,t,"position1"),i=this.valueFromShape(e,t,"position2");return n.add(i).multiplyScalar(.5)}static expandBoundingBox(e,t){e.expandByPoint(gn.fromArray(t.position1)),e.expandByPoint(gn.fromArray(t.position2))}}Mn.type="wideline",Mn.fields={position1:"v3",position2:"v3",color:"c"};class Tn{constructor(e,t){this.exp=3;const n=t||(function(h){const{x:f,y:E,z:m}=h,S=new Box3,w=f.length,{min:v,max:A}=S;for(let M=0;M<w;M++)v.x=Math.min(f[M],v.x),v.y=Math.min(E[M],v.y),v.z=Math.min(m[M],v.z),A.x=Math.max(f[M],A.x),A.y=Math.max(E[M],A.y),A.z=Math.max(m[M],A.z);return S})(e);this.minX=n.min.x,this.minY=n.min.y,this.minZ=n.min.z,this.boundX=1+(n.max.x-this.minX>>this.exp),this.boundY=1+(n.max.y-this.minY>>this.exp),this.boundZ=1+(n.max.z-this.minZ>>this.exp);const i=this.boundX*this.boundY*this.boundZ,s=e.count!==void 0?e.count:e.x.length,o=e.x,a=e.y,l=e.z;let d=0;const u=new Uint32Array(i),g=new Int32Array(s);for(let h=0;h<s;++h){const f=o[h]-this.minX>>this.exp,E=a[h]-this.minY>>this.exp,m=l[h]-this.minZ>>this.exp,S=(f*this.boundY+E)*this.boundZ+m;(u[S]+=1)===1&&(d+=1),g[h]=S}const x=new Uint16Array(d);for(let h=0,f=0;h<i;++h){const E=u[h];E>0&&(u[h]=f+1,x[f]=E,f+=1)}const y=new Uint32Array(d);for(let h=1;h<d;++h)y[h]+=y[h-1]+x[h-1];const b=new Uint16Array(d),_=new Int32Array(s);for(let h=0;h<s;++h){const f=u[g[h]];if(f>0){const E=f-1;_[y[E]+b[E]]=h,b[E]+=1}}this.grid=u,this.bucketCount=x,this.bucketOffset=y,this.bucketArray=_,this.xArray=o,this.yArray=a,this.zArray=l}within(e,t,n,i){const s=[];return this.eachWithin(e,t,n,i,(o=>s.push(o))),s}eachWithin(e,t,n,i,s){const o=i*i,a=Math.max(0,e-i-this.minX>>this.exp),l=Math.max(0,t-i-this.minY>>this.exp),d=Math.max(0,n-i-this.minZ>>this.exp),u=Math.min(this.boundX,1+(e+i-this.minX>>this.exp)),g=Math.min(this.boundY,1+(t+i-this.minY>>this.exp)),x=Math.min(this.boundZ,1+(n+i-this.minZ>>this.exp));for(let y=a;y<u;++y)for(let b=l;b<g;++b)for(let _=d;_<x;++_){const h=(y*this.boundY+b)*this.boundZ+_,f=this.grid[h];if(f>0){const E=f-1,m=this.bucketOffset[E],S=m+this.bucketCount[E];for(let w=m;w<S;++w){const v=this.bucketArray[w],A=this.xArray[v]-e,M=this.yArray[v]-t,T=this.zArray[v]-n,R=A*A+M*M+T*T;R<=o&&s(v,R)}}}}}class Dn{constructor(e=0){this._fields=this._defaultFields,this._init(0)}get _defaultFields(){return[]}_init(e){this.length=e,this.count=0;for(let t=0,n=this._fields.length;t<n;++t){const[i,s,o]=this._fields[t];this._initField(i,s,o)}}_initField(e,t,n){this[e]=yt(n,this.length*t)}addField(e,t,n){this._fields.push([e,t,n]),this._initField(e,t,n)}resize(e){this.length=Math.round(e||0),this.count=Math.min(this.count,this.length);for(let t=0,n=this._fields.length;t<n;++t){const i=this._fields[t][0],s=this._fields[t][1],o=this.length*s,a=new this[i].constructor(o);this[i].length>o?a.set(this[i].subarray(0,o)):a.set(this[i]),this[i]=a}}growIfFull(){if(this.count>=this.length){const e=Math.round(1.5*this.length);this.resize(Math.max(256,e))}}copyFrom(e,t,n,i){for(let s=0,o=this._fields.length;s<o;++s){const a=this._fields[s][0],l=this._fields[s][1],d=this[a],u=e[a];for(let g=0;g<i;++g){const x=l*(t+g),y=l*(n+g);for(let b=0;b<l;++b)d[x+b]=u[y+b]}}}copyWithin(e,t,n){for(let i=0,s=this._fields.length;i<s;++i){const o=this._fields[i][0],a=this._fields[i][1],l=this[o];for(let d=0;d<n;++d){const u=a*(e+d),g=a*(t+d);for(let x=0;x<a;++x)l[u+x]=l[g+x]}}}sort(e){ke.time("Store.sort");const t=this,n=new this.constructor(1);(function i(s,o){if(s<o){let d=Math.floor((s+o)/2),u=s,g=o;do{for(;e(u,d)<0;)u+=1;for(;e(g,d)>0;)g-=1;u<=g&&(u===d?d=g:g===d&&(d=u),(a=u)!==(l=g)&&(n.copyFrom(t,0,a,1),t.copyWithin(a,l,1),t.copyFrom(n,l,0,1)),u+=1,g-=1)}while(u<=g);i(s,g),i(u,o)}var a,l})(0,this.count-1),ke.timeEnd("Store.sort")}clear(){this.count=0}dispose(){for(let e=0,t=this._fields.length;e<t;++e)delete this[this._fields[e][0]]}}class Bn extends Dn{get _defaultFields(){return[["index1",1,"int32"],["index2",1,"int32"],["type",1,"int8"]]}addContact(e,t,n){this.growIfFull();const i=this.count;e<t?(this.index1[i]=e,this.index2[i]=t):(this.index2[i]=e,this.index1[i]=t),n&&(this.type[i]=n),this.count+=1}}function Fn(r){return 16843009*((r=(858993459&(r-=r>>>1&1431655765))+(r>>>2&858993459))+(r>>>4)&252645135)>>>24}class En{constructor(e,t){this.length=e,this._words=new Uint32Array(e+32>>>5),t===!0&&this.setAll()}get(e){return!!(this._words[e>>>5]&1<<e)}set(e){this._words[e>>>5]|=1<<e}clear(e){this._words[e>>>5]&=~(1<<e)}flip(e){this._words[e>>>5]^=1<<e}_assignRange(e,t,n){if(t<e)return;const i=this._words,s=n===!0?4294967295:0,o=e>>>5,a=t>>>5;for(let u=o+1;u<a;++u)i[u]=s;const l=o<<5,d=a<<5;if(n===!0)if(t-e<32)for(let u=e,g=t+1;u<g;++u)i[u>>>5]|=1<<u;else{for(let u=e,g=l+32;u<g;++u)i[u>>>5]|=1<<u;for(let u=d,g=t+1;u<g;++u)i[u>>>5]|=1<<u}else if(t-e<32)for(let u=e,g=t+1;u<g;++u)i[u>>>5]&=~(1<<u);else{for(let u=e,g=l+32;u<g;++u)i[u>>>5]&=~(1<<u);for(let u=d,g=t+1;u<g;++u)i[u>>>5]&=~(1<<u)}return this}setRange(e,t){return this._assignRange(e,t,!0)}clearRange(e,t){return this._assignRange(e,t,!1)}setBits(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const s=e[i];t[s>>>5]|=1<<s}return this}clearBits(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const s=e[i];t[s>>>5]&=~(1<<s)}return this}setAll(){return this._assignRange(0,this.length-1,!0)}clearAll(){return this._assignRange(0,this.length-1,!1)}flipAll(){const e=this._words.length,t=this._words,n=32-this.length%32;for(let i=0;i<e-1;++i)t[i]=~t[i];return t[e-1]=~(t[e-1]<<n)>>>n,this}_isRangeValue(e,t,n){if(t<e)return;const i=this._words,s=n===!0?4294967295:0,o=e>>>5,a=t>>>5;for(let l=o+1;l<a;++l)if(i[l]!==s)return!1;if(t-e<32){for(let l=e,d=t+1;l<d;++l)if(!!(i[l>>>5]&1<<l)!==n)return!1}else{const l=a<<5;for(let d=e,u=(o<<5)+32;d<u;++d)if(!!(i[d>>>5]&1<<d)!==n)return!1;for(let d=l,u=t+1;d<u;++d)if(!!(i[d>>>5]&1<<d)!==n)return!1}return!0}isRangeSet(e,t){return this._isRangeValue(e,t,!0)}isRangeClear(e,t){return this._isRangeValue(e,t,!1)}isAllSet(){return this._isRangeValue(0,this.length-1,!0)}isAllClear(){return this._isRangeValue(0,this.length-1,!1)}isSet(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const s=e[i];if(!(t[s>>>5]&1<<s))return!1}return!0}isClear(...e){const t=this._words,n=e.length;for(let i=0;i<n;++i){const s=e[i];if(t[s>>>5]&1<<s)return!1}return!0}isEqualTo(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)if(t[s]!==n[s])return!1;return!0}getSize(){const e=this._words.length,t=this._words;let n=0;for(let i=0;i<e;++i)n+=Fn(t[i]);return n}difference(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)t[s]=t[s]&~n[s];for(let s=t.length;s<i;++s)t[s]=0;return this}union(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)t[s]|=n[s];for(let s=t.length;s<i;++s)t[s]=0;return this}intersection(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)t[s]&=n[s];for(let s=t.length;s<i;++s)t[s]=0;return this}intersects(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);for(let s=0;s<i;++s)if(t[s]&n[s])return!0;return!1}getIntersectionSize(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length);let s=0;for(let o=0;o<i;++o)s+=Fn(t[o]&n[o]);return s}makeIntersection(e){const t=this._words,n=e._words,i=Math.min(t.length,n.length),s=new Uint32Array(i),o=Object.create(En.prototype);o._words=s,o.length=Math.min(this.length,e.length);for(let a=0;a<i;++a)s[a]=t[a]&n[a];return o}forEach(e){const t=this._words.length,n=this._words;let i=0;for(let s=0;s<t;++s){let o=n[s];for(;o!==0;){const a=o&-o;e((s<<5)+Fn(a-1),i),o^=a,++i}}}toArray(){const e=this._words,t=new Array(this.getSize()),n=this._words.length;let i=0;for(let s=0;s<n;++s){let o=e[s];for(;o!==0;){const a=o&-o;t[i++]=(s<<5)+Fn(a-1),o^=a}}return t}toString(){return"{"+this.toArray().join(",")+"}"}toSeleString(){const e=this.toArray().join(",");return e?"@"+e:"NONE"}clone(){const e=Object.create(En.prototype);return e.length=this.length,e._words=new Uint32Array(this._words),e}}function $n(r){const{edgeCount:e,nodeCount:t,nodeArray1:n,nodeArray2:i}=r,s=new Uint8Array(t),o=new Int32Array(t);for(let d=0;d<e;++d)s[n[d]]+=1,s[i[d]]+=1;for(let d=1;d<t;++d)o[d]+=o[d-1]+s[d-1];const a=2*e,l=new Int32Array(a);for(let d=0;d<a;++d)l[d]=-1;for(let d=0;d<e;++d){const u=n[d],g=i[d];let x=o[u];for(;l[x]!==-1&&x<a;)x+=1;l[x]=d;let y=o[g];for(;l[y]!==-1&&y<a;)y+=1;l[y]=d}return{countArray:s,offsetArray:o,indexArray:l}}function On(r=0,e=0){return{type:r,group:e,x:0,y:0,z:0,atomSet:[]}}function Rn(r,e){r.x+=e.x,r.y+=e.y,r.z+=e.z,r.atomSet.push(e.index)}function Ln(r,e){const t=e.atomSet.length;if(t>0){const{types:n,groups:i,centers:s,atomSets:o}=r;n.push(e.type),i.push(e.group),s.x.push(e.x/t),s.y.push(e.y/t),s.z.push(e.z/t),o.push(e.atomSet)}}const Nn=0,zn=["D-BETA-PEPTIDE, C-GAMMA LINKING","D-GAMMA-PEPTIDE, C-DELTA LINKING","D-PEPTIDE COOH CARBOXY TERMINUS","D-PEPTIDE NH3 AMINO TERMINUS","D-PEPTIDE LINKING","L-BETA-PEPTIDE, C-GAMMA LINKING","L-GAMMA-PEPTIDE, C-DELTA LINKING","L-PEPTIDE COOH CARBOXY TERMINUS","L-PEPTIDE NH3 AMINO TERMINUS","L-PEPTIDE LINKING","PEPTIDE LINKING","PEPTIDE-LIKE"],Un=["RNA OH 3 PRIME TERMINUS","RNA OH 5 PRIME TERMINUS","RNA LINKING"],Vn=["DNA OH 3 PRIME TERMINUS","DNA OH 5 PRIME TERMINUS","DNA LINKING","L-DNA LINKING","L-RNA LINKING"],jn=["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","SACCHARIDE"],Gn=["NON-POLYMER"].concat(["OTHER"],jn),Hn=["h","g","i"],qn=["e","b"],Wn=["s","t","l",""],Xn={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109,DS:110,RG:111,CN:112,NH:113,FL:114,MC:115,LV:116,TS:117,OG:118},Yn={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:2,114:2,115:2,116:2,117:2,118:2},Kn={1:.31,2:.28,3:1.28,4:.96,5:.84,6:.76,7:.71,8:.66,9:.57,10:.58,11:1.66,12:1.41,13:1.21,14:1.11,15:1.07,16:1.05,17:1.02,18:1.06,19:2.03,20:1.76,21:1.7,22:1.6,23:1.53,24:1.39,25:1.39,26:1.32,27:1.26,28:1.24,29:1.32,30:1.22,31:1.22,32:1.2,33:1.19,34:1.2,35:1.2,36:1.16,37:2.2,38:1.95,39:1.9,40:1.75,41:1.64,42:1.54,43:1.47,44:1.46,45:1.42,46:1.39,47:1.45,48:1.44,49:1.42,50:1.39,51:1.39,52:1.38,53:1.39,54:1.4,55:2.44,56:2.15,57:2.07,58:2.04,59:2.03,60:2.01,61:1.99,62:1.98,63:1.98,64:1.96,65:1.94,66:1.92,67:1.92,68:1.89,69:1.9,70:1.87,71:1.87,72:1.75,73:1.7,74:1.62,75:1.51,76:1.44,77:1.41,78:1.36,79:1.36,80:1.32,81:1.45,82:1.46,83:1.48,84:1.4,85:1.5,86:1.5,87:2.6,88:2.21,89:2.15,90:2.06,91:2,92:1.96,93:1.9,94:1.87,95:1.8,96:1.69,97:1.6,98:1.6,99:1.6,100:1.6,101:1.6,102:1.6,103:1.6,104:1.6,105:1.6,106:1.6,107:1.6,108:1.6,109:1.6,110:1.6,111:1.6,112:1.6,113:1.6,114:1.6,115:1.6,116:1.6,117:1.6,118:1.6},Zn={1:[1],2:[0],3:[1],4:[2],5:[3],6:[4],7:[3],8:[2],9:[1],10:[0],11:[1],12:[2],13:[6],14:[6],15:[3,5,7],16:[2,4,6],17:[1],18:[0],19:[1],20:[2],31:[3],32:[4],33:[3,5],34:[2,4,6],35:[1],36:[0],37:[1],38:[2],49:[3],50:[4],51:[3,5],52:[2],53:[1,2,5],54:[0,2],55:[1],56:[2],81:[3],82:[4],83:[3],84:[2],85:[1],86:[0],87:[1],88:[2]},Qn={1:1,2:2,3:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:1,12:2,13:3,14:4,15:5,16:6,17:7,18:8,19:1,20:2,21:3,22:4,23:5,24:6,25:7,26:8,27:9,28:10,29:11,30:2,31:3,32:4,33:5,34:6,35:7,36:8,37:1,38:2,39:3,40:4,41:5,42:6,43:7,44:8,45:9,46:10,47:11,48:2,49:3,50:4,51:5,52:6,53:7,54:8,55:1,56:2,57:3,58:4,59:3,60:4,61:5,62:6,63:7,64:8,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:4,73:5,74:6,75:7,76:8,77:9,78:10,79:11,80:2,81:3,82:4,83:5,84:6,85:7,86:8,87:1,88:2,89:3,90:4,91:3,92:4,93:5,94:6,95:7,96:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:2,105:2,106:2,107:2,108:2,109:2,110:2,111:2,112:2,113:3,114:4,115:5,116:6,117:7,118:8},Jn={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53]},ts=[0,0,0],es={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O"},is=Object.keys(es),rs=["A","C","T","G","U","I"],ns=["DA","DC","DT","DG","DU","DI"],ss=["A","G","I","DA","DG","DI"],os=rs.concat(ns),as=["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP3","TIP4","SPC"],cs=["118","119","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","543","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MLT","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","NCO","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","OHX"],ls=["045","0AT","0BD","0MK","0NZ","0TS","0V4","0XY","0YT","10M","147","149","14T","15L","16G","18T","18Y","1AR","1BW","1GL","1GN","1JB","1LL","1NA","1S3","26M","26Q","26R","26V","26W","26Y","27C","289","291","293","2DG","2F8","2FG","2FL","2FP","2GL","2M4","2M5","32O","34V","3CM","3DO","3DY","3FM","3LR","3MF","3MG","3SA","3ZW","46D","46M","46Z","48Z","4CQ","4GC","4NN","50A","5DI","5GF","5MM","5RP","5SA","5SP","64K","6PG","6SA","7JZ","7SA","A1Q","A2G","AAB","AAL","AAO","ABC","ABD","ABE","ABF","ABL","ACG","ACI","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AHR","AIG","ALL","ALX","AMU","AOG","AOS","ARA","ARB","ARE","ARI","ASG","ASO","AXP","AXR","B0D","B16","B2G","B4G","B6D","B8D","B9D","BBK","BCD","BDG","BDP","BDR","BEM","BFP","BGC","BGL","BGP","BGS","BHG","BMA","BMX","BNG","BNX","BOG","BRI","BXF","BXP","BXX","BXY","C3X","C4X","C5X","CAP","CBI","CBK","CBS","CDR","CEG","CGF","CHO","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D6G","DAF","DAG","DDA","DDB","DDL","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGS","DIG","DLF","DLG","DMU","DNO","DOM","DP5","DQQ","DQR","DR2","DR3","DR4","DRI","DSR","DT6","DVC","E4P","E5G","EAG","EBG","EBQ","EGA","EJT","EPG","ERE","ERI","F1P","F1X","F6P","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FIX","FMO","FRU","FSI","FU4","FUB","FUC","FUD","FUL","FXP","G16","G1P","G2F","G3I","G4D","G4S","G6D","G6P","G6S","GAC","GAD","GAL","GC1","GC4","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GCX","GE1","GFG","GFP","GIV","GL0","GL2","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GMH","GN1","GNX","GP1","GP4","GPH","GPM","GQ1","GQ2","GQ4","GS1","GS4","GSA","GSD","GTE","GTH","GTK","GTR","GTZ","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUP","GUZ","GYP","GYV","H2P","HDL","HMS","HS2","HSD","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","IAB","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IMK","IN1","IPT","ISL","KBG","KD2","KDA","KDM","KDO","KFN","KO1","KO2","KTU","L6S","LAG","LAI","LAK","LAO","LAT","LB2","LBT","LCN","LDY","LGC","LGU","LM2","LMT","LMU","LOG","LOX","LPK","LSM","LTM","LVZ","LXB","LXZ","M1F","M3M","M6P","M8C","MA1","MA2","MA3","MAB","MAG","MAL","MAN","MAT","MAV","MAW","MBG","MCU","MDA","MDM","MDP","MFA","MFB","MFU","MG5","MGA","MGL","MLB","MMA","MMN","MN0","MRP","MTT","MUG","MVP","MXY","N1L","N9S","NAA","NAG","NBG","NDG","NED","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGL","NGS","NGY","NHF","NM6","NM9","NTF","NTO","NTP","NXD","NYT","OPG","OPM","ORP","OX2","P3M","P53","P6P","PA5","PNA","PNG","PNW","PRP","PSJ","PSV","PTQ","QDK","QPS","QV4","R1P","R1X","R2B","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RIB","RIP","RNS","RNT","ROB","ROR","RPA","RST","RUB","RUU","RZM","S6P","S7P","SA0","SCR","SDD","SF6","SF9","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHG","SI3","SIO","SOE","SOL","SSG","SUC","SUP","SUS","T6P","T6T","TAG","TCB","TDG","TGK","TGY","TH1","TIA","TM5","TM6","TM9","TMR","TMX","TOA","TOC","TRE","TYV","UCD","UDC","VG1","X0X","X1X","X2F","X4S","X5S","X6X","XBP","XDN","XDP","XIF","XIM","XLF","XLS","XMM","XUL","XXR","XYP","XYS","YO5","Z3Q","Z6J","Z9M","ZDC","ZDM"],hs=["CA","C","N","O","O1","O2","OC1","OC2","OX1","OXT","OT1","OT2","H","H1","H2","H3","HA","HN","BB"],us=["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"],ds={1:{trace:"CA",direction1:"C",direction2:["O","OC1","O1","OX1","OXT","OT1","OT2"],backboneStart:"N",backboneEnd:"C"},2:{trace:["C4'","C4*"],direction1:["C1'","C1*"],direction2:["C3'","C3*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},3:{trace:["C3'","C3*"],direction1:["C2'","C2*"],direction2:["O4'","O4*"],backboneStart:"P",backboneEnd:["O3'","O3*"]},4:{trace:["CA","BB"],backboneStart:["CA","BB"],backboneEnd:["CA","BB"]},5:{trace:["C4'","C4*","P"],backboneStart:["C4'","C4*","P"],backboneEnd:["C4'","C4*","P"]},6:{trace:["C3'","C3*","C2'","P"],backboneStart:["C3'","C3*","C2'","P"],backboneEnd:["C3'","C3*","C2'","P"]}};ds[Nn]={};const ms={HD:"H",HS:"H",A:"C",NA:"N",NS:"N",OA:"O",OS:"O",SA:"S",G0:"C",G1:"C",G2:"C",G3:"C",CG0:"C",CG1:"C",CG2:"C",CG3:"C",W:"O"};function fs(r){switch(r){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;default:return 8}}const ps=new Map([[2,It(180)],[3,It(120)],[4,It(109.4721)],[6,It(90)]]);function gs(r,e){let t=[];const n=new Vector3,i=new Vector3;return n.subVectors(e,r),r.eachBondedAtom((s=>{s.number!==1&&(i.subVectors(s,r),t.push(n.angleTo(i)))})),t}function ys(r,e){const t=r.clone(),n=new Vector3;n.subVectors(e,r);const i=[new Vector3,new Vector3];let s=0;if(r.eachBondedAtom((a=>{s>1||a.number!==1&&(t.index=a.index,i[s++].subVectors(a,r))})),s===1&&t.eachBondedAtom((a=>{s>1||a.number!==1&&a.index!==r.index&&i[s++].subVectors(a,r)})),s!==2)return;const o=i[0].cross(i[1]);return Math.abs(Math.PI/2-o.angleTo(n))}function bs(r,e){const t=r.structure,n=t.atomCount,i=new Int8Array(n),s=new Int8Array(n),o=new Int8Array(n),a=new Int8Array(n);return t.eachAtom((l=>{const d=l.index,[u,g,x,y]=(function(b,_){const h=b.bondToElementCount(1);let f=b.formalCharge||0;const E=f===0,m=h===0,S=b.bondCount,w=(function(R){let P=0;return R.eachBond((L=>P+=L.bondOrder)),P})(b),v=(function(R){const P=R.structure.getBondProxy(),L=R.number,O=L===8||L===7;if(O&&R.bondCount===4)return!1;let I=!1;return R.eachBond((N=>{if(N.bondOrder>1)I=!0;else if(O){const k=N.getOtherAtom(R);k.eachBond((U=>{if(U.bondOrder>1){const F=k.number;if((F===15||F===16)&&U.getOtherAtom(k).number===8)return;I=!0}}),P)}})),I})(b),A=w-S>0;let M=0,T=8;switch(b.number){case 1:E&&(S===0?(f=1,T=0):S===1&&(f=0,T=1));break;case 6:E&&(f=0),m&&(M=Math.max(0,4-w-Math.abs(f))),T=fs(S+M+Math.max(0,-f));break;case 7:if(E)if(m)if(v&&w<4)f=S-h==1&&w-h==2?1:0;else{let R=!1;b.eachBondedAtom((P=>{(P.number===16||P.isMetal())&&(R=!0)})),f=R?0:1}else f=w-3;m&&(M=Math.max(0,3-w+f)),T=fs(v&&!A?S+M-f:S+M+1-f);break;case 8:E&&(m||(f=w-2),w===1&&b.eachBondedAtom((R=>{R.eachBond((P=>{const L=P.getOtherAtom(R);L.index!==b.index&&L.number===8&&P.bondOrder===2&&(f=-1)}))}))),m&&(M=Math.max(0,2-w+f)),T=fs(v&&!A?S+M-f+1:S+M-f+2);break;case 16:E&&(m||(f=w<=3&&!b.bondToElementCount(8)?w-2:0)),m&&w<2&&(M=Math.max(0,2-w+f)),w<=3&&(T=fs(S+M-f+2));break;case 9:case 17:case 35:case 53:case 85:E&&(f=w-1);break;case 3:case 11:case 19:case 37:case 55:case 87:E&&(f=1-w);break;case 4:case 12:case 20:case 38:case 56:case 88:E&&(f=2-w);break;default:console.warn("Requested charge, protonation for an unhandled element",b.element)}return[f,M,M+h,T]})(l);i[d]=u,s[d]=g,o[d]=x,a[d]=y})),{charge:i,implicitH:s,totalH:o,idealGeometry:a}}function _s(r){if(r["@valenceModel"])return r["@valenceModel"];const e=bs(r);return r["@valenceModel"]=e,e}function xs(r){return r.number===15&&r.bondToElementCount(8)===r.bondCount}const vs=["ARG","HIS","LYS"],ws=["GLU","ASP"];function As(r,e){return r===2&&e===1||r===1&&e===2}function Ss(r,e){return r===3&&e===3}function Cs(r,e){return r===3&&e===1||r===1&&e===3}function Ps(r){return r.resname==="HIS"&&r.number==7&&r.isRing()}function Is(r,e){return r===5&&e===4||r===4&&e===5}function ks(r,e){return r===9&&e===5||r===5&&e===9}const Ms=[3,11,19,37,55,12,20,38,56,13,31,49,81,21,50,82,83,51,80];function Ts(r,e){return r===12?e===11||e===12:r===13?e===10:void 0}const Ds=[17,35,53,85],Bs=[7,8,16],Fs=[6,7,15,16],Es=It(180),$s=It(120);function Os(r,e,t){return!Ls(r,e,t)&&(r.modelIndex!==e.modelIndex||r.altloc&&e.altloc&&r.altloc!==e.altloc)}const Rs={maxHydrophobicDist:4,maxHbondDist:3.5,maxHbondSulfurDist:4.1,maxHbondAccAngle:45,maxHbondDonAngle:45,maxHbondAccPlaneAngle:90,maxHbondDonPlaneAngle:30,maxPiStackingDist:5.5,maxPiStackingOffset:2,maxPiStackingAngle:30,maxCationPiDist:6,maxCationPiOffset:2,maxIonicDist:5,maxHalogenBondDist:4,maxHalogenBondAngle:30,maxMetalDist:3,refineSaltBridges:!0,masterModelIndex:-1,lineOfSightDistFactor:1};function Ls(r,e,t){return r.modelIndex===t&&e.modelIndex!==t||e.modelIndex===t&&r.modelIndex!==t}function Ns(r,e,t){return!Ls(r,e,t)&&(r.modelIndex!==e.modelIndex||r.residueIndex===e.residueIndex||r.altloc&&e.altloc&&r.altloc!==e.altloc)}function zs(r){const e={types:[],groups:[],centers:{x:[],y:[],z:[]},atomSets:[]};return De&&ke.time("calculateFeatures"),(function(t,n){const{charge:i}=_s(t.data),s={};t.eachResidue((o=>{if(vs.includes(o.resname)){const a=On(1);o.eachAtom((l=>{l.number===7&&l.isSidechain()&&Rn(a,l)})),Ln(n,a)}else is.includes(o.resname)||o.isNucleic()||(o.eachAtom((a=>{let l=!1;const d=On(1);(function(u){let g=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===3&&u.eachBondedAtom((x=>{x.bondCount-x.bondToElementCount(1)==1&&++g})),g===2})(a)?(d.group=8,l=!0):(function(u){let g=0;return u.number===6&&u.bondCount===3&&u.bondToElementCount(7)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom((x=>{x.bondCount-x.bondToElementCount(1)==1&&++g})),g===2})(a)&&(d.group=9,l=!0),l&&(a.eachBondedAtom((u=>{u.number===7&&(s[u.index]=!0,Rn(d,u))})),Ln(n,d))})),o.eachAtom((a=>{const l=On(1);i[a.index]>0&&(s[a.index]||(Rn(l,a),Ln(n,l)))})))}))})(r,e),(function(t,n){const{charge:i}=_s(t.data),s={};t.eachResidue((o=>{if(ws.includes(o.resname)){const a=On(2);o.eachAtom((l=>{l.number===8&&l.isSidechain()&&Rn(a,l)})),Ln(n,a)}else if(os.includes(o.resname)){const a=On(2);o.eachAtom((l=>{xs(l)&&(a.group=6,l.eachBondedAtom((d=>{d.number===8&&Rn(a,d)})),Ln(n,a))}))}else is.includes(o.resname)||os.includes(o.resname)||(o.eachAtom((a=>{let l=!1;const d=On(2);(function(u){return u.number===16&&u.bondToElementCount(8)===3})(a)?(d.group=4,l=!0):xs(a)?(d.group=6,l=!0):(function(u){return u.number===16&&u.bondToElementCount(8)===4})(a)?(d.group=5,l=!0):(function(u){let g=0;return u.number===6&&u.bondToElementCount(8)===2&&u.bondToElementCount(6)===1&&u.eachBondedAtom((x=>{x.number===8&&x.bondCount-x.bondToElementCount(1)==1&&++g})),g===2})(a)&&(d.group=10,l=!0),l&&(a.eachBondedAtom((u=>{u.number===8&&(s[u.index]=!0,Rn(d,u))})),Ln(n,d))})),o.eachAtom((a=>{const l=On(2);i[a.index]<0&&(s[a.index]||(Rn(l,a),Ln(n,l)))})))}))})(r,e),(function(t,n){const i=t.getAtomProxy();t.eachResidue((s=>{const o=s.getAromaticRings();if(o){const a=s.atomOffset;o.forEach((l=>{const d=On(3);l.forEach((u=>{i.index=u+a,Rn(d,i)})),Ln(n,d)}))}}))})(r,e),(function(t,n){const{charge:i,implicitH:s,idealGeometry:o}=_s(t.data);t.eachAtom((a=>{const l=On(5),d=a.number;if(d===8)Rn(l,a),Ln(n,l);else if(d===7){if(Ps(a))Rn(l,a),Ln(n,l);else if(i[a.index]<1){const u=a.bondCount+s[a.index],g=o[a.index];(g===4&&u<4||g===3&&u<3||g===2&&u<2)&&(Rn(l,a),Ln(n,l))}}else d===16&&(a.resname!=="CYS"&&a.resname!=="MET"&&a.formalCharge!==-1||(Rn(l,a),Ln(n,l)))}))})(r,e),(function(t,n){const{totalH:i}=_s(t.data);t.eachAtom((s=>{const o=On(4),a=s.number;(Ps(s)||i[s.index]>0&&(a===7||a===8||a===16))&&(Rn(o,s),Ln(n,o))}))})(r,e),(function(t,n){const{totalH:i}=_s(t.data);t.eachAtom((s=>{if(s.number===6&&i[s.index]>0&&(s.bondToElementCount(7)>0||s.bondToElementCount(8)>0||(function(o){if(!o.isAromatic())return!1;const a=o.residueType.getRings();if(!a)return!1;let l=!1;return a.rings.forEach((d=>{l||d.some((u=>o.index-o.residueAtomOffset===u))&&(l=d.some((u=>{const g=o.residueType.atomTypeIdList[u],x=o.atomMap.get(g).number;return x===7||x===8})))})),l})(s))){const o=On(9);Rn(o,s),Ln(n,o)}}))})(r,e),(function(t,n){t.eachAtom((i=>{let s=!1,o=!1;const a=is.includes(i.resname),l=os.includes(i.resname);if(a||l?a?i.number===8?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(i.resname)&&i.isSidechain()||i.isBackbone())&&(s=!0,o=!0):i.number===16&&i.resname==="CYS"?(s=!0,o=!0):i.number===7&&i.resname==="HIS"&&i.isSidechain()&&(s=!0):l&&(i.number===8&&i.isBackbone()?(s=!0,o=!0):["N3","N4","N7"].includes(i.atomname)?s=!0:["O2","O4","O6"].includes(i.atomname)&&(s=!0,o=!0)):i.isHalogen()||i.number===8||i.number===16?(s=!0,o=!0):i.number===7&&(s=!0),s){const d=On(11);Rn(d,i),Ln(n,d)}if(o){const d=On(10);Rn(d,i),Ln(n,d)}}))})(r,e),(function(t,n){t.eachAtom((i=>{if(i.isTransitionMetal()||i.number===30||i.number===48){const s=On(12);Rn(s,i),Ln(n,s)}else if(Ms.includes(i.number)){const s=On(13);Rn(s,i),Ln(n,s)}}))})(r,e),(function(t,n){t.eachAtom((i=>{const s=On(8);let o=!1;i.number===6?(o=!0,i.eachBondedAtom((a=>{const l=a.number;l!==6&&l!==1&&(o=!1)}))):i.number===9&&(o=!0),o&&(Rn(s,i),Ln(n,s))}))})(r,e),(function(t,n){t.eachAtom((i=>{if(Bs.includes(i.number)){let s=!1;if(i.eachBondedAtom((o=>{Fs.includes(o.number)&&(s=!0)})),s){const o=On(7);Rn(o,i),Ln(n,o)}}}))})(r,e),(function(t,n){t.eachAtom((i=>{if(Ds.includes(i.number)&&i.bondToElementCount(6)===1){const s=On(6);Rn(s,i),Ln(n,s)}}))})(r,e),De&&ke.timeEnd("calculateFeatures"),e}function Us(r,e=Rs){const t=(function(i){const{types:s,centers:o}=i;return{features:i,spatialHash:new Tn(o),contactStore:new Bn,featureSet:new En(s.length,!1)}})(zs(r));De&&ke.time("calculateContacts"),(function(i,s,o={}){const a=nt(o.maxIonicDist,Rs.maxIonicDist),l=nt(o.maxPiStackingDist,Rs.maxPiStackingDist),d=nt(o.maxPiStackingOffset,Rs.maxPiStackingOffset),u=nt(o.maxPiStackingAngle,Rs.maxPiStackingAngle),g=nt(o.maxCationPiDist,Rs.maxCationPiDist),x=nt(o.maxCationPiOffset,Rs.maxCationPiOffset),y=nt(o.masterModelIndex,Rs.masterModelIndex),b=Math.max(a+2,l,g),_=l*l,h=g*g,{features:f,spatialHash:E,contactStore:m,featureSet:S}=s,{types:w,centers:v,atomSets:A}=f,{x:M,y:T,z:R}=v,P=w.length,L=i.atomStore.x,O=i.atomStore.y,I=i.atomStore.z,N=i.getAtomProxy(),k=i.getAtomProxy(),U=function(J,et,ht){const er=J.length,tr=et.length;for(let Hm=0;Hm<er;++Hm){N.index=J[Hm];for(let oi=0;oi<tr;++oi)if(k.index=et[oi],N.distanceTo(k)<=ht)return!0}return!1},F=new Vector3,j=new Vector3,H=new Vector3,B=new Vector3,V=new Vector3,K=new Vector3,q=new Vector3,Te=function(J,et){F.set(L[J[0]],O[J[0]],I[J[0]]),j.set(L[J[1]],O[J[1]],I[J[1]]),H.set(L[J[2]],O[J[2]],I[J[2]]),B.subVectors(F,j),V.subVectors(F,H),et.crossVectors(B,V)},Fe=function(J,et,ht){return F.set(M[J],T[J],R[J]),j.set(M[et],T[et],R[et]),F.sub(j).projectOnPlane(ht).add(j).distanceTo(j)},We=function(J,et,ht){S.setBits(J,et),m.addContact(J,et,ht)};for(let J=0;J<P;++J)E.eachWithin(M[J],T[J],R[J],b,((et,ht)=>{if(et<=J||(N.index=A[J][0],k.index=A[et][0],Ns(N,k,y)))return;const er=w[J],tr=w[et];if(As(er,tr))U(A[J],A[et],a)&&We(J,et,1);else if(Ss(er,tr)){if(ht<=_){Te(A[J],K),Te(A[et],q);const Hm=57.29578*K.angleTo(q);Math.min(Fe(J,et,q),Fe(et,J,K))<=d&&(Hm<=u||Hm>=180-u||Hm<=u+90&&Hm>=90-u)&&We(J,et,3)}}else if(Cs(er,tr)&&ht<=h){const[Hm,oi]=er===3?[J,et]:[et,J];Te(A[Hm],K),Fe(oi,Hm,K)<=x&&We(Hm,oi,2)}}))})(r,t,e),(function(i,s,o={}){const a=nt(o.maxHbondDist,Rs.maxHbondDist),l=nt(o.maxHbondSulfurDist,Rs.maxHbondSulfurDist),d=It(nt(o.maxHbondAccAngle,Rs.maxHbondAccAngle)),u=It(nt(o.maxHbondDonAngle,Rs.maxHbondDonAngle)),g=It(nt(o.maxHbondAccPlaneAngle,Rs.maxHbondAccPlaneAngle)),x=It(nt(o.maxHbondDonPlaneAngle,Rs.maxHbondDonPlaneAngle)),y=nt(o.masterModelIndex,Rs.masterModelIndex),b=Math.max(a,l),_=a*a,{features:h,spatialHash:f,contactStore:E,featureSet:m}=s,{types:S,centers:w,atomSets:v}=h,{x:A,y:M,z:T}=w,R=S.length,{idealGeometry:P}=_s(i.data),L=i.getAtomProxy(),O=i.getAtomProxy();for(let I=0;I<R;++I)f.eachWithin(A[I],M[I],T[I],b,((N,k)=>{if(N<=I)return;const U=S[I],F=S[N],j=ks(U,F);if(!j&&!Is(U,F))return;const[H,B]=F===5?[I,N]:[N,I];if(L.index=v[H][0],O.index=v[B][0],O.index===L.index||Ns(L,O,y)||L.number!==16&&O.number!==16&&k>_||L.connectedTo(O))return;const V=gs(L,O),K=ps.get(P[L.index])||It(120);if(V.some((et=>Math.abs(K-et)>u)))return;if(P[L.index]===3){const et=ys(L,O);if(et!==void 0&&et>x)return}const q=gs(O,L),Te=ps.get(P[O.index])||It(120);if(q.some((et=>Te-et>d)))return;if(P[O.index]===3){const et=ys(O,L);if(et!==void 0&&et>g)return}m.setBits(H,B);const Fe=j?8:(function(et,ht){return et.isWater()&&ht.isWater()})(We=L,J=O)?9:(function(et,ht){return et.isBackbone()&&ht.isBackbone()})(We,J)?10:4;var We,J;E.addContact(H,B,Fe)}))})(r,t,e),(function(i,s,o={}){const a=nt(o.maxMetalDist,Rs.maxMetalDist),l=nt(o.masterModelIndex,Rs.masterModelIndex),{features:d,spatialHash:u,contactStore:g,featureSet:x}=s,{types:y,centers:b,atomSets:_}=d,{x:h,y:f,z:E}=b,m=y.length,S=i.getAtomProxy(),w=i.getAtomProxy();for(let v=0;v<m;++v)u.eachWithin(h[v],f[v],E[v],a,((A,M)=>{if(A<=v||(S.index=_[v][0],w.index=_[A][0],Ns(S,w,l)))return;const T=S.isMetal(),R=w.isMetal();if(!T&&!R)return;const[P,L]=T?[y[v],y[A]]:[y[A],y[v]];Ts(P,L)&&(x.setBits(v,A),g.addContact(v,A,7))}))})(r,t,e),(function(i,s,o={}){const a=nt(o.maxHydrophobicDist,Rs.maxHydrophobicDist),l=nt(o.masterModelIndex,Rs.masterModelIndex),{features:d,spatialHash:u,contactStore:g,featureSet:x}=s,{types:y,centers:b,atomSets:_}=d,{x:h,y:f,z:E}=b,m=y.length,S=i.getAtomProxy(),w=i.getAtomProxy();for(let v=0;v<m;++v)u.eachWithin(h[v],f[v],E[v],a,((A,M)=>{var T,R;A<=v||(S.index=_[v][0],w.index=_[A][0],Ns(S,w,l)||S.number===9&&w.number===9||S.connectedTo(w)||(T=y[v],R=y[A],T===8&&R===8&&(x.setBits(v,A),g.addContact(v,A,6))))}))})(r,t,e),(function(i,s,o={}){const a=nt(o.maxHalogenBondDist,Rs.maxHalogenBondDist),l=It(nt(o.maxHalogenBondAngle,Rs.maxHalogenBondAngle)),d=nt(o.masterModelIndex,Rs.masterModelIndex),{features:u,spatialHash:g,contactStore:x,featureSet:y}=s,{types:b,centers:_,atomSets:h}=u,{x:f,y:E,z:m}=_,S=b.length,w=i.getAtomProxy(),v=i.getAtomProxy();for(let A=0;A<S;++A)g.eachWithin(f[A],E[A],m[A],a,((M,T)=>{if(M<=A||(w.index=h[A][0],v.index=h[M][0],Ns(w,v,d))||(R=b[A],P=b[M],!(R===7&&P===6||R===6&&P===7)))return;var R,P;const[L,O]=b[A]===6?[w,v]:[v,w],I=gs(L,O);if(I.length!==1||Es-I[0]>l)return;const N=gs(O,L);N.length!==0&&(N.some((k=>$s-k>l))||(y.setBits(A,M),x.addContact(A,M,5)))}))})(r,t,e);const n=(function(i){const{index1:s,index2:o,count:a}=i.contactStore,l=$n({nodeArray1:s,nodeArray2:o,edgeCount:a,nodeCount:i.featureSet.length}),d=new En(i.contactStore.count,!0);return Object.assign({adjacencyList:l,contactSet:d},i)})(t);return(function(i,s,o={}){De&&ke.time("refineLineOfSight");const a=nt(o.lineOfSightDistFactor,Rs.lineOfSightDistFactor),l=nt(o.masterModelIndex,Rs.masterModelIndex),d=i.spatialHash,{contactSet:u,contactStore:g,features:x}=s,{index1:y,index2:b}=g,{centers:_,atomSets:h}=x,{x:f,y:E,z:m}=_,S=i.getAtomProxy(),w=i.getAtomProxy(),v=i.getAtomProxy(),A=new Vector3,M=new Vector3,T=3*a,R=a*a;u.forEach((P=>{A.set(f[y[P]],E[y[P]],m[y[P]]),M.set(f[b[P]],E[b[P]],m[b[P]]);const L=(A.x+M.x)/2,O=(A.y+M.y)/2,I=(A.z+M.z)/2,N=h[y[P]],k=h[b[P]];S.index=N[0],w.index=k[0],d.eachWithin(L,O,I,T,((U,F)=>{v.index=U,v.number!==1&&v.vdw*v.vdw*R>F&&!Os(S,v,l)&&!Os(w,v,l)&&!N.includes(U)&&!k.includes(U)&&A.distanceToSquared(v)>1&&M.distanceToSquared(v)>1&&(u.clear(P),De&&ke.log("removing",S.qualifiedName(),w.qualifiedName(),"because",v.qualifiedName()))}))})),De&&ke.timeEnd("refineLineOfSight")})(r,n,e),(function(i,s){const{contactSet:o,contactStore:a,features:l}=s,{type:d,index1:u,index2:g}=a,{atomSets:x}=l,y=i.getAtomProxy(),b=i.getAtomProxy(),_={},h=function(f,E,m){const[S,w]=_[m]||[1/0,-1];f<S?(w!==-1&&o.clear(w),_[m]=[f,E]):o.clear(E)};o.forEach((f=>{if(d[f]!==6)return;y.index=x[u[f]][0],b.index=x[g[f]][0];const E=y.distanceTo(b);h(E,f,`${y.index}|${b.residueIndex}`),h(E,f,`${b.index}|${y.residueIndex}`)}))})(r,n),e.refineSaltBridges&&(function(i,s){const{contactSet:o,contactStore:a,features:l}=s,{type:d,index1:u,index2:g}=a,{atomSets:x}=l,y={},b=function(_,h){y[_]||(y[_]=[]),y[_].push(h)};o.forEach((_=>{d[_]===1&&(x[u[_]].forEach((h=>b(h,_))),x[g[_]].forEach((h=>b(h,_))))})),o.forEach((_=>{if(!(function(m){return m===4||m===9||m===10})(d[_]))return;const h=y[x[u[_]][0]],f=y[x[g[_]][0]];if(!h||!f)return;const E=h.length;for(let m=0;m<E;++m)if(f.includes(h[m]))return void o.clear(_)}))})(0,n),(function(i,s){const{contactSet:o,contactStore:a,features:l}=s,{type:d,index1:u,index2:g}=a,{atomSets:x}=l,y={},b=function(_,h){y[_]||(y[_]=[]),y[_].push(h)};o.forEach((_=>{d[_]===3&&(x[u[_]].forEach((h=>b(h,_))),x[g[_]].forEach((h=>b(h,_))))})),o.forEach((_=>{if(d[_]!==6&&d[_]!==2)return;const h=y[x[u[_]][0]],f=y[x[g[_]][0]];if(!h||!f)return;const E=h.length;for(let m=0;m<E;++m)if(f.includes(h[m]))return void o.clear(_)}))})(0,n),(function(i,s){const{contactSet:o,contactStore:a,features:l}=s,{type:d,index1:u,index2:g}=a,{atomSets:x}=l,y={},b=function(_,h){y[_]||(y[_]=[]),y[_].push(h)};o.forEach((_=>{d[_]===1&&(x[u[_]].forEach((h=>b(h,_))),x[g[_]].forEach((h=>b(h,_))))})),o.forEach((_=>{if(d[_]!==7)return;const h=y[x[u[_]][0]],f=y[x[g[_]][0]];if(!h||!f)return;const E=h.length;for(let m=0;m<E;++m)if(f.includes(h[m]))return void o.clear(h[m])}))})(0,n),De&&ke.timeEnd("calculateContacts"),n}function Vs(r){switch(r){case 4:case 9:case 10:return"hydrogen bond";case 6:return"hydrophobic contact";case 5:return"halogen bond";case 1:return"ionic interaction";case 7:return"metal coordination";case 2:return"cation-pi interaction";case 3:return"pi-pi stacking";case 8:return"weak hydrogen bond";default:return"unknown contact"}}const js={hydrogenBond:!0,hydrophobic:!0,halogenBond:!0,ionicInteraction:!0,metalCoordination:!0,cationPi:!0,piStacking:!0,weakHydrogenBond:!0,waterHydrogenBond:!0,backboneHydrogenBond:!0,radius:1,filterSele:""},Gs=new Color;function Hs(r,e,t){const n=st(t,js),i=[];n.hydrogenBond&&i.push(4),n.hydrophobic&&i.push(6),n.halogenBond&&i.push(5),n.ionicInteraction&&i.push(1),n.metalCoordination&&i.push(7),n.cationPi&&i.push(2),n.piStacking&&i.push(3),n.weakHydrogenBond&&i.push(8),n.waterHydrogenBond&&i.push(9),n.backboneHydrogenBond&&i.push(10);const{features:s,contactSet:o,contactStore:a}=r,{centers:l,atomSets:d}=s,{x:u,y:g,z:x}=l,{index1:y,index2:b,type:_}=a,h=[],f=[],E=[],m=[],S=[];let w;return n.filterSele&&(w=Array.isArray(n.filterSele)?n.filterSele.map((v=>e.getAtomSet(new me(v)))):e.getAtomSet(new me(n.filterSele))),o.forEach((v=>{const A=_[v];if(!i.includes(A))return;if(w){const R=d[y[v]][0],P=d[b[v]][0];if(Array.isArray(w)){if(!(w[0].isSet(R)&&w[1].isSet(P)||w[1].isSet(R)&&w[0].isSet(P)))return}else if(!w.isSet(R)&&!w.isSet(P))return}const M=y[v],T=b[v];h.push(u[M],g[M],x[M]),f.push(u[T],g[T],x[T]),E.push(...(function(R){switch(R){case 4:case 9:case 10:return Gs.setHex(2851770).toArray();case 6:return Gs.setHex(8421504).toArray();case 5:return Gs.setHex(4259775).toArray();case 1:return Gs.setHex(15779860).toArray();case 7:return Gs.setHex(9191577).toArray();case 2:return Gs.setHex(16744448).toArray();case 3:return Gs.setHex(9220966).toArray();case 8:return Gs.setHex(12967404).toArray();default:return Gs.setHex(13421772).toArray()}})(A)),m.push(n.radius),S.push(v)})),{position1:new Float32Array(h),position2:new Float32Array(f),color:new Float32Array(E),color2:new Float32Array(E),radius:new Float32Array(m),picking:new Zs(S,r,e)}}class qs{constructor(e){this.array=e}get type(){return""}get data(){return{}}getIndex(e){return this.array?this.array[e]:e}getObject(e){return{}}_applyTransformations(e,t,n){return t&&e.applyMatrix4(t.matrix),n&&e.applyMatrix4(n.matrix),e}_getPosition(e){return new Vector3}getPosition(e,t,n){return this._applyTransformations(this._getPosition(e),t,n)}}class Ws extends qs{constructor(e){super(),this.shape=e}get primitive(){}get data(){return this.shape}get type(){return this.primitive.type}getObject(e){return this.primitive.objectFromShape(this.shape,this.getIndex(e))}_getPosition(e){return this.primitive.positionFromShape(this.shape,this.getIndex(e))}}class Xs extends qs{constructor(e,t){super(e),this.structure=t}get type(){return"atom"}get data(){return this.structure}getObject(e){return this.structure.getAtomProxy(this.getIndex(e))}_getPosition(e){return new Vector3().copy(this.getObject(e))}}class Ys extends qs{constructor(e){super(),this.axes=e}get type(){return"axes"}get data(){return this.axes}getObject(){return{axes:this.axes}}_getPosition(){return this.axes.center.clone()}}class Ks extends qs{constructor(e,t,n){super(e),this.structure=t,this.bondStore=n||t.bondStore}get type(){return"bond"}get data(){return this.structure}getObject(e){const t=this.structure.getBondProxy(this.getIndex(e));return t.bondStore=this.bondStore,t}_getPosition(e){const t=this.getObject(e);return new Vector3().copy(t.atom1).add(t.atom2).multiplyScalar(.5)}}class Zs extends qs{constructor(e,t,n){super(e),this.contacts=t,this.structure=n}get type(){return"contact"}get data(){return this.contacts}getObject(e){const t=this.getIndex(e),{features:n,contactStore:i}=this.contacts,{centers:s,atomSets:o}=n,{x:a,y:l,z:d}=s,{index1:u,index2:g,type:x}=i,y=u[t],b=g[t];return{center1:new Vector3(a[y],l[y],d[y]),center2:new Vector3(a[b],l[b],d[b]),atom1:this.structure.getAtomProxy(o[y][0]),atom2:this.structure.getAtomProxy(o[b][0]),type:Vs(x[t])}}_getPosition(e){const{center1:t,center2:n}=this.getObject(e);return new Vector3().addVectors(t,n).multiplyScalar(.5)}}class Qs extends qs{constructor(e,t,n){super(e),this.validation=t,this.structure=n}get type(){return"clash"}get data(){return this.validation}getObject(e){const t=this.validation,n=this.getIndex(e);return{validation:t,index:n,clash:t.clashArray[n]}}_getAtomProxyFromSele(e){const t=new me(e),n=this.structure.getAtomIndices(t)[0];return this.structure.getAtomProxy(n)}_getPosition(e){const t=this.getObject(e).clash,n=this._getAtomProxyFromSele(t.sele1),i=this._getAtomProxyFromSele(t.sele2);return new Vector3().copy(n).add(i).multiplyScalar(.5)}}class Js extends Ks{get type(){return"distance"}}class to extends qs{get type(){return"ignore"}}class eo extends Ws{constructor(e,t){super(e),this.mesh=t}get type(){return"mesh"}getObject(){const e=this.mesh;return{shape:this.shape,name:e.name,serial:e.serial}}_getPosition(){return this.__position||(this.__position=Vr(this.mesh.position)),this.__position}}class io extends qs{constructor(e,t){super(e),this.surface=t}get type(){return"surface"}get data(){return this.surface}getObject(e){return{surface:this.surface,index:this.getIndex(e)}}_getPosition(){return this.surface.center.clone()}}class ro extends qs{constructor(e,t){super(),this.unitcell=e,this.structure=t}get type(){return"unitcell"}get data(){return this.unitcell}getObject(){return{unitcell:this.unitcell,structure:this.structure}}_getPosition(){return this.unitcell.getCenter(this.structure)}}class no extends qs{constructor(e,t){super(e),this.volume=t}get type(){return"volume"}get data(){return this.volume}getObject(e){const t=this.volume,n=this.getIndex(e);return{volume:t,index:n,value:t.data[n]}}_getPosition(e){const t=this.volume.position,n=this.getIndex(e);return new Vector3(t[3*n],t[3*n+1],t[3*n+2])}}class so extends no{get type(){return"slice"}}function oo(){return new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0])}function ao(){return new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}function co(r,e,t,n,i){var s,o,a,l,d,u,g,x=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]],y=0,b=!1,_=!1,h=!1,f=!1,E=-1,m=e*t*n,S=e,w=e*t,v=new Int32Array(12),A=[],M=[],T=[],R=[],P=oo(),L=ao();function O(B,V,K){return B+(V-B)*K}function I(B,V,K){return w*(K=(K+g)%n)+S*(V=(V+u)%t)+(B=(B+d)%e)}function N(B,V,K,q,Te,Fe,We){var J=3*B;if(o[J]<0){var et=(y-Fe)/(We-Fe),ht=s,er=3*a;if(A[er]=K+et,A[er+1]=q,A[er+2]=Te,!b){var tr=3*B;M[er]=E*O(ht[tr],ht[tr+3],et),M[er+1]=E*O(ht[tr+1],ht[tr+4],et),M[er+2]=E*O(ht[tr+2],ht[tr+5],et)}i&&(R[a]=i[B+Math.round(et)]),o[J]=a,v[V]=a,a+=1}else v[V]=o[J]}function k(B,V,K,q,Te,Fe,We){var J=3*B+1;if(o[J]<0){var et=(y-Fe)/(We-Fe),ht=s,er=3*a;if(A[er]=K,A[er+1]=q+et,A[er+2]=Te,!b){var tr=3*B,Hm=tr+3*S;M[er]=E*O(ht[tr],ht[Hm],et),M[er+1]=E*O(ht[tr+1],ht[Hm+1],et),M[er+2]=E*O(ht[tr+2],ht[Hm+2],et)}i&&(R[a]=i[B+Math.round(et)*S]),o[J]=a,v[V]=a,a+=1}else v[V]=o[J]}function U(B,V,K,q,Te,Fe,We){var J=3*B+2;if(o[J]<0){var et=(y-Fe)/(We-Fe),ht=s,er=3*a;if(A[er]=K,A[er+1]=q,A[er+2]=Te+et,!b){var tr=3*B,Hm=tr+3*w;M[er]=E*O(ht[tr],ht[Hm],et),M[er+1]=E*O(ht[tr+1],ht[Hm+1],et),M[er+2]=E*O(ht[tr+2],ht[Hm+2],et)}i&&(R[a]=i[B+Math.round(et)*w]),o[J]=a,v[V]=a,a+=1}else v[V]=o[J]}function F(B){var V=3*B;s[V]===0&&(s[V]=r[(B-1+m)%m]-r[(B+1)%m],s[V+1]=r[(B-S+m)%m]-r[(B+S)%m],s[V+2]=r[(B-w+m)%m]-r[(B+w)%m])}function j(B,V,K,q,Te){var Fe,We,J,et,ht,er,tr;h?(q=I(B,V,K),Fe=I(B+1,V,K),We=I(B,V+1,K),J=I(B,V,K+1),et=I(B+1,V+1,K),ht=I(B+1,V,K+1),er=I(B,V+1,K+1),tr=I(B+1,V+1,K+1)):(Fe=q+1,et=(We=q+S)+1,ht=(J=q+w)+1,tr=(er=We+w)+1);var Hm=0,oi=r[q],h0=r[Fe],l0=r[We],M0=r[et],U0=r[J],_0=r[ht],C0=r[er],P0=r[tr];oi<y&&(Hm|=1),h0<y&&(Hm|=2),l0<y&&(Hm|=8),M0<y&&(Hm|=4),U0<y&&(Hm|=16),_0<y&&(Hm|=32),C0<y&&(Hm|=128),P0<y&&(Hm|=64);var R0=P[Hm];if(R0===0)return 0;var si=B+1,Xe=V+1,d0=K+1;1&R0&&(b||(F(q),F(Fe)),N(q,0,B,V,K,oi,h0)),2&R0&&(b||(F(Fe),F(et)),k(Fe,1,si,V,K,h0,M0)),4&R0&&(b||(F(We),F(et)),N(We,2,B,Xe,K,l0,M0)),8&R0&&(b||(F(q),F(We)),k(q,3,B,V,K,oi,l0)),16&R0&&(b||(F(J),F(ht)),N(J,4,B,V,d0,U0,_0)),32&R0&&(b||(F(ht),F(tr)),k(ht,5,si,V,d0,_0,P0)),64&R0&&(b||(F(er),F(tr)),N(er,6,B,Xe,d0,C0,P0)),128&R0&&(b||(F(J),F(er)),k(J,7,B,V,d0,U0,C0)),256&R0&&(b||(F(q),F(J)),U(q,8,B,V,K,oi,U0)),512&R0&&(b||(F(Fe),F(ht)),U(Fe,9,si,V,K,h0,_0)),1024&R0&&(b||(F(et),F(tr)),U(et,10,si,Xe,K,M0,P0)),2048&R0&&(b||(F(We),F(er)),U(We,11,B,Xe,K,l0,C0));for(var w0,Q,it,ec=Hm<<4,a0=0;L[ec+a0]!==-1;)w0=L[ec+a0],Q=L[ec+a0+1],it=L[ec+a0+2],_?(x[w0][Q]&Te&&(T[l++]=v[w0],T[l++]=v[Q]),x[Q][it]&Te&&(T[l++]=v[Q],T[l++]=v[it]),x[w0][it]&Te&&(T[l++]=v[w0],T[l++]=v[it])):(T[l++]=v[f?w0:Q],T[l++]=v[f?Q:w0],T[l++]=v[it]),a0+=3}function H(B,V,K,q,Te,Fe){let We,J,et,ht,er,tr,Hm,oi,h0,l0,M0,U0,_0;if(B=B!==void 0?B:0,V=V!==void 0?V:0,K=K!==void 0?K:0,q=q!==void 0?q:e-1,Te=Te!==void 0?Te:t-1,Fe=Fe!==void 0?Fe:n-1,h||(b?(B=Math.max(0,B),V=Math.max(0,V),K=Math.max(0,K),q=Math.min(e-1,q),Te=Math.min(t-1,Te),Fe=Math.min(n-1,Fe)):(B=Math.max(1,B),V=Math.max(1,V),K=Math.max(1,K),q=Math.min(e-2,q),Te=Math.min(t-2,Te),Fe=Math.min(n-2,Fe))),h)for(oi=B-2,h0=V-2,l0=K-2,M0=q+2,U0=Te+2,_0=Fe+2,er=l0;er<_0;++er)for(ht=h0;ht<U0;++ht)for(et=oi;et<M0;++et)J=3*I(et,ht,er),o[J]=-1,o[J+1]=-1,o[J+2]=-1;else for(oi=Math.max(0,B-2),h0=Math.max(0,V-2),l0=Math.max(0,K-2),M0=Math.min(e,q+2),U0=Math.min(t,Te+2),_0=Math.min(n,Fe+2),er=l0;er<_0;++er)for(Hm=w*er,ht=h0;ht<U0;++ht)for(tr=Hm+S*ht,et=oi;et<M0;++et)We=3*(tr+et),o[We]=-1,o[We+1]=-1,o[We+2]=-1;if(!h){var C0,P0=B,R0=V,si=K,Xe=q,d0=Te,w0=Fe;for(C0=!1,er=K;er<Fe;++er){for(ht=V;ht<Te;++ht){for(et=B;et<q;++et)if(We=e*t*er+e*ht+et,r[We]>=y){si=er,C0=!0;break}if(C0)break}if(C0)break}for(C0=!1,ht=V;ht<Te;++ht){for(er=si;er<Fe;++er){for(et=B;et<q;++et)if(We=e*t*er+e*ht+et,r[We]>=y){R0=ht,C0=!0;break}if(C0)break}if(C0)break}for(C0=!1,et=B;et<q;++et){for(ht=R0;ht<Te;++ht){for(er=si;er<Fe;++er)if(We=e*t*er+e*ht+et,r[We]>=y){P0=et,C0=!0;break}if(C0)break}if(C0)break}for(C0=!1,er=Fe;er>=K;--er){for(ht=Te;ht>=V;--ht){for(et=q;et>=B;--et)if(We=e*t*er+e*ht+et,r[We]>=y){w0=er,C0=!0;break}if(C0)break}if(C0)break}for(C0=!1,ht=Te;ht>=V;--ht){for(er=w0;er>=K;--er){for(et=q;et>=B;--et)if(We=e*t*er+e*ht+et,r[We]>=y){d0=ht,C0=!0;break}if(C0)break}if(C0)break}for(C0=!1,et=q;et>=B;--et){for(ht=d0;ht>=V;--ht){for(er=w0;er>=K;--er)if(We=e*t*er+e*ht+et,r[We]>=y){Xe=et,C0=!0;break}if(C0)break}if(C0)break}b?(B=Math.max(0,P0-1),V=Math.max(0,R0-1),K=Math.max(0,si-1),q=Math.min(e-1,Xe+1),Te=Math.min(t-1,d0+1),Fe=Math.min(n-1,w0+1)):(B=Math.max(1,P0-1),V=Math.max(1,R0-1),K=Math.max(1,si-1),q=Math.min(e-2,Xe+1),Te=Math.min(t-2,d0+1),Fe=Math.min(n-2,w0+1))}var Q=15;for(er=K;er<Fe;++er,Q&=-5)for(Hm=w*er,Q|=2,ht=V;ht<Te;++ht,Q&=-3)for(tr=Hm+S*ht,Q|=1,et=B;et<q;++et,Q&=-2)We=tr+et,j(et,ht,er,We,Q)}this.triangulate=function(B,V,K,q,Te){f=(y=B)<0,_=q,h=Te,(b=V||_)||(E=y>0?-1:1,s||(s=new Float32Array(3*m)));var Fe=3*m;if(o&&o.length===Fe||(o=new Int32Array(Fe)),a=0,l=0,K!==void 0){var We=K[0].map(Math.round),J=K[1].map(Math.round);d=e*Math.ceil(Math.abs(We[0])/e),u=t*Math.ceil(Math.abs(We[1])/t),g=n*Math.ceil(Math.abs(We[2])/n),H(We[0],We[1],We[2],J[0],J[1],J[2])}else d=u=g=0,H();return A.length=3*a,b||(M.length=3*a),T.length=l,i&&(R.length=a),{position:new Float32Array(A),normal:b?void 0:new Float32Array(M),index:bt(T,A.length/3),atomindex:i?new Int32Array(R):void 0,contour:_}}}Ge.add("arrow",class extends Ws{get primitive(){return An}}),Ge.add("box",class extends Ws{get primitive(){return _n}}),Ge.add("cone",class extends Ws{get primitive(){return Sn}}),Ge.add("cylinder",class extends Ws{get primitive(){return wn}}),Ge.add("ellipsoid",class extends Ws{get primitive(){return Cn}}),Ge.add("octahedron",class extends Ws{get primitive(){return xn}}),Ge.add("sphere",class extends Ws{get primitive(){return bn}}),Ge.add("tetrahedron",class extends Ws{get primitive(){return vn}}),Ge.add("torus",class extends Ws{get primitive(){return Pn}}),Ge.add("point",class extends Ws{get primitive(){return kn}}),Ge.add("wideline",class extends Ws{get primitive(){return Mn}}),Object.assign(co,{__deps:[oo,ao,bt]});class lo{constructor(e,t){this.cols=e,this.rows=t,this.size=this.cols*this.rows,this.data=new Float32Array(this.size)}copyTo(e){e.data.set(this.data)}}function ho(r,e){let t=0,n=0;const i=e.rows,s=e.cols;let o=0,a=0,l=0;const d=e.data,u=r.data;for(;t<i;a+=1,o+=s,t++)for(l=a,n=0;n<s;l+=i,n++)u[l]=d[o+n]}function uo(r,e,t){let n=0,i=0,s=0,o=0,a=0,l=0,d=0;const u=e.cols,g=e.rows,x=t.rows,y=e.data,b=t.data,_=r.data;let h=0;for(;n<g;o+=u,n++)for(l=0,i=0;i<x;d++,i++){for(a=o,h=0,s=0;s<u;a++,l++,s++)h+=y[a]*b[l];_[d]=h}}function mo(r,e,t){const n=r.data,i=e.data,s=t.data,o=i[0],a=i[1],l=i[2],d=i[3],u=i[4],g=i[5],x=i[6],y=i[7],b=i[8],_=s[0],h=s[1],f=s[2],E=s[3],m=s[4],S=s[5],w=s[6],v=s[7],A=s[8];n[0]=o*_+a*E+l*w,n[1]=o*h+a*m+l*v,n[2]=o*f+a*S+l*A,n[3]=d*_+u*E+g*w,n[4]=d*h+u*m+g*v,n[5]=d*f+u*S+g*A,n[6]=x*_+y*E+b*w,n[7]=x*h+y*m+b*v,n[8]=x*f+y*S+b*A}function fo(r){const e=r.rows,t=r.cols,n=r.data,i=new Array(t);for(let s=0;s<t;++s)i[s]=0;for(let s=0,o=0;s<e;++s)for(let a=0;a<t;++a,++o)i[a]+=n[o];for(let s=0;s<t;++s)i[s]/=e;return i}function po(r,e){const t=r.rows,n=r.cols,i=r.data;for(let s=0,o=0;s<t;++s)for(let a=0;a<n;++a,++o)i[o]-=e[a]}function go(r,e,t,n){n=r[e],r[e]=r[t],r[t]=n}function yo(r,e){return(r=Math.abs(r))>(e=Math.abs(e))?(e/=r,r*Math.sqrt(1+e*e)):e>0?(r/=e,e*Math.sqrt(1+r*r)):0}const bo=1192092896e-16,_o=1e-37;function xo(r,e,t,n){let i=0,s=0;const o=r.rows,a=r.cols;let l=o,d=a;l<d&&(i=1,s=l,l=d,d=s);const u=new lo(l,l),g=new lo(1,d),x=new lo(d,d);if(i===0)ho(u,r);else{for(s=0;s<a*o;s++)u.data[s]=r.data[s];for(;s<d*l;s++)u.data[s]=0}if((function(y,b,_,h,f,E,m,S){const w=2*bo,v=_o;let A=0,M=0,T=0,R=0;const P=Math.max(E,30);let L=0,O=0,I=0,N=0,k=0,U=0,F=0,j=0,H=0,B=0,V=0,K=0,q=0,Te=0,Fe=0,We=0,J=0,et=4660,ht=0,er=0,tr=0;const Hm=new Float64Array(m<<3);for(;A<m;A++){for(T=0,V=0;T<E;T++)j=y[A*b+T],V+=j*j;if(Hm[A]=V,h){for(T=0;T<m;T++)h[A*f+T]=0;h[A*f+A]=1}}for(;R<P;R++){for(k=0,A=0;A<m-1;A++)for(M=A+1;M<m;M++){for(L=A*b|0,O=M*b|0,Fe=Hm[A],We=0,J=Hm[M],T=2,We+=y[L]*y[O],We+=y[L+1]*y[O+1];T<E;T++)We+=y[L+T]*y[O+T];if(!(Math.abs(We)<=w*Math.sqrt(Fe*J))){for(We*=2,K=Fe-J,q=yo(We,K),K<0?(Te=.5*(q-K),F=Math.sqrt(Te/q),U=We/(q*F*2)):(U=Math.sqrt((q+K)/(2*q)),F=We/(q*U*2)),Fe=0,J=0,T=2,H=U*y[L]+F*y[O],B=-F*y[L]+U*y[O],y[L]=H,y[O]=B,Fe+=H*H,J+=B*B,H=U*y[L+1]+F*y[O+1],B=-F*y[L+1]+U*y[O+1],y[L+1]=H,y[O+1]=B,Fe+=H*H,J+=B*B;T<E;T++)H=U*y[L+T]+F*y[O+T],B=-F*y[L+T]+U*y[O+T],y[L+T]=H,y[O+T]=B,Fe+=H*H,J+=B*B;if(Hm[A]=Fe,Hm[M]=J,k=1,h)for(I=A*f|0,N=M*f|0,T=2,H=U*h[I]+F*h[N],B=-F*h[I]+U*h[N],h[I]=H,h[N]=B,H=U*h[I+1]+F*h[N+1],B=-F*h[I+1]+U*h[N+1],h[I+1]=H,h[N+1]=B;T<m;T++)H=U*h[I+T]+F*h[N+T],B=-F*h[I+T]+U*h[N+T],h[I+T]=H,h[N+T]=B}}if(k===0)break}for(A=0;A<m;A++){for(T=0,V=0;T<E;T++)j=y[A*b+T],V+=j*j;Hm[A]=Math.sqrt(V)}for(A=0;A<m-1;A++){for(M=A,T=A+1;T<m;T++)Hm[M]<Hm[T]&&(M=T);if(A!==M&&(go(Hm,A,M,V),h)){for(T=0;T<E;T++)go(y,A*b+T,M*b+T,j);for(T=0;T<m;T++)go(h,A*f+T,M*f+T,j)}}for(A=0;A<m;A++)_[A]=Hm[A];if(h)for(A=0;A<S;A++){for(V=A<m?Hm[A]:0;V<=v;){for(er=1/E,T=0;T<E;T++)et=214013*et+2531011,ht=256&et>>16?er:-er,y[A*b+T]=ht;for(R=0;R<2;R++)for(M=0;M<A;M++){for(V=0,T=0;T<E;T++)V+=y[A*b+T]*y[M*b+T];for(tr=0,T=0;T<E;T++)j=y[A*b+T]-V*y[M*b+T],y[A*b+T]=j,tr+=Math.abs(j);for(tr=tr?1/tr:0,T=0;T<E;T++)y[A*b+T]*=tr}for(V=0,T=0;T<E;T++)j=y[A*b+T],V+=j*j;V=Math.sqrt(V)}for(F=1/V,T=0;T<E;T++)y[A*b+T]*=F}})(u.data,l,g.data,x.data,d,l,d,l),e){for(s=0;s<d;s++)e.data[s]=g.data[s];for(;s<a;s++)e.data[s]=0}i===0?(t&&ho(t,u),n&&ho(n,x)):(t&&ho(t,x),n&&ho(n,u))}function vo(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function wo(r,e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h){r[0]=e,r[4]=t,r[8]=n,r[12]=i,r[1]=s,r[5]=o,r[9]=a,r[13]=l,r[2]=d,r[6]=u,r[10]=g,r[14]=x,r[3]=y,r[7]=b,r[11]=_,r[15]=h}function Ao(r,e,t){const n=e[0],i=e[4],s=e[8],o=e[12],a=e[1],l=e[5],d=e[9],u=e[13],g=e[2],x=e[6],y=e[10],b=e[14],_=e[3],h=e[7],f=e[11],E=e[15],m=t[0],S=t[4],w=t[8],v=t[12],A=t[1],M=t[5],T=t[9],R=t[13],P=t[2],L=t[6],O=t[10],I=t[14],N=t[3],k=t[7],U=t[11],F=t[15];r[0]=n*m+i*A+s*P+o*N,r[4]=n*S+i*M+s*L+o*k,r[8]=n*w+i*T+s*O+o*U,r[12]=n*v+i*R+s*I+o*F,r[1]=a*m+l*A+d*P+u*N,r[5]=a*S+l*M+d*L+u*k,r[9]=a*w+l*T+d*O+u*U,r[13]=a*v+l*R+d*I+u*F,r[2]=g*m+x*A+y*P+b*N,r[6]=g*S+x*M+y*L+b*k,r[10]=g*w+x*T+y*O+b*U,r[14]=g*v+x*R+y*I+b*F,r[3]=_*m+h*A+f*P+E*N,r[7]=_*S+h*M+f*L+E*k,r[11]=_*w+h*T+f*O+E*U,r[15]=_*v+h*R+f*I+E*F}function So(r,e,t,n){wo(r,e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1)}function Co(r,e,t,n){wo(r,1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1)}function Po(r,e){const t=Math.cos(e),n=Math.sin(e);wo(r,t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1)}function Io(){return new Float32Array([1,0,0,0,1,0,0,0,1])}function ko(r,e){const t=Xr([e[0],e[1],e[2]]),n=Xr([e[4],e[5],e[6]]),i=Xr([e[8],e[9],e[10]]),s=Xr();Yr(s,n,i),r[0]=s[0],r[1]=s[1],r[2]=s[2],Yr(s,i,t),r[3]=s[0],r[4]=s[1],r[5]=s[2],Yr(s,t,n),r[6]=s[0],r[7]=s[1],r[8]=s[2]}function Mo(r,e,t,n){t=t||1,n=n||!0;const i=r.length/3,s=e.length/3;let o;n&&(o=new Float32Array(3*i));const a=new Float32Array(3*i);let l;const d=new Array(20);for(l=0;l<20;++l)d[l]=new Uint32Array(i);for(l=0;l<i;++l)d[0][l]=0;let u,g,x;for(l=0;l<s;++l){var y=3*l,b=3*l+1,_=3*l+2;for(x=!0,u=0,g=d[0][e[y]];u<g;++u)if(e[b]===d[u+1][e[y]]){x=!1;break}for(x&&(d[0][e[y]]++,d[d[0][e[y]]][e[y]]=e[b]),x=!0,u=0,g=d[0][e[y]];u<g;++u)if(e[_]===d[u+1][e[y]]){x=!1;break}for(x&&(d[0][e[y]]++,d[d[0][e[y]]][e[y]]=e[_]),x=!0,u=0,g=d[0][e[b]];u<g;++u)if(e[y]===d[u+1][e[b]]){x=!1;break}for(x&&(d[0][e[b]]++,d[d[0][e[b]]][e[b]]=e[y]),x=!0,u=0,g=d[0][e[b]];u<g;++u)if(e[_]===d[u+1][e[b]]){x=!1;break}for(x&&(d[0][e[b]]++,d[d[0][e[b]]][e[b]]=e[_]),x=!0,u=0;u<d[0][e[_]];++u)if(e[y]===d[u+1][e[_]]){x=!1;break}for(x&&(d[0][e[_]]++,d[d[0][e[_]]][e[_]]=e[y]),x=!0,u=0,g=d[0][e[_]];u<g;++u)if(e[b]===d[u+1][e[_]]){x=!1;break}x&&(d[0][e[_]]++,d[d[0][e[_]]][e[_]]=e[b])}for(var h,f,E,m,S,w=.5,v=.75/4.5,A=0;A<t;++A){for(l=0;l<i;++l)if(h=3*l,(E=d[0][l])<3)a[h]=r[h],a[h+1]=r[h+1],a[h+2]=r[h+2];else if(E===3||E===4){for(a[h]=0,a[h+1]=0,a[h+2]=0,u=0;u<E;++u)f=3*d[u+1][l],a[h]+=r[f],a[h+1]+=r[f+1],a[h+2]+=r[f+2];a[h]+=w*r[h],a[h+1]+=w*r[h+1],a[h+2]+=w*r[h+2],S=w+E,a[h]/=S,a[h+1]/=S,a[h+2]/=S}else{for(a[h]=0,a[h+1]=0,a[h+2]=0,u=0;u<E;++u)f=3*d[u+1][l],a[h]+=r[f],a[h+1]+=r[f+1],a[h+2]+=r[f+2];a[h]+=1*r[h],a[h+1]+=1*r[h+1],a[h+2]+=1*r[h+2],m=1+E,a[h]/=m,a[h+1]/=m,a[h+2]/=m}if(r.set(a),n){To(r,e,o);var M=3*i;for(h=0;h<M;h+=3)r[h]+=-1*v*o[h],r[h+1]+=-1*v*o[h+1],r[h+2]+=-1*v*o[h+2]}}}function To(r,e,t){var n,i;if(t===void 0)t=new Float32Array(r.length);else for(n=0,i=t.length;n<i;n++)t[n]=0;var s=new Float32Array(3),o=new Float32Array(3),a=new Float32Array(3),l=new Float32Array(3),d=new Float32Array(3);if(e)for(n=0,i=e.length;n<i;n+=3){var u=3*e[n],g=3*e[n+1],x=3*e[n+2];Jr(s,r,u),Jr(o,r,g),Jr(a,r,x),Zr(l,a,o),Zr(d,s,o),Yr(l,l,d),t[u]+=l[0],t[u+1]+=l[1],t[u+2]+=l[2],t[g]+=l[0],t[g+1]+=l[1],t[g+2]+=l[2],t[x]+=l[0],t[x+1]+=l[1],t[x+2]+=l[2]}else for(n=0,i=r.length;n<i;n+=9)Jr(s,r,n),Jr(o,r,n+3),Jr(a,r,n+6),Zr(l,a,o),Zr(d,s,o),Yr(l,l,d),t[n]=l[0],t[n+1]=l[1],t[n+2]=l[2],t[n+3]=l[0],t[n+4]=l[1],t[n+5]=l[2],t[n+6]=l[0],t[n+7]=l[1],t[n+8]=l[2];return Wr(t),t}function Do(r){for(var e={},t=0,n=r.length;t<n;++t)e[r[t]]=!0;return e}function Bo(r,e,t,n,i){var s=1/n*3;an(r,r,i+(s+=t)),cn(e,e,i+s),sn(r,r,n),ln(r,r),nn(r,r,n),sn(e,e,n),hn(e,e),nn(e,e,n);var o=new Float32Array(3);Zr(o,e,r),sn(o,o,n),hn(o,o),cn(o,o,1);var a=256*Math.pow(10,6),l=o[0]*o[1]*o[2]*3;a<=l&&(sn(r,r,n*=Math.pow(a/l,1/3)),ln(r,r),nn(r,r,n),sn(e,e,n),hn(e,e),nn(e,e,n),Zr(o,e,r),sn(o,o,n),hn(o,o),cn(o,o,1));var d=new Float32Array(r);un(d,d);var u=vo(),g=vo();Po(g,It(90)),Ao(u,u,g);var x=vo();So(x,-1/n,1/n,1/n),Ao(u,u,x);var y=vo();return Co(y,-n*d[2],-n*d[1],-n*d[0]),Ao(u,u,y),{dim:o,tran:d,matrix:u,scaleFactor:n}}So.__deps=[wo],Co.__deps=[wo],Po.__deps=[wo],ko.__deps=[Xr,Yr],Object.assign(Mo,{__deps:[To]}),Object.assign(To,{__deps:[Zr,Yr,Jr,Wr]}),Object.assign(Bo,{__deps:[It,an,cn,nn,sn,ln,hn,Zr,un,vo,Ao,Co,So,Po]});class Fo{constructor(e,t,n){this.name=e||"",this.path=t||"",this.info={},this.center=new Vector3,this.boundingBox=new Box3,n instanceof BufferGeometry||n instanceof Group?this.fromGeometry(n):n&&(this.set(n.position,n.index,n.normal,n.color,n.atomindex,n.contour),this.boundingBox.setFromArray(n.position),this.boundingBox.getCenter(this.center))}get type(){return"Surface"}set(e,t,n,i,s,o=!1){this.position=e,this.index=t,this.normal=n,this.color=i,this.atomindex=s,this.size=e.length/3,this.contour=o}fromGeometry(e){let t,n,i,s;if(De&&ke.time("GeometrySurface.fromGeometry"),t=e instanceof BufferGeometry?e:e[0],t.boundingBox||t.computeBoundingBox(),this.boundingBox.copy(t.boundingBox),this.boundingBox.getCenter(this.center),t instanceof BufferGeometry){const o=t.attributes,a=!!o.normal&&o.normal.array;(!a||a[0]===0&&a[1]===0&&a[2]===0)&&t.computeVertexNormals(),n=o.position.array,i=o.index?o.index.array:null,s=o.normal.array}this.set(n,i,s,void 0,void 0),De&&ke.timeEnd("GeometrySurface.setGeometry")}getPosition(){return this.position}getColor(e){const t=e||{};t.surface=this;const n=this.size,i=new Float32Array(3*n),s=Oe.getScheme(t);if(s.volumeColor||t.scheme==="random")for(let a=0;a<n;++a)s.volumeColorToArray(a,i,3*a);else if(s.positionColor){const a=new Vector3,l=this.position;for(let d=0;d<n;++d){var o=3*d;a.set(l[o],l[o+1],l[o+2]),s.positionColorToArray(a,i,o)}}else if(s.atomColor&&this.atomindex){const a=t.structure.getAtomProxy(),l=this.atomindex;for(let d=0;d<n;++d)a.index=l[d],s.atomColorToArray(a,i,3*d)}else{const a=new Color(t.value);Si(n,a.r,a.g,a.b,i)}return i}getPicking(e){return this.atomindex&&e?new Xs(this.atomindex,e):new io(Ci(this.size),this)}getNormal(){return this.normal}getSize(e,t){return Ai(this.size,e*t)}getIndex(){return this.index}getFilteredIndex(e,t){if(e&&this.atomindex){const n=new me(e),i=t.getAtomSet(n),s=[],o=this.atomindex,a=this.index,l=a.length,d=this.contour?2:3;let u=0;for(let g=0;g<l;g+=d){let x=!0;for(let y=0;y<d;y++){const b=o[a[g+y]];if(!i.get(b)){x=!1;break}}if(x)for(let y=0;y<d;y++,u++)s[u]=a[g+y]}return bt(s,this.position.length/3)}return this.index}getAtomindex(){return this.atomindex}dispose(){}}function Eo(r,e,t,n,i){var s=new co(r,e,t,n,i);this.getSurface=function(o,a,l,d,u,g=!1){const x=s.triangulate(o,a,l,u,g);if(a&&!u&&(Mo(x.position,x.index,a,!0),x.normal=To(x.position,x.index)),d&&(Hr(d,x.position),x.normal)){const y=Io();ko(y,d),qr(y,x.normal)}return x}}Object.assign(Eo,{__deps:[Mo,To,co,Hr,qr,Io,ko]}),$e.add("surf",(function(r,e){const t=r.data.args,n=r.data.params;if(t&&(self.volsurf=new Eo(t[0],t[1],t[2],t[3],t[4])),n){const i=self.volsurf.getSurface(n.isolevel,n.smooth,n.box,n.matrix,n.contour,n.wrap),s=[i.position.buffer,i.index.buffer];i.normal&&s.push(i.normal.buffer),i.atomindex&&s.push(i.atomindex.buffer),e({sd:i,p:n},s)}}),[Eo]);class $o{constructor(e,t,n,i,s,o,a){this.name=e,this.path=t,this.matrix=new Matrix4,this.normalMatrix=new Matrix3,this.inverseMatrix=new Matrix4,this.center=new Vector3,this.boundingBox=new Box3,this.setData(n,i,s,o,a)}get type(){return"Volume"}setData(e,t,n,i,s){this.nx=t||1,this.ny=n||1,this.nz=i||1,this.data=e||new Float32Array(1),this.setAtomindex(s),delete this._position,delete this._min,delete this._max,delete this._mean,delete this._rms,this.worker&&this.worker.terminate()}setStats(e,t,n,i){this._min=e,this._max=t,this._mean=n,this._rms=i}setMatrix(e){this.matrix.copy(e);const t=this.boundingBox,n=this.center,i=this.nx-1,s=this.ny-1,o=this.nz-1;t.makeEmpty(),t.expandByPoint(n.set(i,s,o)),t.expandByPoint(n.set(i,s,0)),t.expandByPoint(n.set(i,0,o)),t.expandByPoint(n.set(i,0,0)),t.expandByPoint(n.set(0,s,o)),t.expandByPoint(n.set(0,0,o)),t.expandByPoint(n.set(0,s,0)),t.expandByPoint(n.set(0,0,0)),t.applyMatrix4(this.matrix),t.getCenter(this.center);const a=this.matrix.elements,l=new Vector3(a[0],a[1],a[2]),d=new Vector3(a[4],a[5],a[6]),u=new Vector3(a[8],a[9],a[10]),g=new Vector3,x=this.normalMatrix.elements;g.crossVectors(d,u),x[0]=g.x,x[1]=g.y,x[2]=g.z,g.crossVectors(u,l),x[3]=g.x,x[4]=g.y,x[5]=g.z,g.crossVectors(l,d),x[6]=g.x,x[7]=g.y,x[8]=g.z,this.inverseMatrix.copy(this.matrix).invert()}setAtomindex(e){this.atomindex=e}getBox(e,t,n){return n||(n=new Box3),n.set(e,e),n.expandByScalar(t),n.applyMatrix4(this.inverseMatrix),n.min.round(),n.max.round(),n}_getBox(e,t){if(!e||!t)return;this.__box||(this.__box=new Box3);const n=this.getBox(e,t,this.__box);return[n.min.toArray(),n.max.toArray()]}_makeSurface(e,t,n){const i=this.name+"@"+t.toPrecision(2),s=new Fo(i,"",e);return s.info.isolevel=t,s.info.smooth=n,s.info.volume=this,s}getSurface(e,t,n,i,s,o=!1){e=isNaN(e)?this.getValueForSigma(2):e,t=nt(t,0),this.volsurf===void 0&&(this.volsurf=new Eo(this.data,this.nx,this.ny,this.nz,this.atomindex));const a=this._getBox(n,i),l=this.volsurf.getSurface(e,t,a,this.matrix.elements,s,o);return this._makeSurface(l,e,t)}getSurfaceWorker(e,t,n,i,s,o,a){if(e=isNaN(e)?this.getValueForSigma(2):e,t=t||0,window.hasOwnProperty("Worker")){this.workerPool===void 0&&(this.workerPool=new Ur("surf",2));const l={},d=this.workerPool.getNextWorker();d.postCount===0&&Object.assign(l,{args:[this.data,this.nx,this.ny,this.nz,this.atomindex]}),Object.assign(l,{params:{isolevel:e,smooth:t,box:this._getBox(n,i),matrix:this.matrix.elements,contour:s,wrap:o}}),d.post(l,void 0,(u=>{const g=u.data.sd,x=u.data.p;a(this._makeSurface(g,x.isolevel,x.smooth))}),(u=>{console.warn("Volume.getSurfaceWorker error - trying without worker",u);const g=this.getSurface(e,t,n,i,s,o);a(g)}))}else{const l=this.getSurface(e,t,n,i,s,o);a(l)}}getValueForSigma(e){return this.mean+nt(e,2)*this.rms}getSigmaForValue(e){return(nt(e,0)-this.mean)/this.rms}get position(){if(!this._position){const e=this.nz,t=this.ny,n=this.nx,i=new Float32Array(n*t*e*3);let s=0;for(let o=0;o<e;++o)for(let a=0;a<t;++a)for(let l=0;l<n;++l)i[s+0]=l,i[s+1]=a,i[s+2]=o,s+=3;Hr(this.matrix.elements,i),this._position=i}return this._position}getDataAtomindex(){return this.atomindex}getDataPosition(){return this.position}getDataColor(e){const t=e||{};t.volume=this,t.scale=t.scale||"Spectral",t.domain=t.domain||[this.min,this.max];const n=Oe.getScheme(t),i=this.position.length/3,s=new Float32Array(3*i);for(let o=0;o<i;++o)n.volumeColorToArray(o,s,3*o);return s}getDataPicking(){const e=Ci(this.position.length/3);return new no(e,this)}getDataSize(e,t){const n=this.data,i=this.position.length/3;let s;switch(e){case"value":case"deviation":s=new Float32Array(n);break;case"abs-value":s=new Float32Array(n);for(let o=0;o<i;++o)s[o]=Math.abs(s[o]);break;case"value-min":{s=new Float32Array(n);const o=this.min;for(let a=0;a<i;++a)s[a]-=o;break}default:s=Ai(i,e)}if(t!==1)for(let o=0;o<i;++o)s[o]*=t;return s}get min(){return this._min===void 0&&(this._min=Di(this.data)),this._min}get max(){return this._max===void 0&&(this._max=Ti(this.data)),this._max}get sum(){return this._sum===void 0&&(this._sum=Bi(this.data)),this._sum}get mean(){return this._mean===void 0&&(this._mean=Fi(this.data)),this._mean}get rms(){return this._rms===void 0&&(this._rms=(function(e){const t=e.length;let n=0;for(let i=0;i<t;++i){const s=e[i];n+=s*s}return Math.sqrt(n/t)})(this.data)),this._rms}clone(){const e=new $o(this.name,this.path,this.data,this.nx,this.ny,this.nz,this.atomindex);return e.matrix.copy(this.matrix),e.header=Object.assign({},this.header),e}dispose(){this.workerPool&&this.workerPool.terminate()}}function Oo(r){return r==="front"?FrontSide:r==="back"?BackSide:DoubleSide}ze.add("shader/Mesh.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#elif defined( NOLIGHT )
vColor = color;
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),ze.add("shader/Mesh.frag",`#define STANDARD
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#elif defined( NOLIGHT )
varying vec3 vColor;
#else
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#elif defined( NOLIGHT )
gl_FragColor = vec4( vColor, opacity );
#else
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
#include interior_fragment
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#include opaque_back_fragment
#endif
}`);const Ro={f:1,v2:2,v3:3,c:3};function Lo(r,e){r.matrix.copy(e),r.matrix.decompose(r.position,r.quaternion,r.scale),r.matrixWorldNeedsUpdate=!0}const No={opaqueBack:!1,side:"double",opacity:1,depthWrite:!0,clipNear:0,clipRadius:0,clipCenter:new Vector3,flatShaded:!1,wireframe:!1,roughness:.4,metalness:0,diffuse:16777215,diffuseInterior:!1,useInteriorColor:!1,interiorColor:14540253,interiorDarkening:0,forceTransparent:!1,matrix:new Matrix4,disablePicking:!1,sortParticles:!1,background:!1},zo={opaqueBack:{updateShader:!0},side:{updateShader:!0,property:!0},opacity:{uniform:!0},depthWrite:{property:!0},clipNear:{updateShader:!0,property:!0},clipRadius:{updateShader:!0,uniform:!0},clipCenter:{uniform:!0},flatShaded:{updateShader:!0},background:{updateShader:!0},wireframe:{updateVisibility:!0},roughness:{uniform:!0},metalness:{uniform:!0},diffuse:{uniform:!0},diffuseInterior:{updateShader:!0},useInteriorColor:{updateShader:!0},interiorColor:{uniform:!0},interiorDarkening:{uniform:!0},matrix:{}};class Uo{constructor(e,t={}){this.parameterTypes=zo,this.geometry=new BufferGeometry,this.indexVersion=0,this.wireframeIndexVersion=-1,this.group=new Group,this.wireframeGroup=new Group,this.pickingGroup=new Group,this.vertexShader="",this.fragmentShader="",this.isImpostor=!1,this.isText=!1,this.isSurface=!1,this.isPoint=!1,this.isLine=!1,this.dynamic=!0,this.visible=!0,this.wireframeIndexCount=0,this.parameters=st(t,this.defaultParameters),this.uniforms=UniformsUtils.merge([UniformsLib.common,{fogColor:{value:new Color(0)},fogNear:{value:0},fogFar:{value:0},opacity:{value:this.parameters.opacity},clipNear:{value:0},clipRadius:{value:this.parameters.clipRadius},clipCenter:{value:this.parameters.clipCenter}},{emissive:{value:new Color(0)},roughness:{value:this.parameters.roughness},metalness:{value:this.parameters.metalness},interiorColor:{value:new Color(this.parameters.interiorColor)},interiorDarkening:{value:this.parameters.interiorDarkening}},UniformsLib.lights]),this.uniforms.diffuse.value.set(this.parameters.diffuse),this.pickingUniforms={clipNear:{value:0},objectId:{value:0},opacity:{value:this.parameters.opacity}};const n=e.position||e.position1;this._positionDataSize=n?n.length/3:0,e.primitiveId||(e.primitiveId=Ci(this._positionDataSize)),this.addAttributes({position:{type:"v3",value:e.position},color:{type:"c",value:e.color},primitiveId:{type:"f",value:e.primitiveId}}),t.matrix&&(this.matrix=t.matrix),e.index&&this.initIndex(e.index),this.picking=e.picking,this.makeWireframeGeometry()}get defaultParameters(){return No}set matrix(e){this.setMatrix(e)}get matrix(){return this.group.matrix.clone()}get transparent(){return this.parameters.opacity<1||this.parameters.forceTransparent}get size(){return this._positionDataSize}get attributeSize(){return this.size}get pickable(){return!!this.picking&&!this.parameters.disablePicking}setMatrix(e){Lo(this.group,e),Lo(this.wireframeGroup,e),Lo(this.pickingGroup,e)}initIndex(e){this.geometry.setIndex(new BufferAttribute(e,1));const t=this.geometry.getIndex();t?t.setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage):ke.error("Index is null")}makeMaterial(){const e=Oo(this.parameters.side),t=new ShaderMaterial({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!0,fog:!0,side:e});t.vertexColors=!0,t.extensions.derivatives=!0,t.extensions.fragDepth=this.isImpostor;const n=new ShaderMaterial({uniforms:this.uniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:this.transparent,depthWrite:this.parameters.depthWrite,lights:!1,fog:!0,side:e});n.vertexColors=!0;const i=new ShaderMaterial({uniforms:this.pickingUniforms,vertexShader:"",fragmentShader:"",depthTest:!0,transparent:!1,depthWrite:this.parameters.depthWrite,lights:!1,fog:!1,side:e,blending:NoBlending});i.vertexColors=!0,i.extensions.fragDepth=this.isImpostor,t.clipNear=this.parameters.clipNear,n.clipNear=this.parameters.clipNear,i.clipNear=this.parameters.clipNear,this.material=t,this.wireframeMaterial=n,this.pickingMaterial=i,this.updateShader()}makeWireframeGeometry(){this.makeWireframeIndex();const e=this.geometry,t=this.wireframeIndex,n=new BufferGeometry;n.attributes=e.attributes,t&&(n.setIndex(new BufferAttribute(t,1).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage)),n.setDrawRange(0,this.wireframeIndexCount)),this.wireframeGeometry=n}makeWireframeIndex(){const e=[];function t(s,o){if(s>o){const l=s;s=o,o=l}const a=e[s];return a===void 0?(e[s]=[o],!0):!a.includes(o)&&(a.push(o),!0)}const n=this.geometry,i=n.index;if(this.parameters.wireframe)if(i){const s=i.array;let o,a=s.length;n.drawRange.count!==1/0&&(a=n.drawRange.count),this.wireframeIndex&&this.wireframeIndex.length>2*a?o=this.wireframeIndex:o=bt(2*a,n.attributes.position.count);let l=0;e.length=0;for(let d=0;d<a;d+=3){const u=s[d+0],g=s[d+1],x=s[d+2];t(u,g)&&(o[l+0]=u,o[l+1]=g,l+=2),t(g,x)&&(o[l+0]=g,o[l+1]=x,l+=2),t(x,u)&&(o[l+0]=x,o[l+1]=u,l+=2)}this.wireframeIndex=o,this.wireframeIndexCount=l,this.wireframeIndexVersion=this.indexVersion}else{const s=n.attributes.position.count;let o;o=this.wireframeIndex&&this.wireframeIndex.length>2*s?this.wireframeIndex:bt(2*s,s);for(let a=0,l=0;a<s;a+=3)o[l+0]=a,o[l+1]=a+1,o[l+2]=a+1,o[l+3]=a+2,o[l+4]=a+2,o[l+5]=a,l+=6;this.wireframeIndex=o,this.wireframeIndexCount=2*s,this.wireframeIndexVersion=this.indexVersion}else this.wireframeIndex=new Uint16Array(0),this.wireframeIndexCount=0}updateWireframeIndex(){if(this.wireframeGeometry&&this.wireframeIndex){if(this.wireframeGeometry.setDrawRange(0,1/0),this.wireframeIndexVersion<this.indexVersion&&this.makeWireframeIndex(),this.wireframeGeometry.index&&this.wireframeIndex.length>this.wireframeGeometry.index.array.length)this.wireframeGeometry.setIndex(new BufferAttribute(this.wireframeIndex,1).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage));else{const e=this.wireframeGeometry.getIndex();if(!e)return void ke.error("Index is null");e.set(this.wireframeIndex),e.needsUpdate=this.wireframeIndexCount>0,e.updateRange.count=this.wireframeIndexCount}this.wireframeGeometry.setDrawRange(0,this.wireframeIndexCount)}}getRenderOrder(){let e=0;return this.isText?e=1:this.transparent&&(e=this.isSurface?3:2),e}_getMesh(e){this.material||this.makeMaterial();const t=this.geometry,n=this[e];let i;return i=this.isLine?new LineSegments(t,n):this.isPoint?new Points(t,n):new Mesh(t,n),i.frustumCulled=!1,i.renderOrder=this.getRenderOrder(),i}getMesh(){return this._getMesh("material")}getWireframeMesh(){let e;return this.material||this.makeMaterial(),this.wireframeGeometry||this.makeWireframeGeometry(),e=new LineSegments(this.wireframeGeometry,this.wireframeMaterial),e.frustumCulled=!1,e.renderOrder=this.getRenderOrder(),e}getPickingMesh(){return this._getMesh("pickingMaterial")}getShader(e,t){return pi(e,this.getDefines(t))}getVertexShader(e){return this.getShader(this.vertexShader,e)}getFragmentShader(e){return this.getShader(this.fragmentShader,e)}getDefines(e){const t={};return this.parameters.clipNear&&(t.NEAR_CLIP=1),this.parameters.clipRadius&&(t.RADIUS_CLIP=1),e==="picking"?t.PICKING=1:((e==="background"||this.parameters.background)&&(t.NOLIGHT=1),this.parameters.flatShaded&&(t.FLAT_SHADED=1),this.parameters.opaqueBack&&(t.OPAQUE_BACK=1),this.parameters.diffuseInterior&&(t.DIFFUSE_INTERIOR=1),this.parameters.useInteriorColor&&(t.USE_INTERIOR_COLOR=1)),t}getParameters(){return this.parameters}addUniforms(e){this.uniforms=UniformsUtils.merge([this.uniforms,e]),this.pickingUniforms=UniformsUtils.merge([this.pickingUniforms,e])}addAttributes(e){for(let t in e){let n;const i=e[t],s=this.attributeSize*Ro[i.type];i.value?(s!==i.value.length&&ke.error("attribute value has wrong length",t),n=i.value):n=yt("float32",s),this.geometry.setAttribute(t,new BufferAttribute(n,Ro[i.type]).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage))}}updateRenderOrder(){const e=this.getRenderOrder();function t(n){n.renderOrder=e}this.group.children.forEach(t),this.pickingGroup&&this.pickingGroup.children.forEach(t)}updateShader(){const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.vertexShader=this.getVertexShader(),e.fragmentShader=this.getFragmentShader(),e.needsUpdate=!0,t.vertexShader=this.getShader("Line.vert"),t.fragmentShader=this.getShader("Line.frag"),t.needsUpdate=!0,n.vertexShader=this.getVertexShader("picking"),n.fragmentShader=this.getFragmentShader("picking"),n.needsUpdate=!0}setParameters(e){const t=e,n=this.parameterTypes,i=this.parameters,s={},o={};let a=!1,l=!1;for(const d in t){const u=t[d];u!==void 0&&(i[d]=u,n[d]!==void 0&&(n[d].property&&(n[d].property!==!0?s[n[d].property]=u:s[d]=u),n[d].uniform&&(n[d].uniform!==!0?o[n[d].uniform]=u:o[d]=u),n[d].updateShader&&(a=!0),n[d].updateVisibility&&(l=!0),this.dynamic&&d==="wireframe"&&u===!0&&this.updateWireframeIndex(),d==="forceTransparent"&&(s.transparent=this.transparent),d==="matrix"&&(this.matrix=u)))}this.setProperties(s),this.setUniforms(o),a&&this.updateShader(),l&&this.setVisibility(this.visible)}setAttributes(e){const t=this.geometry,n=t.attributes;for(const i in e){if(i==="picking")continue;const s=e[i],o=s.length;if(i==="index"){const a=t.getIndex();if(!a){ke.error("Index is null");continue}t.setDrawRange(0,1/0),o>a.array.length?t.setIndex(new BufferAttribute(s,1).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage)):(a.set(s),a.needsUpdate=o>0,a.updateRange.count=o,t.setDrawRange(0,o)),this.indexVersion++,this.parameters.wireframe&&this.updateWireframeIndex()}else{const a=n[i];o>a.array.length?t.setAttribute(i,new BufferAttribute(s,a.itemSize).setUsage(this.dynamic?DynamicDrawUsage:StaticDrawUsage)):(n[i].set(s),n[i].needsUpdate=o>0,n[i].updateRange.count=o)}}}setUniforms(e){if(!e)return;const t=this.material.uniforms,n=this.wireframeMaterial.uniforms,i=this.pickingMaterial.uniforms;for(let s in e)s==="opacity"&&this.setProperties({transparent:this.transparent}),t[s]!==void 0&&(t[s].value.isVector3?t[s].value.copy(e[s]):t[s].value.set?t[s].value.set(e[s]):t[s].value=e[s]),n[s]!==void 0&&(n[s].value.isVector3?n[s].value.copy(e[s]):n[s].value.set?n[s].value.set(e[s]):n[s].value=e[s]),i[s]!==void 0&&(i[s].value.isVector3?i[s].value.copy(e[s]):i[s].value.set?i[s].value.set(e[s]):i[s].value=e[s])}setProperties(e){if(!e)return;const t=this.material,n=this.wireframeMaterial,i=this.pickingMaterial;for(const s in e){const o=s;let a=e[o];o==="transparent"?this.updateRenderOrder():o==="side"&&(a=Oo(a)),t[o]=a,n[o]=a,i[o]=a}t.needsUpdate=!0,n.needsUpdate=!0,i.needsUpdate=!0}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.material&&this.material.dispose(),this.wireframeMaterial&&this.wireframeMaterial.dispose(),this.pickingMaterial&&this.pickingMaterial.dispose(),this.geometry.dispose(),this.wireframeGeometry&&this.wireframeGeometry.dispose()}toJSON(){var e={};for(var t in this)t!=="group"&&t!=="wireframeGroup"&&t!="pickingGroup"&&t!=="picking"&&(e[t]=this[t]);return e}}class Vo extends Uo{constructor(e,t={}){super(e,t),this.vertexShader="Mesh.vert",this.fragmentShader="Mesh.frag",this.addAttributes({normal:{type:"v3",value:e.normal}}),e.normal===void 0&&this.geometry.computeVertexNormals()}}class jo extends Vo{constructor(){super(...arguments),this.isSurface=!0}}function Go(r){r.visible=!0}function Ho(r){r.visible=!1}class qo{constructor(e){this.group=new Group,this.wireframeGroup=new Group,this.pickingGroup=new Group,this.frontMeshes=[],this.backMeshes=[],this.size=e.size,this.side=e.parameters.side,this.visible=e.visible,this.geometry=e.geometry,this.picking=e.picking,this.group=new Group,this.wireframeGroup=new Group,this.pickingGroup=new Group,this.matrix=e.matrix;const t=e,n=new e.constructor({position:new Float32Array(0)});t.makeMaterial(),n.makeMaterial(),n.picking=e.picking,n.geometry=e.geometry,n.wireframeGeometry=e.wireframeGeometry,n.setParameters(e.getParameters()),n.updateShader(),t.setParameters({side:"front"}),n.setParameters({side:"back",opacity:n.parameters.opacity}),this.buffer=e,this.frontBuffer=t,this.backBuffer=n}set matrix(e){Uo.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking&&!this.parameters.disablePicking}get parameters(){return this.buffer.parameters}getParameters(){const e=Object.assign({},this.buffer.parameters);return e.side=this.side,e}getMesh(e){let t,n;return e?(n=this.backBuffer.getPickingMesh(),t=this.frontBuffer.getPickingMesh()):(n=this.backBuffer.getMesh(),t=this.frontBuffer.getMesh()),this.frontMeshes.push(t),this.backMeshes.push(n),this.setParameters({side:this.side}),new Group().add(n,t)}getWireframeMesh(){return this.buffer.getWireframeMesh()}getPickingMesh(){return this.getMesh(!0)}setAttributes(e){this.buffer.setAttributes(e)}setParameters(e){(e=Object.assign({},e)).side==="front"?(this.frontMeshes.forEach(Go),this.backMeshes.forEach(Ho)):e.side==="back"?(this.frontMeshes.forEach(Ho),this.backMeshes.forEach(Go)):e.side==="double"&&(this.frontMeshes.forEach(Go),this.backMeshes.forEach(Go)),e.side!==void 0&&(this.side=e.side),delete e.side,e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,this.frontBuffer.setParameters(e),e.wireframe!==void 0&&(this.wireframe=e.wireframe,this.setVisibility(this.visible)),delete e.wireframe,this.backBuffer.setParameters(e)}setVisibility(e){this.visible=e,this.parameters.wireframe?(this.group.visible=!1,this.wireframeGroup.visible=e,this.pickable&&(this.pickingGroup.visible=!1)):(this.group.visible=e,this.wireframeGroup.visible=!1,this.pickable&&(this.pickingGroup.visible=e))}dispose(){this.frontBuffer.dispose(),this.backBuffer.dispose()}toJSON(){var e={};for(var t in this)["side","size","visible","matrix","parameters"].includes(t)&&(e[t]=this[t]);return e}}ze.add("shader/Line.vert",`uniform float clipNear;
uniform vec3 clipCenter;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include color_pars_vertex
void main(){
#include color_vertex
#include begin_vertex
#include project_vertex
vViewPosition = -mvPosition.xyz;
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),ze.add("shader/Line.frag",`uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#include common
#include color_pars_fragment
#include fog_pars_fragment
void main(){
#include nearclip_fragment
#include radiusclip_fragment
gl_FragColor = vec4( vColor, opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
}`);class Wo extends Uo{constructor(){super(...arguments),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag"}}class Xo extends Nr{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({isolevelType:{type:"select",options:{value:"value",sigma:"sigma"}},isolevel:{type:"number",precision:2,max:1e3,min:-1e3},negateIsolevel:{type:"boolean"},isolevelScroll:{type:"boolean"},smooth:{type:"integer",precision:1,max:10,min:0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},boxSize:{type:"integer",precision:1,max:100,min:0},colorVolume:{type:"hidden"},contour:{type:"boolean",rebuild:!0},useWorker:{type:"boolean",rebuild:!0},wrap:{type:"boolean",rebuild:!0}},this.parameters),e instanceof $o?(this.surface=void 0,this.volume=e):(this.surface=e,this.volume=void 0),this.boxCenter=new Vector3,this.__boxCenter=new Vector3,this.box=new Box3,this.__box=new Box3,this._position=new Vector3,this.inverseMatrix=new Matrix4,this.setBox=function(){this._position.copy(t.translationGroup.position).negate(),this._position.applyMatrix4(this.inverseMatrix),this._position.equals(this.boxCenter)||this.setParameters({boxCenter:this._position})},this.toBePrepared=!0,this.viewer.signals.ticked.add(this.setBox,this),this.init(n)}init(e){const t=e||{};t.colorScheme=nt(t.colorScheme,"uniform"),t.colorValue=nt(t.colorValue,14540253),this.isolevelType=nt(t.isolevelType,"sigma"),this.isolevel=nt(t.isolevel,2),this.negateIsolevel=nt(t.negateIsolevel,!1),this.isolevelScroll=nt(t.isolevelScroll,!1),this.smooth=nt(t.smooth,0),this.background=nt(t.background,!1),this.opaqueBack=nt(t.opaqueBack,!0),this.boxSize=nt(t.boxSize,0),this.colorVolume=nt(t.colorVolume,void 0),this.contour=nt(t.contour,!1),this.useWorker=nt(t.useWorker,!0),this.wrap=nt(t.wrap,!1),super.init(t),this.inverseMatrix.copy(this.matrix).invert(),this.build()}attach(e){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),e()}prepare(e){if(this.volume){let t;if(t=this.isolevelType==="sigma"?this.volume.getValueForSigma(this.isolevel):this.isolevel,this.negateIsolevel&&(t*=-1),!this.surface||this.__isolevel!==t||this.__smooth!==this.smooth||this.__contour!==this.contour||this.__wrap!==this.wrap||this.__boxSize!==this.boxSize||this.boxSize>0&&!this.__boxCenter.equals(this.boxCenter)){this.__isolevel=t,this.__smooth=this.smooth,this.__contour=this.contour,this.__wrap=this.wrap,this.__boxSize=this.boxSize,this.__boxCenter.copy(this.boxCenter),this.__box.copy(this.box);const n=i=>{this.surface=i,e()};this.useWorker?this.volume.getSurfaceWorker(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap,n):n(this.volume.getSurface(t,this.smooth,this.boxCenter,this.boxSize,this.contour,this.wrap))}else e()}else e()}create(){const e={position:this.surface.getPosition(),color:this.surface.getColor(this.getColorParams()),index:this.surface.getIndex()};let t;if(this.contour)t=new Wo(e,this.getBufferParams({wireframe:!1}));else{Object.assign(e,{normal:this.surface.getNormal(),picking:this.surface.getPicking()});const n=new jo(e,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));t=new qo(n)}this.bufferList.push(t)}update(e){if(this.bufferList.length===0)return;const t={};(e=e||{}).position&&(t.position=this.surface.getPosition()),e.color&&(t.color=this.surface.getColor(this.getColorParams())),e.index&&(t.index=this.surface.getIndex()),e.normal&&(t.normal=this.surface.getNormal()),this.bufferList.forEach((function(n){n.setAttributes(t)}))}setParameters(e,t,n){return e&&e.isolevelType!==void 0&&this.volume&&(this.isolevelType==="value"&&e.isolevelType==="sigma"?this.isolevel=this.volume.getSigmaForValue(this.isolevel):this.isolevelType==="sigma"&&e.isolevelType==="value"&&(this.isolevel=this.volume.getValueForSigma(this.isolevel)),this.isolevelType=e.isolevelType),e&&e.boxCenter&&(this.boxCenter.copy(e.boxCenter),delete e.boxCenter),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),e.matrix&&this.inverseMatrix.copy(e.matrix).invert(),this.volume&&this.volume.getBox(this.boxCenter,this.boxSize,this.box),e&&e.colorVolume!==void 0&&t&&(t.color=!0),this.surface&&(e.isolevel!==void 0||e.negateIsolevel!==void 0||e.smooth!==void 0||e.wrap!==void 0||e.boxSize!==void 0||this.boxSize>0&&!this.__box.equals(this.box))&&this.build({position:!0,color:!0,index:!0,normal:!this.contour}),this}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}dispose(){this.viewer.signals.ticked.remove(this.setBox,this),super.dispose()}}class Yo{static zoomScroll(e,t){e.trackballControls.zoom(t)}static clipNearScroll(e,t){const n=e.getParameters();e.setParameters({clipNear:n.clipNear+t/10})}static focusScroll(e,t){const n=e.getFocus(),i=Math.sign(t)*(function(s,o,a){if(s>o)return s;const l=s/o;return((2*a-o)*l+(2*o-3*a))*l*l+a})((100-n)/10,5,.2);e.setFocus(n+i)}static zoomFocusScroll(e,t){e.trackballControls.zoom(t);const n=e.viewer.camera.position.z;e.setFocus(100-Math.abs(n/8))}static isolevelScroll(e,t){const n=Math.sign(t)/10;e.eachRepresentation(((i,s)=>{if(i.repr instanceof Xo){const o=i.getParameters();o.isolevelScroll&&i.setParameters({isolevel:o.isolevel+n})}}))}static panDrag(e,t,n){e.trackballControls.pan(t,n)}static rotateDrag(e,t,n){e.trackballControls.rotate(t,n)}static zRotateDrag(e,t,n){e.trackballControls.zRotate(t,n)}static zoomDrag(e,t,n){e.trackballControls.zoom((t+n)/-2)}static zoomFocusDrag(e,t,n){e.trackballControls.zoom((t+n)/-2);const i=e.viewer.camera.position.z;e.setFocus(100-Math.abs(i/8))}static panComponentDrag(e,t,n){e.trackballControls.panComponent(t,n)}static panAtomDrag(e,t,n){e.trackballControls.panAtom(t,n)}static rotateComponentDrag(e,t,n){e.trackballControls.rotateComponent(t,n)}static movePick(e,t){t&&e.animationControls.move(t.position.clone())}static tooltipPick(e,t){const n=e.tooltip;if(e.getParameters().tooltip&&t){const i=t.mouse.position;n.innerText=t.getLabel(),n.style.bottom=window.innerHeight-i.y+3+"px",n.style.left=i.x+3+"px",n.style.display="block"}else n.style.display="none"}static measurePick(e,t){if(t&&(t.atom||t.bond)){const n=t.atom||t.closestBondAtom;t.component.measurePick(n)}else e.measureClear()}}const Ko={default:[["scroll",Yo.zoomScroll],["scroll-shift",Yo.focusScroll],["scroll-ctrl",Yo.isolevelScroll],["scroll-shift-ctrl",Yo.zoomFocusScroll],["drag-left",Yo.rotateDrag],["drag-right",Yo.panDrag],["drag-ctrl-left",Yo.panDrag],["drag-ctrl-right",Yo.zRotateDrag],["drag-shift-left",Yo.zoomDrag],["drag-middle",Yo.zoomFocusDrag],["drag-ctrl-shift-right",Yo.panComponentDrag],["drag-ctrl-shift-left",Yo.rotateComponentDrag],["clickPick-right",Yo.measurePick],["clickPick-ctrl-left",Yo.measurePick],["clickPick-middle",Yo.movePick],["clickPick-left",Yo.movePick],["hoverPick",Yo.tooltipPick]],pymol:[["drag-left",Yo.rotateDrag],["drag-middle",Yo.panDrag],["drag-right",Yo.zoomDrag],["scroll",Yo.focusScroll],["drag-shift-right",Yo.focusScroll],["clickPick-ctrl+shift-middle",Yo.movePick],["hoverPick",Yo.tooltipPick]],coot:[["scroll",Yo.isolevelScroll],["drag-left",Yo.rotateDrag],["drag-middle",Yo.panDrag],["drag-ctrl-left",Yo.panDrag],["drag-right",Yo.zoomFocusDrag],["drag-ctrl-right",Yo.focusScroll],["clickPick-middle",Yo.movePick],["hoverPick",Yo.tooltipPick]],astexviewer:[["drag-left",Yo.rotateDrag],["drag-ctrl-left",Yo.panDrag],["drag-shift-left",Yo.zoomDrag],["scroll",Yo.focusScroll],["clickPick-middle",Yo.movePick],["hoverPick",Yo.tooltipPick]]};function Zo(r){const e=r.split(/[-+]/);let t="";e.includes("scroll")&&(t="scroll"),e.includes("drag")&&(t="drag"),e.includes("click")&&(t="click"),e.includes("doubleClick")&&(t="doubleClick"),e.includes("hover")&&(t="hover"),e.includes("clickPick")&&(t="clickPick"),e.includes("hoverPick")&&(t="hoverPick");let n=0;e.includes("alt")&&(n+=1),e.includes("ctrl")&&(n+=2),e.includes("meta")&&(n+=4),e.includes("shift")&&(n+=8);let i=0;return e.includes("left")&&(i+=1),e.includes("right")&&(i+=2),e.includes("middle")&&(i+=4),[t,n,i]}class Qo{constructor(e,t={}){this.stage=e,this.actionList=[],this.mouse=e.mouseObserver,this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e,...t){if(this.disabled)return;const n=this.mouse.key||0,i=this.mouse.buttons||0;this.actionList.forEach((s=>{s.type===e&&s.key===n&&s.button===i&&s.callback(this.stage,...t)}))}add(e,t){const[n,i,s]=Zo(e);this.actionList.push({type:n,key:i,button:s,callback:t})}remove(e,t){const n=e.includes("*"),[i,s,o]=Zo(e),a=this.actionList.filter((function(l){return!((l.type===i||n&&i==="")&&(l.key===s||n&&s===0)&&(l.button===o||n&&o===0)&&(l.callback===t||t===void 0))}));this.actionList=a}preset(e){this.clear(),(Ko[e]||[]).forEach((t=>this.add(t[0],t[1])))}clear(){this.actionList.length=0}}class Jo{static autoView(e){e.autoView(1e3)}static toggleAnimations(e){e.animationControls.toggle()}static toggleRock(e){e.toggleRock()}static toggleSpin(e){e.toggleSpin()}static toggleAntialiasing(e){const t=e.getParameters();e.setParameters({sampleLevel:t.sampleLevel===-1?0:-1})}}const ta={default:[["i",Jo.toggleSpin],["k",Jo.toggleRock],["p",Jo.toggleAnimations],["a",Jo.toggleAntialiasing],["r",Jo.autoView]]};class ea{constructor(e,t={}){this.stage=e,this.actionList=[],this.disabled=t.disabled||!1,this.preset(t.preset||"default")}run(e){this.disabled||this.actionList.forEach((t=>{t.key===e&&t.callback(this.stage)}))}add(e,t){this.actionList.push({key:e,callback:t})}remove(e,t){const n=this.actionList.filter((function(i){return!(i.key===e&&(i.callback===t||t===void 0))}));this.actionList=n}preset(e){this.clear(),(ta[e]||[]).forEach((t=>this.add(t[0],t[1])))}clear(){this.actionList.length=0}}class ia{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this)}_onClick(e,t){const n=this.stage.pickingControls.pick(e,t);this.stage.signals.clicked.dispatch(n),this.controls.run("clickPick",n)}_onHover(e,t){const n=this.stage.pickingControls.pick(e,t);n&&this.mouse.down.equals(this.mouse.position)&&(this.stage.transformComponent=n.component,this.stage.transformAtom=n.atom),this.stage.signals.hovered.dispatch(n),this.controls.run("hoverPick",n)}dispose(){this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class ra{constructor(e){this.stage=e,this.stage=e,this.mouse=e.mouseObserver,this.controls=e.mouseControls,this.mouse.signals.moved.add(this._onMove,this),this.mouse.signals.scrolled.add(this._onScroll,this),this.mouse.signals.dragged.add(this._onDrag,this),this.mouse.signals.clicked.add(this._onClick,this),this.mouse.signals.hovered.add(this._onHover,this),this.mouse.signals.doubleClicked.add(this._onDblclick,this)}_onMove(){this.stage.tooltip.style.display="none"}_onScroll(e){this.controls.run("scroll",e)}_onDrag(e,t){this.controls.run("drag",e,t)}_onClick(e,t){this.controls.run("click",e,t)}_onDblclick(e,t){this.controls.run("doubleClick",e,t)}_onHover(e,t){this.controls.run("hover",e,t)}dispose(){this.mouse.signals.moved.remove(this._onMove,this),this.mouse.signals.scrolled.remove(this._onScroll,this),this.mouse.signals.dragged.remove(this._onDrag,this),this.mouse.signals.clicked.remove(this._onClick,this),this.mouse.signals.hovered.remove(this._onHover,this)}}class na{constructor(e){this.stage=e,this.viewer=e.viewer,this.animationControls=e.animationControls,this.viewer.signals.ticked.add(this._onTick,this)}_onTick(e){this.animationControls.run(e)}dispose(){this.viewer.signals.ticked.remove(this._onTick,this)}}const sa=!!we&&{passive:!0};class oa{constructor(e){this.stage=e,this.stage=e,this.controls=e.keyControls,this.domElement=e.viewer.renderer.domElement,this.domElement.setAttribute("tabIndex","-1"),this.domElement.style.outline="none",this._focusDomElement=this._focusDomElement.bind(this),this._onKeydown=this._onKeydown.bind(this),this._onKeyup=this._onKeyup.bind(this),this._onKeypress=this._onKeypress.bind(this),this.domElement.addEventListener("mousedown",this._focusDomElement),this.domElement.addEventListener("touchstart",this._focusDomElement,sa),this.domElement.addEventListener("keydown",this._onKeydown),this.domElement.addEventListener("keyup",this._onKeyup),this.domElement.addEventListener("keypress",this._onKeypress)}_onKeydown(){}_onKeyup(){}_onKeypress(e){let t;t="key"in KeyboardEvent.prototype?e.key:String.fromCharCode(e.which||e.keyCode),this.controls.run(t)}_focusDomElement(){this.domElement.focus()}dispose(){this.domElement.removeEventListener("mousedown",this._focusDomElement),this.domElement.removeEventListener("touchstart",this._focusDomElement,sa),this.domElement.removeEventListener("keydown",this._onKeypress),this.domElement.removeEventListener("keyup",this._onKeypress),this.domElement.removeEventListener("keypress",this._onKeypress)}}class aa{constructor(e,t,n,i={}){this.component=e,this.position=t,this.offsetX=nt(i.offsetX,0),this.offsetY=nt(i.offsetY,0),this.visible=nt(i.visible,!0),this.stage=e.stage,this.viewer=e.stage.viewer,this._viewerPosition=new Vector3,this._updateViewerPosition(),this._canvasPosition=new Vector2,this._cameraPosition=new Vector3,this.element=document.createElement("div"),Object.assign(this.element.style,{display:"block",position:"absolute",pointerEvents:"none",whiteSpace:"nowrap",left:"-10000px"}),this.viewer.wrapper.appendChild(this.element),this.setContent(n),this.updateVisibility(),this.viewer.signals.rendered.add(this._update,this),this.component.signals.matrixChanged.add(this._updateViewerPosition,this)}setContent(e){const t=this.element.style.display;if(t==="none"&&(this.element.style.left="-10000px",this.element.style.display="block"),e instanceof HTMLElement)this.element.appendChild(e);else{const n=document.createElement("div");n.innerText=e,Object.assign(n.style,{backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.element.appendChild(n)}this._clientRect=this.element.getBoundingClientRect(),t==="none"&&(this.element.style.display=t)}setVisibility(e){this.visible=e,this.updateVisibility()}getVisibility(){return this.visible&&this.component.parameters.visible}updateVisibility(){this.element.style.display=this.getVisibility()?"block":"none"}_updateViewerPosition(){this._viewerPosition.copy(this.position).applyMatrix4(this.component.matrix)}_update(){if(!this.getVisibility())return;const e=this.element.style,t=this._canvasPosition,n=this._viewerPosition,i=this._clientRect;if(this._cameraPosition.copy(n).add(this.viewer.translationGroup.position).applyMatrix4(this.viewer.rotationGroup.matrix).sub(this.viewer.camera.position),this._cameraPosition.z<0)return void(e.display="none");e.display="block";const s=this._cameraPosition.length(),o=this.viewer.scene.fog;e.opacity=(1-Et(o.near,o.far,s)).toString(),e.zIndex=Math.round(100*(o.far-s)).toString(),this.stage.viewerControls.getPositionOnCanvas(n,t),e.bottom=this.offsetX+t.y+i.height/2+"px",e.left=this.offsetY+t.x-i.width/2+"px"}dispose(){this.viewer.wrapper.removeChild(this.element),this.viewer.signals.ticked.remove(this._update,this),this.component.signals.matrixChanged.remove(this._updateViewerPosition,this)}}const ca=new Matrix4,la=new Vector3,ha=new Quaternion;class ua{constructor(e){this.component=e,this.signals={changed:new signalsExports.Signal},this.stage=e.stage,this.viewer=e.stage.viewer}get position(){return this.component.position}get rotation(){return this.component.quaternion}changed(){this.component.updateMatrix(),this.viewer.requestRender(),this.signals.changed.dispatch()}spin(e,t){ca.copy(this.viewer.rotationGroup.matrix).invert(),la.copy(vt(e)).applyMatrix4(ca),ca.extractRotation(this.component.transform),ca.premultiply(this.viewer.rotationGroup.matrix),ca.invert(),la.copy(vt(e)),la.applyMatrix4(ca),ca.makeRotationAxis(la,t),ha.setFromRotationMatrix(ca),this.component.quaternion.premultiply(ha),this.changed()}}const da={"":"",vdw:"by vdW radius",covalent:"by covalent radius",sstruc:"by secondary structure",bfactor:"by bfactor",size:"size",data:"data",explicit:"explicit"};class ma{constructor(e={}){this.max=10,this.type=nt(e.type,"size"),this.scale=nt(e.scale,1),this.size=nt(e.size,1),this.data=nt(e.data,{})}atomRadius(e){let t;switch(this.type){case"vdw":t=e.vdw;break;case"covalent":t=e.covalent;break;case"bfactor":t=e.bfactor||1;break;case"sstruc":const n=e.sstruc;t=n==="h"||n==="g"||n==="i"||n==="e"||n==="b"?.25:us.includes(e.atomname)?.4:.1;break;case"data":t=nt(this.data[e.index],1);break;case"explicit":t=e.radius,t===null&&(t=this.size);break;default:t=this.size}return Math.min(t*this.scale,this.max)}}ma.types=da;const fa=new Vector3(-1,-1,-1),pa=new Matrix4;class ga{constructor(e){const t=e.rows,n=t/3,i=new lo(t,3),s=new lo(3,3),o=new lo(1,3),a=new lo(3,3),l=new lo(3,3),d=fo(e);po(e,d),ho(i,e),uo(s,i,i),xo(s,o,a,l);const u=new Vector3(d[0],d[1],d[2]),g=new Vector3(a.data[0],a.data[3],a.data[6]),x=new Vector3(a.data[1],a.data[4],a.data[7]),y=new Vector3(a.data[2],a.data[5],a.data[8]),b=g.clone().multiplyScalar(Math.sqrt(o.data[0]/n)),_=x.clone().multiplyScalar(Math.sqrt(o.data[1]/n)),h=y.clone().multiplyScalar(Math.sqrt(o.data[2]/n));this.begA=u.clone().sub(b),this.endA=u.clone().add(b),this.begB=u.clone().sub(_),this.endB=u.clone().add(_),this.begC=u.clone().sub(h),this.endC=u.clone().add(h),this.center=u,this.vecA=b,this.vecB=_,this.vecC=h,this.normVecA=g,this.normVecB=x,this.normVecC=y}getBasisMatrix(e=new Matrix4){const t=e;return t.makeBasis(this.normVecB,this.normVecA,this.normVecC),t.determinant()<0&&t.scale(fa),t}getRotationQuaternion(e=new Quaternion){const t=e;return t.setFromRotationMatrix(this.getBasisMatrix(pa)),t.invert()}getProjectedScaleForAtoms(e){let t=-1/0,n=-1/0,i=-1/0,s=-1/0,o=-1/0,a=-1/0;const l=new Vector3,d=new Vector3,u=this.center,g=this.normVecA,x=this.normVecB,y=this.normVecC;return e.eachAtom((function(b){jr(l.copy(b),g,u);const _=d.subVectors(l,u).normalize().dot(g),h=l.distanceTo(u);_>0?h>t&&(t=h):h>n&&(n=h),jr(l.copy(b),x,u);const f=d.subVectors(l,u).normalize().dot(x),E=l.distanceTo(u);f>0?E>i&&(i=E):E>s&&(s=E),jr(l.copy(b),y,u);const m=d.subVectors(l,u).normalize().dot(y),S=l.distanceTo(u);m>0?S>o&&(o=S):S>a&&(a=S)})),{d1a:t,d2a:i,d3a:o,d1b:-n,d2b:-s,d3b:-a}}}class ya{constructor(e,t,n,i){this.volume=e,this.setFilter(t,n,i)}get header(){return this.volume.header}get matrix(){return this.volume.matrix}get normalMatrix(){return this.volume.normalMatrix}get inverseMatrix(){return this.volume.inverseMatrix}get center(){return this.volume.center}get boundingBox(){return this.volume.boundingBox}get min(){return this.volume.min}get max(){return this.volume.max}get mean(){return this.volume.mean}get rms(){return this.volume.rms}_getFilterHash(e,t,n){return JSON.stringify([e,t,n])}setFilter(e,t,n){isNaN(e)&&this.header&&(e=this.header.DMEAN+2*this.header.ARMS),e=e===void 0||isNaN(e)?-1/0:e,t=nt(t,1/0),n=nt(n,!1);const i=this.volume.data,s=this.volume.position,o=this.volume.atomindex,a=this._getFilterHash(e,t,n);if(a!==this._filterHash){if(e===-1/0&&t===1/0)this.data=i,this.position=s,this.atomindex=o;else{const l=i.length;this._dataBuffer||(this._dataBuffer=new ArrayBuffer(4*l),this._positionBuffer=new ArrayBuffer(3*l*4),o&&(this._atomindexBuffer=new ArrayBuffer(4*l)));const d=new Float32Array(this._dataBuffer),u=new Float32Array(this._positionBuffer);let g;o&&(g=new Uint32Array(this._atomindexBuffer));let x=0;for(let y=0;y<l;++y){const b=3*y,_=i[y];if(!n&&_>=e&&_<=t||n&&(_<e||_>t)){const h=3*x;d[x]=_,u[h+0]=s[b+0],u[h+1]=s[b+1],u[h+2]=s[b+2],o&&g&&(g[x]=o[y]),x+=1}}this.data=new Float32Array(this._dataBuffer,0,x),this.position=new Float32Array(this._positionBuffer,0,3*x),o&&(this.atomindex=new Int32Array(this._atomindexBuffer,0,x))}this._filterHash=a}}}ya.prototype.getValueForSigma=$o.prototype.getValueForSigma,ya.prototype.getSigmaForValue=$o.prototype.getSigmaForValue,ya.prototype.getDataAtomindex=$o.prototype.getDataAtomindex,ya.prototype.getDataPosition=$o.prototype.getDataPosition,ya.prototype.getDataColor=$o.prototype.getDataColor,ya.prototype.getDataPicking=$o.prototype.getDataPicking,ya.prototype.getDataSize=$o.prototype.getDataSize;class ba{constructor(e,t){const n=$n({nodeArray1:e.atomIndex1,nodeArray2:e.atomIndex2,edgeCount:e.count,nodeCount:t});this.countArray=n.countArray,this.offsetArray=n.offsetArray,this.indexArray=n.indexArray}}class _a extends Dn{get _defaultFields(){return[["atomIndex1",1,"int32"],["atomIndex2",1,"int32"],["bondOrder",1,"int8"]]}addBond(e,t,n){this.growIfFull();const i=this.count,s=e.index,o=t.index;s<o?(this.atomIndex1[i]=s,this.atomIndex2[i]=o):(this.atomIndex2[i]=s,this.atomIndex1[i]=o),n&&(this.bondOrder[i]=n),this.count+=1}addBondIfConnected(e,t,n){return!!e.connectedTo(t)&&(this.addBond(e,t,n),!0)}}class xa extends Dn{get _defaultFields(){return[["residueIndex",1,"uint32"],["atomTypeId",1,"uint16"],["x",1,"float32"],["y",1,"float32"],["z",1,"float32"],["serial",1,"int32"],["bfactor",1,"float32"],["altloc",1,"uint8"],["occupancy",1,"float32"]]}setAltloc(e,t){this.altloc[e]=t.charCodeAt(0)}getAltloc(e){const t=this.altloc[e];return t?String.fromCharCode(t):""}}class va extends Dn{get _defaultFields(){return[["chainIndex",1,"uint32"],["atomOffset",1,"uint32"],["atomCount",1,"uint32"],["residueTypeId",1,"uint16"],["resno",1,"int32"],["sstruc",1,"uint8"],["inscode",1,"uint8"]]}setSstruc(e,t){this.sstruc[e]=t.charCodeAt(0)}getSstruc(e){const t=this.sstruc[e];return t?String.fromCharCode(t):""}setInscode(e,t){this.inscode[e]=t.charCodeAt(0)}getInscode(e){const t=this.inscode[e];return t?String.fromCharCode(t):""}}class wa extends Dn{get _defaultFields(){return[["entityIndex",1,"uint16"],["modelIndex",1,"uint16"],["residueOffset",1,"uint32"],["residueCount",1,"uint32"],["chainname",4,"uint8"],["chainid",4,"uint8"]]}setChainname(e,t){const n=4*e;this.chainname[n]=t.charCodeAt(0),this.chainname[n+1]=t.charCodeAt(1),this.chainname[n+2]=t.charCodeAt(2),this.chainname[n+3]=t.charCodeAt(3)}getChainname(e){let t="";for(let n=0;n<4;++n){const i=this.chainname[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t}setChainid(e,t){const n=4*e;this.chainid[n]=t.charCodeAt(0),this.chainid[n+1]=t.charCodeAt(1),this.chainid[n+2]=t.charCodeAt(2),this.chainid[n+3]=t.charCodeAt(3)}getChainid(e){let t="";for(let n=0;n<4;++n){const i=this.chainid[4*e+n];if(!i)break;t+=String.fromCharCode(i)}return t}}class Aa extends Dn{get _defaultFields(){return[["chainOffset",1,"uint32"],["chainCount",1,"uint32"]]}}class Sa{constructor(e){this.polymer=e,this.size=e.residueCount}getCenterIterator(e=0){const t=this.getPosition().center,n=t.length/3;let i=0,s=-1;const o=[new Vector3,new Vector3,new Vector3,new Vector3];return{size:n,next:function(){const a=this.get(s);return s+=1,a},get:function(a){a=Math.min(n-1,Math.max(0,a));const l=o[i%4],d=3*a;if(l.fromArray(t,d),e){const u=Math.min(e,a,n-a-1);for(let g=1;g<=u;++g){const x=3*g,y=(u+1-g)/(u+1);l.x+=y*t[d-x+0]+y*t[d+x+0],l.y+=y*t[d-x+1]+y*t[d+x+1],l.z+=y*t[d-x+2]+y*t[d+x+2]}l.x/=u+1,l.y/=u+1,l.z/=u+1}return i+=1,l},reset:function(){i=0,s=-1}}}getColor(e){const t=this.polymer,n=t.structure,i=t.residueCount,s=t.residueIndexStart,o=new Float32Array(3*i),a=e||{};a.structure=n;const l=Oe.getScheme(a),d=n.getResidueProxy(),u=n.getAtomProxy();for(let g=0;g<i;++g)d.index=s+g,u.index=d.traceAtomIndex,l.atomColorToArray(u,o,3*g);return{color:o}}getPicking(){const e=this.polymer,t=e.structure,n=e.residueCount,i=e.residueIndexStart,s=new Float32Array(n),o=t.getResidueProxy();for(let a=0;a<n;++a)o.index=i+a,s[a]=o.traceAtomIndex;return{picking:new Xs(s,t)}}getSize(e){const t=this.polymer,n=t.structure,i=t.residueCount,s=t.residueIndexStart,o=new Float32Array(i),a=new ma(e),l=n.getResidueProxy(),d=n.getAtomProxy();for(let u=0;u<i;++u)l.index=s+u,d.index=l.traceAtomIndex,o[u]=a.atomRadius(d);return{size:o}}getPosition(){const e=this.polymer,t=e.structure,n=e.residueCount,i=n-3,s=new Float32Array(3*n),o=new Float32Array(3*n),a=new Float32Array(n),l=new Float32Array(n),d=new Float32Array(n),u=new Float32Array(n),g=new Float32Array(3*n),x=new Vector3,y=new Vector3,b=new Vector3,_=new Vector3,h=new Vector3,f=new Vector3,E=new Vector3,m=new Vector3,S=new Vector3,w=new Vector3,v=new Vector3,A=new Vector3(0,0,0),M="trace",T=t.getAtomProxy(),R=t.getAtomProxy(e.getAtomIndexByType(0,M)),P=t.getAtomProxy(e.getAtomIndexByType(1,M)),L=t.getAtomProxy(e.getAtomIndexByType(2,M));for(let F=0;F<i;++F){T.index=R.index,R.index=P.index,P.index=L.index,L.index=e.getAtomIndexByType(F+3,M);const j=3*F;x.subVectors(R,T),y.subVectors(P,R),b.subVectors(L,P),_.subVectors(x,y),h.subVectors(y,b),S.crossVectors(_,h).normalize(),S.toArray(o,j),F>0&&(a[F]=S.angleTo(w));const H=Math.cos(_.angleTo(h));u[F]=180/Math.PI*Math.acos(H);const B=_.length(),V=h.length();l[F]=Math.sqrt(V*B)/Math.max(2,2*(1-H)),d[F]=Math.abs(y.dot(S)),f.copy(_).multiplyScalar(l[F]/B),E.copy(h).multiplyScalar(l[F]/V),f.subVectors(R,f),E.subVectors(P,E),f.toArray(s,j+3),E.toArray(s,j+6),v.subVectors(T,A),v.toArray(g,j),w.copy(S),A.copy(f)}f.fromArray(s,3),E.fromArray(s,6),S.subVectors(f,E).normalize(),T.index=e.getAtomIndexByType(0,M),A.copy(T),m.copy(T),jr(m,S,f),m.toArray(s,0),v.subVectors(A,f),v.toArray(g,0),f.fromArray(s,3*n-6),E.fromArray(s,3*n-9),S.subVectors(f,E).normalize(),T.index=e.getAtomIndexByType(n-1,M),A.copy(T),m.copy(T),jr(m,S,f),m.toArray(s,3*n-3);for(let F=n-3;F<n;++F)f.fromArray(s,3*F),T.index=e.getAtomIndexByType(F,M),A.copy(T),v.subVectors(A,f),v.toArray(g,3*F);const O=new Float32Array(n),I=new Float32Array(n),N=new Float32Array(n),k=new Float32Array(n);O[1]=l[0],I[1]=u[0],N[1]=l[0];for(let F=2;F<n-2;++F)O[F]=.5*(l[F-2]+l[F-1]),I[F]=.5*(u[F-2]+u[F-1]),N[F]=.5*(d[F-2]+d[F-1]),f.fromArray(o,3*(F-2)),E.fromArray(o,3*(F-1)),k[F]=180/Math.PI*Math.acos(Math.cos(f.angleTo(E)));O[n-2]=l[n-4],I[n-2]=u[n-4],N[n-2]=d[n-4];const U=new Float32Array(3*n);ki(o,U,0,0,3),ki(o,U,0,3,3);for(let F=2;F<n-2;++F)f.fromArray(o,3*(F-2)),E.fromArray(o,3*(F-1)),S.addVectors(E,f).multiplyScalar(.5).normalize(),S.toArray(U,3*F);return ki(o,U,3*n-12,3*n-6,3),ki(o,U,3*n-12,3*n-3,3),{center:s,axis:U,bending:k,radius:O,rise:N,twist:I,resdir:g}}}class Ca{constructor(e){this.polymer=e,this.helixorient=new Sa(e),this.position=this.helixorient.getPosition()}getAxis(e,t,n,i,s){e=e||30,t=t||2.5,n=n!==void 0&&n;const o=this.polymer,a=o.structure,l=o.residueCount,d=o.residueIndexStart,u=this.position,g=i||{};g.structure=a;const x=Oe.getScheme(g),y=new ma(s);let b=0,_=0;const h=[],f=[],E=[],m=[],S=[],w=[],v=[],A=[],M=[];let T,R,P=new Float32Array(3*l),L=new Float32Array(3*l);const O=new Vector3,I=new Vector3,N=a.getResidueProxy(),k=a.getResidueProxy(),U=a.getAtomProxy(),F=new Vector3,j=new Vector3;let H=!1;for(let V=0;V<l;++V)if(N.index=d+V,F.fromArray(u.center,3*V),V===l-1?H=!0:(k.index=d+V+1,j.fromArray(u.center,3*V+3),(n&&N.sstruc!==k.sstruc||F.distanceTo(j)>t||u.bending[V]>e)&&(H=!0)),H){if(V-b<4){b=V,H=!1;continue}U.index=N.traceAtomIndex,P=u.axis.subarray(3*b+3,3*V),L=u.center.subarray(3*b,3*V+3),T=Vr(P).normalize(),R=Vr(L),O.fromArray(L),jr(O,T,R),I.fromArray(L,L.length-3),jr(I,T,R),T.subVectors(I,O),T.toArray(h,_),R.toArray(f,_),O.toArray(E,_),I.toArray(m,_),x.atomColorToArray(U,S,_),w.push(U.index),v.push(y.atomRadius(U)),A.push(d+b),M.push(d+V+1-b),_+=3,b=V,H=!1}const B=new Float32Array(w);return{axis:new Float32Array(h),center:new Float32Array(f),begin:new Float32Array(E),end:new Float32Array(m),color:new Float32Array(S),picking:new Xs(B,a),size:new Float32Array(v),residueOffset:A,residueCount:M}}}class Pa{constructor(e){this.scoreFunction=e,this.content=[],this.scoreFunction=e}push(e){this.content.push(e),this.bubbleUp(this.content.length-1)}pop(){const e=this.content[0],t=this.content.pop();return t&&this.content.length>0&&(this.content[0]=t,this.sinkDown(0)),e}peek(){return this.content[0]}remove(e){const t=this.content.length;for(let n=0;n<t;n++)if(this.content[n]===e){const i=this.content.pop();return void(i&&n!==t-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n)))}throw new Error("Node not found.")}size(){return this.content.length}bubbleUp(e){const t=this.content[e];for(;e>0;){const n=Math.floor((e+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[n]=t,this.content[e]=i,e=n}}sinkDown(e){const t=this.content.length,n=this.content[e],i=this.scoreFunction(n);let s=0,o=0;for(;;){const a=2*(e+1),l=a-1;let d=null;if(l<t){const u=this.content[l];s=this.scoreFunction(u),s<i&&(d=l)}if(a<t){const u=this.content[a];o=this.scoreFunction(u),o<(d===null?i:s)&&(d=a)}if(d===null)break;this.content[e]=this.content[d],this.content[d]=n,e=d}}}class Ia{constructor(e,t){this.points=e,this.metric=t,this.maxDepth=0,this.currentNode=0;const n=e.length/3,i=new Uint32Array(n);for(let s=0;s<n;++s)i[s]=s;this.indices=i,this.nodes=new Int32Array(4*n),this.rootIndex=this.buildTree(0,-1,0,n)}buildTree(e,t,n,i){e>this.maxDepth&&(this.maxDepth=e);const s=i-n;if(s===0)return-1;const o=4*this.currentNode,a=this.nodes;if(this.currentNode+=1,s===1)return a[o]=n,a[o+1]=-1,a[o+2]=-1,a[o+3]=t,o;const l=this.indices,d=this.points,u=n+Math.floor(s/2),g=e%3;let x,y,b,_,h,f=n,E=i-1;for(;E>f;){for(b=f+E>>1,_=d[3*l[b]+g],y=l[b],l[b]=l[E],l[E]=y,h=f,x=f;x<E;++x)d[3*l[x]+g]<_&&(y=l[h],l[h]=l[x],l[x]=y,++h);if(y=l[E],l[E]=l[h],l[h]=y,b=h,u===b)break;u<b?E=b-1:f=b+1}return a[o]=u,a[o+1]=this.buildTree(e+1,o,n,u),a[o+2]=this.buildTree(e+1,o,u+1,i),a[o+3]=t,o}getNodeDepth(e){const t=this.nodes[e+3];return t===-1?0:this.getNodeDepth(t)+1}nearest(e,t,n){const i=new Pa((u=>-u[1])),s=this.nodes,o=this.points,a=this.indices,l=u=>{let g,x;const y=this.getNodeDepth(u)%3,b=3*a[s[u]],_=[o[b+0],o[b+1],o[b+2]],h=this.metric(e,_);function f(v,A){i.push([v,A]),i.size()>t&&i.pop()}const E=s[u+1],m=s[u+2];if(m===-1&&E===-1)return void((i.size()<t||h<i.peek()[1])&&h<=n&&f(u,h));g=m===-1?E:E===-1?m:e[y]<=o[b+y]?E:m,l(g),(i.size()<t||h<i.peek()[1])&&h<=n&&f(u,h);const S=[];for(let v=0;v<3;v+=1)S[v]=v===y?e[v]:o[b+v];const w=this.metric(S,_);(i.size()<t||Math.abs(w)<i.peek()[1])&&Math.abs(w)<=n&&(x=g===E?m:E,x!==-1&&l(x))};l(this.rootIndex);const d=[];for(let u=0,g=Math.min(i.size(),t);u<g;u+=1)d.push(i.content[u]);return d}verify(e,t=0){let n=1;if(e===void 0&&(e=this.rootIndex),e===-1)throw new Error("node is null");const i=t%3,s=this.nodes,o=this.points,a=this.indices,l=s[e+1],d=s[e+2];if(l!==-1){if(o[3*a[s[l]]+i]>o[3*a[s[e]]+i])throw new Error("left child is > parent!");n+=this.verify(l,t+1)}if(d!==-1){if(o[3*a[s[d]]+i]<o[3*a[s[e]]+i])throw new Error("right child is < parent!");n+=this.verify(d,t+1)}return n}}class ka{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get bondHash(){return this.structure.bondHash}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainIndex(){return this.residueStore.chainIndex[this.residueIndex]}get residue(){return console.warn("residue - might be expensive"),this.structure.getResidueProxy(this.residueIndex)}get residueIndex(){return this.atomStore.residueIndex[this.index]}set residueIndex(e){this.atomStore.residueIndex[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.residueIndex)}get inscode(){return this.residueStore.getInscode(this.residueIndex)}get resno(){return this.residueStore.resno[this.residueIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.residueIndex])}get atomType(){return this.atomMap.get(this.atomStore.atomTypeId[this.index])}get residueAtomOffset(){return this.residueStore.atomOffset[this.residueIndex]}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get atomname(){return this.atomType.atomname}get number(){return this.atomType.number}get element(){return this.atomType.element}get vdw(){return this.atomType.vdw}get covalent(){return this.atomType.covalent}get x(){return this.atomStore.x[this.index]}set x(e){this.atomStore.x[this.index]=e}get y(){return this.atomStore.y[this.index]}set y(e){this.atomStore.y[this.index]=e}get z(){return this.atomStore.z[this.index]}set z(e){this.atomStore.z[this.index]=e}get serial(){return this.atomStore.serial[this.index]}set serial(e){this.atomStore.serial[this.index]=e}get bfactor(){return this.atomStore.bfactor[this.index]}set bfactor(e){this.atomStore.bfactor[this.index]=e}get occupancy(){return this.atomStore.occupancy[this.index]}set occupancy(e){this.atomStore.occupancy[this.index]=e}get altloc(){return this.atomStore.getAltloc(this.index)}set altloc(e){this.atomStore.setAltloc(this.index,e)}get partialCharge(){return this.atomStore.partialCharge?this.atomStore.partialCharge[this.index]:null}set partialCharge(e){this.atomStore.partialCharge&&(this.atomStore.partialCharge[this.index]=e)}get radius(){return this.atomStore.radius?this.atomStore.radius[this.index]:null}set radius(e){this.atomStore.radius&&(this.atomStore.radius[this.index]=e)}get formalCharge(){return this.atomStore.formalCharge?this.atomStore.formalCharge[this.index]:null}set formalCharge(e){this.atomStore.formalCharge&&(this.atomStore.formalCharge[this.index]=e)}get aromatic(){return this.atomStore.aromatic?this.atomStore.aromatic[this.index]:this.residueType.isAromatic(this)?1:0}set aromatic(e){this.atomStore.aromatic&&(this.atomStore.aromatic[this.index]=e)}get bondCount(){return this.bondHash.countArray[this.index]}eachBond(e,t){t=t||this.structure._bp;const n=this.index,i=this.bondHash,s=i.indexArray,o=i.countArray[n],a=i.offsetArray[n];for(let l=0;l<o;++l)t.index=s[a+l],e(t)}eachBondedAtom(e,t){const n=t||this.structure._ap,i=this.index;this.eachBond((function(s){n.index=i!==s.atomIndex1?s.atomIndex1:s.atomIndex2,e(n)})),this.index=i}hasBondTo(e){let t=!1;return this.eachBondedAtom((function(n){e.index===n.index&&(t=!0)})),t}bondToElementCount(e){let t=0;const n=this.index;return this.eachBondedAtom((function(i){i.number===e&&(t+=1)})),this.index=n,t}hasBondToElement(e){return this.bondToElementCount(e)>0}isBackbone(){const e=this.residueType.backboneIndexList;return e.length>0&&e.includes(this.index-this.residueAtomOffset)}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isSidechain(){return this.isPolymer()&&!this.isBackbone()}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isTrace(){return this.index===this.residueType.traceAtomIndex+this.residueAtomOffset}isHetero(){return this.residueType.hetero===1}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isHelix(){return Hn.includes(this.sstruc)}isSheet(){return qn.includes(this.sstruc)}isTurn(){return Wn.includes(this.sstruc)&&this.isProtein()}isBonded(){return this.bondHash.countArray[this.index]!==0}isRing(){return this.residueType.getRings().atomRings[this.index-this.residueAtomOffset]!==void 0}isAromatic(){return this.aromatic===1}isPolarHydrogen(){let e=!1;return this.number!==1||(e=!this.hasBondToElement(6)),e}isMetal(){return this.atomType.isMetal()}isNonmetal(){return this.atomType.isNonmetal()}isMetalloid(){return this.atomType.isMetalloid()}isHalogen(){return this.atomType.isHalogen()}isDiatomicNonmetal(){return this.atomType.isDiatomicNonmetal()}isPolyatomicNonmetal(){return this.atomType.isPolyatomicNonmetal()}isAlkaliMetal(){return this.atomType.isAlkaliMetal()}isAlkalineEarthMetal(){return this.atomType.isAlkalineEarthMetal()}isNobleGas(){return this.atomType.isNobleGas()}isTransitionMetal(){return this.atomType.isTransitionMetal()}isPostTransitionMetal(){return this.atomType.isPostTransitionMetal()}isLanthanide(){return this.atomType.isLanthanide()}isActinide(){return this.atomType.isActinide()}getDefaultValence(){return this.atomType.getDefaultValence()}getValenceList(){return this.atomType.getValenceList()}getOuterShellElectronCount(){return this.atomType.getOuterShellElectronCount()}distanceTo(e){const t=this.atomStore,n=e.atomStore,i=this.index,s=e.index,o=t.x[i]-n.x[s],a=t.y[i]-n.y[s],l=t.z[i]-n.z[s],d=o*o+a*a+l*l;return Math.sqrt(d)}connectedTo(e){const t=this.atomStore,n=e.atomStore,i=this.index,s=e.index;if(t.altloc&&n.altloc){const y=t.altloc[i],b=n.altloc[s];if(y!==0&&b!==0&&y!==32&&b!==32&&y!==b)return!1}const o=t.x[i]-n.x[s],a=t.y[i]-n.y[s],l=t.z[i]-n.z[s],d=o*o+a*a+l*l;if(d<48&&this.isCg())return!0;if(isNaN(d))return!1;const u=this.covalent+e.covalent,g=u+.3,x=u-.5;return d<g*g&&d>x*x}positionFromArray(e,t=0){return this.x=e[t+0],this.y=e[t+1],this.z=e[t+2],this}positionToArray(e=[],t=0){const n=this.index,i=this.atomStore;return e[t+0]=i.x[n],e[t+1]=i.y[n],e[t+2]=i.z[n],e}positionToVector3(e){return e===void 0&&(e=new Vector3),e.x=this.x,e.y=this.y,e.z=this.z,e}positionFromVector3(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}positionAdd(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}positionSub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}getResidueBonds(e=!1){const t=this.residueAtomOffset,n=this.index-this.residueAtomOffset,i=this.residueType.getBonds(),s=i.atomIndices1,o=i.atomIndices2;let a,l,d,u;for(e||(u=[]),a=s.indexOf(n);a!==-1;){if(d=o[a]+t,!u)return d;u.push(d),a=s.indexOf(n,a+1)}for(l=o.indexOf(n);l!==-1;){if(d=s[l]+t,!u)return d;u.push(d),l=o.indexOf(n,l+1)}return u}qualifiedName(e=!1){var t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chainname&&(t+=":"+this.chainname),this.atomname&&(t+="."+this.atomname),this.altloc&&(t+="%"+this.altloc),this.structure.modelStore.count>1&&(t+="/"+this.modelIndex),t}clone(){return new ka(this.structure,this.index)}toObject(){return{index:this.index,residueIndex:this.residueIndex,resname:this.resname,x:this.x,y:this.y,z:this.z,element:this.element,chainname:this.chainname,resno:this.resno,serial:this.serial,vdw:this.vdw,covalent:this.covalent,hetero:this.hetero,bfactor:this.bfactor,altloc:this.altloc,atomname:this.atomname,modelIndex:this.modelIndex}}}function Ma(r,e){const t=r[0]-e[0],n=r[1]-e[1],i=r[2]-e[2];return t*t+n*n+i*i}function Ta(r,e){return Math.sqrt(Ma(r,e))}const Da=new Float32Array(3);class Ba{constructor(e,t=!1){De&&ke.time("Kdtree build");const n=t?Ma:Ta,i=new Float32Array(3*e.atomCount),s=new Uint32Array(e.atomCount);let o=0;e.eachAtom((function(a){i[o+0]=a.x,i[o+1]=a.y,i[o+2]=a.z,s[o/3]=a.index,o+=3})),this.atomIndices=s,this.points=i,this.kdtree=new Ia(i,n),De&&ke.timeEnd("Kdtree build")}nearest(e,t,n){e instanceof Vector3?e.toArray(Da):e instanceof ka&&e.positionToArray(Da);const i=this.kdtree.nearest(Da,t,n),s=this.kdtree.indices,o=this.kdtree.nodes,a=this.atomIndices,l=[];for(let d=0,u=i.length;d<u;++d){const g=i[d],x=g[0],y=g[1];l.push({index:a[s[o[x]]],distance:y})}return l}}const Fa={" ":"X","!":"Y","#":"Z",$:"-X","%":"-Y","&":"-Z","'":"Y+1/2","(":"1/2+X",")":"1/2+Y","*":"1/2-X","+":"1/2+Z",",":"1/2-Y","-":"1/2-Z",".":"X+1/2","/":"Z+1/2",0:"-X+1/2",1:"-Y+1/2",2:"-Z+1/2",3:"1/4+X",4:"1/4-Y",5:"1/4+Z",6:"1/4-X",7:"1/4+Y",8:"3/4-Y",9:"3/4+Z",":":"3/4+Y",";":"3/4+X","<":"3/4-X","=":"1/4-Z",">":"3/4-Z","?":"X-Y","@":"Y-X",A:"Z+1/3",B:"Z+2/3",C:"X+2/3",D:"Y+1/3",E:"-Y+2/3",F:"X-Y+1/3",G:"Y-X+2/3",H:"-X+1/3",I:"X+1/3",J:"Y+2/3",K:"-Y+1/3",L:"X-Y+2/3",M:"Y-X+1/3",N:"-X+2/3",O:"2/3+X",P:"1/3+Y",Q:"1/3+Z",R:"2/3-Y",S:"1/3+X-Y",T:"2/3+Y-X",U:"1/3-X",V:"2/3-X",W:"1/3-Y",X:"1/3-Z",Y:"2/3+Y",Z:"1/3+Y-X","[":"2/3+X-Y","]":"1/3+X","^":"2/3+Z",_:"2/3-Z","`":"5/6+Z",a:"1/6+Z",b:"5/6-Z",c:"1/6-Z",d:"Z+5/6",e:"Z+1/6",f:"Z+1/4",g:"+Y"},Ea={"P 1":" !#","P -1":" !#$%&","P 1 2 1":" !#$!&","P 1 21 1":" !#$'&","C 1 2 1":" !#$!&()#*)&","P 1 m 1":" !# %#","P 1 c 1":" !# %+","C 1 m 1":" !# %#()#(,#","C 1 c 1":" !# %+()#(,+","P 1 2/m 1":" !# %#$!&$%&","P 1 21/m 1":" !#$)&$%& ,#","C 1 2/m 1":" !# %#$!&$%&()#(,#*)&*,&","P 1 2/c 1":" !#$!-$%& %+","P 1 21/c 1":" !#$%&$)- ,+","C 1 2/c 1":" !#$!-$%& %+()#*)-*,&(,+","P 2 2 2":" !#$%#$!& %&","P 2 2 21":" !#$%+$!- %&","P 21 21 2":" !#$%#*)&(,&","P 21 21 21":" !#*%+$)-(,&","C 2 2 21":" !#$%+$!- %&()#*,+*)-(,&","C 2 2 2":" !#$%#$!& %&()#*,#*)&(,&","F 2 2 2":" !#$%#$!& %& )+$,+$)- ,-(!+*%+*!-(%-()#*,#*)&(,&","I 2 2 2":" !#$%# %&$!&.'/01/.120'2","I 21 21 21":" !#*%+$)-(,&()+$,#*!& %-","P m m 2":" !#$%# %#$!#","P m c 21":" !#$%+ %+$!#","P c c 2":" !#$%# %+$!+","P m a 2":" !#$%#(%#*!#","P c a 21":" !#$%+(%#*!+","P n c 2":" !#$%# ,+$)+","P m n 21":" !#*%+(%+$!#","P b a 2":" !#$%#(,#*)#","P n a 21":" !#$%+(,#*)+","P n n 2":" !#$%#(,+*)+","C m m 2":" !#$%# %#$!#()#*,#(,#*)#","C m c 21":" !#$%+ %+$!#()#*,+(,+*)#","C c c 2":" !#$%# %+$!+()#*,#(,+*)+","A m m 2":" !#$%# %#$!# )+$,+ ,+$)+","A b m 2":" !#$%# ,#$)# )+$,+ %+$!+","A m a 2":" !#$%#(%#*!# )+$,+(,+*)+","A b a 2":" !#$%#(,#*)# )+$,+(%+*!+","F m m 2":" !#$%# %#$!# )+$,+ ,+$)+(!+*%+(%+*!+()#*,#(,#*)#","F d d 2":" !#$%#345675 )+$,+3896:9(!+*%+;49<79()#*,#;85<:5","I m m 2":" !#$%# %#$!#()+*,+(,+*)+","I b a 2":" !#$%#(,#*)#()+*,+ %+$!+","I m a 2":" !#$%#(%#*!#()+*,+ ,+$)+","P 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#","P 2/n 2/n 2/n":" !#$%#$!& %&*,-()-(,+*)+","P 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+","P 2/b 2/a 2/n":" !#$%#$!& %&*,&()&(,#*)#","P 21/m 2/m 2/a":" !#*%#$!&(%&$%&(!& %#*!#","P 2/n 21/n 2/a":" !#*%#*)- ,-$%&(!&(,+$)+","P 2/m 2/n 21/a":" !#*%+*!- %&$%&(!-(%+$!#","P 21/c 2/c 2/a":" !#*%#$!-(%-$%&(!& %+*!+","P 21/b 21/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#","P 21/c 21/c 2/n":" !#*,#$)-(%-$%&()& ,+*!+","P 2/b 21/c 21/m":" !#$%+$)- ,&$%& !- ,+$)#","P 21/n 21/n 2/m":" !#$%#*)-(,-$%& !&(,+*)+","P 21/m 21/m 2/n":" !#$%#*'&.,&*,&.'& %#$!#","P 21/b 2/c 21/n":" !#*,+$!-(,&$%&()- %+*)#","P 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#","P 21/n 21/m 21/a":" !#0%/$'&.12$%&.!2 1#0'/","C 2/m 2/c 21/m":" !#$%+$!- %&$%& !- %+$!#()#*,+*)-(,&*,&()-(,+*)#","C 2/m 2/c 21/a":" !#$,+$)- %&$%& )- ,+$!#()#*%+*!-(,&*,&(!-(%+*)#","C 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()#*,#*)&(,&*,&()&(,#*)#","C 2/c 2/c 2/m":" !#$%#$!- %-$%& !& %+$!+()#*,#*)-(,-*,&()&(,+*)+","C 2/m 2/m 2/a":" !#$,#$)& %&$%& )& ,#$!#()#*%#*!&(,&*,&(!&(%#*)#","C 2/c 2/c 2/a":" !#*,#$!&(,&$,-(!- ,+*!+()#$%#*)& %&*%- )-(%+$)+","F 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!# )+$,+$)- ,-$,- )- ,+$)+(!+*%+*!-(%-*%-(!-(%+*!+()#*,#*)&(,&*,&()&(,#*)#","F 2/d 2/d 2/d":" !#$%#$!& %&64=37=345675 )+$,+$)- ,-68>3:>3896:9(!+*%+*!-(%-<4>;7>;49<79()#*,#*)&(,&<8=;:=;85<:5","I 2/m 2/m 2/m":" !#$%#$!& %&$%& !& %#$!#()+*,+*)-(,-*,-()-(,+*)+","I 2/b 2/a 2/m":" !#$%#*)&(,&$%& !&(,#*)#()+*,+$!- %-*,-()- %+$!+","I 21/b 21/c 21/a":" !#*%+$)-(,&$%&(!- ,+*)#()+$,#*!& %-*,- )&(%#$!+","I 21/m 21/m 21/a":" !#$,#$)& %&$%& )& ,#$!#()+*%+*!-(,-*,-(!-(%+*)+","P 4":" !#$%#% #!$#","P 41":" !#$%+% 5!$9","P 42":" !#$%#% +!$+","P 43":" !#$%+% 9!$5","I 4":" !#$%#% #!$#()+*,+,(+)*+","I 41":" !#*,+%(5)$9()+$%#, 9!*5","P -4":" !#$%#!$&% &","I -4":" !#$%#!$&% &()+*,+)*-,(-","P 4/m":" !#$%#% #!$#$%& !&!$&% &","P 42/m":" !#$%#% +!$+$%& !&!$-% -","P 4/n":" !#$%#,(#)*#*,&()&!$&% &","P 42/n":" !#$%#,(+)*+*,-()-!$&% &","I 4/m":" !#$%#% #!$#$%& !&!$&% &()+*,+,(+)*+*,-()-)*-,(-","I 41/a":" !#*,+%(5)$9$,=(!>!$&,(-()+$%#, 9!*5*%> )=)*-% &","P 4 2 2":" !#$%#% #!$#$!& %&! &%$&","P 4 21 2":" !#$%#,(#)*#*)&(,&! &%$&","P 41 2 2":" !#$%+% 5!$9$!& %-! >%$=","P 41 21 2":" !#$%+,(5)*9*)=(,>! &%$-","P 42 2 2":" !#$%#% +!$+$!& %&! -%$-","P 42 21 2":" !#$%#,(+)*+*)-(,-! &%$&","P 43 2 2":" !#$%+% 9!$5$!& %-! =%$>","P 43 21 2":" !#$%+,(9)*5*)>(,=! &%$-","I 4 2 2":" !#$%#% #!$#$!& %&! &%$&()+*,+,(+)*+*)-(,-)(-,*-","I 41 2 2":" !#*,+%(5)$9*!> ,=)(-%$&()+$%#, 9!*5$)=(%>! &,*-","P 4 m m":" !#$%#% #!$# %#$!#%$#! #","P 4 b m":" !#$%#% #!$#(,#*)#,*#)(#","P 42 c m":" !#$%#% +!$+ %+$!+%$#! #","P 42 n m":" !#$%#,(+)*+(,+*)+%$#! #","P 4 c c":" !#$%#% #!$# %+$!+%$+! +","P 4 n c":" !#$%#% #!$#(,+*)+,*+)(+","P 42 m c":" !#$%#% +!$+ %#$!#%$+! +","P 42 b c":" !#$%#% +!$+(,#*)#,*+)(+","I 4 m m":" !#$%#% #!$# %#$!#%$#! #()+*,+,(+)*+(,+*)+,*+)(+","I 4 c m":" !#$%#% #!$# %+$!+%$+! +()+*,+,(+)*+(,#*)#,*#)(#","I 41 m d":" !#*,+%(5)$9 %#*)+%*5) 9()+$%#, 9!*5(,+$!#,$9!(5","I 41 c d":" !#*,+%(5)$9 %+*)#%*9) 5()+$%#, 9!*5(,#$!+,$5!(9","P -4 2 m":" !#$%#% &!$&$!& %&%$#! #","P -4 2 c":" !#$%#% &!$&$!- %-%$+! +","P -4 21 m":" !#$%#% &!$&*)&(,&,*#)(#","P -4 21 c":" !#$%#% &!$&*)-(,-,*+)(+","P -4 m 2":" !#$%#!$&% & %#$!#! &%$&","P -4 c 2":" !#$%#% &!$& %+$!+! -%$-","P -4 b 2":" !#$%#% &!$&(,#*)#)(&,*&","P -4 n 2":" !#$%#% &!$&(,+*)+)(-,*-","I -4 m 2":" !#$%#% &!$& %#$!#! &%$&()+*,+,(-)*-(,+*)+)(-,*-","I -4 c 2":" !#$%#% &!$& %+$!+! -%$-()+*,+,(-)*-(,#*)#)(&,*&","I -4 2 m":" !#$%#% &!$&$!& %&%$#! #()+*,+,(-)*-*)-(,-,*+)(+","I -4 2 d":" !#$%#% &!$&*!>(%>,$9) 9()+*,+,(-)*-$)= ,=%*5!(5","P 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #","P 4/m 2/c 2/c":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +","P 4/n 2/b 2/m":" !#$%#% #!$#$!& %&! &%$&*,&()&)*&,(&(,#*)#,*#)(#","P 4/n 2/n 2/c":" !#$%#% #!$#$!& %&! &%$&*,-()-)*-,(-(,+*)+,*+)(+","P 4/m 21/b 2/m":" !#$%#% #!$#*)&(,&)(&,*&$%& !&!$&% &(,#*)#,*#)(#","P 4/m 21/n 2/c":" !#$%#% #!$#*)-(,-)(-,*-$%& !&!$&% &(,+*)+,*+)(+","P 4/n 21/m 2/m":" !#$%#,(#)*#*)&(,&! &%$&*,&()&!$&% & %#$!#,*#)(#","P 4/n 2/c 2/c":" !#$%#,(#)*#*)-(,-! -%$-*,&()&!$&% & %+$!+,*+)(+","P 42/m 2/m 2/c":" !#$%#% +!$+$!& %&! -%$-$%& !&!$-% - %#$!#%$+! +","P 42/m 2/c 2/m":" !#$%#% +!$+$!- %-! &%$&$%& !&!$-% - %+$!+%$#! #","P 42/n 2/b 2/c":" !#$%#,(+)*+$!- %-)(&,*&*,-()-!$&% &(,#*)#%$+! +","P 42/n 2/n 2/m":" !#$%#,(+)*+$!& %&)(-,*-*,-()-!$&% &(,+*)+%$#! #","P 42/m 21/b 2/c":" !#$%#% +!$+*)&(,&)(-,*-$%& !&!$-% -(,#*)#,*+)(+","P 42/m 21/n 2/m":" !#$%#,./'*/*'-.,-! &%$&$%& !&'*-,.-.,/*'/%$#! #","P 42/n 21/m 2/c":" !#$%#,(+)*+*)-(,-! &%$&*,-()-!$&% & %#$!#,*+)(+","P 42/n 21/c 2/m":" !#$%#,(+)*+*)&(,&! -%$-*,-()-!$&% & %+$!+,*#)(#","I 4/m 2/m 2/m":" !#$%#% #!$#$!& %&! &%$&$%& !&!$&% & %#$!#%$#! #()+*,+,(+)*+*)-(,-)(-,*-*,-()-)*-,(-(,+*)+,*+)(+","I 4/m 2/c 2/m":" !#$%#% #!$#$!- %-! -%$-$%& !&!$&% & %+$!+%$+! +()+*,+,(+)*+*)&(,&)(&,*&*,-()-)*-,(-(,#*)#,*#)(#","I 41/a 2/m 2/d":" !#*,+%(5)$9*!> ,=)(-%$&$,=(!>!$&,(-(,+$!#,$9!(5()+$%#, 9!*5$)=(%>! &,*-*%> )=)*-% & %#*)+%*5) 9","I 41/a 2/c 2/d":" !#*,+%(5)$9*!= ,>)(&%$-$,=(!>!$&,(-(,#$!+,$5!(9()+$%#, 9!*5$)>(%=! -,*&*%> )=)*-% & %+*)#%*9) 5","P 3":" !#%?#@$#","P 31":" !#%?A@$B","P 32":" !#%?B@$A","H 3":" !#%?#@$#CDAEFAGHAIJBKLBMNB","R 3":" !## !!# ","P -3":" !#%?#@$#$%&!@&? &","H -3":" !#%?#@$#$%&!@&? &OPQRSQTUQVWXYZX[]X]Y^W[^ZV^UR_PT_SO_","R -3":" !## !!# $%&&$%%&$","P 3 1 2":" !#%?#@$#%$&@!& ?&","P 3 2 1":" !#%?#@$#! &?%&$@&","P 31 1 2":" !#%?Q@$^%$_@!X ?&","P 31 2 1":" !#%?A@$B! &?%_$@X","P 32 1 2":" !#%?^@$Q%$X@!_ ?&","P 32 2 1":" !#%?B@$A! &?%X$@_","H 3 2":" !#%?#@$#! &?%&$@&OPQRSQTUQY]X[WXVZX]Y^W[^ZV^PO_SR_UT_","R 3 2":" !## !!# %$&$&%&%$","P 3 m 1":" !#%?#@$#%$#@!# ?#","P 3 1 m":" !#%?#@$#! #?%#$@#","P 3 c 1":" !#%?#@$#%$+@!+ ?+","P 3 1 c":" !#%?#@$#! +?%+$@+","H 3 m":" !#%?#@$#%$#@!# ?#OPQRSQTUQRUQTPQOSQ]Y^W[^ZV^WV^ZY^][^","R 3 m":" !## !!# ! # #!#! ","H 3 c":" !#%?#@$#%$+@!+ ?+OPQRSQTUQRU`TP`OS`]Y^W[^ZV^WVaZYa][a","R 3 c":" !## !!# '././'/'.","P -3 1 2/m":" !#%?#@$#%$&@!& ?&$%&!@&? &! #?%#$@#","P -3 1 2/c":" !#%?#@$#%$-@!- ?-$%&!@&? &! +?%+$@+","P -3 2/m 1":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#","P -3 2/c 1":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+","H -3 2/m":" !#%?#@$#! &?%&$@&$%&!@&? &%$#@!# ?#OPQRSQTUQY]X[WXVZXVWXYZX[]XRUQTPQOSQ]Y^W[^ZV^PO_SR_UT_UR_PT_SO_WV^ZY^][^","R -3 2/m":" !## !!# %$&$&%&%$$%&&$%%&$! # #!#! ","H -3 2/c":" !#%?#@$#! -?%-$@-$%&!@&? &%$+@!+ ?+OPQRSQTUQY]b[WbVZbVWXYZX[]XRU`TP`OS`]Y^W[^ZV^POcSRcUTcUR_PT_SO_WVaZYa][a","R -3 2/c":" !## !!# 102021210$%&&$%%&$'././'/'.","P 6":" !#%?#@$#$%#!@#? #","P 61":" !#%?A@$B$%/!@d? e","P 65":" !#%?B@$A$%/!@e? d","P 62":" !#%?^@$Q$%#!@^? Q","P 64":" !#%?Q@$^$%#!@Q? ^","P 63":" !#%?#@$#$%+!@+? +","P -6":" !#%?#@$# !&%?&@$&","P 6/m":" !#%?#@$#$%#!@#? #$%&!@&? & !&%?&@$&","P 63/m":" !#%?#@$#$%+!@+? +$%&!@&? & !-%?-@$-","P 6 2 2":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&","P 61 2 2":" !#%?Q@$^$%+!@`? a! X?%&$@_%$b@!- ?c","P 65 2 2":" !#%?^@$Q$%+!@a? `! _?%&$@X%$c@!- ?b","P 62 2 2":" !#%?^@$Q$%#!@^? Q! _?%&$@X%$_@!& ?X","P 64 2 2":" !#%?Q@$^$%#!@Q? ^! X?%&$@_%$X@!& ?_","P 63 2 2":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-","P 6 m m":" !#%?#@$#$%#!@#? #%$#@!# ?#! #?%#$@#","P 6 c c":" !#%?#@$#$%#!@#? #%$+@!+ ?+! +?%+$@+","P 63 c m":" !#%?#@$#$%+!@+? +%$+@!+ ?+! #?%#$@#","P 63 m c":" !#%?#@$#$%+!@+? +%$#@!# ?#! +?%+$@+","P -6 m 2":" !#%?#@$# !&%?&@$&%$#@!# ?#%$&@!& ?&","P -6 c 2":" !#%?#@$# !-%?-@$-%$+@!+ ?+%$&@!& ?&","P -6 2 m":" !#%?#@$# !&%?&@$&! &?%&$@&! #?%#$@#","P -6 2 c":" !#%?#@$# !-%?-@$-! &?%&$@&! +?%+$@+","P 6/m 2/m 2/m":" !#%?#@$#$%#!@#? #! &?%&$@&%$&@!& ?&$%&!@&? & !&@$&%?&%$#@!# ?#! #?%#$@#","P 6/m 2/c 2/c":" !#%?#@$#$%#!@#? #! -?%-$@-%$-@!- ?-$%&!@&? & !&@$&%?&%$+@!+ ?+! +?%+$@+","P 63/m 2/c 2/m":" !#%?#@$#$%+!@+? +! -?%-$@-%$&@!& ?&$%&!@&? & !-@$-%?-%$+@!+ ?+! #?%#$@#","P 63/m 2/m 2/c":" !#%?#@$#$%+!@+? +! &?%&$@&%$-@!- ?-$%&!@&? & !-@$-%?-%$#@!# ?#! +?%+$@+","P 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ","F 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%&  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ","I 2 3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(","P 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(","I 21 3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- ","P 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$","P 2/n -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& *,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","F 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-($,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- *,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$","F 2/d -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& 64=37=345675=64=375345674=67=3453756 )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(68>3:>3896:9=<8=;:5;85<:4><7>;49;79<(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(<4>;7>;49<79>68>3:93896:8=<:=;85;:5<()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- <8=;:=;8f<:f><4>;79;49<78>6:>3893:96","I 2/m -3":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& $%& !& %#$!#&$%& !# %#$!%&$!& %# !#$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-(*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*","P 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*","I 21/a -3":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&($%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*()+$,#*g& %-+()#$,&*!- %)+(,#$!&*%- *,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$","P 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$","P 42 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","F 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$ )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*(!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%*()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$","F 41 3 2":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46 )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<(!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86","I 4 3 2":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*","P 43 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7;>46=:<5839398<5:6=4;>75:<983>7;=46","P 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<","I 41 3 2":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46","P -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ","F -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&%  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(+%*+!*-%(- +)$+,$-) -,#)(#,*&)*&,((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() +,$+)$-, -(#)*#,*&)(&,+!(+%*-!*-%(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(#,*#)*&,(&(+!*+%*-!(-%+) +,$-)$-, ","I -4 3 m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! #%$#!$&% & #!$#%$&! &%#! #%$&!$&% ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","P -4 3 n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,(","F -4 3 c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(+,*+)*-,(-(+)*+,*-)(-,+)(+,*-)*-,( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() #,$#)$&, &(#!*#%*&!(&%+! +%$-!$-% (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(#%*#!*&%(& +!$+%$-! -%#) #,$&)$&, ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! +%$+!$-% - #)$#,$&) &,#!(#%*&!*&%(","I -4 3 d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(7354<9:6>8;=357<946>:;=857394<>:6=8;()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- :;98657<=43>;9:658<=73>49:;586=7<>43","P 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","P 4/n -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$*,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/m -3 2/n":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","P 42/n -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ","F 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#!  )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-(!(-%*-!*+%(+ +,$+)$-, -)#)*#,(&)(&,*$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*%*+!(+%(-!*-$-) -, +)$+,&,(&)*#,*#)((!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&() -,$-)$+, +(#,*#)*&,(&)+!*+%(-!(-%**%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*,$+) +, -)$-*&)(&,(#)*#,-%(-!*+%*+!(()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- )(&,*&)*#,(#(+%*+!*-%(-!+)$+, -) -,$*,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$,*#)(#,(&)*&*-!(-%(+!*+%-, -)$+,$+) ","F 4/m -3 2/c":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& )(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,*$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)( )+$,+$)- ,-#()#*,&*)&(,!+(%+*!-*%-() &,$&)$#, #(#%*#!*&%(&!+!$+% -! -%$$,- )- ,+$)+&*,&()#(,#*)%-*!-(%+(!+*,$#) #, &)$&*&!(&%(#!*#%-% -!$+%$+! (!+*%+*!-(%-+ )+$,-$)- ,)#(,#*)&*,&(!(&%*&!*#%(# +%$+!$-% -!#)$#, &) &,$*%-(!-(%+*!+-$,- )+ ,+$),&*)&(,#()#*%*#!(#%(&!*&$-! -% +!$+%&, &)$#,$#) ()#*,#*)&(,&+(!+*%-*!-(%)+ ,+$)-$,- ! -%$-!$+% + #,$#)$&, &)#!*#%(&!(&%**,&()&(,#*)#-*%-(!+(%+*!,-$)- ,+ )+$%$+! +% -!$-$&) &, #)$#,&%(&!*#%*#!(","F 41/d -3 2/m":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=4664=3:>;85<79=64>3:5;89<74=6:>385;79<,$+! #%(-)*&*&)(-% #!$+,-%(&)*+,$#!  )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<68>37=;49<:5=<8>;753496:4><:=;893756,*#!(+% &)$-*-!(&, +)$#%-, &!$+%*#)((!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<<4>;:=389675>68=379;45<:8=<7>;453:96%$#) +,(&!*-$&! -,(#)*+%&% -)$#,*+!(()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>86<8=;7>3456:9><4=;:9385678>67=349;:5<%*+)(#, -!$&$-) &%(+!*#,&,(-!*#%$+) ","F 41/d -3 2/c":" !#$,+*)&(%-# !+$,&*)-(%!# ,+$)&*%-(:3>46=7<98;5;58<976=43>:97<58;>:3=46<8>;7=3496:5><8=;793456:8><7=;493:56%*#)(+, &!$-$-! &,(+)*#%&, -!$#%*+)( )+$%#*!-(,&#()+*%&$!- ,!+(,#*)-$%& :;=4<>765839;94<5:6>83=79:6543>7;=8<<4=;:>385679>64=3:9;85<78=67>345;:9<%$+) #,(-!*&$&) -%(#!*+,&%(-)*#,$+! (!+*,#$)- %&+ )#$%-*!&(,)#(%+*!&$,- 73=86>:<54;935469:<=8;>7576983=:;>4<68=37>;45<:9=<4>;:5389674>6:=389;75<,*+!(#% -)$&*-)(&% +!$#,-,(&!*+%$#) ()#*%+$!& ,-+(!#*,-$)& %)+ %#$!-*,&(7;>8<=:69435398657<>4;=:5:<94;=73>8664>3:=;89<75=68>375;49<:4=<:>;853796,$#! +%(&)*-*&!(-, #)$+%-% &)$+,*#!(","I 4/m -3 2/m":" !#$%#$!& %&# !#$%&$!& %!# %#$!&$%& ! &%$&!$#% # #%$#!$&% &!#!$#% &! &%$$%& !& %#$!#&$%& !# %#$!%&$!& %# !#$%$#! #% &!$&$&! &% #!$#%&% &!$#%$#! ()+*,+*)-(,-+()+*,-*)-(,)+(,+*)-*,-()(-,*-)*+,(+(+,*+)*-,(-)+)*+,(-)(-,**,-()-(,+*)+-*,-()+(,+*),-*)-(,+()+*,*+)(+,(-)*-*-)(-,(+)*+,-,(-)*+,*+)(","I 41/a -3 2/d":" !#*%+$)-(,&# !+*%-$)&(,!# %+*)-$,&(:3=8<>7694;5;54697<>83=:97654;=:3>8<$%&(!- ,+*)#&$%-(!+ ,#*)%&$!-(,+ )#*4<97358;=:6>6>:;=8357<94=8;>:694<573()+$,#*!& %-+()#$,&*!- %)+(,#$!&*%- 7;>46=:<5839398<5:6=4;>75:<983>7;=46*,- )&(%#$!+-*,& )#(%+$!,-*)& %#(!+$865:;943>7<=<=73>4;9:658>43=7<5869:;","P 1 1 2":" !#$%#","P 1 1 21":" !#$%+","B 1 1 2":" !#$%#(g+*%+","A 1 2 1":" !#$!& )+$)-","C 1 21 1":" !#$)&()#*!&","I 1 2 1":" !#$!&.'/0'2","I 1 21 1":" !#$)&.'/0!-","P 1 1 m":" !# !&","P 1 1 b":" !# )&","B 1 1 m":" !# !&(!+(!-","B 1 1 b":" !# )&(!+()-","P 1 1 2/m":" !# !&$%#$%&","P 1 1 21/m":" !#$%+$%& !-","B 1 1 2/m":" !# !&$%#$%&(!+(!-*%+*%-","P 1 1 2/b":" !#$,#$%& )&","P 1 1 21/b":" !#$%&$,+ )-","B 1 1 2/b":" !#$,#$%& )&(!+*,+*%-()-","P 21 2 2":" !#$!&(%&*%#","P 2 21 2":" !# ,&$)&$%#","P 21 21 2 (a)":" !#*,#.%&$'&","P 21 2 21":" !#$!&(%-*%+","P 2 21 21":" !# %&$)-$,+","C 2 2 21a)":" !#*%+(,&$)-()#$,+ %&*!-","C 2 2 2a":" !#*,#.%&$'&()#$%# ,&*!&","F 2 2 2a":" !#*,#.%&$'& '/*%/.12$!2.!/$,/ %20'2.'#$%# 1&0!&","I 2 2 2a":" !#*,#.%&$'&()+$%+*!- ,-","P 21/m 21/m 2/n a":" !#*,#$)&(%&$%&.'& ,#*!#","P 42 21 2a":" !#*,#%.+'$+$'&.%&! -,*-","I 2 3a":" !#*,#.%&$'&!# ,- '&$%/$# !-*!/$%&.%()+$%+ ,-*!-)+(%&(!-*,#*+()&$)#*,- ,"},$a=/^[1-9]$/;function Oa(r){let e="";return r.length>0&&(e=":"+pt(r).join(" OR :")),new me(e)}class Ra{constructor(e=""){this.name=e,this.partList=[]}get type(){return"Assembly"}addPart(e,t){const n=new La(e,t);return this.partList.push(n),n}getAtomCount(e){return this.partList.reduce(((t,n)=>t+n.getAtomCount(e)),0)}getResidueCount(e){return this.partList.reduce(((t,n)=>t+n.getResidueCount(e)),0)}getInstanceCount(){let e=0;return this.partList.forEach((function(t){e+=t.matrixList.length})),e}isIdentity(e){if(this.partList.length!==1)return!1;const t=this.partList[0];if(t.matrixList.length!==1||!new Matrix4().equals(t.matrixList[0]))return!1;let n=[];return e.eachChain((function(i){n.push(i.chainname)})),n=pt(n),t.chainList.length===n.length}getBoundingBox(e){const t=new Box3;return this.partList.forEach((function(n){const i=n.getBoundingBox(e);t.expandByPoint(i.min),t.expandByPoint(i.max)})),t}getCenter(e){return this.getBoundingBox(e).getCenter(new Vector3)}getSelection(){let e=[];return this.partList.forEach((function(t){e=e.concat(t.chainList)})),Oa(e)}}class La{constructor(e=[],t=[]){this.matrixList=e,this.chainList=t}get type(){return"AssemblyPart"}_getCount(e,t){let n=0;return e.eachChain((i=>{(this.chainList.length===0||this.chainList.includes(i.chainname))&&(n+=i[t])})),this.matrixList.length*n}getAtomCount(e){return this._getCount(e,"atomCount")}getResidueCount(e){return this._getCount(e,"residueCount")}getBoundingBox(e){const t=new Box3,n=new Box3,i=this.getSelection(),s=e.getBoundingBox(i);return this.matrixList.forEach((function(o){n.copy(s).applyMatrix4(o),t.expandByPoint(n.min),t.expandByPoint(n.max)})),t}getSelection(){return Oa(this.chainList)}getView(e){const t=this.getSelection();return t?e.getView(t):e}getInstanceList(){const e=[];for(let t=0,n=this.matrixList.length;t<n;++t)e.push({id:t+1,name:t,matrix:this.matrixList[t]});return e}}class Na{constructor(e){this.structure=e,this.currentModelindex=null,this.currentChainid=null,this.currentResname=null,this.currentResno=null,this.currentInscode=void 0,this.currentHetero=null,this.previousResname="",this.previousHetero=null,this.ai=-1,this.ri=-1,this.ci=-1,this.mi=-1}addResidueType(e){var t,n;const i=this.structure.atomStore,s=this.structure.residueStore,o=this.structure.residueMap,a=(t=this.structure.chemCompMap)===null||t===void 0?void 0:t.dict[this.previousResname],l=s.atomCount[e],d=s.atomOffset[e],u=new Array(l);for(let y=0;y<l;++y)u[y]=i.atomTypeId[d+y];const g=a?.chemCompType,x=a?(n=this.structure.chemCompMap)===null||n===void 0?void 0:n.getBonds(this.previousResname,u):void 0;s.residueTypeId[e]=o.add(this.previousResname,u,this.previousHetero,g,x)}addAtom(e,t,n,i,s,o,a,l){const d=this.structure.atomStore,u=this.structure.residueStore,g=this.structure.chainStore,x=this.structure.modelStore;let y=!1,b=!1,_=!1;this.currentModelindex!==e?(y=!0,b=!0,_=!0,this.mi+=1,this.ci+=1,this.ri+=1):this.currentChainid!==n?(b=!0,_=!0,this.ci+=1,this.ri+=1):this.currentResno===s&&this.currentResname===i&&this.currentInscode===l||(_=!0,this.ri+=1),this.ai+=1,y&&(x.growIfFull(),x.chainOffset[this.mi]=this.ci,x.chainCount[this.mi]=0,x.count+=1,g.modelIndex[this.ci]=this.mi),b&&(g.growIfFull(),g.setChainname(this.ci,t),g.setChainid(this.ci,n),g.residueOffset[this.ci]=this.ri,g.residueCount[this.ci]=0,g.count+=1,g.modelIndex[this.ci]=this.mi,x.chainCount[this.mi]+=1,u.chainIndex[this.ri]=this.ci),_&&(this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>0&&this.addResidueType(this.ri-1),u.growIfFull(),u.resno[this.ri]=s,a!==void 0&&(u.sstruc[this.ri]=a.charCodeAt(0)),l!==void 0&&(u.inscode[this.ri]=l.charCodeAt(0)),u.atomOffset[this.ri]=this.ai,u.atomCount[this.ri]=0,u.count+=1,u.chainIndex[this.ri]=this.ci,g.residueCount[this.ci]+=1),d.count+=1,d.residueIndex[this.ai]=this.ri,u.atomCount[this.ri]+=1,this.currentModelindex=e,this.currentChainid=n,this.currentResname=i,this.currentResno=s,this.currentInscode=l,this.currentHetero=o}finalize(){this.previousResname=this.currentResname,this.previousHetero=this.currentHetero,this.ri>-1&&this.addResidueType(this.ri)}}function za(r,e){if(!e)return;De&&ke.time("assignSecondaryStructure");const t=[];r.eachModel((function(d){d.eachChain((function(u){t.push(u.chainname)}))}));const n=t.slice().sort(),i=[];n.forEach((function(d){i.push(t.indexOf(d))}));const s=e.helices.filter((function(d){return mt(n,d[0])>=0}));s.sort((function(d,u){const g=d[0],x=u[0],y=d[1],b=u[1];if(g===x)return y===b?0:y<b?-1:1;{const _=mt(n,g),h=mt(n,x);return i[_]<i[h]?-1:1}}));const o=r.residueStore;r.eachModel((function(d){let u=0;const g=s.length;if(g===0)return;let x=s[u],y=!1,b=!1;d.eachChain((function(_){let h=!1;if(_.chainname===x[0]){const f=_.residueCount,E=_.residueOffset,m=E+f;for(let S=E;S<m;++S)if(o.resno[S]===x[1]&&o.getInscode(S)===x[2]&&(y=!0),y&&(o.sstruc[S]=x[6],o.resno[S]===x[4]&&o.getInscode(S)===x[5]&&(y=!1,u+=1,u<g?(S=E-1,x=s[u],h=_.chainname!==x[0]):b=!0)),h||b)return}}))}));const a=e.sheets.filter((function(d){return mt(n,d[0])>=0}));a.sort((function(d,u){const g=d[0],x=u[0];if(g===x)return 0;const y=mt(n,g),b=mt(n,x);return i[y]<i[b]?-1:1}));const l=101;r.eachModel((function(d){let u=0;const g=a.length;if(g===0)return;let x=a[u],y=!1,b=!1;d.eachChain((function(_){let h=!1;if(_.chainname===x[0]){const f=_.residueCount,E=_.residueOffset,m=E+f;for(let S=E;S<m;++S)if(o.resno[S]===x[1]&&o.getInscode(S)===x[2]&&(y=!0),y&&(o.sstruc[S]=l,o.resno[S]===x[4]&&o.getInscode(S)===x[5]&&(y=!1,u+=1,u<g?(S=E-1,x=a[u],h=_.chainname!==x[0]):b=!0)),h||b)return}}))})),De&&ke.timeEnd("assignSecondaryStructure")}const Ua=(function(){const r=function(n,i,s,o){const a=n.structure,l=n.residueIndexStart,d=a.getResidueProxy(),u=a.getResidueProxy(),g=a.getAtomProxy(),x=a.getAtomProxy();for(let y=Math.max(0,i-2);y<=i;++y)for(let b=2;b<5;++b){if(y+b>=n.residueCount)continue;d.index=l+y,u.index=l+y+b,g.index=d.traceAtomIndex,x.index=u.traceAtomIndex;const _=g.distanceTo(x);if(Math.abs(_-s[b-2])>o)return!1}return!0},e=function(n,i){return r(n,i,[5.45,5.18,6.37],2.1)},t=function(n,i){return r(n,i,[6.1,10.4,13],1.42)};return function(n){De&&ke.time("calculateSecondaryStructure"),n.eachPolymer((function(i){if(i.residueCount<4)return;if(i.isCg())(function(a){const l=a.residueStore,d=a.residueIndexStart,u=new Ca(a).position,g=new Vector3,x=new Vector3;for(let y=0,b=a.residueCount;y<b;++y){g.fromArray(u.center,3*y),x.fromArray(u.center,3*y+3);const _=g.distanceTo(x);_<2&&_>1&&u.bending[y]<20&&(l.sstruc[d+y]=104,l.sstruc[d+y+1]=104)}})(i);else{if(!i.isProtein())return;(function(a){const l=a.residueStore,d=a.residueIndexStart;for(let u=0,g=a.residueCount;u<g;++u){let x="c";e(a,u)?x="h":t(a,u)&&(x="e"),l.sstruc[d+u]=x.charCodeAt(0)}})(i)}let s,o=0;i.eachResidue((function(a){a.sstruc===s?o+=1:(o===1&&(a.index-=1,a.sstruc="c"),o=1,s=a.sstruc)}))})),De&&ke.timeEnd("calculateSecondaryStructure")}})(),Va="ABCDEFGHIJKLMNOPQRSTUVWXYZ";function ja(r){const e=Va.length;let t=r,n=0,i=Va[t%e];for(;t>=e;)t=Math.floor(t/e),i+=Va[t%e],n+=1;return n>=5&&ke.warn("chainname overflow"),i}function Ga(r,e=!1){De&&ke.time("calculateChainnames");let t=!0;if(r.eachChain((function(n){n.chainname&&(t=!1)})),t){const n=r.modelStore,i=r.chainStore,s=r.residueStore,o=function(_,h,f,E){const m=i.count;for(let S=0;S<E;++S)s.chainIndex[f+S]=m;i.growIfFull(),i.modelIndex[m]=_,i.setChainname(m,h),i.setChainid(m,h),i.residueOffset[m]=f,i.residueCount[m]=E,i.count+=1,n.chainCount[_]+=1},a=r.getAtomProxy(),l=r.getAtomProxy();let d=0,u=0,g=0,x=0;const y=[];s.count===1?y.push({mIndex:0,chainname:"A",rStart:0,rCount:1}):r.eachResidueN(2,(function(_,h){let f=!1;const E=_.backboneType,m=h.backboneType,S=Nn;x=_.index,_.modelIndex!==h.modelIndex||_.moleculeType!==h.moleculeType?f=!0:E!==S&&E===m&&(a.index=_.backboneEndAtomIndex,l.index=h.backboneStartAtomIndex,f=e?!a.hasBondTo(l):!a.connectedTo(l)),f||h.index!==s.count-1||(f=!0,x=h.index),f&&(y.push({mIndex:u,chainname:ja(d),rStart:g,rCount:x-g+1}),d+=1,_.modelIndex!==h.modelIndex&&(d=0,u+=1),h.index===s.count-1&&x!==h.index&&y.push({mIndex:u,chainname:ja(d),rStart:s.count-1,rCount:1}),g=h.index,x=h.index)})),i.count=0,n.chainCount.fill(0,0,n.count),n.chainOffset.fill(0,0,n.count),y.forEach((function(_){o(_.mIndex,_.chainname,_.rStart,_.rCount)}));let b=0;r.eachModel((function(_){n.chainOffset[_.index]=b,b+=n.chainCount[_.index]}))}De&&ke.timeEnd("calculateChainnames")}function Ha(r,e="all"){e!=="none"&&(De&&ke.time("calculateBonds"),Xa(r,!1,e),Ya(r),De&&ke.timeEnd("calculateBonds"))}const qa={"HIS|CD2|CG":2,"HIS|CE1|ND1":2,"ARG|CZ|NH2":2,"PHE|CE1|CZ":2,"PHE|CD2|CE2":2,"PHE|CD1|CG":2,"TRP|CD1|CG":2,"TRP|CD2|CE2":2,"TRP|CE3|CZ3":2,"TRP|CH2|CZ2":2,"ASN|CG|OD1":2,"GLN|CD|OE1":2,"TYR|CD1|CG":2,"TYR|CD2|CE2":2,"TYR|CE1|CZ":2,"ASP|CG|OD1":2,"GLU|CD|OE1":2,"G|C8|N7":2,"G|C4|C5":2,"G|C2|N3":2,"G|C6|O6":2,"C|C4|N3":2,"C|C5|C6":2,"C|C2|O2":2,"A|C2|N3":2,"A|C6|N1":2,"A|C4|C5":2,"A|C8|N7":2,"U|C5|C6":2,"U|C2|O2":2,"U|C4|O4":2,"DG|C8|N7":2,"DG|C4|C5":2,"DG|C2|N3":2,"DG|C6|O6":2,"DC|C4|N3":2,"DC|C5|C6":2,"DC|C2|O2":2,"DA|C2|N3":2,"DA|C6|N1":2,"DA|C4|C5":2,"DA|C8|N7":2,"DT|C5|C6":2,"DT|C2|O2":2,"DT|C4|O4":2};function Wa(r,e,t){return[e,t]=e<t?[e,t]:[t,e],is.includes(r)&&e==="C"&&t==="O"||os.includes(r)&&e==="OP1"&&t==="P"?2:qa[`${r}|${e}|${t}`]||1}function Xa(r,e=!1,t="all"){De&&ke.time("calculateBondsWithin");const n=r.bondStore,i=r.rungBondStore,s=r.getAtomSet(!1),o=r.getAtomProxy(),a=r.getAtomProxy(),l=r.getBondProxy(),d=e?null:(function(g){De&&ke.time("calculateAtomBondMap");var x=[];return g.eachBond((function(y){var b=y.atomIndex1,_=y.atomIndex2;x[b]===void 0&&(x[b]=[]),x[b][_]=y.index})),De&&ke.timeEnd("calculateAtomBondMap"),x})(r);let u;e||t!=="auto"||(u=new Set,d.forEach(((g,x)=>{u.add(x),g.forEach((y=>{u.add(y)}))}))),r.eachResidue((function(g){if(!e&&d){const b=g.atomCount,_=g.atomOffset;if(b>500)return void ke.warn("more than 500 atoms, skip residue for auto-bonding",g.qualifiedName());if(t==="auto"&&g.hetero){for(let w=g.atomOffset;w<g.atomEnd;w++)if(u.has(w))return}const h=g.getBonds(),f=h.atomIndices1,E=h.atomIndices2,m=h.bondOrders,S=f.length;for(let w=0;w<S;++w){const v=f[w],A=E[w],M=v+_,T=A+_,R=d[M];R!==void 0&&R[T]!==void 0?(l.index=R[T],m[g.residueType.getBondIndex(v,A)]=l.bondOrder):(o.index=M,a.index=T,n.addBond(o,a,m[w]))}}const x=g.residueType.traceAtomIndex,y=g.residueType.rungEndAtomIndex;x!==-1&&y!==-1&&(o.index=g.traceAtomIndex,a.index=g.rungEndAtomIndex,i.addBond(o,a),s.set(o.index),s.set(a.index))})),r.atomSetDict.rung=s,De&&ke.timeEnd("calculateBondsWithin")}function Ya(r,e=!1,t=!1){De&&ke.time("calculateBondsBetween");const n=r.bondStore,i=r.backboneBondStore,s=r.getAtomSet(!1),o=r.getAtomProxy(),a=r.getAtomProxy();function l(g,x){const y=g.backboneType,b=x.backboneType;if(y!==Nn&&y===b){o.index=g.backboneEndAtomIndex,a.index=x.backboneStartAtomIndex;let _=!1,h=!1;t&&o.hasBondTo(a)?(_=!1,h=!0):o.connectedTo(a)&&(_=!e,h=!0),_&&n.addBond(o,a,1),h&&(o.index=g.traceAtomIndex,a.index=x.traceAtomIndex,i.addBond(o,a),s.set(o.index),s.set(a.index))}}i.count===0&&i.resize(r.residueStore.count),r.eachResidueN(2,l);const d=r.getResidueProxy(),u=r.getResidueProxy();if(r.eachChain((function(g){g.residueCount!==0&&(d.index=g.residueOffset,u.index=g.residueOffset+g.residueCount-1,l(u,d))})),r.atomSetDict.backbone=s,!e){De&&ke.time("calculateBondsBetween inter");const g=r.spatialHash;r.eachResidue((function(x){x.backboneType!==Nn||x.isWater()||x.eachAtom((function(y){y.isMetal()||g.eachWithin(y.x,y.y,y.z,4,(function(b){a.index=b,y.modelIndex!==a.modelIndex||y.residueIndex===a.residueIndex||a.isMetal()||n.addBondIfConnected(y,a,1)}))}))})),De&&ke.timeEnd("calculateBondsBetween inter")}De&&ke.timeEnd("calculateBondsBetween")}function Ka(r){if(!r.unitcell)return;De&&ke.time("buildUnitcellAssembly");const e=r.unitcell,t=r.center.clone().applyMatrix4(e.cartToFrac),n=t.clone().floor(),i=(function(b){const _=Ea[b],h={};if(_===void 0)return console.warn(`spacegroup '${b}' not found in symop library`),h;const f=[];for(let E=0,m=_.length;E<m;E+=3){const S=[];for(let w=0;w<3;++w)S.push(Fa[_[E+w]]);f.push(S)}return f.forEach((function(E){let m=0;const S=new Matrix4().set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1),w=S.elements;h[E.toString()]=S,E.forEach((function(v){let A=!1,M=!1;for(let T=0,R=v.length;T<R;++T){const P=v[T];if(P==="-")A=!0;else if(P==="+")A=!1;else if(P==="/")M=!0;else if(P==="X")w[0+m]=A?-1:1;else if(P==="Y")w[4+m]=A?-1:1;else if(P==="Z")w[8+m]=A?-1:1;else if($a.test(P)){const L=parseInt(P);M?w[12+m]/=L:w[12+m]=L}else ke.warn(`getSymmetryOperations: unknown token '${P}'`)}m+=1}))})),h})(e.spacegroup),s=new Vector3,o=new Vector3;function a(b){const _=[];return Object.keys(i).forEach((function(h){const f=i[h].clone();s.copy(t).applyMatrix4(f).floor(),o.setFromMatrixPosition(f),o.sub(s),o.add(n),b&&o.add(b),f.setPosition(o),f.multiplyMatrices(e.fracToCart,f),f.multiply(e.cartToFrac),_.push(f)})),_}const l=new Ra("UNITCELL"),d=a(),u=[];if(r.biomolDict.NCS){u.push(new Matrix4,...r.biomolDict.NCS.partList[0].matrixList);const b=[];d.forEach((_=>{u.forEach((h=>{b.push(_.clone().multiply(h))}))})),l.addPart(b)}else l.addPart(d);const g=new Vector3,x=new Ra("SUPERCELL"),y=Array.prototype.concat.call(a(g.set(1,0,0)),a(g.set(0,1,0)),a(g.set(0,0,1)),a(g.set(-1,0,0)),a(g.set(0,-1,0)),a(g.set(0,0,-1)),a(g.set(1,1,0)),a(g.set(1,0,1)),a(g.set(0,1,1)),a(g.set(-1,-1,0)),a(g.set(-1,0,-1)),a(g.set(0,-1,-1)),a(g.set(1,-1,-1)),a(g.set(1,1,-1)),a(g.set(1,-1,1)),a(g.set(-1,1,1)),a(g.set(-1,-1,1)),a(g.set(-1,1,-1)),a(g.set(0,1,-1)),a(g.set(0,-1,1)),a(g.set(1,0,-1)),a(g.set(-1,0,1)),a(g.set(1,-1,0)),a(g.set(-1,1,0)),a(),a(g.set(1,1,1)),a(g.set(-1,-1,-1)));if(r.biomolDict.NCS){const b=[];y.forEach((function(_){u.forEach((function(h){b.push(_.clone().multiply(h))}))})),x.addPart(b)}else x.addPart(y);r.biomolDict.UNITCELL=l,r.biomolDict.SUPERCELL=x,De&&ke.timeEnd("buildUnitcellAssembly")}const Za=["H","C","O","N","S","P"],Qa=["NA","CL","FE"];function Ja(r){let e=r.toUpperCase(),t=0,n=0;for(let s=0;s<e.length;s++)if(e.charCodeAt(s)<65){if(n>0)break;++t}else n=s+1;(t>0||n<e.length)&&(e=e.substring(t,n));const i=e.length;if(i===0)return"";if(i===1)return e;if(i===2){if(Qa.indexOf(e)!==-1)return e;if(Za.indexOf(e[0])!==-1)return e[0];if(e in Xn)return e}return i>=3&&Za.indexOf(e[0])!==-1?e[0]:""}function tc(r){const e=r.bondHash,t=e.countArray,n=e.offsetArray,i=e.indexArray,s=r.getBondProxy();r.eachResidue((function(o){const a=o.residueType;if(a.bonds!==void 0)return;var l=o.atomOffset,d=[],u=[],g=[],x={};const y=l+o.atomCount;o.eachAtom((function(b){const _=b.index,h=n[_];for(let f=0,E=t[_];f<E;++f){s.index=i[h+f];let m=s.atomIndex1;if(m<l||m>=y)continue;let S=s.atomIndex2;if(S<l||S>=y)continue;if(m>S){const v=S;S=m,m=v}const w=m+"|"+S;x[w]===void 0&&(x[w]=!0,d.push(m-l),u.push(S-l),g.push(s.bondOrder))}})),a.bonds={atomIndices1:d,atomIndices2:u,bondOrders:g}}))}const ic=[3,11,19,37,55,87],rc=[4,12,20,38,56,88],nc=[6,15,16,34],sc=[1,7,8,9,17,35,53],oc=[2,10,18,36,54,86],ac=[13,30,31,48,49,50,80,81,82,83,84,85,112],cc=[5,14,32,33,51,52,85],lc=[9,17,35,53,85];class hc{constructor(e,t,n){this.structure=e,this.atomname=t,n=n||Ja(t),this.element=n,this.number=Xn[n]||0,this.vdw=Yn[this.number]||2,this.covalent=Kn[this.number]||1.6}getDefaultValence(){const e=Zn[this.number];return e?e[0]:-1}getValenceList(){return Zn[this.number]||[]}getOuterShellElectronCount(){return Qn[this.number]||2}isMetal(){return this.isAlkaliMetal()||this.isAlkalineEarthMetal()||this.isLanthanide()||this.isActinide()||this.isTransitionMetal()||this.isPostTransitionMetal()}isNonmetal(){return this.isDiatomicNonmetal()||this.isPolyatomicNonmetal()||this.isNobleGas()}isMetalloid(){return cc.includes(this.number)}isHalogen(){return lc.includes(this.number)}isDiatomicNonmetal(){return sc.includes(this.number)}isPolyatomicNonmetal(){return nc.includes(this.number)}isAlkaliMetal(){return ic.includes(this.number)}isAlkalineEarthMetal(){return rc.includes(this.number)}isNobleGas(){return oc.includes(this.number)}isTransitionMetal(){const e=this.number;return e>=21&&e<=29||e>=39&&e<=47||e>=72&&e<=79||e>=104&&e<=108}isPostTransitionMetal(){return ac.includes(this.number)}isLanthanide(){return this.number>=57&&this.number<=71}isActinide(){return this.number>=89&&this.number<=103}}class uc{constructor(e){this.structure=e,this.dict={},this.list=[],this.structure=e}add(e,t){const n=(function(s,o){return s+"|"+o})(e=e.toUpperCase(),t=t?t.toUpperCase():Ja(e));let i=this.dict[n];if(i===void 0){const s=new hc(this.structure,e,t);i=this.list.length,this.dict[n]=i,this.list.push(s)}return i}get(e){return this.list[e]}}class dc{constructor(e,t,n,i,s,o){this.structure=e,this.bondReferenceAtomIndices=[],this.resname=t,this.atomTypeIdList=n,this.hetero=i?1:0,this.chemCompType=s,this.bonds=o,this.atomCount=n.length,this.moleculeType=this.getMoleculeType(),this.backboneType=this.getBackboneType(0),this.backboneEndType=this.getBackboneType(-1),this.backboneStartType=this.getBackboneType(1),this.backboneIndexList=this.getBackboneIndexList();const a=ds[this.backboneType],l=ds[this.backboneStartType],d=ds[this.backboneEndType],u=this.getAtomIndexByName(a.trace);this.traceAtomIndex=nt(u,-1);const g=this.getAtomIndexByName(a.direction1);this.direction1AtomIndex=nt(g,-1);const x=this.getAtomIndexByName(a.direction2);this.direction2AtomIndex=nt(x,-1);const y=this.getAtomIndexByName(l.backboneStart);this.backboneStartAtomIndex=nt(y,-1);const b=this.getAtomIndexByName(d.backboneEnd);let _;this.backboneEndAtomIndex=nt(b,-1),_=ss.includes(t)?this.getAtomIndexByName("N1"):this.getAtomIndexByName("N3"),this.rungEndAtomIndex=nt(_,-1)}getBackboneIndexList(){const e=[];let t;switch(this.moleculeType){case 3:t=hs;break;case 4:case 5:t=us;break;default:return e}const n=this.structure.atomMap,i=this.atomTypeIdList;for(let s=0,o=this.atomCount;s<o;++s){const a=n.get(i[s]);t.includes(a.atomname)&&e.push(s)}return e}getMoleculeType(){return this.isProtein()?3:this.isRna()?4:this.isDna()?5:this.isWater()?1:this.isIon()?2:this.isSaccharide()?6:0}getBackboneType(e){return this.hasProteinBackbone(e)?1:this.hasRnaBackbone(e)?2:this.hasDnaBackbone(e)?3:this.hasCgProteinBackbone(e)?4:this.hasCgRnaBackbone(e)?5:this.hasCgDnaBackbone(e)?6:Nn}isProtein(){return this.chemCompType?zn.includes(this.chemCompType):this.hasAtomWithName("CA","C","N")||is.includes(this.resname)}isCg(){const e=this.backboneType;return e===4||e===5||e===6}isNucleic(){return this.isRna()||this.isDna()}isRna(){return this.chemCompType?Un.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C4'","C4*"],["O2'","O2*","F2'","F2*"])||rs.includes(this.resname)&&this.hasAtomWithName(["O2'","O2*","F2'","F2*"]))}isDna(){return this.chemCompType?Vn.includes(this.chemCompType):this.hetero!==1&&(this.hasAtomWithName(["P","O3'","O3*"],["C3'","C3*"])&&!this.hasAtomWithName(["O2'","O2*","F2'","F2*"])||ns.includes(this.resname))}isHetero(){return this.hetero===1}isIon(){return cs.includes(this.resname)}isWater(){return as.includes(this.resname)}isSaccharide(){return this.chemCompType?jn.includes(this.chemCompType):ls.includes(this.resname)}isStandardAminoacid(){return is.includes(this.resname)}isStandardBase(){return os.includes(this.resname)}hasBackboneAtoms(e,t){const n=ds[t];return e===-1?this.hasAtomWithName(n.trace,n.backboneEnd,n.direction1,n.direction2):e===0?this.hasAtomWithName(n.trace,n.direction1,n.direction2):e===1?this.hasAtomWithName(n.trace,n.backboneStart,n.direction1,n.direction2):this.hasAtomWithName(n.trace,n.backboneStart,n.backboneEnd,n.direction1,n.direction2)}hasProteinBackbone(e){return this.isProtein()&&this.hasBackboneAtoms(e,1)}hasRnaBackbone(e){return this.isRna()&&this.hasBackboneAtoms(e,2)}hasDnaBackbone(e){return this.isDna()&&this.hasBackboneAtoms(e,3)}hasCgProteinBackbone(e){return this.atomCount<7&&this.isProtein()&&this.hasBackboneAtoms(e,4)}hasCgRnaBackbone(e){return this.atomCount<11&&this.isRna()&&this.hasBackboneAtoms(e,5)}hasCgDnaBackbone(e){return this.atomCount<11&&this.isDna()&&this.hasBackboneAtoms(e,6)}hasBackbone(e){return this.hasProteinBackbone(e)||this.hasRnaBackbone(e)||this.hasDnaBackbone(e)||this.hasCgProteinBackbone(e)||this.hasCgRnaBackbone(e)||this.hasCgDnaBackbone(e)}getAtomIndexByName(e){const t=this.atomCount,n=this.structure.atomMap,i=this.atomTypeIdList;if(Array.isArray(e))for(let s=0;s<t;++s){const o=i[s];if(e.includes(n.get(o).atomname))return s}else for(let s=0;s<t;++s){const o=i[s];if(e===n.get(o).atomname)return s}}hasAtomWithName(...e){const t=e.length;for(let n=0;n<t;++n)if(e[n]!==void 0&&this.getAtomIndexByName(e[n])===void 0)return!1;return!0}getBonds(e){return this.bonds===void 0&&(this.bonds=(function(t){const n=t.structure,i=n.getAtomProxy(),s=n.getAtomProxy(),o=t.atomCount,a=t.atomOffset,l=a+o-1,d=[],u=[],g=[];if(o>500)De&&ke.warn("more than 500 atoms, skip residue for auto-bonding",t.qualifiedName());else if(o>50){const x=new Ba(t,!0),y=t.isCg()?1.2:2.3;for(let b=a;b<l;++b){i.index=b;const _=i.covalent+y+.3,h=x.nearest(i,1/0,_*_),f=h.length;for(let E=0;E<f;++E)s.index=h[E].index,i.index<s.index&&i.connectedTo(s)&&(d.push(i.index-a),u.push(s.index-a),g.push(Wa(i.resname,i.atomname,s.atomname)))}}else for(let x=a;x<l;++x){i.index=x;for(let y=x+1;y<=l;++y)s.index=y,i.connectedTo(s)&&(d.push(x-a),u.push(y-a),g.push(Wa(i.resname,i.atomname,s.atomname)))}return{atomIndices1:d,atomIndices2:u,bondOrders:g}})(e)),this.bonds}getRings(){return this.rings===void 0&&this.calculateRings(),this.rings}getBondGraph(){return this.bondGraph===void 0&&this.calculateBondGraph(),this.bondGraph}getAromatic(e){return this.aromaticAtoms===void 0&&this.calculateAromatic(this.structure.getResidueProxy(e.residueIndex)),this.aromaticAtoms}getAromaticRings(e){return this.aromaticRings===void 0&&this.calculateAromatic(e),this.aromaticRings}calculateBondGraph(){const e=this.bondGraph={},t=this.getBonds(),n=t.atomIndices1.length,i=t.atomIndices1,s=t.atomIndices2;for(let o=0;o<n;++o){const a=i[o],l=s[o];(e[a]=e[a]||[]).push(l),(e[l]=e[l]||[]).push(a)}}calculateRings(){const e=(function(t,n){const i={count:n,visited:new Int32Array(n),queue:new Int32Array(n),pred:new Int32Array(n),left:new Int32Array(yc),right:new Int32Array(yc),color:new Int32Array(n),currentColor:0,rings:[],atomRings:[],bonds:t};for(let s=0;s<n;s++)i.visited[s]=-1,i.pred[s]=-1;return i})(this.getBondGraph(),this.atomCount);for(let t=0;t<e.count;t++)e.visited[t]>=0||gc(e,t);this.rings={atomRings:e.atomRings,rings:e.rings}}isAromatic(e){return this.aromaticAtoms=this.getAromatic(e),this.aromaticAtoms[e.index-e.residueAtomOffset]===1}calculateAromatic(e){const t=this.aromaticAtoms=new Uint8Array(this.atomCount),n=this.getRings().rings,i=n.map((o=>(function(a){if(a.some((g=>!mc.includes(g.number))))return!1;let l=0;const d=new lo(3,a.length),u=d.data;return a.forEach((g=>{u[l+0]=g.x,u[l+1]=g.y,u[l+2]=g.z,l+=3})),new ga(d).vecC.length()<fc})(o.map((a=>this.structure.getAtomProxy(a+e.atomOffset)))))),s=this.aromaticRings=[];n.forEach(((o,a)=>{i[a]&&(s.push(o),o.forEach((l=>t[l]=1)))}))}assignBondReferenceAtomIndices(){const e=this.getBondGraph(),t=this.getRings(),n=t.atomRings,i=t.rings,s=this.bonds,o=s.atomIndices1,a=s.atomIndices2,l=s.bondOrders,d=this.bondReferenceAtomIndices,u=s.atomIndices1.length;d.length=0;for(let g=0;g<u;++g){if(l[g]<=1)continue;let x;const y=o[g],b=a[g],_=n[y],h=n[b];if(_&&h){for(let f=0;f<_.length;f++)if(h.indexOf(_[f])!==-1){x=i[_[f]];break}}if(e[y].length>1)for(let f=0;f<e[y].length;++f){const E=e[y][f];if(E!==b&&(x===void 0||x.indexOf(E)!==-1)){d[g]=E;break}}else if(e[b].length>1)for(let f=0;f<e[b].length;++f){const E=e[b][f];if(E!==y&&(x===void 0||x.indexOf(E)!==-1)){d[g]=E;break}}}}getBondIndex(e,t){const n=this.bonds,i=n.atomIndices1,s=n.atomIndices2;let o=i.indexOf(e),a=s.indexOf(t);const l=a;for(;o!==-1;){for(;a!==-1;){if(o===a)return o;a=s.indexOf(t,a+1)}o=i.indexOf(e,o+1),a=l}}getBondReferenceAtomIndex(e,t){const n=this.getBondIndex(e,t);if(n!==void 0)return this.bondReferenceAtomIndices.length===0&&this.assignBondReferenceAtomIndices(),this.bondReferenceAtomIndices[n]}}const mc=[5,6,7,8,14,15,16,32,33,50,51,83],fc=.05;function pc(r,e,t){if(t<e)return;const{pred:n,color:i,left:s,right:o}=r,a=++r.currentColor;let l=e;for(let f=0;f<yc&&(i[l]=a,l=n[l],!(l<0));f++);let d=0,u=0,g=!1,x=0;l=t;for(let f=0;f<yc;f++){if(i[l]===a){x=l,g=!0;break}if(o[u++]=l,l=n[l],l<0)break}if(!g)return;l=e;for(let f=0;f<yc&&(s[d++]=l,x!==l)&&(l=n[l],!(l<0));f++);const y=d+u,b=new Array(y);let _=0;for(let f=0;f<d;f++)b[_++]=s[f];for(let f=u-1;f>=0;f--)b[_++]=o[f];const h=r.rings.length;for(let f=0;f<y;++f){const E=b[f];r.atomRings[E]?r.atomRings[E].push(h):r.atomRings[E]=[h]}r.rings.push(b)}function gc(r,e){const{bonds:t,visited:n,queue:i,pred:s}=r;n[e]=1,i[0]=e;let o=0,a=1;for(;o<a;){const l=i[o++],d=0;if(t[l]===void 0)continue;const u=t[l].length;for(let g=d;g<u;g++){const x=t[l][g];n[x]>0?s[x]!==l&&s[l]!==x&&pc(r,l,x):(n[x]=1,i[a++]=x,s[x]=l)}}}const yc=4;class bc{constructor(e){this.structure=e,this.dict={},this.list=[]}add(e,t,n,i="",s){const o=(function(l,d,u,g=""){return l+"|"+d.join(",")+"|"+(u?1:0)+"|"+g})(e=e.toUpperCase(),t,n,i);let a=this.dict[o];if(a===void 0){const l=new dc(this.structure,e,t,n,i,s);a=this.list.length,this.dict[o]=a,this.list.push(l)}return a}get(e){return this.list[e]}}class _c{constructor(e,t=0){this.structure=e,this.index=t,this.bondStore=e.bondStore,this._v12=new Vector3,this._v13=new Vector3,this._ap1=this.structure.getAtomProxy(),this._ap2=this.structure.getAtomProxy(),this._ap3=this.structure.getAtomProxy()}get atom1(){return this.structure.getAtomProxy(this.atomIndex1)}get atom2(){return this.structure.getAtomProxy(this.atomIndex2)}get atomIndex1(){return this.bondStore.atomIndex1[this.index]}set atomIndex1(e){this.bondStore.atomIndex1[this.index]=e}get atomIndex2(){return this.bondStore.atomIndex2[this.index]}set atomIndex2(e){this.bondStore.atomIndex2[this.index]=e}get bondOrder(){return this.bondStore.bondOrder[this.index]}set bondOrder(e){this.bondStore.bondOrder[this.index]=e}getOtherAtomIndex(e){return e===this.atomIndex1?this.atomIndex2:this.atomIndex1}getOtherAtom(e){return this.structure.getAtomProxy(this.getOtherAtomIndex(e.index))}getReferenceAtomIndex(){const e=this._ap1,t=this._ap2;if(e.index=this.atomIndex1,t.index=this.atomIndex2,e.residueIndex!==t.residueIndex)return;const n=e.index-e.residueAtomOffset,i=t.index-t.residueAtomOffset,s=e.residueType.getBondReferenceAtomIndex(n,i);if(s!==void 0)return s+e.residueAtomOffset;console.warn("No reference atom found",e.index,t.index)}calculateShiftDir(e=new Vector3){const t=this._ap1,n=this._ap2,i=this._ap3,s=this._v12,o=this._v13;t.index=this.atomIndex1,n.index=this.atomIndex2;const a=this.getReferenceAtomIndex();s.subVectors(t,n).normalize(),a!==void 0?(i.index=a,o.subVectors(t,i)):o.copy(t),o.normalize();let l=s.dot(o);return 1-Math.abs(l)<1e-5&&(o.set(1,0,0),l=s.dot(o),1-Math.abs(l)<1e-5&&(o.set(0,1,0),l=s.dot(o))),e.copy(o.sub(s.multiplyScalar(l))).normalize()}qualifiedName(){return this.atomIndex1+"="+this.atomIndex2}clone(){return new _c(this.structure,this.index)}toObject(){return{atomIndex1:this.atomIndex1,atomIndex2:this.atomIndex2,bondOrder:this.bondOrder}}}class xc{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueMap=e.residueMap,this.atomMap=e.atomMap}get entity(){return this.structure.entityList[this.entityIndex]}get entityIndex(){return this.chainStore.entityIndex[this.chainIndex]}get chain(){return this.structure.getChainProxy(this.chainIndex)}get chainIndex(){return this.residueStore.chainIndex[this.index]}set chainIndex(e){this.residueStore.chainIndex[this.index]=e}get atomOffset(){return this.residueStore.atomOffset[this.index]}set atomOffset(e){this.residueStore.atomOffset[this.index]=e}get atomCount(){return this.residueStore.atomCount[this.index]}set atomCount(e){this.residueStore.atomCount[this.index]=e}get atomEnd(){return this.atomOffset+this.atomCount-1}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}get chainid(){return this.chainStore.getChainid(this.chainIndex)}get resno(){return this.residueStore.resno[this.index]}set resno(e){this.residueStore.resno[this.index]=e}get sstruc(){return this.residueStore.getSstruc(this.index)}set sstruc(e){this.residueStore.setSstruc(this.index,e)}get inscode(){return this.residueStore.getInscode(this.index)}set inscode(e){this.residueStore.setInscode(this.index,e)}get residueType(){return this.residueMap.get(this.residueStore.residueTypeId[this.index])}get resname(){return this.residueType.resname}get hetero(){return this.residueType.hetero}get moleculeType(){return this.residueType.moleculeType}get backboneType(){return this.residueType.backboneType}get backboneStartType(){return this.residueType.backboneStartType}get backboneEndType(){return this.residueType.backboneEndType}get traceAtomIndex(){return this.residueType.traceAtomIndex+this.atomOffset}get direction1AtomIndex(){return this.residueType.direction1AtomIndex+this.atomOffset}get direction2AtomIndex(){return this.residueType.direction2AtomIndex+this.atomOffset}get backboneStartAtomIndex(){return this.residueType.backboneStartAtomIndex+this.atomOffset}get backboneEndAtomIndex(){return this.residueType.backboneEndAtomIndex+this.atomOffset}get rungEndAtomIndex(){return this.residueType.rungEndAtomIndex+this.atomOffset}get x(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.x[t];return e/this.atomCount}get y(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.y[t];return e/this.atomCount}get z(){let e=0;for(let t=this.atomOffset;t<=this.atomEnd;++t)e+=this.atomStore.z[t];return e/this.atomCount}eachAtom(e,t){const n=this.atomCount,i=this.atomOffset,s=this.structure._ap,o=i+n;if(t&&t.atomOnlyTest){const a=t.atomOnlyTest;for(let l=i;l<o;++l)s.index=l,a(s)&&e(s)}else for(let a=i;a<o;++a)s.index=a,e(s)}positionToArray(e=[],t=0){return e[t+0]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}isProtein(){return this.residueType.moleculeType===3}isNucleic(){const e=this.residueType.moleculeType;return e===4||e===5}isRna(){return this.residueType.moleculeType===4}isDna(){return this.residueType.moleculeType===5}isCg(){const e=this.residueType.backboneType;return e===4||e===5||e===6}isPolymer(){if(this.structure.entityList.length>0)return this.entity.isPolymer();{const e=this.residueType.moleculeType;return e===3||e===4||e===5}}isHetero(){return this.residueType.hetero===1}isWater(){return this.residueType.moleculeType===1}isIon(){return this.residueType.moleculeType===2}isSaccharide(){return this.residueType.moleculeType===6}isStandardAminoacid(){return this.residueType.isStandardAminoacid()}isStandardBase(){return this.residueType.isStandardBase()}isHelix(){return Hn.includes(this.sstruc)}isSheet(){return qn.includes(this.sstruc)}isTurn(){return Wn.includes(this.sstruc)&&this.isProtein()}getAtomType(e){return this.atomMap.get(this.atomStore.atomTypeId[e])}getResname1(){return es[this.resname.toUpperCase()]||"X"}getBackboneType(e){switch(e){case-1:return this.residueType.backboneStartType;case 1:return this.residueType.backboneEndType;default:return this.residueType.backboneType}}getAtomIndexByName(e){let t=this.residueType.getAtomIndexByName(e);return t!==void 0&&(t+=this.atomOffset),t}hasAtomWithName(e){return this.residueType.hasAtomWithName(e)}getAtomnameList(){console.warn("getAtomnameList - might be expensive");const e=this.atomCount,t=this.atomOffset,n=new Array(e);for(let i=0;i<e;++i)n[i]=this.getAtomType(t+i).atomname;return n}connectedTo(e){const t=this.structure.getAtomProxy(this.backboneEndAtomIndex),n=this.structure.getAtomProxy(e.backboneStartAtomIndex);return!(!t||!n)&&t.connectedTo(n)}getNextConnectedResidue(){const e=this.chainStore.residueOffset[this.chainIndex],t=this.chainStore.residueCount[this.chainIndex],n=this.index+1;if(n<e+t){const i=this.structure.getResidueProxy(n);if(this.connectedTo(i))return i}else if(n===e+t){const i=this.structure.getResidueProxy(e);if(this.connectedTo(i))return i}}getPreviousConnectedResidue(e){const t=this.chainStore.residueOffset[this.chainIndex],n=this.index-1;if(n>=t){const i=nt(e,this.structure.getResidueProxy());if(i.index=n,i.connectedTo(this))return i}else if(n===t-1){const i=this.chainStore.residueCount[this.chainIndex],s=nt(e,this.structure.getResidueProxy());if(s.index=t+i-1,s.connectedTo(this))return s}}getBonds(){return this.residueType.getBonds(this)}getRings(){return this.residueType.getRings()}getAromaticRings(){return this.residueType.getAromaticRings(this)}qualifiedName(e=!1){let t="";return this.resname&&!e&&(t+="["+this.resname+"]"),this.resno!==void 0&&(t+=this.resno),this.inscode&&(t+="^"+this.inscode),this.chain&&(t+=":"+this.chainname),t+="/"+this.modelIndex,t}clone(){return new xc(this.structure,this.index)}toObject(){return{index:this.index,chainIndex:this.chainIndex,atomOffset:this.atomOffset,atomCount:this.atomCount,resno:this.resno,resname:this.resname,sstruc:this.sstruc}}}class vc{constructor(e,t,n){this.structure=e,this.residueIndexStart=t,this.residueIndexEnd=n,this.chainStore=e.chainStore,this.residueStore=e.residueStore,this.atomStore=e.atomStore,this.residueCount=n-t+1;const i=this.structure.getResidueProxy(this.residueIndexStart),s=this.structure.getResidueProxy(this.residueIndexEnd);this.isPrevConnected=i.getPreviousConnectedResidue()!==void 0;const o=s.getNextConnectedResidue();this.isNextConnected=o!==void 0,this.isNextNextConnected=o!==void 0&&o.getNextConnectedResidue()!==void 0,this.isCyclic=s.connectedTo(i),this.__residueProxy=this.structure.getResidueProxy()}get chainIndex(){return this.residueStore.chainIndex[this.residueIndexStart]}get modelIndex(){return this.chainStore.modelIndex[this.chainIndex]}get chainname(){return this.chainStore.getChainname(this.chainIndex)}isProtein(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isProtein()}isCg(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isCg()}isNucleic(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.isNucleic()}getMoleculeType(){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.moleculeType}getBackboneType(e){return this.__residueProxy.index=this.residueIndexStart,this.__residueProxy.getBackboneType(e)}getAtomIndexByType(e,t){this.isCyclic?e===-1?e=this.residueCount-1:e===this.residueCount&&(e=0):(e!==-1||this.isPrevConnected||(e+=1),e!==this.residueCount||this.isNextNextConnected||(e-=1));const n=this.__residueProxy;let i;switch(n.index=this.residueIndexStart+e,t){case"trace":i=n.traceAtomIndex;break;case"direction1":i=n.direction1AtomIndex;break;case"direction2":i=n.direction2AtomIndex;break;default:i=n.getAtomIndexByName(t)}return i}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}))}eachAtomN(e,t,n){const i=this.residueCount,s=new Array(e);for(let a=0;a<e;++a)s[a]=this.structure.getAtomProxy(this.getAtomIndexByType(a,n));t.apply(this,s);for(var o=e;o<i;++o){for(let a=1;a<e;++a)s[a-1].index=s[a].index;s[e-1].index=this.getAtomIndexByType(o,n),t.apply(this,s)}}eachResidue(e){const t=this.structure.getResidueProxy(),n=this.residueCount,i=this.residueIndexStart;for(let s=0;s<n;++s)t.index=i+s,e(t)}qualifiedName(){const e=this.structure.getResidueProxy(this.residueIndexStart),t=this.structure.getResidueProxy(this.residueIndexEnd);return e.qualifiedName()+" - "+t.qualifiedName()}}class wc{constructor(e,t=0){this.structure=e,this.index=t,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get entity(){return this.structure.entityList[this.entityIndex]}get model(){return this.structure.getModelProxy(this.modelIndex)}get entityIndex(){return this.chainStore.entityIndex[this.index]}set entityIndex(e){this.chainStore.entityIndex[this.index]=e}get modelIndex(){return this.chainStore.modelIndex[this.index]}set modelIndex(e){this.chainStore.modelIndex[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.index]}set residueOffset(e){this.chainStore.residueOffset[this.index]=e}get residueCount(){return this.chainStore.residueCount[this.index]}set residueCount(e){this.chainStore.residueCount[this.index]=e}get residueEnd(){return this.residueOffset+this.residueCount-1}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}get chainname(){return this.chainStore.getChainname(this.index)}set chainname(e){this.chainStore.setChainname(this.index,e)}get chainid(){return this.chainStore.getChainid(this.index)}set chainid(e){this.chainStore.setChainid(this.index,e)}eachAtom(e,t){this.eachResidue((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){const n=this.residueCount,i=this.residueOffset,s=this.structure._rp,o=i+n;if(t&&t.test){const a=t.residueOnlyTest;if(a)for(let l=i;l<o;++l)s.index=l,a(s)&&e(s);else for(let l=i;l<o;++l)s.index=l,e(s)}else for(let a=i;a<o;++a)s.index=a,e(s)}eachResidueN(e,t){const n=this.residueCount,i=this.residueOffset,s=i+n;if(n<e)return;const o=new Array(e);for(let a=0;a<e;++a)o[a]=this.structure.getResidueProxy(i+a);t.apply(this,o);for(let a=i+e;a<s;++a){for(let l=0;l<e;++l)o[l].index+=1;t.apply(this,o)}}eachPolymer(e,t){let n=0,i=0;const s=t?t.residueOnlyTest:void 0,o=this.model.structure,a=this.residueCount,l=this.residueOffset,d=l+a,u=this.structure.getResidueProxy(),g=this.structure.getResidueProxy(l),x=this.structure.getAtomProxy(),y=this.structure.getAtomProxy();let b=!0;for(let _=l+1;_<d;++_){u.index=g.index,g.index=_;const h=b?u.backboneEndType:u.backboneType,f=g.backboneType;b&&(n=u.index,b=!1),i=g.index,h!==Nn&&h===f?(x.index=u.backboneEndAtomIndex,y.index=g.backboneStartAtomIndex,x&&y&&x.connectedTo(y)&&(!s||s(u)&&s(g))||(u.index-n>1&&e(new vc(o,n,u.index)),n=i)):(h!==Nn&&u.index-n>1&&e(new vc(o,n,u.index)),n=i)}i-n>1&&this.structure.getResidueProxy(n).backboneEndType&&e(new vc(o,n,i))}qualifiedName(){return":"+this.chainname+"/"+this.modelIndex}clone(){return new wc(this.structure,this.index)}toObject(){return{index:this.index,residueOffset:this.residueOffset,residueCount:this.residueCount,chainname:this.chainname}}}class Ac{constructor(e,t=0){this.structure=e,this.index=t,this.modelStore=e.modelStore,this.chainStore=e.chainStore,this.residueStore=e.residueStore}get chainOffset(){return this.modelStore.chainOffset[this.index]}set chainOffset(e){this.modelStore.chainOffset[this.index]=e}get chainCount(){return this.modelStore.chainCount[this.index]}set chainCount(e){this.modelStore.chainCount[this.index]=e}get residueOffset(){return this.chainStore.residueOffset[this.chainOffset]}get atomOffset(){return this.residueStore.atomOffset[this.residueOffset]}get chainEnd(){return this.chainOffset+this.chainCount-1}get residueEnd(){return this.chainStore.residueOffset[this.chainEnd]+this.chainStore.residueCount[this.chainEnd]-1}get atomEnd(){return this.residueStore.atomOffset[this.residueEnd]+this.residueStore.atomCount[this.residueEnd]-1}get residueCount(){return this.chainCount===0?0:this.residueEnd-this.residueOffset+1}get atomCount(){return this.residueCount===0?0:this.atomEnd-this.atomOffset+1}eachAtom(e,t){this.eachChain((function(n){n.eachAtom(e,t)}),t)}eachResidue(e,t){this.eachChain((function(n){n.eachResidue(e,t)}),t)}eachPolymer(e,t){if(t&&t.chainOnlyTest){const n=t.chainOnlyTest;this.eachChain((function(i){n(i)&&i.eachPolymer(e,t)}))}else this.eachChain((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){const n=this.chainCount,i=this.chainOffset,s=this.structure._cp,o=i+n;if(t&&t.test){const a=t.chainOnlyTest;if(a)for(let l=i;l<o;++l)s.index=l,a(s)&&e(s);else for(let l=i;l<o;++l)s.index=l,e(s)}else for(let a=i;a<o;++a)s.index=a,e(s)}qualifiedName(){return"/"+this.index}clone(){return new Ac(this.structure,this.index)}toObject(){return{index:this.index,chainOffset:this.chainOffset,chainCount:this.chainCount}}}class Sc{constructor(e="",t=""){this.signals={refreshed:new signalsExports.Signal},this.init(e,t)}init(e,t){this.name=e,this.path=t,this.title="",this.id="",this.data={structure:this,"@spatialLookup":void 0,"@valenceModel":void 0},this.header={},this.extraData={},this.atomSetCache={},this.atomSetDict={},this.biomolDict={},this.entityList=[],this.unitcell=void 0,this.frames=[],this.boxes=[],this.validation=void 0,this.bondStore=new _a(0),this.backboneBondStore=new _a(0),this.rungBondStore=new _a(0),this.atomStore=new xa(0),this.residueStore=new va(0),this.chainStore=new wa(0),this.modelStore=new Aa(0),this.atomMap=new uc(this),this.residueMap=new bc(this),this.chemCompMap=void 0,this.bondHash=void 0,this.spatialHash=void 0,this.atomSet=void 0,this.bondSet=void 0,this.center=new Vector3,this.boundingBox=new Box3,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy()}get type(){return"Structure"}finalizeAtoms(){this.atomSet=this.getAtomSet(),this.atomCount=this.atomStore.count,this.boundingBox=this.getBoundingBox(void 0,this.boundingBox),this.center=this.boundingBox.getCenter(new Vector3),this.spatialHash=new Tn(this.atomStore,this.boundingBox)}finalizeBonds(){this.bondSet=this.getBondSet(),this.bondCount=this.bondStore.count,this.bondHash=new ba(this.bondStore,this.atomStore.count),this.atomSetCache={},this.atomSetDict.rung||(this.atomSetDict.rung=this.getAtomSet(!1));for(let e in this.atomSetDict)this.atomSetCache["__"+e]=this.atomSetDict[e].clone()}getBondProxy(e){return new _c(this,e)}getAtomProxy(e){return new ka(this,e)}getResidueProxy(e){return new xc(this,e)}getChainProxy(e){return new wc(this,e)}getModelProxy(e){return new Ac(this,e)}getBondSet(){const e=this.bondStore.count,t=new En(e),n=this.atomSet;if(n)if(n.isAllSet())t.setAll();else if(n.isAllClear())t.clearAll();else{const i=this.getBondProxy();for(let s=0;s<e;++s)i.index=s,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getBackboneBondSet(){const e=this.backboneBondStore.count,t=new En(e),n=this.atomSetCache.__backbone;if(n){const i=this.getBondProxy();i.bondStore=this.backboneBondStore;for(let s=0;s<e;++s)i.index=s,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getRungBondSet(){const e=this.rungBondStore.count,t=new En(e),n=this.atomSetCache.__rung;if(n){const i=this.getBondProxy();i.bondStore=this.rungBondStore;for(let s=0;s<e;++s)i.index=s,n.isSet(i.atomIndex1,i.atomIndex2)&&t.set(i.index)}else t.setAll();return t}getAtomSet(e){const t=this.atomStore.count;if(e===void 0)return new En(t,!0);if(e instanceof En)return e;if(e===!0)return new En(t,!0);if(e&&e.test){const n=e.string;if(n in this.atomSetCache)return this.atomSetCache[n];if(n==="")return new En(t,!0);{const i=new En(t);return this.eachAtom((function(s){i.set(s.index)}),e),this.atomSetCache[n]=i,i}}return e===!1?new En(t):new En(t,!0)}getAtomSetWithinSelection(e,t){const n=this.spatialHash,i=this.getAtomSet(!1),s=this.getAtomProxy();return n&&this.getAtomSet(e).forEach((function(o){s.index=o,n.within(s.x,s.y,s.z,t).forEach((function(a){i.set(a)}))})),i}getAtomSetWithinPoint(e,t){const n=e,i=this.getAtomSet(!1);return this.spatialHash&&this.spatialHash.within(n.x,n.y,n.z,t).forEach((function(s){i.set(s)})),i}getAtomSetWithinVolume(e,t,n,i,s){const o=new ya(e,n,i,s),a=o.getDataPosition(),l=a.length,d=o.matrix.getMaxScaleOnAxis(),u=this.getAtomSet(!1);if(!this.spatialHash)return u;for(let g=0;g<l;g+=3)this.spatialHash.within(a[g],a[g+1],a[g+2],d).forEach((function(x){u.set(x)}));return u}getAtomSetWithinGroup(e){const t=this.atomStore.residueIndex,n=this.getAtomSet(!1),i=this.getResidueProxy();return this.getAtomSet(e).forEach((function(s){i.index=t[s];for(let o=i.atomOffset;o<=i.atomEnd;++o)n.set(o)})),n}getSelection(){}getStructure(){return this}eachEntity(e,t){this.entityList.forEach((function(n){t!==void 0&&n.getEntityType()!==t||e(n)}))}eachBond(e,t){const n=this.getBondProxy();let i;if(t&&t.test&&(i=this.getBondSet(),this.bondSet&&i.intersection(this.bondSet)),i)i.forEach((function(s){n.index=s,e(n)}));else{const s=this.bondStore.count;for(let o=0;o<s;++o)n.index=o,e(n)}}eachAtom(e,t){if(t&&t.test)this.eachModel((function(n){n.eachAtom(e,t)}),t);else{const n=this.atomStore.count,i=this.getAtomProxy();for(let s=0;s<n;++s)i.index=s,e(i)}}eachResidue(e,t){if(t&&t.test){const n=this.modelStore.count,i=this.getModelProxy(),s=t.modelOnlyTest;if(s)for(let o=0;o<n;++o)i.index=o,s(i)&&i.eachResidue(e,t);else for(let o=0;o<n;++o)i.index=o,i.eachResidue(e,t)}else{const n=this.residueStore.count,i=this.getResidueProxy();for(let s=0;s<n;++s)i.index=s,e(i)}}eachResidueN(e,t){const n=this.residueStore.count;if(n<e)return;const i=new Array(e);for(let s=0;s<e;++s)i[s]=this.getResidueProxy(s);t.apply(this,i);for(let s=e;s<n;++s){for(let o=0;o<e;++o)i[o].index+=1;t.apply(this,i)}}eachPolymer(e,t){if(t&&t.modelOnlyTest){const n=t.modelOnlyTest;this.eachModel((function(i){n(i)&&i.eachPolymer(e,t)}))}else this.eachModel((function(n){n.eachPolymer(e,t)}))}eachChain(e,t){if(t&&t.test)this.eachModel((function(n){n.eachChain(e,t)}));else{const n=this.chainStore.count,i=this.getChainProxy();for(let s=0;s<n;++s)i.index=s,e(i)}}eachModel(e,t){const n=this.modelStore.count,i=this.getModelProxy();if(t&&t.test){const s=t.modelOnlyTest;if(s)for(let o=0;o<n;++o)i.index=o,s(i)&&e(i);else for(let o=0;o<n;++o)i.index=o,e(i)}else for(let s=0;s<n;++s)i.index=s,e(i)}getAtomData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,i=nt(t.atomSet,this.atomSet);let s,o;const a={},l=this.getAtomProxy(),d=i.getSize();n&&!n.position||(a.position=new Float32Array(3*d)),n&&!n.color||!t.colorParams||(a.color=new Float32Array(3*d),o=Oe.getScheme(t.colorParams)),n&&!n.picking||(a.picking=new Xs(new Float32Array(d),this.getStructure())),n&&!n.radius||(a.radius=new Float32Array(d),s=new ma(t.radiusParams)),n&&!n.index||(a.index=new Uint32Array(d));const{position:u,color:g,picking:x,radius:y,index:b}=a;return i.forEach(((_,h)=>{const f=3*h;l.index=_,u&&l.positionToArray(u,f),g&&o.atomColorToArray(l,g,f),x&&(x.array[h]=_),y&&(y[h]=s.atomRadius(l)),b&&(b[h]=_)})),a}getBondData(e){const t=Object.assign({},e);t.colorParams&&(t.colorParams.structure=this.getStructure());const n=t.what,i=nt(t.bondSet,this.bondSet),s=nt(t.multipleBond,"off"),o=s!=="off",a=s==="offset",l=nt(t.bondScale,.4),d=nt(t.bondSpacing,1);let u,g;const x={},y=this.getBondProxy();t.bondStore&&(y.bondStore=t.bondStore);const b=this.getAtomProxy(),_=this.getAtomProxy();let h;if(o){const F=y.bondStore.bondOrder;h=0,i.forEach((function(j){h+=F[j]}))}else h=i.getSize();n&&!n.position||(x.position1=new Float32Array(3*h),x.position2=new Float32Array(3*h)),n&&!n.color||!t.colorParams||(x.color=new Float32Array(3*h),x.color2=new Float32Array(3*h),g=Oe.getScheme(t.colorParams)),n&&!n.picking||(x.picking=new Ks(new Float32Array(h),this.getStructure(),t.bondStore)),(!n||n.radius||o&&n.position)&&(u=new ma(t.radiusParams)),n&&!n.radius||(x.radius=new Float32Array(h),t.radius2&&(x.radius2=new Float32Array(h)));const{position1:f,position2:E,color:m,color2:S,picking:w,radius:v,radius2:A}=x;let M,T,R,P,L,O,I=0;const N=new Vector3,k=new Vector3,U=new Vector3;return i.forEach((F=>{if(T=3*I,y.index=F,b.index=y.atomIndex1,_.index=y.atomIndex2,P=y.bondOrder,f)if(o&&P>1){const j=u.atomRadius(b);O=j*l/(.5*P),y.calculateShiftDir(U),a?(L=2*d*j,U.multiplyScalar(L),U.negate(),k.subVectors(_,b).multiplyScalar(Math.max(.1,L/1.88)),b.positionToArray(f,T),_.positionToArray(E,T),P>=2&&(N.addVectors(b,U).add(k).toArray(f,T+3),N.addVectors(_,U).sub(k).toArray(E,T+3),P>=3&&(N.subVectors(b,U).add(k).toArray(f,T+6),N.subVectors(_,U).sub(k).toArray(E,T+6)))):(L=(d-l)*j,U.multiplyScalar(L),P===2?(N.addVectors(b,U).toArray(f,T),N.subVectors(b,U).toArray(f,T+3),N.addVectors(_,U).toArray(E,T),N.subVectors(_,U).toArray(E,T+3)):P===3?(b.positionToArray(f,T),N.addVectors(b,U).toArray(f,T+3),N.subVectors(b,U).toArray(f,T+6),_.positionToArray(E,T),N.addVectors(_,U).toArray(E,T+3),N.subVectors(_,U).toArray(E,T+6)):(b.positionToArray(f,T),_.positionToArray(E,T)))}else b.positionToArray(f,T),_.positionToArray(E,T);if(m&&S&&(g.bondColorToArray(y,1,m,T),g.bondColorToArray(y,0,S,T),o&&P>1))for(M=1;M<P;++M)R=3*M+T,Mi(m,T,R,3),Mi(S,T,R,3);if(w&&w.array&&(w.array[I]=F,o&&P>1))for(M=1;M<P;++M)w.array[I+M]=F;if(v&&(v[I]=u.atomRadius(b),o&&P>1))for(O=v[I]*l/(a?1:.5*P),M=a?1:0;M<P;++M)v[I+M]=O;if(A&&(A[I]=u.atomRadius(_),o&&P>1))for(O=A[I]*l/(a?1:.5*P),M=a?1:0;M<P;++M)A[I+M]=O;I+=o?P:1})),x}getBackboneAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__backbone},e),this.getAtomData(e)}getBackboneBondData(e){return e=Object.assign({bondSet:this.getBackboneBondSet(),bondStore:this.backboneBondStore},e),this.getBondData(e)}getRungAtomData(e){return e=Object.assign({atomSet:this.atomSetCache.__rung},e),this.getAtomData(e)}getRungBondData(e){return e=Object.assign({bondSet:this.getRungBondSet(),bondStore:this.rungBondStore},e),this.getBondData(e)}getBoundingBox(e,t){De&&ke.time("getBoundingBox"),t=t||new Box3;let n=1/0,i=1/0,s=1/0,o=-1/0,a=-1/0,l=-1/0;return this.eachAtom((d=>{const u=d.x,g=d.y,x=d.z;u<n&&(n=u),g<i&&(i=g),x<s&&(s=x),u>o&&(o=u),g>a&&(a=g),x>l&&(l=x)}),e),t.min.set(n,i,s),t.max.set(o,a,l),De&&ke.timeEnd("getBoundingBox"),t}getPrincipalAxes(e){De&&ke.time("getPrincipalAxes");let t=0;const n=new lo(3,this.atomCount),i=n.data;return this.eachAtom((s=>{i[t+0]=s.x,i[t+1]=s.y,i[t+2]=s.z,t+=3}),e),De&&ke.timeEnd("getPrincipalAxes"),new ga(n)}atomCenter(e){return e?this.getBoundingBox(e).getCenter(new Vector3):this.center.clone()}hasCoords(){if(this._hasCoords===void 0){const e=this.atomStore;this._hasCoords=Di(e.x)!==0||Ti(e.x)!==0||Di(e.y)!==0||Ti(e.y)!==0||Di(e.z)!==0||Ti(e.z)!==0||e.count/this.modelStore.count==1}return this._hasCoords}getSequence(e){const t=[],n=this.getResidueProxy();return this.eachAtom((function(i){n.index=i.residueIndex,i.index===n.traceAtomIndex&&t.push(n.getResname1())}),e),t}getAtomIndices(e){if(e&&e.string){const t=[];return this.eachAtom((function(n){t.push(n.index)}),e),new Uint32Array(t)}{const t={what:{index:!0}};return this.getAtomData(t).index}}getChainnameCount(e){const t=new Set;return this.eachChain((function(n){n.residueCount&&t.add(n.chainname)}),e),t.size}updatePosition(e,t=!0){let n=0;this.eachAtom((function(i){i.positionFromArray(e,n),n+=3}),void 0),this._hasCoords=void 0,t&&this.refreshPosition()}refreshPosition(){this.getBoundingBox(void 0,this.boundingBox),this.boundingBox.getCenter(this.center),this.spatialHash=new Tn(this.atomStore,this.boundingBox),this.signals.refreshed.dispatch(this)}dispose(){this.frames&&(this.frames.length=0),this.boxes&&(this.boxes.length=0),this.bondStore.dispose(),this.backboneBondStore.dispose(),this.rungBondStore.dispose(),this.atomStore.dispose(),this.residueStore.dispose(),this.chainStore.dispose(),this.modelStore.dispose(),delete this.bondSet,delete this.atomSet}}const Cc=new Box3,Pc=[An,_n,Sn,wn,Cn,xn,bn,vn,In,Pn,kn,Mn],Ic={aspectRatio:1.5,sphereDetail:2,radialSegments:50,disableImpostor:!1,openEnded:!1,dashedCylinder:!1,labelParams:{},pointSize:2,sizeAttenuation:!1,useTexture:!0,linewidth:2};class kc{constructor(e="shape",t={}){this.boundingBox=new Box3,this.bufferList=[],this.meshCount=0,this._primitiveData={},this.name=e,this.parameters=st(t,Ic),Pc.forEach((n=>{Object.keys(n.fields).forEach((i=>{this._primitiveData[n.getShapeKey(i)]=[]})),this._primitiveData[n.getShapeKey("name")]=[]}))}addBuffer(e){this.bufferList.push(e);const t=e.geometry;return t.boundingBox||t.computeBoundingBox(),this.boundingBox.union(t.boundingBox),this}addMesh(e,t,n,i,s){let o;e=St(e),t=St(t),Array.isArray(n)&&(n=bt(n,e.length)),i&&(i=St(i)),o=i===void 0||i.length==0?{position:e,color:t,index:n}:{position:e,color:t,index:n,normal:i};const a=new eo(this,Object.assign({serial:this.meshCount,name:s},o)),l=new Vo(Object.assign({picking:a},o));return this.bufferList.push(l),Cc.setFromArray(e),this.boundingBox.union(Cc),this.meshCount+=1,this}addSphere(e,t,n,i){return bn.objectToShape(this,{position:e,color:t,radius:n,name:i}),this}addEllipsoid(e,t,n,i,s,o){return Cn.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:s,name:o}),this}addTorus(e,t,n,i,s,o){return Pn.objectToShape(this,{position:e,color:t,radius:n,majorAxis:i,minorAxis:s,name:o}),this}addCylinder(e,t,n,i,s){return wn.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:s}),this}addCone(e,t,n,i,s){return Sn.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:s}),this}addArrow(e,t,n,i,s){return An.objectToShape(this,{position1:e,position2:t,color:n,radius:i,name:s}),this}addBox(e,t,n,i,s,o){return _n.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:s,name:o}),this}addOctahedron(e,t,n,i,s,o){return xn.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:s,name:o}),this}addTetrahedron(e,t,n,i,s,o){return vn.objectToShape(this,{position:e,color:t,size:n,heightAxis:i,depthAxis:s,name:o}),this}addText(e,t,n,i){return In.objectToShape(this,{position:e,color:t,size:n,text:i}),this}addPoint(e,t,n){return kn.objectToShape(this,{position:e,color:t,name:n}),this}addWideline(e,t,n,i,s){return this.parameters.linewidth=i,Mn.objectToShape(this,{position1:e,position2:t,color:n,name:s}),this}addLabel(e,t,n,i){return console.warn("Shape.addLabel is deprecated, use .addText instead"),this.addText(e,t,n,i)}getBufferList(){const e=[];return Pc.forEach((t=>{this._primitiveData[t.getShapeKey("color")].length&&e.push(t.bufferFromShape(this,this.parameters))})),this.bufferList.concat(e)}dispose(){this.bufferList.forEach((function(e){e.dispose()})),this.bufferList.length=0,Pc.forEach((e=>{Object.keys(e.fields).forEach((t=>{this._primitiveData[e.getShapeKey(t)].length=0})),this._primitiveData[e.getShapeKey("name")].length=0}))}get center(){return this._center||(this._center=this.boundingBox.getCenter(new Vector3)),this._center}get type(){return"Shape"}}class Mc extends Nr{constructor(e,t,n){Array.isArray(e)||(e=[e]),super(e,t,n),this.type="buffer",this.parameters=Object.assign({},this.parameters,{colorScheme:null,colorScale:null,colorValue:null,colorDomain:null,colorMode:null}),this.buffer=e,this.init(n)}init(e){super.init(e),this.build()}create(){this.bufferList.push.apply(this.bufferList,this.buffer)}attach(e){this.bufferList.forEach((t=>{this.viewer.add(t),t.setParameters(this.getBufferParams())})),this.setVisibility(this.visible),e()}}const Tc=new Matrix4,Dc=new Matrix3;class Bc extends Vo{constructor(e,t={},n){super((function(l,d){const u=d.attributes.position.array,g=d.index?d.index.array:void 0,x=l.position.length/3,y=u.length/3,b=x*y,_=new Float32Array(3*b),h=new Float32Array(3*b),f=new Float32Array(3*b);let E;return g&&(E=bt(x*g.length,b)),{position:_,color:f,index:E,normal:h,primitiveId:l.primitiveId||Pi(x,y),picking:l.picking}})(e,n),t),this.updateNormals=!1;const i=n.attributes.position.array,s=n.attributes.normal.array,o=n.index?n.index.array:void 0;this.geoPosition=i,this.geoNormal=s,this.geoIndex=o,this.positionCount=e.position.length/3,this.geoPositionCount=i.length/3,this.transformedGeoPosition=new Float32Array(3*this.geoPositionCount),this.transformedGeoNormal=new Float32Array(3*this.geoPositionCount);const a=this.geometry.attributes;if(this.meshPosition=a.position.array,this.meshColor=a.color.array,this.meshNormal=a.normal.array,this.setAttributes(e),o){const l=this.geometry.getIndex();if(!l)return void ke.error("Index is null");this.meshIndex=l.array,this.makeIndex()}}setAttributes(e={},t=!1){const n=this.geometry.attributes;let i,s,o,a,l,d,u,g,x;const y=this.updateNormals;e.position&&(i=e.position,o=this.geoPosition,u=this.meshPosition,l=this.transformedGeoPosition,n.position.needsUpdate=!0,(y||t)&&(a=this.geoNormal,x=this.meshNormal,d=this.transformedGeoNormal,n.normal.needsUpdate=!0)),e.color&&(s=e.color,g=this.meshColor,n.color.needsUpdate=!0);const b=this.positionCount,_=this.geoPositionCount;for(let h=0;h<b;++h){let f,E;const m=h*_*3,S=3*h;if(i&&l&&u&&x&&o&&a&&(l.set(o),Tc.makeTranslation(i[S],i[S+1],i[S+2]),this.applyPositionTransform(Tc,h,S),Hr(Tc.elements,l),u.set(l,m),y&&d?(d.set(a),Dc.getNormalMatrix(Tc),qr(Dc.elements,d),x.set(d,m)):t&&x.set(a,m)),s&&g)for(f=0;f<_;++f)E=m+3*f,g[E]=s[S],g[E+1]=s[S+1],g[E+2]=s[S+2]}}makeIndex(){const e=this.geoIndex,t=this.meshIndex;if(!e)return;const n=this.positionCount,i=this.geoPositionCount,s=3*(e.length/3);for(let o=0;o<n;++o){const a=o*s,l=a+s;t.set(e,a);for(let d=a;d<l;++d)t[d]+=o*i}}}const Fc=new Vector3,Ec=Object.assign({sphereDetail:1},No);class $c extends Bc{constructor(e,t={}){super(e,t,new IcosahedronGeometry(1,nt(t.sphereDetail,1))),this.setAttributes(e,!0)}get defaultParameters(){return Ec}applyPositionTransform(e,t){const n=this._radius[t];Fc.set(n,n,n),e.scale(Fc)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}ze.add("shader/SphereImpostor.vert",`uniform mat4 projectionMatrixInverse;
uniform float clipNear;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
attribute vec2 mapping;
attribute float radius;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
#include matrix_scale
const mat4 D = mat4(
1.0, 0.0, 0.0, 0.0,
0.0, 1.0, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, -1.0
);
mat4 transposeM( in mat4 inMatrix ) {
vec4 i0 = inMatrix[0];
vec4 i1 = inMatrix[1];
vec4 i2 = inMatrix[2];
vec4 i3 = inMatrix[3];
mat4 outMatrix = mat4(
vec4(i0.x, i1.x, i2.x, i3.x),
vec4(i0.y, i1.y, i2.y, i3.y),
vec4(i0.z, i1.z, i2.z, i3.z),
vec4(i0.w, i1.w, i2.w, i3.w)
);
return outMatrix;
}
void ComputePointSizeAndPositionInClipCoordSphere(){
vec2 xbc;
vec2 ybc;
mat4 T = mat4(
radius, 0.0, 0.0, 0.0,
0.0, radius, 0.0, 0.0,
0.0, 0.0, radius, 0.0,
position.x, position.y, position.z, 1.0
);
mat4 R = transposeM( projectionMatrix * modelViewMatrix * T );
float A = dot( R[ 3 ], D * R[ 3 ] );
float B = -2.0 * dot( R[ 0 ], D * R[ 3 ] );
float C = dot( R[ 0 ], D * R[ 0 ] );
xbc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
xbc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sx = abs( xbc[ 0 ] - xbc[ 1 ] ) * 0.5;
A = dot( R[ 3 ], D * R[ 3 ] );
B = -2.0 * dot( R[ 1 ], D * R[ 3 ] );
C = dot( R[ 1 ], D * R[ 1 ] );
ybc[ 0 ] = ( -B - sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
ybc[ 1 ] = ( -B + sqrt( B * B - 4.0 * A * C ) ) / ( 2.0 * A );
float sy = abs( ybc[ 0 ] - ybc[ 1 ] ) * 0.5;
gl_Position.xy = vec2( 0.5 * ( xbc.x + xbc.y ), 0.5 * ( ybc.x + ybc.y ) );
gl_Position.xy -= mapping * vec2( sx, sy );
gl_Position.xy *= gl_Position.w;
}
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
vRadius = radius * matrixScale( modelViewMatrix );
vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
mvPosition.z -= vRadius;
gl_Position = projectionMatrix * vec4( mvPosition.xyz, 1.0 );
ComputePointSizeAndPositionInClipCoordSphere();
vRadiusSq = vRadius * vRadius;
vec4 vPoint4 = projectionMatrixInverse * gl_Position;
vPoint = vPoint4.xyz / vPoint4.w;
vPointViewPosition = -mvPosition.xyz / mvPosition.w;
}`),ze.add("shader/SphereImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying float vRadius;
varying float vRadiusSq;
varying vec3 vPoint;
varying vec3 vPointViewPosition;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool flag2 = false;
bool interior = false;
vec3 cameraPos;
vec3 cameraNormal;
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
bool Impostor( out vec3 cameraPos, out vec3 cameraNormal ){
vec3 cameraSpherePos = -vPointViewPosition;
cameraSpherePos.z += vRadius;
vec3 rayOrigin = mix( vec3( 0.0, 0.0, 0.0 ), vPoint, ortho );
vec3 rayDirection = mix( normalize( vPoint ), vec3( 0.0, 0.0, 1.0 ), ortho );
vec3 cameraSphereDir = mix( cameraSpherePos, rayOrigin - cameraSpherePos, ortho );
float B = dot( rayDirection, cameraSphereDir );
float det = B * B + vRadiusSq - dot( cameraSphereDir, cameraSphereDir );
if( det < 0.0 ){
discard;
return false;
}
float sqrtDet = sqrt( det );
float posT = mix( B + sqrtDet, B + sqrtDet, ortho );
float negT = mix( B - sqrtDet, sqrtDet - B, ortho );
cameraPos = rayDirection * negT + rayOrigin;
#ifdef NEAR_CLIP
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}else if( calcClip( cameraPos ) > 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
flag2 = true;
}
#else
if( calcDepth( cameraPos ) <= 0.0 ){
cameraPos = rayDirection * posT + rayOrigin;
interior = true;
}
#endif
cameraNormal = normalize( cameraPos - cameraSpherePos );
cameraNormal *= float(!interior) * 2.0 - 1.0;
return !interior;
}
void main(void){
bool flag = Impostor( cameraPos, cameraNormal );
#ifdef NEAR_CLIP
if( calcClip( cameraPos ) > 0.0 )
discard;
#endif
gl_FragDepthEXT = calcDepth( cameraPos );
if( !flag ){
#ifdef NEAR_CLIP
if( flag2 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}else if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#else
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
#endif
}
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vNormal = cameraNormal;
vec3 vViewPosition = -cameraPos;
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
#include normal_fragment_begin
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);class Oc extends Uo{constructor(e,t,n={}){super(t,n),this.index=bt(this.indexSize,this.attributeSize),this.makeIndex(),this.initIndex(this.index),this.addAttributes({mapping:{type:e,value:null}}),this.setAttributes({primitiveId:Ci(this.size)})}get attributeSize(){return this.size*this.mappingSize}get indexSize(){return this.size*this.mappingIndicesSize}addAttributes(e){const t={};for(const n in e){const i=e[n];t[n]={type:i.type,value:null}}super.addAttributes(t)}getAttributeIndex(e){return 3*e*this.mappingSize}setAttributes(e){e&&!e.position&&e.position1&&e.position2&&(e.position=vi(e.position1,e.position2));const t=this.size,n=this.mappingSize,i=this.geometry.attributes;let s,o,a,l,d,u,g;for(const x in e)if(x!=="index"&&x!=="picking"){o=e[x],s=i[x],a=s.itemSize,l=s.array;for(let y=0;y<t;++y){d=y*a,u=d*n;for(let b=0;b<n;++b){g=u+a*b;for(let _=0;_<a;++_)l[g+_]=o[d+_]}}s.needsUpdate=!0}}makeMapping(){const e=this.size,t=this.mapping,n=this.mappingSize,i=this.mappingItemSize,s=this.geometry.attributes.mapping.array;for(let o=0;o<e;o++)s.set(t,o*i*n)}makeIndex(){const e=this.size,t=this.mappingSize,n=this.mappingIndices,i=this.mappingIndicesSize,s=this.index;for(let o=0;o<e;o++){const a=o*i,l=o*t;s.set(n,a);for(let d=0;d<i;++d)s[a+d]+=l}}}const Rc=new Float32Array([-1,1,-1,-1,1,1,1,-1]),Lc=new Uint16Array([0,1,2,1,3,2]);class Nc extends Oc{constructor(e,t={}){super("v2",e,t)}get mapping(){return Rc}get mappingIndices(){return Lc}get mappingIndicesSize(){return 6}get mappingSize(){return 4}get mappingItemSize(){return 2}}class zc extends Nc{constructor(e,t={}){super(e,t),this.isImpostor=!0,this.vertexShader="SphereImpostor.vert",this.fragmentShader="SphereImpostor.frag",this.addUniforms({projectionMatrixInverse:{value:new Matrix4},ortho:{value:0}}),this.addAttributes({radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}}Object.assign({disableImpostor:!1},Ec);const Uc=class{constructor(r,e){return!Pe||e&&e.disableImpostor?new $c(r,e):new zc(r,e)}};function Vc(r,e,t,n){const i=t-r,s=n-e;return Math.sqrt(i*i+s*s)}je.add("sphere",Uc),ze.add("shader/Point.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float size;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
varying vec3 vViewPosition;
#endif
#include common
void main(){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
#include begin_vertex
#include project_vertex
#ifdef USE_SIZEATTENUATION
gl_PointSize = size * pixelRatio * ( ( canvasHeight / 2.0 ) / -mvPosition.z );
#else
gl_PointSize = size * pixelRatio;
#endif
#ifndef PICKING
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),ze.add("shader/Point.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef USE_MAP
uniform sampler2D map;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#include alphatest_pars_fragment
varying vec3 vViewPosition;
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
#ifdef USE_MAP
if( texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) ).a < 0.5 )
discard;
#endif
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
#ifdef USE_MAP
diffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );
#endif
#include color_fragment
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const jc=Object.assign({pointSize:1,sizeAttenuation:!0,sortParticles:!1,alphaTest:.5,useTexture:!1,forceTransparent:!1,edgeBleach:0},No),Gc=Object.assign({pointSize:{uniform:"size"},sizeAttenuation:{updateShader:!0},sortParticles:{},alphaTest:{uniform:!0},useTexture:{updateShader:!0},forceTransparent:{},edgeBleach:{uniform:!0}},zo);class Hc extends Uo{constructor(e,t={}){super(e,t),this.parameterTypes=Gc,this.vertexShader="Point.vert",this.fragmentShader="Point.frag",this.isPoint=!0,this.addUniforms({size:{value:this.parameters.pointSize},canvasHeight:{value:1},pixelRatio:{value:1},map:{value:null},alphaTest:{value:this.parameters.alphaTest}})}get defaultParameters(){return jc}makeMaterial(){super.makeMaterial(),this.makeTexture();const e=this.material,t=this.wireframeMaterial,n=this.pickingMaterial;e.uniforms.map.value=this.tex,e.needsUpdate=!0,t.uniforms.map.value=this.tex,t.needsUpdate=!0,n.uniforms.map.value=this.tex,n.needsUpdate=!0}makeTexture(){this.tex&&this.tex.dispose(),this.tex=(function(e){const t=e||{},n=nt(t.width,256),i=nt(t.height,256),s=[n/2,i/2],o=Math.min(n/2,i/2),a=nt(t.delta,1/(o+1))*o;let l=0,d=0;const u=new Uint8Array(n*i*4);for(let x=0,y=u.length;x<y;x+=4){const b=1-Et(o-a,o,Vc(l,d,s[0],s[1]));u[x]=255*b,u[x+1]=255*b,u[x+2]=255*b,u[x+3]=255*b,++l===n&&(l=0,d++)}const g=new DataTexture(u,n,i);return g.needsUpdate=!0,g})({delta:this.parameters.edgeBleach})}getDefines(e){const t=super.getDefines(e);return this.parameters.sizeAttenuation&&(t.USE_SIZEATTENUATION=1),this.parameters.useTexture&&(t.USE_MAP=1),this.parameters.alphaTest>0&&this.parameters.alphaTest<=1&&(t.USE_ALPHATEST=1),t}setUniforms(e){e&&e.edgeBleach!==void 0&&(this.makeTexture(),e.map=this.tex),super.setUniforms(e)}dispose(){super.dispose(),this.tex&&this.tex.dispose()}}je.add("point",Hc);class qc extends Nr{constructor(e,t,n){super(e,t,n),this.type="dot",this.parameters=Object.assign({thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdOut:{type:"boolean",rebuild:!0},dotType:{type:"select",rebuild:!0,options:{"":"",sphere:"sphere",point:"point"}},radiusType:{type:"select",options:{"":"",value:"value","abs-value":"abs-value","value-min":"value-min",deviation:"deviation",size:"size"}},radius:{type:"number",precision:3,max:10,min:.001,property:"size"},scale:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,disableImpostor:!0,pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{colorScheme:{type:"select",update:"color",options:{"":"",value:"value",uniform:"uniform",random:"random"}}}),e instanceof $o?(this.surface=void 0,this.volume=new ya(e)):(this.surface=e,this.volume=void 0),this.init(n)}init(e){var t=e||{};t.colorScheme=nt(t.colorScheme,"uniform"),t.colorValue=nt(t.colorValue,14540253),this.thresholdType=nt(t.thresholdType,"sigma"),this.thresholdMin=nt(t.thresholdMin,2),this.thresholdMax=nt(t.thresholdMax,1/0),this.thresholdOut=nt(t.thresholdOut,!1),this.dotType=nt(t.dotType,"point"),this.radius=nt(t.radius,.1),this.scale=nt(t.scale,1),this.pointSize=nt(t.pointSize,1),this.sizeAttenuation=nt(t.sizeAttenuation,!0),this.sortParticles=nt(t.sortParticles,!1),this.useTexture=nt(t.useTexture,!1),this.alphaTest=nt(t.alphaTest,.5),this.forceTransparent=nt(t.forceTransparent,!1),this.edgeBleach=nt(t.edgeBleach,0),super.init(t),this.build()}attach(e){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),e()}create(){var e={};if(this.volume){var t,n,i=this.volume;this.thresholdType==="sigma"?(t=i.getValueForSigma(this.thresholdMin),n=i.getValueForSigma(this.thresholdMax)):(t=this.thresholdMin,n=this.thresholdMax),i.setFilter(t,n,this.thresholdOut),Object.assign(e,{position:i.getDataPosition(),color:i.getDataColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:i.getDataSize(this.radius,this.scale),picking:i.getDataPicking()})}else{var s=this.surface;Object.assign(e,{position:s.getPosition(),color:s.getColor(this.getColorParams())}),this.dotType==="sphere"&&Object.assign(e,{radius:s.getSize(this.radius,this.scale),picking:s.getPicking()})}this.dotType==="sphere"?this.dotBuffer=new Uc(e,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!1})):this.dotBuffer=new Hc(e,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach})),this.bufferList.push(this.dotBuffer)}update(e={}){if(this.bufferList.length===0)return;const t={};e.color&&(this.volume?Object.assign(t,{color:this.volume.getDataColor(this.getColorParams())}):Object.assign(t,{color:this.surface.getColor(this.getColorParams())})),this.dotType==="sphere"&&(e.radius||e.scale)&&(this.volume?Object.assign(t,{radius:this.volume.getDataSize(this.radius,this.scale)}):Object.assign(t,{radius:this.surface.getSize(this.radius,this.scale)})),this.dotBuffer.setAttributes(t)}setParameters(e,t={},n){return e&&e.thresholdType!==void 0&&this.volume instanceof $o&&(this.thresholdType==="value"&&e.thresholdType==="sigma"?(this.thresholdMin=this.volume.getSigmaForValue(this.thresholdMin),this.thresholdMax=this.volume.getSigmaForValue(this.thresholdMax)):this.thresholdType==="sigma"&&e.thresholdType==="value"&&(this.thresholdMin=this.volume.getValueForSigma(this.thresholdMin),this.thresholdMax=this.volume.getValueForSigma(this.thresholdMax)),this.thresholdType=e.thresholdType),e&&e.radiusType!==void 0&&(e.radiusType==="radius"?this.radius=.1:this.radius=parseFloat(e.radiusType),t.radius=!0,this.dotType!=="sphere"||Pe&&!this.disableImpostor||(n=!0)),e&&e.radius!==void 0&&(t.radius=!0,this.dotType!=="sphere"||Pe&&!this.disableImpostor||(n=!0)),e&&e.scale!==void 0&&(t.scale=!0,this.dotType!=="sphere"||Pe&&!this.disableImpostor||(n=!0)),super.setParameters(e,t,n),this}}ze.add("shader/Image.vert",`uniform float clipRadius;
uniform vec3 clipCenter;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void main() {
#include begin_vertex
#include project_vertex
vUv = uv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
}`),ze.add("shader/Image.frag",`uniform sampler2D map;
uniform float opacity;
uniform vec2 mapSize;
uniform float clipNear;
uniform float clipRadius;
varying vec2 vUv;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform sampler2D pickingMap;
uniform float objectId;
#else
#include fog_pars_fragment
#endif
#if defined( CUBIC_INTERPOLATION )
#if defined( CATMULROM_FILTER ) || defined( MITCHELL_FILTER )
#if defined( CATMULROM_FILTER )
const float B = 0.0;
const float C = 0.5;
#elif defined( MITCHELL_FILTER )
const float B = 0.333;
const float C = 0.333;
#endif
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f < 1.0 ){
return ( ( 12.0 - 9.0 * B - 6.0 * C ) * ( f * f * f ) +
( -18.0 + 12.0 * B + 6.0 *C ) * ( f * f ) +
( 6.0 - 2.0 * B ) ) / 6.0;
}else if( f >= 1.0 && f < 2.0 ){
return ( ( -B - 6.0 * C ) * ( f * f * f )
+ ( 6.0 * B + 30.0 * C ) * ( f *f ) +
( - ( 12.0 * B ) - 48.0 * C ) * f +
8.0 * B + 24.0 * C ) / 6.0;
}else{
return 0.0;
}
}
#elif defined( BSPLINE_FILTER )
float applyFilter( float x ){
float f = x;
if( f < 0.0 ){
f = -f;
}
if( f >= 0.0 && f <= 1.0 ){
return ( 2.0 / 3.0 ) + ( 0.5 ) * ( f * f * f ) - ( f * f );
}else if( f > 1.0 && f <= 2.0 ){
return 1.0 / 6.0 * pow( ( 2.0 - f ), 3.0 );
}
return 1.0;
}
#else
float applyFilter( float x ){
return 1.0;
}
#endif
vec4 biCubic( sampler2D tex, vec2 texCoord ){
vec2 texelSize = 1.0 / mapSize;
texCoord -= texelSize / 2.0;
vec4 nSum = vec4( 0.0 );
float nDenom = 0.0;
vec2 cell = fract( texCoord * mapSize );
for( float m = -1.0; m <= 2.0; ++m ){
for( float n = -1.0; n <= 2.0; ++n ){
vec4 vecData = texture2D(
tex, texCoord + texelSize * vec2( m, n )
);
float c = applyFilter( m - cell.x ) * applyFilter( -n + cell.y );
nSum += vecData * c;
nDenom += c;
}
}
return nSum / nDenom;
}
#endif
void main(){
#include nearclip_fragment
#include radiusclip_fragment
#if defined( CUBIC_INTERPOLATION )
gl_FragColor = biCubic( map, vUv );
#else
gl_FragColor = texture2D( map, vUv );
#endif
#if defined( PICKING )
if( gl_FragColor.a < 0.3 )
discard;
gl_FragColor = vec4( texture2D( pickingMap, vUv ).xyz, objectId );
#else
if( gl_FragColor.a < 0.01 )
discard;
gl_FragColor.a *= opacity;
#include fog_fragment
#endif
}`);const Wc=new Uint16Array([0,1,2,1,3,2]),Xc=new Float32Array([0,1,0,0,1,1,1,0]),Yc=Object.assign({filter:"nearest",forceTransparent:!0},No),Kc=Object.assign({filter:{updateShader:!0,uniform:!0}},zo);class Zc extends Uo{constructor(e,t){super({position:e.position,index:Wc,picking:e.picking},t),this.parameterTypes=Kc,this.alwaysTransparent=!0,this.hasWireframe=!1,this.vertexShader="Image.vert",this.fragmentShader="Image.frag";const{imageData:n,width:i,height:s}=e,o=new DataTexture(n,i,s);o.flipY=!0,this.tex=o;const a=n.length,l=new Uint8Array(a);for(let u=0;u<a;u+=4){const g=u/4;l[u]=g>>16&255,l[u+1]=g>>8&255,l[u+2]=255&g}const d=new DataTexture(l,i,s);d.flipY=!0,d.minFilter=NearestFilter,d.magFilter=NearestFilter,this.pickingTex=d,this.addUniforms({map:{value:o},pickingMap:{value:d},mapSize:{value:new Vector2(i,s)}}),this.geometry.setAttribute("uv",new BufferAttribute(Xc,2))}get defaultParameters(){return Yc}getDefines(e){const t=super.getDefines(e),n=this.parameters.filter;return n.startsWith("cubic")&&(t.CUBIC_INTERPOLATION=1,n.endsWith("bspline")?t.BSPLINE_FILTER=1:n.endsWith("catmulrom")?t.CATMULROM_FILTER=1:n.endsWith("mitchell")&&(t.MITCHELL_FILTER=1)),t}updateTexture(){const e=this.tex,t=this.parameters.filter;t.startsWith("cubic")?(e.minFilter=NearestFilter,e.magFilter=NearestFilter):t==="linear"?(e.minFilter=LinearFilter,e.magFilter=LinearFilter):(e.minFilter=NearestFilter,e.magFilter=NearestFilter),e.needsUpdate=!0,this.pickingTex.needsUpdate=!0}makeMaterial(){super.makeMaterial(),this.updateTexture();const e=this.material;e.uniforms.map.value=this.tex,e.blending=NormalBlending,e.needsUpdate=!0;const t=this.wireframeMaterial;t.uniforms.map.value=this.tex,t.blending=NormalBlending,t.needsUpdate=!0;const n=this.pickingMaterial;n.uniforms.map.value=this.tex,n.uniforms.pickingMap.value=this.pickingTex,n.blending=NormalBlending,n.needsUpdate=!0}setUniforms(e){e&&e.filter!==void 0&&(this.updateTexture(),e.map=this.tex),super.setUniforms(e)}}class Qc{constructor(e,t){const n=t||{};this.dimension=nt(n.dimension,"x"),this.positionType=nt(n.positionType,"percent"),this.position=nt(n.position,30),this.thresholdType=nt(n.thresholdType,"sigma"),this.thresholdMin=nt(n.thresholdMin,-1/0),this.thresholdMax=nt(n.thresholdMax,1/0),this.normalize=nt(n.normalize,!1),this.volume=e}getPositionFromCoordinate(e){const t=this.dimension,n=this.volume,i=n.matrix,s=new Vector3().setFromMatrixPosition(i)[t],o=new Vector3().setFromMatrixScale(i)[t];let a;return a=t==="x"?n.nx:t==="y"?n.ny:n.nz,Math.round(((e-s)/(a/100)+1)/o)}getData(e){e=e||{};const t=this.volume,n=t.data,i=t.matrix;let s;function o(H){return Math.round(H/100*(s-1))}function a(H,B,V,K){return 3*(V*t.ny*t.nx+B*t.nx+H)+K}s=this.positionType==="coordinate"?this.getPositionFromCoordinate(this.position):this.position;const l=new Float32Array(12),d=new Vector3;let u,g,x,y,b,_=0,h=0,f=0,E=t.nx,m=t.ny,S=t.nz;function w(H,B,V,K){d.set(H,B,V).applyMatrix4(i).toArray(l,K)}this.dimension==="x"?(x=o(t.nx),y=t.ny-1,b=t.nz-1,u=t.nz,g=t.ny,_=x,E=_+1,w(x,0,0,0),w(x,y,0,3),w(x,0,b,6),w(x,y,b,9)):this.dimension==="y"?(x=t.nx-1,y=o(t.ny),b=t.nz-1,u=t.nz,g=t.nx,h=y,m=h+1,w(0,y,0,0),w(x,y,0,3),w(0,y,b,6),w(x,y,b,9)):this.dimension==="z"&&(x=t.nx-1,y=t.ny-1,b=o(t.nz),u=t.nx,g=t.ny,f=b,S=f+1,w(0,0,b,0),w(0,y,b,3),w(x,0,b,6),w(x,y,b,9));let v=0,A=0;const M=new Uint8Array(u*g*4),T=new Float32Array(u*g);let R,P;this.thresholdType==="sigma"?(R=t.getValueForSigma(this.thresholdMin),P=t.getValueForSigma(this.thresholdMax)):(R=this.thresholdMin,P=this.thresholdMax);const L=Object.assign({},e.colorParams,{volume:t});this.normalize&&(L.domain=[0,1]);const O=Oe.getScheme(L),I=new Float32Array(3),N=O.getScale();let k,U=0,F=0;if(this.normalize){U=1/0,k=-1/0;for(let H=h;H<m;++H)for(let B=_;B<E;++B)for(let V=f;V<S;++V){const K=n[a(B,H,V,0)/3];K<U&&(U=K),K>k&&(k=K)}F=k-U}for(let H=h;H<m;++H)for(let B=_;B<E;++B)for(let V=f;V<S;++V){const K=a(B,H,V,0)/3;let q=n[K];this.normalize&&(q=(q-U)/F),O.colorToArray(N(q),I),M[v]=Math.round(255*I[0]),M[v+1]=Math.round(255*I[1]),M[v+2]=Math.round(255*I[2]),M[v+3]=q>R&&q<P?255:0,T[A]=K,++A,v+=4}const j=new so(T,t);return{position:l,imageData:M,width:u,height:g,picking:j}}}class Jc extends Nr{constructor(e,t,n){super(e,t,n),this.type="slice",this.parameters=Object.assign({filter:{type:"select",buffer:!0,options:{nearest:"nearest",linear:"linear","cubic-bspline":"cubic-bspline","cubic-catmulrom":"cubic-catmulrom","cubic-mitchell":"cubic-mitchell"}},positionType:{type:"select",rebuild:!0,options:{percent:"percent",coordinate:"coordinate"}},position:{type:"range",step:.1,max:100,min:1,rebuild:!0},dimension:{type:"select",rebuild:!0,options:{x:"x",y:"y",z:"z"}},thresholdType:{type:"select",rebuild:!0,options:{value:"value",sigma:"sigma"}},thresholdMin:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},thresholdMax:{type:"number",precision:3,max:1/0,min:-1/0,rebuild:!0},normalize:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null,linewidth:null,colorScheme:null,roughness:null,metalness:null,diffuse:null}),this.volume=e,this.init(n)}init(e){const t=this.volume,n=e||{};n.colorDomain=nt(n.colorDomain,[t.min,t.max]),n.colorScheme=nt(n.colorScheme,"value"),n.colorScale=nt(n.colorScale,"Spectral"),this.colorScheme="value",this.dimension=nt(n.dimension,"x"),this.filter=nt(n.filter,"cubic-bspline"),this.positionType=nt(n.positionType,"percent"),this.position=nt(n.position,30),this.thresholdType=nt(n.thresholdType,"sigma"),this.thresholdMin=nt(n.thresholdMin,-1/0),this.thresholdMax=nt(n.thresholdMax,1/0),this.normalize=nt(n.normalize,!1),super.init(n),this.build()}attach(e){this.bufferList.forEach((t=>{this.viewer.add(t)})),this.setVisibility(this.visible),e()}create(){const e=new Qc(this.volume,{positionType:this.positionType,position:this.position,dimension:this.dimension,thresholdType:this.thresholdType,thresholdMin:this.thresholdMin,thresholdMax:this.thresholdMax,normalize:this.normalize}),t=new Zc(e.getData({colorParams:this.getColorParams()}),this.getBufferParams({filter:this.filter}));this.bufferList.push(t)}}function tl(r){ke.error(`makeRepresentation: representation type ${r} unknown`)}const el={name:"some element",status:""};class il{constructor(e,t={}){this.stage=e,this.signals={statusChanged:new signalsExports.Signal,nameChanged:new signalsExports.Signal,disposed:new signalsExports.Signal},this.parameters=st(t,this.defaultParameters),this.uuid=Tt()}get defaultParameters(){return el}get name(){return this.parameters.name}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}dispose(){this.signals.disposed.dispatch()}}const rl=Object.assign({visible:!0},el);class nl extends il{constructor(e,t,n={},i){super(e,Object.assign({name:t.type},n)),this.parent=i,this.signals=Object.assign({visibilityChanged:new signalsExports.Signal,parametersChanged:new signalsExports.Signal},this.signals),this.setRepresentation(t)}get defaultParameters(){return rl}get visible(){return this.parameters.visible}get type(){return"representation"}getType(){return this.repr.type}setRepresentation(e){this._disposeRepresentation(),this.repr=e,this.stage.tasks.listen(this.repr.tasks),this.updateVisibility()}_disposeRepresentation(){this.repr&&(this.stage.tasks.unlisten(this.repr.tasks),this.repr.dispose())}dispose(){this.parent&&this.parent.hasRepresentation(this)?this.parent.removeRepresentation(this):(this._disposeRepresentation(),this.signals.disposed.dispatch())}setVisibility(e){return this.parameters.visible=e,this.updateVisibility(),this.signals.visibilityChanged.dispatch(this.parameters.visible),this}getVisibility(){return this.parent?this.parent.parameters.visible&&this.parameters.visible:this.parameters.visible}toggleVisibility(){return this.setVisibility(!this.parameters.visible)}updateVisibility(){this.repr.setVisibility(this.getVisibility())}update(e){return this.repr.update(e),this}build(e){return this.repr.build(e),this}setSelection(e){const t=this.repr;return t.setSelection&&t.setSelection(e),this}setParameters(e){return this.repr.setParameters(e),this.signals.parametersChanged.dispatch(this.repr.getParameters()),this}getParameters(){return this.repr.getParameters()}setColor(e){return this.repr.setColor(e),this}}const sl=new Matrix4,ol=new Vector3,al={name:"",status:"",visible:!0};class cl{constructor(e,t,n={}){this.stage=e,this.object=t,this.signals={representationAdded:new signalsExports.Signal,representationRemoved:new signalsExports.Signal,visibilityChanged:new signalsExports.Signal,matrixChanged:new signalsExports.Signal,statusChanged:new signalsExports.Signal,nameChanged:new signalsExports.Signal,disposed:new signalsExports.Signal},this.reprList=[],this.annotationList=[],this.matrix=new Matrix4,this.position=new Vector3,this.quaternion=new Quaternion,this.scale=new Vector3(1,1,1),this.transform=new Matrix4,this.parameters=st(n,this.defaultParameters),this.uuid=Tt(),this.viewer=e.viewer,this.controls=new ua(this)}get defaultParameters(){return al}get name(){return this.parameters.name}get status(){return this.parameters.status}get visible(){return this.parameters.visible}setPosition(e){return Array.isArray(e)?this.position.fromArray(e):this.position.copy(e),this.updateMatrix(),this}setRotation(e){if(Array.isArray(e))if(e.length===3){const t=new Euler().fromArray(e);this.quaternion.setFromEuler(t)}else this.quaternion.fromArray(e);else e instanceof Euler?this.quaternion.setFromEuler(e):this.quaternion.copy(e);return this.updateMatrix(),this}setScale(e){return this.scale.set(e,e,e),this.updateMatrix(),this}setTransform(e){return this.transform.copy(e),this.updateMatrix(),this}updateMatrix(){const e=this.getCenterUntransformed(ol);this.matrix.makeTranslation(-e.x,-e.y,-e.z),sl.makeRotationFromQuaternion(this.quaternion),this.matrix.premultiply(sl),sl.makeScale(this.scale.x,this.scale.y,this.scale.z),this.matrix.premultiply(sl);const t=this.position;sl.makeTranslation(t.x+e.x,t.y+e.y,t.z+e.z),this.matrix.premultiply(sl),this.matrix.premultiply(this.transform),this.updateRepresentationMatrices(),this.stage.viewer.updateBoundingBox(),this.signals.matrixChanged.dispatch(this.matrix)}updateRepresentationMatrices(){this.reprList.forEach((e=>{e.setParameters({matrix:this.matrix})}))}addAnnotation(e,t,n){const i=new aa(this,e,t,n);return this.annotationList.push(i),i}eachAnnotation(e){this.annotationList.slice().forEach(e)}removeAnnotation(e){const t=this.annotationList.indexOf(e);t!==-1&&(this.annotationList.splice(t,1),e.dispose())}removeAllAnnotations(){this.eachAnnotation((e=>e.dispose())),this.annotationList.length=0}_addRepresentation(e,t,n,i=!1){const s=n||{},o=this.stage.getParameters();s.matrix=this.matrix.clone(),s.quality=s.quality||o.quality,s.disableImpostor=nt(s.disableImpostor,!o.impostor),s.useWorker=nt(s.useWorker,o.workerDefault),s.visible=nt(s.visible,!0);const a=Object.assign({},s,{visible:this.parameters.visible&&s.visible}),l=(function(u,g,x,y){var b;if(De&&ke.time("makeRepresentation "+u),g instanceof Sc){if(!(b=Le.get(u)))return void tl(u)}else if(g instanceof Fo)if(u==="surface")b=Xo;else{if(u!=="dot")return void tl(u);b=qc}else if(g instanceof $o)if(u==="surface")b=Xo;else if(u==="dot")b=qc;else{if(u!=="slice")return void tl(u);b=Jc}else if(g instanceof kc)b=Mc,g=g.getBufferList();else{if(u!=="buffer")return void ke.error("makeRepresentation: object "+g+" unknown");b=Mc}const _=new b(g,x,y);return De&&ke.timeEnd("makeRepresentation "+u),_})(e,t,this.viewer,a),d=new nl(this.stage,l,s,this);return i||(this.reprList.push(d),this.signals.representationAdded.dispatch(d)),d}addBufferRepresentation(e,t){return this._addRepresentation.call(this,"buffer",e,t)}hasRepresentation(e){return this.reprList.indexOf(e)!==-1}eachRepresentation(e){this.reprList.slice().forEach(e)}removeRepresentation(e){const t=this.reprList.indexOf(e);t!==-1&&(this.reprList.splice(t,1),e.dispose(),this.signals.representationRemoved.dispatch(e))}updateRepresentations(e){this.reprList.forEach((t=>t.update(e))),this.stage.viewer.requestRender()}removeAllRepresentations(){this.eachRepresentation((e=>e.dispose()))}dispose(){this.removeAllAnnotations(),this.removeAllRepresentations(),this.reprList.length=0,this.signals.disposed.dispatch()}setVisibility(e){return this.parameters.visible=e,this.eachRepresentation((t=>t.updateVisibility())),this.eachAnnotation((t=>t.updateVisibility())),this.signals.visibilityChanged.dispatch(e),this}setStatus(e){return this.parameters.status=e,this.signals.statusChanged.dispatch(e),this}setName(e){return this.parameters.name=e,this.signals.nameChanged.dispatch(e),this}getBox(...e){return this.getBoxUntransformed(...e).clone().applyMatrix4(this.matrix)}getCenter(...e){return this.getCenterUntransformed(...e).clone().applyMatrix4(this.matrix)}getZoom(...e){return this.stage.getZoomForBox(this.getBox(...e))}getBoxUntransformed(...e){return new Box3}getCenterUntransformed(...e){return this.getBoxUntransformed().getCenter(new Vector3)}autoView(e){this.stage.animationControls.zoomMove(this.getCenter(),this.getZoom(),nt(e,0))}}class ll{constructor(e=[]){this.list=e;const t=e.length;for(let n=0;n<t;++n)e[n].signals.disposed.add(this._remove,this)}_remove(e){const t=this.list.indexOf(e);t!==-1&&this.list.splice(t,1)}get first(){return this.list.length>0?this.list[0]:void 0}forEach(e){return this.list.forEach(e),this}dispose(){return this.forEach((e=>e.dispose()))}}class hl extends ll{setParameters(e){return this.forEach((t=>t.setParameters(e)))}setVisibility(e){return this.forEach((t=>t.setVisibility(e)))}setSelection(e){return this.forEach((t=>t.setSelection(e)))}setColor(e){return this.forEach((t=>t.setColor(e)))}update(e){return this.forEach((t=>t.update(e)))}build(e){return this.forEach((t=>t.build(e)))}dispose(e){return this.forEach((t=>t.dispose()))}}const ul=Object.assign({defaultStep:1,defaultTimeout:50,defaultInterpolateType:"",defaultInterpolateStep:5,defaultMode:"loop",defaultDirection:"forward",initialFrame:0},el);class dl extends il{constructor(e,t,n={}){super(e,Object.assign({name:t.name},n)),this.trajectory=t,this.signals=Object.assign(this.signals,{frameChanged:new signalsExports.Signal,playerChanged:new signalsExports.Signal,countChanged:new signalsExports.Signal,parametersChanged:new signalsExports.Signal}),t.signals.frameChanged.add((i=>{this.signals.frameChanged.dispatch(i)})),t.signals.playerChanged.add((i=>{this.signals.playerChanged.dispatch(i)})),t.signals.countChanged.add((i=>{this.signals.countChanged.dispatch(i)})),n.initialFrame!==void 0&&this.setFrame(n.initialFrame)}get defaultParameters(){return ul}get type(){return"trajectory"}setFrame(e){this.trajectory.setFrame(e)}setParameters(e={}){this.trajectory.setParameters(e),this.signals.parametersChanged.dispatch(e)}dispose(){this.trajectory.dispose(),super.dispose()}}class ml{constructor(e,t){this.name=e,this.path=t,this.coordinates=[],this.boxes=[],this.times=[],this.timeOffset=0,this.deltaTime=1}get type(){return"Frames"}}class fl{constructor(e,t){let n,i;if(this.A=new lo(3,3),this.W=new lo(1,3),this.U=new lo(3,3),this.V=new lo(3,3),this.VH=new lo(3,3),this.R=new lo(3,3),this.tmp=new lo(3,3),this.c=new lo(3,3),e instanceof Sc)n=e.atomCount;else{if(!(e instanceof Float32Array))return;n=e.length/3}if(t instanceof Sc)i=t.atomCount;else{if(!(t instanceof Float32Array))return;i=t.length/3}const s=Math.min(n,i),o=new lo(3,s),a=new lo(3,s);this.coords1t=new lo(s,3),this.coords2t=new lo(s,3),this.transformationMatrix=new Matrix4,this.c.data.set([1,0,0,0,1,0,0,0,-1]),this.prepCoords(e,o,s,!1),this.prepCoords(t,a,s,!1),this._superpose(o,a)}_superpose(e,t){this.mean1=fo(e),this.mean2=fo(t),po(e,this.mean1),po(t,this.mean2),ho(this.coords1t,e),ho(this.coords2t,t),uo(this.A,this.coords2t,this.coords1t),xo(this.A,this.W,this.U,this.V),(function(x,y){const b=x.data,_=y.data,h=b[4],f=b[8],E=b[5],m=b[7],S=b[0],w=S*h,v=S*E,A=b[3],M=b[1],T=A*M,R=b[2],P=A*R,L=b[6],O=L*M,I=L*R,N=1/(w*f-v*m-T*f+P*m+O*E-I*h);_[0]=(h*f-E*m)*N,_[1]=-(M*f-R*m)*N,_[2]=-(-M*E+R*h)*N,_[3]=-(A*f-E*L)*N,_[4]=(S*f-I)*N,_[5]=-(v-P)*N,_[6]=-(-A*m+h*L)*N,_[7]=-(S*m-O)*N,_[8]=(w-T)*N})(this.V,this.VH),mo(this.R,this.U,this.VH),(function(x){const y=x.data;return y[0]*y[4]*y[8]-y[0]*y[5]*y[7]-y[3]*y[1]*y[8]+y[3]*y[2]*y[7]+y[6]*y[1]*y[5]-y[6]*y[2]*y[4]})(this.R)<0&&(De&&ke.log("R not a right handed system"),mo(this.tmp,this.c,this.VH),mo(this.R,this.U,this.tmp));const n=new lo(4,4),i=new lo(4,4),s=new lo(4,4),o=new lo(4,4),a=new lo(4,4),l=new lo(4,4),d=this.R.data,u=this.mean1,g=this.mean2;o.data.set([1,0,0,-u[0],0,1,0,-u[1],0,0,1,-u[2],0,0,0,1]),a.data.set([d[0],d[1],d[2],0,d[3],d[4],d[5],0,d[6],d[7],d[8],0,0,0,0,1]),l.data.set([1,0,0,g[0],0,1,0,g[1],0,0,1,g[2],0,0,0,1]),ho(i,o),uo(n,a,i),ho(s,n),uo(i,l,s),ho(n,i),this.transformationMatrix.elements=n.data}prepCoords(e,t,n,i){let s=0;const o=t.data;let a=3,l=3*n;if(i&&(l=4*n,a=4),e instanceof Sc)e.eachAtom((function(d){s<l&&(o[s+0]=d.x,o[s+1]=d.y,o[s+2]=d.z,i&&(o[s+3]=1),s+=a)}));else if(e instanceof Float32Array)for(;s<l;s+=a)s<l&&(o[s]=e[s],o[s+1]=e[s+1],o[s+2]=e[s+2],i&&(o[s+3]=1));else ke.warn("prepCoords: input type unknown")}transform(e){let t;if(e instanceof Sc)t=e.atomCount;else{if(!(e instanceof Float32Array))return;t=e.length/3}const n=new lo(4,t),i=new lo(t,4);this.prepCoords(e,n,t,!0);const s=this.transformationMatrix,o=s.determinant();if(!o)return o;const a=new lo(4,4);a.data=s.elements,(function(u,g,x){let y=0,b=0,_=0,h=0,f=0,E=0,m=0,S=0;const w=g.cols,v=g.rows,A=x.cols,M=g.data,T=x.data,R=u.data;let P=0;for(;y<v;h+=w,y++)for(m=0,b=0;b<A;S++,m++,b++){for(E=m,f=h,P=0,_=0;_<w;f++,E+=A,_++)P+=M[f]*T[E];R[S]=P}})(i,n,a);let l=0;const d=i.data;if(e instanceof Sc){e.eachAtom((function(x){x.x=d[l],x.y=d[l+1],x.z=d[l+2],l+=4}));const u=new Matrix4;u.copy(s).invert();const g=e.biomolDict;for(let x in g)g.hasOwnProperty(x)&&g[x].partList.forEach((function(y){y.matrixList.forEach((function(b){b.premultiply(s),b.multiply(u)}))}))}else if(e instanceof Float32Array){const u=4*t;for(;l<u;l+=4)e[l]=d[l],e[l+1]=d[l+1],e[l+2]=d[l+2]}else ke.warn("transform: input type unknown");return this.transformationMatrix}}const pl={step:1,timeout:50,start:0,end:0,interpolateType:"",interpolateStep:5,mode:"loop",direction:"forward"};class gl{constructor(e,t={}){this.signals={startedRunning:new signalsExports.Signal,haltedRunning:new signalsExports.Signal},this._run=!1,this._previousTime=0,this._currentTime=0,this._currentStep=1,e.signals.playerChanged.add((i=>{i!==this&&this.pause()}),this);const n=nt(e.frameCount,1);this.traj=e,this.parameters=st(t,pl),this.parameters.end=Math.min(nt(t.end,n-1),n-1),this.parameters.step=nt(t.step,Math.ceil((n+1)/100)),this._currentFrame=this.parameters.start,this._direction=this.parameters.direction==="bounce"?"forward":this.parameters.direction,e.signals.countChanged.add((i=>{this.parameters.end=Math.min(nt(this.parameters.end,i-1),i-1)}),this),this._animate=this._animate.bind(this)}get isRunning(){return this._run}setParameters(e={}){ot(this.parameters,e),e.direction!==void 0&&this.parameters.direction!=="bounce"&&(this._direction=this.parameters.direction)}_animate(){if(!this._run)return;this._currentTime=window.performance.now();const e=this._currentTime-this._previousTime,t=this.parameters.interpolateType?this.parameters.interpolateStep:1,n=this.parameters.timeout/t,i=this.traj;if(i&&i.frameCount&&!i.inProgress&&e>=n)if(this.parameters.interpolateType)if(this._currentStep>this.parameters.interpolateStep&&(this._currentStep=1),this._currentStep===1&&(this._currentFrame=this._nextInterpolated()),i.hasFrame(this._currentFrame)){this._currentStep+=1;const s=this._currentStep/(this.parameters.interpolateStep+1),[o,a,l,d]=this._currentFrame;i.setFrameInterpolated(o,a,l,d,s,this.parameters.interpolateType),this._previousTime=this._currentTime}else i.loadFrame(this._currentFrame);else{const s=this._next();i.hasFrame(s)?(i.setFrame(s),this._previousTime=this._currentTime):i.loadFrame(s)}window.requestAnimationFrame(this._animate)}_next(){const e=this.parameters;let t;return t=this._direction==="forward"?this.traj.currentFrame+e.step:this.traj.currentFrame-e.step,(t>e.end||t<e.start)&&(e.direction==="bounce"&&(this._direction==="forward"?this._direction="backward":this._direction="forward"),e.mode==="once"?(this.pause(),t=e.direction==="forward"?e.end:e.direction==="backward"||this._direction==="forward"?e.start:e.end):this._direction==="forward"?(t=e.start,e.interpolateType&&(t=Math.min(e.end,t+e.step))):(t=e.end,e.interpolateType&&(t=Math.max(e.start,t-e.step)))),t}_nextInterpolated(){const e=this.parameters,t=this._next();let n,i,s;return this._direction==="forward"?(n=Math.max(e.start,t-e.step),i=Math.max(e.start,t-2*e.step),s=Math.max(e.start,t-3*e.step)):(n=Math.min(e.end,t+e.step),i=Math.min(e.end,t+2*e.step),s=Math.min(e.end,t+3*e.step)),[t,n,i,s]}toggle(){this._run?this.pause():this.play()}play(){if(!this._run){this.traj.player!==this&&this.traj.setPlayer(this),this._currentStep=1;const e=this.parameters,t=this.traj.currentFrame;let n=Math.ceil(t/e.step)*e.step;e.direction==="forward"&&t>=e.end?n=e.start:e.direction==="backward"&&t<=e.start&&(n=e.end),this.traj.setFrame(n),this._run=!0,this._animate(),this.signals.startedRunning.dispatch()}}pause(){this._run=!1,this.signals.haltedRunning.dispatch()}stop(){this.pause(),this.traj.setFrame(this.parameters.start)}}class yl{constructor(e,t,n={}){this.signals={countChanged:new signalsExports.Signal,frameChanged:new signalsExports.Signal,playerChanged:new signalsExports.Signal},this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this._frameCount=0,this._currentFrame=-1,this._disposed=!1,this.deltaTime=nt(n.deltaTime,0),this.timeOffset=nt(n.timeOffset,0),this.centerPbc=nt(n.centerPbc,!1),this.removePbc=nt(n.removePbc,!1),this.removePeriodicity=nt(n.removePeriodicity,!1),this.superpose=nt(n.superpose,!1),this.name=e.replace(/^.*[\\/]/,""),this.trajPath=e,this.selection=new me(nt(n.sele,"backbone and not hydrogen")),this.selection.signals.stringChanged.add((()=>{this.selectionIndices=this.structure.getAtomIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}))}get frameCount(){return this._frameCount}get currentFrame(){return this._currentFrame}_init(e){this.setStructure(e),this._loadFrameCount(),this.setPlayer(new gl(this))}_loadFrameCount(){}setStructure(e){this.structure=e,this.atomCount=e.atomCount,this.backboneIndices=this._getIndices(new me("backbone and not hydrogen")),this._makeAtomIndices(),this._saveStructureCoords(),this.selectionIndices=this._getIndices(this.selection),this._resetCache(),this._saveInitialCoords(),this.setFrame(this._currentFrame)}_saveInitialCoords(){this.structure.hasCoords()?(this.initialCoords=new Float32Array(this.structureCoords),this._makeSuperposeCoords()):this.frameCache[0]?(this.initialCoords=new Float32Array(this.frameCache[0]),this._makeSuperposeCoords()):this.loadFrame(0,(()=>this._saveInitialCoords()))}_saveStructureCoords(){this.structureCoords=this.structure.getAtomData({what:{position:!0}}).position}setSelection(e){return this.selection.setString(e),this}_getIndices(e){let t=0;const n=e.test,i=[];return n&&this.structure.eachAtom((s=>{n(s)&&i.push(t),t+=1})),i}_makeSuperposeCoords(){const e=3*this.selectionIndices.length;this.coords1=new Float32Array(e),this.coords2=new Float32Array(e);const t=this.initialCoords,n=this.coords2;for(let i=0;i<e;i+=3){const s=3*this.selectionIndices[i/3];n[i+0]=t[s+0],n[i+1]=t[s+1],n[i+2]=t[s+2]}}_makeAtomIndices(){ke.error("Trajectory._makeAtomIndices not implemented")}_resetCache(){this.frameCache={},this.loadQueue={},this.boxCache={},this.pathCache={},this.frameCacheSize=0,this.initialCoords=new Float32Array(0)}setParameters(e={}){let t=!1;e.centerPbc!==void 0&&e.centerPbc!==this.centerPbc&&(this.centerPbc=e.centerPbc,t=!0),e.removePeriodicity!==void 0&&e.removePeriodicity!==this.removePeriodicity&&(this.removePeriodicity=e.removePeriodicity,t=!0),e.removePbc!==void 0&&e.removePbc!==this.removePbc&&(this.removePbc=e.removePbc,t=!0),e.superpose!==void 0&&e.superpose!==this.superpose&&(this.superpose=e.superpose,t=!0),this.deltaTime=nt(e.deltaTime,this.deltaTime),this.timeOffset=nt(e.timeOffset,this.timeOffset),t&&(this._resetCache(),this.setFrame(this._currentFrame))}hasFrame(e){return Array.isArray(e)?e.every((t=>!!this.frameCache[t])):!!this.frameCache[e]}setFrame(e,t){return e===void 0||(this.inProgress=!0,e===-1||this.frameCache[e]?(this._updateStructure(e),t&&t()):this.loadFrame(e,(()=>{this._updateStructure(e),t&&t()}))),this}_interpolate(e,t,n,i,s,o){const a=this.frameCache;let l;l=o==="spline"?(function(d,u,g,x,y){const b=d.length,_=new Float32Array(b);for(let h=0;h<b;h+=3){const f=h+1,E=h+2;_[h]=Ft(x[h],g[h],u[h],d[h],y,1),_[f]=Ft(x[f],g[f],u[f],d[f],y,1),_[E]=Ft(x[E],g[E],u[E],d[E],y,1)}return _})(a[e],a[t],a[n],a[i],s):(function(d,u,g){const x=d.length,y=new Float32Array(x);for(let b=0;b<x;b+=3){const _=b+1,h=b+2;y[b]=Bt(u[b],d[b],g),y[_]=Bt(u[_],d[_],g),y[h]=Bt(u[h],d[h],g)}return y})(a[e],a[t],s),this.structure.updatePosition(l),this._currentFrame=e,this.signals.frameChanged.dispatch(e)}setFrameInterpolated(e,t,n,i,s,o,a){if(e===void 0)return this;const l=this.frameCache,d=[];return l[i]||d.push(i),l[n]||d.push(n),l[t]||d.push(t),l[e]||d.push(e),d.length?this.loadFrame(d,(()=>{this._interpolate(e,t,n,i,s,o),a&&a()})):(this._interpolate(e,t,n,i,s,o),a&&a()),this}loadFrame(e,t){Array.isArray(e)?e.forEach((n=>{this.loadQueue[n]||this.frameCache[n]||(this.loadQueue[n]=!0,this._loadFrame(n,(()=>{delete this.loadQueue[n]})))})):this.loadQueue[e]||this.frameCache[e]||(this.loadQueue[e]=!0,this._loadFrame(e,(()=>{delete this.loadQueue[e],t&&t()})))}_loadFrame(e,t){ke.error("Trajectory._loadFrame not implemented",e,t)}_updateStructure(e){this._disposed?console.error("updateStructure: traj disposed"):(e===-1?this.structureCoords&&this.structure.updatePosition(this.structureCoords):this.structure.updatePosition(this.frameCache[e]),this.structure.trajectory={name:this.trajPath,frame:e},this._currentFrame=e,this.inProgress=!1,this.signals.frameChanged.dispatch(e))}_doSuperpose(e){const t=3*this.selectionIndices.length,n=this.coords1,i=this.coords2;for(let s=0;s<t;s+=3){const o=3*this.selectionIndices[s/3];n[s+0]=e[o+0],n[s+1]=e[o+1],n[s+2]=e[o+2]}new fl(n,i).transform(e)}_process(e,t,n,i){if(this._setFrameCount(i),t){if(this.backboneIndices.length>0&&this.centerPbc){const s=[t[0],t[4],t[8]],o=(function(a,l,d){return[xi(l,d[0],3,0,a),xi(l,d[1],3,1,a),xi(l,d[2],3,2,a)]})(this.backboneIndices,n,s);(function(a,l,d){if(d[0]===0||d[8]===0||d[4]===0)return;const u=a.length,g=d[0],x=d[1],y=d[2],b=-l[0]+g+g/2,_=-l[1]+x+x/2,h=-l[2]+y+y/2;for(let f=0;f<u;f+=3)a[f+0]=(a[f+0]+b)%g,a[f+1]=(a[f+1]+_)%x,a[f+2]=(a[f+2]+h)%y})(n,o,s)}if(this.removePeriodicity){const s=(function(o){return[Fi(o,3,0),Fi(o,3,1),Fi(o,3,2)]})(n);(function(o,a,l){if(a[0]===0||a[8]===0||a[4]===0)return;const d=o.length;for(let u=3;u<d;u+=3)for(let g=0;g<3;++g){const x=(o[u+g]-l[g])/a[3*g+g];Math.abs(x)>.5&&(o[u+g]-=a[3*g+g]*Math.round(x))}})(n,t,s)}this.removePbc&&(function(s,o){if(o[0]===0||o[8]===0||o[4]===0)return;const a=s.length;for(let l=3;l<a;l+=3)for(let d=0;d<3;++d){const u=s[l+d]-s[l-3+d];if(Math.abs(u)>.9*o[3*d+d])if(u>0)for(let g=0;g<3;++g)s[l+g]-=o[3*d+g];else for(let g=0;g<3;++g)s[l+g]+=o[3*d+g]}})(n,t)}this.selectionIndices.length>0&&this.coords1&&this.superpose&&this._doSuperpose(n),this.frameCache[e]=n,this.boxCache[e]=t,this.frameCacheSize+=1}_setFrameCount(e){e!==this._frameCount&&(this._frameCount=e,this.signals.countChanged.dispatch(e))}dispose(){this._resetCache(),this._disposed=!0,this.player&&this.player.stop()}setPlayer(e){this.player=e,this.signals.playerChanged.dispatch(e)}getFrameTime(e){return this.timeOffset+e*this.deltaTime}}class bl extends yl{constructor(e,t,n){const i=n||{};i.timeOffset=nt(i.timeOffset,e.timeOffset),i.deltaTime=nt(i.deltaTime,e.deltaTime),super("",t,i),this.name=e.name,this.path=e.path,this.frames=e.coordinates,this.boxes=e.boxes,this._init(t)}get type(){return"frames"}_makeAtomIndices(){this.structure.type==="StructureView"?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const i=this.frames[e];if(this.atomIndices){const a=this.atomIndices,l=a.length;n=new Float32Array(3*l);for(let d=0;d<l;++d){const u=3*d,g=3*a[d];n[u+0]=i[g+0],n[u+1]=i[g+1],n[u+2]=i[g+2]}}else n=new Float32Array(i);const s=this.boxes[e],o=this.frames.length;this._process(e,s,n,o),typeof t=="function"&&t()}_loadFrameCount(){this.frames&&this._setFrameCount(this.frames.length)}}class _l extends yl{constructor(e,t,n){super("",t,n),this._init(t)}get type(){return"structure"}_makeAtomIndices(){this.structure.atomSet&&this.structure.atomSet.getSize()<this.structure.atomStore.count?this.atomIndices=this.structure.getAtomIndices():this.atomIndices=void 0}_loadFrame(e,t){let n;const i=this.structure,s=i.frames[e];if(this.atomIndices){const l=this.atomIndices,d=l.length;n=new Float32Array(3*d);for(let u=0;u<d;++u){const g=3*u,x=3*l[u];n[g+0]=s[x+0],n[g+1]=s[x+1],n[g+2]=s[x+2]}}else n=new Float32Array(s);const o=i.boxes[e],a=i.frames.length;this._process(e,o,n,a),typeof t=="function"&&t()}_loadFrameCount(){this._setFrameCount(this.structure.frames.length)}}class xl extends yl{constructor(e,t,n){super(e,t,n),this._init(t)}get type(){return"remote"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),n=t.length;let i=t[0],s=t[0];for(let o=1;o<n;++o){const a=t[o];s+1<a&&(e.push([i,s+1]),i=a),s=a}e.push([i,s+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){const n=new XMLHttpRequest,i=qe.getFrameUrl(this.trajPath,e),s=qe.getFrameParams(this.trajPath,this.atomIndices);n.open("POST",i,!0),n.responseType="arraybuffer",n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.addEventListener("load",(()=>{const o=n.response;if(!o)return void ke.error(`empty arrayBuffer for '${i}'`);const a=new Int32Array(o,0,1)[0],l=new Float32Array(o,8,9),d=new Float32Array(o,44);this._process(e,l,d,a),typeof t=="function"&&t()}),!1),n.send(s)}_loadFrameCount(){const e=new XMLHttpRequest,t=qe.getCountUrl(this.trajPath);e.open("GET",t,!0),e.addEventListener("load",(()=>{this._setFrameCount(parseInt(e.response))}),!1),e.send()}}class vl extends yl{constructor(e,t,n){super("",t,n),this.requestCallback=e,this._init(t)}get type(){return"callback"}_makeAtomIndices(){const e=[];if(this.structure.type==="StructureView"){const t=this.structure.getAtomIndices(),n=t.length;let i=t[0],s=t[0];for(let o=1;o<n;++o){const a=t[o];s+1<a&&(e.push([i,s+1]),i=a),s=a}e.push([i,s+1])}else e.push([0,this.atomCount]);this.atomIndices=e}_loadFrame(e,t){this.requestCallback(((n,i,s,o)=>{this._process(n,i,s,o),typeof t=="function"&&t()}),e,this.atomIndices)}_loadFrameCount(){this.requestCallback((e=>this._setFrameCount(e)))}}Sc.prototype.getView=function(r){return new wl(this,r)};class wl extends Sc{constructor(e,t){super(),this.structure=e,this.selection=t,this.center=new Vector3,this.boundingBox=new Box3,this._bp=this.getBondProxy(),this._ap=this.getAtomProxy(),this._rp=this.getResidueProxy(),this._cp=this.getChainProxy(),this.selection&&this.selection.signals.stringChanged.add(this.refresh,this),this.structure.signals.refreshed.add(this.refresh,this),this.refresh()}init(){}get type(){return"StructureView"}get name(){return this.structure.name}get path(){return this.structure.path}get title(){return this.structure.title}get id(){return this.structure.id}get data(){return this.structure.data}get atomSetDict(){return this.structure.atomSetDict}get biomolDict(){return this.structure.biomolDict}get entityList(){return this.structure.entityList}get unitcell(){return this.structure.unitcell}get frames(){return this.structure.frames}get boxes(){return this.structure.boxes}get validation(){return this.structure.validation}get bondStore(){return this.structure.bondStore}get backboneBondStore(){return this.structure.backboneBondStore}get rungBondStore(){return this.structure.rungBondStore}get atomStore(){return this.structure.atomStore}get residueStore(){return this.structure.residueStore}get chainStore(){return this.structure.chainStore}get modelStore(){return this.structure.modelStore}get atomMap(){return this.structure.atomMap}get residueMap(){return this.structure.residueMap}get bondHash(){return this.structure.bondHash}get spatialHash(){return this.structure.spatialHash}get _hasCoords(){return this.structure._hasCoords}set _hasCoords(e){this.structure._hasCoords=e}refresh(){De&&ke.time("StructureView.refresh"),this.atomSetCache={};const e=this.structure;if(this.selection.isAllSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=e.atomSet.clone(),this.bondSet=e.bondSet.clone();for(let t in this.atomSetDict){const n=this.atomSetDict[t];this.atomSetCache["__"+t]=n.clone()}this.atomCount=e.atomCount,this.bondCount=e.bondCount,this.boundingBox.copy(e.boundingBox),this.center.copy(e.center)}else if(this.selection.isNoneSelection()&&e!==this&&e.atomSet&&e.bondSet){this.atomSet=new En(e.atomCount),this.bondSet=new En(e.bondCount);for(let t in this.atomSetDict)this.atomSetCache["__"+t]=new En(e.atomCount);this.atomCount=0,this.bondCount=0,this.boundingBox.makeEmpty(),this.center.set(0,0,0)}else{this.atomSet=this.getAtomSet(this.selection,!0),e.atomSet&&(this.atomSet=this.atomSet.intersection(e.atomSet)),this.bondSet=this.getBondSet();for(let t in this.atomSetDict){const n=this.atomSetDict[t];this.atomSetCache["__"+t]=n.makeIntersection(this.atomSet)}this.atomCount=this.atomSet.getSize(),this.bondCount=this.bondSet.getSize(),this.boundingBox=this.getBoundingBox(),this.center=this.boundingBox.getCenter(new Vector3)}De&&ke.timeEnd("StructureView.refresh"),this.signals.refreshed.dispatch()}setSelection(e){this.selection=e,this.refresh()}getSelection(e){const t=[];e&&e.string&&t.push(e.string);const n=this.structure.getSelection();n&&n.string&&t.push(n.string),this.selection&&this.selection.string&&t.push(this.selection.string);let i="";return t.length>0&&(i=`( ${t.join(" ) AND ( ")} )`),new me(i)}getStructure(){return this.structure.getStructure()}eachBond(e,t){this.structure.eachBond(e,this.getSelection(t))}eachAtom(e,t){const n=this.getAtomProxy(),i=this.getAtomSet(t),s=this.atomStore.count;if(i.getSize()<s)i.forEach((function(o){n.index=o,e(n)}));else for(let o=0;o<s;++o)n.index=o,e(n)}eachResidue(e,t){this.structure.eachResidue(e,this.getSelection(t))}eachResidueN(e,t){console.error("StructureView.eachResidueN() not implemented")}eachChain(e,t){this.structure.eachChain(e,this.getSelection(t))}eachModel(e,t){this.structure.eachModel(e,this.getSelection(t))}getAtomSet(e,t=!1){let n=this.structure.getAtomSet(e);return!t&&this.atomSet&&(n=n.makeIntersection(this.atomSet)),n}getAtomIndices(e){return this.structure.getAtomIndices(this.getSelection(e))}refreshPosition(){return this.structure.refreshPosition()}dispose(){this.selection&&this.selection.signals.stringChanged.remove(this.refresh,this),this.structure.signals.refreshed.remove(this.refresh,this),this.structure=new Sc,delete this.atomSet,delete this.bondSet}}const Al=[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]];function Sl(r,e){let t,n=0;const i={};return e.forEach((function(s){t=0;const o={};s.forEach((function(a){o[r[t++]]=a})),i[r[n++]]=o})),i}const Cl={blosum62:Sl("ARNDCQEGHILKMFPSTWYVBZ?",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:Sl("ACDEFGHIKLMNPQRSTVWY",Al)};class Pl{constructor(e,t,n=-10,i=-1,s="blosum62"){this.seq1=e,this.seq2=t,this.gapPenalty=n,this.gapExtensionPenalty=i,s&&(this.substMatrix=Cl[s])}initMatrices(){this.n=this.seq1.length,this.m=this.seq2.length,this.score=void 0,this.ali="",this.S=[],this.V=[],this.H=[];for(let e=0;e<=this.n;++e){this.S[e]=[],this.V[e]=[],this.H[e]=[];for(let t=0;t<=this.m;++t)this.S[e][t]=0,this.V[e][t]=0,this.H[e][t]=0}for(let e=0;e<=this.n;++e)this.S[e][0]=this.gap(0),this.H[e][0]=-1/0;for(let e=0;e<=this.m;++e)this.S[0][e]=this.gap(0),this.V[0][e]=-1/0;this.S[0][0]=0}gap(e){return this.gapPenalty+e*this.gapExtensionPenalty}makeScoreFn(){const e=this.seq1,t=this.seq2,n=this.substMatrix;return n?function(i,s){const o=e[i],a=t[s];try{return n[o][a]}catch{return-4}}:(ke.warn("Alignment: no subst matrix"),function(i,s){return e[i]===t[s]?5:-3})}calc(){De&&ke.time("Alignment.calc"),this.initMatrices();const e=this.gap(0),t=this.makeScoreFn(),n=this.gapExtensionPenalty,i=this.V,s=this.H,o=this.S,a=this.n,l=this.m;let d,u,g,x,y;for(let b=1;b<=a;++b){u=o[b-1],d=i[b-1],g=i[b],x=s[b],y=o[b];for(let _=1;_<=l;++_)g[_]=Math.max(u[_]+e,d[_]+n),x[_]=Math.max(y[_-1]+e,x[_-1]+n),y[_]=Math.max(u[_-1]+t(b-1,_-1),g[_],x[_])}De&&ke.timeEnd("Alignment.calc"),De&&ke.log(this.S,this.V,this.H)}trace(){De&&ke.time("Alignment.trace"),this.ali1="",this.ali2="";const e=this.makeScoreFn();let t,n=this.n,i=this.m;for(this.S[n][i]>=this.V[n][i]?(t="S",this.score=this.S[n][i]):this.V[n][i]>=this.H[n][i]?(t="V",this.score=this.V[n][i]):(t="H",this.score=this.H[n][i]),De&&ke.log("Alignment: SCORE",this.score),De&&ke.log("Alignment: S, V, H",this.S[n][i],this.V[n][i],this.H[n][i]);n>0&&i>0;)t==="S"?this.S[n][i]===this.S[n-1][i-1]+e(n-1,i-1)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--n,--i,t="S"):this.S[n][i]===this.V[n][i]?t="V":this.S[n][i]===this.H[n][i]?t="H":(--n,--i):t==="V"?this.V[n][i]===this.V[n-1][i]+this.gapExtensionPenalty?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="V"):this.V[n][i]===this.S[n-1][i]+this.gap(0)?(this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n,t="S"):--n:t==="H"?this.H[n][i]===this.H[n][i-1]+this.gapExtensionPenalty?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,t="H"):this.H[n][i]===this.S[n][i-1]+this.gap(0)?(this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i,t="S"):--i:ke.error("Alignment: no matrix");for(;n>0;)this.ali1=this.seq1[n-1]+this.ali1,this.ali2="-"+this.ali2,--n;for(;i>0;)this.ali1="-"+this.ali1,this.ali2=this.seq2[i-1]+this.ali2,--i;De&&ke.timeEnd("Alignment.trace"),De&&ke.log([this.ali1,this.ali2])}}function Il(r,e,t=!1,n="",i=""){let s,o,a,l,d;if(t){let g=r,x=e;n&&i&&(g=r.getView(new me(n)),x=e.getView(new me(i)));const y=g.getSequence(),b=x.getSequence(),_=new Pl(y.join(""),b.join(""));let h,f;_.calc(),_.trace(),s=0,o=0,a=_.ali1.length;const E=[],m=[];for(let M=0;M<a;++M){const T=_.ali1[M],R=_.ali2[M];h=0,f=0,T==="-"?m[o]=!1:(m[o]=!0,h=1),R==="-"?E[s]=!1:(E[s]=!0,f=1),s+=h,o+=f}const S=[],w=[],v=g.getAtomProxy(),A=x.getAtomProxy();s=0,g.eachResidue((function(M){M.traceAtomIndex!==void 0&&M.traceAtomIndex===M.getAtomIndexByName("CA")&&(E[s]&&(v.index=M.getAtomIndexByName("CA"),S.push(v.x,v.y,v.z)),s+=1)})),s=0,x.eachResidue((function(M){M.traceAtomIndex!==void 0&&M.traceAtomIndex===M.getAtomIndexByName("CA")&&(m[s]&&(A.index=M.getAtomIndexByName("CA"),w.push(A.x,A.y,A.z)),s+=1)})),l=new Float32Array(S),d=new Float32Array(w)}else l=r.getView(new me(`${n} and .CA`)),d=e.getView(new me(`${i} and .CA`));const u=new fl(l,d).transform(r);return r.refreshPosition(),u}const kl=Object.assign({sele:"",defaultAssembly:""},al);class Ml extends cl{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.structure=t,this.trajList=[],this.signals=Object.assign(this.signals,{trajectoryAdded:new signalsExports.Signal,trajectoryRemoved:new signalsExports.Signal,defaultAssemblyChanged:new signalsExports.Signal}),this.initSelection(this.parameters.sele),this.pickBuffer=(function(i){let s=0,o=0;const a=[];return{has:function(l){return a.indexOf(l)!==-1},get:function(l){return a[l]},push:function(l){a[s]=l,s=(i+s+1)%i,++o},get count(){return o},get data(){return a.slice(0,Math.min(o,i))},clear:function(){o=0,s=0,a.length=0}}})(4),this.pickDict=(function(){const i={};return{has:function(s){return i[JSON.stringify(s)]!==void 0},add:function(s,o){i[JSON.stringify(s)]=o},del:function(s){delete i[JSON.stringify(s)]},get values(){return Object.keys(i).map((s=>i[s]))}}})(),this.spacefillRepresentation=this.addRepresentation("spacefill",{sele:"none",opacity:Me.opacity,color:Me.color,disablePicking:!0,radiusType:"data"},!0),this.distanceRepresentation=this.addRepresentation("distance",Me,!0),this.angleRepresentation=this.addRepresentation("angle",Me,!0),this.dihedralRepresentation=this.addRepresentation("dihedral",Me,!0),this.measureRepresentations=new hl([this.spacefillRepresentation,this.distanceRepresentation,this.angleRepresentation,this.dihedralRepresentation]),this.setDefaultAssembly(this.parameters.defaultAssembly),this.structure.signals.refreshed.add((()=>{this.updateRepresentations({position:!0})}))}get defaultParameters(){return kl}get type(){return"structure"}initSelection(e){this.selection=new me(e),this.structureView=new wl(this.structure,this.selection),this.selection.signals.stringChanged.add((()=>{this.structureView.setSelection(this.selection),this.rebuildRepresentations(),this.rebuildTrajectories()}))}setSelection(e){return this.parameters.sele=e,this.selection.setString(e),this}setDefaultAssembly(e){if(this.structure.biomolDict[e]===void 0&&(e=""),this.parameters.defaultAssembly!==e){const t={defaultAssembly:e};this.reprList.forEach((n=>n.setParameters(t))),this.measureRepresentations.setParameters(t),this.parameters.defaultAssembly=e,this.signals.defaultAssemblyChanged.dispatch(e)}return this}rebuildRepresentations(){this.reprList.forEach((e=>{e.build()})),this.measureRepresentations.build()}rebuildTrajectories(){this.trajList.forEach((e=>{e.trajectory.setStructure(this.structureView)}))}updateRepresentations(e){super.updateRepresentations(e),this.measureRepresentations.update(e)}updateRepresentationMatrices(){super.updateRepresentationMatrices(),this.measureRepresentations.setParameters({matrix:this.matrix})}addRepresentation(e,t={},n=!1){t.defaultAssembly=this.parameters.defaultAssembly;const i=this._addRepresentation(e,this.structureView,t,n);return n||i.signals.parametersChanged.add((()=>this.measureUpdate())),i}addTrajectory(e="",t={}){const n=(function(s,o,a){let l;return l=s&&s instanceof ml?new bl(s,o,a):!s&&o.frames?new _l(s,o,a):s&&typeof s=="function"?new vl(s,o,a):new xl(s,o,a),l})(e,this.structureView,t),i=new dl(this.stage,n,t);return this.trajList.push(i),this.signals.trajectoryAdded.dispatch(i),i}removeTrajectory(e){const t=this.trajList.indexOf(e);t!==-1&&this.trajList.splice(t,1),e.dispose(),this.signals.trajectoryRemoved.dispatch(e)}dispose(){this.trajList.slice().forEach((e=>e.dispose())),this.trajList.length=0,this.structure.dispose(),this.measureRepresentations.dispose(),super.dispose()}autoView(e,t){typeof e=="number"&&(t=e,e=""),this.stage.animationControls.zoomMove(this.getCenter(e),this.getZoom(e),nt(t,0))}getBoxUntransformed(e){let t;return t=e?this.structureView.getBoundingBox(new me(e)):this.structureView.boundingBox,t}getCenterUntransformed(e){return e&&typeof e=="string"?this.structure.atomCenter(new me(e)):this.structure.center}superpose(e,t,n,i){return Il(this.structureView,e.structureView,t,n,i),this.updateRepresentations({position:!0}),this}getMaxRepresentationRadius(e){let t=0;const n=this.structure.getAtomProxy(e);return this.eachRepresentation((i=>{if(i.getVisibility()){const s=i.repr;t=Math.max(s.getAtomRadius(n),t)}})),t}measurePick(e){const t=this.pickBuffer.count;if(this.lastPick===e.index&&t>=1){if(t>1){const n=this.pickBuffer.data,i=this.pickBuffer.data.sort();this.pickDict.has(i)?this.pickDict.del(i):this.pickDict.add(i,n),t===2?this.distanceRepresentation.setParameters({atomPair:this.pickDict.values.filter((s=>s.length===2))}):t===3?this.angleRepresentation.setParameters({atomTriple:this.pickDict.values.filter((s=>s.length===3))}):t===4&&this.dihedralRepresentation.setParameters({atomQuad:this.pickDict.values.filter((s=>s.length===4))})}this.pickBuffer.clear(),this.lastPick=void 0}else this.pickBuffer.has(e.index)||this.pickBuffer.push(e.index),this.lastPick=e.index;this.measureUpdate()}measureClear(){this.pickBuffer.clear(),this.lastPick=void 0,this.spacefillRepresentation.setSelection("none")}measureBuild(){const e=this.measureData();this.distanceRepresentation.setParameters({atomPair:e.distance}),this.angleRepresentation.setParameters({atomTriple:e.angle}),this.dihedralRepresentation.setParameters({atomQuad:e.dihedral})}measureUpdate(){const e=this.pickBuffer.data,t={};e.forEach((n=>{const i=Math.max(.1,this.getMaxRepresentationRadius(n));t[n]=i*(2.3-Et(.1,2,i))})),this.spacefillRepresentation.setSelection(e.length?"@"+e.join(","):"none"),e.length&&this.spacefillRepresentation.setParameters({radiusData:t})}measureData(){const e=this.pickDict.values;return{distance:e.filter((t=>t.length===2)),angle:e.filter((t=>t.length===3)),dihedral:e.filter((t=>t.length===4))}}removeAllMeasurements(e){const t=this.pickDict,n=t.values,i=function(s){n.filter((o=>o.length===s)).forEach((o=>t.del(o.slice().sort())))};(!e||1&e)&&i(2),(!e||2&e)&&i(3),(!e||4&e)&&i(4),this.measureBuild()}removeMeasurement(e){this.pickDict.del(e.slice().sort()),this.measureBuild()}addMeasurement(e){if(e.length<2||e.length>4)return;const t=e.slice().sort();this.pickDict.has(t)||this.pickDict.add(t,e),this.measureBuild()}}Ve.add("structure",Ml),Ve.add("structureview",Ml);class Tl extends cl{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.surface=t}get type(){return"surface"}addRepresentation(e,t={}){return this._addRepresentation(e,this.surface,t)}getBoxUntransformed(){return this.surface.boundingBox}getCenterUntransformed(){return this.surface.center}dispose(){this.surface.dispose(),super.dispose()}}Ve.add("surface",Tl);class Dl extends cl{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.volume=t}get type(){return"volume"}addRepresentation(e,t={}){return this._addRepresentation(e,this.volume,t)}getBoxUntransformed(){return this.volume.boundingBox}getCenterUntransformed(){return this.volume.center}dispose(){this.volume.dispose(),super.dispose()}}Ve.add("volume",Dl);class Bl extends ll{addRepresentation(e,t){return this.forEach((n=>n.addRepresentation(e,t)))}autoView(e){return this.forEach((t=>t.autoView(e)))}}function Fl(r,e){return r instanceof RegExp?e.name.match(r)!==null:e.name===r}const El=new Vector3,$l={impostor:!0,quality:"medium",workerDefault:!0,sampleLevel:0,backgroundColor:"black",rotateSpeed:2,zoomSpeed:1.2,panSpeed:1,clipNear:0,clipFar:100,clipDist:10,clipMode:"scene",clipScale:"relative",fogNear:50,fogFar:100,cameraFov:40,cameraEyeSep:.3,cameraType:"perspective",lightColor:14540253,lightIntensity:1.2,ambientColor:14540253,ambientIntensity:.3,hoverTimeout:0,tooltip:!0,mousePreset:"default"};class Ol{constructor(e,t={}){this.signals={parametersChanged:new signalsExports.Signal,fullscreenChanged:new signalsExports.Signal,componentAdded:new signalsExports.Signal,componentRemoved:new signalsExports.Signal,clicked:new signalsExports.Signal,hovered:new signalsExports.Signal},this.tasks=new ui,this.compList=[],this.defaultFileParams={},this.logList=[],this.viewer=new Qi(e),this.viewer.renderer&&(this.tooltip=document.createElement("div"),Object.assign(this.tooltip.style,{display:"none",position:"fixed",zIndex:"1000000",pointerEvents:"none",backgroundColor:"rgba( 0, 0, 0, 0.6 )",color:"lightgrey",padding:"8px",fontFamily:"sans-serif"}),this.viewer.container.appendChild(this.tooltip),this.mouseObserver=new rr(this.viewer.renderer.domElement),this.viewerControls=new Ir(this),this.trackballControls=new pr(this),this.pickingControls=new br(this),this.animationControls=new Rr(this),this.mouseControls=new Qo(this),this.keyControls=new ea(this),this.pickingBehavior=new ia(this),this.mouseBehavior=new ra(this),this.animationBehavior=new na(this),this.keyBehavior=new oa(this),this.spinAnimation=this.animationControls.spin([0,1,0],.005),this.spinAnimation.pause(!0),this.rockAnimation=this.animationControls.rock([0,1,0],.005),this.rockAnimation.pause(!0),this.parameters=st(t,$l),this.setParameters(this.parameters),this.viewer.animate())}setParameters(e={}){ot(this.parameters,e);const t=e,n=this.parameters,i=this.viewer,s=this.trackballControls;return t.quality!==void 0&&this.setQuality(n.quality),t.impostor!==void 0&&this.setImpostor(n.impostor),t.rotateSpeed!==void 0&&(s.rotateSpeed=n.rotateSpeed),t.zoomSpeed!==void 0&&(s.zoomSpeed=n.zoomSpeed),t.panSpeed!==void 0&&(s.panSpeed=n.panSpeed),t.mousePreset!==void 0&&this.mouseControls.preset(n.mousePreset),this.mouseObserver.setParameters({hoverTimeout:n.hoverTimeout}),i.setClip(n.clipNear,n.clipFar,n.clipDist,n.clipMode,n.clipScale),i.setFog(void 0,n.fogNear,n.fogFar),i.setCamera(n.cameraType,n.cameraFov,n.cameraEyeSep),i.setSampling(n.sampleLevel),i.setBackground(n.backgroundColor),i.setLight(n.lightColor,n.lightIntensity,n.ambientColor,n.ambientIntensity),this.signals.parametersChanged.dispatch(this.getParameters()),this}log(e){console.log("STAGE LOG",e),this.logList.push(e)}getParameters(){return Object.assign({},this.parameters)}defaultFileRepresentation(e){if(e instanceof Ml){let t,n,i;e.setSelection("/0");const s=e.structure;if(s.biomolDict.BU1){const g=s.biomolDict.BU1;t=g.getAtomCount(s),n=g.getResidueCount(s),i=g.getInstanceCount(),e.setDefaultAssembly("BU1")}else t=s.getModelProxy(0).atomCount,n=s.getModelProxy(0).residueCount,i=1;let o=t;Ae&&(o*=4);const a=s.atomStore.count/s.residueStore.count<2;a&&(o*=10);let l="chainname",d="RdYlBu",u=!1;if(s.getChainnameCount(new me("polymer and /0"))===1&&(l="residueindex",d="Spectral",u=!0),De&&console.log(o,t,i,a),n/i<4)e.addRepresentation("ball+stick",{colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"});else if(i>5&&o>15e3||o>7e5){let g=Math.min(2,Math.max(.1,6e3/(o/i)));a&&(g=Math.min(g,.5)),e.addRepresentation("surface",{colorScheme:l,colorScale:d,colorReverse:u,sele:"polymer",surfaceType:"av",probeRadius:1.4,scaleFactor:g,useWorker:!1})}else o>25e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:d,colorReverse:u,lineOnly:!0}):o>1e5?e.addRepresentation("backbone",{colorScheme:l,colorScale:d,colorReverse:u,quality:"low",disableImpostor:!0,radiusScale:2}):o>8e4?e.addRepresentation("backbone",{colorScheme:l,colorScale:d,colorReverse:u,radiusScale:2}):(e.addRepresentation("cartoon",{colorScheme:l,colorScale:d,colorReverse:u,radiusScale:.7,aspectRatio:5,quality:"auto"}),o<5e4&&e.addRepresentation("base",{colorScheme:l,colorScale:d,colorReverse:u,quality:"auto"}),e.addRepresentation("ball+stick",{sele:"ligand",colorScheme:"element",radiusScale:2,aspectRatio:1.5,bondScale:.3,bondSpacing:.75,quality:"auto"}));e.structure.frames.length&&e.addTrajectory()}else(e instanceof Tl||e instanceof Dl)&&e.addRepresentation("surface");this.tasks.onZeroOnce(this.autoView,this)}loadFile(e,t={}){const n=Object.assign({},this.defaultFileParams,t),i=ii(e).name;this.tasks.increment(),this.log(`loading file '${i}'`);const s=nt(n.ext,ii(e).ext);let o;return o=Ne.isTrajectory(s)?Promise.reject(new Error(`loadFile: ext '${s}' is a trajectory and must be loaded into a structure component`)):ni(e,n),o.then((a=>{this.log(`loaded '${i}'`);const l=this.addComponentFromObject(a,n);return n.defaultRepresentation&&this.defaultFileRepresentation(l),this.tasks.decrement(),l}),(a=>{this.tasks.decrement();const l=`error loading file: '${a}'`;throw this.log(l),l}))}loadScript(e){const t=ii(e).name;return this.log(`loading script '${t}'`),ni(e).then((n=>{this.tasks.increment(),this.log(`running script '${t}'`),n.run(this).then((()=>{this.tasks.decrement(),this.log(`finished script '${t}'`)})),this.log(`called script '${t}'`)}),(n=>{this.tasks.decrement();const i=`errored script '${t}' "${n}"`;throw this.log(i),i}))}addComponent(e){e?(this.compList.push(e),this.signals.componentAdded.dispatch(e)):ke.warn("Stage.addComponent: no component given")}addComponentFromObject(e,t={}){const n=Ve.get(e.type);if(n){const i=new n(this,e,t);return this.addComponent(i),i}ke.warn("no component for object type",e.type)}removeComponent(e){const t=this.compList.indexOf(e);t!==-1&&(this.compList.splice(t,1),e.dispose(),this.signals.componentRemoved.dispatch(e))}removeAllComponents(){this.compList.slice().forEach((e=>this.removeComponent(e)))}handleResize(){this.viewer.handleResize()}setSize(e,t){const n=this.viewer.container;n!==document.body&&(e!==void 0&&(n.style.width=e),t!==void 0&&(n.style.height=t),this.handleResize())}toggleFullscreen(e){if(!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled))return void ke.log("fullscreen mode (currently) not possible");const t=this;function n(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function i(){if(!n()&&t.lastFullscreenElement){const s=t.lastFullscreenElement;s.style.width=s.dataset.normalWidth||"",s.style.height=s.dataset.normalHeight||"",document.removeEventListener("fullscreenchange",i),document.removeEventListener("mozfullscreenchange",i),document.removeEventListener("webkitfullscreenchange",i),document.removeEventListener("MSFullscreenChange",i),t.handleResize(),t.signals.fullscreenChanged.dispatch(!1)}}e=e||this.viewer.container,this.lastFullscreenElement=e,n()?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.dataset.normalWidth=e.style.width||"",e.dataset.normalHeight=e.style.height||"",e.style.width=window.screen.width+"px",e.style.height=window.screen.height+"px",e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),document.addEventListener("fullscreenchange",i),document.addEventListener("mozfullscreenchange",i),document.addEventListener("webkitfullscreenchange",i),document.addEventListener("MSFullscreenChange",i),this.handleResize(),this.signals.fullscreenChanged.dispatch(!0),setTimeout((function(){t.handleResize()}),100))}setSpin(e){e?(this.spinAnimation.resume(!0),this.rockAnimation.pause(!0)):this.spinAnimation.pause(!0)}setRock(e){e?(this.rockAnimation.resume(!0),this.spinAnimation.pause(!0)):this.rockAnimation.pause(!0)}toggleSpin(){this.setSpin(this.spinAnimation.paused)}toggleRock(){this.setRock(this.rockAnimation.paused)}getFocus(){const e=this.parameters;if(e.clipMode!=="scene")return 0;let t=e.clipNear;return e.clipScale==="absolute"&&(t=this.viewer.absoluteToRelative(t)),2*t}setFocus(e){if(this.parameters.clipMode!=="scene")return;let t,n,i,s;this.parameters.clipScale==="relative"?(t=Dt(e/2,0,49.9),n=100-t,i=50,s=(function(o){return Dt(o,0,100)})(2*n-50)):(t=this.viewer.relativeToAbsolute(e/2),n=t,i=0,s=2*n),this.setParameters({clipNear:t,clipFar:n,fogNear:i,fogFar:s})}getZoomForBox(e){const t=e.getSize(El),n=Math.max(t.x,t.y,t.z),i=Math.min(t.x,t.y,t.z);let s=n+Math.sqrt(i);const o=It(this.viewer.perspectiveCamera.fov),a=this.viewer.width,l=this.viewer.height,d=l<a?1:a/l;return s=Math.abs(.5*s/d/Math.sin(o/2)),s+=this.parameters.clipDist,-s}getBox(){return this.viewer.boundingBox}getZoom(){return this.getZoomForBox(this.getBox())}getCenter(e){return this.getBox().getCenter(e||new Vector3)}autoView(e){this.animationControls.zoomMove(this.getCenter(),this.getZoom(),nt(e,0))}makeImage(e={}){return new Promise(((t,n)=>{this.tasks.onZeroOnce((()=>{this.tasks.increment(),this.viewer.makeImage(e).then((i=>{this.tasks.decrement(),t(i)})).catch((i=>{this.tasks.decrement(),n(i)}))}))}))}setImpostor(e){this.parameters.impostor=e;const t=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(n){if(!t.includes(n.getType()))return;const i=n.getParameters();i.disableImpostor=!e,n.build(i)}))}setQuality(e){this.parameters.quality=e;const t=["tube","cartoon","ribbon","trace","rope"],n=["spacefill","ball+stick","licorice","hyperball","backbone","rocket","helixorient","contact","distance","dot"];this.eachRepresentation((function(i){const s=i.getParameters();if(!t.includes(i.getType())){if(!n.includes(i.getType()))return;if(!s.disableImpostor)return void(i.repr.quality=e)}s.quality=e,i.build(s)}))}eachComponent(e,t){this.compList.slice().forEach((n=>{t!==void 0&&t!==n.type||e(n)}))}eachRepresentation(e,t){this.eachComponent((n=>{n.reprList.slice().forEach((i=>{t!==void 0&&t!==i.getType()||e(i,n)}))}))}getComponentsByName(e){const t=[];return this.eachComponent((n=>{(e===void 0||Fl(e,n))&&t.push(n)})),new Bl(t)}getComponentsByObject(e){const t=[];return this.eachComponent((n=>{n.object===e&&t.push(n)})),new Bl(t)}getRepresentationsByName(e){const t=[];return this.eachRepresentation(((n,i)=>{(e===void 0||Fl(e,n))&&t.push(n)})),new hl(t)}measureClear(){this.eachComponent((e=>e.measureClear()),"structure")}measureUpdate(){this.eachComponent((e=>e.measureUpdate()),"structure")}dispose(){this.tasks.dispose(),this.viewer.dispose(),this.mouseObserver.dispose()}}class Rl extends cl{constructor(e,t,n={}){super(e,t,Object.assign({name:t.name},n)),this.shape=t}get type(){return"shape"}addRepresentation(e,t={}){return this._addRepresentation(e,this.shape,t)}getBoxUntransformed(){return this.shape.boundingBox}getCenterUntransformed(){return this.shape.center}dispose(){this.shape.dispose(),super.dispose()}}function Ll(r,e,t,n){var i,s=arguments.length,o=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(i=r[a])&&(o=(s<3?i(o):s>3?i(e,t,o):i(e,t))||o);return s>3&&o&&Object.defineProperty(e,t,o),o}function Nl(r,e,t,n){return new(t||(t=Promise))((function(i,s){function o(d){try{l(n.next(d))}catch(u){s(u)}}function a(d){try{l(n.throw(d))}catch(u){s(u)}}function l(d){d.done?i(d.value):(function(u){return u instanceof t?u:new t((function(g){g(u)}))})(d.value).then(o,a)}l((n=n.apply(r,[])).next())}))}Ve.add("shape",Rl),typeof SuppressedError=="function"&&SuppressedError;class zl extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=nt(e.reverse,!0)),this.scalePerModel={},e.structure.eachModel((t=>{this.parameters.domain=[t.atomOffset,t.atomEnd],this.scalePerModel[t.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.index)}}Ll([Lt],zl.prototype,"atomColor",null),Oe.add("atomindex",zl);class Ul extends Nt{constructor(e){if(super(e),e.scale||(this.parameters.scale="OrRd"),!e.domain){let t,n=1/0,i=-1/0;e.sele&&(t=new me(e.sele)),e.structure.eachAtom((function(s){const o=s.bfactor;n=Math.min(n,o),i=Math.max(i,o)}),t),this.parameters.domain=[n,i]}this.bfactorScale=this.getScale()}atomColor(e){return this.bfactorScale(e.bfactor)}}Ll([Lt],Ul.prototype,"atomColor",null),Oe.add("bfactor",Ul);class Vl extends Nt{constructor(e){super(e),this.chainidDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((t=>{let n=0;const i={};t.eachChain((function(s){i[s.chainid]===void 0&&(i[s.chainid]=n,n+=1)})),this.parameters.domain=[0,n-1],this.chainidDictPerModel[t.index]=i,this.scalePerModel[t.index]=this.getScale()}))}atomColor(e){const t=this.chainidDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainid])}}Ll([Lt],Vl.prototype,"atomColor",null),Oe.add("chainid",Vl);class jl extends Nt{constructor(e){super(e),this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((t=>{this.parameters.domain=[t.chainOffset,t.chainEnd],this.scalePerModel[t.index]=this.getScale()}))}atomColor(e){return this.scalePerModel[e.modelIndex](e.chainIndex)}}Ll([Lt],jl.prototype,"atomColor",null),Oe.add("chainindex",jl);class Gl extends Nt{constructor(e){super(e),this.chainnameDictPerModel={},this.scalePerModel={},e.scale||(this.parameters.scale="Spectral"),e.structure.eachModel((t=>{let n=0;const i={};t.eachChain((function(s){i[s.chainname]===void 0&&(i[s.chainname]=n,n+=1)})),this.parameters.domain=[0,n-1],this.chainnameDictPerModel[t.index]=i,this.scalePerModel[t.index]=this.getScale()}))}atomColor(e){const t=this.chainnameDictPerModel[e.modelIndex];return this.scalePerModel[e.modelIndex](t[e.chainname])}}Ll([Lt],Gl.prototype,"atomColor",null),Oe.add("chainname",Gl);class Hl extends Nt{constructor(e){super(e),this.rsrzDict={},this.rsccDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rsrzScale=this.getScale({domain:[2,0]}),this.rsccScale=this.getScale({domain:[.678,1]});const t=e.structure.validation;t&&(this.rsrzDict=t.rsrzDict,this.rsccDict=t.rsccDict)}atomColor(e){let t=e.resno+"";e.inscode&&(t+="^"+e.inscode),e.chainname&&(t+=":"+e.chainname),t+="/"+e.modelIndex;const n=this.rsrzDict[t];if(n!==void 0)return this.rsrzScale(n);const i=this.rsccDict[t];return i!==void 0?this.rsccScale(i):9474192}}Ll([Lt],Hl.prototype,"atomColor",null),Oe.add("densityfit",Hl);const ql={ARG:{CD:.1,CZ:.5,NE:-.1},ASN:{CG:.55,OD1:-.55},ASP:{CB:-.16,CG:.36,OD1:-.6,OD2:-.6},CYS:{CB:.19,SG:-.19},GLN:{CD:.55,OE1:-.55},GLU:{CD:.36,CG:-.16,OE1:-.6,OE2:-.6},HIS:{CB:.1,CD2:.2,CE1:.45,CG:.15,ND1:.05,NE2:.05},LYS:{CE:.25,NZ:.75},MET:{CE:.06,CG:.06,SD:-.12},PTR:{C:.55,CA:.1,CZ:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SEP:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,O1P:-.85,O2P:-.85,O3P:-.85,OG1:-1.1,P:1.4},SER:{CB:.25,OG:-.25},THR:{CB:.25,OG1:-.25},TPO:{C:.55,CA:.1,CB:.25,N:-.35,O:-.55,OG1:-1.1,O1P:-.85,O2P:-.85,O3P:-.85,P:1.4},TRP:{CD1:.06,CD2:.1,CE2:-.04,CE3:-.03,CG:-.03,NE1:-.06},TYR:{CZ:.25,OH:-.25},backbone:{C:.55,O:-.55,N:-.35,CA:.1}};class Wl extends Nt{constructor(e){super(e),this.delta=new Vector3,this.hCharges=[],e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-50,50]),this.scale=this.getScale(),this.charges=new Float32Array(e.structure.atomCount);const t=[];e.structure.eachAtom((i=>{var s;if(this.charges[i.index]=((s=i).partialCharge!==null?s.partialCharge:s.isProtein()&&(ql[s.resname]&&ql[s.resname][s.atomname]||ql.backbone[s.atomname])||0)*i.occupancy,i.atomname==="N"){if(i.bondCount>=3||i.bondToElementCount(1))return;const o=(function(a,l=new Vector3){let d=!1,u=!1,g=!1;return l.set(2*a.x,2*a.y,2*a.z),a.eachBondedAtom((function(x){if(!d)return x.atomname==="H"?(l.set(x.x,x.y,x.z),void(d=!0)):void(u||x.atomname!=="CA"?g||x.atomname!=="C"||(g=!0,l.sub(x)):(l.sub(x),u=!0))})),d?l:u&&g?(l.normalize(),l.multiplyScalar(1.04),l.add(a),l):void 0})(i);o!==void 0&&(t.push(o),this.hCharges.push(.25*i.occupancy))}}));const n=e.structure.getBoundingBox();n.expandByScalar(1.04),this.hStore=(function(i){const s=i.length,o=new Float32Array(s),a=new Float32Array(s),l=new Float32Array(s);for(let d=0;d<i.length;d++){const u=i[d];o[d]=u.x,a[d]=u.y,l[d]=u.z}return{x:o,y:a,z:l,count:s}})(t),this.hHash=new Tn(this.hStore,n),this.hash=new Tn(e.structure.atomStore,n)}positionColor(e){const t=this.charges,n=this.hCharges;let i=0;return this.hash.eachWithin(e.x,e.y,e.z,12,((s,o)=>{const a=t[s];a!==0&&(i+=a/o)})),this.hHash.eachWithin(e.x,e.y,e.z,12,((s,o)=>{const a=n[s];a!==0&&(i+=a/o)})),this.scale(332*i)}}Ll([Lt],Wl.prototype,"positionColor",null),Oe.add("electrostatic",Wl);const Xl={H:16777215,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215,D:16777152,T:16777120};class Yl extends Nt{constructor(e){e.value=nt(e.value,Xl.C),super(e)}atomColor(e){const t=e.element;return t==="C"?this.parameters.value:Xl[t]||16777215}}Ll([Lt],Yl.prototype,"atomColor",null),Oe.add("element",Yl);class Kl extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="Spectral"),e.domain||(this.parameters.domain=[0,e.structure.entityList.length-1]),this.entityindexScale=this.getScale()}atomColor(e){return this.entityindexScale(e.entityIndex)}}Ll([Lt],Kl.prototype,"atomColor",null),Oe.add("entityindex",Kl);class Zl extends Nt{atomColor(e){const t=e.entity;switch(t?t.entityType:void 0){case 1:return 8374655;case 2:return 16629894;case 3:return 12496596;case 4:return 3697840;default:return 16777113}}}Ll([Lt],Zl.prototype,"atomColor",null),Oe.add("entitytype",Zl);class Ql extends Nt{constructor(e){super(e),this.geoAtomDict={},this.geoDict={};const t=e.structure.validation;t&&(this.geoAtomDict=t.geoAtomDict,this.geoDict=t.geoDict)}atomColor(e){let t,n=e.resno+"";e.inscode&&(n+="^"+e.inscode),e.chainname&&(n+=":"+e.chainname),n+="/"+e.modelIndex;const i=this.geoAtomDict[n];i!==void 0?(s=i[e.atomname]||0,t=16843009*((s=(858993459&(s-=s>>1&1431655765))+(s>>2&858993459))+(s>>4)&252645135)>>24):t=this.geoDict[n]||0;var s;return t===0?2188972:t===1?16703627:t===2?16018755:t>=3?10813478:9474192}}Ll([Lt],Ql.prototype,"atomColor",null),Oe.add("geoquality",Ql);class Jl extends Nt{constructor(e){super(e),this.resHF={},e.scale||(this.parameters.scale="RdYlGn");for(const t in Jn)this.resHF[t]=Jn[t][0];if(this.defaultResidueHydrophobicity=ts[0],!e.domain){let t=1/0,n=-1/0;for(const i in this.resHF){const s=this.resHF[i];t=Math.min(t,s),n=Math.max(n,s)}this.parameters.domain=[t,0,n]}this.hfScale=this.getScale()}atomColor(e){return this.hfScale(this.resHF[e.resname]||this.defaultResidueHydrophobicity)}}Ll([Lt],Jl.prototype,"atomColor",null),Oe.add("hydrophobicity",Jl);class th extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="rainbow"),e.domain||(this.parameters.domain=[0,e.structure.modelStore.count]),this.modelindexScale=this.getScale()}atomColor(e){return this.modelindexScale(e.modelIndex)}}Ll([Lt],th.prototype,"atomColor",null),Oe.add("modelindex",th);class eh extends Nt{atomColor(e){switch(e.residueType.moleculeType){case 1:return 3697840;case 2:return 15729279;case 3:return 12496596;case 4:return 16629894;case 5:return 12540695;case 6:return 8374655;default:return 16777113}}}Ll([Lt],eh.prototype,"atomColor",null),Oe.add("moleculetype",eh);class ih extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="PuBu"),e.domain||(this.parameters.domain=[0,1]),this.occupancyScale=this.getScale()}atomColor(e){return this.occupancyScale(e.occupancy)}}Ll([Lt],ih.prototype,"atomColor",null),Oe.add("occupancy",ih);class rh extends Nt{constructor(e){super(e),e.scale||(this.parameters.scale="rwb"),e.domain||(this.parameters.domain=[-1,1]),this.partialchargeScale=this.getScale()}atomColor(e){return this.partialchargeScale(e.partialCharge||0)}}function nh(){return 16777215*Math.random()}Ll([Lt],rh.prototype,"atomColor",null),Oe.add("partialcharge",rh);class sh extends Nt{atomColor(){return nh()}volumeColor(){return nh()}positionColor(){return nh()}}Ll([Lt],sh.prototype,"atomColor",null),Ll([Lt],sh.prototype,"volumeColor",null),Ll([Lt],sh.prototype,"positionColor",null),Oe.add("random",sh);class oh extends Nt{constructor(e){super(e),this.rciDict={},e.scale||(this.parameters.scale="RdYlBu"),this.rciScale=this.getScale({domain:[.6,0]});const t=e.structure.validation;t&&(this.rciDict=t.rciDict)}atomColor(e){let t=`[${e.resname}]${e.resno}`;e.chainname&&(t+=":"+e.chainname);const n=this.rciDict[t];return n!==void 0?this.rciScale(n):9474192}}Ll([Lt],oh.prototype,"atomColor",null),Oe.add("randomcoilindex",oh);class ah extends Nt{constructor(e){super(e),this.scalePerChain={},e.scale||(this.parameters.scale="rainbow",this.parameters.reverse=nt(e.reverse,!0)),e.structure.eachChain((t=>{this.parameters.domain=[t.residueOffset,t.residueEnd],this.scalePerChain[t.index]=this.getScale()}))}atomColor(e){return this.scalePerChain[e.chainIndex](e.residueIndex)}}Ll([Lt],ah.prototype,"atomColor",null),Oe.add("residueindex",ah);const ch={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935,ASH:16711935,GLH:16711935,A:14423100,G:3329330,I:10145074,X:8190976,C:16766720,T:4286945,U:4251856,D:35723,DA:14423100,DG:3329330,DI:10145074,DX:8190976,DC:16766720,DT:4286945,DU:4251856,DD:35723};class lh extends Nt{atomColor(e){return ch[e.resname]||16711935}}Ll([Lt],lh.prototype,"atomColor",null),Oe.add("resname",lh);const hh=16711808,uh=10485888,dh=6291584,mh=16762880,fh=6324479,ph=16777215,gh=11403518,yh=16580962,bh=10921722;class _h extends Nt{constructor(e){super(e),this.residueProxy=e.structure.getResidueProxy()}atomColor(e){const t=e.sstruc,n=this.residueProxy;return t==="h"?hh:t==="g"?uh:t==="i"?dh:t==="e"||t==="b"?mh:t==="t"?fh:(n.index=e.residueIndex,n.isDna()?gh:n.isRna()?yh:n.isSaccharide()?bh:n.isProtein()||t==="s"||t==="l"?ph:8421504)}}Ll([Lt],_h.prototype,"atomColor",null),Oe.add("sstruc",_h);class xh extends Nt{constructor(e){var t,n;super(e),e.scale||(this.parameters.scale="rwb"),this.atomData=(t=this.parameters.data)===null||t===void 0?void 0:t.atomData,this.bondData=(n=this.parameters.data)===null||n===void 0?void 0:n.bondData,this.scale=this.getScale(this.parameters)}atomColor(e){var t;const n=(t=this.atomData)===null||t===void 0?void 0:t[e.index];return n!==void 0?this.scale(n):this.parameters.value}bondColor(e,t){var n;const i=(n=this.bondData)===null||n===void 0?void 0:n[e.index];return i!==void 0?this.scale(i):this.atomProxy?(this.atomProxy.index=t?e.atomIndex1:e.atomIndex2,this.atomColor(this.atomProxy)):this.parameters.value}}Ll([Lt],xh.prototype,"atomColor",null),Ll([Lt],xh.prototype,"bondColor",null),Oe.add("structuredata",xh);class vh extends Nt{atomColor(){return this.parameters.value}bondColor(){return this.parameters.value}valueColor(){return this.parameters.value}volumeColor(){return this.parameters.value}}Ll([Lt],vh.prototype,"atomColor",null),Ll([Lt],vh.prototype,"bondColor",null),Ll([Lt],vh.prototype,"valueColor",null),Ll([Lt],vh.prototype,"volumeColor",null),Oe.add("uniform",vh);class wh extends Nt{constructor(e){super(e),this.valueScale=this.getScale()}volumeColor(e){return this.valueScale(this.parameters.volume.data[e])}}Ll([Lt],wh.prototype,"volumeColor",null),Oe.add("value",wh);class Ah extends Nt{constructor(e){super(e),this.vec=new Vector3,this.valueScale=this.getScale()}positionColor(e){const t=this.parameters.volume;if(!t||!t.inverseMatrix)return this.parameters.value;const n=this.vec,i=t.data,s=t.nx,o=t.ny,a=s*o;n.copy(e),n.applyMatrix4(t.inverseMatrix);const l=Math.floor(n.x),d=Math.floor(n.y),u=Math.floor(n.z),g=(u*o+d)*s+l,x=g+1,y=g+s,b=g+a,_=y+1,h=b+1,f=y+a,E=f+1,m=i[g],S=i[x],w=i[y],v=i[b],A=i[_],M=i[h],T=i[f],R=i[E],P=n.x-l,L=n.y-d,O=n.z-u,I=Bt(m,S,P),N=Bt(v,M,P),k=Bt(w,A,P),U=Bt(T,R,P),F=Bt(I,k,L),j=Bt(N,U,L),H=Bt(F,j,O);return this.valueScale(H)}}Ll([Lt],Ah.prototype,"positionColor",null),Oe.add("volume",Ah);class Sh extends Nr{constructor(e,t,n){const i=n||{};if(super(e,t,i),this.type="structure",this.parameters=Object.assign({radiusType:{type:"select",options:ma.types},radiusData:{type:"hidden"},radiusSize:{type:"number",precision:3,max:10,min:.001},radiusScale:{type:"number",precision:3,max:10,min:.001},assembly:null,defaultAssembly:{type:"hidden"}},this.parameters),this.selection=new me(i.sele),this.dataList=[],this.structure=e,this.structureView=this.structure.getView(this.selection),e.biomolDict){const s={default:"default","":e.unitcell?"AU":"FULL"};Object.keys(e.biomolDict).forEach((function(o){s[o]=o})),this.parameters.assembly={type:"select",options:s,rebuild:!0}}else this.parameters.assembly=null}get defaultScale(){return{vdw:1,covalent:1,bfactor:.01,sstruc:1}}init(e){const t=e||{};t.colorScheme=nt(t.colorScheme,"element"),this.setRadius(t.radius,t),this.radiusType=nt(t.radiusType,"vdw"),this.radiusData=nt(t.radiusData,{}),this.radiusSize=nt(t.radiusSize,1),this.radiusScale=nt(t.radiusScale,1),this.assembly=nt(t.assembly,"default"),this.defaultAssembly=nt(t.defaultAssembly,""),t.quality==="auto"&&(t.quality=this.getQuality()),super.init(t),this.selection.signals.stringChanged.add((()=>{this.build()})),this.build()}setRadius(e,t){const n=Object.keys(da);return typeof e=="string"&&n.includes(e.toLowerCase())?t.radiusType=e:e!==void 0&&(t.radiusType="size",t.radiusSize=e),this}getAssembly(){const e=this.assembly==="default"?this.defaultAssembly:this.assembly;return this.structure.biomolDict[e]}getQuality(){let e;const t=this.structureView,n=this.getAssembly();return e=n?n.getAtomCount(t):t.atomCount,Ae&&(e*=4),t.atomStore.count/t.residueStore.count<2&&(e*=10),e<15e3?"high":e<8e4?"medium":"low"}create(){if(this.structureView.atomCount===0)return;if(!this.structureView.hasCoords())return void(this.needsBuild=!0);this.needsBuild=!1;const e=this.getAssembly();if(e)e.partList.forEach(((t,n)=>{const i=t.getView(this.structureView);if(i.atomCount===0)return;const s=this.createData(i,n);s&&(s.sview=i,s.instanceList=t.getInstanceList(),this.dataList.push(s))}));else{const t=this.createData(this.structureView,0);t&&(t.sview=this.structureView,this.dataList.push(t))}}update(e){!this.lazy||this.visible?this.needsBuild?this.build():this.dataList.forEach((t=>{t.bufferList.length>0&&this.updateData(e,t)}),this):Object.assign(this.lazyProps.what,e)}updateData(e,t){this.build()}getColorParams(){return Object.assign(Object.assign({},super.getColorParams()),{structure:this.structure})}getRadiusParams(e){return{type:this.radiusType,scale:this.radiusScale,size:this.radiusSize,data:this.radiusData}}getAtomParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getBondParams(e,t){return Object.assign({what:e,colorParams:this.getColorParams(),radiusParams:this.getRadiusParams()},t)}getAtomRadius(e){return this.structureView.atomSet.isSet(e.index)?new ma(this.getRadiusParams()).atomRadius(e):0}setSelection(e,t){return this.selection.setString(e,t),this}setParameters(e,t={},n=!1){const i=e||{};return this.setRadius(i.radius,i),i.radiusType===void 0&&i.radiusData===void 0&&i.radiusSize===void 0&&i.radiusScale===void 0||(t.radius=!0,Pe&&!this.disableImpostor||(n=!0)),i.defaultAssembly!==void 0&&i.defaultAssembly!==this.defaultAssembly&&(this.assembly==="default"&&i.assembly===void 0||i.assembly==="default")&&(n=!0),super.setParameters(i,t,n),this}getParameters(){return Object.assign(super.getParameters(),{sele:this.selection?this.selection.string:void 0,defaultAssembly:this.defaultAssembly})}attach(e){const t=this.viewer,n=this.bufferList;this.dataList.forEach((function(i){i.bufferList.forEach((function(s){n.push(s),t.add(s,i.instanceList)}))})),this.setVisibility(this.visible),e()}clear(){this.dataList.length=0,super.clear()}dispose(){this.structureView.dispose(),super.dispose()}}class Ch extends Sh{constructor(e,t,n){super(e,t,n),this.n=0,this.parameters=Object.assign({labelVisible:{type:"boolean"},labelSize:{type:"number",precision:3,max:10,min:.001},labelColor:{type:"color"},labelFontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:"fontFamily"},labelFontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:"fontStyle"},labelFontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:"fontWeight"},labelsdf:{type:"boolean",buffer:"sdf"},labelXOffset:{type:"number",precision:1,max:20,min:-20,buffer:"xOffset"},labelYOffset:{type:"number",precision:1,max:20,min:-20,buffer:"yOffset"},labelZOffset:{type:"number",precision:1,max:20,min:-20,buffer:"zOffset"},labelAttachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},labelBorder:{type:"boolean",buffer:"showBorder"},labelBorderColor:{type:"color",buffer:"borderColor"},labelBorderWidth:{type:"number",precision:2,max:.3,min:0,buffer:"borderWidth"},labelBackground:{type:"boolean",rebuild:!0},labelBackgroundColor:{type:"color",buffer:"backgroundColor"},labelBackgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},labelBackgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:"backgroundOpacity"},labelFixedSize:{type:"boolean",buffer:"fixedSize"},lineOpacity:{type:"range",min:0,max:1,step:.01},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters,{flatShaded:null})}init(e){const t=e||{};this.labelVisible=nt(t.labelVisible,!0),this.labelSize=nt(t.labelSize,2),this.labelColor=nt(t.labelColor,16777215),this.labelFontFamily=nt(t.labelFontFamily,"sans-serif"),this.labelFontStyle=nt(t.labelFontstyle,"normal"),this.labelFontWeight=nt(t.labelFontWeight,"bold"),this.labelsdf=nt(t.labelsdf,ve==="Chrome"),this.labelXOffset=nt(t.labelXOffset,0),this.labelYOffset=nt(t.labelYOffset,0),this.labelZOffset=nt(t.labelZOffset,.5),this.labelAttachment=nt(t.labelAttachment,"bottom-left"),this.labelBorder=nt(t.labelBorder,!1),this.labelBorderColor=nt(t.labelBorderColor,"lightgrey"),this.labelBorderWidth=nt(t.labelBorderWidth,.15),this.labelBackground=nt(t.labelBackground,!1),this.labelBackgroundColor=nt(t.labelBackgroundColor,"lightgrey"),this.labelBackgroundMargin=nt(t.labelBackgroundMargin,.5),this.labelBackgroundOpacity=nt(t.labelBackgroundOpacity,1),this.labelFixedSize=nt(t.labelFixedSize,!1),this.lineOpacity=nt(t.lineOpacity,1),this.linewidth=nt(t.linewidth,2),super.init(t)}update(e){e.position?this.build():super.update(e)}updateData(e,t){const n={};if(e&&!e.labelSize||Object.assign(n,{size:Ai(this.n,this.labelSize)}),!e||e.labelColor){const i=new Color(this.labelColor);Object.assign(n,{color:Si(this.n,i.r,i.g,i.b)})}this.textBuffer.setAttributes(n)}setParameters(e,t={},n=!1){return e&&e.labelSize&&(t.labelSize=!0),e&&(e.labelColor||e.labelColor===0)&&(t.labelColor=!0,n=!0),super.setParameters(e,t,n),e&&e.opacity!==void 0&&this.textBuffer.setParameters({opacity:1}),e&&e.labelVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.textBuffer&&this.textBuffer.setVisibility(this.labelVisible&&this.visible),t||this.viewer.requestRender(),this}getLabelBufferParams(e={}){return super.getBufferParams(Object.assign({fontFamily:this.labelFontFamily,fontStyle:this.labelFontStyle,fontWeight:this.labelFontWeight,sdf:this.labelsdf,xOffset:this.labelXOffset,yOffset:this.labelYOffset,zOffset:this.labelZOffset,attachment:this.labelAttachment,showBorder:this.labelBorder,borderColor:this.labelBorderColor,borderWidth:this.labelBorderWidth,showBackground:this.labelBackground,backgroundColor:this.labelBackgroundColor,backgroundMargin:this.labelBackgroundMargin,backgroundOpacity:this.labelBackgroundOpacity,fixedSize:this.labelFixedSize,disablePicking:!0,visible:this.labelVisible},e,{opacity:1}))}getAtomRadius(){return 0}}function Ph(r,e){const t=r.getAtomProxy(),n=new me,i=e.length;if(i===0)return new Float32Array(0);const s=e[0].length,o=r.getAtomSet(),a=new Float32Array(i*s*3);let l=0;return e.forEach((function(d){let u=!1;for(let g=0;g<s;g++){const x=d[g];if(typeof x=="number"&&Number.isInteger(x)){if(!o.get(x)){u=!0;break}t.index=x}else{n.setString(x);const b=r.getAtomIndices(n);if(!b.length){u=!0;break}t.index=b[0]}let y=l+3*g;a[y++]=t.x,a[y++]=t.y,a[y++]=t.z}u||(l+=3*s)})),a.subarray(0,l)}function Ih(r,e,t,n,i){const s=Math.cos(i),o=Math.sin(i);r[0]=e[0]+t[0]*s+n[0]*o,r[1]=e[1]+t[1]*s+n[1]*o,r[2]=e[2]+t[2]*s+n[2]*o}function kh(r,e,t,n,i,s,o){for(let a=0;a<e;a++){for(let l=0;l<t;l++)n[l]=r[l*e+a];Mh(n,i,s,o,t);for(let l=0;l<t;l++)r[l*e+a]=i[l]}for(let a=0;a<t;a++){for(let l=0;l<e;l++)n[l]=r[a*e+l];Mh(n,i,s,o,e);for(let l=0;l<e;l++)r[a*e+l]=Math.sqrt(i[l])}}function Mh(r,e,t,n,i){t[0]=0,n[0]=Number.MIN_SAFE_INTEGER,n[1]=Number.MAX_SAFE_INTEGER;for(let s=1,o=0;s<i;s++){let a=(r[s]+s*s-(r[t[o]]+t[o]*t[o]))/(2*s-2*t[o]);for(;a<=n[o];)o--,a=(r[s]+s*s-(r[t[o]]+t[o]*t[o]))/(2*s-2*t[o]);o++,t[o]=s,n[o]=a,n[o+1]=Number.MAX_SAFE_INTEGER}for(let s=0,o=0;s<i;s++){for(;n[o+1]<s;)o++;e[s]=(s-t[o])*(s-t[o])+r[t[o]]}}ze.add("shader/SDFFont.vert",`uniform float clipNear;
uniform float clipRadius;
uniform vec3 clipCenter;
uniform float xOffset;
uniform float yOffset;
uniform float zOffset;
uniform bool ortho;
uniform float canvasHeight;
uniform float pixelRatio;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
varying vec3 vViewPosition;
#endif
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#endif
attribute vec2 mapping;
attribute vec2 inputTexCoord;
attribute float inputSize;
#include matrix_scale
#include common
void main(void){
#if defined( PICKING )
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#endif
texCoord = inputTexCoord;
float scale = matrixScale( modelViewMatrix );
float _xOffset = xOffset * scale;
float _yOffset = yOffset * scale;
float _zOffset = zOffset * scale;
if( texCoord.x == 10.0 ){
_zOffset -= 0.001;
}
vec4 cameraPos = modelViewMatrix * vec4( position, 1.0 );
#ifdef FIXED_SIZE
if ( ortho ) {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPosition.z) * 0.1;
} else {
scale /= pixelRatio * (( canvasHeight / 2.0 ) / -cameraPos.z) * 0.1;
}
#endif
vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );
cameraCornerPos.xy += mapping * inputSize * 0.01 * scale;
cameraCornerPos.x += _xOffset;
cameraCornerPos.y += _yOffset;
if( ortho ){
cameraCornerPos.xyz += normalize( -cameraPosition ) * _zOffset;
} else {
cameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;
}
gl_Position = projectionMatrix * cameraCornerPos;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || ( !defined( PICKING ) && !defined( NOLIGHT ) )
vViewPosition = -cameraCornerPos.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
#include radiusclip_vertex
}`),ze.add("shader/SDFFont.frag",`uniform sampler2D fontTexture;
uniform float opacity;
uniform bool showBorder;
uniform vec3 borderColor;
uniform float borderWidth;
uniform vec3 backgroundColor;
uniform float backgroundOpacity;
uniform float clipNear;
uniform float clipRadius;
varying vec3 vViewPosition;
varying vec2 texCoord;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#if defined( PICKING )
uniform float objectId;
varying vec3 vPickingColor;
const vec3 vColor = vec3( 0.0 );
#else
#include common
#include color_pars_fragment
#include fog_pars_fragment
#endif
const float gamma = 2.2 * 1.4142 / 128.0;
const float padding = 0.75;
void main(){
#include nearclip_fragment
#include radiusclip_fragment
if( texCoord.x > 1.0 ){
gl_FragColor = vec4( backgroundColor, backgroundOpacity );
}else{
float sdf = texture2D( fontTexture, texCoord ).a;
if( showBorder ) sdf += borderWidth;
float a = smoothstep(padding - gamma, padding + gamma, sdf);
if( a < 0.2 ) discard;
a *= opacity;
vec3 outgoingLight = vColor;
if( showBorder && sdf < ( padding + borderWidth ) ){
outgoingLight = borderColor;
}
gl_FragColor = vec4( outgoingLight, a );
}
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Th={},Dh={font:"sans-serif",size:36,style:"normal",variant:"normal",weight:"normal",outline:3,width:1024,height:1024};class Bh{constructor(e={}){this.gamma=1,this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.25,this.parameters=st(e,Dh);const t=this.parameters;this.radius=t.size/8,this.padding=t.size/3;const n=this.lineHeight=t.size+2*t.outline+Math.round(t.size/4),i=this.maxWidth=t.width/4,s=this.canvas=document.createElement("canvas");s.width=i,s.height=n;const o=this.context=this.canvas.getContext("2d",{willReadFrequently:!0});o.font=`${t.style} ${t.variant} ${t.weight} ${t.size}px ${t.font}`,o.fillStyle="black",o.textAlign="left",o.textBaseline="bottom",o.lineJoin="round",this.gridOuter=new Float64Array(n*i),this.gridInner=new Float64Array(n*i),this.f=new Float64Array(Math.max(n,i)),this.d=new Float64Array(Math.max(n,i)),this.z=new Float64Array(Math.max(n,i)+1),this.v=new Int16Array(Math.max(n,i)),this.data=new Uint8Array(t.width*t.height*4),this.canvas2=document.createElement("canvas"),this.canvas2.width=t.width,this.canvas2.height=t.height,this.context2=this.canvas2.getContext("2d"),this.placeholder=this.map("");for(let a=32;a<=126;++a)this.map(String.fromCharCode(a));this.map(""),this.map(""),this.texture=new CanvasTexture(this.canvas2),this.texture.flipY=!1,this.texture.needsUpdate=!0}map(e){const t=this.parameters;return this.mapped[e]===void 0&&(this.draw(e),this.currentX+this.scratchW>t.width&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>t.height&&console.warn("canvas to small"),this.mapped[e]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH},this.context2.drawImage(this.canvas,0,0,this.scratchW,this.scratchH,this.currentX,this.currentY,this.scratchW,this.scratchH),this.currentX+=this.scratchW),this.mapped[e]}get(e){return this.mapped[e]||this.placeholder}draw(e){const t=this.parameters,n=this.lineHeight,i=t.outline,s=this.context,o=this.maxWidth,a=i,l=n-t.outline,d=s.measureText(e),u=Math.min(o,Math.ceil(d.width+2*a+1)),g=u*n;s.clearRect(0,0,u,n),s.fillText(e,a,l);const x=s.getImageData(0,0,u,n),y=x.data;for(let b=0;b<g;b++){const _=x.data[4*b+3]/255;this.gridOuter[b]=_===1?0:_===0?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-_),2),this.gridInner[b]=_===1?Number.MAX_SAFE_INTEGER:_===0?0:Math.pow(Math.max(0,_-.5),2)}kh(this.gridOuter,u,n,this.f,this.d,this.v,this.z),kh(this.gridInner,u,n,this.f,this.d,this.v,this.z);for(let b=0;b<g;b++){const _=this.gridOuter[b]-this.gridInner[b];y[4*b+3]=Math.max(0,Math.min(255,Math.round(255-255*(_/this.radius+this.cutoff))))}s.putImageData(x,0,0),this.scratchW=u,this.scratchH=n}}const Fh=Object.assign({fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"bold",fontSize:36,xOffset:0,yOffset:0,zOffset:.5,attachment:"bottom-left",showBorder:!1,borderColor:"lightgrey",borderWidth:.15,showBackground:!1,backgroundColor:"lightgrey",backgroundMargin:.5,backgroundOpacity:1,forceTransparent:!0,fixedSize:!1},No),Eh=Object.assign({fontFamily:{uniform:!0},fontStyle:{uniform:!0},fontWeight:{uniform:!0},fontSize:{uniform:!0},xOffset:{uniform:!0},yOffset:{uniform:!0},zOffset:{uniform:!0},showBorder:{uniform:!0},borderColor:{uniform:!0},borderWidth:{uniform:!0},backgroundColor:{uniform:!0},backgroundOpacity:{uniform:!0},fixedSize:{updateShader:!0}},zo);function $h(r,e){const t=r.position.length/3;let n=0;for(let i=0;i<t;++i)n+=r.text[i].length;return e.showBackground&&(n+=t),n}class Oh extends Nc{constructor(e,t={}){super({position:new Float32Array(3*$h(e,t)),color:new Float32Array(3*$h(e,t)),picking:new to},t),this.parameterTypes=Eh,this.alwaysTransparent=!0,this.hasWireframe=!1,this.isText=!0,this.vertexShader="SDFFont.vert",this.fragmentShader="SDFFont.frag",this.text=e.text,this.positionCount=e.position.length/3,this.addUniforms({fontTexture:{value:null},xOffset:{value:this.parameters.xOffset},yOffset:{value:this.parameters.yOffset},zOffset:{value:this.parameters.zOffset},ortho:{value:!1},showBorder:{value:this.parameters.showBorder},borderColor:{value:new Color(this.parameters.borderColor)},borderWidth:{value:this.parameters.borderWidth},backgroundColor:{value:new Color(this.parameters.backgroundColor)},backgroundOpacity:{value:this.parameters.backgroundOpacity},canvasHeight:{value:1},pixelRatio:{value:1}}),this.addAttributes({inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}}),this.setAttributes(e),this.makeTexture(),this.makeMapping()}get defaultParameters(){return Fh}makeMaterial(){super.makeMaterial();const e=this.texture,t=this.material;t.transparent=!0,t.extensions.derivatives=!0,t.lights=!1,t.uniforms.fontTexture.value=e,t.needsUpdate=!0;const n=this.wireframeMaterial;n.transparent=!0,n.extensions.derivatives=!0,n.lights=!1,n.uniforms.fontTexture.value=e,n.needsUpdate=!0;const i=this.pickingMaterial;i.extensions.derivatives=!0,i.lights=!1,i.uniforms.fontTexture.value=e,i.needsUpdate=!0}setAttributes(e={}){let t,n,i,s,o,a;const l=this.text,d=this.geometry.attributes;e.position&&(t=e.position,s=d.position.array,d.position.needsUpdate=!0),e.size&&(n=e.size,o=d.inputSize.array,d.inputSize.needsUpdate=!0),e.color&&(i=e.color,a=d.color.array,d.color.needsUpdate=!0);const u=this.positionCount;let g,x,y,b,_,h=0;for(let f=0;f<u;++f)for(x=3*f,y=l[f],_=y.length,this.parameters.showBackground&&(_+=1),b=0;b<_;++b,++h)for(let E=0;E<4;E++)g=4*h*3+3*E,t&&(s[g]=t[x],s[g+1]=t[x+1],s[g+2]=t[x+2]),n&&(o[4*h+E]=n[f]),i&&(a[g]=i[x],a[g+1]=i[x+1],a[g+2]=i[x+2])}makeTexture(){this.textAtlas=(function(e){const t=JSON.stringify(e);return Th[t]===void 0&&(Th[t]=new Bh(e)),Th[t]})({font:this.parameters.fontFamily,style:this.parameters.fontStyle,weight:this.parameters.fontWeight,size:this.parameters.fontSize}),this.texture=this.textAtlas.texture}makeMapping(){const e=this.textAtlas,t=this.text,n=this.parameters.attachment,i=e.lineHeight*this.parameters.backgroundMargin*.1-10,s=this.geometry.attributes,o=s.inputTexCoord.array,a=s.mapping.array,l=this.positionCount;let d,u,g,x,y,b,_,h,f=0;for(let E=0;E<l;++E){for(g=t[E],x=0,b=g.length,y=0;y<b;++y)d=e.get(g[y]),x+=d.w-2*e.parameters.outline;for(h=n.startsWith("top")?e.lineHeight/1.25:n.startsWith("middle")?e.lineHeight/2.5:0,_=n.endsWith("right")?x:n.endsWith("center")?x/2:0,_+=e.parameters.outline,h+=e.parameters.outline,this.parameters.showBackground&&(u=2*f*4,a[u+0]=-e.lineHeight/6-_-i,a[u+1]=e.lineHeight-h+i,a[u+2]=-e.lineHeight/6-_-i,a[u+3]=0-h-i,a[u+4]=x+e.lineHeight/6-_+2*e.parameters.outline+i,a[u+5]=e.lineHeight-h+i,a[u+6]=x+e.lineHeight/6-_+2*e.parameters.outline+i,a[u+7]=0-h-i,o[u+0]=10,o[u+2]=10,o[u+4]=10,o[u+6]=10,f+=1),x=0,y=0;y<b;++y,++f){d=e.get(g[y]),u=2*f*4,a[u+0]=x-_,a[u+1]=d.h-h,a[u+2]=x-_,a[u+3]=0-h,a[u+4]=x+d.w-_,a[u+5]=d.h-h,a[u+6]=x+d.w-_,a[u+7]=0-h;const m=e.parameters.width,S=e.parameters.height,w=[d.x/m,d.y/S,d.x/m,(d.y+d.h)/S,(d.x+d.w)/m,d.y/S,(d.x+d.w)/m,(d.y+d.h)/S];o.set(w,u),x+=d.w-2*e.parameters.outline}}s.inputTexCoord.needsUpdate=!0,s.mapping.needsUpdate=!0}getDefines(e){const t=super.getDefines(e);return this.parameters.fixedSize&&(t.FIXED_SIZE=1),t}setUniforms(e){!e||e.fontFamily===void 0&&e.fontStyle===void 0&&e.fontWeight===void 0&&e.fontSize===void 0||(this.makeTexture(),this.makeMapping(),this.texture.needsUpdate=!0,e.fontTexture=this.texture),super.setUniforms(e)}}je.add("text",Oh),ze.add("shader/WideLine.vert",`
uniform float clipNear;
uniform vec3 clipCenter;
uniform float linewidth;
uniform vec2 resolution;
uniform mat4 projectionMatrixInverse;
attribute vec2 mapping;
attribute vec3 position1;
attribute vec3 position2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
void trimSegment( const in vec4 start, inout vec4 end ) {
float a = projectionMatrix[ 2 ][ 2 ]; float b = projectionMatrix[ 3 ][ 2 ]; float nearEstimate = - 0.5 * b / a;
float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );
end.xyz = mix( start.xyz, end.xyz, alpha );
}
void main() {
float aspect = resolution.x / resolution.y;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
flag = mapping.y;
vColor = color;
vColor2 = color2;
#endif
vec4 start = modelViewMatrix * vec4( position1, 1.0 );
vec4 end = modelViewMatrix * vec4( position2, 1.0 );
bool perspective = ( projectionMatrix[ 2 ][ 3 ] == -1.0 ); if ( perspective ) {
if ( start.z < 0.0 && end.z >= 0.0 ) {
trimSegment( start, end );
} else if ( end.z < 0.0 && start.z >= 0.0 ) {
trimSegment( end, start );
}
}
vec4 clipStart = projectionMatrix * start;
vec4 clipEnd = projectionMatrix * end;
vec2 ndcStart = clipStart.xy / clipStart.w;
vec2 ndcEnd = clipEnd.xy / clipEnd.w;
vec2 dir = ndcEnd - ndcStart;
dir.x *= aspect;
dir = normalize( dir );
vec2 offset = vec2( dir.y, - dir.x );
dir.x /= aspect;
offset.x /= aspect;
if ( mapping.x < 0.0 ) offset *= - 1.0;
offset *= linewidth;
offset /= resolution.y;
vec4 clip = ( mapping.y < 0.5 ) ? clipStart : clipEnd;
offset *= clip.w;
clip.xy += offset;
gl_Position = clip;
#ifndef PICKING
vViewPosition = ( projectionMatrixInverse * clip ).xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`),ze.add("shader/WideLine.frag",`uniform vec3 diffuse;
uniform float opacity;
uniform float clipNear;
uniform float clipRadius;
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
#include common
#include fog_pars_fragment
varying vec3 vViewPosition;
varying vec3 vColor;
varying vec3 vColor2;
varying float flag;
#endif
void main() {
#include nearclip_fragment
#include radiusclip_fragment
#if defined( PICKING )
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 outgoingLight = vec3( 0.0 );
vec4 diffuseColor = vec4( diffuse, 1.0 );
if ( flag < 0.0 ) {
diffuseColor.rgb *= vColor;
} else {
diffuseColor.rgb *= vColor2;
}
#include alphatest_fragment
outgoingLight = diffuseColor.rgb;
gl_FragColor = vec4( outgoingLight, diffuseColor.a * opacity );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Rh=Object.assign({linewidth:2},No),Lh=Object.assign({linewidth:{uniform:!0}},zo);class Nh extends Nc{constructor(e,t={}){super(e,t),this.parameterTypes=Lh,this.vertexShader="WideLine.vert",this.fragmentShader="WideLine.frag",!e.color2&&e.color&&(e.color2=e.color),this.addUniforms({linewidth:{value:this.parameters.linewidth},resolution:{value:new Vector2},projectionMatrixInverse:{value:new Matrix4}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Rh}setParameters(e){super.setParameters(e)}}je.add("wideline",Nh);class zh extends Ch{constructor(e,t,n){super(e,t,n),this.type="angle",this.parameters=Object.assign({atomTriple:{type:"hidden",rebuild:!0},vectorVisible:{type:"boolean",default:!0},arcVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=nt(t.side,"double"),t.opacity=nt(t.opacity,.5),this.atomTriple=nt(t.atomTriple,[]),this.arcVisible=nt(t.arcVisible,!0),this.sectorVisible=nt(t.sectorVisible,!0),this.vectorVisible=nt(t.vectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomTriple.length)return;const t=(function(a,l){return(function(d){const u=[],g=d.length/9;for(let b=0;b<g;b++){let _=!0;for(let h=b;h<b+3;h+=3)d[h]===d[h+3]&&d[h+1]===d[h+4]&&d[h+2]===d[h+5]&&(_=!1);_&&u.push(b)}const x=new Float32Array(9*u.length);let y=0;return u.forEach((function(b){ki(d,x,9*b,9*y,9),y++})),x})(Ph(a,l))})(e,this.atomTriple),n=(function(a,l={}){const d=nt(l.angleStep,Math.PI/90),u=a.length/9,g=new Float32Array(u),x=new Float32Array(3*u),y=new Array(u),b=new Float32Array(6*u),_=new Float32Array(6*u),h=new Array(u),f=new Array(u),E=new Array(u);let m=0;const S=Xr(),w=Xr(),v=Xr(),A=Xr(),M=Xr(),T=Xr(),R=Xr(),P=Xr(),L=Xr();for(var O=0;O<u;O++){let B=9*O;Jr(S,a,B),Jr(w,a,B+3),Jr(v,a,B+6);let V=6*O;tn(S,b,V),tn(w,_,V),tn(w,b,V+3),tn(v,_,V+3),Zr(A,S,w),Zr(M,v,w),on(A,A),on(M,M),Yr(T,A,M);const K=rn(T),q=Kr(A,M),Te=g[O]=Math.atan2(K,q);y[O]=(_i*Te).toFixed(1)+"",rn(T)===0&&(T[0]=1,T[1]=0,T[2]=0),Yr(R,T,A),on(R,R),Ih(P,w,A,R,Te/2),tn(P,x,3*O);const Fe=Math.ceil(Te/d),We=new Float32Array(9*Fe);E[O]=We;const J=new Float32Array(3*Fe),et=new Float32Array(3*Fe);h[O]=J,f[O]=et,Qr(L,w,A);const ht=function(tr,Hm){const oi=9*Hm,h0=3*Hm;tn(w,We,oi),tn(L,We,oi+3),tn(L,J,h0),Ih(L,w,A,R,tr),tn(L,We,oi+6),tn(L,et,h0)};let er=0;for(let tr=d;tr<Te;tr+=d)ht(tr,er),er++;ht(Te,er),m+=Fe}const I=3*m,N=9*m,k=new Float32Array(I),U=new Float32Array(I),F=new Float32Array(N);let j=0,H=0;for(let B=0;B<u;B++){const V=h[B],K=f[B];ki(V,k,0,H,V.length),ki(K,U,0,H,K.length),H+=V.length;const q=E[B];ki(q,F,0,j,q.length),j+=q.length}return{labelPosition:x,labelText:y,vectorPosition1:b,vectorPosition2:_,arcPosition1:k,arcPosition2:U,sectorPosition:F}})(t),i=this.n=n.labelPosition.length/3,s=new Color(this.labelColor);this.textBuffer=new Oh({position:n.labelPosition,size:Ai(i,this.labelSize),color:Si(i,s.r,s.g,s.b),text:n.labelText},this.getLabelBufferParams());const o=new Color(this.colorValue);return this.vectorBuffer=new Nh(pn({position1:n.vectorPosition1,position2:n.vectorPosition2,color:Si(2*i,o.r,o.g,o.b),color2:Si(2*i,o.r,o.g,o.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.vectorVisible,opacity:this.lineOpacity})),this.arcLength=n.arcPosition1.length/3,this.arcBuffer=new Nh(pn({position1:n.arcPosition1,position2:n.arcPosition2,color:Si(this.arcLength,o.r,o.g,o.b),color2:Si(this.arcLength,o.r,o.g,o.b)}),this.getBufferParams({linewidth:this.linewidth,visible:this.arcVisible,opacity:this.lineOpacity})),this.sectorLength=n.sectorPosition.length/3,this.sectorBuffer=new Vo({position:n.sectorPosition,color:Si(this.sectorLength,o.r,o.g,o.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.vectorBuffer,this.arcBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},i={},s={};if(e.color){const o=new Color(this.colorValue);Object.assign(n,{color:Si(2*this.n,o.r,o.g,o.b),color2:Si(2*this.n,o.r,o.g,o.b)}),Object.assign(i,{color:Si(this.arcLength,o.r,o.g,o.b),color2:Si(this.arcLength,o.r,o.g,o.b)}),Object.assign(s,{color:Si(this.sectorLength,o.r,o.g,o.b)})}this.vectorBuffer.setAttributes(n),this.arcBuffer.setAttributes(i),this.sectorBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),!e||e.vectorVisible===void 0&&e.arcVisible===void 0&&e.sectorVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&(this.vectorBuffer.setParameters({opacity:e.lineOpacity}),this.arcBuffer.setParameters({opacity:e.lineOpacity})),e&&e.opacity!==void 0&&(this.vectorBuffer.setParameters({opacity:this.lineOpacity}),this.arcBuffer.setParameters({opacity:this.lineOpacity})),e&&e.linewidth&&(this.vectorBuffer.setParameters({linewidth:e.linewidth}),this.arcBuffer.setParameters({linewidth:e.linewidth})),this}setVisibility(e,t){return super.setVisibility(e,!0),this.vectorBuffer&&this.vectorBuffer.setVisibility(this.vectorVisible&&this.visible),this.arcBuffer&&this.arcBuffer.setVisibility(this.arcVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}Le.add("angle",zh);const Uh=new Vector3,Vh=new Vector3,jh=new Vector3,Gh=new Vector3(0,1,0),Hh=Object.assign({radialSegments:1,openEnded:!0},No);function qh(r={}){const e=nt(r.radialSegments,10),t=nt(r.openEnded,!0),n=new Matrix4().makeRotationX(Math.PI/2),i=new CylinderGeometry(1,1,1,e,1,t);return i.applyMatrix4(n),i}class Wh extends Bc{constructor(e,t={}){super((function(s,o={}){const a=qh(o),l=s.position1.length,d=a.attributes.position.array.length/3,u=l/3,g=new Float32Array(2*u*d);return Pi(u,d,0,g),Pi(u,d,u*d,g),{position:new Float32Array(2*l),color:new Float32Array(2*l),primitiveId:g,picking:s.picking}})(e,t),t,qh(t)),this.updateNormals=!0;const n=e.position1.length,i=e.radius.length;this.__center=new Float32Array(n),this._position=new Float32Array(2*n),this._color=new Float32Array(2*n),this._from=new Float32Array(2*n),this._to=new Float32Array(2*n),this._radius=new Float32Array(2*i),this.setAttributes(e,!0)}get defaultParameters(){return Hh}applyPositionTransform(e,t,n){Vh.fromArray(this._from,n),jh.fromArray(this._to,n),e.lookAt(Vh,jh,Gh);const i=this._radius[t];Uh.set(i,i,Vh.distanceTo(jh)),e.scale(Uh)}setAttributes(e={},t){const n={};e.position1&&e.position2&&(vi(e.position1,e.position2,this.__center),vi(e.position1,this.__center,this._position),vi(this.__center,e.position2,this._position,e.position1.length),this._from.set(e.position1),this._from.set(this.__center,e.position1.length),this._to.set(this.__center),this._to.set(e.position2,this.__center.length),n.position=this._position),e.color&&e.color2&&(this._color.set(e.color),this._color.set(e.color2,e.color.length),n.color=this._color),e.radius&&(this._radius.set(e.radius),this._radius.set(e.radius,e.radius.length),n.radius=this._radius),super.setAttributes(n,t)}}ze.add("shader/CylinderImpostor.vert",`
attribute vec3 mapping;
attribute vec3 position1;
attribute vec3 position2;
attribute float radius;
varying vec3 axis;varying vec4 base_radius;varying vec4 end_b;varying vec3 U;varying vec3 V;
varying vec4 w;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform mat4 modelViewMatrixInverse;
uniform float ortho;
#include matrix_scale
void main(){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
base_radius.w = radius * matrixScale( modelViewMatrix );
vec3 center = position;
vec3 dir = normalize( position2 - position1 );
float ext = length( position2 - position1 ) / 2.0;
vec3 cam_dir;
if( ortho == 0.0 ){
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 0, 1 ) ).xyz - center;
}else{
cam_dir = ( modelViewMatrixInverse * vec4( 0, 0, 1, 0 ) ).xyz;
}
cam_dir = normalize( cam_dir );
vec3 ldir;
float b = dot( cam_dir, dir );
end_b.w = b;
if( b < 0.0 )
ldir = -ext * dir;
else
ldir = ext * dir;
vec3 left = radius * normalize( cross( cam_dir, ldir ) );
vec3 up = radius * normalize( cross( left, ldir ) );
axis = normalize( normalMatrix * ldir );
U = normalize( normalMatrix * up );
V = normalize( normalMatrix * left );
vec4 base4 = modelViewMatrix * vec4( center - ldir, 1.0 );
base_radius.xyz = base4.xyz / base4.w;
vec4 end4 = modelViewMatrix * vec4( center + ldir, 1.0 );
end_b.xyz = end4.xyz / end4.w;
w = modelViewMatrix * vec4(
center + mapping.x*ldir + mapping.y*left + mapping.z*up, 1.0
);
gl_Position = projectionMatrix * w;
gl_Position.z = 0.99;
}`),ze.add("shader/CylinderImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform mat4 projectionMatrix;
uniform float ortho;
varying vec3 axis;
varying vec4 base_radius;
varying vec4 end_b;
varying vec3 U;
varying vec3 V;
varying vec4 w;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float distSq3( vec3 v3a, vec3 v3b ){
return (
( v3a.x - v3b.x ) * ( v3a.x - v3b.x ) +
( v3a.y - v3b.y ) * ( v3a.y - v3b.y ) +
( v3a.z - v3b.z ) * ( v3a.z - v3b.z )
);
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
float calcClip( vec3 cameraPos ){
return dot( vec4( cameraPos, 1.0 ), vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
void main(){
vec3 ray_target = w.xyz / w.w;
vec3 base = base_radius.xyz; float vRadius = base_radius.w; vec3 end = end_b.xyz; float b = end_b.w;
vec3 ray_origin = vec3(0.0); vec3 ortho_ray_direction = vec3(0.0, 0.0, 1.0); vec3 persp_ray_direction = normalize(ray_origin - ray_target);
vec3 ray_direction = mix(persp_ray_direction, ortho_ray_direction, ortho);
mat3 basis = mat3( U, V, axis );
vec3 diff = ray_target - 0.5 * (base + end);
vec3 P = diff * basis;
float dz = dot( axis, ray_direction );
float radius2 = vRadius*vRadius;
vec3 D = vec3(dot(U, ray_direction),
dot(V, ray_direction),
dz);
float a0 = P.x*P.x + P.y*P.y - radius2;
float a1 = P.x*D.x + P.y*D.y;
float a2 = D.x*D.x + D.y*D.y;
float d = a1*a1 - a0*a2;
if (d < 0.0) {
discard;
}
float dist = (-a1 + sqrt(d)) / a2;
vec3 surface_point = ray_target + dist * ray_direction;
vec3 base_to_surface = surface_point - base;
vec3 _normal = normalize( base_to_surface - axis * dot(base_to_surface, axis) );
float base_cap_test = dot( base_to_surface, axis );
float end_cap_test = dot((surface_point - end), axis);
#ifndef CAP
vec3 new_point2 = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
vec3 tmp_point2 = new_point2 - base;
#endif
if (base_cap_test < 0.0) {
float dNV;
float near;
vec3 front_point;
if ( ortho == 1.0 ) {
front_point = ray_target;
} else {
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
front_point = ray_direction * near + ray_origin;
}
if (dot(front_point - base, front_point-base) > radius2) {
discard;
}
#ifdef CAP
surface_point = front_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(axis, end) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - end, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
if( end_cap_test > 0.0 )
{
float dNV;
float near;
vec3 end_point;
if ( ortho == 1.0 ) {
end_point = ray_target;
} else {
dNV = dot(axis, ray_direction);
if (dNV < 0.0) {
discard;
}
near = dot(axis, end) / dNV;
end_point = ray_direction * near + ray_origin;
}
if( dot(end_point - end, end_point-base) > radius2 ) {
discard;
}
#ifdef CAP
surface_point = end_point;
_normal = axis;
#else
surface_point = ray_target + ( (-a1 - sqrt(d)) / a2 ) * ray_direction;
dNV = dot(-axis, ray_direction);
near = dot(-axis, (base)) / dNV;
new_point2 = ray_direction * near + ray_origin;
if (dot(new_point2 - base, new_point2-base) < radius2) {
discard;
}
interior = true;
#endif
}
gl_FragDepthEXT = calcDepth( surface_point );
#ifdef NEAR_CLIP
if( calcClip( surface_point ) > 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
if( calcClip( surface_point ) > 0.0 ) {
discard;
}
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / vRadius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
dist = (-a1 - sqrt(d)) / a2;
surface_point = ray_target + dist * ray_direction;
interior = true;
gl_FragDepthEXT = calcDepth( surface_point );
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / vRadius );
}
}
#endif
if (gl_FragDepthEXT < 0.0) {
discard;
}
if (gl_FragDepthEXT > 1.0) {
discard;
}
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -surface_point;
vec3 vNormal = _normal;
vec3 vColor;
if( distSq3( surface_point, end ) < distSq3( surface_point, base ) ){
if( b < 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}else{
if( b > 0.0 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Xh=new Float32Array([-1,1,-1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),Yh=new Uint16Array([0,1,2,1,4,2,2,4,3,4,5,3]);class Kh extends Oc{constructor(e,t={}){super("v3",e,t)}get mapping(){return Xh}get mappingIndices(){return Yh}get mappingIndicesSize(){return 12}get mappingSize(){return 6}get mappingItemSize(){return 3}}const Zh=Object.assign({openEnded:!1},No),Qh=Object.assign({openEnded:{updateShader:!0}},zo);class Jh extends Kh{constructor(e,t={}){super(e,t),this.parameterTypes=Qh,this.isImpostor=!0,this.vertexShader="CylinderImpostor.vert",this.fragmentShader="CylinderImpostor.frag",this.addUniforms({modelViewMatrixInverse:{value:new Matrix4},ortho:{value:0}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Zh}getDefines(e){const t=Kh.prototype.getDefines.call(this,e);return this.parameters.openEnded||(t.CAP=1),t}}Object.assign({disableImpostor:!1},Hh,Zh);const tu=class{constructor(r,e={}){return!r.color2&&r.color&&(r.color2=r.color),!Pe||e&&e.disableImpostor?new Wh(r,e):new Jh(r,e)}};je.add("cylinder",tu);class eu extends Sh{constructor(e,t,n){super(e,t,n),this.type="axes",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0,showAxes:{type:"boolean",rebuild:!0},showBox:{type:"boolean",rebuild:!0}},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};t.radiusSize=nt(t.radiusSize,.5),t.colorValue=nt(t.colorValue,"lightgreen"),t.useInteriorColor=nt(t.useInteriorColor,!0),this.showAxes=nt(t.showAxes,!0),this.showBox=nt(t.showBox,!1),super.init(t)}getPrincipalAxes(){let e;const t=this.getAssembly();return t&&(e=t.partList[0].getSelection()),this.structureView.getPrincipalAxes(e)}getAxesData(e){const t=this.getPrincipalAxes(),n=new Color(this.colorValue);let i=0,s=0;this.showAxes&&(i+=6,s+=3),this.showBox&&(i+=8,s+=12);const o=new Float32Array(3*i),a=Si(i,n.r,n.g,n.b),l=Ai(i,this.radiusSize),d=new Float32Array(3*s),u=new Float32Array(3*s),g=Si(s,n.r,n.g,n.b),x=Ai(s,this.radiusSize);let y=0;if(this.showAxes){const _=function(h,f){h.toArray(o,2*y),f.toArray(o,2*y+3),h.toArray(d,y),f.toArray(u,y),y+=3};_(t.begA,t.endA),_(t.begB,t.endB),_(t.begC,t.endC)}if(this.showBox){const _=new Vector3,{d1a:h,d2a:f,d3a:E,d1b:m,d2b:S,d3b:w}=t.getProjectedScaleForAtoms(e);let v=2*y;const A=function(R,P,L){_.copy(t.center).addScaledVector(t.normVecA,R).addScaledVector(t.normVecB,P).addScaledVector(t.normVecC,L),_.toArray(o,v),v+=3};A(h,f,E),A(h,f,w),A(h,S,w),A(h,S,E),A(m,S,w),A(m,S,E),A(m,f,E),A(m,f,w);let M=y;const T=function(R,P){_.fromArray(o,2*y+3*R).toArray(d,M),_.fromArray(o,2*y+3*P).toArray(u,M),M+=3};T(0,1),T(0,3),T(0,6),T(1,2),T(1,7),T(2,3),T(2,4),T(3,5),T(4,5),T(4,7),T(5,6),T(6,7)}const b=new Ys(t);return{vertex:{position:o,color:a,radius:l,picking:b},edge:{position1:d,position2:u,color:g,color2:g,radius:x,picking:b}}}create(){const e=this.getAxesData(this.structureView);this.sphereBuffer=new Uc(e.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new tu(e.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=this.getAxesData(t.sview),i={},s={};e&&!e.position||(Object.assign(i,{position:n.vertex.position}),Object.assign(s,{position1:n.edge.position1,position2:n.edge.position2})),e&&!e.color||(Object.assign(i,{color:n.vertex.color}),Object.assign(s,{color:n.edge.color,color2:n.edge.color})),e&&!e.radius||(Object.assign(i,{radius:n.vertex.radius}),Object.assign(s,{radius:n.edge.radius})),this.sphereBuffer.setAttributes(i),this.cylinderBuffer.setAttributes(s)}}Le.add("axes",eu);class iu extends Sh{constructor(e,t,n){super(e,t,n),this.type="ball+stick",this.parameters=Object.assign({sphereDetail:!0,radialSegments:!0,openEnded:!0,disableImpostor:!0,aspectRatio:{type:"number",precision:1,max:10,min:1},lineOnly:{type:"boolean",rebuild:!0},cylinderOnly:{type:"boolean",rebuild:!0},multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondScale:{type:"number",precision:2,max:1,min:.01},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusType=nt(t.radiusType,"size"),t.radiusSize=nt(t.radiusSize,.15),t.useInteriorColor=nt(t.useInteriorColor,!0),this.aspectRatio=nt(t.aspectRatio,2),this.lineOnly=nt(t.lineOnly,!1),this.cylinderOnly=nt(t.cylinderOnly,!1),this.multipleBond=nt(t.multipleBond,"off"),this.bondSpacing=nt(t.bondSpacing,1),this.bondScale=nt(t.bondScale,.4),this.linewidth=nt(t.linewidth,2),super.init(t)}getAtomRadius(e){return this.aspectRatio*super.getAtomRadius(e)}getAtomParams(e,t){var n=super.getAtomParams(e,t);return n.radiusParams.scale*=this.aspectRatio,n}getAtomData(e,t,n){return e.getAtomData(this.getAtomParams(t,n))}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,bondScale:this.bondScale},t),super.getBondParams(e,t)}getBondData(e,t,n){return e.getBondData(this.getBondParams(t,n))}createData(e){const t=[];if(this.lineOnly)this.lineBuffer=new Nh(this.getBondData(e,{position:!0,color:!0,picking:!0}),this.getBufferParams({linewidth:this.linewidth})),t.push(this.lineBuffer);else{const n=new tu(this.getBondData(e),this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}));if(t.push(n),!this.cylinderOnly){const i=new Uc(this.getAtomData(e),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));t.push(i)}}return{bufferList:t}}updateData(e,t){this.multipleBond!=="off"&&e&&e.radius&&(e.position=!0);const n=this.getBondData(t.sview,e);if(this.lineOnly){const a={};e&&!e.position||Object.assign(a,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(a,{color:n.color,color2:n.color2}),t.bufferList[0].setAttributes(a)}else{var i={};if(e&&!e.position||Object.assign(i,{position1:n.position1,position2:n.position2}),e&&!e.color||Object.assign(i,{color:n.color,color2:n.color2}),e&&!e.radius||Object.assign(i,{radius:n.radius}),t.bufferList[0].setAttributes(i),!this.cylinderOnly){var s=this.getAtomData(t.sview,e),o={};e&&!e.position||Object.assign(o,{position:s.position}),e&&!e.color||Object.assign(o,{color:s.color}),e&&!e.radius||Object.assign(o,{radius:s.radius}),t.bufferList[1].setAttributes(o)}}}setParameters(e={}){let t=!1;const n={};return(e.aspectRatio||e.bondSpacing||e.bondScale)&&(Object.assign(n,{radius:!0}),Pe&&!this.disableImpostor||(t=!0)),super.setParameters(e,n,t),this}}Le.add("ball+stick",iu);class ru extends iu{constructor(e,t,n){super(e,t,n),this.type="backbone",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null}),this.init(n)}init(e){var t=e||{};t.aspectRatio=nt(t.aspectRatio,1),t.radiusSize=nt(t.radiusSize,.25),super.init(t)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}getAtomData(e,t,n){return e.getBackboneAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){return e.getBackboneBondData(this.getBondParams(t,n))}}Le.add("backbone",ru);class nu extends iu{constructor(e,t,n){super(e,t,n),this.type="base",this.parameters=Object.assign({},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){let t=e||{};t.aspectRatio=nt(t.aspectRatio,1),t.radiusSize=nt(t.radiusSize,.3),super.init(t)}getAtomData(e,t,n){return e.getRungAtomData(this.getAtomParams(t,n))}getBondData(e,t,n){let i=this.getBondParams(t,n);return Object.assign(i.colorParams,{rung:!0}),e.getRungBondData(i)}}Le.add("base",nu);class su{constructor(e,t){this.m=e,this.tension=t,this.dt=1/this.m,this.delta=1e-4,this.vec1=new Vector3,this.vec2=new Vector3,this.vDir=new Vector3,this.vTan=new Vector3,this.vNorm=new Vector3,this.vBin=new Vector3,this.m2=Math.ceil(this.m/2)}interpolateToArr(e,t,n,i,s,o,a){o[a+0]=Ft(e.x,t.x,n.x,i.x,s,this.tension),o[a+1]=Ft(e.y,t.y,n.y,i.y,s,this.tension),o[a+2]=Ft(e.z,t.z,n.z,i.z,s,this.tension)}interpolateToVec(e,t,n,i,s,o){o.x=Ft(e.x,t.x,n.x,i.x,s,this.tension),o.y=Ft(e.y,t.y,n.y,i.y,s,this.tension),o.z=Ft(e.z,t.z,n.z,i.z,s,this.tension)}interpolatePosition(e,t,n,i,s,o){for(var a=0;a<this.m;++a){var l=o+3*a,d=this.dt*a;this.interpolateToArr(e,t,n,i,d,s,l)}}interpolateTangent(e,t,n,i,s,o){for(var a=0;a<this.m;++a){var l=this.dt*a,d=l-this.delta,u=l+this.delta,g=o+3*a;d<0&&(d=0),u>1&&(u=1),this.interpolateToVec(e,t,n,i,d,this.vec1),this.interpolateToVec(e,t,n,i,u,this.vec2),this.vec2.sub(this.vec1).normalize(),this.vec2.toArray(s,g)}}vectorSubdivide(e,t,n,i,s){let o,a=t.next(),l=t.next(),d=t.next();const u=t.size,g=u-1;let x=i||0;for(let y=0;y<g;++y)o=a,a=l,l=d,d=t.next(),e.apply(this,[o,a,l,d,n,x]),x+=3*this.m;s&&(o=t.get(u-2),a=t.get(u-1),l=t.get(0),d=t.get(1),e.apply(this,[o,a,l,d,n,x]),x+=3*this.m)}getPosition(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolatePosition,e,t,n,i);var s=e.size-1,o=s*this.m*3;i&&(o+=3*this.m);var a=e.get(i?0:s);t[o]=a.x,t[o+1]=a.y,t[o+2]=a.z}getTangent(e,t,n,i){e.reset(),this.vectorSubdivide(this.interpolateTangent,e,t,n,i);let s=(e.size-1)*this.m*3;i&&(s+=3*this.m),ki(t,t,s-3,s,3)}interpolateNormalDir(e,t,n,i,s,o,a,l,d,u,g,x,y){for(let b=0;b<this.m;++b){let _=x+3*b;y&&(_+=3*this.m2);const h=this.dt*b;this.interpolateToVec(e,t,n,i,h,this.vec1),this.interpolateToVec(s,o,a,l,h,this.vec2),this.vDir.subVectors(this.vec2,this.vec1).normalize(),this.vTan.fromArray(d,_),this.vBin.crossVectors(this.vDir,this.vTan).normalize(),this.vBin.toArray(g,_),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(u,_)}}interpolateNormal(e,t,n,i,s){for(var o=0;o<this.m;++o){var a=s+3*o;e.copy(this.vNorm),this.vTan.fromArray(t,a),this.vBin.crossVectors(e,this.vTan).normalize(),this.vBin.toArray(i,a),this.vNorm.crossVectors(this.vTan,this.vBin).normalize(),this.vNorm.toArray(n,a)}}getNormal(e,t,n,i,s,o){this.vNorm.set(0,0,1);const a=e-1;let l=s||0;for(var d=0;d<a;++d)this.interpolateNormal(this.vDir,t,n,i,l),l+=3*this.m;o&&(this.interpolateNormal(this.vDir,t,n,i,l),l+=3*this.m),this.vBin.toArray(i,l),this.vNorm.toArray(n,l)}getNormalDir(e,t,n,i,s,o,a,l){e.reset(),t.reset();const d=new Vector3,u=new Vector3,g=new Vector3,x=new Vector3,y=new Vector3,b=new Vector3().copy(e.next()),_=new Vector3().copy(e.next()),h=new Vector3().copy(e.next()),f=new Vector3,E=new Vector3().copy(t.next()),m=new Vector3().copy(t.next()),S=new Vector3().copy(t.next());this.vNorm.set(0,0,1);let w=e.size,v=w-1,A=o||0;for(var M=0;M<v;++M)y.copy(b),b.copy(_),_.copy(h),h.copy(e.next()),f.copy(E),E.copy(m),m.copy(S),S.copy(t.next()),M===0?(d.subVectors(f,y),u.subVectors(E,b),d.dot(u)<0&&(u.multiplyScalar(-1),E.addVectors(b,u)),g.subVectors(m,_),u.dot(g)<0&&(g.multiplyScalar(-1),m.addVectors(_,g))):g.copy(x),x.subVectors(S,h),g.dot(x)<0&&(x.multiplyScalar(-1),S.addVectors(h,x)),this.interpolateNormalDir(y,b,_,h,f,E,m,S,n,i,s,A,l),A+=3*this.m;if(a&&(y.copy(e.get(w-2)),b.copy(e.get(w-1)),_.copy(e.get(0)),h.copy(e.get(1)),f.copy(t.get(w-2)),E.copy(t.get(w-1)),m.copy(t.get(0)),S.copy(t.get(1)),g.copy(x),x.subVectors(S,h),g.dot(x)<0&&(x.multiplyScalar(-1),S.addVectors(h,x)),this.interpolateNormalDir(y,b,_,h,f,E,m,S,n,i,s,A,l),A+=3*this.m),l){this.vBin.fromArray(s,3*this.m2),this.vNorm.fromArray(i,3*this.m2);for(var T=0;T<this.m2;++T)this.vBin.toArray(s,3*T),this.vNorm.toArray(i,3*T)}else this.vBin.toArray(s,A),this.vNorm.toArray(i,A)}interpolateColor(e,t,n,i,s){var o,a;for(o=0;o<this.m2;++o)a=s+3*o,n.apply(this,[e,i,a]);for(o=this.m2;o<this.m;++o)a=s+3*o,n.apply(this,[t,i,a])}getColor(e,t,n,i,s){let o;e.reset(),e.next();let a=e.next();for(var l=e.size,d=l-1,u=i||0,g=0;g<d;++g)o=a,a=e.next(),this.interpolateColor(o,a,t,n,u),u+=3*this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolateColor(o,a,t,n,u),u+=3*this.m),n[u]=n[u-3],n[u+1]=n[u-2],n[u+2]=n[u-1]}interpolatePicking(e,t,n,i,s){var o;for(o=0;o<this.m2;++o)i[s+o]=n.apply(this,[e]);for(o=this.m2;o<this.m;++o)i[s+o]=n.apply(this,[t])}getPicking(e,t,n,i,s){let o;e.reset(),e.next();let a=e.next();const l=e.size,d=l-1;let u=i||0;for(var g=0;g<d;++g)o=a,a=e.next(),this.interpolatePicking(o,a,t,n,u),u+=this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolatePicking(o,a,t,n,u),u+=this.m),n[u]=n[u-1]}interpolateSize(e,t,n,i,s){const o=n.apply(this,[e]),a=n.apply(this,[t]);for(let l=0;l<this.m;++l){let d=l/this.m;i[s+l]=(1-d)*o+d*a}}getSize(e,t,n,i,s){let o;e.reset(),e.next();let a=e.next();const l=e.size,d=l-1;let u=i||0;for(var g=0;g<d;++g)o=a,a=e.next(),this.interpolateSize(o,a,t,n,u),u+=this.m;s&&(o=e.get(l-1),a=e.get(0),this.interpolateSize(o,a,t,n,u),u+=this.m),n[u]=n[u-1]}}class ou{constructor(e,t){this.polymer=e,this.size=e.residueCount;var n=t||{};this.directional=n.directional||!1,this.positionIterator=n.positionIterator||!1,this.subdiv=n.subdiv||1,this.smoothSheet=n.smoothSheet||!1,n.tension?this.tension=n.tension:this.tension=this.polymer.isNucleic()?.5:.9,this.interpolator=new su(this.subdiv,this.tension)}getAtomIterator(e,t){const n=this.polymer,i=n.structure,s=n.residueCount;let o=0,a=-1;const l=[i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy(),i.getAtomProxy()],d=[new Vector3,new Vector3,new Vector3,new Vector3];var u=i.getAtomProxy(),g=i.getAtomProxy();function x(y){var b=l[o%4];if(b.index=n.getAtomIndexByType(y,e),t&&y>0&&y<s&&b.sstruc==="e"){var _=d[o%4];return u.index=n.getAtomIndexByType(y+1,e),g.index=n.getAtomIndexByType(y-1,e),_.addVectors(u,g).add(b).add(b).multiplyScalar(.25),o+=1,_}return o+=1,b}return{size:s,next:function(){var y=x(a);return a+=1,y},get:x,reset:function(){o=0,a=-1}}}getSubdividedColor(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t*3+3;n.isCyclic&&(i+=3*t);var s=new Float32Array(i),o=this.getAtomIterator("trace"),a=e||{};a.structure=n.structure;var l=Oe.getScheme(a);return this.interpolator.getColor(o,(function(d,u,g){l.atomColorToArray(d,u,g)}),s,0,n.isCyclic),{color:s}}getSubdividedPicking(){var e=this.subdiv,t=this.polymer,n=(t.residueCount-1)*e+1;t.isCyclic&&(n+=e);var i=t.structure,s=this.getAtomIterator("trace"),o=new Float32Array(n);return this.interpolator.getPicking(s,(function(a){return a.index}),o,0,t.isCyclic),{picking:new Xs(o,i)}}getSubdividedPosition(){return{position:this.getPosition()}}getSubdividedOrientation(){const e=this.getTangent(),t=this.getNormals(e);return{tangent:e,normal:t.normal,binormal:t.binormal}}getSubdividedSize(e){var t=this.subdiv,n=this.polymer,i=(n.residueCount-1)*t+1;n.isCyclic&&(i+=t);var s=new Float32Array(i),o=this.getAtomIterator("trace"),a=new ma(e);return this.interpolator.getSize(o,(function(l){return a.atomRadius(l)}),s,0,n.isCyclic),{size:s}}getPosition(){const e=this.subdiv,t=this.polymer;let n=(t.residueCount-1)*e*3+3;t.isCyclic&&(n+=3*e);const i=new Float32Array(n),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getPosition(s,i,0,t.isCyclic),i}getTangent(){const e=this.subdiv,t=this.polymer;let n=(this.size-1)*e*3+3;t.isCyclic&&(n+=3*e);const i=new Float32Array(n),s=this.positionIterator||this.getAtomIterator("trace",this.smoothSheet);return this.interpolator.getTangent(s,i,0,t.isCyclic),i}getNormals(e){const t=this.subdiv,n=this.polymer,i=n.isProtein(),s=this.size;let o=(s-1)*t*3+3;n.isCyclic&&(o+=3*t);const a=new Float32Array(o),l=new Float32Array(o);if(this.directional&&!this.polymer.isCg()){const d=this.getAtomIterator("direction1"),u=this.getAtomIterator("direction2");this.interpolator.getNormalDir(d,u,e,a,l,0,n.isCyclic,i)}else this.interpolator.getNormal(s,e,a,l,0,n.isCyclic);return{normal:a,binormal:l}}}const au=new Vector3,cu=new Vector3,lu=Object.assign({radialSegments:4,capped:!1,aspectRatio:1},No);class hu extends Vo{constructor(e,t={}){super((function(n,i={}){const s=nt(i.radialSegments,4),o=nt(i.capped,!1),a=o?s:0,l=o?s-2:0,d=n.position.length/3,u=d*s*3+2*a*3,g=2*(d-1)*s*3+2*l*3;return{position:new Float32Array(u),color:new Float32Array(u),index:bt(g,u/3),normal:new Float32Array(u),picking:n.picking}})(e,t),t),this.capVertices=this.parameters.capped?this.parameters.radialSegments:0,this.capTriangles=this.parameters.capped?this.parameters.radialSegments-2:0,this.size2=e.position.length/3,e.primitiveId=Ci(this.size2),this.setAttributes(e),this.makeIndex()}get defaultParameters(){return lu}setAttributes(e={}){const t=this.parameters.aspectRatio,n=this.size2,i=n-1,s=this.parameters.radialSegments,o=this.geometry.attributes;let a,l,d,u,g,x,y,b,_,h,f,E,m;e.position&&(a=e.position,l=e.normal,d=e.binormal,u=e.tangent,x=e.size,b=o.position.array,h=o.normal.array,o.position.needsUpdate=!0,o.normal.needsUpdate=!0),e.color&&(g=e.color,_=o.color.array,o.color.needsUpdate=!0),e.primitiveId&&(y=e.primitiveId,f=o.primitiveId.array,o.primitiveId.needsUpdate=!0);let S=0,w=0,v=0,A=0,M=0,T=0,R=0,P=0,L=0,O=0;const I=[],N=[],k=[],U=[],F=[],j=[];if(a)for(let H=0;H<s;++H){const B=H/s*2*Math.PI;I[H]=t*Math.cos(B),N[H]=Math.sin(B),k[H]=t*Math.cos(B-.01),U[H]=Math.sin(B-.01),F[H]=t*Math.cos(B+.01),j[H]=Math.sin(B+.01)}for(let H=0;H<n;++H){E=3*H,m=E*s,a&&u&&l&&d&&x&&(au.set(u[E],u[E+1],u[E+2]),w=l[E],v=l[E+1],A=l[E+2],M=d[E],T=d[E+1],R=d[E+2],P=a[E],L=a[E+1],O=a[E+2],S=x[H]);for(let B=0;B<s;++B){const V=m+3*B;if(a){const K=-S*I[B],q=S*N[B],Te=-S*k[B],Fe=S*U[B],We=-S*F[B],J=S*j[B];b[V]=P+K*w+q*M,b[V+1]=L+K*v+q*T,b[V+2]=O+K*A+q*R,cu.set(We*w+J*M-(Te*w+Fe*M),We*v+J*T-(Te*v+Fe*T),We*A+J*R-(Te*A+Fe*R)).cross(au),h[V]=cu.x,h[V+1]=cu.y,h[V+2]=cu.z}g&&(_[V]=g[E],_[V+1]=g[E+1],_[V+2]=g[E+2]),y&&(f[H*s+B]=y[H])}}E=0,m=3*n*s;for(let H=0;H<s;++H){const B=E+3*H,V=m+3*H;a&&u&&(b[V]=b[B],b[V+1]=b[B+1],b[V+2]=b[B+2],h[V]=u[E],h[V+1]=u[E+1],h[V+2]=u[E+2]),g&&(_[V]=_[B],_[V+1]=_[B+1],_[V+2]=_[B+2]),y&&(f[n*s+H]=f[0+H])}E=3*(n-1)*s,m=3*(n+1)*s;for(let H=0;H<s;++H){const B=E+3*H,V=m+3*H;a&&u&&(b[V]=b[B],b[V+1]=b[B+1],b[V+2]=b[B+2],h[V]=u[3*i],h[V+1]=u[3*i+1],h[V+2]=u[3*i+2]),g&&(_[V]=_[B],_[V+1]=_[B+1],_[V+2]=_[B+2]),y&&(f[(n+1)*s+H]=f[(n-1)*s+H])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void ke.error("Index is null");const t=e.array,n=this.size2,i=n-1,s=this.capTriangles,o=this.parameters.radialSegments,a=this.parameters.radialSegments+1;let l,d;for(let g=0;g<i;++g){const x=g*o*3*2,y=g*o,b=(g+1)*o;for(let _=0;_<o;++_)d=x+3*_*2,t[d]=y+_,t[d+1]=y+(_+1)%o,t[d+2]=b+_,t[d+3]=b+_,t[d+4]=y+(_+1)%o,t[d+5]=b+(_+1)%o}const u=[0];for(let g=1;g<a/2;++g)u.push(g),o-g!==g&&u.push(o-g);d=i*o*3*2,l=n*o;for(let g=0;g<u.length-2;++g)g%2==0?(t[d+3*g+0]=l+u[g+0],t[d+3*g+1]=l+u[g+1],t[d+3*g+2]=l+u[g+2]):(t[d+3*g+0]=l+u[g+2],t[d+3*g+1]=l+u[g+1],t[d+3*g+2]=l+u[g+0]);d=i*o*3*2+3*s,l=n*o+o;for(let g=0;g<u.length-2;++g)g%2==0?(t[d+3*g+0]=l+u[g+0],t[d+3*g+1]=l+u[g+1],t[d+3*g+2]=l+u[g+2]):(t[d+3*g+0]=l+u[g+2],t[d+3*g+1]=l+u[g+1],t[d+3*g+2]=l+u[g+0])}}class uu extends Sh{constructor(e,t,n){super(e,t,n),this.type="cartoon",this.parameters=Object.assign({aspectRatio:{type:"number",precision:1,max:10,min:1,rebuild:!0},subdiv:{type:"integer",max:50,min:1,rebuild:!0},radialSegments:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},capped:{type:"boolean",rebuild:!0},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters),this.init(n)}init(e){var t=e||{};t.colorScheme=nt(t.colorScheme,"chainname"),t.colorScale=nt(t.colorScale,"RdYlBu"),t.radiusType=nt(t.radiusType,"sstruc"),t.radiusScale=nt(t.radiusScale,.7),t.useInteriorColor=nt(t.useInteriorColor,!0),this.aspectRatio=nt(t.aspectRatio,5),this.tension=nt(t.tension,NaN),this.capped=nt(t.capped,!0),this.smoothSheet=nt(t.smoothSheet,!1),t.quality==="low"?(this.subdiv=3,this.radialSegments=6):t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=nt(t.subdiv,6),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:this.aspectRatio!==1,smoothSheet:this.smoothSheet},e)}getSpline(e){return new ou(e,this.getSplineParams())}getAspectRatio(e){return e.isCg()?1:this.aspectRatio}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){let t=[],n=[];return this.structure.eachPolymer((i=>{if(i.residueCount<4)return;n.push(i);const s=this.getSpline(i),o=this.getAspectRatio(i),a=s.getSubdividedPosition(),l=s.getSubdividedOrientation(),d=s.getSubdividedColor(this.getColorParams()),u=s.getSubdividedPicking(),g=s.getSubdividedSize(this.getRadiusParams());t.push(new hu(Object.assign({},a,l,d,u,g),this.getBufferParams({radialSegments:this.radialSegments,aspectRatio:o,capped:this.capped})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){De&&ke.time(this.type+" repr update"),e=e||{};for(var n=0,i=t.polymerList.length;n<i;++n){var s={},o=t.polymerList[n],a=this.getSpline(o),l=this.getAspectRatio(o);if(Object.assign(t.bufferList[n],{aspectRatio:l}),e.position||e.radius){var d=a.getSubdividedPosition(),u=a.getSubdividedOrientation(),g=a.getSubdividedSize(this.getRadiusParams(l));s.position=d.position,s.normal=u.normal,s.binormal=u.binormal,s.tangent=u.tangent,s.size=g.size}if(e.color){var x=a.getSubdividedColor(this.getColorParams());s.color=x.color}if(e.picking){var y=a.getSubdividedPicking();s.picking=y.picking}t.bufferList[n].setAttributes(s)}De&&ke.timeEnd(this.type+" repr update")}setParameters(e){var t={};return e&&e.aspectRatio&&(t.radius=!0),e&&e.tension&&(t.position=!0),super.setParameters(e,t,!1),this}}Le.add("cartoon",uu);class du extends Sh{constructor(e,t,n){super(e,t,n),this.type="contact",this.parameters=Object.assign({hydrogenBond:{type:"boolean",rebuild:!0},weakHydrogenBond:{type:"boolean",rebuild:!0},waterHydrogenBond:{type:"boolean",rebuild:!0},backboneHydrogenBond:{type:"boolean",rebuild:!0},hydrophobic:{type:"boolean",rebuild:!0},halogenBond:{type:"boolean",rebuild:!0},ionicInteraction:{type:"boolean",rebuild:!0},metalCoordination:{type:"boolean",rebuild:!0},cationPi:{type:"boolean",rebuild:!0},piStacking:{type:"boolean",rebuild:!0},filterSele:{type:"text",rebuild:!0},labelVisible:{type:"boolean",rebuild:!0},labelFixedSize:{type:"boolean",buffer:"fixedSize"},labelSize:{type:"number",precision:3,max:10,min:.001,rebuild:!0},labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},maxHydrophobicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondSulfurDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHbondAccAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondDonAngle:{type:"integer",max:180,min:0,rebuild:!0},maxHbondAccPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxHbondDonPlaneAngle:{type:"integer",max:90,min:0,rebuild:!0},maxPiStackingDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxPiStackingAngle:{type:"integer",max:180,min:0,rebuild:!0},maxCationPiDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxCationPiOffset:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxIonicDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},maxHalogenBondAngle:{type:"integer",max:180,min:0,rebuild:!0},maxMetalDist:{type:"number",precision:1,max:10,min:.1,rebuild:!0},refineSaltBridges:{type:"boolean",rebuild:!0},masterModelIndex:{type:"integer",max:1e3,min:-1,rebuild:!0},lineOfSightDistFactor:{type:"number",precision:1,max:10,min:0,rebuild:!0},radialSegments:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.radiusSize=nt(t.radiusSize,.05),t.useInteriorColor=nt(t.useInteriorColor,!0),this.hydrogenBond=nt(t.hydrogenBond,!0),this.weakHydrogenBond=nt(t.weakHydrogenBond,!1),this.waterHydrogenBond=nt(t.waterHydrogenBond,!1),this.backboneHydrogenBond=nt(t.backboneHydrogenBond,!1),this.hydrophobic=nt(t.hydrophobic,!1),this.halogenBond=nt(t.halogenBond,!0),this.ionicInteraction=nt(t.ionicInteraction,!0),this.metalCoordination=nt(t.metalCoordination,!0),this.cationPi=nt(t.cationPi,!0),this.piStacking=nt(t.piStacking,!0),this.filterSele=nt(t.filterSele,""),this.labelVisible=nt(t.labelVisible,!1),this.labelFixedSize=nt(t.labelFixedSize,!1),this.labelSize=nt(t.labelSize,2),this.labelUnit=nt(t.labelUnit,""),this.maxHydrophobicDist=nt(t.maxHydrophobicDist,4),this.maxHbondDist=nt(t.maxHbondDist,3.5),this.maxHbondSulfurDist=nt(t.maxHbondSulfurDist,4.1),this.maxHbondAccAngle=nt(t.maxHbondAccAngle,45),this.maxHbondDonAngle=nt(t.maxHbondDonAngle,45),this.maxHbondAccPlaneAngle=nt(t.maxHbondAccPlaneAngle,90),this.maxHbondDonPlaneAngle=nt(t.maxHbondDonPlaneAngle,30),this.maxPiStackingDist=nt(t.maxPiStackingDist,5.5),this.maxPiStackingOffset=nt(t.maxPiStackingOffset,2),this.maxPiStackingAngle=nt(t.maxPiStackingAngle,30),this.maxCationPiDist=nt(t.maxCationPiDist,6),this.maxCationPiOffset=nt(t.maxCationPiOffset,2),this.maxIonicDist=nt(t.maxIonicDist,5),this.maxHalogenBondDist=nt(t.maxHalogenBondDist,3.5),this.maxHalogenBondAngle=nt(t.maxHalogenBondAngle,30),this.maxMetalDist=nt(t.maxMetalDist,3),this.refineSaltBridges=nt(t.refineSaltBridges,!0),this.masterModelIndex=nt(t.masterModelIndex,-1),this.lineOfSightDistFactor=nt(t.lineOfSightDistFactor,1),super.init(t)}getAtomRadius(){return 0}getContactData(e){const t={maxHydrophobicDist:this.maxHydrophobicDist,maxHbondDist:this.maxHbondDist,maxHbondSulfurDist:this.maxHbondSulfurDist,maxHbondAccAngle:this.maxHbondAccAngle,maxHbondDonAngle:this.maxHbondDonAngle,maxHbondAccPlaneAngle:this.maxHbondAccPlaneAngle,maxHbondDonPlaneAngle:this.maxHbondDonPlaneAngle,maxPiStackingDist:this.maxPiStackingDist,maxPiStackingOffset:this.maxPiStackingOffset,maxPiStackingAngle:this.maxPiStackingAngle,maxCationPiDist:this.maxCationPiDist,maxCationPiOffset:this.maxCationPiOffset,maxIonicDist:this.maxIonicDist,maxHalogenBondDist:this.maxHalogenBondDist,maxHalogenBondAngle:this.maxHalogenBondAngle,maxMetalDist:this.maxMetalDist,refineSaltBridges:this.refineSaltBridges,masterModelIndex:this.masterModelIndex,lineOfSightDistFactor:this.lineOfSightDistFactor},n={hydrogenBond:this.hydrogenBond,weakHydrogenBond:this.weakHydrogenBond,waterHydrogenBond:this.waterHydrogenBond,backboneHydrogenBond:this.backboneHydrogenBond,hydrophobic:this.hydrophobic,halogenBond:this.halogenBond,ionicInteraction:this.ionicInteraction,metalCoordination:this.metalCoordination,cationPi:this.cationPi,piStacking:this.piStacking,radius:this.radiusSize*this.radiusScale,filterSele:this.filterSele};return Hs(Us(e,t),e,n)}createData(e){const t=this.getContactData(e),n=[new tu(mn(t),this.getBufferParams({sphereDetail:1,dullInterior:!0,disableImpostor:this.disableImpostor}))];if(this.labelVisible){const i={size:this.labelSize,unit:this.labelUnit};n.push(new Oh((function(s,o){const a=vi(s.position1,s.position2),l=[],d=wi(s.position1,s.position2),u=d.length/3;for(let g=0;g<u;g++){const x=3*g,y=Math.sqrt(Math.pow(d[x],2)+Math.pow(d[x+1],2)+Math.pow(d[x+2],2));switch(o.unit){case"angstrom":l[g]=y.toFixed(2)+" ";break;case"nm":l[g]=(y/10).toFixed(2)+" nm";break;default:l[g]=y.toFixed(2)}}return{position:a,size:Ai(a.length/3,o.size),color:s.color,text:l}})(t,i),this.getBufferParams({fixedSize:this.labelFixedSize})))}return{bufferList:n}}}Le.add("contact",du);class mu extends Ch{constructor(e,t,n){super(e,t,n),this.type="dihedral",this.parameters=Object.assign({atomQuad:{type:"hidden",rebuild:!0},extendLine:{type:"boolean",rebuild:!0,default:!0},lineVisible:{type:"boolean",default:!0},planeVisible:{type:"boolean",default:!0},sectorVisible:{type:"boolean",default:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.side=nt(t.side,"double"),t.opacity=nt(t.opacity,.5),this.atomQuad=nt(t.atomQuad,[]),this.extendLine=nt(t.extendLine,!0),this.lineVisible=nt(t.lineVisible,!0),this.planeVisible=nt(t.planeVisible,!0),this.sectorVisible=nt(t.sectorVisible,!0),super.init(t)}createData(e){if(!e.atomCount||!this.atomQuad.length)return;const t=(function(a,l={}){const d=nt(l.angleStep,Math.PI/90),u=a.length,g=a.length/12,x=new Float32Array(g),y=new Float32Array(3*g),b=new Array(g),_=new Array(g),h=new Array(g),f=new Array(g),E=new Array(g);let m=0,S=0,w=0;const v=Xr(),A=Xr(),M=Xr(),T=Xr(),R=Xr(),P=Xr(),L=Xr(),O=Xr(),I=Xr(),N=Xr(),k=Xr(),U=Xr(),F=Xr(),j=Xr(),H=Xr();let B=0;for(var V=0;V<u;V+=12){if(Jr(v,a,V),Jr(A,a,V+3),Jr(M,a,V+6),Jr(T,a,V+9),Zr(R,v,A),Zr(P,M,A),rn(P)===0)continue;Zr(L,T,M),sn(O,P,.5),Qr(I,A,O),on(R,R),on(P,P),on(L,L),Zr(O,v,I);const er=Kr(O,P)>0;Zr(O,T,I);const tr=Kr(O,P)<0;if(sn(O,P,Kr(P,R)),Zr(N,R,O),sn(O,P,Kr(P,L)),Zr(k,L,O),rn(N)===0||rn(k)===0)continue;on(N,N),on(k,k);const Hm=x[B]=dn(N,k);b[B]=(_i*Hm).toFixed(1)+"",Yr(j,N,P),on(j,j),Kr(j,k)<0&&un(j,j),Ih(O,I,N,j,Hm/2),tn(O,y,3*B);const oi=Math.ceil(Hm/d),h0=oi+(l.extendLine?4:2),l0=l.extendLine?36:0,M0=new Float32Array(3*h0),U0=new Float32Array(3*h0),_0=new Float32Array(9*oi),C0=new Float32Array(l0);_[B]=M0,h[B]=U0,f[B]=_0,E[B]=C0,l.extendLine&&(er?(Zr(O,v,M),on(O,O),sn(U,O,1/Kr(N,O)),Qr(U,U,M)):(sn(U,R,1/Kr(N,R)),Qr(U,U,A)),tr?(Zr(O,T,A),on(O,O),sn(F,O,1/Kr(k,O)),Qr(F,F,A)):(sn(F,L,1/Kr(k,L)),Qr(F,F,M))),Qr(H,I,N);let P0=0;l.extendLine?(tn(v,M0,P0),tn(U,U0,P0),P0+=3,tn(U,M0,P0),tn(H,U0,P0),P0+=3,tn(U,C0,0),tn(H,C0,3),tn(er?M:A,C0,6),tn(er?M:A,C0,9),tn(H,C0,12),tn(I,C0,15)):(tn(I,M0,P0),tn(H,U0,P0),P0+=3);const R0=function(Xe,d0){const w0=9*d0;tn(I,_0,w0),tn(H,_0,w0+3),tn(H,M0,P0),Ih(H,I,N,j,Xe),tn(H,_0,w0+6),tn(H,U0,P0),P0+=3};let si=0;for(let Xe=d;Xe<Hm;Xe+=d)R0(Xe,si++);R0(Hm,si++),l.extendLine?(tn(H,M0,3*(h0-2)),tn(F,U0,3*(h0-2)),tn(F,M0,3*(h0-1)),tn(T,U0,3*(h0-1)),tn(F,C0,18),tn(H,C0,21),tn(tr?A:M,C0,24),tn(tr?A:M,C0,27),tn(H,C0,30),tn(I,C0,33)):(tn(H,M0,P0),tn(I,U0,P0),P0+=3),m+=3*h0,S+=9*oi,w+=l0,B+=1}const K=B,q=new Float32Array(m),Te=new Float32Array(m),Fe=new Float32Array(S),We=new Float32Array(w);let J=0,et=0,ht=0;for(let er=0;er<K;er++){const tr=_[er],Hm=h[er],oi=f[er],h0=E[er];ki(tr,q,0,J,tr.length),ki(Hm,Te,0,J,Hm.length),ki(oi,Fe,0,et,oi.length),ki(h0,We,0,ht,h0.length),J+=tr.length,et+=oi.length,ht+=h0.length}return{labelPosition:y.subarray(0,3*K),labelText:b.slice(0,K),linePosition1:q,linePosition2:Te,planePosition:We,sectorPosition:Fe}})(Ph(e,this.atomQuad),{extendLine:this.extendLine}),n=this.n=t.labelText.length,i=new Color(this.labelColor);this.textBuffer=new Oh({position:t.labelPosition,size:Ai(n,this.labelSize),color:Si(n,i.r,i.g,i.b),text:t.labelText},this.getLabelBufferParams());const s=new Color(this.colorValue);this.lineLength=t.linePosition1.length/3;const o=Si(this.lineLength,s.r,s.g,s.b);return this.lineBuffer=new Nh(pn({position1:t.linePosition1,position2:t.linePosition2,color:o}),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),this.planeLength=t.planePosition.length/3,this.planeBuffer=new Vo({position:t.planePosition,color:Si(this.planeLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.planeVisible})),this.sectorLength=t.sectorPosition.length/3,this.sectorBuffer=new Vo({position:t.sectorPosition,color:Si(this.sectorLength,s.r,s.g,s.b)},this.getBufferParams({visible:this.sectorVisible})),{bufferList:[this.textBuffer,this.lineBuffer,this.planeBuffer,this.sectorBuffer]}}updateData(e,t){super.updateData(e,t);const n={},i={},s={};if(e.color){const o=new Color(this.colorValue);Object.assign(n,{color:Si(this.lineLength,o.r,o.g,o.b),color2:Si(this.lineLength,o.r,o.g,o.b)}),Object.assign(i,{color:Si(this.planeLength,o.r,o.g,o.b)}),Object.assign(s,{color:Si(this.sectorLength,o.r,o.g,o.b)})}this.lineBuffer.setAttributes(n),this.planeBuffer.setAttributes(i),this.sectorBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),!e||e.lineVisible===void 0&&e.sectorVisible===void 0&&e.planeVisible===void 0||this.setVisibility(this.visible),e&&e.lineOpacity&&this.lineBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.lineBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.lineBuffer.setParameters({linewidth:e.linewidth}),this}setVisibility(e,t){return super.setVisibility(e,!0),this.lineBuffer&&this.lineBuffer.setVisibility(this.lineVisible&&this.visible),this.planeBuffer&&this.planeBuffer.setVisibility(this.planeVisible&&this.visible),this.sectorBuffer&&this.sectorBuffer.setVisibility(this.sectorVisible&&this.visible),t||this.viewer.requestRender(),this}}Le.add("dihedral",mu);function fu(r,e){function t(i,s){return s in i}const n=Object.assign({},r);for(const i in n)t(n,i)&&t(e,i)&&(n[i]=nt(e[i],n[i]));return n}function pu(r,e){const t=new Color(r),n=new Float32Array(3*e);return Si(e,t.r,t.g,t.b,n),n}class gu extends Sh{constructor(e,t,n){super(e,t,n),this.type="dihedral-histogram",this.parameters=Object.assign({histogramsData:{type:"hidden",rebuild:!0},histogramBinBorderVisible:{type:"boolean",default:!0},scaleBinToSectorArea:{type:"boolean",rebuild:!0,default:!1}},this.parameters),this.init(n)}init(e){const t=e||{},n=fu({histogramBinBorderColor:"grey",adjacentBondArrowColor:"black",distantBondArrowColor:"magenta",frontHistogramColor:"green",backHistogramColor:"blue",opaqueMiddleDiscColor:"white"},t);Object.assign(this,n);const i=fu({histogramsData:[],histogramOpacity:1,opaqueMiddleDiscVisible:!0,opaqueMiddleDiscOpacity:1,histogramBinBorderVisible:!0,histogramBinBorderWidth:1,histogramBinBorderOpacity:.5,bondArrowVisible:!0,bondArrowWidth:2,bondArrowOpacity:1,scaleBinToSectorArea:!1},t);Object.assign(this,i),this.histogramsData.forEach((s=>{const o=fu(n,s);Object.assign(s,o)})),t.side=nt(t.side,"double"),t.opacity=nt(t.opacity,.5),t.radiusType=nt(t.radiusType,"size"),t.radiusSize=nt(t.radiusSize,.15),super.init(t)}getHistogramBinBorderBufferParameters(){return this.getBufferParams({linewidth:this.histogramBinBorderWidth,visible:this.histogramBinBorderVisible,opacity:this.histogramBinBorderOpacity})}getBondArrowsBufferParameters(){return this.getBufferParams({linewidth:this.bondArrowWidth,visible:this.bondArrowVisible,opacity:this.bondArrowOpacity})}getOpaqueMiddleDiscBufferParameters(){return this.getBufferParams({visible:this.opaqueMiddleDiscVisible,opacity:this.opaqueMiddleDiscOpacity})}getHistogramBufferParameters(){return this.getBufferParams({visible:!0,opacity:this.histogramOpacity,side:"double"})}createData(e){if(!e.atomCount||!this.histogramsData.length)return;this.histogramsData.forEach((a=>a.atomPositions=Ph(e,[a.atomQuad])));const t=this.scaleBinToSectorArea?function(a){return Math.sqrt(a)}:function(a){return a};function n(a){const l=a.map((g=>g.length)),d=new Float32Array(Bi(l));let u=0;for(let g=0;g<a.length;g++)d.set(a[g],u),u+=a[g].length;return d}function i(a,l){return new Nh({position1:n(a.map((d=>d.startPoints))),position2:n(a.map((d=>d.endPoints))),color:n(a.map((d=>d.startColors))),color2:n(a.map((d=>d.endColors)))},l)}function s(a,l){return new Vo({position:n(a.map((d=>d.triangles))),color:n(a.map((d=>d.triangleColors)))},l)}this.histogramsData.forEach((a=>a.histogram360Scaled=a.histogram360.map(t)));const o=[];for(let a=0;a<this.histogramsData.length;a++){let l,d=this.histogramsData[a];d.histogram360.length>=3&&(l=yu(d)),l!==void 0&&o.push(l)}return this.frontHistogramBinBordersBuffer=i(o.map((a=>a.frontHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.backHistogramBinBordersBuffer=i(o.map((a=>a.backHistogramBinBorders)),this.getHistogramBinBorderBufferParameters()),this.adjacentBondArrowsBuffer=i(o.map((a=>a.adjacentBondArrows)),this.getBondArrowsBufferParameters()),this.distantBondArrowsBuffer=i(o.map((a=>a.distantBondArrows)),this.getBondArrowsBufferParameters()),this.opaqueMiddleDiscBuffer=s(o.map((a=>a.opaqueMiddleDisc)),this.getOpaqueMiddleDiscBufferParameters()),this.frontHistogramBuffer=s(o.map((a=>a.frontHistogram)),this.getHistogramBufferParameters()),this.backHistogramBuffer=s(o.map((a=>a.backHistogram)),this.getHistogramBufferParameters()),{bufferList:[].concat(this.frontHistogramBinBordersBuffer,this.backHistogramBinBordersBuffer,this.adjacentBondArrowsBuffer,this.distantBondArrowsBuffer,this.opaqueMiddleDiscBuffer,this.frontHistogramBuffer,this.backHistogramBuffer)}}setParameters(e){return super.setParameters(e,{},!1),e&&e.histogramBinBorderVisible!==void 0&&this.setVisibility(this.visible),this}setVisibility(e,t){return super.setVisibility(e,!0),this.frontHistogramBinBordersBuffer&&this.frontHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),this.backHistogramBinBordersBuffer&&this.backHistogramBinBordersBuffer.setVisibility(this.histogramBinBorderVisible),t||this.viewer.requestRender(),this}}function yu(r){const e=r.atomPositions,t=r.histogram360Scaled,n=t.length<=180?360:2*t.length,i={triangles:new Float32Array(3*n*3),triangleColors:pu(r.opaqueMiddleDiscColor,3*n)},s={triangles:new Float32Array(3*t.length*3),triangleColors:pu(r.frontHistogramColor,3*t.length)},o={triangles:new Float32Array(3*t.length*3),triangleColors:pu(r.backHistogramColor,3*t.length)},a={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:pu(r.histogramBinBorderColor,t.length),endColors:pu(r.histogramBinBorderColor,t.length)},l={startPoints:new Float32Array(3*t.length),endPoints:new Float32Array(3*t.length),startColors:pu(r.histogramBinBorderColor,t.length),endColors:pu(r.histogramBinBorderColor,t.length)},d={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:pu(r.adjacentBondArrowColor,t.length),endColors:pu(r.adjacentBondArrowColor,t.length)},u={startPoints:new Float32Array(6),endPoints:new Float32Array(6),startColors:pu(r.distantBondArrowColor,t.length),endColors:pu(r.distantBondArrowColor,t.length)},g=Xr(),x=Xr(),y=Xr(),b=Xr(),_=Xr(),h=Xr(),f=Xr(),E=Xr(),m=Xr(),S=Xr(),w=Xr(),v=Xr(),A=Xr(),M=Xr(),T=Xr(),R=Xr(),P=[g,x,y,b];for(let j=0;j<P.length;j++)Jr(P[j],e,3*j);if(Zr(_,g,x),Zr(h,y,x),Zr(E,b,y),rn(h)===0||(sn(T,h,.5),Qr(m,x,T),on(_,_),on(h,h),on(E,E),un(f,h),sn(T,f,Kr(f,_)),Zr(S,_,T),sn(T,h,Kr(h,E)),Zr(w,E,T),rn(S)===0||rn(w)===0))return;on(S,S),on(w,w);const L=Math.acos(Kr(S,w));Yr(v,f,S),Yr(A,h,w),on(v,v),on(A,A);let O=L;Kr(v,w)<0&&(O=-L),Qr(M,m,S);const I=Math.max.apply(null,t),N=2*Math.PI/t.length;function k(j,H,B,V,K){const q=3*H*3;tn(m,j,q);const Te=Number(t[H])/I;sn(T,B,Te),sn(R,V,Te),Ih(M,m,T,R,H*K),tn(M,j,q+3),Ih(M,m,T,R,(H+1)*K),tn(M,j,q+6)}function U(j,H,B,V,K){ki(m,d.startPoints,0,3*B,m.length),Ih(T,m,V,K,0+0*N),ki(T,d.endPoints,0,3*B,m.length),ki(m,u.startPoints,0,3*B,m.length),Ih(T,m,V,K,O),ki(T,u.endPoints,0,3*B,m.length);for(let q=0;q<t.length;q++)ki(m,H.startPoints,0,3*q,m.length),Ih(T,m,V,K,0+N*q),ki(T,H.endPoints,0,3*q,T.length);for(let q=0;q<t.length;q++)k(j.triangles,q,V,K,N)}const F=2*Math.PI/n;for(let j=0;j<n;j++){const H=3*j*3;tn(m,i.triangles,H),Ih(M,m,S,v,j*F),tn(M,i.triangles,H+3),Ih(M,m,S,v,(j+1)*F),tn(M,i.triangles,H+6)}return sn(T,h,-.01),Qr(m,m,T),U(s,a,0,S,v),sn(T,h,.02),Qr(m,m,T),U(o,l,1,w,A),{opaqueMiddleDisc:i,frontHistogram:s,backHistogram:o,frontHistogramBinBorders:a,backHistogramBinBorders:l,adjacentBondArrows:d,distantBondArrows:u}}Le.add("dihedral-histogram",gu);class bu extends Ch{constructor(e,t,n){super(e,t,n),this.type="distance",this.parameters=Object.assign({radialSegments:!0,openEnded:!0,disableImpostor:!0,labelUnit:{type:"select",rebuild:!0,options:{"":"",angstrom:"angstrom",nm:"nm"}},useCylinder:{type:"boolean",rebuild:!0},atomPair:{type:"hidden",rebuild:!0}},this.parameters),this.init(n)}init(e){const t=e||{};t.linewidth=nt(t.linewidth,5),t.radiusType=nt(t.radiusType,"size"),t.radiusSize=nt(t.radiusSize,.2),this.labelUnit=nt(t.labelUnit,""),this.useCylinder=nt(t.useCylinder,!1),this.atomPair=nt(t.atomPair,[]),super.init(t)}getDistanceData(e,t){let n=t.length;const i=new Array(n);let s=new Float32Array(3*n);const o=new me,a=new me,l=new _a,d=e.getAtomProxy(),u=e.getAtomProxy();let g=0;const x=e.getAtomSet();t.forEach(((b,_)=>{let h=b[0],f=b[1];if(typeof h=="number"&&Number.isInteger(h)&&typeof f=="number"&&Number.isInteger(f)){if(!x.get(h)||!x.get(f))return void(g+=1);d.index=h,u.index=f}else{o.setString(h),a.setString(f);var E=e.getAtomIndices(o),m=e.getAtomIndices(a);if(!E.length||!m.length)return void(g+=1);d.index=E[0],u.index=m[0]}l.addBond(d,u,1),_-=g;var S=d.distanceTo(u);switch(this.labelUnit){case"angstrom":i[_]=S.toFixed(2)+" ";break;case"nm":i[_]=(S/10).toFixed(2)+" nm";break;default:i[_]=S.toFixed(2)}var w=3*_;s[w+0]=(d.x+u.x)/2,s[w+1]=(d.y+u.y)/2,s[w+2]=(d.z+u.z)/2})),g>0&&(n-=g,s=s.subarray(0,3*n));var y=new En(l.count,!0);return{text:i,position:s,bondSet:y,bondStore:l}}getBondData(e,t,n){const i=e.getBondData(this.getBondParams(t,n));return i.picking&&(i.picking=new Js(i.picking.array,i.picking.structure,n.bondStore)),i}createData(e){if(!e.atomCount||!this.atomPair.length)return;const t=this.atomPair.length,n=new Color(this.labelColor),i=this.getDistanceData(e,this.atomPair);this.textBuffer=new Oh({position:i.position,size:Ai(t,this.labelSize),color:Si(t,n.r,n.g,n.b),text:i.text},this.getLabelBufferParams());const s={bondSet:i.bondSet,bondStore:i.bondStore},o=this.getBondData(e,{position:!0,color:!0,picking:!0,radius:this.useCylinder},s);return this.useCylinder?this.distanceBuffer=new tu(o,this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})):this.distanceBuffer=new Nh(fn(o),this.getBufferParams({linewidth:this.linewidth,visible:this.lineVisible,opacity:this.lineOpacity})),{bondSet:i.bondSet,bondStore:i.bondStore,position:i.position,bufferList:[this.textBuffer,this.distanceBuffer]}}updateData(e,t){super.updateData(e,t);const n={bondSet:t.bondSet,bondStore:t.bondStore},i=this.getBondData(t.sview,e,n),s={};e&&!e.color||Object.assign(s,{color:i.color,color2:i.color2}),e&&!e.radius||Object.assign(s,{radius:i.radius}),this.distanceBuffer.setAttributes(s)}setParameters(e){return super.setParameters(e,{},!1),this.useCylinder||(e&&e.lineOpacity&&this.distanceBuffer.setParameters({opacity:e.lineOpacity}),e&&e.opacity!==void 0&&this.distanceBuffer.setParameters({opacity:this.lineOpacity}),e&&e.linewidth&&this.distanceBuffer.setParameters({linewidth:e.linewidth})),this}}function _u(r){return 2*(r.position.length/3)*3}Le.add("distance",bu);const xu=Object.assign({scale:1,color:"grey"},No);class vu extends Uo{constructor(e,t={}){super({position:new Float32Array(_u(e)),color:new Float32Array(_u(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag";const n=new Color(this.parameters.color),i=this.geometry.attributes;Si(_u(e)/3,n.r,n.g,n.b,i.color.array),this.setAttributes(e)}get defaultParameters(){return xu}setAttributes(e={}){const t=this.geometry.attributes;let n,i,s;e.position&&e.vector&&(n=e.position,i=e.vector,s=t.position.array,t.position.needsUpdate=!0);const o=this.size/2,a=this.parameters.scale;if(n&&i)for(let l=0;l<o;l++){const d=2*l*3,u=3*l;s[d+0]=n[u+0],s[d+1]=n[u+1],s[d+2]=n[u+2],s[d+3]=n[u+0]+i[u+0]*a,s[d+4]=n[u+1]+i[u+1]*a,s[d+5]=n[u+2]+i[u+2]*a}}}class wu extends Sh{constructor(e,t,n){super(e,t,n),this.type="helixorient",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){const t=e||{};t.colorScheme=nt(t.colorScheme,"sstruc"),t.radiusType=nt(t.radiusType,"size"),t.radiusSize=nt(t.radiusSize,.15),t.radiusScale=nt(t.radiusScale,1),t.useInteriorColor=nt(t.useInteriorColor,!0),super.init(t)}createData(e){const t=[],n=[];return this.structure.eachPolymer((i=>{if(i.residueCount<4)return;n.push(i);const s=new Sa(i),o=s.getPosition(),a=s.getColor(this.getColorParams()),l=s.getSize(this.getRadiusParams()),d=s.getPicking();t.push(new Uc({position:o.center,color:a.color,radius:l.size,picking:d.picking},this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),new vu({position:o.center,vector:o.axis},this.getBufferParams({color:"skyblue",scale:1})),new vu({position:o.center,vector:o.resdir},this.getBufferParams({color:"lightgreen",scale:1})))}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){De&&ke.time(this.type+" repr update"),e=e||{};for(let n=0,i=t.polymerList.length;n<i;++n){const s=3*n,o={},a=t.polymerList[n],l=new Sa(a);if(e.position){const d=l.getPosition();Object.assign(o,{position:d.center}),t.bufferList[s+1].setAttributes({position:d.center,vector:d.axis}),t.bufferList[s+2].setAttributes({position:d.center,vector:d.resdir})}t.bufferList[s].setAttributes(o)}De&&ke.timeEnd(this.type+" repr update")}}Le.add("helixorient",wu);class Au extends iu{constructor(e,t,n){super(e,t,n),this.type="licorice",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,super.init(t)}}Le.add("licorice",Au),ze.add("shader/HyperballStickImpostor.vert",`
attribute vec3 mapping;
attribute float radius;
attribute float radius2;
attribute vec3 position1;
attribute vec3 position2;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
attribute vec3 color2;
varying vec3 vColor1;
varying vec3 vColor2;
#endif
uniform float shrink;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewProjectionMatrixInverse;
void main(){
vRadius = radius;
vRadius2 = radius2;
vec4 spaceposition;
vec3 position_atom1;
vec3 position_atom2;
vec4 vertex_position;
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
vColor1 = color;
vColor2 = color2;
#endif
float radius1 = radius;
position_atom1 = position1;
position_atom2 = position2;
float distance = distance( position_atom1, position_atom2 );
spaceposition.z = mapping.z * distance;
if (radius1 > radius2) {
spaceposition.y = mapping.y * 1.5 * radius1;
spaceposition.x = mapping.x * 1.5 * radius1;
} else {
spaceposition.y = mapping.y * 1.5 * radius2;
spaceposition.x = mapping.x * 1.5 * radius2;
}
spaceposition.w = 1.0;
vec4 e3 = vec4( 1.0 );
vec3 e1, e1_temp, e2, e2_temp;
e3.xyz = normalize(position_atom1-position_atom2);
if (e3.z == 0.0) { e3.z = 0.0000000000001;}
if ( (position_atom1.x - position_atom2.x) == 0.0) { position_atom1.x += 0.001;}
if ( (position_atom1.y - position_atom2.y) == 0.0) { position_atom1.y += 0.001;}
if ( (position_atom1.z - position_atom2.z) == 0.0) { position_atom1.z += 0.001;}
vec4 focus = vec4( 1.0 );
focus.x = ( position_atom1.x*position_atom1.x - position_atom2.x*position_atom2.x +
( radius2*radius2 - radius1*radius1 )*e3.x*e3.x/shrink )/(2.0*(position_atom1.x - position_atom2.x));
focus.y = ( position_atom1.y*position_atom1.y - position_atom2.y*position_atom2.y +
( radius2*radius2 - radius1*radius1 )*e3.y*e3.y/shrink )/(2.0*(position_atom1.y - position_atom2.y));
focus.z = ( position_atom1.z*position_atom1.z - position_atom2.z*position_atom2.z +
( radius2*radius2 - radius1*radius1 )*e3.z*e3.z/shrink )/(2.0*(position_atom1.z - position_atom2.z));
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2_temp = e1.yzx * e3.zxy - e1.zxy * e3.yzx;
e2 = normalize(e2_temp);
mat3 R= mat3( e1.xyz, e2.xyz, e3.xyz );
vertex_position.xyz = R * spaceposition.xyz;
vertex_position.w = 1.0;
vertex_position.x += (position_atom1.x+position_atom2.x) / 2.0;
vertex_position.y += (position_atom1.y+position_atom2.y) / 2.0;
vertex_position.z += (position_atom1.z+position_atom2.z) / 2.0;
gl_Position = modelViewProjectionMatrix * vertex_position;
vec4 i_near, i_far;
vec4 near = gl_Position;
near.z = 0.0 ;
near = modelViewProjectionMatrixInverse * near;
i_near = near;
vec4 far = gl_Position;
far.z = far.w ;
i_far = modelViewProjectionMatrixInverse * far;
prime1 = vec4( position_atom1 - (position_atom1 - focus.xyz)*shrink, 1.0 );
prime2 = vec4( position_atom2 - (position_atom2 - focus.xyz)*shrink, 1.0 );
float Rsquare = (radius1*radius1/shrink) - (
(position_atom1.x - focus.x)*(position_atom1.x - focus.x) +
(position_atom1.y - focus.y)*(position_atom1.y - focus.y) +
(position_atom1.z - focus.z)*(position_atom1.z - focus.z)
);
focus.w = Rsquare;
matrix_near = mat4( i_near, i_far, focus, e3 );
gl_Position.z = 1.0;
}`),ze.add("shader/HyperballStickImpostor.frag",`#define STANDARD
#define IMPOSTOR
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 interiorColor;
uniform float interiorDarkening;
uniform float roughness;
uniform float metalness;
uniform float opacity;
uniform float clipNear;
uniform float shrink;
uniform mat4 modelViewMatrix;
uniform mat4 modelViewProjectionMatrix;
uniform mat4 modelViewMatrixInverseTranspose;
uniform mat4 projectionMatrix;
varying mat4 matrix_near;
varying vec4 prime1;
varying vec4 prime2;
varying float vRadius;
varying float vRadius2;
#ifdef PICKING
uniform float objectId;
varying vec3 vPickingColor;
#else
varying vec3 vColor1;
varying vec3 vColor2;
#include common
#include fog_pars_fragment
#include bsdfs
#include lights_pars_begin
#include lights_physical_pars_fragment
#endif
bool interior = false;
float calcClip( vec4 cameraPos ){
return dot( cameraPos, vec4( 0.0, 0.0, 1.0, clipNear - 0.5 ) );
}
float calcClip( vec3 cameraPos ){
return calcClip( vec4( cameraPos, 1.0 ) );
}
float calcDepth( in vec3 cameraPos ){
vec2 clipZW = cameraPos.z * projectionMatrix[2].zw + projectionMatrix[3].zw;
return 0.5 + 0.5 * clipZW.x / clipZW.y;
}
struct Ray {
vec3 origin ;
vec3 direction ;
};
bool cutoff_plane (vec3 M, vec3 cutoff, vec3 x3){
float a = x3.x;
float b = x3.y;
float c = x3.z;
float d = -x3.x*cutoff.x-x3.y*cutoff.y-x3.z*cutoff.z;
float l = a*M.x+b*M.y+c*M.z+d;
if (l<0.0) {return true;}
else{return false;}
}
vec3 isect_surf(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t1 =(-b-sqrt(delta))/a;
return r.origin+t1*r.direction;
}
vec3 isect_surf2(Ray r, mat4 matrix_coef){
vec4 direction = vec4(r.direction, 0.0);
vec4 origin = vec4(r.origin, 1.0);
float a = dot(direction,(matrix_coef*direction));
float b = dot(origin,(matrix_coef*direction));
float c = dot(origin,(matrix_coef*origin));
float delta =b*b-a*c;
gl_FragColor.a = 1.0;
if (delta<0.0){
discard;
}
float t2 =(-b+sqrt(delta))/a;
return r.origin+t2*r.direction;
}
Ray primary_ray(vec4 near1, vec4 far1){
vec3 near=near1.xyz/near1.w;
vec3 far=far1.xyz/far1.w;
return Ray(near,far-near);
}
float update_z_buffer(vec3 M, mat4 ModelViewP){
float depth1;
vec4 Ms=(ModelViewP*vec4(M,1.0));
return depth1=(1.0+Ms.z/Ms.w)/2.0;
}
void main(){
float radius = max( vRadius, vRadius2 );
vec4 i_near, i_far, focus;
vec3 e3, e1, e1_temp, e2;
i_near = vec4(matrix_near[0][0],matrix_near[0][1],matrix_near[0][2],matrix_near[0][3]);
i_far = vec4(matrix_near[1][0],matrix_near[1][1],matrix_near[1][2],matrix_near[1][3]);
focus = vec4(matrix_near[2][0],matrix_near[2][1],matrix_near[2][2],matrix_near[2][3]);
e3 = vec3(matrix_near[3][0],matrix_near[3][1],matrix_near[3][2]);
e1.x = 1.0;
e1.y = 1.0;
e1.z = ( (e3.x*focus.x + e3.y*focus.y + e3.z*focus.z) - e1.x*e3.x - e1.y*e3.y)/e3.z;
e1_temp = e1 - focus.xyz;
e1 = normalize(e1_temp);
e2 = normalize(cross(e1,e3));
vec4 equation = focus;
float shrinkfactor = shrink;
float t1 = -1.0/(1.0-shrinkfactor);
float t2 = 1.0/(shrinkfactor);
vec4 colonne1, colonne2, colonne3, colonne4;
mat4 mat;
vec3 equation1 = vec3(t2,t2,t1);
float A1 = - e1.x*equation.x - e1.y*equation.y - e1.z*equation.z;
float A2 = - e2.x*equation.x - e2.y*equation.y - e2.z*equation.z;
float A3 = - e3.x*equation.x - e3.y*equation.y - e3.z*equation.z;
float A11 = equation1.x*e1.x*e1.x + equation1.y*e2.x*e2.x + equation1.z*e3.x*e3.x;
float A21 = equation1.x*e1.x*e1.y + equation1.y*e2.x*e2.y + equation1.z*e3.x*e3.y;
float A31 = equation1.x*e1.x*e1.z + equation1.y*e2.x*e2.z + equation1.z*e3.x*e3.z;
float A41 = equation1.x*e1.x*A1 + equation1.y*e2.x*A2 + equation1.z*e3.x*A3;
float A22 = equation1.x*e1.y*e1.y + equation1.y*e2.y*e2.y + equation1.z*e3.y*e3.y;
float A32 = equation1.x*e1.y*e1.z + equation1.y*e2.y*e2.z + equation1.z*e3.y*e3.z;
float A42 = equation1.x*e1.y*A1 + equation1.y*e2.y*A2 + equation1.z*e3.y*A3;
float A33 = equation1.x*e1.z*e1.z + equation1.y*e2.z*e2.z + equation1.z*e3.z*e3.z;
float A43 = equation1.x*e1.z*A1 + equation1.y*e2.z*A2 + equation1.z*e3.z*A3;
float A44 = equation1.x*A1*A1 + equation1.y*A2*A2 + equation1.z*A3*A3 - equation.w;
colonne1 = vec4(A11,A21,A31,A41);
colonne2 = vec4(A21,A22,A32,A42);
colonne3 = vec4(A31,A32,A33,A43);
colonne4 = vec4(A41,A42,A43,A44);
mat = mat4(colonne1,colonne2,colonne3,colonne4);
Ray ray = primary_ray(i_near,i_far) ;
vec3 M;
M = isect_surf(ray, mat);
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
vec4 M1 = vec4(M,1.0);
vec4 M2 = mat*M1;
vec3 _normal = ( modelViewMatrixInverseTranspose * M2 ).xyz;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
#ifdef NEAR_CLIP
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 ){
M = isect_surf2(ray, mat);
if( calcClip( modelViewMatrix * vec4( M, 1.0 ) ) > 0.0 )
discard;
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = max( 0.0, calcDepth( vec3( - ( clipNear - 0.5 ) ) ) + ( 0.0000001 / radius ) );
}
}else if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix);
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#else
if( gl_FragDepthEXT <= 0.0 ){
M = isect_surf2(ray, mat);
interior = true;
gl_FragDepthEXT = update_z_buffer(M, modelViewProjectionMatrix) ;
if( gl_FragDepthEXT >= 0.0 ){
gl_FragDepthEXT = 0.0 + ( 0.0000001 / radius );
}
}
#endif
if (cutoff_plane(M, prime1.xyz, -e3) || cutoff_plane(M, prime2.xyz, e3)){ discard; }
if (gl_FragDepthEXT < 0.0)
discard;
if (gl_FragDepthEXT > 1.0)
discard;
float distance_ratio = ((M.x-prime2.x)*e3.x + (M.y-prime2.y)*e3.y +(M.z-prime2.z)*e3.z) /
distance(prime2.xyz,prime1.xyz);
#ifdef PICKING
if( opacity < 0.3 )
discard;
gl_FragColor = vec4( vPickingColor, objectId );
#else
vec3 vViewPosition = -( modelViewMatrix * vec4( M, 1.0 ) ).xyz;
vec3 vNormal = _normal;
vec3 vColor;
if( distance_ratio>0.5 ){
vColor = vColor1;
}else{
vColor = vColor2;
}
vec4 diffuseColor = vec4( diffuse, opacity );
ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveLight = emissive;
#include color_fragment
#include roughnessmap_fragment
#include metalnessmap_fragment
vec3 normal = normalize( vNormal );
vec3 nonPerturbedNormal = normal;
#include lights_physical_fragment
#include lights_fragment_begin
#include lights_fragment_end
vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;
if( interior ){
#ifdef USE_INTERIOR_COLOR
outgoingLight.xyz = interiorColor;
#else
#ifdef DIFFUSE_INTERIOR
outgoingLight.xyz = vColor;
#endif
#endif
outgoingLight.xyz *= 1.0 - interiorDarkening;
}
gl_FragColor = vec4( outgoingLight, diffuseColor.a );
#include premultiplied_alpha_fragment
#include tonemapping_fragment
#include colorspace_fragment
#include fog_fragment
#endif
}`);const Su=new Float32Array([-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,-1,1,1]),Cu=new Uint16Array([0,1,2,0,2,3,1,5,6,1,6,2,4,6,5,4,7,6,0,7,4,0,3,7,0,5,1,0,4,5,3,2,6,3,6,7]);class Pu extends Oc{constructor(e,t={}){super("v3",e,t)}get mapping(){return Su}get mappingIndices(){return Cu}get mappingIndicesSize(){return 36}get mappingSize(){return 8}get mappingItemSize(){return 3}}const Iu=Object.assign({shrink:.14},No),ku=Object.assign({shrink:{uniform:!0}},zo);class Mu extends Pu{constructor(e,t={}){super(e,t),this.parameterTypes=ku,this.isImpostor=!0,this.vertexShader="HyperballStickImpostor.vert",this.fragmentShader="HyperballStickImpostor.frag",this.addUniforms({modelViewProjectionMatrix:{value:new Matrix4},modelViewProjectionMatrixInverse:{value:new Matrix4},modelViewMatrixInverseTranspose:{value:new Matrix4},shrink:{value:this.parameters.shrink}}),this.addAttributes({position1:{type:"v3",value:null},position2:{type:"v3",value:null},color2:{type:"c",value:null},radius:{type:"f",value:null},radius2:{type:"f",value:null}}),this.setAttributes(e),this.makeMapping()}get defaultParameters(){return Iu}}Object.assign({disableImpostor:!1},Hh,Iu);const Tu=class{constructor(r,e={}){return!Pe||e&&e.disableImpostor?(r.radius=(function(t,n){const i=t.length,s=new Float32Array(i);for(let o=0;o<i;o++)s[o]=Math.min(t[o],n[o]);return s})(r.radius,r.radius2),new Wh(r,e)):new Mu(r,e)}};class Du extends Au{constructor(e,t,n){super(e,t,n),this.type="hyperball",this.parameters=Object.assign({shrink:{type:"number",precision:3,max:1,min:.001,buffer:!0}},this.parameters,{multipleBond:null,bondSpacing:null})}init(e){var t=e||{};t.radiusScale=nt(t.radiusScale,.2),t.radiusType=nt(t.radiusType,"vdw"),t.useInteriorColor=nt(t.useInteriorColor,!0),this.shrink=nt(t.shrink,.12),super.init(t)}getBondParams(e,t){return e&&!e.radius||(t=Object.assign({radius2:!0},t)),super.getBondParams(e,t)}createData(e){var t=new Uc(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0}));return this.__center=new Float32Array(3*e.bondCount),{bufferList:[t,new Tu(e.getBondData(this.getBondParams()),this.getBufferParams({shrink:this.shrink,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams()),i=t.sview.getBondData(this.getBondParams()),s={},o={};if(!e||e.position){Object.assign(s,{position:n.position});var a=i.position1,l=i.position2;Object.assign(o,{position:vi(a,l,this.__center),position1:a,position2:l})}e&&!e.color||(Object.assign(s,{color:n.color}),Object.assign(o,{color:i.color,color2:i.color2})),e&&!e.radius||(Object.assign(s,{radius:n.radius}),Object.assign(o,{radius:i.radius,radius2:i.radius2})),t.bufferList[0].setAttributes(s),t.bufferList[1].setAttributes(o)}}Le.add("hyperball",Du);class Bu{constructor(e,t={},n=""){this.type=e,this.text=t,this.format=n,this.errorLogged=!1}atomLabel(e){let t;switch(this.type){case"atomname":t=e.atomname;break;case"atomindex":t=`${e.index}`;break;case"occupancy":t=e.occupancy.toFixed(2);break;case"bfactor":t=e.bfactor.toFixed(2);break;case"serial":t=`${e.serial}`;break;case"element":t=e.element;break;case"atom":t=`${e.atomname}|${e.index}`;break;case"resname":t=e.resname;break;case"resno":t=`${e.resno}`;break;case"res":t=`${es[e.resname.toUpperCase()]||e.resname}${e.resno}`;break;case"residue":const n=es[e.resname.toUpperCase()];t=n&&!e.inscode?`${n}${e.resno}`:`[${e.resname}]${e.resno}${e.inscode}`;break;case"text":t=this.text[e.index];break;case"format":try{t=sprintfExports.sprintf(this.format,e)}catch(i){this.errorLogged||(this.errorLogged=!0,console.log(i.message))}break;default:t=e.qualifiedName()}return t===void 0?"":t}}Bu.types={"":"",atomname:"atom name",atomindex:"atom index",occupancy:"occupancy",bfactor:"b-factor",serial:"serial",element:"element",atom:"atom name + index",resname:"residue name",resno:"residue no",res:"one letter code + no",residue:"[residue name] + no + inscode",text:"text",format:"format",qualified:"qualified name"};class Fu extends Sh{constructor(e,t,n){super(e,t,n),this.type="label",this.parameters=Object.assign({labelType:{type:"select",options:Bu.types,rebuild:!0},labelText:{type:"hidden",rebuild:!0},labelFormat:{type:"text",rebuild:!0},labelGrouping:{type:"select",options:{atom:"atom",residue:"residue"},rebuild:!0},fontFamily:{type:"select",options:{"sans-serif":"sans-serif",monospace:"monospace",serif:"serif"},buffer:!0},fontStyle:{type:"select",options:{normal:"normal",italic:"italic"},buffer:!0},fontWeight:{type:"select",options:{normal:"normal",bold:"bold"},buffer:!0},xOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},yOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},zOffset:{type:"number",precision:1,max:20,min:-20,buffer:!0},attachment:{type:"select",options:{"bottom-left":"bottom-left","bottom-center":"bottom-center","bottom-right":"bottom-right","middle-left":"middle-left","middle-center":"middle-center","middle-right":"middle-right","top-left":"top-left","top-center":"top-center","top-right":"top-right"},rebuild:!0},showBorder:{type:"boolean",buffer:!0},borderColor:{type:"color",buffer:!0},borderWidth:{type:"number",precision:2,max:.3,min:0,buffer:!0},showBackground:{type:"boolean",rebuild:!0},backgroundColor:{type:"color",buffer:!0},backgroundMargin:{type:"number",precision:2,max:2,min:0,rebuild:!0},backgroundOpacity:{type:"range",step:.01,max:1,min:0,buffer:!0},fixedSize:{type:"boolean",buffer:!0}},this.parameters,{side:null,flatShaded:null,wireframe:null,linewidth:null,roughness:null,metalness:null,diffuse:null}),this.init(n)}init(e){const t=e||{};this.labelType=nt(t.labelType,"res"),this.labelText=nt(t.labelText,{}),this.labelFormat=nt(t.labelFormat,""),this.labelGrouping=nt(t.labelGrouping,"atom"),this.fontFamily=nt(t.fontFamily,"sans-serif"),this.fontStyle=nt(t.fontStyle,"normal"),this.fontWeight=nt(t.fontWeight,"bold"),this.xOffset=nt(t.xOffset,0),this.yOffset=nt(t.yOffset,0),this.zOffset=nt(t.zOffset,.5),this.attachment=nt(t.attachment,"bottom-left"),this.showBorder=nt(t.showBorder,!1),this.borderColor=nt(t.borderColor,"lightgrey"),this.borderWidth=nt(t.borderWidth,.15),this.showBackground=nt(t.showBackground,!1),this.backgroundColor=nt(t.backgroundColor,"lightgrey"),this.backgroundMargin=nt(t.backgroundMargin,.5),this.backgroundOpacity=nt(t.backgroundOpacity,1),this.fixedSize=nt(t.fixedSize,!1),super.init(t)}getTextData(e,t){const n=this.getAtomParams(t),i=new Bu(this.labelType,this.labelText,this.labelFormat);let s,o,a,l,d,u,g;if(this.labelGrouping==="atom"){const x=e.getAtomData(n);s=x.position,o=x.radius,a=x.color,t&&!t.text||(l=[],e.eachAtom((y=>l.push(i.atomLabel(y)))))}else if(this.labelGrouping==="residue"){t&&!t.position||(d=[]),t&&!t.color||(g=[]),t&&!t.radius||(u=[]),t&&!t.text||(l=[]),n.colorParams&&(n.colorParams.structure=e.getStructure());const x=Oe.getScheme(n.colorParams),y=new ma(n.radiusParams),b=e.getAtomProxy();let _=0;e.eachResidue((h=>{const f=3*_;h.isProtein()||h.isNucleic()?(b.index=h.traceAtomIndex,t&&!t.position||b.positionToArray(d,f)):(b.index=h.atomOffset,t&&!t.position||h.positionToArray(d,f)),t&&!t.color||x.atomColorToArray(b,g,f),t&&!t.radius||(u[_]=y.atomRadius(b)),t&&!t.text||l.push(i.atomLabel(b)),++_})),t&&!t.position||(s=new Float32Array(d)),t&&!t.color||(a=new Float32Array(g)),t&&!t.radius||(o=new Float32Array(u))}return{position:s,size:o,color:a,text:l}}createData(e){return{bufferList:[new Oh(this.getTextData(e,{position:!0,color:!0,radius:!0,text:!0}),this.getBufferParams({fontFamily:this.fontFamily,fontStyle:this.fontStyle,fontWeight:this.fontWeight,xOffset:this.xOffset,yOffset:this.yOffset,zOffset:this.zOffset,attachment:this.attachment,showBorder:this.showBorder,borderColor:this.borderColor,borderWidth:this.borderWidth,showBackground:this.showBackground,backgroundColor:this.backgroundColor,backgroundMargin:this.backgroundMargin,backgroundOpacity:this.backgroundOpacity,fixedSize:this.fixedSize}))]}}updateData(e,t){t.bufferList[0].setAttributes(this.getTextData(t.sview,e))}getAtomRadius(){return 0}}function Eu(r){const e=r.getAtomSet(),t=r.getBondSet(),n=r.getBondProxy();return t.forEach((function(i){n.index=i,e.clear(n.atomIndex1),e.clear(n.atomIndex2)})),e}Le.add("label",Fu);class $u extends Sh{constructor(e,t,n){super(e,t,n),this.type="line",this.parameters=Object.assign({multipleBond:{type:"select",rebuild:!0,options:{off:"off",symmetric:"symmetric",offset:"offset"}},bondSpacing:{type:"number",precision:2,max:2,min:.5},linewidth:{type:"integer",max:50,min:1,buffer:!0},lines:{type:"boolean",rebuild:!0},crosses:{type:"select",rebuild:!0,options:{off:"off",lone:"lone",all:"all"}},crossSize:{type:"number",precision:2,max:2,min:.1}},this.parameters,{flatShaded:null,side:null,wireframe:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.multipleBond=nt(t.multipleBond,"off"),this.bondSpacing=nt(t.bondSpacing,1),this.linewidth=nt(t.linewidth,2),this.lines=nt(t.lines,!0),this.crosses=nt(t.crosses,"lone"),this.crossSize=nt(t.crossSize,.4),super.init(t)}getAtomRadius(e){return .1}getBondParams(e,t){return t=Object.assign({multipleBond:this.multipleBond,bondSpacing:this.bondSpacing,radiusParams:{type:"size",size:.1,scale:1}},t),super.getBondParams(e,t)}_crossData(e,t){if(e&&!e.position&&!e.color)return;const n={};this.crosses==="lone"&&Object.assign(n,{atomSet:Eu(t)});const i=t.getAtomData(this.getAtomParams(e,n)),s={},o=i.position,a=i.color,l=i.picking,d=(o||a).length,u=3*d;let g=new Float32Array(0),x=new Float32Array(0),y=new Float32Array(0),b=new Float32Array(0),_=0,h=new Float32Array(0);e&&!e.position||(g=s.position1=new Float32Array(u),x=s.position2=new Float32Array(u),_=this.crossSize/2),e&&!e.color||(y=s.color=new Float32Array(u),b=s.color2=new Float32Array(u)),e&&!e.picking||(h=new Float32Array(3*i.picking.array.length));for(let f=0;f<d;f++){const E=3*f,m=3*E;if(!e||e.position){const S=o[E],w=o[E+1],v=o[E+2];g[m]=S-_,g[m+1]=w,g[m+2]=v,x[m]=S+_,x[m+1]=w,x[m+2]=v,g[m+3]=S,g[m+4]=w-_,g[m+5]=v,x[m+3]=S,x[m+4]=w+_,x[m+5]=v,g[m+6]=S,g[m+7]=w,g[m+8]=v-_,x[m+6]=S,x[m+7]=w,x[m+8]=v+_}if(!e||e.color){const S=m+9;for(let w=m;w<S;w+=3)y[w]=b[w]=a[E],y[w+1]=b[w+1]=a[E+1],y[w+2]=b[w+2]=a[E+2]}e&&!e.picking||(h[E]=h[E+1]=h[E+2]=l.array[f])}return e&&!e.picking||(s.picking=new Xs(h,l.structure)),s}createData(e){const t={position:!0,color:!0,picking:!0},n=[];if(this.lines){const i=e.getBondData(this.getBondParams(t)),s=new Nh(i,this.getBufferParams({linewidth:this.linewidth}));n.push(s)}if(this.crosses!=="off"){const i=new Nh(this._crossData(t,e),this.getBufferParams({linewidth:this.linewidth}));n.push(i)}return{bufferList:n}}updateData(e,t){let n=0;if(this.lines){const i=t.sview.getBondData(this.getBondParams(e)),s={};e&&!e.position||Object.assign(s,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(s,{color:i.color,color2:i.color2}),t.bufferList[n++].setAttributes(s)}if(this.crosses!=="off"){const i=this._crossData(e,t.sview),s={};e&&!e.position||Object.assign(s,{position1:i.position1,position2:i.position2}),e&&!e.color||Object.assign(s,{color:i.color,color2:i.color2}),t.bufferList[n++].setAttributes(s)}}setParameters(e){var t={};return e&&(e.bondSpacing||e.crossSize)&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}function Ou(r,e,t,n,i){const s=new(n=n||Int32Array)(r*e*t*(i=i||1));function o(a,l,d){return((a*e+l)*t+d)*i}return{data:s,index:o,set:function(a,l,d,...u){const g=o(a,l,d);for(let x=0;x<i;++x)s[g+x]=u[x]},toArray:function(a,l,d,u=[],g=0){const x=o(a,l,d);for(let y=0;y<i;++y)u[g+y]=s[x+y]},fromArray:function(a,l,d,u,g=0){const x=o(a,l,d);for(let y=0;y<i;++y)s[x+y]=u[g+y]},copy:function(a){s.set(a.data)}}}function Ru(r,e,t){var n=Do(e),i=Gr(r);r.length===0&&(i[0].set([0,0,0]),i[1].set([0,0,0]));var s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S=i[0],w=i[1];function v(U,F,j,H,B){s=F||1.4,o=j||2,h=B||!0;var V=0;for(var K in n)V=Math.max(V,K);var q=Bo(S,w,V,o,U?s:0);l=q.dim[0],d=q.dim[1],u=q.dim[2],g=q.matrix,x=q.tran,o=q.scaleFactor,y={},b={},P(U),_=s*o,a=H||s/o,f=new Uint8Array(l*d*u),U&&(E=new Float64Array(l*d*u)),h&&(m=new Int32Array(l*d*u))}var A=1,M=2,T=4,R=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])];function P(U){var F,j,H,B,V,K,q,Te,Fe,We;for(var J in n)if(F=parseFloat(J),!y[J]){for(K=(q=U?(F+s)*o+.5:F*o+.5)*q,Te=Math.floor(q)+1,Fe=new Int32Array(Te*Te),We=0,j=0;j<Te;++j)for(H=0;H<Te;++H)(B=j*j+H*H)>K?Fe[We]=-1:(V=Math.sqrt(K-B),Fe[We]=Math.floor(V)),++We;b[J]=Te,y[J]=Fe}}function L(U){var F,j,H,B,V,K,q,Te,Fe,We,J,et,ht,er,tr,Hm,oi,h0,l0=3*U,M0=U;F=Math.floor(.5+o*(r[l0]+x[0])),j=Math.floor(.5+o*(r[l0+1]+x[1])),H=Math.floor(.5+o*(r[l0+2]+x[2]));var U0,_0=e[M0],C0=y[_0],P0=0,R0=d*u,si=b[_0];for(We=0;We<si;++We)for(J=0;J<si;++J){if((U0=C0[P0])!==-1){for(Hm=-1;Hm<2;++Hm)for(oi=-1;oi<2;++oi)for(h0=-1;h0<2;++h0)if(Hm!==0&&oi!==0&&h0!==0){for(q=Hm*We,Fe=h0*J,et=0;et<=U0;++et)if(er=j+(Te=et*oi),tr=H+Fe,!((ht=F+q)<0||er<0||tr<0||ht>=l||er>=d||tr>=u)){var Xe=ht*R0+er*u+tr;if(h)if(f[Xe]&A){if(f[Xe]&A){var d0=m[Xe];d0!==l0&&q*q+Te*Te+Fe*Fe<(B=F+q-Math.floor(.5+o*(r[d0]+x[0])))*B+(V=j+Te-Math.floor(.5+o*(r[d0+1]+x[1])))*V+(K=H+Fe-Math.floor(.5+o*(r[d0+2]+x[2])))*K&&(m[Xe]=U)}}else f[Xe]|=A,m[Xe]=U;else f[Xe]|=A}}}P0++}}function O(U){var F,j;for(console.time("EDTSurface fillvoxels"),F=0,j=f.length;F<j;++F)f[F]=0,U&&(E[F]=-1),h&&(m[F]=-1);for(F=0,j=r.length/3;F<j;++F)L(F);for(F=0,j=f.length;F<j;++F)f[F]&A&&(f[F]|=M);console.timeEnd("EDTSurface fillvoxels")}function I(U){var F,j,H,B,V,K,q,Te,Fe,We,J,et,ht,er,tr,Hm,oi,h0,l0,M0=3*U,U0=U,_0=0;F=Math.floor(.5+o*(r[M0]+x[0])),j=Math.floor(.5+o*(r[M0+1]+x[1])),H=Math.floor(.5+o*(r[M0+2]+x[2]));var C0=e[U0],P0=d*u;for(ht=0,l0=b[C0];ht<l0;++ht)for(er=0;er<l0;++er){if(y[C0][_0]!==-1){for(Hm=-1;Hm<2;++Hm)for(oi=-1;oi<2;++oi)for(h0=-1;h0<2;++h0)if(Hm!==0&&oi!==0&&h0!==0){for(q=Hm*ht,Fe=h0*er,tr=0;tr<=y[C0][_0];++tr)if(J=j+(Te=tr*oi),et=H+Fe,!((We=F+q)<0||J<0||et<0||We>=l||J>=d||et>=u)){var R0=We*P0+J*u+et;if(f[R0]&M){if(h){var si=m[R0];q*q+Te*Te+Fe*Fe<(B=Math.floor(.5+o*(r[si]+x[0])))*B+(V=Math.floor(.5+o*(r[si+1]+x[1])))*V+(K=Math.floor(.5+o*(r[si+2]+x[2])))*K&&(m[R0]=U)}}else f[R0]|=M,h&&(m[R0]=U)}}}_0++}}function N(){var U,F,j,H;console.time("EDTSurface fastdistancemap");var B,V=Ou(l,d,u,Uint16Array,3),K=d*u,q=_*_,Te=0;for(U=0;U<l;++U)for(F=0;F<d;++F)for(j=0;j<u;++j)f[B=U*K+F*u+j]&=~M,f[B]&A&&f[B]&T&&(V.set(U,F,j,U,F,j),E[B]=0,f[B]|=M,Te+=1);var Fe=new Int32Array(3*Te),We=0,J=new Int32Array(3*Te),et=0;for(U=0;U<l;++U)for(F=0;F<d;++F)for(j=0;j<u;++j)f[B=U*K+F*u+j]&T&&(Fe[We]=U,Fe[We+1]=F,Fe[We+2]=j,We+=3,f[B]&=~T);do for(et=k(Fe,V,We,J),We=0,U=0,H=et;U<H;U+=3)B=K*J[U]+u*J[U+1]+J[U+2],f[B]&=~T,E[B]<=1.0404*q&&(Fe[We]=J[U],Fe[We+1]=J[U+1],Fe[We+2]=J[U+2],We+=3);while(We>0);var ht,er=a*a,tr=new Uint16Array(3);for(U=0;U<l;++U)for(F=0;F<d;++F)for(j=0;j<u;++j)f[B=U*K+F*u+j]&=~T,f[B]&A&&(f[B]&M&&!(f[B]&M&&E[B]>=er)||(f[B]|=T,h&&f[B]&M&&(V.toArray(U,F,j,tr),ht=tr[0]*K+tr[1]*u+tr[2],m[B]=m[ht])));console.timeEnd("EDTSurface fastdistancemap")}function k(U,F,j,H){var B,V,K,q,Te,Fe,We,J,et,ht,er,tr,Hm=new Uint16Array(3),oi=0;if(j===0)return oi;var h0=-1,l0=-1,M0=-1,U0=d*u;for(We=0,et=j;We<et;We+=3)for(B=U[We],V=U[We+1],K=U[We+2],F.toArray(B,V,K,Hm),J=0;J<6;++J)h0=B+(tr=R[J])[0],l0=V+tr[1],M0=K+tr[2],h0<l&&h0>-1&&l0<d&&l0>-1&&M0<u&&M0>-1&&(f[er=h0*U0+u*l0+M0]&A&&!(f[er]&M)?(F.fromArray(h0,l0,M0,Hm),ht=(q=h0-Hm[0])*q+(Te=l0-Hm[1])*Te+(Fe=M0-Hm[2])*Fe,E[er]=ht,f[er]|=M,f[er]|=T,H[oi]=h0,H[oi+1]=l0,H[oi+2]=M0,oi+=3):f[er]&A&&f[er]&M&&(ht=(q=h0-Hm[0])*q+(Te=l0-Hm[1])*Te+(Fe=M0-Hm[2])*Fe)<E[er]&&(F.fromArray(h0,l0,M0,Hm),E[er]=ht,f[er]&T||(f[er]|=T,H[oi]=h0,H[oi+1]=l0,H[oi+2]=M0,oi+=3)));for(We=0,et=j;We<et;We+=3)for(B=U[We],V=U[We+1],K=U[We+2],F.toArray(B,V,K,Hm),J=6;J<18;J++)h0=B+(tr=R[J])[0],l0=V+tr[1],M0=K+tr[2],h0<l&&h0>-1&&l0<d&&l0>-1&&M0<u&&M0>-1&&(f[er=h0*U0+u*l0+M0]&A&&!(f[er]&M)?(F.fromArray(h0,l0,M0,Hm),ht=(q=h0-Hm[0])*q+(Te=l0-Hm[1])*Te+(Fe=M0-Hm[2])*Fe,E[er]=ht,f[er]|=M,f[er]|=T,H[oi]=h0,H[oi+1]=l0,H[oi+2]=M0,oi+=3):f[er]&A&&f[er]&M&&(ht=(q=h0-Hm[0])*q+(Te=l0-Hm[1])*Te+(Fe=M0-Hm[2])*Fe)<E[er]&&(F.fromArray(h0,l0,M0,Hm),E[er]=ht,f[er]&T||(f[er]|=T,H[oi]=h0,H[oi+1]=l0,H[oi+2]=M0,oi+=3)));for(We=0,et=j;We<et;We+=3)for(B=U[We],V=U[We+1],K=U[We+2],F.toArray(B,V,K,Hm),J=18;J<26;J++)h0=B+(tr=R[J])[0],l0=V+tr[1],M0=K+tr[2],h0<l&&h0>-1&&l0<d&&l0>-1&&M0<u&&M0>-1&&(f[er=h0*U0+u*l0+M0]&A&&!(f[er]&M)?(F.fromArray(h0,l0,M0,Hm),ht=(q=h0-Hm[0])*q+(Te=l0-Hm[1])*Te+(Fe=M0-Hm[2])*Fe,E[er]=ht,f[er]|=M,f[er]|=T,H[oi]=h0,H[oi+1]=l0,H[oi+2]=M0,oi+=3):f[er]&A&&f[er]&M&&(ht=(q=h0-Hm[0])*q+(Te=l0-Hm[1])*Te+(Fe=M0-Hm[2])*Fe)<E[er]&&(F.fromArray(h0,l0,M0,Hm),E[er]=ht,f[er]&T||(f[er]|=T,H[oi]=h0,H[oi+1]=l0,H[oi+2]=M0,oi+=3)));return oi}this.getVolume=function(U,F,j,H,B){console.time("EDTSurface.getVolume");var V=U!=="vws";v(V,F,j,H,B),O(V),(function(){var Te,Fe,We,J=d*u;for(Te=0;Te<l;++Te)for(Fe=0;Fe<u;++Fe)for(We=0;We<d;++We){var et=Te*J+We*u+Fe;if(f[et]&A)for(var ht=0;ht<26;){var er=Te+R[ht][0],tr=Fe+R[ht][2],Hm=We+R[ht][1];if(er>-1&&er<l&&Hm>-1&&Hm<d&&tr>-1&&tr<u&&!(f[er*J+Hm*u+tr]&A)){f[et]|=T;break}ht++}}})(),U!=="ms"&&U!=="ses"||N(),U==="ses"&&(P(!1),(function(){var Te,Fe;for(Te=0,Fe=f.length;Te<Fe;++Te)f[Te]&=~M;for(Te=0,Fe=r.length/3;Te<Fe;++Te)I(Te)})()),(function(Te){var Fe,We=f.length;if(Te==="vws")for(Fe=0;Fe<We;++Fe)f[Fe]&=~T,f[Fe]=f[Fe]&M?1:0;else if(Te==="ms")for(Fe=0;Fe<We;++Fe)f[Fe]&=~M,f[Fe]&T&&(f[Fe]|=M),f[Fe]&=~T,f[Fe]=f[Fe]&M?1:0;else if(Te==="ses")for(Fe=0;Fe<We;++Fe)f[Fe]&T&&f[Fe]&M?f[Fe]&=~T:f[Fe]&T&&!(f[Fe]&M)&&(f[Fe]|=M),f[Fe]=f[Fe]&M?1:0;else if(Te==="sas")for(Fe=0;Fe<We;++Fe)f[Fe]&=~T,f[Fe]=f[Fe]&M?1:0})(U);for(var K=0,q=m.length;K<q;++K)m[K]=t[m[K]];return console.timeEnd("EDTSurface.getVolume"),{data:f,nx:u,ny:d,nz:l,atomindex:m}},this.getSurface=function(U,F,j,H,B,V,K){var q=this.getVolume(U,F,j,H,B);return new Eo(q.data,q.nx,q.ny,q.nz,q.atomindex).getSurface(1,V,void 0,g,K)}}function Lu(r,e,t,n,i,s,o){o=Math.max(.1,o);var a=r.length,l=i[0],d=i[1],u=i[2],g=s[0],x=s[1],y=s[2];function b(j,H){return Math.floor((j-H)/o)}for(var _,h,f,E=b(g,l)+1,m=b(x,d)+1,S=b(y,u)+1,w=E*m*S,v=m*S,A=[],M=0;M<a;M++){var T=(_=r[M],h=e[M],f=t[M],(b(_,l)*m+b(h,d))*S+b(f,u));A[T]===void 0?A[T]=[M]:A[T].push(M)}var R=new Uint32Array(w),P=new Uint16Array(w),L=new Uint32Array(a),O=0,I=0;for(M=0;M<w;M++){var N=R[M]=O,k=A[M];if(k!==void 0)for(var U=0;U<k.length;U++)L[O]=k[U],O++;var F=O-N;P[M]=F,F>I&&(I=F)}return{neighbourListLength:27*I+1,withinRadii:function(j,H,B,V,K){for(var q=0,Te=b(j,l),Fe=b(H,d),We=b(B,u),J=Math.max(0,Te-1),et=Math.max(0,Fe-1),ht=Math.max(0,We-1),er=Math.min(E,Te+2),tr=Math.min(m,Fe+2),Hm=Math.min(S,We+2),oi=J;oi<er;++oi)for(var h0=oi*v,l0=et;l0<tr;++l0)for(var M0=l0*S,U0=ht;U0<Hm;++U0)for(var _0=h0+M0+U0,C0=R[_0],P0=C0+P[_0],R0=C0;R0<P0;R0++){var si=L[R0],Xe=r[si]-j,d0=e[si]-H,w0=t[si]-B,Q=n[si]+V;Xe*Xe+d0*d0+w0*w0<=Q*Q&&(K[q++]=L[R0])}K[q]=-1}}}function Nu(r,e,t){const n=e.length,i=new Float32Array(n),s=new Float32Array(n),o=new Float32Array(n);for(let Te=0;Te<n;Te++){const Fe=3*Te;i[Te]=r[Fe],s[Te]=r[Fe+1],o[Te]=r[Fe+2]}let a=Gr(r);r.length===0&&(a[0].set([0,0,0]),a[1].set([0,0,0]));const l=a[0],d=a[1];let u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R,P,L=-1;const O=new Float32Array([0,0,0]),I=new Float32Array([0,0,0]),N=new Float32Array([0,0,0]),k=new Float32Array([0,0,0]);let U;function F(Te,Fe,We,J){y=nt(Te,1.4),b=nt(Fe,2),_=nt(We,!0),h=nt(J,30),u=new Float32Array(n),g=new Float32Array(n);for(let ht=0;ht<u.length;++ht){var et=e[ht]+y;u[ht]=et,g[ht]=et*et}x=0;for(let ht=0;ht<u.length;++ht)u[ht]>x&&(x=u[ht]);(function(){const ht=Bo(l,d,x,b,0);b=ht.scaleFactor,f=ht.dim,E=ht.matrix,U=Math.max(5,2+Math.floor(y*b)),m=Ai(f[0]*f[1]*f[2],-1001),S=new Int32Array(m.length),w=new Float32Array(f[0]),v=new Float32Array(f[1]),A=new Float32Array(f[2]),j(w,l[0],1/b),j(v,l[1],1/b),j(A,l[2],1/b)})(),(function(){var ht=0,er=2*Math.PI/h;T=new Float32Array(h),M=new Float32Array(h);for(var tr=0;tr<h;tr++)T[tr]=Math.cos(ht),M[tr]=Math.sin(ht),ht+=er})(),R=Lu(i,s,o,u,l,d,2.01*x),P=new Int32Array(R.neighbourListLength),L=-1}function j(Te,Fe,We){for(let J=0;J<Te.length;J++)Te[J]=Fe+We*J}function H(Te,Fe,We,J,et){let ht;if(L!==-1){if(ht=L,ht!==J&&ht!==et&&B(ht,Te,Fe,We))return ht;L=-1}var er=0;for(ht=P[er];ht>=0;){if(ht!==J&&ht!==et&&B(ht,Te,Fe,We))return L=ht,ht;ht=P[++er]}return L=-1,-1}function B(Te,Fe,We,J){var et=3*Te,ht=g[Te],er=r[et]-Fe,tr=r[et+1]-We,Hm=r[et+2]-J;return er*er+tr*tr+Hm*Hm<ht}function V(){for(var Te=0;Te<n;Te++){var Fe=i[Te],We=s[Te],J=o[Te],et=u[Te],ht=g[Te];R.withinRadii(Fe,We,J,et,P);for(var er=Math.ceil(et*b),tr=Math.floor(b*(Fe-l[0])),Hm=Math.floor(b*(We-l[1])),oi=Math.floor(b*(J-l[2])),h0=Math.max(0,tr-er),l0=Math.max(0,Hm-er),M0=Math.max(0,oi-er),U0=Math.min(f[0],tr+er+2),_0=Math.min(f[1],Hm+er+2),C0=Math.min(f[2],oi+er+2),P0=h0;P0<U0;P0++)for(var R0=w[P0]-Fe,si=f[1]*f[2]*P0,Xe=l0;Xe<_0;Xe++)for(var d0=v[Xe]-We,w0=R0*R0+d0*d0,Q=si+f[2]*Xe,it=M0;it<C0;it++){var ec=A[it]-J,a0=w0+ec*ec;if(a0<ht){var u0=it+Q;m[u0]<0&&(m[u0]=-m[u0]);var E0=Math.sqrt(a0),O0=et/E0,He=R0*O0,p0=d0*O0,x0=ec*O0;if(H(He+=Fe,p0+=We,x0+=J,Te,-1)===-1){var L0=et-E0;L0<m[u0]&&(m[u0]=L0,_&&(S[u0]=Te))}}}}}function K(Te,Fe){var We=u[Te],J=u[Fe],et=O[0]=i[Fe]-i[Te],ht=O[1]=s[Fe]-s[Te],er=O[2]=o[Fe]-o[Te],tr=et*et+ht*ht+er*er,Hm=Math.sqrt(tr),oi=We*((We*We+Hm*Hm-J*J)/(2*We*Hm));on(O,O),(function(ut,hi){ut[0]=ut[1]=ut[2]=1,hi[0]!==0?ut[0]=(hi[1]+hi[2])/-hi[0]:hi[1]!==0?ut[1]=(hi[0]+hi[2])/-hi[1]:hi[2]!==0&&(ut[2]=(hi[0]+hi[1])/-hi[2])})(N,O),on(N,N),Yr(k,O,N),on(k,k);var h0=Math.sqrt(We*We-oi*oi);sn(N,N,h0),sn(k,k,h0),sn(O,O,oi),I[0]=O[0]+i[Te],I[1]=O[1]+s[Te],I[2]=O[2]+o[Te],L=-1;for(var l0=U,M0=0;M0<h;M0++){var U0=T[M0],_0=M[M0],C0=I[0]+U0*N[0]+_0*k[0],P0=I[1]+U0*N[1]+_0*k[1],R0=I[2]+U0*N[2]+_0*k[2];if(H(C0,P0,R0,Te,Fe)===-1)for(var si=Math.floor(b*(C0-l[0])),Xe=Math.floor(b*(P0-l[1])),d0=Math.floor(b*(R0-l[2])),w0=Math.max(0,si-l0),Q=Math.max(0,Xe-l0),it=Math.max(0,d0-l0),ec=Math.min(f[0],si+l0+2),a0=Math.min(f[1],Xe+l0+2),u0=Math.min(f[2],d0+l0+2),E0=w0;E0<ec;E0++){et=C0-w[E0];for(var O0=f[1]*f[2]*E0,He=Q;He<a0;He++)for(var p0=et*et+(ht=P0-v[He])*ht,x0=O0+f[2]*He,L0=it;L0<u0;L0++){tr=p0+(er=R0-A[L0])*er;var c0=L0+x0,b0=m[c0];if(b0>0&&tr<b0*b0&&(m[c0]=Math.sqrt(tr),_)){const ut=et*O[0]+ht*O[1]+er*O[2];S[c0]=ut<0?Fe:Te}}}}}function q(Te,Fe,We){console.time("AVSurface.getVolume"),console.time("AVSurface.init"),F(Te,Fe,We),console.timeEnd("AVSurface.init"),console.time("AVSurface.projectPoints"),V(),console.timeEnd("AVSurface.projectPoints"),console.time("AVSurface.projectTorii"),(function(){for(var J=0;J<n;J++){R.withinRadii(i[J],s[J],o[J],u[J],P);for(var et=0,ht=P[et];ht>=0;)J<ht&&K(J,ht),ht=P[++et]}})(),console.timeEnd("AVSurface.projectTorii"),(function(){for(var J=0;J<m.length;J++)m[J]<0&&(m[J]=0)})(),(function(){for(var J=0;J<S.length;J++)S[J]=t[S[J]]})(),console.timeEnd("AVSurface.getVolume")}this.getSurface=function(Te,Fe,We,J,et,ht,er){return q(Fe,We,et),new Eo(m,f[2],f[1],f[0],S).getSurface(Fe,!1,void 0,E,er)}}Le.add("line",$u),Object.assign(Ru,{__deps:[Bo,Do,Eo,Gr,Ou]}),Object.assign(Nu,{__deps:[Bo,Eo,Ai,Gr,sn,Yr,on,Lu,nt]}),$e.add("molsurf",(function(r,e){const t=r.data.args,n=r.data.params;if(t&&n){const i=new(n.type==="av"?Nu:Ru)(t.coordList,t.radiusList,t.indexList).getSurface(n.type,n.probeRadius,n.scaleFactor,n.cutoff,!0,n.smooth,n.contour),s=[i.position.buffer,i.index.buffer];i.normal&&s.push(i.normal.buffer),i.atomindex&&s.push(i.atomindex.buffer),e({sd:i,p:n},s)}}),[Ru,Nu]);class zu{constructor(e){this.structure=e}_getAtomData(e){return this.structure.getAtomData({what:{position:!0,radius:!0,index:!0},radiusParams:nt(e.radiusParams,{type:"vdw",scale:1})})}_makeSurface(e,t){var n=new Fo(t.name,"",e);return n.info.type=t.type,n.info.probeRadius=t.probeRadius,n.info.scaleFactor=t.scaleFactor,n.info.smooth=t.smooth,n.info.cutoff=t.cutoff,n}getSurface(e){const t=e||{},n=this._getAtomData(e),i=n.position,s=n.radius,o=n.index,a=new(t.type==="av"?Nu:Ru)(i,s,o).getSurface(t.type,t.probeRadius,t.scaleFactor,t.cutoff,!0,t.smooth,t.contour);return this._makeSurface(a,t)}getSurfaceWorker(e,t){const n=Object.assign({},e);if(window.hasOwnProperty("Worker")){this.worker===void 0&&(this.worker=new zr("molsurf"));const i=this._getAtomData(e),s=i.position,o=i.radius,a=i.index,l={args:{coordList:s,radiusList:o,indexList:a},params:n},d=[s.buffer,o.buffer,a.buffer];this.worker.post(l,d,(u=>{t(this._makeSurface(u.data.sd,n))}),(u=>{console.warn("MolecularSurface.getSurfaceWorker error - trying without worker",u),this.worker.terminate(),this.worker=void 0;const g=this.getSurface(n);t(g)}))}else{const i=this.getSurface(n);t(i)}}dispose(){this.worker&&this.worker.terminate()}}class Uu extends Sh{constructor(e,t,n){super(e,t,n),this.type="surface",this.parameters=Object.assign({surfaceType:{type:"select",rebuild:!0,options:{vws:"vws",sas:"sas",ms:"ms",ses:"ses",av:"av"}},probeRadius:{type:"number",precision:1,max:20,min:0,rebuild:!0},smooth:{type:"integer",precision:1,max:10,min:0,rebuild:!0},scaleFactor:{type:"number",precision:1,max:5,min:0,rebuild:!0},cutoff:{type:"number",precision:2,max:50,min:0,rebuild:!0},contour:{type:"boolean",rebuild:!0},background:{type:"boolean",rebuild:!0},opaqueBack:{type:"boolean",buffer:!0},filterSele:{type:"text",rebuild:!0},colorVolume:{type:"hidden"},useWorker:{type:"boolean",rebuild:!0}},this.parameters,{radius:null,scale:null}),this.__infoList=[],this.structure.signals.refreshed.add((()=>{this.__forceNewMolsurf=!0})),this.toBePrepared=!0,this.init(n)}init(e){const t=e||{};t.colorScheme=nt(t.colorScheme,"uniform"),t.colorValue=nt(t.colorValue,14540253),t.disablePicking=nt(t.disablePicking,!0),this.surfaceType=nt(t.surfaceType,"ms"),this.probeRadius=nt(t.probeRadius,1.4),this.smooth=nt(t.smooth,2),this.scaleFactor=nt(t.scaleFactor,2),this.cutoff=nt(t.cutoff,0),this.contour=nt(t.contour,!1),this.background=nt(t.background,!1),this.opaqueBack=nt(t.opaqueBack,!0),this.filterSele=nt(t.filterSele,""),this.colorVolume=nt(t.colorVolume,void 0),this.useWorker=nt(t.useWorker,!0),super.init(e)}prepareData(e,t,n){let i=this.__infoList[t];if(i||(i={},this.__infoList[t]=i),i.molsurf&&i.sele===e.selection.string)n(t);else{if(this.filterSele){const a=e.structure.getView(new me(this.filterSele)),l=a.boundingBox.getSize(new Vector3),d=Math.max(l.x,l.y,l.z),u=e.getAtomSetWithinPoint(a.center,d/2+6);if((e=e.getView(new me(e.getAtomSetWithinSelection(u,3).toSeleString()))).atomCount===0)return void n(t)}i.sele=e.selection.string,i.molsurf=new zu(e);const s=this.getSurfaceParams(),o=a=>{i.surface=a,n(t)};this.useWorker?i.molsurf.getSurfaceWorker(s,o):o(i.molsurf.getSurface(s))}}prepare(e){if((this.__forceNewMolsurf||this.__sele!==this.selection.string||this.__surfaceParams!==JSON.stringify(this.getSurfaceParams()))&&(this.__infoList.forEach((s=>{s&&s.molsurf&&s.molsurf.dispose()})),this.__infoList.length=0),this.structureView.atomCount===0)return void e();const t=()=>{this.__sele=this.selection.string,this.__surfaceParams=JSON.stringify(this.getSurfaceParams()),this.__forceNewMolsurf=!1,e()},n=this.assembly==="default"?this.defaultAssembly:this.assembly,i=this.structure.biomolDict[n];i?i.partList.forEach(((s,o)=>{const a=s.getView(this.structureView);this.prepareData(a,o,(l=>{l===i.partList.length-1&&t()}))})):this.prepareData(this.structureView,0,t)}createData(e,t){const n=this.__infoList[t],i=n.surface;if(!i)return;const s={position:i.getPosition(),color:i.getColor(this.getColorParams()),index:i.getFilteredIndex(this.filterSele,e)},o=[];if(i.contour){const a=new Wo(s,this.getBufferParams({wireframe:!1}));o.push(a)}else{Object.assign(s,{normal:i.getNormal(),picking:i.getPicking(e.getStructure())});const a=new jo(s,this.getBufferParams({background:this.background,opaqueBack:this.opaqueBack,dullInterior:!1}));if(this.getBufferParams().side=="double"){const l=new qo(a);o.push(l)}else o.push(a)}return{bufferList:o,info:n}}updateData(e,t){const n={};if(e.position||e.radius)return this.__forceNewMolsurf=!0,void this.build();e.color&&(n.color=t.info.surface.getColor(this.getColorParams())),e.index&&(n.index=t.info.surface.getFilteredIndex(this.filterSele,t.sview)),t.bufferList[0].setAttributes(n)}setParameters(e,t={},n){return e&&e.filterSele&&(t.index=!0),e&&e.colorVolume!==void 0&&(t.color=!0),e&&e.wireframe&&(e.contour||e.contour===void 0&&this.contour)&&(e.wireframe=!1),super.setParameters(e,t,n),this}getSurfaceParams(e={}){return Object.assign({type:this.surfaceType,probeRadius:this.probeRadius,scaleFactor:this.scaleFactor,smooth:this.smooth&&!this.contour,cutoff:this.cutoff,contour:this.contour,useWorker:this.useWorker,radiusParams:this.getRadiusParams()},e)}getColorParams(){const e=super.getColorParams();return e.volume=this.colorVolume,e}getAtomRadius(){return 0}clear(){super.clear()}dispose(){this.__infoList.forEach((e=>{e&&e.molsurf&&e.molsurf.dispose()})),this.__infoList.length=0,super.dispose()}}Le.add("surface",Uu);class Vu extends Sh{constructor(e,t,n){super(e,t,n),this.type="point",this.parameters=Object.assign({pointSize:{type:"number",precision:1,max:100,min:0,buffer:!0},sizeAttenuation:{type:"boolean",buffer:!0},sortParticles:{type:"boolean",rebuild:!0},useTexture:{type:"boolean",buffer:!0},alphaTest:{type:"range",step:.001,max:1,min:0,buffer:!0},forceTransparent:{type:"boolean",buffer:!0},edgeBleach:{type:"range",step:.001,max:1,min:0,buffer:!0}},this.parameters,{flatShaded:null,wireframe:null,linewidth:null,side:null,roughness:null,metalness:null}),this.init(n)}init(e){var t=e||{};this.pointSize=nt(t.pointSize,1),this.sizeAttenuation=nt(t.sizeAttenuation,!0),this.sortParticles=nt(t.sortParticles,!1),this.useTexture=nt(t.useTexture,!1),this.alphaTest=nt(t.alphaTest,.5),this.forceTransparent=nt(t.forceTransparent,!1),this.edgeBleach=nt(t.edgeBleach,0),super.init(t)}createData(e){var t=e.getAtomData(this.getAtomParams({position:!0,color:!0,picking:!0}));return{bufferList:[new Hc(t,this.getBufferParams({pointSize:this.pointSize,sizeAttenuation:this.sizeAttenuation,sortParticles:this.sortParticles,useTexture:this.useTexture,alphaTest:this.alphaTest,forceTransparent:this.forceTransparent,edgeBleach:this.edgeBleach}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:n.position}),e&&!e.color||Object.assign(i,{color:n.color}),t.bufferList[0].setAttributes(i)}getAtomRadius(){return .1}}Le.add("point",Vu),ze.add("shader/Ribbon.vert",`#define STANDARD
uniform float clipNear;
uniform vec3 clipCenter;
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
varying vec3 vViewPosition;
#endif
#if defined( RADIUS_CLIP )
varying vec3 vClipCenter;
#endif
attribute vec3 dir;
attribute float size;
#ifdef PICKING
#include unpack_color
attribute float primitiveId;
varying vec3 vPickingColor;
#else
#include color_pars_vertex
#ifndef FLAT_SHADED
varying vec3 vNormal;
#endif
#endif
#include common
void main(void){
#ifdef PICKING
vPickingColor = unpackColor( primitiveId );
#else
#include color_vertex
#include beginnormal_vertex
#include defaultnormal_vertex
#ifndef FLAT_SHADED
vNormal = normalize( transformedNormal );
#endif
#endif
#include begin_vertex
transformed += normalize( dir ) * size;
#include project_vertex
#if defined( NEAR_CLIP ) || defined( RADIUS_CLIP ) || !defined( PICKING )
vViewPosition = -mvPosition.xyz;
#endif
#if defined( RADIUS_CLIP )
vClipCenter = -( modelViewMatrix * vec4( clipCenter, 1.0 ) ).xyz;
#endif
#include nearclip_vertex
}`);const ju=new Uint16Array([0,1,2,1,3,2]);function Gu(r){return 3*(4*(r.position.length/3-1))}class Hu extends Vo{constructor(e,t={}){super({position:new Float32Array(Gu(e)),color:new Float32Array(Gu(e)),index:bt(Gu(e),Gu(e)/3),normal:new Float32Array(Gu(e)),picking:e.picking},t),this.vertexShader="Ribbon.vert";const n=e.position.length/3-1,i=4*n,s=3*i;this.addAttributes({dir:{type:"v3",value:new Float32Array(s)}}),this.addAttributes({size:{type:"f",value:new Float32Array(i)}}),e.primitiveId=Ci(n),this.setAttributes(e),this.makeIndex()}setAttributes(e={}){const t=this.size/4,n=this.geometry.attributes;let i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v;e.position&&(i=e.position,u=n.position.array,n.position.needsUpdate=!0),e.normal&&(s=e.normal,g=n.normal.array,n.normal.needsUpdate=!0),e.size&&(o=e.size,x=n.size.array,n.size.needsUpdate=!0),e.dir&&(a=e.dir,y=n.dir.array,n.dir.needsUpdate=!0),e.color&&(l=e.color,b=n.color.array,n.color.needsUpdate=!0),e.primitiveId&&(d=e.primitiveId,_=n.primitiveId.array,n.primitiveId.needsUpdate=!0);let A=o?o[0]:null;for(h=0;h<t;++h){for(w=3*h,E=3*h*4,S=4*h,i&&(u[E]=u[E+3]=i[w],u[E+1]=u[E+4]=i[w+1],u[E+2]=u[E+5]=i[w+2],u[E+6]=u[E+9]=i[w+3],u[E+7]=u[E+10]=i[w+4],u[E+8]=u[E+11]=i[w+5]),s&&(g[E]=g[E+3]=-s[w],g[E+1]=g[E+4]=-s[w+1],g[E+2]=g[E+5]=-s[w+2],g[E+6]=g[E+9]=-s[w+3],g[E+7]=g[E+10]=-s[w+4],g[E+8]=g[E+11]=-s[w+5]),f=0;f<4;++f)m=E+3*f,l&&(b[m]=l[w],b[m+1]=l[w+1],b[m+2]=l[w+2]),d&&(_[S+f]=d[h]);o&&(v=o[h],A!==o[h]?(x[S]=A,x[S+1]=A,x[S+2]=v,x[S+3]=v):(x[S]=v,x[S+1]=v,x[S+2]=v,x[S+3]=v),A=v),a&&(y[E]=a[w],y[E+1]=a[w+1],y[E+2]=a[w+2],y[E+3]=-a[w],y[E+4]=-a[w+1],y[E+5]=-a[w+2],y[E+6]=a[w+3],y[E+7]=a[w+4],y[E+8]=a[w+5],y[E+9]=-a[w+3],y[E+10]=-a[w+4],y[E+11]=-a[w+5])}}makeIndex(){const e=this.geometry.getIndex();if(!e)return void ke.error("Index is null");const t=e.array,n=t.length/4/3;for(let i=0;i<n;++i){const s=6*i,o=4*i;t.set(ju,s);for(let a=0;a<6;++a)t[s+a]+=o}}}class qu extends Sh{constructor(e,t,n){super(e,t,n),this.type="ribbon",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{side:null,wireframe:null,linewidth:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=nt(t.colorScheme,"chainname"),t.colorScale=nt(t.colorScale,"RdYlBu"),t.radiusType=nt(t.radiusType,"sstruc"),t.radiusScale=nt(t.radiusScale,4),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=nt(t.subdiv,6),this.tension=nt(t.tension,NaN),this.smoothSheet=nt(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!0,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?super.getAtomRadius(e):0}createData(e){var t=[],n=[];return this.structure.eachPolymer((i=>{if(!(i.residueCount<4)){n.push(i);var s=new ou(i,this.getSplineParams()),o=s.getSubdividedPosition(),a=s.getSubdividedOrientation(),l=s.getSubdividedColor(this.getColorParams()),d=s.getSubdividedPicking(),u=s.getSubdividedSize(this.getRadiusParams());t.push(new Hu({position:o.position,normal:a.binormal,dir:a.normal,color:l.color,size:u.size,picking:d.picking},this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,i=t.polymerList.length;for(n=0;n<i;++n){var s={},o=new ou(t.polymerList[n],this.getSplineParams());if(e.position){var a=o.getSubdividedPosition(),l=o.getSubdividedOrientation();Object.assign(s,{position:a.position,normal:l.binormal,dir:l.normal})}if(e.radius||e.scale){var d=o.getSubdividedSize(this.getRadiusParams());Object.assign(s,{size:d.size})}if(e.color){var u=o.getSubdividedColor(this.getColorParams());Object.assign(s,{color:u.color})}t.bufferList[n].setAttributes(s)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}Le.add("ribbon",qu);class Wu extends Sh{constructor(e,t,n){super(e,t,n),this.type="rocket",this.parameters=Object.assign({localAngle:{type:"integer",max:180,min:0,rebuild:!0},centerDist:{type:"number",precision:1,max:10,min:0,rebuild:!0},ssBorder:{type:"boolean",rebuild:!0},radialSegments:!0,openEnded:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){let t=e||{};t.colorScheme=nt(t.colorScheme,"sstruc"),t.radiusSize=nt(t.radiusSize,1.5),t.radiusScale=nt(t.radiusScale,1),t.openEnded=nt(t.openEnded,!1),t.useInteriorColor=nt(t.useInteriorColor,!0),this.localAngle=nt(t.localAngle,30),this.centerDist=nt(t.centerDist,2.5),this.ssBorder=nt(t.ssBorder,!1),super.init(t)}createData(e){let t=0;const n=[],i=[];this.structure.eachPolymer((l=>{if(l.residueCount<4||l.isNucleic())return;const d=new Ca(l),u=d.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());t+=u.size.length,n.push(u),i.push(d)}),e.getSelection());const s={begin:new Float32Array(3*t),end:new Float32Array(3*t),size:new Float32Array(t),color:new Float32Array(3*t),picking:{}};let o=new Float32Array(t),a=0;return n.forEach((function(l){s.begin.set(l.begin,3*a),s.end.set(l.end,3*a),s.size.set(l.size,a),s.color.set(l.color,3*a),o.set(l.picking.array,a),a+=l.size.length})),t&&(s.picking=new Xs(o,e.getStructure())),{bufferList:[new tu({position1:s.begin,position2:s.end,color:s.color,color2:s.color,radius:s.size,picking:s.picking},this.getBufferParams({openEnded:this.openEnded,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0}))],axisList:n,helixbundleList:i,axisData:s}}updateData(e,t){if((e=e||{}).position)this.build();else{var n={};if(e.color||e.radius){var i=0;t.helixbundleList.forEach((s=>{var o=s.getAxis(this.localAngle,this.centerDist,this.ssBorder,this.getColorParams(),this.getRadiusParams());e.color&&t.axisData.color.set(o.color,3*i),(e.radius||e.scale)&&t.axisData.size.set(o.size,i),i+=o.size.length})),e.color&&Object.assign(n,{color:t.axisData.color,color2:t.axisData.color}),(e.radius||e.scale)&&Object.assign(n,{radius:t.axisData.size})}t.bufferList[0].setAttributes(n)}}}Le.add("rocket",Wu);class Xu extends uu{constructor(e,t,n){super(e,t,n),this.type="rope",this.parameters=Object.assign({smooth:{type:"integer",max:15,min:0,rebuild:!0}},this.parameters,{aspectRatio:null,smoothSheet:null})}init(e){var t=e||{};t.aspectRatio=1,t.tension=nt(t.tension,.5),t.radiusScale=nt(t.radiusScale,5),t.smoothSheet=!1,this.smooth=nt(t.smooth,2),super.init(t)}getSpline(e){var t=new Sa(e);return new ou(e,this.getSplineParams({directional:!1,positionIterator:t.getCenterIterator(this.smooth)}))}}Le.add("rope",Xu);class Yu extends Sh{constructor(e,t,n){super(e,t,n),this.type="spacefill",this.parameters=Object.assign({sphereDetail:!0,disableImpostor:!0},this.parameters),this.init(n)}init(e){var t=e||{};t.useInteriorColor=nt(t.useInteriorColor,!0),super.init(t)}createData(e){return{bufferList:[new Uc(e.getAtomData(this.getAtomParams()),this.getBufferParams({sphereDetail:this.sphereDetail,dullInterior:!0,disableImpostor:this.disableImpostor}))]}}updateData(e,t){var n=t.sview.getAtomData(this.getAtomParams(e)),i={};e&&!e.position||Object.assign(i,{position:n.position}),e&&!e.color||Object.assign(i,{color:n.color}),e&&!e.radius||Object.assign(i,{radius:n.radius}),t.bufferList[0].setAttributes(i)}}function Ku(r){return 3*(r.position.length/3-1)*2}Le.add("spacefill",Yu);class Zu extends Uo{constructor(e,t={}){super({position:new Float32Array(Ku(e)),color:new Float32Array(Ku(e))},t),this.isLine=!0,this.vertexShader="Line.vert",this.fragmentShader="Line.frag",this.setAttributes(e)}setAttributes(e){let t,n,i,s;const o=this.geometry.attributes;if(e.position&&(t=e.position,i=o.position.array,o.position.needsUpdate=!0),e.color&&(n=e.color,s=o.color.array,o.color.needsUpdate=!0),!t&&!n)return void ke.warn("TraceBuffer.prototype.setAttributes no data");let a,l;const d=this.size-1;for(let u=0;u<d;++u)a=3*u,l=3*u*2,t&&(i[l]=t[a],i[l+1]=t[a+1],i[l+2]=t[a+2],i[l+3]=t[a+3],i[l+4]=t[a+4],i[l+5]=t[a+5]),n&&(s[l]=n[a],s[l+1]=n[a+1],s[l+2]=n[a+2],s[l+3]=n[a+3],s[l+4]=n[a+4],s[l+5]=n[a+5])}}class Qu extends Sh{constructor(e,t,n){super(e,t,n),this.type="trace",this.parameters=Object.assign({subdiv:{type:"integer",max:50,min:1,rebuild:!0},tension:{type:"number",precision:1,max:1,min:.1},smoothSheet:{type:"boolean",rebuild:!0}},this.parameters,{flatShaded:null,side:null,wireframe:null}),this.init(n)}init(e){var t=e||{};t.colorScheme=nt(t.colorScheme,"chainname"),t.colorScale=nt(t.colorScale,"RdYlBu"),t.quality==="low"?this.subdiv=3:t.quality==="medium"?this.subdiv=6:t.quality==="high"?this.subdiv=12:this.subdiv=nt(t.subdiv,6),this.tension=nt(t.tension,NaN),this.smoothSheet=nt(t.smoothSheet,!1),super.init(t)}getSplineParams(e){return Object.assign({subdiv:this.subdiv,tension:this.tension,directional:!1,smoothSheet:this.smoothSheet},e)}getAtomRadius(e){return e.isTrace()?.1:0}createData(e){var t=[],n=[];return this.structure.eachPolymer((i=>{if(!(i.residueCount<4)){n.push(i);var s=new ou(i,this.getSplineParams()),o=s.getSubdividedPosition(),a=s.getSubdividedColor(this.getColorParams());t.push(new Zu(Object.assign({},o,a),this.getBufferParams()))}}),e.getSelection()),{bufferList:t,polymerList:n}}updateData(e,t){e=e||{};var n=0,i=t.polymerList.length;for(n=0;n<i;++n){var s={},o=new ou(t.polymerList[n],this.getSplineParams());if(e.position){var a=o.getSubdividedPosition();Object.assign(s,{position:a.position})}if(e.color){var l=o.getSubdividedColor(this.getColorParams());Object.assign(s,{color:l.color})}t.bufferList[n].setAttributes(s)}}setParameters(e){var t={};return e&&e.tension&&Object.assign(t,{position:!0}),super.setParameters(e,t,!1),this}}Le.add("trace",Qu);class Ju extends uu{constructor(e,t,n){super(e,t,n),this.type="tube",this.parameters=Object.assign({},this.parameters,{aspectRatio:null})}init(e){var t=e||{};t.aspectRatio=1,t.radiusScale=nt(t.radiusScale,2),t.quality==="low"&&(this.radialSegments=5),super.init(t)}getSplineParams(){return super.getSplineParams({directional:!1})}}Le.add("tube",Ju);class td extends Sh{constructor(e,t,n){super(e,t,n),this.type="unitcell",this.parameters=Object.assign({radiusSize:{type:"number",precision:3,max:10,min:.001},sphereDetail:!0,radialSegments:!0,disableImpostor:!0},this.parameters,{assembly:null}),this.init(n)}init(e){const t=e||{};let n=.5;this.structure.unitcell&&(n=Math.cbrt(this.structure.unitcell.volume)/200),t.radiusSize=nt(t.radiusSize,n),t.colorValue=nt(t.colorValue,"orange"),t.useInteriorColor=nt(t.useInteriorColor,!0),super.init(t)}getUnitcellData(e){return e.unitcell.getData(e)}create(){const e=this.structureView.getStructure();if(!e.unitcell)return;const t=this.getUnitcellData(e);this.sphereBuffer=new Uc(t.vertex,this.getBufferParams({sphereDetail:this.sphereDetail,disableImpostor:this.disableImpostor,dullInterior:!0})),this.cylinderBuffer=new tu(t.edge,this.getBufferParams({openEnded:!0,radialSegments:this.radialSegments,disableImpostor:this.disableImpostor,dullInterior:!0})),this.dataList.push({sview:this.structureView,bufferList:[this.sphereBuffer,this.cylinderBuffer]})}createData(e){}updateData(e,t){const n=t.sview.getStructure();if(!n.unitcell)return;const i=this.getUnitcellData(n),s={},o={};e&&!e.position||(Object.assign(s,{position:i.vertex.position}),Object.assign(o,{position1:i.edge.position1,position2:i.edge.position2})),e&&!e.color||(Object.assign(s,{color:i.vertex.color}),Object.assign(o,{color:i.edge.color,color2:i.edge.color2})),e&&!e.radius||(Object.assign(s,{radius:i.vertex.radius}),Object.assign(o,{radius:i.edge.radius})),this.sphereBuffer.setAttributes(s),this.cylinderBuffer.setAttributes(o)}}Le.add("unitcell",td);class ed extends Sh{constructor(e,t,n){super(e,t,n),this.type="validation",this.parameters=Object.assign({},this.parameters,{radiusType:null,radiusSize:null,radiusScale:null}),this.init(n)}init(e){const t=e||{};t.colorValue=nt(t.colorValue,"#f0027f"),t.useInteriorColor=nt(t.useInteriorColor,!0),super.init(t)}createData(e){if(!e.validation)return;const t=e.validation.getClashData({structure:e,color:this.colorValue});return{bufferList:[new tu(t,this.getBufferParams({openEnded:!1}))]}}}Le.add("validation",ed);const id=new Vector3,rd=new Vector3,nd=new Vector3,sd=new Vector3(0,1,0),od=Object.assign({radialSegments:60,openEnded:!1},No);class ad extends Bc{constructor(e,t={}){super({position:new Float32Array(e.position1.length),color:e.color,picking:e.picking},t,(function(n={}){const i=new ConeGeometry(1,1,nt(n.radialSegments,60),1,nt(n.openEnded,!1));return i.applyMatrix4(new Matrix4().makeRotationX(-Math.PI/2)),i})(t)),this.updateNormals=!0,this._position=new Float32Array(e.position1.length),this.setAttributes(e,!0)}get defaultParameters(){return od}applyPositionTransform(e,t,n){rd.fromArray(this._position1,n),nd.fromArray(this._position2,n),e.lookAt(rd,nd,sd);const i=this._radius[t];id.set(i,i,rd.distanceTo(nd)),e.scale(id)}setAttributes(e={},t){e.position1&&e.position2&&(vi(e.position1,e.position2,this._position),this._position1=e.position1,this._position2=e.position2,e.position=this._position),e.radius&&(this._radius=e.radius),super.setAttributes(e,t)}}je.add("cone",ad);class cd{constructor(e=[]){this.geometryList=e}computeBoundingBox(){this.boundingBox?this.boundingBox.empty():this.boundingBox=new Box3,this.geometryList.forEach((e=>{e.boundingBox||e.computeBoundingBox(),this.boundingBox.union(e.boundingBox)}))}}const ld=Object.assign({aspectRatio:1.5,radialSegments:50,openEnded:!1,disableImpostor:!1},No);class hd{constructor(e,t={}){this.group=new Group,this.wireframeGroup=new Group,this.pickingGroup=new Group,this.visible=!0,this.parameters=st(t,this.defaultParameters),this.splitPosition=new Float32Array(e.position1.length),this.cylinderRadius=new Float32Array(e.radius.length);const n=this.makeAttributes(e),i={radialSegments:this.parameters.radialSegments,openEnded:this.parameters.openEnded,disableImpostor:this.parameters.disableImpostor};this.cylinderBuffer=new tu(n.cylinder,i),this.coneBuffer=new ad(n.cone,i),this.geometry=new cd([this.cylinderBuffer.geometry,this.coneBuffer.geometry]),this.matrix=nt(t.matrix,new Matrix4),this.picking=e.picking}get defaultParameters(){return ld}set matrix(e){Uo.prototype.setMatrix.call(this,e)}get matrix(){return this.group.matrix.clone()}get pickable(){return!!this.picking}makeAttributes(e={}){const t=this.splitPosition,n=this.cylinderRadius,i=this.parameters.aspectRatio;let s,o;const a={},l={};if(e.radius){for(s=0,o=n.length;s<o;++s)n[s]=e.radius[s]/i;a.radius=n,l.radius=e.radius}if(e.position1&&e.position2){const d=new Vector3,u=new Vector3,g=new Vector3,x=new Vector3;for(s=0,o=t.length;s<o;s+=3){d.fromArray(e.position1,s),u.fromArray(e.position2,s),g.subVectors(d,u);const y=g.length(),b=n[s/3]*i*2,_=Math.min(y,b);g.setLength(_),x.copy(u).add(g),x.toArray(t,s)}a.position1=e.position1,a.position2=t,l.position1=t,l.position2=e.position2}return e.color&&(a.color=e.color,a.color2=e.color,l.color=e.color),{cylinder:a,cone:l}}getMesh(){return new Group().add(this.cylinderBuffer.getMesh(),this.coneBuffer.getMesh())}getWireframeMesh(){return new Group().add(this.cylinderBuffer.getWireframeMesh(),this.coneBuffer.getWireframeMesh())}getPickingMesh(){return new Group().add(this.cylinderBuffer.getPickingMesh(),this.coneBuffer.getPickingMesh())}setAttributes(e={}){const t=this.makeAttributes(e);this.cylinderBuffer.setAttributes(t.cylinder),this.coneBuffer.setAttributes(t.cone)}setParameters(e={}){(e=Object.assign({},e))&&e.matrix!==void 0&&(this.matrix=e.matrix),delete e.matrix,e&&e.wireframe!==void 0&&(this.parameters.wireframe=e.wireframe,this.setVisibility(this.visible)),this.cylinderBuffer.setParameters(e),this.coneBuffer.setParameters(e)}setVisibility(e){Uo.prototype.setVisibility.call(this,e)}dispose(){this.cylinderBuffer.dispose(),this.coneBuffer.dispose()}}je.add("arrow",hd);const ud=new Vector3,dd=new Vector3,md=new Vector3,fd=new Vector3(0,0,0);class pd extends Bc{constructor(e,t={}){super(e,t,new BoxGeometry(1,1,1)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){dd.fromArray(this._heightAxis,n),md.fromArray(this._depthAxis,n),e.lookAt(fd,dd,md),ud.set(this._size[t],md.length(),dd.length()),e.scale(ud)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}je.add("box",pd);const gd=new Vector3,yd=new Vector3,bd=new Vector3,_d=new Vector3(0,0,0),xd=Object.assign({sphereDetail:2},No);class vd extends Bc{constructor(e,t={}){super(e,t,new IcosahedronGeometry(1,nt(t.sphereDetail,2))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return xd}applyPositionTransform(e,t,n){yd.fromArray(this._majorAxis,n),bd.fromArray(this._minorAxis,n),e.lookAt(_d,yd,bd),gd.set(this._radius[t],bd.length(),yd.length()),e.scale(gd)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}je.add("ellipsoid",vd);const wd=new Vector3,Ad=new Vector3,Sd=new Vector3,Cd=new Vector3(0,0,0);class Pd extends Bc{constructor(e,t={}){super(e,t,new OctahedronGeometry(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){Ad.fromArray(this._heightAxis,n),Sd.fromArray(this._depthAxis,n),e.lookAt(Cd,Ad,Sd),wd.set(this._size[t],Sd.length(),Ad.length()),e.scale(wd)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}je.add("octahedron",Pd);const Id=new Vector3,kd=new Vector3,Md=new Vector3,Td=new Vector3(0,0,0);class Dd extends Bc{constructor(e,t={}){super(e,t,new TetrahedronGeometry(1,0)),this.updateNormals=!0,this.setAttributes(e,!0)}applyPositionTransform(e,t,n){kd.fromArray(this._heightAxis,n),Md.fromArray(this._depthAxis,n),e.lookAt(Td,kd,Md),Id.set(this._size[t],Md.length(),kd.length()),e.scale(Id)}setAttributes(e={},t){e.size&&(this._size=e.size),e.heightAxis&&(this._heightAxis=e.heightAxis),e.depthAxis&&(this._depthAxis=e.depthAxis),super.setAttributes(e,t)}}je.add("tetrahedron",Dd);const Bd=new Vector3,Fd=new Vector3,Ed=new Vector3,$d=new Vector3(0,0,0),Od=Object.assign({radiusRatio:.2,radialSegments:16,tubularSegments:32},No);class Rd extends Bc{constructor(e,t={}){super(e,t,new TorusGeometry(1,nt(t.radiusRatio,.2),nt(t.radialSegments,16),nt(t.tubularSegments,32))),this.updateNormals=!0,this.setAttributes(e,!0)}get defaultParameters(){return Od}applyPositionTransform(e,t,n){Fd.fromArray(this._majorAxis,n),Ed.fromArray(this._minorAxis,n),e.lookAt($d,Fd,Ed);const i=this._radius[t];Bd.set(i,i,i),e.scale(Bd)}setAttributes(e={},t){e.radius&&(this._radius=e.radius),e.majorAxis&&(this._majorAxis=e.majorAxis),e.minorAxis&&(this._minorAxis=e.minorAxis),super.setAttributes(e,t)}}function Ld(r,e){return{start:e&&e.start!==void 0?Math.max(Math.min(e.start,r-1),0):0,end:e&&e.end!==void 0?Math.min(e.end,r):r}}function Nd(r,e){const t=e&&e.array!==void 0?e.array:Array,{start:n,end:i}=Ld(r,e);return{array:new t(i-n),start:n,end:i}}function zd(r,e,t){const{array:n,start:i}=Nd(r,t);return(function(s,o,a){for(let l=0,d=o.length;l<d;l++)o[l]=s(a+l);return o})(e,n,i)}function Ud(r){return!!r.buffer&&typeof r.byteLength=="number"&&typeof r.BYTES_PER_ELEMENT=="number"}function Vd(r,e){const{constructor:t,buffer:n,length:i,byteOffset:s,BYTES_PER_ELEMENT:o}=r,{start:a,end:l}=Ld(i,e);return a===0&&l===i?r:new t(n,s+o*a,Math.min(i,l-a))}je.add("torus",Rd);const jd=1e-6;function Gd(r,e,t){return Math.abs(r-e)<=t}function Hd(r,e,t){return Math.max(e,Math.min(t,r))}function qd(r,e,t,n,i,s){const o=(t-r)*s,a=(n-e)*s,l=i*i;return(2*e-2*t+o+a)*(i*l)+(-3*e+3*t-2*o-a)*l+o*i+e}function Wd(r,e,t,n){const i=1-n;return i*i*r+2*i*n*e+n*n*t}const Xd=isFinite;function Yd(){return Yd.zero()}(function(r){function e(){const L=[.1,0,0];return L[0]=0,L}function t(L,O,I){const N=e();return N[0]=L,N[1]=O,N[2]=I,N}function n(L,O){return L[0]=O[0],L[1]=O[1],L[2]=O[2],L}function i(L,O,I){return L[0]=O[0]+I[0],L[1]=O[1]+I[1],L[2]=O[2]+I[2],L}function s(L,O,I){return L[0]=O[0]-I[0],L[1]=O[1]-I[1],L[2]=O[2]-I[2],L}function o(L,O,I){return L[0]=O[0]*I,L[1]=O[1]*I,L[2]=O[2]*I,L}function a(L,O,I,N){return L[0]=O[0]+I[0]*N,L[1]=O[1]+I[1]*N,L[2]=O[2]+I[2]*N,L}function l(L){const O=L[0],I=L[1],N=L[2];return O*O+I*I+N*N}function d(L,O){return L[0]=-O[0],L[1]=-O[1],L[2]=-O[2],L}function u(L,O){const I=O[0],N=O[1],k=O[2];let U=I*I+N*N+k*k;return U>0&&(U=1/Math.sqrt(U),L[0]=O[0]*U,L[1]=O[1]*U,L[2]=O[2]*U),L}function g(L,O){return L[0]*O[0]+L[1]*O[1]+L[2]*O[2]}function x(L,O,I){const N=O[0],k=O[1],U=O[2],F=I[0],j=I[1],H=I[2];return L[0]=k*H-U*j,L[1]=U*F-N*H,L[2]=N*j-k*F,L}r.zero=e,r.clone=function(L){const O=e();return O[0]=L[0],O[1]=L[1],O[2]=L[2],O},r.isFinite=function(L){return Xd(L[0])&&Xd(L[1])&&Xd(L[2])},r.hasNaN=function(L){return isNaN(L[0])||isNaN(L[1])||isNaN(L[2])},r.setNaN=function(L){return L[0]=NaN,L[1]=NaN,L[2]=NaN,L},r.fromObj=function(L){return t(L.x,L.y,L.z)},r.toObj=function(L){return{x:L[0],y:L[1],z:L[2]}},r.fromArray=function(L,O,I){return L[0]=O[I+0],L[1]=O[I+1],L[2]=O[I+2],L},r.toArray=function(L,O,I){return O[I+0]=L[0],O[I+1]=L[1],O[I+2]=L[2],O},r.create=t,r.ofArray=function(L){const O=e();return O[0]=L[0],O[1]=L[1],O[2]=L[2],O},r.set=function(L,O,I,N){return L[0]=O,L[1]=I,L[2]=N,L},r.copy=n,r.add=i,r.sub=s,r.mul=function(L,O,I){return L[0]=O[0]*I[0],L[1]=O[1]*I[1],L[2]=O[2]*I[2],L},r.div=function(L,O,I){return L[0]=O[0]/I[0],L[1]=O[1]/I[1],L[2]=O[2]/I[2],L},r.scale=o,r.scaleAndAdd=a,r.scaleAndSub=function(L,O,I,N){return L[0]=O[0]-I[0]*N,L[1]=O[1]-I[1]*N,L[2]=O[2]-I[2]*N,L},r.addScalar=function(L,O,I){return L[0]=O[0]+I,L[1]=O[1]+I,L[2]=O[2]+I,L},r.subScalar=function(L,O,I){return L[0]=O[0]-I,L[1]=O[1]-I,L[2]=O[2]-I,L},r.round=function(L,O){return L[0]=Math.round(O[0]),L[1]=Math.round(O[1]),L[2]=Math.round(O[2]),L},r.ceil=function(L,O){return L[0]=Math.ceil(O[0]),L[1]=Math.ceil(O[1]),L[2]=Math.ceil(O[2]),L},r.floor=function(L,O){return L[0]=Math.floor(O[0]),L[1]=Math.floor(O[1]),L[2]=Math.floor(O[2]),L},r.trunc=function(L,O){return L[0]=Math.trunc(O[0]),L[1]=Math.trunc(O[1]),L[2]=Math.trunc(O[2]),L},r.abs=function(L,O){return L[0]=Math.abs(O[0]),L[1]=Math.abs(O[1]),L[2]=Math.abs(O[2]),L},r.min=function(L,O,I){return L[0]=Math.min(O[0],I[0]),L[1]=Math.min(O[1],I[1]),L[2]=Math.min(O[2],I[2]),L},r.max=function(L,O,I){return L[0]=Math.max(O[0],I[0]),L[1]=Math.max(O[1],I[1]),L[2]=Math.max(O[2],I[2]),L},r.clamp=function(L,O,I,N){return L[0]=Math.max(I[0],Math.min(N[0],O[0])),L[1]=Math.max(I[1],Math.min(N[1],O[1])),L[2]=Math.max(I[2],Math.min(N[2],O[2])),L},r.distance=function(L,O){const I=O[0]-L[0],N=O[1]-L[1],k=O[2]-L[2];return Math.sqrt(I*I+N*N+k*k)},r.squaredDistance=function(L,O){const I=O[0]-L[0],N=O[1]-L[1],k=O[2]-L[2];return I*I+N*N+k*k},r.magnitude=function(L){const O=L[0],I=L[1],N=L[2];return Math.sqrt(O*O+I*I+N*N)},r.squaredMagnitude=l,r.setMagnitude=function(L,O,I){return o(L,u(L,O),I)},r.negate=d,r.inverse=function(L,O){return L[0]=1/O[0],L[1]=1/O[1],L[2]=1/O[2],L},r.normalize=u,r.dot=g,r.cross=x,r.lerp=function(L,O,I,N){const k=O[0],U=O[1],F=O[2];return L[0]=k+N*(I[0]-k),L[1]=U+N*(I[1]-U),L[2]=F+N*(I[2]-F),L};const y=e();function b(L,O){const I=Math.sqrt(l(L)*l(O));if(I===0)return Math.PI/2;const N=g(L,O)/I;return Math.acos(Hd(N,-1,1))}r.slerp=function(L,O,I,N){const k=Hd(g(O,I),-1,1),U=Math.acos(k)*N;return a(y,I,O,-k),u(y,y),i(L,o(L,O,Math.cos(U)),o(y,y,Math.sin(U)))},r.hermite=function(L,O,I,N,k,U){const F=U*U,j=F*(2*U-3)+1,H=F*(U-2)+U,B=F*(U-1),V=F*(3-2*U);return L[0]=O[0]*j+I[0]*H+N[0]*B+k[0]*V,L[1]=O[1]*j+I[1]*H+N[1]*B+k[1]*V,L[2]=O[2]*j+I[2]*H+N[2]*B+k[2]*V,L},r.bezier=function(L,O,I,N,k,U){const F=1-U,j=F*F,H=U*U,B=j*F,V=3*U*j,K=3*H*F,q=H*U;return L[0]=O[0]*B+I[0]*V+N[0]*K+k[0]*q,L[1]=O[1]*B+I[1]*V+N[1]*K+k[1]*q,L[2]=O[2]*B+I[2]*V+N[2]*K+k[2]*q,L},r.quadraticBezier=function(L,O,I,N,k){return L[0]=Wd(O[0],I[0],N[0],k),L[1]=Wd(O[1],I[1],N[1],k),L[2]=Wd(O[2],I[2],N[2],k),L},r.spline=function(L,O,I,N,k,U,F){return L[0]=qd(O[0],I[0],N[0],k[0],U,F),L[1]=qd(O[1],I[1],N[1],k[1],U,F),L[2]=qd(O[2],I[2],N[2],k[2],U,F),L},r.random=function(L,O){const I=2*Math.random()*Math.PI,N=2*Math.random()-1,k=Math.sqrt(1-N*N)*O;return L[0]=Math.cos(I)*k,L[1]=Math.sin(I)*k,L[2]=N*O,L},r.transformMat4=function(L,O,I){const N=O[0],k=O[1],U=O[2],F=1/(I[3]*N+I[7]*k+I[11]*U+I[15]||1);return L[0]=(I[0]*N+I[4]*k+I[8]*U+I[12])*F,L[1]=(I[1]*N+I[5]*k+I[9]*U+I[13])*F,L[2]=(I[2]*N+I[6]*k+I[10]*U+I[14])*F,L},r.transformDirection=function(L,O,I){const N=O[0],k=O[1],U=O[2];return L[0]=I[0]*N+I[4]*k+I[8]*U,L[1]=I[1]*N+I[5]*k+I[9]*U,L[2]=I[2]*N+I[6]*k+I[10]*U,u(L,L)},r.transformMat4Offset=function(L,O,I,N,k,U){const F=O[0+k],j=O[1+k],H=O[2+k],B=1/(I[3+U]*F+I[7+U]*j+I[11+U]*H+I[15+U]||1);return L[0+N]=(I[0+U]*F+I[4+U]*j+I[8+U]*H+I[12+U])*B,L[1+N]=(I[1+U]*F+I[5+U]*j+I[9+U]*H+I[13+U])*B,L[2+N]=(I[2+U]*F+I[6+U]*j+I[10+U]*H+I[14+U])*B,L},r.transformDirectionOffset=function(L,O,I,N,k,U){const F=O[0+k],j=O[1+k],H=O[2+k];L[0+N]=I[0+U]*F+I[4+U]*j+I[8+U]*H,L[1+N]=I[1+U]*F+I[5+U]*j+I[9+U]*H,L[2+N]=I[2+U]*F+I[6+U]*j+I[10+U]*H;const B=Math.hypot(L[0+N],L[1+N],L[2+N]);return B>0&&(L[0+N]/=B,L[1+N]/=B,L[2+N]/=B),L},r.transformMat3=function(L,O,I){const N=O[0],k=O[1],U=O[2];return L[0]=N*I[0]+k*I[3]+U*I[6],L[1]=N*I[1]+k*I[4]+U*I[7],L[2]=N*I[2]+k*I[5]+U*I[8],L},r.transformQuat=function(L,O,I){const N=O[0],k=O[1],U=O[2],F=I[0],j=I[1],H=I[2],B=I[3],V=B*N+j*U-H*k,K=B*k+H*N-F*U,q=B*U+F*k-j*N,Te=-F*N-j*k-H*U;return L[0]=V*B+Te*-F+K*-H-q*-j,L[1]=K*B+Te*-j+q*-F-V*-H,L[2]=q*B+Te*-H+V*-j-K*-F,L},r.angle=b;const _=e(),h=e(),f=e(),E=e(),m=e(),S=e(),w=e();r.dihedralAngle=function(L,O,I,N){s(_,L,O),s(h,I,O),s(f,O,I),s(E,N,I),x(m,_,h),x(S,f,E);const k=b(m,S);return x(w,m,S),g(h,w)>0?k:-k},r.directionFromSpherical=function(L,O,I,N){return r.set(L,N*Math.cos(I)*Math.sin(O),N*Math.sin(I)*Math.sin(O),N*Math.cos(O))},r.exactEquals=function(L,O){return L[0]===O[0]&&L[1]===O[1]&&L[2]===O[2]},r.equals=function(L,O){const I=L[0],N=L[1],k=L[2],U=O[0],F=O[1],j=O[2];return Math.abs(I-U)<=jd*Math.max(1,Math.abs(I),Math.abs(U))&&Math.abs(N-F)<=jd*Math.max(1,Math.abs(N),Math.abs(F))&&Math.abs(k-j)<=jd*Math.max(1,Math.abs(k),Math.abs(j))};const v=e();r.makeRotation=function(L,O,I){const N=b(O,I);if(Math.abs(N)<1e-4)return Qd.setIdentity(L);if(Math.abs(N-Math.PI)<jd)return Qd.fromScaling(L,r.negUnit);const k=x(v,O,I);return Qd.fromRotation(L,N,k)},r.isZero=function(L){return L[0]===0&&L[1]===0&&L[2]===0},r.projectPointOnVector=function(L,O,I,N){return s(L,O,N),i(L,o(L,I,g(I,L)/l(I)),N)};const A=e();function M(L,O,I){return o(L,I,g(I,O)/l(I))}r.projectPointOnPlane=function(L,O,I,N){return u(A,I),s(L,O,N),s(L,O,o(A,A,g(L,A)))},r.projectOnVector=M;const T=e();r.projectOnPlane=function(L,O,I){return M(T,O,I),s(L,O,T)},r.orthogonalize=function(L,O,I){return u(L,x(L,x(L,O,I),O))},r.matchDirection=function(L,O,I){return g(O,I)>0?n(L,O):d(L,n(L,O)),L};const R=e(),P=e();r.triangleNormal=function(L,O,I,N){return s(R,I,O),s(P,N,O),u(L,x(L,R,P))},r.toString=function(L,O){return`[${L[0].toPrecision(O)} ${L[1].toPrecision(O)} ${L[2].toPrecision(O)}]`},r.origin=t(0,0,0),r.unit=t(1,1,1),r.negUnit=t(-1,-1,-1),r.unitX=t(1,0,0),r.unitY=t(0,1,0),r.unitZ=t(0,0,1),r.negUnitX=t(-1,0,0),r.negUnitY=t(0,-1,0),r.negUnitZ=t(0,0,-1)})(Yd||(Yd={}));const Kd=Math.PI/180;function Zd(r){return r*Kd}function Qd(){return Qd.zero()}function Jd(){return Jd.zero()}function tm(){return tm.zero()}function em(){return em.zero()}function im(r){throw new Error("unreachable")}function rm(){return rm.zero()}var nm,sm,om,am;function cm(r,e,t){let n=e,i=0,s=1;for(r.charCodeAt(n)===45?(s=-1,++n):r.charCodeAt(n)===43&&++n;n<t;n++){const o=r.charCodeAt(n)-48;if(o>9||o<0)return s*i|0;i=10*i+o|0}return s*i}function lm(r,e,t,n){return e.charCodeAt(t)===43&&t++,r*Math.pow(10,cm(e,t,n))}function hm(r,e,t){let n=e,i=1,s=0,o=0,a=1;for(r.charCodeAt(n)===45?(i=-1,++n):r.charCodeAt(n)===43&&++n;n<t;){let l=r.charCodeAt(n)-48;if(!(l>=0&&l<10)){if(l===-2){for(++n;n<t;){if(l=r.charCodeAt(n)-48,!(l>=0&&l<10))return l===53||l===21?lm(i*(s+o/a),r,n+1,t):i*(s+o/a);o=10*o+l,a*=10,++n}return i*(s+o/a)}if(l===53||l===21)return lm(i*s,r,n+1,t);break}s=10*s+l,++n}return i*s}function um(r,e,t,n){return{schema:t,__array:void 0,isDefined:n===0,rowCount:e,value:i=>r,valueKind:i=>n,toArray:i=>{const{array:s}=Nd(e,i);for(let o=0,a=s.length;o<a;o++)s[o]=r;return s},areValuesEqual:(i,s)=>!0}}function dm({value:r,valueKind:e,areValuesEqual:t,rowCount:n,schema:i}){return{schema:i,__array:void 0,isDefined:!0,rowCount:n,value:r,valueKind:e||(s=>0),toArray:s=>{const{array:o,start:a}=Nd(n,s);for(let l=0,d=o.length;l<d;l++)o[l]=r(l+a);return o},areValuesEqual:t||((s,o)=>r(s)===r(o))}}function mm({array:r,schema:e,valueKind:t}){const n=r.length,i=e.T,s=e.valueType==="str"?e.transform==="lowercase"?a=>{const l=r[a];return typeof l=="string"?l.toLowerCase():`${l??i}`.toLowerCase()}:e.transform==="uppercase"?a=>{const l=r[a];return typeof l=="string"?l.toUpperCase():`${l??i}`.toUpperCase()}:a=>{const l=r[a];return typeof l=="string"?l:`${l??i}`}:a=>r[a],o=Ud(r);return{schema:e,__array:r,isDefined:!0,rowCount:n,value:s,valueKind:t||(a=>0),toArray:e.valueType==="str"?e.transform==="lowercase"?a=>{const{start:l,end:d}=Ld(n,a),u=new(a&&a.array!==void 0?a.array:r.constructor)(d-l);for(let g=0,x=d-l;g<x;g++){const y=r[l+g];u[g]=typeof y=="string"?y.toLowerCase():`${y??i}`.toLowerCase()}return u}:e.transform==="uppercase"?a=>{const{start:l,end:d}=Ld(n,a),u=new(a&&a.array!==void 0?a.array:r.constructor)(d-l);for(let g=0,x=d-l;g<x;g++){const y=r[l+g];u[g]=typeof y=="string"?y.toUpperCase():`${y??i}`.toUpperCase()}return u}:a=>{const{start:l,end:d}=Ld(n,a),u=new(a&&a.array!==void 0?a.array:r.constructor)(d-l);for(let g=0,x=d-l;g<x;g++){const y=r[l+g];u[g]=typeof y=="string"?y:`${y??i}`}return u}:o?a=>Vd(r,a):a=>{const{start:l,end:d}=Ld(n,a);if(l===0&&d===r.length)return r;const u=new(a&&a.array!==void 0?a.array:r.constructor)(d-l);for(let g=0,x=d-l;g<x;g++)u[g]=r[l+g];return u},areValuesEqual:(a,l)=>r[a]===r[l]}}function fm(r,e,t){return r.isDefined?e===0&&t===r.rowCount?r:r.__array&&Ud(r.__array)?(function(n,i,s){const o=Vd(n.__array,{start:i,end:s}),a=n.valueKind;return mm({array:o,schema:n.schema,valueKind:l=>a(i+l)})})(r,e,t):(function(n,i,s){const o=n.value,a=n.valueKind,l=n.areValuesEqual,d=i===0?o:g=>o(g+i),u=s-i;return{schema:n.schema,__array:void 0,isDefined:n.isDefined,rowCount:u,value:d,valueKind:i===0?a:g=>a(g+i),toArray:g=>{const{array:x}=Nd(u,g);for(let y=0,b=x.length;y<b;y++)x[y]=o(y+i);return x},areValuesEqual:i===0?l:(g,x)=>l(g+i,x+i)}})(r,e,t):sm.Undefined(t-e,r.schema)}function pm(r,e,t){return r.rowCount===0||t&&(function(n,i){if(n.length!==i)return!1;for(let s=0,o=n.length;s<o;s++)if(n[s]!==s)return!1;return!0})(e,r.rowCount)?r:r.__array&&typeof r.value(0)==typeof r.__array[0]?(function(n,i){const s=n.__array,o=new s.constructor(i.length);for(let l=0,d=i.length;l<d;l++)o[l]=s[i[l]];const a=n.valueKind;return mm({array:o,schema:n.schema,valueKind:l=>a(i[l])})})(r,e):(function(n,i){const s=n.value,o=n.valueKind,a=n.areValuesEqual,l=u=>s(i[u]),d=i.length;return{schema:n.schema,__array:void 0,isDefined:n.isDefined,rowCount:d,value:l,valueKind:u=>o(i[u]),toArray:u=>{const{array:g}=Nd(d,u);for(let x=0,y=g.length;x<y;x++)g[x]=s(i[x]);return g},areValuesEqual:(u,g)=>a(i[u],i[g])}})(r,e)}function gm(r,e,t){return r[e]-r[t]}function ym(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}function bm(r,e,t,n){const i=t+n>>1;return e(r,t,n)>0?e(r,t,i)>0?e(r,i,n)>0?i:n:t:e(r,n,i)>0?e(r,i,t)>0?i:t:n}function _m(r,e,t){const{cmp:n,swap:i,data:s,parts:o}=r;let a=e+1,l=t;for(i(s,e,bm(s,n,e,t));n(s,l,e)>0;)--l;for(let d=e+1;d<=l;d++){const u=n(s,d,e);if(u>0){for(i(s,d,l),--l;n(s,l,e)>0;)--l;d--}else u===0&&(i(s,d,a),a++)}for(let d=e;d<a;d++)i(s,d,e+l-d);o[0]=l-a+e+1,o[1]=l}function xm({data:r,cmp:e,swap:t},n,i){for(let s=n+1;s<=i;s++){let o=s-1;for(;o>=n&&e(r,o,o+1)>0;)t(r,o,o+1),o-=1}}function vm(r,e,t){const{parts:n}=r;for(;e<t;){if(t-e<16)return void xm(r,e,t);_m(r,e,t);const i=n[0],s=n[1];i-e<t-s?(vm(r,e,i-1),e=s+1):(vm(r,s+1,t),t=i-1)}}function wm(r,e,t,n){let i=t+1,s=n;ym(r,t,bm(r,gm,t,n));const o=r[t];for(;r[s]>o;)--s;for(let a=t+1;a<=s;a++){const l=r[a];if(l>o){for(ym(r,a,s),--s;r[s]>o;)--s;a--}else l===o&&(ym(r,a,i),++i)}for(let a=t;a<i;a++)ym(r,a,t+s-a);e[0]=s-i+t+1,e[1]=s}function Am(r,e,t){for(let n=e+1;n<=t;n++){const i=r[n];let s=n-1;for(;s>=e&&r[s]>i;)r[s+1]=r[s],s-=1;r[s+1]=i}}function Sm(r,e,t,n){for(;t<n;){if(n-t<16)return void Am(r,t,n);wm(r,e,t,n);const i=e[0],s=e[1];i-t<n-s?(Sm(r,e,t,i-1),t=s+1):(Sm(r,e,s+1,n),n=i-1)}}function Cm(r,e=gm){return(function(t,n,i,s=gm){return s===gm?Sm(t,[0,0],n,i-1):vm({data:t,cmp:s,swap:ym,parts:[0,0]},n,i-1),t})(r,0,r.length,e)}(function(r){function e(){const m=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return m[0]=0,m}function t(){const m=e();return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function n(m){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}function i(m){for(let S=0;S<16;S++)m[S]=0;return m}r.zero=e,r.identity=t,r.setIdentity=n,r.setZero=i,r.ofRows=function(m){const S=e();for(let w=0;w<4;w++){const v=m[w];for(let A=0;A<4;A++)S[4*A+w]=v[A]}return S};const s=t();function o(m,S,w){for(let v=0;v<16;v++)if(Math.abs(m[v]-S[v])>w)return!1;return!0}function a(m,S,w,v){m[4*w+S]=v}function l(m,S){return m[0]=S[0],m[1]=S[1],m[2]=S[2],m[3]=S[3],m[4]=S[4],m[5]=S[5],m[6]=S[6],m[7]=S[7],m[8]=S[8],m[9]=S[9],m[10]=S[10],m[11]=S[11],m[12]=S[12],m[13]=S[13],m[14]=S[14],m[15]=S[15],m}function d(m,S){const w=S[0]+S[5]+S[10];let v=0;return w>0?(v=2*Math.sqrt(w+1),m[3]=.25*v,m[0]=(S[6]-S[9])/v,m[1]=(S[8]-S[2])/v,m[2]=(S[1]-S[4])/v):S[0]>S[5]&&S[0]>S[10]?(v=2*Math.sqrt(1+S[0]-S[5]-S[10]),m[3]=(S[6]-S[9])/v,m[0]=.25*v,m[1]=(S[1]+S[4])/v,m[2]=(S[8]+S[2])/v):S[5]>S[10]?(v=2*Math.sqrt(1+S[5]-S[0]-S[10]),m[3]=(S[8]-S[2])/v,m[0]=(S[1]+S[4])/v,m[1]=.25*v,m[2]=(S[6]+S[9])/v):(v=2*Math.sqrt(1+S[10]-S[0]-S[5]),m[3]=(S[1]-S[4])/v,m[0]=(S[8]+S[2])/v,m[1]=(S[6]+S[9])/v,m[2]=.25*v),m}function u(m,S){const w=S[0],v=S[1],A=S[2],M=S[3],T=S[4],R=S[5],P=S[6],L=S[7],O=S[8],I=S[9],N=S[10],k=S[11],U=S[12],F=S[13],j=S[14],H=S[15],B=w*R-v*T,V=w*P-A*T,K=w*L-M*T,q=v*P-A*R,Te=v*L-M*R,Fe=A*L-M*P,We=O*F-I*U,J=O*j-N*U,et=O*H-k*U,ht=I*j-N*F,er=I*H-k*F,tr=N*H-k*j;let Hm=B*tr-V*er+K*ht+q*et-Te*J+Fe*We;return!!Hm&&(Hm=1/Hm,m[0]=(R*tr-P*er+L*ht)*Hm,m[1]=(A*er-v*tr-M*ht)*Hm,m[2]=(F*Fe-j*Te+H*q)*Hm,m[3]=(N*Te-I*Fe-k*q)*Hm,m[4]=(P*et-T*tr-L*J)*Hm,m[5]=(w*tr-A*et+M*J)*Hm,m[6]=(j*K-U*Fe-H*V)*Hm,m[7]=(O*Fe-N*K+k*V)*Hm,m[8]=(T*er-R*et+L*We)*Hm,m[9]=(v*et-w*er-M*We)*Hm,m[10]=(U*Te-F*K+H*B)*Hm,m[11]=(I*K-O*Te-k*B)*Hm,m[12]=(R*J-T*ht-P*We)*Hm,m[13]=(w*ht-v*J+A*We)*Hm,m[14]=(F*V-U*q-j*B)*Hm,m[15]=(O*q-I*V+N*B)*Hm,!0)}function g(m,S,w){const v=S[0],A=S[1],M=S[2],T=S[3],R=S[4],P=S[5],L=S[6],O=S[7],I=S[8],N=S[9],k=S[10],U=S[11],F=S[12],j=S[13],H=S[14],B=S[15];let V=w[0],K=w[1],q=w[2],Te=w[3];return m[0]=V*v+K*R+q*I+Te*F,m[1]=V*A+K*P+q*N+Te*j,m[2]=V*M+K*L+q*k+Te*H,m[3]=V*T+K*O+q*U+Te*B,V=w[4],K=w[5],q=w[6],Te=w[7],m[4]=V*v+K*R+q*I+Te*F,m[5]=V*A+K*P+q*N+Te*j,m[6]=V*M+K*L+q*k+Te*H,m[7]=V*T+K*O+q*U+Te*B,V=w[8],K=w[9],q=w[10],Te=w[11],m[8]=V*v+K*R+q*I+Te*F,m[9]=V*A+K*P+q*N+Te*j,m[10]=V*M+K*L+q*k+Te*H,m[11]=V*T+K*O+q*U+Te*B,V=w[12],K=w[13],q=w[14],Te=w[15],m[12]=V*v+K*R+q*I+Te*F,m[13]=V*A+K*P+q*N+Te*j,m[14]=V*M+K*L+q*k+Te*H,m[15]=V*T+K*O+q*U+Te*B,m}function x(m,S,w){let v=w[0],A=w[1],M=w[2],T=Math.sqrt(v*v+A*A+M*M);if(Math.abs(T)<jd)return n(m);T=1/T,v*=T,A*=T,M*=T;const R=Math.sin(S),P=Math.cos(S),L=1-P;return m[0]=v*v*L+P,m[1]=A*v*L+M*R,m[2]=M*v*L-A*R,m[3]=0,m[4]=v*A*L-M*R,m[5]=A*A*L+P,m[6]=M*A*L+v*R,m[7]=0,m[8]=v*M*L+A*R,m[9]=A*M*L-v*R,m[10]=M*M*L+P,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m}r.isIdentity=function(m,S){return o(m,s,S===void 0?jd:S)},r.hasNaN=function(m){for(let S=0;S<16;S++)if(isNaN(m[S]))return!0;return!1},r.areEqual=o,r.setValue=a,r.getValue=function(m,S,w){return m[4*w+S]},r.toArray=function(m,S,w){return S[w+0]=m[0],S[w+1]=m[1],S[w+2]=m[2],S[w+3]=m[3],S[w+4]=m[4],S[w+5]=m[5],S[w+6]=m[6],S[w+7]=m[7],S[w+8]=m[8],S[w+9]=m[9],S[w+10]=m[10],S[w+11]=m[11],S[w+12]=m[12],S[w+13]=m[13],S[w+14]=m[14],S[w+15]=m[15],S},r.fromArray=function(m,S,w){return m[0]=S[w+0],m[1]=S[w+1],m[2]=S[w+2],m[3]=S[w+3],m[4]=S[w+4],m[5]=S[w+5],m[6]=S[w+6],m[7]=S[w+7],m[8]=S[w+8],m[9]=S[w+9],m[10]=S[w+10],m[11]=S[w+11],m[12]=S[w+12],m[13]=S[w+13],m[14]=S[w+14],m[15]=S[w+15],m},r.fromBasis=function(m,S,w,v){return i(m),a(m,0,0,S[0]),a(m,1,0,S[1]),a(m,2,0,S[2]),a(m,0,1,w[0]),a(m,1,1,w[1]),a(m,2,1,w[2]),a(m,0,2,v[0]),a(m,1,2,v[1]),a(m,2,2,v[2]),a(m,3,3,1),m},r.copy=l,r.clone=function(m){return l(e(),m)},r.getTranslation=function(m,S){return m[0]=S[12],m[1]=S[13],m[2]=S[14],m},r.getScaling=function(m,S){const w=S[0],v=S[1],A=S[2],M=S[4],T=S[5],R=S[6],P=S[8],L=S[9],O=S[10];return m[0]=Math.sqrt(w*w+v*v+A*A),m[1]=Math.sqrt(M*M+T*T+R*R),m[2]=Math.sqrt(P*P+L*L+O*O),m},r.getRotation=d,r.extractRotation=function(m,S){const w=1/Math.sqrt(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]),v=1/Math.sqrt(S[4]*S[4]+S[5]*S[5]+S[6]*S[6]),A=1/Math.sqrt(S[8]*S[8]+S[9]*S[9]+S[10]*S[10]);return m[0]=S[0]*w,m[1]=S[1]*w,m[2]=S[2]*w,m[3]=0,m[4]=S[4]*v,m[5]=S[5]*v,m[6]=S[6]*v,m[7]=0,m[8]=S[8]*A,m[9]=S[9]*A,m[10]=S[10]*A,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.transpose=function(m,S){if(m===S){const w=S[1],v=S[2],A=S[3],M=S[6],T=S[7],R=S[11];m[1]=S[4],m[2]=S[8],m[3]=S[12],m[4]=w,m[6]=S[9],m[7]=S[13],m[8]=v,m[9]=M,m[11]=S[14],m[12]=A,m[13]=T,m[14]=R}else m[0]=S[0],m[1]=S[4],m[2]=S[8],m[3]=S[12],m[4]=S[1],m[5]=S[5],m[6]=S[9],m[7]=S[13],m[8]=S[2],m[9]=S[6],m[10]=S[10],m[11]=S[14],m[12]=S[3],m[13]=S[7],m[14]=S[11],m[15]=S[15];return m},r.tryInvert=u,r.invert=function(m,S){return u(m,S)||console.warn("non-invertible matrix.",S),m},r.mul=g,r.mulOffset=function(m,S,w,v,A,M){const T=S[0+A],R=S[1+A],P=S[2+A],L=S[3+A],O=S[4+A],I=S[5+A],N=S[6+A],k=S[7+A],U=S[8+A],F=S[9+A],j=S[10+A],H=S[11+A],B=S[12+A],V=S[13+A],K=S[14+A],q=S[15+A];let Te=w[0+M],Fe=w[1+M],We=w[2+M],J=w[3+M];return m[0+v]=Te*T+Fe*O+We*U+J*B,m[1+v]=Te*R+Fe*I+We*F+J*V,m[2+v]=Te*P+Fe*N+We*j+J*K,m[3+v]=Te*L+Fe*k+We*H+J*q,Te=w[4+M],Fe=w[5+M],We=w[6+M],J=w[7+M],m[4+v]=Te*T+Fe*O+We*U+J*B,m[5+v]=Te*R+Fe*I+We*F+J*V,m[6+v]=Te*P+Fe*N+We*j+J*K,m[7+v]=Te*L+Fe*k+We*H+J*q,Te=w[8+M],Fe=w[9+M],We=w[10+M],J=w[11+M],m[8+v]=Te*T+Fe*O+We*U+J*B,m[9+v]=Te*R+Fe*I+We*F+J*V,m[10+v]=Te*P+Fe*N+We*j+J*K,m[11+v]=Te*L+Fe*k+We*H+J*q,Te=w[12+M],Fe=w[13+M],We=w[14+M],J=w[15+M],m[12+v]=Te*T+Fe*O+We*U+J*B,m[13+v]=Te*R+Fe*I+We*F+J*V,m[14+v]=Te*P+Fe*N+We*j+J*K,m[15+v]=Te*L+Fe*k+We*H+J*q,m},r.mul3=function(m,S,w,v){return g(m,g(m,S,w),v)},r.translate=function(m,S,w){const v=w[0],A=w[1],M=w[2];let T,R,P,L,O,I,N,k,U,F,j,H;return S===m?(m[12]=S[0]*v+S[4]*A+S[8]*M+S[12],m[13]=S[1]*v+S[5]*A+S[9]*M+S[13],m[14]=S[2]*v+S[6]*A+S[10]*M+S[14],m[15]=S[3]*v+S[7]*A+S[11]*M+S[15]):(T=S[0],R=S[1],P=S[2],L=S[3],O=S[4],I=S[5],N=S[6],k=S[7],U=S[8],F=S[9],j=S[10],H=S[11],m[0]=T,m[1]=R,m[2]=P,m[3]=L,m[4]=O,m[5]=I,m[6]=N,m[7]=k,m[8]=U,m[9]=F,m[10]=j,m[11]=H,m[12]=T*v+O*A+U*M+S[12],m[13]=R*v+I*A+F*M+S[13],m[14]=P*v+N*A+j*M+S[14],m[15]=L*v+k*A+H*M+S[15]),m},r.fromTranslation=function(m,S){return m[0]=1,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=1,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=1,m[11]=0,m[12]=S[0],m[13]=S[1],m[14]=S[2],m[15]=1,m},r.setTranslation=function(m,S){return m[12]=S[0],m[13]=S[1],m[14]=S[2],m},r.setAxes=function(m,S,w,v){return m[0]=w[0],m[4]=w[1],m[8]=w[2],m[1]=v[0],m[5]=v[1],m[9]=v[2],m[2]=S[0],m[6]=S[1],m[10]=S[2],m},r.rotate=function(m,S,w,v){let A=v[0],M=v[1],T=v[2],R=Math.sqrt(A*A+M*M+T*T);if(Math.abs(R)<jd)return t();R=1/R,A*=R,M*=R,T*=R;const P=Math.sin(w),L=Math.cos(w),O=1-L,I=S[0],N=S[1],k=S[2],U=S[3],F=S[4],j=S[5],H=S[6],B=S[7],V=S[8],K=S[9],q=S[10],Te=S[11],Fe=A*A*O+L,We=M*A*O+T*P,J=T*A*O-M*P,et=A*M*O-T*P,ht=M*M*O+L,er=T*M*O+A*P,tr=A*T*O+M*P,Hm=M*T*O-A*P,oi=T*T*O+L;return m[0]=I*Fe+F*We+V*J,m[1]=N*Fe+j*We+K*J,m[2]=k*Fe+H*We+q*J,m[3]=U*Fe+B*We+Te*J,m[4]=I*et+F*ht+V*er,m[5]=N*et+j*ht+K*er,m[6]=k*et+H*ht+q*er,m[7]=U*et+B*ht+Te*er,m[8]=I*tr+F*Hm+V*oi,m[9]=N*tr+j*Hm+K*oi,m[10]=k*tr+H*Hm+q*oi,m[11]=U*tr+B*Hm+Te*oi,S!==m&&(m[12]=S[12],m[13]=S[13],m[14]=S[14],m[15]=S[15]),m},r.fromRotation=x,r.scale=function(m,S,w){const v=w[0],A=w[1],M=w[2];return m[0]=S[0]*v,m[1]=S[1]*v,m[2]=S[2]*v,m[3]=S[3]*v,m[4]=S[4]*A,m[5]=S[5]*A,m[6]=S[6]*A,m[7]=S[7]*A,m[8]=S[8]*M,m[9]=S[9]*M,m[10]=S[10]*M,m[11]=S[11]*M,m[12]=S[12],m[13]=S[13],m[14]=S[14],m[15]=S[15],m},r.scaleUniformly=function(m,S,w){return m[0]=S[0]*w,m[1]=S[1]*w,m[2]=S[2]*w,m[3]=S[3]*w,m[4]=S[4]*w,m[5]=S[5]*w,m[6]=S[6]*w,m[7]=S[7]*w,m[8]=S[8]*w,m[9]=S[9]*w,m[10]=S[10]*w,m[11]=S[11]*w,m[12]=S[12],m[13]=S[13],m[14]=S[14],m[15]=S[15],m},r.fromScaling=function(m,S){return m[0]=S[0],m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=S[1],m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=S[2],m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.fromUniformScaling=function(m,S){return m[0]=S,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=S,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=S,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.fromMat3=function(m,S){return m[0]=S[0],m[1]=S[1],m[2]=S[2],m[4]=S[3],m[5]=S[4],m[6]=S[5],m[8]=S[6],m[9]=S[7],m[10]=S[8],m},r.compose=function(m,S,w,v){const[A,M,T,R]=w,P=A+A,L=M+M,O=T+T,I=A*P,N=A*L,k=A*O,U=M*L,F=M*O,j=T*O,H=R*P,B=R*L,V=R*O,[K,q,Te]=v;return m[0]=(1-(U+j))*K,m[1]=(N+V)*K,m[2]=(k-B)*K,m[3]=0,m[4]=(N-V)*q,m[5]=(1-(I+j))*q,m[6]=(F+H)*q,m[7]=0,m[8]=(k+B)*Te,m[9]=(F-H)*Te,m[10]=(1-(I+U))*Te,m[11]=0,m[12]=S[0],m[13]=S[1],m[14]=S[2],m[15]=1,m};const y=[0,0,0],b=e();function _(m){const S=m[0],w=m[1],v=m[2],A=m[3],M=m[4],T=m[5],R=m[6],P=m[7],L=m[8],O=m[9],I=m[10],N=m[11],k=m[12],U=m[13],F=m[14],j=m[15];return(S*T-w*M)*(I*j-N*F)-(S*R-v*M)*(O*j-N*U)+(S*P-A*M)*(O*F-I*U)+(w*R-v*T)*(L*j-N*k)-(w*P-A*T)*(L*F-I*k)+(v*P-A*R)*(L*U-O*k)}r.decompose=function(m,S,w,v){let A=Yd.magnitude(Yd.set(y,m[0],m[1],m[2]));const M=Yd.magnitude(Yd.set(y,m[4],m[5],m[6])),T=Yd.magnitude(Yd.set(y,m[8],m[9],m[10]));_(m)<0&&(A=-A),S[0]=m[12],S[1]=m[13],S[2]=m[14],l(b,m);const R=1/A,P=1/M,L=1/T;return b[0]*=R,b[1]*=R,b[2]*=R,b[4]*=P,b[5]*=P,b[6]*=P,b[8]*=L,b[9]*=L,b[10]*=L,d(w,b),v[0]=A,v[1]=M,v[2]=T,m},r.makeTable=function(m){let S="";for(let w=0;w<4;w++){for(let v=0;v<4;v++)S+=m[4*v+w].toString(),v<3&&(S+=" ");w<3&&(S+=`
`)}return S},r.determinant=_,r.isRotationAndTranslation=function(m,S){return(function(w,v){const A=w[0],M=w[1],T=w[2],R=w[3],P=w[4],L=w[5],O=w[6],I=w[7],N=w[8],k=w[9],U=w[10],F=w[11],j=w[15];return!(!(Gd(j,1,v)&&Gd(R,0,v)&&Gd(I,0,v)&&Gd(F,0,v))||!Gd(Math.abs(A*(L*U-O*k)-M*(P*U-O*N)+T*(P*k-L*N)),1,v))})(m,S!==void 0?S:jd)},r.isTranslationAndUniformScaling=function(m,S){return(function(w,v){const A=w[0];return Gd(w[1],0,v)&&Gd(w[2],0,v)&&Gd(w[3],0,v)&&Gd(w[4],0,v)&&Gd(w[5],A,v)&&Gd(w[6],0,v)&&Gd(w[7],0,v)&&Gd(w[8],0,v)&&Gd(w[9],0,v)&&Gd(w[10],A,v)&&Gd(w[11],0,v)&&Gd(w[15],1,v)})(m,S!==void 0?S:jd)},r.fromQuat=function(m,S){const w=S[0],v=S[1],A=S[2],M=S[3],T=w+w,R=v+v,P=A+A,L=w*T,O=v*T,I=v*R,N=A*T,k=A*R,U=A*P,F=M*T,j=M*R,H=M*P;return m[0]=1-I-U,m[1]=O+H,m[2]=N-j,m[3]=0,m[4]=O-H,m[5]=1-L-U,m[6]=k+F,m[7]=0,m[8]=N+j,m[9]=k-F,m[10]=1-L-I,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.fromEuler=function(m,S,w){const v=S[0],A=S[1],M=S[2],T=Math.cos(v),R=Math.sin(v),P=Math.cos(A),L=Math.sin(A),O=Math.cos(M),I=Math.sin(M);if(w==="XYZ"){const N=T*O,k=T*I,U=R*O,F=R*I;m[0]=P*O,m[4]=-P*I,m[8]=L,m[1]=k+U*L,m[5]=N-F*L,m[9]=-R*P,m[2]=F-N*L,m[6]=U+k*L,m[10]=T*P}else if(w==="YXZ"){const N=P*O,k=P*I,U=L*O,F=L*I;m[0]=N+F*R,m[4]=U*R-k,m[8]=T*L,m[1]=T*I,m[5]=T*O,m[9]=-R,m[2]=k*R-U,m[6]=F+N*R,m[10]=T*P}else if(w==="ZXY"){const N=P*O,k=P*I,U=L*O,F=L*I;m[0]=N-F*R,m[4]=-T*I,m[8]=U+k*R,m[1]=k+U*R,m[5]=T*O,m[9]=F-N*R,m[2]=-T*L,m[6]=R,m[10]=T*P}else if(w==="ZYX"){const N=T*O,k=T*I,U=R*O,F=R*I;m[0]=P*O,m[4]=U*L-k,m[8]=N*L+F,m[1]=P*I,m[5]=F*L+N,m[9]=k*L-U,m[2]=-L,m[6]=R*P,m[10]=T*P}else if(w==="YZX"){const N=T*P,k=T*L,U=R*P,F=R*L;m[0]=P*O,m[4]=F-N*I,m[8]=U*I+k,m[1]=I,m[5]=T*O,m[9]=-R*O,m[2]=-L*O,m[6]=k*I+U,m[10]=N-F*I}else if(w==="XZY"){const N=T*P,k=T*L,U=R*P,F=R*L;m[0]=P*O,m[4]=-I,m[8]=L*O,m[1]=N*I+F,m[5]=T*O,m[9]=k*I-U,m[2]=U*I-k,m[6]=R*O,m[10]=F*I+N}return m[3]=0,m[7]=0,m[11]=0,m[12]=0,m[13]=0,m[14]=0,m[15]=1,m},r.perspective=function(m,S,w,v,A,M,T){const R=2*M/(w-S),P=2*M/(v-A),L=(w+S)/(w-S),O=(v+A)/(v-A),I=-(T+M)/(T-M),N=-2*T*M/(T-M);return m[0]=R,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=P,m[6]=0,m[7]=0,m[8]=L,m[9]=O,m[10]=I,m[11]=-1,m[12]=0,m[13]=0,m[14]=N,m[15]=0,m},r.ortho=function(m,S,w,v,A,M,T){const R=1/(w-S),P=1/(v-A),L=1/(T-M),O=(w+S)*R,I=(v+A)*P,N=(T+M)*L;return m[0]=2*R,m[1]=0,m[2]=0,m[3]=0,m[4]=0,m[5]=2*P,m[6]=0,m[7]=0,m[8]=0,m[9]=0,m[10]=-2*L,m[11]=0,m[12]=-O,m[13]=-I,m[14]=-N,m[15]=1,m},r.lookAt=function(m,S,w,v){let A,M,T,R,P,L,O,I,N,k;const U=S[0],F=S[1],j=S[2],H=v[0],B=v[1],V=v[2],K=w[0],q=w[1],Te=w[2];return Math.abs(U-K)<jd&&Math.abs(F-q)<jd&&Math.abs(j-Te)<jd?n(m):(O=U-K,I=F-q,N=j-Te,k=1/Math.sqrt(O*O+I*I+N*N),O*=k,I*=k,N*=k,A=B*N-V*I,M=V*O-H*N,T=H*I-B*O,k=Math.sqrt(A*A+M*M+T*T),k?(k=1/k,A*=k,M*=k,T*=k):(A=0,M=0,T=0),R=I*T-N*M,P=N*A-O*T,L=O*M-I*A,k=Math.sqrt(R*R+P*P+L*L),k?(k=1/k,R*=k,P*=k,L*=k):(R=0,P=0,L=0),m[0]=A,m[1]=R,m[2]=O,m[3]=0,m[4]=M,m[5]=P,m[6]=I,m[7]=0,m[8]=T,m[9]=L,m[10]=N,m[11]=0,m[12]=-(A*U+M*F+T*j),m[13]=-(R*U+P*F+L*j),m[14]=-(O*U+I*F+N*j),m[15]=1,m)},r.targetTo=function(m,S,w,v){const A=S[0],M=S[1],T=S[2],R=v[0],P=v[1],L=v[2];let O=A-w[0],I=M-w[1],N=T-w[2],k=O*O+I*I+N*N;k>0&&(k=1/Math.sqrt(k),O*=k,I*=k,N*=k);let U=P*N-L*I,F=L*O-R*N,j=R*I-P*O;return k=U*U+F*F+j*j,k>0&&(k=1/Math.sqrt(k),U*=k,F*=k,j*=k),m[0]=U,m[1]=F,m[2]=j,m[3]=0,m[4]=I*j-N*F,m[5]=N*U-O*j,m[6]=O*F-I*U,m[7]=0,m[8]=O,m[9]=I,m[10]=N,m[11]=0,m[12]=A,m[13]=M,m[14]=T,m[15]=1,m},r.fromPermutation=function(m,S){i(m);for(let w=0;w<4;w++)a(m,w,S[w],1);return m},r.getMaxScaleOnAxis=function(m){const S=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],w=m[4]*m[4]+m[5]*m[5]+m[6]*m[6],v=m[8]*m[8]+m[9]*m[9]+m[10]*m[10];return Math.sqrt(Math.max(S,w,v))};const h=[1,0,0],f=[0,1,0],E=[0,0,1];r.rotX90=x(e(),Zd(90),h),r.rotX180=x(e(),Zd(180),h),r.rotY90=x(e(),Zd(90),f),r.rotY180=x(e(),Zd(180),f),r.rotY270=x(e(),Zd(270),f),r.rotZ90=x(e(),Zd(90),E),r.rotZ180=x(e(),Zd(180),E),r.rotXY90=g(e(),r.rotX90,r.rotY90),r.rotZY90=g(e(),r.rotZ90,r.rotY90),r.rotZYZ90=g(e(),r.rotZY90,r.rotZ90),r.rotZ90X180=g(e(),r.rotZ90,r.rotX180),r.rotY90Z180=g(e(),r.rotY90,r.rotZ180),r.id=t()})(Qd||(Qd={})),(function(r){function e(){const v=[.1,0,0,0,0,0,0,0,0];return v[0]=0,v}function t(){const v=e();return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=1,v[5]=0,v[6]=0,v[7]=0,v[8]=1,v}function n(v,A){return v[0]=A[0],v[1]=A[1],v[2]=A[2],v[3]=A[4],v[4]=A[5],v[5]=A[6],v[6]=A[8],v[7]=A[9],v[8]=A[10],v}r.zero=e,r.identity=t,r.setIdentity=function(v){return v[0]=1,v[1]=0,v[2]=0,v[3]=0,v[4]=1,v[5]=0,v[6]=0,v[7]=0,v[8]=1,v},r.toArray=function(v,A,M){return A[M+0]=v[0],A[M+1]=v[1],A[M+2]=v[2],A[M+3]=v[3],A[M+4]=v[4],A[M+5]=v[5],A[M+6]=v[6],A[M+7]=v[7],A[M+8]=v[8],A},r.fromArray=function(v,A,M){return v[0]=A[M+0],v[1]=A[M+1],v[2]=A[M+2],v[3]=A[M+3],v[4]=A[M+4],v[5]=A[M+5],v[6]=A[M+6],v[7]=A[M+7],v[8]=A[M+8],v},r.fromColumns=function(v,A,M,T){return v[0]=A[0],v[1]=A[1],v[2]=A[2],v[3]=M[0],v[4]=M[1],v[5]=M[2],v[6]=T[0],v[7]=T[1],v[8]=T[2],v},r.fromMat4=n;const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];r.fromEuler=function(v,A,M){return Qd.fromEuler(i,A,M),n(v,i)},r.create=function(v,A,M,T,R,P,L,O,I){const N=e();return N[0]=v,N[1]=A,N[2]=M,N[3]=T,N[4]=R,N[5]=P,N[6]=L,N[7]=O,N[8]=I,N};const s=t();function o(v,A,M){for(let T=0;T<9;T++)if(Math.abs(v[T]-A[T])>M)return!1;return!0}function a(v,A){return v[0]=A[0],v[1]=A[1],v[2]=A[2],v[3]=A[3],v[4]=A[4],v[5]=A[5],v[6]=A[6],v[7]=A[7],v[8]=A[8],v}function l(v,A){if(v===A){const M=A[1],T=A[2],R=A[5];v[1]=A[3],v[2]=A[6],v[3]=M,v[5]=A[7],v[6]=T,v[7]=R}else v[0]=A[0],v[1]=A[3],v[2]=A[6],v[3]=A[1],v[4]=A[4],v[5]=A[7],v[6]=A[2],v[7]=A[5],v[8]=A[8];return v}function d(v,A){const M=A[0],T=A[1],R=A[2],P=A[3],L=A[4],O=A[5],I=A[6],N=A[7],k=A[8],U=k*L-O*N,F=-k*P+O*I,j=N*P-L*I;let H=M*U+T*F+R*j;return H?(H=1/H,v[0]=U*H,v[1]=(-k*T+R*N)*H,v[2]=(O*T-R*L)*H,v[3]=F*H,v[4]=(k*M-R*I)*H,v[5]=(-O*M+R*P)*H,v[6]=j*H,v[7]=(-N*M+T*I)*H,v[8]=(L*M-T*P)*H,v):(console.warn("non-invertible matrix.",A),v)}function u(v){const A=v[0],M=v[1],T=v[2],R=v[3],P=v[4],L=v[5],O=v[6],I=v[7],N=v[8];return A*(N*P-L*I)+M*(-N*R+L*O)+T*(I*R-P*O)}function g(v){return v[0]+v[4]+v[8]}function x(v,A,M){return v[0]=A[0]-M[0],v[1]=A[1]-M[1],v[2]=A[2]-M[2],v[3]=A[3]-M[3],v[4]=A[4]-M[4],v[5]=A[5]-M[5],v[6]=A[6]-M[6],v[7]=A[7]-M[7],v[8]=A[8]-M[8],v}function y(v,A,M){return v[0]=A[0]*M,v[1]=A[1]*M,v[2]=A[2]*M,v[3]=A[3]*M,v[4]=A[4]*M,v[5]=A[5]*M,v[6]=A[6]*M,v[7]=A[7]*M,v[8]=A[8]*M,v}r.isIdentity=function(v,A){return o(v,s,A===void 0?jd:A)},r.hasNaN=function(v){for(let A=0;A<9;A++)if(isNaN(v[A]))return!0;return!1},r.clone=function(v){return a(e(),v)},r.areEqual=o,r.setValue=function(v,A,M,T){v[3*M+A]=T},r.getValue=function(v,A,M){return v[3*M+A]},r.copy=a,r.transpose=l,r.invert=d,r.symmtricFromUpper=function(v,A){return v===A?(v[3]=A[1],v[6]=A[2],v[7]=A[5]):(v[0]=A[0],v[1]=A[1],v[2]=A[2],v[3]=A[1],v[4]=A[4],v[5]=A[5],v[6]=A[2],v[7]=A[5],v[8]=A[8]),v},r.symmtricFromLower=function(v,A){return v===A?(v[1]=A[3],v[2]=A[6],v[5]=A[7]):(v[0]=A[0],v[1]=A[3],v[2]=A[6],v[3]=A[3],v[4]=A[4],v[5]=A[7],v[6]=A[6],v[7]=A[7],v[8]=A[8]),v},r.determinant=u,r.trace=g,r.sub=x,r.add=function(v,A,M){return v[0]=A[0]+M[0],v[1]=A[1]+M[1],v[2]=A[2]+M[2],v[3]=A[3]+M[3],v[4]=A[4]+M[4],v[5]=A[5]+M[5],v[6]=A[6]+M[6],v[7]=A[7]+M[7],v[8]=A[8]+M[8],v},r.mul=function(v,A,M){const T=A[0],R=A[1],P=A[2],L=A[3],O=A[4],I=A[5],N=A[6],k=A[7],U=A[8],F=M[0],j=M[1],H=M[2],B=M[3],V=M[4],K=M[5],q=M[6],Te=M[7],Fe=M[8];return v[0]=F*T+j*L+H*N,v[1]=F*R+j*O+H*k,v[2]=F*P+j*I+H*U,v[3]=B*T+V*L+K*N,v[4]=B*R+V*O+K*k,v[5]=B*P+V*I+K*U,v[6]=q*T+Te*L+Fe*N,v[7]=q*R+Te*O+Fe*k,v[8]=q*P+Te*I+Fe*U,v},r.subScalar=function(v,A,M){return v[0]=A[0]-M,v[1]=A[1]-M,v[2]=A[2]-M,v[3]=A[3]-M,v[4]=A[4]-M,v[5]=A[5]-M,v[6]=A[6]-M,v[7]=A[7]-M,v[8]=A[8]-M,v},r.addScalar=function(v,A,M){return v[0]=A[0]+M,v[1]=A[1]+M,v[2]=A[2]+M,v[3]=A[3]+M,v[4]=A[4]+M,v[5]=A[5]+M,v[6]=A[6]+M,v[7]=A[7]+M,v[8]=A[8]+M,v},r.mulScalar=y;const b=Math.PI/3,_=e();r.symmetricEigenvalues=function(v,A){const M=A[1]*A[1]+A[2]*A[2]+A[5]*A[5];if(M===0)v[0]=A[0],v[1]=A[4],v[2]=A[8];else{const T=g(A)/3,R=A[0]-T,P=A[4]-T,L=A[8]-T,O=R*R+P*P+L*L+2*M,I=Math.sqrt(O/6);y(_,r.Identity,T),x(_,A,_),y(_,_,1/I);const N=u(_)/2,k=N<=-1?b:N>=1?0:Math.acos(N)/3;v[0]=T+2*I*Math.cos(k),v[2]=T+2*I*Math.cos(k+2*b),v[1]=3*T-v[0]-v[2]}return v};const h=[.1,0,0],f=[.1,0,0],E=[.1,0,0],m=[.1,0,0],S=[.1,0,0],w=[.1,0,0];r.eigenvector=function(v,A,M){Yd.set(h,A[0]-M,A[1],A[2]),Yd.set(f,A[1],A[4]-M,A[5]),Yd.set(E,A[2],A[5],A[8]-M),Yd.cross(m,h,f),Yd.cross(S,h,E),Yd.cross(w,f,E);const T=Yd.dot(m,m),R=Yd.dot(S,S),P=Yd.dot(w,w);let L=T,O=0;return R>L&&(L=R,O=1),P>L&&(O=2),O===0?Yd.scale(v,m,1/Math.sqrt(T)):O===1?Yd.scale(v,S,1/Math.sqrt(R)):Yd.scale(v,w,1/Math.sqrt(P)),v},r.directionTransform=function(v,A){return n(v,A),d(v,v),l(v,v),v},r.Identity=t(),r.innerProduct=function(v,A){return v[0]*A[0]+v[1]*A[1]+v[2]*A[2]+v[3]*A[3]+v[4]*A[4]+v[5]*A[5]+v[6]*A[6]+v[7]*A[7]+v[8]*A[8]}})(Jd||(Jd={})),(function(r){function e(){const t=[.1,0];return t[0]=0,t}r.zero=e,r.clone=function(t){const n=e();return n[0]=t[0],n[1]=t[1],n},r.create=function(t,n){const i=e();return i[0]=t,i[1]=n,i},r.hasNaN=function(t){return isNaN(t[0])||isNaN(t[1])},r.toArray=function(t,n,i){return n[i+0]=t[0],n[i+1]=t[1],n},r.fromArray=function(t,n,i){return t[0]=n[i+0],t[1]=n[i+1],t},r.copy=function(t,n){return t[0]=n[0],t[1]=n[1],t},r.set=function(t,n,i){return t[0]=n,t[1]=i,t},r.add=function(t,n,i){return t[0]=n[0]+i[0],t[1]=n[1]+i[1],t},r.sub=function(t,n,i){return t[0]=n[0]-i[0],t[1]=n[1]-i[1],t},r.mul=function(t,n,i){return t[0]=n[0]*i[0],t[1]=n[1]*i[1],t},r.div=function(t,n,i){return t[0]=n[0]/i[0],t[1]=n[1]/i[1],t},r.scale=function(t,n,i){return t[0]=n[0]*i,t[1]=n[1]*i,t},r.round=function(t,n){return t[0]=Math.round(n[0]),t[1]=Math.round(n[1]),t},r.ceil=function(t,n){return t[0]=Math.ceil(n[0]),t[1]=Math.ceil(n[1]),t},r.floor=function(t,n){return t[0]=Math.floor(n[0]),t[1]=Math.floor(n[1]),t},r.distance=function(t,n){const i=n[0]-t[0],s=n[1]-t[1];return Math.sqrt(i*i+s*s)},r.squaredDistance=function(t,n){const i=n[0]-t[0],s=n[1]-t[1];return i*i+s*s},r.magnitude=function(t){const n=t[0],i=t[1];return Math.sqrt(n*n+i*i)},r.squaredMagnitude=function(t){const n=t[0],i=t[1];return n*n+i*i},r.inverse=function(t,n){return t[0]=1/n[0],t[1]=1/n[1],t},r.areEqual=function(t,n){return t[0]===n[0]&&t[1]===n[1]},r.toString=function(t,n){return`[${t[0].toPrecision(n)} ${t[1].toPrecision(n)}}]`}})(tm||(tm={})),(function(r){function e(){const n=[.1,0,0,0];return n[0]=0,n}function t(n,i){return n[0]=i.center[0],n[1]=i.center[1],n[2]=i.center[2],n[3]=i.radius,n}r.zero=e,r.clone=function(n){const i=e();return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i},r.create=function(n,i,s,o){const a=e();return a[0]=n,a[1]=i,a[2]=s,a[3]=o,a},r.fromSphere=t,r.ofSphere=function(n){return t(e(),n)},r.hasNaN=function(n){return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])},r.toArray=function(n,i,s){return i[s+0]=n[0],i[s+1]=n[1],i[s+2]=n[2],i[s+3]=n[3],i},r.fromArray=function(n,i,s){return n[0]=i[s+0],n[1]=i[s+1],n[2]=i[s+2],n[3]=i[s+3],n},r.toVec3Array=function(n,i,s){i[s+0]=n[0],i[s+1]=n[1],i[s+2]=n[2]},r.fromVec3Array=function(n,i,s){return n[0]=i[s+0],n[1]=i[s+1],n[2]=i[s+2],n[3]=0,n},r.copy=function(n,i){return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n},r.set=function(n,i,s,o,a){return n[0]=i,n[1]=s,n[2]=o,n[3]=a,n},r.add=function(n,i,s){return n[0]=i[0]+s[0],n[1]=i[1]+s[1],n[2]=i[2]+s[2],n[3]=i[3]+s[3],n},r.distance=function(n,i){const s=i[0]-n[0],o=i[1]-n[1],a=i[2]-n[2],l=i[3]-n[3];return Math.sqrt(s*s+o*o+a*a+l*l)},r.scale=function(n,i,s){return n[0]=i[0]*s,n[1]=i[1]*s,n[2]=i[2]*s,n[4]=i[4]*s,n},r.round=function(n,i){return n[0]=Math.round(i[0]),n[1]=Math.round(i[1]),n[2]=Math.round(i[2]),n[3]=Math.round(i[3]),n},r.ceil=function(n,i){return n[0]=Math.ceil(i[0]),n[1]=Math.ceil(i[1]),n[2]=Math.ceil(i[2]),n[3]=Math.ceil(i[3]),n},r.floor=function(n,i){return n[0]=Math.floor(i[0]),n[1]=Math.floor(i[1]),n[2]=Math.floor(i[2]),n[3]=Math.floor(i[3]),n},r.squaredDistance=function(n,i){const s=i[0]-n[0],o=i[1]-n[1],a=i[2]-n[2],l=i[3]-n[3];return s*s+o*o+a*a+l*l},r.norm=function(n){const i=n[0],s=n[1],o=n[2],a=n[3];return Math.sqrt(i*i+s*s+o*o+a*a)},r.squaredNorm=function(n){const i=n[0],s=n[1],o=n[2],a=n[3];return i*i+s*s+o*o+a*a},r.transformMat4=function(n,i,s){const o=i[0],a=i[1],l=i[2],d=i[3];return n[0]=s[0]*o+s[4]*a+s[8]*l+s[12]*d,n[1]=s[1]*o+s[5]*a+s[9]*l+s[13]*d,n[2]=s[2]*o+s[6]*a+s[10]*l+s[14]*d,n[3]=s[3]*o+s[7]*a+s[11]*l+s[15]*d,n},r.dot=function(n,i){return n[0]*i[0]+n[1]*i[1]+n[2]*i[2]+n[3]*i[3]},r.inverse=function(n,i){return n[0]=1/i[0],n[1]=1/i[1],n[2]=1/i[2],n[3]=1/i[3],n},r.exactEquals=function(n,i){return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]&&n[3]===i[3]},r.equals=function(n,i){const s=n[0],o=n[1],a=n[2],l=n[3],d=i[0],u=i[1],g=i[2],x=i[3];return Math.abs(s-d)<=jd*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(o-u)<=jd*Math.max(1,Math.abs(o),Math.abs(u))&&Math.abs(a-g)<=jd*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(l-x)<=jd*Math.max(1,Math.abs(l),Math.abs(x))},r.toString=function(n,i){return`[${n[0].toPrecision(i)} ${n[1].toPrecision(i)} ${n[2].toPrecision(i)}  ${n[3].toPrecision(i)}]`}})(em||(em={})),(function(r){function e(){const b=[.1,0,0,0];return b[0]=0,b}function t(){const b=e();return b[3]=1,b}function n(b,_,h){h*=.5;const f=Math.sin(h);return b[0]=f*_[0],b[1]=f*_[1],b[2]=f*_[2],b[3]=Math.cos(h),b}function i(b,_,h,f){const E=_[0],m=_[1],S=_[2],w=_[3];let v,A,M,T,R,P=h[0],L=h[1],O=h[2],I=h[3];return A=E*P+m*L+S*O+w*I,A<0&&(A=-A,P=-P,L=-L,O=-O,I=-I),1-A>1e-6?(v=Math.acos(A),M=Math.sin(v),T=Math.sin((1-f)*v)/M,R=Math.sin(f*v)/M):(T=1-f,R=f),b[0]=T*E+R*P,b[1]=T*m+R*L,b[2]=T*S+R*O,b[3]=T*w+R*I,b}function s(b,_){const h=_[0]+_[4]+_[8];let f;if(h>0)f=Math.sqrt(h+1),b[3]=.5*f,f=.5/f,b[0]=(_[5]-_[7])*f,b[1]=(_[6]-_[2])*f,b[2]=(_[1]-_[3])*f;else{let E=0;_[4]>_[0]&&(E=1),_[8]>_[3*E+E]&&(E=2);const m=(E+1)%3,S=(E+2)%3;f=Math.sqrt(_[3*E+E]-_[3*m+m]-_[3*S+S]+1),b[E]=.5*f,f=.5/f,b[3]=(_[3*m+S]-_[3*S+m])*f,b[m]=(_[3*m+E]+_[3*E+m])*f,b[S]=(_[3*S+E]+_[3*E+S])*f}return b}r.zero=e,r.identity=t,r.setIdentity=function(b){b[0]=0,b[1]=0,b[2]=0,b[3]=1},r.hasNaN=function(b){return isNaN(b[0])||isNaN(b[1])||isNaN(b[2])||isNaN(b[3])},r.create=function(b,_,h,f){const E=t();return E[0]=b,E[1]=_,E[2]=h,E[3]=f,E},r.setAxisAngle=n,r.getAxisAngle=function(b,_){const h=2*Math.acos(_[3]),f=Math.sin(h/2);return f!==0?(b[0]=_[0]/f,b[1]=_[1]/f,b[2]=_[2]/f):(b[0]=1,b[1]=0,b[2]=0),h},r.multiply=function(b,_,h){const f=_[0],E=_[1],m=_[2],S=_[3],w=h[0],v=h[1],A=h[2],M=h[3];return b[0]=f*M+S*w+E*A-m*v,b[1]=E*M+S*v+m*w-f*A,b[2]=m*M+S*A+f*v-E*w,b[3]=S*M-f*w-E*v-m*A,b},r.rotateX=function(b,_,h){h*=.5;const f=_[0],E=_[1],m=_[2],S=_[3],w=Math.sin(h),v=Math.cos(h);return b[0]=f*v+S*w,b[1]=E*v+m*w,b[2]=m*v-E*w,b[3]=S*v-f*w,b},r.rotateY=function(b,_,h){h*=.5;const f=_[0],E=_[1],m=_[2],S=_[3],w=Math.sin(h),v=Math.cos(h);return b[0]=f*v-m*w,b[1]=E*v+S*w,b[2]=m*v+f*w,b[3]=S*v-E*w,b},r.rotateZ=function(b,_,h){h*=.5;const f=_[0],E=_[1],m=_[2],S=_[3],w=Math.sin(h),v=Math.cos(h);return b[0]=f*v+E*w,b[1]=E*v-f*w,b[2]=m*v+S*w,b[3]=S*v-m*w,b},r.calculateW=function(b,_){const h=_[0],f=_[1],E=_[2];return b[0]=h,b[1]=f,b[2]=E,b[3]=Math.sqrt(Math.abs(1-h*h-f*f-E*E)),b},r.slerp=i,r.invert=function(b,_){const h=_[0],f=_[1],E=_[2],m=_[3],S=h*h+f*f+E*E+m*m,w=S?1/S:0;return b[0]=-h*w,b[1]=-f*w,b[2]=-E*w,b[3]=m*w,b},r.conjugate=function(b,_){return b[0]=-_[0],b[1]=-_[1],b[2]=-_[2],b[3]=_[3],b},r.dot=function(b,_){return b[0]*_[0]+b[1]*_[1]+b[2]*_[2]+b[3]*_[3]},r.fromMat3=s,r.fromEuler=function(b,_,h){const[f,E,m]=_,S=Math.cos(f/2),w=Math.cos(E/2),v=Math.cos(m/2),A=Math.sin(f/2),M=Math.sin(E/2),T=Math.sin(m/2);switch(h){case"XYZ":b[0]=A*w*v+S*M*T,b[1]=S*M*v-A*w*T,b[2]=S*w*T+A*M*v,b[3]=S*w*v-A*M*T;break;case"YXZ":b[0]=A*w*v+S*M*T,b[1]=S*M*v-A*w*T,b[2]=S*w*T-A*M*v,b[3]=S*w*v+A*M*T;break;case"ZXY":b[0]=A*w*v-S*M*T,b[1]=S*M*v+A*w*T,b[2]=S*w*T+A*M*v,b[3]=S*w*v-A*M*T;break;case"ZYX":b[0]=A*w*v-S*M*T,b[1]=S*M*v+A*w*T,b[2]=S*w*T-A*M*v,b[3]=S*w*v+A*M*T;break;case"YZX":b[0]=A*w*v+S*M*T,b[1]=S*M*v+A*w*T,b[2]=S*w*T-A*M*v,b[3]=S*w*v-A*M*T;break;case"XZY":b[0]=A*w*v-S*M*T,b[1]=S*M*v-A*w*T,b[2]=S*w*T+A*M*v,b[3]=S*w*v+A*M*T;break;default:im()}return b};const o=[0,0,0];function a(b,_){const h=_[0],f=_[1],E=_[2],m=_[3];let S=h*h+f*f+E*E+m*m;return S>0&&(S=1/Math.sqrt(S),b[0]=h*S,b[1]=f*S,b[2]=E*S,b[3]=m*S),b}r.fromUnitVec3=function(b,_,h){let f=Yd.dot(_,h)+1;return f<jd?(f=0,Math.abs(_[0])>Math.abs(_[2])?Yd.set(o,-_[1],_[0],0):Yd.set(o,0,-_[2],_[1])):Yd.cross(o,_,h),b[0]=o[0],b[1]=o[1],b[2]=o[2],b[3]=f,a(b,b),b},r.clone=function(b){const _=e();return _[0]=b[0],_[1]=b[1],_[2]=b[2],_[3]=b[3],_},r.toArray=function(b,_,h){return _[h+0]=b[0],_[h+1]=b[1],_[h+2]=b[2],_[h+3]=b[3],_},r.fromArray=function(b,_,h){return b[0]=_[h+0],b[1]=_[h+1],b[2]=_[h+2],b[3]=_[h+3],b},r.copy=function(b,_){return b[0]=_[0],b[1]=_[1],b[2]=_[2],b[3]=_[3],b},r.set=function(b,_,h,f,E){return b[0]=_,b[1]=h,b[2]=f,b[3]=E,b},r.exactEquals=function(b,_){return b[0]===_[0]&&b[1]===_[1]&&b[2]===_[2]&&b[3]===_[3]},r.equals=function(b,_){const h=b[0],f=b[1],E=b[2],m=b[3],S=_[0],w=_[1],v=_[2],A=_[3];return Math.abs(h-S)<=jd*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(f-w)<=jd*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(E-v)<=jd*Math.max(1,Math.abs(E),Math.abs(v))&&Math.abs(m-A)<=jd*Math.max(1,Math.abs(m),Math.abs(A))},r.add=function(b,_,h){return b[0]=_[0]+h[0],b[1]=_[1]+h[1],b[2]=_[2]+h[2],b[3]=_[3]+h[3],b},r.normalize=a;const l=[0,0,0],d=[1,0,0],u=[0,1,0];r.rotationTo=function(b,_,h){const f=Yd.dot(_,h);return f<-.999999?(Yd.cross(l,d,_),Yd.magnitude(l)<1e-6&&Yd.cross(l,u,_),Yd.normalize(l,l),n(b,l,Math.PI),b):f>.999999?(b[0]=0,b[1]=0,b[2]=0,b[3]=1,b):(Yd.cross(l,_,h),b[0]=l[0],b[1]=l[1],b[2]=l[2],b[3]=1+f,a(b,b))};const g=e(),x=e();r.sqlerp=function(b,_,h,f,E,m){return i(g,_,E,m),i(x,h,f,m),i(b,g,x,2*m*(1-m)),b};const y=[0,0,0,0,0,0,0,0,0];r.setAxes=function(b,_,h,f){return y[0]=h[0],y[3]=h[1],y[6]=h[2],y[1]=f[0],y[4]=f[1],y[7]=f[2],y[2]=-_[0],y[5]=-_[1],y[8]=-_[2],a(b,s(b,y))},r.toString=function(b,_){return`[${b[0].toPrecision(_)} ${b[1].toPrecision(_)} ${b[2].toPrecision(_)}  ${b[3].toPrecision(_)}]`},r.Identity=t()})(rm||(rm={})),(function(r){function e(o,a,l){const d=(function(_,h,f){const E=[];for(let S=0;S<h.length;S++)E[S]=h[h.length-S-1];const m=[1];for(let S=1;S<_.length;S++)m[S]=_[E[S-1]];return{dimensions:_,axisOrderFastToSlow:E,axisOrderSlowToFast:h,accessDimensions:m,defaultCtor:f||Float64Array}})(o,a,l),{get:u,set:g,add:x,dataOffset:y,getCoords:b}=t(d);return{rank:o.length,dimensions:o,axisOrderSlowToFast:a,create:n(d),get:u,set:g,add:x,dataOffset:y,getCoords:b}}function t(o){const{dimensions:a,axisOrderFastToSlow:l}=o;switch(a.length){case 1:return{get:(d,u)=>d[u],set:(d,u,g)=>d[u]=g,add:(d,u,g)=>d[u]+=g,dataOffset:d=>d,getCoords:(d,u)=>(u[0]=d,u)};case 2:if(l[0]===0&&l[1]===1){const d=a[0];return{get:(u,g,x)=>u[x*d+g],set:(u,g,x,y)=>u[x*d+g]=y,add:(u,g,x,y)=>u[x*d+g]+=y,dataOffset:(u,g)=>g*d+u,getCoords:(u,g)=>(g[0]=u%d,g[1]=Math.floor(u/d),g)}}if(l[0]===1&&l[1]===0){const d=a[1];return{get:(u,g,x)=>u[g*d+x],set:(u,g,x,y)=>u[g*d+x]=y,add:(u,g,x,y)=>u[g*d+x]+=y,dataOffset:(u,g)=>u*d+g,getCoords:(u,g)=>(g[0]=Math.floor(u/d),g[1]=u%d,g)}}throw new Error("bad axis order");case 3:if(l[0]===0&&l[1]===1&&l[2]===2){const d=a[0],u=a[1],g=d*u;return{get:(x,y,b,_)=>x[y+b*d+_*g],set:(x,y,b,_,h)=>x[y+b*d+_*g]=h,add:(x,y,b,_,h)=>x[y+b*d+_*g]+=h,dataOffset:(x,y,b)=>x+y*d+b*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=x%d,y[1]=b%u,y[2]=Math.floor(b/u),y}}}if(l[0]===0&&l[1]===2&&l[2]===1){const d=a[0],u=a[2],g=d*u;return{get:(x,y,b,_)=>x[y+_*d+b*g],set:(x,y,b,_,h)=>x[y+_*d+b*g]=h,add:(x,y,b,_,h)=>x[y+_*d+b*g]+=h,dataOffset:(x,y,b)=>x+b*d+y*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=x%d,y[1]=Math.floor(b/u),y[2]=b%u,y}}}if(l[0]===1&&l[1]===0&&l[2]===2){const d=a[1],u=a[0],g=d*u;return{get:(x,y,b,_)=>x[b+y*d+_*g],set:(x,y,b,_,h)=>x[b+y*d+_*g]=h,add:(x,y,b,_,h)=>x[b+y*d+_*g]+=h,dataOffset:(x,y,b)=>y+x*d+b*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=b%u,y[1]=x%d,y[2]=Math.floor(b/u),y}}}if(l[0]===1&&l[1]===2&&l[2]===0){const d=a[1],u=a[2],g=d*u;return{get:(x,y,b,_)=>x[b+_*d+y*g],set:(x,y,b,_,h)=>x[b+_*d+y*g]=h,add:(x,y,b,_,h)=>x[b+_*d+y*g]+=h,dataOffset:(x,y,b)=>y+b*d+x*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=Math.floor(b/u),y[1]=x%d,y[2]=b%u,y}}}if(l[0]===2&&l[1]===0&&l[2]===1){const d=a[2],u=a[0],g=d*u;return{get:(x,y,b,_)=>x[_+y*d+b*g],set:(x,y,b,_,h)=>x[_+y*d+b*g]=h,add:(x,y,b,_,h)=>x[_+y*d+b*g]+=h,dataOffset:(x,y,b)=>b+x*d+y*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=b%u,y[1]=Math.floor(b/u),y[2]=x%d,y}}}if(l[0]===2&&l[1]===1&&l[2]===0){const d=a[2],u=a[1],g=d*u;return{get:(x,y,b,_)=>x[_+b*d+y*g],set:(x,y,b,_,h)=>x[_+b*d+y*g]=h,add:(x,y,b,_,h)=>x[_+b*d+y*g]+=h,dataOffset:(x,y,b)=>b+y*d+x*g,getCoords:(x,y)=>{const b=Math.floor(x/d);return y[0]=Math.floor(b/u),y[1]=b%u,y[2]=x%d,y}}}throw new Error("bad axis order");default:return{get:(d,...u)=>d[i(o,u)],set:(d,...u)=>d[i(o,u)]=u[u.length-1],add:(d,...u)=>d[i(o,u)]+=u[u.length-1],dataOffset:(...d)=>i(o,d),getCoords:(d,u)=>(function(g,x,y){const{dimensions:b,axisOrderFastToSlow:_}=g,h=b.length;let f=x;for(let E=0;E<h;E++){const m=b[_[E]];y[_[E]]=f%m,f=Math.floor(f/m)}return y[_[h+1]]=f,y})(o,d,u)}}}function n(o){const{dimensions:a}=o;let l=1;for(let d=0,u=a.length;d<u;d++)l*=a[d];return d=>new(d||o.defaultCtor)(l)}function i(o,a){const{accessDimensions:l,axisOrderFastToSlow:d}=o,u=l.length-1;let g=l[u]*a[d[u]];for(let x=u-1;x>=0;x--)g=(g+a[d[x]])*l[x];return g}function s(o,a){const l=[];for(let d=0;d<o.length;d++)l[d]=o[a[d]];return l}r.create=function(o,a){return{space:o,data:a}},r.Space=e,r.Data1=function(o){return o},r.Vector=function(o,a){return e([o],[0],a)},r.ColumnMajorMatrix=function(o,a,l){return e([o,a],[1,0],l)},r.RowMajorMatrix=function(o,a,l){return e([o,a],[0,1],l)},r.toMat4=function(o,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const d=Math.min(4,a.dimensions[0]),u=Math.min(4,a.dimensions[1]);for(let g=0;g<d;g++)for(let x=0;x<u;x++)Qd.setValue(o,g,x,a.get(l,g,x));return o},r.toMat3=function(o,a,l){if(a.rank!==2)throw new Error("Invalid tensor rank");const d=Math.min(3,a.dimensions[0]),u=Math.min(3,a.dimensions[1]);for(let g=0;g<d;g++)for(let x=0;x<u;x++)Jd.setValue(o,g,x,a.get(l,g,x));return o},r.toVec3=function(o,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const d=Math.min(3,a.dimensions[0]);for(let u=0;u<d;u++)o[u]=l[u];return o},r.toVec4=function(o,a,l){if(a.rank!==1)throw new Error("Invalid tensor rank");const d=Math.min(4,a.dimensions[0]);for(let u=0;u<d;u++)o[u]=l[u];return o},r.areEqualExact=function(o,a){const l=o.length;if(l!==a.length)return!1;for(let d=0;d<l;d++)if(o[d]!==a[d])return!1;return!0},r.invertAxisOrder=function(o){const a=[];for(let l=0;l<o.length;l++)a[l]=o[o.length-l-1];return a},r.convertToCanonicalAxisIndicesFastToSlow=function(o){const a=new Int32Array(o.length);for(let l=0;l<o.length;l++)a[o[l]]=l;return l=>s(l,a)},r.convertToCanonicalAxisIndicesSlowToFast=function(o){const a=new Int32Array(o.length);for(let l=0;l<o.length;l++)a[o[o.length-l-1]]=l;return l=>s(l,a)}})(nm||(nm={})),(function(r){let e;function t(i,s){return um(s.T,i,s,1)}function n(i){return dm(i)}(function(i){function s(o,a=i.float){return{"@type":"tensor",T:o.create(),space:o,valueType:"tensor",baseType:a}}i.str={"@type":"str",T:"",valueType:"str"},i.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},i.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},i.int={"@type":"int",T:0,valueType:"int"},i.coord={"@type":"coord",T:0,valueType:"float"},i.float={"@type":"float",T:0,valueType:"float"},i.Str=function(o){var a;return{"@type":"str",T:(a=o?.defaultValue)!==null&&a!==void 0?a:"",transform:o?.transform,valueType:"str"}},i.Int=function(o=0){return{"@type":"int",T:o,valueType:"int"}},i.Float=function(o=0){return{"@type":"float",T:o,valueType:"float"}},i.Tensor=s,i.Vector=function(o,a=i.float){return s(nm.Vector(o,a["@type"]==="int"?Int32Array:Float64Array),a)},i.Matrix=function(o,a,l=i.float){return s(nm.ColumnMajorMatrix(o,a,l["@type"]==="int"?Int32Array:Float64Array),l)},i.Aliased=function(o){return o},i.List=function(o,a,l=[]){return{"@type":"list",T:l,separator:o,itemParse:a,valueType:"list"}}})(e=r.Schema||(r.Schema={})),r.is=function(i){return!!i&&!!i.schema&&!!i.value},r.ValueKind={Present:0,NotPresent:1,Unknown:2},r.Undefined=t,r.ofConst=function(i,s,o){return um(i,s,o,0)},r.ofLambda=n,r.range=function(i,s){return n({value:o=>o+i,rowCount:Math.max(s-i+1,0),schema:e.int})},r.ofArray=function(i){return mm(i)},r.ofIntArray=function(i){return mm({array:i,schema:e.int})},r.ofFloatArray=function(i){return mm({array:i,schema:e.float})},r.ofStringArray=function(i){return mm({array:i,schema:e.str})},r.ofStringAliasArray=function(i){return mm({array:i,schema:e.Aliased(e.str)})},r.ofStringListArray=function(i,s=","){return mm({array:i,schema:e.List(s,(o=>o))})},r.ofIntTokens=function(i){const{count:s,data:o,indices:a}=i;return dm({value:l=>cm(o,a[2*l],a[2*l+1])||0,rowCount:s,schema:e.int})},r.ofFloatTokens=function(i){const{count:s,data:o,indices:a}=i;return dm({value:l=>hm(o,a[2*l],a[2*l+1])||0,rowCount:s,schema:e.float})},r.ofStringTokens=function(i){const{count:s,data:o,indices:a}=i;return dm({value:l=>{const d=o.substring(a[2*l],a[2*l+1]);return d==="."||d==="?"?"":d},rowCount:s,schema:e.str})},r.window=function(i,s,o){return fm(i,s,o)},r.view=function(i,s,o=!0){return pm(i,s,o)},r.createFirstIndexMap=function(i){return(function(s){const o=new Map;for(let a=0,l=s.rowCount;a<l;a++){const d=s.value(a);o.has(d)||o.set(s.value(a),a)}return o})(i)},r.createIndexer=function(i){return(function(s){const o=new Map;for(let a=0,l=s.rowCount;a<l;a++){const d=s.value(a);o.has(d)||o.set(s.value(a),a)}return a=>o.has(a)?o.get(a):-1})(i)},r.mapToArray=function(i,s,o){return(function(a,l,d){const u=new d(a.rowCount);for(let g=0,x=a.rowCount;g<x;g++)u[g]=l(a.value(g));return u})(i,s,o||Array)},r.areEqual=function(i,s){return(function(o,a){return o===a||o.rowCount===a.rowCount&&o.isDefined===a.isDefined&&o.schema.valueType===a.schema.valueType&&(o.__array&&a.__array?(function(l,d){const u=l.__array,g=d.__array;for(let x=0,y=l.rowCount;x<y;x++)if(u[x]!==g[x])return!1;return!0})(o,a):(function(l,d){const u=l.value,g=d.value;for(let x=0,y=l.rowCount;x<y;x++)if(u(x)!==g(x))return!1;return!0})(o,a))})(i,s)},r.indicesOf=function(i,s){return(function(o,a){const l=[],d=o.value;for(let u=0,g=o.rowCount;u<g;u++)a(d(u))&&(l[l.length]=u);return l})(i,s)},r.asArrayColumn=function(i,s){return i.__array?i:i.isDefined?mm({array:i.toArray({array:s}),schema:i.schema,valueKind:i.valueKind}):t(i.rowCount,i.schema)},r.copyToArray=function(i,s,o=0){if(!i.isDefined)return;const a=i.__array;if(a)for(let l=0,d=a.length;l<d;l++)s[o+l]=a[l];else for(let l=0,d=i.rowCount;l<d;l++)s[o+l]=i.value(l)},r.isIdentity=function(i){for(let s=0,o=i.rowCount;s<o;s++)if(s!==i.value(s))return!1;return!0}})(sm||(sm={})),(function(r){r.create=function(e){return e},r.has=function(e,t){return!!(e&t)},r.hasAll=function(e,t){return!!t&&(e&t)===t}})(om||(om={})),(function(r){r.create=function(i=512){return{current:[],offset:0,capacity:i,chunks:[]}},r.getString=function(i){return i.chunks.length?(i.offset>0&&(i.chunks[i.chunks.length]=i.current.length===i.offset?i.current.join(""):i.current.slice(0,i.offset).join("")),i.chunks.join("")):i.current.length===i.offset?i.current.join(""):i.current.splice(0,i.offset).join("")},r.getSize=function(i){let s=0;for(const o of i.chunks)s+=o.length;for(let o=0;o<i.offset;o++)s+=i.current[o].length;return s},r.getChunks=function(i){return i.offset>0&&(i.current.length===i.offset?i.chunks[i.chunks.length]=i.current.join(""):i.chunks[i.chunks.length]=i.current.slice(0,i.offset).join(""),i.offset=0),i.chunks};const e=[];function t(i,s){s>0&&n(i,e[s])}function n(i,s){i.offset===i.capacity&&(i.chunks[i.chunks.length]=i.current.join(""),i.offset=0),i.current[i.offset++]=s}(function(){let i="";for(let s=0;s<512;s++)e[s]=i,i+=" "})(),r.newline=function(i){n(i,`
`)},r.whitespace=t,r.whitespace1=function(i){n(i," ")},r.write=function(i,s){s&&(i.offset===i.capacity&&(i.chunks[i.chunks.length]=i.current.join(""),i.offset=0),i.current[i.offset++]=s)},r.writeSafe=n,r.writePadLeft=function(i,s,o){if(!s)return void t(i,o);t(i,o-s.length),n(i,s)},r.writePadRight=function(i,s,o){if(!s)return void t(i,o);const a=o-s.length;n(i,s),t(i,a)},r.writeInteger=function(i,s){n(i,""+s)},r.writeIntegerAndSpace=function(i,s){n(i,s+" ")},r.writeIntegerPadLeft=function(i,s,o){const a=""+s;t(i,o-a.length),n(i,a)},r.writeIntegerPadRight=function(i,s,o){const a=""+s,l=o-a.length;n(i,a),t(i,l)},r.writeFloat=function(i,s,o){n(i,""+Math.round(o*s)/o)},r.writeFloatPadLeft=function(i,s,o,a){const l=""+Math.round(o*s)/o;t(i,a-l.length),n(i,l)},r.writeFloatPadRight=function(i,s,o,a){const l=""+Math.round(o*s)/o,d=a-l.length;n(i,l),t(i,d)}})(am||(am={}));const Pm=(function(){if(typeof window<"u"&&window.performance){const r=window.performance;return()=>r.now()}return typeof process<"u"&&process.hrtime!=="undefined"&&typeof process.hrtime=="function"?()=>{const r=process.hrtime();return 1e3*r[0]+r[1]/1e6}:Date.now?()=>Date.now():()=>+new Date})();var Im,km,Mm;function Tm(r,e){return r-e}function Dm(r=0,e=Number.MAX_SAFE_INTEGER){let t=r;return()=>{const n=t;return t=(t+1)%e,n}}(function(r){const e=typeof btoa<"u"?btoa:n=>Buffer.from(n).toString("base64"),t=[];r.create22=function(){let n=+new Date+Pm();for(let i=0;i<16;i++)t[i]=String.fromCharCode((n+255*Math.random())%255|0),n=Math.floor(n/255);return e(t.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},r.createv4=function(){let n=+new Date+Pm();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){const s=(n+16*Math.random())%16|0;return n=Math.floor(n/16),(i==="x"?s:3&s|8).toString(16)}))},r.is=function(n){return typeof n=="string"}})(Im||(Im={})),(function(r){class e{has(d){return!1}forEach(d,u){return u}constructor(){this.size=0}}class t{has(d){return d===this.idx}forEach(d,u){return d(this.idx,u),u}constructor(d){this.idx=d,this.size=1}}class n{has(d){return d<this.length&&!!this.mask[d]}_forEach(d,u){for(let g=0;g<this.length;g++)this.mask[g]&&d(g,u)}forEach(d,u){return this._forEach(d,u),u}constructor(d,u){this.mask=d,this.size=u,this.length=d.length}}class i{has(d){return!0}_forEach(d,u){for(let g=0;g<this.size;g++)d(g,u)}forEach(d,u){return this._forEach(d,u),u}constructor(d){this.size=d}}class s{has(d){return this.set.has(d)}_forEach(d,u){for(const g of this.flatten())d(g,u)}flatten(){if(this._flat)return this._flat;const d=new Int32Array(this.size);let u=0;return this.set.forEach((g=>d[u++]=g)),(function(g){Array.prototype.sort.call(g,Tm)})(d),this._flat=d,this._flat}forEach(d,u){return this._forEach(d,u),u}constructor(d){this.set=d,this._flat=void 0,this.size=d.size}}function o(l){return new s(l)}function a(l,d){return new n(l,d)}r.always=function(l){return new i(l)},r.never=new e,r.ofSet=o,r.singleton=function(l){return new t(l)},r.ofUniqueIndices=function(l){const d=l.length;if(d===0)return new e;if(d===1)return new t(l[0]);let u=0;for(const x of l)x>u&&(u=x);if(d===u)return new i(d);if(d/u<1/12){const x=new Set;for(const y of l)x.add(y);return new s(x)}const g=new Int8Array(u+1);for(const x of l)g[x]=1;return new n(g,l.length)},r.ofMask=a,r.hasAny=function(l,d){for(const u of d)if(l.has(u))return!0;return!1},r.complement=function(l,d){let u=0,g=0;if(d.forEach((x=>{l.has(x)||(u++,x>g&&(g=x))})),u/g<1/12){const x=new Set;return d.forEach((y=>{l.has(y)||x.add(y)})),o(x)}{const x=new Uint8Array(g+1);return d.forEach((y=>{l.has(y)||(x[y]=1)})),a(x,u)}}})(km||(km={})),(function(r){r.create=function(e){return{ref:e}},r.set=function(e,t){return e.ref=t,e}})(Mm||(Mm={}));const Bm=Dm(0,2147483647);var Fm,Em,$m,Om,Rm;function Lm(r){const{data:e,indices:t}=r;return function(n,i){const s=t[2*n],o=t[2*i],a=t[2*n+1]-s;if(a!==t[2*i+1]-o)return!1;for(let l=0;l<a;l++)if(e.charCodeAt(l+s)!==e.charCodeAt(l+o))return!1;return!0}}function Nm(r,e){return{name:e,blocks:r}}function zm(r,e,t,n=[]){return{categoryNames:r,header:t,categories:e,saveFrames:n,getField(i){const[s,o]=i.split(".");return e[s].getField(o||"")}}}function Um(r,e,t,n){return{rowCount:e,name:r,fieldNames:[...t],getField:i=>n[i]}}(function(r){r.create=function(e,t){return{id:Bm(),version:0,value:e,metadata:t}},r.withValue=function(e,t){return{id:e.id,version:e.version+1,value:t,metadata:e.metadata}}})(Fm||(Fm={})),(function(r){function e(t,n){return Mm.set(t,Fm.withValue(t.ref,n))}r.create=function(t,n){return Mm.create(Fm.create(t,n))},r.update=e,r.set=function(t,n){return Mm.set(t,n)},r.updateIfChanged=function(t,n){return t.ref.value!==n?e(t,n):t}})(Em||(Em={})),(function(r){function e(n,i,s){const o=Object.create(null),a=Object.keys(i);o._rowCount=s.length,o._columns=a,o._schema=i;for(const l of a)o[l]=sm.view(n[l],s);return o}function t(n,i){const s=Object.create(null),{_columns:o}=n;for(let a=0;a<o.length;a++){const l=o[a];s[l]=n[l].value(i)}return s}r.is=function(n){return n&&typeof n._rowCount=="number"&&!!n._columns&&!!n._schema},r.pickColumns=function(n,i,s={}){const o=Object.create(null),a=Object.keys(n);o._rowCount=i._rowCount,o._columns=a,o._schema=n;for(const l of a)if(i[l])o[l]=i[l];else{if(!s[l])throw Error(`Cannot find column '${l}'.`);o[l]=s[l]}return o},r.ofColumns=function(n,i){const s=Object.keys(i);return{_rowCount:i[s[0]].rowCount,_columns:s,_schema:n,...i}},r.ofPartialColumns=function(n,i,s){const o=Object.create(null),a=Object.keys(n);o._rowCount=s,o._columns=a,o._schema=n;for(const l of a)o[l]=l in i?i[l]:sm.Undefined(s,n[l]);return o},r.ofUndefinedColumns=function(n,i){const s=Object.create(null),o=Object.keys(n);s._rowCount=i,s._columns=o,s._schema=n;for(const a of o)s[a]=sm.Undefined(i,n[a]);return s},r.ofRows=function(n,i){const s=Object.create(null),o=i.length,a=Object.keys(n);s._rowCount=o,s._columns=a,s._schema=n;for(const l of a)s[l]=sm.ofLambda({rowCount:o,schema:n[l],value:d=>i[d][l],valueKind:d=>i[d][l]===void 0?1:0});return s},r.ofArrays=function(n,i){var s;const o=Object.create(null),a=Object.keys(n);o._rowCount=0,o._columns=a,o._schema=n;for(const l of a)i[l]!==void 0?(o[l]=sm.ofArray({array:i[l],schema:n[l]}),o._rowCount=(s=i[l])===null||s===void 0?void 0:s.length):o[l]=sm.Undefined(o._rowCount,n[l]);return o},r.view=e,r.pick=function(n,i,s){const o=[];for(let a=0,l=n._rowCount;a<l;++a)s(a)&&o.push(a);return e(n,i,o)},r.window=function(n,i,s,o){if(s===0&&o===n._rowCount)return n;const a=Object.create(null),l=Object.keys(i);a._rowCount=o-s,a._columns=l,a._schema=i;for(const d of l)a[d]=sm.window(n[d],s,o);return a},r.concat=function(n,i){const s=Object.create(null),o=Object.keys(i);s._rowCount=0;for(const d of n)s._rowCount+=d._rowCount;const a={};for(const d of o)a[d]=new Array(s._rowCount);s._columns=o,s._schema=i;let l=0;for(const d of n){for(const u of o)sm.copyToArray(d[u],a[u],l);l+=d._rowCount}for(const d of o)s[d]=sm.ofArray({array:a[d],schema:i[d]});return s},r.columnToArray=function(n,i,s){n[i]=sm.asArrayColumn(n[i],s)},r.sort=function(n,i){const s=new Int32Array(n._rowCount);for(let l=0,d=s.length;l<d;l++)s[l]=l;Cm(s,((l,d,u)=>i(d,u)));let o=!0;for(let l=0,d=s.length;l<d;l++)if(s[l]!==l){o=!1;break}if(o)return n;const a=Object.create(null);a._rowCount=n._rowCount,a._columns=n._columns,a._schema=n._schema;for(const l of n._columns)a[l]=sm.view(n[l],s,!1);return a},r.areEqual=function(n,i){if(n._rowCount!==i._rowCount||n._columns.length!==i._columns.length)return!1;for(const s of n._columns)if(!i[s])return!1;for(const s of n._columns)if(!sm.areEqual(n[s],i[s]))return!1;return!0},r.getRow=t,r.pickRow=function(n,i){for(let s=0,o=n._rowCount;s<o;++s)if(i(s))return t(n,s)},r.getRows=function(n){const i=[],{_rowCount:s}=n;for(let o=0;o<s;o++)i[o]=t(n,o);return i},r.toArrays=function(n){const i={},{_columns:s}=n;for(let o=0;o<s.length;o++){const a=s[o];i[a]=n[a].toArray()}return i},r.formatToString=function(n){const i=am.create(),{_columns:s,_rowCount:o}=n;let a=1;am.write(i,"|");for(let l=0;l<s.length;l++)am.write(i,s[l]),am.write(i,"|"),a+=s[l].length+1;am.newline(i),am.write(i,new Array(a+1).join("-")),am.newline(i);for(let l=0;l<o;l++){am.write(i,"|");for(let d=0;d<s.length;d++){const u=n[s[d]];u.valueKind(l)===0?(am.write(i,u.value(l)),am.write(i,"|")):am.write(i,".|")}am.newline(i)}return am.getString(i)}})($m||($m={})),(function(r){r.ofTables=function(e,t,n){const i=Object.keys(n),s=Object.create(null),o=[];s._name=e,s._tableNames=o,s._schema=t;for(const a of i)$m.is(n[a])&&(s[a]=n[a],o[o.length]=a);return s},r.getTablesAsRows=function(e){const t={};for(const n of e._tableNames)t[n]=$m.getRows(e[n]);return t}})(Om||(Om={})),(function(r){function e(t,n){const i=Object.keys(n);return{rowCount:i.length>0?n[i[0]].rowCount:0,name:t,fieldNames:i,getField:s=>n[s]}}r.empty=function(t){return{rowCount:0,name:t,fieldNames:[],getField(n){}}},r.ofFields=e,r.ofTable=function(t,n){const i={};for(const s of n._columns)i[s]=Rm.ofColumn(n[s]);return e(t,i)}})(Um||(Um={})),(function(r){function e(n){const i=n.length,s=l=>{const d=n[l];return d&&d!=="."&&d!=="?"?d:""},o=l=>{const d=n[l];return cm(d,0,d.length)||0},a=l=>{const d=n[l];return hm(d,0,d.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:i,str:s,int:o,float:a,valueKind:l=>{const d=n[l],u=d.length;if(u>1)return 0;if(u===0)return 1;const g=d.charCodeAt(0);return g===46?1:g===63?2:0},areValuesEqual:(l,d)=>n[l]===n[d],toStringArray:l=>l?zd(i,s,l):n,toIntArray:l=>zd(i,o,l),toFloatArray:l=>zd(i,a,l)}}function t(n){const{rowCount:i,valueKind:s,areValuesEqual:o,isDefined:a}=n;let l,d,u;switch(n.schema.valueType){case"float":case"int":l=x=>""+n.value(x),d=n.value,u=n.value;break;case"str":l=n.value,d=x=>{const y=n.value(x);return cm(y,0,y.length)||0},u=x=>{const y=n.value(x);return hm(y,0,y.length)||0};break;case"list":const{separator:g}=n.schema;l=x=>n.value(x).join(g),d=x=>NaN,u=x=>NaN;break;default:throw new Error(`unsupported valueType '${n.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:a,rowCount:i,str:l,int:d,float:u,valueKind:s,areValuesEqual:o,toStringArray:g=>zd(i,l,g),toIntArray:g=>zd(i,d,g),toFloatArray:g=>zd(i,u,g)}}r.ofString=function(n){return e([n])},r.ofStrings=e,r.ofNumbers=function(n){const i=n.length,s=l=>""+n[l],o=l=>n[l],a=l=>!l||l.array&&n instanceof l.array?n:zd(i,o,l);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:i,str:s,int:o,float:o,valueKind:l=>0,areValuesEqual:(l,d)=>n[l]===n[d],toStringArray:l=>zd(i,s,l),toIntArray:a,toFloatArray:a}},r.ofTokens=function(n){const{data:i,indices:s,count:o}=n,a=u=>{const g=i.substring(s[2*u],s[2*u+1]);return g==="."||g==="?"?"":g},l=u=>cm(i,s[2*u],s[2*u+1])||0,d=u=>hm(i,s[2*u],s[2*u+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:o,str:a,int:l,float:d,valueKind:u=>{const g=s[2*u],x=s[2*u+1]-g;if(x>1)return 0;if(x===0)return 1;const y=i.charCodeAt(g);return y===46?1:y===63?2:0},areValuesEqual:Lm(n),toStringArray:u=>zd(o,a,u),toIntArray:u=>zd(o,l,u),toFloatArray:u=>zd(o,d,u)}},r.ofColumn=t,r.ofUndefined=function(n,i){return t(sm.Undefined(n,i))}})(Rm||(Rm={}));const Vm=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(r,...e)=>window.setImmediate(r,...e),clearImmediate:r=>window.clearImmediate(r)}:{setImmediate,clearImmediate}:(function(){const r=(function(){const a=typeof window<"u"&&window,l=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return a||typeof global<"u"&&global||l})(),e={},t=typeof document<"u"?document:void 0;let n,i=1;function s(a){delete e[a]}function o(a){const l=e[a];s(a),(function(d){const u=d.callback,g=d.args;switch(g.length){case 0:u();break;case 1:u(g[0]);break;case 2:u(g[0],g[1]);break;case 3:u(g[0],g[1],g[2]);break;default:u.apply(void 0,g)}})(l)}return typeof process<"u"&&{}.toString.call(process)==="[object process]"?n=function(a){process.nextTick((function(){o(a)}))}:(function(){if(r&&r.postMessage&&!r.importScripts){let a=!0;const l=r.onmessage;return r.onmessage=function(){a=!1},r.postMessage("","*"),r.onmessage=l,a}})()?(function(){const a="setImmediate$"+Math.random()+"$",l=function(d){d.source===r&&typeof d.data=="string"&&d.data.indexOf(a)===0&&o(+d.data.slice(a.length))};window.addEventListener?window.addEventListener("message",l,!1):window.attachEvent("onmessage",l),n=function(d){window.postMessage(a+d,"*")}})():typeof MessageChannel<"u"?(function(){const a=new MessageChannel;a.port1.onmessage=function(l){o(l.data)},n=function(l){a.port2.postMessage(l)}})():t&&"onreadystatechange"in t.createElement("script")?(function(){const a=t.documentElement;n=function(l){let d=t.createElement("script");d.onreadystatechange=function(){o(l),d.onreadystatechange=null,a.removeChild(d),d=null},a.appendChild(d)}})():n=function(a){setTimeout(o,0,a)},{setImmediate:function(a,...l){typeof a!="function"&&(a=new Function(""+a));const d={callback:a,args:l};return e[i]=d,n(i),i++},clearImmediate:s}})();function jm(r){Vm.setImmediate(r)}const Gm={setImmediate:Vm.setImmediate,clearImmediate:Vm.clearImmediate,immediatePromise:()=>new Promise(jm),delay:(r,e=void 0)=>new Promise((t=>setTimeout(t,r,e)))};(function(){try{return!0}catch{return!1}})(),(function(){try{const r=define_process_env_default.DEBUG;return r==="*"||r==="molstar"}catch{return!1}})();var qm;function Wm(r,e,t=250){const n=(function(i,s,o){const a={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:o,lastNotified:Pm(),observer:s,abortToken:a,taskId:i.id,root:{progress:Xm(i),children:[]},tryAbort:Ym(a)}})(r,e,t);return Qm(r,new rf(n,n.root))}function Xm(r){return{taskId:r.id,taskName:r.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function Ym(r){return e=>{r.abortRequested=!0,r.reason=e||r.reason}}function Km(r){return{progress:{...r.progress},children:r.children.map(Km)}}function Zm(r){return r.progress.canAbort&&r.children.every(Zm)}async function Qm(r,e){qm.markStart(r),e.node.progress.startedTime=Pm();try{const t=await r.f(e);return qm.markEnd(r),qm.measure(r),e.info.abortToken.abortRequested&&Jm(e.info),t}catch(t){throw sf.isAbort(t)&&(e.isAborted=!0,e.node.children.length>0&&await new Promise((n=>{e.onChildrenFinished=n})),r.onAbort&&r.onAbort()),t}}function Jm(r){throw r.abortToken.treeAborted||(r.abortToken.treeAborted=!0,tf(r.root),ef(r,Pm())),sf.Aborted(r.abortToken.reason)}function tf(r){const e=r.progress;e.isIndeterminate=!0,e.canAbort=!1,e.message="Aborting...";for(const t of r.children)tf(t)}function ef(r,e){r.lastNotified=e;const t=(function(n){return{root:Km(n.root),canAbort:Zm(n.root),requestAbort:n.tryAbort}})(r);r.observer(t)}(function(r){r.markStart=function(e){},r.markEnd=function(e){},r.measure=function(e){}})(qm||(qm={}));class rf{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,Jm(this.info))}get shouldUpdate(){return this.checkAborted(),Pm()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(e){if(this.checkAborted(),!e)return;const t=this.node.progress;typeof e=="string"?(t.message=e,t.isIndeterminate=!0):(e.canAbort!==void 0&&(t.canAbort=e.canAbort),e.message!==void 0&&(t.message=e.message),e.current!==void 0&&(t.current=e.current),e.max!==void 0&&(t.max=e.max),t.isIndeterminate=t.current===void 0||t.max===void 0,e.isIndeterminate!==void 0&&(t.isIndeterminate=e.isIndeterminate))}update(e,t){if(this.lastUpdatedTime=Pm(),this.updateProgress(e),!t)return ef(this.info,this.lastUpdatedTime),this.checkAborted(),Gm.immediatePromise()}async runChild(e,t){this.updateProgress(t);const n={progress:Xm(e),children:[]},i=this.node.children;i.push(n);const s=new rf(this.info,n);try{return await Qm(e,s)}catch(o){if(sf.isAbort(o)&&this.isAborted)return;throw o}finally{const o=i.indexOf(n);if(o>=0){for(let a=o,l=i.length-1;a<l;a++)i[a]=i[a+1];i.pop()}i.length===0&&this.onChildrenFinished&&this.onChildrenFinished()}}constructor(e,t){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=t,this.info=e}}const nf=new class{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(r,e){}};var sf,of,af,cf,lf,hf;async function uf(r,e,t,n,i){let s=Math.max(e,0),o=0,a=0;if(r.isSynchronous)return n(Number.MAX_SAFE_INTEGER,t),t;let l=Pm(),d=0,u=0;for(;(d=n(s,t))>0;){o+=d;const g=Pm()-l;u+=g,a+=g,r.shouldUpdate&&(await i(r,t,o),s=Math.round(u*o/a)+1,l=Pm(),u=0)}return r.shouldUpdate&&await i(r,t,o),t}function df(r){return{data:r,position:0,length:r.length,lineNumber:1,tokenStart:0,tokenEnd:0}}function mf(r){for(;r.position<r.length;)switch(r.data.charCodeAt(r.position)){case 9:case 10:case 13:case 32:return void(r.tokenEnd=r.position);default:++r.position}r.tokenEnd=r.position}function ff(r){return!(r.length-r.position<2)&&r.data.charCodeAt(r.position+1)===39&&r.data.charCodeAt(r.position+2)===39}function pf(r,e,t){let n;const i=t-e,s=r.tokenStart-e,o=r.tokenEnd-r.tokenStart;if(o<i)return!1;for(n=e;n<t;++n)if(r.data.charCodeAt(n)!==r.data.charCodeAt(n+s))return!1;return i===o||r.data.charCodeAt(n+s)===46}function gf(r){let e;for(e=r.tokenStart;e<r.tokenEnd;++e)if(r.data.charCodeAt(e)===46)return e;return e}function yf(r,e){return r.data.substring(r.tokenStart,e)}function bf(r){return r.data.substring(r.tokenStart,r.tokenEnd)}function _f(r){const e=(function(n){let i=10;for(;n.position<n.length;){const s=n.data.charCodeAt(n.position);switch(s){case 9:case 32:i=s,++n.position;break;case 10:i!==13&&++n.lineNumber,i=s,++n.position;break;case 13:i=s,++n.position,++n.lineNumber;break;default:return i}}return i})(r);if(r.position>=r.length)return void(r.tokenType=6);r.tokenStart=r.position,r.tokenEnd=r.position,r.isEscaped=!1;const t=r.data.charCodeAt(r.position);switch(t){case 35:(function(n){for(;n.position<n.length;){const i=n.data.charCodeAt(n.position);if(i===10||i===13)return;++n.position}})(r),r.tokenType=5;break;case 39:if(ff(r)){(function(n){for(n.position+=3;n.position<n.length;){if(n.data.charCodeAt(n.position)===39&&ff(n))return n.tokenStart+=3,n.tokenEnd=n.position,n.isEscaped=!0,void(n.position+=3);++n.position}n.tokenEnd=n.position})(r),r.tokenType=3;break}case 34:(function(n,i){let s,o;for(++n.position;n.position<n.length;)if(o=n.data.charCodeAt(n.position),o===i)switch(s=n.data.charCodeAt(n.position+1),s){case 9:case 10:case 13:case 32:return n.tokenStart++,n.tokenEnd=n.position,n.isEscaped=!0,void++n.position;default:if(s===void 0)return n.tokenStart++,n.tokenEnd=n.position,n.isEscaped=!0,void++n.position;++n.position}else{if(o===10||o===13)return void(n.tokenEnd=n.position);++n.position}n.tokenEnd=n.position})(r,t),r.tokenType=3;break;case 59:e===10||e===13?(function(n){let i,s=59,o=n.position+1;for(;o<n.length;){if(i=n.data.charCodeAt(o),i===59&&(s===10||s===13)){for(n.position=o+1,n.tokenStart++,o--,i=n.data.charCodeAt(o);i===10||i===13;)o--,i=n.data.charCodeAt(o);return n.tokenEnd=o+1,void(n.isEscaped=!0)}(i===13||i===10&&s!==13)&&n.lineNumber++,s=i,++o}n.position=o})(r):mf(r),r.tokenType=3;break;default:r.isImportGet?(function(n){for(;n.position<n.length;){if(n.data.charCodeAt(n.position)===93)return++n.position,n.tokenEnd=n.position,void(n.isImportGet=!1);++n.position}})(r):mf(r),r.isEscaped?r.tokenType=3:r.data.charCodeAt(r.tokenStart)===95?(r.inSaveFrame&&(function(n){return n.tokenEnd-n.tokenStart==11&&n.data.charCodeAt(n.tokenStart+1)===105&&n.data.charCodeAt(n.tokenStart+2)===109&&n.data.charCodeAt(n.tokenStart+3)===112&&n.data.charCodeAt(n.tokenStart+4)===111&&n.data.charCodeAt(n.tokenStart+5)===114&&n.data.charCodeAt(n.tokenStart+6)===116&&n.data.charCodeAt(n.tokenStart+7)===46&&n.data.charCodeAt(n.tokenStart+8)===103&&n.data.charCodeAt(n.tokenStart+9)===101&&n.data.charCodeAt(n.tokenStart+10)===116})(r)&&(r.isImportGet=!0),r.tokenType=4):r.tokenEnd-r.tokenStart>=5&&r.data.charCodeAt(r.tokenStart+4)===95?(function(n){let i=n.data.charCodeAt(n.tokenStart);return!(i!==68&&i!==100||(i=n.data.charCodeAt(n.tokenStart+1),i!==65&&i!==97||(i=n.data.charCodeAt(n.tokenStart+2),i!==84&&i!==116||(i=n.data.charCodeAt(n.tokenStart+3),i!==65&&i!==97))))})(r)?r.tokenType=0:(function(n){let i=n.data.charCodeAt(n.tokenStart);return!(i!==83&&i!==115||(i=n.data.charCodeAt(n.tokenStart+1),i!==65&&i!==97||(i=n.data.charCodeAt(n.tokenStart+2),i!==86&&i!==118||(i=n.data.charCodeAt(n.tokenStart+3),i!==69&&i!==101))))})(r)?r.tokenType=1:(function(n){if(n.tokenEnd-n.tokenStart!=5)return!1;let i=n.data.charCodeAt(n.tokenStart);return!(i!==76&&i!==108||(i=n.data.charCodeAt(n.tokenStart+1),i!==79&&i!==111||(i=n.data.charCodeAt(n.tokenStart+2),i!==79&&i!==111||(i=n.data.charCodeAt(n.tokenStart+3),i!==80&&i!==112))))})(r)?r.tokenType=2:r.tokenType=3:r.tokenType=3}}function xf(r){for(_f(r);r.tokenType===5;)_f(r)}function vf(){return{categoryNames:[],categoryData:Object.create(null)}}function wf(r,e){const t=Object.create(null);for(const n of r){const i=e[n];t[n]=Um(i.name,i.rowCount,i.fieldNames,i.fields)}return t}function Af(r,e,t){return zm(r.categoryNames,wf(r.categoryNames,r.categoryData),e,t)}function Sf(r,e){return zm(r.categoryNames,wf(r.categoryNames,r.categoryData),e)}function Cf(r,e,t,n,i){if(e in r.categoryData){const s=r.categoryData[e];s.fieldNames.push(...n),Object.assign(s.fields,i)}else r.categoryData[e]={name:e,rowCount:t,fieldNames:n,fields:i},r.categoryNames.push(e)}function Pf(r,e){const t=r.tokenStart,n=gf(r),i=yf(r,n),s=Object.create(null),o=[];let a=!0;for(;a;){if(r.tokenType!==4||!pf(r,t,n)){a=!1;break}const l=bf(r).substring(i.length+1);if(xf(r),r.tokenType!==3)return{hasError:!0,errorLine:r.lineNumber,errorMessage:"Expected value."};s[l]=Rm.ofTokens({data:r.data,indices:[r.tokenStart,r.tokenEnd],count:1}),o[o.length]=l,xf(r)}return Cf(e,i.substr(1),1,o,s),{hasError:!1,errorLine:0,errorMessage:""}}function If(r,e){const{tokenizer:t,tokens:n,fieldCount:i}=e;let s=e.tokenCount,o=0;for(;t.tokenType===3&&o<r;)cf.add(n[s++%i],t.tokenStart,t.tokenEnd),xf(t),o++;return e.tokenCount=s,o}function kf(r,e){return r.update({message:"Parsing...",current:e.tokenizer.position,max:e.tokenizer.data.length})}async function Mf(r,e){const t=r.lineNumber;xf(r);const n=yf(r,gf(r)),i=(function(g){let x;for(x=g.tokenStart;x<g.tokenEnd;++x)if(g.data.charCodeAt(x)===46)return!1;return!0})(r),s=[];for(;r.tokenType===4;)s[s.length]=i?bf(r):bf(r).substring(n.length+1),xf(r);const o=n==="_atom_site"?r.data.length/100|0:32,a=[],l=s.length;for(let g=0;g<l;g++)a[g]=cf.create(r.data,o);const d={fieldCount:l,tokenCount:0,tokenizer:r,tokens:a};if(await uf(r.runtimeCtx,1e6,d,If,kf),d.tokenCount%l!=0)return{hasError:!0,errorLine:r.lineNumber,errorMessage:`The number of values for loop starting at line ${t} is not a multiple of the number of columns.`};const u=d.tokenCount/l|0;if(i)for(let g=0;g<l;g++){const x={"":Rm.ofTokens(a[g])};Cf(e,s[g].substr(1),u,[""],x)}else{const g=Object.create(null);for(let x=0;x<l;x++)g[s[x]]=Rm.ofTokens(a[x]);Cf(e,n.substr(1),u,s,g)}return{hasError:!1,errorLine:0,errorMessage:""}}function Tf(r,e){return lf.error(e,r)}async function Df(r,e){const t=[],n=(function(u,g){return{data:u,length:u.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:g}})(r,e);let i="",s=vf(),o=[],a=vf();const l=(function(u,g,x){return{categoryNames:u,header:x,categories:g}})(a.categoryNames,wf(a.categoryNames,a.categoryData),"");let d="";for(e.update({message:"Parsing...",current:0,max:r.length}),xf(n);n.tokenType!==6;){const u=n.tokenType;if(u===0){if(n.inSaveFrame)return Tf(n.lineNumber,"Unexpected data block inside a save frame.");s.categoryNames.length>0&&t.push(Af(s,i,o)),i=r.substring(n.tokenStart+5,n.tokenEnd),s=vf(),o=[],xf(n)}else if(u===1){if(n.tokenEnd-n.tokenStart==5)a.categoryNames.length>0&&(o[o.length]=Sf(a,d)),n.inSaveFrame=!1;else{if(n.inSaveFrame)return Tf(n.lineNumber,"Save frames cannot be nested.");n.inSaveFrame=!0,d=r.substring(n.tokenStart+5,n.tokenEnd),a=vf()}xf(n)}else if(u===2){const g=await Mf(n,n.inSaveFrame?a:s);if(g.hasError)return Tf(g.errorLine,g.errorMessage)}else{if(u!==4)return console.log(n.tokenType,df.getTokenString(n)),Tf(n.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const g=Pf(n,n.inSaveFrame?a:s);if(g.hasError)return Tf(g.errorLine,g.errorMessage)}}}return n.inSaveFrame?Tf(n.lineNumber,`Unfinished save frame (${l.header}).`):((s.categoryNames.length>0||o.length>0)&&t.push(Af(s,i,o)),(function(u){return lf.success(u)})(Nm(t)))}function Bf(r){return sf.create("Parse CIF",(async e=>await Df(r,e)))}(function(r){class e{run(o,a=250){return o?Wm(this,o,a):this.f(nf)}runAsChild(o,a){return o.isSynchronous?this.f(nf):(function(l,d,u){return l.runChild(d,u)})(o,this,a)}runInContext(o){return o.isSynchronous?this.f(nf):(function(a,l){return Qm(l,a)})(o,this)}constructor(o,a,l){this.name=o,this.f=a,this.onAbort=l,this.id=i()}}function t(s){const o=s;return!!s&&typeof o.id=="number"&&typeof o.name=="string"&&!!o.run}function n(s,o,a){return new e(s,o,a)}r.is=t,r.isAbort=function(s){return!!s&&!!s.isAborted},r.Aborted=function(s){return{isAborted:!0,reason:s,toString:()=>"Aborted"+(s?": "+s:"")}},r.create=n,r.constant=function(s,o){return n(s,(async a=>o))},r.empty=function(){return n("",(async s=>{}))},r.fail=function(s,o){return n(s,(async a=>{throw new Error(o)}))},r.resolveInContext=function(s,o){return t(s)?o?s.runInContext(o):s.run():s};const i=Dm(0,1073741823)})(sf||(sf={})),(function(r){r.Synchronous=nf})(of||(of={})),(function(r){function e(t,n=""){const i=t.progress;if(!t.children.length)return i.isIndeterminate?`${n}${i.taskName}: ${i.message}`:`${n}${i.taskName}: [${i.current}/${i.max}] ${i.message}`;const s=n+"  |_ ",o=t.children.map((a=>e(a,s)));return i.isIndeterminate?`${n}${i.taskName}: ${i.message}
${o.join(`
`)}`:`${n}${i.taskName}: [${i.current}/${i.max}] ${i.message}
${o.join(`
`)}`}r.format=function(t){return e(t.root)}})(af||(af={})),(function(r){function e(o){return o.data.substring(o.tokenStart,o.tokenEnd)}function t(o){const{data:a}=o;for(;o.position<o.length;)switch(a.charCodeAt(o.position)){case 10:return o.tokenEnd=o.position,++o.position,++o.lineNumber,!0;case 13:return o.tokenEnd=o.position,++o.position,++o.lineNumber,a.charCodeAt(o.position)===10&&++o.position,!0;default:++o.position}return o.tokenEnd=o.position,o.tokenStart!==o.tokenEnd}function n(o){return o.tokenStart=o.position,t(o)}function i(o,a,l){let d=0;for(let u=0;u<a;u++){if(!n(o))return d;cf.addUnchecked(l,o.tokenStart,o.tokenEnd),d++}return d}function s(o,a,l){const{data:d}=o;let u=a,g=l-1,x=d.charCodeAt(u);for(;(x===9||x===32)&&u<=g;)x=d.charCodeAt(++u);for(x=d.charCodeAt(g);(x===9||x===32)&&g>=u;)x=d.charCodeAt(--g);return o.tokenStart=u,o.tokenEnd=g+1,o.position=l,o}r.getTokenString=e,r.reset=function(o){o.position=0,o.lineNumber=1,o.tokenStart=0,o.tokenEnd=0},r.eatLine=t,r.markStart=function(o){o.tokenStart=o.position},r.markLine=n,r.readLine=function(o){return n(o),e(o)},r.readLineTrim=function(o){n(o);const a=o.position;return s(o,o.tokenStart,o.tokenEnd),o.position=a,e(o)},r.markLines=function(o,a){const l=cf.create(o.data,2*a);return i(o,a,l),l},r.readLines=function(o,a){const l=[];for(let d=0;d<a;d++)l.push(r.readLine(o));return l},r.readLinesAsync=async function(o,a,l,d=1e5){const u=cf.create(o.data,2*a);let g=0;return await uf(l,d,o,((x,y)=>{const b=Math.min(a-g,x);return i(y,b,u),g+=b,b}),((x,y)=>x.update({message:"Parsing...",current:y.position,max:y.length}))),u},r.readAllLines=function(o){const a=r(o),l=cf.create(a.data,Math.max(o.length/80,2));for(;n(a);)cf.add(l,a.tokenStart,a.tokenEnd);return l},r.readAllLinesAsync=async function(o,a,l=1e5){const d=r(o),u=cf.create(d.data,Math.max(o.length/80,2));return await uf(a,l,d,((g,x)=>((function(y,b,_){let h=0;for(let f=0;f<b;f++){if(!n(y))return h;cf.add(_,y.tokenStart,y.tokenEnd),h++}})(x,g,u),x.position<x.length?g:0)),((g,x)=>g.update({message:"Parsing...",current:x.position,max:x.length}))),u},r.eatValue=function(o){for(;o.position<o.length;)switch(o.data.charCodeAt(o.position)){case 9:case 10:case 13:case 32:return void(o.tokenEnd=o.position);default:++o.position}o.tokenEnd=o.position},r.skipWhitespace=function(o){let a=-1;for(;o.position<o.length;){const l=o.data.charCodeAt(o.position);switch(l){case 9:case 32:a=l,++o.position;break;case 10:a!==13&&++o.lineNumber,a=l,++o.position;break;case 13:a=l,++o.position,++o.lineNumber;break;default:return a}}return a},r.trim=s})(df||(df={})),(function(r){function e(t,n,i){const s=t;s.offset>s.indicesLenMinus2&&(function(o){const a=new Uint32Array(1.61*o.indices.length|0);a.set(o.indices),o.indices=a,o.indicesLenMinus2=a.length-2|0})(s),s.indices[s.offset++]=n,s.indices[s.offset++]=i,t.count++}r.add=e,r.addToken=function(t,n){e(t,n.tokenStart,n.tokenEnd)},r.addUnchecked=function(t,n,i){t.indices[t.offset++]=n,t.indices[t.offset++]=i,t.count++},r.create=function(t,n){return{data:t,indicesLenMinus2:(n=Math.max(10,n))-2|0,count:0,offset:0,indices:new Uint32Array(n)}}})(cf||(cf={})),(function(r){r.error=function(n,i=-1){return new e(n,i)},r.success=function(n,i=[]){return new t(n,i)};class e{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(i,s){this.message=i,this.line=s,this.isError=!0}}r.Error=e;class t{constructor(i,s){this.result=i,this.warnings=s,this.isError=!1}}r.Success=t})(lf||(lf={})),(function(r){var e,t;(e=r.IntDataType||(r.IntDataType={}))[e.Int8=1]="Int8",e[e.Int16=2]="Int16",e[e.Int32=3]="Int32",e[e.Uint8=4]="Uint8",e[e.Uint16=5]="Uint16",e[e.Uint32=6]="Uint32",(t=r.FloatDataType||(r.FloatDataType={}))[t.Float32=32]="Float32",t[t.Float64=33]="Float64",r.getDataType=function(n){let i;return i=n instanceof Int8Array?r.IntDataType.Int8:n instanceof Int16Array?r.IntDataType.Int16:n instanceof Int32Array?r.IntDataType.Int32:n instanceof Uint8Array?r.IntDataType.Uint8:n instanceof Uint16Array?r.IntDataType.Uint16:n instanceof Uint32Array?r.IntDataType.Uint32:n instanceof Float32Array?r.FloatDataType.Float32:n instanceof Float64Array?r.FloatDataType.Float64:r.IntDataType.Int32,i},r.isSignedIntegerDataType=function(n){if(n instanceof Int8Array||n instanceof Int16Array||n instanceof Int32Array)return!0;for(let i=0,s=n.length;i<s;i++)if(i<0)return!1;return!0}})(hf||(hf={}));const Ff=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function Ef(r){let e=r.data;for(let t=r.encoding.length-1;t>=0;t--)e=$f(e,r.encoding[t]);return e}function $f(r,e){switch(e.kind){case"ByteArray":switch(e.type){case hf.IntDataType.Uint8:return r;case hf.IntDataType.Int8:return(function(t){return new Int8Array(t.buffer,t.byteOffset)})(r);case hf.IntDataType.Int16:return(function(t){return Lf(t,2,Int16Array)})(r);case hf.IntDataType.Uint16:return(function(t){return Lf(t,2,Uint16Array)})(r);case hf.IntDataType.Int32:return(function(t){return Lf(t,4,Int32Array)})(r);case hf.IntDataType.Uint32:return(function(t){return Lf(t,4,Uint32Array)})(r);case hf.FloatDataType.Float32:return(function(t){return Lf(t,4,Float32Array)})(r);case hf.FloatDataType.Float64:return(function(t){return Lf(t,8,Float64Array)})(r);default:im(e.type)}case"FixedPoint":return(function(t,n){const i=t.length,s=Rf(n.srcType,i),o=1/n.factor;for(let a=0;a<i;a++)s[a]=o*t[a];return s})(r,e);case"IntervalQuantization":return(function(t,n){const i=t.length,s=Rf(n.srcType,i),o=(n.max-n.min)/(n.numSteps-1),a=n.min;for(let l=0;l<i;l++)s[l]=a+o*t[l];return s})(r,e);case"RunLength":return(function(t,n){const i=Of(n.srcType,n.srcSize);let s=0;for(let o=0,a=t.length;o<a;o+=2){const l=t[o],d=t[o+1];for(let u=0;u<d;++u)i[s++]=l}return i})(r,e);case"Delta":return(function(t,n){const i=t.length,s=Of(n.srcType,i);if(!i)return t;s[0]=t[0]+(0|n.origin);for(let o=1;o<i;++o)s[o]=t[o]+s[o-1];return s})(r,e);case"IntegerPacking":return(function(t,n){return t.length===n.srcSize?t:n.isUnsigned?(function(i,s){const o=s.byteCount===1?255:65535,a=i.length,l=new Int32Array(s.srcSize);let d=0,u=0;for(;d<a;){let g=0,x=i[d];for(;x===o;)g+=x,d++,x=i[d];g+=x,l[u]=g,d++,u++}return l})(t,n):(function(i,s){const o=s.byteCount===1?127:32767,a=-o-1,l=i.length,d=new Int32Array(s.srcSize);let u=0,g=0;for(;u<l;){let x=0,y=i[u];for(;y===o||y===a;)x+=y,u++,y=i[u];x+=y,d[g]=x,u++,g++}return d})(t,n)})(r,e);case"StringArray":return(function(t,n){const i=Ef({encoding:n.offsetEncoding,data:n.offsets}),s=Ef({encoding:n.dataEncoding,data:t}),o=n.stringData,a=new Array(i.length);a[0]="";for(let u=1,g=i.length;u<g;u++)a[u]=o.substring(i[u-1],i[u]);let l=0;const d=new Array(s.length);for(let u=0,g=s.length;u<g;u++)d[l++]=a[s[u]+1];return d})(r,e)}}function Of(r,e){switch(r){case hf.IntDataType.Int8:return new Int8Array(e);case hf.IntDataType.Int16:return new Int16Array(e);case hf.IntDataType.Int32:return new Int32Array(e);case hf.IntDataType.Uint8:return new Uint8Array(e);case hf.IntDataType.Uint16:return new Uint16Array(e);case hf.IntDataType.Uint32:return new Uint32Array(e);default:return new Int32Array(e)}}function Rf(r,e){switch(r){case hf.FloatDataType.Float32:return new Float32Array(e);case hf.FloatDataType.Float64:default:return new Float64Array(e)}}function Lf(r,e,t){return new t(Ff?r.buffer:(function(n,i){const s=new ArrayBuffer(n.length),o=new Uint8Array(s);for(let a=0,l=n.length;a<l;a+=i)for(let d=0;d<i;d++)o[a+i-d-1]=n[a+d];return s})(r,e))}var Nf,zf,Uf,Vf,jf;function Gf(r,e,t){let n,i=1;for(n=0;n<e;n++){const s=i*r;if(Math.abs(Math.round(s)-s)<=t)return n;i*=10}return-1}function Hf(r){return zf.classify(r)}(function(r){function e(n){const i=n.growBy*n.elementSize;n.currentSize=i,n.currentIndex=0,n.currentChunk=new n.ctor(i),n.allocatedSize+=i,n.chunks[n.chunks.length]=n.currentChunk}function t(n,i){const{ctor:s,chunks:o,currentIndex:a}=n;if(!o.length)return new s(0);if(o.length===1&&(i||a===n.allocatedSize))return o[0];let l=0;for(let x=0,y=o.length-1;x<y;x++)l+=o[x].length;l+=n.currentIndex;const d=new s(l);let u=0;if(d.buffer)for(let x=0,y=o.length-1;x<y;x++)d.set(o[x],u),u+=o[x].length;else for(let x=0,y=o.length-1;x<y;x++){const b=o[x];for(let _=0,h=b.length;_<h;_++)d[u+_]=b[_];u+=b.length}const g=o[o.length-1];if(d.buffer&&a>=n.currentSize)d.set(g,u);else for(let x=0,y=g.length;x<y;x++)d[u+x]=g[x];return d}r.is=function(n){return n.creator&&n.chunkSize},r.add4=function(n,i,s,o,a){n.currentIndex>=n.currentSize&&e(n);const l=n.currentChunk,d=n.currentIndex;return l[d]=i,l[d+1]=s,l[d+2]=o,l[d+3]=a,n.currentIndex+=4,n.elementCount++},r.add3=function(n,i,s,o){n.currentIndex>=n.currentSize&&e(n);const a=n.currentChunk,l=n.currentIndex;return a[l]=i,a[l+1]=s,a[l+2]=o,n.currentIndex+=3,n.elementCount++},r.add2=function(n,i,s){n.currentIndex>=n.currentSize&&e(n);const o=n.currentChunk,a=n.currentIndex;return o[a]=i,o[a+1]=s,n.currentIndex+=2,n.elementCount++},r.add=function(n,i){return n.currentIndex>=n.currentSize&&e(n),n.currentChunk[n.currentIndex]=i,n.currentIndex+=1,n.elementCount++},r.addRepeat=function(n,i,s){for(let o=0;o<i;o++)n.currentIndex>=n.currentSize&&e(n),n.currentChunk[n.currentIndex++]=s,n.elementCount++;return n.elementCount},r.addMany=function(n,i){const{elementSize:s}=n;for(let o=0,a=i.length;o<a;o+=s){n.currentIndex>=n.currentSize&&e(n);const{currentChunk:l}=n;for(let d=0;d<s;d++)l[n.currentIndex++]=i[o+d];n.elementCount++}return n.elementCount},r.compact=function(n,i=!1){return t(n,i)},r._compact=t,r.create=function(n,i,s,o){const a={ctor:n,elementSize:i,growBy:Math.max(1,Math.ceil(s)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(o===void 0)return a;if(typeof o=="number")return a.currentChunk=new n(o*i),a.allocatedSize=o*i,a.currentSize=a.currentChunk.length,a.chunks[0]=a.currentChunk,a;const l=o;if(l.length%i!=0)throw new Error("initialChunk length must be a multiple of the element size.");return a.currentChunk=l,a.allocatedSize=l.length,a.currentSize=l.length,a.chunks[0]=l,a}})(Nf||(Nf={})),(function(r){function e(u,g){return u>=0?Math.ceil((u+1)/g):Math.ceil((u+1)/(-g-1))}function t({limit8:u,limit16:g},x,y){x.pack8+=e(y,u),x.pack16+=e(y,g),x.count+=1}function n(u,g){u.pack8+=e(g,127),u.pack16+=e(g,32767),u.count+=1}function i(u){return 4*u.count<2*u.pack16?{length:4*u.count,elem:4}:2*u.pack16<u.pack8?{length:2*u.pack16,elem:2}:{length:u.pack8,elem:1}}function s(u,g){const x={pack8:0,pack16:0,count:0};for(let y=0,b=u.length;y<b;y++)t(g,x,u[y]);return{...i(x),kind:"pack"}}function o(u,g){const x={pack8:0,pack16:0,count:0};let y=u[0];for(let b=1,_=u.length;b<_;b++)n(x,u[b]-y),y=u[b];return{...i(x),kind:"delta"}}function a(u,g){const x={pack8:0,pack16:0,count:0};let y=1;for(let b=1,_=u.length;b<_;b++)u[b-1]!==u[b]?(t(g,x,u[b-1]),t(g,x,y),y=1):y++;return t(g,x,u[u.length-1]),t(g,x,y),{...i(x),kind:"rle"}}function l(u,g){const x={pack8:0,pack16:0,count:0};let y=1,b=0,_=0;for(let h=1,f=u.length;h<f;h++){const E=u[h]-b;_!==E?(n(x,_),n(x,y),y=1):y++,_=E,b=u[h]}return n(x,_),n(x,y),{...i(x),kind:"delta-rle"}}function d(u){const g=(function(y){let b=!1;for(let _=0,h=y.length;_<h;_++)if(y[_]<0){b=!0;break}return b?{signed:b,limit8:127,limit16:32767}:{signed:b,limit8:255,limit16:65535}})(u),x=[s(u,g),a(u,g),o(u),l(u)];return x.sort(((y,b)=>y.length-b.length)),x}r.getSize=d,r.classify=function(u){if(u.length<2)return jf.by(jf.byteArray);switch(d(u)[0].kind){case"pack":return jf.by(jf.integerPacking);case"rle":return jf.by(jf.runLength).and(jf.integerPacking);case"delta":return jf.by(jf.delta).and(jf.integerPacking);case"delta-rle":return jf.by(jf.delta).and(jf.runLength).and(jf.integerPacking);default:im()}}})(zf||(zf={})),(function(r){r.classify=function(e){const{mantissaDigits:t,integerDigits:n}=(function(l,d,u){let g=1,x=0;for(let y=0,b=l.length;y<b;y++){if(g>=0){const h=Gf(l[y],d,u);h<0?g=-1:h>g&&(g=h)}const _=Math.abs(l[y]);if(_>u){const h=Math.floor(Math.log10(Math.abs(_)))+1;h>x&&(x=h)}}return{mantissaDigits:g,integerDigits:x}})(e,4,1e-6);if(t<0||t+n>10)return jf.by(jf.byteArray);if(t===0)return zf.classify(e);const i=(function(l){let d=1;for(let u=0;u<l;u++)d*=10;return d})(t),s=new Int32Array(e.length);for(let l=0,d=e.length;l<d;l++)s[l]=Math.round(i*e[l]);const o=zf.getSize(s)[0],a=jf.by(jf.fixedPoint(i));switch(o.kind){case"pack":return a.and(jf.integerPacking);case"rle":return a.and(jf.runLength).and(jf.integerPacking);case"delta":return a.and(jf.delta).and(jf.integerPacking);case"delta-rle":return a.and(jf.delta).and(jf.runLength).and(jf.integerPacking);default:im()}}})(Uf||(Uf={}));class qf{and(e){return new qf(this.providers.concat([e]))}encode(e){const t=[];for(const n of this.providers){const i=n(e);if(!i.encodings.length)throw new Error("Encodings must be non-empty.");e=i.data;for(const s of i.encodings)t.push(s)}if(!(e instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:t,data:e}}constructor(e){this.providers=e}}(function(r){function e(n){return new qf([n])}function t(n){switch(n.kind){case"ByteArray":return jf.byteArray;case"FixedPoint":return jf.fixedPoint(n.factor);case"IntervalQuantization":return jf.intervalQuantizaiton(n.min,n.max,n.numSteps);case"RunLength":return jf.runLength;case"Delta":return jf.delta;case"IntegerPacking":return jf.integerPacking;case"StringArray":return jf.stringArray}}r.by=e,r.fromEncoding=function(n){let i=e(t(n[0]));for(let s=1;s<n.length&&n[s-1].kind!=="IntegerPacking";s++)i=i.and(t(n[s]));return i}})(Vf||(Vf={})),(function(r){r.by=function(o){return new qf([o])};const e={[hf.IntDataType.Int16]:function(o,a,l){o.setInt16(2*a,l,!0)},[hf.IntDataType.Uint16]:function(o,a,l){o.setUint16(2*a,l,!0)},[hf.IntDataType.Int32]:function(o,a,l){o.setInt32(4*a,l,!0)},[hf.IntDataType.Uint32]:function(o,a,l){o.setUint32(4*a,l,!0)},[hf.FloatDataType.Float32]:function(o,a,l){o.setFloat32(4*a,l,!0)},[hf.FloatDataType.Float64]:function(o,a,l){o.setFloat64(8*a,l,!0)}},t={[hf.IntDataType.Int16]:2,[hf.IntDataType.Uint16]:2,[hf.IntDataType.Int32]:4,[hf.IntDataType.Uint32]:4,[hf.FloatDataType.Float32]:4,[hf.FloatDataType.Float64]:8};function n(o){const a=hf.getDataType(o);if(a===hf.IntDataType.Int8)return(function(g){return{encodings:[{kind:"ByteArray",type:hf.IntDataType.Int8}],data:new Uint8Array(g.buffer,g.byteOffset)}})(o);if(a===hf.IntDataType.Uint8)return(function(g){return{encodings:[{kind:"ByteArray",type:hf.IntDataType.Uint8}],data:g}})(o);const l=new Uint8Array(o.length*t[a]),d=e[a],u=new DataView(l.buffer);for(let g=0,x=o.length;g<x;g++)d(u,g,o[g]);return{encodings:[{kind:"ByteArray",type:a}],data:l}}function i(o,a){let l=0;for(let d=0,u=o.length;d<u;d++)l+=o[d]/a|0;return l+=o.length,l}function s(o,a){const l=-a-1;let d=0;for(let u=0,g=o.length;u<g;u++){const x=o[u];d+=x>=0?x/a|0:x/l|0}return d+=o.length,d}r.byteArray=n,r.fixedPoint=function(o){return a=>(function(l,d){const u=hf.getDataType(l),g=new Int32Array(l.length);for(let x=0,y=l.length;x<y;x++)g[x]=Math.round(l[x]*d);return{encodings:[{kind:"FixedPoint",factor:d,srcType:u}],data:g}})(a,o)},r.intervalQuantizaiton=function(o,a,l,d=Int32Array){return u=>(function(g,x,y,b,_){const h=hf.getDataType(g);if(!g.length)return{encodings:[{kind:"IntervalQuantization",min:x,max:y,numSteps:b,srcType:h}],data:new Int32Array(0)};if(y<x){const m=x;x=y,y=m}const f=(y-x)/(b-1),E=new _(g.length);for(let m=0,S=g.length;m<S;m++){const w=g[m];E[m]=w<=x?0:w>=y?b-1:0|Math.round((w-x)/f)}return{encodings:[{kind:"IntervalQuantization",min:x,max:y,numSteps:b,srcType:h}],data:E}})(u,o,a,l,d)},r.runLength=function(o){let a=hf.getDataType(o);if(a===void 0&&(o=new Int32Array(o),a=hf.IntDataType.Int32),!o.length)return{encodings:[{kind:"RunLength",srcType:a,srcSize:0}],data:new Int32Array(0)};let l=2;for(let x=1,y=o.length;x<y;x++)o[x-1]!==o[x]&&(l+=2);const d=new Int32Array(l);let u=0,g=1;for(let x=1,y=o.length;x<y;x++)o[x-1]!==o[x]?(d[u]=o[x-1],d[u+1]=g,g=1,u+=2):++g;return d[u]=o[o.length-1],d[u+1]=g,{encodings:[{kind:"RunLength",srcType:a,srcSize:o.length}],data:d}},r.delta=function(o){if(!hf.isSignedIntegerDataType(o))throw new Error("Only signed integer types can be encoded using delta encoding.");let a=hf.getDataType(o);if(a===void 0&&(o=new Int32Array(o),a=hf.IntDataType.Int32),!o.length)return{encodings:[{kind:"Delta",origin:0,srcType:a}],data:new o.constructor(0)};const l=new o.constructor(o.length),d=o[0];l[0]=o[0];for(let u=1,g=o.length;u<g;u++)l[u]=o[u]-o[u-1];return l[0]=0,{encodings:[{kind:"Delta",origin:d,srcType:a}],data:l}},r.integerPacking=function(o){const a=(function(l){const d=(function(x){for(let y=0,b=x.length;y<b;y++)if(x[y]<0)return!0;return!1})(l),u=d?s(l,127):i(l,255),g=d?s(l,32767):i(l,65535);return 4*l.length<2*g?{isSigned:d,size:l.length,bytesPerElement:4}:2*g<u?{isSigned:d,size:g,bytesPerElement:2}:{isSigned:d,size:u,bytesPerElement:1}})(o);return a.bytesPerElement===4?n(o):(function(l,d){const u=d.isSigned?d.bytesPerElement===1?127:32767:d.bytesPerElement===1?255:65535,g=-u-1,x=l.length,y=d.isSigned?d.bytesPerElement===1?new Int8Array(d.size):new Int16Array(d.size):d.bytesPerElement===1?new Uint8Array(d.size):new Uint16Array(d.size);let b=0;for(let h=0;h<x;h++){let f=l[h];if(f>=0)for(;f>=u;)y[b]=u,++b,f-=u;else for(;f<=g;)y[b]=g,++b,f-=g;y[b]=f,++b}const _=n(y);return{encodings:[{kind:"IntegerPacking",byteCount:d.bytesPerElement,isUnsigned:!d.isSigned,srcSize:x},_.encodings[0]],data:_.data}})(o,a)},r.stringArray=function(o){const a=Object.create(null),l=[],d=new Int32Array(o.length),u=Nf.create(Int32Array,1,Math.min(1024,o.length<32?o.length+1:Math.round(o.length/8)+1));Nf.add(u,0);let g=0,x=0;for(const h of o){if(h==null){d[x++]=-1;continue}let f=a[h];f===void 0&&(g+=h.length,f=l.length,l[f]=h,a[h]=f,Nf.add(u,g)),d[x++]=f}const y=Nf.compact(u),b=Hf(y).encode(y),_=Hf(d).encode(d);return{encodings:[{kind:"StringArray",dataEncoding:_.encoding,stringData:l.join(""),offsetEncoding:b.encoding,offsets:b.data}],data:_.data}}})(jf||(jf={}));const Wf=(function(){const r=[];for(let e=0;e<1024;e++)r[e]=String.fromCharCode(e);return r})();function Xf(r){throw new Error(r)}const Yf=typeof TextDecoder<"u"?new TextDecoder:void 0;function Kf(r,e,t){if(Yf){const n=e||t!==r.length?r.subarray(e,e+t):r;return Yf.decode(n)}return(function(n,i,s){const o=Wf;let a,l=0;const d=[];for(let u=i,g=i+s;u<g;u++){const x=n[u];128&x?(224&x)==192?d[l++]=o[(15&x)<<6|63&n[++u]]:(240&x)==224?d[l++]=String.fromCharCode((15&x)<<12|(63&n[++u])<<6|63&n[++u]):(248&x)==240?d[l++]=String.fromCharCode((7&x)<<18|(63&n[++u])<<12|(63&n[++u])<<6|63&n[++u]):Xf("Invalid byte "+x.toString(16)):d[l++]=o[x],l===512&&(a=a||[],a[a.length]=d.join(""),l=0)}return a?(l>0&&(a[a.length]=d.slice(0,l).join("")),a.join("")):d.slice(0,l).join("")})(r,e,t)}function Zf(r,e){const t={};for(let n=0;n<e;n++)t[ep(r)]=ep(r);return t}function Qf(r,e){const t=new Uint8Array(e),n=r.offset;for(let i=0;i<e;i++)t[i]=r.buffer[i+n];return r.offset+=e,t}function Jf(r,e){const t=Kf(r.buffer,r.offset,e);return r.offset+=e,t}function tp(r,e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=ep(r);return t}function ep(r){const e=r.buffer[r.offset];let t,n;if(!(128&e))return r.offset++,e;if((240&e)==128)return n=15&e,r.offset++,Zf(r,n);if((240&e)==144)return n=15&e,r.offset++,tp(r,n);if((224&e)==160)return n=31&e,r.offset++,Jf(r,n);if(!(224&~e))return t=r.dataView.getInt8(r.offset),r.offset++,t;switch(e){case 192:return r.offset++,null;case 194:return r.offset++,!1;case 195:return r.offset++,!0;case 196:return n=r.dataView.getUint8(r.offset+1),r.offset+=2,Qf(r,n);case 197:return n=r.dataView.getUint16(r.offset+1),r.offset+=3,Qf(r,n);case 198:return n=r.dataView.getUint32(r.offset+1),r.offset+=5,Qf(r,n);case 202:return t=r.dataView.getFloat32(r.offset+1),r.offset+=5,t;case 203:return t=r.dataView.getFloat64(r.offset+1),r.offset+=9,t;case 204:return t=r.buffer[r.offset+1],r.offset+=2,t;case 205:return t=r.dataView.getUint16(r.offset+1),r.offset+=3,t;case 206:return t=r.dataView.getUint32(r.offset+1),r.offset+=5,t;case 208:return t=r.dataView.getInt8(r.offset+1),r.offset+=2,t;case 209:return t=r.dataView.getInt16(r.offset+1),r.offset+=3,t;case 210:return t=r.dataView.getInt32(r.offset+1),r.offset+=5,t;case 217:return n=r.dataView.getUint8(r.offset+1),r.offset+=2,Jf(r,n);case 218:return n=r.dataView.getUint16(r.offset+1),r.offset+=3,Jf(r,n);case 219:return n=r.dataView.getUint32(r.offset+1),r.offset+=5,Jf(r,n);case 220:return n=r.dataView.getUint16(r.offset+1),r.offset+=3,tp(r,n);case 221:return n=r.dataView.getUint32(r.offset+1),r.offset+=5,tp(r,n);case 222:return n=r.dataView.getUint16(r.offset+1),r.offset+=3,Zf(r,n);case 223:return n=r.dataView.getUint32(r.offset+1),r.offset+=5,Zf(r,n)}throw new Error("Unknown type 0x"+e.toString(16))}function ip(r){const e=Object.create(null),t=Object.create(null);for(const n of r.columns)e[n.name]=n;return{rowCount:r.rowCount,name:r.name.substr(1),fieldNames:r.columns.map((n=>n.name)),getField(n){const i=e[n];if(i)return t[n]||(t[n]=(function(s){const o=s.mask?Ef(s.mask):void 0,a=Ef(s.data),l=Ud(a),d=l?o?b=>o[b]===0?""+a[b]:"":b=>""+a[b]:o?b=>o[b]===0?a[b]:"":b=>a[b],u=l?b=>a[b]:b=>{const _=a[b];return cm(_,0,_.length)},g=l?b=>a[b]:b=>{const _=a[b];return hm(_,0,_.length)},x=o?b=>o[b]:b=>0,y=a.length;return{__array:a,binaryEncoding:s.data.encoding,isDefined:!0,rowCount:y,str:d,int:u,float:g,valueKind:x,areValuesEqual:(b,_)=>a[b]===a[_],toStringArray:b=>zd(y,d,b),toIntArray:l?b=>Vd(a,b):b=>zd(y,u,b),toFloatArray:l?b=>Vd(a,b):b=>zd(y,g,b)}})(i)),t[n]}}}function rp(r){return sf.create("Parse BinaryCIF",(async e=>{const t=[0,3];try{const i=ep({buffer:n=r,offset:0,dataView:new DataView(n.buffer)});if(!(function(o,a){for(let l=0;l<2;l++)if(o[l]>a[l])return!1;return!0})(t,i.version.match(/(\d)\.(\d)\.\d/).slice(1).map((o=>+o))))return lf.error(`Unsupported format version. Current ${i.version}, required ${t.join(".")}.`);const s=Nm(i.dataBlocks.map((o=>{const a=Object.create(null);for(const l of o.categories)a[l.name.substr(1)]=ip(l);return zm(o.categories.map((l=>l.name.substr(1))),a,o.header)})));return lf.success(s)}catch(i){return lf.error(""+i)}var n}))}var np;function sp(r,e,t){return(function(n,i,s){const o=Object.create(null);for(const a of Object.keys(n))o[a]=dp(a,n[a],i,s);return Om.ofTables(i.header,n,o)})(r,e,t)}function op(r){switch(r.valueType){case"str":return(e,t,n)=>(function(i,s,o,a){return{schema:i,__array:s.__array,isDefined:s.isDefined,rowCount:s.rowCount,value:i.transform==="lowercase"?l=>o(l).toLowerCase():i.transform==="uppercase"?l=>o(l).toUpperCase():o,valueKind:s.valueKind,areValuesEqual:s.areValuesEqual,toArray:i.transform==="lowercase"?l=>Array.from(a(l)).map((d=>d.toLowerCase())):i.transform==="uppercase"?l=>Array.from(a(l)).map((d=>d.toUpperCase())):a}})(r,e,e.str,e.toStringArray);case"int":return(e,t,n)=>ap(r,e,e.int,e.toIntArray);case"float":return(e,t,n)=>ap(r,e,e.float,e.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function ap(r,e,t,n){return{schema:r,__array:e.__array,isDefined:e.isDefined,rowCount:e.rowCount,value:t,valueKind:e.valueKind,areValuesEqual:e.areValuesEqual,toArray:n}}function cp(r,e,t){const n=r.separator,i=r.itemParse,s=e.getField(t),o=s?a=>s.str(a).split(n).map((l=>i(l.trim()))).filter((l=>!!l)):a=>[];return{schema:r,__array:void 0,isDefined:!!s,rowCount:e.rowCount,value:o,valueKind:s?s.valueKind:()=>1,areValuesEqual:(a,l)=>(function(d,u){const g=d.length;if(g!==u.length)return!1;for(let x=0;x<g;x++)if(d[x]!==u[x])return!1;return!0})(o(a),o(l)),toArray:a=>zd(e.rowCount,o,a)}}function lp(r,e,t){const n=r.space,i=e.fieldNames.includes(`${t}[0]`)||e.fieldNames.includes(`${t}[0][0]`)||e.fieldNames.includes(`${t}[0][0][0]`),s=i?0:1,o=e.fieldNames.includes(`${t}_1`)||e.fieldNames.includes(`${t}_11`)||e.fieldNames.includes(`${t}_111`)?"underscore":"brackets",a=(function(u,g,x,y){const b=x?0:1;switch(g){case 1:return y==="brackets"?_=>`${u}[${_+b}]`:_=>`${u}_${_+b}`;case 2:return y==="brackets"?(_,h)=>`${u}[${_+b}][${h+b}]`:(_,h)=>`${u}_${_+b}${h+b}`;case 3:return y==="brackets"?(_,h,f)=>`${u}[${_+b}][${h+b}][${f+b}]`:(_,h,f)=>`${u}_${_+b}${h+b}${f+b}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}})(t,n.rank,i,o),l=e.getField(a(s,s,s))||sm.Undefined(e.rowCount,r),d=u=>(function(g,x,y,b){const _=x.create();if(x.rank===1){const h=x.dimensions[0];for(let f=0;f<h;f++){const E=g.getField(b(f));x.set(_,f,E?E.float(y):0)}}else if(x.rank===2){const h=x.dimensions[0],f=x.dimensions[1];for(let E=0;E<h;E++)for(let m=0;m<f;m++){const S=g.getField(b(E,m));x.set(_,E,m,S?S.float(y):0)}}else{if(x.rank!==3)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const h=x.dimensions[0],f=x.dimensions[1],E=x.dimensions[2];for(let m=0;m<h;m++)for(let S=0;S<f;S++)for(let w=0;w<E;w++){const v=g.getField(b(m,S,w));x.set(_,m,S,w,v?v.float(y):0)}}}return _})(e,n,u,a);return{schema:r,__array:void 0,isDefined:l.isDefined,rowCount:e.rowCount,value:d,valueKind:l.valueKind,areValuesEqual:(u,g)=>nm.areEqualExact(d(u),d(g)),toArray:u=>zd(e.rowCount,d,u)}}(function(r){function e(t){return t.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}r.canonical=e,r.equal=function(t,n){return e(t)===e(n)},r.create=function(t,n,i=!1){const s=`${t}${n?`.${n}`:""}`;return i?e(s):s}})(np||(np={}));class hp{constructor(e,t,n){this._isDefined=n;const i=Object.keys(t);this._rowCount=e.rowCount,this._columns=i,this._schema=t;const s=Object.create(null);for(const o of i)Object.defineProperty(this,o,{get:function(){if(s[o])return s[o];const a=t[o];if(a.valueType==="list")s[o]=cp(a,e,o);else if(a.valueType==="tensor")s[o]=lp(a,e,o);else{const l=op(a),d=e.getField(o);s[o]=d?l(d,e,o):sm.Undefined(e.rowCount,a)}return s[o]},enumerable:!0,configurable:!1})}}function up(r,e,t,n){const i=np.create(e,r),s=np.canonical(i);if(s in t)return t[s];if(n&&i in n)for(const o of n[i]){const a=np.canonical(o);if(a in t)return t[a]}}function dp(r,e,t,n){let i=t.categories[r];if(n){const s=(function(d){const u=Object.create(null);for(const g of Object.keys(d.categories))for(const x of d.categories[g].fieldNames)u[np.create(g,x,!0)]=d.categories[g].getField(x);return u})(t),o=Object.create(null),a=[];let l=0;for(const d of Object.keys(e)){const u=up(d,r,s,n);u&&(o[d]=u,a.push(d),l=u.rowCount)}i={rowCount:l,name:r,fieldNames:[...a],getField:d=>o[d]}}return new hp(i||Um.empty(r),e,!!i)}var mp=sm.Schema;const fp=mp.str,pp=mp.int,gp=mp.float,yp=mp.coord,bp=mp.Aliased,_p=mp.Matrix,xp=mp.Vector,vp=mp.lstr,wp=mp.List,Ap={atom_site:{auth_asym_id:fp,auth_atom_id:fp,auth_comp_id:fp,auth_seq_id:pp,B_iso_or_equiv:gp,Cartn_x:yp,Cartn_y:yp,Cartn_z:yp,group_PDB:bp(fp),id:pp,label_alt_id:fp,label_asym_id:fp,label_atom_id:fp,label_comp_id:fp,label_entity_id:fp,label_seq_id:pp,occupancy:gp,type_symbol:fp,pdbx_PDB_ins_code:fp,pdbx_PDB_model_num:pp,pdbx_formal_charge:pp,pdbx_label_index:pp,pdbx_sifts_xref_db_name:fp,pdbx_sifts_xref_db_acc:fp,pdbx_sifts_xref_db_num:fp,pdbx_sifts_xref_db_res:fp,ihm_model_id:pp},atom_site_anisotrop:{id:pp,type_symbol:fp,U:_p(3,3),U_esd:_p(3,3),pdbx_auth_seq_id:fp,pdbx_auth_asym_id:fp,pdbx_auth_atom_id:fp,pdbx_auth_comp_id:fp,pdbx_label_seq_id:pp,pdbx_label_alt_id:fp,pdbx_label_asym_id:fp,pdbx_label_atom_id:fp,pdbx_label_comp_id:fp,pdbx_PDB_ins_code:fp},atom_sites:{entry_id:fp,fract_transf_matrix:_p(3,3),fract_transf_vector:xp(3)},audit_author:{name:fp,pdbx_ordinal:pp,identifier_ORCID:fp},audit_conform:{dict_location:fp,dict_name:fp,dict_version:fp},cell:{angle_alpha:gp,angle_beta:gp,angle_gamma:gp,entry_id:fp,length_a:gp,length_b:gp,length_c:gp,Z_PDB:pp,pdbx_unique_axis:fp},chem_comp:{formula:fp,formula_weight:gp,id:fp,mon_nstd_flag:bp(vp),name:fp,type:bp(vp),pdbx_synonyms:wp(";",(r=>r))},chem_comp_bond:{atom_id_1:fp,atom_id_2:fp,comp_id:fp,value_order:bp(vp),pdbx_ordinal:pp,pdbx_stereo_config:bp(vp),pdbx_aromatic_flag:bp(vp)},citation:{book_publisher:fp,country:fp,id:fp,journal_abbrev:fp,journal_id_ASTM:fp,journal_id_CSD:fp,journal_id_ISSN:fp,journal_volume:fp,page_first:fp,page_last:fp,title:fp,year:pp,pdbx_database_id_DOI:fp,pdbx_database_id_PubMed:pp},citation_author:{citation_id:fp,name:fp,ordinal:pp},database_2:{database_id:bp(vp),database_code:fp},entity:{details:fp,formula_weight:gp,id:fp,src_method:bp(vp),type:bp(vp),pdbx_description:wp(",",(r=>r)),pdbx_number_of_molecules:pp,pdbx_mutation:fp,pdbx_fragment:fp,pdbx_ec:wp(",",(r=>r))},entity_poly:{entity_id:fp,nstd_linkage:bp(vp),nstd_monomer:bp(vp),type:bp(fp),pdbx_strand_id:wp(",",(r=>r)),pdbx_seq_one_letter_code:fp,pdbx_seq_one_letter_code_can:fp,pdbx_target_identifier:fp},entity_poly_seq:{entity_id:fp,hetero:bp(vp),mon_id:fp,num:pp},entry:{id:fp},exptl:{entry_id:fp,method:bp(fp)},software:{classification:fp,date:fp,description:fp,name:fp,type:bp(vp),version:fp,pdbx_ordinal:pp},struct:{entry_id:fp,title:fp,pdbx_descriptor:fp},struct_asym:{details:fp,entity_id:fp,id:fp,pdbx_modified:fp,pdbx_blank_PDB_chainid_flag:bp(fp)},struct_conf:{beg_label_asym_id:fp,beg_label_comp_id:fp,beg_label_seq_id:pp,beg_auth_asym_id:fp,beg_auth_comp_id:fp,beg_auth_seq_id:pp,conf_type_id:bp(vp),details:fp,end_label_asym_id:fp,end_label_comp_id:fp,end_label_seq_id:pp,end_auth_asym_id:fp,end_auth_comp_id:fp,end_auth_seq_id:pp,id:fp,pdbx_beg_PDB_ins_code:fp,pdbx_end_PDB_ins_code:fp,pdbx_PDB_helix_class:fp,pdbx_PDB_helix_length:pp,pdbx_PDB_helix_id:fp},struct_conn:{conn_type_id:bp(vp),details:fp,id:fp,ptnr1_label_asym_id:fp,ptnr1_label_atom_id:fp,ptnr1_label_comp_id:fp,ptnr1_label_seq_id:pp,ptnr1_auth_asym_id:fp,ptnr1_auth_comp_id:fp,ptnr1_auth_seq_id:pp,ptnr1_symmetry:fp,ptnr2_label_asym_id:fp,ptnr2_label_atom_id:fp,ptnr2_label_comp_id:fp,ptnr2_label_seq_id:pp,ptnr2_auth_asym_id:fp,ptnr2_auth_comp_id:fp,ptnr2_auth_seq_id:pp,ptnr2_symmetry:fp,pdbx_ptnr1_PDB_ins_code:fp,pdbx_ptnr1_label_alt_id:fp,pdbx_ptnr1_standard_comp_id:fp,pdbx_ptnr2_PDB_ins_code:fp,pdbx_ptnr2_label_alt_id:fp,pdbx_ptnr3_PDB_ins_code:fp,pdbx_ptnr3_label_alt_id:fp,pdbx_ptnr3_label_asym_id:fp,pdbx_ptnr3_label_atom_id:fp,pdbx_ptnr3_label_comp_id:fp,pdbx_ptnr3_label_seq_id:pp,pdbx_PDB_id:fp,pdbx_dist_value:gp,pdbx_value_order:bp(vp)},struct_conn_type:{criteria:fp,id:bp(vp),reference:fp},struct_keywords:{entry_id:fp,text:wp(",",(r=>r)),pdbx_keywords:fp},struct_ncs_oper:{code:bp(fp),details:fp,id:pp,matrix:_p(3,3),vector:xp(3)},struct_sheet_range:{beg_label_asym_id:fp,beg_label_comp_id:fp,beg_label_seq_id:pp,end_label_asym_id:fp,end_label_comp_id:fp,end_label_seq_id:pp,beg_auth_asym_id:fp,beg_auth_comp_id:fp,beg_auth_seq_id:pp,end_auth_asym_id:fp,end_auth_comp_id:fp,end_auth_seq_id:pp,id:fp,sheet_id:fp,pdbx_beg_PDB_ins_code:fp,pdbx_end_PDB_ins_code:fp},struct_site:{details:fp,id:fp,pdbx_num_residues:pp,pdbx_evidence_code:fp,pdbx_auth_asym_id:fp,pdbx_auth_comp_id:fp,pdbx_auth_seq_id:fp,pdbx_auth_ins_code:fp},struct_site_gen:{details:fp,id:fp,label_alt_id:fp,label_asym_id:fp,label_atom_id:fp,label_comp_id:fp,label_seq_id:pp,auth_asym_id:fp,auth_comp_id:fp,auth_seq_id:fp,site_id:fp,symmetry:fp,pdbx_auth_ins_code:fp,pdbx_num_res:pp},symmetry:{entry_id:fp,cell_setting:bp(vp),Int_Tables_number:pp,space_group_name_Hall:fp,"space_group_name_H-M":fp},pdbx_database_status:{status_code:bp(fp),status_code_sf:bp(fp),status_code_mr:bp(fp),entry_id:fp,recvd_initial_deposition_date:fp,SG_entry:bp(vp),deposit_site:bp(fp),process_site:bp(fp),status_code_cs:bp(fp),methods_development_category:bp(fp),pdb_format_compatible:bp(vp)},pdbx_nonpoly_scheme:{asym_id:fp,entity_id:fp,mon_id:fp,pdb_strand_id:fp,ndb_seq_num:fp,pdb_seq_num:fp,auth_seq_num:fp,pdb_mon_id:fp,auth_mon_id:fp,pdb_ins_code:fp},pdbx_database_related:{db_name:fp,details:fp,db_id:fp,content_type:bp(fp)},pdbx_entity_nonpoly:{entity_id:fp,comp_id:fp,name:fp},pdbx_chem_comp_synonyms:{name:fp,comp_id:fp,provenance:bp(fp)},pdbx_chem_comp_identifier:{comp_id:fp,identifier:fp,type:bp(fp),program:fp,program_version:fp},pdbx_unobs_or_zero_occ_residues:{id:pp,polymer_flag:bp(vp),occupancy_flag:bp(pp),PDB_model_num:pp,auth_asym_id:fp,auth_comp_id:fp,auth_seq_id:fp,PDB_ins_code:fp,label_asym_id:fp,label_comp_id:fp,label_seq_id:pp},pdbx_struct_mod_residue:{id:pp,auth_asym_id:fp,auth_comp_id:fp,auth_seq_id:pp,PDB_ins_code:fp,label_asym_id:fp,label_comp_id:fp,label_seq_id:pp,parent_comp_id:fp,details:fp},pdbx_struct_oper_list:{id:fp,type:bp(fp),name:fp,symmetry_operation:fp,matrix:_p(3,3),vector:xp(3)},pdbx_struct_assembly:{method_details:fp,oligomeric_details:fp,oligomeric_count:pp,details:fp,id:fp},pdbx_struct_assembly_gen:{asym_id_list:wp(",",(r=>r)),assembly_id:fp,oper_expression:fp},pdbx_reference_entity_list:{prd_id:fp,ref_entity_id:fp,type:bp(vp),details:fp,component_id:pp},pdbx_reference_entity_link:{link_id:pp,prd_id:fp,details:fp,ref_entity_id_1:fp,ref_entity_id_2:fp,entity_seq_num_1:pp,entity_seq_num_2:pp,comp_id_1:fp,comp_id_2:fp,atom_id_1:fp,atom_id_2:fp,value_order:bp(vp),component_1:pp,component_2:pp,link_class:bp(fp)},pdbx_reference_entity_poly_link:{link_id:pp,prd_id:fp,ref_entity_id:fp,component_id:pp,entity_seq_num_1:pp,entity_seq_num_2:pp,comp_id_1:fp,comp_id_2:fp,atom_id_1:fp,atom_id_2:fp,value_order:bp(vp)},pdbx_molecule:{prd_id:fp,instance_id:pp,asym_id:fp},pdbx_molecule_features:{prd_id:fp,class:bp(vp),type:bp(vp),name:fp,details:fp},entity_src_nat:{entity_id:fp,pdbx_organism_scientific:fp,pdbx_plasmid_name:fp,pdbx_src_id:pp,pdbx_beg_seq_num:pp,pdbx_end_seq_num:pp},entity_src_gen:{entity_id:fp,pdbx_gene_src_gene:wp(",",(r=>r)),pdbx_gene_src_scientific_name:fp,plasmid_name:fp,pdbx_src_id:pp,pdbx_beg_seq_num:pp,pdbx_end_seq_num:pp},pdbx_entity_src_syn:{organism_scientific:fp,entity_id:fp,pdbx_src_id:pp,pdbx_beg_seq_num:pp,pdbx_end_seq_num:pp},pdbx_entity_branch_descriptor:{entity_id:fp,descriptor:fp,type:bp(vp),program:fp,program_version:fp,ordinal:pp},pdbx_entity_instance_feature:{details:fp,feature_type:bp(fp),auth_asym_id:fp,asym_id:fp,auth_seq_num:fp,seq_num:pp,comp_id:fp,auth_comp_id:fp,ordinal:pp},pdbx_entity_branch_list:{entity_id:fp,hetero:bp(vp),comp_id:fp,num:pp},pdbx_entity_branch_link:{link_id:pp,details:fp,entity_id:fp,entity_branch_list_num_1:pp,entity_branch_list_num_2:pp,comp_id_1:fp,comp_id_2:fp,atom_id_1:fp,leaving_atom_id_1:fp,atom_stereo_config_1:bp(vp),atom_id_2:fp,leaving_atom_id_2:fp,atom_stereo_config_2:bp(vp),value_order:bp(vp)},pdbx_entity_branch:{entity_id:fp,type:bp(fp)},pdbx_branch_scheme:{entity_id:fp,hetero:bp(vp),asym_id:fp,mon_id:fp,num:pp,pdb_asym_id:fp,pdb_seq_num:fp,pdb_mon_id:fp,auth_asym_id:fp,auth_seq_num:fp,auth_mon_id:fp},pdbx_chem_comp_related:{comp_id:fp,related_comp_id:fp,relationship_type:bp(fp),details:fp},ihm_starting_model_details:{starting_model_id:fp,entity_id:fp,entity_description:fp,asym_id:fp,entity_poly_segment_id:pp,starting_model_source:bp(fp),starting_model_auth_asym_id:fp,starting_model_sequence_offset:pp,dataset_list_id:pp},ihm_starting_comparative_models:{id:pp,starting_model_id:fp,starting_model_auth_asym_id:fp,starting_model_seq_id_begin:pp,starting_model_seq_id_end:pp,template_auth_asym_id:fp,template_seq_id_begin:pp,template_seq_id_end:pp,template_sequence_identity:gp,template_sequence_identity_denominator:bp(pp),template_dataset_list_id:pp,alignment_file_id:pp},ihm_starting_model_seq_dif:{id:pp,entity_id:fp,asym_id:fp,seq_id:pp,comp_id:fp,starting_model_id:fp,db_asym_id:fp,db_seq_id:pp,db_comp_id:fp,details:fp},ihm_model_representation:{id:pp,name:fp,details:fp},ihm_model_representation_details:{id:pp,representation_id:pp,entity_poly_segment_id:pp,entity_id:fp,entity_description:fp,entity_asym_id:fp,model_object_primitive:bp(fp),starting_model_id:fp,model_mode:bp(fp),model_granularity:bp(fp),model_object_count:pp},ihm_struct_assembly_details:{id:pp,assembly_id:pp,parent_assembly_id:pp,entity_description:fp,entity_id:fp,asym_id:fp,entity_poly_segment_id:pp},ihm_struct_assembly:{id:pp,name:fp,description:fp},ihm_modeling_protocol:{id:pp,num_steps:pp,protocol_name:fp},ihm_modeling_protocol_details:{id:pp,protocol_id:pp,step_id:pp,struct_assembly_id:pp,dataset_group_id:pp,struct_assembly_description:fp,step_name:fp,step_method:fp,num_models_begin:pp,num_models_end:pp,multi_scale_flag:bp(vp),multi_state_flag:bp(vp),ordered_flag:bp(vp),script_file_id:pp,software_id:pp},ihm_multi_state_modeling:{state_id:pp,state_group_id:pp,population_fraction:gp,population_fraction_sd:gp,state_type:fp,state_name:fp,experiment_type:bp(fp),details:fp},ihm_modeling_post_process:{id:pp,protocol_id:pp,analysis_id:pp,step_id:pp,type:bp(fp),feature:bp(fp),num_models_begin:pp,num_models_end:pp},ihm_ensemble_info:{ensemble_id:pp,ensemble_name:fp,post_process_id:pp,model_group_id:pp,ensemble_clustering_method:bp(fp),ensemble_clustering_feature:bp(fp),num_ensemble_models:pp,num_ensemble_models_deposited:pp,ensemble_precision_value:gp,ensemble_file_id:pp},ihm_model_list:{model_id:pp,model_name:fp,assembly_id:pp,protocol_id:pp,representation_id:pp},ihm_model_group:{id:pp,name:fp,details:fp},ihm_model_group_link:{model_id:pp,group_id:pp},ihm_model_representative:{id:pp,model_group_id:pp,model_id:pp,selection_criteria:bp(fp)},ihm_dataset_list:{id:pp,data_type:bp(fp),database_hosted:bp(vp)},ihm_dataset_group:{id:pp,name:fp,application:bp(fp),details:fp},ihm_dataset_group_link:{dataset_list_id:pp,group_id:pp},ihm_related_datasets:{dataset_list_id_derived:pp,dataset_list_id_primary:pp},ihm_dataset_related_db_reference:{id:pp,dataset_list_id:pp,db_name:bp(fp),accession_code:fp,version:fp,details:fp},ihm_external_reference_info:{reference_id:pp,reference_provider:fp,reference_type:bp(fp),reference:fp,refers_to:bp(fp),associated_url:fp},ihm_external_files:{id:pp,reference_id:pp,file_path:fp,content_type:bp(fp),file_size_bytes:gp,details:fp},ihm_dataset_external_reference:{id:pp,dataset_list_id:pp,file_id:pp},ihm_localization_density_files:{id:pp,file_id:pp,ensemble_id:pp,entity_id:fp,entity_poly_segment_id:pp,asym_id:fp},ihm_predicted_contact_restraint:{id:pp,group_id:pp,entity_id_1:fp,entity_id_2:fp,asym_id_1:fp,asym_id_2:fp,comp_id_1:fp,comp_id_2:fp,seq_id_1:pp,seq_id_2:pp,rep_atom_1:bp(fp),rep_atom_2:bp(fp),distance_lower_limit:gp,distance_upper_limit:gp,probability:gp,restraint_type:bp(fp),model_granularity:bp(fp),dataset_list_id:pp,software_id:pp},ihm_cross_link_list:{id:pp,group_id:pp,entity_description_1:fp,entity_description_2:fp,entity_id_1:fp,entity_id_2:fp,comp_id_1:fp,comp_id_2:fp,seq_id_1:pp,seq_id_2:pp,linker_type:bp(fp),dataset_list_id:pp},ihm_cross_link_restraint:{id:pp,group_id:pp,entity_id_1:fp,entity_id_2:fp,asym_id_1:fp,asym_id_2:fp,comp_id_1:fp,comp_id_2:fp,seq_id_1:pp,seq_id_2:pp,atom_id_1:fp,atom_id_2:fp,restraint_type:bp(fp),conditional_crosslink_flag:bp(fp),model_granularity:bp(fp),distance_threshold:gp,psi:gp,sigma_1:gp,sigma_2:gp},ihm_cross_link_result_parameters:{id:pp,restraint_id:pp,model_id:pp,psi:gp,sigma_1:gp,sigma_2:gp},ihm_2dem_class_average_restraint:{id:pp,dataset_list_id:pp,number_raw_micrographs:pp,pixel_size_width:gp,pixel_size_height:gp,image_resolution:gp,image_segment_flag:bp(vp),number_of_projections:pp,struct_assembly_id:pp,details:fp},ihm_2dem_class_average_fitting:{id:pp,restraint_id:pp,model_id:pp,cross_correlation_coefficient:gp,rot_matrix:_p(3,3),tr_vector:xp(3)},ihm_3dem_restraint:{id:pp,dataset_list_id:pp,model_id:pp,struct_assembly_id:pp,fitting_method:fp,number_of_gaussians:pp,cross_correlation_coefficient:gp},ihm_sas_restraint:{id:pp,dataset_list_id:pp,model_id:pp,struct_assembly_id:pp,profile_segment_flag:bp(vp),fitting_atom_type:fp,fitting_method:fp,fitting_state:bp(fp),radius_of_gyration:gp,chi_value:gp,details:fp},ihm_starting_model_coord:{ordinal_id:pp,starting_model_id:fp,group_PDB:bp(fp),id:pp,type_symbol:fp,entity_id:fp,atom_id:fp,comp_id:fp,seq_id:pp,asym_id:fp,Cartn_x:gp,Cartn_y:gp,Cartn_z:gp,B_iso_or_equiv:gp},ihm_sphere_obj_site:{id:pp,entity_id:fp,seq_id_begin:pp,seq_id_end:pp,asym_id:fp,Cartn_x:gp,Cartn_y:gp,Cartn_z:gp,object_radius:gp,rmsf:gp,model_id:pp},ihm_gaussian_obj_site:{id:pp,entity_id:fp,seq_id_begin:pp,seq_id_end:pp,asym_id:fp,mean_Cartn_x:gp,mean_Cartn_y:gp,mean_Cartn_z:gp,weight:gp,covariance_matrix:_p(3,3),model_id:pp},ihm_gaussian_obj_ensemble:{id:pp,entity_id:fp,seq_id_begin:pp,seq_id_end:pp,asym_id:fp,mean_Cartn_x:gp,mean_Cartn_y:gp,mean_Cartn_z:gp,weight:gp,covariance_matrix:_p(3,3),ensemble_id:pp},ihm_feature_list:{feature_id:pp,feature_type:bp(fp),entity_type:bp(fp)},ihm_poly_residue_feature:{ordinal_id:pp,feature_id:pp,entity_id:fp,asym_id:fp,comp_id_begin:fp,comp_id_end:fp,seq_id_begin:pp,seq_id_end:pp},ihm_derived_distance_restraint:{id:pp,group_id:pp,feature_id_1:pp,feature_id_2:pp,group_conditionality:bp(fp),random_exclusion_fraction:gp,distance_upper_limit:gp,restraint_type:bp(fp),dataset_list_id:pp},ma_model_list:{ordinal_id:pp,model_id:pp,model_group_id:pp,model_name:fp,model_group_name:fp,model_type:bp(fp),data_id:pp},ma_target_entity:{entity_id:fp,data_id:pp,origin:bp(fp)},ma_target_entity_instance:{asym_id:fp,entity_id:fp,details:fp},ma_target_ref_db_details:{target_entity_id:fp,db_name:bp(fp),db_code:fp,db_accession:fp,seq_db_isoform:fp,seq_db_align_begin:fp,seq_db_align_end:fp,ncbi_taxonomy_id:fp,organism_scientific:fp},ma_data:{id:pp,content_type:bp(fp),content_type_other_details:fp,name:fp},ma_software_group:{ordinal_id:pp,group_id:pp,software_id:pp},ma_qa_metric:{id:pp,name:fp,type:bp(fp),mode:bp(fp),software_group_id:pp},ma_qa_metric_global:{ordinal_id:pp,model_id:pp,metric_id:pp,metric_value:gp},ma_qa_metric_local:{ordinal_id:pp,model_id:pp,label_asym_id:fp,label_seq_id:pp,label_comp_id:fp,metric_id:pp,metric_value:gp}};var Sp=sm.Schema;const Cp=Sp.str,Pp=Sp.float,Ip=Sp.List,kp=Sp.lstr,Mp=Sp.Aliased,Tp=Sp.int,Dp=Sp.coord,Bp={chem_comp:{formula:Cp,formula_weight:Pp,id:Cp,mon_nstd_parent_comp_id:Ip(",",(r=>r)),name:Cp,one_letter_code:Cp,three_letter_code:Cp,type:Mp(kp),pdbx_synonyms:Ip(";",(r=>r)),pdbx_type:Cp,pdbx_ambiguous_flag:Cp,pdbx_replaced_by:Cp,pdbx_replaces:Cp,pdbx_formal_charge:Tp,pdbx_model_coordinates_details:Cp,pdbx_model_coordinates_db_code:Cp,pdbx_ideal_coordinates_details:Cp,pdbx_ideal_coordinates_missing_flag:Mp(kp),pdbx_model_coordinates_missing_flag:Mp(kp),pdbx_initial_date:Cp,pdbx_modified_date:Cp,pdbx_release_status:Mp(Cp),pdbx_processing_site:Mp(Cp)},chem_comp_atom:{alt_atom_id:Cp,atom_id:Cp,charge:Tp,model_Cartn_x:Dp,model_Cartn_y:Dp,model_Cartn_z:Dp,comp_id:Cp,type_symbol:Cp,pdbx_align:Tp,pdbx_ordinal:Tp,pdbx_model_Cartn_x_ideal:Dp,pdbx_model_Cartn_y_ideal:Dp,pdbx_model_Cartn_z_ideal:Dp,pdbx_stereo_config:Mp(kp),pdbx_aromatic_flag:Mp(kp),pdbx_leaving_atom_flag:Mp(kp)},chem_comp_bond:{atom_id_1:Cp,atom_id_2:Cp,comp_id:Cp,value_order:Mp(kp),pdbx_ordinal:Tp,pdbx_stereo_config:Mp(kp),pdbx_aromatic_flag:Mp(kp)},pdbx_chem_comp_descriptor:{comp_id:Cp,descriptor:Cp,type:Mp(kp),program:Cp,program_version:Cp},pdbx_chem_comp_identifier:{comp_id:Cp,identifier:Cp,type:Mp(Cp),program:Cp,program_version:Cp}};var Fp=sm.Schema;const Ep=Fp.str,$p=Fp.float,Op=Fp.lstr,Rp=Fp.Aliased,Lp=Fp.int,Np={pdbx_reference_molecule:{prd_id:Ep,formula_weight:$p,formula:Ep,type:Rp(Op),type_evidence_code:Ep,class:Rp(Op),class_evidence_code:Ep,name:Ep,represent_as:Rp(Op),chem_comp_id:Ep,compound_details:Ep,description:Ep,representative_PDB_id_code:Ep,release_status:Rp(Op),replaces:Ep,replaced_by:Ep},pdbx_reference_entity_list:{prd_id:Ep,ref_entity_id:Ep,type:Rp(Op),details:Ep,component_id:Lp},pdbx_reference_entity_nonpoly:{prd_id:Ep,ref_entity_id:Ep,name:Ep,chem_comp_id:Ep},pdbx_reference_entity_link:{link_id:Lp,prd_id:Ep,details:Ep,ref_entity_id_1:Ep,ref_entity_id_2:Ep,entity_seq_num_1:Lp,entity_seq_num_2:Lp,comp_id_1:Ep,comp_id_2:Ep,atom_id_1:Ep,atom_id_2:Ep,value_order:Rp(Op),component_1:Lp,component_2:Lp,link_class:Rp(Ep)},pdbx_reference_entity_poly_link:{link_id:Lp,prd_id:Ep,ref_entity_id:Ep,component_id:Lp,entity_seq_num_1:Lp,entity_seq_num_2:Lp,comp_id_1:Ep,comp_id_2:Ep,atom_id_1:Ep,atom_id_2:Ep,value_order:Rp(Op)},pdbx_reference_entity_poly:{prd_id:Ep,ref_entity_id:Ep,type:Rp(Ep),db_code:Ep,db_name:Ep},pdbx_reference_entity_poly_seq:{prd_id:Ep,ref_entity_id:Ep,mon_id:Ep,parent_mon_id:Ep,num:Lp,observed:Rp(Op),hetero:Rp(Op)},pdbx_reference_entity_sequence:{prd_id:Ep,ref_entity_id:Ep,type:Rp(Ep),NRP_flag:Rp(Ep),one_letter_codes:Ep},pdbx_reference_entity_src_nat:{prd_id:Ep,ref_entity_id:Ep,ordinal:Lp,organism_scientific:Ep,taxid:Ep,db_code:Ep,db_name:Ep},pdbx_prd_audit:{prd_id:Ep,date:Ep,processing_site:Rp(Ep),action_type:Rp(Ep)}};var zp=sm.Schema;const Up=zp.str,Vp={datablock:{id:Up,description:Up},dictionary:{title:Up,datablock_id:Up,version:Up},dictionary_history:{version:Up,update:Up,revision:Up},sub_category:{id:Up,description:Up},category_group_list:{id:Up,parent_id:Up,description:Up},item_type_list:{code:Up,primitive_code:Up,construct:Up,detail:Up},item_units_list:{code:Up,detail:Up},item_units_conversion:{from_code:Up,to_code:Up,operator:Up,factor:zp.float}};var jp=sm.Schema;const Gp=jp.str,Hp=jp.int,qp=jp.float,Wp=jp.Aliased,Xp=jp.Vector;Wp(Gp),Wp(Gp),Wp(Gp),Wp(Gp),Xp(3),Xp(3);const Yp={volume_data_3d_info:{name:Gp,axis_order:Xp(3,Hp),origin:Xp(3),dimensions:Xp(3),sample_rate:Hp,sample_count:Xp(3,Hp),spacegroup_number:Hp,spacegroup_cell_size:Xp(3),spacegroup_cell_angles:Xp(3),mean_source:qp,mean_sampled:qp,sigma_source:qp,sigma_sampled:qp,min_source:qp,min_sampled:qp,max_source:qp,max_sampled:qp},volume_data_3d:{values:qp}};var Kp=sm.Schema;const Zp=Kp.float,Qp=Kp.int,Jp=Kp.str,tg={cell:{angle_alpha:Zp,angle_beta:Zp,angle_gamma:Zp,formula_units_z:Qp,length_a:Zp,length_b:Zp,length_c:Zp,volume:Zp},chemical:{melting_point:Zp,name_common:Jp,name_systematic:Jp},chemical_formula:{moiety:Jp,sum:Jp,weight:Zp},space_group:{crystal_system:Jp,it_number:Qp,"name_h-m_full":Jp},space_group_symop:{operation_xyz:Jp},geom_bond:{atom_site_label_1:Jp,atom_site_label_2:Jp,distance:Zp,publ_flag:Jp,site_symmetry_1:Jp,site_symmetry_2:Jp,valence:Zp},audit:{block_doi:Jp},database_code:{cod:Jp,csd:Jp,depnum_ccdc_archive:Jp,depnum_ccdc_fiz:Jp,icsd:Jp,mdf:Jp,nbs:Jp},atom_site:{adp_type:Jp,calc_flag:Jp,disorder_assembly:Jp,disorder_group:Jp,fract_x:Zp,fract_y:Zp,fract_z:Zp,label:Jp,occupancy:Zp,refinement_flags:Jp,site_symmetry_multiplicity:Qp,type_symbol:Jp,u_iso_or_equiv:Zp},atom_site_aniso:{label:Jp,u_11:Zp,u:(0,Kp.Matrix)(3,3),u_12:Zp,u_13:Zp,u_22:Zp,u_23:Zp,u_33:Zp},atom_type:{description:Jp,symbol:Jp},atom_type_scat:{dispersion_imag:Zp,dispersion_real:Zp,source:Jp}},eg={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},ig=sm.Schema.int,rg={volume_data_3d_info:Yp.volume_data_3d_info,segmentation_data_table:{set_id:ig,segment_id:ig},segmentation_data_3d:{values:ig}},ng={parse:r=>typeof r=="string"?Bf(r):rp(r),parseText:Bf,parseBinary:rp,toDatabaseCollection:function(r,e,t){const n={};for(const i of e.blocks)n[i.header]=sp(r,i,t);return n},toDatabase:sp,schema:{mmCIF:r=>sp(Ap,r),CCD:r=>sp(Bp,r),BIRD:r=>sp(Np,r),dic:r=>sp(Vp,r),cifCore:r=>sp(tg,r,eg),densityServer:r=>sp(Yp,r),segmentation:r=>sp(rg,r)}};class sg{constructor(e,t){var n=t||{};this.streamer=e,this.name=nt(n.name,""),this.path=nt(n.path,"")}get type(){return""}get __objName(){return""}get isBinary(){return!1}get isJson(){return!1}get isXml(){return!1}parse(){return this.streamer.read().then((()=>Nl(this,void 0,void 0,(function*(){return yield this._beforeParse(),yield this._parse(),yield this._afterParse(),this[this.__objName]}))))}_parse(){}_beforeParse(){}_afterParse(){De&&ke.log(this[this.__objName])}}class og extends sg{constructor(e,t){var n=t||{};super(e,n),this.firstModelOnly=nt(n.firstModelOnly,!1),this.asTrajectory=nt(n.asTrajectory,!1),this.cAlphaOnly=nt(n.cAlphaOnly,!1),this.structure=new Sc(this.name,this.path),this.structureBuilder=new Na(this.structure)}get type(){return"structure"}get __objName(){return"structure"}}class ag{constructor(e,t,n="",i,s=[]){this.structure=e,this.index=t,this.description=n,this.entityType=(function(o){switch(o=o.toLowerCase()){case"polymer":return 1;case"non-polymer":return 2;case"macrolide":return 3;case"water":return 4;default:return 0}})(i||""),this.chainIndexList=s,s.forEach((function(o){e.chainStore.entityIndex[o]=t}))}get type(){return(function(e){switch(e){case 1:return"polymer";case 2:return"non-polymer";case 3:return"macrolide";case 4:return"water";default:return}})(this.entityType)}getEntityType(){return this.entityType}isPolymer(){return this.entityType===1}isNonPolymer(){return this.entityType===2}isMacrolide(){return this.entityType===3}isWater(){return this.entityType===4}eachChain(e){const t=this.structure.getChainProxy();this.chainIndexList.forEach((function(n){t.index=n,e(t)}))}}const cg={a:1,b:1,c:1,alpha:90,beta:90,gamma:90,spacegroup:"P 1"};class lg{constructor(e=cg){this.cartToFrac=new Matrix4,this.fracToCart=new Matrix4,this.a=e.a,this.b=e.b,this.c=e.c,this.alpha=e.alpha,this.beta=e.beta,this.gamma=e.gamma,this.spacegroup=e.spacegroup;const t=It(this.alpha),n=It(this.beta),i=It(this.gamma),s=Math.cos(t),o=Math.cos(n),a=Math.cos(i),l=Math.sin(n),d=Math.sin(i);if(this.volume=this.a*this.b*this.c*Math.sqrt(1-s*s-o*o-a*a+2*s*o*a),e.cartToFrac===void 0){const u=this.a*this.b*d/this.volume,g=(o*a-s)/(l*d);this.fracToCart.set(this.a,0,0,0,this.b*a,this.b*d,0,0,this.c*o,-this.c*l*g,1/u,0,0,0,0,1).transpose(),this.cartToFrac.copy(this.fracToCart).invert()}else this.cartToFrac.copy(e.cartToFrac),this.fracToCart.copy(this.cartToFrac).invert()}getPosition(e){const t=new Float32Array(24);if(e.unitcell){const n=e.unitcell,i=e.center.clone().applyMatrix4(n.cartToFrac).floor(),s=new Vector3;let o=0;const a=function(l,d,u){s.set(l,d,u).add(i).applyMatrix4(n.fracToCart).toArray(t,o),o+=3};a(0,0,0),a(1,0,0),a(0,1,0),a(0,0,1),a(1,1,0),a(1,0,1),a(0,1,1),a(1,1,1)}return t}getCenter(e){return(function(t,n=new Vector3){const i=t.length;for(let s=0;s<i;s+=3)n.x+=t[s],n.y+=t[s+1],n.z+=t[s+2];return n.divideScalar(i/3),n})(this.getPosition(e))}getData(e,t={}){const n=nt(t.colorValue,"orange"),i=nt(t.radius,Math.cbrt(this.volume)/200),s=new Color(n),o=new Vector3,a=this.getPosition(e),l=Si(8,s.r,s.g,s.b),d=Ai(8,i),u=new Float32Array(36),g=new Float32Array(36),x=Si(12,s.r,s.g,s.b),y=Ai(12,i);let b=0;function _(f,E){o.fromArray(a,3*f).toArray(u,b),o.fromArray(a,3*E).toArray(g,b),b+=3}_(0,1),_(0,2),_(0,3),_(1,4),_(1,5),_(2,6),_(3,5),_(4,7),_(5,7),_(2,4),_(7,6),_(3,6);const h=new ro(this,e);return{vertex:{position:a,color:l,radius:d,picking:h},edge:{position1:u,position2:g,color:x,color2:x,radius:y,picking:h}}}}const hg={1:"h",2:"h",3:"i",4:"h",5:"g",6:"h",7:"h",8:"h",9:"h",10:"h",0:"h"},ug=["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"],dg=["MOL_ID","MOLECULE","CHAIN","FRAGMENT","SYNONYM","EC","ENGINEERED","MUTATION","OTHER_DETAILS"],mg=/\s+/;function fg(r,e,t){let n=`${r}`;return e&&(n+=`:${e}`),t&&(n+=`^${t}`),n}class pg extends og{constructor(e,t){const n=t||{};super(e,n),this.hex=nt(n.hex,!1),this.inferBonds=nt(n.inferBonds,"all")}get type(){return"pdb"}_parse(){De&&ke.time("PdbParser._parse "+this.name);let e=!1;const t=this.streamer.peekLines(1)[0],n=t.substr(62,4),i=t.substr(72,4);n===i&&i.trim()&&(e=!0);const s=this.type==="pqr",o=this.type==="pdbqt",a=this.structure,l=this.structureBuilder,d=this.hex;let u=10,g=10;const x=this.firstModelOnly,y=this.asTrajectory,b=this.cAlphaOnly,_=a.frames,h=a.boxes;let f,E,m=!1;const S=a.biomolDict;let w,v,A,M,T,R,P,L,O,I,N,k,U,F,j,H,B,V,K,q,Te,Fe,We={};const J={},et={},ht=[];let er,tr;const Hm={},oi={},h0={};let l0,M0,U0,_0,C0,P0,R0;const si={};let Xe;const d0={helices:[],sheets:[]},w0=d0.helices,Q=d0.sheets,it=a.atomMap,ec=a.atomStore;ec.resize(Math.round(this.streamer.data.length/80)),(s||o)&&ec.addField("partialCharge",1,"float32"),s&&ec.addField("radius",1,"float32");const a0=a.getAtomProxy(),u0=a.getAtomProxy();let E0=0,O0=0,He=!0;this.streamer.eachChunkOfLines((function(x0){(function(L0,c0,b0){for(let ut=L0;ut<c0;++ut)if(M=b0[ut],T=M.substr(0,6),T==="ATOM  "||T==="HETATM"){if(He&&(y?(m?(f=new Float32Array(3*ec.count),_.push(f)):f=[],E=0):x||(We={}),l0=1,M0=l0.toString(),U0=!0,He=!1),x&&O0>0)continue;let hi,S0,W,t0,o0,Ji=0;if(s){if(t0=M.split(mg),Ji=t0.length===10?1:0,k=t0[2],b&&k!=="CA")continue;hi=parseFloat(t0[6-Ji]),S0=parseFloat(t0[7-Ji]),W=parseFloat(t0[8-Ji])}else{if(k=M.substr(12,4).trim(),b&&k!=="CA")continue;hi=parseFloat(M.substr(30,8)),S0=parseFloat(M.substr(38,8)),W=parseFloat(M.substr(46,8))}if(y){const I0=3*E;if(f[I0+0]=hi,f[I0+1]=S0,f[I0+2]=W,E+=1,m)continue}s?(R=parseInt(t0[1]),o0="",U=M[0]==="H",P=Ji?"":t0[4],L=parseInt(t0[5-Ji]),N="",O=t0[3],j="",I=1):(R=parseInt(M.substr(6,5),u),d&&R===99999&&(u=16),U=M[0]==="H",P=M[21].trim(),L=parseInt(M.substr(22,4),g),d&&L===9999&&(g=16),N=M[26].trim(),O=M.substr(17,4).trim()||"MOL",F=parseFloat(M.substr(60,6)),j=M[16].trim(),I=parseFloat(M.substr(54,6)),e||(o?(o0=M.substr(76,3).trim(),o0 in ms&&(o0=ms[o0])):(o0=M.substr(76,2).trim(),P||(P=M.substr(72,4).trim())),H=parseInt((M.substr(79,1)+M.substr(78,1)).trim()))),ec.growIfFull(),ec.atomTypeId[E0]=it.add(k,o0),ec.x[E0]=hi,ec.y[E0]=S0,ec.z[E0]=W,ec.serial[E0]=R,ec.altloc[E0]=j.charCodeAt(0),ec.occupancy[E0]=isNaN(I)?0:I,s?(ec.partialCharge[E0]=parseFloat(t0[9-Ji]),ec.radius[E0]=parseFloat(t0[10-Ji])):(ec.bfactor[E0]=isNaN(F)?0:F,o&&(ec.partialCharge[E0]=parseFloat(M.substr(70,6))),isFinite(H)&&(ec.formalCharge||ec.addField("formalCharge",1,"int8"),ec.formalCharge[E0]=H));const m0=fg(L,P,N);!U||oi[m0]||ug.includes(O)?U0||_0===P||(l0+=1,M0=l0.toString()):_0===P&&P0===O&&(as.includes(O)||C0===L&&R0===N)||(l0+=1,M0=l0.toString(),C0=L,P0=O,R0=N),l.addAtom(O0,P,M0,O,L,U,void 0,N),We[R]=E0,E0+=1,U0=!1,_0=P}else if(T==="CONECT"){const hi=We[parseInt(M.substr(6,5))],S0=[11,16,21,26],W={};if(hi===void 0)continue;for(let t0=0;t0<4;++t0){let o0=parseInt(M.substr(S0[t0],5));if(!Number.isNaN(o0)&&(o0=We[o0],o0!==void 0))if(hi<o0?(a0.index=hi,u0.index=o0):(a0.index=o0,u0.index=hi),W[o0]!==void 0)a.bondStore.bondOrder[W[o0]]+=1;else{const Ji=a0.index+"|"+u0.index;et[Ji]===void 0&&(et[Ji]=!0,W[o0]=a.bondStore.count,a.bondStore.addBond(a0,u0,1))}}}else if(T==="HELIX "){B=M[19].trim(),V=parseInt(M.substr(21,4)),K=M[25].trim(),q=M[31].trim(),Te=parseInt(M.substr(33,4)),Fe=M[37].trim();let hi=parseInt(M.substr(39,1));hi=(hg[hi]||hg[0]).charCodeAt(0),w0.push([B,V,K,q,Te,Fe,hi])}else if(T==="SHEET ")B=M[21].trim(),V=parseInt(M.substr(22,4)),K=M[26].trim(),q=M[32].trim(),Te=parseInt(M.substr(33,4)),Fe=M[37].trim(),Q.push([B,V,K,q,Te,Fe]);else if(T==="HETNAM")Hm[M.substr(11,3)]=M.substr(15).trim();else if(T==="SEQRES"){const hi=M[11].trim();hi!==Xe&&(si[hi]=[],Xe=hi),si[hi].push(...M.substr(19).trim().split(mg))}else if(T==="MODRES"){const hi=M.substr(12,3).trim(),S0=M[16].trim(),W=M[22].trim(),t0=parseInt(M.substr(18,4).trim()),o0=fg(t0,S0,W);oi[o0]={resname:hi,chainname:S0,inscode:W,resno:t0}}else if(T==="COMPND"){const hi=M.substr(10,70).trim(),S0=hi.indexOf(":"),W=hi.substring(0,S0);let t0;dg.includes(W)?(tr=W,t0=hi.substring(S0+2)):t0=hi,t0=t0.replace(/;$/,""),tr==="MOL_ID"?(er={chainList:[],name:""},ht.push(er)):tr==="MOLECULE"?(er.name&&(er.name+=" "),er.name+=t0):tr==="CHAIN"&&Array.prototype.push.apply(er.chainList,t0.split(/\s*,\s*/))}else if(M.startsWith("TER")){const hi=a.getChainProxy(a.chainStore.count-1);h0[hi.chainname]=hi.index,l0+=1,M0=l0.toString(),U0=!0}else if(T==="REMARK"&&M.substr(7,3)==="350"){if(M.substr(11,12)==="BIOMOLECULE:"){let hi=M.substr(23).trim();/^(0|[1-9][0-9]*)$/.test(hi)&&(hi="BU"+hi),w=new Ra(hi),S[hi]=w}else if(M.substr(13,5)==="BIOMT"){const hi=M.split(/\s+/),S0=parseInt(M[18])-1;S0===0&&(A=new Matrix4,v.matrixList.push(A));const W=A.elements;W[0+S0]=parseFloat(hi[4]),W[4+S0]=parseFloat(hi[5]),W[8+S0]=parseFloat(hi[6]),W[12+S0]=parseFloat(hi[7])}else if(M.substr(11,30)==="APPLY THE FOLLOWING TO CHAINS:"||M.substr(11,30)==="                   AND CHAINS:"){M.substr(11,5)==="APPLY"&&(v=w.addPart());const hi=M.substr(41,30).split(",");for(let S0=0,W=hi.length;S0<W;++S0){const t0=hi[S0].trim();t0&&v.chainList.push(t0)}}}else if(T==="HEADER")a.id=M.substr(62,4);else if(T==="TITLE ")a.title+=(a.title?" ":"")+M.substr(10,70).trim();else if(T==="MODEL ")He=!0;else if(T==="ENDMDL"||M.trim()==="END"){if(He)continue;y&&!m&&(_.push(new Float32Array(f)),m=!0),O0+=1,He=!0}else if(M.substr(0,5)==="MTRIX"){if(M[59]==="1")continue;(!w||w.name!=="NCS")&&(w=new Ra("NCS"),S.NCS=w,v=w.addPart());const hi=M.split(/\s+/),S0=parseInt(M[5])-1;S0===0&&(A=new Matrix4,v.matrixList.push(A));const W=A.elements;W[0+S0]=parseFloat(hi[2]),W[4+S0]=parseFloat(hi[3]),W[8+S0]=parseFloat(hi[4]),W[12+S0]=parseFloat(hi[5])}else if(M.substr(0,5)==="ORIGX"){J.origx||(J.origx=new Matrix4);const hi=M.split(/\s+/),S0=parseInt(M[5])-1,W=J.origx.elements;W[0+S0]=parseFloat(hi[1]),W[4+S0]=parseFloat(hi[2]),W[8+S0]=parseFloat(hi[3]),W[12+S0]=parseFloat(hi[4])}else if(M.substr(0,5)==="SCALE"){J.scale||(J.scale=new Matrix4);const hi=M.split(/\s+/),S0=parseInt(M[5])-1,W=J.scale.elements;W[0+S0]=parseFloat(hi[1]),W[4+S0]=parseFloat(hi[2]),W[8+S0]=parseFloat(hi[3]),W[12+S0]=parseFloat(hi[4])}else if(T==="CRYST1"){const hi=parseFloat(M.substr(6,9)),S0=parseFloat(M.substr(15,9)),W=parseFloat(M.substr(24,9)),t0=parseFloat(M.substr(33,7)),o0=parseFloat(M.substr(40,7)),Ji=parseFloat(M.substr(47,7)),m0=M.substr(55,11).trim(),I0=new Float32Array(9);I0[0]=hi,I0[4]=S0,I0[8]=W,h.push(I0),O0===0&&(J.a=hi,J.b=S0,J.c=W,J.alpha=t0,J.beta=o0,J.gamma=Ji,J.spacegroup=m0)}})(0,x0.length,x0)})),l.finalize();const p0=ht.length;if(p0){a.eachChain((function(b0){b0.entityIndex=p0})),ht.forEach((function(b0,ut){const hi=b0.chainList.map((function(S0){return h0[S0]}));a.entityList.push(new ag(a,ut,b0.name,"polymer",hi))}));let x0=ht.length;const L0=a.getResidueProxy(),c0={};a.eachChain((function(b0){b0.entityIndex===p0&&(L0.index=b0.residueOffset,c0[L0.resname]||(c0[L0.resname]=[]),c0[L0.resname].push(b0.index))})),Object.keys(c0).forEach((function(b0){const ut=c0[b0];let hi="non-polymer",S0=Hm[b0]||b0;as.includes(b0)&&(S0="water",hi="water"),a.entityList.push(new ag(a,x0,S0,hi,ut)),x0+=1}))}J.a!==void 0?a.unitcell=new lg(J):a.unitcell=void 0,(w0.length||Q.length)&&za(a,d0),a.finalizeAtoms(),e||Ga(a),Ha(a,this.inferBonds),a.finalizeBonds(),w0.length||Q.length||Ua(a),Ka(a),De&&ke.timeEnd("PdbParser._parse "+this.name)}}Ne.add("pdb",pg),Ne.add("pdb1",pg),Ne.add("ent",pg);class gg{constructor(e){this.structure=e,this.dict={},this.structure=e}add(e,t,n){this.dict[e]={chemCompType:t},n&&(this.dict[e].bonds=n)}addBond(e,t,n,i){const s=this.dict[e];if(!s)return;s.bonds||(s.bonds={atom1:[],atom2:[],bondOrders:[]});const o=s.bonds;o.atom1.push(t),o.atom2.push(n),o.bondOrders.push(i)}getBonds(e,t){var n;const i=(n=this.dict[e])===null||n===void 0?void 0:n.bonds;if(!i)return;const s=this.structure.atomMap,o=new Map(t.map(((x,y)=>{var b;return[(b=s.get(x))===null||b===void 0?void 0:b.atomname,y]}))),a=[],l=[],d=[];let u,g;for(let x=0;x<i.atom1.length;x++)(u=o.get(i.atom1[x]))!==void 0&&(g=o.get(i.atom2[x]))!==void 0&&(a.push(u),l.push(g),d.push(i.bondOrders[x]));return{atomIndices1:a,atomIndices2:l,bondOrders:d}}}const yg=/^\D{1,2}/,bg={HELX_RH_AL_P:"h",STRN:"e",HELX_RH_3T_P:"g",HELX_RH_PI_P:"i",HELX_LH_PP_P:"e",TURN_TY1_P:"t",BEND:"s",OTHER:" "},_g={AROM:1,DELO:2,DIRECTED:0,DOUB:2,PI:0,POLY:0,QUAD:4,SING:1,TRIP:3};function xg(r){switch(r.toLowerCase()){case"?":case"sing":return 1;case"doub":return 2;case"trip":return 3;case"quad":return 4}return 0}class vg extends og{get type(){return"cif"}get isBinary(){return!1}_parse(){var e,t,n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w;return Nl(this,void 0,void 0,(function*(){ke.time("CifParser._parse "+this.name);const v=this.structure,A=this.structureBuilder,M=this.firstModelOnly,T=this.asTrajectory,R=v.frames;let P,L;const O=this.isBinary?ng.parseBinary(this.streamer.data):ng.parseText(this.streamer.compressed?gt(this.streamer.data):this.streamer.data),I=yield O.run();if(I.isError)throw I;const N=I.result.blocks[0];if("chem_comp"in N.categories&&"chem_comp_atom"in N.categories&&!("struct"in N.categories))(function(k,U,F){const j=U.atomStore,H=U.atomMap;let B,V;const K=k.chem_comp,q=k.chem_comp_atom,Te=k.chem_comp_bond;let Fe;K&&((Fe=K.getField("name"))&&(U.title=Fe.str(0)),(Fe=K.getField("id"))&&(U.id=Fe.str(0)));const We={};if(q){let J,et,ht,er;V=q.rowCount,j.resize(2*V);const tr=q.getField("atom_id"),Hm=q.getField("type_symbol"),oi=q.getField("pdbx_component_comp_id"),h0=q.getField("pdbx_residue_numbering");[["model_Cartn_x","model_Cartn_y","model_Cartn_z"],["pdbx_model_Cartn_x_ideal","pdbx_model_Cartn_y_ideal","pdbx_model_Cartn_z_ideal"]].forEach((([l0,M0,U0],_0)=>{var C0;const P0=q.getField(l0),R0=q.getField(M0),si=q.getField(U0),Xe=_0*V;for(let d0=0;d0<V;++d0){const w0=d0+Xe;j.growIfFull(),J=tr?.str(d0),et=Hm?.str(d0),We[J]=d0,j.atomTypeId[w0]=H.add(J,et),j.x[w0]=P0.float(d0),j.y[w0]=R0.float(d0),j.z[w0]=si.float(d0),j.serial[w0]=d0,ht=oi.str(d0),er=(C0=h0?.int(d0))!==null&&C0!==void 0?C0:1,F.addAtom(_0,"","",ht,er,!0)}}))}if(q&&Te){let J,et,ht;V=Te.rowCount;const er=q.rowCount,tr=U.getAtomProxy(),Hm=U.getAtomProxy(),oi=Te.getField("atom_id_1"),h0=Te.getField("atom_id_2"),l0=Te.getField("value_order");for(B=0;B<V;++B)J=oi.str(B),et=h0.str(B),ht=xg(l0.str(B)),tr.index=We[J],Hm.index=We[et],U.bondStore.growIfFull(),U.bondStore.addBond(tr,Hm,ht),tr.index+=er,Hm.index+=er,U.bondStore.growIfFull(),U.bondStore.addBond(tr,Hm,ht)}})(N.categories,v,A),A.finalize(),v.finalizeAtoms(),v.finalizeBonds(),tc(v);else if("atom_site_type_symbol"in N.categories&&"atom_site_label"in N.categories&&"atom_site_fract_x"in N.categories)(function(k,U,F){var j,H,B=U.atomStore,V=U.atomMap;k.header&&(U.id=k.header,U.name=k.header),U.unitcell=new lg({a:k.getField("cell_length_a").float(0),b:k.getField("cell_length_b").float(0),c:k.getField("cell_length_c").float(0),alpha:k.getField("cell_angle_alpha").float(0),beta:k.getField("cell_angle_beta").float(0),gamma:k.getField("cell_angle_gamma").float(0),spacegroup:k.getField("symmetry_space_group_name_H-M").str(0)});const K=new Vector3,q=new Vector3,Te=k.getField("atom_site_type_symbol");if(!Te)return;const Fe=(j=Te.rowCount)!==null&&j!==void 0?j:0,We=k.getField("atom_site_type_symbol"),J=k.getField("atom_site_fract_x"),et=k.getField("atom_site_fract_y"),ht=k.getField("atom_site_fract_z"),er=k.getField("atom_site_occupancy"),tr={};for(let _0=0;_0<Fe;++_0){B.growIfFull();const C0=We.str(_0),P0=Te.str(_0);let R0=tr[P0];if(!R0){const si=P0.match(yg);tr[P0]=R0=(H=si?.[0])!==null&&H!==void 0?H:P0}B.atomTypeId[_0]=V.add(C0,R0),K.set(J.float(_0),et.float(_0),ht.float(_0)),K.applyMatrix4(U.unitcell.fracToCart),q.add(K),B.x[_0]=K.x,B.y[_0]=K.y,B.z[_0]=K.z,er&&(B.occupancy[_0]=er.float(_0)),B.serial[_0]=_0,F.addAtom(0,"","","HET",1,!0)}q.divideScalar(Fe),U.center=q,Ka(U);const Hm=new Vector3,oi=new Vector3,h0=U.biomolDict.SUPERCELL.partList[0].matrixList;let l0=Fe;function M0(_0){return V.get(B.atomTypeId[_0]).covalent}const U0=new Matrix4;for(let _0=0;_0<Fe;++_0){const C0=M0(_0);K.set(B.x[_0],B.y[_0],B.z[_0]),h0.forEach((function(P0){if(!U0.equals(P0)){Hm.copy(K),Hm.applyMatrix4(P0);for(let R0=0;R0<Fe;++R0){oi.set(B.x[R0],B.y[R0],B.z[R0]);const si=Hm.distanceToSquared(oi),Xe=M0(R0)+C0,d0=Xe+.3,w0=Xe-.5;if(si<d0*d0&&si>w0*w0)return B.growIfFull(),B.atomTypeId[l0]=B.atomTypeId[_0],B.x[l0]=Hm.x,B.y[l0]=Hm.y,B.z[l0]=Hm.z,B.occupancy[l0]=B.occupancy[_0],B.serial[l0]=l0,B.altloc[l0]=65,F.addAtom(0,"","","HET",1,!0),void(l0+=1)}}}))}})(N,v,A),A.finalize(),v.finalizeAtoms(),Ha(v),v.finalizeBonds();else{const k={},U={},F=v.atomMap,j=v.atomStore,H=N.categories.atom_site;let B=H.rowCount;const V=H.getField("pdbx_PDB_model_num");if(!((e=V?.areValuesEqual(0,B-1))===null||e===void 0||e)&&(T||M)){const _0=V.int(0);for(let C0=0;C0<B;C0++)if(V.int(C0)>_0){B=C0;break}}v.chemCompMap=new gg(v);const K=N.categories.chem_comp;let q=K.getField("id");const Te=K.getField("type");for(let _0=0;_0<K.rowCount;_0++)v.chemCompMap.add(q.str(_0),Te.str(_0).toUpperCase());if(N.categoryNames.includes("chem_comp_bond")){const _0=N.categories.chem_comp_bond;q=_0.getField("comp_id");const C0=_0.getField("atom_id_1"),P0=_0.getField("atom_id_2"),R0=_0.getField("value_order");for(let si=0;si<_0.rowCount;si++){const Xe=_g[R0.str(si)];Xe&&v.chemCompMap.addBond(q.str(si),C0.str(si),P0.str(si),Xe)}}const Fe=(_0,C0,P0)=>{const R0=_0.getField(C0);return R0?R0.toFloatArray({array:Float32Array,start:0,end:P0}):new Float32Array(P0)};j.resize(B),j.x=Fe(H,"Cartn_x",B),j.y=Fe(H,"Cartn_y",B),j.z=Fe(H,"Cartn_z",B),j.serial=H.getField("id").toIntArray({start:0,end:B}),j.bfactor=Fe(H,"B_iso_or_equiv",B),j.occupancy=Fe(H,"occupancy",B);const We=H.getField("label_alt_id");We?.isDefined&&(j.altloc=Uint8Array.from(We.toStringArray(),(_0=>_0.charCodeAt(0))));const J=H.getField("label_atom_id"),et=H.getField("type_symbol");q=H.getField("label_comp_id");const ht=(t=H.getField("auth_seq_id"))!==null&&t!==void 0?t:H.getField("label_seq_id"),er=H.getField("pdbx_PDB_ins_code"),tr=H.getField("auth_asym_id"),Hm=H.getField("label_asym_id"),oi=H.getField("group_PDB"),h0=H.getField("label_entity_id");for(let _0=0;_0<B;_0++){const C0=(n=V?.int(_0))!==null&&n!==void 0?n:1,P0=(i=tr?.str(_0))!==null&&i!==void 0?i:"",R0=(s=Hm?.str(_0))!==null&&s!==void 0?s:"",si=(o=q?.str(_0))!==null&&o!==void 0?o:"",Xe=(a=ht?.int(_0))!==null&&a!==void 0?a:0,d0=oi?.str(_0)[0]==="H",w0=(l=er?.str(_0))!==null&&l!==void 0?l:"",Q=(d=h0?.int(_0))!==null&&d!==void 0?d:1;j.atomTypeId[_0]=F.add(J?.str(_0)||"",et?.str(_0)),A.addAtom(C0-1,P0,R0,si,Xe,d0,void 0,w0),k[R0]=P0,U[Q]||(U[Q]=new Set),U[Q].add(v.chainStore.count-1)}if(T){const _0=H.rowCount/B|0,C0=H.getField("Cartn_x"),P0=H.getField("Cartn_y"),R0=H.getField("Cartn_z");for(let si=0;si<_0;si++){P=new Float32Array(3*B);const Xe=si*B,d0=Xe+B;L=0;for(let w0=Xe;w0<d0;w0++)P[L+0]=C0.float(w0),P[L+1]=P0.float(w0),P[L+2]=R0.float(w0),L+=3;R.push(P)}}const l0=(function(_0,C0,P0){var R0,si,Xe,d0,w0,Q;const it=[],ec=[];let a0,u0,E0,O0;const He=_0.struct_conf;if(He?.fieldNames.includes("pdbx_PDB_helix_class")){const x0=He.getField("pdbx_beg_PDB_ins_code"),L0=He.getField("pdbx_end_PDB_ins_code"),c0=He.getField("pdbx_PDB_helix_class"),b0=He.getField("beg_label_asym_id"),ut=He.getField("end_label_asym_id"),hi=He.getField("beg_auth_seq_id"),S0=He.getField("end_auth_seq_id");for(a0=0,u0=He.rowCount;a0<u0;++a0){const W=c0?.int(a0);Number.isFinite(W)&&(E0=(R0=x0?.str(a0))!==null&&R0!==void 0?R0:"",O0=(si=L0?.str(a0))!==null&&si!==void 0?si:"",it.push([P0[b0.str(a0)],hi.int(a0),E0,P0[ut.str(a0)],S0.int(a0),O0,(hg[W]||hg[0]).charCodeAt(0)]))}}else if(He?.fieldNames.includes("conf_type_id")){const x0=He.getField("conf_type_id"),L0=He.getField("pdbx_beg_PDB_ins_code"),c0=He.getField("pdbx_end_PDB_ins_code"),b0=He.getField("beg_label_asym_id"),ut=He.getField("end_label_asym_id"),hi=He.getField("beg_auth_seq_id"),S0=He.getField("end_auth_seq_id");let W;for(a0=0,u0=He.rowCount;a0<u0;++a0){const t0=x0.str(a0);(W=bg[t0])&&(E0=(Xe=L0?.str(a0))!==null&&Xe!==void 0?Xe:"",O0=(d0=c0?.str(a0))!==null&&d0!==void 0?d0:"",W==="h"||W==="g"||W==="i"?it.push([P0[b0.str(a0)],hi.int(a0),E0,P0[ut.str(a0)],S0.int(a0),O0,W.charCodeAt(0)]):W==="e"&&ec.push([P0[b0.str(a0)],hi.int(a0),E0,P0[ut.str(a0)],S0.int(a0),O0]))}}const p0=_0.struct_sheet_range;if(p0&&ec.length===0){const x0=p0.getField("pdbx_beg_PDB_ins_code"),L0=p0.getField("pdbx_end_PDB_ins_code"),c0=p0.getField("beg_label_asym_id"),b0=p0.getField("end_label_asym_id"),ut=p0.getField("beg_auth_seq_id"),hi=p0.getField("end_auth_seq_id");for(a0=0,u0=p0.rowCount;a0<u0;++a0)E0=(w0=x0?.str(a0))!==null&&w0!==void 0?w0:"",O0=(Q=L0?.str(a0))!==null&&Q!==void 0?Q:"",ec.push([P0[c0.str(a0)],ut.int(a0),E0,P0[b0.str(a0)],hi.int(a0),O0])}return!(!He&&!p0)&&{helices:it,sheets:ec}})(N.categories,0,k);let M0,U0;if((function(_0,C0,P0){const R0={},si=C0.biomolDict;if(_0.pdbx_struct_oper_list){const Q=_0.pdbx_struct_oper_list,it=Q.getField("id"),ec=Q.getField("matrix[1][1]"),a0=Q.getField("matrix[1][2]"),u0=Q.getField("matrix[1][3]"),E0=Q.getField("matrix[2][1]"),O0=Q.getField("matrix[2][2]"),He=Q.getField("matrix[2][3]"),p0=Q.getField("matrix[3][1]"),x0=Q.getField("matrix[3][2]"),L0=Q.getField("matrix[3][3]"),c0=Q.getField("vector[1]"),b0=Q.getField("vector[2]"),ut=Q.getField("vector[3]");for(let hi=0;hi<Q.rowCount;hi++){const S0=new Matrix4,W=S0.elements;W[0]=ec.float(hi),W[1]=a0.float(hi),W[2]=u0.float(hi),W[4]=E0.float(hi),W[5]=O0.float(hi),W[6]=He.float(hi),W[8]=p0.float(hi),W[9]=x0.float(hi),W[10]=L0.float(hi),W[3]=c0.float(hi),W[7]=b0.float(hi),W[11]=ut.float(hi),S0.transpose(),R0[it.str(hi)]=S0}}if(_0.pdbx_struct_assembly_gen){const Q=_0.pdbx_struct_assembly_gen,it=function(E0){const O0={};return E0.replace(/[()']/g,"").split(",").forEach((function(He){if(He.includes("-"))for(var p0=He.split("-"),x0=parseInt(p0[0]),L0=parseInt(p0[1]);x0<=L0;++x0)O0[x0]=R0[x0];else O0[He]=R0[He]})),O0},ec=Q.getField("assembly_id"),a0=Q.getField("oper_expression"),u0=Q.getField("asym_id_list");for(let E0=0;E0<Q.rowCount;E0++){const O0=ec.int(E0);let He={},p0=a0.str(E0).replace(/['"]\(|['"]/g,"");if(p0.includes(")(")||p0.indexOf("(")>0){const[b0,ut]=p0.split("(").filter((W=>!!W)),hi=it(b0),S0=it(ut);Object.keys(hi).forEach((function(W){Object.keys(S0).forEach((function(t0){const o0=new Matrix4;o0.multiplyMatrices(hi[W],S0[t0]),He[W+"x"+t0]=o0}))}))}else He=it(p0);const x0=[];for(let b0 in He)x0.push(He[b0]);let L0=""+O0;/^(0|[1-9][0-9]*)$/.test(L0)&&(L0="BU"+L0);const c0=u0.str(E0).split(",").map((b0=>P0[b0]));si[L0]===void 0&&(si[L0]=new Ra(L0)),si[L0].addPart(x0,c0)}}if(_0.struct_ncs_oper){const Q=_0.struct_ncs_oper,it="NCS";si[it]=new Ra(it);const ec=si[it].addPart(),a0=Q.getField("code"),u0=Q.getField("matrix[1][1]"),E0=Q.getField("matrix[1][2]"),O0=Q.getField("matrix[1][3]"),He=Q.getField("matrix[2][1]"),p0=Q.getField("matrix[2][2]"),x0=Q.getField("matrix[2][3]"),L0=Q.getField("matrix[3][1]"),c0=Q.getField("matrix[3][2]"),b0=Q.getField("matrix[3][3]"),ut=Q.getField("vector[1]"),hi=Q.getField("vector[2]"),S0=Q.getField("vector[3]");for(let W=0;W<Q.rowCount;W++){if(a0.str(W)==="given")return;const t0=new Matrix4,o0=t0.elements;o0[0]=u0.float(W),o0[1]=E0.float(W),o0[2]=O0.float(W),o0[4]=He.float(W),o0[5]=p0.float(W),o0[6]=x0.float(W),o0[8]=L0.float(W),o0[9]=c0.float(W),o0[10]=b0.float(W),o0[3]=ut.float(W),o0[7]=hi.float(W),o0[11]=S0.float(W),t0.transpose(),ec.matrixList.push(t0)}ec.matrixList.length===0&&delete si[it]}const Xe={};if(_0.cell){const Q=_0.cell,it=Q.getField("length_a").float(0),ec=Q.getField("length_b").float(0),a0=Q.getField("length_c").float(0),u0=new Float32Array(9);u0[0]=it,u0[4]=ec,u0[8]=a0,C0.boxes.push(u0),Xe.a=it,Xe.b=ec,Xe.c=a0,Xe.alpha=Q.getField("angle_alpha").float(0),Xe.beta=Q.getField("angle_beta").float(0),Xe.gamma=Q.getField("angle_gamma").float(0)}_0.symmetry&&(Xe.spacegroup=_0.symmetry.getField("space_group_name_H-M").str(0));const d0=new Matrix4;if(_0.database_PDB_matrix){const Q=_0.database_PDB_matrix,it=d0.elements,ec=Q.getField("origx[1][1]"),a0=Q.getField("origx[1][2]"),u0=Q.getField("origx[1][3]"),E0=Q.getField("origx[2][1]"),O0=Q.getField("origx[2][2]"),He=Q.getField("origx[2][3]"),p0=Q.getField("origx[3][1]"),x0=Q.getField("origx[3][2]"),L0=Q.getField("origx[3][3]"),c0=Q.getField("origx_vector[1]"),b0=Q.getField("origx_vector[2]"),ut=Q.getField("origx_vector[3]");it[0]=ec.float(0),it[1]=a0.float(0),it[2]=u0.float(0),it[4]=E0.float(0),it[5]=O0.float(0),it[6]=He.float(0),it[8]=p0.float(0),it[9]=x0.float(0),it[10]=L0.float(0),it[3]=c0.float(0),it[7]=b0.float(0),it[11]=ut.float(0),d0.transpose(),Xe.origx=d0}const w0=new Matrix4;if(_0.atom_sites){const Q=_0.atom_sites,it=w0.elements,ec=Q.getField("fract_transf_matrix[1][1]"),a0=Q.getField("fract_transf_matrix[1][2]"),u0=Q.getField("fract_transf_matrix[1][3]"),E0=Q.getField("fract_transf_matrix[2][1]"),O0=Q.getField("fract_transf_matrix[2][2]"),He=Q.getField("fract_transf_matrix[2][3]"),p0=Q.getField("fract_transf_matrix[3][1]"),x0=Q.getField("fract_transf_matrix[3][2]"),L0=Q.getField("fract_transf_matrix[3][3]"),c0=Q.getField("fract_transf_vector[1]"),b0=Q.getField("fract_transf_vector[2]"),ut=Q.getField("fract_transf_vector[3]");it[0]=ec.float(0),it[1]=a0.float(0),it[2]=u0.float(0),it[4]=E0.float(0),it[5]=O0.float(0),it[6]=He.float(0),it[8]=p0.float(0),it[9]=x0.float(0),it[10]=L0.float(0),it[3]=c0.float(0),it[7]=b0.float(0),it[11]=ut.float(0),w0.transpose(),Xe.scale=w0}Xe.a!==void 0?C0.unitcell=new lg(Xe):C0.unitcell=void 0})(N.categories,v,k),(function(_0,C0,P0){const R0=_0.struct_conn;if(R0){const d0=C0.getAtomProxy(),w0=C0.getAtomProxy(),Q={},it=R0.getField("conn_type_id"),ec=R0.getField("ptnr1_symmetry"),a0=R0.getField("pdbx_ptnr1_PDB_ins_code"),u0=R0.getField("pdbx_ptnr1_label_alt_id"),E0=R0.getField("ptnr1_auth_seq_id"),O0=R0.getField("ptnr1_label_asym_id"),He=R0.getField("ptnr1_label_atom_id"),p0=R0.getField("ptnr2_symmetry"),x0=R0.getField("pdbx_ptnr2_PDB_ins_code"),L0=R0.getField("pdbx_ptnr2_label_alt_id"),c0=R0.getField("ptnr2_auth_seq_id"),b0=R0.getField("ptnr2_label_asym_id"),ut=R0.getField("ptnr2_label_atom_id"),hi=R0.getField("pdbx_value_order");for(let S0=0,W=R0.rowCount;S0<W;++S0){const t0=it.str(S0);if(t0==="hydrog"||t0==="mismat"||t0==="saltbr"||ec.str(S0)!=="1_555"||p0.str(S0)!=="1_555")continue;const o0=a0.str(S0),Ji=u0.str(S0),m0=E0.str(S0)+(o0?"^"+o0:"")+":"+P0[O0.str(S0)]+"."+He.str(S0)+(Ji?"%"+Ji:"");let I0=Q[m0];if(!I0){const r0=new me(m0);if(r0.selection.error){De&&ke.warn("invalid selection for connection",m0);continue}I0=C0.getAtomIndices(r0),Q[m0]=I0}const Z=x0.str(S0),at=L0.str(S0),lt=c0.str(S0)+(Z?"^"+Z:"")+":"+P0[b0.str(S0)]+"."+ut.str(S0)+(at?"%"+at:"");let n0=Q[lt];if(!n0){const r0=new me(lt);if(r0.selection.error){De&&ke.warn("invalid selection for connection",lt);continue}n0=C0.getAtomIndices(r0),Q[lt]=n0}var si=I0.length,Xe=n0.length;if(si>Xe&&([si,Xe]=[Xe,si],[I0,n0]=[n0,I0]),si!==0&&Xe!==0)for(let r0=0;r0<Xe;++r0)d0.index=I0[r0%si],w0.index=n0[r0],d0&&w0?C0.bondStore.addBond(d0,w0,xg(hi.str(S0))):ke.log("atoms for connection not found");else De&&ke.warn("no atoms found for",m0,lt)}}})(N.categories,v,k),(function(_0,C0,P0){var R0;if(_0.entity){const si=_0.entity,Xe=si.getField("id"),d0=si.getField("pdbx_description"),w0=si.getField("type"),Q=si.rowCount;for(let it=0;it<Q;++it){const ec=Array.from((R0=P0[Xe.int(it)])!==null&&R0!==void 0?R0:[]);C0.entityList[it]=new ag(C0,it,d0?.str(it),w0.str(it),ec)}}})(N.categories,v,U),(M0=(u=N.categories.struct)===null||u===void 0?void 0:u.getField("title"))&&(U0=M0.str(0))&&(v.title=U0),(M0=(g=N.categories.entry)===null||g===void 0?void 0:g.getField("id"))&&(U0=M0.str(0))&&(v.id=U0),N.categories.pdbx_audit_revision_history){if(M0=(x=N.categories.pdbx_audit_revision_history)===null||x===void 0?void 0:x.getField("revision_date")){for(let _0=0;_0<M0.rowCount;_0++)if(U0=M0.str(_0)){v.header.releaseDate=U0;break}}if(M0=(y=N.categories.pdbx_database_status)===null||y===void 0?void 0:y.getField("recvd_initial_deposition_date")){for(let _0=0;_0<M0.rowCount;_0++)if(U0=M0.str(_0)){v.header.depositionDate=U0;break}}}else if(N.categories.database_PDB_rev){if(M0=(b=N.categories.database_PDB_rev)===null||b===void 0?void 0:b.getField("date")){for(let _0=0;_0<M0.rowCount;_0++)if(U0=M0.str(_0)){v.header.releaseDate=U0;break}}if(M0=(_=N.categories.database_PDB_rev)===null||_===void 0?void 0:_.getField("date_original")){for(let _0=0;_0<M0.rowCount;_0++)if(U0=M0.str(_0)){v.header.depositionDate=U0;break}}}(M0=(f=(h=N.categories.reflns)===null||h===void 0?void 0:h.getField("d_resolution_high"))!==null&&f!==void 0?f:(E=N.categories.refine)===null||E===void 0?void 0:E.getField("ls_d_res_high"))&&M0.valueKind(0)===0&&(v.header.resolution=M0.float(0)),(M0=(m=N.categories.refine)===null||m===void 0?void 0:m.getField("ls_R_factor_R_free"))&&M0.valueKind(0)===0&&(v.header.rFree=M0.float(0)),(M0=(S=N.categories.refine)===null||S===void 0?void 0:S.getField("ls_R_factor_R_work"))&&M0.valueKind(0)===0&&(v.header.rFree=M0.float(0)),(M0=(w=N.categories.exptl)===null||w===void 0?void 0:w.getField("method"))&&(v.header.experimentalMethods=M0.toStringArray().slice()),A.finalize(),v.finalizeAtoms(),Ha(v),v.finalizeBonds(),l0?za(v,l0):Ua(v),Ka(v),v.extraData.cif=N}De&&ke.timeEnd("CifParser._parse "+this.name)}))}}Ne.add("bcif",class extends vg{get type(){return"bcif"}get isBinary(){return!0}}),Ne.add("cif",vg),Ne.add("mcif",vg),Ne.add("mmcif",vg);Ne.add("gro",class extends og{get type(){return"gro"}_parse(){De&&ke.time("GroParser._parse "+this.name);var r,e,t=this.structure,n=this.structureBuilder,i=this.firstModelOnly,s=this.asTrajectory,o=this.cAlphaOnly,a=t.frames,l=t.boxes,d=this.streamer.peekLines(3);t.title=d[0].trim();var u,g,x,y,b=5+(d[2].length-d[2].lastIndexOf(".")-1),_=20+b,h=20+2*b,f=parseInt(d[1]),E=f+3,m=t.atomMap,S=t.atomStore;S.resize(f);var w=0,v=0,A=0;this.streamer.eachChunkOfLines((function(M){(function(T,R,P){for(var L=T;L<R;++L){var O=++A-1,I=P[L];if(I){if(O%E==0)s&&(r=new Float32Array(3*f),a.push(r),e=0);else if(O%E!=1)if(O%E==E-1){var N=I.trim().split(/\s+/),k=new Float32Array(9);if(k[0]=10*parseFloat(N[0]),k[4]=10*parseFloat(N[1]),k[8]=10*parseFloat(N[2]),l.push(k),i)return!0;v+=1}else{if(u=I.substr(10,5).trim(),o&&u!=="CA")continue;var U=10*parseFloat(I.substr(20,b)),F=10*parseFloat(I.substr(_,b)),j=10*parseFloat(I.substr(h,b));if(s){var H=3*e;if(r[H+0]=U,r[H+1]=F,r[H+2]=j,e+=1,O>E)continue}g=I.substr(5,5).trim(),x=parseInt(I.substr(0,5)),y=parseInt(I.substr(15,5)),S.growIfFull(),S.atomTypeId[w]=m.add(u),S.x[w]=U,S.y[w]=F,S.z[w]=j,S.serial[w]=y,n.addAtom(v,"","",g,x,!1,"l"),w+=1}}}})(0,M.length,M)})),n.finalize(),t.finalizeAtoms(),Ga(t),Ha(t),t.finalizeBonds(),Ua(t),De&&ke.timeEnd("GroParser._parse "+this.name)}});var wg=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"].concat(["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"]);function Ag(r,e,t){return e?new r(e.buffer,e.byteOffset,e.byteLength/(t||1)):void 0}function Sg(r){return Ag(DataView,r)}function Cg(r){return Ag(Int8Array,r)}function Pg(r){return Ag(Int32Array,r,4)}function Ig(r,e){var t=r.length/2;e||(e=new Int16Array(t));for(var n=0,i=0;n<t;++n,i+=2)e[n]=r[i]<<8^r[i+1];return e}function kg(r,e){var t=r.length/4;e||(e=new Int32Array(t));for(var n=0,i=0;n<t;++n,i+=4)e[n]=r[i]<<24^r[i+1]<<16^r[i+2]<<8^r[i+3];return e}function Mg(r,e,t){var n=r.length,i=1/e;t||(t=new Float32Array(n));for(var s=0;s<n;++s)t[s]=r[s]*i;return t}function Tg(r,e){var t,n;if(!e){var i=0;for(t=0,n=r.length;t<n;t+=2)i+=r[t+1];e=new r.constructor(i)}var s=0;for(t=0,n=r.length;t<n;t+=2)for(var o=r[t],a=r[t+1],l=0;l<a;++l)e[s]=o,++s;return e}function Dg(r,e){var t=r.length;e||(e=new r.constructor(t)),t&&(e[0]=r[0]);for(var n=1;n<t;++n)e[n]=r[n]+e[n-1];return e}function Bg(r,e){var t,n,i=r instanceof Int8Array?127:32767,s=-i-1,o=r.length;if(!e){var a=0;for(t=0;t<o;++t)r[t]<i&&r[t]>s&&++a;e=new Int32Array(a)}for(t=0,n=0;t<o;){for(var l=0;r[t]===i||r[t]===s;)l+=r[t],++t;l+=r[t],++t,e[n]=l,++n}return e}function Fg(r,e,t){return Mg(Bg(r,Pg(t)),e,t)}function Eg(r,e,t){var n=Bg(r,Pg(t));return(function(i,s,o){return Mg(Dg(i,Pg(o)),s,o)})(n,e,Ag(Float32Array,n,4))}function $g(r){var e=0,t=new DataView(r.buffer);function n(l){for(var d={},u=0;u<l;u++)d[a()]=a();return d}function i(l){var d=r.subarray(e,e+l);return e+=l,d}function s(l){var d=r.subarray(e,e+l);e+=l;var u=65535;if(l>u){for(var g=[],x=0;x<d.length;x+=u)g.push(String.fromCharCode.apply(null,d.subarray(x,x+u)));return g.join("")}return String.fromCharCode.apply(null,d)}function o(l){for(var d=new Array(l),u=0;u<l;u++)d[u]=a();return d}function a(){var l,d,u=r[e];if(!(128&u))return e++,u;if((240&u)==128)return e++,n(d=15&u);if((240&u)==144)return e++,o(d=15&u);if((224&u)==160)return e++,s(d=31&u);if(!(224&~u))return l=t.getInt8(e),e++,l;switch(u){case 192:return e++,null;case 194:return e++,!1;case 195:return e++,!0;case 196:return d=t.getUint8(e+1),e+=2,i(d);case 197:return d=t.getUint16(e+1),e+=3,i(d);case 198:return d=t.getUint32(e+1),e+=5,i(d);case 202:return l=t.getFloat32(e+1),e+=5,l;case 203:return l=t.getFloat64(e+1),e+=9,l;case 204:return l=r[e+1],e+=2,l;case 205:return l=t.getUint16(e+1),e+=3,l;case 206:return l=t.getUint32(e+1),e+=5,l;case 208:return l=t.getInt8(e+1),e+=2,l;case 209:return l=t.getInt16(e+1),e+=3,l;case 210:return l=t.getInt32(e+1),e+=5,l;case 217:return d=t.getUint8(e+1),e+=2,s(d);case 218:return d=t.getUint16(e+1),e+=3,s(d);case 219:return d=t.getUint32(e+1),e+=5,s(d);case 220:return d=t.getUint16(e+1),e+=3,o(d);case 221:return d=t.getUint32(e+1),e+=5,o(d);case 222:return d=t.getUint16(e+1),e+=3,n(d);case 223:return d=t.getUint32(e+1),e+=5,n(d)}throw new Error("Unknown type 0x"+u.toString(16))}return a()}function Og(r,e,t,n){switch(r){case 1:return(function(a,l){var d=a.length;l||(l=new Float32Array(d/4));for(var u=Sg(l),g=Sg(a),x=0,y=0,b=d/4;x<b;++x,y+=4)u.setFloat32(y,g.getFloat32(y),!0);return l})(e);case 2:return Cg(e);case 3:return Ig(e);case 4:return kg(e);case 5:return Ag(Uint8Array,e);case 6:return Tg(kg(e),new Uint8Array(t));case 7:return Tg(kg(e));case 8:return(function(a,l){return Dg(Tg(a),l)})(kg(e));case 9:return i=kg(e),s=kg(n)[0],Mg(Tg(i,Pg(o)),s,o);case 10:return Eg(Ig(e),kg(n)[0]);case 11:return Mg(Ig(e),kg(n)[0]);case 12:return Fg(Ig(e),kg(n)[0]);case 13:return Fg(Cg(e),kg(n)[0]);case 14:return Bg(Ig(e));case 15:return Bg(Cg(e))}var i,s,o}function Rg(r,e){var t=(e=e||{}).ignoreFields,n={};return wg.forEach((function(i){var s,o,a,l,d,u=!!t&&t.indexOf(i)!==-1,g=r[i];u||g===void 0||(g instanceof Uint8Array?n[i]=Og.apply(null,(o=Sg(s=g),a=o.getInt32(0),l=o.getInt32(4),d=s.subarray(8,12),[a,s=s.subarray(12),l,d])):n[i]=g)})),n}const Lg={0:105,1:115,2:104,3:101,4:103,5:98,6:116,7:108,"-1":NaN};Ne.add("mmtf",class extends og{get type(){return"mmtf"}get isBinary(){return!0}_parse(){let r,e,t,n,i;De&&ke.time("MmtfParser._parse "+this.name);const s=this.structure,o=Rg($g(this.streamer.data));let a,l,d,u,g,x;if(["depositionDate","releaseDate","resolution","rFree","rWork","experimentalMethods"].forEach((function(F){o[F]!==void 0&&(s.header[F]=o[F])})),s.id=o.structureId,s.title=o.title,s.atomStore.addField("formalCharge",1,"int8"),this.firstModelOnly||this.asTrajectory){for(g=1,u=o.chainsPerModel[0],d=0,r=0,e=u;r<e;++r)d+=o.groupsPerChain[r];for(l=0,r=0,e=d;r<e;++r)i=o.groupList[o.groupTypeList[r]],l+=i.atomNameList.length;a=o.numBonds,x=[u]}else a=o.numBonds,l=o.numAtoms,d=o.numGroups,u=o.numChains,g=o.numModels,x=o.chainsPerModel;if(a+=d,this.asTrajectory)for(r=0,e=o.numModels;r<e;++r){const F=new Float32Array(3*l),j=l*r;for(t=0;t<l;++t){const H=3*t,B=t+j;F[H]=o.xCoordList[B],F[H+1]=o.yCoordList[B],F[H+2]=o.zCoordList[B]}s.frames.push(F)}const y=new Uint32Array(a),b=new Uint32Array(a),_=new Uint8Array(a),h=new Uint32Array(l),f=new Int8Array(l),E=new Uint32Array(d),m=new Uint32Array(d),S=new Uint32Array(d),w=new Uint16Array(u),v=new Uint32Array(u),A=new Uint32Array(u),M=new Uint32Array(g),T=new Uint32Array(g);let R=0;for(r=0,e=g;r<e;++r){const F=x[r];for(M[r]=R,T[r]=F,t=0;t<F;++t)w[t+R]=r;R+=F}const P=o.groupsPerChain;let L=0;for(r=0,e=u;r<e;++r){const F=P[r];for(v[r]=L,A[r]=F,t=0;t<F;++t)E[t+L]=r;L+=F}let O=0,I=0;for(r=0,e=d;r<e;++r){i=o.groupList[o.groupTypeList[r]];const F=i.atomNameList.length,j=i.formalChargeList,H=i.bondAtomList,B=i.bondOrderList;for(t=0,n=B.length;t<n;++t)y[I]=O+H[2*t],b[I]=O+H[2*t+1],_[I]=B[t],I+=1;for(m[r]=O,S[r]=F,t=0;t<F;++t)h[O]=r,f[O]=j[t],O+=1}const N=o.bondAtomList;if(N)for(o.bondOrderList&&_.set(o.bondOrderList,I),r=0,e=N.length;r<e;r+=2){const F=N[r],j=N[r+1];F<l&&j<l&&(y[I]=F,b[I]=j,I+=1)}s.bondStore.length=_.length,s.bondStore.count=I,s.bondStore.atomIndex1=y,s.bondStore.atomIndex2=b,s.bondStore.bondOrder=_,s.atomStore.length=l,s.atomStore.count=l,s.atomStore.residueIndex=h,s.atomStore.atomTypeId=new Uint16Array(l),s.atomStore.x=o.xCoordList.subarray(0,l),s.atomStore.y=o.yCoordList.subarray(0,l),s.atomStore.z=o.zCoordList.subarray(0,l),s.atomStore.serial=o.atomIdList.subarray(0,l),s.atomStore.bfactor=o.bFactorList.subarray(0,l),s.atomStore.altloc=o.altLocList.subarray(0,l),s.atomStore.occupancy=o.occupancyList.subarray(0,l),s.atomStore.formalCharge=f,s.residueStore.length=d,s.residueStore.count=d,s.residueStore.chainIndex=E,s.residueStore.residueTypeId=o.groupTypeList,s.residueStore.atomOffset=m,s.residueStore.atomCount=S,s.residueStore.resno=o.groupIdList.subarray(0,d),s.residueStore.sstruc=o.secStructList.subarray(0,d),s.residueStore.inscode=o.insCodeList.subarray(0,d),s.chainStore.length=u,s.chainStore.count=u,s.chainStore.entityIndex=new Uint16Array(u),s.chainStore.modelIndex=w,s.chainStore.residueOffset=v,s.chainStore.residueCount=A,s.chainStore.chainname=o.chainNameList.subarray(0,4*u),s.chainStore.chainid=o.chainIdList.subarray(0,4*u),s.modelStore.length=g,s.modelStore.count=g,s.modelStore.chainOffset=M,s.modelStore.chainCount=T;let k={};for(r=0,e=o.groupList.length;r<e;++r){const F=o.groupList[r],j=[];for(t=0,n=F.atomNameList.length;t<n;++t){const Fe=F.elementList[t].toUpperCase(),We=F.atomNameList[t];j.push(s.atomMap.add(We,Fe))}const H=F.chemCompType.toUpperCase(),B=Gn.includes(H),V=F.bondOrderList.length,K=new Array(V),q=new Array(V);for(t=0;t<V;++t)K[t]=F.bondAtomList[2*t],q[t]=F.bondAtomList[2*t+1];const Te={atomIndices1:K,atomIndices2:q,bondOrders:F.bondOrderList};k[r]=s.residueMap.add(F.groupName,j,B,H,Te)}for(r=0,e=d;r<e;++r)s.residueStore.residueTypeId[r]=k[s.residueStore.residueTypeId[r]];for(r=0,e=s.atomStore.count;r<e;++r){const F=s.atomStore.residueIndex[r],j=s.residueMap.list[s.residueStore.residueTypeId[F]],H=s.residueStore.atomOffset[F];s.atomStore.atomTypeId[r]=j.atomTypeIdList[r-H]}if(o.secStructList){const F=o.secStructList.length;for(r=0,e=s.residueStore.count;r<e;++r){const j=Lg[s.residueStore.sstruc[r%F]];j!==void 0&&(s.residueStore.sstruc[r]=j)}}if(o.entityList&&o.entityList.forEach((function(F,j){s.entityList[j]=new ag(s,j,F.description,F.type,F.chainIndexList)})),o.bioAssemblyList&&o.bioAssemblyList.forEach((function(F,j){const H=j+1,B=new Ra(""+H);s.biomolDict["BU"+H]=B;let V={};F.transformList.forEach((function(K){const q=new Matrix4().fromArray(K.matrix).transpose(),Te=K.chainIndexList.map((function(We){let J="";for(let et=0;et<4;++et){const ht=o.chainNameList[4*We+et];if(!ht)break;J+=String.fromCharCode(ht)}return J})),Fe=V[Te.toString()];Fe?Fe.matrixList.push(q):V[Te.toString()]=B.addPart([q],Te)}))})),o.ncsOperatorList){const j=new Ra("NCS"),H=j.addPart();o.ncsOperatorList.forEach((function(B){const V=new Matrix4().fromArray(B).transpose();H.matrixList.push(V)})),H.matrixList.length>0&&(s.biomolDict.NCS=j)}const U=o.unitCell;U&&Array.isArray(U)&&U[0]?s.unitcell=new lg({a:U[0],b:U[1],c:U[2],alpha:U[3],beta:U[4],gamma:U[5],spacegroup:o.spaceGroup}):s.unitcell=void 0,Ya(s,!0),Xa(s,!0),s.finalizeAtoms(),s.finalizeBonds(),Ka(s),De&&ke.timeEnd("MmtfParser._parse "+this.name)}});const Ng=/\s+/,zg={1:1,2:2,3:3,am:1,ar:1,du:1,un:1,nc:0};Ne.add("mol2",class extends og{get type(){return"mol2"}_parse(){De&&ke.time("Mol2Parser._parse "+this.name);const r=this.structure,e=this.structureBuilder,t=this.firstModelOnly,n=this.asTrajectory,i=r.frames;let s,o,a=!1;const l=r.atomMap,d=r.atomStore;d.resize(Math.round(this.streamer.data.length/60)),d.addField("partialCharge",1,"float32");let u=0,g=0,x=0,y=-1,b=0,_=0;const h=r.getAtomProxy(),f=r.getAtomProxy();this.streamer.eachChunkOfLines((function(E){(function(m,S,w){for(let v=m;v<S;++v){const A=w[v].trim();if(A!==""&&A[0]!=="#"){if(A[0]==="@")A==="@<TRIPOS>MOLECULE"?(_=1,g=0,++y):A==="@<TRIPOS>ATOM"?(_=2,x=d.count,n&&(o=0,s=new Float32Array(3*b),i.push(s),y>0&&(a=!0))):_=A==="@<TRIPOS>BOND"?3:0;else if(_===1){if(g===0)r.title=A,r.id=A;else if(g===1){const M=A.split(Ng);b=parseInt(M[0])}++g}else if(_===2){const M=A.split(Ng);if(t&&y>0)continue;const T=parseFloat(M[2]),R=parseFloat(M[3]),P=parseFloat(M[4]);if(n){const F=3*o;if(s[F+0]=T,s[F+1]=R,s[F+2]=P,o+=1,a)continue}const L=M[0],O=M[1],I=M[5].split(".")[0],N=M[6]?parseInt(M[6]):1,k=M[7]?M[7]:"",U=M[8]?parseFloat(M[8]):0;d.growIfFull(),d.atomTypeId[u]=l.add(O,I),d.x[u]=T,d.y[u]=R,d.z[u]=P,d.serial[u]=+L,d.partialCharge[u]=U,e.addAtom(y,"","",k,N,!0),u+=1}else if(_===3){if(t&&y>0||n&&y>0)continue;const M=A.split(Ng);h.index=parseInt(M[1])-1+x,f.index=parseInt(M[2])-1+x;const T=zg[M[3]];r.bondStore.addBond(h,f,T)}}}})(0,E.length,E)})),e.finalize(),r.finalizeAtoms(),Ga(r),Xa(r,!0),Ya(r,!0),r.finalizeBonds(),tc(r),Ua(r),De&&ke.timeEnd("Mol2Parser._parse "+this.name)}});Ne.add("pdbqt",class extends pg{get type(){return"pdbqt"}});Ne.add("pqr",class extends pg{get type(){return"pqr"}});const Ug=/> +<(.+)>/;class Vg extends og{get type(){return"sdf"}_parse(){De&&ke.time("SdfParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=this.firstModelOnly,i=this.asTrajectory,s=this.streamer.peekLines(2);e.id=s[0].trim(),e.title=s[1].trim();const o=e.frames;let a,l,d=!1;const u=e.atomMap,g=e.atomStore;g.resize(Math.round(this.streamer.data.length/50)),g.addField("formalCharge",1,"int8");const x=e.getAtomProxy(),y=e.getAtomProxy();let b=0,_=0,h=0,f=0;const E=[];let m,S,w,v,A,M,T,R,P,L,O,I,N,k,U=!1,F={};e.extraData.sdf=E;let j=!1,H=!1,B=!1,V=[],K=[];const q=new Map;this.streamer.eachChunkOfLines((function(Te){(function(Fe,We,J){for(let et=Fe;et<We;++et){const ht=J[et];if(j&&ht&&(V=ht.substring(7).split(" "),K.length&&(V=[...K,...V],K=[]),V[V.length-1]==="-"))V.pop(),K=V;else{if(ht.substr(0,4)==="$$$$")_=-1,++h,f=g.count,E.push(F),F={},U=!1,j=!1;else if(_===3)j=ht.indexOf(" V3000")>-1,j?q.clear():(S=parseInt(ht.substr(0,3)),w=parseInt(ht.substr(3,3)),v=4,A=v+S,M=A,T=M+w,i&&(l=0,a=new Float32Array(3*S),o.push(a),h>0&&(d=!0)));else if(j&&V[0]==="COUNTS")S=parseInt(V[1]),i&&(l=0,a=new Float32Array(3*S),o.push(a),h>0&&(d=!0));else if(j&&V.length==2)V[1]==="ATOM"?V[0]==="BEGIN"?H=!0:V[0]==="END"&&(H=!1):V[1]==="BOND"&&(V[0]==="BEGIN"?B=!0:V[0]==="END"&&(B=!1));else if(H||!j&&_>=v&&_<A){if(n&&h>0)continue;let er=0;if(j){if(R=parseFloat(V[2]),P=parseFloat(V[3]),L=parseFloat(V[4]),I=V[1],N=parseInt(V[0]),q.set(N,b),O=I+N,V.length>6){let tr=V.slice(6).find((Hm=>Hm.indexOf("CHG=")===0));tr&&(er=parseInt(tr.substring(4)))}}else R=parseFloat(ht.substr(0,10)),P=parseFloat(ht.substr(10,10)),L=parseFloat(ht.substr(20,10)),I=ht.substr(31,3).trim(),O=I+(b-f+1);if(i){const tr=3*l;if(a[tr+0]=R,a[tr+1]=P,a[tr+2]=L,l+=1,d)continue}g.growIfFull(),g.atomTypeId[b]=u.add(O,I),g.x[b]=R,g.y[b]=P,g.z[b]=L,g.serial[b]=j?N:b,g.formalCharge[b]=er,t.addAtom(h,"","","HET",1,!0),b+=1}else if(B||!j&&_>=M&&_<T){if(n&&h>0||i&&h>0)continue;j?(x.index=q.get(parseInt(V[2])),y.index=q.get(parseInt(V[3])),k=parseInt(V[1])):(x.index=parseInt(ht.substr(0,3))-1+f,y.index=parseInt(ht.substr(3,3))-1+f,k=parseInt(ht.substr(6,3))),e.bondStore.addBond(x,y,k)}else if(ht.substr(0,6)==="M  CHG"){const er=parseInt(ht.substr(6,3));for(let tr=0,Hm=10;tr<er;++tr,Hm+=8){const oi=parseInt(ht.substr(Hm,3))-1+f,h0=parseInt(ht.substr(Hm+4,3));g.formalCharge[oi]=h0}}else ht.charAt(0)===">"&&(m=ht.match(Ug))?(U=m[1],F[U]=[]):U!==!1&&ht&&F[U].push(ht);++_}}})(0,Te.length,Te)})),t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),tc(e),De&&ke.timeEnd("SdfParser._parse "+this.name)}_postProcess(){tc(this.structure)}}Ne.add("sdf",Vg),Ne.add("sd",Vg),Ne.add("mol",Vg);function jg(r,e,t){return parseInt(r.substr(e,t).trim())}class Gg extends og{get type(){return"prmtop"}_parse(){De&&ke.time("PrmtopParser._parse "+this.name);const e=this.structure,t=this.structureBuilder,n=e.atomMap,i=e.atomStore;i.addField("partialCharge",1,"float32"),i.addField("radius",1,"float32");const s=[],o={},a=["NATOM","NTYPES","NBONH","MBONA","NTHETH","MTHETA","NPHIH","MPHIA","NHPARM","NPARM","NNB","NRES","NBONA","NTHETA","NPHIA","NUMBND","NUMANG","NPTRA","NATYP","NPHB","IFPERT","NBPER","NGPER","NDPER","MBPER","MGPER","MDPER","IFBOX","NMXRS","IFCAP","NUMEXTRA","NCOPY"];let l,d,u,g,x;a.forEach((A=>{o[A]=0}));let y,b,_,h,f,E=new Uint8Array(0);this.streamer.eachChunkOfLines((function(A){(function(M,T,R){for(let P=M;P<T;++P){const L=R[P],O=L.trim();if(O&&!L.startsWith("%FORMAT")){if(L.startsWith("%FLAG")){const I=L.substr(5).trim();h=0,I==="TITLE"?_=0:I==="POINTERS"?_=1:I==="ATOM_NAME"?_=2:I==="CHARGE"?_=3:I==="MASS"?_=4:I==="RESIDUE_LABEL"?_=5:I==="RESIDUE_POINTER"?_=6:I==="BONDS_INC_HYDROGEN"?(f=0,_=7):I==="BONDS_WITHOUT_HYDROGEN"?(f=o.NBONH,_=8):_=I==="RADII"?9:void 0}else if(_===0)s.push(O);else if(_===1){const I=Math.min(h+10,32);for(let k=0;h<I;++k,++h)o[a[h]]=parseInt(L.substr(8*k,8).trim());l=new Array(o.NATOM),d=new Float32Array(o.NATOM),u=new Float32Array(o.NATOM),i.resize(o.NATOM);const N=o.NBONH+o.MBONA;g=new Uint32Array(N),x=new Uint32Array(N),E=new Uint8Array(N),y=new Array(o.NRES),b=new Uint32Array(o.NRES)}else if(_===2){const I=Math.min(h+20,o.NATOM);for(let N=0;h<I;++N,++h)l[h]=L.substr(4*N,4).trim()}else if(_===3){const I=Math.min(h+5,o.NATOM);for(let N=0;h<I;++N,++h)d[h]=parseFloat(L.substr(16*N,16))/18.2223}else if(_!==4){if(_===5){const I=Math.min(h+20,o.NRES);for(let N=0;h<I;++N,++h)y[h]=L.substr(4*N,4).trim()}else if(_===6){const I=Math.min(h+10,o.NRES);for(let N=0;h<I;++N,++h)b[h]=jg(L,8*N,8)}else if(_===7){const I=Math.min(h+10,3*o.NBONH);for(let N=0;h<I;++N,++h){const k=h%3;k===0&&(g[f]=jg(L,8*N,8)/3),k===1&&(x[f]=jg(L,8*N,8)/3,E[f]=1,++f)}}else if(_===8){const I=Math.min(h+10,3*o.MBONA);for(let N=0;h<I;++N,++h){const k=h%3;k===0&&(g[f]=jg(L,8*N,8)/3),k===1&&(x[f]=jg(L,8*N,8)/3,E[f]=1,++f)}}else if(_===9){const I=Math.min(h+5,o.NATOM);for(let N=0;h<I;++N,++h)u[h]=parseFloat(L.substr(16*N,16))}}}}})(0,A.length,A)})),e.title=s.join(" ");const m=o.NATOM;let S=0,w=y[0],v=1;for(let A=0;A<m;++A)A+1===b[S+1]&&(++S,w=y[S],v=S+1),i.atomTypeId[A]=n.add(l[A]),i.serial[A]=A+1,t.addAtom(0,"","",w,v,!1);i.partialCharge.set(d),i.radius.set(u),e.bondStore.length=E.length,e.bondStore.count=E.length,e.bondStore.atomIndex1=g,e.bondStore.atomIndex2=x,e.bondStore.bondOrder=E,t.finalize(),e.finalizeAtoms(),e.finalizeBonds(),Xa(e,!0),Ya(e,!0,!0),Ga(e,!0),tc(e),De&&ke.timeEnd("PrmtopParser._parse "+this.name)}}Ne.add("prmtop",Gg),Ne.add("parm7",Gg);const Hg=/\s+/,qg=/(^\*|REMARK)*/;Ne.add("psf",class extends og{get type(){return"psf"}_parse(){De&&ke.time("PsfParser._parse "+this.name);const r=this.structure,e=this.structureBuilder,t=r.atomMap,n=r.atomStore;n.addField("partialCharge",1,"float32");const i=[];let s,o,a,l,d,u,g=0,x=0,y=0;this.streamer.eachChunkOfLines((function(b){(function(_,h,f){for(let E=_;E<h;++E){const m=f[E].trim();if(m){if(s===2){const S=m.split(Hg),w=parseInt(S[0]),v=S[1],A=parseInt(S[2]),M=S[3],T=S[4],R=parseFloat(S[6]);v!==a&&(o=ja(x),++x),n.growIfFull(),n.atomTypeId[g]=t.add(T),n.serial[g]=w,n.partialCharge[g]=R,e.addAtom(0,o,o,M,A,!1),g+=1,a=v}else if(s===3){const S=m.split(Hg);for(let w=0,v=S.length;w<v;w+=2)l[y]=parseInt(S[w])-1,d[y]=parseInt(S[w+1])-1,u[y]=1,y+=1}else if(s===1)i.push(m.replace(qg,"").trim());else if(s!==4){if(s!==5){if(s!==6)if(m.includes("!NATOM")){s=2;const S=parseInt(m.split(Hg)[0]);n.resize(S)}else if(m.includes("!NBOND")){s=3;const S=parseInt(m.split(Hg)[0]);l=new Uint32Array(S),d=new Uint32Array(S),u=new Uint8Array(S)}else m.includes("!NTITLE")?s=1:m.includes("!NTHETA")?s=4:m.includes("!NPHI")?s=5:m.includes("!NIMPHI")&&(s=6)}}}else s=void 0}})(0,b.length,b)})),r.title=i.join(" "),r.bondStore.length=u.length,r.bondStore.count=y,r.bondStore.atomIndex1=l,r.bondStore.atomIndex2=d,r.bondStore.bondOrder=u,e.finalize(),r.finalizeAtoms(),r.finalizeBonds(),Xa(r,!0),Ya(r,!0,!0),tc(r),De&&ke.timeEnd("PsfParser._parse "+this.name)}});const Wg=/\[ (.+) \]/,Xg=/\s+/;Ne.add("top",class extends og{get type(){return"top"}_parse(){De&&ke.time("TopParser._parse "+this.name);const r=this.structure,e=this.structureBuilder,t=r.atomMap,n=r.bondStore,i=r.atomStore;i.addField("partialCharge",1,"float32");const s=[],o={};let a,l;this.streamer.eachChunkOfLines((function(E){(function(m,S,w){for(let v=m;v<S;++v){const A=w[v];let M=A.trim();if(!M||M[0]==="*"||M[0]===";")continue;if(M.startsWith("#include"))throw new Error("TopParser: #include statements not allowed");const T=A.match(Wg);if(T!==null){const P=T[1];P==="moleculetype"?(l=2,a={atoms:[],bonds:[]}):l=P==="atoms"?3:P==="bonds"?4:P==="system"?0:P==="molecules"?1:void 0;continue}const R=M.indexOf(";");if(R!==-1&&(M=M.substring(0,R).trim()),l===2){const P=M.split(Xg)[0];o[P]=a}else if(l===3){const P=M.split(Xg);a.atoms.push([parseInt(P[2]),P[3],P[4],parseFloat(P[6])])}else if(l===4){const P=M.split(Xg);a.bonds.push([parseInt(P[0]),parseInt(P[1])])}else if(l===0)r.title=M;else if(l===1){const P=M.split(Xg);s.push([P[0],parseInt(P[1])])}}})(0,E.length,E)}));let d=0,u=0;s.forEach((function(E){const[m,S]=E,w=o[m];d+=S*w.atoms.length,u+=S*w.bonds.length})),i.resize(d),n.resize(u);let g,x=0,y=0,b=0,_=0,h=0,f=0;s.forEach((function(E){const[m,S]=E,w=o[m],v=ja(_);for(let A=0;A<S;++A){g=-1;const M=as.includes(m)?v:ja(b);w.atoms.forEach((function(T){const[R,P,L,O]=T;R!==g&&++y,i.atomTypeId[x]=t.add(L),i.serial[x]=x+1,i.partialCharge[x]=O,e.addAtom(0,v,M,P,y+1,!1),++x,g=R})),w.bonds.forEach((function(T){n.atomIndex1[h]=f+T[0]-1,n.atomIndex2[h]=f+T[1]-1,++h})),++b,f+=w.atoms.length}++_})),n.count=u,e.finalize(),r.finalizeAtoms(),r.finalizeBonds(),Xa(r,!0),Ya(r,!0,!0),tc(r),De&&ke.timeEnd("TopParser._parse "+this.name)}});class Yg extends sg{constructor(e,t){super(e,t),this.frames=new ml(this.name,this.path)}get type(){return"trajectory"}get __objName(){return"frames"}}function Kg(r,e){if(r)throw new TypeError("Not a valid NetCDF v3.x file: "+e)}function Zg(r){r.offset%4!=0&&r.skip(4-r.offset%4)}function Qg(r){const e=r.readUint32(),t=r.readChars(e);return Zg(r),t}Ne.add("dcd",class extends Yg{get type(){return"dcd"}get isBinary(){return!0}_parse(){De&&ke.time("DcdParser._parse "+this.name);const r=_t(this.streamer.data),e=new DataView(r),t=this.frames,n=t.coordinates,i=t.boxes,s={};let o=0;const a=new Int32Array(r,0,23),l=a[0]!==e.getInt32(0);if(a[0]!==84){const h=r.byteLength;for(let f=0;f<h;f+=4)e.setFloat32(f,e.getFloat32(f),!0)}a[0]!==84&&ke.error("dcd bad format, header block start"),String.fromCharCode(e.getUint8(4),e.getUint8(5),e.getUint8(6),e.getUint8(7))!=="CORD"&&ke.error("dcd bad format, format string");let d=!1,u=!1,g=!1;a[22]!==0&&(d=!0,a[12]!==0&&(u=!0),a[13]===1&&(g=!0)),s.NSET=a[2],s.ISTART=a[3],s.NSAVC=a[4],s.NAMNF=a[10],s.DELTA=d?e.getFloat32(44,l):e.getFloat64(44,l),a[22]!==84&&ke.error("dcd bad format, header block end"),o=o+84+8;const x=e.getInt32(o,l),y=o+1;if((x-4)%80!=0&&ke.error("dcd bad format, title block start"),s.TITLE=gt(new Uint8Array(r,y,x)),e.getInt32(y+x+4-1,l)!==x&&ke.error("dcd bad format, title block end"),o=o+x+8,e.getInt32(o,l)!==4&&ke.error("dcd bad format, natom block start"),s.NATOM=e.getInt32(o+4,l),e.getInt32(o+8,l)!==4&&ke.error("dcd bad format, natom block end"),o=o+4+8,s.NAMNF>0)return void ke.error("dcd format with fixed atoms unsupported, aborting");const b=s.NATOM,_=4*b;for(let h=0,f=s.NSET;h<f;++h){if(u){o+=4;const m=new Float32Array(9);m[0]=e.getFloat64(o,l),m[4]=e.getFloat64(o+16,l),m[8]=e.getFloat64(o+40,l),i.push(m),o+=48,o+=4}const E=new Float32Array(3*b);for(let m=0;m<3;++m){e.getInt32(o,l)!==_&&ke.error("dcd bad format, coord block start",h,m),o+=4;const S=new Float32Array(r,o,b);for(let w=0;w<b;++w)E[3*w+m]=S[w];o+=_,e.getInt32(o,l)!==_&&ke.error("dcd bad format, coord block end",h,m),o+=4}n.push(E),g&&(o+=4+e.getInt32(o,l)+4)}s.DELTA&&(t.deltaTime=20.45482949774598*s.DELTA),s.ISTART>=1&&(t.timeOffset=(s.ISTART-1)*t.deltaTime),De&&ke.timeEnd("DcdParser._parse "+this.name)}});const Jg={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function ty(r){switch(Number(r)){case Jg.BYTE:return"byte";case Jg.CHAR:return"char";case Jg.SHORT:return"short";case Jg.INT:return"int";case Jg.FLOAT:return"float";case Jg.DOUBLE:return"double";default:return"undefined"}}function ey(r){switch(Number(r)){case Jg.BYTE:case Jg.CHAR:return 1;case Jg.SHORT:return 2;case Jg.INT:case Jg.FLOAT:return 4;case Jg.DOUBLE:return 8;default:return-1}}function iy(r){switch(String(r)){case"byte":return Jg.BYTE;case"char":return Jg.CHAR;case"short":return Jg.SHORT;case"int":return Jg.INT;case"float":return Jg.FLOAT;case"double":return Jg.DOUBLE;default:return-1}}function ry(r,e){if(r!==1){const t=new Array(r);for(let n=0;n<r;n++)t[n]=e();return t}return e()}function ny(r,e,t){switch(e){case Jg.BYTE:return r.readBytes(t);case Jg.CHAR:return(function(n){return n.charCodeAt(n.length-1)===0?n.substring(0,n.length-1):n})(r.readChars(t));case Jg.SHORT:return ry(t,r.readInt16.bind(r));case Jg.INT:return ry(t,r.readInt32.bind(r));case Jg.FLOAT:return ry(t,r.readFloat32.bind(r));case Jg.DOUBLE:return ry(t,r.readFloat64.bind(r));default:return void Kg(!0,"non valid type "+e)}}const sy=0,oy=10,ay=11,cy=12;function ly(r,e){const t={recordDimension:{length:r.readUint32()}};t.version=e;const n=(function(s){let o,a,l;const d=s.readUint32();if(d===sy)return Kg(s.readUint32()!==sy,"wrong empty tag for list of dimensions"),[];{Kg(d!==oy,"wrong tag for list of dimensions");const u=s.readUint32();o=new Array(u);for(let g=0;g<u;g++){const x=Qg(s),y=s.readUint32();y===0&&(a=g,l=x),o[g]={name:x,size:y}}return{dimensions:o,recordId:a,recordName:l}}})(r);t.recordDimension.id=n.recordId,t.recordDimension.name=n.recordName,t.dimensions=n.dimensions,t.globalAttributes=hy(r);const i=(function(s,o,a){const l=s.readUint32();let d,u=0;if(l===sy)return Kg(s.readUint32()!==sy,"wrong empty tag for list of variables"),[];{Kg(l!==ay,"wrong tag for list of variables");const g=s.readUint32();d=new Array(g);for(let x=0;x<g;x++){const y=Qg(s),b=s.readUint32(),_=new Array(b);for(let S=0;S<b;S++)_[S]=s.readUint32();const h=hy(s),f=s.readUint32();Kg(f<1&&f>6,"non valid type "+f);const E=s.readUint32();let m=s.readUint32();a===2&&(Kg(m>0,"offsets larger than 4GB not supported"),m=s.readUint32()),_[0]===o&&(u+=E),d[x]={name:y,dimensions:_,attributes:h,type:ty(f),size:E,offset:m,record:_[0]===o}}}return{variables:d,recordStep:u}})(r,n.recordId,e);return t.variables=i.variables,t.recordDimension.recordStep=i.recordStep,t}function hy(r){let e;const t=r.readUint32();if(t===sy)return Kg(r.readUint32()!==sy,"wrong empty tag for list of attributes"),[];{Kg(t!==cy,"wrong tag for list of attributes");const n=r.readUint32();e=new Array(n);for(let i=0;i<n;i++){const s=Qg(r),o=r.readUint32();Kg(o<1||o>6,"non valid type "+o);const a=r.readUint32(),l=ny(r,o,a);Zg(r),e[i]={name:s,type:ty(o),value:l}}}return e}class uy{constructor(e){const t=new li(e);t.setBigEndian(),Kg(t.readChars(3)!=="CDF","should start with CDF");const n=t.readByte();Kg(n>2,"unknown version"),this.header=ly(t,n),this.buffer=t}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(e){return this.header.variables.findIndex((function(t){return t.name===e}))!==-1}getDataVariable(e){let t;return t=typeof e=="string"?this.header.variables.find((function(n){return n.name===e})):e,Kg(t===void 0,"variable not found"),this.buffer.seek(t.offset),t.record?(function(n,i,s){const o=iy(i.type),a=i.size?i.size/ey(o):1,l=s.length,d=new Array(l),u=s.recordStep;for(let g=0;g<l;g++){const x=n.offset;d[g]=ny(n,o,a),n.seek(x+u)}return d})(this.buffer,t,this.header.recordDimension):(function(n,i){const s=iy(i.type),o=i.size/ey(s),a=new Array(o);for(let l=0;l<o;l++)a[l]=ny(n,s,1);return a})(this.buffer,t)}}class dy extends Yg{get type(){return"nctraj"}get isBinary(){return!0}_parse(){De&&ke.time("NctrajParser._parse "+this.name);const e=new uy(this.streamer.data),t=this.frames,n=t.coordinates,i=t.boxes,s=t.times;e.getDataVariable("coordinates").forEach((function(o){n.push(new Float32Array(o))})),e.hasDataVariable("cell_lengths")&&e.getDataVariable("cell_lengths").forEach((function(o){i.push(new Float32Array(o))})),e.hasDataVariable("time")&&e.getDataVariable("time").forEach((function(o){s.push(o)})),s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),De&&ke.timeEnd("NctrajParser._parse "+this.name)}}Ne.add("nctraj",dy),Ne.add("ncdf",dy),Ne.add("nc",dy);Ne.add("trr",class extends Yg{get type(){return"trr"}get isBinary(){return!0}_parse(){De&&ke.time("TrrParser._parse "+this.name);const r=_t(this.streamer.data),e=new DataView(r),t=this.frames,n=t.coordinates,i=t.boxes,s=t.times;let o=0;for(;;){o+=8;const a=e.getInt32(o);o+=4,o+=a;const l=e.getInt32(o+8),d=e.getInt32(o+12),u=e.getInt32(o+16),g=e.getInt32(o+28),x=e.getInt32(o+32),y=e.getInt32(o+36),b=e.getInt32(o+40);o+=52;const _=l/9,h=3*b;if(_===8?s.push(e.getFloat64(o)):s.push(e.getFloat32(o)),o+=2*_,l){const f=new Float32Array(9);if(_===8)for(let E=0;E<9;++E)f[E]=10*e.getFloat64(o),o+=8;else for(let E=0;E<9;++E)f[E]=10*e.getFloat32(o),o+=4;i.push(f)}if(o+=d,o+=u,g){let f;if(_===8){f=new Float32Array(h);for(let E=0;E<h;++E)f[E]=10*e.getFloat64(o),o+=8}else{const E=new Uint32Array(r,o,h);for(let m=0;m<h;++m){const S=E[m];E[m]=(255&S)<<24|(65280&S)<<8|S>>8&65280|S>>24&255}f=new Float32Array(r,o,h);for(let m=0;m<h;++m)f[m]*=10,o+=4}n.push(f)}if(o+=x,o+=y,o>=r.byteLength)break}s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),De&&ke.timeEnd("TrrParser._parse "+this.name)}});const my=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]);function fy(r){let e=1,t=0;for(;r>=e&&t<32;)t++,e<<=1;return t}const py=new Uint8Array(32);function gy(r,e){let t=1,n=0;py[0]=1;for(let s=0;s<r;s++){let o,a=0;for(o=0;o<t;o++)a+=py[o]*e[s],py[o]=255&a,a>>=8;for(;a!==0;)py[o++]=255&a,a>>=8;t=o}let i=1;for(t--;py[t]>=i;)n++,i*=2;return n+8*t}function yy(r,e,t,n){const i=(1<<t)-1;let s=n[1],o=n[2],a=r[0],l=0;for(;t>=8;)o=o<<8|e[a++],l|=o>>s<<t-8,t-=8;return t>0&&(s<t&&(s+=8,o=o<<8|e[a++]),s-=t,l|=o>>s&(1<<t)-1),l&=i,r[0]=a,r[1]=s,r[2]=o,l}const by=new Int32Array(32);function _y(r,e,t,n,i,s,o){let a=0;for(by[1]=0,by[2]=0,by[3]=0;n>8;)by[a++]=yy(r,e,8,o),n-=8;n>0&&(by[a++]=yy(r,e,n,o));for(let l=t-1;l>0;l--){let d=0;for(let u=a-1;u>=0;u--){d=d<<8|by[u];const g=d/i[l]|0;by[u]=g,d-=g*i[l]}s[l]=d}s[0]=by[0]|by[1]<<8|by[2]<<16|by[3]<<24}Ne.add("xtc",class extends Yg{get type(){return"xtc"}get isBinary(){return!0}_parse(){De&&ke.time("XtcParser._parse "+this.name);const r=_t(this.streamer.data),e=new DataView(r),t=this.frames,n=t.coordinates,i=t.boxes,s=t.times,o=new Int32Array(6),a=new Int32Array(3),l=new Int32Array(3),d=new Uint32Array(3),u=new Float32Array(3),g=new Float32Array(3);let x=0;const y=new Int32Array(3),b=new Uint32Array(y.buffer);for(;;){let _;const h=e.getInt32(x+4);x+=12;const f=3*h;s.push(e.getFloat32(x)),x+=4;const E=new Float32Array(9);for(let m=0;m<9;++m)E[m]=10*e.getFloat32(x),x+=4;if(i.push(E),h<=9){_=new Float32Array(h);for(let m=0;m<h;++m)_[m]=e.getFloat32(x),x+=4}else{y[0]=y[1]=y[2]=0,a[0]=a[1]=a[2]=0,d[0]=d[1]=d[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,g[0]=g[1]=g[2]=0,_=new Float32Array(f);let m=0;const S=e.getInt32(x);x+=4;const w=e.getFloat32(x);let v;x+=4,o[0]=e.getInt32(x),o[1]=e.getInt32(x+4),o[2]=e.getInt32(x+8),o[3]=e.getInt32(x+12),o[4]=e.getInt32(x+16),o[5]=e.getInt32(x+20),a[0]=o[3]-o[0]+1,a[1]=o[4]-o[1]+1,a[2]=o[5]-o[2]+1,x+=24,(a[0]|a[1]|a[2])>16777215?(l[0]=fy(a[0]),l[1]=fy(a[1]),l[2]=fy(a[2]),v=0):v=gy(3,a);let A=e.getInt32(x);x+=4;let M=A-1;M=9>M?9:M;let T=my[M]/2|0,R=my[A]/2|0;d[0]=d[1]=d[2]=my[A];let P=4*Math.ceil(e.getInt32(x)/4);x+=4;const L=1/w;let O=0,I=0;const N=new Uint8Array(r,x);for(u[0]=u[1]=u[2]=0;I<S;){v===0?(u[0]=yy(y,N,l[0],b),u[1]=yy(y,N,l[1],b),u[2]=yy(y,N,l[2],b)):_y(y,N,3,v,a,u,b),I++,u[0]+=o[0],u[1]+=o[1],u[2]+=o[2],g[0]=u[0],g[1]=u[1],g[2]=u[2];let k=0;if(yy(y,N,1,b)===1&&(O=yy(y,N,5,b),k=O%3,O-=k,k--),O>0){u[0]=u[1]=u[2]=0;for(let U=0;U<O;U+=3){if(_y(y,N,3,A,d,u,b),I++,u[0]+=g[0]-R,u[1]+=g[1]-R,u[2]+=g[2]-R,U===0){let F=u[0];u[0]=g[0],g[0]=F,F=u[1],u[1]=g[1],g[1]=F,F=u[2],u[2]=g[2],g[2]=F,_[m++]=g[0]*L,_[m++]=g[1]*L,_[m++]=g[2]*L}else g[0]=u[0],g[1]=u[1],g[2]=u[2];_[m++]=u[0]*L,_[m++]=u[1]*L,_[m++]=u[2]*L}}else _[m++]=u[0]*L,_[m++]=u[1]*L,_[m++]=u[2]*L;if(A+=k,k<0?(R=T,T=A>9?my[A-1]/2|0:0):k>0&&(T=R,R=my[A]/2|0),d[0]=d[1]=d[2]=my[A],d[0]===0||d[1]===0||d[2]===0)return void console.error("(xdrfile error) Undefined error.")}x+=P}for(let m=0;m<f;m++)_[m]*=10;if(n.push(_),x>=r.byteLength)break}s.length>=1&&(t.timeOffset=s[0]),s.length>=2&&(t.deltaTime=s[1]-s[0]),De&&ke.timeEnd("XtcParser._parse "+this.name)}});class xy extends sg{constructor(e,t){const n=t||{};super(e,n),this.volume=new $o(this.name,this.path),this.voxelSize=nt(n.voxelSize,1)}get type(){return"volume"}get __objName(){return"volume"}_afterParse(){this.volume.setMatrix(this.getMatrix()),super._afterParse()}getMatrix(){return new Matrix4}}const vy=/\s+/,wy=/-?\d+(?:\.\d*)?(?:[eE][+-]?\d+)?/g,Ay=.529177210859;class Sy extends xy{get type(){return"cube"}_parse(){De&&ke.time("CubeParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(6),n={},i=Ay*this.voxelSize;function s(u,g){var x=t[u].trim().split(vy)[g];return parseFloat(x)}n.atomCount=Math.abs(s(2,0)),n.originX=s(2,1)*Ay,n.originY=s(2,2)*Ay,n.originZ=s(2,3)*Ay,n.NVX=s(3,0),n.NVY=s(4,0),n.NVZ=s(5,0),n.basisX=new Vector3(s(3,1),s(3,2),s(3,3)).multiplyScalar(i),n.basisY=new Vector3(s(4,1),s(4,2),s(4,3)).multiplyScalar(i),n.basisZ=new Vector3(s(5,1),s(5,2),s(5,3)).multiplyScalar(i);const o=new Float32Array(n.NVX*n.NVY*n.NVZ);let a=0,l=0;const d=s(2,0)>0?0:1;this.streamer.eachChunkOfLines((function(u){(function(g,x,y){for(let b=g;b<x;++b){const _=y[b].trim();if(_!==""&&l>=n.atomCount+6+d){const h=_.match(wy);for(let f=0,E=h.length;f<E;++f)o[a]=parseFloat(h[f]),++a}++l}})(0,u.length,u)})),e.header=n,e.setData(o,n.NVZ,n.NVY,n.NVX),De&&ke.timeEnd("CubeParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=new Matrix4;return t.multiply(new Matrix4().makeTranslation(e.originX,e.originY,e.originZ)),t.multiply(new Matrix4().makeBasis(e.basisZ,e.basisY,e.basisX)),t}}Ne.add("cub",Sy),Ne.add("cube",Sy);class Cy extends xy{get type(){return"dsn6"}get isBinary(){return!0}_parse(){De&&ke.time("Dsn6Parser._parse "+this.name);const e=this.volume,t={};let n,i;const s=_t(this.streamer.data),o=new Int16Array(s),a=new Uint8Array(s),l=String.fromCharCode.apply(null,a.subarray(0,512));if(l.startsWith(":-)"))t.xStart=parseInt(l.substr(10,5)),t.yStart=parseInt(l.substr(15,5)),t.zStart=parseInt(l.substr(20,5)),t.xExtent=parseInt(l.substr(32,5)),t.yExtent=parseInt(l.substr(38,5)),t.zExtent=parseInt(l.substr(42,5)),t.xRate=parseInt(l.substr(52,5)),t.yRate=parseInt(l.substr(58,5)),t.zRate=parseInt(l.substr(62,5)),t.xlen=parseFloat(l.substr(73,10))*this.voxelSize,t.ylen=parseFloat(l.substr(83,10))*this.voxelSize,t.zlen=parseFloat(l.substr(93,10))*this.voxelSize,t.alpha=parseFloat(l.substr(103,10)),t.beta=parseFloat(l.substr(113,10)),t.gamma=parseFloat(l.substr(123,10)),n=parseFloat(l.substr(138,12))/100,i=parseInt(l.substr(155,8)),t.sigma=100*parseFloat(l.substr(170,12));else{if(o[18]!==100)for(let T=0,R=o.length;T<R;++T){const P=o[T];o[T]=(255&P)<<8|P>>8&255}t.xStart=o[0],t.yStart=o[1],t.zStart=o[2],t.xExtent=o[3],t.yExtent=o[4],t.zExtent=o[5],t.xRate=o[6],t.yRate=o[7],t.zRate=o[8];const A=1/o[17],M=A*this.voxelSize;t.xlen=o[9]*M,t.ylen=o[10]*M,t.zlen=o[11]*M,t.alpha=o[12]*A,t.beta=o[13]*A,t.gamma=o[14]*A,n=o[15]/100,i=o[16],t.gamma=o[14]*A}e.header=t,De&&ke.log(t,n,i);const d=new Float32Array(t.xExtent*t.yExtent*t.zExtent);let u=512;const g=Math.ceil(t.xExtent/8),x=Math.ceil(t.yExtent/8),y=Math.ceil(t.zExtent/8);for(var b=0;b<y;++b)for(var _=0;_<x;++_)for(var h=0;h<g;++h)for(var f=0;f<8;++f)for(var E=8*b+f,m=0;m<8;++m)for(var S=8*_+m,w=0;w<8;++w){var v=8*h+w;if(!(v<t.xExtent&&S<t.yExtent&&E<t.zExtent)){u+=8-w;break}d[(v*t.yExtent+S)*t.zExtent+E]=(a[u]-i)/n,++u}e.setData(d,t.zExtent,t.yExtent,t.xExtent),t.sigma&&e.setStats(void 0,void 0,void 0,t.sigma),De&&ke.timeEnd("Dsn6Parser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const s=[[],t,n,i],o=[0,e.xRate,e.yRate,e.zRate],a=[0,1,2,3],l=new Matrix4;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.multiply(new Matrix4().makeRotationY(It(90))),l.multiply(new Matrix4().makeTranslation(-e.zStart,e.yStart,e.xStart)),l.multiply(new Matrix4().makeScale(-1,1,1)),l}}Ne.add("dsn6",Cy),Ne.add("brix",Cy);const Py=/\s+/;class Iy extends xy{get type(){return"dx"}_parse(){De&&ke.time("DxParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(30),n=this.parseHeaderLines(t),i=this.volume.header,s=n.dataLineStart,o=i.nx*i.ny*i.nz,a=new Float32Array(o);let l=0,d=0;this.streamer.eachChunkOfLines((function(u){(function(g,x,y){for(let b=g;b<x;++b){if(l<o&&d>s){const _=y[b].trim();if(_!==""){const h=_.split(Py);for(let f=0,E=h.length;f<E;++f)a[l]=parseFloat(h[f]),++l}}++d}})(0,u.length,u)})),e.setData(a,i.nz,i.ny,i.nx),De&&ke.timeEnd("DxParser._parse "+this.name)}parseHeaderLines(e){const t={},n=e.length;let i=0,s=0,o=0;for(let a=0;a<n;++a){let l;const d=e[a];if(d.startsWith("object 1"))l=d.split(Py),t.nx=parseInt(l[5]),t.ny=parseInt(l[6]),t.nz=parseInt(l[7]);else if(d.startsWith("origin"))l=d.split(Py),t.xmin=parseFloat(l[1]),t.ymin=parseFloat(l[2]),t.zmin=parseFloat(l[3]);else if(d.startsWith("delta"))l=d.split(Py),o===0?t.hx=parseFloat(l[1])*this.voxelSize:o===1?t.hy=parseFloat(l[2])*this.voxelSize:o===2&&(t.hz=parseFloat(l[3])*this.voxelSize),o+=1;else if(d.startsWith("object 3")){i=a,s+=d.length+1;break}s+=d.length+1}return this.volume.header=t,{dataLineStart:i,headerByteCount:s}}getMatrix(){const e=this.volume.header,t=new Matrix4;return t.multiply(new Matrix4().makeRotationY(It(90))),t.multiply(new Matrix4().makeTranslation(-e.zmin,e.ymin,e.xmin)),t.multiply(new Matrix4().makeScale(-e.hz,e.hy,e.hx)),t}}Ne.add("dx",Iy);Ne.add("dxbin",class extends Iy{get type(){return"dxbin"}get isBinary(){return!0}_parse(){De&&ke.time("DxbinParser._parse "+this.name);const r=_t(this.streamer.data),e=(function(l,d=10485760,u=`
`){let g="",x=[];for(let y=0;y<l.length;y+=d){const b=gt(l.subarray(y,y+d)),_=b.lastIndexOf(u);if(_===-1)g+=b;else{const h=g+b.substr(0,_);x=x.concat(h.split(u)),g=_===b.length-u.length?"":b.substr(_+u.length)}}return g!==""&&x.push(g),x})(new Uint8Array(r,0,1e3)),t=this.parseHeaderLines(e),n=this.volume.header,i=t.headerByteCount,s=n.nx*n.ny*n.nz,o=new DataView(r),a=new Float32Array(s);for(let l=0;l<s;++l)a[l]=o.getFloat64(8*l+i,!0);this.volume.setData(a,n.nz,n.ny,n.nx),De&&ke.timeEnd("DxbinParser._parse "+this.name)}});class ky extends xy{get type(){return"mrc"}get isBinary(){return!0}_parse(){De&&ke.time("MrcParser._parse "+this.name);const e=this.volume,t={},n=_t(this.streamer.data),i=new Int32Array(n,0,56),s=new Float32Array(n,0,56),o=new DataView(n);if(t.MAP=String.fromCharCode(o.getUint8(208),o.getUint8(209),o.getUint8(210),o.getUint8(211)),t.MACHST=[o.getUint8(212),o.getUint8(213)],t.MACHST[0]===17&&t.MACHST[1]===17){const l=n.byteLength;for(let d=0;d<l;d+=4)o.setFloat32(d,o.getFloat32(d),!0)}let a;if(t.NX=i[0],t.NY=i[1],t.NZ=i[2],t.MODE=i[3],t.NXSTART=i[4],t.NYSTART=i[5],t.NZSTART=i[6],t.MX=i[7],t.MY=i[8],t.MZ=i[9],t.xlen=s[10]*this.voxelSize,t.ylen=s[11]*this.voxelSize,t.zlen=s[12]*this.voxelSize,t.alpha=s[13],t.beta=s[14],t.gamma=s[15],t.MAPC=i[16],t.MAPR=i[17],t.MAPS=i[18],t.DMIN=s[19],t.DMAX=s[20],t.DMEAN=s[21],t.ISPG=i[22],t.NSYMBT=i[23],t.LSKFLG=i[24],t.originX=s[49],t.originY=s[50],t.originZ=s[51],t.ARMS=s[54],e.header=t,t.MODE===2)a=new Float32Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ);else if(t.MODE===0){if(a=new Float32Array(new Int8Array(n,1024+t.NSYMBT,t.NX*t.NY*t.NZ)),i[39]===-128&&i[40]===127){const l=(t.DMAX-t.DMIN)/255,d=.5*(t.DMIN+t.DMAX+l);for(let u=0,g=a.length;u<g;++u)a[u]=l*a[u]+d}}else ke.error("MrcParser unknown mode",t.MODE);e.setData(a,t.NX,t.NY,t.NZ),t.ARMS!==0&&e.setStats(t.DMIN,t.DMAX,t.DMEAN,t.ARMS),De&&ke.timeEnd("MrcParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.xlen,0,0],n=[e.ylen*Math.cos(Math.PI/180*e.gamma),e.ylen*Math.sin(Math.PI/180*e.gamma),0],i=[e.zlen*Math.cos(Math.PI/180*e.beta),e.zlen*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.zlen*e.zlen*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const s=[[],t,n,i],o=[0,e.MX,e.MY,e.MZ],a=[0,e.MAPC,e.MAPR,e.MAPS],l=new Matrix4;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.setPosition(new Vector3(e.originX,e.originY,e.originZ)),l.multiply(new Matrix4().makeTranslation(e.NXSTART,e.NYSTART,e.NZSTART)),l}}Ne.add("mrc",ky),Ne.add("ccp4",ky),Ne.add("map",ky);const My=/\s+/;function Ty(r){return r.trim().split(My).map(parseFloat)}class Dy extends xy{get type(){return"xplor"}_parse(){De&&ke.time("XplorParser._parse "+this.name);const e=this.volume,t=this.streamer.peekLines(8),n={};let i;i=t[2].startsWith("REMARKS")?parseInt(t[1].substring(0,8))+2:5;const s=i+3,o=Ty(t[i]);n.NA=o[0],n.AMIN=o[1],n.AMAX=o[2],n.NB=o[3],n.BMIN=o[4],n.BMAX=o[5],n.NC=o[6],n.CMIN=o[7],n.CMAX=o[8];const a=Ty(t[i+1]);n.a=a[0]*this.voxelSize,n.b=a[1]*this.voxelSize,n.c=a[2]*this.voxelSize,n.alpha=a[3],n.beta=a[4],n.gamma=a[5];const l=n.AMAX-n.AMIN+1,d=n.BMAX-n.BMIN+1,u=n.CMAX-n.CMIN+1,g=l*d*u,x=new Float32Array(g),y=Math.ceil(1+l*d/6);let b=0,_=0;this.streamer.eachChunkOfLines((function(h){(function(f,E,m){for(let S=f;S<E;++S){const w=m[S];if(_>=s&&(_-s)%y!=0&&b<g)for(let v=0,A=6;v<A;++v){const M=parseFloat(w.substr(12*v,12));if(isNaN(M))break;x[b++]=M}else if(b===g){const v=w.trim();if(v&&v!=="-9999"){const A=Ty(w);n.RAVE=A[0],n.RSIGMA=A[1]}}++_}})(0,h.length,h)})),e.header=n,e.setData(x,l,d,u),n.RAVE!==0&&n.RSIGMA!==1&&e.setStats(void 0,void 0,n.RAVE,n.RSIGMA),De&&ke.timeEnd("XplorParser._parse "+this.name)}getMatrix(){const e=this.volume.header,t=[e.a,0,0],n=[e.b*Math.cos(Math.PI/180*e.gamma),e.b*Math.sin(Math.PI/180*e.gamma),0],i=[e.c*Math.cos(Math.PI/180*e.beta),e.c*(Math.cos(Math.PI/180*e.alpha)-Math.cos(Math.PI/180*e.gamma)*Math.cos(Math.PI/180*e.beta))/Math.sin(Math.PI/180*e.gamma),0];i[2]=Math.sqrt(e.c*e.c*Math.sin(Math.PI/180*e.beta)*Math.sin(Math.PI/180*e.beta)-i[1]*i[1]);const s=[[],t,n,i],o=[0,e.NA,e.NB,e.NC],a=[0,1,2,3],l=new Matrix4;return l.set(s[a[1]][0]/o[a[1]],s[a[2]][0]/o[a[2]],s[a[3]][0]/o[a[3]],0,s[a[1]][1]/o[a[1]],s[a[2]][1]/o[a[2]],s[a[3]][1]/o[a[3]],0,s[a[1]][2]/o[a[1]],s[a[2]][2]/o[a[2]],s[a[3]][2]/o[a[3]],0,0,0,0,1),l.multiply(new Matrix4().makeTranslation(e.AMIN,e.BMIN,e.CMIN)),l}}function By(r,e,t){let n,i,s;r/=360,e/=100,t/=100;const o=Math.floor(6*r),a=6*r-o,l=t*(1-e),d=t*(1-a*e),u=t*(1-(1-a)*e);switch(o%6){case 0:n=t,i=u,s=l;break;case 1:n=d,i=t,s=l;break;case 2:n=l,i=t,s=u;break;case 3:n=l,i=d,s=t;break;case 4:n=u,i=l,s=t;break;case 5:n=t,i=l,s=d}return[n,i,s]}Ne.add("xplor",Dy),Ne.add("cns",Dy);const Fy={red:By(0,100,100),orange:By(20,100,100),gold:By(40,100,100),yellow:By(60,100,100),lime:By(80,100,100),green:By(120,80,100),sea:By(150,100,100),cyan:By(180,100,85),sky:By(210,75,95),blue:By(240,70,100),purple:By(275,75,100),magenta:By(300,95,100),hotpink:By(335,100,100),pink:By(350,55,100),peach:By(25,75,100),lilac:By(275,55,100),pinktint:By(340,30,100),peachtint:By(25,50,100),yellowtint:By(60,50,100),greentint:By(135,40,100),bluetint:By(220,40,100),lilactint:By(275,35,100),white:By(0,0,100),gray:By(0,0,50),brown:By(20,45,75),deadwhite:[1,1,1],deadblack:[0,0,0],invisible:[0,0,0]},Ey=/[\s,]+/,$y=/[^{}\s]*{[^{}]+}|[^{}\s]+/g,Oy=/^{+|}+$/g,Ry=/^['"]+|['"]+$/g,Ly=/\s*=\s*/g;function Ny(r){let e,t,n,i=[];const s=(r=r.replace(Ly,"=")).match($y);for(let o=1;o<s.length;++o){const a=s[o];if(a[0]==="{")e=a.substring(1,a.length-1);else{const l=a.split("=");l.length===2&&(l[0]==="color"?t=Fy[l[1]]:l[0]==="width"?n=parseInt(l[1]):l[0]==="master"&&i.push(l[1].replace(Oy,"")))}}return{listName:e,listColor:t,listMasters:i,listWidth:n}}function zy(r){const e=(r=r.trim()).indexOf("{"),t=r.indexOf("}"),n=r.substr(t+1).split(Ey),i=r.substr(e+1,t-1),s=[parseFloat(n[n.length-3]),parseFloat(n[n.length-2]),parseFloat(n[n.length-1])];let o,a,l,d=!1,u=!1;for(let g=4;g<=n.length;g++){const x=n[n.length-g];x in Fy&&(o=Fy[n[n.length-g]]),x.startsWith("width")&&(a=parseInt(x.substring(5))),x.startsWith("r=")&&(l=parseFloat(x.split("=")[1])),x.startsWith("P")&&(d=!0),x.startsWith("X")&&(u=!0)}return{label:i,position:s,color:o,radius:l,width:a,isLineBreak:d,isTriangleBreak:u}}function Uy(r){const e=r.indexOf("{"),t=r.indexOf("}");return r.substring(e!==-1?e+1:0,t!==-1?t:void 0).trim()}function Vy(r){const e=r.indexOf("}");return e===-1?void 0:r.substr(e+1).trim()}function jy(r){let e="",t=[],n={};const i=(r=r.replace(Ly,"=")).match($y);for(let s=1;s<i.length;++s){const o=i[s];if(o[0]==="{")e=o.substring(1,o.length-1);else{const a=o.split("=");a.length===2?a[0]==="master"?t.push(a[1].replace(Oy,"")):n[a[0]]=a[1].replace(Oy,""):n[a[0]]=!0}}return{groupName:e,groupFlags:n,groupMasters:t}}Ne.add("kin",class extends sg{get type(){return"kin"}get __objName(){return"kinemage"}_parse(){De&&ke.time(`KinParser._parse ${this.name}`);const r={kinemage:void 0,onewidth:void 0,"1viewid":void 0,pdbfile:void 0,texts:[],text:"",captions:[],caption:"",groupDict:{},subgroupDict:{},masterDict:{},pointmasterDict:{},dotLists:[],vectorLists:[],ballLists:[],ribbonLists:[]};let e,t;this.kinemage=r;let n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T=!1,R="",P=!1,L="",O=null,I=null,N=!1,k="",U=!1,F="",j=!1,H=!1;if(this.streamer.eachChunkOfLines((function(B){(function(V,K,q){for(let Fe=V;Fe<K;++Fe){const We=q[Fe];if(We[0]==="@"&&(T=!1,P=!1,N=!1,U=!1,j=!1,H=!1),We)if(We.startsWith("@dotlist")){let{listColor:J,listName:et,listMasters:ht}=Ny(We);T=!0,R="",i=[],s=[],o=[],n=J,e&&(ht=ht.concat(e)),t&&(ht=ht.concat(t)),r.dotLists.push({name:et,masterArray:ht,labelArray:i,positionArray:s,colorArray:o})}else if(We.startsWith("@vectorlist")){let{listMasters:J,listName:et,listWidth:ht,listColor:er}=Ny(We);J&&J.forEach((function(tr){r.masterDict[tr]||(r.masterDict[tr]={indent:!1,visible:!1})})),P=!0,L="",O=null,I=null,d=[],u=[],g=[],x=[],y=[],b=[],a=er,l=[],ht&&l.push(ht),e&&(J=J.concat(e)),t&&(J=J.concat(t)),r.vectorLists.push({name:et,masterArray:J,label1Array:d,label2Array:u,position1Array:g,position2Array:x,color1Array:y,color2Array:b,width:l})}else if(We.startsWith("@balllist")){let{listName:J,listColor:et,listMasters:ht}=Ny(We);ht&&ht.forEach((function(er){r.masterDict[er]||(r.masterDict[er]={indent:!1,visible:!1})})),N=!0,k="",f=[],_=[],E=[],m=[],h=et,e&&(ht=ht.concat(e)),t&&(ht=ht.concat(t)),r.ballLists.push({name:J,masterArray:ht,labelArray:f,radiusArray:_,positionArray:E,colorArray:m})}else if(We.startsWith("@ribbonlist")||We.startsWith("@trianglelist")){let{listMasters:J,listName:et,listColor:ht}=Ny(We);J&&J.forEach((function(er){r.masterDict[er]||(r.masterDict[er]={indent:!1,visible:!1})})),U=!0,F="",w=[],v=[],A=[],M=[],S=ht,e&&(J=J.concat(e)),t&&(J=J.concat(t)),r.ribbonLists.push({name:et,masterArray:J,labelArray:w,positionArray:v,breakArray:A,colorArray:M})}else if(We.startsWith("@text"))j=!0,r.texts.push(We.substr(5));else if(We.startsWith("@caption"))H=!0,r.captions.push(We.substr(8));else if(T){let{label:J,color:et,position:ht}=zy(We);J==='"'?J=R:R=J,et===void 0&&(et=n),i.push(J),s.push(...ht),o.push(...et)}else if(P){let J=We.replace(/(?!^){/g,`
{`).split(/\n/);for(var Te=0;Te<J.length;Te++){let et=J[Te],{label:ht,color:er,width:tr,position:Hm,isLineBreak:oi}=zy(et);ht==='"'?ht=L:L=ht,er===void 0&&(er=a),oi||O!==null&&(tr&&l.push(tr),d.push(L),g.push(...O),y.push(...I),u.push(ht),x.push(...Hm),b.push(...er)),L=ht,O=Hm,I=er}}else if(N){let{label:J,radius:et,color:ht,position:er}=zy(We);J==='"'?J=k:k=J,et===void 0&&(et=1),ht===void 0&&(ht=h),f.push(J),_.push(et),E.push(...er),m.push(...ht)}else if(U){let{label:J,color:et,position:ht,isTriangleBreak:er}=zy(We);J==='"'?J=F:F=J,et===void 0&&(et=S),w.push(J),v.push(...ht),A.push(er),M.push(...et)}else if(j)r.texts.push(We);else if(H)r.captions.push(We);else if(We.startsWith("@kinemage"))r.kinemage=parseInt(We.substr(9).trim());else if(We.startsWith("@onewidth"))r.onewidth=!0;else if(We.startsWith("@1viewid"))r["1viewid"]=Uy(We);else if(We.startsWith("@pdbfile"))r.pdbfile=Uy(We);else if(We.startsWith("@group")){let{groupName:J,groupFlags:et,groupMasters:ht}=jy(We);r.groupDict[J]||(r.groupDict[J]={dominant:!1,animate:!1},e=ht),e&&e.forEach((function(er){r.masterDict[er]||(r.masterDict[er]={indent:!1,visible:!1})}));for(let er in et)r.groupDict[J][er]=et[er]}else if(We.startsWith("@subgroup")){const{groupName:J,groupFlags:et,groupMasters:ht}=jy(We);r.subgroupDict[J]||(r.subgroupDict[J]={dominant:!1,animate:!1},t=ht),t&&t.forEach((function(er){r.masterDict[er]||(r.masterDict[er]={indent:!1,visible:!1})}));for(let er in et)r.subgroupDict[J][er]=et[er]}else if(We.startsWith("@master")){const J=Uy(We),et=Vy(We);r.masterDict[J]||(r.masterDict[J]={indent:!1,visible:!1}),et==="on"?r.masterDict[J].visible=!0:et==="off"?r.masterDict[J].visible=!1:et==="indent"&&(r.masterDict[J].indent=!0)}else if(We.startsWith("@pointmaster")){const{groupName:J,groupFlags:et}=jy(We);r.pointmasterDict[J]={id:Object.keys(et)[0].replace(Ry,"")}}else console.log(We);else T=!1,P=!1,N=!1,U=!1}})(0,B.length,B)})),r.text=r.texts.join(`
`).trim(),r.caption=r.captions.join(`
`).trim(),r.ribbonLists){let B=[];r.ribbonLists.forEach((function(V){B.push((function(K){let{labelArray:q,positionArray:Te,colorArray:Fe,breakArray:We}=K,J=[],et=[],ht=[],er=[];for(let tr=0;tr<We.length/3;tr++){let Hm=3*tr,oi=9*tr;We[Hm+1]||We[Hm+2]||(J.push(q[Hm]),J.push(q[Hm+1]),J.push(q[Hm+2]),er.push(We[Hm]),er.push(We[Hm+1]),er.push(We[Hm+2]),et.push(Te[oi]),et.push(Te[oi+1]),et.push(Te[oi+2]),et.push(Te[oi+3]),et.push(Te[oi+4]),et.push(Te[oi+5]),et.push(Te[oi+6]),et.push(Te[oi+7]),et.push(Te[oi+8]),ht.push(Fe[oi]),ht.push(Fe[oi+1]),ht.push(Fe[oi+2]),ht.push(Fe[oi+3]),ht.push(Fe[oi+4]),ht.push(Fe[oi+5]),ht.push(Fe[oi+6]),ht.push(Fe[oi+7]),ht.push(Fe[oi+8]))}return{name:K.name,masterArray:K.masterArray,labelArray:J,positionArray:et,breakArray:er,colorArray:ht}})((function(K){let{labelArray:q,positionArray:Te,colorArray:Fe,breakArray:We}=K,J=[];for(let Hm=0;Hm<3*(q.length-2);++Hm)J[Hm]=q[Hm-2*Math.floor(Hm/3)];let et=[];for(let Hm=0;Hm<3*(We.length-2);++Hm)et[Hm]=We[Hm-2*Math.floor(Hm/3)];let ht=[];for(let Hm=0;Hm<9*(Te.length/3-2);++Hm)ht[Hm]=Te[Hm-6*Math.floor(Hm/9)];let er=[];for(let Hm=0;Hm<9*(Fe.length/3-2);++Hm)er[Hm]=Fe[Hm-6*Math.floor(Hm/9)];let tr=[];for(let Hm=0;Hm<ht.length/3;++Hm)tr.push(new Vector3(ht[3*Hm],ht[3*Hm]+1,ht[3*Hm]+2));return{name:K.name,masterArray:K.masterArray,labelArray:J,positionArray:ht,breakArray:et,colorArray:er}})(V)))})),r.ribbonLists=B}De&&ke.timeEnd(`KinParser._parse ${this.name}`)}});class Gy extends sg{constructor(e,t){super(e,t),this.loader=this.getLoader(),this.surface=new Fo(this.name,this.path)}get type(){return"surface"}get __objName(){return"surface"}_parse(){var e=this.loader.parse(this.streamer.asText());this.surface.fromGeometry(e)}}const Hy=function(){this.regexp={vertex_pattern:/^v\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,normal_pattern:/^vn\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,uv_pattern:/^vt\s+([\d.+\-eE]+)\s+([\d.+\-eE]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}};Hy.prototype={constructor:Hy,setPath:function(r){this.path=r},_createParserState:function(){var r={objects:[],object:{},vertices:[],normals:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);this.object={name:e||"",geometry:{vertices:[],normals:[]},fromDeclaration:t!==!1},this.objects.push(this.object)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},addVertex:function(e,t,n){var i=this.vertices,s=this.object.geometry.vertices;s.push(i[e+0]),s.push(i[e+1]),s.push(i[e+2]),s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2]),s.push(i[n+0]),s.push(i[n+1]),s.push(i[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var i=this.normals,s=this.object.geometry.normals;s.push(i[e+0]),s.push(i[e+1]),s.push(i[e+2]),s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2]),s.push(i[n+0]),s.push(i[n+1]),s.push(i[n+2])},addFace:function(e,t,n,i,s,o,a,l){var d,u=this.vertices.length,g=this.parseVertexIndex(e,u),x=this.parseVertexIndex(t,u),y=this.parseVertexIndex(n,u);if(i===void 0?this.addVertex(g,x,y):(d=this.parseVertexIndex(i,u),this.addVertex(g,x,d),this.addVertex(x,y,d)),s!==void 0){var b=this.normals.length;g=this.parseNormalIndex(s,b),x=s===o?g:this.parseNormalIndex(o,b),y=s===a?g:this.parseNormalIndex(a,b),i===void 0?this.addNormal(g,x,y):(d=this.parseNormalIndex(l,b),this.addNormal(g,x,d),this.addNormal(x,y,d))}},addLineGeometry:function(e){this.object.geometry.type="Line";for(var t=this.vertices.length,n=0,i=e.length;n<i;n++)this.addVertexLine(this.parseVertexIndex(e[n],t))}};return r.startObject("",!1),r},parse:function(r){var e,t,n=this._createParserState();r.indexOf(`\r
`)!==-1&&(r=r.replace(/\r\n/g,`
`)),r.indexOf(`\\
`)!==-1&&(r=r.replace(/\\\n/g,""));var i=r.split(`
`),s="",o="",a="",l=[],d=typeof"".trimLeft=="function";for(e=0,t=i.length;e<t;e++)if(s=i[e],(s=d?s.trimLeft():s.trim()).length!==0&&(o=s.charAt(0))!=="#"){if(o==="v"){if((a=s.charAt(1))===" "&&(l=this.regexp.vertex_pattern.exec(s))!==null)n.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a==="n"&&(l=this.regexp.normal_pattern.exec(s))!==null)n.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));else if(a!=="t"||this.regexp.uv_pattern.exec(s)===null)throw new Error("Unexpected vertex/normal/uv line: '"+s+"'")}else if(o==="f"){if((l=this.regexp.face_vertex_uv_normal.exec(s))!==null)n.addFace(l[1],l[4],l[7],l[10],l[3],l[6],l[9],l[12]);else if(this.regexp.face_vertex_uv.exec(s)===null)if((l=this.regexp.face_vertex_normal.exec(s))!==null)n.addFace(l[1],l[3],l[5],l[7],l[2],l[4],l[6],l[8]);else{if((l=this.regexp.face_vertex.exec(s))===null)throw new Error("Unexpected face line: '"+s+"'");n.addFace(l[1],l[2],l[3],l[4])}}else if(o==="l"){var u=s.substring(1).trim().split(" "),g=[],x=[];if(s.indexOf("/")===-1)g=u;else for(var y=0,b=u.length;y<b;y++){var _=u[y].split("/");_[0]!==""&&g.push(_[0]),_[1]!==""&&x.push(_[1])}n.addLineGeometry(g,x)}else if((l=this.regexp.object_pattern.exec(s))!==null){var h=l[0].substr(1).trim();n.startObject(h)}else if(!this.regexp.material_use_pattern.test(s)){if(!this.regexp.material_library_pattern.test(s)){if(this.regexp.smoothing_pattern.exec(s)===null){if(s==="\0")continue;throw new Error("Unexpected line: '"+s+"'")}}}}var f=[];for(e=0,t=n.objects.length;e<t;e++){var E=n.objects[e].geometry;if(E.vertices.length!==0){var m=new BufferGeometry;m.setAttribute("position",new BufferAttribute(new Float32Array(E.vertices),3)),E.normals.length>0?m.setAttribute("normal",new BufferAttribute(new Float32Array(E.normals),3)):m.computeVertexNormals(),f.push(m)}}return f}};Ne.add("obj",class extends Gy{get type(){return"obj"}getLoader(){return new Hy}});const qy=["int8","char","uint8","uchar","int16","short","uint16","ushort","int32","int","uint32","uint","float32","float","float64","double"];function Wy(r){if((function(e){return qy.includes(e)})(r))return r;throw new Error(`Unsupported data type: ${r}`)}function Xy(r){if(typeof r!="object"||r===null)throw new Error("Expected element to be an object");if(typeof r.name!="string")throw new Error("Expected element.name to be a string");if(typeof r.count!="number")throw new Error("Expected element.count to be a number");if(!Array.isArray(r.properties))throw new Error("Expected element.properties to be an array")}function Yy(r,e,t){switch(e){case"int8":case"char":return{read:n=>r.getInt8(n),size:1};case"uint8":case"uchar":return{read:n=>r.getUint8(n),size:1};case"int16":case"short":return{read:n=>r.getInt16(n,t),size:2};case"uint16":case"ushort":return{read:n=>r.getUint16(n,t),size:2};case"int32":case"int":return{read:n=>r.getInt32(n,t),size:4};case"uint32":case"uint":return{read:n=>r.getUint32(n,t),size:4};case"float32":case"float":return{read:n=>r.getFloat32(n,t),size:4};case"float64":case"double":return{read:n=>r.getFloat64(n,t),size:8};default:throw new Error(`Unsupported data type: ${e}`)}}function Ky(r,e){const t={};let n=0;for(let i=0;i<e.length;i++){const s=e[i],o=s.valueReader;if(s.isList){const a=[],l=s.countReader.read(r+n);n+=s.countReader.size;for(let d=0;d<l;d++)a.push(o.read(r+n)),n+=o.size;t[s.name]=a}else t[s.name]=o.read(r+n),n+=o.size}return[t,n]}class Zy{constructor(){this._color=new Color,this.propertyNameMapping={},this.customPropertyMapping={}}setPropertyNameMapping(e){this.propertyNameMapping=e}createBuffer(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const t of Object.keys(this.customPropertyMapping))e[t]=[];return e}extractHeaderText(e){let t=0,n=!0,i="";const s=[],o=new TextDecoder().decode(e.subarray(0,5)),a=/^ply\r\n/.test(o);do{const l=String.fromCharCode(e[t++]);l!==`
`&&l!=="\r"?i+=l:(i==="end_header"&&(n=!1),i!==""&&(s.push(i),i=""))}while(n&&t<e.length);return a===!0&&t++,{headerText:s.join("\r")+"\r",headerLength:t}}handleElement(e,t,n,i){if(t==="vertex"){e.vertices.push(n[i.attrX],n[i.attrY],n[i.attrZ]),i.attrNX!==null&&i.attrNY!==null&&i.attrNZ!==null&&e.normals.push(n[i.attrNX],n[i.attrNY],n[i.attrNZ]),i.attrS!==null&&i.attrT!==null&&e.uvs.push(n[i.attrS],n[i.attrT]),i.attrR!==null&&i.attrG!==null&&i.attrB!==null&&(this._color.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255).convertSRGBToLinear(),e.colors.push(this._color.r,this._color.g,this._color.b));for(const s of Object.keys(this.customPropertyMapping))for(const o of this.customPropertyMapping[s])e[s].push(n[o])}else if(t==="face"){const s=n.vertex_indices||n.vertex_index,o=n.texcoord;s.length===3?(e.indices.push(s[0],s[1],s[2]),o&&o.length===6&&(e.faceVertexUvs.push(o[0],o[1]),e.faceVertexUvs.push(o[2],o[3]),e.faceVertexUvs.push(o[4],o[5]))):s.length===4&&(e.indices.push(s[0],s[1],s[3]),e.indices.push(s[1],s[2],s[3])),i.attrR!==null&&i.attrG!==null&&i.attrB!==null&&(this._color.setRGB(n[i.attrR]/255,n[i.attrG]/255,n[i.attrB]/255).convertSRGBToLinear(),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b),e.faceVertexColors.push(this._color.r,this._color.g,this._color.b))}}parse(e){let t;if(e instanceof ArrayBuffer){const n=new Uint8Array(e),{headerText:i,headerLength:s}=this.extractHeaderText(n),o=this.parseHeader(i,s);if(o.format==="ascii"){const a=new TextDecoder().decode(n);t=this.parseASCII(a,o)}else t=this.parseBinary(n,o)}else t=this.parseASCII(e,this.parseHeader(e));return t}parseHeader(e,t=0){let n="";const i=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);i!==null&&(n=i[1]);const s={comments:[],elements:[],headerLength:t,objInfo:"",format:"",version:""},o=n.split(/\r\n|\r|\n/);let a;for(let l=0;l<o.length;l++){let d=o[l];if(d=d.trim(),d==="")continue;const u=d.split(/\s+/),g=u.shift();switch(d=u.join(" "),g){case"format":s.format=u[0],s.version=u[1];break;case"comment":s.comments.push(d);break;case"element":a!==void 0&&(Xy(a),s.elements.push(a)),a={name:u[0],count:parseInt(u[1]),properties:[]};break;case"property":if(a===void 0){console.warn("property without element");continue}a.properties.push(Qy(u,this.propertyNameMapping));break;case"obj_info":s.objInfo=d;break;default:console.log("unhandled",g,u)}}return a!==void 0&&s.elements.push(a),s}parseASCII(e,t){const n=this.createBuffer();let i,s;i=(s=/end_header\s+(\S[\s\S]*\S|\S)\s*$/.exec(e))!==null?s[1].split(/\s+/):[];const o=new ib(i);e:for(let a=0;a<t.elements.length;a++){const l=t.elements[a],d=eb(l.properties);for(let u=0;u<l.count;u++){const g=tb(l.properties,o);if(!g)break e;this.handleElement(n,l.name,g,d)}}return this.postProcess(n)}parseBinary(e,t){const n=this.createBuffer(),i=t.format==="binary_little_endian",s=new DataView(e,t.headerLength);let o,a=0;for(let l=0;l<t.elements.length;l++){const d=t.elements[l],u=d.properties,g=eb(u),x=this.makeBinaryProperties(u,s,i);for(let y=0;y<d.count;y++){o=Ky(a,x),a+=o[1];const b=o[0];this.handleElement(n,d.name,b,g)}}return this.postProcess(n)}postProcess(e){let t=new BufferGeometry;e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new Float32BufferAttribute(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(t=t.toNonIndexed(),e.faceVertexUvs.length>0&&t.setAttribute("uv",new Float32BufferAttribute(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&t.setAttribute("color",new Float32BufferAttribute(e.faceVertexColors,3)));for(const n of Object.keys(this.customPropertyMapping))e[n].length>0&&t.setAttribute(n,new Float32BufferAttribute(e[n],this.customPropertyMapping[n].length));return t.computeBoundingSphere(),t}makeBinaryProperties(e,t,n){const i=[];for(let s=0,o=e.length;s<o;s++){const a=e[s];a.isList?i.push(Object.assign(Object.assign({},a),{countReader:Yy(t,a.countType,n),valueReader:Yy(t,a.type,n)})):i.push(Object.assign(Object.assign({},a),{valueReader:Yy(t,a.type,n)}))}return i}}function Qy(r,e){const t=r[0];let n;return n=t==="list"?{isList:!0,name:r[3],type:Wy(r[2]),countType:Wy(r[1])}:{isList:!1,name:r[1],type:Wy(t)},n.name in e&&(n.name=e[n.name]),n}function Jy(r,e){switch(e){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(r);case"float":case"double":case"float32":case"float64":return parseFloat(r)}return 0}function tb(r,e){const t={name:"",type:""};for(let n=0;n<r.length;n++){if(e.empty())return null;const i=r[n];if(i.isList){const s=[],o=Jy(e.next(),i.countType);for(let a=0;a<o;a++){if(e.empty())return null;s.push(Jy(e.next(),i.type))}t[i.name]=s}else t[r[n].name]=Jy(e.next(),r[n].type)}return t}function eb(r){const e=r.map((n=>n.name));function t(n){for(let i=0,s=n.length;i<s;i++){const o=n[i];if(e.includes(o))return o}return null}return{attrX:t(["x","px","posx"])||"x",attrY:t(["y","py","posy"])||"y",attrZ:t(["z","pz","posz"])||"z",attrNX:t(["nx","normalx"]),attrNY:t(["ny","normaly"]),attrNZ:t(["nz","normalz"]),attrS:t(["s","u","texture_u","tx"]),attrT:t(["t","v","texture_v","ty"]),attrR:t(["red","diffuse_red","r","diffuse_r"]),attrG:t(["green","diffuse_green","g","diffuse_g"]),attrB:t(["blue","diffuse_blue","b","diffuse_b"])}}class ib{constructor(e){this.arr=e,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}Ne.add("ply",class extends Gy{get type(){return"ply"}getLoader(){return new Zy}});Ne.add("csv",class extends sg{constructor(r,e){const t=e||{};super(r,t),this.delimiter=nt(t.delimiter,","),this.comment=nt(t.comment,"#"),this.columnNames=nt(t.columnNames,!1),this.table={name:this.name,path:this.path,columnNames:[],data:[]}}get type(){return"csv"}get __objName(){return"table"}_parse(){const r=this.table.data,e=new RegExp("\\s*"+this.delimiter+"\\s*");let t=0;this.streamer.eachChunkOfLines((n=>{const i=n.length;for(let s=0;s<i;++s){const o=n[s].trim();if(o.startsWith(this.comment))continue;const a=o.split(e);t===0?this.table.columnNames=a:o&&r.push(a),++t}}))}});Ne.add("json",class extends sg{constructor(r,e){const t=e||{};super(r,t),this.string=nt(t.string,!1),this.json={name:this.name,path:this.path,data:{}}}get type(){return"json"}get __objName(){return"json"}get isJson(){return!0}_parse(){this.streamer.isBinary()||this.string?this.json.data=JSON.parse(this.streamer.asText()):this.json.data=this.streamer.data}});Ne.add("msgpack",class extends sg{constructor(r,e){super(r,e||{}),this.msgpack={name:this.name,path:this.path,data:void 0}}get type(){return"msgpack"}get __objName(){return"msgpack"}get isBinary(){return!0}_parse(){De&&ke.time("MsgpackParser._parse "+this.name),this.msgpack.data=$g(this.streamer.data),De&&ke.timeEnd("MsgpackParser._parse "+this.name)}});Ne.add("netcdf",class extends sg{constructor(r,e){super(r,e||{}),this.netcdf={name:this.name,path:this.path,data:void 0}}get type(){return"netcdf"}get __objName(){return"netcdf"}get isBinary(){return!0}_parse(){De&&ke.time("NetcdfParser._parse "+this.name),this.netcdf.data=new uy(this.streamer.data),De&&ke.timeEnd("NetcdfParser._parse "+this.name)}});class rb extends sg{constructor(e,t){super(e,t),this.text={name:this.name,path:this.path,data:""}}get type(){return"text"}get __objName(){return"text"}_parse(){this.text.data=this.streamer.asText()}}Ne.add("txt",rb),Ne.add("text",rb);const nb=/^['"]|['"]$/g,sb=/^<([\w-:.]+)\s*/,ob=/^([^<]*)/,ab=/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/;function cb(r){return r=r.trim().replace(/<!--[\s\S]*?-->/g,""),{declaration:e(),root:t()};function e(){if(!i(/^<\?xml\s*/))return;const a={attributes:{}};for(;!s()&&!o("?>");){const l=n();if(!l)return a;a.attributes[l.name]=l.value}return i(/\?>\s*/),a}function t(){const a=i(sb);if(!a)return;const l={name:a[1],attributes:{},children:[]};for(;!(s()||o(">")||o("?>")||o("/>"));){const u=n();if(!u)return l;l.attributes[u.name]=u.value}if(i(/^\s*\/>\s*/))return l;let d;for(i(/\??>\s*/),l.content=(function(){const u=i(ob);return u?u[1]:""})();d=t();)l.children.push(d);return i(/^<\/[\w-:.]+>\s*/),l}function n(){const a=i(ab);var l;if(a)return{name:a[1],value:(l=a[2],l.replace(nb,""))}}function i(a){const l=r.match(a);if(l)return r=r.slice(l[0].length),l}function s(){return r.length===0}function o(a){return r.indexOf(a)===0}}class lb extends sg{constructor(e,t){const n=t||{};super(e,n),this.useDomParser=nt(n.useDomParser,!1),this.xml={name:this.name,path:this.path,data:{}}}get type(){return"xml"}get __objName(){return"xml"}get isXml(){return!0}__xmlParser(e){return cb(e)}__domParser(e){return new window.DOMParser().parseFromString(e,"text/xml")}_parse(){De&&ke.time("XmlParser._parse "+this.name),this.useDomParser?this.streamer.data instanceof Document?this.xml.data=this.streamer.data:this.xml.data=this.__domParser(this.streamer.asText()):this.xml.data=this.__xmlParser(this.streamer.asText()),De&&ke.timeEnd("XmlParser._parse "+this.name)}}function hb(r,e){const t=r.getNamedItem(e);return t!==null?t.value:""}function ub(r,e,t=!1){const n=hb(r,"icode").trim(),i=hb(r,"chain").trim(),s=hb(r,"altcode");let o=hb(r,"resnum");return n&&(o+="^"+n),i&&(o+=":"+i),e&&(o+="."+e),t&&s.trim()&&(o+="%"+s),o+="/"+(parseInt(hb(r,"model"))-1),o}function db(r){const e=hb(r,"chain").trim();let t=`[${hb(r,"rescode")}]${hb(r,"resnum")}`;return e&&(t+=`:${e}`),t}function mb(r,e,t){r[e]===void 0?r[e]=t:r[e]|=t}function fb(r,e){return r!==null&&r.value===e}function pb(r,e,t){let n=0;const i=e.getElementsByTagName("clash");for(let s=0,o=i.length;s<o;++s)if(r[hb(i[s].attributes,"cid")]){n+=1;break}return e.getElementsByTagName("angle-outlier").length>0&&(n+=1),e.getElementsByTagName("bond-outlier").length>0&&(n+=1),e.getElementsByTagName("plane-outlier").length>0&&(n+=1),fb(t.getNamedItem("rota"),"OUTLIER")&&(n+=1),fb(t.getNamedItem("rama"),"OUTLIER")&&(n+=1),fb(t.getNamedItem("RNApucker"),"outlier")&&(n+=1),n}Ne.add("xml",lb);class gb{constructor(e,t){this.name=e,this.path=t,this.rsrzDict={},this.rsccDict={},this.rciDict={},this.clashDict={},this.clashArray=[],this.geoDict={},this.geoAtomDict={},this.atomDict={},this.clashSele="NONE"}get type(){return"validation"}fromXml(e){De&&ke.time("Validation.fromXml");const t=this.rsrzDict,n=this.rsccDict,i=this.rciDict,s=this.clashDict,o=this.clashArray,a=this.geoDict,l=this.geoAtomDict,d=this.atomDict,u=e.getElementsByTagName("Entry");if(u.length===1){const b=u[0].getElementsByTagName("chemical_shift_list");if(b.length===1){const _=b[0].getElementsByTagName("random_coil_index");for(let h=0,f=_.length;h<f;++h){const E=_[h].attributes;i[db(E)]=parseFloat(hb(E,"value"))}}}const g=e.getElementsByTagName("ModelledSubgroup"),x={},y=[];De&&ke.time("Validation.fromXml#clashDict");for(let b=0,_=g.length;b<_;++b){const h=g[b],f=h.attributes,E=ub(f);f.getNamedItem("rsrz")!==null&&(t[E]=parseFloat(hb(f,"rsrz"))),f.getNamedItem("rscc")!==null&&(n[E]=parseFloat(hb(f,"rscc")));const m=e.createAttribute("sele");m.value=E,f.setNamedItem(m);const S=h.getElementsByTagName("clash");for(let w=0,v=S.length;w<v;++w){const A=S[w].attributes,M=hb(A,"atom");if(Ja(M)!=="H"){const T=hb(A,"cid"),R=ub(f,M,!0);if(d[R]=!0,x[T]===void 0)x[T]={sele1:R,res1:E};else{const P=x[T];P.res1!==E&&(P.sele2=R,P.res2=E,y.push(P.res1,E),s[T]=P,o.push(P))}}}}De&&ke.timeEnd("Validation.fromXml#clashDict");for(let b=0,_=g.length;b<_;++b){const h=g[b],f=h.attributes,E=hb(f,"sele");if(hb(f,"seq")!=="."){const m=pb(s,h,f);m>0&&(a[E]=m)}else{const m=h.getElementsByTagName("clash"),S=h.getElementsByTagName("mog-bond-outlier"),w=h.getElementsByTagName("mog-angle-outlier");if(S.length>0||w.length>0||m.length>0){const v={};l[E]=v;for(let A=0,M=m.length;A<M;++A){const T=m[A].attributes;s[hb(T,"cid")]&&mb(v,hb(T,"atom"),1)}for(let A=0,M=S.length;A<M;++A)hb(S[A].attributes,"atoms").split(",").forEach((function(T){mb(v,T,2)}));for(let A=0,M=w.length;A<M;++A)hb(w[A].attributes,"atoms").split(",").forEach((function(T){mb(v,T,4)}))}}}this.clashSele=y.length?y.join(" OR "):"NONE",De&&ke.timeEnd("Validation.fromXml")}getClashData(e){De&&ke.time("Validation.getClashData");const t=e||{},n=t.structure,i=n.atomSet,s=new Color(nt(t.color,"#f0027f")),o=n.getAtomProxy(),a=n.getAtomProxy(),l=new Vector3,d=new Vector3,u=new Vector3,g=this.clashArray,x=g.length,y=new Float32Array(3*x),b=new Float32Array(3*x),_=Si(x,s.r,s.g,s.b),h=new Float32Array(x),f=new Float32Array(x);De&&ke.time("Validation.getClashData#atomDict");const E=this.atomDict;n.eachAtom((function(S){const w=(function(v){const A=v.inscode,M=v.chainname,T=v.atomname,R=v.altloc;let P=v.resno+"";return A&&(P+="^"+A),M&&(P+=":"+M),T&&(P+="."+T),R&&(P+="%"+R),P+="/"+v.modelIndex,P})(S);E[w]===!0&&(E[w]=S.index)})),De&&ke.timeEnd("Validation.getClashData#atomDict");let m=0;return g.forEach((function(S,w){if(o.index=E[S.sele1],a.index=E[S.sele2],o.index===void 0||a.index===void 0||!i.isSet(o.index,a.index))return;l.subVectors(a,o).setLength(o.vdw),d.copy(o).add(l),l.subVectors(o,a).setLength(a.vdw),u.copy(a).add(l);const v=o.distanceTo(a)/2,A=Math.sqrt(o.vdw*o.vdw-v*v),M=Math.sqrt(a.vdw*a.vdw-v*v);d.toArray(y,3*m),u.toArray(b,3*m),h[m]=(A+M)/2,f[m]=w,++m})),De&&ke.timeEnd("Validation.getClashData"),{position1:y.subarray(0,3*m),position2:b.subarray(0,3*m),color:_.subarray(0,3*m),color2:_.subarray(0,3*m),radius:h.subarray(0,m),picking:new Qs(f.subarray(0,m),this,n)}}}function yb(r,e){return r.length===e?r:r.subarray?r.subarray(0,e):(r.length=e,r)}function bb(r,e,t,n,i){if(e.subarray&&r.subarray)r.set(e.subarray(t,t+n),i);else for(var s=0;s<n;s++)r[i+s]=e[t+s]}function _b(r,e,t,n){for(var i=65535&r,s=r>>>16&65535,o=0;t!==0;){t-=o=t>2e3?2e3:t;do s=s+(i=i+e[n++]|0)|0;while(--o);i%=65521,s%=65521}return i|s<<16}Ne.add("validation",class extends lb{constructor(r,e){super(r,e||{}),this.useDomParser=!0,this.validation=new gb(this.name,this.path)}get __objName(){return"validation"}get isXml(){return!0}_parse(){super._parse(),De&&ke.time("ValidationParser._parse "+this.name),this.validation.fromXml(this.xml.data),De&&ke.timeEnd("ValidationParser._parse "+this.name)}});var xb=(function(){for(var r,e=[],t=0;t<256;t++){r=t;for(var n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;e[t]=r}return e})();function vb(r,e,t,n){var i=xb,s=n+t;r^=-1;for(var o=n;o<s;o++)r=r>>>8^i[255&(r^e[o])];return~r}var wb=30,Ab=12;function Sb(r,e){var t,n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R;t=r.state,n=r.next_in,T=r.input,i=n+(r.avail_in-5),s=r.next_out,R=r.output,o=s-(e-r.avail_out),a=s+(r.avail_out-257),l=t.dmax,d=t.wsize,u=t.whave,g=t.wnext,x=t.window,y=t.hold,b=t.bits,_=t.lencode,h=t.distcode,f=(1<<t.lenbits)-1,E=(1<<t.distbits)-1;e:do{b<15&&(y+=T[n++]<<b,b+=8,y+=T[n++]<<b,b+=8),m=_[y&f];t:for(;;){if(y>>>=S=m>>>24,b-=S,(S=m>>>16&255)===0)R[s++]=65535&m;else{if(!(16&S)){if(64&S){if(32&S){t.mode=Ab;break e}r.msg="invalid literal/length code",t.mode=wb;break e}m=_[(65535&m)+(y&(1<<S)-1)];continue t}for(w=65535&m,(S&=15)&&(b<S&&(y+=T[n++]<<b,b+=8),w+=y&(1<<S)-1,y>>>=S,b-=S),b<15&&(y+=T[n++]<<b,b+=8,y+=T[n++]<<b,b+=8),m=h[y&E];;){if(y>>>=S=m>>>24,b-=S,16&(S=m>>>16&255)){if(v=65535&m,b<(S&=15)&&(y+=T[n++]<<b,(b+=8)<S&&(y+=T[n++]<<b,b+=8)),(v+=y&(1<<S)-1)>l){r.msg="invalid distance too far back",t.mode=wb;break e}if(y>>>=S,b-=S,v>(S=s-o)){if((S=v-S)>u&&t.sane){r.msg="invalid distance too far back",t.mode=wb;break e}if(A=0,M=x,g===0){if(A+=d-S,S<w){w-=S;do R[s++]=x[A++];while(--S);A=s-v,M=R}}else if(g<S){if(A+=d+g-S,(S-=g)<w){w-=S;do R[s++]=x[A++];while(--S);if(A=0,g<w){w-=S=g;do R[s++]=x[A++];while(--S);A=s-v,M=R}}}else if(A+=g-S,S<w){w-=S;do R[s++]=x[A++];while(--S);A=s-v,M=R}for(;w>2;)R[s++]=M[A++],R[s++]=M[A++],R[s++]=M[A++],w-=3;w&&(R[s++]=M[A++],w>1&&(R[s++]=M[A++]))}else{A=s-v;do R[s++]=R[A++],R[s++]=R[A++],R[s++]=R[A++],w-=3;while(w>2);w&&(R[s++]=R[A++],w>1&&(R[s++]=R[A++]))}break}if(64&S){r.msg="invalid distance code",t.mode=wb;break e}m=h[(65535&m)+(y&(1<<S)-1)]}}break}}while(n<i&&s<a);n-=w=b>>3,y&=(1<<(b-=w<<3))-1,r.next_in=n,r.next_out=s,r.avail_in=n<i?i-n+5:5-(n-i),r.avail_out=s<a?a-s+257:257-(s-a),t.hold=y,t.bits=b}var Cb=15,Pb=852,Ib=592,kb=0,Mb=1,Tb=2,Db=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Bb=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Fb=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Eb=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function $b(r,e,t,n,i,s,o,a){var l,d,u,g,x,y,b,_,h,f=a.bits,E=0,m=0,S=0,w=0,v=0,A=0,M=0,T=0,R=0,P=0,L=null,O=0,I=new Uint16Array(Cb+1),N=new Uint16Array(Cb+1),k=null,U=0;for(E=0;E<=Cb;E++)I[E]=0;for(m=0;m<n;m++)I[e[t+m]]++;for(v=f,w=Cb;w>=1&&I[w]===0;w--);if(v>w&&(v=w),w===0)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(S=1;S<w&&I[S]===0;S++);for(v<S&&(v=S),T=1,E=1;E<=Cb;E++)if(T<<=1,(T-=I[E])<0)return-1;if(T>0&&(r===kb||w!==1))return-1;for(N[1]=0,E=1;E<Cb;E++)N[E+1]=N[E]+I[E];for(m=0;m<n;m++)e[t+m]!==0&&(o[N[e[t+m]]++]=m);if(r===kb?(L=k=o,y=19):r===Mb?(L=Db,O-=257,k=Bb,U-=257,y=256):(L=Fb,k=Eb,y=-1),P=0,m=0,E=S,x=s,A=v,M=0,u=-1,g=(R=1<<v)-1,r===Mb&&R>Pb||r===Tb&&R>Ib)return 1;for(;;){b=E-M,o[m]<y?(_=0,h=o[m]):o[m]>y?(_=k[U+o[m]],h=L[O+o[m]]):(_=96,h=0),l=1<<E-M,S=d=1<<A;do i[x+(P>>M)+(d-=l)]=b<<24|_<<16|h;while(d!==0);for(l=1<<E-1;P&l;)l>>=1;if(l!==0?(P&=l-1,P+=l):P=0,m++,--I[E]==0){if(E===w)break;E=e[t+o[m]]}if(E>v&&(P&g)!==u){for(M===0&&(M=v),x+=S,T=1<<(A=E-M);A+M<w&&!((T-=I[A+M])<=0);)A++,T<<=1;if(R+=1<<A,r===Mb&&R>Pb||r===Tb&&R>Ib)return 1;i[u=P&g]=v<<24|A<<16|x-s}}return P!==0&&(i[x+P]=E-M<<24|64<<16),a.bits=v,0}var Ob=1,Rb=2,Lb=0,Nb=-2,zb=1,Ub=12,Vb=30,jb=852,Gb=592;function Hb(r){return(r>>>24&255)+(r>>>8&65280)+((65280&r)<<8)+((255&r)<<24)}function qb(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Wb(r){var e;return r&&r.state?((e=r.state).wsize=0,e.whave=0,e.wnext=0,(function(t){var n;return t&&t.state?(n=t.state,t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=1&n.wrap),n.mode=zb,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new Int32Array(jb),n.distcode=n.distdyn=new Int32Array(Gb),n.sane=1,n.back=-1,Lb):Nb})(r)):Nb}function Xb(r,e){var t,n;return r?(n=new qb,r.state=n,n.window=null,t=(function(i,s){var o,a;return i&&i.state?(a=i.state,s<0?(o=0,s=-s):(o=1+(s>>4),s<48&&(s&=15)),s&&(s<8||s>15)?Nb:(a.window!==null&&a.wbits!==s&&(a.window=null),a.wrap=o,a.wbits=s,Wb(i))):Nb})(r,e),t!==Lb&&(r.state=null),t):Nb}var Yb,Kb,Zb=!0;function Qb(r){if(Zb){var e;for(Yb=new Int32Array(512),Kb=new Int32Array(32),e=0;e<144;)r.lens[e++]=8;for(;e<256;)r.lens[e++]=9;for(;e<280;)r.lens[e++]=7;for(;e<288;)r.lens[e++]=8;for($b(Ob,r.lens,0,288,Yb,0,r.work,{bits:9}),e=0;e<32;)r.lens[e++]=5;$b(Rb,r.lens,0,32,Kb,0,r.work,{bits:5}),Zb=!1}r.lencode=Yb,r.lenbits=9,r.distcode=Kb,r.distbits=5}function Jb(r,e,t,n){var i,s=r.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),n>=s.wsize?(bb(s.window,e,t-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((i=s.wsize-s.wnext)>n&&(i=n),bb(s.window,e,t-n,i,s.wnext),(n-=i)?(bb(s.window,e,t-n,n,0),s.wnext=n,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function t_(r,e){var t,n,i,s,o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R=0,P=new Uint8Array(4),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!r||!r.state||!r.output||!r.input&&r.avail_in!==0)return Nb;(t=r.state).mode===Ub&&(t.mode=13),o=r.next_out,i=r.output,l=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,d=t.hold,u=t.bits,g=a,x=l,A=Lb;e:for(;;)switch(t.mode){case zb:if(t.wrap===0){t.mode=13;break}for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(2&t.wrap&&d===35615){t.check=0,P[0]=255&d,P[1]=d>>>8&255,t.check=vb(t.check,P,2,0),d=0,u=0,t.mode=2;break}if(t.flags=0,t.head&&(t.head.done=!1),!(1&t.wrap)||(((255&d)<<8)+(d>>8))%31){r.msg="incorrect header check",t.mode=Vb;break}if((15&d)!=8){r.msg="unknown compression method",t.mode=Vb;break}if(u-=4,v=8+(15&(d>>>=4)),t.wbits===0)t.wbits=v;else if(v>t.wbits){r.msg="invalid window size",t.mode=Vb;break}t.dmax=1<<v,r.adler=t.check=1,t.mode=512&d?10:Ub,d=0,u=0;break;case 2:for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(t.flags=d,(255&t.flags)!=8){r.msg="unknown compression method",t.mode=Vb;break}if(57344&t.flags){r.msg="unknown header flags set",t.mode=Vb;break}t.head&&(t.head.text=d>>8&1),512&t.flags&&(P[0]=255&d,P[1]=d>>>8&255,t.check=vb(t.check,P,2,0)),d=0,u=0,t.mode=3;case 3:for(;u<32;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.head&&(t.head.time=d),512&t.flags&&(P[0]=255&d,P[1]=d>>>8&255,P[2]=d>>>16&255,P[3]=d>>>24&255,t.check=vb(t.check,P,4,0)),d=0,u=0,t.mode=4;case 4:for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.head&&(t.head.xflags=255&d,t.head.os=d>>8),512&t.flags&&(P[0]=255&d,P[1]=d>>>8&255,t.check=vb(t.check,P,2,0)),d=0,u=0,t.mode=5;case 5:if(1024&t.flags){for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.length=d,t.head&&(t.head.extra_len=d),512&t.flags&&(P[0]=255&d,P[1]=d>>>8&255,t.check=vb(t.check,P,2,0)),d=0,u=0}else t.head&&(t.head.extra=null);t.mode=6;case 6:if(1024&t.flags&&((y=t.length)>a&&(y=a),y&&(t.head&&(v=t.head.extra_len-t.length,t.head.extra||(t.head.extra=new Array(t.head.extra_len)),bb(t.head.extra,n,s,y,v)),512&t.flags&&(t.check=vb(t.check,n,y,s)),a-=y,s+=y,t.length-=y),t.length))break e;t.length=0,t.mode=7;case 7:if(2048&t.flags){if(a===0)break e;y=0;do v=n[s+y++],t.head&&v&&t.length<65536&&(t.head.name+=String.fromCharCode(v));while(v&&y<a);if(512&t.flags&&(t.check=vb(t.check,n,y,s)),a-=y,s+=y,v)break e}else t.head&&(t.head.name=null);t.length=0,t.mode=8;case 8:if(4096&t.flags){if(a===0)break e;y=0;do v=n[s+y++],t.head&&v&&t.length<65536&&(t.head.comment+=String.fromCharCode(v));while(v&&y<a);if(512&t.flags&&(t.check=vb(t.check,n,y,s)),a-=y,s+=y,v)break e}else t.head&&(t.head.comment=null);t.mode=9;case 9:if(512&t.flags){for(;u<16;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(d!==(65535&t.check)){r.msg="header crc mismatch",t.mode=Vb;break}d=0,u=0}t.head&&(t.head.hcrc=t.flags>>9&1,t.head.done=!0),r.adler=t.check=0,t.mode=Ub;break;case 10:for(;u<32;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}r.adler=t.check=Hb(d),d=0,u=0,t.mode=11;case 11:if(t.havedict===0)return r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=d,t.bits=u,2;r.adler=t.check=1,t.mode=Ub;case Ub:case 13:if(t.last){d>>>=7&u,u-=7&u,t.mode=27;break}for(;u<3;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}switch(t.last=1&d,u-=1,3&(d>>>=1)){case 0:t.mode=14;break;case 1:Qb(t),t.mode=20;break;case 2:t.mode=17;break;case 3:r.msg="invalid block type",t.mode=Vb}d>>>=2,u-=2;break;case 14:for(d>>>=7&u,u-=7&u;u<32;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if((65535&d)!=(d>>>16^65535)){r.msg="invalid stored block lengths",t.mode=Vb;break}t.length=65535&d,d=0,u=0,t.mode=15;case 15:t.mode=16;case 16:if(y=t.length){if(y>a&&(y=a),y>l&&(y=l),y===0)break e;bb(i,n,s,y,o),a-=y,s+=y,l-=y,o+=y,t.length-=y;break}t.mode=Ub;break;case 17:for(;u<14;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(t.nlen=257+(31&d),d>>>=5,u-=5,t.ndist=1+(31&d),d>>>=5,u-=5,t.ncode=4+(15&d),d>>>=4,u-=4,t.nlen>286||t.ndist>30){r.msg="too many length or distance symbols",t.mode=Vb;break}t.have=0,t.mode=18;case 18:for(;t.have<t.ncode;){for(;u<3;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.lens[L[t.have++]]=7&d,d>>>=3,u-=3}for(;t.have<19;)t.lens[L[t.have++]]=0;if(t.lencode=t.lendyn,t.lenbits=7,M={bits:t.lenbits},A=$b(0,t.lens,0,19,t.lencode,0,t.work,M),t.lenbits=M.bits,A){r.msg="invalid code lengths set",t.mode=Vb;break}t.have=0,t.mode=19;case 19:for(;t.have<t.nlen+t.ndist;){for(;f=(R=t.lencode[d&(1<<t.lenbits)-1])>>>16&255,E=65535&R,!((h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(E<16)d>>>=h,u-=h,t.lens[t.have++]=E;else{if(E===16){for(T=h+2;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(d>>>=h,u-=h,t.have===0){r.msg="invalid bit length repeat",t.mode=Vb;break}v=t.lens[t.have-1],y=3+(3&d),d>>>=2,u-=2}else if(E===17){for(T=h+3;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}u-=h,v=0,y=3+(7&(d>>>=h)),d>>>=3,u-=3}else{for(T=h+7;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}u-=h,v=0,y=11+(127&(d>>>=h)),d>>>=7,u-=7}if(t.have+y>t.nlen+t.ndist){r.msg="invalid bit length repeat",t.mode=Vb;break}for(;y--;)t.lens[t.have++]=v}}if(t.mode===Vb)break;if(t.lens[256]===0){r.msg="invalid code -- missing end-of-block",t.mode=Vb;break}if(t.lenbits=9,M={bits:t.lenbits},A=$b(Ob,t.lens,0,t.nlen,t.lencode,0,t.work,M),t.lenbits=M.bits,A){r.msg="invalid literal/lengths set",t.mode=Vb;break}if(t.distbits=6,t.distcode=t.distdyn,M={bits:t.distbits},A=$b(Rb,t.lens,t.nlen,t.ndist,t.distcode,0,t.work,M),t.distbits=M.bits,A){r.msg="invalid distances set",t.mode=Vb;break}t.mode=20;case 20:t.mode=21;case 21:if(a>=6&&l>=258){r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=d,t.bits=u,Sb(r,x),o=r.next_out,i=r.output,l=r.avail_out,s=r.next_in,n=r.input,a=r.avail_in,d=t.hold,u=t.bits,t.mode===Ub&&(t.back=-1);break}for(t.back=0;f=(R=t.lencode[d&(1<<t.lenbits)-1])>>>16&255,E=65535&R,!((h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(f&&!(240&f)){for(m=h,S=f,w=E;f=(R=t.lencode[w+((d&(1<<m+S)-1)>>m)])>>>16&255,E=65535&R,!(m+(h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}d>>>=m,u-=m,t.back+=m}if(d>>>=h,u-=h,t.back+=h,t.length=E,f===0){t.mode=26;break}if(32&f){t.back=-1,t.mode=Ub;break}if(64&f){r.msg="invalid literal/length code",t.mode=Vb;break}t.extra=15&f,t.mode=22;case 22:if(t.extra){for(T=t.extra;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.length+=d&(1<<t.extra)-1,d>>>=t.extra,u-=t.extra,t.back+=t.extra}t.was=t.length,t.mode=23;case 23:for(;f=(R=t.distcode[d&(1<<t.distbits)-1])>>>16&255,E=65535&R,!((h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(!(240&f)){for(m=h,S=f,w=E;f=(R=t.distcode[w+((d&(1<<m+S)-1)>>m)])>>>16&255,E=65535&R,!(m+(h=R>>>24)<=u);){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}d>>>=m,u-=m,t.back+=m}if(d>>>=h,u-=h,t.back+=h,64&f){r.msg="invalid distance code",t.mode=Vb;break}t.offset=E,t.extra=15&f,t.mode=24;case 24:if(t.extra){for(T=t.extra;u<T;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}t.offset+=d&(1<<t.extra)-1,d>>>=t.extra,u-=t.extra,t.back+=t.extra}if(t.offset>t.dmax){r.msg="invalid distance too far back",t.mode=Vb;break}t.mode=25;case 25:if(l===0)break e;if(y=x-l,t.offset>y){if((y=t.offset-y)>t.whave&&t.sane){r.msg="invalid distance too far back",t.mode=Vb;break}y>t.wnext?(y-=t.wnext,b=t.wsize-y):b=t.wnext-y,y>t.length&&(y=t.length),_=t.window}else _=i,b=o-t.offset,y=t.length;y>l&&(y=l),l-=y,t.length-=y;do i[o++]=_[b++];while(--y);t.length===0&&(t.mode=21);break;case 26:if(l===0)break e;i[o++]=t.length,l--,t.mode=21;break;case 27:if(t.wrap){for(;u<32;){if(a===0)break e;a--,d|=n[s++]<<u,u+=8}if(x-=l,r.total_out+=x,t.total+=x,x&&(r.adler=t.check=t.flags?vb(t.check,i,x,o-x):_b(t.check,i,x,o-x)),x=l,(t.flags?d:Hb(d))!==t.check){r.msg="incorrect data check",t.mode=Vb;break}d=0,u=0}t.mode=28;case 28:if(t.wrap&&t.flags){for(;u<32;){if(a===0)break e;a--,d+=n[s++]<<u,u+=8}if(d!==(4294967295&t.total)){r.msg="incorrect length check",t.mode=Vb;break}d=0,u=0}t.mode=29;case 29:A=1;break e;case Vb:A=-3;break e;case 31:return-4;default:return Nb}return r.next_out=o,r.avail_out=l,r.next_in=s,r.avail_in=a,t.hold=d,t.bits=u,(t.wsize||x!==r.avail_out&&t.mode<Vb&&(t.mode<27||e!==4))&&Jb(r,r.output,r.next_out,x-r.avail_out),g-=r.avail_in,x-=r.avail_out,r.total_in+=g,r.total_out+=x,t.total+=x,t.wrap&&x&&(r.adler=t.check=t.flags?vb(t.check,i,x,r.next_out-x):_b(t.check,i,x,r.next_out-x)),r.data_type=t.bits+(t.last?64:0)+(t.mode===Ub?128:0)+(t.mode===20||t.mode===15?256:0),(g===0&&x===0||e===4)&&A===Lb&&(A=-5),A}function e_(r,e){var t,n=e.length;return r&&r.state?(t=r.state).wrap!==0&&t.mode!==11?Nb:t.mode===11&&_b(1,e,n,0)!==t.check?-3:Jb(r,e,n,n)?(t.mode=31,-4):(t.havedict=1,Lb):Nb}var i_=!0,r_=!0;try{String.fromCharCode.apply(null,[0])}catch{i_=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r_=!1}for(var n_=new Uint8Array(256),s_=0;s_<256;s_++)n_[s_]=s_>=252?6:s_>=248?5:s_>=240?4:s_>=224?3:s_>=192?2:1;function o_(r){var e,t,n,i,s,o=r.length,a=0;for(i=0;i<o;i++)(64512&(t=r.charCodeAt(i)))==55296&&i+1<o&&(64512&(n=r.charCodeAt(i+1)))==56320&&(t=65536+(t-55296<<10)+(n-56320),i++),a+=t<128?1:t<2048?2:t<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)(64512&(t=r.charCodeAt(i)))==55296&&i+1<o&&(64512&(n=r.charCodeAt(i+1)))==56320&&(t=65536+(t-55296<<10)+(n-56320),i++),t<128?e[s++]=t:t<2048?(e[s++]=192|t>>>6,e[s++]=128|63&t):t<65536?(e[s++]=224|t>>>12,e[s++]=128|t>>>6&63,e[s++]=128|63&t):(e[s++]=240|t>>>18,e[s++]=128|t>>>12&63,e[s++]=128|t>>>6&63,e[s++]=128|63&t);return e}function a_(r,e){var t,n,i,s,o=e||r.length,a=new Array(2*o);for(n=0,t=0;t<o;)if((i=r[t++])<128)a[n++]=i;else if((s=n_[i])>4)a[n++]=65533,t+=s-1;else{for(i&=s===2?31:s===3?15:7;s>1&&t<o;)i=i<<6|63&r[t++],s--;s>1?a[n++]=65533:i<65536?a[n++]=i:(i-=65536,a[n++]=55296|i>>10&1023,a[n++]=56320|1023&i)}return(function(l,d){if(d<65537&&(l.subarray&&r_||!l.subarray&&i_))return String.fromCharCode.apply(null,yb(l,d));for(var u="",g=0;g<d;g++)u+=String.fromCharCode(l[g]);return u})(a,n)}function c_(r,e){var t;for((e=e||r.length)>r.length&&(e=r.length),t=e-1;t>=0&&(192&r[t])==128;)t--;return t<0||t===0?e:t+n_[r[t]]>e?t:e}n_[254]=n_[254]=1;var l_=0,h_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function u_(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function d_(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var m_=Object.prototype.toString;function f_(r){if(!(this instanceof f_))return new f_(r);this.options=(function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var d in l)l.hasOwnProperty(d)&&(o[d]=l[d])}}return o})({chunkSize:16384,windowBits:0,to:""},r||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||r&&r.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u_,this.strm.avail_out=0;var t,n,i,s=Xb(this.strm,e.windowBits);if(s!==l_)throw new Error(h_[s]);this.header=new d_,t=this.strm,n=this.header,t&&t.state&&2&(i=t.state).wrap&&(i.head=n,n.done=!1)}f_.prototype.push=function(r,e){var t,n,i,s,o,a,l=this.strm,d=this.options.chunkSize,u=this.options.dictionary,g=!1;if(this.ended)return!1;n=e===~~e?e:e===!0?4:0,typeof r=="string"?l.input=(function(x){for(var y=new Uint8Array(x.length),b=0,_=y.length;b<_;b++)y[b]=x.charCodeAt(b);return y})(r):m_.call(r)==="[object ArrayBuffer]"?l.input=new Uint8Array(r):l.input=r,l.next_in=0,l.avail_in=l.input.length;do{if(l.avail_out===0&&(l.output=new Uint8Array(d),l.next_out=0,l.avail_out=d),(t=t_(l,0))===2&&u&&(a=typeof u=="string"?o_(u):m_.call(u)==="[object ArrayBuffer]"?new Uint8Array(u):u,t=e_(this.strm,a)),t===-5&&g===!0&&(t=l_,g=!1),t!==1&&t!==l_)return this.onEnd(t),this.ended=!0,!1;l.next_out&&(l.avail_out!==0&&t!==1&&(l.avail_in!==0||n!==4&&n!==2)||(this.options.to==="string"?(i=c_(l.output,l.next_out),s=l.next_out-i,o=a_(l.output,i),l.next_out=s,l.avail_out=d-s,s&&bb(l.output,l.output,i,s,0),this.onData(o)):this.onData(yb(l.output,l.next_out)))),l.avail_in===0&&l.avail_out===0&&(g=!0)}while((l.avail_in>0||l.avail_out===0)&&t!==1);return t===1&&(n=4),n===4?(t=(function(x){if(!x||!x.state)return Nb;var y=x.state;return y.window&&(y.window=null),x.state=null,Lb})(this.strm),this.onEnd(t),this.ended=!0,t===l_):n!==2||(this.onEnd(l_),l.avail_out=0,!0)},f_.prototype.onData=function(r){this.chunks.push(r)},f_.prototype.onEnd=function(r){r===l_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=(function(e){var t,n,i,s,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),s=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,s),s+=o.length;return a})(this.chunks)),this.chunks=[],this.err=r,this.msg=this.strm.msg},Ue.add("gz",(function(r){let e;r instanceof ArrayBuffer&&(r=new Uint8Array(r));try{e=(function(t,n){var i=new f_(n);if(i.push(t,!0),i.err)throw i.msg;return i.result})(r)}catch{e=r}return e}));class p_{}const g_="https:";Re.add("rcsb",new class extends p_{getUrl(r){const e=ii(r),t=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);return!["pdb","cif"].includes(e.ext)||e.compressed!==!1&&e.compressed!=="gz"?(e.ext==="mmtf"&&(ke.warn(`MMTF files distribution has been discontinued by RCSB PDB as of July 2024.
 Defaulting to bcif format instead. See https://www.rcsb.org/news/65a1af31c76ca3abcc925d0c for the deprecation notice`),e.base.endsWith(".bb")&&ke.warn("Backbone only files are not available from RCSB PDB anymore."),e.ext=""),e.ext?ke.warn("unsupported ext",e.ext):ke.warn(`mmCif files available from RCSB PDB lack connectivity information.
 Consider using PDBe as the data provider for using "Updated mmCif files" that contain residues connectivity records.`),g_+"//models.rcsb.org/"+t+".bcif.gz"):g_+"//files.rcsb.org/download/"+e.path}getExt(r){return ii(r).ext||"bcif"}});const y_="//www.ebi.ac.uk/pdbe/entry-files/download/";Re.add("pdbe",new class extends p_{getUrl(r){const e=ii(r);let t,n=e.name.indexOf("_")>-1?e.name:e.name.substring(0,4);switch(e.ext){case"cif":t=y_+n+"_updated.cif";break;case"pdb":case"ent":n.startsWith("pdb")||(n="pdb"+n),t=y_+n+".ent";break;case"bcif":t=y_+e.path;break;case"":t=y_+n+".bcif";break;default:ke.warn("unsupported ext",e.ext),t=y_+n+".bcif"}return"https://"+t}getExt(r){return ii(r).ext||"bcif"}});const b_="//pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/",__="/SDF?record_type=3d";Re.add("pubchem",new class extends p_{getUrl(r){const e=ii(r),t=e.name;let n;return e.ext&&e.ext!=="sdf"&&ke.warn("unsupported ext",e.ext),n=b_+t+__,(function(){const i=window.location.protocol;return i.match(/http(s)?:/gi)===null?"http:":i})()+n}getExt(r){return ii(r).ext||"sdf"}});class x_ extends p_{getUrl(e){return e}getExt(e){return ii(e).ext}}Re.add("ftp",new x_),Re.add("http",new x_),Re.add("https",new x_);const v_="//alphafold.ebi.ac.uk/files/AF-",w_="-F1-model_v4.pdb";Re.add("alphafold",new class extends p_{getUrl(r){const e=ii(r),t=e.name;let n;return e.ext&&e.ext!=="pdb"&&ke.warn("unsupported AF ext",e.ext),n=v_+t+w_,"https://"+n}getExt(r){return ii(r).ext||"pdb"}});function M_(...r){return{type:"select",options:r.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:t})),{})}}M_("auto","low","medium","high"),M_("scene","camera"),M_("relative","absolute"),M_("perspective","orthographic","stereo"),M_(...Object.keys(Ko));const toKebabCase=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),toCamelCase=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),toPascalCase=r=>{const e=toCamelCase(r);return e.charAt(0).toUpperCase()+e.slice(1)},mergeClasses=(...r)=>r.filter((e,t,n)=>!!e&&e.trim()!==""&&n.indexOf(e)===t).join(" ").trim(),hasA11yProp=r=>{for(const e in r)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const Icon=reactExports.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:n,className:i="",children:s,iconNode:o,...a},l)=>reactExports.createElement("svg",{ref:l,...defaultAttributes,width:e,height:e,stroke:r,strokeWidth:n?Number(t)*24/Number(e):t,className:mergeClasses("lucide",i),...!s&&!hasA11yProp(a)&&{"aria-hidden":"true"},...a},[...o.map(([d,u])=>reactExports.createElement(d,u)),...Array.isArray(s)?s:[s]]));const createLucideIcon=(r,e)=>{const t=reactExports.forwardRef(({className:n,...i},s)=>reactExports.createElement(Icon,{ref:s,iconNode:e,className:mergeClasses(`lucide-${toKebabCase(toPascalCase(r))}`,`lucide-${r}`,n),...i}));return t.displayName=toPascalCase(r),t};const __iconNode$h=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ArrowLeft=createLucideIcon("arrow-left",__iconNode$h);const __iconNode$g=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Camera=createLucideIcon("camera",__iconNode$g);const __iconNode$f=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],ChevronDown=createLucideIcon("chevron-down",__iconNode$f);const __iconNode$e=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ChevronUp=createLucideIcon("chevron-up",__iconNode$e);const __iconNode$d=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],CircleQuestionMark=createLucideIcon("circle-question-mark",__iconNode$d);const __iconNode$c=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Download=createLucideIcon("download",__iconNode$c);const __iconNode$b=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]],FileBraces=createLucideIcon("file-braces",__iconNode$b);const __iconNode$a=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Funnel=createLucideIcon("funnel",__iconNode$a);const __iconNode$9=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],LoaderCircle=createLucideIcon("loader-circle",__iconNode$9);const __iconNode$8=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Menu=createLucideIcon("menu",__iconNode$8);const __iconNode$7=[["path",{d:"M12 2v20",key:"t6zp3m"}],["path",{d:"m15 19-3 3-3-3",key:"11eu04"}],["path",{d:"m19 9 3 3-3 3",key:"1mg7y2"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"m5 9-3 3 3 3",key:"j64kie"}],["path",{d:"m9 5 3-3 3 3",key:"l8vdw6"}]],Move=createLucideIcon("move",__iconNode$7);const __iconNode$6=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],RefreshCw=createLucideIcon("refresh-cw",__iconNode$6);const __iconNode$5=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Search=createLucideIcon("search",__iconNode$5);const __iconNode$4=[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]],Table=createLucideIcon("table",__iconNode$4);const __iconNode$3=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Upload=createLucideIcon("upload",__iconNode$3);const __iconNode$2=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],X=createLucideIcon("x",__iconNode$2);const __iconNode$1=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],ZoomIn=createLucideIcon("zoom-in",__iconNode$1);const __iconNode=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],ZoomOut=createLucideIcon("zoom-out",__iconNode);var _3Dmol$1={exports:{}};var _3Dmol=_3Dmol$1.exports,hasRequired_3Dmol;function require_3Dmol(){return hasRequired_3Dmol||(hasRequired_3Dmol=1,(function(module,exports$1){(function(e,t){module.exports=t()})(_3Dmol,()=>(()=>{var __webpack_modules__={"./node_modules/iobuffer/lib-esm/IOBuffer.js":((r,e,t)=>{t.r(e),t.d(e,{IOBuffer:()=>a});var n=t("./node_modules/iobuffer/lib-esm/text.js");const i=1024*8,s=(()=>{const l=new Uint8Array(4),d=new Uint32Array(l.buffer);return!((d[0]=1)&l[0])})(),o={int8:globalThis.Int8Array,uint8:globalThis.Uint8Array,int16:globalThis.Int16Array,uint16:globalThis.Uint16Array,int32:globalThis.Int32Array,uint32:globalThis.Uint32Array,uint64:globalThis.BigUint64Array,int64:globalThis.BigInt64Array,float32:globalThis.Float32Array,float64:globalThis.Float64Array};class a{buffer;byteLength;byteOffset;length;offset;lastWrittenByte;littleEndian;_data;_mark;_marks;constructor(d=i,u={}){let g=!1;typeof d=="number"?d=new ArrayBuffer(d):(g=!0,this.lastWrittenByte=d.byteLength);const x=u.offset?u.offset>>>0:0,y=d.byteLength-x;let b=x;(ArrayBuffer.isView(d)||d instanceof a)&&(d.byteLength!==d.buffer.byteLength&&(b=d.byteOffset+x),d=d.buffer),g?this.lastWrittenByte=y:this.lastWrittenByte=0,this.buffer=d,this.length=y,this.byteLength=y,this.byteOffset=b,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,b,y),this._mark=0,this._marks=[]}available(d=1){return this.offset+d<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(d=1){return this.offset+=d,this}back(d=1){return this.offset-=d,this}seek(d){return this.offset=d,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const d=this._marks.pop();if(d===void 0)throw new Error("Mark stack empty");return this.seek(d),this}rewind(){return this.offset=0,this}ensureAvailable(d=1){if(!this.available(d)){const g=(this.offset+d)*2,x=new Uint8Array(g);x.set(new Uint8Array(this.buffer)),this.buffer=x.buffer,this.length=g,this.byteLength=g,this._data=new DataView(this.buffer)}return this}readBoolean(){return this.readUint8()!==0}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(d=1){return this.readArray(d,"uint8")}readArray(d,u){const g=o[u].BYTES_PER_ELEMENT*d,x=this.byteOffset+this.offset,y=this.buffer.slice(x,x+g);if(this.littleEndian===s&&u!=="uint8"&&u!=="int8"){const _=new Uint8Array(this.buffer.slice(x,x+g));_.reverse();const h=new o[u](_.buffer);return this.offset+=g,h.reverse(),h}const b=new o[u](y);return this.offset+=g,b}readInt16(){const d=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,d}readUint16(){const d=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,d}readInt32(){const d=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,d}readUint32(){const d=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,d}readFloat32(){const d=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,d}readFloat64(){const d=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,d}readBigInt64(){const d=this._data.getBigInt64(this.offset,this.littleEndian);return this.offset+=8,d}readBigUint64(){const d=this._data.getBigUint64(this.offset,this.littleEndian);return this.offset+=8,d}readChar(){return String.fromCharCode(this.readInt8())}readChars(d=1){let u="";for(let g=0;g<d;g++)u+=this.readChar();return u}readUtf8(d=1){return(0,n.decode)(this.readBytes(d))}decodeText(d=1,u="utf8"){return(0,n.decode)(this.readBytes(d),u)}writeBoolean(d){return this.writeUint8(d?255:0),this}writeInt8(d){return this.ensureAvailable(1),this._data.setInt8(this.offset++,d),this._updateLastWrittenByte(),this}writeUint8(d){return this.ensureAvailable(1),this._data.setUint8(this.offset++,d),this._updateLastWrittenByte(),this}writeByte(d){return this.writeUint8(d)}writeBytes(d){this.ensureAvailable(d.length);for(let u=0;u<d.length;u++)this._data.setUint8(this.offset++,d[u]);return this._updateLastWrittenByte(),this}writeInt16(d){return this.ensureAvailable(2),this._data.setInt16(this.offset,d,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(d){return this.ensureAvailable(2),this._data.setUint16(this.offset,d,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(d){return this.ensureAvailable(4),this._data.setInt32(this.offset,d,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(d){return this.ensureAvailable(4),this._data.setUint32(this.offset,d,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(d){return this.ensureAvailable(4),this._data.setFloat32(this.offset,d,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(d){return this.ensureAvailable(8),this._data.setFloat64(this.offset,d,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigInt64(d){return this.ensureAvailable(8),this._data.setBigInt64(this.offset,d,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeBigUint64(d){return this.ensureAvailable(8),this._data.setBigUint64(this.offset,d,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(d){return this.writeUint8(d.charCodeAt(0))}writeChars(d){for(let u=0;u<d.length;u++)this.writeUint8(d.charCodeAt(u));return this}writeUtf8(d){return this.writeBytes((0,n.encode)(d))}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)}getWrittenByteLength(){return this.lastWrittenByte-this.byteOffset}_updateLastWrittenByte(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)}}}),"./node_modules/iobuffer/lib-esm/text.js":((r,e,t)=>{t.r(e),t.d(e,{decode:()=>n,encode:()=>s});function n(o,a="utf8"){return new TextDecoder(a).decode(o)}const i=new TextEncoder;function s(o){return i.encode(o)}}),"./node_modules/netcdfjs/lib-esm/data.js":((r,e,t)=>{t.r(e),t.d(e,{nonRecord:()=>i,record:()=>s});var n=t("./node_modules/netcdfjs/lib-esm/types.js");function i(o,a){const l=(0,n.str2num)(a.type),d=a.size/(0,n.num2bytes)(l),u=new Array(d);for(let g=0;g<d;g++)u[g]=(0,n.readType)(o,l,1);return u}function s(o,a,l){const d=(0,n.str2num)(a.type),u=a.size?a.size/(0,n.num2bytes)(d):1,g=l.length,x=new Array(g),y=l.recordStep;if(y)for(let b=0;b<g;b++){const _=o.offset;x[b]=(0,n.readType)(o,d,u),o.seek(_+y)}else throw new Error("recordDimension.recordStep is undefined");return x}}),"./node_modules/netcdfjs/lib-esm/header.js":((r,e,t)=>{t.r(e),t.d(e,{header:()=>u});var n=t("./node_modules/netcdfjs/lib-esm/types.js"),i=t("./node_modules/netcdfjs/lib-esm/utils.js");const s=0,o=10,a=11,l=12,d=0;function u(b,_){const h={version:_},f={length:b.readUint32()},E=g(b);Array.isArray(E)||(f.id=E.recordId,f.name=E.recordName,h.dimensions=E.dimensions),h.globalAttributes=x(b);const m=y(b,f?.id,_);return Array.isArray(m)||(h.variables=m.variables,f.recordStep=m.recordStep),h.recordDimension=f,h}function g(b){const _={};let h,f;const E=b.readUint32();let m;if(E===s)return(0,i.notNetcdf)(b.readUint32()!==s,"wrong empty tag for list of dimensions"),[];{(0,i.notNetcdf)(E!==o,"wrong tag for list of dimensions");const S=b.readUint32();m=new Array(S);for(let w=0;w<S;w++){const v=(0,i.readName)(b),A=b.readUint32();A===d&&(h=w,f=v),m[w]={name:v,size:A}}}return h!==void 0&&(_.recordId=h),f!==void 0&&(_.recordName=f),_.dimensions=m,_}function x(b){const _=b.readUint32();let h;if(_===s)return(0,i.notNetcdf)(b.readUint32()!==s,"wrong empty tag for list of attributes"),[];{(0,i.notNetcdf)(_!==l,"wrong tag for list of attributes");const f=b.readUint32();h=new Array(f);for(let E=0;E<f;E++){const m=(0,i.readName)(b),S=b.readUint32();(0,i.notNetcdf)(S<1||S>6,`non valid type ${S}`);const w=b.readUint32(),v=(0,n.readType)(b,S,w);(0,i.padding)(b),h[E]={name:m,type:(0,n.num2str)(S),value:v}}}return h}function y(b,_,h){const f=b.readUint32();let E=0,m;if(f===s)return(0,i.notNetcdf)(b.readUint32()!==s,"wrong empty tag for list of variables"),[];{(0,i.notNetcdf)(f!==a,"wrong tag for list of variables");const S=b.readUint32();m=new Array(S);for(let w=0;w<S;w++){const v=(0,i.readName)(b),A=b.readUint32(),M=new Array(A);for(let I=0;I<A;I++)M[I]=b.readUint32();const T=x(b),R=b.readUint32();(0,i.notNetcdf)(R<1&&R>6,`non valid type ${R}`);const P=b.readUint32();let L=b.readUint32();h===2&&((0,i.notNetcdf)(L>0,"offsets larger than 4GB not supported"),L=b.readUint32());let O=!1;typeof _<"u"&&M[0]===_&&(E+=P,O=!0),m[w]={name:v,dimensions:M,attributes:T,type:(0,n.num2str)(R),size:P,offset:L,record:O}}}return{variables:m,recordStep:E}}}),"./node_modules/netcdfjs/lib-esm/index.js":((r,e,t)=>{t.r(e),t.d(e,{NetCDFReader:()=>n.NetCDFReader});var n=t("./node_modules/netcdfjs/lib-esm/parser.js")}),"./node_modules/netcdfjs/lib-esm/parser.js":((r,e,t)=>{t.r(e),t.d(e,{NetCDFReader:()=>l});var n=t("./node_modules/iobuffer/lib-esm/IOBuffer.js"),i=t("./node_modules/netcdfjs/lib-esm/data.js"),s=t("./node_modules/netcdfjs/lib-esm/header.js"),o=t("./node_modules/netcdfjs/lib-esm/toString.js"),a=t("./node_modules/netcdfjs/lib-esm/utils.js");class l{constructor(u){this.toString=o.toString;const g=new n.IOBuffer(u);g.setBigEndian(),(0,a.notNetcdf)(g.readChars(3)!=="CDF","should start with CDF");const x=g.readByte();(0,a.notNetcdf)(x>2,"unknown version"),this.header=(0,s.header)(g,x),this.buffer=g}get version(){return this.header.version===1?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}getAttribute(u){const g=this.globalAttributes.find(x=>x.name===u);return g?g.value:null}getDataVariableAsString(u){const g=this.getDataVariable(u);return g?g.join(""):null}get variables(){return this.header.variables}getDataVariable(u){let g;if(typeof u=="string"?g=this.header.variables.find(x=>x.name===u):g=u,g===void 0)throw new Error("Not a valid NetCDF v3.x file: variable not found");return this.buffer.seek(g.offset),g.record?(0,i.record)(this.buffer,g,this.header.recordDimension):(0,i.nonRecord)(this.buffer,g)}dataVariableExists(u){return this.header.variables.find(x=>x.name===u)!==void 0}attributeExists(u){return this.globalAttributes.find(x=>x.name===u)!==void 0}}}),"./node_modules/netcdfjs/lib-esm/toString.js":((r,e,t)=>{t.r(e),t.d(e,{toString:()=>n});function n(){const i=[];i.push("DIMENSIONS");for(const o of this.dimensions)i.push(`  ${o.name.padEnd(30)} = size: ${o.size}`);i.push(""),i.push("GLOBAL ATTRIBUTES");for(const o of this.globalAttributes)i.push(`  ${o.name.padEnd(30)} = ${o.value}`);const s=JSON.parse(JSON.stringify(this.variables));i.push(""),i.push("VARIABLES:");for(const o of s){o.value=this.getDataVariable(o);let a=JSON.stringify(o.value);a.length>50&&(a=a.substring(0,50)),isNaN(o.value.length)||(a+=` (length: ${o.value.length})`),i.push(`  ${o.name.padEnd(30)} = ${a}`)}return i.join(`
`)}}),"./node_modules/netcdfjs/lib-esm/types.js":((r,e,t)=>{t.r(e),t.d(e,{num2bytes:()=>s,num2str:()=>i,readType:()=>l,str2num:()=>o});const n={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function i(u){switch(Number(u)){case n.BYTE:return"byte";case n.CHAR:return"char";case n.SHORT:return"short";case n.INT:return"int";case n.FLOAT:return"float";case n.DOUBLE:return"double";default:return"undefined"}}function s(u){switch(Number(u)){case n.BYTE:return 1;case n.CHAR:return 1;case n.SHORT:return 2;case n.INT:return 4;case n.FLOAT:return 4;case n.DOUBLE:return 8;default:return-1}}function o(u){switch(String(u)){case"byte":return n.BYTE;case"char":return n.CHAR;case"short":return n.SHORT;case"int":return n.INT;case"float":return n.FLOAT;case"double":return n.DOUBLE;default:return-1}}function a(u,g){if(u!==1){const x=new Array(u);for(let y=0;y<u;y++)x[y]=g();return x}else return g()}function l(u,g,x){switch(g){case n.BYTE:return Array.from(u.readBytes(x));case n.CHAR:return d(u.readChars(x));case n.SHORT:return a(x,u.readInt16.bind(u));case n.INT:return a(x,u.readInt32.bind(u));case n.FLOAT:return a(x,u.readFloat32.bind(u));case n.DOUBLE:return a(x,u.readFloat64.bind(u));default:throw new Error(`non valid type ${g}`)}}function d(u){return u.charCodeAt(u.length-1)===0?u.substring(0,u.length-1):u}}),"./node_modules/netcdfjs/lib-esm/utils.js":((r,e,t)=>{t.r(e),t.d(e,{notNetcdf:()=>n,padding:()=>i,readName:()=>s});function n(o,a){if(o)throw new TypeError(`Not a valid NetCDF v3.x file: ${a}`)}function i(o){o.offset%4!==0&&o.skip(4-o.offset%4)}function s(o){const a=o.readUint32(),l=o.readChars(a);return i(o),l}}),"./node_modules/pako/dist/pako.esm.mjs":((r,e,t)=>{t.r(e),t.d(e,{Deflate:()=>Kx,Inflate:()=>Cx,constants:()=>eA,default:()=>Tx,deflate:()=>qx,deflateRaw:()=>cS,gzip:()=>wx,inflate:()=>KA,inflateRaw:()=>JS,ungzip:()=>qA});const n=4,i=0,s=1,o=2;function a(z){let ai=z.length;for(;--ai>=0;)z[ai]=0}const l=0,d=1,u=2,g=3,x=258,y=29,b=256,_=b+1+y,h=30,f=19,E=2*_+1,m=15,S=16,w=7,v=256,A=16,M=17,T=18,R=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),P=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),L=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),O=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),I=512,N=new Array((_+2)*2);a(N);const k=new Array(h*2);a(k);const U=new Array(I);a(U);const F=new Array(x-g+1);a(F);const j=new Array(y);a(j);const H=new Array(h);a(H);function B(z,ai,Y,s0,y0){this.static_tree=z,this.extra_bits=ai,this.extra_base=Y,this.elems=s0,this.max_length=y0,this.has_stree=z&&z.length}let V,K,q;function Te(z,ai){this.dyn_tree=z,this.max_code=0,this.stat_desc=ai}const Fe=z=>z<256?U[z]:U[256+(z>>>7)],We=(z,ai)=>{z.pending_buf[z.pending++]=ai&255,z.pending_buf[z.pending++]=ai>>>8&255},J=(z,ai,Y)=>{z.bi_valid>S-Y?(z.bi_buf|=ai<<z.bi_valid&65535,We(z,z.bi_buf),z.bi_buf=ai>>S-z.bi_valid,z.bi_valid+=Y-S):(z.bi_buf|=ai<<z.bi_valid&65535,z.bi_valid+=Y)},et=(z,ai,Y)=>{J(z,Y[ai*2],Y[ai*2+1])},ht=(z,ai)=>{let Y=0;do Y|=z&1,z>>>=1,Y<<=1;while(--ai>0);return Y>>>1},er=z=>{z.bi_valid===16?(We(z,z.bi_buf),z.bi_buf=0,z.bi_valid=0):z.bi_valid>=8&&(z.pending_buf[z.pending++]=z.bi_buf&255,z.bi_buf>>=8,z.bi_valid-=8)},tr=(z,ai)=>{const Y=ai.dyn_tree,s0=ai.max_code,y0=ai.stat_desc.static_tree,g0=ai.stat_desc.has_stree,Y0=ai.stat_desc.extra_bits,k0=ai.stat_desc.extra_base,g1=ai.stat_desc.max_length;let B0,W0,$1,f1,a1,A1,E_=0;for(f1=0;f1<=m;f1++)z.bl_count[f1]=0;for(Y[z.heap[z.heap_max]*2+1]=0,B0=z.heap_max+1;B0<E;B0++)W0=z.heap[B0],f1=Y[Y[W0*2+1]*2+1]+1,f1>g1&&(f1=g1,E_++),Y[W0*2+1]=f1,!(W0>s0)&&(z.bl_count[f1]++,a1=0,W0>=k0&&(a1=Y0[W0-k0]),A1=Y[W0*2],z.opt_len+=A1*(f1+a1),g0&&(z.static_len+=A1*(y0[W0*2+1]+a1)));if(E_!==0){do{for(f1=g1-1;z.bl_count[f1]===0;)f1--;z.bl_count[f1]--,z.bl_count[f1+1]+=2,z.bl_count[g1]--,E_-=2}while(E_>0);for(f1=g1;f1!==0;f1--)for(W0=z.bl_count[f1];W0!==0;)$1=z.heap[--B0],!($1>s0)&&(Y[$1*2+1]!==f1&&(z.opt_len+=(f1-Y[$1*2+1])*Y[$1*2],Y[$1*2+1]=f1),W0--)}},Hm=(z,ai,Y)=>{const s0=new Array(m+1);let y0=0,g0,Y0;for(g0=1;g0<=m;g0++)y0=y0+Y[g0-1]<<1,s0[g0]=y0;for(Y0=0;Y0<=ai;Y0++){let k0=z[Y0*2+1];k0!==0&&(z[Y0*2]=ht(s0[k0]++,k0))}},oi=()=>{let z,ai,Y,s0,y0;const g0=new Array(m+1);for(Y=0,s0=0;s0<y-1;s0++)for(j[s0]=Y,z=0;z<1<<R[s0];z++)F[Y++]=s0;for(F[Y-1]=s0,y0=0,s0=0;s0<16;s0++)for(H[s0]=y0,z=0;z<1<<P[s0];z++)U[y0++]=s0;for(y0>>=7;s0<h;s0++)for(H[s0]=y0<<7,z=0;z<1<<P[s0]-7;z++)U[256+y0++]=s0;for(ai=0;ai<=m;ai++)g0[ai]=0;for(z=0;z<=143;)N[z*2+1]=8,z++,g0[8]++;for(;z<=255;)N[z*2+1]=9,z++,g0[9]++;for(;z<=279;)N[z*2+1]=7,z++,g0[7]++;for(;z<=287;)N[z*2+1]=8,z++,g0[8]++;for(Hm(N,_+1,g0),z=0;z<h;z++)k[z*2+1]=5,k[z*2]=ht(z,5);V=new B(N,R,b+1,_,m),K=new B(k,P,0,h,m),q=new B(new Array(0),L,0,f,w)},h0=z=>{let ai;for(ai=0;ai<_;ai++)z.dyn_ltree[ai*2]=0;for(ai=0;ai<h;ai++)z.dyn_dtree[ai*2]=0;for(ai=0;ai<f;ai++)z.bl_tree[ai*2]=0;z.dyn_ltree[v*2]=1,z.opt_len=z.static_len=0,z.sym_next=z.matches=0},l0=z=>{z.bi_valid>8?We(z,z.bi_buf):z.bi_valid>0&&(z.pending_buf[z.pending++]=z.bi_buf),z.bi_buf=0,z.bi_valid=0},M0=(z,ai,Y,s0)=>{const y0=ai*2,g0=Y*2;return z[y0]<z[g0]||z[y0]===z[g0]&&s0[ai]<=s0[Y]},U0=(z,ai,Y)=>{const s0=z.heap[Y];let y0=Y<<1;for(;y0<=z.heap_len&&(y0<z.heap_len&&M0(ai,z.heap[y0+1],z.heap[y0],z.depth)&&y0++,!M0(ai,s0,z.heap[y0],z.depth));)z.heap[Y]=z.heap[y0],Y=y0,y0<<=1;z.heap[Y]=s0},_0=(z,ai,Y)=>{let s0,y0,g0=0,Y0,k0;if(z.sym_next!==0)do s0=z.pending_buf[z.sym_buf+g0++]&255,s0+=(z.pending_buf[z.sym_buf+g0++]&255)<<8,y0=z.pending_buf[z.sym_buf+g0++],s0===0?et(z,y0,ai):(Y0=F[y0],et(z,Y0+b+1,ai),k0=R[Y0],k0!==0&&(y0-=j[Y0],J(z,y0,k0)),s0--,Y0=Fe(s0),et(z,Y0,Y),k0=P[Y0],k0!==0&&(s0-=H[Y0],J(z,s0,k0)));while(g0<z.sym_next);et(z,v,ai)},C0=(z,ai)=>{const Y=ai.dyn_tree,s0=ai.stat_desc.static_tree,y0=ai.stat_desc.has_stree,g0=ai.stat_desc.elems;let Y0,k0,g1=-1,B0;for(z.heap_len=0,z.heap_max=E,Y0=0;Y0<g0;Y0++)Y[Y0*2]!==0?(z.heap[++z.heap_len]=g1=Y0,z.depth[Y0]=0):Y[Y0*2+1]=0;for(;z.heap_len<2;)B0=z.heap[++z.heap_len]=g1<2?++g1:0,Y[B0*2]=1,z.depth[B0]=0,z.opt_len--,y0&&(z.static_len-=s0[B0*2+1]);for(ai.max_code=g1,Y0=z.heap_len>>1;Y0>=1;Y0--)U0(z,Y,Y0);B0=g0;do Y0=z.heap[1],z.heap[1]=z.heap[z.heap_len--],U0(z,Y,1),k0=z.heap[1],z.heap[--z.heap_max]=Y0,z.heap[--z.heap_max]=k0,Y[B0*2]=Y[Y0*2]+Y[k0*2],z.depth[B0]=(z.depth[Y0]>=z.depth[k0]?z.depth[Y0]:z.depth[k0])+1,Y[Y0*2+1]=Y[k0*2+1]=B0,z.heap[1]=B0++,U0(z,Y,1);while(z.heap_len>=2);z.heap[--z.heap_max]=z.heap[1],tr(z,ai),Hm(Y,g1,z.bl_count)},P0=(z,ai,Y)=>{let s0,y0=-1,g0,Y0=ai[1],k0=0,g1=7,B0=4;for(Y0===0&&(g1=138,B0=3),ai[(Y+1)*2+1]=65535,s0=0;s0<=Y;s0++)g0=Y0,Y0=ai[(s0+1)*2+1],!(++k0<g1&&g0===Y0)&&(k0<B0?z.bl_tree[g0*2]+=k0:g0!==0?(g0!==y0&&z.bl_tree[g0*2]++,z.bl_tree[A*2]++):k0<=10?z.bl_tree[M*2]++:z.bl_tree[T*2]++,k0=0,y0=g0,Y0===0?(g1=138,B0=3):g0===Y0?(g1=6,B0=3):(g1=7,B0=4))},R0=(z,ai,Y)=>{let s0,y0=-1,g0,Y0=ai[1],k0=0,g1=7,B0=4;for(Y0===0&&(g1=138,B0=3),s0=0;s0<=Y;s0++)if(g0=Y0,Y0=ai[(s0+1)*2+1],!(++k0<g1&&g0===Y0)){if(k0<B0)do et(z,g0,z.bl_tree);while(--k0!==0);else g0!==0?(g0!==y0&&(et(z,g0,z.bl_tree),k0--),et(z,A,z.bl_tree),J(z,k0-3,2)):k0<=10?(et(z,M,z.bl_tree),J(z,k0-3,3)):(et(z,T,z.bl_tree),J(z,k0-11,7));k0=0,y0=g0,Y0===0?(g1=138,B0=3):g0===Y0?(g1=6,B0=3):(g1=7,B0=4)}},si=z=>{let ai;for(P0(z,z.dyn_ltree,z.l_desc.max_code),P0(z,z.dyn_dtree,z.d_desc.max_code),C0(z,z.bl_desc),ai=f-1;ai>=3&&z.bl_tree[O[ai]*2+1]===0;ai--);return z.opt_len+=3*(ai+1)+5+5+4,ai},Xe=(z,ai,Y,s0)=>{let y0;for(J(z,ai-257,5),J(z,Y-1,5),J(z,s0-4,4),y0=0;y0<s0;y0++)J(z,z.bl_tree[O[y0]*2+1],3);R0(z,z.dyn_ltree,ai-1),R0(z,z.dyn_dtree,Y-1)},d0=z=>{let ai=4093624447,Y;for(Y=0;Y<=31;Y++,ai>>>=1)if(ai&1&&z.dyn_ltree[Y*2]!==0)return i;if(z.dyn_ltree[18]!==0||z.dyn_ltree[20]!==0||z.dyn_ltree[26]!==0)return s;for(Y=32;Y<b;Y++)if(z.dyn_ltree[Y*2]!==0)return s;return i};let w0=!1;const Q=z=>{w0||(oi(),w0=!0),z.l_desc=new Te(z.dyn_ltree,V),z.d_desc=new Te(z.dyn_dtree,K),z.bl_desc=new Te(z.bl_tree,q),z.bi_buf=0,z.bi_valid=0,h0(z)},it=(z,ai,Y,s0)=>{J(z,(l<<1)+(s0?1:0),3),l0(z),We(z,Y),We(z,~Y),Y&&z.pending_buf.set(z.window.subarray(ai,ai+Y),z.pending),z.pending+=Y},ec=z=>{J(z,d<<1,3),et(z,v,N),er(z)},a0=(z,ai,Y,s0)=>{let y0,g0,Y0=0;z.level>0?(z.strm.data_type===o&&(z.strm.data_type=d0(z)),C0(z,z.l_desc),C0(z,z.d_desc),Y0=si(z),y0=z.opt_len+3+7>>>3,g0=z.static_len+3+7>>>3,g0<=y0&&(y0=g0)):y0=g0=Y+5,Y+4<=y0&&ai!==-1?it(z,ai,Y,s0):z.strategy===n||g0===y0?(J(z,(d<<1)+(s0?1:0),3),_0(z,N,k)):(J(z,(u<<1)+(s0?1:0),3),Xe(z,z.l_desc.max_code+1,z.d_desc.max_code+1,Y0+1),_0(z,z.dyn_ltree,z.dyn_dtree)),h0(z),s0&&l0(z)},u0=(z,ai,Y)=>(z.pending_buf[z.sym_buf+z.sym_next++]=ai,z.pending_buf[z.sym_buf+z.sym_next++]=ai>>8,z.pending_buf[z.sym_buf+z.sym_next++]=Y,ai===0?z.dyn_ltree[Y*2]++:(z.matches++,ai--,z.dyn_ltree[(F[Y]+b+1)*2]++,z.dyn_dtree[Fe(ai)*2]++),z.sym_next===z.sym_end);var E0=Q,O0=it,He=a0,p0=u0,x0=ec,L0={_tr_init:E0,_tr_stored_block:O0,_tr_flush_block:He,_tr_tally:p0,_tr_align:x0},b0=(z,ai,Y,s0)=>{let y0=z&65535|0,g0=z>>>16&65535|0,Y0=0;for(;Y!==0;){Y0=Y>2e3?2e3:Y,Y-=Y0;do y0=y0+ai[s0++]|0,g0=g0+y0|0;while(--Y0);y0%=65521,g0%=65521}return y0|g0<<16|0};const ut=()=>{let z,ai=[];for(var Y=0;Y<256;Y++){z=Y;for(var s0=0;s0<8;s0++)z=z&1?3988292384^z>>>1:z>>>1;ai[Y]=z}return ai},hi=new Uint32Array(ut());var W=(z,ai,Y,s0)=>{const y0=hi,g0=s0+Y;z^=-1;for(let Y0=s0;Y0<g0;Y0++)z=z>>>8^y0[(z^ai[Y0])&255];return z^-1},t0={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},o0={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Ji,_tr_stored_block:m0,_tr_flush_block:I0,_tr_tally:Z,_tr_align:at}=L0,{Z_NO_FLUSH:lt,Z_PARTIAL_FLUSH:n0,Z_FULL_FLUSH:r0,Z_FINISH:f0,Z_BLOCK:v0,Z_OK:A0,Z_STREAM_END:X0,Z_STREAM_ERROR:q0,Z_DATA_ERROR:i1,Z_BUF_ERROR:u1,Z_DEFAULT_COMPRESSION:e1,Z_FILTERED:Q0,Z_HUFFMAN_ONLY:e0,Z_RLE:T0,Z_FIXED:F0,Z_DEFAULT_STRATEGY:N0,Z_UNKNOWN:H0,Z_DEFLATED:r1}=o0,h1=9,p1=15,o1=8,c1=256+1+29,x1=30,m1=19,S1=2*c1+1,w1=15,l1=3,_1=258,b1=_1+l1+1,T1=32,Z1=42,O_=57,lv=69,pv=73,Q1=91,X_=103,F_=113,D_=666,F1=1,mv=2,Q_=3,cv=4,bv=3,uv=(z,ai)=>(z.msg=t0[ai],ai),$v=z=>z*2-(z>4?9:0),H_=z=>{let ai=z.length;for(;--ai>=0;)z[ai]=0},fx=z=>{let ai,Y,s0,y0=z.w_size;ai=z.hash_size,s0=ai;do Y=z.head[--s0],z.head[s0]=Y>=y0?Y-y0:0;while(--ai);ai=y0,s0=ai;do Y=z.prev[--s0],z.prev[s0]=Y>=y0?Y-y0:0;while(--ai)};let sv=(z,ai,Y)=>(ai<<z.hash_shift^Y)&z.hash_mask;const I_=z=>{const ai=z.state;let Y=ai.pending;Y>z.avail_out&&(Y=z.avail_out),Y!==0&&(z.output.set(ai.pending_buf.subarray(ai.pending_out,ai.pending_out+Y),z.next_out),z.next_out+=Y,ai.pending_out+=Y,z.total_out+=Y,z.avail_out-=Y,ai.pending-=Y,ai.pending===0&&(ai.pending_out=0))},Y_=(z,ai)=>{I0(z,z.block_start>=0?z.block_start:-1,z.strstart-z.block_start,ai),z.block_start=z.strstart,I_(z.strm)},V1=(z,ai)=>{z.pending_buf[z.pending++]=ai},j_=(z,ai)=>{z.pending_buf[z.pending++]=ai>>>8&255,z.pending_buf[z.pending++]=ai&255},J_=(z,ai,Y,s0)=>{let y0=z.avail_in;return y0>s0&&(y0=s0),y0===0?0:(z.avail_in-=y0,ai.set(z.input.subarray(z.next_in,z.next_in+y0),Y),z.state.wrap===1?z.adler=b0(z.adler,ai,y0,Y):z.state.wrap===2&&(z.adler=W(z.adler,ai,y0,Y)),z.next_in+=y0,z.total_in+=y0,y0)},nx=(z,ai)=>{let Y=z.max_chain_length,s0=z.strstart,y0,g0,Y0=z.prev_length,k0=z.nice_match;const g1=z.strstart>z.w_size-b1?z.strstart-(z.w_size-b1):0,B0=z.window,W0=z.w_mask,$1=z.prev,f1=z.strstart+_1;let a1=B0[s0+Y0-1],A1=B0[s0+Y0];z.prev_length>=z.good_match&&(Y>>=2),k0>z.lookahead&&(k0=z.lookahead);do if(y0=ai,!(B0[y0+Y0]!==A1||B0[y0+Y0-1]!==a1||B0[y0]!==B0[s0]||B0[++y0]!==B0[s0+1])){s0+=2,y0++;do;while(B0[++s0]===B0[++y0]&&B0[++s0]===B0[++y0]&&B0[++s0]===B0[++y0]&&B0[++s0]===B0[++y0]&&B0[++s0]===B0[++y0]&&B0[++s0]===B0[++y0]&&B0[++s0]===B0[++y0]&&B0[++s0]===B0[++y0]&&s0<f1);if(g0=_1-(f1-s0),s0=f1-_1,g0>Y0){if(z.match_start=ai,Y0=g0,g0>=k0)break;a1=B0[s0+Y0-1],A1=B0[s0+Y0]}}while((ai=$1[ai&W0])>g1&&--Y!==0);return Y0<=z.lookahead?Y0:z.lookahead},Sv=z=>{const ai=z.w_size;let Y,s0,y0;do{if(s0=z.window_size-z.lookahead-z.strstart,z.strstart>=ai+(ai-b1)&&(z.window.set(z.window.subarray(ai,ai+ai-s0),0),z.match_start-=ai,z.strstart-=ai,z.block_start-=ai,z.insert>z.strstart&&(z.insert=z.strstart),fx(z),s0+=ai),z.strm.avail_in===0)break;if(Y=J_(z.strm,z.window,z.strstart+z.lookahead,s0),z.lookahead+=Y,z.lookahead+z.insert>=l1)for(y0=z.strstart-z.insert,z.ins_h=z.window[y0],z.ins_h=sv(z,z.ins_h,z.window[y0+1]);z.insert&&(z.ins_h=sv(z,z.ins_h,z.window[y0+l1-1]),z.prev[y0&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=y0,y0++,z.insert--,!(z.lookahead+z.insert<l1)););}while(z.lookahead<b1&&z.strm.avail_in!==0)},mx=(z,ai)=>{let Y=z.pending_buf_size-5>z.w_size?z.w_size:z.pending_buf_size-5,s0,y0,g0,Y0=0,k0=z.strm.avail_in;do{if(s0=65535,g0=z.bi_valid+42>>3,z.strm.avail_out<g0||(g0=z.strm.avail_out-g0,y0=z.strstart-z.block_start,s0>y0+z.strm.avail_in&&(s0=y0+z.strm.avail_in),s0>g0&&(s0=g0),s0<Y&&(s0===0&&ai!==f0||ai===lt||s0!==y0+z.strm.avail_in)))break;Y0=ai===f0&&s0===y0+z.strm.avail_in?1:0,m0(z,0,0,Y0),z.pending_buf[z.pending-4]=s0,z.pending_buf[z.pending-3]=s0>>8,z.pending_buf[z.pending-2]=~s0,z.pending_buf[z.pending-1]=~s0>>8,I_(z.strm),y0&&(y0>s0&&(y0=s0),z.strm.output.set(z.window.subarray(z.block_start,z.block_start+y0),z.strm.next_out),z.strm.next_out+=y0,z.strm.avail_out-=y0,z.strm.total_out+=y0,z.block_start+=y0,s0-=y0),s0&&(J_(z.strm,z.strm.output,z.strm.next_out,s0),z.strm.next_out+=s0,z.strm.avail_out-=s0,z.strm.total_out+=s0)}while(Y0===0);return k0-=z.strm.avail_in,k0&&(k0>=z.w_size?(z.matches=2,z.window.set(z.strm.input.subarray(z.strm.next_in-z.w_size,z.strm.next_in),0),z.strstart=z.w_size,z.insert=z.strstart):(z.window_size-z.strstart<=k0&&(z.strstart-=z.w_size,z.window.set(z.window.subarray(z.w_size,z.w_size+z.strstart),0),z.matches<2&&z.matches++,z.insert>z.strstart&&(z.insert=z.strstart)),z.window.set(z.strm.input.subarray(z.strm.next_in-k0,z.strm.next_in),z.strstart),z.strstart+=k0,z.insert+=k0>z.w_size-z.insert?z.w_size-z.insert:k0),z.block_start=z.strstart),z.high_water<z.strstart&&(z.high_water=z.strstart),Y0?cv:ai!==lt&&ai!==f0&&z.strm.avail_in===0&&z.strstart===z.block_start?mv:(g0=z.window_size-z.strstart,z.strm.avail_in>g0&&z.block_start>=z.w_size&&(z.block_start-=z.w_size,z.strstart-=z.w_size,z.window.set(z.window.subarray(z.w_size,z.w_size+z.strstart),0),z.matches<2&&z.matches++,g0+=z.w_size,z.insert>z.strstart&&(z.insert=z.strstart)),g0>z.strm.avail_in&&(g0=z.strm.avail_in),g0&&(J_(z.strm,z.window,z.strstart,g0),z.strstart+=g0,z.insert+=g0>z.w_size-z.insert?z.w_size-z.insert:g0),z.high_water<z.strstart&&(z.high_water=z.strstart),g0=z.bi_valid+42>>3,g0=z.pending_buf_size-g0>65535?65535:z.pending_buf_size-g0,Y=g0>z.w_size?z.w_size:g0,y0=z.strstart-z.block_start,(y0>=Y||(y0||ai===f0)&&ai!==lt&&z.strm.avail_in===0&&y0<=g0)&&(s0=y0>g0?g0:y0,Y0=ai===f0&&z.strm.avail_in===0&&s0===y0?1:0,m0(z,z.block_start,s0,Y0),z.block_start+=s0,I_(z.strm)),Y0?Q_:F1)},ix=(z,ai)=>{let Y,s0;for(;;){if(z.lookahead<b1){if(Sv(z),z.lookahead<b1&&ai===lt)return F1;if(z.lookahead===0)break}if(Y=0,z.lookahead>=l1&&(z.ins_h=sv(z,z.ins_h,z.window[z.strstart+l1-1]),Y=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),Y!==0&&z.strstart-Y<=z.w_size-b1&&(z.match_length=nx(z,Y)),z.match_length>=l1)if(s0=Z(z,z.strstart-z.match_start,z.match_length-l1),z.lookahead-=z.match_length,z.match_length<=z.max_lazy_match&&z.lookahead>=l1){z.match_length--;do z.strstart++,z.ins_h=sv(z,z.ins_h,z.window[z.strstart+l1-1]),Y=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart;while(--z.match_length!==0);z.strstart++}else z.strstart+=z.match_length,z.match_length=0,z.ins_h=z.window[z.strstart],z.ins_h=sv(z,z.ins_h,z.window[z.strstart+1]);else s0=Z(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++;if(s0&&(Y_(z,!1),z.strm.avail_out===0))return F1}return z.insert=z.strstart<l1-1?z.strstart:l1-1,ai===f0?(Y_(z,!0),z.strm.avail_out===0?Q_:cv):z.sym_next&&(Y_(z,!1),z.strm.avail_out===0)?F1:mv},gx=(z,ai)=>{let Y,s0,y0;for(;;){if(z.lookahead<b1){if(Sv(z),z.lookahead<b1&&ai===lt)return F1;if(z.lookahead===0)break}if(Y=0,z.lookahead>=l1&&(z.ins_h=sv(z,z.ins_h,z.window[z.strstart+l1-1]),Y=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart),z.prev_length=z.match_length,z.prev_match=z.match_start,z.match_length=l1-1,Y!==0&&z.prev_length<z.max_lazy_match&&z.strstart-Y<=z.w_size-b1&&(z.match_length=nx(z,Y),z.match_length<=5&&(z.strategy===Q0||z.match_length===l1&&z.strstart-z.match_start>4096)&&(z.match_length=l1-1)),z.prev_length>=l1&&z.match_length<=z.prev_length){y0=z.strstart+z.lookahead-l1,s0=Z(z,z.strstart-1-z.prev_match,z.prev_length-l1),z.lookahead-=z.prev_length-1,z.prev_length-=2;do++z.strstart<=y0&&(z.ins_h=sv(z,z.ins_h,z.window[z.strstart+l1-1]),Y=z.prev[z.strstart&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=z.strstart);while(--z.prev_length!==0);if(z.match_available=0,z.match_length=l1-1,z.strstart++,s0&&(Y_(z,!1),z.strm.avail_out===0))return F1}else if(z.match_available){if(s0=Z(z,0,z.window[z.strstart-1]),s0&&Y_(z,!1),z.strstart++,z.lookahead--,z.strm.avail_out===0)return F1}else z.match_available=1,z.strstart++,z.lookahead--}return z.match_available&&(s0=Z(z,0,z.window[z.strstart-1]),z.match_available=0),z.insert=z.strstart<l1-1?z.strstart:l1-1,ai===f0?(Y_(z,!0),z.strm.avail_out===0?Q_:cv):z.sym_next&&(Y_(z,!1),z.strm.avail_out===0)?F1:mv},wS=(z,ai)=>{let Y,s0,y0,g0;const Y0=z.window;for(;;){if(z.lookahead<=_1){if(Sv(z),z.lookahead<=_1&&ai===lt)return F1;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=l1&&z.strstart>0&&(y0=z.strstart-1,s0=Y0[y0],s0===Y0[++y0]&&s0===Y0[++y0]&&s0===Y0[++y0])){g0=z.strstart+_1;do;while(s0===Y0[++y0]&&s0===Y0[++y0]&&s0===Y0[++y0]&&s0===Y0[++y0]&&s0===Y0[++y0]&&s0===Y0[++y0]&&s0===Y0[++y0]&&s0===Y0[++y0]&&y0<g0);z.match_length=_1-(g0-y0),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=l1?(Y=Z(z,1,z.match_length-l1),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):(Y=Z(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),Y&&(Y_(z,!1),z.strm.avail_out===0))return F1}return z.insert=0,ai===f0?(Y_(z,!0),z.strm.avail_out===0?Q_:cv):z.sym_next&&(Y_(z,!1),z.strm.avail_out===0)?F1:mv},EA=(z,ai)=>{let Y;for(;;){if(z.lookahead===0&&(Sv(z),z.lookahead===0)){if(ai===lt)return F1;break}if(z.match_length=0,Y=Z(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,Y&&(Y_(z,!1),z.strm.avail_out===0))return F1}return z.insert=0,ai===f0?(Y_(z,!0),z.strm.avail_out===0?Q_:cv):z.sym_next&&(Y_(z,!1),z.strm.avail_out===0)?F1:mv};function hv(z,ai,Y,s0,y0){this.good_length=z,this.max_lazy=ai,this.nice_length=Y,this.max_chain=s0,this.func=y0}const gv=[new hv(0,0,0,0,mx),new hv(4,4,8,4,ix),new hv(4,5,16,8,ix),new hv(4,6,32,32,ix),new hv(4,4,16,16,gx),new hv(8,16,32,32,gx),new hv(8,16,128,128,gx),new hv(8,32,128,256,gx),new hv(32,128,258,1024,gx),new hv(32,258,258,4096,gx)],CS=z=>{z.window_size=2*z.w_size,H_(z.head),z.max_lazy_match=gv[z.level].max_lazy,z.good_match=gv[z.level].good_length,z.nice_match=gv[z.level].nice_length,z.max_chain_length=gv[z.level].max_chain,z.strstart=0,z.block_start=0,z.lookahead=0,z.insert=0,z.match_length=z.prev_length=l1-1,z.match_available=0,z.ins_h=0};function f2(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=r1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(S1*2),this.dyn_dtree=new Uint16Array((2*x1+1)*2),this.bl_tree=new Uint16Array((2*m1+1)*2),H_(this.dyn_ltree),H_(this.dyn_dtree),H_(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(w1+1),this.heap=new Uint16Array(2*c1+1),H_(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*c1+1),H_(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Av=z=>{if(!z)return 1;const ai=z.state;return!ai||ai.strm!==z||ai.status!==Z1&&ai.status!==O_&&ai.status!==lv&&ai.status!==pv&&ai.status!==Q1&&ai.status!==X_&&ai.status!==F_&&ai.status!==D_?1:0},V2=z=>{if(Av(z))return uv(z,q0);z.total_in=z.total_out=0,z.data_type=H0;const ai=z.state;return ai.pending=0,ai.pending_out=0,ai.wrap<0&&(ai.wrap=-ai.wrap),ai.status=ai.wrap===2?O_:ai.wrap?Z1:F_,z.adler=ai.wrap===2?0:1,ai.last_flush=-2,Ji(ai),A0},p2=z=>{const ai=V2(z);return ai===A0&&CS(z.state),ai},MA=(z,ai)=>Av(z)||z.state.wrap!==2?q0:(z.state.gzhead=ai,A0),m2=(z,ai,Y,s0,y0,g0)=>{if(!z)return q0;let Y0=1;if(ai===e1&&(ai=6),s0<0?(Y0=0,s0=-s0):s0>15&&(Y0=2,s0-=16),y0<1||y0>h1||Y!==r1||s0<8||s0>15||ai<0||ai>9||g0<0||g0>F0||s0===8&&Y0!==1)return uv(z,q0);s0===8&&(s0=9);const k0=new f2;return z.state=k0,k0.strm=z,k0.status=Z1,k0.wrap=Y0,k0.gzhead=null,k0.w_bits=s0,k0.w_size=1<<k0.w_bits,k0.w_mask=k0.w_size-1,k0.hash_bits=y0+7,k0.hash_size=1<<k0.hash_bits,k0.hash_mask=k0.hash_size-1,k0.hash_shift=~~((k0.hash_bits+l1-1)/l1),k0.window=new Uint8Array(k0.w_size*2),k0.head=new Uint16Array(k0.hash_size),k0.prev=new Uint16Array(k0.w_size),k0.lit_bufsize=1<<y0+6,k0.pending_buf_size=k0.lit_bufsize*4,k0.pending_buf=new Uint8Array(k0.pending_buf_size),k0.sym_buf=k0.lit_bufsize,k0.sym_end=(k0.lit_bufsize-1)*3,k0.level=ai,k0.strategy=g0,k0.method=Y,p2(z)},H2=(z,ai)=>m2(z,ai,r1,p1,o1,N0),wA=(z,ai)=>{if(Av(z)||ai>v0||ai<0)return z?uv(z,q0):q0;const Y=z.state;if(!z.output||z.avail_in!==0&&!z.input||Y.status===D_&&ai!==f0)return uv(z,z.avail_out===0?u1:q0);const s0=Y.last_flush;if(Y.last_flush=ai,Y.pending!==0){if(I_(z),z.avail_out===0)return Y.last_flush=-1,A0}else if(z.avail_in===0&&$v(ai)<=$v(s0)&&ai!==f0)return uv(z,u1);if(Y.status===D_&&z.avail_in!==0)return uv(z,u1);if(Y.status===Z1&&Y.wrap===0&&(Y.status=F_),Y.status===Z1){let y0=r1+(Y.w_bits-8<<4)<<8,g0=-1;if(Y.strategy>=e0||Y.level<2?g0=0:Y.level<6?g0=1:Y.level===6?g0=2:g0=3,y0|=g0<<6,Y.strstart!==0&&(y0|=T1),y0+=31-y0%31,j_(Y,y0),Y.strstart!==0&&(j_(Y,z.adler>>>16),j_(Y,z.adler&65535)),z.adler=1,Y.status=F_,I_(z),Y.pending!==0)return Y.last_flush=-1,A0}if(Y.status===O_){if(z.adler=0,V1(Y,31),V1(Y,139),V1(Y,8),Y.gzhead)V1(Y,(Y.gzhead.text?1:0)+(Y.gzhead.hcrc?2:0)+(Y.gzhead.extra?4:0)+(Y.gzhead.name?8:0)+(Y.gzhead.comment?16:0)),V1(Y,Y.gzhead.time&255),V1(Y,Y.gzhead.time>>8&255),V1(Y,Y.gzhead.time>>16&255),V1(Y,Y.gzhead.time>>24&255),V1(Y,Y.level===9?2:Y.strategy>=e0||Y.level<2?4:0),V1(Y,Y.gzhead.os&255),Y.gzhead.extra&&Y.gzhead.extra.length&&(V1(Y,Y.gzhead.extra.length&255),V1(Y,Y.gzhead.extra.length>>8&255)),Y.gzhead.hcrc&&(z.adler=W(z.adler,Y.pending_buf,Y.pending,0)),Y.gzindex=0,Y.status=lv;else if(V1(Y,0),V1(Y,0),V1(Y,0),V1(Y,0),V1(Y,0),V1(Y,Y.level===9?2:Y.strategy>=e0||Y.level<2?4:0),V1(Y,bv),Y.status=F_,I_(z),Y.pending!==0)return Y.last_flush=-1,A0}if(Y.status===lv){if(Y.gzhead.extra){let y0=Y.pending,g0=(Y.gzhead.extra.length&65535)-Y.gzindex;for(;Y.pending+g0>Y.pending_buf_size;){let k0=Y.pending_buf_size-Y.pending;if(Y.pending_buf.set(Y.gzhead.extra.subarray(Y.gzindex,Y.gzindex+k0),Y.pending),Y.pending=Y.pending_buf_size,Y.gzhead.hcrc&&Y.pending>y0&&(z.adler=W(z.adler,Y.pending_buf,Y.pending-y0,y0)),Y.gzindex+=k0,I_(z),Y.pending!==0)return Y.last_flush=-1,A0;y0=0,g0-=k0}let Y0=new Uint8Array(Y.gzhead.extra);Y.pending_buf.set(Y0.subarray(Y.gzindex,Y.gzindex+g0),Y.pending),Y.pending+=g0,Y.gzhead.hcrc&&Y.pending>y0&&(z.adler=W(z.adler,Y.pending_buf,Y.pending-y0,y0)),Y.gzindex=0}Y.status=pv}if(Y.status===pv){if(Y.gzhead.name){let y0=Y.pending,g0;do{if(Y.pending===Y.pending_buf_size){if(Y.gzhead.hcrc&&Y.pending>y0&&(z.adler=W(z.adler,Y.pending_buf,Y.pending-y0,y0)),I_(z),Y.pending!==0)return Y.last_flush=-1,A0;y0=0}Y.gzindex<Y.gzhead.name.length?g0=Y.gzhead.name.charCodeAt(Y.gzindex++)&255:g0=0,V1(Y,g0)}while(g0!==0);Y.gzhead.hcrc&&Y.pending>y0&&(z.adler=W(z.adler,Y.pending_buf,Y.pending-y0,y0)),Y.gzindex=0}Y.status=Q1}if(Y.status===Q1){if(Y.gzhead.comment){let y0=Y.pending,g0;do{if(Y.pending===Y.pending_buf_size){if(Y.gzhead.hcrc&&Y.pending>y0&&(z.adler=W(z.adler,Y.pending_buf,Y.pending-y0,y0)),I_(z),Y.pending!==0)return Y.last_flush=-1,A0;y0=0}Y.gzindex<Y.gzhead.comment.length?g0=Y.gzhead.comment.charCodeAt(Y.gzindex++)&255:g0=0,V1(Y,g0)}while(g0!==0);Y.gzhead.hcrc&&Y.pending>y0&&(z.adler=W(z.adler,Y.pending_buf,Y.pending-y0,y0))}Y.status=X_}if(Y.status===X_){if(Y.gzhead.hcrc){if(Y.pending+2>Y.pending_buf_size&&(I_(z),Y.pending!==0))return Y.last_flush=-1,A0;V1(Y,z.adler&255),V1(Y,z.adler>>8&255),z.adler=0}if(Y.status=F_,I_(z),Y.pending!==0)return Y.last_flush=-1,A0}if(z.avail_in!==0||Y.lookahead!==0||ai!==lt&&Y.status!==D_){let y0=Y.level===0?mx(Y,ai):Y.strategy===e0?EA(Y,ai):Y.strategy===T0?wS(Y,ai):gv[Y.level].func(Y,ai);if((y0===Q_||y0===cv)&&(Y.status=D_),y0===F1||y0===Q_)return z.avail_out===0&&(Y.last_flush=-1),A0;if(y0===mv&&(ai===n0?at(Y):ai!==v0&&(m0(Y,0,0,!1),ai===r0&&(H_(Y.head),Y.lookahead===0&&(Y.strstart=0,Y.block_start=0,Y.insert=0))),I_(z),z.avail_out===0))return Y.last_flush=-1,A0}return ai!==f0?A0:Y.wrap<=0?X0:(Y.wrap===2?(V1(Y,z.adler&255),V1(Y,z.adler>>8&255),V1(Y,z.adler>>16&255),V1(Y,z.adler>>24&255),V1(Y,z.total_in&255),V1(Y,z.total_in>>8&255),V1(Y,z.total_in>>16&255),V1(Y,z.total_in>>24&255)):(j_(Y,z.adler>>>16),j_(Y,z.adler&65535)),I_(z),Y.wrap>0&&(Y.wrap=-Y.wrap),Y.pending!==0?A0:X0)},dv=z=>{if(Av(z))return q0;const ai=z.state.status;return z.state=null,ai===F_?uv(z,i1):A0},vx=(z,ai)=>{let Y=ai.length;if(Av(z))return q0;const s0=z.state,y0=s0.wrap;if(y0===2||y0===1&&s0.status!==Z1||s0.lookahead)return q0;if(y0===1&&(z.adler=b0(z.adler,ai,Y,0)),s0.wrap=0,Y>=s0.w_size){y0===0&&(H_(s0.head),s0.strstart=0,s0.block_start=0,s0.insert=0);let g1=new Uint8Array(s0.w_size);g1.set(ai.subarray(Y-s0.w_size,Y),0),ai=g1,Y=s0.w_size}const g0=z.avail_in,Y0=z.next_in,k0=z.input;for(z.avail_in=Y,z.next_in=0,z.input=ai,Sv(s0);s0.lookahead>=l1;){let g1=s0.strstart,B0=s0.lookahead-(l1-1);do s0.ins_h=sv(s0,s0.ins_h,s0.window[g1+l1-1]),s0.prev[g1&s0.w_mask]=s0.head[s0.ins_h],s0.head[s0.ins_h]=g1,g1++;while(--B0);s0.strstart=g1,s0.lookahead=l1-1,Sv(s0)}return s0.strstart+=s0.lookahead,s0.block_start=s0.strstart,s0.insert=s0.lookahead,s0.lookahead=0,s0.match_length=s0.prev_length=l1-1,s0.match_available=0,z.next_in=Y0,z.input=k0,z.avail_in=g0,s0.wrap=y0,A0};var j2=H2,g2=m2,kE=p2,TS=V2,RS=MA,_2=wA,W2=dv,CA=vx,GE="pako deflate (from Nodeca project)",v2={deflateInit:j2,deflateInit2:g2,deflateReset:kE,deflateResetKeep:TS,deflateSetHeader:RS,deflate:_2,deflateEnd:W2,deflateSetDictionary:CA,deflateInfo:GE};const VE=(z,ai)=>Object.prototype.hasOwnProperty.call(z,ai);var DS=function(z){const ai=Array.prototype.slice.call(arguments,1);for(;ai.length;){const Y=ai.shift();if(Y){if(typeof Y!="object")throw new TypeError(Y+"must be non-object");for(const s0 in Y)VE(Y,s0)&&(z[s0]=Y[s0])}}return z},HE=z=>{let ai=0;for(let s0=0,y0=z.length;s0<y0;s0++)ai+=z[s0].length;const Y=new Uint8Array(ai);for(let s0=0,y0=0,g0=z.length;s0<g0;s0++){let Y0=z[s0];Y.set(Y0,y0),y0+=Y0.length}return Y},$2={assign:DS,flattenChunks:HE};let TA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{TA=!1}const x2=new Uint8Array(256);for(let z=0;z<256;z++)x2[z]=z>=252?6:z>=248?5:z>=240?4:z>=224?3:z>=192?2:1;x2[254]=x2[254]=1;var jE=z=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(z);let ai,Y,s0,y0,g0,Y0=z.length,k0=0;for(y0=0;y0<Y0;y0++)Y=z.charCodeAt(y0),(Y&64512)===55296&&y0+1<Y0&&(s0=z.charCodeAt(y0+1),(s0&64512)===56320&&(Y=65536+(Y-55296<<10)+(s0-56320),y0++)),k0+=Y<128?1:Y<2048?2:Y<65536?3:4;for(ai=new Uint8Array(k0),g0=0,y0=0;g0<k0;y0++)Y=z.charCodeAt(y0),(Y&64512)===55296&&y0+1<Y0&&(s0=z.charCodeAt(y0+1),(s0&64512)===56320&&(Y=65536+(Y-55296<<10)+(s0-56320),y0++)),Y<128?ai[g0++]=Y:Y<2048?(ai[g0++]=192|Y>>>6,ai[g0++]=128|Y&63):Y<65536?(ai[g0++]=224|Y>>>12,ai[g0++]=128|Y>>>6&63,ai[g0++]=128|Y&63):(ai[g0++]=240|Y>>>18,ai[g0++]=128|Y>>>12&63,ai[g0++]=128|Y>>>6&63,ai[g0++]=128|Y&63);return ai};const RA=(z,ai)=>{if(ai<65534&&z.subarray&&TA)return String.fromCharCode.apply(null,z.length===ai?z:z.subarray(0,ai));let Y="";for(let s0=0;s0<ai;s0++)Y+=String.fromCharCode(z[s0]);return Y};var WE=(z,ai)=>{const Y=ai||z.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(z.subarray(0,ai));let s0,y0;const g0=new Array(Y*2);for(y0=0,s0=0;s0<Y;){let Y0=z[s0++];if(Y0<128){g0[y0++]=Y0;continue}let k0=x2[Y0];if(k0>4){g0[y0++]=65533,s0+=k0-1;continue}for(Y0&=k0===2?31:k0===3?15:7;k0>1&&s0<Y;)Y0=Y0<<6|z[s0++]&63,k0--;if(k0>1){g0[y0++]=65533;continue}Y0<65536?g0[y0++]=Y0:(Y0-=65536,g0[y0++]=55296|Y0>>10&1023,g0[y0++]=56320|Y0&1023)}return RA(g0,y0)},$E=(z,ai)=>{ai=ai||z.length,ai>z.length&&(ai=z.length);let Y=ai-1;for(;Y>=0&&(z[Y]&192)===128;)Y--;return Y<0||Y===0?ai:Y+x2[z[Y]]>ai?Y:ai},y2={string2buf:jE,buf2string:WE,utf8border:$E};function XE(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var X2=XE;const DA=Object.prototype.toString,{Z_NO_FLUSH:YE,Z_SYNC_FLUSH:KE,Z_FULL_FLUSH:LA,Z_FINISH:qE,Z_OK:Y2,Z_STREAM_END:ZE,Z_DEFAULT_COMPRESSION:QE,Z_DEFAULT_STRATEGY:JE,Z_DEFLATED:eM}=o0;function b2(z){this.options=$2.assign({level:QE,method:eM,chunkSize:16384,windowBits:15,memLevel:8,strategy:JE},z||{});let ai=this.options;ai.raw&&ai.windowBits>0?ai.windowBits=-ai.windowBits:ai.gzip&&ai.windowBits>0&&ai.windowBits<16&&(ai.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new X2,this.strm.avail_out=0;let Y=v2.deflateInit2(this.strm,ai.level,ai.method,ai.windowBits,ai.memLevel,ai.strategy);if(Y!==Y2)throw new Error(t0[Y]);if(ai.header&&v2.deflateSetHeader(this.strm,ai.header),ai.dictionary){let s0;if(typeof ai.dictionary=="string"?s0=y2.string2buf(ai.dictionary):DA.call(ai.dictionary)==="[object ArrayBuffer]"?s0=new Uint8Array(ai.dictionary):s0=ai.dictionary,Y=v2.deflateSetDictionary(this.strm,s0),Y!==Y2)throw new Error(t0[Y]);this._dict_set=!0}}b2.prototype.push=function(z,ai){const Y=this.strm,s0=this.options.chunkSize;let y0,g0;if(this.ended)return!1;for(ai===~~ai?g0=ai:g0=ai===!0?qE:YE,typeof z=="string"?Y.input=y2.string2buf(z):DA.call(z)==="[object ArrayBuffer]"?Y.input=new Uint8Array(z):Y.input=z,Y.next_in=0,Y.avail_in=Y.input.length;;){if(Y.avail_out===0&&(Y.output=new Uint8Array(s0),Y.next_out=0,Y.avail_out=s0),(g0===KE||g0===LA)&&Y.avail_out<=6){this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;continue}if(y0=v2.deflate(Y,g0),y0===ZE)return Y.next_out>0&&this.onData(Y.output.subarray(0,Y.next_out)),y0=v2.deflateEnd(this.strm),this.onEnd(y0),this.ended=!0,y0===Y2;if(Y.avail_out===0){this.onData(Y.output);continue}if(g0>0&&Y.next_out>0){this.onData(Y.output.subarray(0,Y.next_out)),Y.avail_out=0;continue}if(Y.avail_in===0)break}return!0},b2.prototype.onData=function(z){this.chunks.push(z)},b2.prototype.onEnd=function(z){z===Y2&&(this.result=$2.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg};function LS(z,ai){const Y=new b2(ai);if(Y.push(z,!0),Y.err)throw Y.msg||t0[Y.err];return Y.result}function tM(z,ai){return ai=ai||{},ai.raw=!0,LS(z,ai)}function PS(z,ai){return ai=ai||{},ai.gzip=!0,LS(z,ai)}var S2=b2,nM=LS,PA=tM,OA=PS,IA={Deflate:S2,deflate:nM,deflateRaw:PA,gzip:OA};const A2=16209,BA=16191;var kx=function(ai,Y){let s0,y0,g0,Y0,k0,g1,B0,W0,$1,f1,a1,A1,E_,B1,D1,X1,L1,d1,N1,k_,M1,H1,P1,R1;const z1=ai.state;s0=ai.next_in,P1=ai.input,y0=s0+(ai.avail_in-5),g0=ai.next_out,R1=ai.output,Y0=g0-(Y-ai.avail_out),k0=g0+(ai.avail_out-257),g1=z1.dmax,B0=z1.wsize,W0=z1.whave,$1=z1.wnext,f1=z1.window,a1=z1.hold,A1=z1.bits,E_=z1.lencode,B1=z1.distcode,D1=(1<<z1.lenbits)-1,X1=(1<<z1.distbits)-1;e:do{A1<15&&(a1+=P1[s0++]<<A1,A1+=8,a1+=P1[s0++]<<A1,A1+=8),L1=E_[a1&D1];t:for(;;){if(d1=L1>>>24,a1>>>=d1,A1-=d1,d1=L1>>>16&255,d1===0)R1[g0++]=L1&65535;else if(d1&16){N1=L1&65535,d1&=15,d1&&(A1<d1&&(a1+=P1[s0++]<<A1,A1+=8),N1+=a1&(1<<d1)-1,a1>>>=d1,A1-=d1),A1<15&&(a1+=P1[s0++]<<A1,A1+=8,a1+=P1[s0++]<<A1,A1+=8),L1=B1[a1&X1];n:for(;;){if(d1=L1>>>24,a1>>>=d1,A1-=d1,d1=L1>>>16&255,d1&16){if(k_=L1&65535,d1&=15,A1<d1&&(a1+=P1[s0++]<<A1,A1+=8,A1<d1&&(a1+=P1[s0++]<<A1,A1+=8)),k_+=a1&(1<<d1)-1,k_>g1){ai.msg="invalid distance too far back",z1.mode=A2;break e}if(a1>>>=d1,A1-=d1,d1=g0-Y0,k_>d1){if(d1=k_-d1,d1>W0&&z1.sane){ai.msg="invalid distance too far back",z1.mode=A2;break e}if(M1=0,H1=f1,$1===0){if(M1+=B0-d1,d1<N1){N1-=d1;do R1[g0++]=f1[M1++];while(--d1);M1=g0-k_,H1=R1}}else if($1<d1){if(M1+=B0+$1-d1,d1-=$1,d1<N1){N1-=d1;do R1[g0++]=f1[M1++];while(--d1);if(M1=0,$1<N1){d1=$1,N1-=d1;do R1[g0++]=f1[M1++];while(--d1);M1=g0-k_,H1=R1}}}else if(M1+=$1-d1,d1<N1){N1-=d1;do R1[g0++]=f1[M1++];while(--d1);M1=g0-k_,H1=R1}for(;N1>2;)R1[g0++]=H1[M1++],R1[g0++]=H1[M1++],R1[g0++]=H1[M1++],N1-=3;N1&&(R1[g0++]=H1[M1++],N1>1&&(R1[g0++]=H1[M1++]))}else{M1=g0-k_;do R1[g0++]=R1[M1++],R1[g0++]=R1[M1++],R1[g0++]=R1[M1++],N1-=3;while(N1>2);N1&&(R1[g0++]=R1[M1++],N1>1&&(R1[g0++]=R1[M1++]))}}else if((d1&64)===0){L1=B1[(L1&65535)+(a1&(1<<d1)-1)];continue n}else{ai.msg="invalid distance code",z1.mode=A2;break e}break}}else if((d1&64)===0){L1=E_[(L1&65535)+(a1&(1<<d1)-1)];continue t}else if(d1&32){z1.mode=BA;break e}else{ai.msg="invalid literal/length code",z1.mode=A2;break e}break}}while(s0<y0&&g0<k0);N1=A1>>3,s0-=N1,A1-=N1<<3,a1&=(1<<A1)-1,ai.next_in=s0,ai.next_out=g0,ai.avail_in=s0<y0?5+(y0-s0):5-(s0-y0),ai.avail_out=g0<k0?257+(k0-g0):257-(g0-k0),z1.hold=a1,z1.bits=A1};const Gx=15,NA=852,zA=592,OS=0,K2=1,Vx=2,E2=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),iM=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),q2=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),FA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var xx=(z,ai,Y,s0,y0,g0,Y0,k0)=>{const g1=k0.bits;let B0=0,W0=0,$1=0,f1=0,a1=0,A1=0,E_=0,B1=0,D1=0,X1=0,L1,d1,N1,k_,M1,H1=null,P1;const R1=new Uint16Array(Gx+1),z1=new Uint16Array(Gx+1);let Jv=null,Zx,ux,z2;for(B0=0;B0<=Gx;B0++)R1[B0]=0;for(W0=0;W0<s0;W0++)R1[ai[Y+W0]]++;for(a1=g1,f1=Gx;f1>=1&&R1[f1]===0;f1--);if(a1>f1&&(a1=f1),f1===0)return y0[g0++]=1<<24|64<<16|0,y0[g0++]=1<<24|64<<16|0,k0.bits=1,0;for($1=1;$1<f1&&R1[$1]===0;$1++);for(a1<$1&&(a1=$1),B1=1,B0=1;B0<=Gx;B0++)if(B1<<=1,B1-=R1[B0],B1<0)return-1;if(B1>0&&(z===OS||f1!==1))return-1;for(z1[1]=0,B0=1;B0<Gx;B0++)z1[B0+1]=z1[B0]+R1[B0];for(W0=0;W0<s0;W0++)ai[Y+W0]!==0&&(Y0[z1[ai[Y+W0]]++]=W0);if(z===OS?(H1=Jv=Y0,P1=20):z===K2?(H1=E2,Jv=iM,P1=257):(H1=q2,Jv=FA,P1=0),X1=0,W0=0,B0=$1,M1=g0,A1=a1,E_=0,N1=-1,D1=1<<a1,k_=D1-1,z===K2&&D1>NA||z===Vx&&D1>zA)return 1;for(;;){Zx=B0-E_,Y0[W0]+1<P1?(ux=0,z2=Y0[W0]):Y0[W0]>=P1?(ux=Jv[Y0[W0]-P1],z2=H1[Y0[W0]-P1]):(ux=96,z2=0),L1=1<<B0-E_,d1=1<<A1,$1=d1;do d1-=L1,y0[M1+(X1>>E_)+d1]=Zx<<24|ux<<16|z2|0;while(d1!==0);for(L1=1<<B0-1;X1&L1;)L1>>=1;if(L1!==0?(X1&=L1-1,X1+=L1):X1=0,W0++,--R1[B0]===0){if(B0===f1)break;B0=ai[Y+Y0[W0]]}if(B0>a1&&(X1&k_)!==N1){for(E_===0&&(E_=a1),M1+=$1,A1=B0-E_,B1=1<<A1;A1+E_<f1&&(B1-=R1[A1+E_],!(B1<=0));)A1++,B1<<=1;if(D1+=1<<A1,z===K2&&D1>NA||z===Vx&&D1>zA)return 1;N1=X1&k_,y0[N1]=a1<<24|A1<<16|M1-g0|0}}return X1!==0&&(y0[M1+X1]=B0-E_<<24|64<<16|0),k0.bits=a1,0};const IS=0,BS=1,NS=2,{Z_FINISH:zS,Z_BLOCK:sM,Z_TREES:Z2,Z_OK:yx,Z_STREAM_END:aM,Z_NEED_DICT:oM,Z_STREAM_ERROR:B_,Z_DATA_ERROR:Hx,Z_MEM_ERROR:FS,Z_BUF_ERROR:UA,Z_DEFLATED:US}=o0,M2=16180,Q2=16181,kA=16182,bx=16183,J2=16184,jx=16185,eS=16186,kS=16187,rx=16188,Sx=16189,Wx=16190,Fv=16191,Xv=16192,GS=16193,tS=16194,VS=16195,GA=16196,VA=16197,HA=16198,w2=16199,C2=16200,nS=16201,Ev=16202,T2=16203,_v=16204,Ax=16205,R2=16206,D2=16207,L2=16208,A_=16209,sx=16210,HS=16211,iS=852,$x=592,vv=15,rS=z=>(z>>>24&255)+(z>>>8&65280)+((z&65280)<<8)+((z&255)<<24);function Yv(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const ax=z=>{if(!z)return 1;const ai=z.state;return!ai||ai.strm!==z||ai.mode<M2||ai.mode>HS?1:0},P2=z=>{if(ax(z))return B_;const ai=z.state;return z.total_in=z.total_out=ai.total=0,z.msg="",ai.wrap&&(z.adler=ai.wrap&1),ai.mode=M2,ai.last=0,ai.havedict=0,ai.flags=-1,ai.dmax=32768,ai.head=null,ai.hold=0,ai.bits=0,ai.lencode=ai.lendyn=new Int32Array(iS),ai.distcode=ai.distdyn=new Int32Array($x),ai.sane=1,ai.back=-1,yx},ox=z=>{if(ax(z))return B_;const ai=z.state;return ai.wsize=0,ai.whave=0,ai.wnext=0,P2(z)},sS=(z,ai)=>{let Y;if(ax(z))return B_;const s0=z.state;return ai<0?(Y=0,ai=-ai):(Y=(ai>>4)+5,ai<48&&(ai&=15)),ai&&(ai<8||ai>15)?B_:(s0.window!==null&&s0.wbits!==ai&&(s0.window=null),s0.wrap=Y,s0.wbits=ai,ox(z))},jS=(z,ai)=>{if(!z)return B_;const Y=new Yv;z.state=Y,Y.strm=z,Y.window=null,Y.mode=M2;const s0=sS(z,ai);return s0!==yx&&(z.state=null),s0},WS=z=>jS(z,vv);let $S=!0,fv,lx;const Xx=z=>{if($S){fv=new Int32Array(512),lx=new Int32Array(32);let ai=0;for(;ai<144;)z.lens[ai++]=8;for(;ai<256;)z.lens[ai++]=9;for(;ai<280;)z.lens[ai++]=7;for(;ai<288;)z.lens[ai++]=8;for(xx(BS,z.lens,0,288,fv,0,z.work,{bits:9}),ai=0;ai<32;)z.lens[ai++]=5;xx(NS,z.lens,0,32,lx,0,z.work,{bits:5}),$S=!1}z.lencode=fv,z.lenbits=9,z.distcode=lx,z.distbits=5},O2=(z,ai,Y,s0)=>{let y0;const g0=z.state;return g0.window===null&&(g0.wsize=1<<g0.wbits,g0.wnext=0,g0.whave=0,g0.window=new Uint8Array(g0.wsize)),s0>=g0.wsize?(g0.window.set(ai.subarray(Y-g0.wsize,Y),0),g0.wnext=0,g0.whave=g0.wsize):(y0=g0.wsize-g0.wnext,y0>s0&&(y0=s0),g0.window.set(ai.subarray(Y-s0,Y-s0+y0),g0.wnext),s0-=y0,s0?(g0.window.set(ai.subarray(Y-s0,Y),0),g0.wnext=s0,g0.whave=g0.wsize):(g0.wnext+=y0,g0.wnext===g0.wsize&&(g0.wnext=0),g0.whave<g0.wsize&&(g0.whave+=y0))),0},I2=(z,ai)=>{let Y,s0,y0,g0,Y0,k0,g1,B0,W0,$1,f1,a1,A1,E_,B1=0,D1,X1,L1,d1,N1,k_,M1,H1;const P1=new Uint8Array(4);let R1,z1;const Jv=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(ax(z)||!z.output||!z.input&&z.avail_in!==0)return B_;Y=z.state,Y.mode===Fv&&(Y.mode=Xv),Y0=z.next_out,y0=z.output,g1=z.avail_out,g0=z.next_in,s0=z.input,k0=z.avail_in,B0=Y.hold,W0=Y.bits,$1=k0,f1=g1,H1=yx;e:for(;;)switch(Y.mode){case M2:if(Y.wrap===0){Y.mode=Xv;break}for(;W0<16;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if(Y.wrap&2&&B0===35615){Y.wbits===0&&(Y.wbits=15),Y.check=0,P1[0]=B0&255,P1[1]=B0>>>8&255,Y.check=W(Y.check,P1,2,0),B0=0,W0=0,Y.mode=Q2;break}if(Y.head&&(Y.head.done=!1),!(Y.wrap&1)||(((B0&255)<<8)+(B0>>8))%31){z.msg="incorrect header check",Y.mode=A_;break}if((B0&15)!==US){z.msg="unknown compression method",Y.mode=A_;break}if(B0>>>=4,W0-=4,M1=(B0&15)+8,Y.wbits===0&&(Y.wbits=M1),M1>15||M1>Y.wbits){z.msg="invalid window size",Y.mode=A_;break}Y.dmax=1<<Y.wbits,Y.flags=0,z.adler=Y.check=1,Y.mode=B0&512?Sx:Fv,B0=0,W0=0;break;case Q2:for(;W0<16;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if(Y.flags=B0,(Y.flags&255)!==US){z.msg="unknown compression method",Y.mode=A_;break}if(Y.flags&57344){z.msg="unknown header flags set",Y.mode=A_;break}Y.head&&(Y.head.text=B0>>8&1),Y.flags&512&&Y.wrap&4&&(P1[0]=B0&255,P1[1]=B0>>>8&255,Y.check=W(Y.check,P1,2,0)),B0=0,W0=0,Y.mode=kA;case kA:for(;W0<32;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}Y.head&&(Y.head.time=B0),Y.flags&512&&Y.wrap&4&&(P1[0]=B0&255,P1[1]=B0>>>8&255,P1[2]=B0>>>16&255,P1[3]=B0>>>24&255,Y.check=W(Y.check,P1,4,0)),B0=0,W0=0,Y.mode=bx;case bx:for(;W0<16;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}Y.head&&(Y.head.xflags=B0&255,Y.head.os=B0>>8),Y.flags&512&&Y.wrap&4&&(P1[0]=B0&255,P1[1]=B0>>>8&255,Y.check=W(Y.check,P1,2,0)),B0=0,W0=0,Y.mode=J2;case J2:if(Y.flags&1024){for(;W0<16;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}Y.length=B0,Y.head&&(Y.head.extra_len=B0),Y.flags&512&&Y.wrap&4&&(P1[0]=B0&255,P1[1]=B0>>>8&255,Y.check=W(Y.check,P1,2,0)),B0=0,W0=0}else Y.head&&(Y.head.extra=null);Y.mode=jx;case jx:if(Y.flags&1024&&(a1=Y.length,a1>k0&&(a1=k0),a1&&(Y.head&&(M1=Y.head.extra_len-Y.length,Y.head.extra||(Y.head.extra=new Uint8Array(Y.head.extra_len)),Y.head.extra.set(s0.subarray(g0,g0+a1),M1)),Y.flags&512&&Y.wrap&4&&(Y.check=W(Y.check,s0,a1,g0)),k0-=a1,g0+=a1,Y.length-=a1),Y.length))break e;Y.length=0,Y.mode=eS;case eS:if(Y.flags&2048){if(k0===0)break e;a1=0;do M1=s0[g0+a1++],Y.head&&M1&&Y.length<65536&&(Y.head.name+=String.fromCharCode(M1));while(M1&&a1<k0);if(Y.flags&512&&Y.wrap&4&&(Y.check=W(Y.check,s0,a1,g0)),k0-=a1,g0+=a1,M1)break e}else Y.head&&(Y.head.name=null);Y.length=0,Y.mode=kS;case kS:if(Y.flags&4096){if(k0===0)break e;a1=0;do M1=s0[g0+a1++],Y.head&&M1&&Y.length<65536&&(Y.head.comment+=String.fromCharCode(M1));while(M1&&a1<k0);if(Y.flags&512&&Y.wrap&4&&(Y.check=W(Y.check,s0,a1,g0)),k0-=a1,g0+=a1,M1)break e}else Y.head&&(Y.head.comment=null);Y.mode=rx;case rx:if(Y.flags&512){for(;W0<16;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if(Y.wrap&4&&B0!==(Y.check&65535)){z.msg="header crc mismatch",Y.mode=A_;break}B0=0,W0=0}Y.head&&(Y.head.hcrc=Y.flags>>9&1,Y.head.done=!0),z.adler=Y.check=0,Y.mode=Fv;break;case Sx:for(;W0<32;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}z.adler=Y.check=rS(B0),B0=0,W0=0,Y.mode=Wx;case Wx:if(Y.havedict===0)return z.next_out=Y0,z.avail_out=g1,z.next_in=g0,z.avail_in=k0,Y.hold=B0,Y.bits=W0,oM;z.adler=Y.check=1,Y.mode=Fv;case Fv:if(ai===sM||ai===Z2)break e;case Xv:if(Y.last){B0>>>=W0&7,W0-=W0&7,Y.mode=R2;break}for(;W0<3;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}switch(Y.last=B0&1,B0>>>=1,W0-=1,B0&3){case 0:Y.mode=GS;break;case 1:if(Xx(Y),Y.mode=w2,ai===Z2){B0>>>=2,W0-=2;break e}break;case 2:Y.mode=GA;break;case 3:z.msg="invalid block type",Y.mode=A_}B0>>>=2,W0-=2;break;case GS:for(B0>>>=W0&7,W0-=W0&7;W0<32;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if((B0&65535)!==(B0>>>16^65535)){z.msg="invalid stored block lengths",Y.mode=A_;break}if(Y.length=B0&65535,B0=0,W0=0,Y.mode=tS,ai===Z2)break e;case tS:Y.mode=VS;case VS:if(a1=Y.length,a1){if(a1>k0&&(a1=k0),a1>g1&&(a1=g1),a1===0)break e;y0.set(s0.subarray(g0,g0+a1),Y0),k0-=a1,g0+=a1,g1-=a1,Y0+=a1,Y.length-=a1;break}Y.mode=Fv;break;case GA:for(;W0<14;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if(Y.nlen=(B0&31)+257,B0>>>=5,W0-=5,Y.ndist=(B0&31)+1,B0>>>=5,W0-=5,Y.ncode=(B0&15)+4,B0>>>=4,W0-=4,Y.nlen>286||Y.ndist>30){z.msg="too many length or distance symbols",Y.mode=A_;break}Y.have=0,Y.mode=VA;case VA:for(;Y.have<Y.ncode;){for(;W0<3;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}Y.lens[Jv[Y.have++]]=B0&7,B0>>>=3,W0-=3}for(;Y.have<19;)Y.lens[Jv[Y.have++]]=0;if(Y.lencode=Y.lendyn,Y.lenbits=7,R1={bits:Y.lenbits},H1=xx(IS,Y.lens,0,19,Y.lencode,0,Y.work,R1),Y.lenbits=R1.bits,H1){z.msg="invalid code lengths set",Y.mode=A_;break}Y.have=0,Y.mode=HA;case HA:for(;Y.have<Y.nlen+Y.ndist;){for(;B1=Y.lencode[B0&(1<<Y.lenbits)-1],D1=B1>>>24,X1=B1>>>16&255,L1=B1&65535,!(D1<=W0);){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if(L1<16)B0>>>=D1,W0-=D1,Y.lens[Y.have++]=L1;else{if(L1===16){for(z1=D1+2;W0<z1;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if(B0>>>=D1,W0-=D1,Y.have===0){z.msg="invalid bit length repeat",Y.mode=A_;break}M1=Y.lens[Y.have-1],a1=3+(B0&3),B0>>>=2,W0-=2}else if(L1===17){for(z1=D1+3;W0<z1;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}B0>>>=D1,W0-=D1,M1=0,a1=3+(B0&7),B0>>>=3,W0-=3}else{for(z1=D1+7;W0<z1;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}B0>>>=D1,W0-=D1,M1=0,a1=11+(B0&127),B0>>>=7,W0-=7}if(Y.have+a1>Y.nlen+Y.ndist){z.msg="invalid bit length repeat",Y.mode=A_;break}for(;a1--;)Y.lens[Y.have++]=M1}}if(Y.mode===A_)break;if(Y.lens[256]===0){z.msg="invalid code -- missing end-of-block",Y.mode=A_;break}if(Y.lenbits=9,R1={bits:Y.lenbits},H1=xx(BS,Y.lens,0,Y.nlen,Y.lencode,0,Y.work,R1),Y.lenbits=R1.bits,H1){z.msg="invalid literal/lengths set",Y.mode=A_;break}if(Y.distbits=6,Y.distcode=Y.distdyn,R1={bits:Y.distbits},H1=xx(NS,Y.lens,Y.nlen,Y.ndist,Y.distcode,0,Y.work,R1),Y.distbits=R1.bits,H1){z.msg="invalid distances set",Y.mode=A_;break}if(Y.mode=w2,ai===Z2)break e;case w2:Y.mode=C2;case C2:if(k0>=6&&g1>=258){z.next_out=Y0,z.avail_out=g1,z.next_in=g0,z.avail_in=k0,Y.hold=B0,Y.bits=W0,kx(z,f1),Y0=z.next_out,y0=z.output,g1=z.avail_out,g0=z.next_in,s0=z.input,k0=z.avail_in,B0=Y.hold,W0=Y.bits,Y.mode===Fv&&(Y.back=-1);break}for(Y.back=0;B1=Y.lencode[B0&(1<<Y.lenbits)-1],D1=B1>>>24,X1=B1>>>16&255,L1=B1&65535,!(D1<=W0);){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if(X1&&(X1&240)===0){for(d1=D1,N1=X1,k_=L1;B1=Y.lencode[k_+((B0&(1<<d1+N1)-1)>>d1)],D1=B1>>>24,X1=B1>>>16&255,L1=B1&65535,!(d1+D1<=W0);){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}B0>>>=d1,W0-=d1,Y.back+=d1}if(B0>>>=D1,W0-=D1,Y.back+=D1,Y.length=L1,X1===0){Y.mode=Ax;break}if(X1&32){Y.back=-1,Y.mode=Fv;break}if(X1&64){z.msg="invalid literal/length code",Y.mode=A_;break}Y.extra=X1&15,Y.mode=nS;case nS:if(Y.extra){for(z1=Y.extra;W0<z1;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}Y.length+=B0&(1<<Y.extra)-1,B0>>>=Y.extra,W0-=Y.extra,Y.back+=Y.extra}Y.was=Y.length,Y.mode=Ev;case Ev:for(;B1=Y.distcode[B0&(1<<Y.distbits)-1],D1=B1>>>24,X1=B1>>>16&255,L1=B1&65535,!(D1<=W0);){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if((X1&240)===0){for(d1=D1,N1=X1,k_=L1;B1=Y.distcode[k_+((B0&(1<<d1+N1)-1)>>d1)],D1=B1>>>24,X1=B1>>>16&255,L1=B1&65535,!(d1+D1<=W0);){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}B0>>>=d1,W0-=d1,Y.back+=d1}if(B0>>>=D1,W0-=D1,Y.back+=D1,X1&64){z.msg="invalid distance code",Y.mode=A_;break}Y.offset=L1,Y.extra=X1&15,Y.mode=T2;case T2:if(Y.extra){for(z1=Y.extra;W0<z1;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}Y.offset+=B0&(1<<Y.extra)-1,B0>>>=Y.extra,W0-=Y.extra,Y.back+=Y.extra}if(Y.offset>Y.dmax){z.msg="invalid distance too far back",Y.mode=A_;break}Y.mode=_v;case _v:if(g1===0)break e;if(a1=f1-g1,Y.offset>a1){if(a1=Y.offset-a1,a1>Y.whave&&Y.sane){z.msg="invalid distance too far back",Y.mode=A_;break}a1>Y.wnext?(a1-=Y.wnext,A1=Y.wsize-a1):A1=Y.wnext-a1,a1>Y.length&&(a1=Y.length),E_=Y.window}else E_=y0,A1=Y0-Y.offset,a1=Y.length;a1>g1&&(a1=g1),g1-=a1,Y.length-=a1;do y0[Y0++]=E_[A1++];while(--a1);Y.length===0&&(Y.mode=C2);break;case Ax:if(g1===0)break e;y0[Y0++]=Y.length,g1--,Y.mode=C2;break;case R2:if(Y.wrap){for(;W0<32;){if(k0===0)break e;k0--,B0|=s0[g0++]<<W0,W0+=8}if(f1-=g1,z.total_out+=f1,Y.total+=f1,Y.wrap&4&&f1&&(z.adler=Y.check=Y.flags?W(Y.check,y0,f1,Y0-f1):b0(Y.check,y0,f1,Y0-f1)),f1=g1,Y.wrap&4&&(Y.flags?B0:rS(B0))!==Y.check){z.msg="incorrect data check",Y.mode=A_;break}B0=0,W0=0}Y.mode=D2;case D2:if(Y.wrap&&Y.flags){for(;W0<32;){if(k0===0)break e;k0--,B0+=s0[g0++]<<W0,W0+=8}if(Y.wrap&4&&B0!==(Y.total&4294967295)){z.msg="incorrect length check",Y.mode=A_;break}B0=0,W0=0}Y.mode=L2;case L2:H1=aM;break e;case A_:H1=Hx;break e;case sx:return FS;case HS:default:return B_}return z.next_out=Y0,z.avail_out=g1,z.next_in=g0,z.avail_in=k0,Y.hold=B0,Y.bits=W0,(Y.wsize||f1!==z.avail_out&&Y.mode<A_&&(Y.mode<R2||ai!==zS))&&O2(z,z.output,z.next_out,f1-z.avail_out),$1-=z.avail_in,f1-=z.avail_out,z.total_in+=$1,z.total_out+=f1,Y.total+=f1,Y.wrap&4&&f1&&(z.adler=Y.check=Y.flags?W(Y.check,y0,f1,z.next_out-f1):b0(Y.check,y0,f1,z.next_out-f1)),z.data_type=Y.bits+(Y.last?64:0)+(Y.mode===Fv?128:0)+(Y.mode===w2||Y.mode===tS?256:0),($1===0&&f1===0||ai===zS)&&H1===yx&&(H1=UA),H1},Mv=z=>{if(ax(z))return B_;let ai=z.state;return ai.window&&(ai.window=null),z.state=null,yx},wv=(z,ai)=>{if(ax(z))return B_;const Y=z.state;return(Y.wrap&2)===0?B_:(Y.head=ai,ai.done=!1,yx)},cx=(z,ai)=>{const Y=ai.length;let s0,y0,g0;return ax(z)||(s0=z.state,s0.wrap!==0&&s0.mode!==Wx)?B_:s0.mode===Wx&&(y0=1,y0=b0(y0,ai,Y,0),y0!==s0.check)?Hx:(g0=O2(z,ai,Y,Y),g0?(s0.mode=sx,FS):(s0.havedict=1,yx))};var Uv=ox,kv=sS,Kv=P2,jA=WS,XS=jS,YS=I2,WA=Mv,ev=wv,L_=cx,U1="pako inflate (from Nodeca project)",iv={inflateReset:Uv,inflateReset2:kv,inflateResetKeep:Kv,inflateInit:jA,inflateInit2:XS,inflate:YS,inflateEnd:WA,inflateGetHeader:ev,inflateSetDictionary:L_,inflateInfo:U1};function Cv(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var KS=Cv;const qv=Object.prototype.toString,{Z_NO_FLUSH:$A,Z_FINISH:XA,Z_OK:Gv,Z_STREAM_END:Zv,Z_NEED_DICT:B2,Z_STREAM_ERROR:N2,Z_DATA_ERROR:aS,Z_MEM_ERROR:Ex}=o0;function xv(z){this.options=$2.assign({chunkSize:65536,windowBits:15,to:""},z||{});const ai=this.options;ai.raw&&ai.windowBits>=0&&ai.windowBits<16&&(ai.windowBits=-ai.windowBits,ai.windowBits===0&&(ai.windowBits=-15)),ai.windowBits>=0&&ai.windowBits<16&&!(z&&z.windowBits)&&(ai.windowBits+=32),ai.windowBits>15&&ai.windowBits<48&&(ai.windowBits&15)===0&&(ai.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new X2,this.strm.avail_out=0;let Y=iv.inflateInit2(this.strm,ai.windowBits);if(Y!==Gv)throw new Error(t0[Y]);if(this.header=new KS,iv.inflateGetHeader(this.strm,this.header),ai.dictionary&&(typeof ai.dictionary=="string"?ai.dictionary=y2.string2buf(ai.dictionary):qv.call(ai.dictionary)==="[object ArrayBuffer]"&&(ai.dictionary=new Uint8Array(ai.dictionary)),ai.raw&&(Y=iv.inflateSetDictionary(this.strm,ai.dictionary),Y!==Gv)))throw new Error(t0[Y])}xv.prototype.push=function(z,ai){const Y=this.strm,s0=this.options.chunkSize,y0=this.options.dictionary;let g0,Y0,k0;if(this.ended)return!1;for(ai===~~ai?Y0=ai:Y0=ai===!0?XA:$A,qv.call(z)==="[object ArrayBuffer]"?Y.input=new Uint8Array(z):Y.input=z,Y.next_in=0,Y.avail_in=Y.input.length;;){for(Y.avail_out===0&&(Y.output=new Uint8Array(s0),Y.next_out=0,Y.avail_out=s0),g0=iv.inflate(Y,Y0),g0===B2&&y0&&(g0=iv.inflateSetDictionary(Y,y0),g0===Gv?g0=iv.inflate(Y,Y0):g0===aS&&(g0=B2));Y.avail_in>0&&g0===Zv&&Y.state.wrap>0&&z[Y.next_in]!==0;)iv.inflateReset(Y),g0=iv.inflate(Y,Y0);switch(g0){case N2:case aS:case B2:case Ex:return this.onEnd(g0),this.ended=!0,!1}if(k0=Y.avail_out,Y.next_out&&(Y.avail_out===0||g0===Zv))if(this.options.to==="string"){let g1=y2.utf8border(Y.output,Y.next_out),B0=Y.next_out-g1,W0=y2.buf2string(Y.output,g1);Y.next_out=B0,Y.avail_out=s0-B0,B0&&Y.output.set(Y.output.subarray(g1,g1+B0),0),this.onData(W0)}else this.onData(Y.output.length===Y.next_out?Y.output:Y.output.subarray(0,Y.next_out));if(!(g0===Gv&&k0===0)){if(g0===Zv)return g0=iv.inflateEnd(this.strm),this.onEnd(g0),this.ended=!0,!0;if(Y.avail_in===0)break}}return!0},xv.prototype.onData=function(z){this.chunks.push(z)},xv.prototype.onEnd=function(z){z===Gv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=$2.flattenChunks(this.chunks)),this.chunks=[],this.err=z,this.msg=this.strm.msg};function Vv(z,ai){const Y=new xv(ai);if(Y.push(z),Y.err)throw Y.msg||t0[Y.err];return Y.result}function Qv(z,ai){return ai=ai||{},ai.raw=!0,Vv(z,ai)}var qS=xv,ZS=Vv,Yx=Qv,oS=Vv,Mx={Inflate:qS,inflate:ZS,inflateRaw:Yx,ungzip:oS};const{Deflate:tv,deflate:lS,deflateRaw:YA,gzip:lM}=IA,{Inflate:cM,inflate:uM,inflateRaw:U_,ungzip:QS}=Mx;var Kx=tv,qx=lS,cS=YA,wx=lM,Cx=cM,KA=uM,JS=U_,qA=QS,eA=o0,Tx={Deflate:Kx,deflate:qx,deflateRaw:cS,gzip:wx,Inflate:Cx,inflate:KA,inflateRaw:JS,ungzip:qA,constants:eA}}),"./node_modules/upng-js/UPNG.js":((r,e,t)=>{(function(){var n={},i;r.exports=n,i=t("./node_modules/upng-js/node_modules/pako/index.js"),(function(s,o){s.toRGBA8=function(a){var l=a.width,d=a.height;if(a.tabs.acTL==null)return[s.toRGBA8.decodeImage(a.data,l,d,a).buffer];var u=[];a.frames[0].data==null&&(a.frames[0].data=a.data);for(var g,x=new Uint8Array(l*d*4),y=0;y<a.frames.length;y++){var b=a.frames[y],_=b.rect.x,h=b.rect.y,f=b.rect.width,E=b.rect.height,m=s.toRGBA8.decodeImage(b.data,f,E,a);if(y==0?g=m:b.blend==0?s._copyTile(m,f,E,g,l,d,_,h,0):b.blend==1&&s._copyTile(m,f,E,g,l,d,_,h,1),u.push(g.buffer),g=g.slice(0),b.dispose!=0){if(b.dispose==1)s._copyTile(x,f,E,g,l,d,_,h,0);else if(b.dispose==2){for(var S=y-1;a.frames[S].dispose==2;)S--;g=new Uint8Array(u[S]).slice(0)}}}return u},s.toRGBA8.decodeImage=function(a,l,d,u){var g=l*d,x=s.decode._getBPP(u),y=Math.ceil(l*x/8),b=new Uint8Array(g*4),_=new Uint32Array(b.buffer),h=u.ctype,f=u.depth,E=s._bin.readUshort;if(h==6){var m=g<<2;if(f==8)for(var S=0;S<m;S++)b[S]=a[S];if(f==16)for(var S=0;S<m;S++)b[S]=a[S<<1]}else if(h==2){var w=u.tabs.tRNS,v=-1,A=-1,M=-1;if(w&&(v=w[0],A=w[1],M=w[2]),f==8)for(var S=0;S<g;S++){var T=S<<2,R=S*3;b[T]=a[R],b[T+1]=a[R+1],b[T+2]=a[R+2],b[T+3]=255,v!=-1&&a[R]==v&&a[R+1]==A&&a[R+2]==M&&(b[T+3]=0)}if(f==16)for(var S=0;S<g;S++){var T=S<<2,R=S*6;b[T]=a[R],b[T+1]=a[R+2],b[T+2]=a[R+4],b[T+3]=255,v!=-1&&E(a,R)==v&&E(a,R+2)==A&&E(a,R+4)==M&&(b[T+3]=0)}}else if(h==3){var P=u.tabs.PLTE,L=u.tabs.tRNS,O=L?L.length:0;if(f==1)for(var I=0;I<d;I++)for(var N=I*y,k=I*l,S=0;S<l;S++){var T=k+S<<2,U=a[N+(S>>3)]>>7-((S&7)<<0)&1,F=3*U;b[T]=P[F],b[T+1]=P[F+1],b[T+2]=P[F+2],b[T+3]=U<O?L[U]:255}if(f==2)for(var I=0;I<d;I++)for(var N=I*y,k=I*l,S=0;S<l;S++){var T=k+S<<2,U=a[N+(S>>2)]>>6-((S&3)<<1)&3,F=3*U;b[T]=P[F],b[T+1]=P[F+1],b[T+2]=P[F+2],b[T+3]=U<O?L[U]:255}if(f==4)for(var I=0;I<d;I++)for(var N=I*y,k=I*l,S=0;S<l;S++){var T=k+S<<2,U=a[N+(S>>1)]>>4-((S&1)<<2)&15,F=3*U;b[T]=P[F],b[T+1]=P[F+1],b[T+2]=P[F+2],b[T+3]=U<O?L[U]:255}if(f==8)for(var S=0;S<g;S++){var T=S<<2,U=a[S],F=3*U;b[T]=P[F],b[T+1]=P[F+1],b[T+2]=P[F+2],b[T+3]=U<O?L[U]:255}}else if(h==4){if(f==8)for(var S=0;S<g;S++){var T=S<<2,j=S<<1,H=a[j];b[T]=H,b[T+1]=H,b[T+2]=H,b[T+3]=a[j+1]}if(f==16)for(var S=0;S<g;S++){var T=S<<2,j=S<<2,H=a[j];b[T]=H,b[T+1]=H,b[T+2]=H,b[T+3]=a[j+2]}}else if(h==0){var v=u.tabs.tRNS?u.tabs.tRNS:-1;if(f==1)for(var S=0;S<g;S++){var H=255*(a[S>>3]>>7-(S&7)&1),B=H==v*255?0:255;_[S]=B<<24|H<<16|H<<8|H}if(f==2)for(var S=0;S<g;S++){var H=85*(a[S>>2]>>6-((S&3)<<1)&3),B=H==v*85?0:255;_[S]=B<<24|H<<16|H<<8|H}if(f==4)for(var S=0;S<g;S++){var H=17*(a[S>>1]>>4-((S&1)<<2)&15),B=H==v*17?0:255;_[S]=B<<24|H<<16|H<<8|H}if(f==8)for(var S=0;S<g;S++){var H=a[S],B=H==v?0:255;_[S]=B<<24|H<<16|H<<8|H}if(f==16)for(var S=0;S<g;S++){var H=a[S<<1],B=E(a,S<<1)==v?0:255;_[S]=B<<24|H<<16|H<<8|H}}return b},s.decode=function(a){for(var l=new Uint8Array(a),d=8,u=s._bin,g=u.readUshort,x=u.readUint,y={tabs:{},frames:[]},b=new Uint8Array(l.length),_=0,h,f=0,E=[137,80,78,71,13,10,26,10],m=0;m<8;m++)if(l[m]!=E[m])throw"The input is not a PNG file!";for(;d<l.length;){var S=u.readUint(l,d);d+=4;var w=u.readASCII(l,d,4);if(d+=4,w=="IHDR")s.decode._IHDR(l,d,y);else if(w=="IDAT"){for(var m=0;m<S;m++)b[_+m]=l[d+m];_+=S}else if(w=="acTL")y.tabs[w]={num_frames:x(l,d),num_plays:x(l,d+4)},h=new Uint8Array(l.length);else if(w=="fcTL"){if(f!=0){var v=y.frames[y.frames.length-1];v.data=s.decode._decompress(y,h.slice(0,f),v.rect.width,v.rect.height),f=0}var A={x:x(l,d+12),y:x(l,d+16),width:x(l,d+4),height:x(l,d+8)},M=g(l,d+22);M=g(l,d+20)/(M==0?100:M);var T={rect:A,delay:Math.round(M*1e3),dispose:l[d+24],blend:l[d+25]};y.frames.push(T)}else if(w=="fdAT"){for(var m=0;m<S-4;m++)h[f+m]=l[d+m+4];f+=S-4}else if(w=="pHYs")y.tabs[w]=[u.readUint(l,d),u.readUint(l,d+4),l[d+8]];else if(w=="cHRM"){y.tabs[w]=[];for(var m=0;m<8;m++)y.tabs[w].push(u.readUint(l,d+m*4))}else if(w=="tEXt"){y.tabs[w]==null&&(y.tabs[w]={});var R=u.nextZero(l,d),P=u.readASCII(l,d,R-d),L=u.readASCII(l,R+1,d+S-R-1);y.tabs[w][P]=L}else if(w=="iTXt"){y.tabs[w]==null&&(y.tabs[w]={});var R=0,O=d;R=u.nextZero(l,O);var P=u.readASCII(l,O,R-O);O=R+1,l[O],l[O+1],O+=2,R=u.nextZero(l,O),u.readASCII(l,O,R-O),O=R+1,R=u.nextZero(l,O),u.readUTF8(l,O,R-O),O=R+1;var L=u.readUTF8(l,O,S-(O-d));y.tabs[w][P]=L}else if(w=="PLTE")y.tabs[w]=u.readBytes(l,d,S);else if(w=="hIST"){var I=y.tabs.PLTE.length/3;y.tabs[w]=[];for(var m=0;m<I;m++)y.tabs[w].push(g(l,d+m*2))}else if(w=="tRNS")y.ctype==3?y.tabs[w]=u.readBytes(l,d,S):y.ctype==0?y.tabs[w]=g(l,d):y.ctype==2&&(y.tabs[w]=[g(l,d),g(l,d+2),g(l,d+4)]);else if(w=="gAMA")y.tabs[w]=u.readUint(l,d)/1e5;else if(w=="sRGB")y.tabs[w]=l[d];else if(w=="bKGD")y.ctype==0||y.ctype==4?y.tabs[w]=[g(l,d)]:y.ctype==2||y.ctype==6?y.tabs[w]=[g(l,d),g(l,d+2),g(l,d+4)]:y.ctype==3&&(y.tabs[w]=l[d]);else if(w=="IEND"){if(f!=0){var v=y.frames[y.frames.length-1];v.data=s.decode._decompress(y,h.slice(0,f),v.rect.width,v.rect.height),f=0}y.data=s.decode._decompress(y,b,y.width,y.height);break}d+=S,u.readUint(l,d),d+=4}return delete y.compress,delete y.interlace,delete y.filter,y},s.decode._decompress=function(a,l,d,u){return a.compress==0&&(l=s.decode._inflate(l)),a.interlace==0?l=s.decode._filterZero(l,a,0,d,u):a.interlace==1&&(l=s.decode._readInterlace(l,a)),l},s.decode._inflate=function(a){return o.inflate(a)},s.decode._readInterlace=function(a,l){for(var d=l.width,u=l.height,g=s.decode._getBPP(l),x=g>>3,y=Math.ceil(d*g/8),b=new Uint8Array(u*y),_=0,h=[0,0,4,0,2,0,1],f=[0,4,0,2,0,1,0],E=[8,8,8,4,4,2,2],m=[8,8,4,4,2,2,1],S=0;S<7;){for(var w=E[S],v=m[S],A=0,M=0,T=h[S];T<u;)T+=w,M++;for(var R=f[S];R<d;)R+=v,A++;var P=Math.ceil(A*g/8);s.decode._filterZero(a,l,_,A,M);for(var L=0,O=h[S];O<u;){for(var I=f[S],N=_+L*P<<3;I<d;){if(g==1){var k=a[N>>3];k=k>>7-(N&7)&1,b[O*y+(I>>3)]|=k<<7-((I&3)<<0)}if(g==2){var k=a[N>>3];k=k>>6-(N&7)&3,b[O*y+(I>>2)]|=k<<6-((I&3)<<1)}if(g==4){var k=a[N>>3];k=k>>4-(N&7)&15,b[O*y+(I>>1)]|=k<<4-((I&1)<<2)}if(g>=8)for(var U=O*y+I*x,F=0;F<x;F++)b[U+F]=a[(N>>3)+F];N+=g,I+=v}L++,O+=w}A*M!=0&&(_+=M*(1+P)),S=S+1}return b},s.decode._getBPP=function(a){var l=[1,null,3,1,2,null,4][a.ctype];return l*a.depth},s.decode._filterZero=function(a,l,d,u,g){var x=s.decode._getBPP(l),y=Math.ceil(u*x/8),b=s.decode._paeth;x=Math.ceil(x/8);for(var _=0;_<g;_++){var h=d+_*y,f=h+_+1,E=a[f-1];if(E==0)for(var m=0;m<y;m++)a[h+m]=a[f+m];else if(E==1){for(var m=0;m<x;m++)a[h+m]=a[f+m];for(var m=x;m<y;m++)a[h+m]=a[f+m]+a[h+m-x]&255}else if(_==0){for(var m=0;m<x;m++)a[h+m]=a[f+m];if(E==2)for(var m=x;m<y;m++)a[h+m]=a[f+m]&255;if(E==3)for(var m=x;m<y;m++)a[h+m]=a[f+m]+(a[h+m-x]>>1)&255;if(E==4)for(var m=x;m<y;m++)a[h+m]=a[f+m]+b(a[h+m-x],0,0)&255}else{if(E==2)for(var m=0;m<y;m++)a[h+m]=a[f+m]+a[h+m-y]&255;if(E==3){for(var m=0;m<x;m++)a[h+m]=a[f+m]+(a[h+m-y]>>1)&255;for(var m=x;m<y;m++)a[h+m]=a[f+m]+(a[h+m-y]+a[h+m-x]>>1)&255}if(E==4){for(var m=0;m<x;m++)a[h+m]=a[f+m]+b(0,a[h+m-y],0)&255;for(var m=x;m<y;m++)a[h+m]=a[f+m]+b(a[h+m-x],a[h+m-y],a[h+m-x-y])&255}}}return a},s.decode._paeth=function(a,l,d){var u=a+l-d,g=Math.abs(u-a),x=Math.abs(u-l),y=Math.abs(u-d);return g<=x&&g<=y?a:x<=y?l:d},s.decode._IHDR=function(a,l,d){var u=s._bin;d.width=u.readUint(a,l),l+=4,d.height=u.readUint(a,l),l+=4,d.depth=a[l],l++,d.ctype=a[l],l++,d.compress=a[l],l++,d.filter=a[l],l++,d.interlace=a[l],l++},s._bin={nextZero:function(a,l){for(;a[l]!=0;)l++;return l},readUshort:function(a,l){return a[l]<<8|a[l+1]},writeUshort:function(a,l,d){a[l]=d>>8&255,a[l+1]=d&255},readUint:function(a,l){return a[l]*16777216+(a[l+1]<<16|a[l+2]<<8|a[l+3])},writeUint:function(a,l,d){a[l]=d>>24&255,a[l+1]=d>>16&255,a[l+2]=d>>8&255,a[l+3]=d&255},readASCII:function(a,l,d){for(var u="",g=0;g<d;g++)u+=String.fromCharCode(a[l+g]);return u},writeASCII:function(a,l,d){for(var u=0;u<d.length;u++)a[l+u]=d.charCodeAt(u)},readBytes:function(a,l,d){for(var u=[],g=0;g<d;g++)u.push(a[l+g]);return u},pad:function(a){return a.length<2?"0"+a:a},readUTF8:function(a,l,d){for(var u="",g,x=0;x<d;x++)u+="%"+s._bin.pad(a[l+x].toString(16));try{g=decodeURIComponent(u)}catch{return s._bin.readASCII(a,l,d)}return g}},s._copyTile=function(a,l,d,u,g,x,y,b,_){for(var h=Math.min(l,g),f=Math.min(d,x),E=0,m=0,S=0;S<f;S++)for(var w=0;w<h;w++)if(y>=0&&b>=0?(E=S*l+w<<2,m=(b+S)*g+y+w<<2):(E=(-b+S)*l-y+w<<2,m=S*g+w<<2),_==0)u[m]=a[E],u[m+1]=a[E+1],u[m+2]=a[E+2],u[m+3]=a[E+3];else if(_==1){var v=a[E+3]*.00392156862745098,A=a[E]*v,M=a[E+1]*v,T=a[E+2]*v,R=u[m+3]*(1/255),P=u[m]*R,L=u[m+1]*R,O=u[m+2]*R,I=1-v,N=v+R*I,k=N==0?0:1/N;u[m+3]=255*N,u[m+0]=(A+P*I)*k,u[m+1]=(M+L*I)*k,u[m+2]=(T+O*I)*k}else if(_==2){var v=a[E+3],A=a[E],M=a[E+1],T=a[E+2],R=u[m+3],P=u[m],L=u[m+1],O=u[m+2];v==R&&A==P&&M==L&&T==O?(u[m]=0,u[m+1]=0,u[m+2]=0,u[m+3]=0):(u[m]=A,u[m+1]=M,u[m+2]=T,u[m+3]=v)}else if(_==3){var v=a[E+3],A=a[E],M=a[E+1],T=a[E+2],R=u[m+3],P=u[m],L=u[m+1],O=u[m+2];if(v==R&&A==P&&M==L&&T==O)continue;if(v<220&&R>20)return!1}return!0},s.encode=function(a,l,d,u,g,x){u==null&&(u=0),x==null&&(x=!1);for(var y=new Uint8Array(a[0].byteLength*a.length+100),b=[137,80,78,71,13,10,26,10],_=0;_<8;_++)y[_]=b[_];var h=8,f=s._bin,E=s.crc.crc,m=f.writeUint,S=f.writeUshort,w=f.writeASCII,v=s.encode.compressPNG(a,l,d,u,x);m(y,h,13),h+=4,w(y,h,"IHDR"),h+=4,m(y,h,l),h+=4,m(y,h,d),h+=4,y[h]=v.depth,h++,y[h]=v.ctype,h++,y[h]=0,h++,y[h]=0,h++,y[h]=0,h++,m(y,h,E(y,h-17,17)),h+=4,m(y,h,1),h+=4,w(y,h,"sRGB"),h+=4,y[h]=1,h++,m(y,h,E(y,h-5,5)),h+=4;var A=a.length>1;if(A&&(m(y,h,8),h+=4,w(y,h,"acTL"),h+=4,m(y,h,a.length),h+=4,m(y,h,0),h+=4,m(y,h,E(y,h-12,12)),h+=4),v.ctype==3){var M=v.plte.length;m(y,h,M*3),h+=4,w(y,h,"PLTE"),h+=4;for(var _=0;_<M;_++){var T=_*3,R=v.plte[_],P=R&255,L=R>>8&255,O=R>>16&255;y[h+T+0]=P,y[h+T+1]=L,y[h+T+2]=O}if(h+=M*3,m(y,h,E(y,h-M*3-4,M*3+4)),h+=4,v.gotAlpha){m(y,h,M),h+=4,w(y,h,"tRNS"),h+=4;for(var _=0;_<M;_++)y[h+_]=v.plte[_]>>24&255;h+=M,m(y,h,E(y,h-M-4,M+4)),h+=4}}for(var I=0,N=0;N<v.frames.length;N++){var k=v.frames[N];A&&(m(y,h,26),h+=4,w(y,h,"fcTL"),h+=4,m(y,h,I++),h+=4,m(y,h,k.rect.width),h+=4,m(y,h,k.rect.height),h+=4,m(y,h,k.rect.x),h+=4,m(y,h,k.rect.y),h+=4,S(y,h,g[N]),h+=2,S(y,h,1e3),h+=2,y[h]=k.dispose,h++,y[h]=k.blend,h++,m(y,h,E(y,h-30,30)),h+=4);var U=k.cimg,M=U.length;m(y,h,M+(N==0?0:4)),h+=4;var F=h;w(y,h,N==0?"IDAT":"fdAT"),h+=4,N!=0&&(m(y,h,I++),h+=4);for(var _=0;_<M;_++)y[h+_]=U[_];h+=M,m(y,h,E(y,F,h-F)),h+=4}return m(y,h,0),h+=4,w(y,h,"IEND"),h+=4,m(y,h,E(y,h-4,4)),h+=4,y.buffer.slice(0,h)},s.encode.compressPNG=function(a,l,d,u,g){for(var x=s.encode.compress(a,l,d,u,!1,g),y=0;y<a.length;y++){var b=x.frames[y];b.rect.width;var _=b.rect.height,h=b.bpl,f=b.bpp,E=new Uint8Array(_*h+_);b.cimg=s.encode._filterZero(b.img,_,f,h,E)}return x},s.encode.compress=function(a,l,d,u,g,x){x==null&&(x=!1);for(var y=6,b=8,_=4,h=255,f=0;f<a.length;f++)for(var E=new Uint8Array(a[f]),m=E.length,S=0;S<m;S+=4)h&=E[S+3];var w=h!=255,v={},A=[];if(a.length!=0&&(v[0]=0,A.push(0),u!=0&&u--),u!=0){var M=s.quantize(a,u,g);a=M.bufs;for(var S=0;S<M.plte.length;S++){var T=M.plte[S].est.rgba;v[T]==null&&(v[T]=A.length,A.push(T))}}else for(var f=0;f<a.length;f++)for(var R=new Uint32Array(a[f]),m=R.length,S=0;S<m;S++){var T=R[S];if((S<l||T!=R[S-1]&&T!=R[S-l])&&v[T]==null&&(v[T]=A.length,A.push(T),A.length>=300))break}var P=w?g:!1,L=A.length;L<=256&&x==!1&&(L<=2?b=1:L<=4?b=2:L<=16?b=4:b=8,g&&(b=8),w=!0);for(var O=[],f=0;f<a.length;f++){var I=new Uint8Array(a[f]),N=new Uint32Array(I.buffer),k=0,U=0,F=l,j=d,H=0;if(f!=0&&!P){for(var B=g||f==1||O[O.length-2].dispose==2?1:2,V=0,K=1e9,q=0;q<B;q++){for(var Hm=new Uint8Array(a[f-1-q]),Te=new Uint32Array(a[f-1-q]),Fe=l,We=d,J=-1,et=-1,ht=0;ht<d;ht++)for(var er=0;er<l;er++){var S=ht*l+er;N[S]!=Te[S]&&(er<Fe&&(Fe=er),er>J&&(J=er),ht<We&&(We=ht),ht>et&&(et=ht))}var tr=J==-1?1:(J-Fe+1)*(et-We+1);tr<K&&(K=tr,V=q,J==-1?(k=U=0,F=j=1):(k=Fe,U=We,F=J-Fe+1,j=et-We+1))}var Hm=new Uint8Array(a[f-1-V]);V==1&&(O[O.length-1].dispose=2);var oi=new Uint8Array(F*j*4);new Uint32Array(oi.buffer),s._copyTile(Hm,l,d,oi,F,j,-k,-U,0),s._copyTile(I,l,d,oi,F,j,-k,-U,3)?(s._copyTile(I,l,d,oi,F,j,-k,-U,2),H=1):(s._copyTile(I,l,d,oi,F,j,-k,-U,0),H=0),I=oi,N=new Uint32Array(I.buffer)}var h0=4*F;if(L<=256&&x==!1){h0=Math.ceil(b*F/8);for(var oi=new Uint8Array(h0*j),ht=0;ht<j;ht++){var S=ht*h0,l0=ht*F;if(b==8)for(var er=0;er<F;er++)oi[S+er]=v[N[l0+er]];else if(b==4)for(var er=0;er<F;er++)oi[S+(er>>1)]|=v[N[l0+er]]<<4-(er&1)*4;else if(b==2)for(var er=0;er<F;er++)oi[S+(er>>2)]|=v[N[l0+er]]<<6-(er&3)*2;else if(b==1)for(var er=0;er<F;er++)oi[S+(er>>3)]|=v[N[l0+er]]<<7-(er&7)*1}I=oi,y=3,_=1}else if(w==!1&&a.length==1){for(var oi=new Uint8Array(F*j*3),M0=F*j,S=0;S<M0;S++){var U0=S*3,_0=S*4;oi[U0]=I[_0],oi[U0+1]=I[_0+1],oi[U0+2]=I[_0+2]}I=oi,y=2,_=3,h0=3*F}O.push({rect:{x:k,y:U,width:F,height:j},img:I,bpl:h0,bpp:_,blend:H,dispose:P?1:0})}return{ctype:y,depth:b,plte:A,gotAlpha:w,frames:O}},s.encode._filterZero=function(a,l,d,u,g){for(var x=[],y=0;y<5;y++)if(!(l*u>5e5&&(y==2||y==3||y==4))){for(var b=0;b<l;b++)s.encode._filterLine(g,a,b,u,d,y);if(x.push(o.deflate(g)),d==1)break}for(var _,h=1e9,f=0;f<x.length;f++)x[f].length<h&&(_=f,h=x[f].length);return x[_]},s.encode._filterLine=function(a,l,d,u,g,x){var y=d*u,b=y+d,_=s.decode._paeth;if(a[b]=x,b++,x==0)for(var h=0;h<u;h++)a[b+h]=l[y+h];else if(x==1){for(var h=0;h<g;h++)a[b+h]=l[y+h];for(var h=g;h<u;h++)a[b+h]=l[y+h]-l[y+h-g]+256&255}else if(d==0){for(var h=0;h<g;h++)a[b+h]=l[y+h];if(x==2)for(var h=g;h<u;h++)a[b+h]=l[y+h];if(x==3)for(var h=g;h<u;h++)a[b+h]=l[y+h]-(l[y+h-g]>>1)+256&255;if(x==4)for(var h=g;h<u;h++)a[b+h]=l[y+h]-_(l[y+h-g],0,0)+256&255}else{if(x==2)for(var h=0;h<u;h++)a[b+h]=l[y+h]+256-l[y+h-u]&255;if(x==3){for(var h=0;h<g;h++)a[b+h]=l[y+h]+256-(l[y+h-u]>>1)&255;for(var h=g;h<u;h++)a[b+h]=l[y+h]+256-(l[y+h-u]+l[y+h-g]>>1)&255}if(x==4){for(var h=0;h<g;h++)a[b+h]=l[y+h]+256-_(0,l[y+h-u],0)&255;for(var h=g;h<u;h++)a[b+h]=l[y+h]+256-_(l[y+h-g],l[y+h-u],l[y+h-g-u])&255}}},s.crc={table:(function(){for(var a=new Uint32Array(256),l=0;l<256;l++){for(var d=l,u=0;u<8;u++)d&1?d=3988292384^d>>>1:d=d>>>1;a[l]=d}return a})(),update:function(a,l,d,u){for(var g=0;g<u;g++)a=s.crc.table[(a^l[d+g])&255]^a>>>8;return a},crc:function(a,l,d){return s.crc.update(4294967295,a,l,d)^4294967295}},s.quantize=function(a,l,d){for(var u=[],g=0,x=0;x<a.length;x++)u.push(s.encode.alphaMul(new Uint8Array(a[x]),d)),g+=a[x].byteLength;for(var y=new Uint8Array(g),b=new Uint32Array(y.buffer),_=0,x=0;x<u.length;x++){for(var h=u[x],f=h.length,E=0;E<f;E++)y[_+E]=h[E];_+=f}var m={i0:0,i1:y.length,bst:null,est:null,tdst:0,left:null,right:null};m.bst=s.quantize.stats(y,m.i0,m.i1),m.est=s.quantize.estats(m.bst);for(var S=[m];S.length<l;){for(var w=0,v=0,x=0;x<S.length;x++)S[x].est.L>w&&(w=S[x].est.L,v=x);if(w<.001)break;var A=S[v],M=s.quantize.splitPixels(y,b,A.i0,A.i1,A.est.e,A.est.eMq255),T={i0:A.i0,i1:M,bst:null,est:null,tdst:0,left:null,right:null};T.bst=s.quantize.stats(y,T.i0,T.i1),T.est=s.quantize.estats(T.bst);var R={i0:M,i1:A.i1,bst:null,est:null,tdst:0,left:null,right:null};R.bst={R:[],m:[],N:A.bst.N-T.bst.N};for(var x=0;x<16;x++)R.bst.R[x]=A.bst.R[x]-T.bst.R[x];for(var x=0;x<4;x++)R.bst.m[x]=A.bst.m[x]-T.bst.m[x];R.est=s.quantize.estats(R.bst),A.left=T,A.right=R,S[v]=T,S.push(R)}S.sort(function(B,V){return V.bst.N-B.bst.N});for(var P=0;P<u.length;P++){for(var L=s.quantize.planeDst,O=new Uint8Array(u[P].buffer),I=new Uint32Array(u[P].buffer),N=O.length,x=0;x<N;x+=4){for(var k=O[x]*.00392156862745098,U=O[x+1]*(1/255),F=O[x+2]*(1/255),j=O[x+3]*(1/255),H=m;H.left;)H=L(H.est,k,U,F,j)<=0?H.left:H.right;I[x>>2]=H.est.rgba}u[P]=I.buffer}return{bufs:u,plte:S}},s.quantize.getNearest=function(a,l,d,u,g){if(a.left==null)return a.tdst=s.quantize.dist(a.est.q,l,d,u,g),a;var x=s.quantize.planeDst(a.est,l,d,u,g),y=a.left,b=a.right;x>0&&(y=a.right,b=a.left);var _=s.quantize.getNearest(y,l,d,u,g);if(_.tdst<=x*x)return _;var h=s.quantize.getNearest(b,l,d,u,g);return h.tdst<_.tdst?h:_},s.quantize.planeDst=function(a,l,d,u,g){var x=a.e;return x[0]*l+x[1]*d+x[2]*u+x[3]*g-a.eMq},s.quantize.dist=function(a,l,d,u,g){var x=l-a[0],y=d-a[1],b=u-a[2],_=g-a[3];return x*x+y*y+b*b+_*_},s.quantize.splitPixels=function(a,l,d,u,g,x){var y=s.quantize.vecDot;for(u-=4;d<u;){for(;y(a,d,g)<=x;)d+=4;for(;y(a,u,g)>x;)u-=4;if(d>=u)break;var b=l[d>>2];l[d>>2]=l[u>>2],l[u>>2]=b,d+=4,u-=4}for(;y(a,d,g)>x;)d-=4;return d+4},s.quantize.vecDot=function(a,l,d){return a[l]*d[0]+a[l+1]*d[1]+a[l+2]*d[2]+a[l+3]*d[3]},s.quantize.stats=function(a,l,d){for(var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=[0,0,0,0],x=d-l>>2,y=l;y<d;y+=4){var b=a[y]*.00392156862745098,_=a[y+1]*(1/255),h=a[y+2]*(1/255),f=a[y+3]*(1/255);g[0]+=b,g[1]+=_,g[2]+=h,g[3]+=f,u[0]+=b*b,u[1]+=b*_,u[2]+=b*h,u[3]+=b*f,u[5]+=_*_,u[6]+=_*h,u[7]+=_*f,u[10]+=h*h,u[11]+=h*f,u[15]+=f*f}return u[4]=u[1],u[8]=u[2],u[12]=u[3],u[9]=u[6],u[13]=u[7],u[14]=u[11],{R:u,m:g,N:x}},s.quantize.estats=function(a){var l=a.R,d=a.m,u=a.N,g=d[0],x=d[1],y=d[2],b=d[3],_=u==0?0:1/u,h=[l[0]-g*g*_,l[1]-g*x*_,l[2]-g*y*_,l[3]-g*b*_,l[4]-x*g*_,l[5]-x*x*_,l[6]-x*y*_,l[7]-x*b*_,l[8]-y*g*_,l[9]-y*x*_,l[10]-y*y*_,l[11]-y*b*_,l[12]-b*g*_,l[13]-b*x*_,l[14]-b*y*_,l[15]-b*b*_],f=h,E=s.M4,m=[.5,.5,.5,.5],S=0,w=0;if(u!=0)for(var v=0;v<10&&(m=E.multVec(f,m),w=Math.sqrt(E.dot(m,m)),m=E.sml(1/w,m),!(Math.abs(w-S)<1e-9));v++)S=w;var A=[g*_,x*_,y*_,b*_],M=E.dot(E.sml(255,A),m),T=A[3]<.001?0:1/A[3];return{Cov:h,q:A,e:m,L:S,eMq255:M,eMq:E.dot(m,A),rgba:(Math.round(255*A[3])<<24|Math.round(255*A[2]*T)<<16|Math.round(255*A[1]*T)<<8|Math.round(255*A[0]*T)<<0)>>>0}},s.M4={multVec:function(a,l){return[a[0]*l[0]+a[1]*l[1]+a[2]*l[2]+a[3]*l[3],a[4]*l[0]+a[5]*l[1]+a[6]*l[2]+a[7]*l[3],a[8]*l[0]+a[9]*l[1]+a[10]*l[2]+a[11]*l[3],a[12]*l[0]+a[13]*l[1]+a[14]*l[2]+a[15]*l[3]]},dot:function(a,l){return a[0]*l[0]+a[1]*l[1]+a[2]*l[2]+a[3]*l[3]},sml:function(a,l){return[a*l[0],a*l[1],a*l[2],a*l[3]]}},s.encode.alphaMul=function(a,l){for(var d=new Uint8Array(a.length),u=a.length>>2,g=0;g<u;g++){var x=g<<2,y=a[x+3];l&&(y=y<128?0:255);var b=y*(1/255);d[x+0]=a[x+0]*b,d[x+1]=a[x+1]*b,d[x+2]=a[x+2]*b,d[x+3]=y}return d}})(n,i)})()}),"./node_modules/upng-js/node_modules/pako/index.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js").assign,i=t("./node_modules/upng-js/node_modules/pako/lib/deflate.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/inflate.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),a={};n(a,i,s,o),r.exports=a}),"./node_modules/upng-js/node_modules/pako/lib/deflate.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js"),i=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),a=t("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),l=Object.prototype.toString,d=0,u=4,g=0,x=1,y=2,b=-1,_=0,h=8;function f(w){if(!(this instanceof f))return new f(w);this.options=i.assign({level:b,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:_,to:""},w||{});var v=this.options;v.raw&&v.windowBits>0?v.windowBits=-v.windowBits:v.gzip&&v.windowBits>0&&v.windowBits<16&&(v.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var A=n.deflateInit2(this.strm,v.level,v.method,v.windowBits,v.memLevel,v.strategy);if(A!==g)throw new Error(o[A]);if(v.header&&n.deflateSetHeader(this.strm,v.header),v.dictionary){var M;if(typeof v.dictionary=="string"?M=s.string2buf(v.dictionary):l.call(v.dictionary)==="[object ArrayBuffer]"?M=new Uint8Array(v.dictionary):M=v.dictionary,A=n.deflateSetDictionary(this.strm,M),A!==g)throw new Error(o[A]);this._dict_set=!0}}f.prototype.push=function(w,v){var A=this.strm,M=this.options.chunkSize,T,R;if(this.ended)return!1;R=v===~~v?v:v===!0?u:d,typeof w=="string"?A.input=s.string2buf(w):l.call(w)==="[object ArrayBuffer]"?A.input=new Uint8Array(w):A.input=w,A.next_in=0,A.avail_in=A.input.length;do{if(A.avail_out===0&&(A.output=new i.Buf8(M),A.next_out=0,A.avail_out=M),T=n.deflate(A,R),T!==x&&T!==g)return this.onEnd(T),this.ended=!0,!1;(A.avail_out===0||A.avail_in===0&&(R===u||R===y))&&(this.options.to==="string"?this.onData(s.buf2binstring(i.shrinkBuf(A.output,A.next_out))):this.onData(i.shrinkBuf(A.output,A.next_out)))}while((A.avail_in>0||A.avail_out===0)&&T!==x);return R===u?(T=n.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===g):(R===y&&(this.onEnd(g),A.avail_out=0),!0)},f.prototype.onData=function(w){this.chunks.push(w)},f.prototype.onEnd=function(w){w===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=w,this.msg=this.strm.msg};function E(w,v){var A=new f(v);if(A.push(w,!0),A.err)throw A.msg||o[A.err];return A.result}function m(w,v){return v=v||{},v.raw=!0,E(w,v)}function S(w,v){return v=v||{},v.gzip=!0,E(w,v)}e.Deflate=f,e.deflate=E,e.deflateRaw=m,e.gzip=S}),"./node_modules/upng-js/node_modules/pako/lib/inflate.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js"),i=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/utils/strings.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js"),a=t("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),l=t("./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js"),d=t("./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js"),u=Object.prototype.toString;function g(b){if(!(this instanceof g))return new g(b);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},b||{});var _=this.options;_.raw&&_.windowBits>=0&&_.windowBits<16&&(_.windowBits=-_.windowBits,_.windowBits===0&&(_.windowBits=-15)),_.windowBits>=0&&_.windowBits<16&&!(b&&b.windowBits)&&(_.windowBits+=32),_.windowBits>15&&_.windowBits<48&&(_.windowBits&15)===0&&(_.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var h=n.inflateInit2(this.strm,_.windowBits);if(h!==o.Z_OK)throw new Error(a[h]);if(this.header=new d,n.inflateGetHeader(this.strm,this.header),_.dictionary&&(typeof _.dictionary=="string"?_.dictionary=s.string2buf(_.dictionary):u.call(_.dictionary)==="[object ArrayBuffer]"&&(_.dictionary=new Uint8Array(_.dictionary)),_.raw&&(h=n.inflateSetDictionary(this.strm,_.dictionary),h!==o.Z_OK)))throw new Error(a[h])}g.prototype.push=function(b,_){var h=this.strm,f=this.options.chunkSize,E=this.options.dictionary,m,S,w,v,A,M=!1;if(this.ended)return!1;S=_===~~_?_:_===!0?o.Z_FINISH:o.Z_NO_FLUSH,typeof b=="string"?h.input=s.binstring2buf(b):u.call(b)==="[object ArrayBuffer]"?h.input=new Uint8Array(b):h.input=b,h.next_in=0,h.avail_in=h.input.length;do{if(h.avail_out===0&&(h.output=new i.Buf8(f),h.next_out=0,h.avail_out=f),m=n.inflate(h,o.Z_NO_FLUSH),m===o.Z_NEED_DICT&&E&&(m=n.inflateSetDictionary(this.strm,E)),m===o.Z_BUF_ERROR&&M===!0&&(m=o.Z_OK,M=!1),m!==o.Z_STREAM_END&&m!==o.Z_OK)return this.onEnd(m),this.ended=!0,!1;h.next_out&&(h.avail_out===0||m===o.Z_STREAM_END||h.avail_in===0&&(S===o.Z_FINISH||S===o.Z_SYNC_FLUSH))&&(this.options.to==="string"?(w=s.utf8border(h.output,h.next_out),v=h.next_out-w,A=s.buf2string(h.output,w),h.next_out=v,h.avail_out=f-v,v&&i.arraySet(h.output,h.output,w,v,0),this.onData(A)):this.onData(i.shrinkBuf(h.output,h.next_out))),h.avail_in===0&&h.avail_out===0&&(M=!0)}while((h.avail_in>0||h.avail_out===0)&&m!==o.Z_STREAM_END);return m===o.Z_STREAM_END&&(S=o.Z_FINISH),S===o.Z_FINISH?(m=n.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===o.Z_OK):(S===o.Z_SYNC_FLUSH&&(this.onEnd(o.Z_OK),h.avail_out=0),!0)},g.prototype.onData=function(b){this.chunks.push(b)},g.prototype.onEnd=function(b){b===o.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=b,this.msg=this.strm.msg};function x(b,_){var h=new g(_);if(h.push(b,!0),h.err)throw h.msg||a[h.err];return h.result}function y(b,_){return _=_||{},_.raw=!0,x(b,_)}e.Inflate=g,e.inflate=x,e.inflateRaw=y,e.ungzip=x}),"./node_modules/upng-js/node_modules/pako/lib/utils/common.js":((r,e)=>{var t=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function n(o,a){return Object.prototype.hasOwnProperty.call(o,a)}e.assign=function(o){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var d in l)n(l,d)&&(o[d]=l[d])}}return o},e.shrinkBuf=function(o,a){return o.length===a?o:o.subarray?o.subarray(0,a):(o.length=a,o)};var i={arraySet:function(o,a,l,d,u){if(a.subarray&&o.subarray){o.set(a.subarray(l,l+d),u);return}for(var g=0;g<d;g++)o[u+g]=a[l+g]},flattenChunks:function(o){var a,l,d,u,g,x;for(d=0,a=0,l=o.length;a<l;a++)d+=o[a].length;for(x=new Uint8Array(d),u=0,a=0,l=o.length;a<l;a++)g=o[a],x.set(g,u),u+=g.length;return x}},s={arraySet:function(o,a,l,d,u){for(var g=0;g<d;g++)o[u+g]=a[l+g]},flattenChunks:function(o){return[].concat.apply([],o)}};e.setTyped=function(o){o?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,i)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,s))},e.setTyped(t)}),"./node_modules/upng-js/node_modules/pako/lib/utils/strings.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var o=new n.Buf8(256),a=0;a<256;a++)o[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;o[254]=o[254]=1,e.string2buf=function(d){var u,g,x,y,b,_=d.length,h=0;for(y=0;y<_;y++)g=d.charCodeAt(y),(g&64512)===55296&&y+1<_&&(x=d.charCodeAt(y+1),(x&64512)===56320&&(g=65536+(g-55296<<10)+(x-56320),y++)),h+=g<128?1:g<2048?2:g<65536?3:4;for(u=new n.Buf8(h),b=0,y=0;b<h;y++)g=d.charCodeAt(y),(g&64512)===55296&&y+1<_&&(x=d.charCodeAt(y+1),(x&64512)===56320&&(g=65536+(g-55296<<10)+(x-56320),y++)),g<128?u[b++]=g:g<2048?(u[b++]=192|g>>>6,u[b++]=128|g&63):g<65536?(u[b++]=224|g>>>12,u[b++]=128|g>>>6&63,u[b++]=128|g&63):(u[b++]=240|g>>>18,u[b++]=128|g>>>12&63,u[b++]=128|g>>>6&63,u[b++]=128|g&63);return u};function l(d,u){if(u<65534&&(d.subarray&&s||!d.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(d,u));for(var g="",x=0;x<u;x++)g+=String.fromCharCode(d[x]);return g}e.buf2binstring=function(d){return l(d,d.length)},e.binstring2buf=function(d){for(var u=new n.Buf8(d.length),g=0,x=u.length;g<x;g++)u[g]=d.charCodeAt(g);return u},e.buf2string=function(d,u){var g,x,y,b,_=u||d.length,h=new Array(_*2);for(x=0,g=0;g<_;){if(y=d[g++],y<128){h[x++]=y;continue}if(b=o[y],b>4){h[x++]=65533,g+=b-1;continue}for(y&=b===2?31:b===3?15:7;b>1&&g<_;)y=y<<6|d[g++]&63,b--;if(b>1){h[x++]=65533;continue}y<65536?h[x++]=y:(y-=65536,h[x++]=55296|y>>10&1023,h[x++]=56320|y&1023)}return l(h,x)},e.utf8border=function(d,u){var g;for(u=u||d.length,u>d.length&&(u=d.length),g=u-1;g>=0&&(d[g]&192)===128;)g--;return g<0||g===0?u:g+o[d[g]]>u?g:u}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js":(r=>{function e(t,n,i,s){for(var o=t&65535|0,a=t>>>16&65535|0,l=0;i!==0;){l=i>2e3?2e3:i,i-=l;do o=o+n[s++]|0,a=a+o|0;while(--l);o%=65521,a%=65521}return o|a<<16|0}r.exports=e}),"./node_modules/upng-js/node_modules/pako/lib/zlib/constants.js":(r=>{r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js":(r=>{function e(){for(var i,s=[],o=0;o<256;o++){i=o;for(var a=0;a<8;a++)i=i&1?3988292384^i>>>1:i>>>1;s[o]=i}return s}var t=e();function n(i,s,o,a){var l=t,d=a+o;i^=-1;for(var u=a;u<d;u++)i=i>>>8^l[(i^s[u])&255];return i^-1}r.exports=n}),"./node_modules/upng-js/node_modules/pako/lib/zlib/deflate.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=t("./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),a=t("./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js"),l=0,d=1,u=3,g=4,x=5,y=0,b=1,_=-2,h=-3,f=-5,E=-1,m=1,S=2,w=3,v=4,A=0,M=2,T=8,R=9,P=15,L=8,O=29,I=256,N=I+1+O,k=30,U=19,F=2*N+1,j=15,H=3,B=258,V=B+H+1,K=32,q=42,Te=69,Fe=73,We=91,J=103,et=113,ht=666,er=1,tr=2,Hm=3,oi=4,h0=3;function l0(W,t0){return W.msg=a[t0],t0}function M0(W){return(W<<1)-(W>4?9:0)}function U0(W){for(var t0=W.length;--t0>=0;)W[t0]=0}function _0(W){var t0=W.state,o0=t0.pending;o0>W.avail_out&&(o0=W.avail_out),o0!==0&&(n.arraySet(W.output,t0.pending_buf,t0.pending_out,o0,W.next_out),W.next_out+=o0,t0.pending_out+=o0,W.total_out+=o0,W.avail_out-=o0,t0.pending-=o0,t0.pending===0&&(t0.pending_out=0))}function C0(W,t0){i._tr_flush_block(W,W.block_start>=0?W.block_start:-1,W.strstart-W.block_start,t0),W.block_start=W.strstart,_0(W.strm)}function P0(W,t0){W.pending_buf[W.pending++]=t0}function R0(W,t0){W.pending_buf[W.pending++]=t0>>>8&255,W.pending_buf[W.pending++]=t0&255}function si(W,t0,o0,Ji){var m0=W.avail_in;return m0>Ji&&(m0=Ji),m0===0?0:(W.avail_in-=m0,n.arraySet(t0,W.input,W.next_in,m0,o0),W.state.wrap===1?W.adler=s(W.adler,t0,m0,o0):W.state.wrap===2&&(W.adler=o(W.adler,t0,m0,o0)),W.next_in+=m0,W.total_in+=m0,m0)}function Xe(W,t0){var o0=W.max_chain_length,Ji=W.strstart,m0,I0,Z=W.prev_length,at=W.nice_match,lt=W.strstart>W.w_size-V?W.strstart-(W.w_size-V):0,n0=W.window,r0=W.w_mask,f0=W.prev,v0=W.strstart+B,A0=n0[Ji+Z-1],X0=n0[Ji+Z];W.prev_length>=W.good_match&&(o0>>=2),at>W.lookahead&&(at=W.lookahead);do if(m0=t0,!(n0[m0+Z]!==X0||n0[m0+Z-1]!==A0||n0[m0]!==n0[Ji]||n0[++m0]!==n0[Ji+1])){Ji+=2,m0++;do;while(n0[++Ji]===n0[++m0]&&n0[++Ji]===n0[++m0]&&n0[++Ji]===n0[++m0]&&n0[++Ji]===n0[++m0]&&n0[++Ji]===n0[++m0]&&n0[++Ji]===n0[++m0]&&n0[++Ji]===n0[++m0]&&n0[++Ji]===n0[++m0]&&Ji<v0);if(I0=B-(v0-Ji),Ji=v0-B,I0>Z){if(W.match_start=t0,Z=I0,I0>=at)break;A0=n0[Ji+Z-1],X0=n0[Ji+Z]}}while((t0=f0[t0&r0])>lt&&--o0!==0);return Z<=W.lookahead?Z:W.lookahead}function d0(W){var t0=W.w_size,o0,Ji,m0,I0,Z;do{if(I0=W.window_size-W.lookahead-W.strstart,W.strstart>=t0+(t0-V)){n.arraySet(W.window,W.window,t0,t0,0),W.match_start-=t0,W.strstart-=t0,W.block_start-=t0,Ji=W.hash_size,o0=Ji;do m0=W.head[--o0],W.head[o0]=m0>=t0?m0-t0:0;while(--Ji);Ji=t0,o0=Ji;do m0=W.prev[--o0],W.prev[o0]=m0>=t0?m0-t0:0;while(--Ji);I0+=t0}if(W.strm.avail_in===0)break;if(Ji=si(W.strm,W.window,W.strstart+W.lookahead,I0),W.lookahead+=Ji,W.lookahead+W.insert>=H)for(Z=W.strstart-W.insert,W.ins_h=W.window[Z],W.ins_h=(W.ins_h<<W.hash_shift^W.window[Z+1])&W.hash_mask;W.insert&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[Z+H-1])&W.hash_mask,W.prev[Z&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=Z,Z++,W.insert--,!(W.lookahead+W.insert<H)););}while(W.lookahead<V&&W.strm.avail_in!==0)}function w0(W,t0){var o0=65535;for(o0>W.pending_buf_size-5&&(o0=W.pending_buf_size-5);;){if(W.lookahead<=1){if(d0(W),W.lookahead===0&&t0===l)return er;if(W.lookahead===0)break}W.strstart+=W.lookahead,W.lookahead=0;var Ji=W.block_start+o0;if((W.strstart===0||W.strstart>=Ji)&&(W.lookahead=W.strstart-Ji,W.strstart=Ji,C0(W,!1),W.strm.avail_out===0)||W.strstart-W.block_start>=W.w_size-V&&(C0(W,!1),W.strm.avail_out===0))return er}return W.insert=0,t0===g?(C0(W,!0),W.strm.avail_out===0?Hm:oi):(W.strstart>W.block_start&&(C0(W,!1),W.strm.avail_out===0),er)}function Q(W,t0){for(var o0,Ji;;){if(W.lookahead<V){if(d0(W),W.lookahead<V&&t0===l)return er;if(W.lookahead===0)break}if(o0=0,W.lookahead>=H&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+H-1])&W.hash_mask,o0=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),o0!==0&&W.strstart-o0<=W.w_size-V&&(W.match_length=Xe(W,o0)),W.match_length>=H)if(Ji=i._tr_tally(W,W.strstart-W.match_start,W.match_length-H),W.lookahead-=W.match_length,W.match_length<=W.max_lazy_match&&W.lookahead>=H){W.match_length--;do W.strstart++,W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+H-1])&W.hash_mask,o0=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart;while(--W.match_length!==0);W.strstart++}else W.strstart+=W.match_length,W.match_length=0,W.ins_h=W.window[W.strstart],W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+1])&W.hash_mask;else Ji=i._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++;if(Ji&&(C0(W,!1),W.strm.avail_out===0))return er}return W.insert=W.strstart<H-1?W.strstart:H-1,t0===g?(C0(W,!0),W.strm.avail_out===0?Hm:oi):W.last_lit&&(C0(W,!1),W.strm.avail_out===0)?er:tr}function it(W,t0){for(var o0,Ji,m0;;){if(W.lookahead<V){if(d0(W),W.lookahead<V&&t0===l)return er;if(W.lookahead===0)break}if(o0=0,W.lookahead>=H&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+H-1])&W.hash_mask,o0=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart),W.prev_length=W.match_length,W.prev_match=W.match_start,W.match_length=H-1,o0!==0&&W.prev_length<W.max_lazy_match&&W.strstart-o0<=W.w_size-V&&(W.match_length=Xe(W,o0),W.match_length<=5&&(W.strategy===m||W.match_length===H&&W.strstart-W.match_start>4096)&&(W.match_length=H-1)),W.prev_length>=H&&W.match_length<=W.prev_length){m0=W.strstart+W.lookahead-H,Ji=i._tr_tally(W,W.strstart-1-W.prev_match,W.prev_length-H),W.lookahead-=W.prev_length-1,W.prev_length-=2;do++W.strstart<=m0&&(W.ins_h=(W.ins_h<<W.hash_shift^W.window[W.strstart+H-1])&W.hash_mask,o0=W.prev[W.strstart&W.w_mask]=W.head[W.ins_h],W.head[W.ins_h]=W.strstart);while(--W.prev_length!==0);if(W.match_available=0,W.match_length=H-1,W.strstart++,Ji&&(C0(W,!1),W.strm.avail_out===0))return er}else if(W.match_available){if(Ji=i._tr_tally(W,0,W.window[W.strstart-1]),Ji&&C0(W,!1),W.strstart++,W.lookahead--,W.strm.avail_out===0)return er}else W.match_available=1,W.strstart++,W.lookahead--}return W.match_available&&(Ji=i._tr_tally(W,0,W.window[W.strstart-1]),W.match_available=0),W.insert=W.strstart<H-1?W.strstart:H-1,t0===g?(C0(W,!0),W.strm.avail_out===0?Hm:oi):W.last_lit&&(C0(W,!1),W.strm.avail_out===0)?er:tr}function ec(W,t0){for(var o0,Ji,m0,I0,Z=W.window;;){if(W.lookahead<=B){if(d0(W),W.lookahead<=B&&t0===l)return er;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=H&&W.strstart>0&&(m0=W.strstart-1,Ji=Z[m0],Ji===Z[++m0]&&Ji===Z[++m0]&&Ji===Z[++m0])){I0=W.strstart+B;do;while(Ji===Z[++m0]&&Ji===Z[++m0]&&Ji===Z[++m0]&&Ji===Z[++m0]&&Ji===Z[++m0]&&Ji===Z[++m0]&&Ji===Z[++m0]&&Ji===Z[++m0]&&m0<I0);W.match_length=B-(I0-m0),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=H?(o0=i._tr_tally(W,1,W.match_length-H),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(o0=i._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),o0&&(C0(W,!1),W.strm.avail_out===0))return er}return W.insert=0,t0===g?(C0(W,!0),W.strm.avail_out===0?Hm:oi):W.last_lit&&(C0(W,!1),W.strm.avail_out===0)?er:tr}function a0(W,t0){for(var o0;;){if(W.lookahead===0&&(d0(W),W.lookahead===0)){if(t0===l)return er;break}if(W.match_length=0,o0=i._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,o0&&(C0(W,!1),W.strm.avail_out===0))return er}return W.insert=0,t0===g?(C0(W,!0),W.strm.avail_out===0?Hm:oi):W.last_lit&&(C0(W,!1),W.strm.avail_out===0)?er:tr}function u0(W,t0,o0,Ji,m0){this.good_length=W,this.max_lazy=t0,this.nice_length=o0,this.max_chain=Ji,this.func=m0}var E0;E0=[new u0(0,0,0,0,w0),new u0(4,4,8,4,Q),new u0(4,5,16,8,Q),new u0(4,6,32,32,Q),new u0(4,4,16,16,it),new u0(8,16,32,32,it),new u0(8,16,128,128,it),new u0(8,32,128,256,it),new u0(32,128,258,1024,it),new u0(32,258,258,4096,it)];function O0(W){W.window_size=2*W.w_size,U0(W.head),W.max_lazy_match=E0[W.level].max_lazy,W.good_match=E0[W.level].good_length,W.nice_match=E0[W.level].nice_length,W.max_chain_length=E0[W.level].max_chain,W.strstart=0,W.block_start=0,W.lookahead=0,W.insert=0,W.match_length=W.prev_length=H-1,W.match_available=0,W.ins_h=0}function He(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new n.Buf16(F*2),this.dyn_dtree=new n.Buf16((2*k+1)*2),this.bl_tree=new n.Buf16((2*U+1)*2),U0(this.dyn_ltree),U0(this.dyn_dtree),U0(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new n.Buf16(j+1),this.heap=new n.Buf16(2*N+1),U0(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new n.Buf16(2*N+1),U0(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function p0(W){var t0;return!W||!W.state?l0(W,_):(W.total_in=W.total_out=0,W.data_type=M,t0=W.state,t0.pending=0,t0.pending_out=0,t0.wrap<0&&(t0.wrap=-t0.wrap),t0.status=t0.wrap?q:et,W.adler=t0.wrap===2?0:1,t0.last_flush=l,i._tr_init(t0),y)}function x0(W){var t0=p0(W);return t0===y&&O0(W.state),t0}function L0(W,t0){return!W||!W.state||W.state.wrap!==2?_:(W.state.gzhead=t0,y)}function c0(W,t0,o0,Ji,m0,I0){if(!W)return _;var Z=1;if(t0===E&&(t0=6),Ji<0?(Z=0,Ji=-Ji):Ji>15&&(Z=2,Ji-=16),m0<1||m0>R||o0!==T||Ji<8||Ji>15||t0<0||t0>9||I0<0||I0>v)return l0(W,_);Ji===8&&(Ji=9);var at=new He;return W.state=at,at.strm=W,at.wrap=Z,at.gzhead=null,at.w_bits=Ji,at.w_size=1<<at.w_bits,at.w_mask=at.w_size-1,at.hash_bits=m0+7,at.hash_size=1<<at.hash_bits,at.hash_mask=at.hash_size-1,at.hash_shift=~~((at.hash_bits+H-1)/H),at.window=new n.Buf8(at.w_size*2),at.head=new n.Buf16(at.hash_size),at.prev=new n.Buf16(at.w_size),at.lit_bufsize=1<<m0+6,at.pending_buf_size=at.lit_bufsize*4,at.pending_buf=new n.Buf8(at.pending_buf_size),at.d_buf=1*at.lit_bufsize,at.l_buf=3*at.lit_bufsize,at.level=t0,at.strategy=I0,at.method=o0,x0(W)}function b0(W,t0){return c0(W,t0,T,P,L,A)}function ut(W,t0){var o0,Ji,m0,I0;if(!W||!W.state||t0>x||t0<0)return W?l0(W,_):_;if(Ji=W.state,!W.output||!W.input&&W.avail_in!==0||Ji.status===ht&&t0!==g)return l0(W,W.avail_out===0?f:_);if(Ji.strm=W,o0=Ji.last_flush,Ji.last_flush=t0,Ji.status===q)if(Ji.wrap===2)W.adler=0,P0(Ji,31),P0(Ji,139),P0(Ji,8),Ji.gzhead?(P0(Ji,(Ji.gzhead.text?1:0)+(Ji.gzhead.hcrc?2:0)+(Ji.gzhead.extra?4:0)+(Ji.gzhead.name?8:0)+(Ji.gzhead.comment?16:0)),P0(Ji,Ji.gzhead.time&255),P0(Ji,Ji.gzhead.time>>8&255),P0(Ji,Ji.gzhead.time>>16&255),P0(Ji,Ji.gzhead.time>>24&255),P0(Ji,Ji.level===9?2:Ji.strategy>=S||Ji.level<2?4:0),P0(Ji,Ji.gzhead.os&255),Ji.gzhead.extra&&Ji.gzhead.extra.length&&(P0(Ji,Ji.gzhead.extra.length&255),P0(Ji,Ji.gzhead.extra.length>>8&255)),Ji.gzhead.hcrc&&(W.adler=o(W.adler,Ji.pending_buf,Ji.pending,0)),Ji.gzindex=0,Ji.status=Te):(P0(Ji,0),P0(Ji,0),P0(Ji,0),P0(Ji,0),P0(Ji,0),P0(Ji,Ji.level===9?2:Ji.strategy>=S||Ji.level<2?4:0),P0(Ji,h0),Ji.status=et);else{var Z=T+(Ji.w_bits-8<<4)<<8,at=-1;Ji.strategy>=S||Ji.level<2?at=0:Ji.level<6?at=1:Ji.level===6?at=2:at=3,Z|=at<<6,Ji.strstart!==0&&(Z|=K),Z+=31-Z%31,Ji.status=et,R0(Ji,Z),Ji.strstart!==0&&(R0(Ji,W.adler>>>16),R0(Ji,W.adler&65535)),W.adler=1}if(Ji.status===Te)if(Ji.gzhead.extra){for(m0=Ji.pending;Ji.gzindex<(Ji.gzhead.extra.length&65535)&&!(Ji.pending===Ji.pending_buf_size&&(Ji.gzhead.hcrc&&Ji.pending>m0&&(W.adler=o(W.adler,Ji.pending_buf,Ji.pending-m0,m0)),_0(W),m0=Ji.pending,Ji.pending===Ji.pending_buf_size));)P0(Ji,Ji.gzhead.extra[Ji.gzindex]&255),Ji.gzindex++;Ji.gzhead.hcrc&&Ji.pending>m0&&(W.adler=o(W.adler,Ji.pending_buf,Ji.pending-m0,m0)),Ji.gzindex===Ji.gzhead.extra.length&&(Ji.gzindex=0,Ji.status=Fe)}else Ji.status=Fe;if(Ji.status===Fe)if(Ji.gzhead.name){m0=Ji.pending;do{if(Ji.pending===Ji.pending_buf_size&&(Ji.gzhead.hcrc&&Ji.pending>m0&&(W.adler=o(W.adler,Ji.pending_buf,Ji.pending-m0,m0)),_0(W),m0=Ji.pending,Ji.pending===Ji.pending_buf_size)){I0=1;break}Ji.gzindex<Ji.gzhead.name.length?I0=Ji.gzhead.name.charCodeAt(Ji.gzindex++)&255:I0=0,P0(Ji,I0)}while(I0!==0);Ji.gzhead.hcrc&&Ji.pending>m0&&(W.adler=o(W.adler,Ji.pending_buf,Ji.pending-m0,m0)),I0===0&&(Ji.gzindex=0,Ji.status=We)}else Ji.status=We;if(Ji.status===We)if(Ji.gzhead.comment){m0=Ji.pending;do{if(Ji.pending===Ji.pending_buf_size&&(Ji.gzhead.hcrc&&Ji.pending>m0&&(W.adler=o(W.adler,Ji.pending_buf,Ji.pending-m0,m0)),_0(W),m0=Ji.pending,Ji.pending===Ji.pending_buf_size)){I0=1;break}Ji.gzindex<Ji.gzhead.comment.length?I0=Ji.gzhead.comment.charCodeAt(Ji.gzindex++)&255:I0=0,P0(Ji,I0)}while(I0!==0);Ji.gzhead.hcrc&&Ji.pending>m0&&(W.adler=o(W.adler,Ji.pending_buf,Ji.pending-m0,m0)),I0===0&&(Ji.status=J)}else Ji.status=J;if(Ji.status===J&&(Ji.gzhead.hcrc?(Ji.pending+2>Ji.pending_buf_size&&_0(W),Ji.pending+2<=Ji.pending_buf_size&&(P0(Ji,W.adler&255),P0(Ji,W.adler>>8&255),W.adler=0,Ji.status=et)):Ji.status=et),Ji.pending!==0){if(_0(W),W.avail_out===0)return Ji.last_flush=-1,y}else if(W.avail_in===0&&M0(t0)<=M0(o0)&&t0!==g)return l0(W,f);if(Ji.status===ht&&W.avail_in!==0)return l0(W,f);if(W.avail_in!==0||Ji.lookahead!==0||t0!==l&&Ji.status!==ht){var lt=Ji.strategy===S?a0(Ji,t0):Ji.strategy===w?ec(Ji,t0):E0[Ji.level].func(Ji,t0);if((lt===Hm||lt===oi)&&(Ji.status=ht),lt===er||lt===Hm)return W.avail_out===0&&(Ji.last_flush=-1),y;if(lt===tr&&(t0===d?i._tr_align(Ji):t0!==x&&(i._tr_stored_block(Ji,0,0,!1),t0===u&&(U0(Ji.head),Ji.lookahead===0&&(Ji.strstart=0,Ji.block_start=0,Ji.insert=0))),_0(W),W.avail_out===0))return Ji.last_flush=-1,y}return t0!==g?y:Ji.wrap<=0?b:(Ji.wrap===2?(P0(Ji,W.adler&255),P0(Ji,W.adler>>8&255),P0(Ji,W.adler>>16&255),P0(Ji,W.adler>>24&255),P0(Ji,W.total_in&255),P0(Ji,W.total_in>>8&255),P0(Ji,W.total_in>>16&255),P0(Ji,W.total_in>>24&255)):(R0(Ji,W.adler>>>16),R0(Ji,W.adler&65535)),_0(W),Ji.wrap>0&&(Ji.wrap=-Ji.wrap),Ji.pending!==0?y:b)}function hi(W){var t0;return!W||!W.state?_:(t0=W.state.status,t0!==q&&t0!==Te&&t0!==Fe&&t0!==We&&t0!==J&&t0!==et&&t0!==ht?l0(W,_):(W.state=null,t0===et?l0(W,h):y))}function S0(W,t0){var o0=t0.length,Ji,m0,I0,Z,at,lt,n0,r0;if(!W||!W.state||(Ji=W.state,Z=Ji.wrap,Z===2||Z===1&&Ji.status!==q||Ji.lookahead))return _;for(Z===1&&(W.adler=s(W.adler,t0,o0,0)),Ji.wrap=0,o0>=Ji.w_size&&(Z===0&&(U0(Ji.head),Ji.strstart=0,Ji.block_start=0,Ji.insert=0),r0=new n.Buf8(Ji.w_size),n.arraySet(r0,t0,o0-Ji.w_size,Ji.w_size,0),t0=r0,o0=Ji.w_size),at=W.avail_in,lt=W.next_in,n0=W.input,W.avail_in=o0,W.next_in=0,W.input=t0,d0(Ji);Ji.lookahead>=H;){m0=Ji.strstart,I0=Ji.lookahead-(H-1);do Ji.ins_h=(Ji.ins_h<<Ji.hash_shift^Ji.window[m0+H-1])&Ji.hash_mask,Ji.prev[m0&Ji.w_mask]=Ji.head[Ji.ins_h],Ji.head[Ji.ins_h]=m0,m0++;while(--I0);Ji.strstart=m0,Ji.lookahead=H-1,d0(Ji)}return Ji.strstart+=Ji.lookahead,Ji.block_start=Ji.strstart,Ji.insert=Ji.lookahead,Ji.lookahead=0,Ji.match_length=Ji.prev_length=H-1,Ji.match_available=0,W.next_in=lt,W.input=n0,W.avail_in=at,Ji.wrap=Z,y}e.deflateInit=b0,e.deflateInit2=c0,e.deflateReset=x0,e.deflateResetKeep=p0,e.deflateSetHeader=L0,e.deflate=ut,e.deflateEnd=hi,e.deflateSetDictionary=S0,e.deflateInfo="pako deflate (from Nodeca project)"}),"./node_modules/upng-js/node_modules/pako/lib/zlib/gzheader.js":(r=>{function e(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}r.exports=e}),"./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js":(r=>{var e=30,t=12;r.exports=function(i,s){var o,a,l,d,u,g,x,y,b,_,h,f,E,m,S,w,v,A,M,T,R,P,L,O,I;o=i.state,a=i.next_in,O=i.input,l=a+(i.avail_in-5),d=i.next_out,I=i.output,u=d-(s-i.avail_out),g=d+(i.avail_out-257),x=o.dmax,y=o.wsize,b=o.whave,_=o.wnext,h=o.window,f=o.hold,E=o.bits,m=o.lencode,S=o.distcode,w=(1<<o.lenbits)-1,v=(1<<o.distbits)-1;e:do{E<15&&(f+=O[a++]<<E,E+=8,f+=O[a++]<<E,E+=8),A=m[f&w];t:for(;;){if(M=A>>>24,f>>>=M,E-=M,M=A>>>16&255,M===0)I[d++]=A&65535;else if(M&16){T=A&65535,M&=15,M&&(E<M&&(f+=O[a++]<<E,E+=8),T+=f&(1<<M)-1,f>>>=M,E-=M),E<15&&(f+=O[a++]<<E,E+=8,f+=O[a++]<<E,E+=8),A=S[f&v];n:for(;;){if(M=A>>>24,f>>>=M,E-=M,M=A>>>16&255,M&16){if(R=A&65535,M&=15,E<M&&(f+=O[a++]<<E,E+=8,E<M&&(f+=O[a++]<<E,E+=8)),R+=f&(1<<M)-1,R>x){i.msg="invalid distance too far back",o.mode=e;break e}if(f>>>=M,E-=M,M=d-u,R>M){if(M=R-M,M>b&&o.sane){i.msg="invalid distance too far back",o.mode=e;break e}if(P=0,L=h,_===0){if(P+=y-M,M<T){T-=M;do I[d++]=h[P++];while(--M);P=d-R,L=I}}else if(_<M){if(P+=y+_-M,M-=_,M<T){T-=M;do I[d++]=h[P++];while(--M);if(P=0,_<T){M=_,T-=M;do I[d++]=h[P++];while(--M);P=d-R,L=I}}}else if(P+=_-M,M<T){T-=M;do I[d++]=h[P++];while(--M);P=d-R,L=I}for(;T>2;)I[d++]=L[P++],I[d++]=L[P++],I[d++]=L[P++],T-=3;T&&(I[d++]=L[P++],T>1&&(I[d++]=L[P++]))}else{P=d-R;do I[d++]=I[P++],I[d++]=I[P++],I[d++]=I[P++],T-=3;while(T>2);T&&(I[d++]=I[P++],T>1&&(I[d++]=I[P++]))}}else if((M&64)===0){A=S[(A&65535)+(f&(1<<M)-1)];continue n}else{i.msg="invalid distance code",o.mode=e;break e}break}}else if((M&64)===0){A=m[(A&65535)+(f&(1<<M)-1)];continue t}else if(M&32){o.mode=t;break e}else{i.msg="invalid literal/length code",o.mode=e;break e}break}}while(a<l&&d<g);T=E>>3,a-=T,E-=T<<3,f&=(1<<E)-1,i.next_in=a,i.next_out=d,i.avail_in=a<l?5+(l-a):5-(a-l),i.avail_out=d<g?257+(g-d):257-(d-g),o.hold=f,o.bits=E}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/inflate.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=t("./node_modules/upng-js/node_modules/pako/lib/zlib/adler32.js"),s=t("./node_modules/upng-js/node_modules/pako/lib/zlib/crc32.js"),o=t("./node_modules/upng-js/node_modules/pako/lib/zlib/inffast.js"),a=t("./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js"),l=0,d=1,u=2,g=4,x=5,y=6,b=0,_=1,h=2,f=-2,E=-3,m=-4,S=-5,w=8,v=1,A=2,M=3,T=4,R=5,P=6,L=7,O=8,I=9,N=10,k=11,U=12,F=13,j=14,H=15,B=16,V=17,K=18,q=19,Te=20,Fe=21,We=22,J=23,et=24,ht=25,er=26,tr=27,Hm=28,oi=29,h0=30,l0=31,M0=32,U0=852,_0=592,C0=15,P0=C0;function R0(c0){return(c0>>>24&255)+(c0>>>8&65280)+((c0&65280)<<8)+((c0&255)<<24)}function si(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Xe(c0){var b0;return!c0||!c0.state?f:(b0=c0.state,c0.total_in=c0.total_out=b0.total=0,c0.msg="",b0.wrap&&(c0.adler=b0.wrap&1),b0.mode=v,b0.last=0,b0.havedict=0,b0.dmax=32768,b0.head=null,b0.hold=0,b0.bits=0,b0.lencode=b0.lendyn=new n.Buf32(U0),b0.distcode=b0.distdyn=new n.Buf32(_0),b0.sane=1,b0.back=-1,b)}function d0(c0){var b0;return!c0||!c0.state?f:(b0=c0.state,b0.wsize=0,b0.whave=0,b0.wnext=0,Xe(c0))}function w0(c0,b0){var ut,hi;return!c0||!c0.state||(hi=c0.state,b0<0?(ut=0,b0=-b0):(ut=(b0>>4)+1,b0<48&&(b0&=15)),b0&&(b0<8||b0>15))?f:(hi.window!==null&&hi.wbits!==b0&&(hi.window=null),hi.wrap=ut,hi.wbits=b0,d0(c0))}function Q(c0,b0){var ut,hi;return c0?(hi=new si,c0.state=hi,hi.window=null,ut=w0(c0,b0),ut!==b&&(c0.state=null),ut):f}function it(c0){return Q(c0,P0)}var ec=!0,a0,u0;function E0(c0){if(ec){var b0;for(a0=new n.Buf32(512),u0=new n.Buf32(32),b0=0;b0<144;)c0.lens[b0++]=8;for(;b0<256;)c0.lens[b0++]=9;for(;b0<280;)c0.lens[b0++]=7;for(;b0<288;)c0.lens[b0++]=8;for(a(d,c0.lens,0,288,a0,0,c0.work,{bits:9}),b0=0;b0<32;)c0.lens[b0++]=5;a(u,c0.lens,0,32,u0,0,c0.work,{bits:5}),ec=!1}c0.lencode=a0,c0.lenbits=9,c0.distcode=u0,c0.distbits=5}function O0(c0,b0,ut,hi){var S0,W=c0.state;return W.window===null&&(W.wsize=1<<W.wbits,W.wnext=0,W.whave=0,W.window=new n.Buf8(W.wsize)),hi>=W.wsize?(n.arraySet(W.window,b0,ut-W.wsize,W.wsize,0),W.wnext=0,W.whave=W.wsize):(S0=W.wsize-W.wnext,S0>hi&&(S0=hi),n.arraySet(W.window,b0,ut-hi,S0,W.wnext),hi-=S0,hi?(n.arraySet(W.window,b0,ut-hi,hi,0),W.wnext=hi,W.whave=W.wsize):(W.wnext+=S0,W.wnext===W.wsize&&(W.wnext=0),W.whave<W.wsize&&(W.whave+=S0))),0}function He(c0,b0){var ut,hi,S0,W,t0,o0,Ji,m0,I0,Z,at,lt,n0,r0,f0=0,v0,A0,X0,q0,i1,u1,e1,Q0,e0=new n.Buf8(4),T0,F0,N0=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!c0||!c0.state||!c0.output||!c0.input&&c0.avail_in!==0)return f;ut=c0.state,ut.mode===U&&(ut.mode=F),t0=c0.next_out,S0=c0.output,Ji=c0.avail_out,W=c0.next_in,hi=c0.input,o0=c0.avail_in,m0=ut.hold,I0=ut.bits,Z=o0,at=Ji,Q0=b;e:for(;;)switch(ut.mode){case v:if(ut.wrap===0){ut.mode=F;break}for(;I0<16;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if(ut.wrap&2&&m0===35615){ut.check=0,e0[0]=m0&255,e0[1]=m0>>>8&255,ut.check=s(ut.check,e0,2,0),m0=0,I0=0,ut.mode=A;break}if(ut.flags=0,ut.head&&(ut.head.done=!1),!(ut.wrap&1)||(((m0&255)<<8)+(m0>>8))%31){c0.msg="incorrect header check",ut.mode=h0;break}if((m0&15)!==w){c0.msg="unknown compression method",ut.mode=h0;break}if(m0>>>=4,I0-=4,e1=(m0&15)+8,ut.wbits===0)ut.wbits=e1;else if(e1>ut.wbits){c0.msg="invalid window size",ut.mode=h0;break}ut.dmax=1<<e1,c0.adler=ut.check=1,ut.mode=m0&512?N:U,m0=0,I0=0;break;case A:for(;I0<16;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if(ut.flags=m0,(ut.flags&255)!==w){c0.msg="unknown compression method",ut.mode=h0;break}if(ut.flags&57344){c0.msg="unknown header flags set",ut.mode=h0;break}ut.head&&(ut.head.text=m0>>8&1),ut.flags&512&&(e0[0]=m0&255,e0[1]=m0>>>8&255,ut.check=s(ut.check,e0,2,0)),m0=0,I0=0,ut.mode=M;case M:for(;I0<32;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}ut.head&&(ut.head.time=m0),ut.flags&512&&(e0[0]=m0&255,e0[1]=m0>>>8&255,e0[2]=m0>>>16&255,e0[3]=m0>>>24&255,ut.check=s(ut.check,e0,4,0)),m0=0,I0=0,ut.mode=T;case T:for(;I0<16;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}ut.head&&(ut.head.xflags=m0&255,ut.head.os=m0>>8),ut.flags&512&&(e0[0]=m0&255,e0[1]=m0>>>8&255,ut.check=s(ut.check,e0,2,0)),m0=0,I0=0,ut.mode=R;case R:if(ut.flags&1024){for(;I0<16;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}ut.length=m0,ut.head&&(ut.head.extra_len=m0),ut.flags&512&&(e0[0]=m0&255,e0[1]=m0>>>8&255,ut.check=s(ut.check,e0,2,0)),m0=0,I0=0}else ut.head&&(ut.head.extra=null);ut.mode=P;case P:if(ut.flags&1024&&(lt=ut.length,lt>o0&&(lt=o0),lt&&(ut.head&&(e1=ut.head.extra_len-ut.length,ut.head.extra||(ut.head.extra=new Array(ut.head.extra_len)),n.arraySet(ut.head.extra,hi,W,lt,e1)),ut.flags&512&&(ut.check=s(ut.check,hi,lt,W)),o0-=lt,W+=lt,ut.length-=lt),ut.length))break e;ut.length=0,ut.mode=L;case L:if(ut.flags&2048){if(o0===0)break e;lt=0;do e1=hi[W+lt++],ut.head&&e1&&ut.length<65536&&(ut.head.name+=String.fromCharCode(e1));while(e1&&lt<o0);if(ut.flags&512&&(ut.check=s(ut.check,hi,lt,W)),o0-=lt,W+=lt,e1)break e}else ut.head&&(ut.head.name=null);ut.length=0,ut.mode=O;case O:if(ut.flags&4096){if(o0===0)break e;lt=0;do e1=hi[W+lt++],ut.head&&e1&&ut.length<65536&&(ut.head.comment+=String.fromCharCode(e1));while(e1&&lt<o0);if(ut.flags&512&&(ut.check=s(ut.check,hi,lt,W)),o0-=lt,W+=lt,e1)break e}else ut.head&&(ut.head.comment=null);ut.mode=I;case I:if(ut.flags&512){for(;I0<16;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if(m0!==(ut.check&65535)){c0.msg="header crc mismatch",ut.mode=h0;break}m0=0,I0=0}ut.head&&(ut.head.hcrc=ut.flags>>9&1,ut.head.done=!0),c0.adler=ut.check=0,ut.mode=U;break;case N:for(;I0<32;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}c0.adler=ut.check=R0(m0),m0=0,I0=0,ut.mode=k;case k:if(ut.havedict===0)return c0.next_out=t0,c0.avail_out=Ji,c0.next_in=W,c0.avail_in=o0,ut.hold=m0,ut.bits=I0,h;c0.adler=ut.check=1,ut.mode=U;case U:if(b0===x||b0===y)break e;case F:if(ut.last){m0>>>=I0&7,I0-=I0&7,ut.mode=tr;break}for(;I0<3;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}switch(ut.last=m0&1,m0>>>=1,I0-=1,m0&3){case 0:ut.mode=j;break;case 1:if(E0(ut),ut.mode=Te,b0===y){m0>>>=2,I0-=2;break e}break;case 2:ut.mode=V;break;case 3:c0.msg="invalid block type",ut.mode=h0}m0>>>=2,I0-=2;break;case j:for(m0>>>=I0&7,I0-=I0&7;I0<32;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if((m0&65535)!==(m0>>>16^65535)){c0.msg="invalid stored block lengths",ut.mode=h0;break}if(ut.length=m0&65535,m0=0,I0=0,ut.mode=H,b0===y)break e;case H:ut.mode=B;case B:if(lt=ut.length,lt){if(lt>o0&&(lt=o0),lt>Ji&&(lt=Ji),lt===0)break e;n.arraySet(S0,hi,W,lt,t0),o0-=lt,W+=lt,Ji-=lt,t0+=lt,ut.length-=lt;break}ut.mode=U;break;case V:for(;I0<14;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if(ut.nlen=(m0&31)+257,m0>>>=5,I0-=5,ut.ndist=(m0&31)+1,m0>>>=5,I0-=5,ut.ncode=(m0&15)+4,m0>>>=4,I0-=4,ut.nlen>286||ut.ndist>30){c0.msg="too many length or distance symbols",ut.mode=h0;break}ut.have=0,ut.mode=K;case K:for(;ut.have<ut.ncode;){for(;I0<3;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}ut.lens[N0[ut.have++]]=m0&7,m0>>>=3,I0-=3}for(;ut.have<19;)ut.lens[N0[ut.have++]]=0;if(ut.lencode=ut.lendyn,ut.lenbits=7,T0={bits:ut.lenbits},Q0=a(l,ut.lens,0,19,ut.lencode,0,ut.work,T0),ut.lenbits=T0.bits,Q0){c0.msg="invalid code lengths set",ut.mode=h0;break}ut.have=0,ut.mode=q;case q:for(;ut.have<ut.nlen+ut.ndist;){for(;f0=ut.lencode[m0&(1<<ut.lenbits)-1],v0=f0>>>24,A0=f0>>>16&255,X0=f0&65535,!(v0<=I0);){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if(X0<16)m0>>>=v0,I0-=v0,ut.lens[ut.have++]=X0;else{if(X0===16){for(F0=v0+2;I0<F0;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if(m0>>>=v0,I0-=v0,ut.have===0){c0.msg="invalid bit length repeat",ut.mode=h0;break}e1=ut.lens[ut.have-1],lt=3+(m0&3),m0>>>=2,I0-=2}else if(X0===17){for(F0=v0+3;I0<F0;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}m0>>>=v0,I0-=v0,e1=0,lt=3+(m0&7),m0>>>=3,I0-=3}else{for(F0=v0+7;I0<F0;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}m0>>>=v0,I0-=v0,e1=0,lt=11+(m0&127),m0>>>=7,I0-=7}if(ut.have+lt>ut.nlen+ut.ndist){c0.msg="invalid bit length repeat",ut.mode=h0;break}for(;lt--;)ut.lens[ut.have++]=e1}}if(ut.mode===h0)break;if(ut.lens[256]===0){c0.msg="invalid code -- missing end-of-block",ut.mode=h0;break}if(ut.lenbits=9,T0={bits:ut.lenbits},Q0=a(d,ut.lens,0,ut.nlen,ut.lencode,0,ut.work,T0),ut.lenbits=T0.bits,Q0){c0.msg="invalid literal/lengths set",ut.mode=h0;break}if(ut.distbits=6,ut.distcode=ut.distdyn,T0={bits:ut.distbits},Q0=a(u,ut.lens,ut.nlen,ut.ndist,ut.distcode,0,ut.work,T0),ut.distbits=T0.bits,Q0){c0.msg="invalid distances set",ut.mode=h0;break}if(ut.mode=Te,b0===y)break e;case Te:ut.mode=Fe;case Fe:if(o0>=6&&Ji>=258){c0.next_out=t0,c0.avail_out=Ji,c0.next_in=W,c0.avail_in=o0,ut.hold=m0,ut.bits=I0,o(c0,at),t0=c0.next_out,S0=c0.output,Ji=c0.avail_out,W=c0.next_in,hi=c0.input,o0=c0.avail_in,m0=ut.hold,I0=ut.bits,ut.mode===U&&(ut.back=-1);break}for(ut.back=0;f0=ut.lencode[m0&(1<<ut.lenbits)-1],v0=f0>>>24,A0=f0>>>16&255,X0=f0&65535,!(v0<=I0);){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if(A0&&(A0&240)===0){for(q0=v0,i1=A0,u1=X0;f0=ut.lencode[u1+((m0&(1<<q0+i1)-1)>>q0)],v0=f0>>>24,A0=f0>>>16&255,X0=f0&65535,!(q0+v0<=I0);){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}m0>>>=q0,I0-=q0,ut.back+=q0}if(m0>>>=v0,I0-=v0,ut.back+=v0,ut.length=X0,A0===0){ut.mode=er;break}if(A0&32){ut.back=-1,ut.mode=U;break}if(A0&64){c0.msg="invalid literal/length code",ut.mode=h0;break}ut.extra=A0&15,ut.mode=We;case We:if(ut.extra){for(F0=ut.extra;I0<F0;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}ut.length+=m0&(1<<ut.extra)-1,m0>>>=ut.extra,I0-=ut.extra,ut.back+=ut.extra}ut.was=ut.length,ut.mode=J;case J:for(;f0=ut.distcode[m0&(1<<ut.distbits)-1],v0=f0>>>24,A0=f0>>>16&255,X0=f0&65535,!(v0<=I0);){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if((A0&240)===0){for(q0=v0,i1=A0,u1=X0;f0=ut.distcode[u1+((m0&(1<<q0+i1)-1)>>q0)],v0=f0>>>24,A0=f0>>>16&255,X0=f0&65535,!(q0+v0<=I0);){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}m0>>>=q0,I0-=q0,ut.back+=q0}if(m0>>>=v0,I0-=v0,ut.back+=v0,A0&64){c0.msg="invalid distance code",ut.mode=h0;break}ut.offset=X0,ut.extra=A0&15,ut.mode=et;case et:if(ut.extra){for(F0=ut.extra;I0<F0;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}ut.offset+=m0&(1<<ut.extra)-1,m0>>>=ut.extra,I0-=ut.extra,ut.back+=ut.extra}if(ut.offset>ut.dmax){c0.msg="invalid distance too far back",ut.mode=h0;break}ut.mode=ht;case ht:if(Ji===0)break e;if(lt=at-Ji,ut.offset>lt){if(lt=ut.offset-lt,lt>ut.whave&&ut.sane){c0.msg="invalid distance too far back",ut.mode=h0;break}lt>ut.wnext?(lt-=ut.wnext,n0=ut.wsize-lt):n0=ut.wnext-lt,lt>ut.length&&(lt=ut.length),r0=ut.window}else r0=S0,n0=t0-ut.offset,lt=ut.length;lt>Ji&&(lt=Ji),Ji-=lt,ut.length-=lt;do S0[t0++]=r0[n0++];while(--lt);ut.length===0&&(ut.mode=Fe);break;case er:if(Ji===0)break e;S0[t0++]=ut.length,Ji--,ut.mode=Fe;break;case tr:if(ut.wrap){for(;I0<32;){if(o0===0)break e;o0--,m0|=hi[W++]<<I0,I0+=8}if(at-=Ji,c0.total_out+=at,ut.total+=at,at&&(c0.adler=ut.check=ut.flags?s(ut.check,S0,at,t0-at):i(ut.check,S0,at,t0-at)),at=Ji,(ut.flags?m0:R0(m0))!==ut.check){c0.msg="incorrect data check",ut.mode=h0;break}m0=0,I0=0}ut.mode=Hm;case Hm:if(ut.wrap&&ut.flags){for(;I0<32;){if(o0===0)break e;o0--,m0+=hi[W++]<<I0,I0+=8}if(m0!==(ut.total&4294967295)){c0.msg="incorrect length check",ut.mode=h0;break}m0=0,I0=0}ut.mode=oi;case oi:Q0=_;break e;case h0:Q0=E;break e;case l0:return m;case M0:default:return f}return c0.next_out=t0,c0.avail_out=Ji,c0.next_in=W,c0.avail_in=o0,ut.hold=m0,ut.bits=I0,(ut.wsize||at!==c0.avail_out&&ut.mode<h0&&(ut.mode<tr||b0!==g))&&O0(c0,c0.output,c0.next_out,at-c0.avail_out),Z-=c0.avail_in,at-=c0.avail_out,c0.total_in+=Z,c0.total_out+=at,ut.total+=at,ut.wrap&&at&&(c0.adler=ut.check=ut.flags?s(ut.check,S0,at,c0.next_out-at):i(ut.check,S0,at,c0.next_out-at)),c0.data_type=ut.bits+(ut.last?64:0)+(ut.mode===U?128:0)+(ut.mode===Te||ut.mode===H?256:0),(Z===0&&at===0||b0===g)&&Q0===b&&(Q0=S),Q0}function p0(c0){if(!c0||!c0.state)return f;var b0=c0.state;return b0.window&&(b0.window=null),c0.state=null,b}function x0(c0,b0){var ut;return!c0||!c0.state||(ut=c0.state,(ut.wrap&2)===0)?f:(ut.head=b0,b0.done=!1,b)}function L0(c0,b0){var ut=b0.length,hi,S0,W;return!c0||!c0.state||(hi=c0.state,hi.wrap!==0&&hi.mode!==k)?f:hi.mode===k&&(S0=1,S0=i(S0,b0,ut,0),S0!==hi.check)?E:(W=O0(c0,b0,ut,ut),W?(hi.mode=l0,m):(hi.havedict=1,b))}e.inflateReset=d0,e.inflateReset2=w0,e.inflateResetKeep=Xe,e.inflateInit=it,e.inflateInit2=Q,e.inflate=He,e.inflateEnd=p0,e.inflateGetHeader=x0,e.inflateSetDictionary=L0,e.inflateInfo="pako inflate (from Nodeca project)"}),"./node_modules/upng-js/node_modules/pako/lib/zlib/inftrees.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=15,s=852,o=592,a=0,l=1,d=2,u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],g=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(_,h,f,E,m,S,w,v){var A=v.bits,M=0,T=0,R=0,P=0,L=0,O=0,I=0,N=0,k=0,U=0,F,j,H,B,V,K=null,q=0,Te,Fe=new n.Buf16(i+1),We=new n.Buf16(i+1),J=null,et=0,ht,er,tr;for(M=0;M<=i;M++)Fe[M]=0;for(T=0;T<E;T++)Fe[h[f+T]]++;for(L=A,P=i;P>=1&&Fe[P]===0;P--);if(L>P&&(L=P),P===0)return m[S++]=20971520,m[S++]=20971520,v.bits=1,0;for(R=1;R<P&&Fe[R]===0;R++);for(L<R&&(L=R),N=1,M=1;M<=i;M++)if(N<<=1,N-=Fe[M],N<0)return-1;if(N>0&&(_===a||P!==1))return-1;for(We[1]=0,M=1;M<i;M++)We[M+1]=We[M]+Fe[M];for(T=0;T<E;T++)h[f+T]!==0&&(w[We[h[f+T]]++]=T);if(_===a?(K=J=w,Te=19):_===l?(K=u,q-=257,J=g,et-=257,Te=256):(K=x,J=y,Te=-1),U=0,T=0,M=R,V=S,O=L,I=0,H=-1,k=1<<L,B=k-1,_===l&&k>s||_===d&&k>o)return 1;for(;;){ht=M-I,w[T]<Te?(er=0,tr=w[T]):w[T]>Te?(er=J[et+w[T]],tr=K[q+w[T]]):(er=96,tr=0),F=1<<M-I,j=1<<O,R=j;do j-=F,m[V+(U>>I)+j]=ht<<24|er<<16|tr|0;while(j!==0);for(F=1<<M-1;U&F;)F>>=1;if(F!==0?(U&=F-1,U+=F):U=0,T++,--Fe[M]===0){if(M===P)break;M=h[f+w[T]]}if(M>L&&(U&B)!==H){for(I===0&&(I=L),V+=R,O=M-I,N=1<<O;O+I<P&&(N-=Fe[O+I],!(N<=0));)O++,N<<=1;if(k+=1<<O,_===l&&k>s||_===d&&k>o)return 1;H=U&B,m[H]=L<<24|O<<16|V-S|0}}return U!==0&&(m[V+U]=M-I<<24|4194304|0),v.bits=L,0}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/messages.js":(r=>{r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}}),"./node_modules/upng-js/node_modules/pako/lib/zlib/trees.js":((r,e,t)=>{var n=t("./node_modules/upng-js/node_modules/pako/lib/utils/common.js"),i=4,s=0,o=1,a=2;function l(He){for(var p0=He.length;--p0>=0;)He[p0]=0}var d=0,u=1,g=2,x=3,y=258,b=29,_=256,h=_+1+b,f=30,E=19,m=2*h+1,S=15,w=16,v=7,A=256,M=16,T=17,R=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N=512,k=new Array((h+2)*2);l(k);var U=new Array(f*2);l(U);var F=new Array(N);l(F);var j=new Array(y-x+1);l(j);var H=new Array(b);l(H);var B=new Array(f);l(B);function V(He,p0,x0,L0,c0){this.static_tree=He,this.extra_bits=p0,this.extra_base=x0,this.elems=L0,this.max_length=c0,this.has_stree=He&&He.length}var K,q,Te;function Fe(He,p0){this.dyn_tree=He,this.max_code=0,this.stat_desc=p0}function We(He){return He<256?F[He]:F[256+(He>>>7)]}function J(He,p0){He.pending_buf[He.pending++]=p0&255,He.pending_buf[He.pending++]=p0>>>8&255}function et(He,p0,x0){He.bi_valid>w-x0?(He.bi_buf|=p0<<He.bi_valid&65535,J(He,He.bi_buf),He.bi_buf=p0>>w-He.bi_valid,He.bi_valid+=x0-w):(He.bi_buf|=p0<<He.bi_valid&65535,He.bi_valid+=x0)}function ht(He,p0,x0){et(He,x0[p0*2],x0[p0*2+1])}function er(He,p0){var x0=0;do x0|=He&1,He>>>=1,x0<<=1;while(--p0>0);return x0>>>1}function tr(He){He.bi_valid===16?(J(He,He.bi_buf),He.bi_buf=0,He.bi_valid=0):He.bi_valid>=8&&(He.pending_buf[He.pending++]=He.bi_buf&255,He.bi_buf>>=8,He.bi_valid-=8)}function Hm(He,p0){var x0=p0.dyn_tree,L0=p0.max_code,c0=p0.stat_desc.static_tree,b0=p0.stat_desc.has_stree,ut=p0.stat_desc.extra_bits,hi=p0.stat_desc.extra_base,S0=p0.stat_desc.max_length,W,t0,o0,Ji,m0,I0,Z=0;for(Ji=0;Ji<=S;Ji++)He.bl_count[Ji]=0;for(x0[He.heap[He.heap_max]*2+1]=0,W=He.heap_max+1;W<m;W++)t0=He.heap[W],Ji=x0[x0[t0*2+1]*2+1]+1,Ji>S0&&(Ji=S0,Z++),x0[t0*2+1]=Ji,!(t0>L0)&&(He.bl_count[Ji]++,m0=0,t0>=hi&&(m0=ut[t0-hi]),I0=x0[t0*2],He.opt_len+=I0*(Ji+m0),b0&&(He.static_len+=I0*(c0[t0*2+1]+m0)));if(Z!==0){do{for(Ji=S0-1;He.bl_count[Ji]===0;)Ji--;He.bl_count[Ji]--,He.bl_count[Ji+1]+=2,He.bl_count[S0]--,Z-=2}while(Z>0);for(Ji=S0;Ji!==0;Ji--)for(t0=He.bl_count[Ji];t0!==0;)o0=He.heap[--W],!(o0>L0)&&(x0[o0*2+1]!==Ji&&(He.opt_len+=(Ji-x0[o0*2+1])*x0[o0*2],x0[o0*2+1]=Ji),t0--)}}function oi(He,p0,x0){var L0=new Array(S+1),c0=0,b0,ut;for(b0=1;b0<=S;b0++)L0[b0]=c0=c0+x0[b0-1]<<1;for(ut=0;ut<=p0;ut++){var hi=He[ut*2+1];hi!==0&&(He[ut*2]=er(L0[hi]++,hi))}}function h0(){var He,p0,x0,L0,c0,b0=new Array(S+1);for(x0=0,L0=0;L0<b-1;L0++)for(H[L0]=x0,He=0;He<1<<P[L0];He++)j[x0++]=L0;for(j[x0-1]=L0,c0=0,L0=0;L0<16;L0++)for(B[L0]=c0,He=0;He<1<<L[L0];He++)F[c0++]=L0;for(c0>>=7;L0<f;L0++)for(B[L0]=c0<<7,He=0;He<1<<L[L0]-7;He++)F[256+c0++]=L0;for(p0=0;p0<=S;p0++)b0[p0]=0;for(He=0;He<=143;)k[He*2+1]=8,He++,b0[8]++;for(;He<=255;)k[He*2+1]=9,He++,b0[9]++;for(;He<=279;)k[He*2+1]=7,He++,b0[7]++;for(;He<=287;)k[He*2+1]=8,He++,b0[8]++;for(oi(k,h+1,b0),He=0;He<f;He++)U[He*2+1]=5,U[He*2]=er(He,5);K=new V(k,P,_+1,h,S),q=new V(U,L,0,f,S),Te=new V(new Array(0),O,0,E,v)}function l0(He){var p0;for(p0=0;p0<h;p0++)He.dyn_ltree[p0*2]=0;for(p0=0;p0<f;p0++)He.dyn_dtree[p0*2]=0;for(p0=0;p0<E;p0++)He.bl_tree[p0*2]=0;He.dyn_ltree[A*2]=1,He.opt_len=He.static_len=0,He.last_lit=He.matches=0}function M0(He){He.bi_valid>8?J(He,He.bi_buf):He.bi_valid>0&&(He.pending_buf[He.pending++]=He.bi_buf),He.bi_buf=0,He.bi_valid=0}function U0(He,p0,x0,L0){M0(He),J(He,x0),J(He,~x0),n.arraySet(He.pending_buf,He.window,p0,x0,He.pending),He.pending+=x0}function _0(He,p0,x0,L0){var c0=p0*2,b0=x0*2;return He[c0]<He[b0]||He[c0]===He[b0]&&L0[p0]<=L0[x0]}function C0(He,p0,x0){for(var L0=He.heap[x0],c0=x0<<1;c0<=He.heap_len&&(c0<He.heap_len&&_0(p0,He.heap[c0+1],He.heap[c0],He.depth)&&c0++,!_0(p0,L0,He.heap[c0],He.depth));)He.heap[x0]=He.heap[c0],x0=c0,c0<<=1;He.heap[x0]=L0}function P0(He,p0,x0){var L0,c0,b0=0,ut,hi;if(He.last_lit!==0)do L0=He.pending_buf[He.d_buf+b0*2]<<8|He.pending_buf[He.d_buf+b0*2+1],c0=He.pending_buf[He.l_buf+b0],b0++,L0===0?ht(He,c0,p0):(ut=j[c0],ht(He,ut+_+1,p0),hi=P[ut],hi!==0&&(c0-=H[ut],et(He,c0,hi)),L0--,ut=We(L0),ht(He,ut,x0),hi=L[ut],hi!==0&&(L0-=B[ut],et(He,L0,hi)));while(b0<He.last_lit);ht(He,A,p0)}function R0(He,p0){var x0=p0.dyn_tree,L0=p0.stat_desc.static_tree,c0=p0.stat_desc.has_stree,b0=p0.stat_desc.elems,ut,hi,S0=-1,W;for(He.heap_len=0,He.heap_max=m,ut=0;ut<b0;ut++)x0[ut*2]!==0?(He.heap[++He.heap_len]=S0=ut,He.depth[ut]=0):x0[ut*2+1]=0;for(;He.heap_len<2;)W=He.heap[++He.heap_len]=S0<2?++S0:0,x0[W*2]=1,He.depth[W]=0,He.opt_len--,c0&&(He.static_len-=L0[W*2+1]);for(p0.max_code=S0,ut=He.heap_len>>1;ut>=1;ut--)C0(He,x0,ut);W=b0;do ut=He.heap[1],He.heap[1]=He.heap[He.heap_len--],C0(He,x0,1),hi=He.heap[1],He.heap[--He.heap_max]=ut,He.heap[--He.heap_max]=hi,x0[W*2]=x0[ut*2]+x0[hi*2],He.depth[W]=(He.depth[ut]>=He.depth[hi]?He.depth[ut]:He.depth[hi])+1,x0[ut*2+1]=x0[hi*2+1]=W,He.heap[1]=W++,C0(He,x0,1);while(He.heap_len>=2);He.heap[--He.heap_max]=He.heap[1],Hm(He,p0),oi(x0,S0,He.bl_count)}function si(He,p0,x0){var L0,c0=-1,b0,ut=p0[1],hi=0,S0=7,W=4;for(ut===0&&(S0=138,W=3),p0[(x0+1)*2+1]=65535,L0=0;L0<=x0;L0++)b0=ut,ut=p0[(L0+1)*2+1],!(++hi<S0&&b0===ut)&&(hi<W?He.bl_tree[b0*2]+=hi:b0!==0?(b0!==c0&&He.bl_tree[b0*2]++,He.bl_tree[M*2]++):hi<=10?He.bl_tree[T*2]++:He.bl_tree[R*2]++,hi=0,c0=b0,ut===0?(S0=138,W=3):b0===ut?(S0=6,W=3):(S0=7,W=4))}function Xe(He,p0,x0){var L0,c0=-1,b0,ut=p0[1],hi=0,S0=7,W=4;for(ut===0&&(S0=138,W=3),L0=0;L0<=x0;L0++)if(b0=ut,ut=p0[(L0+1)*2+1],!(++hi<S0&&b0===ut)){if(hi<W)do ht(He,b0,He.bl_tree);while(--hi!==0);else b0!==0?(b0!==c0&&(ht(He,b0,He.bl_tree),hi--),ht(He,M,He.bl_tree),et(He,hi-3,2)):hi<=10?(ht(He,T,He.bl_tree),et(He,hi-3,3)):(ht(He,R,He.bl_tree),et(He,hi-11,7));hi=0,c0=b0,ut===0?(S0=138,W=3):b0===ut?(S0=6,W=3):(S0=7,W=4)}}function d0(He){var p0;for(si(He,He.dyn_ltree,He.l_desc.max_code),si(He,He.dyn_dtree,He.d_desc.max_code),R0(He,He.bl_desc),p0=E-1;p0>=3&&He.bl_tree[I[p0]*2+1]===0;p0--);return He.opt_len+=3*(p0+1)+5+5+4,p0}function w0(He,p0,x0,L0){var c0;for(et(He,p0-257,5),et(He,x0-1,5),et(He,L0-4,4),c0=0;c0<L0;c0++)et(He,He.bl_tree[I[c0]*2+1],3);Xe(He,He.dyn_ltree,p0-1),Xe(He,He.dyn_dtree,x0-1)}function Q(He){var p0=4093624447,x0;for(x0=0;x0<=31;x0++,p0>>>=1)if(p0&1&&He.dyn_ltree[x0*2]!==0)return s;if(He.dyn_ltree[18]!==0||He.dyn_ltree[20]!==0||He.dyn_ltree[26]!==0)return o;for(x0=32;x0<_;x0++)if(He.dyn_ltree[x0*2]!==0)return o;return s}var it=!1;function ec(He){it||(h0(),it=!0),He.l_desc=new Fe(He.dyn_ltree,K),He.d_desc=new Fe(He.dyn_dtree,q),He.bl_desc=new Fe(He.bl_tree,Te),He.bi_buf=0,He.bi_valid=0,l0(He)}function a0(He,p0,x0,L0){et(He,(d<<1)+(L0?1:0),3),U0(He,p0,x0)}function u0(He){et(He,u<<1,3),ht(He,A,k),tr(He)}function E0(He,p0,x0,L0){var c0,b0,ut=0;He.level>0?(He.strm.data_type===a&&(He.strm.data_type=Q(He)),R0(He,He.l_desc),R0(He,He.d_desc),ut=d0(He),c0=He.opt_len+3+7>>>3,b0=He.static_len+3+7>>>3,b0<=c0&&(c0=b0)):c0=b0=x0+5,x0+4<=c0&&p0!==-1?a0(He,p0,x0,L0):He.strategy===i||b0===c0?(et(He,(u<<1)+(L0?1:0),3),P0(He,k,U)):(et(He,(g<<1)+(L0?1:0),3),w0(He,He.l_desc.max_code+1,He.d_desc.max_code+1,ut+1),P0(He,He.dyn_ltree,He.dyn_dtree)),l0(He),L0&&M0(He)}function O0(He,p0,x0){return He.pending_buf[He.d_buf+He.last_lit*2]=p0>>>8&255,He.pending_buf[He.d_buf+He.last_lit*2+1]=p0&255,He.pending_buf[He.l_buf+He.last_lit]=x0&255,He.last_lit++,p0===0?He.dyn_ltree[x0*2]++:(He.matches++,p0--,He.dyn_ltree[(j[x0]+_+1)*2]++,He.dyn_dtree[We(p0)*2]++),He.last_lit===He.lit_bufsize-1}e._tr_init=ec,e._tr_stored_block=a0,e._tr_flush_block=E0,e._tr_tally=O0,e._tr_align=u0}),"./node_modules/upng-js/node_modules/pako/lib/zlib/zstream.js":(r=>{function e(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}r.exports=e}),"./src/3Dmol.ts":((r,e,t)=>{t.r(e),t.d(e,{CAP:()=>o.CAP,CC:()=>i.CC,CONTEXTS_PER_VIEWPORT:()=>d.CONTEXTS_PER_VIEWPORT,Color:()=>i.Color,CustomLinear:()=>u.CustomLinear,Cylinder:()=>m.Cylinder,GLDraw:()=>o.GLDraw,GLModel:()=>a.GLModel,GLShape:()=>l.GLShape,GLViewer:()=>d.GLViewer,GLVolumetricRender:()=>f.GLVolumetricRender,Gradient:()=>u.Gradient,GradientType:()=>u.GradientType,Label:()=>g.Label,LabelCount:()=>g.LabelCount,MarchingCube:()=>b.MarchingCube,MarchingCubeInitializer:()=>b.MarchingCubeInitializer,Matrix3:()=>E.Matrix3,Matrix4:()=>E.Matrix4,Parsers:()=>x.Parsers,PausableTimer:()=>_.PausableTimer,PointGrid:()=>b.PointGrid,ProteinSurface:()=>b.ProteinSurface,Quaternion:()=>E.Quaternion,ROYGB:()=>u.ROYGB,RWB:()=>u.RWB,Ray:()=>E.Ray,Sinebow:()=>u.Sinebow,Sphere:()=>m.Sphere,SurfaceType:()=>b.SurfaceType,Triangle:()=>m.Triangle,Vector2:()=>E.Vector2,Vector3:()=>E.Vector3,VolumeData:()=>h.VolumeData,adjustVolumeStyle:()=>_.adjustVolumeStyle,applyPartialCharges:()=>y.applyPartialCharges,autoinit:()=>n.autoinit,autoload:()=>n.autoload,base64ToArray:()=>_.base64ToArray,bondLength:()=>x.bondLength,builtinColorSchemes:()=>i.builtinColorSchemes,builtinGradients:()=>u.builtinGradients,chains:()=>i.chains,clamp:()=>E.clamp,conversionMatrix3:()=>E.conversionMatrix3,createStereoViewer:()=>d.createStereoViewer,createViewer:()=>d.createViewer,createViewerGrid:()=>d.createViewerGrid,deepCopy:()=>_.deepCopy,degToRad:()=>E.degToRad,download:()=>_.download,drawCartoon:()=>s.drawCartoon,elementColors:()=>i.elementColors,extend:()=>_.extend,get:()=>_.get,getAtomProperty:()=>_.getAtomProperty,getColorFromStyle:()=>_.getColorFromStyle,getElement:()=>_.getElement,getExtent:()=>_.getExtent,getGradient:()=>u.getGradient,getPropertyRange:()=>_.getPropertyRange,getbin:()=>_.getbin,htmlColors:()=>i.htmlColors,inflateString:()=>_.inflateString,isEmptyObject:()=>_.isEmptyObject,isNumeric:()=>_.isNumeric,makeFunction:()=>_.makeFunction,mergeGeos:()=>_.mergeGeos,normalizeValue:()=>u.normalizeValue,partialCharges:()=>y.partialCharges,processing_autoinit:()=>n.processing_autoinit,residues:()=>i.residues,setBondLength:()=>x.setBondLength,setSyncSurface:()=>b.setSyncSurface,specStringToObject:()=>_.specStringToObject,splitMesh:()=>l.splitMesh,ssColors:()=>i.ssColors,subdivide_spline:()=>s.subdivide_spline,syncSurface:()=>b.syncSurface,viewers:()=>n.viewers});var n=t("./src/autoload.ts"),i=t("./src/colors.ts"),s=t("./src/glcartoon.ts"),o=t("./src/GLDraw.ts"),a=t("./src/GLModel.ts"),l=t("./src/GLShape.ts"),d=t("./src/GLViewer.ts"),u=t("./src/Gradient.ts"),g=t("./src/Label.ts"),x=t("./src/parsers/index.ts"),y=t("./src/partialCharges.ts"),b=t("./src/ProteinSurface4.ts");t("./src/specs.ts");var _=t("./src/utilities.ts"),h=t("./src/VolumeData.ts"),f=t("./src/VolumetricRender.ts"),E=t("./src/WebGL/math/index.ts"),m=t("./src/WebGL/shapes/index.ts")}),"./src/GLDraw.ts":((r,e,t)=>{t.r(e),t.d(e,{CAP:()=>i,GLDraw:()=>s});var n=t("./src/WebGL/math/index.ts"),i;(function(o){o[o.NONE=0]="NONE",o[o.FLAT=1]="FLAT",o[o.ROUND=2]="ROUND"})(i||(i={}));var s;(function(o){function a(_,h,f){var E=Math.hypot(_,h),m,S,w,v,A;E<1e-4?(S=0,w=1):(S=-_/E,w=h/E),h=-S*_+w*h,m=Math.hypot(h,f),m<1e-4?(v=0,A=1):(v=f/m,A=h/m);var M=new Float32Array(9);return M[0]=w,M[1]=S,M[2]=0,M[3]=-S*A,M[4]=w*A,M[5]=v,M[6]=S*v,M[7]=-w*v,M[8]=A,M}class l{constructor(){this.cache={};let h=[],f=4,E=Math.pow(2,f),m=2,S=Math.pow(2,m),w=E/S,v;for(h[0]=new n.Vector3(-1,0,0),h[w]=new n.Vector3(0,0,1),h[w*2]=new n.Vector3(1,0,0),h[w*3]=new n.Vector3(0,0,-1),m=3;m<=f;m++){for(S=Math.pow(2,m-1),w=E/S,v=0;v<S-1;v++)h[w/2+v*w]=h[v*w].clone().add(h[(v+1)*w]).normalize();v=S-1,h[w/2+v*w]=h[v*w].clone().add(h[0]).normalize()}this.basisVectors=h}getVerticesForRadius(h,f,E){if(typeof this.cache<"u"&&this.cache[h]!==void 0&&this.cache[h][f+E]!==void 0)return this.cache[h][f+E];for(var m=this.basisVectors.length,S=[],w=[],v,A=0;A<m;A++)S.push(this.basisVectors[A].clone().multiplyScalar(h)),S.push(this.basisVectors[A].clone().multiplyScalar(h)),v=this.basisVectors[A].clone().normalize(),w.push(v),w.push(v);var M=[],T=10,R=m,P=0,L=Math.PI*2,O=0,I=Math.PI,N,k,U=!1,F=!1;for(k=0;k<=T;k++){U=k===0||k===T,F=k===T/2;var j=[],H=[];for(N=0;N<=R;N++){if(F){var B=N<R?2*N:0;H.push(B+1),j.push(B);continue}var V=N/R,K=k/T;if(!U||N===0)if(N<R){var q=new n.Vector3;q.x=-h*Math.cos(P+V*L)*Math.sin(O+K*I),f==1?q.y=0:q.y=h*Math.cos(O+K*I),q.z=h*Math.sin(P+V*L)*Math.sin(O+K*I),Math.abs(q.x)<1e-5&&(q.x=0),Math.abs(q.y)<1e-5&&(q.y=0),Math.abs(q.z)<1e-5&&(q.z=0),f==i.FLAT?(v=new n.Vector3(0,Math.cos(O+K*I),0),v.normalize()):(v=new n.Vector3(q.x,q.y,q.z),v.normalize()),S.push(q),w.push(v),j.push(S.length-1)}else j.push(S.length-R);else U&&j.push(S.length-1)}F&&M.push(H),M.push(j)}var Te={vertices:S,normals:w,verticesRows:M,w:R,h:T};return h in this.cache||(this.cache[h]={}),this.cache[h][f+E]=Te,Te}}var d=new l;function u(_,h,f,E,m,S=0,w=0){if(!h||!f)return;let v=function(I0){if(typeof I0=="string"){let Z=I0;return Z.toLowerCase()=="flat"?i.FLAT:Z.toLowerCase()=="round"?i.ROUND:i.NONE}else return I0};S=v(S),w=v(w);var A=w||S;m=m||{r:0,g:0,b:0};var M=a(f.x-h.x,f.y-h.y,f.z-h.z),T=d.getVerticesForRadius(E,w,"to"),R=T.w,P=T.h,L=A?P*R+2:2*R,O=_.updateGeoGroup(L),I=T.vertices,N=T.normals,k=T.verticesRows,U=k[P/2],F=k[P/2+1],j=O.vertices,H,B,V,K,q,Te,Fe=O.vertexArray,We=O.normalArray,J=O.colorArray,et=O.faceArray;for(V=0;V<R;++V){var ht=2*V;K=M[0]*I[ht].x+M[3]*I[ht].y+M[6]*I[ht].z,q=M[1]*I[ht].x+M[4]*I[ht].y+M[7]*I[ht].z,Te=M[5]*I[ht].y+M[8]*I[ht].z,H=3*(j+ht),B=O.faceidx,Fe[H]=K+h.x,Fe[H+1]=q+h.y,Fe[H+2]=Te+h.z,Fe[H+3]=K+f.x,Fe[H+4]=q+f.y,Fe[H+5]=Te+f.z,We[H]=K,We[H+3]=K,We[H+1]=q,We[H+4]=q,We[H+2]=Te,We[H+5]=Te,J[H]=m.r,J[H+3]=m.r,J[H+1]=m.g,J[H+4]=m.g,J[H+2]=m.b,J[H+5]=m.b,et[B]=F[V]+j,et[B+1]=F[V+1]+j,et[B+2]=U[V]+j,et[B+3]=U[V]+j,et[B+4]=F[V+1]+j,et[B+5]=U[V+1]+j,O.faceidx+=6}if(A){var er=w?0:P/2,tr=S?P+1:P/2+1,Hm,oi,h0,l0,M0,U0,_0,C0,P0,R0,si,Xe,d0,w0,Q,it,ec,a0,u0,E0,O0,He,p0,x0,L0,c0,b0,ut,hi,S0,W,t0;for(q=er;q<tr;q++)if(q!==P/2){var o0=q<=P/2?f:h,Ji=d.getVerticesForRadius(E,w,"to"),m0=d.getVerticesForRadius(E,S,"from");for(o0===f?(I=Ji.vertices,N=Ji.normals,k=Ji.verticesRows):o0==h&&(I=m0.vertices,N=m0.normals,k=m0.verticesRows),K=0;K<R;K++)B=O.faceidx,Hm=k[q][K+1],hi=(Hm+j)*3,oi=k[q][K],S0=(oi+j)*3,h0=k[q+1][K],W=(h0+j)*3,l0=k[q+1][K+1],t0=(l0+j)*3,M0=M[0]*I[Hm].x+M[3]*I[Hm].y+M[6]*I[Hm].z,U0=M[0]*I[oi].x+M[3]*I[oi].y+M[6]*I[oi].z,_0=M[0]*I[h0].x+M[3]*I[h0].y+M[6]*I[h0].z,C0=M[0]*I[l0].x+M[3]*I[l0].y+M[6]*I[l0].z,P0=M[1]*I[Hm].x+M[4]*I[Hm].y+M[7]*I[Hm].z,R0=M[1]*I[oi].x+M[4]*I[oi].y+M[7]*I[oi].z,si=M[1]*I[h0].x+M[4]*I[h0].y+M[7]*I[h0].z,Xe=M[1]*I[l0].x+M[4]*I[l0].y+M[7]*I[l0].z,d0=M[5]*I[Hm].y+M[8]*I[Hm].z,w0=M[5]*I[oi].y+M[8]*I[oi].z,Q=M[5]*I[h0].y+M[8]*I[h0].z,it=M[5]*I[l0].y+M[8]*I[l0].z,Fe[hi]=M0+o0.x,Fe[S0]=U0+o0.x,Fe[W]=_0+o0.x,Fe[t0]=C0+o0.x,Fe[hi+1]=P0+o0.y,Fe[S0+1]=R0+o0.y,Fe[W+1]=si+o0.y,Fe[t0+1]=Xe+o0.y,Fe[hi+2]=d0+o0.z,Fe[S0+2]=w0+o0.z,Fe[W+2]=Q+o0.z,Fe[t0+2]=it+o0.z,J[hi]=m.r,J[S0]=m.r,J[W]=m.r,J[t0]=m.r,J[hi+1]=m.g,J[S0+1]=m.g,J[W+1]=m.g,J[t0+1]=m.g,J[hi+2]=m.b,J[S0+2]=m.b,J[W+2]=m.b,J[t0+2]=m.b,ec=M[0]*N[Hm].x+M[3]*N[Hm].y+M[6]*N[Hm].z,a0=M[0]*N[oi].x+M[3]*N[oi].y+M[6]*N[oi].z,u0=M[0]*N[h0].x+M[3]*N[h0].y+M[6]*N[h0].z,E0=M[0]*N[l0].x+M[3]*N[l0].y+M[6]*N[l0].z,O0=M[1]*N[Hm].x+M[4]*N[Hm].y+M[7]*N[Hm].z,He=M[1]*N[oi].x+M[4]*N[oi].y+M[7]*N[oi].z,p0=M[1]*N[h0].x+M[4]*N[h0].y+M[7]*N[h0].z,x0=M[1]*N[l0].x+M[4]*N[l0].y+M[7]*N[l0].z,L0=M[5]*N[Hm].y+M[8]*N[Hm].z,c0=M[5]*N[oi].y+M[8]*N[oi].z,b0=M[5]*N[h0].y+M[8]*N[h0].z,ut=M[5]*N[l0].y+M[8]*N[l0].z,q===0?(We[hi]=ec,We[W]=u0,We[t0]=E0,We[hi+1]=O0,We[W+1]=p0,We[t0+1]=x0,We[hi+2]=L0,We[W+2]=b0,We[t0+2]=ut,et[B]=Hm+j,et[B+1]=h0+j,et[B+2]=l0+j,O.faceidx+=3):q===tr-1?(We[hi]=ec,We[S0]=a0,We[W]=u0,We[hi+1]=O0,We[S0+1]=He,We[W+1]=p0,We[hi+2]=L0,We[S0+2]=c0,We[W+2]=b0,et[B]=Hm+j,et[B+1]=oi+j,et[B+2]=h0+j,O.faceidx+=3):(We[hi]=ec,We[S0]=a0,We[t0]=E0,We[hi+1]=O0,We[S0+1]=He,We[t0+1]=x0,We[hi+2]=L0,We[S0+2]=c0,We[t0+2]=ut,We[S0]=a0,We[W]=u0,We[t0]=E0,We[S0+1]=He,We[W+1]=p0,We[t0+1]=x0,We[S0+2]=c0,We[W+2]=b0,We[t0+2]=ut,et[B]=Hm+j,et[B+1]=oi+j,et[B+2]=l0+j,et[B+3]=oi+j,et[B+4]=h0+j,et[B+5]=l0+j,O.faceidx+=6)}}O.vertices+=L}o.drawCylinder=u;function g(_,h,f,E,m){if(!h||!f)return;m=m||{r:0,g:0,b:0};let S=new n.Vector3(f.x-h.x,f.y-h.y,f.z-h.z);var w=a(S.x,S.y,S.z);S=S.normalize();var v=d.basisVectors.length,A=d.basisVectors,M=v+2,T=_.updateGeoGroup(M),R=T.vertices,P,L,O,I,N,k,U=T.vertexArray,F=T.normalArray,j=T.colorArray,H=T.faceArray;for(P=R*3,U[P]=h.x,U[P+1]=h.y,U[P+2]=h.z,F[P]=-S.x,F[P+1]=-S.y,F[P+2]=-S.z,j[P]=m.r,j[P+1]=m.g,j[P+2]=m.b,U[P+3]=f.x,U[P+4]=f.y,U[P+5]=f.z,F[P+3]=S.x,F[P+4]=S.y,F[P+5]=S.z,j[P+3]=m.r,j[P+4]=m.g,j[P+5]=m.b,P+=6,O=0;O<v;++O){var B=A[O].clone();B.multiplyScalar(E),I=w[0]*B.x+w[3]*B.y+w[6]*B.z,N=w[1]*B.x+w[4]*B.y+w[7]*B.z,k=w[5]*B.y+w[8]*B.z,U[P]=I+h.x,U[P+1]=N+h.y,U[P+2]=k+h.z,F[P]=I,F[P+1]=N,F[P+2]=k,j[P]=m.r,j[P+1]=m.g,j[P+2]=m.b,P+=3}for(T.vertices+=v+2,L=T.faceidx,O=0;O<v;O++){var V=R+2+O,K=R+2+(O+1)%v;H[L]=V,H[L+1]=K,H[L+2]=R,L+=3,H[L]=V,H[L+1]=K,H[L+2]=R+1,L+=3}T.faceidx+=6*v}o.drawCone=g;class x{constructor(){this.cache=new Map}getVerticesForRadius(h,f){f=f||2,this.cache.has(f)||this.cache.set(f,new Map);let E=this.cache.get(f);if(E.has(h))return E.get(h);var m={vertices:[],verticesRows:[],normals:[]},S=16*f,w=10*f;h<1&&(S=10*f,w=8*f);var v=0,A=Math.PI*2,M=0,T=Math.PI,R,P;for(P=0;P<=w;P++){let O=[];for(R=0;R<=S;R++){let I=R/S,N=P/w,k=-h*Math.cos(v+I*A)*Math.sin(M+N*T),U=h*Math.cos(M+N*T),F=h*Math.sin(v+I*A)*Math.sin(M+N*T);var L=new n.Vector3(k,U,F);L.normalize(),m.vertices.push({x:k,y:U,z:F}),m.normals.push(L),O.push(m.vertices.length-1)}m.verticesRows.push(O)}return E.set(h,m),m}}var y=new x;function b(_,h,f,E,m){var S=y.getVerticesForRadius(f,m),w=S.vertices,v=S.normals,A=_.updateGeoGroup(w.length),M=A.vertices,T=A.vertexArray,R=A.colorArray,P=A.faceArray,L=A.lineArray,O=A.normalArray;for(let k=0,U=w.length;k<U;++k){let F=3*(M+k),j=w[k];T[F]=j.x+h.x,T[F+1]=j.y+h.y,T[F+2]=j.z+h.z,R[F]=E.r,R[F+1]=E.g,R[F+2]=E.b}A.vertices+=w.length;let I=S.verticesRows,N=I.length-1;for(let k=0;k<N;k++){let U=I[k].length-1;for(let F=0;F<U;F++){let j=A.faceidx,H=A.lineidx,B=I[k][F+1]+M,V=B*3,K=I[k][F]+M,q=K*3,Te=I[k+1][F]+M,Fe=Te*3,We=I[k+1][F+1]+M,J=We*3,et=v[B-M],ht=v[K-M],er=v[Te-M],tr=v[We-M];Math.abs(w[B-M].y)===f?(O[V]=et.x,O[Fe]=er.x,O[J]=tr.x,O[V+1]=et.y,O[Fe+1]=er.y,O[J+1]=tr.y,O[V+2]=et.z,O[Fe+2]=er.z,O[J+2]=tr.z,P[j]=B,P[j+1]=Te,P[j+2]=We,L[H]=B,L[H+1]=Te,L[H+2]=B,L[H+3]=We,L[H+4]=Te,L[H+5]=We,A.faceidx+=3,A.lineidx+=6):Math.abs(w[Te-M].y)===f?(O[V]=et.x,O[q]=ht.x,O[Fe]=er.x,O[V+1]=et.y,O[q+1]=ht.y,O[Fe+1]=er.y,O[V+2]=et.z,O[q+2]=ht.z,O[Fe+2]=er.z,P[j]=B,P[j+1]=K,P[j+2]=Te,L[H]=B,L[H+1]=K,L[H+2]=B,L[H+3]=Te,L[H+4]=K,L[H+5]=Te,A.faceidx+=3,A.lineidx+=6):(O[V]=et.x,O[q]=ht.x,O[J]=tr.x,O[V+1]=et.y,O[q+1]=ht.y,O[J+1]=tr.y,O[V+2]=et.z,O[q+2]=ht.z,O[J+2]=tr.z,O[q]=ht.x,O[Fe]=er.x,O[J]=tr.x,O[q+1]=ht.y,O[Fe+1]=er.y,O[J+1]=tr.y,O[q+2]=ht.z,O[Fe+2]=er.z,O[J+2]=tr.z,P[j]=B,P[j+1]=K,P[j+2]=We,P[j+3]=K,P[j+4]=Te,P[j+5]=We,L[H]=B,L[H+1]=K,L[H+2]=B,L[H+3]=We,L[H+4]=K,L[H+5]=Te,L[H+6]=Te,L[H+7]=We,A.faceidx+=6,A.lineidx+=8)}}}o.drawSphere=b})(s||(s={}))}),"./src/GLModel.ts":((r,e,t)=>{t.r(e),t.d(e,{GLModel:()=>b});var n=t("./src/WebGL/index.ts"),i=t("./src/WebGL/shapes/index.ts"),s=t("./src/WebGL/math/index.ts"),o=t("./src/colors.ts"),a=t("./src/GLDraw.ts"),l=t("./src/glcartoon.ts"),d=t("./src/utilities.ts"),u=t("./src/Gradient.ts"),g=t("./src/parsers/index.ts"),x=t("./node_modules/netcdfjs/lib-esm/index.js"),y=t("./src/parsers/utils/assignBonds.ts");class b{static sameObj(h,f){return h&&f?JSON.stringify(h)==JSON.stringify(f):h==f}constructor(h,f,E){this.atoms=[],this.frames=[],this.box=null,this.atomdfs=null,this.id=0,this.hidden=!1,this.molObj=null,this.renderedMolObj=null,this.lastColors=null,this.modelData={},this.modelDatas=null,this.idMatrix=new s.Matrix4,this.dontDuplicateAtoms=!0,this.defaultColor=o.elementColors.defaultColor,this.defaultStickRadius=.25,this.options=f||{},this.viewer=E,this.ElementColors=this.options.defaultcolors?this.options.defaultcolors:o.elementColors.defaultColors,this.defaultSphereRadius=this.options.defaultSphereRadius?this.options.defaultSphereRadius:1.5,this.defaultCartoonQuality=this.options.cartoonQuality?this.options.cartoonQuality:10,this.id=h}getRadiusFromStyle(h,f){var E=this.defaultSphereRadius;if(typeof f.radius<"u")E=f.radius;else if(b.vdwRadii[h.elem])E=b.vdwRadii[h.elem];else if(h.elem.length>1){let m=h.elem;m=m[0].toUpperCase()+m[1].toLowerCase(),b.vdwRadii[m]&&(E=b.vdwRadii[m])}return typeof f.scale<"u"&&(E*=f.scale),E}drawAtomCross(h,f){if(h.style.cross){var E=h.style.cross;if(!E.hidden){var m=E.linewidth||b.defaultlineWidth;f[m]||(f[m]=new n.Geometry);var S=f[m].updateGeoGroup(6),w=this.getRadiusFromStyle(h,E),v=[[w,0,0],[-w,0,0],[0,w,0],[0,-w,0],[0,0,w],[0,0,-w]],A=h.clickable||h.hoverable;A&&h.intersectionShape===void 0&&(h.intersectionShape={sphere:[],cylinder:[],line:[]});for(var M=(0,d.getColorFromStyle)(h,E),T=S.vertexArray,R=S.colorArray,P=0;P<6;P++){var L=S.vertices*3;if(S.vertices++,T[L]=h.x+v[P][0],T[L+1]=h.y+v[P][1],T[L+2]=h.z+v[P][2],R[L]=M.r,R[L+1]=M.g,R[L+2]=M.b,A){var O=new s.Vector3(v[P][0],v[P][1],v[P][2]);O.multiplyScalar(.1),O.set(O.x+h.x,O.y+h.y,O.z+h.z),h.intersectionShape.line.push(O)}}}}}getGoodCross(h,f,E,m){for(var S=null,w=-1,v=0,A=h.bonds.length;v<A;v++)if(h.bonds[v]!=f.index){let T=h.bonds[v],R=this.atoms[T],L=new s.Vector3(R.x,R.y,R.z).clone();L.sub(E);let O=L.clone();O.cross(m);var M=O.lengthSq();if(M>w&&(w=M,S=O,w>.1))return S}return S}getSideBondV(h,f,E){var m,S,w,v,A,M=new s.Vector3(h.x,h.y,h.z),T=new s.Vector3(f.x,f.y,f.z),R=T.clone(),P=null;if(R.sub(M),h.bonds.length===1)f.bonds.length===1?(P=R.clone(),Math.abs(P.x)>1e-4?P.y+=1:P.x+=1):(m=(E+1)%f.bonds.length,S=f.bonds[m],w=this.atoms[S],w.index==h.index&&(m=(m+1)%f.bonds.length,S=f.bonds[m],w=this.atoms[S]),v=new s.Vector3(w.x,w.y,w.z),A=v.clone(),A.sub(M),P=A.clone(),P.cross(R));else if(P=this.getGoodCross(h,f,M,R),P.lengthSq()<.01){var L=this.getGoodCross(f,h,M,R);L!=null&&(P=L)}return P.lengthSq()<.01&&(P=R.clone(),Math.abs(P.x)>1e-4?P.y+=1:P.x+=1),P.cross(R),P.normalize(),P}addLine(h,f,E,m,S,w){h[E]=m.x,h[E+1]=m.y,h[E+2]=m.z,f[E]=w.r,f[E+1]=w.g,f[E+2]=w.b,h[E+3]=S.x,h[E+4]=S.y,h[E+5]=S.z,f[E+3]=w.r,f[E+4]=w.g,f[E+5]=w.b}drawBondLines(h,f,E){if(h.style.line){var m=h.style.line;if(!m.hidden){var S,w,v,A,M=m.linewidth||b.defaultlineWidth;E[M]||(E[M]=new n.Geometry);for(var T=E[M].updateGeoGroup(6*h.bonds.length),R=T.vertexArray,P=T.colorArray,L=0;L<h.bonds.length;L++){var O=h.bonds[L],I=f[O];if(I.style.line&&!(h.index>=I.index)){var N=new s.Vector3(h.x,h.y,h.z),k=new s.Vector3(I.x,I.y,I.z),U=N.clone().add(k).multiplyScalar(.5),F=!1,j=h.clickable||h.hoverable,H=I.clickable||I.hoverable;(j||H)&&(j&&(h.intersectionShape===void 0&&(h.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),h.intersectionShape.line.push(N),h.intersectionShape.line.push(U)),H&&(I.intersectionShape===void 0&&(I.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),I.intersectionShape.line.push(U),I.intersectionShape.line.push(k)));var B=(0,d.getColorFromStyle)(h,h.style.line),V=(0,d.getColorFromStyle)(I,I.style.line);if(h.bondStyles&&h.bondStyles[L]){var K=h.bondStyles[L];if(!K.iswire)continue;K.singleBond&&(F=!0),typeof K.color1<"u"&&(B=o.CC.color(K.color1)),typeof K.color2<"u"&&(V=o.CC.color(K.color2))}var q=T.vertices*3,Te,Fe;if(h.bondOrder[L]>1&&h.bondOrder[L]<4&&!F){var We=this.getSideBondV(h,I,L),J=k.clone();J.sub(N),h.bondOrder[L]==2?(We.multiplyScalar(.1),S=N.clone(),S.add(We),w=N.clone(),w.sub(We),v=S.clone(),v.add(J),A=w.clone(),A.add(J),B==V?(T.vertices+=4,this.addLine(R,P,q,S,v,B),this.addLine(R,P,q+6,w,A,B)):(T.vertices+=8,J.multiplyScalar(.5),Te=S.clone(),Te.add(J),Fe=w.clone(),Fe.add(J),this.addLine(R,P,q,S,Te,B),this.addLine(R,P,q+6,Te,v,V),this.addLine(R,P,q+12,w,Fe,B),this.addLine(R,P,q+18,Fe,A,V))):h.bondOrder[L]==3&&(We.multiplyScalar(.1),S=N.clone(),S.add(We),w=N.clone(),w.sub(We),v=S.clone(),v.add(J),A=w.clone(),A.add(J),B==V?(T.vertices+=6,this.addLine(R,P,q,N,k,B),this.addLine(R,P,q+6,S,v,B),this.addLine(R,P,q+12,w,A,B)):(T.vertices+=12,J.multiplyScalar(.5),Te=S.clone(),Te.add(J),Fe=w.clone(),Fe.add(J),this.addLine(R,P,q,N,U,B),this.addLine(R,P,q+6,U,k,V),this.addLine(R,P,q+12,S,Te,B),this.addLine(R,P,q+18,Te,v,V),this.addLine(R,P,q+24,w,Fe,B),this.addLine(R,P,q+30,Fe,A,V)))}else B==V?(T.vertices+=2,this.addLine(R,P,q,N,k,B)):(T.vertices+=4,this.addLine(R,P,q,N,U,B),this.addLine(R,P,q+6,U,k,V))}}}}}drawAtomSphere(h,f){if(h.style.sphere){var E=h.style.sphere;if(!E.hidden){var m=(0,d.getColorFromStyle)(h,E),S=this.getRadiusFromStyle(h,E);if((h.clickable===!0||h.hoverable)&&h.intersectionShape!==void 0){var w=new s.Vector3(h.x,h.y,h.z);h.intersectionShape.sphere.push(new i.Sphere(w,S))}a.GLDraw.drawSphere(f,h,S,m)}}}drawAtomClickSphere(h){if(h.style.clicksphere){var f=h.style.clicksphere;if(!f.hidden){var E=this.getRadiusFromStyle(h,f);if((h.clickable===!0||h.hoverable)&&h.intersectionShape!==void 0){var m=new s.Vector3(h.x,h.y,h.z);h.intersectionShape.sphere.push(new i.Sphere(m,E))}}}}drawAtomInstanced(h,f){if(h.style.sphere){var E=h.style.sphere;if(!E.hidden){var m=this.getRadiusFromStyle(h,E),S=(0,d.getColorFromStyle)(h,E),w=f.updateGeoGroup(1),v=w.vertices,A=v*3,M=w.vertexArray,T=w.colorArray,R=w.radiusArray;if(M[A]=h.x,M[A+1]=h.y,M[A+2]=h.z,T[A]=S.r,T[A+1]=S.g,T[A+2]=S.b,R[v]=m,(h.clickable===!0||h.hoverable)&&h.intersectionShape!==void 0){var P=new s.Vector3(h.x,h.y,h.z);h.intersectionShape.sphere.push(new i.Sphere(P,m))}w.vertices+=1}}}drawSphereImposter(h,f,E,m){var S=h.updateGeoGroup(4),w,v=S.vertices,A=v*3,M=S.vertexArray,T=S.colorArray;for(w=0;w<4;w++)M[A+3*w]=f.x,M[A+3*w+1]=f.y,M[A+3*w+2]=f.z;var R=S.normalArray;for(w=0;w<4;w++)T[A+3*w]=m.r,T[A+3*w+1]=m.g,T[A+3*w+2]=m.b;R[A+0]=-E,R[A+1]=E,R[A+2]=0,R[A+3]=-E,R[A+4]=-E,R[A+5]=0,R[A+6]=E,R[A+7]=-E,R[A+8]=0,R[A+9]=E,R[A+10]=E,R[A+11]=0,S.vertices+=4;var P=S.faceArray,L=S.faceidx;P[L+0]=v,P[L+1]=v+1,P[L+2]=v+2,P[L+3]=v+2,P[L+4]=v+3,P[L+5]=v,S.faceidx+=6}drawAtomImposter(h,f){if(h.style.sphere){var E=h.style.sphere;if(!E.hidden){var m=this.getRadiusFromStyle(h,E),S=(0,d.getColorFromStyle)(h,E);if((h.clickable===!0||h.hoverable)&&h.intersectionShape!==void 0){var w=new s.Vector3(h.x,h.y,h.z);h.intersectionShape.sphere.push(new i.Sphere(w,m))}this.drawSphereImposter(f,h,m,S)}}}calculateDashes(h,f,E,m,S){var w=Math.sqrt(Math.pow(h.x-f.x,2)+Math.pow(h.y-f.y,2)+Math.pow(h.z-f.z,2));E=Math.max(E,0),S=Math.max(S,0)+2*E,m=Math.max(m,.001),m+S>w&&(m=w,S=0);var v=Math.floor((w-m)/(m+S))+1,A=v*m;S=(w-A)/v;for(var M,T=new s.Vector3(h.x,h.y,h.z),R=new s.Vector3((f.x-h.x)/(w/S),(f.y-h.y)/(w/S),(f.z-h.z)/(w/S)),P=new s.Vector3((f.x-h.x)/(w/m),(f.y-h.y)/(w/m),(f.z-h.z)/(w/m)),L=[],O=0;O<v;O++)M=new s.Vector3(T.x+P.x,T.y+P.y,T.z+P.z),L.push({from:T,to:M}),T=new s.Vector3(M.x+R.x,M.y+R.y,M.z+R.z);return L}static drawStickImposter(h,f,E,m,S,w=0,v=0){for(var A=h.updateGeoGroup(4),M=A.vertices,T=M*3,R=A.vertexArray,P=A.colorArray,L=A.radiusArray,O=A.normalArray,I=S.r,N=S.g,k=S.b,U=function(V){var K=-V;return K==0&&(K=-1e-4),K},F=T,j=0;j<4;j++)R[F]=f.x,O[F]=E.x,P[F]=I,F++,R[F]=f.y,O[F]=E.y,P[F]=N,F++,R[F]=f.z,O[F]=E.z,j<2?P[F]=k:P[F]=U(k),F++;A.vertices+=4,L[M]=-m,L[M+1]=m,L[M+2]=-m,L[M+3]=m;var H=A.faceArray,B=A.faceidx;H[B+0]=M,H[B+1]=M+1,H[B+2]=M+2,H[B+3]=M+2,H[B+4]=M+3,H[B+5]=M,A.faceidx+=6}drawBondSticks(h,f,E){var m,S;if(h.style.stick){var w=h.style.stick;if(!w.hidden){var v=w.radius||this.defaultStickRadius,A=w.doubleBondScaling||.4,M=w.tripleBondScaling||.25,T=((m=w.dashedBondConfig)===null||m===void 0?void 0:m.dashLength)||.1,R=((S=w.dashedBondConfig)===null||S===void 0?void 0:S.gapLength)||.25,P=v,L=w.singleBonds||!1,O=w.dashedBonds||!1,I=0,N=0,k,U,F,j,H,B,V,K,q,Te,Fe,We=(0,d.getColorFromStyle)(h,w),J,et,ht;!h.capDrawn&&h.bonds.length<4&&(I=2);var er=p0=>{var x0=E.imposter?b.drawStickImposter:a.GLDraw.drawCylinder;return!O&&p0>=1?x0:(L0,c0,b0,ut,hi,S0=0,W=0,t0=.1,o0=.25)=>{var Ji=this.calculateDashes(c0,b0,ut,t0,o0);Ji.forEach(m0=>{x0(L0,m0.from,m0.to,ut,hi,S0,W)})}};for(F=0;F<h.bonds.length;F++){var tr=er(h.bondOrder[F]),Hm=h.bonds[F],oi=f[Hm];if(J=et=ht=null,h.index<oi.index){var h0=oi.style;if(!h0.stick||h0.stick.hidden)continue;var l0=(0,d.getColorFromStyle)(oi,h0.stick);if(P=v,j=L,h.bondStyles&&h.bondStyles[F]){if(H=h.bondStyles[F],H.iswire)continue;H.radius&&(P=H.radius),H.singleBond&&(j=!0),typeof H.color1<"u"&&(We=o.CC.color(H.color1)),typeof H.color2<"u"&&(l0=o.CC.color(H.color2))}var M0=new s.Vector3(h.x,h.y,h.z),U0=new s.Vector3(oi.x,oi.y,oi.z);if(h.bondOrder[F]<=1||j||h.bondOrder[F]>3){if(h.bondOrder[F]<1&&(P*=h.bondOrder[F]),!oi.capDrawn&&oi.bonds.length<4&&(N=2),We!=l0?(J=new s.Vector3().addVectors(M0,U0).multiplyScalar(.5),tr(E,M0,J,P,We,I,0,T,R),tr(E,J,U0,P,l0,0,N,T,R)):tr(E,M0,U0,P,We,I,N,T,R),k=h.clickable||h.hoverable,U=oi.clickable||oi.hoverable,k||U){if(J||(J=new s.Vector3().addVectors(M0,U0).multiplyScalar(.5)),k){var _0=new i.Cylinder(M0,J,P),C0=new i.Sphere(M0,P);h.intersectionShape.cylinder.push(_0),h.intersectionShape.sphere.push(C0)}if(U){var P0=new i.Cylinder(U0,J,P),R0=new i.Sphere(U0,P);oi.intersectionShape.cylinder.push(P0),oi.intersectionShape.sphere.push(R0)}}}else if(h.bondOrder[F]>1){var si=0,Xe=0;P!=v&&(si=2,Xe=2);var d0=U0.clone(),w0=null;d0.sub(M0);var Q,it,ec,a0,u0;w0=this.getSideBondV(h,oi,F),h.bondOrder[F]==2?(Q=P*A,w0.multiplyScalar(Q*1.5),it=M0.clone(),it.add(w0),ec=M0.clone(),ec.sub(w0),a0=it.clone(),a0.add(d0),u0=ec.clone(),u0.add(d0),We!=l0?(J=new s.Vector3().addVectors(it,a0).multiplyScalar(.5),et=new s.Vector3().addVectors(ec,u0).multiplyScalar(.5),tr(E,it,J,Q,We,si,0),tr(E,J,a0,Q,l0,0,Xe),tr(E,ec,et,Q,We,si,0),tr(E,et,u0,Q,l0,0,Xe)):(tr(E,it,a0,Q,We,si,Xe),tr(E,ec,u0,Q,We,si,Xe)),k=h.clickable||h.hoverable,U=oi.clickable||oi.hoverable,(k||U)&&(J||(J=new s.Vector3().addVectors(it,a0).multiplyScalar(.5)),et||(et=new s.Vector3().addVectors(ec,u0).multiplyScalar(.5)),k&&(B=new i.Cylinder(it,J,Q),V=new i.Cylinder(ec,et,Q),h.intersectionShape.cylinder.push(B),h.intersectionShape.cylinder.push(V)),U&&(q=new i.Cylinder(a0,J,Q),Te=new i.Cylinder(u0,et,Q),oi.intersectionShape.cylinder.push(q),oi.intersectionShape.cylinder.push(Te)))):h.bondOrder[F]==3&&(Q=P*M,w0.cross(d0),w0.normalize(),w0.multiplyScalar(Q*3),it=M0.clone(),it.add(w0),ec=M0.clone(),ec.sub(w0),a0=it.clone(),a0.add(d0),u0=ec.clone(),u0.add(d0),We!=l0?(J=new s.Vector3().addVectors(it,a0).multiplyScalar(.5),et=new s.Vector3().addVectors(ec,u0).multiplyScalar(.5),ht=new s.Vector3().addVectors(M0,U0).multiplyScalar(.5),tr(E,it,J,Q,We,si,0),tr(E,J,a0,Q,l0,0,Xe),tr(E,M0,ht,Q,We,I,0),tr(E,ht,U0,Q,l0,0,N),tr(E,ec,et,Q,We,si,0),tr(E,et,u0,Q,l0,0,Xe)):(tr(E,it,a0,Q,We,si,Xe),tr(E,M0,U0,Q,We,I,N),tr(E,ec,u0,Q,We,si,Xe)),k=h.clickable||h.hoverable,U=oi.clickable||oi.hoverable,(k||U)&&(J||(J=new s.Vector3().addVectors(it,a0).multiplyScalar(.5)),et||(et=new s.Vector3().addVectors(ec,u0).multiplyScalar(.5)),ht||(ht=new s.Vector3().addVectors(M0,U0).multiplyScalar(.5)),k&&(B=new i.Cylinder(it.clone(),J.clone(),Q),V=new i.Cylinder(ec.clone(),et.clone(),Q),K=new i.Cylinder(M0.clone(),ht.clone(),Q),h.intersectionShape.cylinder.push(B),h.intersectionShape.cylinder.push(V),h.intersectionShape.cylinder.push(K)),U&&(q=new i.Cylinder(a0.clone(),J.clone(),Q),Te=new i.Cylinder(u0.clone(),et.clone(),Q),Fe=new i.Cylinder(U0.clone(),ht.clone(),Q),oi.intersectionShape.cylinder.push(q),oi.intersectionShape.cylinder.push(Te),oi.intersectionShape.cylinder.push(Fe))))}}}var E0=!1,O0=0,He=!1;for(F=0;F<h.bonds.length;F++)j=L,h.bondStyles&&h.bondStyles[F]&&(H=h.bondStyles[F],H.singleBond&&(j=!0),H.radius&&H.radius!=v&&(He=!0)),(j||h.bondOrder[F]==1)&&O0++;He?O0>0&&(E0=!0):O0==0&&(h.bonds.length>0||w.showNonBonded)&&(E0=!0),E0&&(P=v,E.imposter?this.drawSphereImposter(E.sphereGeometry,h,P,We):a.GLDraw.drawSphere(E,h,P,We))}}}createMolObj(h,f){f=f||{};var E=new n.Object3D,m=[],S={},w={},v=this.drawAtomSphere,A=null,M=null;f.supportsImposters?(v=this.drawAtomImposter,A=new n.Geometry(!0),A.imposter=!0,M=new n.Geometry(!0,!0),M.imposter=!0,M.sphereGeometry=new n.Geometry(!0),M.sphereGeometry.imposter=!0,M.drawnCaps={}):f.supportsAIA?(v=this.drawAtomInstanced,A=new n.Geometry(!1,!0,!0),A.instanced=!0,M=new n.Geometry(!0)):(A=new n.Geometry(!0),M=new n.Geometry(!0));var T,R,P,L,O={},I=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(T=0,P=h.length;T<P;T++){var N=h[T];if(N&&N.style){(N.clickable||N.hoverable)&&N.intersectionShape===void 0&&(N.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),L={line:void 0,cross:void 0,stick:void 0,sphere:void 0};for(R in L)N.style[R]?N.style[R].opacity?L[R]=parseFloat(N.style[R].opacity):L[R]=1:L[R]=void 0,O[R]?L[R]!=null&&O[R]!=L[R]&&(console.log("Warning: "+R+" opacity is ambiguous"),O[R]=1):O[R]=L[R];v.call(this,N,A),this.drawAtomClickSphere(N),this.drawAtomCross(N,w),this.drawBondLines(N,h,S),this.drawBondSticks(N,h,M),typeof N.style.cartoon<"u"&&!N.style.cartoon.hidden&&(N.style.cartoon.color==="spectrum"&&typeof N.resi=="number"&&!N.hetflag&&(N.resi<I[0]&&(I[0]=N.resi),N.resi>I[1]&&(I[1]=N.resi)),m.push(N))}}if(m.length>0&&(0,l.drawCartoon)(E,m,I,this.defaultCartoonQuality),A&&A.vertices>0){A.initTypedArrays();var k=null,U=null;A.imposter?k=new n.SphereImposterMaterial({ambient:0,vertexColors:!0,reflectivity:0}):A.instanced?(U=new n.Geometry(!0),a.GLDraw.drawSphere(U,{x:0,y:0,z:0},1,new o.Color(.5,.5,.5)),U.initTypedArrays(),k=new n.InstancedMaterial({sphereMaterial:new n.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),sphere:U})):k=new n.MeshLambertMaterial({ambient:0,vertexColors:!0,reflectivity:0}),O.sphere<1&&O.sphere>=0&&(k.transparent=!0,k.opacity=O.sphere),U=new n.Mesh(A,k),E.add(U)}if(M.vertices>0){var F=null,j=null,H=M.sphereGeometry;(!H||typeof H.vertices>"u"||H.vertices==0)&&(H=null),M.initTypedArrays(),H&&H.initTypedArrays();var B={ambient:0,vertexColors:!0,reflectivity:0};M.imposter?(F=new n.StickImposterMaterial(B),j=new n.SphereImposterMaterial(B)):(F=new n.MeshLambertMaterial(B),j=new n.MeshLambertMaterial(B),F.wireframe&&(M.setUpWireframe(),H&&H.setUpWireframe())),O.stick<1&&O.stick>=0&&(F.transparent=!0,F.opacity=O.stick,j.transparent=!0,j.opacity=O.stick);var V=new n.Mesh(M,F);if(E.add(V),H){var K=new n.Mesh(H,j);E.add(K)}}var q;for(T in S)if(S.hasOwnProperty(T)){q=T;var Te=new n.LineBasicMaterial({linewidth:q,vertexColors:!0});O.line<1&&O.line>=0&&(Te.transparent=!0,Te.opacity=O.line),S[T].initTypedArrays();var Fe=new n.Line(S[T],Te,n.LineStyle.LinePieces);E.add(Fe)}for(T in w)if(w.hasOwnProperty(T)){q=T;var We=new n.LineBasicMaterial({linewidth:q,vertexColors:!0});O.cross<1&&O.cross>=0&&(We.transparent=!0,We.opacity=O.cross),w[T].initTypedArrays();var J=new n.Line(w[T],We,n.LineStyle.LinePieces);E.add(J)}if(this.dontDuplicateAtoms&&this.modelData.symmetries&&this.modelData.symmetries.length>0){var et=new n.Object3D,ht;for(ht=0;ht<this.modelData.symmetries.length;ht++){var er=new n.Object3D;er=E.clone(),er.matrix.copy(this.modelData.symmetries[ht]),er.matrixAutoUpdate=!1,et.add(er)}return et}return E}getViewer(){return this.viewer}getInternalState(){return{atoms:this.atoms,frames:this.frames}}setInternalState(h){this.atoms=h.atoms,this.frames=h.frames,this.molObj=null}getCrystData(){if(this.modelData.cryst){if(!this.modelData.cryst.matrix){const h=this.modelData.cryst;this.modelData.cryst.matrix=(0,s.conversionMatrix3)(h.a,h.b,h.c,h.alpha,h.beta,h.gamma)}return this.modelData.cryst}else return null}setCrystData(h,f,E,m,S,w){h=h||1,f=f||1,E=E||1,m=m||90,S=S||90,w=w||90;const v=(0,s.conversionMatrix3)(h,f,E,m,S,w);this.modelData.cryst={a:h,b:f,c:E,alpha:m,beta:S,gamma:w,matrix:v}}setCrystMatrix(h){h=h||new s.Matrix3(1,0,0,0,1,0,0,0,1),this.modelData.cryst={matrix:h}}getSymmetries(){return typeof this.modelData.symmetries>"u"&&(this.modelData.symmetries=[this.idMatrix]),this.modelData.symmetries}setSymmetries(h){typeof h>"u"?this.modelData.symmetries=[this.idMatrix]:(this.modelData.symmetries=h,this.molObj=null)}getID(){return this.id}getNumFrames(){return this.frames.numFrames!=null?this.frames.numFrames:this.frames.length}adjustCoord(h,f,E,m){var S=f-h;return S<-E?f+m:S>E?f-m:f}adjustCoordinatesToBox(){if(this.box&&this.atomdfs)for(var h=this.box[0],f=this.box[1],E=this.box[2],m=h*.9,S=f*.9,w=E*.9,v=0;v<this.atomdfs.length;v++)for(var A=this.atomdfs[v],M=1;M<A.length;M++){var T=this.atoms[A[M][0]],R=this.atoms[A[M][1]];T.x=this.adjustCoord(R.x,T.x,m,h),T.y=this.adjustCoord(R.y,T.y,S,f),T.z=this.adjustCoord(R.z,T.z,w,E)}}setFrame(h){var f=this.getNumFrames();let E=this,m=this.viewer;return new Promise(function(S,w){if(f==0&&S(),(h<0||h>=f)&&(h=f-1),E.frames.url!=null){var v=E.frames.url;(0,d.getbin)(v+"/traj/frame/"+h+"/"+E.frames.path,void 0,"POST",void 0).then(function(A){for(var M=new Float32Array(A,44),T=0,R=0;R<E.atoms.length;R++)E.atoms[R].x=M[T++],E.atoms[R].y=M[T++],E.atoms[R].z=M[T++];E.box&&E.atomdfs&&E.adjustCoordinatesToBox(),S()}).catch(w)}else E.atoms=E.frames[h],S();E.molObj=null,E.modelDatas&&h<E.modelDatas.length&&(E.modelData=E.modelDatas[h],E.unitCellObjects&&m&&(m.removeUnitCell(E),m.addUnitCell(E)))})}addFrame(h){this.frames.push(h)}vibrate(h=10,f=1,E=!1,m){var S=0,w=h;let v=this.viewer;E&&(S=-h,w=h),this.frames!==void 0&&this.frames.origIndex!==void 0?this.setFrame(this.frames.origIndex):this.setFrame(0),S<w&&(this.frames=[]),E&&(this.frames.origIndex=h);for(var A=S;A<w;A++){var M=[],T=this.frames.length;if(A==0&&!m){this.frames.push(this.atoms);continue}for(var R=0;R<this.atoms.length;R++){var P=(0,d.getAtomProperty)(this.atoms[R],"dx"),L=(0,d.getAtomProperty)(this.atoms[R],"dy"),O=(0,d.getAtomProperty)(this.atoms[R],"dz"),I=new s.Vector3(P,L,O),N=new s.Vector3(this.atoms[R].x,this.atoms[R].y,this.atoms[R].z),k=A*f/h;I.multiplyScalar(k),N.add(I);var U={};for(var F in this.atoms[R])U[F]=this.atoms[R][F];if(U.x=N.x,U.y=N.y,U.z=N.z,M.push(U),v&&m){var j=(0,d.extend)({},m),H=new s.Vector3(P,L,O);if(H.multiplyScalar(f),H.add(N),j.start=N,j.end=H,j.frame=T,!j.color){var B=U.style.sphere;B||(B=U.style.stick),B||(B=U.style.line),j.color=(0,d.getColorFromStyle)(U,B)}v.addArrow(j)}}this.frames.push(M)}}setAtomDefaults(h){for(let f=0;f<h.length;f++){let E=h[f];E&&(E.style=E.style||(0,d.deepCopy)(b.defaultAtomStyle),E.color=E.color||this.ElementColors[E.elem]||this.defaultColor,E.model=this.id,(E.clickable||E.hoverable)&&(E.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}))}}addMolData(h,f,E={}){var m=b.parseMolData(h,f,E);this.dontDuplicateAtoms=!E.duplicateAssemblyAtoms;var S=m.modelData;if(S&&(Array.isArray(S)?(this.modelData=S[0],E.frames&&(this.modelDatas=S)):this.modelData=S),m.box?this.box=m.box:this.box=null,this.frames.length==0){for(let v=0;v<m.length;v++)m[v].length!=0&&this.frames.push(m[v]);this.frames[0]&&(this.atoms=this.frames[0])}else if(E.frames)for(let v=0;v<m.length;v++)this.frames.push(m[v]);else for(var w=0;w<m.length;w++)this.addAtoms(m[w]);for(let v=0;v<this.frames.length;v++)this.setAtomDefaults(this.frames[v]);E.vibrate&&E.vibrate.frames&&E.vibrate.amplitude&&this.vibrate(E.vibrate.frames,E.vibrate.amplitude),E.style&&this.setStyle({},E.style)}setDontDuplicateAtoms(h){this.dontDuplicateAtoms=h}setModelData(h){this.modelData=h}propertyMatches(h,f){if(h==f)return!0;if(typeof f=="string"&&typeof h=="number"){var E=f.match(/(-?\d+)\s*-\s*(-?\d+)/);if(E){var m=parseInt(E[1]),S=parseInt(E[2]);if(E&&h>=m&&h<=S)return!0}}return!1}static deepCopyAndCache(h,f){if(typeof h!="object"||h==null||h instanceof b||h.__cache_created)return h;const E={};for(const m in h){const S=h[m];if(Array.isArray(S)){E[m]=[];for(let w=0;w<S.length;w++)E[m].push(b.deepCopyAndCache(S[w],f))}else typeof S=="object"&&m!="properties"&&m!="model"?E[m]=b.deepCopyAndCache(S,f):E[m]=S;if(m=="and"||m=="or"){const w=[];for(const v of E[m]){const A=new Set;for(const M of f.selectedAtoms(v))A.add(M.index);w.push(A)}if(m=="and"){const v=function(M,T){const R=new Set;for(const P of T)M.has(P)&&R.add(P);return R};let A=new Set(w[0]);for(const M of w.splice(1))A=v(A,M);E[m].__cached_results=A}else if(m=="or"){const v=new Set;for(const A of w)for(const M of A)v.add(M);E[m].__cached_results=v}}}return E.__cache_created=!0,E}atomIsSelected(h,f){if(typeof f>"u")return!0;var E=!!f.invert,m=!0;for(var S in f)if(S=="and"||S=="or"||S=="not"){if(S=="not"){if(this.atomIsSelected(h,f[S])){m=!1;break}}else if(f[S].__cached_results===void 0&&(f=b.deepCopyAndCache(f,this)),m=f[S].__cached_results.has(h.index),!m)break}else if(S==="predicate"){if(!f.predicate(h)){m=!1;break}}else if(S=="properties"&&h[S]){for(var w in f.properties)if(!w.startsWith("__cache")){if(typeof h.properties[w]>"u"){m=!1;break}if(h.properties[w]!=f.properties[w]){m=!1;break}}}else if(S=="model"){let T=f.model;if(typeof T=="number"&&T<0&&(T=this.viewer.getNextModelId()+T),Array.isArray(T)){let R=!1;for(let P=0;P<T.length;P++)if(T[P]==this||T[P]==this.id){R=!0;break}if(!R){m=!1;break}}else if(T!=this&&T!=this.id){m=!1;break}}else if(f.hasOwnProperty(S)&&!b.ignoredKeys.has(S)&&!S.startsWith("__cache")){if(typeof h[S]>"u"){m=!1;break}let T=!1;if(S==="bonds"){var v=f[S];if(v!=h.bonds.length){m=!1;break}}else if(Array.isArray(f[S])){var A=f[S],M=h[S];for(let R=0;R<A.length;R++)if(this.propertyMatches(M,A[R])){T=!0;break}if(!T){m=!1;break}}else{let R=f[S];if(!this.propertyMatches(h[S],R)){m=!1;break}}}return E?!m:m}static squaredDistance(h,f){var E=f.x-h.x,m=f.y-h.y,S=f.z-h.z;return E*E+m*m+S*S}expandAtomList(h,f){if(f<=0)return h;for(var E=(0,d.getExtent)(h,void 0),m=[[],[],[]],S=0;S<3;S++)m[0][S]=E[0][S]-f,m[1][S]=E[1][S]+f,m[2][S]=E[2][S];var w=[];for(let T=0;T<this.atoms.length;T++){var v=this.atoms[T].x,A=this.atoms[T].y,M=this.atoms[T].z;v>=m[0][0]&&v<=m[1][0]&&A>=m[0][1]&&A<=m[1][1]&&M>=m[0][2]&&M<=m[1][2]&&(v>=E[0][0]&&v<=E[1][0]&&A>=E[0][1]&&A<=E[1][1]&&M>=E[0][2]&&M<=E[1][2]||w.push(this.atoms[T]))}return w}static getFloat(h){return typeof h=="number"?h:parseFloat(h)}selectedAtoms(h,f){var E=[];h=b.deepCopyAndCache(h||{},this),f||(f=this.atoms);for(var m=f.length,S=0;S<m;S++){var w=f[S];w&&this.atomIsSelected(w,h)&&E.push(w)}if(h.hasOwnProperty("expand")){const U=b.getFloat(h.expand);let F=this.expandAtomList(E,U),j=E.length;const H=U*U;for(let B=0;B<F.length;B++)for(let V=0;V<j;V++){var v=b.squaredDistance(F[B],E[V]);v<H&&v>0&&E.push(F[B])}}if(h.hasOwnProperty("within")&&h.within.hasOwnProperty("sel")&&h.within.hasOwnProperty("distance")){var A=this.selectedAtoms(h.within.sel,this.atoms),M={};const U=b.getFloat(h.within.distance),F=U*U;for(let j=0;j<A.length;j++)for(let H=0;H<E.length;H++){let B=b.squaredDistance(A[j],E[H]);B<F&&B>0&&(M[H]=1)}var T=[];if(h.within.invert)for(let j=0;j<E.length;j++)M[j]||T.push(E[j]);else for(let j in M)T.push(E[j]);E=T}if(h.hasOwnProperty("byres")){var R={},P=[],L=[];for(let U=0;U<E.length;U++){let F=E[U];var O=F.chain,I=F.resi;if(R[O]===void 0&&(R[O]={}),F.hasOwnProperty("resi")&&R[O][I]===void 0){for(R[O][I]=!0,L.push(F);L.length>0;)if(F=L.pop(),O=F.chain,I=F.resi,P[F.index]===void 0){P[F.index]=!0;for(var N=0;N<F.bonds.length;N++){var k=this.atoms[F.bonds[N]];P[k.index]===void 0&&k.hasOwnProperty("resi")&&k.chain==O&&k.resi==I&&(L.push(k),E.push(k))}}}}}return E}addAtoms(h){this.molObj=null;var f=this.atoms.length,E=[],m;for(m=0;m<h.length;m++)typeof h[m].index>"u"&&(h[m].index=m),typeof h[m].serial>"u"&&(h[m].serial=m),E[h[m].index]=f+m;for(m=0;m<h.length;m++){var S=h[m],w=E[S.index],v=(0,d.extend)({},S);v.index=w,v.bonds=[],v.bondOrder=[],v.model=this.id,v.style=v.style||(0,d.deepCopy)(b.defaultAtomStyle),typeof v.color>"u"&&(v.color=this.ElementColors[v.elem]||this.defaultColor);for(var A=S.bonds?S.bonds.length:0,M=0;M<A;M++){var T=E[S.bonds[M]];typeof T<"u"&&(v.bonds.push(T),v.bondOrder.push(S.bondOrder?S.bondOrder[M]:1))}this.atoms.push(v)}}assignBonds(){(0,y.assignBonds)(this.atoms,{assignBonds:!0})}removeAtoms(h){this.molObj=null;var f=[],E;for(E=0;E<h.length;E++)f[h[E].index]=!0;var m=[];for(E=0;E<this.atoms.length;E++){var S=this.atoms[E];f[S.index]||m.push(S)}this.atoms=[],this.addAtoms(m)}setStyle(h,f,E){typeof f>"u"&&typeof E>"u"&&(f=h,h={}),h=h,typeof f=="string"&&(f=(0,d.specStringToObject)(f));var m=!1,S=this,w=function(A){var M=S.selectedAtoms(h,A);for(let T=0;T<A.length;T++)A[T]&&(A[T].capDrawn=!1);for(let T=0;T<M.length;T++){m=!0,(M[T].clickable||M[T].hoverable)&&(M[T].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]}),E||(M[T].style={});for(let R in f)f.hasOwnProperty(R)&&(M[T].style[R]=M[T].style[R]||{},Object.assign(M[T].style[R],f[R]))}};if(h.frame!==void 0&&h.frame<this.frames.length){let A=h.frame;A<0&&(A=this.frames.length+A),w(this.frames[A])}else{w(this.atoms);for(var v=0;v<this.frames.length;v++)this.frames[v]!==this.atoms&&w(this.frames[v])}m&&(this.molObj=null)}setClickable(h,f,E){if(f=!!f,E=(0,d.makeFunction)(E),E===null){console.log("Callback is not a function");return}var m=this.selectedAtoms(h,this.atoms),S=m.length;for(let w=0;w<S;w++)m[w].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},m[w].clickable=f,E&&(m[w].callback=E);S>0&&(this.molObj=null)}setHoverable(h,f,E,m){if(f=!!f,E=(0,d.makeFunction)(E),m=(0,d.makeFunction)(m),E===null){console.log("Hover_callback is not a function");return}if(m===null){console.log("Unhover_callback is not a function");return}var S=this.selectedAtoms(h,this.atoms),w=S.length;for(let v=0;v<w;v++)S[v].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},S[v].hoverable=f,E&&(S[v].hover_callback=E),m&&(S[v].unhover_callback=m);w>0&&(this.molObj=null)}enableContextMenu(h,f){f=!!f;var E,m=this.selectedAtoms(h,this.atoms),S=m.length;for(E=0;E<S;E++)m[E].intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},m[E].contextMenuEnabled=f;S>0&&(this.molObj=null)}setColorByElement(h,f){if(!(this.molObj!==null&&b.sameObj(f,this.lastColors))){this.lastColors=f;var E=this.selectedAtoms(h,E);E.length>0&&(this.molObj=null);for(var m=0;m<E.length;m++){var S=E[m];typeof f[S.elem]<"u"&&(S.color=f[S.elem])}}}setColorByProperty(h,f,E,m){var S,w,v=this.selectedAtoms(h,v);for(this.lastColors=null,v.length>0&&(this.molObj=null),typeof E=="string"&&typeof u.Gradient.builtinGradients[E]<"u"&&(E=new u.Gradient.builtinGradients[E]),E=E,m||(m=E.range()),m||(m=(0,d.getPropertyRange)(v,f)),S=0;S<v.length;S++){w=v[S];var A=(0,d.getAtomProperty)(w,f);A!=null&&(w.color=E.valueToHex(parseFloat(w.properties[f]),m))}}setColorByFunction(h,f){var E=this.selectedAtoms(h,E);if(typeof f=="function"){this.lastColors=null,E.length>0&&(this.molObj=null);for(let m=0;m<E.length;m++){let S=E[m];S.color=f(S)}}}toCDObject(h=!1){var f={a:[],b:[]};h&&(f.s=[]);for(let m=0;m<this.atoms.length;m++){let S={},w=this.atoms[m];if(S.x=w.x,S.y=w.y,S.z=w.z,w.elem!="C"&&(S.l=w.elem),h){for(var E=0;E<f.s.length&&JSON.stringify(w.style)!==JSON.stringify(f.s[E]);)E++;E===f.s.length&&f.s.push(w.style),E!==0&&(S.s=E)}f.a.push(S);for(let v=0;v<w.bonds.length;v++){let A=m,M=w.bonds[v];if(A>=M)continue;let T={b:A,e:M},R=w.bondOrder[v];R!=1&&(T.o=R),f.b.push(T)}}return f}globj(h,f){(this.molObj===null||f.regen)&&(this.molObj=this.createMolObj(this.atoms,f),this.renderedMolObj&&(h.remove(this.renderedMolObj),this.renderedMolObj=null),this.renderedMolObj=this.molObj.clone(),this.hidden&&(this.renderedMolObj.setVisible(!1),this.molObj.setVisible(!1)),h.add(this.renderedMolObj))}exportVRML(){var h=this.createMolObj(this.atoms,{supportsImposters:!1,supportsAIA:!1});return h.vrml()}removegl(h){this.renderedMolObj&&(this.renderedMolObj.geometry!==void 0&&this.renderedMolObj.geometry.dispose(),this.renderedMolObj.material!==void 0&&this.renderedMolObj.material.dispose(),h.remove(this.renderedMolObj),this.renderedMolObj=null),this.molObj=null}hide(){this.hidden=!0,this.renderedMolObj&&this.renderedMolObj.setVisible(!1),this.molObj&&this.molObj.setVisible(!1)}show(){this.hidden=!1,this.renderedMolObj&&this.renderedMolObj.setVisible(!0),this.molObj&&this.molObj.setVisible(!0)}addPropertyLabels(h,f,E){let m=this.selectedAtoms(f),S=this.viewer,w=(0,d.deepCopy)(E);for(let A=0;A<m.length;A++){let M=m[A];var v=null;typeof M[h]<"u"?v=String(M[h]):typeof M.properties[h]<"u"&&(v=String(M.properties[h])),v!=null&&(w.position=M,S.addLabel(v,w))}}addResLabels(h,f,E=!1){let m=this.viewer;var S=[],w=function(A,M){for(var T=A.selectedAtoms(h,T),R={},P=0;P<T.length;P++){var L=T[P],O=L.chain,I=L.resn,N=L.resi,k=I+""+N;R[O]||(R[O]={}),R[O][k]||(R[O][k]=[]),R[O][k].push(L)}var U=(0,d.deepCopy)(f);for(let j in R)if(R.hasOwnProperty(j)){var F=R[j];for(let H in F)if(F.hasOwnProperty(H)){let B=F[H],V=new s.Vector3(0,0,0);for(let q=0;q<B.length;q++){let Te=B[q];V.x+=Te.x,V.y+=Te.y,V.z+=Te.z}V.divideScalar(B.length),U.position=V,U.frame=M;let K=m.addLabel(H,U,void 0,!0);S.push(K)}}};if(E){var v=this.getNumFrames();let A=this.atoms;for(let M=0;M<v;M++)this.frames[M]&&(this.atoms=this.frames[M],w(this,M));this.atoms=A}else w(this);return S}setupDFS(){this.atomdfs=[];var h=this,f=new Int8Array(this.atoms.length);f.fill(0);for(var E=function(v,A,M){M.push([v,A]);var T=h.atoms[v];f[v]=1;for(var R=0;R<T.bonds.length;R++){var P=T.bonds[R];h.atoms[P]&&!f[P]&&E(P,v,M)}},m=0;m<this.atoms.length;m++){var S=this.atoms[m];if(S&&!f[m]){var w=[];E(m,-1,w),this.atomdfs.push(w)}}}setCoordinatesFromURL(h,f){this.frames=[];var E=this;return this.box&&this.setupDFS(),h.startsWith("http")||(h="http://"+h),(0,d.get)(h+"/traj/numframes/"+f,function(m){if(!isNaN(parseInt(m)))return E.frames.push(E.atoms),E.frames.numFrames=m,E.frames.url=h,E.frames.path=f,E.setFrame(0)})}setCoordinates(h,f){if(f=f||"",!h)return[];if(/\.gz$/.test(f)){f=f.replace(/\.gz$/,"");try{h=(0,d.inflateString)(h)}catch(R){console.log(R)}}var E={mdcrd:"",inpcrd:"",pdb:"",netcdf:"",array:""};if(E.hasOwnProperty(f)){this.frames=[];for(var m=this.atoms.length,S=b.parseCrd(h,f),w=0;w<S.length;){for(var v=[],A=0;A<m;A++){var M={};for(var T in this.atoms[A])M[T]=this.atoms[A][T];v[A]=M,v[A].x=S[w++],v[A].y=S[w++],v[A].z=S[w++]}this.frames.push(v)}return this.atoms=this.frames[0],this.frames}return[]}addAtomSpecs(h){}static parseCrd(h,f){var E=[],m=0;if(f=="pdb")for(var S=h.indexOf(`
ATOM`);S!=-1;){for(;h.slice(S,S+5)==`
ATOM`||h.slice(S,S+7)==`
HETATM`;)E[m++]=parseFloat(h.slice(S+31,S+39)),E[m++]=parseFloat(h.slice(S+39,S+47)),E[m++]=parseFloat(h.slice(S+47,S+55)),S=h.indexOf(`
`,S+54),h.slice(S,S+4)==`
TER`&&(S=h.indexOf(`
`,S+5));S=h.indexOf(`
ATOM`,S)}else if(f=="netcdf"){var w=new x.NetCDFReader(h);E=[].concat.apply([],w.getDataVariable("coordinates"))}else{if(f=="array"||Array.isArray(h))return h.flat(2);{let v=h.indexOf(`
`);f=="inpcrd"&&(v=h.indexOf(`
`,v+1)),h=h.slice(v+1),E=h.match(/\S+/g).map(parseFloat)}}return E}static parseMolData(h,f="",E){if(!h)return[];if(/\.gz$/.test(f)){f=f.replace(/\.gz$/,"");try{f.match(/bcif/i)?h=(0,d.inflateString)(h,!1):h=(0,d.inflateString)(h)}catch(w){console.log(w)}}typeof g.Parsers[f]>"u"&&(f=f.split(".").pop(),typeof g.Parsers[f]>"u"&&(console.log("Unknown format: "+f),h instanceof Uint8Array?f="bcif":h.match(/^@<TRIPOS>MOLECULE/gm)?f="mol2":h.match(/^data_/gm)&&h.match(/^loop_/gm)?f="cif":h.match(/^HETATM/gm)||h.match(/^ATOM/gm)?f="pdb":h.match(/ITEM: TIMESTEP/gm)?f="lammpstrj":h.match(/^.*\n.*\n.\s*(\d+)\s+(\d+)/gm)?f="sdf":h.match(/^%VERSION\s+VERSION_STAMP/gm)?f="prmtop":f="xyz",console.log("Best guess: "+f)));var m=g.Parsers[f],S=m(h,E);return S}}b.defaultAtomStyle={line:{}},b.defaultlineWidth=1,b.vdwRadii={H:1.2,He:1.4,Li:1.82,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Ni:1.63,Cu:1.4,Zn:1.39,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.85,Kr:2.02,Rb:3.03,Sr:2.49,Pd:1.63,Ag:1.72,Cd:1.58,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,Pt:1.75,Au:1.66,Hg:1.55,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,U:1.86},b.ignoredKeys=new Set(["props","invert","model","frame","byres","expand","within","and","or","not"])}),"./src/GLShape.ts":((r,e,t)=>{t.r(e),t.d(e,{GLShape:()=>x,splitMesh:()=>y});var n=t("./src/WebGL/index.ts"),i=t("./src/WebGL/shapes/index.ts"),s=t("./src/WebGL/math/index.ts"),o=t("./src/colors.ts"),a=t("./src/ProteinSurface4.ts"),l=t("./src/VolumeData.ts"),d=t("./src/GLDraw.ts"),u=t("./src/glcartoon.ts"),g=t("./src/utilities.ts");class x{static finalizeGeo(_){var h=_.updateGeoGroup(0);h.vertices>0&&h.truncateArrayBuffers(!0,!0)}static updateColor(_,h){h=h||o.CC.color(h),_.colorsNeedUpdate=!0;var f,E,m;h.constructor!==Array&&(f=h.r,E=h.g,m=h.b);for(let S in _.geometryGroups){let w=_.geometryGroups[S],v=w.colorArray;for(let A=0,M=w.vertices;A<M;++A){if(h.constructor===Array){let T=h[A];f=T.r,E=T.g,m=T.b}v[A*3]=f,v[A*3+1]=E,v[A*3+2]=m}}}static drawArrow(_,h,f){var E=f.start,m=f.end,S=f.radius,w=f.radiusRatio,v=f.mid,A=f.midpos;if(!(E&&m))return;var M=h.updateGeoGroup(51),T=new s.Vector3(m.x,m.y,m.z).sub(E);if(A){let c0=T.length();A>0?v=A/c0:v=(c0+A)/c0}T.multiplyScalar(v);var R=new s.Vector3(E.x,E.y,E.z).add(T),P=T.clone().negate();let L=new s.Vector3(E.x,E.y,E.z);_.intersectionShape.cylinder.push(new i.Cylinder(L,R.clone(),S)),_.intersectionShape.sphere.push(new i.Sphere(L,S));var O=[];O[0]=T.clone(),Math.abs(O[0].x)>1e-4?O[0].y+=1:O[0].x+=1,O[0].cross(T),O[0].normalize(),O[4]=O[0].clone(),O[4].crossVectors(O[0],T),O[4].normalize(),O[8]=O[0].clone().negate(),O[12]=O[4].clone().negate(),O[2]=O[0].clone().add(O[4]).normalize(),O[6]=O[4].clone().add(O[8]).normalize(),O[10]=O[8].clone().add(O[12]).normalize(),O[14]=O[12].clone().add(O[0]).normalize(),O[1]=O[0].clone().add(O[2]).normalize(),O[3]=O[2].clone().add(O[4]).normalize(),O[5]=O[4].clone().add(O[6]).normalize(),O[7]=O[6].clone().add(O[8]).normalize(),O[9]=O[8].clone().add(O[10]).normalize(),O[11]=O[10].clone().add(O[12]).normalize(),O[13]=O[12].clone().add(O[14]).normalize(),O[15]=O[14].clone().add(O[0]).normalize();var I=M.vertices,N=M.vertexArray,k=M.faceArray,U=M.normalArray,F=M.lineArray,j,H,B;for(H=0,B=O.length;H<B;++H){j=3*(I+3*H);var V=O[H].clone().multiplyScalar(S).add(E),K=O[H].clone().multiplyScalar(S).add(R),q=O[H].clone().multiplyScalar(S*w).add(R);if(N[j]=V.x,N[j+1]=V.y,N[j+2]=V.z,N[j+3]=K.x,N[j+4]=K.y,N[j+5]=K.z,N[j+6]=q.x,N[j+7]=q.y,N[j+8]=q.z,H>0){var Te=N[j-3],Fe=N[j-2],We=N[j-1],J=new s.Vector3(Te,Fe,We),et=new s.Vector3(m.x,m.y,m.z),ht=R.clone(),er=new s.Vector3(q.x,q.y,q.z);_.intersectionShape.triangle.push(new i.Triangle(er,et,J)),_.intersectionShape.triangle.push(new i.Triangle(J.clone(),ht,er.clone()))}}M.vertices+=48,j=M.vertices*3,N[j]=E.x,N[j+1]=E.y,N[j+2]=E.z,N[j+3]=R.x,N[j+4]=R.y,N[j+5]=R.z,N[j+6]=m.x,N[j+7]=m.y,N[j+8]=m.z,M.vertices+=3;var tr,Hm,oi,h0,l0,M0,U0,_0,C0,P0,R0,si,Xe,d0,w0,Q,it,ec,a0,u0=M.vertices-3,E0=M.vertices-2,O0=M.vertices-1,He=u0*3,p0=E0*3,x0=O0*3;for(H=0,B=O.length-1;H<B;++H){var L0=I+3*H;j=L0*3,Hm=M.faceidx,oi=M.lineidx,h0=L0,P0=h0*3,l0=L0+1,R0=l0*3,M0=L0+2,si=M0*3,U0=L0+4,Xe=U0*3,_0=L0+5,d0=_0*3,C0=L0+3,w0=C0*3,Q=it=O[H],ec=a0=O[H+1],U[P0]=Q.x,U[R0]=it.x,U[w0]=a0.x,U[P0+1]=Q.y,U[R0+1]=it.y,U[w0+1]=a0.y,U[P0+2]=Q.z,U[R0+2]=it.z,U[w0+2]=a0.z,U[R0]=it.x,U[Xe]=ec.x,U[w0]=a0.x,U[R0+1]=it.y,U[Xe+1]=ec.y,U[w0+1]=a0.y,U[R0+2]=it.z,U[Xe+2]=ec.z,U[w0+2]=a0.z,U[si]=it.x,U[d0]=ec.x,U[si+1]=it.y,U[d0+1]=ec.y,U[si+2]=it.z,U[d0+2]=ec.z,k[Hm]=h0,k[Hm+1]=l0,k[Hm+2]=C0,k[Hm+3]=l0,k[Hm+4]=U0,k[Hm+5]=C0,k[Hm+6]=h0,k[Hm+7]=C0,k[Hm+8]=u0,k[Hm+9]=M0,k[Hm+10]=E0,k[Hm+11]=_0,k[Hm+12]=M0,k[Hm+13]=O0,k[Hm+14]=_0,F[oi]=h0,F[oi+1]=l0,F[oi+2]=h0,F[oi+3]=C0,F[oi+4]=U0,F[oi+5]=C0,F[oi+6]=h0,F[oi+7]=C0,F[oi+8]=M0,F[oi+9]=l0,F[oi+10]=M0,F[oi+11]=_0,F[oi+12]=U0,F[oi+13]=_0,F[oi+14]=M0,F[oi+15]=O0,F[oi+16]=M0,F[oi+17]=_0,F[oi+18]=O0,F[oi+19]=_0,M.faceidx+=15,M.lineidx+=20}tr=[I+45,I+46,I+1,I,I+47,I+2],Hm=M.faceidx,oi=M.lineidx,h0=tr[0],P0=h0*3,l0=tr[1],R0=l0*3,M0=tr[4],si=M0*3,U0=tr[2],Xe=U0*3,_0=tr[5],d0=_0*3,C0=tr[3],w0=C0*3,Q=it=O[15],ec=a0=O[0],U[P0]=Q.x,U[R0]=it.x,U[w0]=a0.x,U[P0+1]=Q.y,U[R0+1]=it.y,U[w0+1]=a0.y,U[P0+2]=Q.z,U[R0+2]=it.z,U[w0+2]=a0.z,U[R0]=it.x,U[Xe]=ec.x,U[w0]=a0.x,U[R0+1]=it.y,U[Xe+1]=ec.y,U[w0+1]=a0.y,U[R0+2]=it.z,U[Xe+2]=ec.z,U[w0+2]=a0.z,U[si]=it.x,U[d0]=ec.x,U[si+1]=it.y,U[d0+1]=ec.y,U[si+2]=it.z,U[d0+2]=ec.z,T.normalize(),P.normalize(),U[He]=P.x,U[p0]=U[x0]=T.x,U[He+1]=P.y,U[p0+1]=U[x0+1]=T.y,U[He+2]=P.z,U[p0+2]=U[x0+2]=T.z,k[Hm]=h0,k[Hm+1]=l0,k[Hm+2]=C0,k[Hm+3]=l0,k[Hm+4]=U0,k[Hm+5]=C0,k[Hm+6]=h0,k[Hm+7]=C0,k[Hm+8]=u0,k[Hm+9]=M0,k[Hm+10]=E0,k[Hm+11]=_0,k[Hm+12]=M0,k[Hm+13]=O0,k[Hm+14]=_0,F[oi]=h0,F[oi+1]=l0,F[oi+2]=h0,F[oi+3]=C0,F[oi+4]=U0,F[oi+5]=C0,F[oi+6]=h0,F[oi+7]=C0,F[oi+8]=M0,F[oi+9]=l0,F[oi+10]=M0,F[oi+11]=_0,F[oi+12]=U0,F[oi+13]=_0,F[oi+14]=M0,F[oi+15]=O0,F[oi+16]=M0,F[oi+17]=_0,F[oi+18]=O0,F[oi+19]=_0,M.faceidx+=15,M.lineidx+=20}static updateBoundingFromPoints(_,h,f,E){_.center.set(0,0,0);let m=1/0,S=1/0,w=1/0,v=-1/0,A=-1/0,M=-1/0;_.box&&(m=_.box.min.x,v=_.box.max.x,S=_.box.min.y,A=_.box.max.y,w=_.box.min.z,M=_.box.max.z);for(let L=0,O=E;L<O;L++){var T=f[L*3],R=f[L*3+1],P=f[L*3+2];T<m&&(m=T),R<S&&(S=R),P<w&&(w=P),T>v&&(v=T),R>A&&(A=R),P>M&&(M=P)}_.center.set((v+m)/2,(A+S)/2,(M+w)/2),_.radius=_.center.distanceTo({x:v,y:A,z:M}),_.box={min:{x:m,y:S,z:w},max:{x:v,y:A,z:M}}}static addCustomGeo(_,h,f,E,m){var S=h.addGeoGroup(),w=f.vertexArr,v=f.normalArr,A=f.faceArr;S.vertices=w.length,S.faceidx=A.length;var M,T,R,P,L,O,I,N,k,U=S.vertexArray,F=S.colorArray;for(E.constructor!==Array&&(N=E.r,k=E.g,P=E.b),O=0,I=S.vertices;O<I;++O)M=O*3,T=w[O],U[M]=T.x,U[M+1]=T.y,U[M+2]=T.z,E.constructor===Array&&(L=E[O],N=L.r,k=L.g,P=L.b),F[M]=N,F[M+1]=k,F[M+2]=P;if(m)for(O=0,I=S.faceidx/3;O<I;++O){M=O*3,R=A[M],P=A[M+1],L=A[M+2];var j=new s.Vector3,H=new s.Vector3,B=new s.Vector3;_.intersectionShape.triangle.push(new i.Triangle(j.copy(w[R]),H.copy(w[P]),B.copy(w[L])))}if(m){var V=new s.Vector3(0,0,0),K=0;for(let Fe=0;Fe<h.geometryGroups.length;Fe++)V.add(h.geometryGroups[Fe].getCentroid()),K++;V.divideScalar(K),x.updateBoundingFromPoints(_.boundingSphere,{centroid:V},U,S.vertices)}if(S.faceArray=new Uint16Array(A),S.truncateArrayBuffers(!0,!0),v.length<S.vertices)S.setNormals();else{var q=S.normalArray=new Float32Array(S.vertices*3),Te;for(O=0,I=S.vertices;O<I;++O)M=O*3,Te=v[O],q[M]=Te.x,q[M+1]=Te.y,q[M+2]=Te.z}S.setLineIndices(),S.lineidx=S.lineArray.length}static updateFromStyle(_,h){typeof h.color<"u"?(_.color=h.color||new o.Color,h.color instanceof o.Color||(_.color=o.CC.color(h.color))):_.color=o.CC.color(0),_.wireframe=!!h.wireframe,_.opacity=h.alpha?(0,s.clamp)(h.alpha,0,1):1,typeof h.opacity<"u"&&(_.opacity=(0,s.clamp)(h.opacity,0,1)),_.side=h.side!==void 0?h.side:n.DoubleSide,_.linewidth=typeof h.linewidth>"u"?1:h.linewidth,_.clickable=!!h.clickable,_.callback=(0,g.makeFunction)(h.callback),_.hoverable=!!h.hoverable,_.hover_callback=(0,g.makeFunction)(h.hover_callback),_.unhover_callback=(0,g.makeFunction)(h.unhover_callback),_.contextMenuEnabled=!!h.contextMenuEnabled,_.hidden=h.hidden,_.frame=h.frame}constructor(_){this.color=16777215,this.hidden=!1,this.wireframe=!1,this.opacity=1,this.linewidth=1,this.clickable=!1,this.hoverable=!1,this.contextMenuEnabled=!1,this.side=n.DoubleSide,this.stylespec=_||{},this.boundingSphere=new i.Sphere,this.intersectionShape={sphere:[],cylinder:[],line:[],triangle:[]},x.updateFromStyle(this,this.stylespec),this.components=[],this.shapeObj=null,this.renderedShapeObj=null,this.geo=new n.Geometry(!0),this.linegeo=new n.Geometry(!0)}updateStyle(_){for(var h in _)this.stylespec[h]=_[h];if(x.updateFromStyle(this,this.stylespec),_.voldata&&_.volscheme){(0,g.adjustVolumeStyle)(_);const f=_.volscheme,E=_.voldata,m=o.CC,S=f.range()||[-1,1];this.geo.setColors(function(w,v,A){let M=E.getVal(w,v,A);return m.color(f.valueToHex(M,S))}),delete this.color}}addCustom(_){_.vertexArr=_.vertexArr||[],_.faceArr=_.faceArr||[],_.normalArr=_.normalArr||[],x.drawCustom(this,this.geo,_)}addSphere(_){_.center||(_.center=new s.Vector3(0,0,0)),_.radius=_.radius?(0,s.clamp)(_.radius,0,1/0):1.5,_.color=o.CC.color(_.color),this.intersectionShape.sphere.push(new i.Sphere(_.center,_.radius)),d.GLDraw.drawSphere(this.geo,_.center,_.radius,_.color,_.quality),this.components.push({centroid:new s.Vector3(_.center.x,_.center.y,_.center.z)});var h=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,h.vertexArray,h.vertices)}addBox(_){var h=_.dimensions||{w:1,h:1,d:1},f;typeof h.w=="number"?f={x:h.w,y:0,z:0}:f=h.w;var E;typeof h.h=="number"?E={x:0,y:h.h,z:0}:E=h.h;var m;typeof h.d=="number"?m={x:0,y:0,z:h.d}:m=h.d;var S=_.corner;S==null&&(_.center!==void 0?S={x:_.center.x-.5*(f.x+E.x+m.x),y:_.center.y-.5*(f.y+E.y+m.y),z:_.center.z-.5*(f.z+E.z+m.z)}:S={x:0,y:0,z:0});var w=[{x:S.x,y:S.y,z:S.z},{x:S.x+f.x,y:S.y+f.y,z:S.z+f.z},{x:S.x+E.x,y:S.y+E.y,z:S.z+E.z},{x:S.x+f.x+E.x,y:S.y+f.y+E.y,z:S.z+f.z+E.z},{x:S.x+m.x,y:S.y+m.y,z:S.z+m.z},{x:S.x+f.x+m.x,y:S.y+f.y+m.y,z:S.z+f.z+m.z},{x:S.x+E.x+m.x,y:S.y+E.y+m.y,z:S.z+E.z+m.z},{x:S.x+f.x+E.x+m.x,y:S.y+f.y+E.y+m.y,z:S.z+f.z+E.z+m.z}],v=[],A=[];v.splice(v.length,0,w[0],w[1],w[2],w[3]),A.splice(A.length,0,0,2,1,1,2,3);var M=4;v.splice(v.length,0,w[2],w[3],w[6],w[7]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4,v.splice(v.length,0,w[4],w[5],w[0],w[1]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4,v.splice(v.length,0,w[6],w[7],w[4],w[5]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4,v.splice(v.length,0,w[3],w[1],w[7],w[5]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4,v.splice(v.length,0,w[2],w[6],w[0],w[4]),A.splice(A.length,0,M+0,M+2,M+1,M+1,M+2,M+3),M+=4;var T=(0,g.extend)({},_);T.vertexArr=v,T.faceArr=A,T.normalArr=[],x.drawCustom(this,this.geo,T);var R=new s.Vector3;this.components.push({centroid:R.addVectors(w[0],w[7]).multiplyScalar(.5)});var P=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,P.vertexArray,P.vertices)}addCylinder(_){var h,f;_.start?h=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):h=new s.Vector3(0,0,0),_.end?(f=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),typeof f.x>"u"&&(f.x=3)):f=new s.Vector3(0,0,0);var E=_.radius||.1,m=o.CC.color(_.color);this.intersectionShape.cylinder.push(new i.Cylinder(h,f,E)),d.GLDraw.drawCylinder(this.geo,h,f,E,m,_.fromCap,_.toCap);var S=new s.Vector3;this.components.push({centroid:S.addVectors(h,f).multiplyScalar(.5)});var w=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,w.vertexArray,w.vertices)}addDashedCylinder(_){_.dashLength=_.dashLength||.25,_.gapLength=_.gapLength||.25;var h;_.start?h=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):h=new s.Vector3(0,0,0);var f;_.end?(f=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),typeof f.x>"u"&&(f.x=3)):f=new s.Vector3(3,0,0);for(var E=_.radius||.1,m=o.CC.color(_.color),S=Math.sqrt(Math.pow(h.x-f.x,2)+Math.pow(h.y-f.y,2)+Math.pow(h.z-f.z,2)),w=S/(_.gapLength+_.dashLength),v=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0),A=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),M=new s.Vector3((f.x-h.x)/(S/_.gapLength),(f.y-h.y)/(S/_.gapLength),(f.z-h.z)/(S/_.gapLength)),T=new s.Vector3((f.x-h.x)/(S/_.dashLength),(f.y-h.y)/(S/_.dashLength),(f.z-h.z)/(S/_.dashLength)),R=0;R<w;R++)A=new s.Vector3(v.x+T.x,v.y+T.y,v.z+T.z),this.intersectionShape.cylinder.push(new i.Cylinder(v,A,E)),d.GLDraw.drawCylinder(this.geo,v,A,E,m,_.fromCap,_.toCap),v=new s.Vector3(A.x+M.x,A.y+M.y,A.z+M.z);var P=new s.Vector3;this.components.push({centroid:P.addVectors(h,f).multiplyScalar(.5)});var L=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,L.vertexArray,L.vertices)}addCurve(_){_.points=_.points||[],_.smooth=_.smooth||10,typeof _.fromCap>"u"&&(_.fromCap=2),typeof _.toCap>"u"&&(_.toCap=2);var h=(0,u.subdivide_spline)(_.points,_.smooth);if(h.length<3){console.log("Too few points in addCurve");return}var f=_.radius||.1,E=o.CC.color(_.color),m=0,S=h.length-1,w=h[0].distanceTo(h[1]),v=Math.ceil(2*f/w);if(_.toArrow){S-=v;let R={start:h[S],end:h[h.length-1],radius:f,color:E,mid:1e-4};this.addArrow(R)}if(_.fromArrow){m+=v;let R={start:h[m],end:h[0],radius:f,color:E,mid:1e-4};this.addArrow(R)}for(var A=Math.ceil(h.length/2),M={radius:f,color:E,fromCap:2,toCap:2},T=m;T<S;T++)M.start=h[T],M.end=h[T+1],M.fromCap=2,M.toCap=2,T<A?(M.fromCap=2,M.toCap=0):T>A?(M.fromCap=0,M.toCap=2):(M.fromCap=2,M.toCap=2),this.addCylinder(M)}addLine(_){var h,f;_.start?h=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):h=new s.Vector3(0,0,0),_.end?(f=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),typeof f.x>"u"&&(f.x=3)):f=new s.Vector3(3,0,0);var E=this.geo.updateGeoGroup(2),m=E.vertices,S=m*3,w=E.vertexArray;w[S]=h.x,w[S+1]=h.y,w[S+2]=h.z,w[S+3]=f.x,w[S+4]=f.y,w[S+5]=f.z,E.vertices+=2;var v=E.lineArray,A=E.lineidx;v[A]=m,v[A+1]=m+1,E.lineidx+=2;var M=new s.Vector3;this.components.push({centroid:M.addVectors(h,f).multiplyScalar(.5)}),E=this.geo.updateGeoGroup(0),x.updateBoundingFromPoints(this.boundingSphere,this.components,E.vertexArray,E.vertices)}addArrow(_){if(_.start?_.start=new s.Vector3(_.start.x||0,_.start.y||0,_.start.z||0):_.start=new s.Vector3(0,0,0),_.dir instanceof s.Vector3&&typeof _.length=="number"){var h=_.dir.clone().multiplyScalar(_.length).add(_.start);_.end=h}else _.end?(_.end=new s.Vector3(_.end.x,_.end.y||0,_.end.z||0),typeof _.end.x>"u"&&(_.end.x=3)):_.end=new s.Vector3(3,0,0);_.radius=_.radius||.1,_.radiusRatio=_.radiusRatio||1.618034,_.mid=0<_.mid&&_.mid<1?_.mid:.618034,x.drawArrow(this,this.geo,_);var f=new s.Vector3;this.components.push({centroid:f.addVectors(_.start,_.end).multiplyScalar(.5)});var E=this.geo.updateGeoGroup(0);x.updateBoundingFromPoints(this.boundingSphere,this.components,E.vertexArray,E.vertices)}static distance_from(_,h){return Math.sqrt(Math.pow(_.x-h.x,2)+Math.pow(_.y-h.y,2)+Math.pow(_.z-h.z,2))}static inSelectedRegion(_,h,f){for(var E=0;E<h.length;E++)if(x.distance_from(h[E],_)<=f)return!0;return!1}addIsosurface(_,h,f,E){var m=h.isoval!==void 0&&typeof h.isoval=="number"?h.isoval:0,S=!!h.voxel,w=h.smoothness===void 0?1:h.smoothness,v=_.size.x,A=_.size.y,M=_.size.z,T=new Int16Array(v*A*M),R=_.data,P,L;for(P=0,L=T.length;P<L;++P)T[P]=-1;var O=new Uint8Array(v*A*M);for(P=0,L=R.length;P<L;++P){var I=m>=0?R[P]-m:m-R[P];I>0&&(O[P]|=x.ISDONE)}var N=[],k=[];a.MarchingCube.march(O,N,k,{fulltable:!0,voxel:S,unitCube:_.unit,origin:_.origin,matrix:_.matrix,nX:v,nY:A,nZ:M}),!S&&w>0&&a.MarchingCube.laplacianSmooth(w,N,k);var U=[],F=[],j=[];if(h.selectedRegion&&h.coords===void 0&&(h.coords=h.selectedRegion),h.coords===void 0&&h.selection!==void 0&&(E?h.coords=E.selectedAtoms(h.selection):console.log("addIsosurface needs viewer is selection provided.")),h.coords!==void 0){var H=h.coords[0].x,B=h.coords[0].y,V=h.coords[0].z,K=h.coords[0].x,q=h.coords[0].y,Te=h.coords[0].z;for(let oi=0;oi<h.coords.length;oi++)h.coords[oi].x>H?H=h.coords[oi].x:h.coords[oi].x<K&&(K=h.coords[oi].x),h.coords[oi].y>B?B=h.coords[oi].y:h.coords[oi].y<q&&(q=h.coords[oi].y),h.coords[oi].z>V?V=h.coords[oi].z:h.coords[oi].z<Te&&(Te=h.coords[oi].z);var Fe=2;h.radius!==void 0&&(Fe=h.radius),h.selectedOffset!==void 0&&(Fe=h.selectedOffset),h.seldist!==void 0&&(Fe=h.seldist),K-=Fe,H+=Fe,q-=Fe,B+=Fe,Te-=Fe,V+=Fe;for(let oi=0;oi<N.length;oi++)N[oi].x>K&&N[oi].x<H&&N[oi].y>q&&N[oi].y<B&&N[oi].z>Te&&N[oi].z<V&&x.inSelectedRegion(N[oi],h.coords,Fe)?(U.push(F.length),F.push(N[oi])):U.push(-1);for(let oi=0;oi+2<k.length;oi+=3)U[k[oi]]!==-1&&U[k[oi+1]]!==-1&&U[k[oi+2]]!==-1&&(j.push(k[oi]-(k[oi]-U[k[oi]])),j.push(k[oi+1]-(k[oi+1]-U[k[oi+1]])),j.push(k[oi+2]-(k[oi+2]-U[k[oi+2]])));N=F,k=j}x.drawCustom(this,this.geo,{vertexArr:N,faceArr:k,normalArr:[],clickable:h.clickable,hoverable:h.hoverable}),this.updateStyle(h);var We=new s.Vector3(_.origin.x,_.origin.y,_.origin.z),J=new s.Vector3(_.size.x*_.unit.x,_.size.y*_.unit.y,_.size.z*_.unit.z),et=new s.Vector3(0,0,0),ht=We.clone(),er=We.clone().add(J);for(let oi=0;oi<N.length;oi++)et.add(N[oi]),ht.max(N[oi]),er.min(N[oi]);et.divideScalar(N.length);var tr=et.distanceTo(er),Hm=et.distanceTo(ht);this.boundingSphere.center=et,this.boundingSphere.radius=Math.max(tr,Hm),typeof f=="function"&&f()}addVolumetricData(_,h,f){_=new l.VolumeData(_,h),this.addIsosurface(_,f)}finalize(){return x.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.geo}globj(_){if(this.renderedShapeObj&&(_.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){x.finalizeGeo(this.geo),this.geo.initTypedArrays(),this.wireframe&&this.geo.setUpWireframe(),typeof this.color<"u"&&x.updateColor(this.geo,this.color),this.shapeObj=new n.Object3D;var h=null;this.side==n.DoubleSide?h=new n.MeshDoubleLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:n.Coloring.VertexColors}):h=new n.MeshLambertMaterial({wireframe:this.wireframe,side:this.side,transparent:this.opacity<1,opacity:this.opacity,wireframeLinewidth:this.linewidth,vertexColors:n.Coloring.VertexColors});var f=new n.Mesh(this.geo,h);if(this.shapeObj.add(f),this.linegeo&&this.linegeo.vertices>0){var E=new n.LineBasicMaterial({linewidth:this.linewidth,color:this.color}),m=new n.Line(this.linegeo,E,n.LineStyle.LinePieces);this.shapeObj.add(m)}this.renderedShapeObj=this.shapeObj.clone(),_.add(this.renderedShapeObj)}}removegl(_){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),_.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}x.ISDONE=2,x.drawCustom=function(b,_,h){var f=h,E=f.vertexArr,m=f.faceArr;(E.length===0||m.length===0)&&console.warn("Error adding custom shape component: No vertices and/or face indices supplied!");var S=h.color;typeof S>"u"&&(S=b.color),S=o.CC.color(S);for(var w=y(f),v=0,A=w.length;v<A;v++)x.addCustomGeo(b,_,w[v],w[v].colorArr?w[v].colorArr:S,h.clickable)};function y(b){var _=64e3;if(b.vertexArr.length<_)return[b];var h=[{vertexArr:[],normalArr:[],faceArr:[]}];b.colorArr&&(h.colorArr=[]);var f=[],E=[],m=0,S=b.faceArr;for(let v=0,A=S.length;v<A;v+=3){let M=h[m];for(let T=0;T<3;T++){var w=S[v+T];f[w]!==m&&(f[w]=m,E[w]=M.vertexArr.length,M.vertexArr.push(b.vertexArr[w]),b.normalArr&&b.normalArr[w]&&M.normalArr.push(b.normalArr[w]),b.colorArr&&b.colorArr[w]&&M.colorArr.push(b.colorArr[w])),M.faceArr.push(E[w])}M.vertexArr.length>=_&&(h.push({vertexArr:[],normalArr:[],faceArr:[]}),b.colorArr&&(h.colorArr=[]),m++)}return h}}),"./src/GLViewer.ts":((r,e,t)=>{t.r(e),t.d(e,{CONTEXTS_PER_VIEWPORT:()=>_,GLViewer:()=>f,createStereoViewer:()=>S,createViewer:()=>E,createViewerGrid:()=>m});var n=t("./node_modules/upng-js/UPNG.js"),i=t("./src/GLModel.ts"),s=t("./src/GLShape.ts"),o=t("./src/Gradient.ts"),a=t("./src/Label.ts"),l=t("./src/ProteinSurface4.ts"),d=t("./src/VolumeData.ts"),u=t("./src/VolumetricRender.ts"),g=t("./src/WebGL/index.ts"),x=t("./src/WebGL/math/index.ts"),y=t("./src/colors.ts"),b=t("./src/utilities.ts");const _=16;class h extends Array{constructor(v){super(...v)}getSymmetries(){if(this.length==0)return[];let v=this[0];return typeof v.symmetries>"u"&&this.setSymmetries([new x.Matrix4]),v.symmetries}setSymmetries(v){typeof v>"u"&&(v=[new x.Matrix4]);for(let A of this)A.symmetries=v,A.finished=!1}}class f{getWidth(){let v=this.container,A=v.offsetWidth;if(A==0&&v.style.display==="none"){let M=v.style.position,T=v.style.visibility;v.style.display="block",v.style.visibility="hidden",v.style.position="absolute",A=v.offsetWidth,v.style.display="none",v.style.visibility=T,v.style.position=M}return A}getHeight(){let v=this.container,A=v.offsetHeight;if(A==0&&v.style.display==="none"){let M=v.style.position,T=v.style.visibility;v.style.display="block",v.style.visibility="hidden",v.style.position="absolute",A=v.offsetHeight,v.style.display="none",v.style.visibility=T,v.style.position=M}return A}setupRenderer(){let v=Object.assign(Object.assign({},this.config),{preserveDrawingBuffer:!0,premultipliedAlpha:!1,containerWidth:this.WIDTH,containerHeight:this.HEIGHT});this.renderer=new g.Renderer(v),this.renderer.domElement.style.width="100%",this.renderer.domElement.style.height="100%",this.renderer.domElement.style.padding="0",this.renderer.domElement.style.position="absolute",this.renderer.domElement.style.top="0px",this.renderer.domElement.style.left="0px",this.renderer.domElement.style.zIndex="0"}initializeScene(){this.scene=new g.Scene,this.scene.fog=new g.Fog(this.bgColor,100,200),this.modelGroup=new g.Object3D,this.rotationGroup=new g.Object3D,this.rotationGroup.useQuaternion=!0,this.rotationGroup.quaternion=new x.Quaternion(0,0,0,1),this.rotationGroup.add(this.modelGroup),this.scene.add(this.rotationGroup);var v=new g.Light(16777215);v.position=new x.Vector3(.2,.2,1).normalize(),v.intensity=1,this.scene.add(v)}_handleLostContext(v){const A=function(M){const T=M.getBoundingClientRect();return!(T.right<0||T.bottom<0||T.top>(window.innerHeight||document.documentElement.clientHeight)||T.left>(window.innerWidth||document.documentElement.clientWidth))};if(A(this.container)){let M=0;for(let T of document.getElementsByTagName("canvas"))if(A(T)&&T._3dmol_viewer!=null&&(T._3dmol_viewer.resize(),M+=1,M>=_))break}}initContainer(v){this.container=v,this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.container.append(this.renderer.domElement),this.glDOM=this.renderer.domElement,this.glDOM._3dmol_viewer=this,this.glDOM.addEventListener("webglcontextlost",this._handleLostContext.bind(this)),this.nomouse||(this.glDOM.addEventListener("mousedown",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("touchstart",this._handleMouseDown.bind(this),{passive:!1}),this.glDOM.addEventListener("wheel",this._handleMouseScroll.bind(this),{passive:!1}),this.glDOM.addEventListener("mousemove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("touchmove",this._handleMouseMove.bind(this),{passive:!1}),this.glDOM.addEventListener("contextmenu",this._handleContextMenu.bind(this),{passive:!1}))}decAnim(){this.animated--,this.animated<0&&(this.animated=0)}incAnim(){this.animated++}nextSurfID(){var v=0;for(let M in this.surfaces)if(this.surfaces.hasOwnProperty(M)){var A=parseInt(M);isNaN(A)||A>v&&(v=A)}return v+1}setSlabAndFog(){let v=this.camera.position.z-this.rotationGroup.position.z;v<1&&(v=1),this.camera.near=v+this.slabNear,!this.camera.ortho&&this.camera.near<1&&(this.camera.near=1),this.camera.far=v+this.slabFar,this.camera.near+1>this.camera.far&&(this.camera.far=this.camera.near+1),this.camera.fov=this.fov,this.camera.right=v*Math.tan(Math.PI/180*this.fov),this.camera.left=-this.camera.right,this.camera.top=this.camera.right/this.ASPECT,this.camera.bottom=-this.camera.top,this.camera.updateProjectionMatrix(),this.scene.fog.near=this.camera.near+this.fogStart*(this.camera.far-this.camera.near),this.scene.fog.far=this.camera.near+this.fogEnd*(this.camera.far-this.camera.near),this.config.disableFog&&(this.scene.fog.near=this.scene.fog.far)}show(v){if(this.renderer.setViewport(),!!this.scene&&(this.setSlabAndFog(),this.renderer.render(this.scene,this.camera),this.viewChangeCallback&&this.viewChangeCallback(this._viewer.getView()),!v&&this.linkedViewers.length>0))for(var A=this._viewer.getView(),M=0;M<this.linkedViewers.length;M++){var T=this.linkedViewers[M];T.setView(A,!0)}}updateClickables(){this.clickables.splice(0,this.clickables.length),this.hoverables.splice(0,this.hoverables.length),this.contextMenuEnabledObjects.splice(0,this.contextMenuEnabledObjects.length);for(let v=0,A=this.models.length;v<A;v++){let M=this.models[v];if(M){let T=M.selectedAtoms({clickable:!0}),R=M.selectedAtoms({hoverable:!0}),P=M.selectedAtoms({contextMenuEnabled:!0});for(let L=0;L<R.length;L++)this.hoverables.push(R[L]);for(let L=0;L<T.length;L++)this.clickables.push(T[L]);for(let L=0;L<P.length;L++)this.contextMenuEnabledObjects.push(P[L])}}for(let v=0,A=this.shapes.length;v<A;v++){let M=this.shapes[v];M&&M.clickable&&this.clickables.push(M),M&&M.hoverable&&this.hoverables.push(M),M&&M.contextMenuEnabled&&this.contextMenuEnabledObjects.push(M)}}handleClickSelection(v,A,M){let T=this.targetedObjects(v,A,this.clickables);if(T.length){var R=T[0].clickable;R.callback!==void 0&&(typeof R.callback!="function"&&(R.callback=(0,b.makeFunction)(R.callback)),typeof R.callback=="function"&&(this.mouseButton===3&&this.contextMenuEnabledObjects.includes(R)&&this.userContextMenuHandler||R.callback(R,this._viewer,M,this.container,T)))}}canvasOffset(){let v=this.glDOM,A=v.getBoundingClientRect(),M=v.ownerDocument,T=M.documentElement,R=M.defaultView;return{top:A.top+R.pageYOffset-T.clientTop,left:A.left+R.pageXOffset-T.clientLeft}}setHover(v,A,M){this.current_hover!=v&&(this.current_hover&&(typeof this.current_hover.unhover_callback!="function"&&(this.current_hover.unhover_callback=(0,b.makeFunction)(this.current_hover.unhover_callback)),this.current_hover.unhover_callback(this.current_hover,this._viewer,A,this.container,M)),this.current_hover=v,v&&v.hover_callback!==void 0&&(typeof v.hover_callback!="function"&&(v.hover_callback=(0,b.makeFunction)(v.hover_callback)),typeof v.hover_callback=="function"&&v.hover_callback(v,this._viewer,A,this.container,M)))}handleHoverSelection(v,A,M){if(this.hoverables.length==0)return;let T=this.targetedObjects(v,A,this.hoverables);if(T.length){var R=T[0].clickable;this.setHover(R,M,T),this.current_hover=R}else this.setHover(null)}handleHoverContinue(v,A){let M=this.targetedObjects(v,A,this.hoverables);(M.length==0||M[0]===void 0)&&this.setHover(null),M[0]!==void 0&&M[0].clickable!==this.current_hover&&this.setHover(null)}closeEnoughForClick(v,{allowTolerance:A=v.targetTouches,tolerance:M=5}={}){const T=this.getX(v),R=this.getY(v);if(A){const P=Math.abs(T-this.mouseStartX),L=Math.abs(R-this.mouseStartY);return P<=M&&L<=M}else return T===this.mouseStartX&&R===this.mouseStartY}calcTouchDistance(v){var A=v.targetTouches[0].pageX-v.targetTouches[1].pageX,M=v.targetTouches[0].pageY-v.targetTouches[1].pageY;return Math.hypot(A,M)}getX(v){var A=v.pageX;return A==null&&(A=v.pageX),v.targetTouches&&v.targetTouches[0]?A=v.targetTouches[0].pageX:v.changedTouches&&v.changedTouches[0]&&(A=v.changedTouches[0].pageX),A}getY(v){var A=v.pageY;return A==null&&(A=v.pageY),v.targetTouches&&v.targetTouches[0]?A=v.targetTouches[0].pageY:v.changedTouches&&v.changedTouches[0]&&(A=v.changedTouches[0].pageY),A}isInViewer(v,A){if(this.viewers!=null){var M=this.WIDTH/this.cols,T=this.HEIGHT/this.rows,R=this.canvasOffset(),P=v-R.left,L=A-R.top,O=this.rows-Math.floor(L/T)-1,I=Math.floor(P/M);if(O!=this.row||I!=this.col)return!1}return!0}adjustZoomToLimits(v){if(this.config.lowerZoomLimit&&this.config.lowerZoomLimit>0){let A=this.CAMERA_Z-this.config.lowerZoomLimit;v>A&&(v=A)}if(this.config.upperZoomLimit&&this.config.upperZoomLimit>0){let A=this.CAMERA_Z-this.config.upperZoomLimit;v<A&&(v=A)}return v>this.CAMERA_Z-1&&(v=this.CAMERA_Z-1),v}static slerp(v,A,M){if(M==1)return A.clone();if(M==0)return v.clone();let T=v.x*A.x+v.y*A.y+v.z*A.z+v.w*A.w;if(T>.9995){let k=new x.Quaternion(v.x+M*(A.x-v.x),v.y+M*(A.y-v.y),v.z+M*(A.z-v.z),v.w+M*(A.w-v.w));return k.normalize(),k}T<0&&(A=A.clone().multiplyScalar(-1),T=-T),T>1?T=1:T<-1&&(T=-1);var R=Math.acos(T),P=R*M,L=A.clone();L.sub(v.clone().multiplyScalar(T)),L.normalize();var O=Math.cos(P),I=Math.sin(P),N=new x.Quaternion(v.x*O+L.x*I,v.y*O+L.y*I,v.z*O+L.z*I,v.w*O+L.w*I);return N.normalize(),N}constructor(v,A={}){if(this.nomouse=!1,this.glDOM=null,this.models=[],this.surfaces={},this.shapes=[],this.labels=[],this.clickables=[],this.hoverables=[],this.contextMenuEnabledObjects=[],this.current_hover=null,this.hoverDuration=500,this.longTouchDuration=1e3,this.viewer_frame=0,this.viewChangeCallback=null,this.stateChangeCallback=null,this.NEAR=1,this.FAR=800,this.CAMERA_Z=150,this.fov=20,this.linkedViewers=[],this.renderer=null,this.control_all=!1,this.scene=null,this.rotationGroup=null,this.modelGroup=null,this.fogStart=.4,this.fogEnd=1,this.slabNear=-50,this.slabFar=50,this.cq=new x.Quaternion(0,0,0,1),this.dq=new x.Quaternion(0,0,0,1),this.animated=0,this.animationTimers=new Set,this.isDragging=!1,this.mouseStartX=0,this.mouseStartY=0,this.touchDistanceStart=0,this.touchHold=!1,this.currentModelPos=0,this.cz=0,this.cslabNear=0,this.cslabFar=0,this.userContextMenuHandler=null,this.config=A,this.callback=this.config.callback,this.defaultcolors=this.config.defaultcolors,this.defaultcolors||(this.defaultcolors=y.elementColors.defaultColors),this.nomouse=!!this.config.nomouse,this.bgColor=0,this.config.backgroundColor=this.config.backgroundColor||"#ffffff",typeof this.config.backgroundColor<"u"&&(this.bgColor=y.CC.color(this.config.backgroundColor).getHex()),this.config.backgroundAlpha=this.config.backgroundAlpha==null?1:this.config.backgroundAlpha,this.camerax=0,typeof this.config.camerax<"u"&&(this.camerax=typeof this.config.camerax=="string"?parseFloat(this.config.camerax):this.config.camerax),this._viewer=this,this.container=v,this.config.hoverDuration!=null&&(this.hoverDuration=this.config.hoverDuration),this.config.antialias===void 0&&(this.config.antialias=!0),this.config.cartoonQuality===void 0&&(this.config.cartoonQuality=10),this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight(),this.setupRenderer(),this.row=this.config.row==null?0:this.config.row,this.col=this.config.col==null?0:this.config.col,this.cols=this.config.cols,this.rows=this.config.rows,this.viewers=this.config.viewers,this.control_all=this.config.control_all,this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.camera=new g.Camera(this.fov,this.ASPECT,this.NEAR,this.FAR,this.config.orthographic),this.camera.position=new x.Vector3(this.camerax,0,this.CAMERA_Z),this.lookingAt=new x.Vector3,this.camera.lookAt(this.lookingAt),this.raycaster=new g.Raycaster(new x.Vector3(0,0,0),new x.Vector3(0,0,0)),this.projector=new g.Projector,this.initializeScene(),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),this.scene.fog.color=y.CC.color(this.bgColor),document.body.addEventListener("mouseup",this._handleMouseUp.bind(this)),document.body.addEventListener("touchend",this._handleMouseUp.bind(this)),this.initContainer(this.container),this.config.style&&this.setViewStyle(this.config),window.addEventListener("resize",this.resize.bind(this)),typeof window.ResizeObserver<"u"&&(this.divwatcher=new window.ResizeObserver(this.resize.bind(this)),this.divwatcher.observe(this.container)),typeof window.IntersectionObserver<"u"){let M=(T,R)=>{T.forEach(P=>{P.isIntersecting&&this.resize()})};this.intwatcher=new window.IntersectionObserver(M),this.intwatcher.observe(this.container)}try{typeof this.callback=="function"&&this.callback(this)}catch(M){console.log("error with glviewer callback: "+M)}}targetedObjects(v,A,M){var T={x:v,y:A,z:-1};return Array.isArray(M)||(M=this.selectedAtoms(M)),M.length==0?[]:(this.raycaster.setFromCamera(T,this.camera),this.raycaster.intersectObjects(this.modelGroup,M))}modelToScreen(v){let A=!1;Array.isArray(v)||(v=[v],A=!0);let M=this.renderer.getXRatio(),T=this.renderer.getYRatio(),R=this.col,P=this.row,L=R*(this.WIDTH/M),O=(T-P-1)*(this.HEIGHT/T),I=[],N=this.canvasOffset();return v.forEach(k=>{let U=new x.Vector3(k.x,k.y,k.z);U.applyMatrix4(this.modelGroup.matrixWorld),this.projector.projectVector(U,this.camera);let F=this.WIDTH/M*(U.x+1)/2+N.left+L,j=-(this.HEIGHT/T)*(U.y-1)/2+N.top+O;I.push({x:F,y:j})}),A&&(I=I[0]),I}screenOffsetToModel(v,A,M){var T=v/this.WIDTH,R=A/this.HEIGHT,P=M===void 0?this.rotationGroup.position.z:M,L=this.rotationGroup.quaternion,O=new x.Vector3(0,0,P);return this.projector.projectVector(O,this.camera),O.x+=T*2,O.y-=R*2,this.projector.unprojectVector(O,this.camera),O.z=0,O.applyQuaternion(L),O}screenToModelDistance(v,A){let M=this.canvasOffset(),T=new x.Vector3(A.x,A.y,A.z);T.applyMatrix4(this.modelGroup.matrixWorld);let R=T.clone();this.projector.projectVector(T,this.camera);let P=new x.Vector3((v.x-M.left)*2/this.WIDTH-1,(v.y-M.top)*2/-this.HEIGHT+1,T.z);return this.projector.unprojectVector(P,this.camera),P.distanceTo(R)}setViewChangeCallback(v){(typeof v=="function"||v==null)&&(this.viewChangeCallback=v)}setStateChangeCallback(v){(typeof v=="function"||v==null)&&(this.stateChangeCallback=v)}getConfig(){return this.config}setConfig(v){this.config=v,v.ambientOcclusion&&this.renderer.enableAmbientOcclusion(v.ambientOcclusion)}getInternalState(){var v={models:[],surfaces:[],shapes:[],labels:[]};for(let A=0;A<this.models.length;A++)this.models[A]&&(v.models[A]=this.models[A].getInternalState());return v}setInternalState(v){this.clear();var A=v.models;for(let M=0;M<A.length;M++)A[M]&&(this.models[M]=new i.GLModel(M,void 0,this),this.models[M].setInternalState(A[M]));this.render()}setZoomLimits(v,A){typeof v<"u"&&(this.config.lowerZoomLimit=v),A&&(this.config.upperZoomLimit=A),this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}setCameraParameters(v){v.fov!==void 0&&(this.fov=v.fov,this.camera.fov=this.fov),v.z!==void 0&&(this.CAMERA_Z=v.z,this.camera.z=this.CAMERA_Z),v.orthographic!==void 0&&(this.camera.ortho=v.orthographic),this.setSlabAndFog()}_handleMouseDown(v){if(v.preventDefault(),!this.scene)return;var A=this.getX(v),M=this.getY(v);if(A===void 0)return;this.isDragging=!0,this.mouseButton=v.which,this.mouseStartX=A,this.mouseStartY=M,this.touchHold=!0,this.touchDistanceStart=0,v.targetTouches&&v.targetTouches.length==2&&(this.touchDistanceStart=this.calcTouchDistance(v)),this.cq=this.rotationGroup.quaternion.clone(),this.cz=this.rotationGroup.position.z,this.currentModelPos=this.modelGroup.position.clone(),this.cslabNear=this.slabNear,this.cslabFar=this.slabFar;let T=this;v.targetTouches&&v.targetTouches.length===1&&(this.longTouchTimeout=setTimeout(function(){if(T.touchHold==!0){T.glDOM=T.renderer.domElement;const R=v.targetTouches[0],P=new PointerEvent("contextmenu",Object.assign(Object.assign({},v),{pageX:R.pageX,pageY:R.pageY,screenX:R.screenX,screenY:R.screenY,clientX:R.clientX,clientY:R.clientY}));T.glDOM.dispatchEvent(P)}},this.longTouchDuration))}_handleMouseUp(v){if(this.touchHold=!1,this.isDragging&&this.scene){var A=this.getX(v),M=this.getY(v);if(this.closeEnoughForClick(v)&&this.isInViewer(A,M)){let T=this.mouseXY(A,M);this.handleClickSelection(T.x,T.y,v)}}this.isDragging=!1}_handleMouseScroll(v){if(v.preventDefault(),!!this.scene){var A=this.getX(v),M=this.getY(v);if(A!==void 0&&!(!this.control_all&&!this.isInViewer(A,M))){var T=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,R=1;if(v.ctrlKey&&(R=-1),v.detail)this.rotationGroup.position.z+=R*T*v.detail/10;else if(v.wheelDelta){let P=v.wheelDelta*600/(v.wheelDelta+600);this.rotationGroup.position.z-=R*T*P/400}this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z),this.show()}}}pngURI(){return this.getCanvas().toDataURL("image/png")}apngURI(v){let A=this;return v=v||1,new Promise(function(M){let T=0,R=A.viewChangeCallback,P=[],L=[],O=Date.now();A.viewChangeCallback=function(){L.push(Date.now()-O),O=Date.now(),P.push(new Promise(I=>{A.getCanvas().toBlob(function(N){N.arrayBuffer().then(I)},"image/png")})),T+=1,T==v&&(A.viewChangeCallback=R,Promise.all(P).then(I=>{let N=[];for(let B=0;B<I.length;B++){let V=(0,n.decode)(I[B]);N.push((0,n.toRGBA8)(V)[0])}let k=A.getCanvas().width,U=A.getCanvas().height,F=(0,n.encode)(N,k,U,0,L),j=new Blob([F],{type:"image/png"}),H=new FileReader;H.onload=function(B){M(B.target.result)},H.readAsDataURL(j)}))}})}getCanvas(){return this.glDOM}getRenderer(){return this.renderer}setHoverDuration(v){this.hoverDuration=v}mouseXY(v,A){let M=this.canvasOffset(),T=this.renderer.getXRatio(),R=this.renderer.getYRatio(),P=this.col,L=this.row,O=P*(this.WIDTH/T),I=(R-L-1)*(this.HEIGHT/R),N=(v-M.left-O)/(this.WIDTH/T)*2-1,k=-((A-M.top-I)/(this.HEIGHT/R))*2+1;return{x:N,y:k}}_handleMouseMove(v){clearTimeout(this.hoverTimeout),v.preventDefault();let A=this.getX(v),M=this.getY(v);if(A===void 0)return;let T=this.renderer.getXRatio(),R=this.renderer.getYRatio(),P=this.mouseXY(A,M),L=this;this.current_hover!==null&&this.handleHoverContinue(P.x,P.y);var O=0;if(!(!this.control_all&&!this.isInViewer(A,M))&&this.scene&&(this.hoverables.length>0&&(this.hoverTimeout=setTimeout(function(){L.handleHoverSelection(P.x,P.y,v)},this.hoverDuration)),!!this.isDragging)){v.targetTouches&&(v.targetTouches.length>1||v.targetTouches.length===1&&!this.closeEnoughForClick(v))&&clearTimeout(this.longTouchTimeout);var I=(A-this.mouseStartX)/this.WIDTH,N=(M-this.mouseStartY)/this.HEIGHT;if(this.touchDistanceStart!=0&&v.targetTouches&&v.targetTouches.length==2){var k=this.calcTouchDistance(v);O=2,N=(k-this.touchDistanceStart)*2/(this.WIDTH+this.HEIGHT)}else v.targetTouches&&v.targetTouches.length==3&&(O=1);I*=T,N*=R;var U=Math.hypot(I,N),F;if(O==3||this.mouseButton==3&&v.ctrlKey)this.slabNear=this.cslabNear+I*100,this.slabFar=this.cslabFar-N*100;else if(O==2||this.mouseButton==3||v.shiftKey)F=(this.CAMERA_Z-this.rotationGroup.position.z)*.85,F<80&&(F=80),this.rotationGroup.position.z=this.cz+N*F,this.rotationGroup.position.z=this.adjustZoomToLimits(this.rotationGroup.position.z);else if(O==1||this.mouseButton==2||v.ctrlKey){var j=this.screenOffsetToModel(T*(A-this.mouseStartX),R*(M-this.mouseStartY));this.modelGroup.position.addVectors(this.currentModelPos,j)}else if((O===0||this.mouseButton==1)&&U!==0){var H=Math.sin(U*Math.PI)/U;this.dq.x=Math.cos(U*Math.PI),this.dq.y=0,this.dq.z=H*I,this.dq.w=-H*N,this.rotationGroup.quaternion.set(1,0,0,0),this.rotationGroup.quaternion.multiply(this.dq),this.rotationGroup.quaternion.multiply(this.cq)}this.show()}}_handleContextMenu(v){if(v.preventDefault(),this.closeEnoughForClick(v)){var T=this.mouseStartX,R=this.mouseStartY,M=this.canvasOffset();let P=this.mouseXY(T,R),L=P.x,O=P.y,I=this.targetedObjects(L,O,this.contextMenuEnabledObjects);var A=null;I.length&&(A=I[0].clickable);var M=this.canvasOffset(),T=this.mouseStartX-M.left,R=this.mouseStartY-M.top;this.userContextMenuHandler&&(this.userContextMenuHandler(A,T,R,I,v),this.isDragging=!1)}}setContainer(v){let A=(0,b.getElement)(v)||this.container;return this.initContainer(A),this}setBackgroundColor(v,A){(typeof A>"u"||A<0||A>1)&&(A=1);var M=y.CC.color(v);return this.scene.fog.color=M,this.bgColor=M.getHex(),this.renderer.setClearColorHex(M.getHex(),A),this.show(),this}setProjection(v){this.camera.ortho=v==="orthographic",this.setSlabAndFog()}setViewStyle(v){if(v=v||{},v.style=v.style||"",v.style.includes("outline")?this.renderer.enableOutline(v):this.renderer.disableOutline(),v.style.includes("ambientOcclusion")){var A={};v.strength&&(A.strength=v.strength),v.radius&&(A.radius=v.radius),this.renderer.enableAmbientOcclusion(A)}else this.renderer.disableAmbientOcclusion();return this}updateSize(){this.renderer.setSize(this.WIDTH,this.HEIGHT),this.ASPECT=this.renderer.getAspect(this.WIDTH,this.HEIGHT),this.renderer.setSize(this.WIDTH,this.HEIGHT),this.camera.aspect=this.ASPECT,this.camera.updateProjectionMatrix()}setWidth(v){return this.WIDTH=v||this.WIDTH,this.updateSize(),this}setHeight(v){return this.HEIGHT=v||this.HEIGHT,this.updateSize(),this}resize(){this.WIDTH=this.getWidth(),this.HEIGHT=this.getHeight();let v=!1;if(this.renderer.isLost()&&this.WIDTH>0&&this.HEIGHT>0){let A=!1,M=this.container.querySelector("canvas");M&&M!=this.renderer.getCanvas()?this.config.canvas=M:(M.remove(),this.config&&this.config.canvas!=null&&(delete this.config.canvas,A=!0)),this.setupRenderer(),this.initContainer(this.container),this.renderer.setClearColorHex(this.bgColor,this.config.backgroundAlpha),v=!0,A&&(this.config.canvas=this.renderer.getCanvas())}if(this.WIDTH==0||this.HEIGHT==0?this.animated&&this._viewer.pauseAnimate():this.animated&&this._viewer.resumeAnimate(),this.updateSize(),v){let A=this.renderer.supportedExtensions();if(A.regen=!0,this.viewers)for(let M=0,T=this.viewers.length;M<T;M++)for(let R=0,P=this.viewers[M].length;R<P;R++)this.viewers[M][R].render(null,A);this._viewer.render(null,A)}else this.WIDTH>0&&this.HEIGHT>0&&this.show();return this}getModel(v){return v===void 0?this.models.length==0?null:this.models[this.models.length-1]:v instanceof i.GLModel?v:v in this.models?this.models[v]:this.models.length==0?null:this.models[this.models.length-1]}spin(v,A=1,M=!1){if(clearInterval(this.spinInterval),typeof v>"u"&&(v="y"),typeof v=="boolean")if(v)v="y";else return;Array.isArray(v)&&(v={x:v[0],y:v[1],z:v[2]});var T=this;this.spinInterval=setInterval(function(){!T.getCanvas().isConnected&&T.renderer.isLost()&&clearInterval(T.spinInterval),(!M||T.container.checkVisibility&&T.container.checkVisibility())&&T.rotate(1*A,v)},25)}animateMotion(v,A,M,T,R,P){var L=20,O=Math.ceil(v/L);O<1&&(O=1),this.incAnim();var I={mpos:this.modelGroup.position.clone(),rz:this.rotationGroup.position.z,rot:this.rotationGroup.quaternion.clone(),cam:this.lookingAt.clone()};if(A){let U=new Array(O);for(let B=0;B<O;B++){let V=(B+1)/O,K={mpos:I.mpos,rz:I.rz,rot:I.rot};K.mpos=M.clone().sub(I.mpos).multiplyScalar(V).add(I.mpos),K.rz=I.rz+V*(T-I.rz),K.rot=f.slerp(I.rot,R,V),K.cam=P.clone().sub(I.cam).multiplyScalar(V).add(I.cam),U[B]=K}let F=0,j=this,H=function(){var B=U[F];F+=1,j.modelGroup.position=B.mpos,j.rotationGroup.position.z=B.rz,j.rotationGroup.quaternion=B.rot,j.camera.lookAt(B.cam),F<U.length?setTimeout(H,L):j.decAnim(),j.show()};setTimeout(H,L)}else{var N={};let U=1/O;if(M&&(N.mpos=M.clone().sub(I.mpos).multiplyScalar(U)),typeof T<"u"&&T!=null&&(N.rz=U*(T-I.rz)),R){var k=f.slerp(I.rot,R,U);N.rot=I.rot.clone().inverse().multiply(k)}P&&(N.cam=P.clone().sub(I.cam).multiplyScalar(U));let F=0,j=this,H=function(){F+=1,N.mpos&&j.modelGroup.position.add(N.mpos),N.rz&&(j.rotationGroup.position.z+=N.rz),N.rot&&j.rotationGroup.quaternion.multiply(N.rot),N.cam&&(j.lookingAt.add(N.cam),j.camera.lookAt(j.lookingAt)),F<O?setTimeout(H,L):j.decAnim(),j.show()};setTimeout(H,L)}}rotate(v,A="y",M=0,T=!1){if(A=="x"?A={x:1,y:0,z:0}:A=="y"?A={x:0,y:1,z:0}:A=="z"&&(A={x:0,y:0,z:1}),A=="vx"?A={vx:1,vy:0,vz:0}:A=="vy"?A={vx:0,vy:1,vz:0}:A=="vz"&&(A={vx:0,vy:0,vz:1}),typeof A.vx<"u"){var R=new x.Vector3(A.vx,A.vy,A.vz);R.applyQuaternion(this.rotationGroup.quaternion),A={x:R.x,y:R.y,z:R.z}}var P=function(N){var k=Math.sin(N/2),U=Math.cos(N/2),F=0,j=0,H=0;return F=A.x*k,j=A.y*k,H=A.z*k,new x.Quaternion(F,j,H,U).normalize()},L=Math.PI*v/180,O=P(L);if(M){var I=new x.Quaternion().copy(this.rotationGroup.quaternion).multiply(O);this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,I,this.lookingAt)}else this.rotationGroup.quaternion.multiply(O),this.show();return this}surfacesFinished(){for(var v in this.surfaces)if(!this.surfaces[v][0].done)return!1;return!0}getView(){if(!this.modelGroup)return[0,0,0,0,0,0,0,1];var v=this.modelGroup.position,A=this.rotationGroup.quaternion;return[v.x,v.y,v.z,this.rotationGroup.position.z,A.x,A.y,A.z,A.w]}setView(v,A){return v===void 0||!(v instanceof Array||v.length!==8)?this:!this.modelGroup||!this.rotationGroup?this:(this.modelGroup.position.x=v[0],this.modelGroup.position.y=v[1],this.modelGroup.position.z=v[2],this.rotationGroup.position.z=v[3],this.rotationGroup.quaternion.x=v[4],this.rotationGroup.quaternion.y=v[5],this.rotationGroup.quaternion.z=v[6],this.rotationGroup.quaternion.w=v[7],typeof v[8]<"u"&&(this.rotationGroup.position.x=v[8],this.rotationGroup.position.y=v[9]),this.show(A),this)}render(v,A){this.renderer.setViewport(),this.updateClickables();var M=this.getView();this.stateChangeCallback&&this.stateChangeCallback(this.getInternalState());var T,R;for(A||(A=this.renderer.supportedExtensions()),T=0;T<this.models.length;T++)this.models[T]&&this.models[T].globj(this.modelGroup,A);for(T=0;T<this.shapes.length;T++)this.shapes[T]&&(typeof this.shapes[T].frame>"u"||this.viewer_frame<0||this.shapes[T].frame<0||this.shapes[T].frame==this.viewer_frame?this.shapes[T].globj(this.modelGroup,A):this.shapes[T].removegl(this.modelGroup));for(T=0;T<this.labels.length;T++)A.regen&&(this.labels[T].dispose(),this.modelGroup.remove(this.labels[T].sprite),this.labels[T].setContext(),this.modelGroup.add(this.labels[T].sprite)),this.labels[T]&&typeof this.labels[T].frame<"u"&&this.labels[T].frame>=0&&(this.modelGroup.remove(this.labels[T].sprite),(this.viewer_frame<0||this.labels[T].frame==this.viewer_frame)&&this.modelGroup.add(this.labels[T].sprite));for(T in this.surfaces)if(this.surfaces.hasOwnProperty(T)){var P=this.surfaces[T];for(R=0;R<P.length;R++)if(P.hasOwnProperty(R)){var L=P[R].geo;if(!P[R].finished||A.regen){L.verticesNeedUpdate=!0,L.elementsNeedUpdate=!0,L.normalsNeedUpdate=!0,L.colorsNeedUpdate=!0,L.buffersNeedUpdate=!0,P[R].mat.needsUpdate=!0,P[R].done&&(P[R].finished=!0),P[R].lastGL&&this.modelGroup.remove(P[R].lastGL);var O=null;if(P[R].mat instanceof g.LineBasicMaterial?O=new g.Line(L,P[R].mat):("wireframe"in P.style&&P.style.wireframe&&L.setUpWireframe(),O=new g.Mesh(L,P[R].mat)),P[R].mat.transparent&&P[R].mat.opacity==0?O.visible=!1:O.visible=!0,P[R].symmetries.length>1||P[R].symmetries.length==1&&!P[R].symmetries[0].isIdentity()){var I,N=new g.Object3D;for(I=0;I<P[R].symmetries.length;I++){var k=O.clone();k.matrix=P[R].symmetries[I],k.matrixAutoUpdate=!1,N.add(k)}P[R].lastGL=N,this.modelGroup.add(N)}else P[R].lastGL=O,this.modelGroup.add(O)}}}return this.setView(M),typeof v=="function"&&v(this),this}getModelList(v){let A=[];if(typeof v>"u"||typeof v.model>"u")for(let T=0;T<this.models.length;T++)this.models[T]&&A.push(this.models[T]);else{let T=v.model;Array.isArray(T)||(T=[T]);for(let R=0;R<T.length;R++)if(typeof T[R]=="number"){var M=T[R];M<0&&(M+=this.models.length),A.push(this.models[M])}else A.push(T[R])}return A}getAtomsFromSel(v){var A=[];typeof v>"u"&&(v={});var M=this.getModelList(v);for(let T=0;T<M.length;T++)A=A.concat(M[T].selectedAtoms(v));return A}atomIsSelected(v,A){typeof A>"u"&&(A={});for(var M=this.getModelList(A),T=0;T<M.length;T++)if(M[T].atomIsSelected(v,A))return!0;return!1}selectedAtoms(v){return this.getAtomsFromSel(v)}getUniqueValues(v,A){typeof A>"u"&&(A={});var M=this.getAtomsFromSel(A),T={};for(var R in M)if(M[R].hasOwnProperty(v)){var P=M[R][v];T[P]=!0}return Object.keys(T)}pdbData(v){for(var A=this.getAtomsFromSel(v),M="",T=0,R=A.length;T<R;++T)M+=A[T].pdbline+`
`;return M}zoom(v=2,A=0,M=!1){var T=(this.CAMERA_Z-this.rotationGroup.position.z)/v,R=this.CAMERA_Z-T;return A>0?this.animateMotion(A,M,this.modelGroup.position,this.adjustZoomToLimits(R),this.rotationGroup.quaternion,this.lookingAt):(this.rotationGroup.position.z=this.adjustZoomToLimits(R),this.show()),this}translate(v,A,M=0,T=!1){var R=v/this.WIDTH,P=A/this.HEIGHT,L=new x.Vector3(0,0,-this.CAMERA_Z);this.projector.projectVector(L,this.camera),L.x-=R,L.y-=P,this.projector.unprojectVector(L,this.camera),L.z=0;var O=this.lookingAt.clone().add(L);return M>0?this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,O):(this.lookingAt=O,this.camera.lookAt(this.lookingAt),this.show()),this}translateScene(v,A,M=0,T=!1){var R=this.screenOffsetToModel(v,A),P=this.modelGroup.position.clone().add(R);return M>0?this.animateMotion(M,T,this.modelGroup.position,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=P,this.show()),this}fitSlab(v){v=v||{};var A=this.getAtomsFromSel(v),M=(0,b.getExtent)(A),T=M[1][0]-M[0][0],R=M[1][1]-M[0][1],P=M[1][2]-M[0][2],L=Math.hypot(T,R,P);return L<5&&(L=5),this.slabNear=-L/1.9,this.slabFar=L/2,this}center(v={},A=0,M=!1){var T,R,P=this.getAtomsFromSel(v),L=(0,b.getExtent)(P);(0,b.isEmptyObject)(v)?(this.shapes.forEach(V=>{if(V&&V.boundingSphere&&V.boundingSphere.center){var K=V.boundingSphere.center,q=V.boundingSphere.radius;q>0?(P.push(new x.Vector3(K.x+q,K.y,K.z)),P.push(new x.Vector3(K.x-q,K.y,K.z)),P.push(new x.Vector3(K.x,K.y+q,K.z)),P.push(new x.Vector3(K.x,K.y-q,K.z)),P.push(new x.Vector3(K.x,K.y,K.z+q)),P.push(new x.Vector3(K.x,K.y,K.z-q))):P.push(K)}}),L=(0,b.getExtent)(P),T=P,R=L):(T=this.getAtomsFromSel({}),R=(0,b.getExtent)(T));var O=new x.Vector3(L[2][0],L[2][1],L[2][2]),I=R[1][0]-R[0][0],N=R[1][1]-R[0][1],k=R[1][2]-R[0][2],U=Math.hypot(I,N,k);U<5&&(U=5),this.slabNear=-U/1.9,this.slabFar=U/2,I=L[1][0]-L[0][0],N=L[1][1]-L[0][1],k=L[1][2]-L[0][2],U=Math.hypot(I,N,k),U<5&&(U=5);for(var F=25,j=0;j<P.length;j++)if(P[j]){var H=O.distanceToSquared(P[j]);H>F&&(F=H)}U=Math.sqrt(F)*2;var B=O.clone().multiplyScalar(-1);return A>0?this.animateMotion(A,M,B,this.rotationGroup.position.z,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=B,this.show()),this}zoomTo(v={},A=0,M=!1){let T=this.getAtomsFromSel(v),R=(0,b.getExtent)(T),P=R;if((0,b.isEmptyObject)(v)){let K=T&&T.length;if(this.shapes.forEach(q=>{if(q&&q.boundingSphere){if(q.boundingSphere.box){let We=q.boundingSphere.box;T.push(new x.Vector3(We.min.x,We.min.y,We.min.z)),T.push(new x.Vector3(We.max.x,We.max.y,We.max.z))}else if(q.boundingSphere.center){var Te=q.boundingSphere.center,Fe=q.boundingSphere.radius;Fe>0?(T.push(new x.Vector3(Te.x+Fe,Te.y,Te.z)),T.push(new x.Vector3(Te.x-Fe,Te.y,Te.z)),T.push(new x.Vector3(Te.x,Te.y+Fe,Te.z)),T.push(new x.Vector3(Te.x,Te.y-Fe,Te.z)),T.push(new x.Vector3(Te.x,Te.y,Te.z+Fe)),T.push(new x.Vector3(Te.x,Te.y,Te.z-Fe))):T.push(Te)}}}),P=(0,b.getExtent)(T),!K)for(let q=0;q<3;q++)R[2][q]=(P[0][q]+P[1][q])/2}else{let K=this.getAtomsFromSel({});P=(0,b.getExtent)(K)}var L=new x.Vector3(R[2][0],R[2][1],R[2][2]),O=P[1][0]-P[0][0],I=P[1][1]-P[0][1],N=P[1][2]-P[0][2],k=Math.hypot(O,I,N);k<5&&(k=5),this.slabNear=-k/1.9,this.slabFar=k/2,Object.keys(v).length===0&&(this.slabNear=Math.min(-k*2,-50),this.slabFar=Math.max(k*2,50));var U=this.config.minimumZoomToDistance||5;O=R[1][0]-R[0][0],I=R[1][1]-R[0][1],N=R[1][2]-R[0][2],k=Math.hypot(O,I,N),k<U&&(k=U);for(var F=U*U,j=0;j<T.length;j++)if(T[j]){var H=L.distanceToSquared(T[j]);H>F&&(F=H)}k=Math.sqrt(F)*2;var B=L.clone().multiplyScalar(-1),V=-(k*.5/Math.tan(Math.PI/180*this.camera.fov/2)-this.CAMERA_Z);return V=this.adjustZoomToLimits(V),A>0?this.animateMotion(A,M,B,V,this.rotationGroup.quaternion,this.lookingAt):(this.modelGroup.position=B,this.rotationGroup.position.z=V,this.show()),this}setSlab(v,A){this.slabNear=v,this.slabFar=A}getSlab(){return{near:this.slabNear,far:this.slabFar}}addLabel(v,A={},M,T=!1){if(M){var R=(0,b.getExtent)(this.getAtomsFromSel(M));A.position={x:R[2][0],y:R[2][1],z:R[2][2]}}var P=new a.Label(v,A);return P.setContext(),this.modelGroup.add(P.sprite),this.labels.push(P),T||this.show(),P}addResLabels(v,A,M=!1){let T=this.labels.length;return this.applyToModels("addResLabels",v,A,M),this.show(),this.labels.slice(T)}addPropertyLabels(v,A,M){return this.applyToModels("addPropertyLabels",v,A,M),this.show(),this}removeLabel(v){for(var A=0;A<this.labels.length;A++)if(this.labels[A]==v){this.labels.splice(A,1),v.dispose(),this.modelGroup.remove(v.sprite);break}return this.show(),this}removeAllLabels(){for(var v=0;v<this.labels.length;v++)this.labels[v]&&this.labels[v].sprite&&this.modelGroup.remove(this.labels[v].sprite);return this.labels.splice(0,this.labels.length),this.show(),this}hideAllLabels(){for(var v=0;v<this.labels.length;v++)this.labels[v]&&this.labels[v].hide();return this.show(),this}showAllLabels(){for(var v=0;v<this.labels.length;v++)this.labels[v]&&this.labels[v].show();return this.show(),this}setLabelStyle(v,A){return this.modelGroup.remove(v.sprite),v.dispose(),v.stylespec=A,v.setContext(),this.modelGroup.add(v.sprite),this.show(),v}setLabelText(v,A){return this.modelGroup.remove(v.sprite),v.dispose(),v.text=A,v.setContext(),this.modelGroup.add(v.sprite),this.show(),v}addShape(v){v=v||{};var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,this.shapes.push(A),A}removeShape(v){if(!v)return this;for(v.removegl(this.modelGroup),delete this.shapes[v.shapePosition];this.shapes.length>0&&typeof this.shapes[this.shapes.length-1]>"u";)this.shapes.pop();return this}removeAllShapes(){for(var v=0;v<this.shapes.length;v++){var A=this.shapes[v];A&&A.removegl(this.modelGroup)}return this.shapes.splice(0,this.shapes.length),this}getSelectionCenter(v){if(v.hasOwnProperty("x")&&v.hasOwnProperty("y")&&v.hasOwnProperty("z"))return v;var A=this.getAtomsFromSel(v);if(A.length==0)return{x:0,y:0,z:0};var M=(0,b.getExtent)(A);return{x:M[0][0]+(M[1][0]-M[0][0])/2,y:M[0][1]+(M[1][1]-M[0][1])/2,z:M[0][2]+(M[1][2]-M[0][2])/2}}addSphere(v){v=v||{},v.center=this.getSelectionCenter(v.center);var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addSphere(v),this.shapes.push(A),A.finalize(),A}addBox(v={}){v.corner!=null&&(v.corner=this.getSelectionCenter(v.corner)),v.center!=null&&(v.center=this.getSelectionCenter(v.center));var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addBox(v),this.shapes.push(A),A.finalize(),A}addArrow(v={}){v.start=this.getSelectionCenter(v.start),v.end=this.getSelectionCenter(v.end);var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addArrow(v),this.shapes.push(A),A.finalize(),A}addCylinder(v={}){v.start=this.getSelectionCenter(v.start),v.end=this.getSelectionCenter(v.end);var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,v.dashed?A.addDashedCylinder(v):A.addCylinder(v),this.shapes.push(A),A.finalize(),A}addCurve(v={}){var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addCurve(v),this.shapes.push(A),A.finalize(),A}addLine(v={}){v.start=this.getSelectionCenter(v.start),v.end=this.getSelectionCenter(v.end),v.wireframe=!0;var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,v.dashed?A=this.addLineDashed(v,A):A.addLine(v),this.shapes.push(A),A.finalize(),A}addUnitCell(v,A){v=this.getModel(v),A=A||{alabel:"a",blabel:"b",clabel:"c"},A.box=A.box||{},A.astyle=A.astyle||{color:"red",radius:.1,midpos:-1},A.bstyle=A.bstyle||{color:"green",radius:.1,midpos:-1},A.cstyle=A.cstyle||{color:"blue",radius:.1,midpos:-1},A.alabelstyle=A.alabelstyle||{fontColor:"red",showBackground:!1,alignment:"center",inFront:!1},A.blabelstyle=A.blabelstyle||{fontColor:"green",showBackground:!1,alignment:"center",inFront:!1},A.clabelstyle=A.clabelstyle||{fontColor:"blue",showBackground:!1,alignment:"center",inFront:!1},v.unitCellObjects&&this.removeUnitCell(v),v.unitCellObjects={shapes:[],labels:[]};var M=v.getCrystData(),T=null;if(M){if(M.matrix)T=M.matrix;else{var R=M.a,P=M.b,L=M.c,O=M.alpha,I=M.beta,N=M.gamma;O=O*Math.PI/180,I=I*Math.PI/180,N=N*Math.PI/180;var k,U,F;k=Math.cos(I),U=(Math.cos(O)-Math.cos(I)*Math.cos(N))/Math.sin(N),F=Math.sqrt(Math.max(0,1-k*k-U*U)),T=new x.Matrix3(R,P*Math.cos(N),L*k,0,P*Math.sin(N),L*U,0,0,L*F)}var j=[new x.Vector3(0,0,0),new x.Vector3(1,0,0),new x.Vector3(0,1,0),new x.Vector3(0,0,1),new x.Vector3(1,1,0),new x.Vector3(0,1,1),new x.Vector3(1,0,1),new x.Vector3(1,1,1)];if(M.matrix4)for(let B=0;B<j.length;B++)M.size&&j[B].multiplyVectors(j[B],M.size),j[B]=j[B].applyMatrix4(M.matrix4);else for(let B=0;B<j.length;B++)j[B]=j[B].applyMatrix3(T);if(A.box&&!A.box.hidden){A.box.wireframe=!0;var H=new s.GLShape(A.box);H.shapePosition=this.shapes.length,H.addLine({start:j[0],end:j[1]}),H.addLine({start:j[0],end:j[2]}),H.addLine({start:j[1],end:j[4]}),H.addLine({start:j[2],end:j[4]}),H.addLine({start:j[0],end:j[3]}),H.addLine({start:j[3],end:j[5]}),H.addLine({start:j[2],end:j[5]}),H.addLine({start:j[1],end:j[6]}),H.addLine({start:j[4],end:j[7]}),H.addLine({start:j[6],end:j[7]}),H.addLine({start:j[3],end:j[6]}),H.addLine({start:j[5],end:j[7]}),this.shapes.push(H),v.unitCellObjects.shapes.push(H),H.finalize()}if(!A.astyle.hidden){A.astyle.start=j[0],A.astyle.end=j[1];let B=this.addArrow(A.astyle);v.unitCellObjects.shapes.push(B)}if(!A.bstyle.hidden){A.bstyle.start=j[0],A.bstyle.end=j[2];let B=this.addArrow(A.bstyle);v.unitCellObjects.shapes.push(B)}if(!A.cstyle.hidden){A.cstyle.start=j[0],A.cstyle.end=j[3];let B=this.addArrow(A.cstyle);v.unitCellObjects.shapes.push(B)}if(A.alabel){A.alabelstyle.position=j[1];let B=this.addLabel(A.alabel,A.alabelstyle);v.unitCellObjects.labels.push(B)}if(A.blabel){A.blabelstyle.position=j[2];let B=this.addLabel(A.blabel,A.blabelstyle);v.unitCellObjects.labels.push(B)}if(A.clabel){A.clabelstyle.position=j[3];let B=this.addLabel(A.clabel,A.clabelstyle);v.unitCellObjects.labels.push(B)}}}removeUnitCell(v){if(v=this.getModel(v),v.unitCellObjects){let A=this;v.unitCellObjects.shapes.forEach(function(M){A.removeShape(M)}),v.unitCellObjects.labels.forEach(function(M){A.removeLabel(M)})}delete v.unitCellObjects}replicateUnitCell(v=3,A=v,M=A,T,R,P){T=this.getModel(T);let L=T.getCrystData();if(L){const O=T.selectedAtoms({}),I=L.matrix;let N=function(U){return U%2==0?-U/2:Math.ceil(U/2)};v<=1&&A<=1&&M<=1&&(P=!0,v=A=M=3);let k=function(U,F,j){return!1};if(P){const U=new x.Matrix3().getInverse3(I);k=function(F,j,H){let B=new x.Vector3(F,j,H).applyMatrix3(U);return!(B.x>-1e-4&&B.x<1.0001&&B.y>-1e-4&&B.y<1.0001&&B.z>-1e-4&&B.z<1.0001)}}for(let U=0;U<v;U++)for(let F=0;F<A;F++)for(let j=0;j<M;j++){if(U==0&&F==0&&j==0)continue;let H=new x.Vector3(N(U),N(F),N(j));H.applyMatrix3(I);let B=[];for(let V=0;V<O.length;V++){let K=O[V].x+H.x,q=O[V].y+H.y,Te=O[V].z+H.z;if(k(K,q,Te))continue;let Fe={};for(let We in O[V])Fe[We]=O[V][We];Fe.x=K,Fe.y=q,Fe.z=Te,B.push(Fe)}T.addAtoms(B)}R&&T.assignBonds()}}addLineDashed(v,A){v.dashLength=v.dashLength||.5,v.gapLength=v.gapLength||.5;var M;v.start?M=new x.Vector3(v.start.x||0,v.start.y||0,v.start.z||0):M=new x.Vector3(0,0,0);var T;v.end?T=new x.Vector3(v.end.x,v.end.y||0,v.end.z||0):T=new x.Vector3(0,0,0);var R=new x.Vector3,P=new x.Vector3,L=new x.Vector3,O,I,N,k=M.clone(),U=0;for(R.subVectors(T,M),O=R.length(),R.normalize(),P=R.clone(),L=R.clone(),P.multiplyScalar(v.dashLength),L.multiplyScalar(v.gapLength),I=P.length(),N=L.length();U<O;){if(U+I>O){v.start=M,v.end=T,A.addLine(v);break}k.addVectors(M,P),v.start=M,v.end=k,A.addLine(v),M=k.clone(),U+=I,k.addVectors(M,L),M=k.clone(),U+=N}return A.finalize(),A}addCustom(v){v=v||{};var A=new s.GLShape(v);return A.shapePosition=this.shapes.length,A.addCustom(v),this.shapes.push(A),A.finalize(),A}addVolumetricData(v,A,M={}){var T=new d.VolumeData(v,A);return M.hasOwnProperty("transferfn")?this.addVolumetricRender(T,M):this.addIsosurface(T,M)}addIsosurface(v,A={},M){var T=new s.GLShape(A);return T.shapePosition=this.shapes.length,T.addIsosurface(v,A,M,this),this.shapes.push(T),T}addVolumetricRender(v,A){A=A||{};var M=new u.GLVolumetricRender(v,A,this);return M.shapePosition=this.shapes.length,this.shapes.push(M),M}hasVolumetricRender(){return this.renderer.supportsVolumetric()}enableFog(v){if(v){this.scene.fog=new g.Fog(this.bgColor,100,200),this.config.disableFog=!1;const A=v;A.fogStart==null?this.fogStart=.4:this.fogStart=A.fogStart,A.fogEnd==null?this.fogEnd=1:this.fogEnd=A.fogEnd}else this.config.disableFog=!0,this.show()}setFrame(v){this.viewer_frame=v;let A=this;return new Promise(function(M){var T=A.models.map(function(R){return R.setFrame(v)});Promise.all(T).then(function(){M()})})}getFrame(){return this.viewer_frame}getNumFrames(){var v=0;for(let A=0;A<this.models.length;A++)this.models[A].getNumFrames()>v&&(v=this.models[A].getNumFrames());for(let A=0;A<this.shapes.length;A++)this.shapes[A].frame&&this.shapes[A].frame>=v&&(v=this.shapes[A].frame+1);for(let A=0;A<this.labels.length;A++)this.labels[A].frame&&this.labels[A].frame>=v&&(v=this.labels[A].frame+1);return v}getNextModelId(){return this.models.length}animate(v){this.incAnim();var A=100,M="forward",T=1/0;v=v||{},v.interval&&(A=v.interval),v.loop&&(M=v.loop),v.reps&&(T=v.reps);var R=this.getNumFrames(),P=this,L=0;v.startFrame&&(L=v.startFrame%R);var O=1;v.step&&(O=v.step,T/=O);var I=0,N=R*T,k=new Date,U,F,j=function(H){k=new Date,H=="forward"?P.setFrame(L).then(function(){L=(L+O)%R,U()}):H=="backward"?P.setFrame(R-1-L).then(function(){L=(L+O)%R,U()}):P.setFrame(L).then(function(){L+=O,O*=L%(R-1)==0?-1:1,U()})};return U=function(){if(P.render(),!P.getCanvas().isConnected)P.stopAnimate();else if(++I>=N||!P.isAnimated())F.cancel(),P.animationTimers.delete(F),P.decAnim();else{var H=A-(new Date().getTime()-k.getTime());H=H>0?H:0,F.cancel(),P.animationTimers.delete(F),F=new b.PausableTimer(j,H,M),P.animationTimers.add(F)}},F=new b.PausableTimer(j,0,M),this.animationTimers.add(F),this}stopAnimate(){return this.animated=0,this.animationTimers.forEach(function(v){v.cancel()}),this.animationTimers=new Set,this}pauseAnimate(){return this.animationTimers.forEach(function(v){v.pause()}),this}resumeAnimate(){return this.animationTimers.forEach(function(v){v.resume()}),this}isAnimated(){return this.animated>0}getModelOpt(v){return v&&!v.defaultcolors?(v.defaultcolors=this.defaultcolors,v.cartoonQuality=v.cartoonQuality||this.config.cartoonQuality):typeof v>"u"&&(v={defaultcolors:this.defaultcolors,cartoonQuality:this.config.cartoonQuality}),v}addModel(v,A="",M){M=this.getModelOpt(M);var T=new i.GLModel(this.models.length,M,this);return T.addMolData(v,A,M),this.models.push(T),T}addModels(v,A,M){M=this.getModelOpt(M),M.multimodel=!0,M.frames=!0;for(var T=i.GLModel.parseMolData(v,A,M),R=0;R<T.length;R++){var P=new i.GLModel(this.models.length,M,this);P.setAtomDefaults(T[R]),P.addFrame(T[R]),P.setFrame(0),T.modelData&&P.setModelData(T.modelData[R]),P.setDontDuplicateAtoms(!M.duplicateAssemblyAtoms),this.models.push(P)}return this.models}addModelsAsFrames(v,A,M){M=this.getModelOpt(M),M.multimodel=!0,M.frames=!0;var T=new i.GLModel(this.models.length,M,this);return T.addMolData(v,A,M),this.models.push(T),T}addAsOneMolecule(v,A,M){M=this.getModelOpt(M),M.multimodel=!0,M.onemol=!0;var T=new i.GLModel(this.models.length,M,this);return T.addMolData(v,A,M),this.models.push(T),T}removeModel(v){if(v=this.getModel(v),!!v){for(v.removegl(this.modelGroup),delete this.models[v.getID()];this.models.length>0&&typeof this.models[this.models.length-1]>"u";)this.models.pop();return this}}removeAllModels(){for(var v=0;v<this.models.length;v++){var A=this.models[v];A&&A.removegl(this.modelGroup)}return this.models.splice(0,this.models.length),this}exportJSON(v,A){var M={};return A===void 0?M.m=this.models.map(function(T){return T.toCDObject(v)}):M.m=[this.models[A].toCDObject()],JSON.stringify(M)}exportVRML(){var v=this.modelGroup;this.applyToModels("removegl",this.modelGroup),this.modelGroup=new g.Object3D,this.render(null,{supportsImposters:!1,supportsAIA:!1,regen:!0});var A=`#VRML V2.0 utf8
`+this.modelGroup.vrml()+`
`;return this.applyToModels("removegl",this.modelGroup),this.modelGroup=v,A}createModelFrom(v,A=!1){for(var M=new i.GLModel(this.models.length,this.defaultcolors,this),T=0;T<this.models.length;T++)if(this.models[T]){var R=this.models[T].selectedAtoms(v);M.addAtoms(R),A&&this.models[T].removeAtoms(R)}return this.models.push(M),M}applyToModels(v,A,M,T,R,P,L){for(var O=this.getModelList(A),I=0;I<O.length;I++)O[I][v](A,M,T,R,P,L)}setStyle(v,A){return typeof A>"u"&&(A=v,v={}),this.applyToModels("setStyle",v,A,!1),this}addStyle(v,A){return typeof A>"u"&&(A=v,v={}),this.applyToModels("setStyle",v,A,!0),this}setClickable(v,A,M){return this.applyToModels("setClickable",v,A,M),this}setHoverable(v,A,M,T){return this.applyToModels("setHoverable",v,A,M,T),this}enableContextMenu(v,A){return this.applyToModels("enableContextMenu",v,A),this}vibrate(v,A,M,T){return this.applyToModels("vibrate",v,A,M,T),this}setColorByProperty(v,A,M,T){return this.applyToModels("setColorByProperty",v,A,M,T),this}setColorByElement(v,A){return this.applyToModels("setColorByElement",v,A),this}static getAtomsWithin(v,A){var M=[];for(let R=0;R<v.length;R++){var T=v[R];typeof T>"u"||T.x<A[0][0]||T.x>A[1][0]||T.y<A[0][1]||T.y>A[1][1]||T.z<A[0][2]||T.z>A[1][2]||M.push(T)}return M}static volume(v){var A=v[1][0]-v[0][0],M=v[1][1]-v[0][1],T=v[1][2]-v[0][2];return A*M*T}carveUpExtent(v,A,M){let T=[],R={};for(let k=0,U=A.length;k<U;k++)R[A[k].index]=k;let P=function(k){let U=[];for(let F=0,j=k.length;F<j;F++)k[F].index in R&&U.push(R[k[F].index]);return U},L=function(k){let U=[];return U[0]=[k[0][0],k[0][1],k[0][2]],U[1]=[k[1][0],k[1][1],k[1][2]],U},O=function(k){if(f.volume(k)<f.maxVolume)return[k];var U=k[1][0]-k[0][0],F=k[1][1]-k[0][1],j=k[1][2]-k[0][2],H;U>F&&U>j?H=0:F>U&&F>j?H=1:H=2;var B=L(k),V=L(k),K=(k[1][H]-k[0][H])/2+k[0][H];B[1][H]=K,V[0][H]=K;var q=O(B),Te=O(V);return q.concat(Te)},I=O(v),N=6;for(let k=0,U=I.length;k<U;k++){let F=L(I[k]);F[0][0]-=N,F[0][1]-=N,F[0][2]-=N,F[1][0]+=N,F[1][1]+=N,F[1][2]+=N;let j=f.getAtomsWithin(A,F),H=f.getAtomsWithin(M,I[k]);T.push({extent:I[k],atoms:P(j),toshow:P(H)})}return T}static generateSurfaceMesh(v,A,M){var T=new g.Geometry(!0),R=T.updateGeoGroup(0),P=[];for(let oi=0,h0=v.length;oi<h0;oi++){var L=v[oi];L&&(typeof L.surfaceColor<"u"?P[oi]=L.surfaceColor:L.color&&(P[oi]=y.CC.color(L.color)))}var O=R.vertexArray,I=A.vertices;for(let oi=0,h0=I.length;oi<h0;oi++){let l0=R.vertices*3;O[l0]=I[oi].x,O[l0+1]=I[oi].y,O[l0+2]=I[oi].z,R.vertices++}var N=R.colorArray;let k=R.atomArray;if(M.voldata&&M.volscheme){var U=M.volscheme,F=M.voldata,j=U.range()||[-1,1];for(let oi=0,h0=I.length;oi<h0;oi++){let l0=I[oi].atomid,M0=F.getVal(I[oi].x,I[oi].y,I[oi].z),U0=y.CC.color(U.valueToHex(M0,j)),_0=oi*3;N[_0]=U0.r,N[_0+1]=U0.g,N[_0+2]=U0.b,k[oi]=v[l0]}}else if(P.length>0)for(let oi=0,h0=I.length;oi<h0;oi++){let l0=I[oi].atomid,M0=oi*3;N[M0]=P[l0].r,N[M0+1]=P[l0].g,N[M0+2]=P[l0].b,k[oi]=v[l0]}var H=A.faces;R.faceidx=H.length,T.initTypedArrays();var B=R.vertexArray,V=R.normalArray,K,q,Te,Fe;for(let oi=0,h0=H.length;oi<h0;oi+=3){var We=H[oi],J=H[oi+1],et=H[oi+2],ht=We*3,er=J*3,tr=et*3;K=new x.Vector3(B[ht],B[ht+1],B[ht+2]),q=new x.Vector3(B[er],B[er+1],B[er+2]),Te=new x.Vector3(B[tr],B[tr+1],B[tr+2]),Te.subVectors(Te,q),K.subVectors(K,q),Te.cross(K),Fe=Te,Fe.normalize(),V[ht]+=Fe.x,V[er]+=Fe.x,V[tr]+=Fe.x,V[ht+1]+=Fe.y,V[er+1]+=Fe.y,V[tr+1]+=Fe.y,V[ht+2]+=Fe.z,V[er+2]+=Fe.z,V[tr+2]+=Fe.z}R.faceArray=new Uint16Array(H);var Hm=new g.Mesh(T,M);return Hm}static generateMeshSyncHelper(v,A,M,T,R,P){var L=new l.ProteinSurface;return L.initparm(A,v!==1,P),L.fillvoxels(R,M),L.buildboundary(),(v==l.SurfaceType.SES||v==l.SurfaceType.MS)&&(L.fastdistancemap(),L.boundingatom(!1),L.fillvoxelswaals(R,M)),L.marchingcube(v),L.getFacesAndVertices(T)}static getMatWithStyle(v){let A=null;v.onesided?A=new g.MeshLambertMaterial:A=new g.MeshDoubleLambertMaterial,A.vertexColors=g.Coloring.VertexColors;for(var M in v)M==="color"||M==="map"||v.hasOwnProperty(M)&&(A[M]=v[M]);return v.opacity!==void 0&&(v.opacity===1?A.transparent=!1:A.transparent=!0),v.wireframe!==void 0&&(A.wireframe=v.wireframe),A}addMesh(v){let A={geo:v.geometry,mat:v.material,done:!0,finished:!1};var M=this.nextSurfID();return this.surfaces[M]=new h([A]),M}static shallowCopy(v){var A=[];let M=v.length;for(let T=0;T<M;T++)A[T]=(0,b.extend)({},v[T]);return A}addSurface(v,A={},M={},T,R,P){let L=this.nextSurfID(),O=null,I=this,N=l.SurfaceType.VDW;typeof v=="string"?f.surfaceTypeMap[v.toUpperCase()]!==void 0?N=f.surfaceTypeMap[v]:console.log("Surface type : "+v+" is not recognized"):typeof v=="number"&&(N=v);var k=null,U=null,F=f.shallowCopy(this.getAtomsFromSel(M));T?k=f.shallowCopy(this.getAtomsFromSel(T)):k=F,(0,b.adjustVolumeStyle)(A);var j=!1,H;for(H=0;H<this.models.length;H++)if(this.models[H]){var B=this.models[H].getSymmetries();if(B.length>1||B.length==1&&!B[0].isIdentity()){j=!0;break}}var V=function(et,ht,er){R?U=f.shallowCopy(I.getAtomsFromSel(R)):U=er;var tr,Hm=(0,b.getExtent)(er,!0);if(A.map&&A.map.prop){var oi=A.map.prop;let d0=(0,o.getGradient)(A.map.scheme||A.map.gradient||new o.Gradient.RWB),w0=d0.range();w0||(w0=(0,b.getPropertyRange)(er,oi)),A.colorscheme={prop:oi,gradient:d0}}for(let d0=0,w0=ht.length;d0<w0;d0++)tr=ht[d0],tr.surfaceColor=(0,b.getColorFromStyle)(tr,A);var h0=f.volume(Hm),l0=I.carveUpExtent(Hm,ht,er);if(U&&U.length&&U.length>0){var M0=(0,b.getExtent)(U,!0),U0=function(d0,w0){var Q=function(a0,u0){var E0=a0.extent,O0=E0[1][0]-E0[0][0],He=E0[1][1]-E0[0][1],p0=E0[1][2]-E0[0][2],x0=O0-u0[2][0];x0*=x0;var L0=He-u0[2][1];L0*=L0;var c0=p0-u0[2][2];return c0*=c0,x0+L0+c0},it=Q(d0,M0),ec=Q(w0,M0);return it-ec};l0.sort(U0)}var _0=[];for(let d0=0,w0=ht.length;d0<w0;d0++)tr=ht[d0],_0[d0]={x:tr.x,y:tr.y,z:tr.z,serial:d0,elem:tr.elem};var C0=!!l.syncSurface;if((typeof $3Dmol>"u"||typeof $3Dmol.SurfaceWorker>"u")&&(console.log("$3Dmol.SurfaceWorker is not defined, using synchronous surface generation."),C0=!0),C0){var P0=function(w0){return new Promise(function(Q){for(var it=f.generateMeshSyncHelper(N,l0[w0].extent,l0[w0].atoms,l0[w0].toshow,_0,h0),ec=(0,s.splitMesh)({vertexArr:it.vertices,faceArr:it.faces}),a0=0,u0=ec.length;a0<u0;a0++){it={vertices:ec[a0].vertexArr,faces:ec[a0].faceArr};var E0=f.generateSurfaceMesh(ht,it,O);(0,b.mergeGeos)(et.geo,E0)}I.render(),Q()})},R0=[];for(let d0=0;d0<l0.length;d0++)R0.push(P0(d0));return Promise.all(R0).then(function(){return et.done=!0,I.render(),Promise.resolve(L)})}else{var si=[];N<0&&(N=0);for(let d0=0,w0=f.numWorkers;d0<w0;d0++){var Xe=new Worker($3Dmol.SurfaceWorker);si.push(Xe),Xe.postMessage({type:-1,atoms:_0,volume:h0})}return new Promise(function(d0,w0){var Q=0,it=function(){!si||!si.length||si.forEach(function(E0){E0&&E0.terminate&&E0.terminate()})},ec=function(E0){for(var O0=(0,s.splitMesh)({vertexArr:E0.data.vertices,faceArr:E0.data.faces}),He=0,p0=O0.length;He<p0;He++){var x0={vertices:O0[He].vertexArr,faces:O0[He].faceArr},L0=f.generateSurfaceMesh(ht,x0,O);(0,b.mergeGeos)(et.geo,L0)}I.render(),Q++,Q==l0.length&&(et.done=!0,it(),d0(L))},a0=function(E0){it(),console.log(E0.message+" ("+E0.filename+":"+E0.lineno+")"),w0(E0)};for(let E0=0;E0<l0.length;E0++){var u0=si[E0%si.length];u0.onmessage=ec,u0.onerror=a0,u0.postMessage({type:N,expandedExtent:l0[E0].extent,extendedAtoms:l0[E0].atoms,atomsToShow:l0[E0].toshow})}})}};A=A||{},O=f.getMatWithStyle(A);let K=new h([]);K.style=A,K.atomsel=M,K.allsel=T,K.focus=R;var q=null;if(j){var Te={},Fe={};for(H=0;H<this.models.length;H++)Te[H]=[],Fe[H]=[];for(H=0;H<k.length;H++)Te[k[H].model].push(k[H]);for(H=0;H<F.length;H++)Fe[F[H].model].push(F[H]);var We=[];for(H=0;H<this.models.length;H++)Fe[H].length>0&&(K.push({geo:new g.Geometry(!0),mat:O,done:!1,finished:!1,symmetries:this.models[H].getSymmetries()}),We.push(V(K[K.length-1],Te[H],Fe[H])));q=Promise.all(We)}else K.push({geo:new g.Geometry(!0),mat:O,done:!1,finished:!1,symmetries:[new x.Matrix4]}),q=V(K[K.length-1],k,F);return this.surfaces[L]=K,q.surfid=L,P&&typeof P=="function"?(q.then(function(J){P(J)}),L):q}setSurfaceMaterialStyle(v,A){if((0,b.adjustVolumeStyle)(A),this.surfaces[v]){var M=this.surfaces[v];for(let R=0;R<M.length;R++){var T=M[R].mat=f.getMatWithStyle(A);if(M[R].mat.side=g.FrontSide,A.wireframe&&M[R].geo.setUpWireframe(),A.color){M[R].mat.color=y.CC.color(A.color),M[R].geo.colorsNeedUpdate=!0;const P=y.CC.color(A.color);M[R].geo.setColor(P)}else if(T.voldata&&T.volscheme){const P=T.volscheme,L=T.voldata,O=y.CC,I=P.range()||[-1,1];M[R].geo.setColors(function(N,k,U){let F=L.getVal(N,k,U);return O.color(P.valueToHex(F,I))})}else{M[R].geo.colorsNeedUpdate=!0;for(let P of M[R].geo.geometryGroups)for(let L=0;L<P.vertices;L++){let O=(0,b.getColorFromStyle)(P.atomArray[L],A),I=3*L;P.colorArray[I]=O.r,P.colorArray[I+1]=O.g,P.colorArray[I+2]=O.b}}M[R].finished=!1}}return this}getSurface(v){return this.surfaces[v]}removeSurface(v){for(var A=this.surfaces[v],M=0;M<A.length;M++)A[M]&&A[M].lastGL&&(A[M].geo!==void 0&&A[M].geo.dispose(),A[M].mat!==void 0&&A[M].mat.dispose(),this.modelGroup.remove(A[M].lastGL));return delete this.surfaces[v],this.show(),this}removeAllSurfaces(){for(var v in this.surfaces)if(this.surfaces.hasOwnProperty(v)){for(var A=this.surfaces[v],M=0;M<A.length;M++)A[M]&&A[M].lastGL&&(A[M].geo!==void 0&&A[M].geo.dispose(),A[M].mat!==void 0&&A[M].mat.dispose(),this.modelGroup.remove(A[M].lastGL));delete this.surfaces[v]}return this.show(),this}jmolMoveTo(){var v=this.modelGroup.position,A="center { "+-v.x+" "+-v.y+" "+-v.z+" }; ",M=this.rotationGroup.quaternion;return A+="moveto .5 quaternion { "+M.x+" "+M.y+" "+M.z+" "+M.w+" };",A}clear(){return this.removeAllSurfaces(),this.removeAllModels(),this.removeAllLabels(),this.removeAllShapes(),this.show(),this}mapAtomProperties(v,A){A=A||{};var M=this.getAtomsFromSel(A);if(typeof v=="function")for(let P=0,L=M.length;P<L;P++){let O=M[P];v(O)}else for(let P=0,L=M.length;P<L;P++){var T=M[P];for(let O=0,I=v.length;O<I;O++){let N=v[O];if(N.props)for(var R in N.props)N.props.hasOwnProperty(R)&&this.atomIsSelected(T,N)&&(T.properties||(T.properties={}),T.properties[R]=N.props[R])}}return this}linkViewer(v){return this.linkedViewers.push(v),this}getPerceivedDistance(){return this.CAMERA_Z-this.rotationGroup.position.z}setPerceivedDistance(v){this.rotationGroup.position.z=this.CAMERA_Z-v}setAutoEyeSeparation(v,A){var M=this.getPerceivedDistance();return A||(A=5),v||this.camera.position.x>0?this.camera.position.x=M*Math.tan(Math.PI/180*A):this.camera.position.x=-M*Math.tan(Math.PI/180*A),this.camera.lookAt(new x.Vector3(0,0,this.rotationGroup.position.z)),this.camera.position.x}setDefaultCartoonQuality(v){this.config.cartoonQuality=v}}f.numWorkers=4,f.maxVolume=64e3,f.surfaceTypeMap={VDW:l.SurfaceType.VDW,MS:l.SurfaceType.MS,SAS:l.SurfaceType.SAS,SES:l.SurfaceType.SES};function E(w,v){if(w=(0,b.getElement)(w),!!w){v=v||{};try{var A=new f(w,v);return A}catch(M){throw"error creating viewer: "+M}}}function m(w,v={},A={}){if(w=(0,b.getElement)(w),!!w){var M=[],T=document.createElement("canvas");A.rows=v.rows,A.cols=v.cols,A.control_all=v.control_all!=null?v.control_all:!1,w.appendChild(T);try{for(var R=0;R<v.rows;R++){for(var P=[],L=0;L<v.cols;L++){A.row=R,A.col=L,A.canvas=T,A.viewers=M,A.control_all=v.control_all;var O=E(w,(0,b.extend)({},A));P.push(O)}M.unshift(P)}}catch(I){throw"error creating viewer grid: "+I}return M}}function S(w){var v=this;if(w=(0,b.getElement)(w),!!w){var A=m(w,{rows:1,cols:2,control_all:!0});this.glviewer1=A[0][0],this.glviewer2=A[0][1],this.glviewer1.setAutoEyeSeparation(!1),this.glviewer2.setAutoEyeSeparation(!0),this.glviewer1.linkViewer(this.glviewer2),this.glviewer2.linkViewer(this.glviewer1);for(var M=Object.getOwnPropertyNames(this.glviewer1.__proto__).filter(function(R){return typeof v.glviewer1[R]=="function"}),T=0;T<M.length;T++)this[M[T]]=(function(R){return function(){var P=this.glviewer1[R].apply(this.glviewer1,arguments),L=this.glviewer2[R].apply(this.glviewer2,arguments);return[P,L]}})(M[T]);this.setCoordinates=function(R,P,L){for(var O=0;O<R.length;O++)R[O].setCoordinates(P,L)},this.surfacesFinished=function(){return this.glviewer1.surfacesFinished()&&this.glviewer2.surfacesFinished()},this.isAnimated=function(){return this.glviewer1.isAnimated()||this.glviewer2.isAnimated()},this.render=function(R){this.glviewer1.render(),this.glviewer2.render(),R&&R(this)},this.getCanvas=function(){return this.glviewer1.getCanvas()}}}}),"./src/Gradient.ts":((r,e,t)=>{t.r(e),t.d(e,{CustomLinear:()=>u,Gradient:()=>x,GradientType:()=>i,ROYGB:()=>l,RWB:()=>a,Sinebow:()=>d,builtinGradients:()=>g,getGradient:()=>o,normalizeValue:()=>s});var n=t("./src/colors.ts");class i{}function s(y,b,_){return b>=y?(_<y&&(_=y),_>b&&(_=b),{lo:y,hi:b,val:_}):(_>y&&(_=y),_<b&&(_=b),_=y-_+b,{lo:b,hi:y,val:_})}function o(y){if(y instanceof i)return y;if(y.gradient!==void 0&&g[y.gradient]){let b=y.min===void 0?-1:y.min,_=y.max===void 0?1:y.max;return y.mid===void 0?y.colors===void 0?new g[y.gradient](b,_):new g[y.gradient](b,_,y.colors):new g[y.gradient](b,_,y.mid)}else if(typeof y.gradient=="string"&&y.gradient.startsWith("linear_")){let b=y.gradient.split("_");b.shift();let _=y.min===void 0?-1:y.min,h=y.max===void 0?1:y.max;return new u(_,h,b)}return y}class a extends i{constructor(b,_,h){super(),this.gradient="RWB",this.mult=1,this.mid=h,this.min=b,this.max=_,typeof _>"u"&&Array.isArray(b)&&b.length>=2?(this.max=b[1],this.min=b[0]):b&&_&&!Array.isArray(b)&&(this.min=b,this.max=_)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(b,_){var h,f;if(b=this.mult*b,_?(h=_[0],f=_[1]):(h=this.min,f=this.max),b===void 0)return 16777215;var E=s(h,f,b);h=E.lo,f=E.hi,b=E.val;var m=(f+h)/2;_&&typeof _[2]<"u"?m=_[2]:typeof this.mid<"u"?m=this.mid:m=(h+f)/2;var S,w;return b<m?(S=Math.floor(255*Math.sqrt((b-h)/(m-h))),w=16711680+256*S+S,w):b>m?(S=Math.floor(255*Math.sqrt(1-(b-m)/(f-m))),w=65536*S+256*S+255,w):16777215}}class l extends i{constructor(b,_){super(),this.gradient="ROYGB",this.mult=1,this.min=b,this.max=_,typeof _>"u"&&Array.isArray(b)&&b.length>=2?(this.max=b[1],this.min=b[0]):b&&_&&!Array.isArray(b)&&(this.min=b,this.max=_)}valueToHex(b,_){var h,f;if(b=this.mult*b,_?(h=_[0],f=_[1]):(h=this.min,f=this.max),typeof b>"u")return 16777215;var E=s(h,f,b);h=E.lo,f=E.hi,b=E.val;var m=(h+f)/2,S=(h+m)/2,w=(m+f)/2,v,A;return b<S?(v=Math.floor(255*Math.sqrt((b-h)/(S-h))),A=16711680+256*v+0,A):b<m?(v=Math.floor(255*Math.sqrt(1-(b-S)/(m-S))),A=65536*v+65280+0,A):b<w?(v=Math.floor(255*Math.sqrt((b-m)/(w-m))),A=65280+1*v,A):(v=Math.floor(255*Math.sqrt(1-(b-w)/(f-w))),A=0+256*v+255,A)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class d extends i{constructor(b,_){super(),this.gradient="Sinebow",this.mult=1,this.min=b,this.max=_,typeof _>"u"&&Array.isArray(b)&&b.length>=2&&(this.max=b[1],this.min=b[0]),_<b&&(this.mult=-1,this.min*=-1,this.max*=-1)}valueToHex(b,_){var h,f;if(b=this.mult*b,_?(h=_[0],f=_[1]):(h=this.min,f=this.max),typeof b>"u")return 16777215;var E=x.normalizeValue(h,f,b);h=E.lo,f=E.hi,b=E.val;var m=(b-h)/(f-h),S=5*m/6+.5,w=Math.sin(Math.PI*S);w*=w*255;var v=Math.sin(Math.PI*(S+1/3));v*=v*255;var A=Math.sin(Math.PI*(S+2/3));return A*=A*255,65536*Math.floor(w)+256*Math.floor(A)+1*Math.floor(v)}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}}class u extends i{constructor(b,_,h){super(),this.gradient="linear",this.colors=new Array;var f;if(Array.isArray(b)&&b.length>=2?(this.max=b[1],this.min=b[0],f=_):(this.min=b,this.max=_,f=h),f)for(let E of f)this.colors.push(n.CC.color(E));else this.colors.push(n.CC.color(0))}range(){return typeof this.min<"u"&&typeof this.max<"u"?[this.min,this.max]:null}valueToHex(b,_){var h,f;if(_?(h=_[0],f=_[1]):(h=this.min,f=this.max),b===void 0)return 16777215;var E=s(h,f,b);h=E.lo,f=E.hi,b=E.val;let m=this.colors.length,S=(f-h)/m,w=Math.min(Math.floor((b-h)/S),m-1),v=Math.min(w+1,m-1),A=(b-h-w*S)/S,M=this.colors[w],T=this.colors[v];return new n.Color(M.r+A*(T.r-M.r),M.g+A*(T.g-M.g),M.b+A*(T.b-M.b)).getHex()}}const g={rwb:a,RWB:a,roygb:l,ROYGB:l,sinebow:d,linear:u};class x extends i{valueToHex(b,_){return 0}range(){return null}}x.RWB=a,x.ROYGB=l,x.Sinebow=d,x.CustomLinear=u,x.builtinGradients=g,x.normalizeValue=s,x.getGradient=o}),"./src/Label.ts":((r,e,t)=>{t.r(e),t.d(e,{Label:()=>d,LabelCount:()=>o});var n=t("./src/WebGL/index.ts"),i=t("./src/Gradient.ts"),s=t("./src/colors.ts");let o=0;function a(u,g,x,y,b,_,h){u.beginPath(),u.moveTo(g+_,x),u.lineTo(g+y-_,x),u.quadraticCurveTo(g+y,x,g+y,x+_),u.lineTo(g+y,x+b-_),u.quadraticCurveTo(g+y,x+b,g+y-_,x+b),u.lineTo(g+_,x+b),u.quadraticCurveTo(g,x+b,g,x+b-_),u.lineTo(g,x+_),u.quadraticCurveTo(g,x,g+_,x),u.closePath(),u.fill(),h&&u.stroke()}function l(u,g,x){var y=x;return typeof u<"u"&&(u instanceof s.Color?y=u.scaled():(y=s.CC.color(u),typeof y.scaled<"u"&&(y=y.scaled()))),typeof g<"u"&&(y.a=parseFloat(g)),y}class d{constructor(g,x){this.id=o++,this.stylespec=x||{},this.canvas=document.createElement("canvas"),this.canvas.width=134,this.canvas.height=35,this.context=this.canvas.getContext("2d"),this.sprite=new n.Sprite,this.text=g,this.frame=this.stylespec.frame}getStyle(){return this.stylespec}hide(){this.sprite&&(this.sprite.visible=!1)}show(){this.sprite&&(this.sprite.visible=!0)}setContext(){var g=this.stylespec,x=typeof g.useScreen>"u"?!1:g.useScreen,y=g.showBackground;(y==="0"||y==="false")&&(y=!1),typeof y>"u"&&(y=!0);var b=g.font?g.font:"sans-serif",_=parseInt(g.fontSize)?parseInt(g.fontSize):18,h=l(g.fontColor,g.fontOpacity,{r:255,g:255,b:255,a:1}),f=g.padding?g.padding:4,E=g.borderThickness?g.borderThickness:0,m=l(g.backgroundColor,g.backgroundOpacity,{r:0,g:0,b:0,a:1}),S=l(g.borderColor,g.borderOpacity,m),w=g.position?g.position:{x:-10,y:1,z:1},v=g.inFront!==void 0?g.inFront:!0;(v==="false"||v==="0")&&(v=!1);var A=g.alignment||n.SpriteAlignment.topLeft;typeof A=="string"&&A in n.SpriteAlignment&&(A=n.SpriteAlignment[A]);var M="";g.bold&&(M="bold "),this.context.font=M+_+"px  "+b;var T=this.context.measureText(this.text),R=T.width;y||(E=0);var P=R+2.5*E+2*f,L=_*1.25+2*E+2*f;if(g.backgroundImage){var O=g.backgroundImage,I=g.backgroundWidth?g.backgroundWidth:O.width,N=g.backgroundHeight?g.backgroundHeight:O.height;I>P&&(P=I),N>L&&(L=N)}if(this.canvas.width=P,this.canvas.height=L,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),M="",g.bold&&(M="bold "),this.context.font=M+_+"px  "+b,this.context.fillStyle="rgba("+m.r+","+m.g+","+m.b+","+m.a+")",this.context.strokeStyle="rgba("+S.r+","+S.g+","+S.b+","+S.a+")",g.backgroundGradient){let U=this.context.createLinearGradient(0,L/2,P,L/2),F=i.Gradient.getGradient(g.backgroundGradient),j=F.range(),H=-1,B=1;j&&(H=j[0],B=j[1]);let V=B-H;for(let K=0;K<1.01;K+=.1){let q=l(F.valueToHex(H+V*K)),Te="rgba("+q.r+","+q.g+","+q.b+","+q.a+")";U.addColorStop(K,Te)}this.context.fillStyle=U}this.context.lineWidth=E,y&&a(this.context,E,E,P-2*E,L-2*E,6,E>0),g.backgroundImage&&this.context.drawImage(O,0,0,P,L),this.context.fillStyle="rgba("+h.r+","+h.g+","+h.b+","+h.a+")",this.context.fillText(this.text,E+f,_+E+f,R);var k=new n.Texture(this.canvas);k.needsUpdate=!0,this.sprite.material=new n.SpriteMaterial({map:k,useScreenCoordinates:x,alignment:A,depthTest:!v,screenOffset:g.screenOffset||null}),this.sprite.scale.set(1,1,1),this.sprite.position.set(w.x,w.y,w.z)}dispose(){this.sprite.material.map!==void 0&&this.sprite.material.map.dispose(),this.sprite.material!==void 0&&this.sprite.material.dispose()}}}),"./src/ProteinSurface4.ts":((r,e,t)=>{t.r(e),t.d(e,{MarchingCube:()=>l,MarchingCubeInitializer:()=>a,PointGrid:()=>d,ProteinSurface:()=>u,SurfaceType:()=>i,setSyncSurface:()=>o,syncSurface:()=>s});var n=t("./src/WebGL/math/index.ts"),i;(function(g){g[g.VDW=1]="VDW",g[g.MS=2]="MS",g[g.SAS=3]="SAS",g[g.SES=4]="SES"})(i||(i={}));var s=!1;function o(g){s=g}(window.navigator.userAgent.indexOf("MSIE ")>=0||window.navigator.userAgent.indexOf("Trident/")>=0)&&(s=!0);class a{constructor(){this.ISDONE=2,this.edgeTable=new Uint32Array([0,0,0,0,0,0,0,2816,0,0,0,1792,0,3328,3584,3840,0,0,0,138,0,21,0,134,0,0,0,652,0,2067,3865,3600,0,0,0,42,0,0,0,294,0,0,21,28,0,3875,1049,3360,0,168,162,170,0,645,2475,2210,0,687,293,172,4010,3747,3497,3232,0,0,0,0,0,69,0,900,0,0,0,1792,138,131,1608,1920,0,81,0,2074,84,85,84,86,0,81,0,3676,330,1105,1881,1616,0,0,0,42,0,69,0,502,0,0,21,3580,138,2035,1273,1520,2816,104,2337,106,840,581,367,102,2816,3695,3429,3180,1898,1635,1385,1120,0,0,0,0,0,0,0,3910,0,0,69,588,42,2083,41,2880,0,0,0,1722,0,2293,4095,3830,0,255,757,764,2538,2291,3065,2800,0,0,81,338,0,3925,1119,3414,84,855,85,340,2130,2899,89,2384,1792,712,194,1162,4036,3781,3535,3270,708,719,197,204,3018,2755,2505,2240,0,0,0,0,168,420,168,1958,162,162,676,2988,170,163,680,928,3328,3096,3328,3642,52,53,1855,1590,2340,2111,2869,2620,298,51,825,560,3584,3584,3090,3482,1668,1941,1183,1430,146,2975,2069,2460,154,915,153,400,3840,3592,3329,3082,1796,1541,1295,1030,2818,2575,2309,2060,778,515,265,0]),this.triTable=[[],[],[],[],[],[],[],[11,9,8],[],[],[],[8,10,9],[],[10,8,11],[9,11,10],[8,10,9,8,11,10],[],[],[],[1,7,3],[],[4,2,0],[],[2,1,7],[],[],[],[2,7,3,2,9,7],[],[1,4,11,1,0,4],[3,8,0,11,9,4,11,10,9],[4,11,9,11,10,9],[],[],[],[5,3,1],[],[],[],[2,5,8,2,1,5],[],[],[2,4,0],[3,2,4],[],[0,9,1,8,10,5,8,11,10],[3,4,0,3,10,4],[5,8,10,8,11,10],[],[3,5,7],[7,1,5],[1,7,3,1,5,7],[],[9,2,0,9,7,2],[0,3,8,1,7,11,1,5,7],[11,1,7,1,5,7],[],[9,1,0,5,3,2,5,7,3],[8,2,5,8,0,2],[2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[],[],[],[],[],[0,6,2],[],[7,2,9,7,9,8],[],[],[],[8,10,9],[7,1,3],[7,1,0],[6,9,3,6,10,9],[7,10,8,10,9,8],[],[6,0,4],[],[11,1,4,11,3,1],[2,4,6],[2,0,4,2,4,6],[2,4,6],[1,4,2,4,6,2],[],[6,0,4],[],[2,11,3,6,9,4,6,10,9],[8,6,1,8,1,3],[10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[],[],[],[5,3,1],[],[0,6,2],[],[7,4,8,5,2,1,5,6,2],[],[],[2,4,0],[7,4,8,2,11,3,10,5,6],[7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[9,11,8],[3,5,6],[0,5,11,0,11,8],[6,3,5,3,1,5],[3,9,6,3,8,9],[9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[],[],[],[],[],[],[],[1,10,2,9,11,6,9,8,11],[],[],[6,0,2],[3,6,9,3,2,6],[3,5,1],[0,5,1,0,11,5],[0,3,5],[6,9,11,9,8,11],[],[],[],[4,5,9,7,1,10,7,3,1],[],[11,6,7,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[],[],[0,6,4],[8,6,4,8,1,6],[],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[4,2,6],[1,0,9,2,4,8,2,6,4],[2,4,0,2,6,4],[8,2,4,2,6,4],[11,4,1,11,6,4],[0,9,1,4,11,6,4,8,11],[3,6,0,6,4,0],[8,6,4,8,11,6],[10,8,9],[6,3,9,6,7,3],[6,7,1],[10,7,1,7,3,1],[7,11,6,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2],[1,0,9,3,6,7,3,2,6],[7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[],[],[],[],[5,3,7],[8,5,2,8,7,5],[5,3,7],[1,10,2,5,8,7,5,9,8],[1,7,5],[1,7,5],[9,2,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[0,7,1,7,5,1],[9,3,5,3,7,5],[9,7,5,9,8,7],[8,10,11],[3,4,10,3,10,11],[8,10,11],[5,9,4,1,11,3,1,10,11],[2,4,5],[5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[2,8,5,2,11,8],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[11,9,10],[11,9,10],[1,11,4,1,10,11],[8,7,4,11,1,10,11,3,1],[2,7,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[1,7,4],[3,2,11,4,8,7,9,1,0],[11,4,2,4,0,2],[2,11,3,7,4,8],[4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[3,9,11,9,10,11],[0,10,8,10,11,8],[10,3,1,10,11,3],[2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]],this.edgeTable2=[0,265,515,778,2060,2309,2575,2822,1030,1295,1541,1804,3082,3331,3593,3840,400,153,915,666,2460,2197,2975,2710,1430,1183,1941,1692,3482,3219,3993,3728,560,825,51,314,2620,2869,2111,2358,1590,1855,1077,1340,3642,3891,3129,3376,928,681,419,170,2988,2725,2479,2214,1958,1711,1445,1196,4010,3747,3497,3232,2240,2505,2755,3018,204,453,719,966,3270,3535,3781,4044,1226,1475,1737,1984,2384,2137,2899,2650,348,85,863,598,3414,3167,3925,3676,1370,1107,1881,1616,2800,3065,2291,2554,764,1013,255,502,3830,4095,3317,3580,1786,2035,1273,1520,2912,2665,2403,2154,876,613,367,102,3942,3695,3429,3180,1898,1635,1385,1120,1120,1385,1635,1898,3180,3429,3695,3942,102,367,613,876,2154,2403,2665,2912,1520,1273,2035,1786,3580,3317,4095,3830,502,255,1013,764,2554,2291,3065,2800,1616,1881,1107,1370,3676,3925,3167,3414,598,863,85,348,2650,2899,2137,2384,1984,1737,1475,1226,4044,3781,3535,3270,966,719,453,204,3018,2755,2505,2240,3232,3497,3747,4010,1196,1445,1711,1958,2214,2479,2725,2988,170,419,681,928,3376,3129,3891,3642,1340,1077,1855,1590,2358,2111,2869,2620,314,51,825,560,3728,3993,3219,3482,1692,1941,1183,1430,2710,2975,2197,2460,666,915,153,400,3840,3593,3331,3082,1804,1541,1295,1030,2822,2575,2309,2060,778,515,265,0],this.triTable2=[[],[8,3,0],[9,0,1],[8,3,1,8,1,9],[11,2,3],[11,2,0,11,0,8],[11,2,3,0,1,9],[2,1,11,1,9,11,11,9,8],[10,1,2],[8,3,0,1,2,10],[9,0,2,9,2,10],[3,2,8,2,10,8,8,10,9],[10,1,3,10,3,11],[1,0,10,0,8,10,10,8,11],[0,3,9,3,11,9,9,11,10],[8,10,9,8,11,10],[8,4,7],[3,0,4,3,4,7],[1,9,0,8,4,7],[9,4,1,4,7,1,1,7,3],[2,3,11,7,8,4],[7,11,4,11,2,4,4,2,0],[3,11,2,4,7,8,9,0,1],[2,7,11,2,1,7,1,4,7,1,9,4],[10,1,2,8,4,7],[2,10,1,0,4,7,0,7,3],[4,7,8,0,2,10,0,10,9],[2,7,3,2,9,7,7,9,4,2,10,9],[8,4,7,11,10,1,11,1,3],[11,4,7,1,4,11,1,11,10,1,0,4],[3,8,0,7,11,4,11,9,4,11,10,9],[7,11,4,4,11,9,11,10,9],[9,5,4],[3,0,8,4,9,5],[5,4,0,5,0,1],[4,8,5,8,3,5,5,3,1],[11,2,3,9,5,4],[9,5,4,8,11,2,8,2,0],[3,11,2,1,5,4,1,4,0],[8,5,4,2,5,8,2,8,11,2,1,5],[2,10,1,9,5,4],[0,8,3,5,4,9,10,1,2],[10,5,2,5,4,2,2,4,0],[3,4,8,3,2,4,2,5,4,2,10,5],[5,4,9,1,3,11,1,11,10],[0,9,1,4,8,5,8,10,5,8,11,10],[3,4,0,3,10,4,4,10,5,3,11,10],[4,8,5,5,8,10,8,11,10],[9,5,7,9,7,8],[0,9,3,9,5,3,3,5,7],[8,0,7,0,1,7,7,1,5],[1,7,3,1,5,7],[11,2,3,8,9,5,8,5,7],[9,2,0,9,7,2,2,7,11,9,5,7],[0,3,8,2,1,11,1,7,11,1,5,7],[2,1,11,11,1,7,1,5,7],[1,2,10,5,7,8,5,8,9],[9,1,0,10,5,2,5,3,2,5,7,3],[5,2,10,8,2,5,8,5,7,8,0,2],[10,5,2,2,5,3,5,7,3],[3,9,1,3,8,9,7,11,10,7,10,5],[9,1,0,10,7,11,10,5,7],[3,8,0,7,10,5,7,11,10],[11,5,7,11,10,5],[11,7,6],[0,8,3,11,7,6],[9,0,1,11,7,6],[7,6,11,3,1,9,3,9,8],[2,3,7,2,7,6],[8,7,0,7,6,0,0,6,2],[1,9,0,3,7,6,3,6,2],[7,6,2,7,2,9,2,1,9,7,9,8],[1,2,10,6,11,7],[2,10,1,7,6,11,8,3,0],[11,7,6,10,9,0,10,0,2],[7,6,11,3,2,8,8,2,10,8,10,9],[6,10,7,10,1,7,7,1,3],[6,10,1,6,1,7,7,1,0,7,0,8],[9,0,3,6,9,3,6,10,9,6,3,7],[6,10,7,7,10,8,10,9,8],[8,4,6,8,6,11],[11,3,6,3,0,6,6,0,4],[0,1,9,4,6,11,4,11,8],[1,9,4,11,1,4,11,3,1,11,4,6],[3,8,2,8,4,2,2,4,6],[2,0,4,2,4,6],[1,9,0,3,8,2,2,8,4,2,4,6],[9,4,1,1,4,2,4,6,2],[10,1,2,11,8,4,11,4,6],[10,1,2,11,3,6,6,3,0,6,0,4],[0,2,10,0,10,9,4,11,8,4,6,11],[2,11,3,6,9,4,6,10,9],[8,4,6,8,6,1,6,10,1,8,1,3],[1,0,10,10,0,6,0,4,6],[8,0,3,9,6,10,9,4,6],[10,4,6,10,9,4],[9,5,4,7,6,11],[4,9,5,3,0,8,11,7,6],[6,11,7,4,0,1,4,1,5],[6,11,7,4,8,5,5,8,3,5,3,1],[4,9,5,6,2,3,6,3,7],[9,5,4,8,7,0,0,7,6,0,6,2],[4,0,1,4,1,5,6,3,7,6,2,3],[7,4,8,5,2,1,5,6,2],[6,11,7,1,2,10,9,5,4],[11,7,6,8,3,0,1,2,10,9,5,4],[11,7,6,10,5,2,2,5,4,2,4,0],[7,4,8,2,11,3,10,5,6],[4,9,5,6,10,7,7,10,1,7,1,3],[5,6,10,0,9,1,8,7,4],[5,6,10,7,0,3,7,4,0],[10,5,6,4,8,7],[5,6,9,6,11,9,9,11,8],[0,9,5,0,5,3,3,5,6,3,6,11],[0,1,5,0,5,11,5,6,11,0,11,8],[11,3,6,6,3,5,3,1,5],[9,5,6,3,9,6,3,8,9,3,6,2],[5,6,9,9,6,0,6,2,0],[0,3,8,2,5,6,2,1,5],[1,6,2,1,5,6],[1,2,10,5,6,9,9,6,11,9,11,8],[1,0,9,6,10,5,11,3,2],[6,10,5,2,8,0,2,11,8],[3,2,11,10,5,6],[10,5,6,9,3,8,9,1,3],[0,9,1,5,6,10],[8,0,3,10,5,6],[10,5,6],[10,6,5],[8,3,0,10,6,5],[0,1,9,5,10,6],[10,6,5,9,8,3,9,3,1],[3,11,2,10,6,5],[6,5,10,2,0,8,2,8,11],[1,9,0,6,5,10,11,2,3],[1,10,2,5,9,6,9,11,6,9,8,11],[1,2,6,1,6,5],[0,8,3,2,6,5,2,5,1],[5,9,6,9,0,6,6,0,2],[9,6,5,3,6,9,3,9,8,3,2,6],[11,6,3,6,5,3,3,5,1],[0,5,1,0,11,5,5,11,6,0,8,11],[0,5,9,0,3,5,3,6,5,3,11,6],[5,9,6,6,9,11,9,8,11],[10,6,5,4,7,8],[5,10,6,7,3,0,7,0,4],[5,10,6,0,1,9,8,4,7],[4,5,9,6,7,10,7,1,10,7,3,1],[7,8,4,2,3,11,10,6,5],[11,6,7,10,2,5,2,4,5,2,0,4],[11,6,7,8,0,3,1,10,2,9,4,5],[6,7,11,1,10,2,9,4,5],[7,8,4,5,1,2,5,2,6],[4,1,0,4,5,1,6,7,3,6,3,2],[9,4,5,8,0,7,0,6,7,0,2,6],[4,5,9,6,3,2,6,7,3],[6,7,11,4,5,8,5,3,8,5,1,3],[6,7,11,4,1,0,4,5,1],[4,5,9,3,8,0,11,6,7],[9,4,5,7,11,6],[10,6,4,10,4,9],[8,3,0,9,10,6,9,6,4],[1,10,0,10,6,0,0,6,4],[8,6,4,8,1,6,6,1,10,8,3,1],[2,3,11,6,4,9,6,9,10],[0,10,2,0,9,10,4,8,11,4,11,6],[10,2,1,11,6,3,6,0,3,6,4,0],[10,2,1,11,4,8,11,6,4],[9,1,4,1,2,4,4,2,6],[1,0,9,3,2,8,2,4,8,2,6,4],[2,4,0,2,6,4],[3,2,8,8,2,4,2,6,4],[1,4,9,11,4,1,11,1,3,11,6,4],[0,9,1,4,11,6,4,8,11],[11,6,3,3,6,0,6,4,0],[8,6,4,8,11,6],[6,7,10,7,8,10,10,8,9],[9,3,0,6,3,9,6,9,10,6,7,3],[6,1,10,6,7,1,7,0,1,7,8,0],[6,7,10,10,7,1,7,3,1],[7,11,6,3,8,2,8,10,2,8,9,10],[11,6,7,10,0,9,10,2,0],[2,1,10,7,11,6,8,0,3],[1,10,2,6,7,11],[7,2,6,7,9,2,2,9,1,7,8,9],[1,0,9,3,6,7,3,2,6],[8,0,7,7,0,6,0,2,6],[2,7,3,2,6,7],[7,11,6,3,9,1,3,8,9],[9,1,0,11,6,7],[0,3,8,11,6,7],[11,6,7],[11,7,5,11,5,10],[3,0,8,7,5,10,7,10,11],[9,0,1,10,11,7,10,7,5],[3,1,9,3,9,8,7,10,11,7,5,10],[10,2,5,2,3,5,5,3,7],[5,10,2,8,5,2,8,7,5,8,2,0],[9,0,1,10,2,5,5,2,3,5,3,7],[1,10,2,5,8,7,5,9,8],[2,11,1,11,7,1,1,7,5],[0,8,3,2,11,1,1,11,7,1,7,5],[9,0,2,9,2,7,2,11,7,9,7,5],[11,3,2,8,5,9,8,7,5],[1,3,7,1,7,5],[8,7,0,0,7,1,7,5,1],[0,3,9,9,3,5,3,7,5],[9,7,5,9,8,7],[4,5,8,5,10,8,8,10,11],[3,0,4,3,4,10,4,5,10,3,10,11],[0,1,9,4,5,8,8,5,10,8,10,11],[5,9,4,1,11,3,1,10,11],[3,8,4,3,4,2,2,4,5,2,5,10],[10,2,5,5,2,4,2,0,4],[0,3,8,5,9,4,10,2,1],[2,1,10,9,4,5],[8,4,5,2,8,5,2,11,8,2,5,1],[3,2,11,1,4,5,1,0,4],[9,4,5,8,2,11,8,0,2],[11,3,2,9,4,5],[4,5,8,8,5,3,5,1,3],[5,0,4,5,1,0],[3,8,0,4,5,9],[9,4,5],[7,4,11,4,9,11,11,9,10],[3,0,8,7,4,11,11,4,9,11,9,10],[11,7,4,1,11,4,1,10,11,1,4,0],[8,7,4,11,1,10,11,3,1],[2,3,7,2,7,9,7,4,9,2,9,10],[4,8,7,0,10,2,0,9,10],[2,1,10,0,7,4,0,3,7],[10,2,1,8,7,4],[2,11,7,2,7,1,1,7,4,1,4,9],[3,2,11,4,8,7,9,1,0],[7,4,11,11,4,2,4,0,2],[2,11,3,7,4,8],[9,1,4,4,1,7,1,3,7],[1,0,9,8,7,4],[3,4,0,3,7,4],[8,7,4],[8,9,10,8,10,11],[0,9,3,3,9,11,9,10,11],[1,10,0,0,10,8,10,11,8],[10,3,1,10,11,3],[3,8,2,2,8,10,8,9,10],[9,2,0,9,10,2],[8,0,3,1,10,2],[10,2,1],[2,11,1,1,11,9,11,8,9],[11,3,2,0,9,1],[11,0,2,11,8,0],[11,3,2],[8,1,3,8,9,1],[9,1,0],[8,0,3],[]]}march(x,y,b,_){let h=!!_.fulltable,f=_.hasOwnProperty("origin")&&_.origin.hasOwnProperty("x")?_.origin:{x:0,y:0,z:0},E=!!_.voxel,m=_.matrix,S=_.nX||0,w=_.nY||0,v=_.nZ||0,A=_.scale||1,M=null;_.unitCube?M=_.unitCube:M={x:A,y:A,z:A};let T=new Int32Array(S*w*v),R,P;for(R=0,P=T.length;R<P;++R)T[R]=-1;let L=function(k,U,F,j,H,B){let V={x:0,y:0,z:0},K=!!(j&1<<H),q=!!(j&1<<B),Te=H;if(!K&&q&&(Te=B),Te&1&&F++,Te&2&&U++,Te&4&&k++,m){let We=new n.Vector3(k,U,F);We=We.applyMatrix4(m),V={x:We.x,y:We.y,z:We.z}}else V.x=f.x+M.x*k,V.y=f.y+M.y*U,V.z=f.z+M.z*F;let Fe=(w*k+U)*v+F;return E?(y.push(V),y.length-1):(T[Fe]<0&&(T[Fe]=y.length,y.push(V)),T[Fe])},O=new Int32Array(12),I=h?this.edgeTable2:this.edgeTable,N=h?this.triTable2:this.triTable;for(R=0;R<S-1;++R)for(let k=0;k<w-1;++k)for(let U=0;U<v-1;++U){let F=0;for(let B=0;B<8;++B){let V=(w*(R+((B&4)>>2))+k+((B&2)>>1))*v+U+(B&1),K=!!(x[V]&this.ISDONE);F|=K<<B}if(F===0||F===255)continue;let j=I[F];if(j===0)continue;let H=N[F];j&1&&(O[0]=L(R,k,U,F,0,1)),j&2&&(O[1]=L(R,k,U,F,1,3)),j&4&&(O[2]=L(R,k,U,F,3,2)),j&8&&(O[3]=L(R,k,U,F,2,0)),j&16&&(O[4]=L(R,k,U,F,4,5)),j&32&&(O[5]=L(R,k,U,F,5,7)),j&64&&(O[6]=L(R,k,U,F,7,6)),j&128&&(O[7]=L(R,k,U,F,6,4)),j&256&&(O[8]=L(R,k,U,F,0,4)),j&512&&(O[9]=L(R,k,U,F,1,5)),j&1024&&(O[10]=L(R,k,U,F,3,7)),j&2048&&(O[11]=L(R,k,U,F,2,6));for(let B=0;B<H.length;B+=3){let V=O[H[B]],K=O[H[B+1]],q=O[H[B+2]];E&&B>=3&&(y.push(y[V]),V=y.length-1,y.push(y[K]),K=y.length-1,y.push(y[q]),q=y.length-1),b.push(V),b.push(K),b.push(q)}}}laplacianSmooth(x,y,b){let _=new Array(y.length),h,f,E,m,S;for(h=0,f=y.length;h<f;h++)_[h]={x:0,y:0,z:0};let w=new Array(20),v;for(h=0;h<20;h++)w[h]=new Array(y.length);for(h=0,f=y.length;h<f;h++)w[0][h]=0;for(h=0,f=b.length/3;h<f;h++){let T=h*3,R=h*3+1,P=h*3+2;for(v=!0,E=0,m=w[0][b[T]];E<m;E++)if(b[R]==w[E+1][b[T]]){v=!1;break}for(v&&(w[0][b[T]]++,w[w[0][b[T]]][b[T]]=b[R]),v=!0,E=0,m=w[0][b[T]];E<m;E++)if(b[P]==w[E+1][b[T]]){v=!1;break}for(v&&(w[0][b[T]]++,w[w[0][b[T]]][b[T]]=b[P]),v=!0,E=0,m=w[0][b[R]];E<m;E++)if(b[T]==w[E+1][b[R]]){v=!1;break}for(v&&(w[0][b[R]]++,w[w[0][b[R]]][b[R]]=b[T]),v=!0,E=0,m=w[0][b[R]];E<m;E++)if(b[P]==w[E+1][b[R]]){v=!1;break}for(v&&(w[0][b[R]]++,w[w[0][b[R]]][b[R]]=b[P]),v=!0,E=0;E<w[0][b[P]];E++)if(b[T]==w[E+1][b[P]]){v=!1;break}for(v&&(w[0][b[P]]++,w[w[0][b[P]]][b[P]]=b[T]),v=!0,E=0,m=w[0][b[P]];E<m;E++)if(b[R]==w[E+1][b[P]]){v=!1;break}v&&(w[0][b[P]]++,w[w[0][b[P]]][b[P]]=b[R])}let A=1,M=.5;for(S=0;S<x;S++){for(h=0,f=y.length;h<f;h++)if(w[0][h]<3)_[h].x=y[h].x,_[h].y=y[h].y,_[h].z=y[h].z;else if(w[0][h]==3||w[0][h]==4){for(_[h].x=0,_[h].y=0,_[h].z=0,E=0,m=w[0][h];E<m;E++)_[h].x+=y[w[E+1][h]].x,_[h].y+=y[w[E+1][h]].y,_[h].z+=y[w[E+1][h]].z;_[h].x+=M*y[h].x,_[h].y+=M*y[h].y,_[h].z+=M*y[h].z,_[h].x/=M+w[0][h],_[h].y/=M+w[0][h],_[h].z/=M+w[0][h]}else{for(_[h].x=0,_[h].y=0,_[h].z=0,E=0,m=w[0][h];E<m;E++)_[h].x+=y[w[E+1][h]].x,_[h].y+=y[w[E+1][h]].y,_[h].z+=y[w[E+1][h]].z;_[h].x+=A*y[h].x,_[h].y+=A*y[h].y,_[h].z+=A*y[h].z,_[h].x/=A+w[0][h],_[h].y/=A+w[0][h],_[h].z/=A+w[0][h]}for(h=0,f=y.length;h<f;h++)y[h].x=_[h].x,y[h].y=_[h].y,y[h].z=_[h].z}}}let l=new a;class d{constructor(x,y,b){this.data=new Int32Array(x*y*b*3),this.width=y,this.height=b}set(x,y,b,_){let h=((x*this.width+y)*this.height+b)*3;this.data[h]=_.ix,this.data[h+1]=_.iy,this.data[h+2]=_.iz}get(x,y,b){let _=((x*this.width+y)*this.height+b)*3;return{ix:this.data[_],iy:this.data[_+1],iz:this.data[_+2]}}}class u{constructor(){this.INOUT=1,this.ISDONE=2,this.ISBOUND=4,this.ptranx=0,this.ptrany=0,this.ptranz=0,this.probeRadius=1.4,this.defaultScaleFactor=2,this.scaleFactor=this.defaultScaleFactor,this.pHeight=0,this.pWidth=0,this.pLength=0,this.cutRadius=0,this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,this.pminx=0,this.pminy=0,this.pminz=0,this.pmaxx=0,this.pmaxy=0,this.pmaxz=0,this.depty={},this.widxz={},this.faces=[],this.verts=[],this.vdwRadii={H:1.2,Li:1.82,Na:2.27,K:2.75,C:1.7,N:1.55,O:1.52,F:1.47,P:1.8,S:1.8,CL:1.75,BR:1.85,SE:1.9,ZN:1.39,CU:1.4,NI:1.63,X:2},this.nb=[new Int32Array([1,0,0]),new Int32Array([-1,0,0]),new Int32Array([0,1,0]),new Int32Array([0,-1,0]),new Int32Array([0,0,1]),new Int32Array([0,0,-1]),new Int32Array([1,1,0]),new Int32Array([1,-1,0]),new Int32Array([-1,1,0]),new Int32Array([-1,-1,0]),new Int32Array([1,0,1]),new Int32Array([1,0,-1]),new Int32Array([-1,0,1]),new Int32Array([-1,0,-1]),new Int32Array([0,1,1]),new Int32Array([0,1,-1]),new Int32Array([0,-1,1]),new Int32Array([0,-1,-1]),new Int32Array([1,1,1]),new Int32Array([1,1,-1]),new Int32Array([1,-1,1]),new Int32Array([-1,1,1]),new Int32Array([1,-1,-1]),new Int32Array([-1,-1,1]),new Int32Array([-1,1,-1]),new Int32Array([-1,-1,-1])],u.MarchingCube||(u.MarchingCube=new a)}getVDWIndex(x){return!x.elem||typeof this.vdwRadii[x.elem]>"u"?"X":x.elem}getFacesAndVertices(x){let y={};for(let h=0,f=x.length;h<f;h++)y[x[h]]=!0;let b=this.verts;for(let h=0,f=b.length;h<f;h++)b[h].x=b[h].x/this.scaleFactor-this.ptranx,b[h].y=b[h].y/this.scaleFactor-this.ptrany,b[h].z=b[h].z/this.scaleFactor-this.ptranz;let _=[];for(let h=0,f=this.faces.length;h<f;h+=3){let E=this.faces[h],m=this.faces[h+1],S=this.faces[h+2],w=b[E].atomid,v=b[m].atomid,A=b[S].atomid,M=w;v<M&&(M=v),A<M&&(M=A),y[M]&&E!==m&&m!==S&&E!==S&&(_.push(E),_.push(m),_.push(S))}return this.vpBits=null,this.vpDistance=null,this.vpAtomID=null,{vertices:b,faces:_}}initparm(x,y,b){b>1e6&&(this.scaleFactor=this.defaultScaleFactor/2);let _=1/this.scaleFactor*5.5;this.pminx=x[0][0],this.pmaxx=x[1][0],this.pminy=x[0][1],this.pmaxy=x[1][1],this.pminz=x[0][2],this.pmaxz=x[1][2],y?(this.pminx-=this.probeRadius+_,this.pminy-=this.probeRadius+_,this.pminz-=this.probeRadius+_,this.pmaxx+=this.probeRadius+_,this.pmaxy+=this.probeRadius+_,this.pmaxz+=this.probeRadius+_):(this.pminx-=_,this.pminy-=_,this.pminz-=_,this.pmaxx+=_,this.pmaxy+=_,this.pmaxz+=_),this.pminx=Math.floor(this.pminx*this.scaleFactor)/this.scaleFactor,this.pminy=Math.floor(this.pminy*this.scaleFactor)/this.scaleFactor,this.pminz=Math.floor(this.pminz*this.scaleFactor)/this.scaleFactor,this.pmaxx=Math.ceil(this.pmaxx*this.scaleFactor)/this.scaleFactor,this.pmaxy=Math.ceil(this.pmaxy*this.scaleFactor)/this.scaleFactor,this.pmaxz=Math.ceil(this.pmaxz*this.scaleFactor)/this.scaleFactor,this.ptranx=-this.pminx,this.ptrany=-this.pminy,this.ptranz=-this.pminz,this.pLength=Math.ceil(this.scaleFactor*(this.pmaxx-this.pminx))+1,this.pWidth=Math.ceil(this.scaleFactor*(this.pmaxy-this.pminy))+1,this.pHeight=Math.ceil(this.scaleFactor*(this.pmaxz-this.pminz))+1,this.boundingatom(y),this.cutRadius=this.probeRadius*this.scaleFactor,this.vpBits=new Uint8Array(this.pLength*this.pWidth*this.pHeight),this.vpDistance=new Float64Array(this.pLength*this.pWidth*this.pHeight),this.vpAtomID=new Int32Array(this.pLength*this.pWidth*this.pHeight)}boundingatom(x){let y={};for(const b in this.vdwRadii){let _=this.vdwRadii[b];x?y[b]=(_+this.probeRadius)*this.scaleFactor+.5:y[b]=_*this.scaleFactor+.5;let h=y[b]*y[b];this.widxz[b]=Math.floor(y[b])+1,this.depty[b]=new Int32Array(this.widxz[b]*this.widxz[b]);let f=0;for(let E=0;E<this.widxz[b];E++)for(let m=0;m<this.widxz[b];m++){let S=E*E+m*m;if(S>h)this.depty[b][f]=-1;else{let w=Math.sqrt(h-S);this.depty[b][f]=Math.floor(w)}f++}}}fillvoxels(x,y){for(let b=0,_=this.vpBits.length;b<_;b++)this.vpBits[b]=0,this.vpDistance[b]=-1,this.vpAtomID[b]=-1;for(let b in y){let _=x[y[b]];_!==void 0&&this.fillAtom(_,x)}for(let b=0,_=this.vpBits.length;b<_;b++)this.vpBits[b]&this.INOUT&&(this.vpBits[b]|=this.ISDONE)}fillAtom(x,y){let b=Math.floor(.5+this.scaleFactor*(x.x+this.ptranx)),_=Math.floor(.5+this.scaleFactor*(x.y+this.ptrany)),h=Math.floor(.5+this.scaleFactor*(x.z+this.ptranz)),f=this.getVDWIndex(x),E=0,m=this.pWidth*this.pHeight;for(let S=0,w=this.widxz[f];S<w;S++)for(let v=0;v<w;v++){if(this.depty[f][E]!=-1){for(let A=-1;A<2;A++)for(let M=-1;M<2;M++)for(let T=-1;T<2;T++)if(A!==0&&M!==0&&T!==0){let R=A*S,P=T*v;for(let L=0;L<=this.depty[f][E];L++){let O=L*M,I=b+R,N=_+O,k=h+P;if(I<0||N<0||k<0||I>=this.pLength||N>=this.pWidth||k>=this.pHeight)continue;let U=I*m+N*this.pHeight+k;if(!(this.vpBits[U]&this.INOUT))this.vpBits[U]|=this.INOUT,this.vpAtomID[U]=x.serial;else{let F=y[this.vpAtomID[U]];if(F.serial!=x.serial){let j=b+R-Math.floor(.5+this.scaleFactor*(F.x+this.ptranx)),H=_+O-Math.floor(.5+this.scaleFactor*(F.y+this.ptrany)),B=h+P-Math.floor(.5+this.scaleFactor*(F.z+this.ptranz));R*R+O*O+P*P<j*j+H*H+B*B&&(this.vpAtomID[U]=x.serial)}}}}}E++}}fillvoxelswaals(x,y){for(let b=0,_=this.vpBits.length;b<_;b++)this.vpBits[b]&=~this.ISDONE;for(let b in y){let _=x[y[b]];_!==void 0&&this.fillAtomWaals(_,x)}}fillAtomWaals(x,y){let b=0,_=Math.floor(.5+this.scaleFactor*(x.x+this.ptranx)),h=Math.floor(.5+this.scaleFactor*(x.y+this.ptrany)),f=Math.floor(.5+this.scaleFactor*(x.z+this.ptranz)),E=this.getVDWIndex(x),m=this.pWidth*this.pHeight;for(let S=0,w=this.widxz[E];S<w;S++)for(let v=0;v<w;v++){if(this.depty[E][b]!=-1){for(let A=-1;A<2;A++)for(let M=-1;M<2;M++)for(let T=-1;T<2;T++)if(A!==0&&M!==0&&T!==0){let R=A*S,P=T*v;for(let L=0;L<=this.depty[E][b];L++){let O=L*M,I=_+R,N=h+O,k=f+P;if(I<0||N<0||k<0||I>=this.pLength||N>=this.pWidth||k>=this.pHeight)continue;let U=I*m+N*this.pHeight+k;if(!(this.vpBits[U]&this.ISDONE))this.vpBits[U]|=this.ISDONE,this.vpAtomID[U]=x.serial;else{let F=y[this.vpAtomID[U]];if(F.serial!=x.serial){let j=_+R-Math.floor(.5+this.scaleFactor*(F.x+this.ptranx)),H=h+O-Math.floor(.5+this.scaleFactor*(F.y+this.ptrany)),B=f+P-Math.floor(.5+this.scaleFactor*(F.z+this.ptranz));R*R+O*O+P*P<j*j+H*H+B*B&&(this.vpAtomID[U]=x.serial)}}}}}b++}}buildboundary(){let x=this.pWidth*this.pHeight;for(let y=0;y<this.pLength;y++)for(let b=0;b<this.pHeight;b++)for(let _=0;_<this.pWidth;_++){let h=y*x+_*this.pHeight+b;if(this.vpBits[h]&this.INOUT){let f=0;for(;f<26;){let E=y+this.nb[f][0],m=b+this.nb[f][2],S=_+this.nb[f][1];if(E>-1&&E<this.pLength&&S>-1&&S<this.pWidth&&m>-1&&m<this.pHeight&&!(this.vpBits[E*x+S*this.pHeight+m]&this.INOUT)){this.vpBits[h]|=this.ISBOUND;break}else f++}}}}fastdistancemap(){let x=new d(this.pLength,this.pWidth,this.pHeight),y=this.pWidth*this.pHeight,b=this.cutRadius*this.cutRadius,_=[],h=[],f;for(let S=0;S<this.pLength;S++)for(let w=0;w<this.pWidth;w++)for(let v=0;v<this.pHeight;v++)if(f=S*y+w*this.pHeight+v,this.vpBits[f]&=~this.ISDONE,this.vpBits[f]&this.INOUT&&this.vpBits[f]&this.ISBOUND){let A={ix:S,iy:w,iz:v};x.set(S,w,v,A),_.push(A),this.vpDistance[f]=0,this.vpBits[f]|=this.ISDONE,this.vpBits[f]&=~this.ISBOUND}do{h=this.fastoneshell(_,x),_=[];for(let S=0,w=h.length;S<w;S++)f=y*h[S].ix+this.pHeight*h[S].iy+h[S].iz,this.vpBits[f]&=~this.ISBOUND,this.vpDistance[f]<=1.0404*b&&_.push({ix:h[S].ix,iy:h[S].iy,iz:h[S].iz})}while(_.length!==0);_=[],h=[],x=null;let E=this.scaleFactor-.5;E<0&&(E=0);let m=b-.5/(.1+E);for(let S=0;S<this.pLength;S++)for(let w=0;w<this.pWidth;w++)for(let v=0;v<this.pHeight;v++)f=S*y+w*this.pHeight+v,this.vpBits[f]&=~this.ISBOUND,this.vpBits[f]&this.INOUT&&(!(this.vpBits[f]&this.ISDONE)||this.vpBits[f]&this.ISDONE&&this.vpDistance[f]>=m)&&(this.vpBits[f]|=this.ISBOUND)}fastoneshell(x,y){let b,_,h,f,E,m,S,w,v,A=[];if(x.length===0)return A;let M={ix:-1,iy:-1,iz:-1},T=this.pWidth*this.pHeight;for(let R=0,P=x.length;R<P;R++){b=x[R].ix,_=x[R].iy,h=x[R].iz,w=y.get(b,_,h);for(let L=0;L<6;L++)M.ix=b+this.nb[L][0],M.iy=_+this.nb[L][1],M.iz=h+this.nb[L][2],M.ix<this.pLength&&M.ix>-1&&M.iy<this.pWidth&&M.iy>-1&&M.iz<this.pHeight&&M.iz>-1&&(v=M.ix*T+this.pHeight*M.iy+M.iz,this.vpBits[v]&this.INOUT&&!(this.vpBits[v]&this.ISDONE)?(y.set(M.ix,M.iy,h+this.nb[L][2],w),f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,this.vpDistance[v]=S,this.vpBits[v]|=this.ISDONE,this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})):this.vpBits[v]&this.INOUT&&this.vpBits[v]&this.ISDONE&&(f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,S<this.vpDistance[v]&&(y.set(M.ix,M.iy,M.iz,w),this.vpDistance[v]=S,this.vpBits[v]&this.ISBOUND||(this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})))))}for(let R=0,P=x.length;R<P;R++){b=x[R].ix,_=x[R].iy,h=x[R].iz,w=y.get(b,_,h);for(let L=6;L<18;L++)M.ix=b+this.nb[L][0],M.iy=_+this.nb[L][1],M.iz=h+this.nb[L][2],M.ix<this.pLength&&M.ix>-1&&M.iy<this.pWidth&&M.iy>-1&&M.iz<this.pHeight&&M.iz>-1&&(v=M.ix*T+this.pHeight*M.iy+M.iz,this.vpBits[v]&this.INOUT&&!(this.vpBits[v]&this.ISDONE)?(y.set(M.ix,M.iy,h+this.nb[L][2],w),f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,this.vpDistance[v]=S,this.vpBits[v]|=this.ISDONE,this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})):this.vpBits[v]&this.INOUT&&this.vpBits[v]&this.ISDONE&&(f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,S<this.vpDistance[v]&&(y.set(M.ix,M.iy,M.iz,w),this.vpDistance[v]=S,this.vpBits[v]&this.ISBOUND||(this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})))))}for(let R=0,P=x.length;R<P;R++){b=x[R].ix,_=x[R].iy,h=x[R].iz,w=y.get(b,_,h);for(let L=18;L<26;L++)M.ix=b+this.nb[L][0],M.iy=_+this.nb[L][1],M.iz=h+this.nb[L][2],M.ix<this.pLength&&M.ix>-1&&M.iy<this.pWidth&&M.iy>-1&&M.iz<this.pHeight&&M.iz>-1&&(v=M.ix*T+this.pHeight*M.iy+M.iz,this.vpBits[v]&this.INOUT&&!(this.vpBits[v]&this.ISDONE)?(y.set(M.ix,M.iy,h+this.nb[L][2],w),f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,this.vpDistance[v]=S,this.vpBits[v]|=this.ISDONE,this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})):this.vpBits[v]&this.INOUT&&this.vpBits[v]&this.ISDONE&&(f=M.ix-w.ix,E=M.iy-w.iy,m=M.iz-w.iz,S=f*f+E*E+m*m,S<this.vpDistance[v]&&(y.set(M.ix,M.iy,M.iz,w),this.vpDistance[v]=S,this.vpBits[v]&this.ISBOUND||(this.vpBits[v]|=this.ISBOUND,A.push({ix:M.ix,iy:M.iy,iz:M.iz})))))}return A}marchingcubeinit(x){for(let y=0,b=this.vpBits.length;y<b;y++)x==1?this.vpBits[y]&=~this.ISBOUND:x==4?(this.vpBits[y]&=~this.ISDONE,this.vpBits[y]&this.ISBOUND&&(this.vpBits[y]|=this.ISDONE),this.vpBits[y]&=~this.ISBOUND):x==2?this.vpBits[y]&this.ISBOUND&&this.vpBits[y]&this.ISDONE?this.vpBits[y]&=~this.ISBOUND:this.vpBits[y]&this.ISBOUND&&!(this.vpBits[y]&this.ISDONE)&&(this.vpBits[y]|=this.ISDONE):x==3&&(this.vpBits[y]&=~this.ISBOUND)}marchingcube(x){this.marchingcubeinit(x),this.verts=[],this.faces=[],u.MarchingCube.march(this.vpBits,this.verts,this.faces,{smooth:1,nX:this.pLength,nY:this.pWidth,nZ:this.pHeight});let y=this.pWidth*this.pHeight;for(let b=0,_=this.verts.length;b<_;b++)this.verts[b].atomid=this.vpAtomID[this.verts[b].x*y+this.pHeight*this.verts[b].y+this.verts[b].z];u.MarchingCube.laplacianSmooth(1,this.verts,this.faces)}}u.MarchingCube=new a}),"./src/SurfaceWorker.js":(()=>{$3Dmol.workerString=(function(){self.onmessage=function(r){var e=r.data,t=e.type;if(t<0)self.atomData=e.atoms,self.volume=e.volume,self.ps=new ProteinSurface;else{var n=self.ps;n.initparm(e.expandedExtent,t!=1,self.volume),n.fillvoxels(self.atomData,e.extendedAtoms),n.buildboundary(),(t===4||t===2)&&(n.fastdistancemap(),n.boundingatom(!1),n.fillvoxelswaals(self.atomData,e.extendedAtoms)),n.marchingcube(t);var i=n.getFacesAndVertices(e.atomsToShow);self.postMessage(i)}}}).toString().replace(/(^.*?\{|\}$)/g,""),$3Dmol.workerString+=`;
function _classCallCheck() {};`,$3Dmol.workerString+=`;
`+$3Dmol.Vector3.toString(),$3Dmol.workerString+=`;
`+$3Dmol.MarchingCubeInitializer.toString()+`;

`,$3Dmol.workerString+=`;
`+$3Dmol.PointGrid.toString()+`;
`,$3Dmol.workerString+=`;
var ProteinSurface = `+$3Dmol.ProteinSurface.toString()+`;
`,$3Dmol.SurfaceWorker=window.URL?window.URL.createObjectURL(new Blob([$3Dmol.workerString],{type:"text/javascript"})):void 0}),"./src/VolumeData.ts":((r,e,t)=>{t.r(e),t.d(e,{VolumeData:()=>l});var n=t("./src/utilities.ts"),i=t("./src/WebGL/math/index.ts"),s=t("./src/parsers/VASP.ts"),o=t("./src/parsers/CUBE.ts"),a=t("./node_modules/pako/dist/pako.esm.mjs");class l{constructor(u,g,x){if(this.unit={x:1,y:1,z:1},this.origin={x:0,y:0,z:0},this.size={x:0,y:0,z:0},this.data=new Float32Array([]),this.matrix=null,this.inversematrix=null,this.isbinary=new Set(["ccp4","CCP4"]),this.getCoordinates=function(f){var E=f/(this.size.y*this.size.z),m=f%(this.size.y*this.size.z),S=f%this.size.z;return E*=this.unit.x,m*=this.unit.y,S*=this.unit.z,E+=this.origin.x,m+=this.origin.y,S+=this.origin.z,{x:E,y:m,z:S}},this.vasp=function(f){var E=f.replace(/^\s+/,"").split(/[\n\r]/),m=(0,s.VASP)(f)[0],S=m.length;if(S==0){console.warn("No good formating of CHG or CHGCAR file, not atomic information provided in the file."),this.data=[];return}var w=1.889725992,v=.036749309,A=parseFloat(E[1]),M;M=E[2].replace(/^\s+/,"").split(/\s+/);var T=new i.Vector3(parseFloat(M[0]),parseFloat(M[1]),parseFloat(M[2])).multiplyScalar(A*w);M=E[3].replace(/^\s+/,"").split(/\s+/);var R=new i.Vector3(parseFloat(M[0]),parseFloat(M[1]),parseFloat(M[2])).multiplyScalar(A*w);M=E[4].replace(/^\s+/,"").split(/\s+/);var P=new i.Vector3(parseFloat(M[0]),parseFloat(M[1]),parseFloat(M[2])).multiplyScalar(A*w),L=T.x*(R.y*P.z-P.y*R.z)-R.x*(T.y*P.z-P.y*T.z)+P.x*(T.y*R.z-R.y*T.z);L=Math.abs(L)/Math.pow(w,3);var O=1/L;E.splice(0,8+S+1);var I=E[0].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),N=Math.abs(parseFloat(I[0])),k=Math.abs(parseFloat(I[1])),U=Math.abs(parseFloat(I[2])),F=this.origin=new i.Vector3(0,0,0);this.size={x:N,y:k,z:U},this.unit=new i.Vector3(T.x,R.y,P.z),T=T.multiplyScalar(1/(w*N)),R=R.multiplyScalar(1/(w*k)),P=P.multiplyScalar(1/(w*U)),(T.y!=0||T.z!=0||R.x!=0||R.z!=0||P.x!=0||P.y!=0)&&(this.matrix=new i.Matrix4(T.x,R.x,P.x,0,T.y,R.y,P.y,0,T.z,R.z,P.z,0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new i.Matrix4().makeTranslation(F.x,F.y,F.z)),this.origin=new i.Vector3(0,0,0),this.unit=new i.Vector3(1,1,1)),E.splice(0,1);var j=E.join(" ");j=j.replace(/^\s+/,"");var H=j.split(/[\s\r]+/);H.splice(N*k*U+1);for(var B=Float32Array.from(H,parseFloat),V=0;V<B.length;V++)B[V]=B[V]*O*v;this.data=B},this.dx=function(f){var E=f.split(/[\n\r]+/),m,S=/gridpositions\s+counts\s+(\d+)\s+(\d+)\s+(\d+)/,w=/^origin\s+(\S+)\s+(\S+)\s+(\S+)/,v=/^delta\s+(\S+)\s+(\S+)\s+(\S+)/,A=/data follows/,M=0;for(M=0;M<E.length;M++){var T=E[M];if(m=S.exec(T)){var R=parseInt(m[1]),P=parseInt(m[2]),L=parseInt(m[3]);this.size={x:R,y:P,z:L}}else if(m=v.exec(T)){var O=parseFloat(m[1]);if((parseFloat(m[2])!=0||parseFloat(m[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),M+=1,T=E[M],m=v.exec(T),m==null){console.error("Parse error in dx delta matrix");return}var I=parseFloat(m[2]);if((parseFloat(m[1])!=0||parseFloat(m[3])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),M+=1,T=E[M],m=v.exec(T),m==null){console.error("Parse error in dx delta matrix");return}var N=parseFloat(m[3]);(parseFloat(m[1])!=0||parseFloat(m[2])!=0)&&console.warn("Non-orthogonal delta matrix not currently supported in dx format"),this.unit=new i.Vector3(O,I,N)}else if(m=w.exec(T)){var k=parseFloat(m[1]),U=parseFloat(m[2]),F=parseFloat(m[3]);this.origin=new i.Vector3(k,U,F)}else if(m=A.exec(T))break}if(M+=1,!this.size||!this.origin||!this.unit||!this.size){console.error("Error parsing dx format");return}var j=E.splice(M).join(" "),H=j.split(/[\s\r]+/);this.data=Float32Array.from(H,parseFloat)},g=g.toLowerCase(),/\.gz$/.test(g)){g=g.replace(/\.gz$/,"");try{this[g]&&this.isbinary.has(g)?(typeof u=="string"&&(u=(0,n.base64ToArray)(u)),u=(0,a.inflate)(u)):u=new TextDecoder("utf-8").decode((0,a.inflate)(u))}catch(f){console.error(f)}}if(this[g]&&(this.isbinary.has(g)&&typeof u=="string"&&(u=(0,n.base64ToArray)(u)),this[g](u)),x){if(x.negate)for(let f=0,E=this.data.length;f<E;f++)this.data[f]=-this.data[f];if(x.normalize){var y=0;for(let f=0,E=this.data.length;f<E;f++)y+=this.data[f];var b=y/this.data.length;y=0;for(let f=0,E=this.data.length;f<E;f++){var _=this.data[f]-b;y+=_*_}var h=y/this.data.length;for(let f=0,E=this.data.length;f<E;f++)this.data[f]=(this.data[f]-b)/h}}}getIndex(u,g,x){if(this.matrix){this.inversematrix==null&&(this.inversematrix=new i.Matrix4().getInverse(this.matrix));var y=new i.Vector3(u,g,x);y=y.applyMatrix4(this.inversematrix),u=y.x,g=y.y,x=y.z}else u-=this.origin.x,g-=this.origin.y,x-=this.origin.z,u/=this.unit.x,g/=this.unit.y,x/=this.unit.z;return u=Math.round(u),g=Math.round(g),x=Math.round(x),u<0||u>=this.size.x||g<0||g>=this.size.y||x<0||x>=this.size.z?-1:u*this.size.y*this.size.z+g*this.size.z+x}getVal(u,g,x){let y=this.getIndex(u,g,x);return y<0?0:this.data[y]}cube(u){var g=u.split(/\r?\n/);if(!(g.length<6)){var x=(0,o.CUBE)(u,{}).modelData[0].cryst,y=g[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),b=parseFloat(y[0]),_=Math.abs(b);this.origin=x.origin,this.size=x.size,this.unit=x.unit,this.matrix=x.matrix4;var h=6;b<0&&h++;var f=g.splice(_+h).join(" ");f=f.replace(/^\s+/,"");var E=f.split(/[\s\r]+/);this.data=Float32Array.from(E,parseFloat)}}ccp4(u){var g={};u=new Int8Array(u);var x=new Int32Array(u.buffer,0,56),y=new Float32Array(u.buffer,0,56),b=new DataView(u.buffer);if(g.MAP=String.fromCharCode(b.getUint8(208),b.getUint8(209),b.getUint8(210),b.getUint8(211)),g.MACHST=[b.getUint8(212),b.getUint8(213)],g.MACHST[0]===17&&g.MACHST[1]===17)for(var _=u.byteLength,h=0;h<_;h+=4)b.setFloat32(h,b.getFloat32(h),!0);g.NX=x[0],g.NY=x[1],g.NZ=x[2],g.MODE=x[3],g.NXSTART=x[4],g.NYSTART=x[5],g.NZSTART=x[6],g.MX=x[7],g.MY=x[8],g.MZ=x[9],g.xlen=y[10],g.ylen=y[11],g.zlen=y[12],g.alpha=y[13],g.beta=y[14],g.gamma=y[15],g.MAPC=x[16],g.MAPR=x[17],g.MAPS=x[18],g.DMIN=y[19],g.DMAX=y[20],g.DMEAN=y[21],g.ISPG=x[22],g.NSYMBT=x[23],g.LSKFLG=x[24],g.originX=y[49],g.originY=y[50],g.originZ=y[51],g.ARMS=y[54];var f=g,E=[f.xlen,0,0],m=[f.ylen*Math.cos(Math.PI/180*f.gamma),f.ylen*Math.sin(Math.PI/180*f.gamma),0],S=[f.zlen*Math.cos(Math.PI/180*f.beta),f.zlen*(Math.cos(Math.PI/180*f.alpha)-Math.cos(Math.PI/180*f.gamma)*Math.cos(Math.PI/180*f.beta))/Math.sin(Math.PI/180*f.gamma),0];S[2]=Math.sqrt(f.zlen*f.zlen*Math.sin(Math.PI/180*f.beta)*Math.sin(Math.PI/180*f.beta)-S[1]*S[1]);var w=[0,E,m,S],v=[0,f.MX,f.MY,f.MZ],A=[0,f.MAPC,f.MAPR,f.MAPS];this.matrix=new i.Matrix4,this.matrix.set(w[A[1]][0]/v[A[1]],w[A[2]][0]/v[A[2]],w[A[3]][0]/v[A[3]],0,w[A[1]][1]/v[A[1]],w[A[2]][1]/v[A[2]],w[A[3]][1]/v[A[3]],0,w[A[1]][2]/v[A[1]],w[A[2]][2]/v[A[2]],w[A[3]][2]/v[A[3]],0,0,0,0,1),this.matrix=this.matrix.multiplyMatrices(this.matrix,new i.Matrix4().makeTranslation(f.NXSTART+f.originX,f.NYSTART+f.originY,f.NZSTART+f.originZ)),this.origin=new i.Vector3(0,0,0),this.unit=new i.Vector3(1,1,1),this.size={x:g.NX,y:g.NY,z:g.NZ},this.dimensionorder=[g.MAPC,g.MAPR,g.MAPS];var M=new Float32Array(u.buffer,1024+g.NSYMBT),T=g.NX,R=g.NY,P=g.NZ;this.data=new Float32Array(T*R*P);for(let L=0;L<T;L++)for(let O=0;O<R;O++)for(let I=0;I<P;I++)this.data[(L*R+O)*P+I]=M[(I*R+O)*T+L]}}}),"./src/VolumetricRender.ts":((r,e,t)=>{t.r(e),t.d(e,{GLVolumetricRender:()=>l});var n=t("./src/WebGL/shapes/index.ts"),i=t("./src/WebGL/math/index.ts"),s=t("./src/WebGL/index.ts"),o=t("./src/colors.ts"),a=t("./src/GLShape.ts");class l{static interpolateArray(u,g){function x(S,w,v){return S+(w-S)*v}var y=[],b=(u.length-1)/(g-1);y[0]=u[0];for(var _=1;_<g-1;_++){var h=_*b,f=Math.floor(h),E=Math.ceil(h),m=h-f;y[_]=x(u[f],u[E],m)}return y[g-1]=u[u.length-1],y}constructor(u,g,x){this.hidden=!1,this.boundingSphere=new n.Sphere,this.renderedShapeObj=null,this.shapeObj=null,this.subsamples=5,this.data=null,this.transferfunctionbuffer=[],this.min=0,this.max=0,g=g||{};var y=Object.assign([],g.transferfn);this.subsamples=g.subsamples||5;let b=256;y.forEach(function(R){R.value=parseFloat(R.value)}),y.sort(function(R,P){return R.value-P.value}),this.min=y[0].value,y.length==0&&y.push(y[0]),this.max=y[y.length-1].value;var _,h,f,E,m,S,w,v,A,M;for(let R=0;R<y.length-1;R++)if(f=o.CC.color(y[R].color),E=o.CC.color(y[R+1].color),A=y[R].opacity,M=y[R+1].opacity,_=Math.floor((y[R].value-this.min)*b/(this.max-this.min)),h=Math.floor((y[R+1].value-this.min)*b/(this.max-this.min)),_!=h){m=l.interpolateArray([f.r*255,E.r*255],h-_),S=l.interpolateArray([f.g*255,E.g*255],h-_),w=l.interpolateArray([f.b*255,E.b*255],h-_),v=l.interpolateArray([A*255,M*255],h-_);for(let P=0;P<m.length;P++)this.transferfunctionbuffer.push(m[P]),this.transferfunctionbuffer.push(S[P]),this.transferfunctionbuffer.push(w[P]),this.transferfunctionbuffer.push(v[P])}if(this.transferfunctionbuffer=new Uint8ClampedArray(this.transferfunctionbuffer),u.matrix){let R=new i.Vector3(0,0,0),P=new i.Vector3(u.size.x,u.size.y,u.size.z),L=new i.Vector3(1,1,1);R.applyMatrix4(u.matrix),P.applyMatrix4(u.matrix),L.applyMatrix4(u.matrix).sub(R),this.extent=[[R.x,R.y,R.z],[P.x,P.y,P.z]];for(let k=1;k<7;k++)P.x=k&1?u.size.x:0,P.y=k&2?u.size.y:0,P.z=k&4?u.size.z:0,P.applyMatrix4(u.matrix),this.extent[0][0]=Math.min(this.extent[0][0],P.x),this.extent[0][1]=Math.min(this.extent[0][1],P.y),this.extent[0][2]=Math.min(this.extent[0][2],P.z),this.extent[1][0]=Math.max(this.extent[1][0],P.x),this.extent[1][1]=Math.max(this.extent[1][1],P.y),this.extent[1][2]=Math.max(this.extent[1][2],P.z);let O=P.x-R.x,I=P.y-R.y,N=P.z-R.z;this.maxdepth=Math.sqrt(O*O+I*I+N*N),this.minunit=Math.min(Math.min(L.x,L.y),L.z),this.texmatrix=new i.Matrix4().identity().scale({x:u.size.x,y:u.size.y,z:u.size.z}),this.texmatrix=this.texmatrix.multiplyMatrices(u.matrix,this.texmatrix),this.texmatrix=this.texmatrix.getInverse(this.texmatrix)}else{this.texmatrix=new i.Matrix4().identity();let R=u.unit.x*u.size.x,P=u.unit.y*u.size.y,L=u.unit.z*u.size.z;this.texmatrix.makeTranslation(-u.origin.x/R,-u.origin.y/P,-u.origin.z/L),this.texmatrix.scale({x:1/R,y:1/P,z:1/L}),this.minunit=Math.min(Math.min(u.unit.x,u.unit.y),u.unit.z),this.extent=[[u.origin.x,u.origin.y,u.origin.z],[u.origin.x+R,u.origin.y+P,u.origin.z+L]],this.maxdepth=Math.sqrt(R*R+P*P+L*L)}var T=new a.GLShape({});if(T.addBox({corner:{x:this.extent[0][0],y:this.extent[0][1],z:this.extent[0][2]},dimensions:{w:this.extent[1][0]-this.extent[0][0],h:this.extent[1][1]-this.extent[0][1],d:this.extent[1][2]-this.extent[0][2]}}),this.geo=T.finalize(),this.boundingSphere.center=new i.Vector3((this.extent[0][0]+this.extent[1][0])/2,(this.extent[0][1]+this.extent[1][1])/2,(this.extent[0][2]+this.extent[1][2])/2),this.boundingSphere.radius=this.maxdepth/2,g.coords===void 0&&g.selection!==void 0&&(x?g.coords=x.selectedAtoms(g.selection):console.log("Need to provide viewer to volumetric renderer if selection specified.")),g.coords!==void 0&&g.seldist!==void 0){let R=new Uint8Array(u.data.length),P=g.seldist,L=P*P;for(let O=0,I=g.coords.length;O<I;O++){let N=g.coords[O],k=N.x-P,U=N.y-P,F=N.z-P,j=N.x+P,H=N.y+P,B=N.z+P;if(u.getIndex(k,U,F)>=0||u.getIndex(j,H,B)>=0)for(let V=k;V<j;V+=this.minunit)for(let K=U;K<H;K+=this.minunit)for(let q=F;q<B;q+=this.minunit){let Te=u.getIndex(V,K,q);Te>=0&&!R[Te]&&(V-N.x)*(V-N.x)+(K-N.y)*(K-N.y)+(q-N.z)*(q-N.z)<L&&(R[Te]=1)}}for(let O=0,I=u.data.length;O<I;O++)R[O]==0&&(u.data[O]=1/0)}this.data=u}globj(u){if(this.renderedShapeObj&&(u.remove(this.renderedShapeObj),this.renderedShapeObj=null),!this.hidden){this.shapeObj=new s.Object3D;var g=null,x=new s.Texture(this.data,!0),y=new s.Texture(this.transferfunctionbuffer,!1);x.needsUpdate=!0,y.needsUpdate=!0,y.flipY=!1,g=new s.VolumetricMaterial({transferfn:y,transfermin:this.min,transfermax:this.max,map:x,extent:this.extent,maxdepth:this.maxdepth,texmatrix:this.texmatrix,unit:this.minunit,subsamples:this.subsamples});var b=new s.Mesh(this.geo,g);this.shapeObj.add(b),this.renderedShapeObj=this.shapeObj.clone(),u.add(this.renderedShapeObj)}}removegl(u){this.renderedShapeObj&&(this.renderedShapeObj.geometry!==void 0&&this.renderedShapeObj.geometry.dispose(),this.renderedShapeObj.material!==void 0&&this.renderedShapeObj.material.dispose(),u.remove(this.renderedShapeObj),this.renderedShapeObj=null),this.shapeObj=null}get position(){return this.boundingSphere.center}get x(){return this.boundingSphere.center.x}get y(){return this.boundingSphere.center.y}get z(){return this.boundingSphere.center.z}}}),"./src/WebGL/Camera.ts":((r,e,t)=>{t.r(e),t.d(e,{Camera:()=>s});var n=t("./src/WebGL/core/index.ts"),i=t("./src/WebGL/math/index.ts");class s extends n.Object3D{constructor(a=50,l=1,d=.1,u=2e3,g=!1){super(),this.projectionMatrix=new i.Matrix4,this.projectionMatrixInverse=new i.Matrix4,this.matrixWorldInverse=new i.Matrix4,this.fov=a,this.aspect=l,this.near=d,this.far=u;var x=this.position.z;this.right=x*Math.tan(Math.PI/180*a),this.left=-this.right,this.top=this.right/this.aspect,this.bottom=-this.top,this.ortho=!!g,this.updateProjectionMatrix()}lookAt(a){this.matrix.lookAt(this.position,a,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!1&&this.rotation instanceof i.Vector3?this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder):console.error("Unimplemented math operation."))}updateProjectionMatrix(){this.ortho?this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far):this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)}}}),"./src/WebGL/Fog.ts":((r,e,t)=>{t.r(e),t.d(e,{Fog:()=>i});var n=t("./src/colors.ts");class i{constructor(o,a=1,l=1e3){this.name="",this.color=new n.Color(o),this.near=a,this.far=l}clone(){return new i(this.color.getHex(),this.near,this.far)}}}),"./src/WebGL/Renderer.ts":((r,e,t)=>{t.r(e),t.d(e,{Renderer:()=>_});var n=t("./src/WebGL/Camera.ts"),i=t("./src/WebGL/constants/Sides.ts"),s=t("./src/WebGL/constants/TextureConstants.ts"),o=t("./src/WebGL/core/index.ts"),a=t("./src/colors.ts"),l=t("./src/WebGL/materials/index.ts"),d=t("./src/WebGL/math/index.ts"),u=t("./src/WebGL/objects/index.ts"),g=t("./src/WebGL/shaders/index.ts"),x=t("./src/WebGL/SpritePlugin.ts"),y=null,b=null;class _{constructor(f){this.context=null,this.devicePixelRatio=1,this.sortObjects=!0,this.autoUpdateObjects=!0,this.autoUpdateScene=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}},this._offscreen=null,this._bitmap=null,this._programs=[],this._programs_counter=0,this._webglversion=1,this._currentProgram=null,this._currentMaterialId=-1,this._currentGeometryGroupHash=null,this._currentCamera=null,this._geometryGroupCounter=0,this._oldDoubleSided=-1,this._oldFlipSided=-1,this._oldDepthTest=-1,this._oldDepthWrite=-1,this._oldPolygonOffset=null,this._oldLineWidth=null,this._viewportWidth=0,this._viewportHeight=0,this._currentWidth=0,this._currentHeight=0,this._enabledAttributes={},this._vector3=new d.Vector3,this._worldInverse=new d.Matrix4,this._projInverse=new d.Matrix4,this._textureMatrix=new d.Matrix4,this._fullProjModelMatrix=new d.Matrix4,this._fullProjModelMatrixInv=new d.Matrix4,this._direction=new d.Vector3,this._lightsNeedUpdate=!0,this._lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},this.sprites=new x.SpritePlugin,this._screenshader=null,this._AOshader=null,this._blurshader=null,this._vertexattribpos=null,this._aovertexattribpos=null,this._blurvertexattribpos=null,this._screenQuadVBO=null,this._fb=null,this._targetTexture=null,this._depthTexture=null,this._shadingTexture=null,this._scratchTexture=null,this._upscale=null,this._AOstrength=1,this._AOradius=5,this.SHADE_TEXTURE=3,f=f||{},this.row=f.row,this.col=f.col,this.rows=f.rows,this.cols=f.cols,this._canvas=f.canvas!==void 0?f.canvas:document.createElement("canvas"),this._precision=f.precision!==void 0?f.precision:"highp",this._alpha=f.alpha!==void 0?f.alpha:!0,this._premultipliedAlpha=f.premultipliedAlpha!==void 0?f.premultipliedAlpha:!0,this._antialias=f.antialias!==void 0?f.antialias:!1,this._upscale=f.upscale!==void 0?f.upscale:this._antialias,this._preserveDrawingBuffer=f.preserveDrawingBuffer!==void 0?f.preserveDrawingBuffer:!1,this._clearColor=f.clearColor!==void 0?new a.Color(f.clearColor):new a.Color(0),this._clearAlpha=f.clearAlpha!==void 0?f.clearAlpha:0,this._outlineMaterial=new l.MeshOutlineMaterial(f.outline),this._outlineSphereImposterMaterial=new l.SphereImposterOutlineMaterial(f.outline),this._outlineStickImposterMaterial=new l.StickImposterOutlineMaterial(f.outline),this._outlineEnabled=!!f.outline,this._AOEnabled=!!f.ambientOcclusion,f.ambientOcclusion&&typeof f.ambientOcclusion.strength<"u"&&(this._AOstrength=parseFloat(f.ambientOcclusion.strength)),this._AOstrength==0&&(this._AOEnabled=!1),f.ambientOcclusion&&typeof f.ambientOcclusion.radius<"u"&&(this._AOradius=parseFloat(f.ambientOcclusion.radius)),this.domElement=this._canvas,this._canvas.id=f.id,!(f.containerWidth==0||f.containerHeight==0)&&(this.initGL(),this.setDefaultGLState(),this.context=this._gl,this.isWebGL1()?this._extInstanced=this._gl.getExtension("ANGLE_instanced_arrays"):this._extInstanced={vertexAttribDivisorANGLE:this._gl.vertexAttribDivisor.bind(this._gl),drawElementsInstancedANGLE:this._gl.drawElementsInstanced.bind(this._gl)},this._extFragDepth=this._gl.getExtension("EXT_frag_depth"),this._extFloatLinear=this._gl.getExtension("OES_texture_float_linear"),this._extColorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this.sprites.init(this))}supportedExtensions(){return{supportsAIA:!!this._extInstanced,supportsImposters:!!this._extFragDepth||!this.isWebGL1(),regen:!1}}getContext(){return this._gl}getCanvas(){return this._canvas}isLost(){return this._gl==null||this._gl.isContextLost()}getPrecision(){return this._precision}setClearColorHex(f,E){this._clearColor.setHex(f),this._clearAlpha=E,this.isLost()||this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}enableOutline(f){this._outlineMaterial=new l.MeshOutlineMaterial(f),this._outlineSphereImposterMaterial=new l.SphereImposterOutlineMaterial(f),this._outlineStickImposterMaterial=new l.StickImposterOutlineMaterial(f),this._outlineEnabled=!0}disableOutline(){this._outlineEnabled=!1}enableAmbientOcclusion(f){f&&(f.strength&&(this._AOstrength=f.strength),f.scale&&(this._AOradius=f.scale)),this._AOEnabled=this._AOstrength>0}disableAmbientOcclusion(){this._AOEnabled=!1}setViewport(){if(this._offscreen&&(this._offscreen.width=this._canvas.width,this._offscreen.height=this._canvas.height),this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null&&!this.isLost()){var f=this._gl.drawingBufferWidth/this.cols,E=this._gl.drawingBufferHeight/this.rows;this._viewportWidth=f,this._viewportHeight=E,this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(f*this.col,E*this.row,f,E),this._gl.viewport(f*this.col,E*this.row,f,E)}}setSize(f,E){this.devicePixelRatio=window.devicePixelRatio!==void 0?window.devicePixelRatio:1,this._upscale&&this.devicePixelRatio<2&&(this.devicePixelRatio=2),this._canvas.width=f*this.devicePixelRatio,this._canvas.height=E*this.devicePixelRatio,this._canvas.style.width=f+"px",this._canvas.style.height=E+"px",this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null?(this.isLost()||(this._viewportWidth=this._gl.drawingBufferWidth/this.cols,this._viewportHeight=this._gl.drawingBufferHeight/this.rows),this.setViewport()):(this._viewportWidth=this._canvas.width,this._viewportHeight=this._canvas.height,this.isLost()||this._gl.viewport(0,0,this._gl.drawingBufferWidth,this._gl.drawingBufferHeight)),this.initFrameBuffer()}clear(f,E,m){var S=0;(f===void 0||f)&&(S|=this._gl.COLOR_BUFFER_BIT),(E===void 0||E)&&(S|=this._gl.DEPTH_BUFFER_BIT),(m===void 0||m)&&(S|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(S)}setMaterialFaces(f,E){var m=f.side===i.DoubleSide,S=f.side===i.BackSide;f.imposter||(S=E?!S:S),this._oldDoubleSided!==m&&(m?this._gl.disable(this._gl.CULL_FACE):this._gl.enable(this._gl.CULL_FACE),this._oldDoubleSided=m),this._oldFlipSided!==S&&(S?this._gl.frontFace(this._gl.CW):this._gl.frontFace(this._gl.CCW),this._oldFlipSided=S),this._gl.cullFace(this._gl.BACK)}setDepthTest(f){this._oldDepthTest!==f&&(f?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._oldDepthTest=f)}setDepthWrite(f){this._oldDepthWrite!==f&&(this._gl.depthMask(f),this._oldDepthWrite=f)}setBlending(f){f?(this._gl.enable(this._gl.BLEND),this._gl.blendEquationSeparate(this._gl.FUNC_ADD,this._gl.FUNC_ADD),this._gl.blendFuncSeparate(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA)):this._gl.disable(this._gl.BLEND)}initMaterial(f,E,m,S){f.addEventListener("dispose",this.onMaterialDispose.bind(this));var w,v;if(v=f.shaderID,v){var A=g.ShaderLib[v];f.vertexShader=A.vertexShader,f.fragmentShader=A.fragmentShader,f.uniforms=g.ShaderUtils.clone(A.uniforms),f.shaded&&f.makeShaded(this.SHADE_TEXTURE)}w={wireframe:f.wireframe,fragdepth:f.imposter,volumetric:f.volumetric,shaded:f.shaded},f.program=this.buildProgram(f.fragmentShader,f.vertexShader,f.uniforms,w)}renderBuffer(f,E,m,S,w,v){if(S.visible){var A,M;if(A=this.setProgram(f,E,m,S,v,this),!!A){M=A.attributes;var T=!1,R=S.wireframe?1:0,P=w.id*16777215+A.id*2+R;P!==this._currentGeometryGroupHash&&(this._currentGeometryGroupHash=P,T=!0),T&&(this.disableAttributes(),M.position>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglVertexBuffer),this.enableAttribute(M.position),this._gl.vertexAttribPointer(M.position,3,this._gl.FLOAT,!1,0,0)),M.color>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglColorBuffer),this.enableAttribute(M.color),this._gl.vertexAttribPointer(M.color,3,this._gl.FLOAT,!1,0,0)),M.normal>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglNormalBuffer),this.enableAttribute(M.normal),this._gl.vertexAttribPointer(M.normal,3,this._gl.FLOAT,!1,0,0)),M.offset>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglOffsetBuffer),this.enableAttribute(M.offset),this._gl.vertexAttribPointer(M.offset,3,this._gl.FLOAT,!1,0,0)),M.radius>=0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglRadiusBuffer),this.enableAttribute(M.radius),this._gl.vertexAttribPointer(M.radius,1,this._gl.FLOAT,!1,0,0)));var L,O;if(v instanceof u.Mesh){if(S.shaderID==="instanced"){var I=S.sphere.geometryGroups[0];T&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,I.vertexArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,w.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,I.normalArray,this._gl.STATIC_DRAW),this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,I.faceArray,this._gl.STATIC_DRAW)),L=I.faceidx,this._extInstanced.vertexAttribDivisorANGLE(M.offset,1),this._extInstanced.vertexAttribDivisorANGLE(M.radius,1),this._extInstanced.vertexAttribDivisorANGLE(M.color,1),this._extInstanced.drawElementsInstancedANGLE(this._gl.TRIANGLES,L,this._gl.UNSIGNED_SHORT,0,w.radiusArray.length),this._extInstanced.vertexAttribDivisorANGLE(M.offset,0),this._extInstanced.vertexAttribDivisorANGLE(M.radius,0),this._extInstanced.vertexAttribDivisorANGLE(M.color,0)}else S.wireframe?(O=w.lineidx,this.setLineWidth(S.wireframeLinewidth),T&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglLineBuffer),this._gl.drawElements(this._gl.LINES,O,this._gl.UNSIGNED_SHORT,0)):(L=w.faceidx,T&&this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,w.__webglFaceBuffer),this._gl.drawElements(this._gl.TRIANGLES,L,this._gl.UNSIGNED_SHORT,0));this.info.render.calls++,this.info.render.vertices+=L,this.info.render.faces+=L/3}else v instanceof u.Line&&(O=w.vertices,this.setLineWidth(S.linewidth),this._gl.drawArrays(this._gl.LINES,0,O),this.info.render.calls++)}}}clearShading(){this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}setShading(f,E,m){let S=f.__lights,w=f.fog,v=[];for(let T=0,R=f.__webglObjects.length;T<R;T++){let P=f.__webglObjects[T];P.render&&P[m]&&v.push(P)}if(v.length==0)return;this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,null,0),this.renderObjects(f.__webglObjects,!0,m+"Depth",E,S,w,!1),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._scratchTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._AOshader),this._currentProgram=this._AOshader,this.setDepthTest(-1),this.setDepthWrite(-1);let A=this._AOshader.uniforms;this._gl.uniform1f(A.total_strength,this._AOstrength),this._gl.uniform1f(A.radius,this._AOradius),this._fullProjModelMatrix=new d.Matrix4,this._fullProjModelMatrixInv=new d.Matrix4;let M=v[0].object;this._fullProjModelMatrix.multiplyMatrices(E.projectionMatrix,M._modelViewMatrix),this._fullProjModelMatrixInv.getInverse(this._fullProjModelMatrix),this._gl.uniformMatrix4fv(A.projectionMatrix,!1,this._fullProjModelMatrix.elements),this._gl.uniformMatrix4fv(A.projinv,!1,this._fullProjModelMatrixInv.elements),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._aovertexattribpos),this._gl.vertexAttribPointer(this._aovertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this.clear(!1,!0,!1),this._gl.useProgram(this._blurshader),this._currentProgram=this._blurshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._blurvertexattribpos),this._gl.vertexAttribPointer(this._blurvertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}render(f,E){if(!(E instanceof n.Camera)){console.error("Renderer.render: camera is not an instance of Camera.");return}var m,S,w,v,A,M=f.__lights,T=f.fog;if(this._currentMaterialId=-1,this._lightsNeedUpdate=!0,this.autoUpdateScene&&f.updateMatrixWorld(),E.parent===void 0&&E.updateMatrixWorld(),E.matrixWorldInverse.getInverse(E.matrixWorld),this.isLost())return;this.autoUpdateObjects&&this.initWebGLObjects(f),this.info.render.calls=0,this.info.render.vertices=0,this.info.render.faces=0,this.info.render.points=0,this._currentWidth=this._viewportWidth,this._currentHeight=this._viewportHeight,this.setViewport(),this.setFrameBuffer(),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha),this.clear(!0,!0,!0),A=f.__webglObjects;let R=!1,P=this._AOEnabled;for(m=0,S=A.length;m<S;m++)w=A[m],v=w.object,w.render=!1,v.visible&&(this.setupMatrices(v,E),this.unrollBufferMaterial(w),w.render=!0,w.volumetric&&(R=!0),w.hasAO&&(P=!0));if(this.setBlending(!1),P&&this.setShading(f,E,"opaque"),this.renderObjects(f.__webglObjects,!0,"opaque",E,M,T,!1),P&&this.clearShading(),this.renderSprites(f,E,!1),this.renderObjects(f.__webglObjects,!0,"transparentDepth",E,M,T,!0),this.renderObjects(f.__webglObjects,!1,"transparent",E,M,T,!0),R&&this._fb&&(this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,null,0),this.renderObjects(f.__webglObjects,!1,"volumetric",E,M,T,!0)),this.renderFrameBuffertoScreen(),this.setDepthTest(!0),this.setDepthWrite(!0),this.renderSprites(f,E,!0),this._bitmap){const L=this._offscreen.transferToImageBitmap();this._bitmap.transferFromImageBitmap(L),L.close()}}setFrameBuffer(){if(this.isWebGL1()||!this._fb)return;let f=this._viewportWidth,E=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,f,E),this._gl.viewport(0,0,f,E),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.RGBA,f,E,0,this._gl.RGBA,this._gl.UNSIGNED_BYTE,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,f,E,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._shadingTexture&&(this._gl.deleteTexture(this._shadingTexture),this._shadingTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,f,E,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.deleteTexture(this._scratchTexture),this._scratchTexture=this._gl.createTexture(),this._gl.bindTexture(this._gl.TEXTURE_2D,this._scratchTexture),this._gl.texImage2D(this._gl.TEXTURE_2D,0,this._gl.DEPTH_COMPONENT32F,f,E,0,this._gl.DEPTH_COMPONENT,this._gl.FLOAT,null),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE)),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,this._fb),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.COLOR_ATTACHMENT0,this._gl.TEXTURE_2D,this._targetTexture,0),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._shadingTexture,0),this._gl.clearDepth(1),this._gl.clear(this._gl.DEPTH_BUFFER_BIT),this._gl.framebufferTexture2D(this._gl.FRAMEBUFFER,this._gl.DEPTH_ATTACHMENT,this._gl.TEXTURE_2D,this._depthTexture,0)}initFrameBuffer(){if(this.isWebGL1())return;let f=this._viewportWidth,E=this._viewportHeight;this._gl.enable(this._gl.SCISSOR_TEST),this._gl.scissor(0,0,f,E),this._gl.viewport(0,0,f,E),this._targetTexture=this._gl.createTexture(),this._depthTexture=this._gl.createTexture(),this._shadingTexture=this._gl.createTexture(),this._scratchTexture=this._gl.createTexture(),this._fb=this._gl.createFramebuffer();var m=this._antialias?g.ShaderLib.screenaa:g.ShaderLib.screen;this._screenshader=this.buildProgram(m.fragmentShader,m.vertexShader,m.uniforms,{}),this._vertexattribpos=this._gl.getAttribLocation(this._screenshader,"vertexPosition");var S=[1,1,-1,1,-1,-1,-1,-1,1,-1,1,1];this._screenQuadVBO=this._gl.createBuffer(),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(S),this._gl.STATIC_DRAW);let w=g.ShaderLib.ssao;this._AOshader=this.buildProgram(w.fragmentShader,w.vertexShader,w.uniforms,{}),this._aovertexattribpos=this._gl.getAttribLocation(this._AOshader,"vertexPosition");let v=g.ShaderLib.blur;this._blurshader=this.buildProgram(v.fragmentShader,v.vertexShader,v.uniforms,{}),this._blurvertexattribpos=this._gl.getAttribLocation(this._blurshader,"vertexPosition")}renderFrameBuffertoScreen(){this.isWebGL1()||this._fb===null||(this.setViewport(),this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),this._gl.clear(this._gl.COLOR_BUFFER_BIT|this._gl.DEPTH_BUFFER_BIT),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.useProgram(this._screenshader),this._currentProgram=this._screenshader,this.setDepthTest(-1),this.setDepthWrite(-1),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,this._screenQuadVBO),this._gl.enableVertexAttribArray(this._vertexattribpos),this._gl.vertexAttribPointer(this._vertexattribpos,2,this._gl.FLOAT,!1,0,0),this._gl.activeTexture(this._gl.TEXTURE0),this._gl.bindTexture(this._gl.TEXTURE_2D,this._targetTexture),this._gl.drawArrays(this._gl.TRIANGLES,0,6))}initWebGLObjects(f){if(f.__webglObjects||(f.__webglObjects=[],f.__webglObjectsImmediate=[],f.__webglSprites=[],f.__webglFlares=[]),f.__objectsAdded.length){for(;f.__objectsAdded.length;)this.addObject(f.__objectsAdded[0],f),f.__objectsAdded.splice(0,1);this._currentGeometryGroupHash=-1}for(;f.__objectsRemoved.length;)this.removeObject(f.__objectsRemoved[0],f),f.__objectsRemoved.splice(0,1);for(var E=0,m=f.__webglObjects.length;E<m;E++)this.updateObject(f.__webglObjects[E].object)}getYRatio(){return this.rows!==void 0&&this.row!==void 0?this.rows:1}getXRatio(){return this.cols!==void 0&&this.col!==void 0?this.cols:1}getAspect(f,E){(f==null||E==null)&&(f=this._canvas.width,E=this._canvas.height);var m=f/E;if(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null){var S=f/this.cols,w=E/this.rows;m=S/w}return m}setTexture(f,E,m){if(f.needsUpdate){f.__webglInit||(f.__webglInit=!0,f.addEventListener("dispose",this.onTextureDispose.bind(this)),f.__webglTexture=this._gl.createTexture(),this.info.memory.textures++),this._gl.activeTexture(this._gl.TEXTURE0+E);var S=m?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D;this._gl.bindTexture(S,f.__webglTexture),this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,f.flipY),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.premultiplyAlpha),this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,f.unpackAlignment),this._gl.pixelStorei(this._gl.PACK_ALIGNMENT,f.unpackAlignment);var w=this.paramToGL(f.format),v=this.paramToGL(f.type);if(m)this.setTextureParameters(this._gl.TEXTURE_3D,f),this._gl.texImage3D(this._gl.TEXTURE_3D,0,this._gl.R32F,f.image.size.z,f.image.size.y,f.image.size.x,0,this._gl.RED,this._gl.FLOAT,f.image.data);else{var A=f.image,M=A.width,T=A.height;typeof M>"u"&&(M=A.length,w==this._gl.RGBA&&(M/=4),T=1),this.setTextureParameters(this._gl.TEXTURE_2D,f),this.isWebGL1()?this._gl.texImage2D(this._gl.TEXTURE_2D,0,w,w,v,f.image):this._gl.texImage2D(this._gl.TEXTURE_2D,0,w,M,T,0,w,v,f.image)}f.needsUpdate=!1,f.onUpdate&&f.onUpdate()}else this._gl.activeTexture(this._gl.TEXTURE0+E),m?this._gl.bindTexture(this._gl.TEXTURE_3D,f.__webglTexture):this._gl.bindTexture(this._gl.TEXTURE_2D,f.__webglTexture)}supportsVolumetric(){return!this.isWebGL1()}enableAttribute(f){this._enabledAttributes[f]||(this._gl.enableVertexAttribArray(f),this._enabledAttributes[f]=!0)}disableAttributes(){for(let f in this._enabledAttributes)this._enabledAttributes[f]&&(this._gl.disableVertexAttribArray(f),this._enabledAttributes[f]=!1)}setPolygonOffset(f,E,m){this._oldPolygonOffset!==f&&(f?this._gl.enable(this._gl.POLYGON_OFFSET_FILL):this._gl.disable(this._gl.POLYGON_OFFSET_FILL))}setLineWidth(f){f!==this._oldLineWidth&&(this._gl.lineWidth(f),this._oldLineWidth=f)}deallocateGeometry(f){if(f.__webglInit=void 0,f.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(f.__webglVertexBuffer),f.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(f.__webglColorBuffer),f.geometryGroups!==void 0)for(var E=0,m=f.groups;E<m;E++){var S=f.geometryGroups[E];S.__webglVertexBuffer!==void 0&&this._gl.deleteBuffer(S.__webglVertexBuffer),S.__webglColorBuffer!==void 0&&this._gl.deleteBuffer(S.__webglColorBuffer),S.__webglNormalBuffer!==void 0&&this._gl.deleteBuffer(S.__webglNormalBuffer),S.__webglFaceBuffer!==void 0&&this._gl.deleteBuffer(S.__webglFaceBuffer),S.__webglLineBuffer!==void 0&&this._gl.deleteBuffer(S.__webglLineBuffer)}}deallocateMaterial(f){var E=f.program;if(E!==void 0){f.program=void 0;var m,S,w,v=!1;for(m=0,S=this._programs.length;m<S;m++)if(w=this._programs[m],w.program===E){w.usedTimes--,w.usedTimes===0&&(v=!0);break}if(v===!0){var A=[];for(m=0,S=this._programs.length;m<S;m++)w=this._programs[m],w.program!==E&&A.push(w);this._programs=A,this._gl.deleteProgram(E),this.info.memory.programs--}}}deallocateTexture(f){if(f.image&&f.image.__webglTextureCube)this._gl.deleteTexture(f.image.__webglTextureCube);else{if(!f.__webglInit)return;f.__webglInit=!1,this._gl.deleteTexture(f.__webglTexture)}}onGeometryDispose(f){var E=f.target;E.removeEventListener("dispose",this.onGeometryDispose),this.deallocateGeometry(E),this.info.memory.geometries--}onTextureDispose(f){var E=f.target;E.removeEventListener("dispose",this.onTextureDispose),this.deallocateTexture(E),this.info.memory.textures--}onMaterialDispose(f){var E=f.target;E.removeEventListener("dispose",this.onMaterialDispose),this.deallocateMaterial(E)}getShader(f,E){var m;return!this.isWebGL1()&&!E.startsWith("#version")&&(E=E.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),f=="fragment"?E=E.replace(/varying/g,"in"):E=E.replace(/varying/g,"out"),E=E.replace(/attribute/g,"in"),E=E.replace(/texture2D/g,"texture"),E=E.replace(/\/\/DEFINEFRAGCOLOR/g,"out vec4 glFragColor;"),E=E.replace(/gl_FragColor/g,"glFragColor"),E=`#version 300 es
`+E),f==="fragment"?m=this._gl.createShader(this._gl.FRAGMENT_SHADER):f==="vertex"&&(m=this._gl.createShader(this._gl.VERTEX_SHADER)),m==null?null:(this._gl.shaderSource(m,E),this._gl.compileShader(m),this._gl.getShaderParameter(m,this._gl.COMPILE_STATUS)?m:(console.error(this._gl.getShaderInfoLog(m)),console.error("could not initialize shader"),null))}buildProgram(f,E,m,S){var w,v,A,M,T=[];T.push(f),T.push(E);for(w in S)T.push(w),T.push(S[w]);for(M=T.join(),w=0,v=this._programs.length;w<v;w++){var R=this._programs[w];if(R.code===M)return R.usedTimes++,R.program}if(this.isWebGL1()&&S.volumetric)throw new Error("Volumetric rendering requires webgl2 which is not supported by your hardware.");if(A=this._gl.createProgram(),A==null)return null;var P=this._precision,L="precision "+P+" float;",O=[S.volumetric?"#version 300 es":"",L].join(`
`),I=[S.volumetric?"#version 300 es":"",S.fragdepth&&this.isWebGL1()?"#extension GL_EXT_frag_depth: enable":"",S.shaded?"#define SHADED 1":"",S.wireframe?"#define WIREFRAME 1":"",L].join(`
`),N=this.getShader("fragment",I+f),k=this.getShader("vertex",O+E);k!=null&&this._gl.attachShader(A,k),N!=null&&this._gl.attachShader(A,N),this._gl.linkProgram(A),this._gl.getProgramParameter(A,this._gl.LINK_STATUS)||console.error("Could not initialize shader"),A.uniforms={},A.attributes={};var U,F,j;U=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","vWidth","vHeight"];for(F in m)U.push(F);for(j=0;j<U.length;j++){var H=U[j];A.uniforms[H]=this._gl.getUniformLocation(A,H)}for(U=["position","normal","color","lineDistance","offset","radius"],j=0;j<U.length;j++){var B=U[j];A.attributes[B]=this._gl.getAttribLocation(A,B)}return A.id=this._programs_counter++,this._programs.push({program:A,code:M,usedTimes:1}),this.info.memory.programs=this._programs.length,A}setProgram(f,E,m,S,w,v){if(S.needsUpdate&&(S.program&&this.deallocateMaterial(S),this.initMaterial(S,E,m,w),S.needsUpdate=!1),S.program==null)return null;var A=!1,M=S.program,T=M.uniforms,R=S.uniforms;if(M!=this._currentProgram&&(this._gl.useProgram(M),this._currentProgram=M,A=!0),S.id!=this._currentMaterialId&&(this._currentMaterialId=S.id,A=!0),f!=this._currentCamera&&(this._currentCamera=f,A=!0),T.projectionMatrix&&this._gl.uniformMatrix4fv(T.projectionMatrix,!1,f.projectionMatrix.elements),T.modelViewMatrix&&this._gl.uniformMatrix4fv(T.modelViewMatrix,!1,w._modelViewMatrix.elements),T.normalMatrix&&this._gl.uniformMatrix3fv(T.normalMatrix,!1,w._normalMatrix.elements),T.projinv&&(this._projInverse.getInverse(f.projectionMatrix),this._gl.uniformMatrix4fv(T.projinv,!1,this._projInverse.elements)),T.viewMatrix&&this._gl.uniformMatrix4fv(T.viewMatrix,!1,f.matrixWorldInverse.elements),T.vWidth&&this._gl.uniform1f(T.vWidth,this._viewportWidth),T.vHeight&&this._gl.uniform1f(T.vHeight,this._viewportHeight),A){if(R.fogColor.value=m.color,R.fogNear.value=m.near,R.fogFar.value=m.far,S.shaderID.startsWith("lambert")||S.shaderID==="instanced"||S.shaderID.endsWith("imposter"))this._lightsNeedUpdate&&(this.setupLights(M,E),this._lightsNeedUpdate=!1),R.directionalLightColor.value=this._lights.directional.colors,R.directionalLightDirection.value=this._lights.directional.positions;else if(S.shaderID.endsWith("outline"))R.outlineColor.value=S.outlineColor,R.outlineWidth.value=S.outlineWidth,R.outlinePushback.value=S.outlinePushback,R.outlineMaxPixels.value=S.outlineMaxPixels*this.devicePixelRatio;else if(S.shaderID==="volumetric"){w._modelViewMatrix.getScale(this._direction),this._worldInverse.getInverse(w._modelViewMatrix),this._projInverse.getInverse(f.projectionMatrix),this._textureMatrix.multiplyMatrices(w.material.texmatrix,this._worldInverse),this._gl.uniformMatrix4fv(T.textmat,!1,this._textureMatrix.elements),this._gl.uniformMatrix4fv(T.projinv,!1,this._projInverse.elements);let P=Math.min(Math.min(this._direction.x,this._direction.y),this._direction.z);R.step.value=w.material.unit*P,R.maxdepth.value=w.material.maxdepth*P,R.transfermax.value=w.material.transfermax,R.transfermin.value=w.material.transfermin,R.subsamples.value=w.material.subsamples,v.setTexture(w.material.transferfn,4,!1),v.setTexture(w.material.map,3,!0),this._gl.activeTexture(this._gl.TEXTURE5),this._gl.bindTexture(this._gl.TEXTURE_2D,this._depthTexture)}R.opacity.value=S.opacity,this.loadMaterialUniforms(T,R)}return R.shading&&(R.shading.value==3?(this._gl.activeTexture(this._gl.TEXTURE0+this.SHADE_TEXTURE),this._gl.bindTexture(this._gl.TEXTURE_2D,this._shadingTexture)):console.error("Invalid shading textures.")),M}loadMaterialUniforms(f,E){var m,S,w,v;for(m in E)f[m]&&(S=E[m].type,w=E[m].value,v=f[m],S==="f"?this._gl.uniform1f(v,w):S==="i"?this._gl.uniform1i(v,w):S==="fv"?this._gl.uniform3fv(v,w):S==="c"?this._gl.uniform3f(v,w.r,w.g,w.b):S==="f4"&&this._gl.uniform4f(v,w[0],w[1],w[2],w[3]))}addObject(f,E){var m,S,w,v;if(!f.__webglInit&&(f.__webglInit=!0,f._modelViewMatrix=new d.Matrix4,f._normalMatrix=new d.Matrix3,f.geometry!==void 0&&f.geometry.__webglInit===void 0&&(f.geometry.__webglInit=!0,f.geometry.addEventListener("dispose",this.onGeometryDispose.bind(this))),f instanceof u.Mesh||f instanceof u.Line))for(w=f.geometry,m=0,S=w.geometryGroups.length;m<S;m++)v=w.geometryGroups[m],v.id=this._geometryGroupCounter++,v.__webglVertexBuffer||(f instanceof u.Mesh?(this.createMeshBuffers(v),w.elementsNeedUpdate=!0,w.normalsNeedUpdate=!0):f instanceof u.Line&&this.createLineBuffers(v),w.verticesNeedUpdate=!0,w.colorsNeedUpdate=!0);if(!f.__webglActive){if(f instanceof u.Mesh||f instanceof u.Line)for(w=f.geometry,m=0,S=w.geometryGroups.length;m<S;m++)v=w.geometryGroups[m],this.addBuffer(E.__webglObjects,v,f);else f instanceof u.Sprite&&E.__webglSprites.push(f);f.__webglActive=!0}}updateObject(f){var E=f.geometry,m;if(f instanceof u.Mesh||f instanceof u.Line){for(var S=0,w=E.geometryGroups.length;S<w;S++)m=E.geometryGroups[S],(E.verticesNeedUpdate||E.elementsNeedUpdate||E.colorsNeedUpdate||E.normalsNeedUpdate)&&this.setBuffers(m,this._gl.STATIC_DRAW);E.verticesNeedUpdate=!1,E.elementsNeedUpdate=!1,E.normalsNeedUpdate=!1,E.colorsNeedUpdate=!1,E.buffersNeedUpdate=!1}}removeObject(f,E){f instanceof u.Mesh||f instanceof u.Line?this.removeInstances(E.__webglObjects,f):f instanceof u.Sprite&&this.removeInstancesDirect(E.__webglSprites,f),f.__webglActive=!1}removeInstances(f,E){for(var m=f.length-1;m>=0;--m)f[m].object===E&&f.splice(m,1)}removeInstancesDirect(f,E){for(var m=f.length-1;m>=0;--m)f[m]===E&&f.splice(m,1)}unrollBufferMaterial(f){var E=f.object,m=E.material;if(m.volumetric)f.opaque=null,f.transparent=null,f.volumetric=m;else if(m.transparent){if(f.opaque=null,f.volumetric=null,f.transparent=m,!m.wireframe){let S=m.clone();S.opacity=0,f.transparentDepth=S}}else{if(f.opaque=m,f.transparent=null,f.volumetric=null,!m.wireframe){let S=m.clone();S.opacity=0,f.opaqueDepth=S}m.hasAO&&(f.hasAO=!0),(this._AOEnabled||f.hasAO)&&(f.opaqueShaded=m.clone(),f.opaqueShaded.shaded=!0)}}setBuffers(f,E){var m=f.vertexArray,S=f.colorArray;if(f.__webglOffsetBuffer!==void 0?(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglOffsetBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,m,E)):(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglVertexBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,m,E)),this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglColorBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,S,E),f.normalArray&&f.__webglNormalBuffer!==void 0){var w=f.normalArray;this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglNormalBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,w,E)}if(f.radiusArray&&f.__webglRadiusBuffer!==void 0&&(this._gl.bindBuffer(this._gl.ARRAY_BUFFER,f.__webglRadiusBuffer),this._gl.bufferData(this._gl.ARRAY_BUFFER,f.radiusArray,E)),f.faceArray&&f.__webglFaceBuffer!==void 0){var v=f.faceArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,f.__webglFaceBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,v,E)}if(f.lineArray&&f.__webglLineBuffer!==void 0){var A=f.lineArray;this._gl.bindBuffer(this._gl.ELEMENT_ARRAY_BUFFER,f.__webglLineBuffer),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,A,E)}}createMeshBuffers(f){f.radiusArray&&(f.__webglRadiusBuffer=this._gl.createBuffer()),f.useOffset&&(f.__webglOffsetBuffer=this._gl.createBuffer()),f.__webglVertexBuffer=this._gl.createBuffer(),f.__webglNormalBuffer=this._gl.createBuffer(),f.__webglColorBuffer=this._gl.createBuffer(),f.__webglFaceBuffer=this._gl.createBuffer(),f.__webglLineBuffer=this._gl.createBuffer(),this.info.memory.geometries++}createLineBuffers(f){f.__webglVertexBuffer=this._gl.createBuffer(),f.__webglColorBuffer=this._gl.createBuffer(),this.info.memory.geometries++}addBuffer(f,E,m){f.push({buffer:E,object:m,opaque:null,transparent:null})}setupMatrices(f,E){f._modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,f.matrixWorld),f._normalMatrix.getInverse(f._modelViewMatrix),f._normalMatrix.transpose()}filterFallback(f){return this._gl.LINEAR}setTextureParameters(f,E){f==this._gl.TEXTURE_2D?(this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,this.filterFallback(E.magFilter)),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,this.filterFallback(E.minFilter))):(this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(f,this._gl.TEXTURE_WRAP_R,this._gl.CLAMP_TO_EDGE),this._extColorBufferFloat&&this._extFloatLinear?(this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR)):(this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,this._gl.NEAREST),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,this._gl.NEAREST)))}paramToGL(f){return f===s.UnsignedByteType?this._gl.UNSIGNED_BYTE:f===s.RGBAFormat?this._gl.RGBA:f===s.NearestFilter?this._gl.NEAREST:0}setupLights(f,E){var m,S,w,v=0,A=0,M=0,T,R,P=this._lights,L=P.directional.colors,O=P.directional.positions,I=0,N=0;for(m=0,S=E.length;m<S;m++)if(w=E[m],T=w.color,R=w.intensity,w instanceof o.Light){if(this._direction.getPositionFromMatrix(w.matrixWorld),this._vector3.getPositionFromMatrix(w.target.matrixWorld),this._direction.sub(this._vector3),this._direction.normalize(),this._direction.x===0&&this._direction.y===0&&this._direction.z===0)continue;O[N]=this._direction.x,O[N+1]=this._direction.y,O[N+2]=this._direction.z,L[N]=T.r*R,L[N+1]=T.g*R,L[N+2]=T.b*R,N+=3,I++}P.ambient[0]=v,P.ambient[1]=A,P.ambient[2]=M,P.directional.length=I}initGL(){try{if(OffscreenCanvas&&!(this.rows!=null&&this.cols!=null&&this.row!=null&&this.col!=null))(b==null||b.isContextLost())&&(y=new OffscreenCanvas(this._canvas.width,this._canvas.height),b=y.getContext("webgl2",{alpha:!0,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})),this._offscreen=y,this._gl=b,this._bitmap=this._canvas.getContext("bitmaprenderer",{alpha:!0});else if(!(this._gl=this._canvas.getContext("webgl2",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("experimental-webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer}))&&!(this._gl=this._canvas.getContext("webgl",{alpha:this._alpha,premultipliedAlpha:this._premultipliedAlpha,antialias:this._antialias,preserveDrawingBuffer:this._preserveDrawingBuffer})))throw"Error creating WebGL context.";var f=this._gl.getParameter(this._gl.VERSION);this._webglversion=parseInt(f[6])}catch(E){console.error(E)}}isWebGL1(){return this._webglversion==1}setDefaultGLState(){this._gl.clearDepth(1),this._gl.clearStencil(0),this._gl.enable(this._gl.DEPTH_TEST),this._gl.depthFunc(this._gl.LEQUAL),this._gl.frontFace(this._gl.CCW),this._gl.cullFace(this._gl.BACK),this._gl.enable(this._gl.CULL_FACE),this._gl.enable(this._gl.BLEND),this._gl.blendEquation(this._gl.FUNC_ADD),this._gl.blendFunc(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._gl.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearAlpha)}renderObjects(f,E,m,S,w,v,A){var M,T,R,P,L,O,I;E?(L=f.length-1,O=-1,I=-1):(L=0,O=f.length,I=1);for(var N=L;N!==O;N+=I)if(M=f[N],M.render){if(T=M.object,R=M.buffer,P=M[m],(M.hasAO||this._AOEnabled)&&M[m+"Shaded"]&&(P=M[m+"Shaded"]),!P)continue;this.setBlending(A),this.setDepthTest(P.depthTest),this.setDepthWrite(P.depthWrite),this.setPolygonOffset(P.polygonOffset,P.polygonOffsetFactor,P.polygonOffsetUnits);var k=T._modelViewMatrix.isReflected();if(this.setMaterialFaces(P,k),this.renderBuffer(S,w,v,P,R,T),(this._outlineEnabled||P.outline)&&!P.wireframe&&P.shaderID!=="basic"&&P.opacity!==0){let U=this._outlineMaterial;P.shaderID=="sphereimposter"?U=this._outlineSphereImposterMaterial:P.shaderID=="stickimposter"&&(U=this._outlineStickImposterMaterial),this.renderBuffer(S,w,v,U,R,T)}}}renderSprites(f,E,m){this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1,this._lightsNeedUpdate=!0,this.sprites.render(f,E,this._currentWidth,this._currentHeight,m),this._currentGeometryGroupHash=-1,this._currentProgram=null,this._currentCamera=null,this._oldDepthWrite=-1,this._oldDepthTest=-1,this._oldDoubleSided=-1,this._currentMaterialId=-1,this._oldFlipSided=-1}}}),"./src/WebGL/SpritePlugin.ts":((r,e,t)=>{t.r(e),t.d(e,{SpritePlugin:()=>i});var n=t("./src/WebGL/shaders/index.ts");class i{constructor(){this.sprite={vertices:null,faces:null,vertexBuffer:null,elementBuffer:null,program:null,attributes:{},uniforms:null}}init(a){this.gl=a.context,this.renderer=a,this.precision=a.getPrecision(),this.sprite.vertices=new Float32Array(16),this.sprite.faces=new Uint16Array(6);var l=0;this.sprite.vertices[l++]=-1,this.sprite.vertices[l++]=-1,this.sprite.vertices[l++]=0,this.sprite.vertices[l++]=0,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=-1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=0,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=-1,this.sprite.vertices[l++]=1,this.sprite.vertices[l++]=0,this.sprite.vertices[l++]=1,l=0,this.sprite.faces[l++]=0,this.sprite.faces[l++]=1,this.sprite.faces[l++]=2,this.sprite.faces[l++]=0,this.sprite.faces[l++]=2,this.sprite.faces[l++]=3,this.sprite.vertexBuffer=this.gl.createBuffer(),this.sprite.elementBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.sprite.vertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.faces,this.gl.STATIC_DRAW),this.sprite.program=this.createProgram(n.ShaderLib.sprite,this.precision||1),this.sprite.attributes={};const d={};this.sprite.attributes.position=this.gl.getAttribLocation(this.sprite.program,"position"),this.sprite.attributes.uv=this.gl.getAttribLocation(this.sprite.program,"uv"),d.uvOffset=this.gl.getUniformLocation(this.sprite.program,"uvOffset"),d.uvScale=this.gl.getUniformLocation(this.sprite.program,"uvScale"),d.rotation=this.gl.getUniformLocation(this.sprite.program,"rotation"),d.scale=this.gl.getUniformLocation(this.sprite.program,"scale"),d.alignment=this.gl.getUniformLocation(this.sprite.program,"alignment"),d.color=this.gl.getUniformLocation(this.sprite.program,"color"),d.map=this.gl.getUniformLocation(this.sprite.program,"map"),d.opacity=this.gl.getUniformLocation(this.sprite.program,"opacity"),d.useScreenCoordinates=this.gl.getUniformLocation(this.sprite.program,"useScreenCoordinates"),d.screenPosition=this.gl.getUniformLocation(this.sprite.program,"screenPosition"),d.modelViewMatrix=this.gl.getUniformLocation(this.sprite.program,"modelViewMatrix"),d.projectionMatrix=this.gl.getUniformLocation(this.sprite.program,"projectionMatrix"),d.fogNear=this.gl.getUniformLocation(this.sprite.program,"fogNear"),d.fogFar=this.gl.getUniformLocation(this.sprite.program,"fogFar"),d.fogColor=this.gl.getUniformLocation(this.sprite.program,"fogColor"),d.alphaTest=this.gl.getUniformLocation(this.sprite.program,"alphaTest"),this.sprite.uniforms=d}render(a,l,d,u,g){var x,y,b,_,h,f,E,m,S,w;if(!this.gl)throw new Error("WebGLRenderer not initialized");let v=[];(x=a?.__webglSprites)===null||x===void 0||x.forEach(H=>{(g&&H.material.depthTest==!1||!g&&H.material.depthTest)&&v.push(H)});let A=v.length;if(!A)return;const M=this.sprite.attributes,T=this.sprite.uniforms;if(!T)throw new Error("Uniforms not defined");var R=d*.5,P=u*.5;this.gl.useProgram(this.sprite.program),this.gl.enableVertexAttribArray(M.position),this.gl.enableVertexAttribArray(M.uv),this.gl.disable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.sprite.vertexBuffer),this.gl.vertexAttribPointer(M.position,2,this.gl.FLOAT,!1,16,0),this.gl.vertexAttribPointer(M.uv,2,this.gl.FLOAT,!1,16,8),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprite.elementBuffer),this.gl.uniformMatrix4fv(T.projectionMatrix,!1,l.projectionMatrix.elements),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.uniform1i(T.map,0);var L=a.fog;L?(this.gl.uniform3f(T.fogColor,L.color.r,L.color.g,L.color.b),this.gl.uniform1f(T.fogNear,L.near),this.gl.uniform1f(T.fogFar,L.far)):(this.gl.uniform1f(T.fogNear,0),this.gl.uniform1f(T.fogFar,0));var O;let I,N,k,U=[];for(O=0;O<A;O++)I=v[O],N=I.material,N&&(N.depthTest==!1&&!g||!I.visible||N.opacity===0||(N.useScreenCoordinates?I.z=-I.position.z:(I._modelViewMatrix.multiplyMatrices(l.matrixWorldInverse,I.matrixWorld),I.z=-I._modelViewMatrix.elements[14])));for(v.sort(s),O=0;O<A;O++)if(I=v[O],N=I.material,!!N&&!(!I.visible||N.opacity===0)&&N.map&&N.map.image&&N.map.image.width){this.gl.uniform1f(T?.alphaTest||null,N.alphaTest);var F=N.map.image.width,j=N.map.image.height;U[0]=F*this.renderer.devicePixelRatio/d,U[1]=j*this.renderer.devicePixelRatio/u,N.useScreenCoordinates===!0?(this.gl.uniform1i(T.useScreenCoordinates,1),this.gl.uniform3f(T.screenPosition,(I.position.x*this.renderer.devicePixelRatio-R)/R,(P-I.position.y*this.renderer.devicePixelRatio)/P,Math.max(0,Math.min(1,I.position.z)))):(this.gl.uniform1i(T.useScreenCoordinates,0),this.gl.uniformMatrix4fv(T.modelViewMatrix,!1,I._modelViewMatrix.elements)),k=1/(N.scaleByViewport?u:1),U[0]*=k*I.scale.x,U[1]*=k*I.scale.y;let H=(y=N?.alignment)===null||y===void 0?void 0:y.x,B=(b=N?.alignment)===null||b===void 0?void 0:b.y;N.screenOffset&&(H=(H||0)+2*N.screenOffset.x/F,B=(B||0)+2*N.screenOffset.y/j),this.gl.uniform2f(T.uvScale,((_=N?.uvScale)===null||_===void 0?void 0:_.x)||1,((h=N?.uvScale)===null||h===void 0?void 0:h.y)||1),this.gl.uniform2f(T.uvOffset,((f=N?.uvOffset)===null||f===void 0?void 0:f.x)||0,((E=N?.uvOffset)===null||E===void 0?void 0:E.y)||0),this.gl.uniform2f(T.alignment,H||0,B||0),this.gl.uniform1f(T.opacity,N.opacity),this.gl.uniform3f(T.color,((m=N?.color)===null||m===void 0?void 0:m.r)||0,((S=N?.color)===null||S===void 0?void 0:S.g)||0,((w=N?.color)===null||w===void 0?void 0:w.b)||0),this.gl.uniform1f(T.rotation,I.rotation),this.gl.uniform2fv(T.scale,U),this.renderer.setDepthTest(N.depthTest),this.renderer.setDepthWrite(N.depthWrite),this.renderer.setTexture(N.map,0),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0)}this.gl.enable(this.gl.CULL_FACE)}createProgram(a,l){if(!this.gl)throw new Error("WebGL Rendering context not found");var d=this.gl.createProgram();if(!d)throw new Error("Error creating webgl program");var u=this.gl.createShader(this.gl.FRAGMENT_SHADER),g=this.gl.createShader(this.gl.VERTEX_SHADER);if(!u)throw new Error("Unable to create fragment shader SpritePlugin.createProgram");if(!g)throw new Error("Unable to create vertex shader SpritePlugin.createProgram");var x="precision "+l+` float;
`;if(this.gl.shaderSource(u,x+a.fragmentShader),this.gl.shaderSource(g,x+a.vertexShader),this.gl.compileShader(u),this.gl.compileShader(g),!this.gl.getShaderParameter(u,this.gl.COMPILE_STATUS)||!this.gl.getShaderParameter(g,this.gl.COMPILE_STATUS))throw new Error(`Error compiling shader: 
      ${this.gl.getShaderInfoLog(u)} 
      ${this.gl.getShaderInfoLog(g)}`);return this.gl.attachShader(d,u),this.gl.attachShader(d,g),this.gl.linkProgram(d),this.gl.getProgramParameter(d,this.gl.LINK_STATUS)||console.error("Could not initialize shader"),d}}function s(o,a){return o.z!==a.z?a.z-o.z:a.id-o.id}}),"./src/WebGL/constants/Coloring.ts":((r,e,t)=>{t.r(e),t.d(e,{Coloring:()=>n});var n;(function(i){i[i.NoColors=0]="NoColors",i[i.FaceColors=1]="FaceColors",i[i.VertexColors=2]="VertexColors"})(n||(n={}))}),"./src/WebGL/constants/Shading.ts":((r,e,t)=>{t.r(e),t.d(e,{Shading:()=>n});var n;(function(i){i[i.NoShading=0]="NoShading",i[i.FlatShading=1]="FlatShading",i[i.SmoothShading=2]="SmoothShading"})(n||(n={}))}),"./src/WebGL/constants/Sides.ts":((r,e,t)=>{t.r(e),t.d(e,{BackSide:()=>i,DoubleSide:()=>s,FrontSide:()=>n});const n=0,i=1,s=2}),"./src/WebGL/constants/SpriteAlignment.ts":((r,e,t)=>{t.r(e),t.d(e,{SpriteAlignment:()=>i});var n=t("./src/WebGL/math/index.ts");const i={topLeft:new n.Vector2(1,-1),topCenter:new n.Vector2(0,-1),topRight:new n.Vector2(-1,-1),centerLeft:new n.Vector2(1,0),center:new n.Vector2(0,0),centerRight:new n.Vector2(-1,0),bottomLeft:new n.Vector2(1,1),bottomCenter:new n.Vector2(0,1),bottomRight:new n.Vector2(-1,1)}}),"./src/WebGL/constants/TextureConstants.ts":((r,e,t)=>{t.r(e),t.d(e,{ClampToEdgeWrapping:()=>n,FloatType:()=>l,LinearFilter:()=>i,LinearMipMapLinearFilter:()=>o,NearestFilter:()=>s,R32Format:()=>g,RFormat:()=>u,RGBAFormat:()=>d,UnsignedByteType:()=>a});const n=1001,i=1006,s=1007,o=1008,a=1009,l=1010,d=1021,u=1022,g=1023}),"./src/WebGL/constants/TextureOperations.ts":((r,e,t)=>{t.r(e),t.d(e,{TextureOperations:()=>n});var n;(function(i){i[i.MultiplyOperation=0]="MultiplyOperation",i[i.MixOperation=1]="MixOperation",i[i.AddOperation=2]="AddOperation"})(n||(n={}))}),"./src/WebGL/constants/index.ts":((r,e,t)=>{t.r(e),t.d(e,{BackSide:()=>i.BackSide,ClampToEdgeWrapping:()=>a.ClampToEdgeWrapping,Coloring:()=>n.Coloring,DoubleSide:()=>i.DoubleSide,FloatType:()=>a.FloatType,FrontSide:()=>i.FrontSide,LinearFilter:()=>a.LinearFilter,LinearMipMapLinearFilter:()=>a.LinearMipMapLinearFilter,NearestFilter:()=>a.NearestFilter,R32Format:()=>a.R32Format,RFormat:()=>a.RFormat,RGBAFormat:()=>a.RGBAFormat,Shading:()=>s.Shading,SpriteAlignment:()=>o.SpriteAlignment,TextureOperations:()=>l.TextureOperations,UnsignedByteType:()=>a.UnsignedByteType});var n=t("./src/WebGL/constants/Coloring.ts"),i=t("./src/WebGL/constants/Sides.ts"),s=t("./src/WebGL/constants/Shading.ts"),o=t("./src/WebGL/constants/SpriteAlignment.ts"),a=t("./src/WebGL/constants/TextureConstants.ts"),l=t("./src/WebGL/constants/TextureOperations.ts")}),"./src/WebGL/core/EventDispatcher.ts":((r,e,t)=>{t.r(e),t.d(e,{EventDispatcher:()=>n});class n{constructor(){this.listeners={}}dispatchEvent(s){var o=this.listeners[s.type];if(o!==void 0){s.target=this;for(var a=0,l=o.length;a<l;a++)o[a].call(this,s)}}removeEventListener(s,o){if(!o)this.listeners[s]=[];else{var a=this.listeners[s].indexOf(o);a!==-1&&this.listeners[s].splice(a,1)}}addEventListener(s,o){this.listeners[s]===void 0&&(this.listeners[s]=[]),this.listeners[s].indexOf(o)===-1&&this.listeners[s].push(o)}}}),"./src/WebGL/core/Geometry.ts":((r,e,t)=>{t.r(e),t.d(e,{Geometry:()=>d,GeometryGroup:()=>l,GeometryIDCount:()=>u});var n=t("./src/WebGL/materials/LineBasicMaterial.ts"),i=t("./src/WebGL/core/EventDispatcher.ts"),s=t("./src/WebGL/math/index.ts"),o=t("./src/colors.ts");const a=65535;class l{constructor(x=0){this.vertexArray=null,this.colorArray=null,this.normalArray=null,this.radiusArray=null,this.faceArray=null,this.lineArray=null,this.atomArray=Array(),this.vertices=0,this.faceidx=0,this.lineidx=0,this.__inittedArrays=!1,this.id=x}setColor(x){var y=this.vertexArray,b=this.colorArray;if(!y)throw new Error("vertex array not initialized");if(!b)throw new Error("color array not initialized");let _=o.CC.color(x);for(var h=0;h<y.length;h+=3)b[h]=_.r,b[h+1]=_.g,b[h+2]=_.b}setColors(x){var y=this.vertexArray,b=this.colorArray;if(!y)throw new Error("vertex array not initialized");if(!b)throw new Error("color array not initialized");if(y.length!=b.length){console.log("Cannot re-color geometry group due to mismatched lengths.");return}for(var _=0;_<y.length;_+=3){var h=x(y[_],y[_+1],y[_+2]);h instanceof o.Color||(h=o.CC.color(h)),b[_]=h.r,b[_+1]=h.g,b[_+2]=h.b}}getNumVertices(){return this.vertices}getVertices(){return this.vertexArray}getCentroid(){if(!this.vertexArray)throw new Error("vertex array not initialized");for(var x=new s.Vector3,y,b,_,h,f=0;f<this.vertices;++f)y=f*3,b=this.vertexArray[y],_=this.vertexArray[y+1],h=this.vertexArray[y+2],x.x+=b,x.y+=_,x.z+=h;return x.divideScalar(this.vertices),x}setNormals(){var x=this.faceArray,y=this.vertexArray,b=this.normalArray;if(!(!this.vertices||!this.faceidx)){if(!x)throw new Error("face array not initialized");if(!y)throw new Error("vertex array not initialized");if(!b)throw new Error("normal array not initialized");for(var _,h,f,E,m,S,w,v=0;v<x.length/3;++v)_=x[v*3]*3,h=x[v*3+1]*3,f=x[v*3+2]*3,E=new s.Vector3(y[_],y[_+1],y[_+2]),m=new s.Vector3(y[h],y[h+1],y[h+2]),S=new s.Vector3(y[f],y[f+1],y[f+2]),E.subVectors(E,m),S.subVectors(S,m),S.cross(E),w=S,w.normalize(),b[_]+=w.x,b[h]+=w.x,b[f]+=w.x,b[_+1]+=w.y,b[h+1]+=w.y,b[f+1]+=w.y,b[_+2]+=w.z,b[h+2]+=w.z,b[f+2]+=w.z}}setLineIndices(){if(this.faceidx&&!(this.lineArray&&this.lineArray.length==this.faceidx*2&&this.lineidx==this.faceidx*2)){var x=this.faceArray,y=this.lineArray=new Uint16Array(this.faceidx*2);if(this.lineidx=this.faceidx*2,!x)throw new Error("face array not initialized");for(var b=0;b<this.faceidx/3;++b){var _=b*3,h=_*2,f=x[_],E=x[_+1],m=x[_+2];y[h]=f,y[h+1]=E,y[h+2]=f,y[h+3]=m,y[h+4]=E,y[h+5]=m}}}vrml(x,y){var b,_,h,f,E,m,S,w,v,A,M,T,R,P,L,O,I,N,k="";if(k+=x+`Shape {
`+x+` appearance Appearance {
`+x+`  material Material {
`+x+"   diffuseColor "+((b=y?.color)===null||b===void 0?void 0:b.r)+" "+((_=y?.color)===null||_===void 0?void 0:_.g)+" "+((h=y?.color)===null||h===void 0?void 0:h.b)+`
`,y.wireframe&&this.colorArray){let F=this.colorArray;k+=x+"    emissiveColor "+F[0]+" "+F[1]+" "+F[2]+`
`}y?.transparent&&(k+=x+"   transparency "+(1-y.opacity)+`
`),k+=x+`  }
`,k+=x+` }
`;var U=x;if(x+=" ",y instanceof n.LineBasicMaterial||y.wireframe){k+=x+`geometry IndexedLineSet {
`+x+` colorPerVertex TRUE
`+x+` coord Coordinate {
`+x+`  point [
`;let F,j,H;for(let B=0;B<this.vertices;++B){let V=B*3;F=(f=this.vertexArray)===null||f===void 0?void 0:f[V],j=(E=this.vertexArray)===null||E===void 0?void 0:E[V+1],H=(m=this.vertexArray)===null||m===void 0?void 0:m[V+2],k+=x+"   "+F+" "+j+" "+H+`,
`}if(k+=x+`  ]
`,k+=x+` }
`,this.colorArray&&!y.wireframe){k+=x+` color Color {
`+x+`  color [
`;for(let B=0;B<this.vertices;++B){let V=B*3;F=this.colorArray[V],j=this.colorArray[V+1],H=this.colorArray[V+2],k+=x+"   "+F+" "+j+" "+H+`,
`}k+=x+`  ]
`,k+=x+` }
`}if(k+=x+` coordIndex [
`,y.wireframe&&this.faceArray)for(let B=0;B<this.faceidx;B+=3)F=(S=this.faceArray)===null||S===void 0?void 0:S[B],j=(w=this.faceArray)===null||w===void 0?void 0:w[B+1],H=(v=this.faceArray)===null||v===void 0?void 0:v[B+2],k+=x+"  "+F+", "+j+", "+H+`, -1,
`;else for(let B=0;B<this.vertices-1;B+=2)k+=x+"  "+B+", "+(B+1)+`, -1,
`;k+=x+` ]
`,k+=x+`}
`}else{k+=x+`geometry IndexedFaceSet {
`+x+` colorPerVertex TRUE
`+x+` normalPerVertex TRUE
`+x+` solid FALSE
`,k+=x+` coord Coordinate {
`+x+`  point [
`;let F,j,H;for(let B=0;B<this.vertices;++B){let V=B*3;F=(A=this.vertexArray)===null||A===void 0?void 0:A[V],j=(M=this.vertexArray)===null||M===void 0?void 0:M[V+1],H=(T=this.vertexArray)===null||T===void 0?void 0:T[V+2],k+=x+"   "+F+" "+j+" "+H+`,
`}k+=x+`  ]
`,k+=x+` }
`,k+=x+` normal Normal {
`+x+`  vector [
`;for(let B=0;B<this.vertices;++B){let V=B*3;F=(R=this.normalArray)===null||R===void 0?void 0:R[V],j=(P=this.normalArray)===null||P===void 0?void 0:P[V+1],H=(L=this.normalArray)===null||L===void 0?void 0:L[V+2],k+=x+"   "+F+" "+j+" "+H+`,
`}if(k+=x+`  ]
`,k+=x+` }
`,this.colorArray){k+=x+` color Color {
`+x+`  color [
`;for(let B=0;B<this.vertices;++B){let V=B*3;F=this.colorArray[V],j=this.colorArray[V+1],H=this.colorArray[V+2],k+=x+"   "+F+" "+j+" "+H+`,
`}k+=x+`  ]
`,k+=x+` }
`}k+=x+` coordIndex [
`;for(let B=0;B<this.faceidx;B+=3)F=(O=this.faceArray)===null||O===void 0?void 0:O[B],j=(I=this.faceArray)===null||I===void 0?void 0:I[B+1],H=(N=this.faceArray)===null||N===void 0?void 0:N[B+2],k+=x+"  "+F+", "+j+", "+H+`, -1,
`;k+=x+` ]
`,k+=x+`}
`}return k+=U+"}",k}truncateArrayBuffers(x=!0,y=!1){var b=this.vertexArray,_=this.colorArray,h=this.normalArray,f=this.faceArray,E=this.lineArray,m=this.radiusArray;this.vertexArray=b?.subarray(0,this.vertices*3)||null,this.colorArray=_?.subarray(0,this.vertices*3)||null,x?(this.normalArray=h?.subarray(0,this.vertices*3)||null,this.faceArray=f?.subarray(0,this.faceidx)||null,this.lineidx>0?this.lineArray=E?.subarray(0,this.lineidx)||null:this.lineArray=new Uint16Array(0)):(this.normalArray=new Float32Array(0),this.faceArray=new Uint16Array(0),this.lineArray=new Uint16Array(0)),m&&(this.radiusArray=m.subarray(0,this.vertices)),y&&(this.normalArray&&(this.normalArray=new Float32Array(this.normalArray)),this.faceArray&&(this.faceArray=new Uint16Array(this.faceArray)),this.lineArray&&(this.lineArray=new Uint16Array(this.lineArray)),this.vertexArray&&(this.vertexArray=new Float32Array(this.vertexArray)),this.colorArray&&(this.colorArray=new Float32Array(this.colorArray)),this.radiusArray&&(this.radiusArray=new Float32Array(this.radiusArray))),this.__inittedArrays=!0}}class d extends i.EventDispatcher{constructor(x=!1,y=!1,b=!1){super(),this.name="",this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.buffersNeedUpdate=!1,this.imposter=!1,this.instanced=!1,this.geometryGroups=[],this.groups=0,this.id=u++,this.mesh=x,this.radii=y,this.offset=b}updateGeoGroup(x=0){var y,b=this.groups>0?this.geometryGroups[this.groups-1]:null;return(!b||b.vertices+x>(((y=b?.vertexArray)===null||y===void 0?void 0:y.length)||0)/3)&&(b=this.addGeoGroup()),b}vrml(x,y){for(var b="",_=this.geometryGroups.length,h=0;h<_;h++){var f=this.geometryGroups[h];b+=f.vrml(x,y)+`,
`}return b}addGeoGroup(){var x=new l(this.geometryGroups.length);return this.geometryGroups.push(x),this.groups=this.geometryGroups.length,x.vertexArray=new Float32Array(a*3),x.colorArray=new Float32Array(a*3),this.mesh&&(x.normalArray=new Float32Array(a*3),x.faceArray=new Uint16Array(a*6),x.lineArray=new Uint16Array(a*6)),this.radii&&(x.radiusArray=new Float32Array(a)),x.useOffset=this.offset,x}setUpNormals(...x){for(var y=0;y<this.groups;y++){var b=this.geometryGroups[y];b.setNormals(...x)}}setColors(...x){for(var y=this.geometryGroups.length,b=0;b<y;b++){var _=this.geometryGroups[b];_.setColors(...x)}}setColor(...x){let y=this.geometryGroups.length;for(var b=0;b<y;b++){var _=this.geometryGroups[b];_.setColor(...x)}}setUpWireframe(...x){let y=this.geometryGroups.length;for(var b=0;b<y;b++){var _=this.geometryGroups[b];_.setLineIndices(...x)}}initTypedArrays(){for(var x=0;x<this.groups;x++){var y=this.geometryGroups[x];y.__inittedArrays!==!0&&y.truncateArrayBuffers(this.mesh,!1)}}dispose(){this.dispatchEvent({type:"dispose"})}get vertices(){for(var x=0,y=0;y<this.groups;y++)x+=this.geometryGroups[y].vertices;return x}}let u=0}),"./src/WebGL/core/Object3D.ts":((r,e,t)=>{t.r(e),t.d(e,{Light:()=>l,Object3D:()=>o,Object3DIDCount:()=>s,Scene:()=>a});var n=t("./src/WebGL/math/index.ts"),i=t("./src/colors.ts");let s=0;class o{constructor(){this.id=s++,this.name="",this.children=[],this.position=new n.Vector3,this.rotation=new n.Vector3,this.matrix=new n.Matrix4,this.matrixWorld=new n.Matrix4,this.quaternion=new n.Quaternion,this.eulerOrder="XYZ",this.up=new n.Vector3(0,1,0),this.scale=new n.Vector3(1,1,1),this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.rotationAutoUpdate=!0,this.useQuaternion=!1,this.visible=!0}lookAt(u){this.matrix.lookAt(u,this.position,this.up),this.rotationAutoUpdate&&(this.useQuaternion===!0?console.error("Unimplemented math operation."):this.rotation instanceof n.Vector3&&this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder))}add(u){if(u===this){console.error("Can't add $3Dmol.Object3D to itself");return}u.parent=this,this.children.push(u);for(var g=this;g.parent!==void 0;)g=g.parent;g!==void 0&&g instanceof a&&g.__addObject(u)}remove(u){var g=this.children.indexOf(u);if(g!==-1){u.parent=void 0,this.children.splice(g,1);for(var x=this;x.parent!==void 0;)x=x.parent;x!==void 0&&x instanceof a&&x.__removeObject(u)}}vrml(u){u||(u=" ");var g=2*Math.atan2(this.quaternion.lengthxyz(),this.quaternion.w),x=0,y=0,b=0;if(g!=0){let f=Math.sin(g/2);x=this.quaternion.x/f,y=this.quaternion.y/f,b=this.quaternion.z/f}var _=u+`Transform {
`+u+" center "+this.position.x+" "+this.position.y+" "+this.position.z+`
`+u+" rotation "+x+" "+y+" "+b+" "+g+`
`+u+` children [
`;this.geometry&&(_+=this.geometry.vrml(u,this.material));for(var h=0;h<this.children.length;h++)_+=this.children[h].vrml(u+" ")+`,
`;return _+=` ]
`,_+="}",_}updateMatrix(){this.matrix.setPosition(this.position),this.useQuaternion===!1&&this.rotation instanceof n.Vector3?this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder):this.matrix.setRotationFromQuaternion(this.quaternion),(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(u){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||u===!0)&&(this.parent===void 0?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1;for(var g=0;g<this.children.length;g++)this.children[g].updateMatrixWorld(!0)}clone(u){u===void 0&&(u=new o),u.name=this.name,u.up.copy(this.up),u.position.copy(this.position),u.rotation instanceof n.Vector3&&this.rotation instanceof n.Vector3?u.rotation.copy(this.rotation):u.rotation=this.rotation,u.eulerOrder=this.eulerOrder,u.scale.copy(this.scale),u.rotationAutoUpdate=this.rotationAutoUpdate,u.matrix.copy(this.matrix),u.matrixWorld.copy(this.matrixWorld),u.quaternion.copy(this.quaternion),u.matrixAutoUpdate=this.matrixAutoUpdate,u.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,u.useQuaternion=this.useQuaternion,u.visible=this.visible;for(var g=0;g<this.children.length;g++){var x=this.children[g];u.add(x.clone())}return u}setVisible(u){this.visible=u;for(var g=0;g<this.children.length;g++){var x=this.children[g];x.setVisible(u)}}}class a extends o{constructor(){super(...arguments),this.fog=null,this.overrideMaterial=null,this.matrixAutoUpdate=!1,this.__objects=[],this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]}__addObject(u){if(u instanceof l)this.__lights.indexOf(u)===-1&&this.__lights.push(u),u.target&&u.target.parent===void 0&&this.add(u.target);else if(this.__objects.indexOf(u)===-1){this.__objects.push(u),this.__objectsAdded.push(u);var g=this.__objectsRemoved.indexOf(u);g!==-1&&this.__objectsRemoved.splice(g,1)}for(var x=0;x<u.children.length;x++)this.__addObject(u.children[x])}__removeObject(u){var g;if(u instanceof l)g=this.__lights.indexOf(u),g!==-1&&this.__lights.splice(g,1);else if(g=this.__objects.indexOf(u),g!==-1){this.__objects.splice(g,1),this.__objectsRemoved.push(u);var x=this.__objectsAdded.indexOf(u);x!==-1&&this.__objectsAdded.splice(g,1)}for(var y=0;y<u.children.length;y++)this.__removeObject(u.children[y])}}class l extends o{constructor(u,g=1){super(),this.position=new n.Vector3(0,1,0),this.target=new o,this.castShadow=!1,this.onlyShadow=!1,this.color=new i.Color(u),this.intensity=g}}}),"./src/WebGL/core/Projector.ts":((r,e,t)=>{t.r(e),t.d(e,{Projector:()=>s});var n=t("./src/WebGL/math/index.ts");const i=new n.Matrix4;class s{static unprojectVector(a,l){return l.projectionMatrixInverse.getInverse(l.projectionMatrix),i.multiplyMatrices(l.matrixWorld,l.projectionMatrixInverse),a.applyProjection(i)}static projectVector(a,l){return l.matrixWorldInverse.getInverse(l.matrixWorld),i.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),a.applyProjection(i)}projectVector(a,l){return s.projectVector(a,l)}unprojectVector(a,l){return s.unprojectVector(a,l)}}}),"./src/WebGL/core/Raycaster.ts":((r,e,t)=>{t.r(e),t.d(e,{Raycaster:()=>a,intersectObject:()=>f});var n=t("./src/WebGL/math/index.ts"),i=t("./src/WebGL/shapes/index.ts");const s=(E,m)=>E.distance-m.distance,o=new n.Matrix4;class a{constructor(m,S,w,v){this.precision=1e-4,this.linePrecision=.2,this.ray=new n.Ray(m,S),this.ray.direction.lengthSq()>0&&this.ray.direction.normalize(),this.near=v||0,this.far=w||1/0}set(m,S){this.ray.set(m,S)}setFromCamera(m,S){S.ortho?(this.ray.origin.set(m.x,m.y,(S.near+S.far)/(S.near-S.far)).unproject(S),this.ray.direction.set(0,0,-1).transformDirection(S.matrixWorld)):(this.ray.origin.setFromMatrixPosition(S.matrixWorld),this.ray.direction.set(m.x,m.y,m.z),S.projectionMatrixInverse.getInverse(S.projectionMatrix),o.multiplyMatrices(S.matrixWorld,S.projectionMatrixInverse),this.ray.direction.applyProjection(o),this.ray.direction.sub(this.ray.origin).normalize())}intersectObjects(m,S){for(var w=[],v=0,A=S.length;v<A;v++)f(m,S[v],this,w);return w.sort(s),w}}const l=E=>Math.min(Math.max(E,-1),1);var d=new i.Sphere,u=new i.Cylinder,g=new i.Triangle,x=new n.Vector3,y=new n.Vector3,b=new n.Vector3,_=new n.Vector3,h=new n.Vector3;function f(E,m,S,w){if(h.getPositionFromMatrix(E.matrixWorld),m.intersectionShape===void 0||m.hidden)return w;var v=m.intersectionShape,A=S.linePrecision;A*=E.matrixWorld.getMaxScaleOnAxis();var M=A*A;if(m.boundingSphere!==void 0&&m.boundingSphere instanceof i.Sphere&&(d.copy(m.boundingSphere),d.applyMatrix4(E.matrixWorld),!S.ray.isIntersectionSphere(d)))return w;var T,R,P,L,O,I,N,k,U,F,j,H,B,V;for(T=0,R=v.triangle.length;T<R;T++)if(v.triangle[T]instanceof i.Triangle){if(g.copy(v.triangle[T]),g.applyMatrix4(E.matrixWorld),P=g.getNormal(),L=S.ray.direction.dot(P),L>=0||(x.subVectors(g.a,S.ray.origin),N=P.dot(x)/L,N<0))continue;y.copy(S.ray.direction).multiplyScalar(N).add(S.ray.origin),y.sub(g.a),b.copy(g.b).sub(g.a),_.copy(g.c).sub(g.a);var K=b.dot(_),q=b.lengthSq(),Te=_.lengthSq();if(H=(q*y.dot(_)-K*y.dot(b))/(q*Te-K*K),H<0||H>1||(j=(y.dot(b)-H*K)/q,j<0||j>1||j+H>1))continue;w.push({clickable:m,distance:N})}for(T=0,R=v.cylinder.length;T<R;T++)if(v.cylinder[T]instanceof i.Cylinder){if(u.copy(v.cylinder[T]),u.applyMatrix4(E.matrixWorld),x.subVectors(u.c1,S.ray.origin),O=x.dot(u.direction),I=x.dot(S.ray.direction),L=l(S.ray.direction.dot(u.direction)),U=1-L*L,U===0)continue;B=(L*I-O)/U,V=(I-L*O)/U,y.copy(u.direction).multiplyScalar(B).add(u.c1),b.copy(S.ray.direction).multiplyScalar(V).add(S.ray.origin),k=_.subVectors(y,b).lengthSq();var Fe=u.radius*u.radius;if(k<=Fe){if(F=(L*O-I)*(L*O-I)-U*(x.lengthSq()-O*O-Fe),F<=0?H=N=Math.sqrt(k):H=N=(I-L*O-Math.sqrt(F))/U,j=L*H-O,j<0||j*j>u.lengthSq()||H<0)continue;w.push({clickable:m,distance:N})}}for(T=0,R=v.line.length;T<R;T+=2){y.copy(v.line[T]),y.applyMatrix4(E.matrixWorld),b.copy(v.line[T+1]),b.applyMatrix4(E.matrixWorld),_.subVectors(b,y);var We=_.lengthSq();_.normalize(),x.subVectors(y,S.ray.origin);var J=x.dot(_);I=x.dot(S.ray.direction),L=l(S.ray.direction.dot(_)),U=1-L*L,U!==0&&(B=(L*I-J)/U,V=(I-L*J)/U,y.add(_.multiplyScalar(B)),b.copy(S.ray.direction).multiplyScalar(V).add(S.ray.origin),k=_.subVectors(b,y).lengthSq(),k<M&&B*B<We&&w.push({clickable:m,distance:V}))}for(T=0,R=v.sphere.length;T<R;T++)if(v.sphere[T]instanceof i.Sphere&&(d.copy(v.sphere[T]),d.applyMatrix4(E.matrixWorld),S.ray.isIntersectionSphere(d))){y.subVectors(d.center,S.ray.origin);var et=y.dot(S.ray.direction);if(F=et*et-(y.lengthSq()-d.radius*d.radius),et<0)return w;F<=0?N=et:N=et-Math.sqrt(F),w.push({clickable:m,distance:N})}return w}}),"./src/WebGL/core/Texture.ts":((r,e,t)=>{t.r(e),t.d(e,{Texture:()=>a,TextureIdCount:()=>l});var n=t("./src/WebGL/constants/TextureConstants.ts"),i=t("./src/WebGL/math/index.ts"),s=t("./src/WebGL/core/EventDispatcher.ts"),o=t("./src/WebGL/core/UVMapping.ts");class a extends s.EventDispatcher{constructor(u,g){super(),this.id=l++,this.name="",this.image=u,this.mapping=new o.UVMapping,this.wrapS=n.ClampToEdgeWrapping,this.wrapT=n.ClampToEdgeWrapping,this.anisotropy=1,g?(this.format=n.RFormat,this.type=n.FloatType,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.magFilter=n.NearestFilter,this.minFilter=n.NearestFilter):(this.format=n.RGBAFormat,this.type=n.UnsignedByteType,this.offset=new i.Vector2(0,0),this.repeat=new i.Vector2(1,1),this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.magFilter=n.LinearFilter,this.minFilter=n.LinearMipMapLinearFilter),this.needsUpdate=!1,this.onUpdate=null}clone(u=new a){return u.image=this.image,u.mapping=this.mapping,u.wrapS=this.wrapS,u.wrapT=this.wrapT,u.magFilter=this.magFilter,u.minFilter=this.minFilter,u.anisotropy=this.anisotropy,u.format=this.format,u.type=this.type,u.offset.copy(this.offset),u.repeat.copy(this.repeat),u.premultiplyAlpha=this.premultiplyAlpha,u.flipY=this.flipY,u.unpackAlignment=this.unpackAlignment,u}dispose(){this.dispatchEvent({type:"dispose"})}}let l=0}),"./src/WebGL/core/UVMapping.ts":((r,e,t)=>{t.r(e),t.d(e,{UVMapping:()=>n});class n{}}),"./src/WebGL/core/index.ts":((r,e,t)=>{t.r(e),t.d(e,{EventDispatcher:()=>n.EventDispatcher,Geometry:()=>i.Geometry,GeometryGroup:()=>i.GeometryGroup,GeometryIDCount:()=>i.GeometryIDCount,Light:()=>s.Light,Object3D:()=>s.Object3D,Object3DIDCount:()=>s.Object3DIDCount,Projector:()=>o.Projector,Raycaster:()=>a.Raycaster,Scene:()=>s.Scene,Texture:()=>l.Texture,TextureIdCount:()=>l.TextureIdCount,UVMapping:()=>d.UVMapping,intersectObject:()=>a.intersectObject});var n=t("./src/WebGL/core/EventDispatcher.ts"),i=t("./src/WebGL/core/Geometry.ts"),s=t("./src/WebGL/core/Object3D.ts"),o=t("./src/WebGL/core/Projector.ts"),a=t("./src/WebGL/core/Raycaster.ts"),l=t("./src/WebGL/core/Texture.ts"),d=t("./src/WebGL/core/UVMapping.ts")}),"./src/WebGL/index.ts":((r,e,t)=>{t.r(e),t.d(e,{BackSide:()=>n.BackSide,Camera:()=>u.Camera,ClampToEdgeWrapping:()=>n.ClampToEdgeWrapping,Coloring:()=>n.Coloring,Cylinder:()=>d.Cylinder,DoubleSide:()=>n.DoubleSide,EventDispatcher:()=>i.EventDispatcher,FloatType:()=>n.FloatType,Fog:()=>g.Fog,FrontSide:()=>n.FrontSide,Geometry:()=>i.Geometry,GeometryGroup:()=>i.GeometryGroup,GeometryIDCount:()=>i.GeometryIDCount,ImposterMaterial:()=>s.ImposterMaterial,InstancedMaterial:()=>s.InstancedMaterial,Light:()=>i.Light,Line:()=>a.Line,LineBasicMaterial:()=>s.LineBasicMaterial,LineStyle:()=>a.LineStyle,LinearFilter:()=>n.LinearFilter,LinearMipMapLinearFilter:()=>n.LinearMipMapLinearFilter,Material:()=>s.Material,MaterialIdCount:()=>s.MaterialIdCount,Matrix3:()=>o.Matrix3,Matrix4:()=>o.Matrix4,Mesh:()=>a.Mesh,MeshDoubleLambertMaterial:()=>s.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>s.MeshLambertMaterial,MeshOutlineMaterial:()=>s.MeshOutlineMaterial,NearestFilter:()=>n.NearestFilter,Object3D:()=>i.Object3D,Object3DIDCount:()=>i.Object3DIDCount,Projector:()=>i.Projector,Quaternion:()=>o.Quaternion,R32Format:()=>n.R32Format,RFormat:()=>n.RFormat,RGBAFormat:()=>n.RGBAFormat,Ray:()=>o.Ray,Raycaster:()=>i.Raycaster,Renderer:()=>x.Renderer,Scene:()=>i.Scene,ShaderLib:()=>l.ShaderLib,ShaderUtils:()=>l.ShaderUtils,Shading:()=>n.Shading,Sphere:()=>d.Sphere,SphereImposterMaterial:()=>s.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>s.SphereImposterOutlineMaterial,Sprite:()=>a.Sprite,SpriteAlignment:()=>n.SpriteAlignment,SpriteMaterial:()=>s.SpriteMaterial,SpritePlugin:()=>y.SpritePlugin,StickImposterMaterial:()=>s.StickImposterMaterial,StickImposterOutlineMaterial:()=>s.StickImposterOutlineMaterial,Texture:()=>i.Texture,TextureIdCount:()=>i.TextureIdCount,TextureOperations:()=>n.TextureOperations,Triangle:()=>d.Triangle,UVMapping:()=>i.UVMapping,UnsignedByteType:()=>n.UnsignedByteType,Vector2:()=>o.Vector2,Vector3:()=>o.Vector3,VolumetricMaterial:()=>s.VolumetricMaterial,basic:()=>l.basic,clamp:()=>o.clamp,clone:()=>l.clone,conversionMatrix3:()=>o.conversionMatrix3,degToRad:()=>o.degToRad,instanced:()=>l.instanced,intersectObject:()=>i.intersectObject,lambert:()=>l.lambert,lambertdouble:()=>l.lambertdouble,outline:()=>l.outline,screen:()=>l.screen,screenaa:()=>l.screenaa,sphereimposter:()=>l.sphereimposter,sphereimposteroutline:()=>l.sphereimposteroutline,sprite:()=>l.sprite,stickimposter:()=>l.stickimposter,stickimposteroutline:()=>l.stickimposteroutline,volumetric:()=>l.volumetric});var n=t("./src/WebGL/constants/index.ts"),i=t("./src/WebGL/core/index.ts"),s=t("./src/WebGL/materials/index.ts"),o=t("./src/WebGL/math/index.ts"),a=t("./src/WebGL/objects/index.ts"),l=t("./src/WebGL/shaders/index.ts"),d=t("./src/WebGL/shapes/index.ts"),u=t("./src/WebGL/Camera.ts"),g=t("./src/WebGL/Fog.ts"),x=t("./src/WebGL/Renderer.ts"),y=t("./src/WebGL/SpritePlugin.ts")}),"./src/WebGL/materials/ImposterMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{ImposterMaterial:()=>l});var n=t("./src/WebGL/constants/Coloring.ts"),i=t("./src/WebGL/constants/Shading.ts"),s=t("./src/colors.ts"),o=t("./src/WebGL/math/index.ts"),a=t("./src/WebGL/materials/Material.ts");class l extends a.Material{constructor(u){super(),this.color=new s.Color(16777215),this.ambient=new s.Color(1048575),this.emissive=new s.Color(0),this.imposter=!0,this.wrapAround=!1,this.wrapRGB=new o.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=i.Shading.SmoothShading,this.shaderID=null,this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.setValues(u)}clone(u=new l){return super.clone.call(this,u),u.color.copy(this.color),u.ambient.copy(this.ambient),u.emissive.copy(this.emissive),u.wrapAround=this.wrapAround,u.wrapRGB.copy(this.wrapRGB),u.map=this.map,u.lightMap=this.lightMap,u.specularMap=this.specularMap,u.envMap=this.envMap,u.combine=this.combine,u.reflectivity=this.reflectivity,u.refractionRatio=this.refractionRatio,u.fog=this.fog,u.shading=this.shading,u.shaderID=this.shaderID,u.vertexColors=this.vertexColors,u.skinning=this.skinning,u.morphTargets=this.morphTargets,u.morphNormals=this.morphNormals,u}}}),"./src/WebGL/materials/InstancedMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{InstancedMaterial:()=>l});var n=t("./src/WebGL/constants/Coloring.ts"),i=t("./src/WebGL/constants/Shading.ts"),s=t("./src/colors.ts"),o=t("./src/WebGL/math/index.ts"),a=t("./src/WebGL/materials/Material.ts");class l extends a.Material{constructor(u){super(),this.color=new s.Color(16777215),this.ambient=new s.Color(1048575),this.emissive=new s.Color(0),this.wrapAround=!1,this.wrapRGB=new o.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=i.Shading.SmoothShading,this.shaderID="instanced",this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.sphere=null,this.setValues(u)}clone(u=new l){return super.clone.call(this,u),u.color.copy(this.color),u.ambient.copy(this.ambient),u.emissive.copy(this.emissive),u.wrapAround=this.wrapAround,u.wrapRGB.copy(this.wrapRGB),u.map=this.map,u.lightMap=this.lightMap,u.specularMap=this.specularMap,u.envMap=this.envMap,u.combine=this.combine,u.reflectivity=this.reflectivity,u.refractionRatio=this.refractionRatio,u.fog=this.fog,u.shading=this.shading,u.shaderID=this.shaderID,u.vertexColors=this.vertexColors,u.skinning=this.skinning,u.morphTargets=this.morphTargets,u.morphNormals=this.morphNormals,u.sphere=this.sphere,u}}}),"./src/WebGL/materials/LineBasicMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{LineBasicMaterial:()=>s});var n=t("./src/colors.ts"),i=t("./src/WebGL/materials/Material.ts");class s extends i.Material{constructor(a){super(),this.color=new n.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.shaderID="basic",this.setValues(a)}clone(a=new s){return super.clone.call(this,a),a.color.copy(this.color),a}}}),"./src/WebGL/materials/Material.ts":((r,e,t)=>{t.r(e),t.d(e,{Material:()=>a,MaterialIdCount:()=>l});var n=t("./src/WebGL/constants/Sides.ts"),i=t("./src/WebGL/core/index.ts"),s=t("./src/WebGL/math/index.ts"),o=t("./src/colors.ts");class a extends i.EventDispatcher{constructor(){super(...arguments),this.id=l++,this.name="",this.side=n.FrontSide,this.opacity=1,this.transparent=!1,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.visible=!0,this.needsUpdate=!0,this.outline=!1,this.wireframe=!1,this.shaded=!1}setValues(u={}){if(u!==void 0)for(var g in u){var x=u[g];if(x===void 0){console.warn("$3Dmol.Material: '"+g+"' parameter is undefined.");continue}if(g in this){var y=this[g];y instanceof o.Color&&x instanceof o.Color?y.copy(x):y instanceof o.Color?y.set(x):y instanceof s.Vector3&&x instanceof s.Vector3?y.copy(x):this[g]=x}}}clone(u=new a){return u.name=this.name,u.side=this.side,u.opacity=this.opacity,u.transparent=this.transparent,u.depthTest=this.depthTest,u.depthWrite=this.depthWrite,u.polygonOffset=this.polygonOffset,u.polygonOffsetFactor=this.polygonOffsetFactor,u.polygonOffsetUnits=this.polygonOffsetUnits,u.alphaTest=this.alphaTest,u.overdraw=this.overdraw,u.visible=this.visible,u}makeShaded(u){this.shaded=!0,this.uniforms&&(this.uniforms.shading={type:"i",value:u},this.uniforms.vWidth={type:"f",value:1},this.uniforms.vHeight={type:"f",value:1})}dispose(){this.dispatchEvent({type:"dispose"})}}let l=0}),"./src/WebGL/materials/MeshDoubleLambertMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{MeshDoubleLambertMaterial:()=>s});var n=t("./src/WebGL/constants/Sides.ts"),i=t("./src/WebGL/materials/MeshLambertMaterial.ts");class s extends i.MeshLambertMaterial{constructor(a){super(a),this.shaderID="lambertdouble",this.side=n.DoubleSide,this.outline=!1}clone(a=new s){return super.clone.call(this,a),a}}}),"./src/WebGL/materials/MeshLambertMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{MeshLambertMaterial:()=>l});var n=t("./src/WebGL/constants/Coloring.ts"),i=t("./src/WebGL/constants/Shading.ts"),s=t("./src/WebGL/materials/Material.ts"),o=t("./src/colors.ts"),a=t("./src/WebGL/math/index.ts");class l extends s.Material{constructor(u){super(),this.color=new o.Color(16777215),this.ambient=new o.Color(1048575),this.emissive=new o.Color(0),this.wrapAround=!1,this.wrapRGB=new a.Vector3(1,1,1),this.map=void 0,this.lightMap=null,this.specularMap=null,this.envMap=null,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.shading=i.Shading.SmoothShading,this.shaderID="lambert",this.vertexColors=n.Coloring.NoColors,this.skinning=!1,this.setValues(u)}clone(u=new l){return super.clone.call(this,u),u.color.copy(this.color),u.ambient.copy(this.ambient),u.emissive.copy(this.emissive),u.wrapAround=this.wrapAround,u.wrapRGB.copy(this.wrapRGB),u.map=this.map,u.lightMap=this.lightMap,u.specularMap=this.specularMap,u.envMap=this.envMap,u.combine=this.combine,u.reflectivity=this.reflectivity,u.refractionRatio=this.refractionRatio,u.fog=this.fog,u.shading=this.shading,u.shaderID=this.shaderID,u.vertexColors=this.vertexColors,u.skinning=this.skinning,u.morphTargets=this.morphTargets,u.morphNormals=this.morphNormals,u}}}),"./src/WebGL/materials/MeshOutlineMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{MeshOutlineMaterial:()=>s});var n=t("./src/colors.ts"),i=t("./src/WebGL/materials/Material.ts");class s extends i.Material{constructor(a){super(),a=a||{},this.fog=!0,this.shaderID="outline",this.wireframe=!1,this.outlineColor=n.CC.color(a.color||new n.Color(0,0,0)),this.outlineWidth=a.width||.1,this.outlinePushback=a.pushback||1,this.outlineMaxPixels=a.maxpixels||0}clone(a=new s){return super.clone.call(this,a),a.fog=this.fog,a.shaderID=this.shaderID,a.wireframe=this.wireframe,a.outlineColor=this.outlineColor,a.outlineWidth=this.outlineWidth,a.outlinePushback=this.outlinePushback,a.outlineMaxPixels=this.outlineMaxPixels,a}}}),"./src/WebGL/materials/SphereImposterMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{SphereImposterMaterial:()=>i});var n=t("./src/WebGL/materials/ImposterMaterial.ts");class i extends n.ImposterMaterial{constructor(o){super(o),this.shaderID="sphereimposter",this.setValues(o)}clone(o=new i){return super.clone.call(this,o),o}}}),"./src/WebGL/materials/SphereImposterOutlineMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{SphereImposterOutlineMaterial:()=>s});var n=t("./src/colors.ts"),i=t("./src/WebGL/materials/ImposterMaterial.ts");class s extends i.ImposterMaterial{constructor(a){super(a),a=a||{},this.shaderID="sphereimposteroutline",this.outlineColor=n.CC.color(a.color||new n.Color(0,0,0)),this.outlineWidth=a.width||.1,this.outlinePushback=a.pushback||1,this.outlineMaxPixels=a.maxpixels||0,this.setValues(a)}clone(a=new s){return super.clone.call(this,a),a.outlineColor=this.outlineColor,a.outlineWidth=this.outlineWidth,a.outlinePushback=this.outlinePushback,a.outlineMaxPixels=this.outlineMaxPixels,a}}}),"./src/WebGL/materials/SpriteMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{SpriteMaterial:()=>l});var n=t("./src/WebGL/constants/SpriteAlignment.ts"),i=t("./src/WebGL/core/Texture.ts"),s=t("./src/colors.ts"),o=t("./src/WebGL/math/index.ts"),a=t("./src/WebGL/materials/Material.ts");class l extends a.Material{constructor(u){super(),this.color=new s.Color(16777215),this.map=new i.Texture,this.useScreenCoordinates=!0,this.fog=!1,this.uvOffset=new o.Vector2(0,0),this.uvScale=new o.Vector2(1,1),this.depthTest=!this.useScreenCoordinates,this.sizeAttenuation=!this.useScreenCoordinates,this.screenOffset=this.screenOffset,this.scaleByViewPort=!this.sizeAttenuation,this.alignment=n.SpriteAlignment.center.clone(),this.setValues(u),u=u||{},u.depthTest===void 0&&(this.depthTest=!this.useScreenCoordinates),u.sizeAttenuation===void 0&&(this.sizeAttenuation=!this.useScreenCoordinates),u.scaleByViewPort===void 0&&(this.scaleByViewPort=!this.sizeAttenuation)}clone(u=new l){return super.clone.call(this,u),u.color.copy(this.color),u.map=this.map,u.useScreenCoordinates=this.useScreenCoordinates,u.screenOffset=this.screenOffset,u.sizeAttenuation=this.sizeAttenuation,u.scaleByViewport=this.scaleByViewPort,u.alignment.copy(this.alignment),u.uvOffset.copy(this.uvOffset),u}}}),"./src/WebGL/materials/StickImposterMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{StickImposterMaterial:()=>i});var n=t("./src/WebGL/materials/ImposterMaterial.ts");class i extends n.ImposterMaterial{constructor(o){super(o),this.shaderID="stickimposter",this.setValues(o)}clone(o=new i){return super.clone.call(this,o),o}}}),"./src/WebGL/materials/StickImposterOutlineMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{StickImposterOutlineMaterial:()=>s});var n=t("./src/colors.ts"),i=t("./src/WebGL/materials/ImposterMaterial.ts");class s extends i.ImposterMaterial{constructor(a={}){super(a),this.shaderID="stickimposteroutline",this.outlineColor=new n.Color(0,0,0),this.outlineWidth=.1,this.outlinePushback=1,this.outlineMaxPixels=0,a.color&&(this.outlineColor=n.CC.color(a.color)),a.width&&(this.outlineWidth=a.width),a.pushback&&(this.outlinePushback=a.pushback),a.maxpixels&&(this.outlineMaxPixels=a.maxpixels),this.setValues(a)}clone(a=new s){return super.clone.call(this,a),a.outlineColor=this.outlineColor,a.outlineWidth=this.outlineWidth,a.outlinePushback=this.outlinePushback,a.outlineMaxPixels=this.outlineMaxPixels,a}}}),"./src/WebGL/materials/VolumetricMaterial.ts":((r,e,t)=>{t.r(e),t.d(e,{VolumetricMaterial:()=>o});var n=t("./src/WebGL/constants/Sides.ts"),i=t("./src/colors.ts"),s=t("./src/WebGL/materials/Material.ts");class o extends s.Material{constructor(l){super(),this.transparent=!1,this.volumetric=!0,this.color=new i.Color(16777215),this.transferfn=null,this.map=void 0,this.extent=[],this.maxdepth=100,this.unit=0,this.texmatrix=null,this.transfermin=-1,this.transfermax=1,this.subsamples=5,this.shaderID="volumetric",this.side=n.FrontSide,this.setValues(l)}clone(l=new o){return super.clone.call(this,l),l.transparent=this.transparent,l.volumetric=this.volumetric,l.color=this.color,l.transferfn=this.transferfn,l.map=this.map,l.extent=this.extent,l.maxdepth=this.maxdepth,l.unit=this.unit,l.texmatrix=this.texmatrix,l.transfermin=this.transfermin,l.transfermax=this.transfermax,l.subsamples=this.subsamples,l.shaderID=this.shaderID,l.side=this.side,l}}}),"./src/WebGL/materials/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ImposterMaterial:()=>n.ImposterMaterial,InstancedMaterial:()=>i.InstancedMaterial,LineBasicMaterial:()=>s.LineBasicMaterial,Material:()=>o.Material,MaterialIdCount:()=>o.MaterialIdCount,MeshDoubleLambertMaterial:()=>a.MeshDoubleLambertMaterial,MeshLambertMaterial:()=>l.MeshLambertMaterial,MeshOutlineMaterial:()=>d.MeshOutlineMaterial,SphereImposterMaterial:()=>u.SphereImposterMaterial,SphereImposterOutlineMaterial:()=>g.SphereImposterOutlineMaterial,SpriteMaterial:()=>x.SpriteMaterial,StickImposterMaterial:()=>y.StickImposterMaterial,StickImposterOutlineMaterial:()=>b.StickImposterOutlineMaterial,VolumetricMaterial:()=>_.VolumetricMaterial});var n=t("./src/WebGL/materials/ImposterMaterial.ts"),i=t("./src/WebGL/materials/InstancedMaterial.ts"),s=t("./src/WebGL/materials/LineBasicMaterial.ts"),o=t("./src/WebGL/materials/Material.ts"),a=t("./src/WebGL/materials/MeshDoubleLambertMaterial.ts"),l=t("./src/WebGL/materials/MeshLambertMaterial.ts"),d=t("./src/WebGL/materials/MeshOutlineMaterial.ts"),u=t("./src/WebGL/materials/SphereImposterMaterial.ts"),g=t("./src/WebGL/materials/SphereImposterOutlineMaterial.ts"),x=t("./src/WebGL/materials/SpriteMaterial.ts"),y=t("./src/WebGL/materials/StickImposterMaterial.ts"),b=t("./src/WebGL/materials/StickImposterOutlineMaterial.ts"),_=t("./src/WebGL/materials/VolumetricMaterial.ts")}),"./src/WebGL/math/Quaternion.ts":((r,e,t)=>{t.r(e),t.d(e,{Quaternion:()=>n});class n{constructor(s,o,a,l){this.x=s||0,this.y=o||0,this.z=a||0,this.w=l!==void 0?l:1}set(s,o,a,l){return this.x=s,this.y=o,this.z=a,this.w=l,this}copy(s){return this.x=s.x,this.y=s.y,this.z=s.z,this.w=s.w,this}conjugate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}inverse(){return this.conjugate().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthxyz(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}normalize(){let s=this.length();return s===0?(this.x=0,this.y=0,this.z=0,this.w=1):(s=1/s,this.x*=s,this.y*=s,this.z*=s,this.w*=s),this}multiply(s){return this.multiplyQuaternions(this,s)}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}multiplyQuaternions(s,o){const a=s.x,l=s.y,d=s.z,u=s.w,g=o.x,x=o.y,y=o.z,b=o.w;return this.x=a*b+u*g+l*y-d*x,this.y=l*b+u*x+d*g-a*y,this.z=d*b+u*y+a*x-l*g,this.w=u*b-a*g-l*x-d*y,this}sub(s){return this.x-=s.x,this.y-=s.y,this.z-=s.z,this.w-=s.w,this}clone(){return new n(this.x,this.y,this.z,this.w)}setFromEuler(s){const o=Math.cos(s.x/2),a=Math.cos(s.y/2),l=Math.cos(s.z/2),d=Math.sin(s.x/2),u=Math.sin(s.y/2),g=Math.sin(s.z/2);return this.x=d*a*l+o*u*g,this.y=o*u*l-d*a*g,this.z=o*a*g+d*u*l,this.w=o*a*l-d*u*g,this}}}),"./src/WebGL/math/Vector2.ts":((r,e,t)=>{t.r(e),t.d(e,{Vector2:()=>n});class n{constructor(s,o){this.x=s||0,this.y=o||0}set(s,o){return this.x=s,this.y=o,this}subVectors(s,o){return this.x=s.x-o.x,this.y=s.y-o.y,this}copy(s){return this.x=s.x,this.y=s.y,this}clone(){return new n(this.x,this.y)}}}),"./src/WebGL/math/index.ts":((r,e,t)=>{t.r(e),t.d(e,{Matrix3:()=>l.Matrix3,Matrix4:()=>l.Matrix4,Quaternion:()=>n.Quaternion,Ray:()=>l.Ray,Vector2:()=>i.Vector2,Vector3:()=>l.Vector3,clamp:()=>s.clamp,conversionMatrix3:()=>o.conversionMatrix3,degToRad:()=>a.degToRad});var n=t("./src/WebGL/math/Quaternion.ts"),i=t("./src/WebGL/math/Vector2.ts"),s=t("./src/WebGL/math/utils/clamp.ts"),o=t("./src/WebGL/math/utils/conversionMatrix3.ts"),a=t("./src/WebGL/math/utils/degToRad.ts"),l=t("./src/WebGL/math/math.ts")}),"./src/WebGL/math/math.ts":((r,e,t)=>{t.r(e),t.d(e,{Matrix3:()=>x,Matrix4:()=>u,Ray:()=>y,Vector3:()=>g});var n=t("./src/WebGL/math/utils/degToRad.ts"),i=t("./src/WebGL/math/utils/clamp.ts"),s,o,a,l,d;class u{constructor(_=1,h=0,f=0,E=0,m=0,S=1,w=0,v=0,A=0,M=0,T=1,R=0,P=0,L=0,O=0,I=1){typeof _<"u"&&typeof _!="number"?this.elements=new Float32Array(_):(this.elements=new Float32Array(16),this.elements[0]=_,this.elements[4]=h,this.elements[8]=f,this.elements[12]=E,this.elements[1]=m,this.elements[5]=S,this.elements[9]=w,this.elements[13]=v,this.elements[2]=A,this.elements[6]=M,this.elements[10]=T,this.elements[14]=R,this.elements[3]=P,this.elements[7]=L,this.elements[11]=O,this.elements[15]=I)}makeScale(_,h,f){throw new Error("Method not implemented.")}set(_,h,f,E,m,S,w,v,A,M,T,R,P,L,O,I){const N=this.elements;return N[0]=_,N[4]=h,N[8]=f,N[12]=E,N[1]=m,N[5]=S,N[9]=w,N[13]=v,N[2]=A,N[6]=M,N[10]=T,N[14]=R,N[3]=P,N[7]=L,N[11]=O,N[15]=I,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}copy(_){const h=_.elements;return this.set(h[0],h[4],h[8],h[12],h[1],h[5],h[9],h[13],h[2],h[6],h[10],h[14],h[3],h[7],h[11],h[15]),this}matrix3FromTopLeft(){const _=this.elements;return new x(_[0],_[4],_[8],_[1],_[5],_[9],_[2],_[6],_[10])}setRotationFromEuler(_,h){const f=this.elements,{x:E,y:m,z:S}=_,w=Math.cos(E),v=Math.sin(E),A=Math.cos(m),M=Math.sin(m),T=Math.cos(S),R=Math.sin(S);if(h===void 0||h==="XYZ"){const P=w*T,L=w*R,O=v*T,I=v*R;f[0]=A*T,f[4]=-A*R,f[8]=M,f[1]=L+O*M,f[5]=P-I*M,f[9]=-v*A,f[2]=I-P*M,f[6]=O+L*M,f[10]=w*A}else console.error(`Error with matrix4 setRotationFromEuler. Order: ${h}`);return this}setRotationFromQuaternion(_){const h=this.elements,{x:f,y:E,z:m,w:S}=_,w=f+f,v=E+E,A=m+m,M=f*w,T=f*v,R=f*A,P=E*v,L=E*A,O=m*A,I=S*w,N=S*v,k=S*A;return h[0]=1-(P+O),h[4]=T-k,h[8]=R+N,h[1]=T+k,h[5]=1-(M+O),h[9]=L-I,h[2]=R-N,h[6]=L+I,h[10]=1-(M+P),this}multiplyMatrices(_,h){const f=_.elements,E=h.elements,m=this.elements,S=f[0],w=f[4],v=f[8],A=f[12],M=f[1],T=f[5],R=f[9],P=f[13],L=f[2],O=f[6],I=f[10],N=f[14],k=f[3],U=f[7],F=f[11],j=f[15],H=E[0],B=E[4],V=E[8],K=E[12],q=E[1],Te=E[5],Fe=E[9],We=E[13],J=E[2],et=E[6],ht=E[10],er=E[14],tr=E[3],Hm=E[7],oi=E[11],h0=E[15];return m[0]=S*H+w*q+v*J+A*tr,m[4]=S*B+w*Te+v*et+A*Hm,m[8]=S*V+w*Fe+v*ht+A*oi,m[12]=S*K+w*We+v*er+A*h0,m[1]=M*H+T*q+R*J+P*tr,m[5]=M*B+T*Te+R*et+P*Hm,m[9]=M*V+T*Fe+R*ht+P*oi,m[13]=M*K+T*We+R*er+P*h0,m[2]=L*H+O*q+I*J+N*tr,m[6]=L*B+O*Te+I*et+N*Hm,m[10]=L*V+O*Fe+I*ht+N*oi,m[14]=L*K+O*We+I*er+N*h0,m[3]=k*H+U*q+F*J+j*tr,m[7]=k*B+U*Te+F*et+j*Hm,m[11]=k*V+U*Fe+F*ht+j*oi,m[15]=k*K+U*We+F*er+j*h0,this}multiplyScalar(_){const h=this.elements;return h[0]*=_,h[4]*=_,h[8]*=_,h[12]*=_,h[1]*=_,h[5]*=_,h[9]*=_,h[13]*=_,h[2]*=_,h[6]*=_,h[10]*=_,h[14]*=_,h[3]*=_,h[7]*=_,h[11]*=_,h[15]*=_,this}makeTranslation(_,h,f){return this.set(1,0,0,_,0,1,0,h,0,0,1,f,0,0,0,1),this}snap(_){const h=Math.pow(10,4),f=this.elements;for(let E=0;E<16;E++){const m=Math.round(f[E]);m===Math.round(f[E]*h)/h&&(f[E]=m)}return this}transpose(){const _=this.elements;let h;return h=_[1],_[1]=_[4],_[4]=h,h=_[2],_[2]=_[8],_[8]=h,h=_[6],_[6]=_[9],_[9]=h,h=_[3],_[3]=_[12],_[12]=h,h=_[7],_[7]=_[13],_[13]=h,h=_[11],_[11]=_[14],_[14]=h,this}setPosition(_){const h=this.elements;return h[12]=_.x,h[13]=_.y,h[14]=_.z,this}translate(_){const h=this.elements;return h[12]+=_.x,h[13]+=_.y,h[14]+=_.z,this}getInverse(_,h){const f=this.elements,E=_.elements,m=E[0],S=E[4],w=E[8],v=E[12],A=E[1],M=E[5],T=E[9],R=E[13],P=E[2],L=E[6],O=E[10],I=E[14],N=E[3],k=E[7],U=E[11],F=E[15];f[0]=T*I*k-R*O*k+R*L*U-M*I*U-T*L*F+M*O*F,f[4]=v*O*k-w*I*k-v*L*U+S*I*U+w*L*F-S*O*F,f[8]=w*R*k-v*T*k+v*M*U-S*R*U-w*M*F+S*T*F,f[12]=v*T*L-w*R*L-v*M*O+S*R*O+w*M*I-S*T*I,f[1]=R*O*N-T*I*N-R*P*U+A*I*U+T*P*F-A*O*F,f[5]=w*I*N-v*O*N+v*P*U-m*I*U-w*P*F+m*O*F,f[9]=v*T*N-w*R*N-v*A*U+m*R*U+w*A*F-m*T*F,f[13]=w*R*P-v*T*P+v*A*O-m*R*O-w*A*I+m*T*I,f[2]=M*I*N-R*L*N+R*P*k-A*I*k-M*P*F+A*L*F,f[6]=v*L*N-S*I*N-v*P*k+m*I*k+S*P*F-m*L*F,f[10]=S*R*N-v*M*N+v*A*k-m*R*k-S*A*F+m*M*F,f[14]=v*M*P-S*R*P-v*A*L+m*R*L+S*A*I-m*M*I,f[3]=T*L*N-M*O*N-T*P*k+A*O*k+M*P*U-A*L*U,f[7]=S*O*N-w*L*N+w*P*k-m*O*k-S*P*U+m*L*U,f[11]=w*M*N-S*T*N-w*A*k+m*T*k+S*A*U-m*M*U,f[15]=S*T*P-w*M*P+w*A*L-m*T*L-S*A*O+m*M*O;const j=m*f[0]+A*f[4]+P*f[8]+N*f[12];if(j===0){const H="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(h)throw new Error(H);return console.warn(H),this.identity(),this}return this.multiplyScalar(1/j),this}isReflected(){const _=this.elements,h=_[0],f=_[4],E=_[8],m=_[1],S=_[5],w=_[9],v=_[2],A=_[6],M=_[10];return h*S*M+m*A*E+v*f*w-v*S*E-m*f*M-h*A*w<0}scale(_){const h=this.elements,{x:f}=_,{y:E}=_,{z:m}=_;return h[0]*=f,h[4]*=E,h[8]*=m,h[1]*=f,h[5]*=E,h[9]*=m,h[2]*=f,h[6]*=E,h[10]*=m,h[3]*=f,h[7]*=E,h[11]*=m,this}getMaxScaleOnAxis(){const _=this.elements,h=_[0]*_[0]+_[1]*_[1]+_[2]*_[2],f=_[4]*_[4]+_[5]*_[5]+_[6]*_[6],E=_[8]*_[8]+_[9]*_[9]+_[10]*_[10];return Math.sqrt(Math.max(h,Math.max(f,E)))}makeFrustum(_,h,f,E,m,S){const w=this.elements,v=2*m/(h-_),A=2*m/(E-f),M=(h+_)/(h-_),T=(E+f)/(E-f),R=-(S+m)/(S-m),P=-2*S*m/(S-m);return w[0]=v,w[4]=0,w[8]=M,w[12]=0,w[1]=0,w[5]=A,w[9]=T,w[13]=0,w[2]=0,w[6]=0,w[10]=R,w[14]=P,w[3]=0,w[7]=0,w[11]=-1,w[15]=0,this}makePerspective(_,h,f,E){const m=f*Math.tan((0,n.degToRad)(_*.5)),S=-m,w=S*h,v=m*h;return this.makeFrustum(w,v,S,m,f,E)}makeOrthographic(_,h,f,E,m,S){const w=this.elements,v=1/(h-_),A=1/(f-E),M=1/(S-m),T=(h+_)*v,R=(f+E)*A,P=(S+m)*M;return w[0]=2*v,w[4]=0,w[8]=0,w[12]=-T,w[1]=0,w[5]=2*A,w[9]=0,w[13]=-R,w[2]=0,w[6]=0,w[10]=-2*M,w[14]=-P,w[3]=0,w[7]=0,w[11]=0,w[15]=1,this}isEqual(_){const h=_.elements,f=this.elements;return f[0]===h[0]&&f[4]===h[4]&&f[8]===h[8]&&f[12]===h[12]&&f[1]===h[1]&&f[5]===h[5]&&f[9]===h[9]&&f[13]===h[13]&&f[2]===h[2]&&f[6]===h[6]&&f[10]===h[10]&&f[14]===h[14]&&f[3]===h[3]&&f[7]===h[7]&&f[11]===h[11]&&f[15]===h[15]}clone(){const _=this.elements;return new u(_[0],_[4],_[8],_[12],_[1],_[5],_[9],_[13],_[2],_[6],_[10],_[14],_[3],_[7],_[11],_[15])}isIdentity(){const _=this.elements;return _[0]===1&&_[4]===0&&_[8]===0&&_[12]===0&&_[1]===0&&_[5]===1&&_[9]===0&&_[13]===0&&_[2]===0&&_[6]===0&&_[10]===1&&_[14]===0&&_[3]===0&&_[7]===0&&_[11]===0&&_[15]===1}isNearlyIdentity(_){return this.clone().snap(_).isIdentity()}getScale(_){const h=this.elements;return _=_||new g,a.set(h[0],h[1],h[2]),l.set(h[4],h[5],h[6]),d.set(h[8],h[9],h[10]),_.x=a.length(),_.y=l.length(),_.z=d.length(),_}lookAt(_,h,f){const E=this.elements;return d.subVectors(_,h).normalize(),d.length()===0&&(d.z=1),a.crossVectors(f,d).normalize(),a.length()===0&&(d.x+=1e-4,a.crossVectors(f,d).normalize()),l.crossVectors(d,a),E[0]=a.x,E[4]=l.x,E[8]=d.x,E[1]=a.y,E[5]=l.y,E[9]=d.y,E[2]=a.z,E[6]=l.z,E[10]=d.z,this}compose(_,h,f){const E=this.elements;return s.identity(),s.setRotationFromQuaternion(h),o.makeScale(f.x,f.y,f.z),this.multiplyMatrices(s,o),E[12]=_.x,E[13]=_.y,E[14]=_.z,this}}s=new u,o=new u;class g{constructor(_,h,f){this.x=_||0,this.y=h||0,this.z=f||0,this.atomid=void 0}set(_,h,f){return this.x=_,this.y=h,this.z=f,this}copy(_){return this.x=_.x,this.y=_.y,this.z=_.z,this}add(_){return this.x+=_.x,this.y+=_.y,this.z+=_.z,this}addVectors(_,h){return this.x=_.x+h.x,this.y=_.y+h.y,this.z=_.z+h.z,this}multiplyVectors(_,h){return this.x=_.x*h.x,this.y=_.y*h.y,this.z=_.z*h.z,this}sub(_){return this.x-=_.x,this.y-=_.y,this.z-=_.z,this}subVectors(_,h){return this.x=_.x-h.x,this.y=_.y-h.y,this.z=_.z-h.z,this}multiplyScalar(_){return this.x*=_,this.y*=_,this.z*=_,this}divideScalar(_){return _!==0?(this.x/=_,this.y/=_,this.z/=_):(this.x=0,this.y=0,this.z=0),this}max(_){return this.x=Math.max(this.x,_.x),this.y=Math.max(this.y,_.y),this.z=Math.max(this.z,_.z),this}min(_){return this.x=Math.min(this.x,_.x),this.y=Math.min(this.y,_.y),this.z=Math.min(this.z,_.z),this}distanceTo(_){return Math.sqrt(this.distanceToSquared(_))}distanceToSquared(_){const h=this.x-_.x,f=this.y-_.y,E=this.z-_.z;return h*h+f*f+E*E}applyMatrix3(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.elements;return this.x=m[0]*h+m[3]*f+m[6]*E,this.y=m[1]*h+m[4]*f+m[7]*E,this.z=m[2]*h+m[5]*f+m[8]*E,this}applyMatrix4(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.elements;return this.x=m[0]*h+m[4]*f+m[8]*E+m[12],this.y=m[1]*h+m[5]*f+m[9]*E+m[13],this.z=m[2]*h+m[6]*f+m[10]*E+m[14],this}applyProjection(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.elements,S=m[3]*h+m[7]*f+m[11]*E+m[15];return this.x=(m[0]*h+m[4]*f+m[8]*E+m[12])/S,this.y=(m[1]*h+m[5]*f+m[9]*E+m[13])/S,this.z=(m[2]*h+m[6]*f+m[10]*E+m[14])/S,this}applyQuaternion(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.x,S=_.y,w=_.z,v=_.w,A={};A.x=2*(f*w-E*S),A.y=2*(E*m-h*w),A.z=2*(h*S-f*m);const M={};return M.x=A.y*w-A.z*S,M.y=A.z*m-A.x*w,M.z=A.x*S-A.y*m,this.x=h+v*A.x+M.x,this.y=f+v*A.y+M.y,this.z=E+v*A.z+M.z,this}negate(){return this.multiplyScalar(-1)}dot(_){return this.x*_.x+this.y*_.y+this.z*_.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalize(){return this.divideScalar(this.length())}cross(_){const{x:h}=this,{y:f}=this,{z:E}=this;return this.x=f*_.z-E*_.y,this.y=E*_.x-h*_.z,this.z=h*_.y-f*_.x,this}crossVectors(_,h){return this.x=_.y*h.z-_.z*h.y,this.y=_.z*h.x-_.x*h.z,this.z=_.x*h.y-_.y*h.x,this}equals(_){return this.x==_.x&&this.y==_.y&&this.z==_.z}getPositionFromMatrix(_){return this.x=_.elements[12],this.y=_.elements[13],this.z=_.elements[14],this}setEulerFromRotationMatrix(_,h){const f=_.elements,E=f[0],m=f[4],S=f[8],w=f[5],v=f[9],A=f[6],M=f[10];return h===void 0||h==="XYZ"?(this.y=Math.asin((0,i.clamp)(S,-1,1)),Math.abs(S)<.99999?(this.x=Math.atan2(-v,M),this.z=Math.atan2(-m,E)):(this.x=Math.atan2(A,w),this.z=0)):console.error(`Error with vector's setEulerFromRotationMatrix: Unknown order: ${h}`),this}rotateAboutVector(_,h){_.normalize();const f=Math.cos(h),E=Math.sin(h),m=this.clone().multiplyScalar(f),S=_.clone().cross(this).multiplyScalar(E),w=_.clone().multiplyScalar(_.clone().dot(this)).multiplyScalar(1-f),v=m.add(S).add(w);return this.x=v.x,this.y=v.y,this.z=v.z,this}setFromMatrixPosition(_){const h=_.elements;return this.x=h[12],this.y=h[13],this.z=h[14],this}transformDirection(_){const{x:h}=this,{y:f}=this,{z:E}=this,m=_.elements;return this.x=m[0]*h+m[4]*f+m[8]*E,this.y=m[1]*h+m[5]*f+m[9]*E,this.z=m[2]*h+m[6]*f+m[10]*E,this.normalize()}clone(){return new g(this.x,this.y,this.z)}unproject(_){const h=s;return h.multiplyMatrices(_.matrixWorld,h.getInverse(_.projectionMatrix)),this.applyMatrix4(h)}}a=new g,l=new g,d=new g;class x{constructor(_=1,h=0,f=0,E=0,m=1,S=0,w=0,v=0,A=1){this.elements=new Float32Array(9),this.set(_,h,f,E,m,S,w,v,A)}set(_,h,f,E,m,S,w,v,A){const M=this.elements;return M[0]=_,M[3]=h,M[6]=f,M[1]=E,M[4]=m,M[7]=S,M[2]=w,M[5]=v,M[8]=A,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(_){const h=_.elements;this.set(h[0],h[3],h[6],h[1],h[4],h[7],h[2],h[5],h[8])}multiplyScalar(_){const h=this.elements;return h[0]*=_,h[3]*=_,h[6]*=_,h[1]*=_,h[4]*=_,h[7]*=_,h[2]*=_,h[5]*=_,h[8]*=_,this}getInverse3(_){const h=_.elements,f=this.elements;f[0]=h[4]*h[8]-h[5]*h[7],f[3]=h[6]*h[5]-h[3]*h[8],f[6]=h[3]*h[7]-h[6]*h[4],f[1]=h[7]*h[2]-h[1]*h[8],f[4]=h[0]*h[8]-h[6]*h[2],f[7]=h[1]*h[6]-h[0]*h[7],f[2]=h[1]*h[5]-h[2]*h[4],f[5]=h[2]*h[3]-h[0]*h[5],f[8]=h[0]*h[4]-h[1]*h[3];const E=h[0]*f[0]+h[3]*f[1]+h[6]*f[2];return this.multiplyScalar(1/E),this}getInverse(_,h){const f=_.elements,E=this.elements;E[0]=f[10]*f[5]-f[6]*f[9],E[1]=-f[10]*f[1]+f[2]*f[9],E[2]=f[6]*f[1]-f[2]*f[5],E[3]=-f[10]*f[4]+f[6]*f[8],E[4]=f[10]*f[0]-f[2]*f[8],E[5]=-f[6]*f[0]+f[2]*f[4],E[6]=f[9]*f[4]-f[5]*f[8],E[7]=-f[9]*f[0]+f[1]*f[8],E[8]=f[5]*f[0]-f[1]*f[4];const m=f[0]*E[0]+f[1]*E[3]+f[2]*E[6];if(m===0){const S="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(h)throw new Error(S);return console.warn(S),this.identity(),this}return this.multiplyScalar(1/m),this}getDeterminant(){const _=this.elements;return _[0]*_[4]*_[8]+_[1]*_[5]*_[6]+_[2]*_[3]*_[7]-_[2]*_[4]*_[6]-_[1]*_[3]*_[8]-_[0]*_[5]*_[7]}transpose(){let _;const h=this.elements;return _=h[1],h[1]=h[3],h[3]=_,_=h[2],h[2]=h[6],h[6]=_,_=h[5],h[5]=h[7],h[7]=_,this}clone(){const _=this.elements;return new x(_[0],_[3],_[6],_[1],_[4],_[7],_[2],_[5],_[8])}getMatrix4(){const _=this.elements;return new u(_[0],_[3],_[6],0,_[1],_[4],_[7],0,_[2],_[5],_[8],0)}}class y{constructor(_,h){this.origin=_!==void 0?_:new g,this.direction=h!==void 0?h:new g}set(_,h){return this.origin.copy(_),this.direction.copy(h),this}copy(_){return this.origin.copy(_.origin),this.direction.copy(_.direction),this}at(_,h){return(h||new g).copy(this.direction).multiplyScalar(_).add(this.origin)}recast(_){const h=a;return this.origin.copy(this.at(_,h)),this}closestPointToPoint(_,h){const f=h||new g;f.subVectors(_,this.origin);const E=f.dot(this.direction);return f.copy(this.direction).multiplyScalar(E).add(this.origin)}distanceToPoint(_){const h=a,f=h.subVectors(_,this.origin).dot(this.direction);return h.copy(this.direction).multiplyScalar(f).add(this.origin),h.distanceTo(_)}isIntersectionCylinder(){}isIntersectionSphere(_){return this.distanceToPoint(_.center)<=_.radius}isIntersectionPlane(_){return _.normal.dot(this.direction)!==0||_.distanceToPoint(this.origin)===0}distanceToPlane(_){const h=_.normal.dot(this.direction);return h===0?_.distanceToPoint(this.origin)===0?0:void 0:-(this.origin.dot(_.normal)+_.constant)/h}intersectPlane(_,h){const f=this.distanceToPlane(_);if(f!==void 0)return this.at(f,h)}applyMatrix4(_){return this.direction.add(this.origin).applyMatrix4(_),this.origin.applyMatrix4(_),this.direction.sub(this.origin),this}clone(){return new y().copy(this)}}}),"./src/WebGL/math/utils/clamp.ts":((r,e,t)=>{t.r(e),t.d(e,{clamp:()=>n});function n(i,s,o){return Math.min(Math.max(i,s),o)}}),"./src/WebGL/math/utils/conversionMatrix3.ts":((r,e,t)=>{t.r(e),t.d(e,{conversionMatrix3:()=>i});var n=t("./src/WebGL/math/math.ts");function i(s,o,a,l,d,u){l=l*Math.PI/180,d=d*Math.PI/180,u=u*Math.PI/180;const g=f=>f*f,x=Math.cos(l),y=Math.cos(d),b=Math.cos(u),_=Math.sin(u);return new n.Matrix3(s,o*b,a*y,0,o*_,a*(x-y*b)/_,0,0,a*Math.sqrt(1-g(x)-g(y)-g(b)+2*x*y*b)/_)}}),"./src/WebGL/math/utils/degToRad.ts":((r,e,t)=>{t.r(e),t.d(e,{degToRad:()=>i});const n=Math.PI/180;function i(s){return s*n}}),"./src/WebGL/objects/Line.ts":((r,e,t)=>{t.r(e),t.d(e,{Line:()=>o,LineStyle:()=>s});var n=t("./src/WebGL/materials/index.ts"),i=t("./src/WebGL/core/index.ts"),s;(function(a){a[a.LineStrip=0]="LineStrip",a[a.LinePieces=1]="LinePieces"})(s||(s={}));class o extends i.Object3D{constructor(l,d=new n.LineBasicMaterial({color:Math.random()*16777215}),u=s.LineStrip){super(),this.geometry=l,this.material=d,this.type=u}clone(l=new o(this.geometry,this.material,this.type)){return super.clone.call(this,l),l}}}),"./src/WebGL/objects/Mesh.ts":((r,e,t)=>{t.r(e),t.d(e,{Mesh:()=>i});var n=t("./src/WebGL/core/index.ts");class i extends n.Object3D{constructor(o,a){super(),this.geometry=o,this.material=a}clone(o){return o===void 0&&(o=new i(this.geometry,this.material)),super.clone.call(this,o),o}}}),"./src/WebGL/objects/Sprite.ts":((r,e,t)=>{t.r(e),t.d(e,{Sprite:()=>s});var n=t("./src/WebGL/materials/index.ts"),i=t("./src/WebGL/core/index.ts");class s extends i.Object3D{constructor(a=new n.SpriteMaterial){super(),this.material=a,this.rotation3d=this.rotation,this.rotation=0}updateMatrix(){this.matrix.setPosition(this.position),this.rotation3d.set(0,0,this.rotation),this.matrix.setRotationFromEuler(this.rotation3d),(this.scale.x!==1||this.scale.y!==1)&&this.matrix.scale(this.scale),this.matrixWorldNeedsUpdate=!0}clone(a=new s(this.material)){return i.Object3D.prototype.clone.call(this,a),a}}}),"./src/WebGL/objects/index.ts":((r,e,t)=>{t.r(e),t.d(e,{Line:()=>n.Line,LineStyle:()=>n.LineStyle,Mesh:()=>i.Mesh,Sprite:()=>s.Sprite});var n=t("./src/WebGL/objects/Line.ts"),i=t("./src/WebGL/objects/Mesh.ts"),s=t("./src/WebGL/objects/Sprite.ts")}),"./src/WebGL/shaders/ShaderType.ts":((r,e,t)=>{t.r(e)}),"./src/WebGL/shaders/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ShaderLib:()=>n.ShaderLib,ShaderUtils:()=>i.ShaderUtils,basic:()=>n.basic,clone:()=>i.clone,instanced:()=>n.instanced,lambert:()=>n.lambert,lambertdouble:()=>n.lambertdouble,outline:()=>n.outline,screen:()=>n.screen,screenaa:()=>n.screenaa,sphereimposter:()=>n.sphereimposter,sphereimposteroutline:()=>n.sphereimposteroutline,sprite:()=>n.sprite,stickimposter:()=>n.stickimposter,stickimposteroutline:()=>n.stickimposteroutline,volumetric:()=>n.volumetric});var n=t("./src/WebGL/shaders/lib/index.ts"),i=t("./src/WebGL/shaders/utils/index.ts");t("./src/WebGL/shaders/ShaderType.ts")}),"./src/WebGL/shaders/lib/basic/basic.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
varying vec3 vColor;
varying vec4 mvPosition;

//DEFINEFRAGCOLOR
void main() {
    gl_FragColor = vec4( vColor, opacity );
    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`}),"./src/WebGL/shaders/lib/basic/basic.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;

attribute vec3 position;
attribute vec3 color;

varying vec3 vColor;
varying vec4 mvPosition;

void main() {

    vColor = color;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix * mvPosition;

}`}),"./src/WebGL/shaders/lib/basic/index.ts":((r,e,t)=>{t.r(e),t.d(e,{basic:()=>o});var n=t("./src/WebGL/shaders/lib/basic/uniforms.ts"),i=t("./src/WebGL/shaders/lib/basic/basic.frag"),s=t("./src/WebGL/shaders/lib/basic/basic.vert");const o={vertexShader:s.default.replace("#define GLSLIFY 1",""),fragmentShader:i.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/basic/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3}}}),"./src/WebGL/shaders/lib/blur/blur.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`const float INV_TOTAL_SAMPLES_FACTOR = 1.0 / 9.0;
uniform highp sampler2D inTex;
varying highp vec2 vTexCoords;
    
void main() {
 
 vec2 texelSize = 1.0 / vec2(textureSize(inTex,0));
 float blurred_visibility_factor = 0.0f;
 for (int t = -1; t <= 1; ++t) {
  for (int s = -1; s <= 1; ++s) {
   vec2 offset = vec2(float(s), float(t)) * texelSize;
   blurred_visibility_factor += texture2D(inTex, vTexCoords + offset).r;
  }
 }
    
 gl_FragDepthEXT = blurred_visibility_factor * INV_TOTAL_SAMPLES_FACTOR;
 
}`}),"./src/WebGL/shaders/lib/blur/blur.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `}),"./src/WebGL/shaders/lib/blur/index.ts":((r,e,t)=>{t.r(e),t.d(e,{blur:()=>o});var n=t("./src/WebGL/shaders/lib/blur/uniforms.ts"),i=t("./src/WebGL/shaders/lib/blur/blur.frag"),s=t("./src/WebGL/shaders/lib/blur/blur.vert");const o={fragmentShader:i.default,vertexShader:s.default,uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/blur/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={}}),"./src/WebGL/shaders/lib/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ShaderLib:()=>E,basic:()=>n.basic,instanced:()=>i.instanced,lambert:()=>s.lambert,lambertdouble:()=>o.lambertdouble,outline:()=>a.outline,screen:()=>l.screen,screenaa:()=>d.screenaa,sphereimposter:()=>u.sphereimposter,sphereimposteroutline:()=>g.sphereimposteroutline,sprite:()=>x.sprite,stickimposter:()=>y.stickimposter,stickimposteroutline:()=>b.stickimposteroutline,volumetric:()=>_.volumetric});var n=t("./src/WebGL/shaders/lib/basic/index.ts"),i=t("./src/WebGL/shaders/lib/instanced/index.ts"),s=t("./src/WebGL/shaders/lib/lambert/index.ts"),o=t("./src/WebGL/shaders/lib/lambertdouble/index.ts"),a=t("./src/WebGL/shaders/lib/outline/index.ts"),l=t("./src/WebGL/shaders/lib/screen/index.ts"),d=t("./src/WebGL/shaders/lib/screenaa/index.ts"),u=t("./src/WebGL/shaders/lib/sphereimposter/index.ts"),g=t("./src/WebGL/shaders/lib/sphereimposteroutline/index.ts"),x=t("./src/WebGL/shaders/lib/sprite/index.ts"),y=t("./src/WebGL/shaders/lib/stickimposter/index.ts"),b=t("./src/WebGL/shaders/lib/stickimposteroutline/index.ts"),_=t("./src/WebGL/shaders/lib/volumetric/index.ts"),h=t("./src/WebGL/shaders/lib/ssao/index.ts"),f=t("./src/WebGL/shaders/lib/blur/index.ts");const E={basic:n.basic,blur:f.blur,instanced:i.instanced,lambert:s.lambert,lambertdouble:o.lambertdouble,outline:a.outline,screen:l.screen,screenaa:d.screenaa,ssao:h.ssao,sphereimposter:u.sphereimposter,sphereimposteroutline:g.sphereimposteroutline,sprite:x.sprite,stickimposter:y.stickimposter,stickimposteroutline:b.stickimposteroutline,volumetric:_.volumetric}}),"./src/WebGL/shaders/lib/instanced/index.ts":((r,e,t)=>{t.r(e),t.d(e,{instanced:()=>o});var n=t("./src/WebGL/shaders/lib/instanced/uniforms.ts"),i=t("./src/WebGL/shaders/lib/instanced/instanced.frag"),s=t("./src/WebGL/shaders/lib/instanced/instanced.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/instanced/instanced.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif

#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );
    float depth = gl_FragCoord.z / gl_FragCoord.w;

    float fogFactor = smoothstep( fogNear, fogFar, depth );

    gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );

}


`}),"./src/WebGL/shaders/lib/instanced/instanced.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 offset;
attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLightFront;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    vec4 mvPosition = modelViewMatrix * vec4( position * radius + offset, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}

`}),"./src/WebGL/shaders/lib/instanced/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/lambert/index.ts":((r,e,t)=>{t.r(e),t.d(e,{lambert:()=>o});var n=t("./src/WebGL/shaders/lib/lambert/uniforms.ts"),i=t("./src/WebGL/shaders/lib/lambert/lambert.frag"),s=t("./src/WebGL/shaders/lib/lambert/lambert.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/lambert/lambert.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
#ifdef SHADED
uniform highp sampler2D shading;
#endif
varying vec3 vLightFront;
varying vec3 vColor;
varying vec4 mvPosition;


//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    gl_FragColor.xyz *= vLightFront;
    #endif
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    vColor *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( vColor, opacity );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }

}`}),"./src/WebGL/shaders/lib/lambert/lambert.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec4 mvPosition;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;

    gl_Position = projectionMatrix * mvPosition;
}`}),"./src/WebGL/shaders/lib/lambert/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/lambertdouble/index.ts":((r,e,t)=>{t.r(e),t.d(e,{lambertdouble:()=>o});var n=t("./src/WebGL/shaders/lib/lambertdouble/uniforms.ts"),i=t("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag"),s=t("./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
#ifdef SHADED
uniform highp sampler2D shading;
#endif

uniform mat4 viewMatrix;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLightFront;
varying vec3 vLightBack;

varying vec3 vColor;
varying vec4 mvPosition;

//DEFINEFRAGCOLOR

void main() {

    gl_FragColor = vec4( vec3 ( 1.0 ), opacity );

    #ifndef WIREFRAME
    if ( gl_FrontFacing )
       gl_FragColor.xyz *= vLightFront;
    else
       gl_FragColor.xyz *= vLightBack;
    #endif

    vec3 color = vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif
    gl_FragColor = gl_FragColor * vec4( color, opacity );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }

}


`}),"./src/WebGL/shaders/lib/lambertdouble/lambertdouble.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec3 vColor;
varying vec3 vLightFront;
varying vec3 vLightBack;
varying vec4 mvPosition;

void main() {

    vColor = color;

    vec3 objectNormal = normal;
    vec3 transformedNormal = normalMatrix * objectNormal;
    mvPosition = modelViewMatrix * vec4( position, 1.0 );

    vLightFront = vec3( 0.0 );
    vLightBack = vec3( 0.0 );

    transformedNormal = normalize( transformedNormal );

    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vec3 dirVector = normalize( lDirection.xyz );
    float dotProduct = dot( transformedNormal, dirVector );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );

    vLightFront += directionalLightColor[ 0 ] * directionalLightWeighting;
    vLightBack += directionalLightColor[ 0 ] * directionalLightWeightingBack;

    gl_Position = projectionMatrix * mvPosition;
}

`}),"./src/WebGL/shaders/lib/lambertdouble/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/outline/index.ts":((r,e,t)=>{t.r(e),t.d(e,{outline:()=>o});var n=t("./src/WebGL/shaders/lib/outline/uniforms.ts"),i=t("./src/WebGL/shaders/lib/outline/outline.frag"),s=t("./src/WebGL/shaders/lib/outline/outline.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/outline/outline.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec4 mvPosition;
//DEFINEFRAGCOLOR

void main() {
    gl_FragColor = vec4( outlineColor, 1 );

    if(fogNear != fogFar) {
        float depth = -mvPosition.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}


`}),"./src/WebGL/shaders/lib/outline/outline.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float vWidth;
uniform float vHeight;
uniform float outlineMaxPixels;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec4 mvPosition;

void main() {

    vec4 norm = modelViewMatrix*vec4(normalize(normal),0.0);
    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    mvPosition.xy += norm.xy*outlineWidth;
    vec4 outpos = projectionMatrix * mvPosition;

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*modelViewMatrix * vec4( position, 1.0 );
        float w = outpos.w;
        //normalize homogeneous coords
        unadjusted /= unadjusted.w;
        outpos /= outpos.w;
        vec2 diff = outpos.xy-unadjusted.xy;
        //put into pixels
        diff.x *= vWidth;
        diff.y *= vHeight;
        if ( length(diff) > outlineMaxPixels) {
            vec2 ndiff = normalize(diff)*outlineMaxPixels;
            ndiff.x /= vWidth;
            ndiff.y /= vHeight;
            outpos.xy = unadjusted.xy;
            outpos.xy += ndiff;
        }
        outpos *= w; //if I don't do this things blow up
    }
    gl_Position = outpos;
    mvPosition.z -= outlinePushback; //go backwards in model space
    vec4 pushpos = projectionMatrix*mvPosition; //project to get z in projection space, I'm probably missing some simple math to do the same thing..
    gl_Position.z = gl_Position.w*pushpos.z/pushpos.w;
}

`}),"./src/WebGL/shaders/lib/outline/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new n.Color(0,0,0)},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}}),"./src/WebGL/shaders/lib/screen/index.ts":((r,e,t)=>{t.r(e),t.d(e,{screen:()=>o});var n=t("./src/WebGL/shaders/lib/screen/uniforms.ts"),i=t("./src/WebGL/shaders/lib/screen/screen.frag"),s=t("./src/WebGL/shaders/lib/screen/screen.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/screen/screen.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform sampler2D colormap;
varying highp vec2 vTexCoords;
uniform vec2 dimensions;
//DEFINEFRAGCOLOR
void main (void) {
   gl_FragColor = texture2D(colormap, vTexCoords);

   //gl_FragColor.g = gl_FragColor.b =  gl_FragColor.r; //debug shading 
}
        `}),"./src/WebGL/shaders/lib/screen/screen.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `}),"./src/WebGL/shaders/lib/screen/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={}}),"./src/WebGL/shaders/lib/screenaa/index.ts":((r,e,t)=>{t.r(e),t.d(e,{screenaa:()=>o});var n=t("./src/WebGL/shaders/lib/screenaa/uniforms.ts"),i=t("./src/WebGL/shaders/lib/screenaa/screenaa.frag"),s=t("./src/WebGL/shaders/lib/screenaa/screenaa.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/screenaa/screenaa.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
        
precision highp float;
precision highp int;
precision highp sampler2D;

uniform sampler2D tColor;
varying highp vec2 vTexCoords;

// adapted from https://github.com/kosua20/Rendu
// MIT License Copyright (c) 2017 Simon Rodriguez
// by way of molstar (https://github.com/molstar/molstar/blob/master/src/mol-gl/shader/fxaa.frag.ts)

#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))

float rgb2luma(vec3 rgb){
    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));
}

float sampleLuma(vec2 uv) {
    return rgb2luma(texture2D(tColor, uv).rgb);
}

float sampleLuma(vec2 uv, float uOffset, float vOffset) {
    uv += vec2(uOffset, vOffset);
    return sampleLuma(uv);
}

//DEFINEFRAGCOLOR
void main(void) {
    ivec2 dim = textureSize(tColor,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseScreenSize = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec2 coords = vTexCoords;

    vec4 colorCenter = texture2D(tColor, coords);
    float dEdgeThresholdMin = 0.0312;
    float dEdgeThresholdMax = 0.125;
    int dIterations = 12;
    float dSubpixelQuality = 0.3;

    // Luma at the current fragment
    float lumaCenter = rgb2luma(colorCenter.rgb);

    // Luma at the four direct neighbours of the current fragment.
    float lumaDown = sampleLuma(coords, 0.0, -inverseScreenSize.y);
    float lumaUp = sampleLuma(coords, 0.0, inverseScreenSize.y);
    float lumaLeft = sampleLuma(coords, -inverseScreenSize.x, 0.0);
    float lumaRight = sampleLuma(coords, inverseScreenSize.x, 0.0);

    // Find the maximum and minimum luma around the current fragment.
    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));
    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));

    // Compute the delta.
    float lumaRange = lumaMax - lumaMin;

    // If the luma variation is lower that a threshold (or if we are in a really dark area),
    // we are not on an edge, don't perform any AA.
    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {
        gl_FragColor = colorCenter;
        return;
    }

    // Query the 4 remaining corners lumas.
    float lumaDownLeft = sampleLuma(coords, -inverseScreenSize.x, -inverseScreenSize.y);
    float lumaUpRight = sampleLuma(coords, inverseScreenSize.x, inverseScreenSize.y);
    float lumaUpLeft = sampleLuma(coords, -inverseScreenSize.x, inverseScreenSize.y);
    float lumaDownRight = sampleLuma(coords, inverseScreenSize.x, -inverseScreenSize.y);

    // Combine the four edges lumas (using intermediary variables for future computations
    // with the same values).
    float lumaDownUp = lumaDown + lumaUp;
    float lumaLeftRight = lumaLeft + lumaRight;

    // Same for corners
    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;
    float lumaDownCorners = lumaDownLeft + lumaDownRight;
    float lumaRightCorners = lumaDownRight + lumaUpRight;
    float lumaUpCorners = lumaUpRight + lumaUpLeft;

    // Compute an estimation of the gradient along the horizontal and vertical axis.
    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);
    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);

    // Is the local edge horizontal or vertical ?
    bool isHorizontal = (edgeHorizontal >= edgeVertical);

    // Choose the step size (one pixel) accordingly.
    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;

    // Select the two neighboring texels lumas in the opposite direction to the local edge.
    float luma1 = isHorizontal ? lumaDown : lumaLeft;
    float luma2 = isHorizontal ? lumaUp : lumaRight;
    // Compute gradients in this direction.
    float gradient1 = luma1 - lumaCenter;
    float gradient2 = luma2 - lumaCenter;

    // Which direction is the steepest ?
    bool is1Steepest = abs(gradient1) >= abs(gradient2);

    // Gradient in the corresponding direction, normalized.
    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));

    // Average luma in the correct direction.
    float lumaLocalAverage = 0.0;
    if(is1Steepest){
        // Switch the direction
        stepLength = -stepLength;
        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);
    } else {
        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);
    }

    // Shift UV in the correct direction by half a pixel.
    vec2 currentUv = coords;
    if(isHorizontal){
        currentUv.y += stepLength * 0.5;
    } else {
        currentUv.x += stepLength * 0.5;
    }

    // Compute offset (for each iteration step) in the right direction.
    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);
    // Compute UVs to explore on each side of the edge, orthogonally.
    // The QUALITY allows us to step faster.
    vec2 uv1 = currentUv - offset * QUALITY(0);
    vec2 uv2 = currentUv + offset * QUALITY(0);

    // Read the lumas at both current extremities of the exploration segment,
    // and compute the delta wrt to the local average luma.
    float lumaEnd1 = sampleLuma(uv1);
    float lumaEnd2 = sampleLuma(uv2);
    lumaEnd1 -= lumaLocalAverage;
    lumaEnd2 -= lumaLocalAverage;

    // If the luma deltas at the current extremities is larger than the local gradient,
    // we have reached the side of the edge.
    bool reached1 = abs(lumaEnd1) >= gradientScaled;
    bool reached2 = abs(lumaEnd2) >= gradientScaled;
    bool reachedBoth = reached1 && reached2;

    // If the side is not reached, we continue to explore in this direction.
    if(!reached1){
        uv1 -= offset * QUALITY(1);
    }
    if(!reached2){
        uv2 += offset * QUALITY(1);
    }

    // If both sides have not been reached, continue to explore.
    if(!reachedBoth){
        for(int i = 2; i < dIterations; i++){
            // If needed, read luma in 1st direction, compute delta.
            if(!reached1){
                lumaEnd1 = sampleLuma(uv1);
                lumaEnd1 = lumaEnd1 - lumaLocalAverage;
            }
            // If needed, read luma in opposite direction, compute delta.
            if(!reached2){
                lumaEnd2 = sampleLuma(uv2);
                lumaEnd2 = lumaEnd2 - lumaLocalAverage;
            }
            // If the luma deltas at the current extremities is larger than the local gradient,
            // we have reached the side of the edge.
            reached1 = abs(lumaEnd1) >= gradientScaled;
            reached2 = abs(lumaEnd2) >= gradientScaled;
            reachedBoth = reached1 && reached2;

            // If the side is not reached, we continue to explore in this direction,
            // with a variable quality.
            if(!reached1){
                uv1 -= offset * QUALITY(i);
            }
            if(!reached2){
                uv2 += offset * QUALITY(i);
            }

            // If both sides have been reached, stop the exploration.
            if(reachedBoth){
                break;
            }
        }
    }

    // Compute the distances to each side edge of the edge (!).
    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);
    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);

    // In which direction is the side of the edge closer ?
    bool isDirection1 = distance1 < distance2;
    float distanceFinal = min(distance1, distance2);

    // Thickness of the edge.
    float edgeThickness = (distance1 + distance2);

    // Is the luma at center smaller than the local average ?
    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;

    // If the luma at center is smaller than at its neighbour,
    // the delta luma at each end should be positive (same variation).
    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;
    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;

    // Only keep the result in the direction of the closer side of the edge.
    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;

    // UV offset: read in the direction of the closest side of the edge.
    float pixelOffset = - distanceFinal / edgeThickness + 0.5;

    // If the luma variation is incorrect, do not offset.
    float finalOffset = correctVariation ? pixelOffset : 0.0;

    // Sub-pixel shifting
    // Full weighted average of the luma over the 3x3 neighborhood.
    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);
    // Ratio of the delta between the global average and the center luma,
    // over the luma range in the 3x3 neighborhood.
    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);
    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;
    // Compute a sub-pixel offset based on this delta.
    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);

    // Pick the biggest of the two offsets.
    finalOffset = max(finalOffset, subPixelOffsetFinal);

    // Compute the final UV coordinates.
    vec2 finalUv = coords;
    if(isHorizontal){
        finalUv.y += finalOffset * stepLength;
    } else {
        finalUv.x += finalOffset * stepLength;
    }

    // Read the color at the new UV coordinates, and use it.
    gl_FragColor = texture2D(tColor, finalUv);
}        

/* old fxaa implementation
uniform highp sampler2D colormap;
varying highp vec2 vTexCoords;


// Basic FXAA implementation based on the code on geeks3d.com 
#define FXAA_REDUCE_MIN (1.0/ 128.0)
#define FXAA_REDUCE_MUL (1.0 / 8.0)
#define FXAA_SPAN_MAX 8.0


vec4 applyFXAA(vec2 fragCoord, highp sampler2D tex)
{
    vec4 color;
    ivec2 dim = textureSize(tex,0);
    vec2 dimensions = vec2(float(dim.x),float(dim.y));
    vec2 inverseVP = vec2(1.0 / dimensions.x, 1.0 / dimensions.y);
    vec4 rgbNW = texture2D(tex, fragCoord + vec2(-1.0, -1.0) * inverseVP);
    vec4 rgbNE = texture2D(tex, fragCoord + vec2(1.0, -1.0) * inverseVP);
    vec4 rgbSW = texture2D(tex, fragCoord + vec2(-1.0, 1.0) * inverseVP);
    vec4 rgbSE = texture2D(tex, fragCoord + vec2(1.0, 1.0) * inverseVP);
    vec4 rgbM  = texture2D(tex, fragCoord );
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW.xyz, luma);
    float lumaNE = dot(rgbNE.xyz, luma);
    float lumaSW = dot(rgbSW.xyz, luma);
    float lumaSE = dot(rgbSE.xyz, luma);
    float lumaM  = dot(rgbM.xyz,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                        (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
            max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
            dir * rcpDirMin)) * inverseVP;

    vec4 rgbA = 0.5 * (
        texture2D(tex, fragCoord + dir * (1.0 / 3.0 - 0.5)) +
        texture2D(tex, fragCoord  + dir * (2.0 / 3.0 - 0.5)));
    vec4 rgbB = rgbA * 0.5 + 0.25 * (
        texture2D(tex, fragCoord  + dir * -0.5) +
        texture2D(tex, fragCoord  + dir * 0.5));

    float lumaB = dot(rgbB.xyz, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = rgbA;
    else
        color = rgbB;

    return color;
}


//DEFINEFRAGCOLOR
void main (void) {
    ivec2 dim = textureSize(colormap,0);

  gl_FragColor = applyFXAA(vTexCoords, colormap);
}
        
*/`}),"./src/WebGL/shaders/lib/screenaa/screenaa.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `}),"./src/WebGL/shaders/lib/screenaa/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={}}),"./src/WebGL/shaders/lib/sphereimposter/index.ts":((r,e,t)=>{t.r(e),t.d(e,{sphereimposter:()=>o});var n=t("./src/WebGL/shaders/lib/sphereimposter/uniforms.ts"),i=t("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag"),s=t("./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert");const o={vertexShader:s.default.replace("#define GLSLIFY 1",""),fragmentShader:i.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
uniform mat4 viewMatrix;
uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float uDepth;
uniform vec3 directionalLightColor[ 1 ];

varying vec3 vColor;
varying vec2 mapping;
varying float rval;
varying vec3 vLight;
varying vec3 center;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    vec3 norm = normalize(vec3(mapping.x,mapping.y,z));
    float dotProduct = dot( norm, vLight );
    vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );
    vec3 vLight = directionalLightColor[ 0 ] * directionalLightWeighting;
    vec3 color = vLight*vColor;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );

    if(fogNear != fogFar) {
        float depth = -cameraPos.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
     
}

`}),"./src/WebGL/shaders/lib/sphereimposter/sphereimposter.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying vec3 vColor;
varying float rval;
varying vec3 vLight;
varying vec3 center;

void main() {

    vColor = color;
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec4 adjust = projectionMatrix* vec4(normal,0.0); adjust.z = 0.0; adjust.w = 0.0;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz );
    mapping = normal.xy;
    rval = abs(normal.x);
    gl_Position = projPosition+adjust;

}
`}),"./src/WebGL/shaders/lib/sphereimposter/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/sphereimposteroutline/index.ts":((r,e,t)=>{t.r(e),t.d(e,{sphereimposteroutline:()=>o});var n=t("./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts"),i=t("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag"),s=t("./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform float opacity;
uniform vec3 outlineColor;
uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform mat4 projectionMatrix;
varying vec2 mapping;
varying float rval;
varying vec3 center;

uniform float outlinePushback;

//DEFINEFRAGCOLOR

void main() {
    float lensqr = dot(mapping,mapping);
    float rsqr = rval*rval;
    if(lensqr > rsqr)
       discard;
    float z = sqrt(rsqr-lensqr);
    vec3 cameraPos = center+ vec3(mapping.x,mapping.y,z-outlinePushback);
    vec4 clipPos = projectionMatrix * vec4(cameraPos, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    gl_FragDepthEXT = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragColor = vec4(outlineColor, 1 );

    if(fogNear != fogFar) {
        float depth = -cameraPos.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}


`}),"./src/WebGL/shaders/lib/sphereimposteroutline/sphereimposteroutline.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform float vHeight;

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;

varying vec2 mapping;
varying float rval;
varying vec3 center;

void main() {

    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    center = mvPosition.xyz;
    vec4 projPosition = projectionMatrix * mvPosition;
    vec2 norm = normal.xy + vec2(sign(normal.x)*outlineWidth,sign(normal.y)*outlineWidth);

    vec4 adjust = projectionMatrix* vec4(norm,normal.z,1.0); 
    mapping = norm.xy;
    rval = abs(norm.x);
    gl_Position = projPosition+vec4(adjust.xy,0.0,0.0);

    if(outlineMaxPixels > 0.0) {
        vec4 unadjusted = projectionMatrix*vec4(center.x+normal.x, center.y,center.z,1.0); 
        vec4 ccoord = projectionMatrix*vec4(center.xyz,1.0);
        adjust = projectionMatrix* vec4(center.x+norm.x,center.y,center.z,1.0); 
        //subtract center 
        unadjusted.xyz -= ccoord.xyz;
        adjust.xyz -= ccoord.xyz;
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth;
        if(diff > outlineMaxPixels) {
            
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth;
            //adjsut reval by ratio of lengths
            rval *= fixlen/abs(adjust.x);
        }

    }
}

`}),"./src/WebGL/shaders/lib/sphereimposteroutline/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},outlineColor:{type:"c",value:new n.Color(0,0,0)},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0}}}),"./src/WebGL/shaders/lib/sprite/index.ts":((r,e,t)=>{t.r(e),t.d(e,{sprite:()=>o});var n=t("./src/WebGL/shaders/lib/sprite/uniforms.ts"),i=t("./src/WebGL/shaders/lib/sprite/sprite.frag"),s=t("./src/WebGL/shaders/lib/sprite/sprite.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/sprite/sprite.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform vec3 color;
uniform sampler2D map;
uniform float opacity;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;
uniform float alphaTest;

varying vec2 vUV;
//DEFINEFRAGCOLOR

void main() {

    vec4 texture = texture2D(map, vUV);

    if (texture.a <= alphaTest) discard;

    gl_FragColor = vec4(color * texture.xyz, texture.a * opacity);

    if (fogNear != fogFar) {

        float depth = gl_FragCoord.z / gl_FragCoord.w; //probably wrong
        float fogFactor = smoothstep(fogNear, fogFar, depth);        
        gl_FragColor = mix(gl_FragColor, vec4(fogColor, gl_FragColor.w), fogFactor);
    }
}

`}),"./src/WebGL/shaders/lib/sprite/sprite.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform int useScreenCoordinates;
uniform vec3 screenPosition;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform float rotation;
uniform vec2 scale;
uniform vec2 alignment;
uniform vec2 uvOffset;
uniform vec2 uvScale;

attribute vec2 position;
attribute vec2 uv;

varying vec2 vUV;

void main() {

    vUV = uvOffset + uv * uvScale;

    vec2 alignedPosition = position + alignment;

    vec2 rotatedPosition;
    rotatedPosition.x = ( cos(rotation) * alignedPosition.x - sin(rotation) * alignedPosition.y ) * scale.x;
    rotatedPosition.y = ( sin(rotation) * alignedPosition.x + cos(rotation) * alignedPosition.y ) * scale.y;

    vec4 finalPosition;

    if(useScreenCoordinates != 0) {
        finalPosition = vec4(screenPosition.xy + rotatedPosition, screenPosition.z, 1.0);
    }

    else {
        finalPosition = projectionMatrix * modelViewMatrix * vec4(0.0, 0.0, 0.0, 1.0); finalPosition /= finalPosition.w;
        finalPosition.xy += rotatedPosition; 
    }

    gl_Position = finalPosition;

}

`}),"./src/WebGL/shaders/lib/sprite/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={}}),"./src/WebGL/shaders/lib/ssao/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ssao:()=>o});var n=t("./src/WebGL/shaders/lib/ssao/uniforms.ts"),i=t("./src/WebGL/shaders/lib/ssao/ssao.frag"),s=t("./src/WebGL/shaders/lib/ssao/ssao.vert");const o={fragmentShader:i.default,vertexShader:s.default,uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/ssao/ssao.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform sampler2D depthmap;
varying highp vec2 vTexCoords;
uniform float vWidth;
uniform float vHeight;
uniform float total_strength;
uniform float radius;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

//code for pseudorandom vector from chatgpt
float hash(vec3 p) {
    p = fract(p * vec3(0.1031, 0.1030, 0.0973));
    p += dot(p, p.yzx + 33.33);
    return fract((p.x + p.y) * p.z);
}

// Generate a pseudorandom vec3 from a seed vec3
vec3 pseudorandomVec3(vec3 seed) {
    vec3 randomVec;
    randomVec.x = hash(seed);
    randomVec.y = hash(seed + vec3(1.0, 0.0, 17.1));
    randomVec.z = hash(seed + vec3(0.0, 13.23, 0.0));
    return randomVec;
}

void main(void)
{   
   const float base = 0.2;
   const float area = 0.75;
   const int cycles = 1;

   const int samples = 64;
   vec3 sample_sphere[64] = vec3[](
      vec3(0.091258,-0.510164,0.000000),
      vec3(-0.204347,-0.872967,0.187199),
      vec3(0.009690,-0.263696,-0.110414),
      vec3(0.175208,-0.563987,0.228527),
      vec3(-0.001824,-0.003113,-0.000323),
      vec3(0.411134,-0.719869,-0.261530),
      vec3(-0.074272,-0.377368,0.276290),
      vec3(-0.147773,-0.381587,-0.284529),
      vec3(0.173317,-0.199635,0.063295),
      vec3(-0.186452,-0.199460,0.076965),
      vec3(0.143985,-0.308160,-0.307687),
      vec3(0.053194,-0.148286,0.169589),
      vec3(-0.547656,-0.486476,-0.317378),
      vec3(0.020804,-0.015092,-0.004574),
      vec3(-0.038006,-0.043165,0.054059),
      vec3(-0.094795,-0.443908,-0.731525),
      vec3(0.547552,-0.396466,0.461477),
      vec3(-0.176886,-0.089989,0.007315),
      vec3(0.074401,-0.048840,-0.074039),
      vec3(-0.008240,-0.075697,0.178197),
      vec3(-0.307880,-0.185053,-0.368943),
      vec3(0.309520,-0.108483,0.041646),
      vec3(-0.773478,-0.292946,0.538166),
      vec3(0.184487,-0.231594,-0.820065),
      vec3(0.207318,-0.100531,0.361797),
      vec3(-0.173306,-0.037737,-0.055289),
      vec3(0.548102,-0.105342,-0.253237),
      vec3(-0.119342,-0.043907,0.285162),
      vec3(-0.270247,-0.087861,-0.751357),
      vec3(0.449312,-0.039777,0.236146),
      vec3(-0.743773,-0.036095,0.196056),
      vec3(0.148819,-0.004300,-0.231448),
      vec3(0.008773,0.000809,0.051047),
      vec3(-0.461467,0.027390,-0.357386),
      vec3(0.169626,0.013338,-0.014053),
      vec3(-0.043786,0.007095,0.047331),
      vec3(0.004821,0.140371,-0.988260),
      vec3(0.092402,0.023994,0.101860),
      vec3(-0.295335,0.061530,-0.027372),
      vec3(0.024903,0.007537,-0.018901),
      vec3(-0.081463,0.125402,0.447794),
      vec3(-0.397119,0.231805,-0.631062),
      vec3(0.163853,0.059014,0.044905),
      vec3(-0.495220,0.214357,0.254139),
      vec3(0.306123,0.373687,-0.825715),
      vec3(0.021665,0.026737,0.053220),
      vec3(-0.208231,0.117129,-0.098685),
      vec3(0.139749,0.080968,-0.043086),
      vec3(-0.153599,0.182814,0.262090),
      vec3(-0.159673,0.496777,-0.743568),
      vec3(0.134797,0.117152,0.095753),
      vec3(-0.155626,0.120533,0.019395),
      vec3(0.042311,0.054462,-0.049709),
      vec3(0.001257,0.031288,0.034468),
      vec3(-0.002271,0.003199,-0.002304),
      vec3(0.662104,0.717307,0.033854),
      vec3(-0.373100,0.576021,0.308274),
      vec3(0.024233,0.231316,-0.173688),
      vec3(0.161311,0.420217,0.234273),
      vec3(-0.045248,0.078031,-0.010411),
      vec3(0.167453,0.376942,-0.094872),
      vec3(-0.056194,0.433247,0.173218),
      vec3(-0.016224,0.123149,-0.035569),
      vec3(0.067127,0.407641,0.028479)
   );

   float depth = texture2D(depthmap, vTexCoords).r;
   if(depth == 1.0) {
      discard;
   }

   vec4 screen_position = vec4(vTexCoords, depth,1.0);
   vec4 pos = projinv*screen_position;
   pos /= pos.w;
   vec3 position = pos.xyz;

   //approximate the normal from the depth map; I find this simpler
   //than trying to recompute the exact normal within every possible object shader

   //pixel offset positions in screen space
   ivec2 dim = textureSize(depthmap,0);
   vec2 offset1 = vec2(0.0,1.0/float(dim.y));
   vec2 offset2 = vec2(1.0/float(dim.x),0.0);
   float depth1 = texture2D(depthmap, vTexCoords + offset1).r;
   float depth2 = texture2D(depthmap, vTexCoords + offset2).r;
   
   vec3 p1 = vec3(screen_position.xy+offset1, depth1 - depth);
   vec3 p2 = vec3(screen_position.xy+offset2, depth2 - depth);

   //convert to model space
   vec4 pos1 = projinv*vec4(p1,1);
   pos1 /= pos1.w;
   vec4 pos2 = projinv*vec4(p2,1);
   pos2 /= pos2.w;

   vec3 normal = normalize(cross(pos1.xyz-position, pos2.xyz-position)); //model normal, important we normalize in model space

   //pseudo random number

   float occlusion = 0.0;
   for(int c = 0; c < cycles; c++) {
   vec3 random = normalize(pseudorandomVec3(position+float(c)));
   for(int i=0; i < samples; i++) {

      vec3 ray = radius * reflect(sample_sphere[i],random);
      vec3 hemi_ray = position + sign(dot(ray,normal)) * ray; //model space
      vec4 hemi_screen = projectionMatrix*vec4(hemi_ray,1.0);
      hemi_screen /= hemi_screen.w;
      
      float occ_depth = texture2D(depthmap, clamp(hemi_screen.xy,0.0,1.0)).r;
      float difference = hemi_screen.z - occ_depth;
      
      occlusion += step(0.0, difference) * (1.0-smoothstep(0.0, area, difference));
   }
   }
   float ao = 1.0 - total_strength * occlusion * (1.0 / float(cycles*samples));
   gl_FragDepthEXT = clamp(ao+base,0.0,1.0);

}`}),"./src/WebGL/shaders/lib/ssao/ssao.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`attribute vec2 vertexPosition;
varying highp vec2 vTexCoords;
const vec2 scale = vec2(0.5, 0.5);

void main() {
   vTexCoords  = vertexPosition * scale + scale; // scale vertex attribute to [0,1] range
   gl_Position = vec4(vertexPosition, 0.0, 1.0);
}
        `}),"./src/WebGL/shaders/lib/ssao/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>n});const n={total_strength:{type:"f",value:1},radius:{type:"f",value:5},projinv:{type:"mat4",value:[]}}}),"./src/WebGL/shaders/lib/stickimposter/index.ts":((r,e,t)=>{t.r(e),t.d(e,{stickimposter:()=>l});var n=t("./src/WebGL/shaders/lib/stickimposter/uniforms.ts"),i=t("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),s=t("./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag"),o=t("./src/WebGL/shaders/lib/stickimposter/stickimposter.vert");const l={fragmentShader:[i.default,s.default].join(`
`),vertexShader:o.default,uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/stickimposter/stickimposter.partial.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`    float dotProduct = dot( norm, vLight );
    vec3 light = vec3( max( dotProduct, 0.0 ) );
    color *= light;
#ifdef SHADED
    ivec2 dim = textureSize(shading,0);
    float shadowFactor = texture2D(shading,vec2(gl_FragCoord.x/float(dim.x),gl_FragCoord.y/float(dim.y))).r;
    color *= shadowFactor;
#endif    
    gl_FragColor = vec4(color, opacity*opacity );
    if(fogNear != fogFar) {
        float depth = -qi.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`}),"./src/WebGL/shaders/lib/stickimposter/stickimposter.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];

attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = color; vColor.z = abs(vColor.z); //z indicates which vertex and so would vary
    r = abs(radius);
    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }
    vec3 n = normalize(mvPosition.xyz);
    bool isperspective = (projectionMatrix[3][3] == 0.0);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       if(isperspective) { //perspective
         vec3 pnorm = normalize(p1);
         float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
         mvPosition.xyz = p1+t*pnorm; 
       } else { //orthographic
         mvPosition.xyz = p1;
       }
    } else {
      if(isperspective) { //perspective
         vec3 pnorm = normalize(p2);
         float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
         mvPosition.xyz = p2+t*pnorm;
       } else { //orthographic
         mvPosition.xyz = p2;
       } 
       mult *= -1.0;
    }

    if(isperspective) { //perspective
      vec3 cr = normalize(cross(mvPosition.xyz,norm))*radius;
      vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;
    } else {
      vec3 cr = normalize(cross(vec3(0.0,0.0,-1.0),norm))*radius;
      vec3 doublecr = normalize(cross(vec3(0.0,0.0,-1.0),cr))*radius;
      mvPosition.xyz +=  mult*(cr + doublecr).xyz;     
    }

    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ 0 ], 0.0 );
    vLight = normalize( lDirection.xyz )*directionalLightColor[0]; //not really sure this is right, but color is always white so..
}

`}),"./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform float opacity;
uniform mat4 projectionMatrix;

uniform vec3 fogColor;
uniform float fogNear;
uniform float fogFar;

varying vec3 vLight;
varying vec3 vColor;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

#ifdef SHADED
uniform highp sampler2D shading;
#endif

//DEFINEFRAGCOLOR

//cylinder-ray intersection testing taken from http://mrl.nyu.edu/~dzorin/cg05/lecture12.pdf
//also useful: http://stackoverflow.com/questions/9595300/cylinder-impostor-in-glsl
//with a bit more care (caps) this could be a general cylinder imposter (see also outline)
void main() {
    vec3 color = abs(vColor);
    vec3 pos = cposition;
    vec3 p = pos; //ray point
    vec3 v = vec3(0.0,0.0,-1.0); //ray normal - orthographic
    if(projectionMatrix[3][3] == 0.0) v = normalize(pos); //ray normal - perspective
    vec3 pa = p1; //cyl start
    vec3 va = normalize(p2-p1); //cyl norm
    vec3 tmp1 = v-(dot(v,va)*va);
    vec3 deltap = p-pa;
    float A = dot(tmp1,tmp1);
    if(A == 0.0) discard;
    vec3 tmp2 = deltap-(dot(deltap,va)*va);
    float B = 2.0*dot(tmp1, tmp2);
    float C = dot(tmp2,tmp2)-r*r;
//quadratic equation!
    float det = (B*B) - (4.0*A*C);
    if(det < 0.0) discard;
    float sqrtDet = sqrt(det);
    float posT = (-B+sqrtDet)/(2.0*A);
    float negT = (-B-sqrtDet)/(2.0*A);
    float intersectionT = min(posT,negT);
    vec3 qi = p+v*intersectionT;
    float dotp1 = dot(va,qi-p1);
    float dotp2 = dot(va,qi-p2);
    vec3 norm;
    if( dotp1 < 0.0 || dotp2 > 0.0) { //(p-c)^2 + 2(p-c)vt +v^2+t^2 - r^2 = 0
       vec3 cp;
       if( dotp1 < 0.0) {  
//        if(vColor.x < 0.0 ) discard; //color sign bit indicates if we should cap or not
        cp = p1;
       } else {
//          if(vColor.y < 0.0 ) discard;
          cp = p2;
       }
       vec3 diff = p-cp;
       A = dot(v,v);
       B = dot(diff,v)*2.0;
       C = dot(diff,diff)-r*r;
       det = (B*B) - (4.0*C);
       if(det < 0.0) discard;
       sqrtDet = sqrt(det);
       posT = (-B+sqrtDet)/(2.0);
       negT = (-B-sqrtDet)/(2.0);
       float t = min(posT,negT);
       qi = p+v*t; 
       norm = normalize(qi-cp); 
    } else {
       norm = normalize(qi-(dotp1*va + p1));
    }
    vec4 clipPos = projectionMatrix * vec4(qi, 1.0);
    float ndcDepth = clipPos.z / clipPos.w;
    float depth = ((gl_DepthRange.diff * ndcDepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
    gl_FragDepthEXT = depth;`}),"./src/WebGL/shaders/lib/stickimposter/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},directionalLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]}}}),"./src/WebGL/shaders/lib/stickimposteroutline/index.ts":((r,e,t)=>{t.r(e),t.d(e,{stickimposteroutline:()=>l});var n=t("./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts"),i=t("./src/WebGL/shaders/lib/stickimposter/stickimposterFragmentShader.partial.frag"),s=t("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag"),o=t("./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert");const l={fragmentShader:i.default+s.default,vertexShader:o.default,uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.partial.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
    gl_FragColor = vec4(color, opacity*opacity );
    if(fogNear != fogFar) {
        float depth = -qi.z;
        float fogFactor = smoothstep( fogNear, fogFar, depth );
        gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
    }
}`}),"./src/WebGL/shaders/lib/stickimposteroutline/stickimposteroutline.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`

uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 directionalLightColor[ 1 ];
uniform vec3 directionalLightDirection[ 1 ];
uniform vec3 outlineColor;
uniform float outlineWidth;
uniform float outlinePushback;
uniform float outlineMaxPixels;
uniform float vWidth;
uniform mat4 projinv;


attribute vec3 position;
attribute vec3 normal;
attribute vec3 color;
attribute float radius;

varying vec3 vColor;
varying vec3 vLight;
varying vec3 cposition;
varying vec3 p1;
varying vec3 p2;
varying float r;

void main() {

    vColor = outlineColor;
    float rad = radius+sign(radius)*outlineWidth;
    r = abs(rad);

    vec4 to = modelViewMatrix*vec4(normal, 1.0); //normal is other point of cylinder
    vec4 pt = modelViewMatrix*vec4(position, 1.0);
//pushback
    float scale = 1.0;
    if(projectionMatrix[3][3] != 0.0) { //orthographic
        to.z -= outlinePushback;
        pt.z -= outlinePushback;
    } else { //perspective
        vec4 midbefore = pt;
        if(length(to.xyz) < length(pt)) {
            midbefore = to;
        }
        vec4 midafter = midbefore;
        midafter.xyz += normalize(midbefore.xyz)*outlinePushback;

        to.xyz += normalize(to.xyz)*outlinePushback;
        pt.xyz += normalize(pt.xyz)*outlinePushback;

        //figure out a scaling factor for radius to account for perspective setback
        vec4 midbeforer = vec4(midbefore.x+rad,midbefore.y, midbefore.z, midbefore.w);
        vec4 midafterr = vec4(midafter.x+rad,midafter.y, midafter.z, midafter.w);

        vec4 mb = projectionMatrix*midbefore;
        vec4 mbr = projectionMatrix*midbeforer;
        vec4 ma = projectionMatrix*midafter;
        vec4 mar = projectionMatrix*midafterr;
        mb /= mb.w;
        mbr /= mbr.w;
        ma /= ma.w;
        mar /= mar.w;
        scale = abs((mbr.x-mb.x)/(mar.x-ma.x));
        rad *= scale;
        r = abs(rad);
    }
    vec4 mvPosition = pt;
    p1 = pt.xyz; p2 = to.xyz;
    vec3 norm = to.xyz-pt.xyz;
    float mult = 1.1; //slop to account for perspective of sphere
    if(length(p1) > length(p2)) { //billboard at level of closest point
       mvPosition = to;
    }

    vec3 n = normalize(mvPosition.xyz);
//intersect with the plane defined by the camera looking at the billboard point
    if(color.z >= 0.0) { //p1
       vec3 pnorm = normalize(p1);
       float t = dot(mvPosition.xyz-p1,n)/dot(pnorm,n);
       mvPosition.xyz = p1+t*pnorm;
    } else {
       vec3 pnorm = normalize(p2);
       float t = dot(mvPosition.xyz-p2,n)/dot(pnorm,n);
       mvPosition.xyz = p2+t*pnorm;
       mult *= -1.0;
    }

    if(outlineMaxPixels > 0.0) {
        vec4 cpos = mvPosition;
        vec4 unadjusted = projectionMatrix*vec4(cpos.x+abs(scale*radius), cpos.y,cpos.z,cpos.w); 
        vec4 ccoord = projectionMatrix*cpos;
        vec4 adjust = projectionMatrix*vec4(cpos.x+r,cpos.y,cpos.z,cpos.w); 
        unadjusted /= unadjusted.w;
        adjust /= adjust.w;
        unadjusted.xyz -= ccoord.xyz/ccoord.w;
        adjust.xyz -= ccoord.xyz/ccoord.w;
        float diff = abs(adjust.x-unadjusted.x);
        diff *= vWidth; //this should now be in pixels
        if(diff > outlineMaxPixels) {
            float fixlen = abs(unadjusted.x) + outlineMaxPixels/vWidth; 
            vec4 pcoord = ccoord;
            pcoord.x += fixlen*pcoord.w;
            vec4 altc = projinv*pcoord;
            r= abs(altc.x-cpos.x);
        }
    }

    vec3 cr = normalize(cross(mvPosition.xyz,norm))*rad;
    vec3 doublecr = normalize(cross(mvPosition.xyz,cr))*rad;
    mvPosition.xy +=  mult*(cr + doublecr).xy;
    cposition = mvPosition.xyz;
    gl_Position = projectionMatrix * mvPosition;
    vLight = vec3(1.0,1.0,1.0);
}

`}),"./src/WebGL/shaders/lib/stickimposteroutline/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},outlineColor:{type:"c",value:new n.Color(0,0,0)},outlineWidth:{type:"f",value:.1},outlinePushback:{type:"f",value:1},outlineMaxPixels:{type:"f",value:0},projinv:{type:"mat4",value:[]}}}),"./src/WebGL/shaders/lib/volumetric/index.ts":((r,e,t)=>{t.r(e),t.d(e,{volumetric:()=>o});var n=t("./src/WebGL/shaders/lib/volumetric/uniforms.ts"),i=t("./src/WebGL/shaders/lib/volumetric/volumetric.frag"),s=t("./src/WebGL/shaders/lib/volumetric/volumetric.vert");const o={fragmentShader:i.default.replace("#define GLSLIFY 1",""),vertexShader:s.default.replace("#define GLSLIFY 1",""),uniforms:n.uniforms}}),"./src/WebGL/shaders/lib/volumetric/uniforms.ts":((r,e,t)=>{t.r(e),t.d(e,{uniforms:()=>i});var n=t("./src/colors.ts");const i={opacity:{type:"f",value:1},fogColor:{type:"c",value:new n.Color(1,1,1)},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},data:{type:"i",value:3},colormap:{type:"i",value:4},depthmap:{type:"i",value:5},step:{type:"f",value:1},maxdepth:{type:"f",value:100},subsamples:{type:"f",value:5},textmat:{type:"mat4",value:[]},projinv:{type:"mat4",value:[]},transfermin:{type:"f",value:-.2},transfermax:{type:"f",value:.2}}}),"./src/WebGL/shaders/lib/volumetric/volumetric.frag":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`
uniform highp sampler3D data;
uniform highp sampler2D colormap;
uniform highp sampler2D depthmap;


uniform mat4 textmat;
uniform mat4 projinv;
uniform mat4 projectionMatrix;

uniform float step;
uniform float subsamples;
uniform float maxdepth;
uniform float transfermin;
uniform float transfermax;
in  vec4 mvPosition;
out vec4 color;
void main(void) {

   vec4 pos = mvPosition;
   bool seengood = false;
   float i = 0.0;
   color = vec4(1,1,1,0);
   float increment = 1.0/subsamples;
   float maxsteps = (maxdepth*subsamples/step);
//there's probably a better way to do this..
//calculate farthest possible point in model coordinates
   vec4 maxpos = vec4(pos.x,pos.y,pos.z-maxdepth,1.0);
// convert to projection
   maxpos = projectionMatrix*maxpos;
   vec4 startp = projectionMatrix*pos;
// homogonize
   maxpos /= maxpos.w;
   startp /= startp.w;
//take x,y from start and z from max
   maxpos = vec4(startp.x,startp.y,maxpos.z,1.0);
//convert back to model space
   maxpos = projinv*maxpos;
   maxpos /= maxpos.w;
   float incr = step/subsamples;
//get depth from depthmap
//startp is apparently [-1,1]
   vec2 tpos = startp.xy/2.0+0.5;
   float depth = texture(depthmap, tpos).r;
//compute vector between start and end
   vec4 direction = maxpos-pos;
   for( i = 0.0; i <= maxsteps; i++) {
      vec4 pt = (pos+(i/maxsteps)*direction);
      vec4 ppt = projectionMatrix*pt;
      float ptdepth = ppt.z/ppt.w;
      ptdepth = ((gl_DepthRange.diff * ptdepth) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;
      if(ptdepth > depth) break;
      pt = textmat*pt;
//       pt /= pt.w;
      if(pt.x >= -0.01 && pt.y >= -0.01 && pt.z >= -0.01 && pt.x <= 1.01 && pt.y <= 1.01 && pt.z <= 1.01) {
         seengood = true;
      } else if(seengood) {
         break;
      }
      if( pt.x < -0.01 || pt.x > 1.01 || pt.y < -0.01 || pt.y > 1.01 || pt.z < -0.01 || pt.z > 1.01  ){
          color.a = 0.0;
          continue;
      }
      else {
         float val = texture(data, pt.zyx).r;
         if(isinf(val)) continue; //masked out
         float cval = (val-transfermin)/(transfermax-transfermin); //scale to texture 0-1 range
         vec4 val_color = texture(colormap, vec2(cval,0.5));
         color.rgb = color.rgb*color.a + (1.0-color.a)*val_color.a*val_color.rgb;
         color.a += (1.0 - color.a) * val_color.a; 
         if(color.a > 0.0) color.rgb /= color.a;
//          color = vec4(pt.x, pt.y, pt.z, 1.0);
      }
//       color = vec4(pt.x, pt.y, pt.z, 0.0)
    }
}

        `}),"./src/WebGL/shaders/lib/volumetric/volumetric.vert":((r,e,t)=>{t.r(e),t.d(e,{default:()=>n});const n=`uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;

in vec3 position;
out vec4 mvPosition;
void main() {

    mvPosition = modelViewMatrix * vec4( position, 1.0 );
    gl_Position = projectionMatrix*mvPosition;
}
`}),"./src/WebGL/shaders/utils/clone.ts":((r,e,t)=>{t.r(e),t.d(e,{clone:()=>i});var n=t("./src/colors.ts");function i(s){let o={};for(const l in s){o[l]={},o[l].type=s[l].type;var a=s[l].value;a instanceof n.Color?o[l].value=a.clone():typeof a=="number"?o[l].value=a:a instanceof Array?o[l].value=[]:console.error("Error copying shader uniforms from ShaderLib: unknown type for uniform")}return o}}),"./src/WebGL/shaders/utils/index.ts":((r,e,t)=>{t.r(e),t.d(e,{ShaderUtils:()=>i,clone:()=>n.clone});var n=t("./src/WebGL/shaders/utils/clone.ts");const i={clone:n.clone}}),"./src/WebGL/shapes/Cylinder.ts":((r,e,t)=>{t.r(e),t.d(e,{Cylinder:()=>s});var n=t("./src/WebGL/math/index.ts");let i=new n.Vector3;class s{constructor(a=new n.Vector3,l=new n.Vector3,d=0){this.c1=a,this.c2=l,this.radius=d,this.direction=new n.Vector3().subVectors(this.c2,this.c1).normalize()}copy(a){return this.c1.copy(a.c1),this.c2.copy(a.c2),this.direction.copy(a.direction),this.radius=a.radius,this}lengthSq(){return i.subVectors(this.c2,this.c1).lengthSq()}applyMatrix4(a){return this.direction.add(this.c1).applyMatrix4(a),this.c1.applyMatrix4(a),this.c2.applyMatrix4(a),this.direction.sub(this.c1).normalize(),this.radius=this.radius*a.getMaxScaleOnAxis(),this}}}),"./src/WebGL/shapes/Sphere.ts":((r,e,t)=>{t.r(e),t.d(e,{Sphere:()=>i});var n=t("./src/WebGL/math/index.ts");class i{constructor(o={x:0,y:0,z:0},a=0){this.center=new n.Vector3(o.x,o.y,o.z),this.radius=a}set(o,a){return this.center.copy(o),this.radius=a,this}copy(o){return this.center.copy(o.center),this.radius=o.radius,this}applyMatrix4(o){return this.center.applyMatrix4(o),this.radius=this.radius*o.getMaxScaleOnAxis(),this}translate(o){return this.center.add(o),this}equals(o){return o.center.equals(this.center)&&o.radius===this.radius}clone(){return new i().copy(this)}}}),"./src/WebGL/shapes/Triangle.ts":((r,e,t)=>{t.r(e),t.d(e,{Triangle:()=>s});var n=t("./src/WebGL/math/index.ts");const i=new n.Vector3;class s{constructor(a=new n.Vector3,l=new n.Vector3,d=new n.Vector3){this.a=a,this.b=l,this.c=d}copy(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this}applyMatrix4(a){return this.a.applyMatrix4(a),this.b.applyMatrix4(a),this.c.applyMatrix4(a),this}getNormal(){var a=this.a.clone();return a.sub(this.b),i.subVectors(this.c,this.b),a.cross(i),a.normalize(),a}}}),"./src/WebGL/shapes/index.ts":((r,e,t)=>{t.r(e),t.d(e,{Cylinder:()=>i.Cylinder,Sphere:()=>n.Sphere,Triangle:()=>s.Triangle});var n=t("./src/WebGL/shapes/Sphere.ts"),i=t("./src/WebGL/shapes/Cylinder.ts"),s=t("./src/WebGL/shapes/Triangle.ts")}),"./src/autoload.ts":((r,e,t)=>{t.r(e),t.d(e,{autoinit:()=>a,autoload:()=>u,processing_autoinit:()=>l,viewers:()=>d});var n=t("./src/GLViewer.ts"),i=t("./src/ProteinSurface4.ts"),s=t("./src/utilities.ts"),o=t("./src/colors.ts"),a=!1,l=!1,d={};function u(g,x){var y,b,_;if(document.querySelector(".viewer_3Dmoljs")!=null&&(a=!0),a){l=!0,g=g??null;var h=0;document.querySelectorAll(".viewer_3Dmoljs").forEach(f=>{var E=[],m=[],S="";f.style.position=="static"&&(f.style.position="relative");var w=null;if(_=null,f.dataset.pdb)E.push("https://files.rcsb.org/view/"+f.dataset.pdb+".pdb"),m.push("pdb");else if(f.dataset.cid)m.push("sdf"),E.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+f.dataset.cid+"/SDF?record_type=3d");else if(f.dataset.href||f.dataset.url){if(f.dataset.href?S=f.dataset.href:S=f.dataset.url,E.push(S),_=S.substring(S.lastIndexOf(".")+1),_=="gz"){let Hm=S.substring(0,S.lastIndexOf(".")).lastIndexOf(".");_=S.substring(Hm+1)}m.push(_);var v=S.substring(S.lastIndexOf("/")+1,S.lastIndexOf("."));v=="/"&&(v=S.substring(S.lastIndexOf("/")+1)),f.dataset[m[m.length-1]]=v}let A=f.dataset;for(y in A)y.substring(0,3)==="pdb"&&y!=="pdb"?(E.push("https://files.rcsb.org/view/"+A[y]+".pdb"),m.push("pdb")):y.substring(0,4)==="href"&&y!=="href"?(S=A[y],E.push(S),m.push(S.substring(S.lastIndexOf(".")+1))):y.substring(0,3)==="cid"&&y!=="cid"&&(E.push("https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+A[y]+"/SDF?record_type=3d"),m.push("sdf"));var M={};f.dataset.options&&(M=(0,s.specStringToObject)(f.dataset.options));var T=o.CC.color(f.dataset.backgroundcolor),R=f.dataset.backgroundalpha;R=R==null?1:parseFloat(R);var P={line:{}};f.dataset.style&&(P=(0,s.specStringToObject)(f.dataset.style));var L={};f.dataset.select&&(L=(0,s.specStringToObject)(f.dataset.select));var O=[],I=[],N=[],k={},U=null,F=f.dataset,j=/style(.+)/,H=/surface(.*)/,B=/labelres(.*)/,V=[];for(b in F)Object.prototype.hasOwnProperty.call(F,b)&&V.push(b);for(V.sort(),y=0;y<V.length;y++){b=V[y];var K=j.exec(b),q,Te,Fe;K&&(q="select"+K[1],Te=(0,s.specStringToObject)(F[q]),Fe=(0,s.specStringToObject)(F[b]),O.push([Te,Fe])),K=H.exec(b),K&&(q="select"+K[1],Te=(0,s.specStringToObject)(F[q]),Fe=(0,s.specStringToObject)(F[b]),I.push([Te,Fe])),K=B.exec(b),K&&(q="select"+K[1],Te=(0,s.specStringToObject)(F[q]),Fe=(0,s.specStringToObject)(F[b]),N.push([Te,Fe])),b=="zoomto"&&(k=(0,s.specStringToObject)(F[b])),b=="spin"&&(U=(0,s.specStringToObject)(F[b]))}var We=function(Hm){for(Hm.setStyle(L,P),w&&w.createSelectionAndStyle(L,P),y=0;y<O.length;y++){let oi=O[y][0]||{},h0=O[y][1]||{line:{}};Hm.setStyle(oi,h0),w&&w.createSelectionAndStyle(L,P)}for(y=0;y<I.length;y++){let oi=I[y][0]||{},h0=I[y][1]||{};w?Hm.addSurface(i.SurfaceType.VDW,h0,oi,oi).then(M0=>{w.loadSurface("VDW",oi,h0,M0)}):Hm.addSurface(i.SurfaceType.VDW,h0,oi,oi)}for(y=0;y<N.length;y++){let oi=N[y][0]||{},h0=N[y][1]||{};Hm.addResLabels(oi,h0)}Hm.render(),Hm.zoomTo(k),U&&Hm.spin(U.axis,U.speed)};let J=g;try{var et=(0,s.specStringToObject)(f.dataset.config)||{};et.backgroundColor===void 0&&(et.backgroundColor=T),et.backgroundAlpha===void 0&&(et.backgroundAlpha=R),J==null?J=d[f.id||h++]=(0,n.createViewer)(f,et):(J.setBackgroundColor(T,R),J.setConfig(et),w&&w.initiateUI()),f.dataset.ui&&$3Dmol.StateManager&&(w=new $3Dmol.StateManager(J))}catch(Hm){console.log(Hm),f.textContent="WebGL appears to be disabled."}if(E.length!=0){let Hm=0,oi=((h0,l0)=>function(M0){S=E[Hm];var U0=h0.dataset.type||h0.dataset.datatype||m[Hm];if(l0.addModel(M0,U0,M),w){var _0=h0.dataset[m[Hm]];w.setModelTitle(_0)}Hm+=1,Hm<E.length?(0,s.get)(E[Hm]).then(oi):(We(l0),h0.dataset.callback&&(0,s.makeFunction)(h0.dataset.callback)(l0),l=!1,x&&x(l0))})(f,J);_&&_.endsWith("gz")?(0,s.getbin)(E[0]).then(oi):(0,s.get)(E[0]).then(oi)}else{if(f.dataset.element){var ht="#"+f.dataset.element,er=document.querySelector(ht),tr=er?er.textContent:"";_=f.dataset.type||f.dataset.datatype,J.addModel(tr,_,M)}We(J),f.dataset.callback&&(0,s.makeFunction)(f.dataset.callback)(J),l=!1,x&&x(J)}})}}document.onreadystatechange=()=>{document.readyState==="complete"&&u()}}),"./src/colors.ts":((r,e,t)=>{t.r(e),t.d(e,{CC:()=>i,Color:()=>n,builtinColorSchemes:()=>g,chains:()=>u,elementColors:()=>l,htmlColors:()=>s,residues:()=>d,ssColors:()=>o});class n{constructor(y,b,_){return this.r=0,this.g=0,this.b=0,arguments.length>1&&typeof y=="number"?(this.r=y||0,this.g=b||0,this.b=_||0,this):this.set(y||0)}set(y){return y instanceof n?y.clone():(typeof y=="number"?this.setHex(y):typeof y=="object"&&(this.r=y?.r||0,this.g=y?.g||0,this.b=y?.b||0),this)}setHex(y){return y=Math.floor(y),this.r=(y>>16&255)/255,this.g=(y>>8&255)/255,this.b=(y&255)/255,this}getHex(){var y=Math.round(this.r*255),b=Math.round(this.g*255),_=Math.round(this.b*255);return y<<16|b<<8|_}clone(){return new n(this.r,this.g,this.b)}copy(y){return this.r=y.r,this.g=y.g,this.b=y.b,this}scaled(){var y={};return y.r=Math.round(this.r*255),y.g=Math.round(this.g*255),y.b=Math.round(this.b*255),y.a=1,y}}class i{static color(y){if(!y)return i.cache[0];if(y instanceof n)return y;if(typeof y=="number"&&typeof i.cache[y]<"u")return i.cache[y];if(y&&Array.isArray(y))return y.map(i.color);let b=i.getHex(y),_=new n(b);return i.cache[b]=_,_}static getHex(y){if(Array.isArray(y))return y.map(i.getHex);if(typeof y=="string"){let b=y;if(!isNaN(parseInt(b)))return parseInt(b);if(b=b.trim(),b.length==4&&b[0]=="#"&&(b="#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]),b.length==7&&b[0]=="#")return parseInt(b.substring(1),16);let _=i.rgbRegEx.exec(b);if(_){_[1]!=""&&console.log("WARNING: Opacity value in rgba ignored.  Specify separately as opacity attribute.");let f=0;for(let E=2;E<5;E++){f*=256;let m=_[E].endsWith("%")?255*parseFloat(_[E])/100:parseFloat(_[E]);f+=Math.round(m)}return f}let h=s[b.toLowerCase()];return h!==void 0?h:(console.error("color not found",y.toLowerCase(),s),0)}return y}}i.rgbRegEx=/rgb(a?)\(\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)\s*,\s*([^ ,\)\t]+)/i,i.cache={0:new n(0)};const s={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgrey:11119017,darkgreen:25600,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,grey:8421504,green:32768,greenyellow:11403055,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgrey:13882323,lightgreen:9498256,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074,b:255,g:32768,r:16711680,c:49087,m:12517567,y:12566272,k:0,w:16777215},o={pyMol:{h:16711680,s:16776960,c:65280},Jmol:{h:16711808,s:16762880,c:16777215}},a={H:16777215,He:16761035,HE:16761035,Li:11674146,LI:11674146,B:65280,C:13158600,N:9408511,O:15728640,F:14329120,Na:255,NA:255,Mg:2263842,MG:2263842,Al:8421520,AL:8421520,Si:14329120,SI:14329120,P:16753920,S:16762930,Cl:65280,CL:65280,Ca:8421520,CA:8421520,Ti:8421520,TI:8421520,Cr:8421520,CR:8421520,Mn:8421520,MN:8421520,Fe:16753920,FE:16753920,Ni:10824234,NI:10824234,Cu:10824234,CU:10824234,Zn:10824234,ZN:10824234,Br:10824234,BR:10824234,Ag:8421520,AG:8421520,I:10494192,Ba:16753920,BA:16753920,Au:14329120,AU:14329120},l={defaultColor:16716947,Jmol:{H:16777215,He:14286847,HE:14286847,Li:13402367,LI:13402367,Be:12779264,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,Ne:11789301,NE:11789301,Na:11230450,NA:11230450,Mg:9109248,MG:9109248,Al:12560038,AL:12560038,Si:1578e4,SI:1578e4,P:16744448,S:16777008,Cl:2093087,CL:2093087,Ar:8442339,AR:8442339,K:9388244,Ca:4062976,CA:4062976,Sc:15132390,SC:15132390,Ti:12567239,TI:12567239,V:10921643,Cr:9083335,CR:9083335,Mn:10255047,MN:10255047,Fe:14706227,FE:14706227,Co:15765664,CO:15765664,Ni:5296208,NI:5296208,Cu:13140019,CU:13140019,Zn:8224944,ZN:8224944,Ga:12750735,GA:12750735,Ge:6721423,GE:6721423,As:12419299,AS:12419299,Se:16752896,SE:16752896,Br:10889513,BR:10889513,Kr:6076625,KR:6076625,Rb:7351984,RB:7351984,Sr:65280,SR:65280,Y:9764863,Zr:9756896,ZR:9756896,Nb:7586505,NB:7586505,Mo:5551541,MO:5551541,Tc:3907230,TC:3907230,Ru:2396047,RU:2396047,Rh:687500,RH:687500,Pd:27013,PD:27013,Ag:12632256,AG:12632256,Cd:16767375,CD:16767375,In:10909043,IN:10909043,Sn:6717568,SN:6717568,Sb:10380213,SB:10380213,Te:13924864,TE:13924864,I:9699476,Xe:4366e3,XE:4366e3,Cs:5707663,CS:5707663,Ba:51456,BA:51456,La:7394559,LA:7394559,Ce:16777159,CE:16777159,Pr:14286791,PR:14286791,Nd:13107143,ND:13107143,Pm:10747847,PM:10747847,Sm:9437127,SM:9437127,Eu:6422471,EU:6422471,Gd:4587463,GD:4587463,Tb:3211207,TB:3211207,Dy:2097095,DY:2097095,Ho:65436,HO:65436,Er:58997,ER:58997,Tm:54354,TM:54354,Yb:48952,YB:48952,Lu:43812,LU:43812,Hf:5096191,HF:5096191,Ta:5089023,TA:5089023,W:2200790,Re:2522539,RE:2522539,Os:2516630,OS:2516630,Ir:1528967,IR:1528967,Pt:13684960,PT:13684960,Au:16765219,AU:16765219,Hg:12105936,HG:12105936,Tl:10900557,TL:10900557,Pb:5724513,PB:5724513,Bi:10375093,BI:10375093,Po:11230208,PO:11230208,At:7688005,AT:7688005,Rn:4358806,RN:4358806,Fr:4325478,FR:4325478,Ra:32e3,RA:32e3,Ac:7384058,AC:7384058,Th:47871,TH:47871,Pa:41471,PA:41471,U:36863,Np:33023,NP:33023,Pu:27647,PU:27647,Am:5528818,AM:5528818,Cm:7888099,CM:7888099,Bk:9064419,BK:9064419,Cf:10565332,CF:10565332,Es:11739092,ES:11739092,Fm:11739066,FM:11739066,Md:11734438,MD:11734438,No:12389767,NO:12389767,Lr:13041766,LR:13041766,Rf:13369433,RF:13369433,Db:13697103,DB:13697103,Sg:14221381,SG:14221381,Bh:14680120,BH:14680120,Hs:15073326,HS:15073326,Mt:15400998,MT:15400998},rasmol:a,defaultColors:Object.assign({},a),greenCarbon:Object.assign(Object.assign({},a),{C:65280}),cyanCarbon:Object.assign(Object.assign({},a),{C:65535}),magentaCarbon:Object.assign(Object.assign({},a),{C:16711935}),yellowCarbon:Object.assign(Object.assign({},a),{C:16776960}),whiteCarbon:Object.assign(Object.assign({},a),{C:16777215}),orangeCarbon:Object.assign(Object.assign({},a),{C:16753920}),purpleCarbon:Object.assign(Object.assign({},a),{C:8388736}),blueCarbon:Object.assign(Object.assign({},a),{C:255})},d={amino:{ALA:13158600,ARG:1334015,ASN:56540,ASP:15075850,CYS:15132160,GLN:56540,GLU:15075850,GLY:15461355,HIS:8553170,ILE:1016335,LEU:1016335,LYS:1334015,MET:15132160,PHE:3289770,PRO:14456450,SER:16422400,THR:16422400,TRP:11819700,TYR:3289770,VAL:1016335,ASX:16738740,GLX:16738740},shapely:{ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:16777215,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,ASX:16711935,GLX:16711935},nucleic:{A:10526975,G:16740464,I:8454143,C:16747595,T:10551200,U:16744576}},u={atom:{A:12636415,B:11599792,C:16761032,D:16777088,E:16761087,F:11596016,G:16765040,H:15761536,I:16113331,J:49151,K:13458524,L:6737322,M:10145074,N:15631086,O:52945,P:65407,Q:3978097,R:139,S:12433259,T:25600,U:8388608,V:8421376,W:8388736,X:32896,Y:12092939,Z:11674146},hetatm:{A:9478351,B:8441752,C:13602992,D:13619056,E:13603023,F:8437952,G:13607008,H:12603504,I:12955267,J:42959,K:11881548,L:5682578,M:9090346,N:12481214,O:46753,P:53103,Q:3447649,R:187,S:10854235,T:37888,U:11534336,V:11579392,W:11534512,X:45232,Y:15250963,Z:12726834}},g={ssPyMol:{prop:"ss",map:o.pyMol},ssJmol:{prop:"ss",map:o.Jmol},Jmol:{prop:"elem",map:l.Jmol},amino:{prop:"resn",map:d.amino},shapely:{prop:"resn",map:d.shapely},nucleic:{prop:"resn",map:d.nucleic},chain:{prop:"chain",map:u.atom},rasmol:{prop:"elem",map:l.rasmol},default:{prop:"elem",map:l.defaultColors},greenCarbon:{prop:"elem",map:l.greenCarbon},chainHetatm:{prop:"chain",map:u.hetatm},cyanCarbon:{prop:"elem",map:l.cyanCarbon},magentaCarbon:{prop:"elem",map:l.magentaCarbon},purpleCarbon:{prop:"elem",map:l.purpleCarbon},whiteCarbon:{prop:"elem",map:l.whiteCarbon},orangeCarbon:{prop:"elem",map:l.orangeCarbon},yellowCarbon:{prop:"elem",map:l.yellowCarbon},blueCarbon:{prop:"elem",map:l.blueCarbon}}}),"./src/exporter.js":(r=>{typeof r.exports=="object"&&(r.exports=window.$3Dmol)}),"./src/glcartoon.ts":((r,e,t)=>{t.r(e),t.d(e,{drawCartoon:()=>L,subdivide_spline:()=>u});var n=t("./src/WebGL/math/index.ts"),i=t("./src/WebGL/shapes/index.ts"),s=t("./src/WebGL/index.ts"),o=t("./src/Gradient.ts"),a=t("./src/colors.ts"),l=t("./src/GLDraw.ts"),d=t("./src/utilities.ts");function u(O,I){var N=[],k=O;k=[],k.push(O[0]);var U,F,j,H,B,V,K,q,Te;for(U=1,F=O.length-1;U<F;U++)if(B=O[U],V=O[U+1],B.smoothen){var Fe=new n.Vector3((B.x+V.x)/2,(B.y+V.y)/2,(B.z+V.z)/2);Fe.atom=B.atom,k.push(Fe)}else k.push(B);for(k.push(O[O.length-1]),U=-1,j=k.length;U<=j-3;U++)if(H=k[U===-1?0:U],B=k[U+1],V=k[U+2],K=k[U===j-3?j-1:U+3],q=new n.Vector3().subVectors(V,H).multiplyScalar(.5),Te=new n.Vector3().subVectors(K,B).multiplyScalar(.5),!V.skip)for(var We=0;We<I;We++){var J=1/I*We,et=B.x+J*q.x+J*J*(-3*B.x+3*V.x-2*q.x-Te.x)+J*J*J*(2*B.x-2*V.x+q.x+Te.x),ht=B.y+J*q.y+J*J*(-3*B.y+3*V.y-2*q.y-Te.y)+J*J*J*(2*B.y-2*V.y+q.y+Te.y),er=B.z+J*q.z+J*J*(-3*B.z+3*V.z-2*q.z-Te.z)+J*J*J*(2*B.z-2*V.z+q.z+Te.z),tr=new n.Vector3(et,ht,er);We<I/2?tr.atom=B.atom:tr.atom=V.atom,N.push(tr)}return N.push(k[k.length-1]),N}const g=.5,x=1.3,y=.8,b=.4,_=.4;function h(O,I,N,k){for(var U,F,j,H,B=0,V=I.length;B<V;B++){H=Math.round(B*(k.length-1)/V),j=a.CC.color(k[H]);var K=O.updateGeoGroup(2),q=K.vertexArray,Te=K.colorArray,Fe=K.faceArray;U=K.vertices,F=U*3,q[F]=I[B].x,q[F+1]=I[B].y,q[F+2]=I[B].z,q[F+3]=N[B].x,q[F+4]=N[B].y,q[F+5]=N[B].z;for(var We=0;We<6;++We)Te[F+3*We]=j.r,Te[F+1+3*We]=j.g,Te[F+2+3*We]=j.b;if(B>0){var J=[U,U+1,U-1,U-2],et=K.faceidx;Fe[et]=J[0],Fe[et+1]=J[1],Fe[et+2]=J[3],Fe[et+3]=J[1],Fe[et+4]=J[2],Fe[et+5]=J[3],K.faceidx+=6}K.vertices+=2}}function f(O,I,N,k,U,F,j){var H,B,V,K;if(V=I.length,V<2||I[0].length<2)return;for(H=0;H<V;H++)I[H]=u(I[H],k);if(K=I[0].length,!U)return h(O,I[0],I[V-1],N);var q,Te,Fe,We,J,et,ht=[],er=[],tr=[];for(B=0;B<V;B++)ht.push(.25+1.5*Math.sqrt((V-1)*B-Math.pow(B,2))/(V-1)),er.push(.5),tr.push(2*(Math.pow(B/V,2)-B/V)+.6);var Hm=[];for(B=0;B<V*2-1;B++)Hm[B]=[B,B+1,B+1-2*V,B-2*V];Hm[V*2-1]=[B,B+1-2*V,B+1-4*V,B-2*V];var oi,h0,l0,M0,U0,_0,C0,P0,R0,si;let Xe=O.updateGeoGroup();for(H=0;H<K;H++){let it=O.groups,ec=!1;Xe=O.updateGeoGroup(2*V),it!=O.groups&&H>0&&(H=H-1,ec=!0),_0=Math.round(H*(N.length-1)/K),U0=a.CC.color(N[_0]),J=Fe,et=We,Fe=[],We=[],q=[],I[0][H].atom!==void 0&&(M0=I[0][H].atom,j==="oval"?Te=ht:j==="rectangle"?Te=er:j==="parabola"&&(Te=tr)),Te||(Te=er);var d0,w0;for(B=0;B<V;B++)H<K-1?d0=I[B][H+1].clone().sub(I[B][H]):d0=I[B][H-1].clone().sub(I[B][H]).negate(),B<V-1?w0=I[B+1][H].clone().sub(I[B][H]):w0=I[B-1][H].clone().sub(I[B][H]).negate(),q[B]=w0.cross(d0).normalize().multiplyScalar(U*Te[B]);for(B=0;B<V;B++)Fe[B]=I[B][H].clone().add(q[B].clone().negate());for(B=0;B<V;B++)We[B]=I[B][H].clone().add(q[B]);for(C0=Xe.vertexArray,P0=Xe.colorArray,R0=Xe.faceArray,oi=Xe.vertices,h0=oi*3,B=0;B<V;B++)C0[h0+3*B+0]=Fe[B].x,C0[h0+3*B+1]=Fe[B].y,C0[h0+3*B+2]=Fe[B].z;for(B=0;B<V;B++)C0[h0+3*B+0+3*V]=We[V-1-B].x,C0[h0+3*B+1+3*V]=We[V-1-B].y,C0[h0+3*B+2+3*V]=We[V-1-B].z;for(B=0;B<2*V;++B)P0[h0+3*B+0]=U0.r,P0[h0+3*B+1]=U0.g,P0[h0+3*B+2]=U0.b;if(H>0&&!ec){for(B=0;B<V*2;B++)si=[oi+Hm[B][0],oi+Hm[B][1],oi+Hm[B][2],oi+Hm[B][3]],l0=Xe.faceidx,R0[l0]=si[0],R0[l0+1]=si[1],R0[l0+2]=si[3],R0[l0+3]=si[1],R0[l0+4]=si[2],R0[l0+5]=si[3],Xe.faceidx+=6;if(M0.clickable||M0.hoverable){var Q=[];Q.push(new i.Triangle(J[0],Fe[0],Fe[V-1])),Q.push(new i.Triangle(J[0],Fe[V-1],J[V-1])),Q.push(new i.Triangle(J[V-1],Fe[V-1],We[V-1])),Q.push(new i.Triangle(J[V-1],We[V-1],et[V-1])),Q.push(new i.Triangle(We[0],et[0],et[V-1])),Q.push(new i.Triangle(We[V-1],We[0],et[V-1])),Q.push(new i.Triangle(Fe[0],J[0],et[0])),Q.push(new i.Triangle(We[0],Fe[0],et[0]));for(B in Q)M0.intersectionShape.triangle.push(Q[B])}}Xe.vertices+=2*V}for(C0=Xe.vertexArray,P0=Xe.colorArray,R0=Xe.faceArray,oi=Xe.vertices,h0=oi*3,l0=Xe.faceidx,H=0;H<V-1;H++)si=[H,H+1,2*V-2-H,2*V-1-H],l0=Xe.faceidx,R0[l0]=si[0],R0[l0+1]=si[1],R0[l0+2]=si[3],R0[l0+3]=si[1],R0[l0+4]=si[2],R0[l0+5]=si[3],Xe.faceidx+=6;for(H=0;H<V-1;H++)si=[oi-1-H,oi-2-H,oi-2*V+H+1,oi-2*V+H],l0=Xe.faceidx,R0[l0]=si[0],R0[l0+1]=si[1],R0[l0+2]=si[3],R0[l0+3]=si[1],R0[l0+4]=si[2],R0[l0+5]=si[3],Xe.faceidx+=6}function E(O,I,N,k,U,F){if(!(I.length<2)){var j,H;if(j=I[0],H=I[I.length-1],j=u(j,k),H=u(H,k),!U)return h(O,j,H,N);var B=[],V,K,q,Te,Fe,We=[[0,2,-6,-8],[-4,-2,6,4],[7,-1,-5,3],[-3,5,1,-7]],J,et,ht,er,tr,Hm,oi,h0,l0,M0,U0,_0,C0,P0,R0,si,Xe;for(h0=0,l0=j.length;h0<l0;h0++){if(tr=Math.round(h0*(N.length-1)/l0),er=a.CC.color(N[tr]),B.push(K=j[h0]),B.push(K),B.push(q=H[h0]),B.push(q),h0<l0-1){var d0=j[h0+1].clone().sub(j[h0]),w0=H[h0].clone().sub(j[h0]);V=w0.cross(d0).normalize().multiplyScalar(U)}for(B.push(Te=j[h0].clone().add(V)),B.push(Te),B.push(Fe=H[h0].clone().add(V)),B.push(Fe),K.atom!==void 0&&(Hm=K.atom),P0=O.updateGeoGroup(8),R0=P0.vertexArray,si=P0.colorArray,Xe=P0.faceArray,J=P0.vertices,et=J*3,R0[et]=K.x,R0[et+1]=K.y,R0[et+2]=K.z,R0[et+3]=K.x,R0[et+4]=K.y,R0[et+5]=K.z,R0[et+6]=q.x,R0[et+7]=q.y,R0[et+8]=q.z,R0[et+9]=q.x,R0[et+10]=q.y,R0[et+11]=q.z,R0[et+12]=Te.x,R0[et+13]=Te.y,R0[et+14]=Te.z,R0[et+15]=Te.x,R0[et+16]=Te.y,R0[et+17]=Te.z,R0[et+18]=Fe.x,R0[et+19]=Fe.y,R0[et+20]=Fe.z,R0[et+21]=Fe.x,R0[et+22]=Fe.y,R0[et+23]=Fe.z,M0=0;M0<8;++M0)si[et+3*M0]=er.r,si[et+1+3*M0]=er.g,si[et+2+3*M0]=er.b;if(h0>0){var Q=oi!==void 0&&Hm!==void 0&&oi.serial!==Hm.serial;for(M0=0;M0<4;M0++){var it=[J+We[M0][0],J+We[M0][1],J+We[M0][2],J+We[M0][3]];if(ht=P0.faceidx,Xe[ht]=it[0],Xe[ht+1]=it[1],Xe[ht+2]=it[3],Xe[ht+3]=it[1],Xe[ht+4]=it[2],Xe[ht+5]=it[3],P0.faceidx+=6,Hm.clickable||oi.clickable||Hm.hoverable||oi.hoverable){var ec=B[it[3]].clone(),a0=B[it[0]].clone(),u0=B[it[2]].clone(),E0=B[it[1]].clone();if(ec.atom=B[it[3]].atom||null,u0.atom=B[it[2]].atom||null,a0.atom=B[it[0]].atom||null,E0.atom=B[it[1]].atom||null,Q){var O0=ec.clone().add(a0).multiplyScalar(.5),He=u0.clone().add(E0).multiplyScalar(.5),p0=ec.clone().add(E0).multiplyScalar(.5);M0%2===0?((oi.clickable||oi.hoverable)&&(U0=new i.Triangle(O0,p0,ec),_0=new i.Triangle(He,u0,p0),C0=new i.Triangle(p0,u0,ec),oi.intersectionShape.triangle.push(U0),oi.intersectionShape.triangle.push(_0),oi.intersectionShape.triangle.push(C0)),(Hm.clickable||Hm.hoverable)&&(U0=new i.Triangle(a0,E0,p0),_0=new i.Triangle(E0,He,p0),C0=new i.Triangle(a0,p0,O0),Hm.intersectionShape.triangle.push(U0),Hm.intersectionShape.triangle.push(_0),Hm.intersectionShape.triangle.push(C0))):((Hm.clickable||Hm.hoverable)&&(U0=new i.Triangle(O0,p0,ec),_0=new i.Triangle(He,u0,p0),C0=new i.Triangle(p0,u0,ec),Hm.intersectionShape.triangle.push(U0),Hm.intersectionShape.triangle.push(_0),Hm.intersectionShape.triangle.push(C0)),(oi.clickable||oi.hoverable)&&(U0=new i.Triangle(a0,E0,p0),_0=new i.Triangle(E0,He,p0),C0=new i.Triangle(a0,p0,O0),oi.intersectionShape.triangle.push(U0),oi.intersectionShape.triangle.push(_0),oi.intersectionShape.triangle.push(C0)))}else(Hm.clickable||Hm.hoverable)&&(U0=new i.Triangle(a0,E0,ec),_0=new i.Triangle(E0,u0,ec),Hm.intersectionShape.triangle.push(U0),Hm.intersectionShape.triangle.push(_0))}}}P0.vertices+=8,oi=Hm}var x0=B.length-8;for(P0=O.updateGeoGroup(8),R0=P0.vertexArray,si=P0.colorArray,Xe=P0.faceArray,J=P0.vertices,et=J*3,ht=P0.faceidx,h0=0;h0<4;h0++){B.push(B[h0*2]),B.push(B[x0+h0*2]);var L0=B[h0*2],c0=B[x0+h0*2];R0[et+6*h0]=L0.x,R0[et+1+6*h0]=L0.y,R0[et+2+6*h0]=L0.z,R0[et+3+6*h0]=c0.x,R0[et+4+6*h0]=c0.y,R0[et+5+6*h0]=c0.z,si[et+6*h0]=er.r,si[et+1+6*h0]=er.g,si[et+2+6*h0]=er.b,si[et+3+6*h0]=er.r,si[et+4+6*h0]=er.g,si[et+5+6*h0]=er.b}x0+=8,U0=[J,J+2,J+6,J+4],_0=[J+1,J+5,J+7,J+3],Xe[ht]=U0[0],Xe[ht+1]=U0[1],Xe[ht+2]=U0[3],Xe[ht+3]=U0[1],Xe[ht+4]=U0[2],Xe[ht+5]=U0[3],Xe[ht+6]=_0[0],Xe[ht+7]=_0[1],Xe[ht+8]=_0[3],Xe[ht+9]=_0[1],Xe[ht+10]=_0[2],Xe[ht+11]=_0[3],P0.faceidx+=12,P0.vertices+=8}}function m(O,I,N,k,U,F,j){(!j||j==="default")&&(j="rectangle"),j==="edged"?E(O,I,N,k,U):(j==="rectangle"||j==="oval"||j==="parabola")&&f(O,I,N,k,U,F,j)}function S(O){return O&&O.elem==="C"&&O.atom==="CA"}function w(O,I){if(O&&I&&O.chain===I.chain){if(!O.hetflag&&!I.hetflag&&O.reschain===I.reschain&&(O.resi===I.resi||O.resi===I.resi-1))return!0;if(O.resi<I.resi){var N=O.x-I.x,k=O.y-I.y,U=O.z-I.z,F=N*N+k*k+U*U;if(O.atom=="CA"&&I.atom=="CA"&&F<16)return!0;if((O.atom=="P"||I.atom=="P")&&F<64)return!0}}return!1}function v(O,I,N,k,U){if(!(I==null||I.vertices==0)){U&&(I.initTypedArrays(),I.setUpNormals());var F=new s.MeshDoubleLambertMaterial;F.vertexColors=s.Coloring.FaceColors,typeof N=="number"&&N>=0&&N<1&&(F.transparent=!0,F.opacity=N),F.outline=k;var j=new s.Mesh(I,F);O.add(j)}}function A(O,I,N,k,U,F,j,H,B){var V,K,q,Te,Fe,We;if(!(!k||!U||!j)){var J=U.sub(k);J.normalize();var et=H[B];for(K=B+1;K<H.length&&(et=H[K],et.atom!=j.atom);K++);if(et=et?new n.Vector3(et.x,et.y,et.z):new n.Vector3(0,0,0),et.sub(k),j.ss==="arrow start"){var ht=et.clone().multiplyScalar(.3).cross(U);k.add(ht);var er=et.clone().cross(J).normalize();J.rotateAboutVector(er,.43)}for(j.style.cartoon.ribbon?V=j.style.cartoon.thickness||b:j.style.cartoon.width?V=j.style.cartoon.width:j.ss==="c"?j.atom==="P"?V=y:V=g:j.ss==="arrow start"?(V=x,Fe=!0):j.ss==="arrow end"||j.ss==="h"&&j.style.cartoon.tubes||j.ss==="tube start"?V=g:V=x,F!=null&&J.dot(F)<0&&J.negate(),J.multiplyScalar(V),K=0;K<I;K++)q=-1+K*2/(I-1),Te=new n.Vector3(k.x+q*J.x,k.y+q*J.y,k.z+q*J.z),Te.atom=j,j.ss==="s"&&(Te.smoothen=!0),O[K].push(Te);if(Fe)for(J.multiplyScalar(2),K=0;K<I;K++)q=-1+K*2/(I-1),Te=new n.Vector3(k.x+q*J.x,k.y+q*J.y,k.z+q*J.z),Te.atom=j,Te.smoothen=!1,Te.skip=!0,O[K].push(Te);return We=j.style.cartoon.style||"default",O.style?O.style!=We&&(console.log("Warning: a cartoon chain's strand-style is ambiguous"),O.style="default"):O.style=We,(j.ss==="arrow start"||j.ss==="arrow end")&&(j.ss="s"),Fe}}const M={C:!0,CA:!0,O:!0,P:!0,OP2:!0,O2P:!0,"O5'":!0,"O3'":!0,"C5'":!0,"C2'":!0,"O5*":!0,"O3*":!0,"C5*":!0,"C2*":!0,N1:!0,N3:!0},T={DA:!0,DG:!0,A:!0,G:!0},R={DT:!0,DC:!0,U:!0,C:!0,T:!0},P={DA:!0,DG:!0,A:!0,G:!0,DT:!0,DC:!0,U:!0,C:!0,T:!0};function L(O,I,N,k=10){let U=k,F=k;var j,H,B,V,K,q,Te,Fe,We,J,et,ht,er,tr,Hm,oi,h0,l0,M0=new s.Geometry(!0),U0=new s.Geometry(!0),_0=[],C0=[],P0=1,R0=!1,si={};for(var Xe in o.Gradient.builtinGradients)o.Gradient.builtinGradients.hasOwnProperty(Xe)&&(si[Xe]=new o.Gradient.builtinGradients[Xe](N[1],N[0]));var d0=function(S0,W){return N&&W.color==="spectrum"?W.colorscheme in si?si[W.colorscheme].valueToHex(S0.resi):si.sinebow.valueToHex(S0.resi):(0,d.getColorFromStyle)(S0,W).getHex()};for(Fe=0;Fe<U;Fe++)C0[Fe]=[];var w0=!1,Q=!1,it=[];for(Fe in I){if(V=I[Fe],V.elem==="C"&&V.atom==="CA"){var ec=w(B,V);ec&&V.ss==="s"?w0=!0:w0&&(B&&H&&B.style.cartoon.arrows&&H.style.cartoon.arrows&&(B.ss="arrow end",H.ss="arrow start"),w0=!1),ec&&(B.ss==="h"||B.ss=="tube start")&&B.style.cartoon.tubes?!Q&&B.ss!="tube start"&&V.style.cartoon.tubes&&(V.ss="tube start",Q=!0):Q&&(B.ss==="tube start"?B.ss="tube end":H&&H.style.cartoon.tubes&&(H.ss="tube end"),Q=!1),H=B,B=V}V&&V.atom in M&&it.push(V)}Q&&B.style.cartoon.tubes&&(B.ss="tube end",Q=!1);var a0=function(S0){C0[0].length>0&&m(U0,C0,_0,F,Te,P0,C0.style);var W=[],t0=null;if(S0){for(Fe=0;Fe<U;Fe++)W[Fe]=C0[Fe][C0[Fe].length-1];t0=_0[_0.length-1]}for(C0=[],Fe=0;Fe<U;Fe++)C0[Fe]=[];if(_0=[],S0){for(Fe=0;Fe<U;Fe++)C0[Fe].push(W[Fe]);_0.push(t0)}v(O,U0,P0,R0,!0),v(O,M0,P0,R0,!1),U0=new s.Geometry(!0),M0=new s.Geometry(!0)};B=void 0;let u0=[];for(var E0=0;E0<it.length;E0++){V=it[E0];var O0=V.resn.trim(),He=O0 in P;if(P0=1,j=V.style.cartoon,B&&B.style.cartoon&&(P0=B.style.cartoon.opacity),B&&B.style.cartoon&&B.style.cartoon.outline&&(R0=B.style.cartoon.outline),B&&B.style.cartoon&&(!V.style.cartoon||B.style.cartoon.opacity!=V.style.cartoon.opacity)&&a0(B.chain==V.chain),B&&V&&!w(B,V)&&B.chain&&B.chain==V.chain&&!B.hetflag&&!V.hetflag&&B.reschain+1==V.reschain&&u0.push([B,V]),j.style==="trace"){if(!V.hetflag){if(V.elem==="C"&&V.atom==="CA"||He&&V.atom==="P"||V.atom==="BB"){if(q=d0(V,j),(0,d.isNumeric)(j.thickness)?Te=j.thickness:Te=b,w(B,V))if(q==K){var p0=a.CC.color(q);l.GLDraw.drawCylinder(M0,B,V,Te,p0,2,2)}else{var x0=new n.Vector3().addVectors(B,V).multiplyScalar(.5),L0=a.CC.color(K),c0=a.CC.color(q);l.GLDraw.drawCylinder(M0,B,x0,Te,L0,2,0),l.GLDraw.drawCylinder(M0,x0,V,Te,c0,0,2)}if((V.clickable===!0||V.hoverable)&&V.intersectionShape!==void 0){var b0=new n.Vector3(V.x,V.y,V.z);V.intersectionShape.sphere.push(new i.Sphere(b0,Te))}B=V,K=q}}}else{if(S(V)||He&&(V.atom==="P"||V.atom.indexOf("O5")==0)){if(l0)if(V.ss==="tube end")l0=!1,h0=new n.Vector3(V.x,V.y,V.z),l.GLDraw.drawCylinder(M0,oi,h0,2,a.CC.color(K),1,1),V.ss="h";else if(B.chain!=V.chain||B.ss==="tube end")l0=!1,B.ss="h",h0=new n.Vector3(B.x,B.y,B.z),l.GLDraw.drawCylinder(M0,oi,h0,2,a.CC.color(K),1,1);else continue;if(B&&(!w(B,V)||B.ss==="tube start")){for(B.ss==="tube start"&&(l0=!0,oi=new n.Vector3(B.x,B.y,B.z),B.ss="h"),Hm&&(ht?tr=new n.Vector3().addVectors(B,ht).multiplyScalar(.5):tr=new n.Vector3(B.x,B.y,B.z),l.GLDraw.drawCylinder(M0,tr,Hm,_,a.CC.color(Hm.color),0,2),A(C0,U,!0,ht,er,et,B,it,E0),_0.push(q),tr=null,Hm=null),C0[0].length>0&&m(U0,C0,_0,F,Te,P0,C0.style),C0=[],Fe=0;Fe<U;Fe++)C0[Fe]=[];_0=[]}if(B===void 0||B.rescode!=V.rescode||B.resi!=V.resi){if(Hm&&B!=null){tr=new n.Vector3().addVectors(B,V).multiplyScalar(.5);var ut=tr.clone().sub(Hm).multiplyScalar(.02);tr.add(ut),l.GLDraw.drawCylinder(M0,tr,Hm,_,a.CC.color(Hm.color),0,2),tr=null,Hm=null}q=d0(V,j),_0.push(q),(0,d.isNumeric)(j.thickness)?Te=j.thickness:Te=b,B=V,We=new n.Vector3(B.x,B.y,B.z),We.resi=B.resi,K=q}(V.clickable===!0||V.hoverable===!0)&&(V.intersectionShape===void 0||V.intersectionShape.triangle===void 0)&&(V.intersectionShape={sphere:null,cylinder:[],line:[],triangle:[]})}else B!=null&&(S(B)&&V.atom==="O"||He&&B.atom==="P"&&(V.atom==="OP2"||V.atom==="O2P")||He&&B.atom.indexOf("O5")==0&&V.atom.indexOf("C5")==0)?(J=new n.Vector3(V.x,V.y,V.z),J.resi=V.resi,(V.atom==="OP2"||V.atom==="O2P")&&(er=new n.Vector3(V.x,V.y,V.z))):He&&V.atom.indexOf("O3")==0?ht=new n.Vector3(V.x,V.y,V.z):(V.atom==="N1"&&O0 in T||V.atom==="N3"&&O0 in R)&&(Hm=new n.Vector3(V.x,V.y,V.z),Hm.color=(0,d.getColorFromStyle)(V,j).getHex());J&&We&&J.resi===We.resi&&(A(C0,U,!0,We,J,et,B,it,E0),et=J,We=null,J=null,_0.push(q))}}Hm&&(ht?tr=new n.Vector3().addVectors(B,ht).multiplyScalar(.5):tr=new n.Vector3(B.x,B.y,B.z),l.GLDraw.drawCylinder(M0,tr,Hm,_,a.CC.color(Hm.color),0,2),A(C0,U,!0,ht,er,et,B,it,E0),_0.push(q)),a0(!1);var hi=function(S0,W){if(S0.style.cartoon.gapcutoff&&S0.style.cartoon.gapcutoff==W.style.cartoon.gapcutoff){let o0=S0.style.cartoon.gapcutoff,Ji=W.resi-S0.resi;if(Ji>0&&Ji<o0){let m0=.25,I0=W.x-S0.x,Z=W.y-S0.y,at=W.z-S0.z,lt=Math.sqrt(I0*I0+Z*Z+at*at),n0=lt/(2*Ji),r0=new n.Vector3(S0.x,S0.y,S0.z),f0=lt/n0,v0=new n.Vector3((W.x-S0.x)/f0,(W.y-S0.y)/f0,(W.z-S0.z)/f0);r0.add({x:v0.x/2,y:v0.y/2,z:v0.z/2});let A0=r0.clone().add(v0);v0.multiplyScalar(2);let X0=(0,d.extend)({},S0);for(var t0=0;t0<Ji;t0++){X0.resi+=1;let q0=d0(X0,X0.style.cartoon);l.GLDraw.drawCylinder(M0,r0,A0,m0,a.CC.color(q0),l.CAP.FLAT,l.CAP.FLAT),r0.add(v0),A0.add(v0)}a0(!1)}}};for(let S0 of u0)hi(S0[0],S0[1])}}),"./src/index.ts":((r,e,t)=>{t.r(e),t.d(e,{CAP:()=>n.CAP,CC:()=>n.CC,CONTEXTS_PER_VIEWPORT:()=>n.CONTEXTS_PER_VIEWPORT,Color:()=>n.Color,CustomLinear:()=>n.CustomLinear,Cylinder:()=>n.Cylinder,GLDraw:()=>n.GLDraw,GLModel:()=>n.GLModel,GLShape:()=>n.GLShape,GLViewer:()=>n.GLViewer,GLVolumetricRender:()=>n.GLVolumetricRender,Gradient:()=>n.Gradient,GradientType:()=>n.GradientType,Label:()=>n.Label,LabelCount:()=>n.LabelCount,MarchingCube:()=>n.MarchingCube,MarchingCubeInitializer:()=>n.MarchingCubeInitializer,Matrix3:()=>n.Matrix3,Matrix4:()=>n.Matrix4,Parsers:()=>n.Parsers,PausableTimer:()=>n.PausableTimer,PointGrid:()=>n.PointGrid,ProteinSurface:()=>n.ProteinSurface,Quaternion:()=>n.Quaternion,ROYGB:()=>n.ROYGB,RWB:()=>n.RWB,Ray:()=>n.Ray,Sinebow:()=>n.Sinebow,Sphere:()=>n.Sphere,SurfaceType:()=>n.SurfaceType,Triangle:()=>n.Triangle,Vector2:()=>n.Vector2,Vector3:()=>n.Vector3,VolumeData:()=>n.VolumeData,adjustVolumeStyle:()=>n.adjustVolumeStyle,applyPartialCharges:()=>n.applyPartialCharges,autoinit:()=>n.autoinit,autoload:()=>n.autoload,base64ToArray:()=>n.base64ToArray,bondLength:()=>n.bondLength,builtinColorSchemes:()=>n.builtinColorSchemes,builtinGradients:()=>n.builtinGradients,chains:()=>n.chains,clamp:()=>n.clamp,conversionMatrix3:()=>n.conversionMatrix3,createStereoViewer:()=>n.createStereoViewer,createViewer:()=>n.createViewer,createViewerGrid:()=>n.createViewerGrid,deepCopy:()=>n.deepCopy,degToRad:()=>n.degToRad,download:()=>n.download,drawCartoon:()=>n.drawCartoon,elementColors:()=>n.elementColors,extend:()=>n.extend,get:()=>n.get,getAtomProperty:()=>n.getAtomProperty,getColorFromStyle:()=>n.getColorFromStyle,getElement:()=>n.getElement,getExtent:()=>n.getExtent,getGradient:()=>n.getGradient,getPropertyRange:()=>n.getPropertyRange,getbin:()=>n.getbin,htmlColors:()=>n.htmlColors,inflateString:()=>n.inflateString,isEmptyObject:()=>n.isEmptyObject,isNumeric:()=>n.isNumeric,makeFunction:()=>n.makeFunction,mergeGeos:()=>n.mergeGeos,normalizeValue:()=>n.normalizeValue,partialCharges:()=>n.partialCharges,processing_autoinit:()=>n.processing_autoinit,residues:()=>n.residues,setBondLength:()=>n.setBondLength,setSyncSurface:()=>n.setSyncSurface,specStringToObject:()=>n.specStringToObject,splitMesh:()=>n.splitMesh,ssColors:()=>n.ssColors,subdivide_spline:()=>n.subdivide_spline,syncSurface:()=>n.syncSurface,viewers:()=>n.viewers});var n=t("./src/3Dmol.ts");window&&(window.$3Dmol=e)}),"./src/parsers/BCIF.ts":((r,e,t)=>{t.r(e),t.d(e,{BCIF:()=>b});var n=t("./src/utilities.ts"),i=t("./src/parsers/utils/computeSecondaryStructure.ts"),s=t("./src/parsers/utils/processSymmetries.ts"),o=t("./src/parsers/cifutils/category.ts"),a=t("./src/parsers/utils/assignPDBBonds.ts"),l=t("./src/WebGL/index.ts"),d=t("./src/parsers/utils/isEmpty.ts"),u=t("./src/vendor/mmtf.js");class g{constructor(h){if(this.C={},h){let f=h.getField("comp_id"),E=h.getField("atom_id_1"),m=h.getField("atom_id_2"),S=h.getField("value_order");for(let w=0;w<f.length;w++){let v=f[w],A=E[w],M=m[w],T=S[w],R=1;T=="doub"?R=2:T=="trip"&&(R=3),this.C[v]==null&&(this.C[v]={}),this.C[v][A]==null&&(this.C[v][A]={}),this.C[v][M]==null&&(this.C[v][M]={}),this.C[v][A][M]=R,this.C[v][M][A]=R}}}order(h,f,E){return this.C[h]!==void 0&&this.C[h][f]!==void 0&&this.C[h][f][E]!==void 0?this.C[h][f][E]:0}}class x{constructor(h){if(this.C=[],h){let f=h.getField("conn_type_id"),E=h.getField("ptnr1_label_asym_id"),m=h.getField("ptnr1_label_seq_id"),S=h.getField("ptnr1_label_comp_id"),w=h.getField("ptnr1_label_atom_id"),v=h.getField("ptnr2_label_asym_id"),A=h.getField("ptnr2_label_seq_id"),M=h.getField("ptnr2_label_comp_id"),T=h.getField("ptnr2_label_atom_id"),R=h.getField("pdbx_value_order");for(let P=0;P<f.length;P++)if(f[P]=="disulf"||f[P]=="covale"){let L=R?R[P]==""?1:parseInt(R[P]):1;this.C.push([[E[P],m[P],S[P],w[P]],[v[P],A[P],M[P],T[P]],L])}}}}class y{constructor(){this.R={}}add(h){this.R[h.lchain]==null&&(this.R[h.lchain]={}),this.R[h.lchain][h.lresi]==null&&(this.R[h.lchain][h.lresi]={}),this.R[h.lchain][h.lresi][h.lresn]==null&&(this.R[h.lchain][h.lresi][h.lresn]=[]),this.R[h.lchain][h.lresi][h.lresn].push(h),this.R[h.lchain][h.lresi][h.lresn][h.atom]=h}geta([h,f,E,m]){if(this.R[h]!==void 0&&this.R[h][f]!==void 0&&this.R[h][f][E]!==void 0)return this.R[h][f][E][m]}setBonds(h,f){for(let E in this.R)for(let m in this.R[E])for(let S in this.R[E][m]){let w=this.R[E][m][S];for(let v=0;v<w.length;v++)for(let A=v+1;A<w.length;A++){let M=w[v],T=w[A],R=h.order(S,M.atom,T.atom);M.altLoc!=T.altLoc&&M.altLoc!=""&&T.altLoc!=""&&(R=0),R>0&&(M.bonds.push(T.index),T.bonds.push(M.index),M.bondOrder.push(R),T.bondOrder.push(R))}}for(let E of f.C){let m=E[0],S=E[1],w=E[2],v=this.geta(m),A=this.geta(S);v!=null&&A!=null&&(v.bonds.push(A.index),A.bonds.push(v.index),v.bondOrder.push(w),A.bondOrder.push(w))}}}function b(_,h){var f=!h.keepH,E=h.altLoc?h.altLoc:"A",m=!h.noComputeSecondaryStructure;const S=!h.doAssembly,w=h.assignBonds===void 0?!0:h.assignBonds;if(typeof _=="string")try{_=(0,n.base64ToArray)(_)}catch{_=new TextEncoder().encode(_)}else _=new Uint8Array(_);var v=u.decodeMsgpack(_);v==31&&(_=(0,n.inflateString)(_,!1),v=u.decodeMsgpack(_));var A=[],M=A.modelData=[],T=v.dataBlocks.length;if(T==0)return A;h.multimodel||(T=1);for(let R=0;R<T;R++){let P=A.length;const L=[];M.push({symmetries:[]}),A.push([]);const O=v.dataBlocks[R],I=Object.create(null);for(const si of O.categories)I[si.name.substr(1)]=(0,o.Category)(si);let N={},k=I.struct_conf;if(k){let si=k.getField("conf_type_id"),Xe=k.getField("beg_label_asym_id"),d0=k.getField("beg_label_seq_id"),w0=k.getField("end_label_seq_id");for(let Q=0;Q<si.length;Q++)if(si[Q].startsWith("H")){let it=Xe[Q],ec=d0[Q],a0=w0[Q];it in N||(N[it]={}),N[it][ec]="h1";for(let u0=ec+1;u0<a0;u0++)N[it][u0]="h";N[it][a0]="h2"}}let U=I.struct_sheet_range;if(U){let si=U.getField("id"),Xe=U.getField("beg_label_asym_id"),d0=U.getField("beg_label_seq_id"),w0=U.getField("end_label_seq_id");for(let Q=0;Q<si.length;Q++){let it=Xe[Q],ec=d0[Q],a0=w0[Q];it in N||(N[it]={}),N[it][ec]="s1";for(let u0=ec+1;u0<a0;u0++)N[it][u0]="s";N[it][a0]="s2"}}let F=I.pdbx_struct_oper_list,j=F.getField("id");if(j&&!S){let si=F.getField("matrix[1][1]"),Xe=F.getField("matrix[1][2]"),d0=F.getField("matrix[1][3]"),w0=F.getField("matrix[2][1]"),Q=F.getField("matrix[2][2]"),it=F.getField("matrix[2][3]"),ec=F.getField("matrix[3][1]"),a0=F.getField("matrix[3][2]"),u0=F.getField("matrix[3][3]"),E0=F.getField("vector[1]"),O0=F.getField("vector[2]"),He=F.getField("vector[3]");for(let p0=0;p0<j.length;p0++){const x0=new l.Matrix4(si[p0],Xe[p0],d0[p0],E0[p0],w0[p0],Q[p0],it[p0],O0[p0],ec[p0],a0[p0],u0[p0],He[p0]);M[M.length-1].symmetries.push(x0)}}let H=new g(I.chem_comp_bond),B=new y,V=new x(I.struct_conn),K=I.atom_site,q=K.rowCount,Te=K.getField("group_PDB"),Fe=K.getField("Cartn_x"),We=K.getField("Cartn_y"),J=K.getField("Cartn_z"),et=K.getField("auth_asym_id"),ht=K.getField("label_asym_id"),er=K.getField("auth_seq_id"),tr=K.getField("label_seq_id"),Hm=K.getField("auth_comp_id"),oi=K.getField("label_comp_id"),h0=K.getField("auth_atom_id"),l0=K.getField("label_atom_id"),M0=K.getField("type_symbol"),U0=K.getField("B_iso_or_equiv"),_0=K.getField("id"),C0=K.getField("label_alt_id"),P0=K.getField("pdbx_PDB_model_num"),R0=P0?P0[0]:0;for(let si=0;si<q;si++){if(Te!==void 0&&Te[si]==="TER")continue;if(P0&&P0[si]!=R0)if(R0=P0[si],h.multimodel)h.onemol||(A.push([]),M.push(M[M.length-1]),R0=P0[si],B.setBonds(H,V),B=new y);else break;const Xe={};Xe.x=Fe[si],Xe.y=We[si],Xe.z=J[si],Xe.chain=et?et[si]:ht?ht[si]:void 0,Xe.lchain=ht?ht[si]:void 0,Xe.resi=er?er[si]:tr?tr[si]:void 0,Xe.lresi=tr?tr[si]:void 0,Xe.resn=Hm?Hm[si].trim():oi?oi[si].trim():void 0,Xe.lresn=oi?oi[si].trim():void 0,Xe.atom=h0?h0[si].replace(/"/gm,""):l0?l0[si].replace(/"/gm,""):void 0,Xe.icode=C0?C0[si]:void 0,Xe.altLoc=Xe.icode,Xe.hetflag=!Te||Te[si]==="HETA"||Te[si]==="HETATM";let d0="X";M0&&(d0=M0[si].replace(/\(?\+?\d+.*/,"")),Xe.elem=d0[0].toUpperCase()+d0.substring(1,2).toLowerCase(),U0&&(Xe.b=U0[si]),!(f&&Xe.elem=="H")&&(Xe.altLoc!=""&&Xe.altLoc!=E&&E!="*"||(Xe.bonds=[],Xe.ss="c",Xe.serial=_0[si],Xe.model=R0,Xe.bondOrder=[],Xe.properties={},Xe.index=A[A.length-1].length,L[Xe.serial]=[A.length,Xe.index],A[A.length-1].push(Xe),B.add(Xe)))}if(B.setBonds(H,V),!(0,d.isEmpty)(N))for(let si=P;si<A.length;si++){let Xe=A[si];for(let d0=0;d0<Xe.length;d0++){const w0=Xe[d0];if(w0!==void 0&&w0.lchain in N&&w0.lresi in N[w0.lchain]){const Q=N[w0.lchain][w0.lresi];w0.ss=Q[0],Q.length>1&&(Q[1]=="1"?w0.ssbegin=!0:Q[1]=="2"&&(w0.ssend=!0))}}}h.multimodel&&R<T-1&&(h.onemol||(A.push([]),M.push({symmetries:[]})))}for(let R=0;R<A.length;R++)w&&!(h.duplicateAssemblyAtoms&&!h.dontConnectDuplicatedAtoms)&&(0,a.assignPDBBonds)(A[R],h),m&&(0,i.computeSecondaryStructure)(A[R],h.hbondCutoff),(0,s.processSymmetries)(M[R].symmetries,A[R],h,M[R].cryst),h.duplicateAssemblyAtoms&&!h.dontConnectDuplicatedAtoms&&w&&(0,a.assignPDBBonds)(A[R],h);return A}}),"./src/parsers/CDJSON.ts":((r,e,t)=>{t.r(e),t.d(e,{CDJSON:()=>n});function n(i,s){var o=[[]];typeof i=="string"&&(i=JSON.parse(i));for(var a=i.m,l=a[0].a,d=a[0].b,u=a[0].s,g=s!==void 0&&s.parseStyle!==void 0?s.parseStyle:u!==void 0,x=o[o.length-1].length,y=0;y<l.length;y++){var b=l[y],_={};_.id=b.i,_.x=b.x,_.y=b.y,_.z=b.z||0,_.bonds=[],_.bondOrder=[];var h=b.l||"C";_.elem=h[0].toUpperCase()+h.substring(1).toLowerCase(),_.serial=o[o.length-1].length,g&&(_.style=u[b.s||0]),o[o.length-1].push(_)}for(let f=0;f<d.length;f++){let E=d[f],m=E.b+x,S=E.e+x,w=E.o||1,v=o[o.length-1][m],A=o[o.length-1][S];v.bonds.push(S),v.bondOrder.push(w),A.bonds.push(m),A.bondOrder.push(w)}return o}}),"./src/parsers/CIF.ts":((r,e,t)=>{t.r(e),t.d(e,{CIF:()=>l});var n=t("./src/parsers/utils/computeSecondaryStructure.ts"),i=t("./src/parsers/utils/processSymmetries.ts"),s=t("./src/WebGL/index.ts"),o=t("./src/parsers/utils/assignPDBBonds.ts");const a=function(d,u,g,x){return new s.Vector3(u,g,x).applyMatrix3(d)};function l(d,u={}){const g=[],x=!u.doAssembly,y=g.modelData=[],b=u.assignBonds===void 0?!0:u.assignBonds;function _(w,v){const A=[];let M=0,T=0;for(;T<w.length;){for(;w.substring(T,T+v.length)!==v&&T<w.length;)if(w[T]==="'"){for(T++;T<w.length&&w[T]!=="'";)T++;for(;w.substring(T,T+v.length)!==v&&T<w.length;)T++}else if(w[T]==='"'){for(T++;T<w.length&&w[T]!=='"';)T++;T++}else T++;A.push(w.substring(M,T)),M=T=T+v.length}return A}const h=d.split(/\r?\n|\r/),f=[];let E=!1;for(let w=0;w<h.length;w++){var m=h[w].split("#")[0];if(E?m[0]===";"&&(E=!1):m[0]===";"&&(E=!0),E||m!==""){if(!E&&(m=m.trim(),m[0]==="_")){const v=m.split(/\s/)[0].indexOf(".");if(v>-1){let A=m.split("");A[v]="_",m=A.join(""),m=m.substring(0,v)+"_"+m.substring(v+1)}}f.push(m)}}let S=0;for(;S<f.length;){for(;!f[S].startsWith("data_")||f[S]==="data_global";)S++;S++;const w={};for(;S<f.length&&!f[S].startsWith("data_");)if(f[S][0]===void 0)S++;else if(f[S][0]==="_"){const T=f[S].split(/\s/)[0].toLowerCase(),R=w[T]=w[T]||[],P=f[S].substring(f[S].indexOf(T)+T.length);if(P==="")if(S++,f[S][0]===";"){let L=f[S].substring(1);for(S++;f[S]!==";";)L=L+`
`+f[S],S++;R.push(L)}else R.push(f[S]);else R.push(P.trim());S++}else if(f[S].substring(0,5)==="loop_"){S++;const T=[];for(;f[S]===""||f[S][0]==="_";){if(f[S]!==""){let P=f[S].split(/\s/)[0].toLowerCase(),L=w[P]=w[P]||[];T.push(L)}S++}let R=0;for(;S<f.length&&f[S][0]!=="_"&&!f[S].startsWith("loop_")&&!f[S].startsWith("data_");){let P=_(f[S]," ");for(let L=0;L<P.length;L++)P[L]!==""&&(T[R].push(P[L]),R=(R+1)%T.length);S++}}else S++;y.push({symmetries:[]}),g.push([]);const v=w._atom_site_id!==void 0?w._atom_site_id.length:w._atom_site_label.length;let A;if(w._cell_length_a!==void 0){const T=parseFloat(w._cell_length_a),R=parseFloat(w._cell_length_b),P=parseFloat(w._cell_length_c),L=parseFloat(w._cell_angle_alpha)||90,O=parseFloat(w._cell_angle_beta)||90,I=parseFloat(w._cell_angle_gamma)||90;A=(0,s.conversionMatrix3)(T,R,P,L,O,I),y[y.length-1].cryst={a:T,b:R,c:P,alpha:L,beta:O,gamma:I}}for(let T=0;T<v;T++){if(w._atom_site_group_pdb!==void 0&&w._atom_site_group_pdb[T]==="TER")continue;const R={};if(w._atom_site_cartn_x!==void 0)R.x=parseFloat(w._atom_site_cartn_x[T]),R.y=parseFloat(w._atom_site_cartn_y[T]),R.z=parseFloat(w._atom_site_cartn_z[T]);else{const L=a(A,parseFloat(w._atom_site_fract_x[T]),parseFloat(w._atom_site_fract_y[T]),parseFloat(w._atom_site_fract_z[T]));R.x=L.x,R.y=L.y,R.z=L.z}R.chain=w._atom_site_auth_asym_id?w._atom_site_auth_asym_id[T]:w._atom_site_label_asym_id?w._atom_site_label_asym_id[T]:void 0,R.lchain=w._atom_site_label_asym_id?w._atom_site_label_asym_id[T]:void 0,R.resi=w._atom_site_auth_seq_id?parseInt(w._atom_site_auth_seq_id[T]):w._atom_site_label_seq_id?w._atom_site_label_seq_id[T]:void 0,R.resn=w._atom_site_auth_comp_id?w._atom_site_auth_comp_id[T].trim():w._atom_site_label_comp_id?w._atom_site_label_comp_id[T].trim():void 0,R.atom=w._atom_site_auth_atom_id?w._atom_site_auth_atom_id[T].replace(/"/gm,""):w._atom_site_label_atom_id?w._atom_site_label_atom_id[T].replace(/"/gm,""):void 0,R.hetflag=!w._atom_site_group_pdb||w._atom_site_group_pdb[T]==="HETA"||w._atom_site_group_pdb[T]==="HETATM",w._atom_site_b_iso_or_equiv&&(R.b=parseFloat(w._atom_site_b_iso_or_equiv[T]));let P="X";w._atom_site_type_symbol?P=w._atom_site_type_symbol[T].replace(/\(?\+?\d+.*/,""):w._atom_site_label&&(P=w._atom_site_label[T].split("_")[0].replace(/\(?\d+.*/,"")),R.elem=P[0].toUpperCase()+P.substring(1,2).toLowerCase(),R.bonds=[],R.ss="c",R.serial=T,R.bondOrder=[],R.properties={},g[g.length-1].push(R)}if(w._pdbx_struct_oper_list_id!==void 0&&!x)for(let T=0;T<w._pdbx_struct_oper_list_id.length;T++){const R=parseFloat(w["_pdbx_struct_oper_list_matrix[1][1]"][T]),P=parseFloat(w["_pdbx_struct_oper_list_matrix[1][2]"][T]),L=parseFloat(w["_pdbx_struct_oper_list_matrix[1][3]"][T]),O=parseFloat(w["_pdbx_struct_oper_list_vector[1]"][T]),I=parseFloat(w["_pdbx_struct_oper_list_matrix[2][1]"][T]),N=parseFloat(w["_pdbx_struct_oper_list_matrix[2][2]"][T]),k=parseFloat(w["_pdbx_struct_oper_list_matrix[2][3]"][T]),U=parseFloat(w["_pdbx_struct_oper_list_vector[2]"][T]),F=parseFloat(w["_pdbx_struct_oper_list_matrix[3][1]"][T]),j=parseFloat(w["_pdbx_struct_oper_list_matrix[3][2]"][T]),H=parseFloat(w["_pdbx_struct_oper_list_matrix[3][3]"][T]),B=parseFloat(w["_pdbx_struct_oper_list_vector[3]"][T]),V=new s.Matrix4(R,P,L,O,I,N,k,U,F,j,H,B);y[y.length-1].symmetries.push(V)}const M=function(T){const R=T.match("-");T=T.replace(/[-xyz]/g,"");const P=T.split("/");let L,O;return P[1]===void 0?O=1:O=parseInt(P[1]),P[0]===""?L=1:L=parseInt(P[0]),L/O*(R?-1:1)};if(w._symmetry_equiv_pos_as_xyz!==void 0&&!x)for(let T=0;T<w._symmetry_equiv_pos_as_xyz.length;T++){const P=w._symmetry_equiv_pos_as_xyz[T].replace(/["' ]/g,"").split(",").map(function(N){return N.replace(/-/g,"+-")});let L=new s.Matrix4(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1);for(let N=0;N<3;N++){const k=P[N].split("+");for(let U=0;U<k.length;U++){const F=k[U];if(F==="")continue;const j=M(F);F.match("x")?L.elements[N+0]=j:F.match("y")?L.elements[N+4]=j:F.match("z")?L.elements[N+8]=j:L.elements[N+12]=j}}const O=A.getMatrix4(),I=new s.Matrix4().getInverse(O,!0);L=new s.Matrix4().multiplyMatrices(L,I),L=new s.Matrix4().multiplyMatrices(O,L),y[y.length-1].symmetries.push(L)}}for(let w=0;w<g.length;w++)b&&!(u.duplicateAssemblyAtoms&&!u.dontConnectDuplicatedAtoms)&&(0,o.assignPDBBonds)(g[w],u),(0,n.computeSecondaryStructure)(g[w],u.hbondCutoff),(0,i.processSymmetries)(y[w].symmetries,g[w],u,y[w].cryst),u.duplicateAssemblyAtoms&&!u.dontConnectDuplicatedAtoms&&b&&(0,o.assignPDBBonds)(g[w],u);return g}}),"./src/parsers/CUBE.ts":((r,e,t)=>{t.r(e),t.d(e,{CUBE:()=>o});var n=t("./src/WebGL/index.ts"),i=t("./src/parsers/utils/assignBonds.ts"),s=t("./src/parsers/utils/anumToSymbol.ts");function o(a,l){l=l||{};const d=[[]];let u=a.split(/\r?\n/);const g=l.assignBonds===void 0?!0:l.assignBonds;if(u.length<6)return d;let x=u[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const y=Math.abs(parseFloat(x[0]));let b={origin:void 0,size:void 0,unit:void 0,matrix4:void 0,matrix:void 0};const _=b.origin=new n.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3]));x=u[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),x=u[3].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const h=x[0]>0?.529177:1;_.multiplyScalar(h);const f=Math.abs(x[0]),E=new n.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(h);x=u[4].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const m=Math.abs(x[0]),S=new n.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(h);x=u[5].replace(/^\s+/,"").replace(/\s+/g," ").split(" ");const w=Math.abs(x[0]),v=new n.Vector3(parseFloat(x[1]),parseFloat(x[2]),parseFloat(x[3])).multiplyScalar(h);if(b.size={x:f,y:m,z:w},b.unit=new n.Vector3(E.x,S.y,v.z),E.y!=0||E.z!=0||S.x!=0||S.z!=0||v.x!=0||v.y!=0){b.matrix4=new n.Matrix4(E.x,S.x,v.x,0,E.y,S.y,v.y,0,E.z,S.z,v.z,0,0,0,0,1);let O=new n.Matrix4().makeTranslation(_.x,_.y,_.z);b.matrix4=b.matrix4.multiplyMatrices(O,b.matrix4),b.matrix=b.matrix4.matrix3FromTopLeft(),b.origin=new n.Vector3(0,0,0),b.unit=new n.Vector3(1,1,1)}d.modelData=[{cryst:b}],u=u.splice(6,y);for(var A=d[d.length-1].length,M=A+u.length,T=A;T<M;++T){var R={};R.serial=T;var P=u[T-A],L=P.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");R.elem=s.anumToSymbol[L[0]],R.x=parseFloat(L[2])*h,R.y=parseFloat(L[3])*h,R.z=parseFloat(L[4])*h,R.hetflag=!0,R.bonds=[],R.bondOrder=[],R.properties={},d[d.length-1].push(R)}if(g)for(let O=0;O<d.length;O++)(0,i.assignBonds)(d[O],l);return d}}),"./src/parsers/GRO.ts":((r,e,t)=>{t.r(e),t.d(e,{GRO:()=>s});var n=t("./src/parsers/utils/assignPDBBonds.ts"),i=t("./src/parsers/utils/atomNameToElem.ts");function s(o,a){const l=[],d=o.split(/\r?\n|\r/);for(;d.length>0;){const u=parseInt(d[1]);if(d.length<3||isNaN(u)||u<=0||d.length<u+3)break;const x=[];l.push(x);let y=2;const b=x.length,_=b+u;for(let h=b;h<_;h++){const f=d[y++],E={};E.serial=h,E.atom=f.slice(10,15).trim(),E.elem=(0,i.atomNameToElem)(E.atom,!0),E.x=10*parseFloat(f.slice(20,28)),E.y=10*parseFloat(f.slice(28,36)),E.z=10*parseFloat(f.slice(36,44)),E.resi=parseInt(f.slice(0,5)),E.resn=f.slice(5,10).trim(),E.bonds=[],E.bondOrder=[],E.properties={},f.length>44&&(E.dx=10*parseFloat(f.slice(44,52)),E.dy=10*parseFloat(f.slice(52,60)),E.dz=10*parseFloat(f.slice(60,68))),x[h]=E}if(d.length<=y+3){const f=d[y++].trim().split(/\s+/);if(f.length===3){for(let E=0;E<3;E++)f[E]=(parseFloat(f[E])*10).toString();l.box=f}}d.splice(0,++y)}for(let u=0;u<l.length;u++)(0,n.assignPDBBonds)(l[u],a);return l}}),"./src/parsers/LAMMPSTRJ.ts":((r,e,t)=>{t.r(e),t.d(e,{LAMMPSTRJ:()=>s});var n=t("./src/parsers/utils/assignBonds.ts");const i={id:"serial",type:"atom",element:"elem",q:"charge",radius:"radius",x:"x",xu:"x",xs:"x",xsu:"x",y:"y",yu:"y",ys:"y",ysu:"y",z:"z",zu:"z",zs:"z",zsu:"z"};function s(o,a){const l=[],d=o.split(/\r?\n|\r/);let u=0,g=0,x=0;for(;x<d.length-9;){for(var y=x;y<d.length;y++)if(d[y].match(/ITEM: NUMBER OF ATOMS/)&&(g=parseInt(d[y+1])),d[y].match(/ITEM: ATOMS/)){u=y+1;break}const b=d[u-1].replace("ITEM: ATOMS ","").split(" ");l.push([]);for(let _=u;_<u+g;_++){const h={},f={},E=d[_].split(" ");for(let m=0;m<E.length;m++){const S=i[b[m]];S!==void 0&&(S==="serial"?h[S]=parseInt(E[m]):S==="x"||S==="y"||S==="z"?h[S]=parseFloat(E[m]):S==="charge"||S==="radius"?f[S]=parseFloat(E[m]):h[S]=E[m]),h.properties=f,h.bonds=[],h.bondOrder=[]}l[l.length-1][_-u]=h}x=u+g-1}if(a.assignBonds)for(let b=0;b<l.length;b++)(0,n.assignBonds)(l[b],a);return l}}),"./src/parsers/MMTF.ts":((r,e,t)=>{t.r(e),t.d(e,{MMTFparser:()=>g});var n=t("./src/utilities.ts"),i=t("./src/WebGL/index.ts"),s=t("./src/parsers/utils/computeSecondaryStructure.ts"),o=t("./src/parsers/utils/processSymmetries.ts"),a=t("./src/vendor/mmtf.js"),l=function(x){return String.fromCharCode.apply(null,x).replace(/\0/g,"")},d=function(x){return x==0||x==2||x==4?"h":x==3?"s":"c"};let u=new Set(["D-SACCHARIDE","D-SACCHARIDE 1,4 AND 1,4 LINKING","D-SACCHARIDE 1,4 AND 1,6 LINKING","L-SACCHARIDE","L-SACCHARIDE 1,4 AND 1,4 LINKING","L-SACCHARIDE 1,4 AND 1,6 LINKING","NON-POLYMER","OTHER","PEPTIDE-LIKE","SACCHARIDE"]);function g(x,y){var b=!y.keepH,_=y.altLoc?y.altLoc:"A",h=!!y.noSecondaryStructure,f=!y.noComputeSecondaryStructure,E=!y.doAssembly,m=y.assemblyIndex?y.assemblyIndex:0;typeof x=="string"?x=(0,n.base64ToArray)(x):x=new Uint8Array(x);var S=a.decode(x),w=[[]],v=w.modelData=[],A=0,M=0,T=0,R=S.secStructList,P=S.bFactorList,L=S.altLocList,O=S.occupancyList,I=S.bondAtomList,N=S.bondOrderList,k=S.numModels;if(k==0)return w;y.multimodel||(k=1);var U,F,j,H,B,V,K=[];if(!E&&S.bioAssemblyList&&S.bioAssemblyList.length>0){var q=S.bioAssemblyList[m].transformList;for(U=0,V=q.length;U<V;U++){var Te=new i.Matrix4(q[U].matrix);Te.transpose(),K.push(Te)}}var Fe=null;if(S.unitCell){var We=S.unitCell;Fe={a:We[0],b:We[1],c:We[2],alpha:We[3],beta:We[4],gamma:We[5]}}let J=[];S.entityList.forEach(o0=>{o0.chainIndexList.forEach(Ji=>{J[Ji]=o0.type=="polymer"})});var et=0;for(B=0;B<k;B++){var ht=S.chainsPerModel[B],er=w[w.length-1],tr=[];for(v.push({symmetries:K,cryst:Fe}),U=0;U<ht;++U){var Hm=S.groupsPerChain[A],oi=l(S.chainIdList.subarray(A*4,A*4+4));S.chainNameList&&(oi=l(S.chainNameList.subarray(A*4,A*4+4)));var h0=M,l0="";for(F=0;F<Hm;++F){var M0=S.groupList[S.groupTypeList[M]],U0=M0.atomNameList.length,_0=0,C0=!1,P0=!1;if(R){_0=R[M];var R0=d(_0);(M==0||R0!=l0)&&(C0=!0),l0=R0;var si=M+1;(si>=R.length||d(R[si]!=R0))&&(P0=!0)}var Xe=S.groupIdList[M],d0=M0.groupName;let o0=M0.chemCompType;var w0=T;let Ji=u.has(o0)||!J[A];for(j=0;j<U0;++j){var Q=M0.elementList[j];if(b&&Q=="H"){T+=1;continue}var it="";P&&(it=P[T]);var ec="";L&&L[T]&&(ec=String.fromCharCode(L[T]));var a0="";if(O&&(a0=O[T]),ec!=""&&ec!=_&&_!="*"){T+=1;continue}var u0=S.atomIdList[T],E0=M0.atomNameList[j],O0=0;M0.atomChargeList&&(O0=M0.atomChargeList[j]);var He=S.xCoordList[T],p0=S.yCoordList[T],x0=S.zCoordList[T];tr[T]=er.length,er.push({resn:d0,x:He,y:p0,z:x0,elem:Q,hetflag:Ji,chain:oi,resi:Xe,icode:ec,rescode:Xe+(ec!=" "?"^"+ec:""),serial:u0,altLoc:ec,index:T,atom:E0,bonds:[],ss:d(_0),ssbegin:C0,ssend:P0,bondOrder:[],properties:{charge:O0,occupancy:a0},b:it}),T+=1}var L0=M0.bondAtomList;for(j=0,H=M0.bondOrderList.length;j<H;++j){var c0=w0+L0[j*2],b0=w0+L0[j*2+1],ut=M0.bondOrderList[j],hi=tr[c0],S0=tr[b0],W=er[hi],t0=er[S0];W&&t0&&(W.bonds.push(S0),W.bondOrder.push(ut),t0.bonds.push(hi),t0.bondOrder.push(ut))}M+=1}for(M=h0,F=0;F<Hm;++F)M+=1;A+=1}if(I)for(let o0=et,Ji=I.length;o0<Ji;o0+=2){let m0=I[o0],I0=I[o0+1],Z=N?N[o0/2]:1;if(m0>=T){et=o0;break}let at=tr[m0],lt=tr[I0],n0=er[at],r0=er[lt];n0&&r0&&(n0.bonds.push(lt),n0.bondOrder.push(Z),r0.bonds.push(at),r0.bondOrder.push(Z))}y.multimodel&&(y.onemol||w.push([]))}if(!E)for(let o0=0;o0<w.length;o0++)(0,o.processSymmetries)(v[o0].symmetries,w[o0],y,v[o0].cryst);return f&&!h&&(0,s.computeSecondaryStructure)(w,y.hbondCutoff),w}}),"./src/parsers/MOL2.ts":((r,e,t)=>{t.r(e),t.d(e,{MOL2:()=>i});let n={"C.1":"C",C1:"C","C.2":"C",C2:"C","C.3":"C",C3:"C","C.ar":"C",Car:"C","C.cat":"C",Ccat:"C","H.spc":"H",Hspc:"H","H.t3p":"H",Ht3p:"H","N.1":"N",N1:"N","N.2":"N",N2:"N","N.3":"N",N3:"N","N.4":"N",N4:"N","N.am":"N",Nam:"N","N.ar":"N",Nar:"N","N.p13":"N",Np13:"N","O.2":"O",O2:"O","O.3":"O",O3:"O","O.co2":"O",Oco2:"O","O.spc":"O",Ospc:"O","O.t3p":"O",Ot3p:"O","P.3":"P",P3:"P","S.2":"S",S2:"S","S.3":"S",S3:"S","S.o":"S",So:"S","S.o2":"S",So2:"S"};function i(s,o){var a=[[]],l=!1;typeof o.keepH<"u"&&(l=!o.keepH);var d=s.search(/@<TRIPOS>MOLECULE/),u=s.search(/@<TRIPOS>ATOM/);if(d==-1||u==-1)return a;for(var g=s.substring(d).split(/\r?\n|\r/);g.length>0;){var x=[],y=g[2].replace(/^\s+/,"").replace(/\s+/g," ").split(" "),b=parseInt(y[0]),_=0;y.length>1&&(_=parseInt(y[1]));var h=4,f;for(f=3;f<g.length;f++)if(g[f]=="@<TRIPOS>ATOM"){h=f+1;break}var E=a[a.length-1].length,m=E+b,S;for(f=E;f<m;f++){S=g[h++],y=S.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var w={},v=y[5];if(n[v]!==void 0?v=n[v]:(v=v.split(".")[0],v=v[0].toUpperCase()+v.substring(1).toLowerCase()),w.atom=y[1],w.elem=v,!(w.elem=="H"&&l)){var A=a[a.length-1].length,M=parseInt(y[0]);w.serial=M,w.x=parseFloat(y[2]),w.y=parseFloat(y[3]),w.z=parseFloat(y[4]),w.atom=y[5];var T=parseFloat(y[8]);w.index=A,w.bonds=[],w.bondOrder=[],w.properties={charge:T,partialCharge:T},x[M]=A,a[a.length-1].push(w)}}for(var R=!1;h<g.length;)if(g[h++]=="@<TRIPOS>BOND"){R=!0;break}if(R&&_)for(f=0;f<_;f++){S=g[h++],y=S.replace(/^\s+/,"").replace(/\s+/g," ").split(" ");var P=parseInt(y[1]),L=a[a.length-1][x[P]],O=parseInt(y[2]),I=a[a.length-1][x[O]],N=parseInt(y[3]);isNaN(N)&&(N=1),L!==void 0&&I!==void 0&&(L.bonds.push(x[O]),L.bondOrder.push(N),I.bonds.push(x[P]),I.bondOrder.push(N))}if(o.multimodel){o.onemol||a.push([]),g.splice(0,h),s=g.join(`
`);continue}else break}return a}}),"./src/parsers/PDB.ts":((r,e,t)=>{t.r(e),t.d(e,{PDB:()=>i});var n=t("./src/parsers/utils/getSinglePDB.ts");function i(s,o){o=o||{};var a=[],l={};a.modelData=[];for(var d=s.split(/\r?\n|\r/);d.length>0;){var u=(0,n.getSinglePDB)(d,o,l),g=u[0],x=u[1];if(d=u[2],g.length!=0){if(o.multimodel&&o.onemol&&a.length>0)for(var y=a[0].length,b=0;b<g.length;b++){var _=g[b];_.index=b;for(var h=0;h<_.bonds.length;h++)_.bonds[h]+=y;a[0].push(_)}else a.modelData.push(x),a.push(g);if(!o.multimodel)break}}return a}}),"./src/parsers/PQR.ts":((r,e,t)=>{t.r(e),t.d(e,{PQR:()=>s});var n=t("./src/parsers/utils/assignPDBBonds.ts"),i=t("./src/parsers/utils/computeSecondaryStructure.ts");function s(o,a){var l=[[]],d=!a.noSecondaryStructure;l.modelData=[{symmetries:[]}];var u=[],g=o.split(/\r?\n|\r/),x;for(let R=0;R<g.length;R++){x=g[R].replace(/^\s*/,"");var y=x.substring(0,6);if(y.indexOf("END")==0)if(a.multimodel){a.onemol||l.push([]);continue}else break;else if(y=="ATOM  "||y=="HETATM"){var b;let P=parseInt(x.substring(6,11)),L=x.substring(12,16).replace(/ /g,""),O=x.substring(17,20).trim(),I=x.substring(21,22),N=parseInt(x.substring(22,26));var _=x.substring(30).trim().split(/\s+/),h=parseFloat(_[0]),f=parseFloat(_[1]),E=parseFloat(_[2]),m=parseFloat(_[3]),S=parseFloat(_[4]),w=L[0];L.length>1&&L[1].toUpperCase()!=L[1]&&(w=L.substring(0,2)),x[0]=="H"?b=!0:b=!1,u[P]=l[l.length-1].length,l[l.length-1].push({resn:O,x:h,y:f,z:E,elem:w,hetflag:b,chain:I,resi:N,serial:P,atom:L,bonds:[],ss:"c",bondOrder:[],properties:{charge:m,partialCharge:m,radius:S},pdbline:x})}else if(y=="CONECT"){var v=parseInt(x.substring(6,11)),A=l[l.length-1][u[v]];for(let P=0;P<4;P++){var M=parseInt(x.substring([11,16,21,26][P],[11,16,21,26][P]+5)),T=l[l.length-1][u[M]];A!==void 0&&T!==void 0&&(A.bonds.push(u[M]),A.bondOrder.push(1))}}}for(let R=0;R<l.length;R++)(0,n.assignPDBBonds)(l[R],a),d&&(0,i.computeSecondaryStructure)(l[R],a.hbondCutoff);return l}}),"./src/parsers/PRMTOP.ts":((r,e,t)=>{t.r(e),t.d(e,{PRMTOP:()=>n});function n(i){var s=[],o,a=0,l=i.split(/\r?\n|\r/);if(l.length>0&&l[0].includes("VERSION")){var d=l.filter(function(E){return E.includes("POINTERS")||E.includes("ATOM_NAME")||E.includes("CHARGE")||E.includes("RADII")||E.includes("BONDS_INC_HYDROGEN")||E.includes("BONDS_WITHOUT_HYDROGEN")||E.includes("RESIDUE_LABEL")||E.includes("RESIDUE_POINTER")}),u=_("POINTERS");if(u==-1)return[];var g=h(u),x=parseInt(l[u+1].slice(0,g[1]));let f=parseInt(l[u+2].slice(g[1],g[0]+g[1]));if(isNaN(x)||x<=0)return[];if(u=_("ATOM_NAME"),u==-1)return[];g=h(u);var y=g[0];for(let E=0;E<x/g[0];E++){E==parseInt(x/g[0])&&(y=x%g[0]);for(let m=0;m<y;m++){let S={},w={charge:"",radii:""};S.serial=a,S.x=0,S.y=0,S.z=0,S.atom=l[u+1].slice(g[1]*m,g[1]*(m+1)).trim(),S.elem=l[u+1].slice(g[1]*m,g[1]*m+1).trim(),S.properties=w,S.bonds=[],S.bondOrder=[],S.index=s.length,s.push(S),a++}u++}if(u=_("CHARGE"),u!=-1){g=h(u),a=0,y=g[0];for(let E=0;E<x/g[0];E++){E==parseInt(x/g[0])&&(y=x%g[0]);for(let m=0;m<y;m++)s[a].properties.charge=parseFloat(l[u+1].slice(g[1]*m,g[1]*(m+1))),a++;u++}}u=_("RESIDUE_POINTER");var b=[];if(u!=-1){g=h(u),y=g[0],u+=1;for(let E=0;E<f/g[0];E++){E==parseInt(f/g[0])&&(y=f%g[0]);for(let m=0;m<y;m++)b.push(parseInt(l[u].slice(g[1]*m,g[1]*(m+1))));u++}if(u=_("RESIDUE_LABEL"),u!=-1){let E=[];g=h(u),y=g[0],u+=1;for(let v=0;v<f/g[0];v++){v==parseInt(f/g[0])&&(y=f%g[0]);for(let A=0;A<y;A++)E.push(l[u].slice(g[1]*A,g[1]*(A+1)).trim());u++}let m=0,S=0,w="";b.push(s.length+1);for(let v=0;v<s.length;v++)v+1>=b[m]&&(w=E[m],m+=1,S+=1),s[v].resi=S,s[v].resn=w}}if(u=_("RADII"),u!=-1){g=h(u),a=0,y=g[0];for(let E=0;E<x/g[0];E++){E==parseInt(x/g[0])&&(y=x%g[0]);for(let m=0;m<y;m++)s[a].properties.radii=parseFloat(l[u+1].slice(g[1]*m,g[1]*(m+1))),a++;u++}}if(u=_("BONDS_WITHOUT_HYDROGEN"),u!=-1)for(g=h(u),a=0,y=g[0],u=u+1;!l[u].match(/^%FLAG/);){l[u+1].match(/^%FLAG/)&&(y=x%g[0]);for(let E=0;E<y;E++)a%3==0?o=parseInt(l[u].slice(g[1]*E,g[1]*(E+1))/3):a%3==1&&(s[o].bonds.push(parseInt(l[u].slice(g[1]*E,g[1]*(E+1))/3)),s[o].bondOrder.push(1)),a++;u++}if(u=_("BONDS_INC_HYDROGEN"),u!=-1)for(g=h(u),a=0,y=g[0],u=u+1;!l[u].match(/^%FLAG/);){l[u+1].match(/^%FLAG/)&&(y=x%g[0]);for(let E=0;E<y;E++)a%3==0?o=parseInt(l[u].slice(g[1]*E,g[1]*(E+1))/3):a%3==1&&(s[o].bonds.push(parseInt(l[u].slice(g[1]*E,g[1]*(E+1))/3)),s[o].bonds.push(1)),a++;u++}}else return[];function _(f){var E=l.indexOf(d.filter(function(m){return m.includes(f)})[0]);if(Number.isInteger(E)&&E>0){for(;!l[E].includes("FORMAT");)E++;return E}else return-1}function h(f){var E=l[f].match(/\((\d*)\S*/),m=l[f].match(/[a-zA-Z](\d*)\)\s*/);return m==null&&(m=l[f].match(/[a-zA-Z](\d*)\.\d*\)\s*/)),[parseInt(E[1]),parseInt(m[1])]}return[s]}}),"./src/parsers/SDF.ts":((r,e,t)=>{t.r(e),t.d(e,{SDF:()=>s});var n=function(o,a){var l=[[]],d=!1;for(typeof a.keepH<"u"&&(d=!a.keepH);o.length>0&&!(o.length<4);){var u=parseInt(o[3].substring(0,3));if(isNaN(u)||u<=0)break;var g=parseInt(o[3].substring(3,6)),x=4;if(o.length<4+u+g)break;var y=[],b=l[l.length-1].length,_=b+u,h,f;for(h=b;h<_;h++,x++){f=o[x];var E={},m=f.substring(31,34).replace(/ /g,"");E.atom=E.elem=m[0].toUpperCase()+m.substring(1).toLowerCase(),(E.elem!=="H"||!d)&&(E.serial=h,y[h]=l[l.length-1].length,E.x=parseFloat(f.substring(0,10)),E.y=parseFloat(f.substring(10,20)),E.z=parseFloat(f.substring(20,30)),E.hetflag=!0,E.bonds=[],E.bondOrder=[],E.properties={},E.index=l[l.length-1].length,l[l.length-1].push(E))}for(h=0;h<g;h++,x++){f=o[x];var S=y[parseInt(f.substring(0,3))-1+b],w=y[parseInt(f.substring(3,6))-1+b],v=parseFloat(f.substring(6));typeof S<"u"&&typeof w<"u"&&(l[l.length-1][S].bonds.push(w),l[l.length-1][S].bondOrder.push(v),l[l.length-1][w].bonds.push(S),l[l.length-1][w].bondOrder.push(v))}if(a.multimodel){for(a.onemol||l.push([]);o[x]!=="$$$$"&&x<o.length;)x++;o.splice(0,++x)}else break}return l},i=function(o,a){var l=[[]],d=!1;for(typeof a.keepH<"u"&&(d=!a.keepH);o.length>0&&!(o.length<8||!o[4].startsWith("M  V30 BEGIN CTAB")||!o[5].startsWith("M  V30 COUNTS")||o[5].length<14);){var u=o[5].substring(13).match(/\S+/g);if(u.length<2)break;var g=parseInt(u[0]);if(isNaN(g)||g<=0)break;var x=parseInt(u[1]),y=7;if(o.length<8+g+x)break;var b=[],_=l[l.length-1].length,h=_+g,f,E;for(f=_;f<h;f++,y++){E=o[y];var m=E.substring(6).match(/\S+/g);if(m.length>4){var S={},w=m[1].replace(/ /g,"");S.atom=S.elem=w[0].toUpperCase()+w.substring(1).toLowerCase(),(S.elem!=="H"||!d)&&(S.serial=f,b[f]=l[l.length-1].length,S.x=parseFloat(m[2]),S.y=parseFloat(m[3]),S.z=parseFloat(m[4]),S.hetflag=!0,S.bonds=[],S.bondOrder=[],S.properties={},S.index=l[l.length-1].length,l[l.length-1].push(S))}}if(o[y]==="M  V30 END ATOM")y++;else break;if(x!==0&&o[y]==="M  V30 BEGIN BOND")y++;else break;for(f=0;f<x;f++,y++){E=o[y];var v=E.substring(6).match(/\S+/g);if(v.length>3){var A=b[parseInt(v[2])-1+_],M=b[parseInt(v[3])-1+_],T=parseFloat(v[1]);typeof A<"u"&&typeof M<"u"&&(l[l.length-1][A].bonds.push(M),l[l.length-1][A].bondOrder.push(T),l[l.length-1][M].bonds.push(A),l[l.length-1][M].bondOrder.push(T))}}if(a.multimodel){for(a.onemol||l.push([]);o[y]!=="$$$$"&&y<o.length;)y++;o.splice(0,++y)}else break}return l};function s(o,a){var l="V2000",d=o.split(/\r?\n|\r/);return d.length>3&&d[3].length>38&&(l=d[3].substring(34,39)),l==="V2000"?n(d,a):l==="V3000"?i(d,a):[[""]]}}),"./src/parsers/VASP.ts":((r,e,t)=>{t.r(e),t.d(e,{VASP:()=>s});var n=t("./src/WebGL/index.ts"),i=t("./src/parsers/utils/assignBonds.ts");function s(o,a={}){var l=[[]],d={};const u=a.assignBonds===void 0?!0:a.assignBonds;var g=o.replace(/^\s+/,"").split(/\r?\n/);if(g.length<3)return l;if(g[1].match(/\d+/))d.length=parseFloat(g[1]);else return console.log("Warning: second line of the vasp structure file must be a number"),l;if(d.length<0)return console.log("Warning: Vasp implementation for negative lattice lengths is not yet available"),l;d.xVec=new Float32Array(g[2].replace(/^\s+/,"").split(/\s+/)),d.yVec=new Float32Array(g[3].replace(/^\s+/,"").split(/\s+/)),d.zVec=new Float32Array(g[4].replace(/^\s+/,"").split(/\s+/));var x=new n.Matrix3(d.xVec[0],d.xVec[1],d.xVec[2],d.yVec[0],d.yVec[1],d.yVec[2],d.zVec[0],d.zVec[1],d.zVec[2]);x.multiplyScalar(d.length),l.modelData=[{symmetries:[],cryst:{matrix:x}}];var y=g[5].trim().split(/\s+/),b=new Int16Array(g[6].trim().split(/\s+/)),_=g[7].trim(),h=!1;if(_.match(/S/)&&(h=!0,_=g[8].trim()),_.toLowerCase()[0]=="c")_="cartesian";else if(_.toLowerCase()[0]=="d")_="direct";else return console.log("Warning: Unknown vasp mode in POSCAR file: mode must be either C(artesian) or D(irect)"),l;if(y.length!=b.length)return console.log("Warning: declaration of atomary species wrong:"),console.log(y),console.log(b),l;h?g.splice(0,9):g.splice(0,8);for(var f=0,E=0,m=y.length;E<m;E++){for(var S=y[E],w=0,v=b[E];w<v;w++){var A=new Float32Array(g[f+w].trim().split(/\s+/)),M={};M.elem=S,_=="cartesian"?(M.x=d.length*A[0],M.y=d.length*A[1],M.z=d.length*A[2]):(M.x=d.length*(A[0]*d.xVec[0]+A[1]*d.yVec[0]+A[2]*d.zVec[0]),M.y=d.length*(A[0]*d.xVec[1]+A[1]*d.yVec[1]+A[2]*d.zVec[1]),M.z=d.length*(A[0]*d.xVec[2]+A[1]*d.yVec[2]+A[2]*d.zVec[2])),M.bonds=[],M.bondOrder=[],l[0].push(M)}f+=b[E]}if(u)for(let T=0;T<l.length;T++)(0,i.assignBonds)(l[T],a);return l}}),"./src/parsers/XYZ.ts":((r,e,t)=>{t.r(e),t.d(e,{XYZ:()=>s});var n=t("./src/WebGL/index.ts"),i=t("./src/parsers/utils/assignBonds.ts");function s(o,a){a=a||{};for(var l=[[]],d=a.assignBonds===void 0?!0:a.assignBonds,u=o.trimStart().split(/\r?\n|\r/);u.length>0&&!(u.length<3);){var g=parseInt(u[0]);if(isNaN(g)||g<=0||u.length<g+2)break;var x=/Lattice\s*=\s*["\{\}]([^"\{\}]+)["\{\}]\s*/gi,y=x.exec(u[1]);if(y!=null&&y.length>1){var b=new Float32Array(y[1].split(/\s+/)),_=new n.Matrix3(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]);l.modelData=[{cryst:{matrix:_}}]}for(var h=2,f=l[l.length-1].length,E=f+g,m=f;m<E;m++){var S=u[h++],w=S.trim().split(/\s+/),v={};v.serial=m;var A=w[0];v.atom=v.elem=A[0].toUpperCase()+A.substring(1,2).toLowerCase(),v.x=parseFloat(w[1]),v.y=parseFloat(w[2]),v.z=parseFloat(w[3]),v.hetflag=!0,v.bonds=[],v.bondOrder=[],v.properties={},l[l.length-1][m]=v,w.length>=7&&(v.dx=parseFloat(w[4]),v.dy=parseFloat(w[5]),v.dz=parseFloat(w[6]))}if(a.multimodel)l.push([]),u.splice(0,h);else break}if(d)for(let T=0;T<l.length;T++)(0,i.assignBonds)(l[T],a);if(a.onemol){var M=l;l=[],l.push(M[0]);for(let T=1;T<M.length;T++){let R=l[0].length;for(let P=0;P<M[T].length;P++){let L=M[T][P];for(let O=0;O<L.bonds.length;O++)L.bonds[O]=L.bonds[O]+R;L.index=l[0].length,L.serial=l[0].length,l[0].push(L)}}}return l}}),"./src/parsers/cifutils/category.ts":((r,e,t)=>{t.r(e),t.d(e,{Category:()=>i});var n=t("./src/parsers/cifutils/decoder.ts");function i(s){const o=Object.create(null),a=Object.create(null);for(const l of s.columns)o[l.name]=l;return{rowCount:s.rowCount,name:s.name.substring(1),fieldNames:s.columns.map(l=>l.name),getField(l){const d=o[l];if(d)return a[l]||(a[l]=(0,n.decode)(d.data)),a[l]}}}}),"./src/parsers/cifutils/decoder.ts":((r,e,t)=>{t.r(e),t.d(e,{decode:()=>o});var n=t("./src/parsers/cifutils/encoding.ts");const i=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;function s(R,P){const L=new ArrayBuffer(R.length),O=new Uint8Array(L);for(let I=0,N=R.length;I<N;I+=P)for(let k=0;k<P;k++)O[I+P-k-1]=R[I+k];return L}function o(R){let P=R.data;for(let L=R.encoding.length-1;L>=0;L--)P=a(P,R.encoding[L]);return P}function a(R,P){switch(P.kind){case"ByteArray":switch(P.type){case n.Encoding.IntDataType.Uint8:return R;case n.Encoding.IntDataType.Int8:return u(R);case n.Encoding.IntDataType.Int16:return x(R);case n.Encoding.IntDataType.Uint16:return y(R);case n.Encoding.IntDataType.Int32:return b(R);case n.Encoding.IntDataType.Uint32:return _(R);case n.Encoding.FloatDataType.Float32:return h(R);case n.Encoding.FloatDataType.Float64:return f(R);default:throw new Error("unreachable")}case"FixedPoint":return E(R,P);case"IntervalQuantization":return m(R,P);case"RunLength":return S(R,P);case"Delta":return w(R,P);case"IntegerPacking":return M(R,P);case"StringArray":return T(R,P)}}function l(R,P){switch(R){case n.Encoding.IntDataType.Int8:return new Int8Array(P);case n.Encoding.IntDataType.Int16:return new Int16Array(P);case n.Encoding.IntDataType.Int32:return new Int32Array(P);case n.Encoding.IntDataType.Uint8:return new Uint8Array(P);case n.Encoding.IntDataType.Uint16:return new Uint16Array(P);case n.Encoding.IntDataType.Uint32:return new Uint32Array(P);default:return new Int32Array(P)}}function d(R,P){switch(R){case n.Encoding.FloatDataType.Float32:return new Float32Array(P);case n.Encoding.FloatDataType.Float64:return new Float64Array(P);default:return new Float64Array(P)}}function u(R){return new Int8Array(R.buffer,R.byteOffset)}function g(R,P,L){return(R.byteOffset!=0||R.byteLength!=R.buffer.byteLength)&&(R=new Uint8Array(R)),i?new L(R.buffer):new L(s(R,P))}function x(R){return g(R,2,Int16Array)}function y(R){return g(R,2,Uint16Array)}function b(R){return g(R,4,Int32Array)}function _(R){return g(R,4,Uint32Array)}function h(R){return g(R,4,Float32Array)}function f(R){return g(R,8,Float64Array)}function E(R,P){const L=R.length,O=d(P.srcType,L),I=1/P.factor;for(let N=0;N<L;N++)O[N]=I*R[N];return O}function m(R,P){const L=R.length,O=d(P.srcType,L),I=(P.max-P.min)/(P.numSteps-1),N=P.min;for(let k=0;k<L;k++)O[k]=N+I*R[k];return O}function S(R,P){const L=l(P.srcType,P.srcSize);let O=0;for(let I=0,N=R.length;I<N;I+=2){const k=R[I],U=R[I+1];for(let F=0;F<U;++F)L[O++]=k}return L}function w(R,P){const L=R.length,O=l(P.srcType,L);if(!L)return R;O[0]=R[0]+(P.origin|0);for(let I=1;I<L;++I)O[I]=R[I]+O[I-1];return O}function v(R,P){const L=P.byteCount===1?127:32767,O=-L-1,I=R.length,N=new Int32Array(P.srcSize);let k=0,U=0;for(;k<I;){let F=0,j=R[k];for(;j===L||j===O;)F+=j,k++,j=R[k];F+=j,N[U]=F,k++,U++}return N}function A(R,P){const L=P.byteCount===1?255:65535,O=R.length,I=new Int32Array(P.srcSize);let N=0,k=0;for(;N<O;){let U=0,F=R[N];for(;F===L;)U+=F,N++,F=R[N];U+=F,I[k]=U,N++,k++}return I}function M(R,P){return R.length===P.srcSize?R:P.isUnsigned?A(R,P):v(R,P)}function T(R,P){const L=o({encoding:P.offsetEncoding,data:P.offsets}),O=o({encoding:P.dataEncoding,data:R}),I=P.stringData,N=new Array(L.length);N[0]="";for(let F=1,j=L.length;F<j;F++)N[F]=I.substring(L[F-1],L[F]);let k=0;const U=new Array(O.length);for(let F=0,j=O.length;F<j;F++)U[k++]=N[O[F]+1];return U}}),"./src/parsers/cifutils/encoding.ts":((r,e,t)=>{t.r(e),t.d(e,{Encoding:()=>i,VERSION:()=>n});const n="0.3.0";var i;(function(s){(function(l){l[l.Int8=1]="Int8",l[l.Int16=2]="Int16",l[l.Int32=3]="Int32",l[l.Uint8=4]="Uint8",l[l.Uint16=5]="Uint16",l[l.Uint32=6]="Uint32"})(s.IntDataType||(s.IntDataType={})),(function(l){l[l.Float32=32]="Float32",l[l.Float64=33]="Float64"})(s.FloatDataType||(s.FloatDataType={}));function o(l){let d;return l instanceof Int8Array?d=s.IntDataType.Int8:l instanceof Int16Array?d=s.IntDataType.Int16:l instanceof Int32Array?d=s.IntDataType.Int32:l instanceof Uint8Array?d=s.IntDataType.Uint8:l instanceof Uint16Array?d=s.IntDataType.Uint16:l instanceof Uint32Array?d=s.IntDataType.Uint32:l instanceof Float32Array?d=s.FloatDataType.Float32:l instanceof Float64Array?d=s.FloatDataType.Float64:d=s.IntDataType.Int32,d}s.getDataType=o;function a(l){if(l instanceof Int8Array||l instanceof Int16Array||l instanceof Int32Array)return!0;for(let d=0,u=l.length;d<u;d++)if(d<0)return!1;return!0}s.isSignedIntegerDataType=a})(i||(i={}))}),"./src/parsers/index.ts":((r,e,t)=>{t.r(e),t.d(e,{Parsers:()=>E,bondLength:()=>f.bondLength,setBondLength:()=>f.setBondLength});var n=t("./src/parsers/VASP.ts"),i=t("./src/parsers/CUBE.ts"),s=t("./src/parsers/XYZ.ts"),o=t("./src/parsers/SDF.ts"),a=t("./src/parsers/CDJSON.ts"),l=t("./src/parsers/CIF.ts"),d=t("./src/parsers/MOL2.ts"),u=t("./src/parsers/PDB.ts"),g=t("./src/parsers/PQR.ts"),x=t("./src/parsers/MMTF.ts"),y=t("./src/parsers/PRMTOP.ts"),b=t("./src/parsers/GRO.ts"),_=t("./src/parsers/LAMMPSTRJ.ts"),h=t("./src/parsers/BCIF.ts"),f=t("./src/parsers/utils/bondLength.ts");const E={vasp:n.VASP,VASP:n.VASP,cube:i.CUBE,CUBE:i.CUBE,xyz:s.XYZ,XYZ:s.XYZ,sdf:o.SDF,SDF:o.SDF,json:a.CDJSON,cdjson:a.CDJSON,CDJSON:a.CDJSON,mcif:l.CIF,cif:l.CIF,CIF:l.CIF,mol2:d.MOL2,MOL2:d.MOL2,pdb:u.PDB,PDB:u.PDB,pdbqt:u.PDB,PDBQT:u.PDB,pqr:g.PQR,PQR:g.PQR,mmtf:x.MMTFparser,MMTF:x.MMTFparser,prmtop:y.PRMTOP,PRMTOP:y.PRMTOP,gro:b.GRO,GRO:b.GRO,lammpstrj:_.LAMMPSTRJ,LAMMPSTRJ:_.LAMMPSTRJ,bcif:h.BCIF,BCIF:h.BCIF}}),"./src/parsers/utils/anumToSymbol.ts":((r,e,t)=>{t.r(e),t.d(e,{anumToSymbol:()=>n});const n={1:"H",2:"He",3:"Li",4:"Be",5:"B",6:"C",7:"N",8:"O",9:"F",10:"Ne",11:"Na",12:"Mg",13:"Al",14:"Si",15:"P",16:"S",17:"Cl",18:"Ar",19:"K",20:"Ca",21:"Sc",22:"Ti",23:"V",24:"Cr",25:"Mn",26:"Fe",27:"Co",28:"Ni",29:"Cu",30:"Zn",31:"Ga",32:"Ge",33:"As",34:"Se",35:"Br",36:"Kr",37:"Rb",38:"Sr",39:"Y",40:"Zr",41:"Nb",42:"Mo",43:"Tc",44:"Ru",45:"Rh",46:"Pd",47:"Ag",48:"Cd",49:"In",50:"Sn",51:"Sb",52:"Te",53:"I",54:"Xe",55:"Cs",56:"Ba",71:"Lu",72:"Hf",73:"Ta",74:"W",75:"Re",76:"Os",77:"Ir",78:"Pt",79:"Au",80:"Hg",81:"Tl",82:"Pb",83:"Bi",84:"Po",85:"At",86:"Rn",87:"Fr",88:"Ra",104:"Rf",105:"Db",106:"Sg",107:"Bh",108:"Hs",109:"Mt",110:"Ds",111:"Rg",112:"Cn",113:"Nh",114:"Fl",115:"Mc",116:"Lv",117:"Ts",118:"Og",57:"La",58:"Ce",59:"Pr",60:"Nd",61:"Pm",62:"Sm",63:"Eu",64:"Gd",65:"Tb",66:"Dy",67:"Ho",68:"Er",69:"Tm",70:"Yb",89:"Ac",90:"Th",91:"Pa",92:"U",93:"Np",94:"Pu",95:"Am",96:"Cm",97:"Bk",98:"Cf",99:"Es",100:"Fm",101:"Md",102:"No"}}),"./src/parsers/utils/areConnected.ts":((r,e,t)=>{t.r(e),t.d(e,{areConnected:()=>s});var n=t("./src/parsers/utils/bondLength.ts");const i=new Set(["Na","K","Ca","Mg","Mn","Sr"]);function s(o,a,l){if(l&&l.unboundCations&&(i.has(o.elem)||i.has(a.elem)))return!1;let d=(0,n.bondLength)(o.elem)+(0,n.bondLength)(a.elem);d+=.25,d*=d;let u=o.x-a.x;if(u*=u,u>d)return!1;let g=o.y-a.y;if(g*=g,g>d)return!1;let x=o.z-a.z;if(x*=x,x>d)return!1;const y=u+g+x;return!(isNaN(y)||y<.5||y>d||o.altLoc!==a.altLoc&&o.altLoc.trim()!==""&&a.altLoc.trim()!=="")}}),"./src/parsers/utils/assignBackboneHBonds.ts":((r,e,t)=>{t.r(e),t.d(e,{assignBackboneHBonds:()=>n});function n(i,s){const o=s||3.2,a=o*o,l=[];for(let d=0,u=i.length;d<u;d++){i[d].index=d;const g=i[d];!g.hetflag&&(g.atom==="N"||g.atom==="O")&&(l.push(g),g.hbondOther=null,g.hbondDistanceSq=Number.POSITIVE_INFINITY)}l.sort(function(d,u){return d.z-u.z});for(let d=0,u=l.length;d<u;d++){const g=l[d];for(let x=d+1;x<u;x++){const y=l[x],b=y.z-g.z;if(b>o)break;if(y.atom==g.atom)continue;const _=Math.abs(y.y-g.y);if(_>o)continue;const h=Math.abs(y.x-g.x);if(h>o)continue;const f=h*h+_*_+b*b;f>a||y.chain==g.chain&&Math.abs(y.resi-g.resi)<4||(f<g.hbondDistanceSq&&(g.hbondOther=y,g.hbondDistanceSq=f),f<y.hbondDistanceSq&&(y.hbondOther=g,y.hbondDistanceSq=f))}}}}),"./src/parsers/utils/assignBonds.ts":((r,e,t)=>{t.r(e),t.d(e,{assignBonds:()=>o});var n=t("./src/parsers/utils/areConnected.ts");const i=[{x:0,y:0,z:1},{x:0,y:1,z:-1},{x:0,y:1,z:0},{x:0,y:1,z:1},{x:1,y:-1,z:-1},{x:1,y:-1,z:0},{x:1,y:-1,z:1},{x:1,y:0,z:-1},{x:1,y:0,z:0},{x:1,y:0,z:1},{x:1,y:1,z:-1},{x:1,y:1,z:0},{x:1,y:1,z:1}],s=4.95;function o(a,l){for(let g=0,x=a.length;g<x;g++)a[g].index||(a[g].index=g);const d={x:{y:{z:[]}}};for(let g=0;g<a.length;g++){const x=a[g],y=Math.floor(x.x/s),b=Math.floor(x.y/s),_=Math.floor(x.z/s);d[y]||(d[y]={}),d[y][b]||(d[y][b]={}),d[y][b][_]||(d[y][b][_]=[]),d[y][b][_].push(x)}function u(g,x){for(let y=0;y<g.length;y++){const b=g[y];for(let _=0;_<x.length;_++){const h=x[_];if((0,n.areConnected)(b,h,l)){const f=b.bonds.indexOf(h.index),E=h.bonds.indexOf(b.index);f===-1&&E===-1?(b.bonds.push(h.index),b.bondOrder.push(1),h.bonds.push(b.index),h.bondOrder.push(1)):f===-1?(b.bonds.push(h.index),b.bondOrder.push(h.bondOrder[E])):E===-1&&(h.bonds.push(b.index),h.bondOrder.push(b.bondOrder[f]))}}}}for(let g in d){const x=parseInt(g);for(let y in d[x]){const b=parseInt(y);for(let _ in d[x][b]){const h=parseInt(_),f=d[x][b][h];for(let E=0;E<f.length;E++){const m=f[E];for(let S=E+1;S<f.length;S++){const w=f[S];(0,n.areConnected)(m,w,l)&&m.bonds.indexOf(w.index)==-1&&(m.bonds.push(w.index),m.bondOrder.push(1),w.bonds.push(m.index),w.bondOrder.push(1))}}for(let E=0;E<i.length;E++){const m=i[E];if(!d[x+m.x]||!d[x+m.x][b+m.y]||!d[x+m.x][b+m.y][h+m.z])continue;const S=d[x+m.x][b+m.y][h+m.z];u(f,S)}}}}}}),"./src/parsers/utils/assignPDBBonds.ts":((r,e,t)=>{t.r(e),t.d(e,{assignPDBBonds:()=>o});var n=t("./src/parsers/utils/areConnected.ts"),i=t("./src/parsers/utils/assignBonds.ts"),s=t("./src/parsers/utils/standardResidues.ts");function o(a,l){const d=[],u=[];for(let b=0,_=a.length;b<_;b++){const h=a[b];h.index=b,h.hetflag||!s.standardResidues.has(h.resn)?u.push(h):d.push(h)}(0,i.assignBonds)(u,l),d.sort(function(b,_){return b.chain!==_.chain?b.chain<_.chain?-1:1:b.resi-_.resi});let g=-1,x=-1,y;for(let b=0,_=d.length;b<_;b++){const h=d[b];h.resi!==g&&(g=h.resi,y||x++,y=!1),h.reschain=x;for(let f=b+1;f<d.length;f++){const E=d[f];if(E.chain!==h.chain||E.resi-h.resi>1)break;(0,n.areConnected)(h,E,l)&&(h.bonds.indexOf(E.index)===-1&&(h.bonds.push(E.index),h.bondOrder.push(1),E.bonds.push(h.index),E.bondOrder.push(1)),h.resi!==E.resi&&(y=!0))}}}}),"./src/parsers/utils/atomNameToElem.ts":((r,e,t)=>{t.r(e),t.d(e,{atomNameToElem:()=>i});var n=t("./src/parsers/utils/bondLength.ts");function i(s,o){let a=s.replace(/ /g,"");return a.length>0&&a[0]==="H"&&a!=="Hg"&&a!=="He"&&a!=="Hf"&&a!=="Hs"&&a!=="Ho"&&(a="H"),a.length>1&&(a=a[0].toUpperCase()+a.substring(1).toLowerCase(),n.bondTable[a]===void 0?a=a[0]:o&&(a==="Ca"||a==="Cd")&&(a="C")),a}}),"./src/parsers/utils/bondLength.ts":((r,e,t)=>{t.r(e),t.d(e,{bondLength:()=>i,bondTable:()=>n,setBondLength:()=>s});let n={H:.37,He:.32,Li:1.34,Be:.9,B:.82,C:.77,N:.75,O:.73,F:.71,Ne:.69,Na:1.54,Mg:1.3,Al:1.18,Si:1.11,P:1.06,S:1.02,Cl:.99,Ar:.97,K:1.96,Ca:1.74,Sc:1.44,Ti:1.56,V:1.25,Mn:1.39,Fe:1.25,Co:1.26,Ni:1.21,Cu:1.38,Zn:1.31,Ga:1.26,Ge:1.22,Se:1.16,Br:1.14,Kr:1.1,Rb:2.11,Sr:1.92,Y:1.62,Zr:1.48,Nb:1.37,Mo:1.45,Tc:1.56,Ru:1.26,Rh:1.35,Pd:1.31,Ag:1.53,Cd:1.48,In:1.44,Sn:1.41,Sb:1.38,Te:1.35,I:1.33,Xe:1.3,Cs:2.25,Ba:1.98,Lu:1.6,Hf:1.5,Ta:1.38,W:1.46,Re:1.59,Os:1.44,Ir:1.37,Pt:1.28,Au:1.44,Hg:1.49,Tl:1.48,Pb:1.47,Bi:1.46,Rn:1.45};function i(o){return n[o]||1.6}function s(o,a){a<0&&(a=0),n[o]=a}}),"./src/parsers/utils/computeSecondaryStructure.ts":((r,e,t)=>{t.r(e),t.d(e,{computeSecondaryStructure:()=>i});var n=t("./src/parsers/utils/assignBackboneHBonds.ts");function i(s,o){(0,n.assignBackboneHBonds)(s,o);const a={};let l,d,u,g,x,y;for(l=0,d=s.length;l<d;l++)if(x=s[l],a[x.chain]===void 0&&(a[x.chain]=[]),isFinite(x.hbondDistanceSq)){const b=x.hbondOther;a[b.chain]===void 0&&(a[b.chain]=[]),Math.abs(b.resi-x.resi)===4&&(a[x.chain][x.resi]="h")}for(u in a)for(g=1;g<a[u].length-1;g++){const b=a[u][g-1],_=a[u][g+1];y=a[u][g],b=="h"&&b==_&&y!=b&&(a[u][g]=b)}for(l=0,d=s.length;l<d;l++)x=s[l],isFinite(x.hbondDistanceSq)&&a[x.chain][x.resi]!="h"&&x.ss!=="h"&&(a[x.chain][x.resi]="maybesheet");for(let b=0,_=s.length;b<_;b++)if(x=s[b],isFinite(x.hbondDistanceSq)&&a[x.chain][x.resi]=="maybesheet"){let h=x.hbondOther,f=a[h.chain][h.resi];(f=="maybesheet"||f=="s")&&(a[x.chain][x.resi]="s",a[h.chain][h.resi]="s")}for(let b in a){for(let _=1;_<a[b].length-1;_++){const h=a[b][_-1],f=a[b][_+1];y=a[b][_],h=="s"&&h==f&&y!=h&&(a[b][_]=h)}for(let _=0;_<a[b].length;_++){const h=a[b][_];(h=="h"||h=="s")&&a[b][_-1]!=h&&a[b][_+1]!=h&&delete a[b][_]}}for(l=0,d=s.length;l<d;l++)x=s[l],y=a[x.chain][x.resi],delete x.hbondOther,delete x.hbondDistanceSq,!(y===void 0||y==="maybesheet")&&(x.ss=y,a[x.chain][x.resi-1]!=y&&(x.ssbegin=!0),a[x.chain][x.resi+1]!=y&&(x.ssend=!0))}}),"./src/parsers/utils/getSinglePDB.ts":((r,e,t)=>{t.r(e),t.d(e,{getSinglePDB:()=>g});var n=t("./src/WebGL/index.ts"),i=t("./src/parsers/utils/atomNameToElem.ts"),s=t("./src/parsers/utils/bondLength.ts"),o=t("./src/parsers/utils/computeSecondaryStructure.ts"),a=t("./src/parsers/utils/isEmpty.ts"),l=t("./src/parsers/utils/processSymmetries.ts"),d=t("./src/parsers/utils/assignPDBBonds.ts"),u=t("./src/parsers/utils/validateBonds.ts");function g(x,y,b){const _=[],h=y.assignBonds===void 0?!0:y.assignBonds,f=!y.keepH,E=!!y.noSecondaryStructure,m=!y.noComputeSecondaryStructure,S=!y.doAssembly,w=y.altLoc?y.altLoc:"A",v={symmetries:[],cryst:void 0};let A,M=[];const T=[];let R;const P={};for(let L=0;L<x.length;L++){R=x[L].replace(/^\s*/,"");const O=R.substring(0,6);let I,N,k;if(O.indexOf("END")===0){if(M=x.slice(L+1),O==="END")for(const U in b)b.hasOwnProperty(U)&&delete b[U];break}else if(O==="ATOM  "||O==="HETATM"){let U,F,j,H,B,V,K,q,Te,Fe,We,J;if(We=R.substring(16,17),We!==" "&&We!==w&&w!=="*"||(Fe=parseInt(R.substring(6,11)),A=R.substring(12,16).replace(/ /g,""),U=R.substring(17,20).replace(/ /g,""),F=R.substring(21,22),j=parseInt(R.substring(22,26)),H=R.substring(26,27),B=parseFloat(R.substring(30,38)),V=parseFloat(R.substring(38,46)),K=parseFloat(R.substring(46,54)),J=parseFloat(R.substring(60,68)),Te=R.substring(76,78).replace(/ /g,""),Te===""||s.bondTable[Te]===void 0?Te=(0,i.atomNameToElem)(R.substring(12,14),R[0]=="A"):Te=Te[0].toUpperCase()+Te.substring(1).toLowerCase(),Te==="H"&&f))continue;O[0]=="H"?q=!0:q=!1,T[Fe]=_.length,_.push({resn:U,x:B,y:V,z:K,elem:Te,hetflag:q,altLoc:We,chain:F,resi:j,icode:H,rescode:j+(H!==" "?"^"+H:""),serial:Fe,atom:A,bonds:[],ss:"c",bondOrder:[],properties:{},b:J,pdbline:R})}else if(O==="SHEET "){I=R.substring(21,22),N=parseInt(R.substring(22,26)),k=parseInt(R.substring(33,37)),I in b||(b[I]={}),b[I][N]="s1";for(let U=N+1;U<k;U++)b[I][U]="s";b[I][k]="s2"}else if(O==="CONECT"){const U=parseInt(R.substring(6,11)),F=T[U],j=_[F],H=[11,16,21,26];for(let B=0;B<4;B++){const V=parseInt(R.substring(H[B],H[B]+5)),K=T[V];let q=F+":"+K;const Te=_[K];if(j!==void 0&&Te!==void 0)if(!P[q])P[q]=1,(j.bonds.length==0||j.bonds[j.bonds.length-1]!==K)&&(j.bonds.push(K),j.bondOrder.push(1));else{P[q]+=1;for(let Fe=0;Fe<j.bonds.length;Fe++)if(j.bonds[Fe]==K){const We=P[q];We>=4?j.bondOrder[Fe]=1:j.bondOrder[Fe]=We}}}}else if(O==="HELIX "){I=R.substring(19,20),N=parseInt(R.substring(21,25)),k=parseInt(R.substring(33,37)),I in b||(b[I]={}),b[I][N]="h1";for(let U=N+1;U<k;U++)b[I][U]="h";b[I][k]="h2"}else if(!S&&O==="REMARK"&&R.substring(13,18)==="BIOMT"){let U,F=new n.Matrix4;for(U=1;U<=3;U++)if(R=x[L].replace(/^\s*/,""),parseInt(R.substring(18,19))==U)F.elements[U-1]=parseFloat(R.substring(23,33)),F.elements[U-1+4]=parseFloat(R.substring(33,43)),F.elements[U-1+8]=parseFloat(R.substring(43,53)),F.elements[U-1+12]=parseFloat(R.substring(53)),L++;else for(;R.substring(13,18)==="BIOMT";)L++,R=x[L].replace(/^\s*/,"");F.elements[3]=0,F.elements[7]=0,F.elements[11]=0,F.elements[15]=1,v.symmetries.push(F),L--}else if(O==="CRYST1"){let U,F,j,H,B,V;U=parseFloat(R.substring(7,15)),F=parseFloat(R.substring(16,24)),j=parseFloat(R.substring(25,33)),H=parseFloat(R.substring(34,40)),B=parseFloat(R.substring(41,47)),V=parseFloat(R.substring(48,54)),v.cryst={a:U,b:F,c:j,alpha:H,beta:B,gamma:V}}else if(O==="ANISOU"){const U=parseInt(R.substring(6,11)),F=T[U],j=_[F];if(j){const H=R.substring(30).trim().split(/\s+/),B={u11:parseInt(H[0]),u22:parseInt(H[1]),u33:parseInt(H[2]),u12:parseInt(H[3]),u13:parseInt(H[4]),u23:parseInt(H[5])};j.uMat=B}}}if((0,u.validateBonds)(_,T),h&&(0,d.assignPDBBonds)(_,y),S||(0,l.processSymmetries)(v.symmetries,_,y,v.cryst),m&&!E&&(0,o.computeSecondaryStructure)(_,y.hbondCutoff),!(0,a.isEmpty)(b))for(let L=0;L<_.length;L++){const O=_[L];if(O!==void 0&&O.chain in b&&O.resi in b[O.chain]){const I=b[O.chain][O.resi];O.ss=I[0],I.length>1&&(I[1]=="1"?O.ssbegin=!0:I[1]=="2"&&(O.ssend=!0))}}return[_,v,M]}}),"./src/parsers/utils/isEmpty.ts":((r,e,t)=>{t.r(e),t.d(e,{isEmpty:()=>n});function n(i){for(const s in i)return!1;return!0}}),"./src/parsers/utils/processSymmetries.ts":((r,e,t)=>{t.r(e),t.d(e,{processSymmetries:()=>i});var n=t("./src/WebGL/index.ts");function i(s,o,a,l){const d=!a.duplicateAssemblyAtoms,u=o.length;let g=u,x=-1,y=null,b=null;(a.normalizeAssembly||a.wrapAtoms)&&l&&(y=(0,n.conversionMatrix3)(l.a,l.b,l.c,l.alpha,l.beta,l.gamma),b=new n.Matrix3,b.getInverse3(y));let _=function(E){let m=E.clone().applyMatrix3(b);const S=[m.x,m.y,m.z],w=[0,0,0];for(let A=0;A<3;A++){for(;S[A]<-.001;)S[A]+=1,w[A]+=1;for(;S[A]>1.001;)S[A]-=1,w[A]-=1}const v=new n.Vector3(w[0],w[1],w[2]);return v.applyMatrix3(y),v};if(a.normalizeAssembly&&l)for(let E=0;E<s.length;E++){const m=new n.Vector3(0,0,0);for(let w=0;w<u;w++){const v=new n.Vector3(o[w].x,o[w].y,o[w].z);v.applyMatrix4(s[E]),m.add(v)}m.divideScalar(u);const S=_(m);s[E].isNearlyIdentity()&&S.lengthSq()>.001&&(x=E),s[E].translate(S)}if(d){if(s.length>1)for(let E=0;E<o.length;E++){var h=[];for(let m=0;m<s.length;m++)if(!s[m].isNearlyIdentity()){var f=new n.Vector3;f.set(o[E].x,o[E].y,o[E].z),f.applyMatrix4(s[m]),h.push(f)}o[E].symmetries=h}}else{for(let E=0;E<u;E++)o[E].sym=-1;for(let E=0;E<s.length;E++)if(!s[E].isNearlyIdentity()&&x!=E){let m=new n.Vector3;for(let S=0;S<u;S++){const w=[];for(let A=0;A<o[S].bonds.length;A++)w.push(o[S].bonds[A]+g);if(m.set(o[S].x,o[S].y,o[S].z),m.applyMatrix4(s[E]),a.wrapAtoms&&l){let A=_(m);m.add(A)}const v={};for(const A in o[S])v[A]=o[S][A];v.x=m.x,v.y=m.y,v.z=m.z,v.bonds=w,v.sym=E,v.index=o.length,o.push(v)}g=o.length}else for(let m=0;m<u;m++)o[m].sym=E;if(a.wrapAtoms&&l){let E=new n.Vector3;for(let m=0;m<u;m++){E.set(o[m].x,o[m].y,o[m].z);let S=_(E);E.add(S),o[m].x=E.x,o[m].y=E.y,o[m].z=E.z}}if(x>=0){const E=new n.Vector3;for(let m=0;m<u;m++)E.set(o[m].x,o[m].y,o[m].z),E.applyMatrix4(s[x]),o[m].x=E.x,o[m].y=E.y,o[m].z=E.z}s.length=0}}}),"./src/parsers/utils/standardResidues.ts":((r,e,t)=>{t.r(e),t.d(e,{standardResidues:()=>n});const n=new Set(["ABU","ACD","ALA","ALB","ALI","ARG","AR0","ASN","ASP","ASX","BAS","CYS","CYH","CYX","CSS","CSH","GLN","GLU","GLX","GLY","HIS","HIE","HID","HIP","HYP","ILE","ILU","LEU","LYS","MET","PCA","PGA","PHE","PR0","PRO","PRZ","SER","THR","TRP","TYR","VAL","A","1MA","C","5MC","OMC","G","1MG","2MG","M2G","7MG","OMG","YG","I","T","U","+U","H2U","5MU","PSU","ACE","F0R","H2O","HOH","WAT"])}),"./src/parsers/utils/validateBonds.ts":((r,e,t)=>{t.r(e),t.d(e,{validateBonds:()=>n});function n(i,s){for(let o=0,a=i.length;o<a;o++){const l=i[o];for(let d=0;d<l.bonds.length;d++){const u=l.bonds[d],g=i[u],x=s[l.serial];g&&x&&g.bonds.indexOf(x)<0&&(g.bonds.push(x),g.bondOrder.push(l.bondOrder[d]))}}}}),"./src/partialCharges.ts":((r,e,t)=>{t.r(e),t.d(e,{applyPartialCharges:()=>i,partialCharges:()=>n});const n={"ALA:N":-.15,"ALA:CA":.1,"ALA:CB":0,"ALA:C":.6,"ALA:O":-.55,"ARG:N":-.15,"ARG:CA":.1,"ARG:CB":0,"ARG:CG":0,"ARG:CD":.1,"ARG:NE":-.1,"ARG:CZ":.5,"ARG:NH1":.25,"ARG:NH2":.25,"ARG:C":.6,"ARG:O":-.55,"ASN:N":-.15,"ASN:CA":.1,"ASN:CB":0,"ASN:CG":.55,"ASN:OD1":-.55,"ASN:ND2":0,"ASN:C":.6,"ASN:O":-.55,"ASP:N":-.15,"ASP:CA":.1,"ASP:CB":0,"ASP:CG":.14,"ASP:OD1":-.57,"ASP:OD2":-.57,"ASP:C":.6,"ASP:O":-.55,"CYS:N":-.15,"CYS:CA":.1,"CYS:CB":.19,"CYS:SG":-.19,"CYS:C":.6,"CYS:O":-.55,"GLN:N":-.15,"GLN:CA":.1,"GLN:CB":0,"GLN:CG":0,"GLN:CD":.55,"GLN:OE1":-.55,"GLN:NE2":0,"GLN:C":.6,"GLN:O":-.55,"GLU:N":-.15,"GLU:CA":.1,"GLU:CB":0,"GLU:CG":0,"GLU:CD":.14,"GLU:OE1":-.57,"GLU:OE2":-.57,"GLU:C":.6,"GLU:O":-.55,"GLY:N":-.15,"GLY:CA":.1,"GLY:C":.6,"GLY:O":-.55,"HIS:N":-.15,"HIS:CA":.1,"HIS:CB":0,"HIS:CG":.1,"HIS:ND1":-.1,"HIS:CD2":.1,"HIS:NE2":-.4,"HIS:CE1":.3,"HIS:C":.6,"HIS:O":-.55,"ILE:N":-.15,"ILE:CA":.1,"ILE:CB":0,"ILE:CG2":0,"ILE:CG1":0,"ILE:CD":0,"ILE:C":.6,"ILE:O":-.55,"LEU:N":-.15,"LEU:CA":.1,"LEU:CB":0,"LEU:CG":0,"LEU:CD1":0,"LEU:CD2":0,"LEU:C":.6,"LEU:O":-.55,"LYS:N":-.15,"LYS:CA":.1,"LYS:CB":0,"LYS:CG":0,"LYS:CD":0,"LYS:CE":.25,"LYS:NZ":.75,"LYS:C":.6,"LYS:O":-.55,"MET:N":-.15,"MET:CA":.1,"MET:CB":0,"MET:CG":.06,"MET:SD":-.12,"MET:CE":.06,"MET:C":.6,"MET:O":-.55,"PHE:N":-.15,"PHE:CA":.1,"PHE:CB":0,"PHE:CG":0,"PHE:CD1":0,"PHE:CD2":0,"PHE:CE1":0,"PHE:CE2":0,"PHE:CZ":0,"PHE:C":.6,"PHE:O":-.55,"PRO:N":-.25,"PRO:CD":.1,"PRO:CA":.1,"PRO:CB":0,"PRO:CG":0,"PRO:C":.6,"PRO:O":-.55,"SER:N":-.15,"SER:CA":.1,"SER:CB":.25,"SER:OG":-.25,"SER:C":.6,"SER:O":-.55,"THR:N":-.15,"THR:CA":.1,"THR:CB":.25,"THR:OG1":-.25,"THR:CG2":0,"THR:C":.6,"THR:O":-.55,"TRP:N":-.15,"TRP:CA":.1,"TRP:CB":0,"TRP:CG":-.03,"TRP:CD2":.1,"TRP:CE2":-.04,"TRP:CE3":-.03,"TRP:CD1":.06,"TRP:NE1":-.06,"TRP:CZ2":0,"TRP:CZ3":0,"TRP:CH2":0,"TRP:C":.6,"TRP:O":-.55,"TYR:N":-.15,"TYR:CA":.1,"TYR:CB":0,"TYR:CG":0,"TYR:CD1":0,"TYR:CE1":0,"TYR:CD2":0,"TYR:CE2":0,"TYR:CZ":.25,"TYR:OH":-.25,"TYR:C":.6,"TYR:O":-.55,"VAL:N":-.15,"VAL:CA":.1,"VAL:CB":0,"VAL:CG1":0,"VAL:CG2":0,"VAL:C":.6,"VAL:O":-.55};function i(s,o){if((!o||typeof s.partialCharge>"u")&&s.resn&&s.atom){var a=s.resn+":"+s.atom;s.properties.partialCharge=n[a]}}}),"./src/specs.ts":((r,e,t)=>{t.r(e)}),"./src/utilities.ts":((__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{PausableTimer:()=>PausableTimer,adjustVolumeStyle:()=>adjustVolumeStyle,base64ToArray:()=>base64ToArray,deepCopy:()=>deepCopy,download:()=>download,extend:()=>extend,get:()=>get,getAtomProperty:()=>getAtomProperty,getColorFromStyle:()=>getColorFromStyle,getElement:()=>getElement,getExtent:()=>getExtent,getPropertyRange:()=>getPropertyRange,getbin:()=>getbin,inflateString:()=>inflateString,isEmptyObject:()=>isEmptyObject,isNumeric:()=>isNumeric,makeFunction:()=>makeFunction,mergeGeos:()=>mergeGeos,specStringToObject:()=>specStringToObject});var _Gradient__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Gradient.ts"),_VolumeData__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./src/VolumeData.ts"),_colors__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./src/colors.ts"),pako__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/pako/dist/pako.esm.mjs");function extend(r,e){for(var t in e)e.hasOwnProperty(t)&&e[t]!==void 0&&(r[t]=e[t]);return r}function deepCopy(r){let e,t,n;if(r==null)return{};if(typeof r!="object"||r===null)return r;e=Array.isArray(r)?[]:{};for(n in r)t=r[n],e[n]=deepCopy(t);return e}function isNumeric(r){var e=typeof r;return(e==="number"||e==="string")&&!isNaN(r-parseFloat(r))}function isEmptyObject(r){return Object.keys(r).length===0}function makeFunction(callback){return callback&&typeof callback=="string"&&(callback=eval("("+callback+")")),callback&&typeof callback!="function"?(console.warn("Invalid callback provided."),()=>{}):callback}function adjustVolumeStyle(r){r&&(r.volformat&&!(r.voldata instanceof _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData)&&(r.voldata=new _VolumeData__WEBPACK_IMPORTED_MODULE_1__.VolumeData(r.voldata,r.volformat)),r.volscheme&&(r.volscheme=_Gradient__WEBPACK_IMPORTED_MODULE_0__.Gradient.getGradient(r.volscheme)))}function getExtent(r,e){var t,n,i,s,o,a,l,d,u,g,x=!e;if(t=n=i=9999,s=o=a=-9999,l=d=u=g=0,r.length===0)return[[0,0,0],[0,0,0],[0,0,0]];for(var y=0;y<r.length;y++){var b=r[y];if(!(typeof b>"u"||!isFinite(b.x)||!isFinite(b.y)||!isFinite(b.z))&&(g++,l+=b.x,d+=b.y,u+=b.z,t=t<b.x?t:b.x,n=n<b.y?n:b.y,i=i<b.z?i:b.z,s=s>b.x?s:b.x,o=o>b.y?o:b.y,a=a>b.z?a:b.z,b.symmetries&&x))for(var _=0;_<b.symmetries.length;_++)g++,l+=b.symmetries[_].x,d+=b.symmetries[_].y,u+=b.symmetries[_].z,t=t<b.symmetries[_].x?t:b.symmetries[_].x,n=n<b.symmetries[_].y?n:b.symmetries[_].y,i=i<b.symmetries[_].z?i:b.symmetries[_].z,s=s>b.symmetries[_].x?s:b.symmetries[_].x,o=o>b.symmetries[_].y?o:b.symmetries[_].y,a=a>b.symmetries[_].z?a:b.symmetries[_].z}return[[t,n,i],[s,o,a],[l/g,d/g,u/g]]}function getPropertyRange(r,e){for(var t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=0,s=r.length;i<s;i++){var o=r[i],a=getAtomProperty(o,e);a!=null&&(a<t&&(t=a),a>n&&(n=a))}return!isFinite(t)&&!isFinite(n)?t=n=0:isFinite(t)?isFinite(n)||(n=t):t=n,[t,n]}class PausableTimer{constructor(e,t,n){this.total_time_run=0,this.fn=e,this.arg=n,this.countdown=t,this.start_time=new Date().getTime(),this.ident=setTimeout(e,t,n)}cancel(){clearTimeout(this.ident)}pause(){clearTimeout(this.ident),this.total_time_run=new Date().getTime()-this.start_time}resume(){this.ident=setTimeout(this.fn,Math.max(0,this.countdown-this.total_time_run),this.arg)}}function base64ToArray(r){for(var e=window.atob(r),t=e.length,n=new Uint8Array(t),i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}function getAtomProperty(r,e){var t=null;return r.properties&&typeof r.properties[e]<"u"?t=r.properties[e]:typeof r[e]<"u"&&(t=r[e]),t}function mergeGeos(r,e){var t=e.geometry;t!==void 0&&r.geometryGroups.push(t.geometryGroups[0])}function specStringToObject(r){if(typeof r=="object")return r;if(typeof r>"u"||r==null)return r;try{return JSON.parse(r)}catch{}r=r.replace(/%7E/g,"~");var e=function(x){return isNumeric(x)?Math.floor(parseFloat(x))==parseInt(x)||x.indexOf(".")>=0?parseFloat(x):parseInt(x):x==="true"?!0:x==="false"?!1:x},t={};if(r==="all")return t;for(var n=r.split(";"),i=0;i<n.length;i++){var s=n[i].split(":"),o=s[0],a={},l=s[1];if(l)if(l=l.replace(/~/g,"="),l.indexOf("=")!==-1)for(var d=l.split(","),u=0;u<d.length;u++){var g=d[u].split("=",2);a[g[0]]=e(g[1])}else l.indexOf(",")!==-1?a=l.split(","):a=e(l);t[o]=a}return t}function checkStatus(r){if(!r.ok)throw new Error(`HTTP ${r.status} - ${r.statusText}`);return r}function get(r,e){var t=fetch(r).then(checkStatus).then(n=>n.text());return e?t.then(e):t}function getbin(r,e,t,n){var i;return t=="POST"?i=fetch(r,{method:"POST",body:n}).then(s=>checkStatus(s)).then(s=>s.arrayBuffer()):i=fetch(r).then(s=>checkStatus(s)).then(s=>s.arrayBuffer()),e?i.then(e):i}function download(r,e,t,n){var i="",s="",o="",a=null,l=e.addModel();if(r.indexOf(":")<0&&(r.length==4?r="pdb:"+r:isNaN(r)?r="url:"+r:r="cid:"+r),r.substring(0,5)=="mmtf:"&&(console.warn("WARNING: MMTF now deprecated.  Reverting to bcif."),r="bcif:"+r.slice(5)),r.substring(0,5)==="bcif:")r=r.substring(5).toUpperCase(),o="https://models.rcsb.org/"+r+".bcif.gz",t&&typeof t.noComputeSecondaryStructure>"u"&&(t.noComputeSecondaryStructure=!0),a=new Promise(function(u){getbin(o).then(function(g){l.addMolData(g,"bcif.gz",t),e.zoomTo(),e.render(),u(l)},function(){console.error("fetch of "+o+" failed.")})});else{if(r.substring(0,4)==="pdb:"){if(i="bcif",t&&t.format&&(i=t.format),t&&typeof t.noComputeSecondaryStructure>"u"&&(t.noComputeSecondaryStructure=!0),r=r.substring(4).toUpperCase(),!r.match(/^[1-9][A-Za-z0-9]{3}$/)){alert("Wrong PDB ID");return}i=="bcif"?o="https://models.rcsb.org/"+r.toUpperCase()+".bcif.gz":(s=t&&t.pdbUri?t.pdbUri:"https://files.rcsb.org/view/",o=s+r+"."+i)}else if(r.substring(0,4)=="cid:"){if(i="sdf",r=r.substring(4),!r.match(/^[0-9]+$/)){alert("Wrong Compound ID");return}o="https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/cid/"+r+"/SDF?record_type=3d"}else r.substring(0,4)=="url:"&&(o=r.substring(4),i=o);var d=function(u){l.addMolData(u,i,t),e.zoomTo(),e.render()};a=new Promise(function(u){i=="bcif"?getbin(o).then(function(g){d(g),u(l)}).catch(function(){s=t&&t.pdbUri?t.pdbUri:"https://files.rcsb.org/view/",o=s+r+".pdb",i="pdb",console.warn("falling back to pdb format"),get(o).then(function(g){d(g),u(l)}).catch(function(g){d(""),u(l),console.error("fetch of "+o+" failed: "+g.statusText)})}):get(o).then(function(g){d(g),u(l)}).catch(function(g){d(""),u(l),console.error("fetch of "+o+" failed: "+g.statusText)})})}return n?(a.then(function(u){n(u)}),l):a}function getColorFromStyle(r,e){let t=e.colorscheme;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[t]<"u")t=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[t];else if(typeof t=="string"&&t.endsWith("Carbon")){let o=t.substring(0,t.lastIndexOf("Carbon")).toLowerCase();if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[o]<"u"){let a=Object.assign({},_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors.defaultColors);a.C=_colors__WEBPACK_IMPORTED_MODULE_2__.htmlColors[o],_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[t]={prop:"elem",map:a},t=_colors__WEBPACK_IMPORTED_MODULE_2__.builtinColorSchemes[t]}}let n=r.color;if(typeof e.color<"u"&&e.color!="spectrum"&&(n=e.color),typeof t<"u"){let o,a;if(typeof _colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[t]<"u")t=_colors__WEBPACK_IMPORTED_MODULE_2__.elementColors[t],typeof t[r[t.prop]]<"u"&&(n=t.map[r[t.prop]]);else if(typeof t[r[t.prop]]<"u")n=t.map[r[t.prop]];else if(typeof t.prop<"u"&&typeof t.gradient<"u"){o=t.prop;var i=t.gradient;i instanceof _Gradient__WEBPACK_IMPORTED_MODULE_0__.GradientType||(i=(0,_Gradient__WEBPACK_IMPORTED_MODULE_0__.getGradient)(t));let l=i.range()||[-1,1];a=getAtomProperty(r,o),a!=null&&(n=i.valueToHex(a,l))}else typeof t.prop<"u"&&typeof t.map<"u"?(o=t.prop,a=getAtomProperty(r,o),typeof t.map[a]<"u"&&(n=t.map[a])):typeof e.colorscheme[r.elem]<"u"?n=e.colorscheme[r.elem]:console.warn("Could not interpret colorscheme "+t)}else typeof e.colorfunc<"u"&&(n=e.colorfunc(r));return _colors__WEBPACK_IMPORTED_MODULE_2__.CC.color(n)}function getElement(r){let e=r;return typeof r=="string"?e=document.querySelector("#"+r):typeof r=="object"&&r.get&&(e=r.get(0)),e}function inflateString(r,e=!0){let t;return typeof r=="string"?t=new TextEncoder().encode(r):t=new Uint8Array(r),(0,pako__WEBPACK_IMPORTED_MODULE_3__.inflate)(t,{to:e?"string":null})}}),"./src/vendor/mmtf.js":(function(r,e){(function(t,n){n(e)})(this,function(t){function n(Q,it,ec){for(var a0=(Q.byteLength,0),u0=ec.length;u0>a0;a0++){var E0=ec.charCodeAt(a0);if(128>E0)Q.setUint8(it++,E0>>>0&127|0);else if(2048>E0)Q.setUint8(it++,E0>>>6&31|192),Q.setUint8(it++,E0>>>0&63|128);else if(65536>E0)Q.setUint8(it++,E0>>>12&15|224),Q.setUint8(it++,E0>>>6&63|128),Q.setUint8(it++,E0>>>0&63|128);else{if(!(1114112>E0))throw new Error("bad codepoint "+E0);Q.setUint8(it++,E0>>>18&7|240),Q.setUint8(it++,E0>>>12&63|128),Q.setUint8(it++,E0>>>6&63|128),Q.setUint8(it++,E0>>>0&63|128)}}}function i(Q){for(var it=0,ec=0,a0=Q.length;a0>ec;ec++){var u0=Q.charCodeAt(ec);if(128>u0)it+=1;else if(2048>u0)it+=2;else if(65536>u0)it+=3;else{if(!(1114112>u0))throw new Error("bad codepoint "+u0);it+=4}}return it}function s(Q,it,ec){var a0=typeof Q;if(a0==="string"){var u0=i(Q);if(32>u0)return it.setUint8(ec,160|u0),n(it,ec+1,Q),1+u0;if(256>u0)return it.setUint8(ec,217),it.setUint8(ec+1,u0),n(it,ec+2,Q),2+u0;if(65536>u0)return it.setUint8(ec,218),it.setUint16(ec+1,u0),n(it,ec+3,Q),3+u0;if(4294967296>u0)return it.setUint8(ec,219),it.setUint32(ec+1,u0),n(it,ec+5,Q),5+u0}if(Q instanceof Uint8Array){var u0=Q.byteLength,E0=new Uint8Array(it.buffer);if(256>u0)return it.setUint8(ec,196),it.setUint8(ec+1,u0),E0.set(Q,ec+2),2+u0;if(65536>u0)return it.setUint8(ec,197),it.setUint16(ec+1,u0),E0.set(Q,ec+3),3+u0;if(4294967296>u0)return it.setUint8(ec,198),it.setUint32(ec+1,u0),E0.set(Q,ec+5),5+u0}if(a0==="number"){if(!isFinite(Q))throw new Error("Number not finite: "+Q);if(Math.floor(Q)!==Q)return it.setUint8(ec,203),it.setFloat64(ec+1,Q),9;if(Q>=0){if(128>Q)return it.setUint8(ec,Q),1;if(256>Q)return it.setUint8(ec,204),it.setUint8(ec+1,Q),2;if(65536>Q)return it.setUint8(ec,205),it.setUint16(ec+1,Q),3;if(4294967296>Q)return it.setUint8(ec,206),it.setUint32(ec+1,Q),5;throw new Error("Number too big 0x"+Q.toString(16))}if(Q>=-32)return it.setInt8(ec,Q),1;if(Q>=-128)return it.setUint8(ec,208),it.setInt8(ec+1,Q),2;if(Q>=-32768)return it.setUint8(ec,209),it.setInt16(ec+1,Q),3;if(Q>=-2147483648)return it.setUint8(ec,210),it.setInt32(ec+1,Q),5;throw new Error("Number too small -0x"+(-Q).toString(16).substr(1))}if(Q===null)return it.setUint8(ec,192),1;if(a0==="boolean")return it.setUint8(ec,Q?195:194),1;if(a0==="object"){var u0,p0=0,O0=Array.isArray(Q);if(O0)u0=Q.length;else{var He=Object.keys(Q);u0=He.length}var p0;if(16>u0?(it.setUint8(ec,u0|(O0?144:128)),p0=1):65536>u0?(it.setUint8(ec,O0?220:222),it.setUint16(ec+1,u0),p0=3):4294967296>u0&&(it.setUint8(ec,O0?221:223),it.setUint32(ec+1,u0),p0=5),O0)for(var x0=0;u0>x0;x0++)p0+=s(Q[x0],it,ec+p0);else for(var x0=0;u0>x0;x0++){var L0=He[x0];p0+=s(L0,it,ec+p0),p0+=s(Q[L0],it,ec+p0)}return p0}throw new Error("Unknown type "+a0)}function o(Q){var it=typeof Q;if(it==="string"){var ec=i(Q);if(32>ec)return 1+ec;if(256>ec)return 2+ec;if(65536>ec)return 3+ec;if(4294967296>ec)return 5+ec}if(Q instanceof Uint8Array){var ec=Q.byteLength;if(256>ec)return 2+ec;if(65536>ec)return 3+ec;if(4294967296>ec)return 5+ec}if(it==="number"){if(Math.floor(Q)!==Q)return 9;if(Q>=0){if(128>Q)return 1;if(256>Q)return 2;if(65536>Q)return 3;if(4294967296>Q)return 5;throw new Error("Number too big 0x"+Q.toString(16))}if(Q>=-32)return 1;if(Q>=-128)return 2;if(Q>=-32768)return 3;if(Q>=-2147483648)return 5;throw new Error("Number too small -0x"+Q.toString(16).substr(1))}if(it==="boolean"||Q===null)return 1;if(it==="object"){var ec,a0=0;if(Array.isArray(Q)){ec=Q.length;for(var u0=0;ec>u0;u0++)a0+=o(Q[u0])}else{var E0=Object.keys(Q);ec=E0.length;for(var u0=0;ec>u0;u0++){var O0=E0[u0];a0+=o(O0)+o(Q[O0])}}if(16>ec)return 1+a0;if(65536>ec)return 3+a0;if(4294967296>ec)return 5+a0;throw new Error("Array or object too long 0x"+ec.toString(16))}throw new Error("Unknown type "+it)}function a(Q){var it=new ArrayBuffer(o(Q)),ec=new DataView(it);return s(Q,ec,0),new Uint8Array(it)}function l(Q,it,ec){return it?new Q(it.buffer,it.byteOffset,it.byteLength/(ec||1)):void 0}function d(Q){return l(DataView,Q)}function u(Q){return l(Uint8Array,Q)}function g(Q){return l(Int8Array,Q)}function x(Q){return l(Int32Array,Q,4)}function y(Q){return l(Float32Array,Q,4)}function b(Q,it){var ec=Q.length/2;it||(it=new Int16Array(ec));for(var a0=0,u0=0;ec>a0;++a0,u0+=2)it[a0]=Q[u0]<<8^Q[u0+1]<<0;return it}function _(Q,it){var ec=Q.length;it||(it=new Uint8Array(2*ec));for(var a0=d(it),u0=0;ec>u0;++u0)a0.setInt16(2*u0,Q[u0]);return u(it)}function h(Q,it){var ec=Q.length/4;it||(it=new Int32Array(ec));for(var a0=0,u0=0;ec>a0;++a0,u0+=4)it[a0]=Q[u0]<<24^Q[u0+1]<<16^Q[u0+2]<<8^Q[u0+3]<<0;return it}function f(Q,it){var ec=Q.length;it||(it=new Uint8Array(4*ec));for(var a0=d(it),u0=0;ec>u0;++u0)a0.setInt32(4*u0,Q[u0]);return u(it)}function E(Q,it){var ec=Q.length;it||(it=new Float32Array(ec/4));for(var a0=d(it),u0=d(Q),E0=0,O0=0,He=ec/4;He>E0;++E0,O0+=4)a0.setFloat32(O0,u0.getFloat32(O0),!0);return it}function m(Q,it,ec){var a0=Q.length,u0=1/it;ec||(ec=new Float32Array(a0));for(var E0=0;a0>E0;++E0)ec[E0]=Q[E0]*u0;return ec}function S(Q,it,ec){var a0=Q.length;ec||(ec=new Int32Array(a0));for(var u0=0;a0>u0;++u0)ec[u0]=Math.round(Q[u0]*it);return ec}function w(Q,it){var ec,a0;if(!it){var u0=0;for(ec=0,a0=Q.length;a0>ec;ec+=2)u0+=Q[ec+1];it=new Q.constructor(u0)}var E0=0;for(ec=0,a0=Q.length;a0>ec;ec+=2)for(var O0=Q[ec],He=Q[ec+1],p0=0;He>p0;++p0)it[E0]=O0,++E0;return it}function v(Q){if(Q.length===0)return new Int32Array;var it,ec,a0=2;for(it=1,ec=Q.length;ec>it;++it)Q[it-1]!==Q[it]&&(a0+=2);var u0=new Int32Array(a0),E0=0,O0=1;for(it=1,ec=Q.length;ec>it;++it)Q[it-1]!==Q[it]?(u0[E0]=Q[it-1],u0[E0+1]=O0,O0=1,E0+=2):++O0;return u0[E0]=Q[Q.length-1],u0[E0+1]=O0,u0}function A(Q,it){var ec=Q.length;it||(it=new Q.constructor(ec)),ec&&(it[0]=Q[0]);for(var a0=1;ec>a0;++a0)it[a0]=Q[a0]+it[a0-1];return it}function M(Q,it){var ec=Q.length;it||(it=new Q.constructor(ec)),it[0]=Q[0];for(var a0=1;ec>a0;++a0)it[a0]=Q[a0]-Q[a0-1];return it}function T(Q,it){var ec,a0,u0=Q instanceof Int8Array?127:32767,E0=-u0-1,O0=Q.length;if(!it){var He=0;for(ec=0;O0>ec;++ec)Q[ec]<u0&&Q[ec]>E0&&++He;it=new Int32Array(He)}for(ec=0,a0=0;O0>ec;){for(var p0=0;Q[ec]===u0||Q[ec]===E0;)p0+=Q[ec],++ec;p0+=Q[ec],++ec,it[a0]=p0,++a0}return it}function R(Q,it){var ec,a0=32767,u0=-a0-1,E0=Q.length,O0=0;for(ec=0;E0>ec;++ec){var He=Q[ec];He===0?++O0:He>0?(O0+=Math.ceil(He/a0),He%a0===0&&(O0+=1)):(O0+=Math.ceil(He/u0),He%u0===0&&(O0+=1))}var p0=new Int16Array(O0),x0=0;for(ec=0;E0>ec;++ec){var He=Q[ec];if(He>=0)for(;He>=a0;)p0[x0]=a0,++x0,He-=a0;else for(;u0>=He;)p0[x0]=u0,++x0,He-=u0;p0[x0]=He,++x0}return p0}function P(Q,it){return A(w(Q),it)}function L(Q){return v(M(Q))}function O(Q,it,ec){return m(w(Q,x(ec)),it,ec)}function I(Q,it){return v(S(Q,it))}function N(Q,it,ec){return m(A(Q,x(ec)),it,ec)}function k(Q,it,ec){return M(S(Q,it),ec)}function U(Q,it,ec){return m(T(Q,x(ec)),it,ec)}function F(Q,it,ec){var a0=T(Q,x(ec));return N(a0,it,y(a0))}function j(Q,it,ec){return R(k(Q,it))}function H(E0){var it=d(E0),ec=it.getInt32(0),a0=it.getInt32(4),u0=E0.subarray(8,12),E0=E0.subarray(12);return[ec,E0,a0,u0]}function B(Q,it,ec,a0){var u0=new ArrayBuffer(12+a0.byteLength),E0=new Uint8Array(u0),O0=new DataView(u0);return O0.setInt32(0,Q),O0.setInt32(4,it),ec&&E0.set(ec,8),E0.set(a0,12),E0}function V(Q){var it=Q.length,ec=u(Q);return B(2,it,void 0,ec)}function K(Q){var it=Q.length,ec=f(Q);return B(4,it,void 0,ec)}function q(Q,it){var ec=Q.length/it,a0=f([it]),u0=u(Q);return B(5,ec,a0,u0)}function Te(Q){var it=Q.length,ec=f(v(Q));return B(6,it,void 0,ec)}function Fe(Q){var it=Q.length,ec=f(L(Q));return B(8,it,void 0,ec)}function We(Q,it){var ec=Q.length,a0=f([it]),u0=f(I(Q,it));return B(9,ec,a0,u0)}function J(Q,it){var ec=Q.length,a0=f([it]),u0=_(j(Q,it));return B(10,ec,a0,u0)}function et(Q){var it={};return C0.forEach(function(ec){Q[ec]!==void 0&&(it[ec]=Q[ec])}),Q.bondAtomList&&(it.bondAtomList=K(Q.bondAtomList)),Q.bondOrderList&&(it.bondOrderList=V(Q.bondOrderList)),it.xCoordList=J(Q.xCoordList,1e3),it.yCoordList=J(Q.yCoordList,1e3),it.zCoordList=J(Q.zCoordList,1e3),Q.bFactorList&&(it.bFactorList=J(Q.bFactorList,100)),Q.atomIdList&&(it.atomIdList=Fe(Q.atomIdList)),Q.altLocList&&(it.altLocList=Te(Q.altLocList)),Q.occupancyList&&(it.occupancyList=We(Q.occupancyList,100)),it.groupIdList=Fe(Q.groupIdList),it.groupTypeList=K(Q.groupTypeList),Q.secStructList&&(it.secStructList=V(Q.secStructList)),Q.insCodeList&&(it.insCodeList=Te(Q.insCodeList)),Q.sequenceIndexList&&(it.sequenceIndexList=Fe(Q.sequenceIndexList)),it.chainIdList=q(Q.chainIdList,4),Q.chainNameList&&(it.chainNameList=q(Q.chainNameList,4)),it}function ht(Q){function it(p0){for(var x0={},L0=0;p0>L0;L0++){var c0=E0();x0[c0]=E0()}return x0}function ec(p0){var x0=Q.subarray(O0,O0+p0);return O0+=p0,x0}function a0(p0){var x0=Q.subarray(O0,O0+p0);O0+=p0;var L0=65535;if(p0>L0){for(var c0=[],b0=0;b0<x0.length;b0+=L0)c0.push(String.fromCharCode.apply(null,x0.subarray(b0,b0+L0)));return c0.join("")}return String.fromCharCode.apply(null,x0)}function u0(p0){for(var x0=new Array(p0),L0=0;p0>L0;L0++)x0[L0]=E0();return x0}function E0(){var p0,x0,L0=Q[O0];if((128&L0)===0)return O0++,L0;if((240&L0)===128)return x0=15&L0,O0++,it(x0);if((240&L0)===144)return x0=15&L0,O0++,u0(x0);if((224&L0)===160)return x0=31&L0,O0++,a0(x0);if((224&L0)===224)return p0=He.getInt8(O0),O0++,p0;switch(L0){case 192:return O0++,null;case 194:return O0++,!1;case 195:return O0++,!0;case 196:return x0=He.getUint8(O0+1),O0+=2,ec(x0);case 197:return x0=He.getUint16(O0+1),O0+=3,ec(x0);case 198:return x0=He.getUint32(O0+1),O0+=5,ec(x0);case 202:return p0=He.getFloat32(O0+1),O0+=5,p0;case 203:return p0=He.getFloat64(O0+1),O0+=9,p0;case 204:return p0=Q[O0+1],O0+=2,p0;case 205:return p0=He.getUint16(O0+1),O0+=3,p0;case 206:return p0=He.getUint32(O0+1),O0+=5,p0;case 208:return p0=He.getInt8(O0+1),O0+=2,p0;case 209:return p0=He.getInt16(O0+1),O0+=3,p0;case 210:return p0=He.getInt32(O0+1),O0+=5,p0;case 217:return x0=He.getUint8(O0+1),O0+=2,a0(x0);case 218:return x0=He.getUint16(O0+1),O0+=3,a0(x0);case 219:return x0=He.getUint32(O0+1),O0+=5,a0(x0);case 220:return x0=He.getUint16(O0+1),O0+=3,u0(x0);case 221:return x0=He.getUint32(O0+1),O0+=5,u0(x0);case 222:return x0=He.getUint16(O0+1),O0+=3,it(x0);case 223:return x0=He.getUint32(O0+1),O0+=5,it(x0)}throw new Error("Unknown type 0x"+L0.toString(16))}var O0=0,He=new DataView(Q.buffer);return E0()}function er(Q,it,ec,a0){switch(Q){case 1:return E(it);case 2:return g(it);case 3:return b(it);case 4:return h(it);case 5:return u(it);case 6:return w(h(it),new Uint8Array(ec));case 7:return w(h(it));case 8:return P(h(it));case 9:return O(h(it),h(a0)[0]);case 10:return F(b(it),h(a0)[0]);case 11:return m(b(it),h(a0)[0]);case 12:return U(b(it),h(a0)[0]);case 13:return U(g(it),h(a0)[0]);case 14:return T(b(it));case 15:return T(g(it))}}function tr(Q,it){it=it||{};var ec=it.ignoreFields,a0={};return R0.forEach(function(u0){var E0=ec?ec.indexOf(u0)!==-1:!1,O0=Q[u0];E0||O0===void 0||(O0 instanceof Uint8Array?a0[u0]=er.apply(null,H(O0)):a0[u0]=O0)}),a0}function Hm(Q){return String.fromCharCode.apply(null,Q).replace(/\0/g,"")}function oi(Q,it,ec){ec=ec||{};var a0,u0,E0,O0,He,p0,x0=ec.firstModelOnly,L0=it.onModel,c0=it.onChain,b0=it.onGroup,ut=it.onAtom,hi=it.onBond,S0=0,W=0,t0=0,o0=0,Ji=0,m0=-1,I0=Q.chainNameList,Z=Q.secStructList,at=Q.insCodeList,lt=Q.sequenceIndexList,n0=Q.atomIdList,r0=Q.bFactorList,f0=Q.altLocList,v0=Q.occupancyList,A0=Q.bondAtomList,X0=Q.bondOrderList;for(a0=0,u0=Q.chainsPerModel.length;u0>a0&&!(x0&&S0>0);++a0){var q0=Q.chainsPerModel[S0];for(L0&&L0({chainCount:q0,modelIndex:S0}),E0=0;q0>E0;++E0){var i1=Q.groupsPerChain[W];if(c0){var u1=Hm(Q.chainIdList.subarray(4*W,4*W+4)),e1=null;I0&&(e1=Hm(I0.subarray(4*W,4*W+4))),c0({groupCount:i1,chainIndex:W,modelIndex:S0,chainId:u1,chainName:e1})}for(O0=0;i1>O0;++O0){var Q0=Q.groupList[Q.groupTypeList[t0]],e0=Q0.atomNameList.length;if(b0){var T0=null;Z&&(T0=Z[t0]);var F0=null;Q.insCodeList&&(F0=String.fromCharCode(at[t0]));var N0=null;lt&&(N0=lt[t0]),b0({atomCount:e0,groupIndex:t0,chainIndex:W,modelIndex:S0,groupId:Q.groupIdList[t0],groupType:Q.groupTypeList[t0],groupName:Q0.groupName,singleLetterCode:Q0.singleLetterCode,chemCompType:Q0.chemCompType,secStruct:T0,insCode:F0,sequenceIndex:N0})}for(He=0;e0>He;++He){if(ut){var H0=null;n0&&(H0=n0[o0]);var r1=null;r0&&(r1=r0[o0]);var h1=null;f0&&(h1=String.fromCharCode(f0[o0]));var p1=null;v0&&(p1=v0[o0]),ut({atomIndex:o0,groupIndex:t0,chainIndex:W,modelIndex:S0,atomId:H0,element:Q0.elementList[He],atomName:Q0.atomNameList[He],formalCharge:Q0.formalChargeList[He],xCoord:Q.xCoordList[o0],yCoord:Q.yCoordList[o0],zCoord:Q.zCoordList[o0],bFactor:r1,altLoc:h1,occupancy:p1})}o0+=1}if(hi){var o1=Q0.bondAtomList;for(He=0,p0=Q0.bondOrderList.length;p0>He;++He)hi({atomIndex1:o0-e0+o1[2*He],atomIndex2:o0-e0+o1[2*He+1],bondOrder:Q0.bondOrderList[He]})}t0+=1}W+=1}if(Ji=m0+1,m0=o0-1,hi&&A0)for(He=0,p0=A0.length;p0>He;He+=2){var G0=A0[He],s1=A0[He+1];(G0>=Ji&&m0>=G0||s1>=Ji&&m0>=s1)&&hi({atomIndex1:G0,atomIndex2:s1,bondOrder:X0?X0[He/2]:null})}S0+=1}}function h0(Q){return a(et(Q))}function l0(Q,it){Q instanceof ArrayBuffer&&(Q=new Uint8Array(Q));var ec;return ec=Q instanceof Uint8Array?ht(Q):Q,tr(ec,it)}function M0(Q,it,ec,a0){function u0(){try{var O0=l0(E0.response);ec(O0)}catch(He){a0(He)}}var E0=new XMLHttpRequest;E0.addEventListener("load",u0,!0),E0.addEventListener("error",a0,!0),E0.responseType="arraybuffer",E0.open("GET",it+Q.toUpperCase()),E0.send()}function U0(Q,it,ec){M0(Q,d0,it,ec)}function _0(Q,it,ec){M0(Q,w0,it,ec)}var C0=["mmtfVersion","mmtfProducer","unitCell","spaceGroup","structureId","title","depositionDate","releaseDate","experimentalMethods","resolution","rFree","rWork","bioAssemblyList","ncsOperatorList","entityList","groupList","numBonds","numAtoms","numGroups","numChains","numModels","groupsPerChain","chainsPerModel"],P0=["xCoordList","yCoordList","zCoordList","groupIdList","groupTypeList","chainIdList","bFactorList","atomIdList","altLocList","occupancyList","secStructList","insCodeList","sequenceIndexList","chainNameList","bondAtomList","bondOrderList"],R0=C0.concat(P0),si="v1.0.1",Xe="//mmtf.rcsb.org/v1.0/",d0=Xe+"full/",w0=Xe+"reduced/";t.encode=h0,t.decode=l0,t.traverse=oi,t.fetch=U0,t.fetchReduced=_0,t.version=si,t.fetchUrl=d0,t.fetchReducedUrl=w0,t.encodeMsgpack=a,t.encodeMmtf=et,t.decodeMsgpack=ht,t.decodeMmtf=tr})})},__webpack_module_cache__={};function __webpack_require__(r){var e=__webpack_module_cache__[r];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[r]={exports:{}};return __webpack_modules__[r].call(t.exports,t,t.exports,__webpack_require__),t.exports}__webpack_require__.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(r,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},__webpack_require__.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),__webpack_require__.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},__webpack_require__("./src/index.ts"),__webpack_require__("./src/SurfaceWorker.js");var __webpack_exports__=__webpack_require__("./src/exporter.js");return __webpack_exports__})())})(_3Dmol$1)),_3Dmol$1.exports}var _3DmolExports=require_3Dmol();const InteractionType={HydrogenBond:"Hydrogen Bond",Hydrophobic:"Hydrophobic",SaltBridge:"Salt Bridge",PiStacking:"Pi-Stacking",HalogenBond:"Halogen Bond",MetalCoordination:"Metal Coordination",Unknown:"Unknown"},Viewer3Dmol=({file:r,onStructureLoaded:e,selectedLigand:t,interactions:n,showInteractions:i,visualSettings:s,triggerRecenter:o})=>{const a=reactExports.useRef(null),l=reactExports.useRef(null),[d,u]=reactExports.useState(!1);reactExports.useEffect(()=>{if(!a.current)return;const b={backgroundColor:"white"},_=_3DmolExports.createViewer(a.current,b);return l.current=_,()=>{l.current&&l.current.clear()}},[]),reactExports.useEffect(()=>{if(!r||!l.current)return;u(!0);const b=new FileReader;b.onload=_=>{const h=_.target?.result,f=r.name.split(".").pop()||"pdb",E=l.current;E.clear(),E.addModel(h,f),E.setStyle({},{cartoon:{color:"#888888",opacity:1}}),E.zoomTo(),E.render();const m=new Blob([h],{type:"text/plain"}),S=new Ol(document.createElement("div"));S.loadFile(m,{ext:f}).then(w=>{w&&(e(w.structure),S.dispose()),u(!1)}).catch(w=>{console.error("NGL Parse Error:",w),u(!1)})},b.readAsText(r)},[r,e]),reactExports.useEffect(()=>{if(o>0&&l.current)if(t){const _={resi:t.resNos??[t.resNo],chain:t.chain};l.current.zoomTo(_,500)}else l.current.zoomTo({},500)},[o,t]),reactExports.useEffect(()=>{const b=l.current;if(!b)return;b.removeAllShapes(),b.setStyle({},{});let _={};if(t&&(_={resi:t.resNos??[t.resNo],chain:t.chain}),s.proteinStyle!=="hidden"){let h={};const f="#cccccc";switch(s.proteinStyle){case"cartoon":h={cartoon:{color:f,opacity:.15}};break;case"rope":h={cartoon:{color:f,style:"trace",radius:.3}};break;case"trace":h={stick:{radius:.2,color:f}};break;case"line":h={line:{color:f}};break;default:h={cartoon:{color:f}}}b.setStyle({},h)}if(t&&n&&n.length>0)try{const h=n.filter(f=>f&&f.proteinAtom).map(f=>({resi:f.proteinAtom.resNo,chain:f.proteinAtom.chain}));if(h.length>0){const f=Array.from(new Set(h.map(S=>JSON.stringify(S)))).map(S=>JSON.parse(S)),E={or:f};let m={};switch(s.pocketStyle){case"licorice":m={stick:{radius:.2}};break;case"stick":m={stick:{radius:.2}};break;case"ball+stick":m={stick:{radius:.2},sphere:{scale:.25}};break;default:m={stick:{radius:.2}};break}b.addStyle(E,m),b.removeAllLabels(),f.forEach(S=>{const w=n.find(M=>M.proteinAtom&&M.proteinAtom.resNo===S.resi&&M.proteinAtom.chain===S.chain),v=w?w.proteinAtom.resName:"",A=v?`${v} ${S.resi}`:`${S.resi}`;b.addLabel(A,{fontSize:11,fontColor:"#374151",backgroundColor:"white",backgroundOpacity:.85,inFront:!0,alignment:"center"},{resi:S.resi,chain:S.chain,atom:"CA"})})}}catch(h){console.error("Error rendering pocket:",h)}if(t){let h={};switch(s.ligandStyle){case"ball+stick":h={stick:{radius:.25,colorscheme:{prop:"elem",map:{C:s.ligandColor,N:"#3b82f6",O:"#ef4444",S:"#fbbf24",P:"#f97316",default:"#9ca3af"}}},sphere:{scale:.25,colorscheme:{prop:"elem",map:{C:s.ligandColor,N:"#3b82f6",O:"#ef4444",S:"#fbbf24",P:"#f97316",default:"#9ca3af"}}}};break;case"spacefill":h={sphere:{colorscheme:{prop:"elem",map:{C:s.ligandColor,N:"#3b82f6",O:"#ef4444",S:"#fbbf24",P:"#f97316",default:"#9ca3af"}}}};break;case"licorice":h={stick:{radius:.3,colorscheme:{prop:"elem",map:{C:s.ligandColor,N:"#3b82f6",O:"#ef4444",S:"#fbbf24",P:"#f97316",default:"#9ca3af"}}}};break}b.setStyle(_,h)}i&&n.length>0&&n.forEach(h=>{const f={x:h.proteinAtom.x,y:h.proteinAtom.y,z:h.proteinAtom.z},E={x:h.ligandAtom.x,y:h.ligandAtom.y,z:h.ligandAtom.z};let m="gray",S=!1;switch(h.type){case InteractionType.HydrogenBond:m="#3b82f6",S=!0;break;case InteractionType.SaltBridge:m="#eab308",S=!0;break;case InteractionType.PiStacking:m="#22c55e",S=!1;break;case InteractionType.Hydrophobic:m="#a3a3a3",S=!0;break;case InteractionType.HalogenBond:m="#a855f7",S=!0;break}b.addCylinder({start:f,end:E,radius:s.interactionWidth/20,color:m,dashed:S,fromCap:1,toCap:1})}),b.render(),t&&n.length>0&&setTimeout(()=>{b.zoomTo(_,500,1.5)},100)},[t,n,i,s]);const g=b=>{if(l.current){const _=b>0?.8:1.2;l.current.zoom(_)}},x=(b,_)=>{l.current&&l.current.translate(b,_)},y=b=>{if(b.stopPropagation(),l.current){const _=l.current.pngURI(),h=document.createElement("a");h.href=_,h.download="ligand_view.png",h.click()}};return r?jsxRuntimeExports.jsxs("div",{className:"relative w-full h-full bg-white overflow-hidden group shadow-inner rounded-lg",children:[d&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center gap-2",children:[jsxRuntimeExports.jsx(LoaderCircle,{className:"animate-spin text-indigo-600",size:32}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-slate-600",children:"Loading Structure..."})]})}),jsxRuntimeExports.jsx("div",{ref:a,className:"absolute inset-0 w-full h-full"}),jsxRuntimeExports.jsxs("div",{className:"absolute top-2 right-2 md:top-4 md:right-4 flex flex-col gap-1 md:gap-2 bg-white/95 p-1.5 md:p-2 rounded-lg shadow-md border border-slate-200 backdrop-blur-sm z-10",children:[jsxRuntimeExports.jsx("button",{onClick:()=>g(-5),className:"p-2.5 md:p-2 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors active:bg-indigo-100",title:"Zoom In",children:jsxRuntimeExports.jsx(ZoomIn,{size:18})}),jsxRuntimeExports.jsx("button",{onClick:()=>g(5),className:"p-2.5 md:p-2 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors active:bg-indigo-100",title:"Zoom Out",children:jsxRuntimeExports.jsx(ZoomOut,{size:18})}),jsxRuntimeExports.jsx("hr",{className:"border-slate-200 my-0.5 md:my-1"}),jsxRuntimeExports.jsxs("div",{className:"hidden md:grid grid-cols-3 gap-0.5",children:[jsxRuntimeExports.jsx("div",{className:"col-start-2",children:jsxRuntimeExports.jsx("button",{onClick:()=>x(0,20),className:"p-1.5 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Pan Up",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M8 3l4 4H4z"})})})}),jsxRuntimeExports.jsx("button",{onClick:()=>x(-20,0),className:"p-1.5 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors col-start-1 row-start-2",title:"Pan Left",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M3 8l4-4v8z"})})}),jsxRuntimeExports.jsx("button",{onClick:()=>x(20,0),className:"p-1.5 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors col-start-3 row-start-2",title:"Pan Right",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M13 8l-4 4V4z"})})}),jsxRuntimeExports.jsx("div",{className:"col-start-2 row-start-3",children:jsxRuntimeExports.jsx("button",{onClick:()=>x(0,-20),className:"p-1.5 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors",title:"Pan Down",children:jsxRuntimeExports.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M8 13l-4-4h8z"})})})})]}),jsxRuntimeExports.jsx("hr",{className:"border-slate-200 my-0.5 md:my-1 hidden md:block"}),jsxRuntimeExports.jsx("button",{onClick:y,className:"p-2.5 md:p-2 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors active:bg-indigo-100",title:"Snapshot",children:jsxRuntimeExports.jsx(Camera,{size:18})})]})]}):jsxRuntimeExports.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-500 bg-gradient-to-br from-slate-50 to-slate-100 border-dashed border-2 border-slate-200 rounded-lg select-none px-4 py-8",children:[jsxRuntimeExports.jsx("p",{className:"text-xs md:text-sm text-center text-slate-400 mb-2 max-w-xs",children:"Upload a structure file or click Try Demo to get started"}),jsxRuntimeExports.jsx("p",{className:"text-[10px] md:text-xs text-slate-400",children:"Supports: .pdb, .cif, .sdf, .mol2"})]})},InteractionTable=({interactions:r})=>{const e=()=>{const i=["ID","Type","Distance ()","Ligand Atom","Protein Atom","Residue"],s=r.map(u=>[u.id,u.type,u.distance.toFixed(2),`${u.ligandAtom.element}:${u.ligandAtom.name}`,`${u.proteinAtom.element}:${u.proteinAtom.name}`,`${u.proteinAtom.resName} ${u.proteinAtom.resNo}`]),o=[i.join(","),...s.map(u=>u.join(","))].join(`
`),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),d=document.createElement("a");d.setAttribute("href",l),d.setAttribute("download","interactions.csv"),d.click()},t=()=>{const i=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),s=URL.createObjectURL(i),o=document.createElement("a");o.setAttribute("href",s),o.setAttribute("download","interactions.json"),o.click()},n=reactExports.useMemo(()=>[...r].sort((i,s)=>i.type!==s.type?i.type.localeCompare(s.type):i.distance-s.distance),[r]);return r.length===0?jsxRuntimeExports.jsx("div",{className:"h-full flex items-center justify-center text-slate-400",children:jsxRuntimeExports.jsx("p",{children:"No interaction data available."})}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col h-full",children:[jsxRuntimeExports.jsxs("div",{className:"px-3 md:px-4 py-2 bg-white border-b border-slate-100 flex flex-wrap justify-end gap-2",children:[jsxRuntimeExports.jsxs("button",{onClick:e,className:"flex items-center gap-1 px-2 py-1.5 text-xs font-medium bg-slate-100 border border-slate-300 rounded hover:bg-slate-200 text-slate-700",children:[jsxRuntimeExports.jsx(Download,{size:12})," ",jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Export"})," CSV"]}),jsxRuntimeExports.jsxs("button",{onClick:t,className:"flex items-center gap-1 px-2 py-1.5 text-xs font-medium bg-slate-100 border border-slate-300 rounded hover:bg-slate-200 text-slate-700",children:[jsxRuntimeExports.jsx(FileBraces,{size:12})," ",jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Export"})," JSON"]})]}),jsxRuntimeExports.jsx("div",{className:"overflow-auto flex-1 bg-white",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-xs md:text-sm text-left text-slate-600 min-w-[480px]",children:[jsxRuntimeExports.jsx("thead",{className:"text-[10px] md:text-xs text-slate-700 uppercase bg-slate-50 sticky top-0 z-10 shadow-sm",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"px-2 md:px-4 py-2 border-b",children:"Type"}),jsxRuntimeExports.jsx("th",{className:"px-2 md:px-4 py-2 border-b",children:"Dist"}),jsxRuntimeExports.jsx("th",{className:"px-2 md:px-4 py-2 border-b",children:"Ligand"}),jsxRuntimeExports.jsx("th",{className:"px-2 md:px-4 py-2 border-b",children:"Protein Res"}),jsxRuntimeExports.jsx("th",{className:"px-2 md:px-4 py-2 border-b hidden sm:table-cell",children:"Protein Atom"})]})}),jsxRuntimeExports.jsx("tbody",{className:"divide-y divide-slate-100",children:n.map(i=>{let s="bg-slate-100 text-slate-800";i.type===InteractionType.HydrogenBond&&(s="bg-blue-50 text-blue-700 border border-blue-100"),i.type===InteractionType.Hydrophobic&&(s="bg-orange-50 text-orange-700 border border-orange-100"),i.type===InteractionType.SaltBridge&&(s="bg-yellow-50 text-yellow-700 border border-yellow-100"),i.type===InteractionType.HalogenBond&&(s="bg-purple-50 text-purple-700 border border-purple-100");const o=i.type.replace("Hydrogen Bond","H-Bond").replace("Hydrophobic","Hydro").replace("Salt Bridge","Salt");return jsxRuntimeExports.jsxs("tr",{className:"hover:bg-slate-50 transition-colors",children:[jsxRuntimeExports.jsx("td",{className:"px-2 md:px-4 py-2",children:jsxRuntimeExports.jsxs("span",{className:`px-1.5 md:px-2 py-0.5 rounded text-[9px] md:text-[10px] font-bold uppercase tracking-wide whitespace-nowrap ${s}`,children:[jsxRuntimeExports.jsx("span",{className:"hidden md:inline",children:i.type}),jsxRuntimeExports.jsx("span",{className:"md:hidden",children:o})]})}),jsxRuntimeExports.jsx("td",{className:"px-2 md:px-4 py-2 font-mono text-slate-900 font-medium",children:i.distance.toFixed(2)}),jsxRuntimeExports.jsxs("td",{className:"px-2 md:px-4 py-2 text-slate-600",children:[i.ligandAtom.name,jsxRuntimeExports.jsxs("span",{className:"hidden md:inline text-slate-400 text-xs",children:[" (",i.ligandAtom.element,")"]})]}),jsxRuntimeExports.jsxs("td",{className:"px-2 md:px-4 py-2 font-medium text-slate-800",children:[i.proteinAtom.resName," ",i.proteinAtom.resNo,jsxRuntimeExports.jsxs("span",{className:"text-slate-400 font-normal hidden sm:inline",children:[" (",i.proteinAtom.chain,")"]})]}),jsxRuntimeExports.jsx("td",{className:"px-2 md:px-4 py-2 text-slate-600 hidden sm:table-cell",children:i.proteinAtom.name})]},i.id)})})]})})]})},HelpPage=({onBack:r})=>jsxRuntimeExports.jsxs("div",{className:"h-screen bg-slate-100 flex flex-col font-sans text-slate-900 overflow-hidden",children:[jsxRuntimeExports.jsx("header",{className:"bg-white border-b border-slate-200 shrink-0 h-14 flex items-center justify-between px-6 z-40 shadow-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:r,className:"flex items-center gap-2 text-slate-600 hover:text-indigo-600 transition-colors",children:[jsxRuntimeExports.jsx(ArrowLeft,{size:18}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium",children:"Back"})]}),jsxRuntimeExports.jsxs("h1",{className:"text-lg font-bold text-slate-800",children:["LigPlot",jsxRuntimeExports.jsx("span",{className:"text-indigo-600",children:"3D"}),"  Documentation"]})]})}),jsxRuntimeExports.jsx("main",{className:"flex-1 overflow-auto p-6",children:jsxRuntimeExports.jsxs("div",{className:"max-w-4xl mx-auto space-y-8",children:[jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-3",children:"About LigPlot3D"}),jsxRuntimeExports.jsx("p",{className:"text-slate-600 leading-relaxed",children:"LigPlot3D is a web-based tool for analyzing and visualizing protein-ligand interactions from molecular docking studies. It uses geometric algorithms inspired by PLIP (Protein-Ligand Interaction Profiler) to detect and classify different types of non-covalent interactions."})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Interaction Detection"}),jsxRuntimeExports.jsx("p",{className:"text-slate-600 mb-4",children:"All interactions are detected using distance and angle-based geometric criteria. The following table summarizes the thresholds used:"}),jsxRuntimeExports.jsx("div",{className:"overflow-hidden rounded-lg border border-slate-200",children:jsxRuntimeExports.jsxs("table",{className:"w-full text-sm",children:[jsxRuntimeExports.jsx("thead",{className:"bg-slate-50",children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Interaction Type"}),jsxRuntimeExports.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Distance Cutoff"}),jsxRuntimeExports.jsx("th",{className:"text-left px-4 py-3 font-semibold text-slate-700",children:"Additional Criteria"})]})}),jsxRuntimeExports.jsxs("tbody",{className:"bg-white divide-y divide-slate-100",children:[jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs font-medium",children:"Hydrogen Bond"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 3.5 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Between donor (N, O, S) and acceptor atoms. DonorHAcceptor angle  120."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-yellow-50 text-yellow-700 rounded text-xs font-medium",children:"Salt Bridge"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 4.0 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Between charged heavy atoms: ARG/LYS/HIS (positive)  ASP/GLU or ligand carboxyl/phosphate/sulfate (negative)."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-orange-50 text-orange-700 rounded text-xs font-medium",children:"Hydrophobic"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 4.5 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Nonpolar carboncarbon contacts (aliphatic or aromatic)."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-green-50 text-green-700 rounded text-xs font-medium",children:"Pi-Stacking"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 5.5 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Centroidcentroid distance. Parallel: angle < 30. T-shaped: angle 60120."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-purple-50 text-purple-700 rounded text-xs font-medium",children:"Halogen Bond"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 3.5 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Between halogen (Cl, Br, I) on ligand and acceptor (N, O, S). CXA angle  140."})]}),jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"px-4 py-3",children:jsxRuntimeExports.jsx("span",{className:"px-2 py-1 bg-slate-100 text-slate-700 rounded text-xs font-medium",children:"Metal Coordination"})}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 font-mono text-slate-600",children:" 2.8 "}),jsxRuntimeExports.jsx("td",{className:"px-4 py-3 text-slate-600",children:"Involving metal ions (Zn, Mg, Fe, Cu, Ca, Na, K, Mn, Co, Ni). Distance varies by metal type."})]})]})]})})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"How Detection Works"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4 text-slate-600",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"1. Ligand Identification"}),jsxRuntimeExports.jsx("p",{children:"Heteroatoms (HETATM records) are scanned to identify potential ligands. Common residues like water (HOH), ions (NA, CL, CA), and buffers are excluded. Common ligand names (LIG, UNK, DRG) are prioritized."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"2. Binding Pocket Detection"}),jsxRuntimeExports.jsx("p",{children:"All protein atoms within 18  of the ligand center are considered for interaction analysis. This creates a sphere around the ligand for efficient computation."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"3. Ring Detection"}),jsxRuntimeExports.jsx("p",{children:"For Pi-stacking, aromatic rings in the ligand are detected using a geometric DFS algorithm that identifies 56 membered rings based on bond lengths (< 1.65 )."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"4. Deduplication"}),jsxRuntimeExports.jsx("p",{children:"If multiple interaction types are detected for the same atom pair, only the strongest is kept. Priority: Salt Bridge > Pi-Stacking > Hydrogen Bond > Hydrophobic."})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Export File Formats"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"CSV Export"}),jsxRuntimeExports.jsx("p",{className:"text-slate-600 mb-2",children:"Comma-separated values with the following columns:"}),jsxRuntimeExports.jsx("code",{className:"block bg-slate-50 p-3 rounded text-sm font-mono text-slate-700",children:"ID, Type, Distance (), Ligand Atom, Protein Atom, Residue"}),jsxRuntimeExports.jsxs("p",{className:"text-slate-500 text-sm mt-2",children:["Example: ",jsxRuntimeExports.jsx("code",{children:"hb-0, Hydrogen Bond, 2.45, O:O1, N:NH1, ARG 42"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"JSON Export"}),jsxRuntimeExports.jsx("p",{className:"text-slate-600 mb-2",children:"Full interaction data as JSON array. Each object contains:"}),jsxRuntimeExports.jsx("pre",{className:"bg-slate-50 p-3 rounded text-sm font-mono text-slate-700 overflow-x-auto",children:`{
  "id": "hb-0",
  "type": "Hydrogen Bond",
  "distance": 2.45,
  "ligandAtom": {
    "index": 145,
    "name": "O1",
    "element": "O",
    "x": 12.34, "y": 5.67, "z": 8.90,
    "resName": "LIG",
    "resNo": 1,
    "chain": "A"
  },
  "proteinAtom": {
    "index": 234,
    "name": "NH1",
    "element": "N",
    "x": 10.12, "y": 4.56, "z": 7.89,
    "resName": "ARG",
    "resNo": 42,
    "chain": "A"
  }
}`})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Residue Classifications"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Hydrophobic Residues"}),jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-600",children:"ALA, VAL, LEU, ILE, MET, PHE, TRP, PRO, CYS"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Aromatic Residues"}),jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-600",children:"PHE, TYR, TRP, HIS"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Positively Charged"}),jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-600",children:"ARG, LYS, HIS"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white p-4 rounded-lg border border-slate-200",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-slate-800 mb-2",children:"Negatively Charged"}),jsxRuntimeExports.jsx("p",{className:"font-mono text-sm text-slate-600",children:"ASP, GLU"})]})]})]}),jsxRuntimeExports.jsxs("section",{children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"Limitations"}),jsxRuntimeExports.jsxs("ul",{className:"list-disc list-inside space-y-2 text-slate-600",children:[jsxRuntimeExports.jsx("li",{children:"Hydrogen atoms are often missing from PDB files; H-bond detection uses heavy-atom distances."}),jsxRuntimeExports.jsx("li",{children:"Water-mediated hydrogen bonds are not currently detected."}),jsxRuntimeExports.jsx("li",{children:"Covalent bonds between ligand and protein are not analyzed."}),jsxRuntimeExports.jsx("li",{children:"Angle criteria for H-bonds may be relaxed when hydrogen positions are unavailable."})]})]}),jsxRuntimeExports.jsxs("section",{className:"pb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-4",children:"References"}),jsxRuntimeExports.jsxs("ul",{className:"space-y-2 text-slate-600",children:[jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"PLIP:"})," Salentin et al. (2015). PLIP: fully automated protein-ligand interaction profiler. ",jsxRuntimeExports.jsx("em",{children:"Nucleic Acids Research"}),"."]}),jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"NGL Viewer:"})," Rose et al. (2018). NGL viewer: web-based molecular graphics for large complexes. ",jsxRuntimeExports.jsx("em",{children:"Bioinformatics"}),"."]}),jsxRuntimeExports.jsxs("li",{children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"3Dmol.js:"})," Rego & Koes (2015). 3Dmol.js: molecular visualization with WebGL. ",jsxRuntimeExports.jsx("em",{children:"Bioinformatics"}),"."]})]})]})]})})]}),THRESHOLDS={HBOND_DIST:3.5,SALT_BRIDGE_DIST:4,HYDROPHOBIC_DIST:4.5,PI_STACKING_DIST:5.5,PI_STACKING_ANGLE_PARALLEL:30,PI_STACKING_ANGLE_TSHAPED:60,PI_CATION_DIST:5,HALOGEN_DIST:3.5,METAL_DIST:2.8},COMMON_LIGANDS=new Set(["LIG","UNK","DRG","INH","001","1","NAG","NDG","MAN","BMA","GAL","GLC","FUC","SIA","BGC","BGLC","BGLCC","AGLC","AGLCA","GLA","GUP","XYL","RIB","ARA","PLM","OLA","MYR","STE","ATP","ADP","AMP","GTP","GDP","NAD","NADP","FAD","FMN","HEM","HEC"]),IGNORED_RESIDUES=new Set(["HOH","DOD","TIP","WAT","SOL","NA","CL","K","MG","ZN","CA","MN","SO4","PO4"]),ATOM_PROPS={POS_CHARGE_ATOMS:{ARG:["NH1","NH2","CZ"],LYS:["NZ"],HIS:["ND1","NE2"]},NEG_CHARGE_ATOMS:{ASP:["OD1","OD2"],GLU:["OE1","OE2"]},AROMATIC_PLANES:{PHE:["CG","CD1","CD2","CE1","CE2","CZ"],TYR:["CG","CD1","CD2","CE1","CE2","CZ"],TRP:["CG","CD1","CD2","NE1","CE2","CE3","CZ2","CZ3","CH2"],HIS:["CG","ND1","CD2","CE1","NE2"]},DONORS:new Set(["N","O","S"]),ACCEPTORS:new Set(["N","O","S"]),HALOGENS:new Set(["CL","BR","I"]),METALS:new Set(["ZN","MG","FE","CU","CA","NA","K","MN","CO","NI"])},distance=(r,e)=>{const t=r.x-e.x,n=r.y-e.y,i=r.z-e.z;return Math.sqrt(t*t+n*n+i*i)},getCenter=r=>{if(r.length===0)return{x:0,y:0,z:0};let e=0,t=0,n=0;return r.forEach(i=>{e+=i.x,t+=i.y,n+=i.z}),{x:e/r.length,y:t/r.length,z:n/r.length}},sub=(r,e)=>({x:r.x-e.x,y:r.y-e.y,z:r.z-e.z}),dot=(r,e)=>r.x*e.x+r.y*e.y+r.z*e.z,cross=(r,e)=>({x:r.y*e.z-r.z*e.y,y:r.z*e.x-r.x*e.z,z:r.x*e.y-r.y*e.x}),mag=r=>Math.sqrt(r.x*r.x+r.y*r.y+r.z*r.z),normalize=r=>{const e=mag(r);return e===0?{x:0,y:0,z:0}:{x:r.x/e,y:r.y/e,z:r.z/e}},angleBetween=(r,e)=>{const t=dot(r,e),n=mag(r),i=mag(e);if(n===0||i===0)return 0;const s=Math.max(-1,Math.min(1,Math.abs(t)/(n*i)));return Math.acos(s)*180/Math.PI},getPlaneNormal=r=>{if(r.length<3)return{x:0,y:0,z:1};const e=r[0],t=r[Math.floor(r.length/2)],n=r[r.length-1],i=sub(t,e),s=sub(n,e);return normalize(cross(i,s))},parseNGLAtom=r=>({index:r.index,name:r.atomname,element:r.element,x:r.x,y:r.y,z:r.z,resName:r.resname,resNo:r.resno,chain:r.chainname,isHet:r.isHetero()}),findLigandRings=r=>{if(!r||r.length===0)return[];const e=[],t=r.map(()=>[]);for(let s=0;s<r.length;s++)for(let o=s+1;o<r.length;o++)distance(r[s],r[o])<1.65&&(t[s].push(o),t[o].push(s));const n=new Set,i=(s,o,a)=>{if(!(a.length>6)){if(a.length>=5&&t[o].includes(s)){const d=[...a].sort((u,g)=>u-g).join(",");n.has(d)||(n.add(d),e.push(a.map(u=>r[u])));return}for(const l of t[o])a.includes(l)||i(s,l,[...a,l])}};for(let s=0;s<r.length;s++)["C","N"].includes(r[s].element)&&i(s,s,[s]);return e},getLigandCandidates=r=>{const e=new Map;r.eachResidue(o=>{const a=o.resname.toUpperCase(),l=COMMON_LIGANDS.has(a),d=o.isHetero(),u=IGNORED_RESIDUES.has(a);if(l||d&&!u){const g=`${o.chainname}:${o.resno}`;if(!e.has(g)){let x=0,y=0,b=0,_=0;o.eachAtom(h=>{x+=h.x,y+=h.y,b+=h.z,_++}),e.set(g,{resName:o.resname,resNo:o.resno,chain:o.chainname,atomCount:o.atomCount,centerX:_>0?x/_:0,centerY:_>0?y/_:0,centerZ:_>0?b/_:0})}}});const t=Array.from(e.values()),n=new Map,i=new Set,s=5;for(const o of t){const a=`${o.chain}:${o.resNo}`;if(i.has(a))continue;const l=`${o.chain}:${o.resName}:${o.resNo}`,d=[o.resNo];let u=o.atomCount;i.add(a);let g=!0;for(;g;){g=!1;for(const x of t){const y=`${x.chain}:${x.resNo}`;if(!i.has(y)&&!(x.resName!==o.resName||x.chain!==o.chain))for(const b of d){const _=e.get(`${o.chain}:${b}`);if(!_)continue;const h=x.centerX-_.centerX,f=x.centerY-_.centerY,E=x.centerZ-_.centerZ;if(Math.sqrt(h*h+f*f+E*E)<s){d.push(x.resNo),u+=x.atomCount,i.add(y),g=!0;break}}}}d.sort((x,y)=>x-y),n.set(l,{resName:o.resName,resNo:d[0],resNos:d.length>1?d:void 0,chain:o.chain,atomCount:u})}return Array.from(n.values()).sort((o,a)=>{const l=COMMON_LIGANDS.has(o.resName.toUpperCase()),d=COMMON_LIGANDS.has(a.resName.toUpperCase());return l&&!d?-1:!l&&d?1:a.atomCount-o.atomCount})},findResidueByName=(r,e)=>{let t=null;const n=e.toUpperCase().trim();return r.eachResidue(i=>{t||i.resname.toUpperCase()===n&&(t={resName:i.resname,resNo:i.resno,chain:i.chainname,atomCount:i.atomCount})}),t},analyzeInteractions=(r,e)=>{const t=[],n=[],i=[],s=e.resNos??[e.resNo];if(r.eachAtom(y=>{s.includes(y.resno)&&y.chainname===e.chain&&y.resname===e.resName?n.push(parseNGLAtom(y)):y.isHetero()||i.push(parseNGLAtom(y))}),n.length===0)return{interactions:[],ligandCenter:{x:0,y:0,z:0}};const o=getCenter(n);let a=0;const l=i.filter(y=>distance(y,o)<18),d={};l.forEach(y=>{const b=`${y.chain}:${y.resNo}`;d[b]||(d[b]=[]),d[b].push(y)});const g=findLigandRings(n).map(y=>({center:getCenter(y),normal:getPlaneNormal(y),atoms:y}));Object.values(d).forEach(y=>{const b=y[0].resName,_=ATOM_PROPS.AROMATIC_PLANES[b];if(_){const E=y.filter(m=>_.includes(m.name));if(E.length>=3){const m=getCenter(E),S=getPlaneNormal(E);g.forEach(w=>{const v=distance(m,w.center);if(v<=THRESHOLDS.PI_STACKING_DIST){const A=angleBetween(S,w.normal),M=A<THRESHOLDS.PI_STACKING_ANGLE_PARALLEL||A>180-THRESHOLDS.PI_STACKING_ANGLE_PARALLEL,T=A>THRESHOLDS.PI_STACKING_ANGLE_TSHAPED&&A<120;(M||T)&&t.push({id:`pi-${a++}`,type:InteractionType.PiStacking,distance:v,ligandAtom:w.atoms[0],proteinAtom:E[0],angle:A})}}),n.forEach(w=>{(w.element==="N"||w.name.includes("NH"))&&distance(w,m)<THRESHOLDS.PI_CATION_DIST&&t.push({id:`pic-${a++}`,type:InteractionType.PiStacking,distance:distance(w,m),ligandAtom:w,proteinAtom:E[0]})})}}const h=ATOM_PROPS.POS_CHARGE_ATOMS[b],f=ATOM_PROPS.NEG_CHARGE_ATOMS[b];if(h){const E=y.filter(m=>h.includes(m.name));if(E.length>0){const m=getCenter(E);g.forEach(S=>{distance(m,S.center)<THRESHOLDS.PI_CATION_DIST&&t.push({id:`pic-${a++}`,type:InteractionType.PiStacking,distance:distance(m,S.center),ligandAtom:S.atoms[0],proteinAtom:E[0]})}),n.forEach(S=>{if(["O","S","P"].includes(S.element)){const w=distance(S,m);w<THRESHOLDS.SALT_BRIDGE_DIST&&t.push({id:`sb-${a++}`,type:InteractionType.SaltBridge,distance:w,ligandAtom:S,proteinAtom:E[0]})}})}}if(f){const E=y.filter(m=>f.includes(m.name));if(E.length>0){const m=getCenter(E);n.forEach(S=>{if(S.element==="N"||S.name.includes("NH")){const w=distance(S,m);w<THRESHOLDS.SALT_BRIDGE_DIST&&t.push({id:`sb-${a++}`,type:InteractionType.SaltBridge,distance:w,ligandAtom:S,proteinAtom:E[0]})}})}}}),n.forEach(y=>{l.forEach(b=>{const _=distance(y,b);if(!(_>Math.max(THRESHOLDS.HBOND_DIST,THRESHOLDS.HYDROPHOBIC_DIST))){if(_<=THRESHOLDS.HBOND_DIST){const h=ATOM_PROPS.DONORS.has(y.element),f=ATOM_PROPS.ACCEPTORS.has(y.element),E=ATOM_PROPS.DONORS.has(b.element),m=ATOM_PROPS.ACCEPTORS.has(b.element);(h&&m||f&&E)&&t.push({id:`hb-${a++}`,type:InteractionType.HydrogenBond,distance:_,ligandAtom:y,proteinAtom:b})}ATOM_PROPS.HALOGENS.has(y.element.toUpperCase())&&ATOM_PROPS.ACCEPTORS.has(b.element)&&_<=THRESHOLDS.HALOGEN_DIST&&t.push({id:`xb-${a++}`,type:InteractionType.HalogenBond,distance:_,ligandAtom:y,proteinAtom:b}),y.element==="C"&&b.element==="C"&&_<=THRESHOLDS.HYDROPHOBIC_DIST&&t.push({id:`hp-${a++}`,type:InteractionType.Hydrophobic,distance:_,ligandAtom:y,proteinAtom:b}),(ATOM_PROPS.METALS.has(y.element.toUpperCase())||ATOM_PROPS.METALS.has(b.element.toUpperCase()))&&_<=THRESHOLDS.METAL_DIST&&t.push({id:`mt-${a++}`,type:InteractionType.MetalCoordination,distance:_,ligandAtom:y,proteinAtom:b})}})});const x=new Map;return t.forEach(y=>{const b=`${y.ligandAtom.index}-${y.proteinAtom.index}`,_=x.get(b);if(!_)x.set(b,y);else{const h=f=>f===InteractionType.SaltBridge?4:f===InteractionType.PiStacking?3:f===InteractionType.HydrogenBond?2:1;h(y.type)>h(_.type)&&x.set(b,y)}}),{interactions:Array.from(x.values()),ligandCenter:o}},App=()=>{const[r,e]=reactExports.useState(null),[t,n]=reactExports.useState(null),[i,s]=reactExports.useState([]),[o,a]=reactExports.useState(null),[l,d]=reactExports.useState(null),[u]=reactExports.useState(!0),[g,x]=reactExports.useState(""),[y,b]=reactExports.useState(!1),[_,h]=reactExports.useState({[InteractionType.HydrogenBond]:!0,[InteractionType.SaltBridge]:!0,[InteractionType.Hydrophobic]:!1,[InteractionType.PiStacking]:!1,[InteractionType.HalogenBond]:!1,[InteractionType.MetalCoordination]:!1,[InteractionType.Unknown]:!1}),f=reactExports.useRef(null),[E,m]=reactExports.useState({proteinStyle:"cartoon",ligandStyle:"ball+stick",pocketStyle:"stick",interactionWidth:2,ligandColor:"#22c55e"}),[S,w]=reactExports.useState(0),[v,A]=reactExports.useState(!1),[M,T]=reactExports.useState(!1),R=[".pdb",".ent",".cif",".sdf",".mol2"],P=F=>{if(F.target.files&&F.target.files[0]){const j=F.target.files[0],H=j.name.toLowerCase();if(!R.some(V=>H.endsWith(V))){alert(`Unsupported file format. Please upload a molecular structure file.

Supported formats: ${R.join(", ")}`),f.current&&(f.current.value="");return}e(j),n(null),s([]),a(null),d(null)}},L=()=>{e(null),n(null),s([]),a(null),d(null),x(""),f.current&&(f.current.value="")},O=async()=>{try{const F=await fetch("/LigPlot3D/demo.cif");if(!F.ok)throw new Error("Failed to fetch demo file");const j=await F.text(),H=new Blob([j],{type:"text/plain"}),B=new File([H],"demo.cif",{type:"text/plain"});e(B),n(null),s([]),a(null),d(null)}catch(F){console.error("Error loading demo:",F),alert("Failed to load demo file. Please try uploading your own structure.")}},I=reactExports.useCallback(F=>{n(F);const j=getLigandCandidates(F);s(j),j.length>0&&a(j[0])},[]),N=()=>{if(!t||!g)return;const F=findResidueByName(t,g);F?(s(j=>j.some(B=>B.chain===F.chain&&B.resNo===F.resNo)?j:[F,...j]),a(F)):alert(`Residue '${g}' not found.`)};reactExports.useEffect(()=>{if(t&&o){const F=analyzeInteractions(t,o);d(F)}},[t,o]);const k=reactExports.useMemo(()=>l?l.interactions.filter(F=>_[F.type]):[],[l,_]),U=F=>{h(j=>({...j,[F]:!j[F]}))};return jsxRuntimeExports.jsxs("div",{className:"h-screen bg-slate-100 flex flex-col font-sans text-slate-900 overflow-hidden selection:bg-indigo-100",style:{maxWidth:"100%",width:"100%"},children:[jsxRuntimeExports.jsxs("header",{className:"bg-white border-b border-slate-200 shrink-0 h-14 flex items-center justify-between px-3 md:px-6 z-40 shadow-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>A(!v),className:"lg:hidden p-2 -ml-1 text-slate-600 hover:text-indigo-600 hover:bg-slate-100 rounded-md","aria-label":"Toggle menu",children:v?jsxRuntimeExports.jsx(X,{size:20}):jsxRuntimeExports.jsx(Menu,{size:20})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-slate-800",children:"LigPlot3D"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-1 md:gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>b(!0),className:"flex items-center gap-1 md:gap-2 px-2 md:px-3 py-1.5 text-slate-600 hover:text-indigo-600 hover:bg-indigo-50 rounded-md text-xs md:text-sm font-medium transition-colors",children:[jsxRuntimeExports.jsx(CircleQuestionMark,{size:14})," ",jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Help"})]}),r&&jsxRuntimeExports.jsxs("button",{onClick:L,className:"flex items-center gap-1 md:gap-2 px-2 md:px-3 py-1.5 text-slate-600 hover:text-red-600 hover:bg-red-50 rounded-md text-xs md:text-sm font-medium transition-colors",children:[jsxRuntimeExports.jsx(RefreshCw,{size:14})," ",jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"New Analysis"}),jsxRuntimeExports.jsx("span",{className:"sm:hidden",children:"Reset"})]}),!r&&jsxRuntimeExports.jsxs("button",{onClick:O,className:"flex items-center gap-1 md:gap-2 px-2 md:px-3 py-1.5 bg-slate-500 hover:bg-slate-600 text-white rounded-md text-xs md:text-sm font-medium transition-colors shadow-sm",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polygon",{points:"5 3 19 12 5 21 5 3"})}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Try Demo"}),jsxRuntimeExports.jsx("span",{className:"sm:hidden",children:"Demo"})]}),jsxRuntimeExports.jsxs("label",{className:"cursor-pointer inline-flex items-center gap-1 md:gap-2 px-2 md:px-4 py-1.5 bg-rose-700 hover:bg-rose-800 text-white rounded-md text-xs md:text-sm font-medium transition-all shadow-sm",children:[jsxRuntimeExports.jsx(Upload,{size:14}),jsxRuntimeExports.jsx("span",{className:"hidden sm:inline",children:"Upload Structure"}),jsxRuntimeExports.jsx("span",{className:"sm:hidden",children:"Upload"}),jsxRuntimeExports.jsx("input",{ref:f,type:"file",accept:".pdb,.ent,.cif,.sdf,.mol2",onChange:P,className:"hidden"})]})]})]}),y?jsxRuntimeExports.jsx(HelpPage,{onBack:()=>b(!1)}):jsxRuntimeExports.jsxs("main",{className:"flex-1 w-full flex flex-col lg:flex-row overflow-hidden relative",children:[v&&jsxRuntimeExports.jsx("div",{className:"lg:hidden fixed inset-0 bg-black/40 z-20 transition-opacity",onClick:()=>A(!1)}),jsxRuntimeExports.jsx("aside",{className:`
            fixed lg:relative inset-y-0 left-0 z-30
            w-[85%] max-w-[320px] lg:w-80 
            bg-white border-r border-slate-200 
            flex flex-col shrink-0 
            transform transition-transform duration-300 ease-in-out
            ${v?"translate-x-0":"-translate-x-full lg:translate-x-0"}
            lg:top-0 top-14
            overflow-y-auto
          `,children:jsxRuntimeExports.jsxs("div",{className:"p-4 flex flex-col gap-4 lg:gap-6",children:[jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 rounded-lg border border-slate-200 p-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xs font-bold uppercase text-slate-500 mb-3 flex items-center gap-2",children:"Target Selection"}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Ligand"}),jsxRuntimeExports.jsxs("select",{className:"w-full border-slate-300 rounded text-sm p-2 border bg-white focus:ring-2 focus:ring-indigo-500 outline-none",value:o?`${o.chain}:${o.resNo}`:"",onChange:F=>{const[j,H]=F.target.value.split(":"),B=i.find(V=>V.chain===j&&V.resNo===parseInt(H));B&&a(B)},disabled:i.length===0,children:[i.map(F=>{const H=F.resNos&&F.resNos.length>1?`${F.resName} ${F.resNos[0]}-${F.resNos[F.resNos.length-1]} (${F.chain}) [${F.resNos.length} units]`:`${F.resName} ${F.resNo} (Chain ${F.chain})`;return jsxRuntimeExports.jsx("option",{value:`${F.chain}:${F.resNo}`,children:H},`${F.chain}:${F.resNo}`)}),i.length===0&&jsxRuntimeExports.jsx("option",{children:"No ligands found"})]})]}),jsxRuntimeExports.jsx("div",{className:"pt-3 border-t border-slate-200",children:jsxRuntimeExports.jsxs("div",{className:"flex gap-2",children:[jsxRuntimeExports.jsx("input",{type:"text",className:"flex-1 border border-slate-300 rounded text-sm px-2 py-1",placeholder:"Search residue (e.g. LIG)",value:g,onChange:F=>x(F.target.value),onKeyDown:F=>F.key==="Enter"&&N()}),jsxRuntimeExports.jsx("button",{onClick:N,className:"px-3 py-1 bg-white border border-slate-300 hover:bg-slate-100 rounded text-sm shadow-sm",children:jsxRuntimeExports.jsx(Search,{size:14})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 rounded-lg border border-slate-200 p-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-xs font-bold uppercase text-slate-500 mb-3",children:"Visualization"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Protein"}),jsxRuntimeExports.jsxs("select",{className:"w-full text-xs border p-1 rounded",value:E.proteinStyle,onChange:F=>m({...E,proteinStyle:F.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"cartoon",children:"Cartoon"}),jsxRuntimeExports.jsx("option",{value:"rope",children:"Rope"}),jsxRuntimeExports.jsx("option",{value:"line",children:"Lines"}),jsxRuntimeExports.jsx("option",{value:"hidden",children:"Hidden"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Ligand"}),jsxRuntimeExports.jsxs("select",{className:"w-full text-xs border p-1 rounded",value:E.ligandStyle,onChange:F=>m({...E,ligandStyle:F.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"ball+stick",children:"Ball & Stick"}),jsxRuntimeExports.jsx("option",{value:"licorice",children:"Licorice"}),jsxRuntimeExports.jsx("option",{value:"spacefill",children:"Spacefill"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Ligand Color"}),jsxRuntimeExports.jsx("input",{type:"color",value:E.ligandColor,onChange:F=>m({...E,ligandColor:F.target.value}),className:"w-full h-8 border rounded cursor-pointer",title:"Change ligand carbon color"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Pocket Residues"}),jsxRuntimeExports.jsxs("select",{className:"w-full text-xs border p-1 rounded",value:E.pocketStyle,onChange:F=>m({...E,pocketStyle:F.target.value}),children:[jsxRuntimeExports.jsx("option",{value:"stick",children:"Stick"}),jsxRuntimeExports.jsx("option",{value:"licorice",children:"Licorice"}),jsxRuntimeExports.jsx("option",{value:"ball+stick",children:"Ball & Stick"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-[10px] font-bold text-slate-500 mb-1",children:"Interaction Line Width"}),jsxRuntimeExports.jsx("input",{type:"range",min:"1",max:"8",step:"1",value:E.interactionWidth,onChange:F=>m({...E,interactionWidth:parseInt(F.target.value)}),className:"w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-slate-50 rounded-lg border border-slate-200 p-4",children:[jsxRuntimeExports.jsxs("h2",{className:"text-xs font-bold uppercase text-slate-500 mb-3 flex items-center gap-2",children:[jsxRuntimeExports.jsx(Funnel,{size:14})," Interaction Filters"]}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:[{type:InteractionType.HydrogenBond,color:"bg-blue-500",label:"H-Bonds"},{type:InteractionType.SaltBridge,color:"bg-yellow-500",label:"Salt Bridges"},{type:InteractionType.PiStacking,color:"bg-green-600",label:"Pi-Stacking"},{type:InteractionType.Hydrophobic,color:"bg-slate-400",label:"Hydrophobic"},{type:InteractionType.HalogenBond,color:"bg-purple-600",label:"Halogen Bonds"}].map(F=>jsxRuntimeExports.jsxs("label",{className:"flex items-center gap-2 text-sm text-slate-700 cursor-pointer hover:bg-slate-100 p-1 rounded -mx-1 transition-colors",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:_[F.type],onChange:()=>U(F.type),className:"rounded text-indigo-600 focus:ring-0"}),jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${F.color}`}),jsxRuntimeExports.jsx("span",{children:F.label})]},F.type))})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>w(F=>F+1),className:"w-full flex items-center justify-center gap-2 px-3 py-2 bg-white border border-slate-300 rounded text-sm font-medium hover:bg-slate-100 text-slate-700",children:[jsxRuntimeExports.jsx(Move,{size:14})," Recenter View"]})]})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 w-full flex flex-col overflow-hidden relative",children:[jsxRuntimeExports.jsx("div",{className:`w-full relative border-b border-slate-200 bg-white min-h-0 transition-all duration-300 ${M?"flex-1":"flex-[2] lg:flex-[2]"}`,children:jsxRuntimeExports.jsx(Viewer3Dmol,{file:r,onStructureLoaded:I,selectedLigand:o,interactions:k,showInteractions:u,visualSettings:E,triggerRecenter:S},r?r.name:"empty")}),jsxRuntimeExports.jsxs("div",{className:`w-full overflow-hidden flex flex-col bg-white min-h-0 transition-all duration-300 ${M?"flex-[2]":"lg:flex-[1]"}`,children:[jsxRuntimeExports.jsxs("button",{onClick:()=>T(!M),className:"lg:pointer-events-none bg-slate-50 px-4 py-3 lg:py-2 border-b border-slate-200 flex items-center justify-between text-sm font-bold text-slate-700 shrink-0 w-full hover:bg-slate-100 lg:hover:bg-slate-50 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Table,{size:16}),jsxRuntimeExports.jsx("span",{children:"Interaction Data"}),k.length>0&&jsxRuntimeExports.jsx("span",{className:"text-xs font-normal text-slate-500 bg-slate-200 px-1.5 py-0.5 rounded-full",children:k.length})]}),jsxRuntimeExports.jsx("div",{className:"lg:hidden text-slate-400",children:M?jsxRuntimeExports.jsx(ChevronDown,{size:18}):jsxRuntimeExports.jsx(ChevronUp,{size:18})})]}),jsxRuntimeExports.jsx("div",{className:`flex-1 overflow-auto transition-all duration-300 ${M?"block":"hidden lg:block"}`,children:jsxRuntimeExports.jsx(InteractionTable,{interactions:k})})]})]})]})]})};clientExports.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(reactExports.StrictMode,{children:jsxRuntimeExports.jsx(App,{})}));
